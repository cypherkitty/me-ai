var Mm=Object.defineProperty;var xf=t=>{throw TypeError(t)};var Om=(t,e,n)=>e in t?Mm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var pt=(t,e,n)=>Om(t,typeof e!="symbol"?e+"":e,n),Pc=(t,e,n)=>e.has(t)||xf("Cannot "+n);var F=(t,e,n)=>(Pc(t,e,"read from private field"),n?n.call(t):e.get(t)),Me=(t,e,n)=>e.has(t)?xf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),St=(t,e,n,r)=>(Pc(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),wn=(t,e,n)=>(Pc(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const ru=!1;var jl=Array.isArray,Nm=Array.prototype.indexOf,Js=Array.prototype.includes,zl=Array.from,Rm=Object.defineProperty,Ra=Object.getOwnPropertyDescriptor,th=Object.getOwnPropertyDescriptors,nh=Object.prototype,Dm=Array.prototype,Bl=Object.getPrototypeOf,kf=Object.isExtensible;function xi(t){return typeof t=="function"}const xs=()=>{};function Lm(t){return t()}function au(t){for(var e=0;e<t.length;e++)t[e]()}function rh(){var t,e,n=new Promise((r,a)=>{t=r,e=a});return{promise:n,resolve:t,reject:e}}function qn(t,e,n=!1){return t===void 0?n?e():e:t}function io(t,e){if(Array.isArray(t))return t;if(e===void 0||!(Symbol.iterator in t))return Array.from(t);const n=[];for(const r of t)if(n.push(r),n.length===e)break;return n}function jm(t,e){var n={};for(var r in t)e.includes(r)||(n[r]=t[r]);for(var a of Object.getOwnPropertySymbols(t))Object.propertyIsEnumerable.call(t,a)&&!e.includes(a)&&(n[a]=t[a]);return n}const Mn=2,oo=4,lo=8,Xu=1<<24,wa=16,jr=32,Ka=64,su=128,mr=512,En=1024,On=2048,Dr=4096,cr=8192,ma=16384,fs=32768,za=65536,Sf=1<<17,ah=1<<18,ks=1<<19,sh=1<<20,va=1<<25,vs=65536,iu=1<<21,Zu=1<<22,Da=1<<23,Yr=Symbol("$state"),ih=Symbol("legacy props"),zm=Symbol(""),$a=new class extends Error{constructor(){super(...arguments);pt(this,"name","StaleReactionError");pt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};var Jv;const oh=!!((Jv=globalThis.document)!=null&&Jv.contentType)&&globalThis.document.contentType.includes("xml");function Qu(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Bm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function qm(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function Fm(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Km(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Hm(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Vm(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Um(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Gm(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wm(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ym(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Xm(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Zm=1,Qm=2,lh=4,Jm=8,$m=16,ey=1,ty=2,ny=4,ry=8,ay=16,ch=1,sy=2,Sn=Symbol(),uh="http://www.w3.org/1999/xhtml",iy="http://www.w3.org/2000/svg",oy="http://www.w3.org/1998/Math/MathML",ly="@attach";function cy(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function uy(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function dh(t){return t===this.v}function fh(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function vh(t){return!fh(t,this.v)}let li=!1,dy=!1;function fy(){li=!0}const vy=[];function hh(t,e=!1,n=!1){return $o(t,new Map,"",vy,null,n)}function $o(t,e,n,r,a=null,s=!1){if(typeof t=="object"&&t!==null){var i=e.get(t);if(i!==void 0)return i;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(jl(t)){var o=Array(t.length);e.set(t,o),a!==null&&e.set(a,o);for(var u=0;u<t.length;u+=1){var f=t[u];u in t&&(o[u]=$o(f,e,n,r,null,s))}return o}if(Bl(t)===nh){o={},e.set(t,o),a!==null&&e.set(a,o);for(var v of Object.keys(t))o[v]=$o(t[v],e,n,r,null,s);return o}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return $o(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let rn=null;function $s(t){rn=t}function Ju(t){return $u().get(t)}function ph(t,e){return $u().set(t,e),e}function hy(t){return $u().has(t)}function tt(t,e=!1,n){rn={p:rn,i:!1,c:null,e:null,s:t,x:null,l:li&&!e?{s:null,u:null,$:[]}:null}}function nt(t){var e=rn,n=e.e;if(n!==null){e.e=null;for(var r of n)zh(r)}return t!==void 0&&(e.x=t),e.i=!0,rn=e.p,t??{}}function co(){return!li||rn!==null&&rn.l===null}function $u(t){return rn===null&&Qu(),rn.c??(rn.c=new Map(py(rn)||void 0))}function py(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let es=[];function gh(){var t=es;es=[],au(t)}function Xr(t){if(es.length===0&&!ji){var e=es;queueMicrotask(()=>{e===es&&gh()})}es.push(t)}function gy(){for(;es.length>0;)gh()}function mh(t){var e=Kt;if(e===null)return Nt.f|=Da,t;if((e.f&fs)===0&&(e.f&oo)===0)throw t;Na(t,e)}function Na(t,e){for(;e!==null;){if((e.f&su)!==0){if((e.f&fs)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const my=-7169;function mn(t,e){t.f=t.f&my|e}function ed(t){(t.f&mr)!==0||t.deps===null?mn(t,En):mn(t,Dr)}function yh(t){if(t!==null)for(const e of t)(e.f&Mn)===0||(e.f&vs)===0||(e.f^=vs,yh(e.deps))}function bh(t,e,n){(t.f&On)!==0?e.add(t):(t.f&Dr)!==0&&n.add(t),yh(t.deps),mn(t,En)}const zo=new Set;let Et=null,dl=null,In=null,Qn=[],ql=null,ou=!1,ji=!1;var Vs,Us,as,Gs,$i,eo,ss,la,Ws,dr,lu,cu,uu,_h;const Wd=class Wd{constructor(){Me(this,dr);pt(this,"current",new Map);pt(this,"previous",new Map);Me(this,Vs,new Set);Me(this,Us,new Set);Me(this,as,0);Me(this,Gs,0);Me(this,$i,null);Me(this,eo,new Set);Me(this,ss,new Set);Me(this,la,new Map);pt(this,"is_fork",!1);Me(this,Ws,!1)}skip_effect(e){F(this,la).has(e)||F(this,la).set(e,{d:[],m:[]})}unskip_effect(e){var n=F(this,la).get(e);if(n){F(this,la).delete(e);for(var r of n.d)mn(r,On),Or(r);for(r of n.m)mn(r,Dr),Or(r)}}process(e){var a;Qn=[],this.apply();var n=[],r=[];for(const s of e)wn(this,dr,cu).call(this,s,n,r);if(wn(this,dr,lu).call(this)){wn(this,dr,uu).call(this,r),wn(this,dr,uu).call(this,n);for(const[s,i]of F(this,la))Sh(s,i)}else{for(const s of F(this,Vs))s();F(this,Vs).clear(),F(this,as)===0&&wn(this,dr,_h).call(this),dl=this,Et=null,Ef(r),Ef(n),dl=null,(a=F(this,$i))==null||a.resolve()}In=null}capture(e,n){n!==Sn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Da)===0&&(this.current.set(e,e.v),In==null||In.set(e,e.v))}activate(){Et=this,this.apply()}deactivate(){Et===this&&(Et=null,In=null)}flush(){if(this.activate(),Qn.length>0){if(wh(),Et!==null&&Et!==this)return}else F(this,as)===0&&this.process([]);this.deactivate()}discard(){for(const e of F(this,Us))e(this);F(this,Us).clear()}increment(e){St(this,as,F(this,as)+1),e&&St(this,Gs,F(this,Gs)+1)}decrement(e){St(this,as,F(this,as)-1),e&&St(this,Gs,F(this,Gs)-1),!F(this,Ws)&&(St(this,Ws,!0),Xr(()=>{St(this,Ws,!1),wn(this,dr,lu).call(this)?Qn.length>0&&this.flush():this.revive()}))}revive(){for(const e of F(this,eo))F(this,ss).delete(e),mn(e,On),Or(e);for(const e of F(this,ss))mn(e,Dr),Or(e);this.flush()}oncommit(e){F(this,Vs).add(e)}ondiscard(e){F(this,Us).add(e)}settled(){return(F(this,$i)??St(this,$i,rh())).promise}static ensure(){if(Et===null){const e=Et=new Wd;zo.add(Et),ji||Xr(()=>{Et===e&&e.flush()})}return Et}apply(){}};Vs=new WeakMap,Us=new WeakMap,as=new WeakMap,Gs=new WeakMap,$i=new WeakMap,eo=new WeakMap,ss=new WeakMap,la=new WeakMap,Ws=new WeakMap,dr=new WeakSet,lu=function(){return this.is_fork||F(this,Gs)>0},cu=function(e,n,r){e.f^=En;for(var a=e.first;a!==null;){var s=a.f,i=(s&(jr|Ka))!==0,o=i&&(s&En)!==0,u=o||(s&cr)!==0||F(this,la).has(a);if(!u&&a.fn!==null){i?a.f^=En:(s&oo)!==0?n.push(a):ho(a)&&((s&wa)!==0&&F(this,ss).add(a),ti(a));var f=a.first;if(f!==null){a=f;continue}}for(;a!==null;){var v=a.next;if(v!==null){a=v;break}a=a.parent}}},uu=function(e){for(var n=0;n<e.length;n+=1)bh(e[n],F(this,eo),F(this,ss))},_h=function(){var a;if(zo.size>1){this.previous.clear();var e=In,n=!0;for(const s of zo){if(s===this){n=!1;continue}const i=[];for(const[u,f]of this.current){if(s.current.has(u))if(n&&f!==s.current.get(u))s.current.set(u,f);else continue;i.push(u)}if(i.length===0)continue;const o=[...s.current.keys()].filter(u=>!this.current.has(u));if(o.length>0){var r=Qn;Qn=[];const u=new Set,f=new Map;for(const v of i)xh(v,o,u,f);if(Qn.length>0){Et=s,s.apply();for(const v of Qn)wn(a=s,dr,cu).call(a,v,[],[]);s.deactivate()}Qn=r}}Et=null,In=e}zo.delete(this)};let ya=Wd;function yy(t){var e=ji;ji=!0;try{for(var n;;){if(gy(),Qn.length===0&&(Et==null||Et.flush(),Qn.length===0))return ql=null,n;wh()}}finally{ji=e}}function wh(){ou=!0;var t=null;try{for(var e=0;Qn.length>0;){var n=ya.ensure();if(e++>1e3){var r,a;by()}n.process(Qn),La.clear()}}finally{Qn=[],ou=!1,ql=null}}function by(){try{Vm()}catch(t){Na(t,ql)}}let Sr=null;function Ef(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(ma|cr))===0&&ho(r)&&(Sr=new Set,ti(r),r.deps===null&&r.first===null&&r.nodes===null&&r.teardown===null&&r.ac===null&&Vh(r),(Sr==null?void 0:Sr.size)>0)){La.clear();for(const a of Sr){if((a.f&(ma|cr))!==0)continue;const s=[a];let i=a.parent;for(;i!==null;)Sr.has(i)&&(Sr.delete(i),s.push(i)),i=i.parent;for(let o=s.length-1;o>=0;o--){const u=s[o];(u.f&(ma|cr))===0&&ti(u)}}Sr.clear()}}Sr=null}}function xh(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const a of t.reactions){const s=a.f;(s&Mn)!==0?xh(a,e,n,r):(s&(Zu|wa))!==0&&(s&On)===0&&kh(a,e,r)&&(mn(a,On),Or(a))}}function kh(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const a of t.deps){if(Js.call(e,a))return!0;if((a.f&Mn)!==0&&kh(a,e,n))return n.set(a,!0),!0}return n.set(t,!1),!1}function Or(t){var e=ql=t,n=e.b;if(n!=null&&n.is_pending&&(t.f&(oo|lo|Xu))!==0&&(t.f&fs)===0){n.defer_effect(t);return}for(;e.parent!==null;){e=e.parent;var r=e.f;if(ou&&e===Kt&&(r&wa)!==0&&(r&ah)===0&&(r&fs)!==0)return;if((r&(Ka|jr))!==0){if((r&En)===0)return;e.f^=En}}Qn.push(e)}function Sh(t,e){if(!((t.f&jr)!==0&&(t.f&En)!==0)){(t.f&On)!==0?e.d.push(t):(t.f&Dr)!==0&&e.m.push(t),mn(t,En);for(var n=t.first;n!==null;)Sh(n,e),n=n.next}}function Eh(t){let e=0,n=hs(0),r;return()=>{rd()&&(l(n),Kl(()=>(e===0&&(r=er(()=>t(()=>zi(n)))),e+=1,()=>{Xr(()=>{e-=1,e===0&&(r==null||r(),r=void 0,zi(n))})})))}}var _y=za|ks;function wy(t,e,n,r){new xy(t,e,n,r)}var pr,Yu,Vr,is,Yn,Ur,or,Ar,ca,os,Ma,Ys,Xs,Zs,ua,Nl,xn,ky,Sy,Ey,du,el,tl,fu;class xy{constructor(e,n,r,a){Me(this,xn);pt(this,"parent");pt(this,"is_pending",!1);pt(this,"transform_error");Me(this,pr);Me(this,Yu,null);Me(this,Vr);Me(this,is);Me(this,Yn);Me(this,Ur,null);Me(this,or,null);Me(this,Ar,null);Me(this,ca,null);Me(this,os,0);Me(this,Ma,0);Me(this,Ys,!1);Me(this,Xs,new Set);Me(this,Zs,new Set);Me(this,ua,null);Me(this,Nl,Eh(()=>(St(this,ua,hs(F(this,os))),()=>{St(this,ua,null)})));var s;St(this,pr,e),St(this,Vr,n),St(this,is,i=>{var o=Kt;o.b=this,o.f|=su,r(i)}),this.parent=Kt.b,this.transform_error=a??((s=this.parent)==null?void 0:s.transform_error)??(i=>i),St(this,Yn,vo(()=>{wn(this,xn,du).call(this)},_y))}defer_effect(e){bh(e,F(this,Xs),F(this,Zs))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!F(this,Vr).pending}update_pending_count(e){wn(this,xn,fu).call(this,e),St(this,os,F(this,os)+e),!(!F(this,ua)||F(this,Ys))&&(St(this,Ys,!0),Xr(()=>{St(this,Ys,!1),F(this,ua)&&ei(F(this,ua),F(this,os))}))}get_effect_pending(){return F(this,Nl).call(this),l(F(this,ua))}error(e){var n=F(this,Vr).onerror;let r=F(this,Vr).failed;if(!n&&!r)throw e;F(this,Ur)&&(An(F(this,Ur)),St(this,Ur,null)),F(this,or)&&(An(F(this,or)),St(this,or,null)),F(this,Ar)&&(An(F(this,Ar)),St(this,Ar,null));var a=!1,s=!1;const i=()=>{if(a){uy();return}a=!0,s&&Xm(),F(this,Ar)!==null&&cs(F(this,Ar),()=>{St(this,Ar,null)}),wn(this,xn,tl).call(this,()=>{ya.ensure(),wn(this,xn,du).call(this)})},o=u=>{try{s=!0,n==null||n(u,i),s=!1}catch(f){Na(f,F(this,Yn)&&F(this,Yn).parent)}r&&St(this,Ar,wn(this,xn,tl).call(this,()=>{ya.ensure();try{return $n(()=>{var f=Kt;f.b=this,f.f|=su,r(F(this,pr),()=>u,()=>i)})}catch(f){return Na(f,F(this,Yn).parent),null}}))};Xr(()=>{var u;try{u=this.transform_error(e)}catch(f){Na(f,F(this,Yn)&&F(this,Yn).parent);return}u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(o,f=>Na(f,F(this,Yn)&&F(this,Yn).parent)):o(u)})}}pr=new WeakMap,Yu=new WeakMap,Vr=new WeakMap,is=new WeakMap,Yn=new WeakMap,Ur=new WeakMap,or=new WeakMap,Ar=new WeakMap,ca=new WeakMap,os=new WeakMap,Ma=new WeakMap,Ys=new WeakMap,Xs=new WeakMap,Zs=new WeakMap,ua=new WeakMap,Nl=new WeakMap,xn=new WeakSet,ky=function(){try{St(this,Ur,$n(()=>F(this,is).call(this,F(this,pr))))}catch(e){this.error(e)}},Sy=function(e){const n=F(this,Vr).failed;n&&St(this,Ar,$n(()=>{n(F(this,pr),()=>e,()=>()=>{})}))},Ey=function(){const e=F(this,Vr).pending;e&&(this.is_pending=!0,St(this,or,$n(()=>e(F(this,pr)))),Xr(()=>{var n=St(this,ca,document.createDocumentFragment()),r=ba();n.append(r),St(this,Ur,wn(this,xn,tl).call(this,()=>(ya.ensure(),$n(()=>F(this,is).call(this,r))))),F(this,Ma)===0&&(F(this,pr).before(n),St(this,ca,null),cs(F(this,or),()=>{St(this,or,null)}),wn(this,xn,el).call(this))}))},du=function(){try{if(this.is_pending=this.has_pending_snippet(),St(this,Ma,0),St(this,os,0),St(this,Ur,$n(()=>{F(this,is).call(this,F(this,pr))})),F(this,Ma)>0){var e=St(this,ca,document.createDocumentFragment());Wh(F(this,Ur),e);const n=F(this,Vr).pending;St(this,or,$n(()=>n(F(this,pr))))}else wn(this,xn,el).call(this)}catch(n){this.error(n)}},el=function(){this.is_pending=!1;for(const e of F(this,Xs))mn(e,On),Or(e);for(const e of F(this,Zs))mn(e,Dr),Or(e);F(this,Xs).clear(),F(this,Zs).clear()},tl=function(e){var n=Kt,r=Nt,a=rn;$r(F(this,Yn)),_r(F(this,Yn)),$s(F(this,Yn).ctx);try{return e()}catch(s){return mh(s),null}finally{$r(n),_r(r),$s(a)}},fu=function(e){var n;if(!this.has_pending_snippet()){this.parent&&wn(n=this.parent,xn,fu).call(n,e);return}St(this,Ma,F(this,Ma)+e),F(this,Ma)===0&&(wn(this,xn,el).call(this),F(this,or)&&cs(F(this,or),()=>{St(this,or,null)}),F(this,ca)&&(F(this,pr).before(F(this,ca)),St(this,ca,null)))};function Ah(t,e,n,r){const a=co()?uo:td;var s=t.filter(p=>!p.settled);if(n.length===0&&s.length===0){r(e.map(a));return}var i=Kt,o=Ay(),u=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(p=>p.promise)):null;function f(p){o();try{r(p)}catch(h){(i.f&ma)===0&&Na(h,i)}vu()}if(n.length===0){u.then(()=>f(e.map(a)));return}function v(){o(),Promise.all(n.map(p=>Cy(p))).then(p=>f([...e.map(a),...p])).catch(p=>Na(p,i))}u?u.then(v):v()}function Ay(){var t=Kt,e=Nt,n=rn,r=Et;return function(s=!0){$r(t),_r(e),$s(n),s&&(r==null||r.activate())}}function vu(t=!0){$r(null),_r(null),$s(null),t&&(Et==null||Et.deactivate())}function Ty(){var t=Kt.b,e=Et,n=t.is_rendered();return t.update_pending_count(1),e.increment(n),()=>{t.update_pending_count(-1),e.decrement(n)}}function uo(t){var e=Mn|On,n=Nt!==null&&(Nt.f&Mn)!==0?Nt:null;return Kt!==null&&(Kt.f|=ks),{ctx:rn,deps:null,effects:null,equals:dh,f:e,fn:t,reactions:null,rv:0,v:Sn,wv:0,parent:n??Kt,ac:null}}function Cy(t,e,n){Kt===null&&Bm();var a=void 0,s=hs(Sn),i=!Nt,o=new Map;return Fy(()=>{var h;var u=rh();a=u.promise;try{Promise.resolve(t()).then(u.resolve,u.reject).finally(vu)}catch(m){u.reject(m),vu()}var f=Et;if(i){var v=Ty();(h=o.get(f))==null||h.reject($a),o.delete(f),o.set(f,u)}const p=(m,x=void 0)=>{if(f.activate(),x)x!==$a&&(s.f|=Da,ei(s,x));else{(s.f&Da)!==0&&(s.f^=Da),ei(s,m);for(const[k,T]of o){if(o.delete(k),k===f)break;T.reject($a)}}v&&v()};u.promise.then(p,m=>p(null,m||"unknown"))}),ad(()=>{for(const u of o.values())u.reject($a)}),new Promise(u=>{function f(v){function p(){v===a?u(s):f(a)}v.then(p,p)}f(a)})}function $(t){const e=uo(t);return Yh(e),e}function td(t){const e=uo(t);return e.equals=vh,e}function Iy(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)An(e[n])}}function Py(t){for(var e=t.parent;e!==null;){if((e.f&Mn)===0)return(e.f&ma)===0?e:null;e=e.parent}return null}function nd(t){var e,n=Kt;$r(Py(t));try{t.f&=~vs,Iy(t),e=Jh(t)}finally{$r(n)}return e}function Th(t){var e=nd(t);if(!t.equals(e)&&(t.wv=Zh(),(!(Et!=null&&Et.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){mn(t,En);return}Ba||(In!==null?(rd()||Et!=null&&Et.is_fork)&&In.set(t,e):ed(t))}function My(t){var e,n;if(t.effects!==null)for(const r of t.effects)(r.teardown||r.ac)&&((e=r.teardown)==null||e.call(r),(n=r.ac)==null||n.abort($a),r.teardown=xs,r.ac=null,Hi(r,0),sd(r))}function Ch(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&ti(e)}let hu=new Set;const La=new Map;let Ih=!1;function hs(t,e){var n={f:0,v:t,reactions:null,equals:dh,rv:0,wv:0};return n}function Oe(t,e){const n=hs(t);return Yh(n),n}function Oy(t,e=!1,n=!0){var a;const r=hs(t);return e||(r.equals=vh),li&&n&&rn!==null&&rn.l!==null&&((a=rn.l).s??(a.s=[])).push(r),r}function M(t,e,n=!1){Nt!==null&&(!Nr||(Nt.f&Sf)!==0)&&co()&&(Nt.f&(Mn|wa|Zu|Sf))!==0&&(yr===null||!Js.call(yr,t))&&Ym();let r=n?tn(e):e;return ei(t,r)}function ei(t,e){if(!t.equals(e)){var n=t.v;Ba?La.set(t,e):La.set(t,n),t.v=e;var r=ya.ensure();if(r.capture(t,n),(t.f&Mn)!==0){const a=t;(t.f&On)!==0&&nd(a),ed(a)}t.wv=Zh(),Ph(t,On),co()&&Kt!==null&&(Kt.f&En)!==0&&(Kt.f&(jr|Ka))===0&&(hr===null?Hy([t]):hr.push(t)),!r.is_fork&&hu.size>0&&!Ih&&Ny()}return e}function Ny(){Ih=!1;for(const t of hu)(t.f&En)!==0&&mn(t,Dr),ho(t)&&ti(t);hu.clear()}function zi(t){M(t,t.v+1)}function Ph(t,e){var n=t.reactions;if(n!==null)for(var r=co(),a=n.length,s=0;s<a;s++){var i=n[s],o=i.f;if(!(!r&&i===Kt)){var u=(o&On)===0;if(u&&mn(i,e),(o&Mn)!==0){var f=i;In==null||In.delete(f),(o&vs)===0&&(o&mr&&(i.f|=vs),Ph(f,Dr))}else u&&((o&wa)!==0&&Sr!==null&&Sr.add(i),Or(i))}}}function tn(t){if(typeof t!="object"||t===null||Yr in t)return t;const e=Bl(t);if(e!==nh&&e!==Dm)return t;var n=new Map,r=jl(t),a=Oe(0),s=us,i=o=>{if(us===s)return o();var u=Nt,f=us;_r(null),If(s);var v=o();return _r(u),If(f),v};return r&&n.set("length",Oe(t.length)),new Proxy(t,{defineProperty(o,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Gm();var v=n.get(u);return v===void 0?i(()=>{var p=Oe(f.value);return n.set(u,p),p}):M(v,f.value,!0),!0},deleteProperty(o,u){var f=n.get(u);if(f===void 0){if(u in o){const v=i(()=>Oe(Sn));n.set(u,v),zi(a)}}else M(f,Sn),zi(a);return!0},get(o,u,f){var m;if(u===Yr)return t;var v=n.get(u),p=u in o;if(v===void 0&&(!p||(m=Ra(o,u))!=null&&m.writable)&&(v=i(()=>{var x=tn(p?o[u]:Sn),k=Oe(x);return k}),n.set(u,v)),v!==void 0){var h=l(v);return h===Sn?void 0:h}return Reflect.get(o,u,f)},getOwnPropertyDescriptor(o,u){var f=Reflect.getOwnPropertyDescriptor(o,u);if(f&&"value"in f){var v=n.get(u);v&&(f.value=l(v))}else if(f===void 0){var p=n.get(u),h=p==null?void 0:p.v;if(p!==void 0&&h!==Sn)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return f},has(o,u){var h;if(u===Yr)return!0;var f=n.get(u),v=f!==void 0&&f.v!==Sn||Reflect.has(o,u);if(f!==void 0||Kt!==null&&(!v||(h=Ra(o,u))!=null&&h.writable)){f===void 0&&(f=i(()=>{var m=v?tn(o[u]):Sn,x=Oe(m);return x}),n.set(u,f));var p=l(f);if(p===Sn)return!1}return v},set(o,u,f,v){var G;var p=n.get(u),h=u in o;if(r&&u==="length")for(var m=f;m<p.v;m+=1){var x=n.get(m+"");x!==void 0?M(x,Sn):m in o&&(x=i(()=>Oe(Sn)),n.set(m+"",x))}if(p===void 0)(!h||(G=Ra(o,u))!=null&&G.writable)&&(p=i(()=>Oe(void 0)),M(p,tn(f)),n.set(u,p));else{h=p.v!==Sn;var k=i(()=>tn(f));M(p,k)}var T=Reflect.getOwnPropertyDescriptor(o,u);if(T!=null&&T.set&&T.set.call(v,f),!h){if(r&&typeof u=="string"){var N=n.get("length"),z=Number(u);Number.isInteger(z)&&z>=N.v&&M(N,z+1)}zi(a)}return!0},ownKeys(o){l(a);var u=Reflect.ownKeys(o).filter(p=>{var h=n.get(p);return h===void 0||h.v!==Sn});for(var[f,v]of n)v.v!==Sn&&!(f in o)&&u.push(f);return u},setPrototypeOf(){Wm()}})}function Af(t){try{if(t!==null&&typeof t=="object"&&Yr in t)return t[Yr]}catch{}return t}function Ry(t,e){return Object.is(Af(t),Af(e))}var Wn,Mh,Oh,Nh;function Dy(){if(Wn===void 0){Wn=window,Mh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Oh=Ra(e,"firstChild").get,Nh=Ra(e,"nextSibling").get,kf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),kf(n)&&(n.__t=void 0)}}function ba(t=""){return document.createTextNode(t)}function gr(t){return Oh.call(t)}function fo(t){return Nh.call(t)}function b(t,e){return gr(t)}function Ye(t,e=!1){{var n=gr(t);return n instanceof Comment&&n.data===""?fo(n):n}}function w(t,e=1,n=!1){let r=t;for(;e--;)r=fo(r);return r}function Ly(t){t.textContent=""}function Rh(){return!1}function Dh(t,e,n){return document.createElementNS(e??uh,t,void 0)}function jy(t,e){if(e){const n=document.body;t.autofocus=!0,Xr(()=>{document.activeElement===n&&t.focus()})}}let Tf=!1;function zy(){Tf||(Tf=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Fl(t){var e=Nt,n=Kt;_r(null),$r(null);try{return t()}finally{_r(e),$r(n)}}function Lh(t,e,n,r=n){t.addEventListener(e,()=>Fl(n));const a=t.__on_r;a?t.__on_r=()=>{a(),r(!0)}:t.__on_r=()=>r(!0),zy()}function jh(t){Kt===null&&(Nt===null&&Hm(),Km()),Ba&&Fm()}function By(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function xr(t,e,n){var r=Kt;r!==null&&(r.f&cr)!==0&&(t|=cr);var a={ctx:rn,deps:null,nodes:null,f:t|On|mr,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{ti(a)}catch(o){throw An(a),o}else e!==null&&Or(a);var s=a;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&ks)===0&&(s=s.first,(t&wa)!==0&&(t&za)!==0&&s!==null&&(s.f|=za)),s!==null&&(s.parent=r,r!==null&&By(s,r),Nt!==null&&(Nt.f&Mn)!==0&&(t&Ka)===0)){var i=Nt;(i.effects??(i.effects=[])).push(s)}return a}function rd(){return Nt!==null&&!Nr}function ad(t){const e=xr(lo,null,!1);return mn(e,En),e.teardown=t,e}function Nn(t){jh();var e=Kt.f,n=!Nt&&(e&jr)!==0&&(e&fs)===0;if(n){var r=rn;(r.e??(r.e=[])).push(t)}else return zh(t)}function zh(t){return xr(oo|sh,t,!1)}function Bh(t){return jh(),xr(lo|sh,t,!0)}function qh(t){ya.ensure();const e=xr(Ka|ks,t,!0);return()=>{An(e)}}function qy(t){ya.ensure();const e=xr(Ka|ks,t,!0);return(n={})=>new Promise(r=>{n.outro?cs(e,()=>{An(e),r(void 0)}):(An(e),r(void 0))})}function ci(t){return xr(oo,t,!1)}function Fy(t){return xr(Zu|ks,t,!0)}function Kl(t,e=0){return xr(lo|e,t,!0)}function se(t,e=[],n=[],r=[]){Ah(r,e,n,a=>{xr(lo,()=>t(...a.map(l)),!0)})}function vo(t,e=0){var n=xr(wa|e,t,!0);return n}function Fh(t,e=0){var n=xr(Xu|e,t,!0);return n}function $n(t){return xr(jr|ks,t,!0)}function Kh(t){var e=t.teardown;if(e!==null){const n=Ba,r=Nt;Cf(!0),_r(null);try{e.call(null)}finally{Cf(n),_r(r)}}}function sd(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const a=n.ac;a!==null&&Fl(()=>{a.abort($a)});var r=n.next;(n.f&Ka)!==0?n.parent=null:An(n,e),n=r}}function Ky(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&jr)===0&&An(e),e=n}}function An(t,e=!0){var n=!1;(e||(t.f&ah)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Hh(t.nodes.start,t.nodes.end),n=!0),sd(t,e&&!n),Hi(t,0),mn(t,ma);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Kh(t);var a=t.parent;a!==null&&a.first!==null&&Vh(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Hh(t,e){for(;t!==null;){var n=t===e?null:fo(t);t.remove(),t=n}}function Vh(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function cs(t,e,n=!0){var r=[];Uh(t,r,!0);var a=()=>{n&&An(t),e&&e()},s=r.length;if(s>0){var i=()=>--s||a();for(var o of r)o.out(i)}else a()}function Uh(t,e,n){if((t.f&cr)===0){t.f^=cr;var r=t.nodes&&t.nodes.t;if(r!==null)for(const o of r)(o.is_global||n)&&e.push(o);for(var a=t.first;a!==null;){var s=a.next,i=(a.f&za)!==0||(a.f&jr)!==0&&(t.f&wa)!==0;Uh(a,e,i?n:!1),a=s}}}function id(t){Gh(t,!0)}function Gh(t,e){if((t.f&cr)!==0){t.f^=cr,(t.f&En)===0&&(mn(t,On),Or(t));for(var n=t.first;n!==null;){var r=n.next,a=(n.f&za)!==0||(n.f&jr)!==0;Gh(n,a?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)(i.is_global||e)&&i.in()}}function Wh(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var a=n===r?null:fo(n);e.append(n),n=a}}let nl=!1,Ba=!1;function Cf(t){Ba=t}let Nt=null,Nr=!1;function _r(t){Nt=t}let Kt=null;function $r(t){Kt=t}let yr=null;function Yh(t){Nt!==null&&(yr===null?yr=[t]:yr.push(t))}let Jn=null,ir=0,hr=null;function Hy(t){hr=t}let Xh=1,ts=0,us=ts;function If(t){us=t}function Zh(){return++Xh}function ho(t){var e=t.f;if((e&On)!==0)return!0;if(e&Mn&&(t.f&=~vs),(e&Dr)!==0){for(var n=t.deps,r=n.length,a=0;a<r;a++){var s=n[a];if(ho(s)&&Th(s),s.wv>t.wv)return!0}(e&mr)!==0&&In===null&&mn(t,En)}return!1}function Qh(t,e,n=!0){var r=t.reactions;if(r!==null&&!(yr!==null&&Js.call(yr,t)))for(var a=0;a<r.length;a++){var s=r[a];(s.f&Mn)!==0?Qh(s,e,!1):e===s&&(n?mn(s,On):(s.f&En)!==0&&mn(s,Dr),Or(s))}}function Jh(t){var k;var e=Jn,n=ir,r=hr,a=Nt,s=yr,i=rn,o=Nr,u=us,f=t.f;Jn=null,ir=0,hr=null,Nt=(f&(jr|Ka))===0?t:null,yr=null,$s(t.ctx),Nr=!1,us=++ts,t.ac!==null&&(Fl(()=>{t.ac.abort($a)}),t.ac=null);try{t.f|=iu;var v=t.fn,p=v();t.f|=fs;var h=t.deps,m=Et==null?void 0:Et.is_fork;if(Jn!==null){var x;if(m||Hi(t,ir),h!==null&&ir>0)for(h.length=ir+Jn.length,x=0;x<Jn.length;x++)h[ir+x]=Jn[x];else t.deps=h=Jn;if(rd()&&(t.f&mr)!==0)for(x=ir;x<h.length;x++)((k=h[x]).reactions??(k.reactions=[])).push(t)}else!m&&h!==null&&ir<h.length&&(Hi(t,ir),h.length=ir);if(co()&&hr!==null&&!Nr&&h!==null&&(t.f&(Mn|Dr|On))===0)for(x=0;x<hr.length;x++)Qh(hr[x],t);if(a!==null&&a!==t){if(ts++,a.deps!==null)for(let T=0;T<n;T+=1)a.deps[T].rv=ts;if(e!==null)for(const T of e)T.rv=ts;hr!==null&&(r===null?r=hr:r.push(...hr))}return(t.f&Da)!==0&&(t.f^=Da),p}catch(T){return mh(T)}finally{t.f^=iu,Jn=e,ir=n,hr=r,Nt=a,yr=s,$s(i),Nr=o,us=u}}function Vy(t,e){let n=e.reactions;if(n!==null){var r=Nm.call(n,t);if(r!==-1){var a=n.length-1;a===0?n=e.reactions=null:(n[r]=n[a],n.pop())}}if(n===null&&(e.f&Mn)!==0&&(Jn===null||!Js.call(Jn,e))){var s=e;(s.f&mr)!==0&&(s.f^=mr,s.f&=~vs),ed(s),My(s),Hi(s,0)}}function Hi(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)Vy(t,n[r])}function ti(t){var e=t.f;if((e&ma)===0){mn(t,En);var n=Kt,r=nl;Kt=t,nl=!0;try{(e&(wa|Xu))!==0?Ky(t):sd(t),Kh(t);var a=Jh(t);t.teardown=typeof a=="function"?a:null,t.wv=Xh;var s;ru&&dy&&(t.f&On)!==0&&t.deps}finally{nl=r,Kt=n}}}async function $h(){await Promise.resolve(),yy()}function l(t){var e=t.f,n=(e&Mn)!==0;if(Nt!==null&&!Nr){var r=Kt!==null&&(Kt.f&ma)!==0;if(!r&&(yr===null||!Js.call(yr,t))){var a=Nt.deps;if((Nt.f&iu)!==0)t.rv<ts&&(t.rv=ts,Jn===null&&a!==null&&a[ir]===t?ir++:Jn===null?Jn=[t]:Jn.push(t));else{(Nt.deps??(Nt.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[Nt]:Js.call(s,Nt)||s.push(Nt)}}}if(Ba&&La.has(t))return La.get(t);if(n){var i=t;if(Ba){var o=i.v;return((i.f&En)===0&&i.reactions!==null||tp(i))&&(o=nd(i)),La.set(i,o),o}var u=(i.f&mr)===0&&!Nr&&Nt!==null&&(nl||(Nt.f&mr)!==0),f=(i.f&fs)===0;ho(i)&&(u&&(i.f|=mr),Th(i)),u&&!f&&(Ch(i),ep(i))}if(In!=null&&In.has(t))return In.get(t);if((t.f&Da)!==0)throw t.v;return t.v}function ep(t){if(t.f|=mr,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&Mn)!==0&&(e.f&mr)===0&&(Ch(e),ep(e))}function tp(t){if(t.v===Sn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(La.has(e)||(e.f&Mn)!==0&&tp(e))return!0;return!1}function er(t){var e=Nr;try{return Nr=!0,t()}finally{Nr=e}}function np(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Yr in t)pu(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Yr in n&&pu(n)}}}function pu(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{pu(t[r],e)}catch{}const n=Bl(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=th(n);for(let a in r){const s=r[a].get;if(s)try{s.call(t)}catch{}}}}}function Uy(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const Gy=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Wy(t){return Gy.includes(t)}const Yy={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Xy(t){return t=t.toLowerCase(),Yy[t]??t}const Zy=["touchstart","touchmove"];function Qy(t){return Zy.includes(t)}const ns=Symbol("events"),rp=new Set,gu=new Set;function od(t,e,n,r={}){function a(s){if(r.capture||yu.call(e,s),!s.cancelBubble)return Fl(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Xr(()=>{e.addEventListener(t,a,r)}):e.addEventListener(t,a,r),a}function mu(t,e,n,r={}){var a=od(e,t,n,r);return()=>{t.removeEventListener(e,a,r)}}function fl(t,e,n,r,a){var s={capture:r,passive:a},i=od(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ad(()=>{e.removeEventListener(t,i,s)})}function Ce(t,e,n){(e[ns]??(e[ns]={}))[t]=n}function $t(t){for(var e=0;e<t.length;e++)rp.add(t[e]);for(var n of gu)n(t)}let Pf=null;function yu(t){var T,N;var e=this,n=e.ownerDocument,r=t.type,a=((T=t.composedPath)==null?void 0:T.call(t))||[],s=a[0]||t.target;Pf=t;var i=0,o=Pf===t&&t[ns];if(o){var u=a.indexOf(o);if(u!==-1&&(e===document||e===window)){t[ns]=e;return}var f=a.indexOf(e);if(f===-1)return;u<=f&&(i=u)}if(s=a[i]||t.target,s!==e){Rm(t,"currentTarget",{configurable:!0,get(){return s||n}});var v=Nt,p=Kt;_r(null),$r(null);try{for(var h,m=[];s!==null;){var x=s.assignedSlot||s.parentNode||s.host||null;try{var k=(N=s[ns])==null?void 0:N[r];k!=null&&(!s.disabled||t.target===s)&&k.call(s,t)}catch(z){h?m.push(z):h=z}if(t.cancelBubble||x===e||x===null)break;s=x}if(h){for(let z of m)queueMicrotask(()=>{throw z});throw h}}finally{t[ns]=e,delete t.currentTarget,_r(v),$r(p)}}}var $v;const Mc=(($v=globalThis==null?void 0:globalThis.window)==null?void 0:$v.trustedTypes)&&globalThis.window.trustedTypes.createPolicy("svelte-trusted-html",{createHTML:t=>t});function Jy(t){return(Mc==null?void 0:Mc.createHTML(t))??t}function ap(t){var e=Dh("template");return e.innerHTML=Jy(t.replaceAll("<!>","<!---->")),e.content}function ps(t,e){var n=Kt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function q(t,e){var n=(e&ch)!==0,r=(e&sy)!==0,a,s=!t.startsWith("<!>");return()=>{a===void 0&&(a=ap(s?t:"<!>"+t),n||(a=gr(a)));var i=r||Mh?document.importNode(a,!0):a.cloneNode(!0);if(n){var o=gr(i),u=i.lastChild;ps(o,u)}else ps(i,i);return i}}function $y(t,e,n="svg"){var r=!t.startsWith("<!>"),a=(e&ch)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,i;return()=>{if(!i){var o=ap(s),u=gr(o);if(a)for(i=document.createDocumentFragment();gr(u);)i.appendChild(gr(u));else i=gr(u)}var f=i.cloneNode(!0);if(a){var v=gr(f),p=f.lastChild;ps(v,p)}else ps(f,f);return f}}function bn(t,e){return $y(t,e,"svg")}function yn(t=""){{var e=ba(t+"");return ps(e,e),e}}function cn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=ba();return t.append(e,n),ps(e,n),t}function C(t,e){t!==null&&t.before(e)}function te(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function eb(t,e){return tb(t,e)}const Bo=new Map;function tb(t,{target:e,anchor:n,props:r={},events:a,context:s,intro:i=!0,transformError:o}){Dy();var u=void 0,f=qy(()=>{var v=n??e.appendChild(ba());wy(v,{pending:()=>{}},m=>{tt({});var x=rn;s&&(x.c=s),a&&(r.$$events=a),u=t(m,r)||{},nt()},o);var p=new Set,h=m=>{for(var x=0;x<m.length;x++){var k=m[x];if(!p.has(k)){p.add(k);var T=Qy(k);for(const G of[e,document]){var N=Bo.get(G);N===void 0&&(N=new Map,Bo.set(G,N));var z=N.get(k);z===void 0?(G.addEventListener(k,yu,{passive:T}),N.set(k,1)):N.set(k,z+1)}}}};return h(zl(rp)),gu.add(h),()=>{var T;for(var m of p)for(const N of[e,document]){var x=Bo.get(N),k=x.get(m);--k==0?(N.removeEventListener(m,yu),x.delete(m),x.size===0&&Bo.delete(N)):x.set(m,k)}gu.delete(h),v!==n&&((T=v.parentNode)==null||T.removeChild(v))}});return nb.set(u,f),u}let nb=new WeakMap;var Tr,Gr,lr,ls,to,no,Rl;class ld{constructor(e,n=!0){pt(this,"anchor");Me(this,Tr,new Map);Me(this,Gr,new Map);Me(this,lr,new Map);Me(this,ls,new Set);Me(this,to,!0);Me(this,no,()=>{var e=Et;if(F(this,Tr).has(e)){var n=F(this,Tr).get(e),r=F(this,Gr).get(n);if(r)id(r),F(this,ls).delete(n);else{var a=F(this,lr).get(n);a&&(F(this,Gr).set(n,a.effect),F(this,lr).delete(n),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),r=a.effect)}for(const[s,i]of F(this,Tr)){if(F(this,Tr).delete(s),s===e)break;const o=F(this,lr).get(i);o&&(An(o.effect),F(this,lr).delete(i))}for(const[s,i]of F(this,Gr)){if(s===n||F(this,ls).has(s))continue;const o=()=>{if(Array.from(F(this,Tr).values()).includes(s)){var f=document.createDocumentFragment();Wh(i,f),f.append(ba()),F(this,lr).set(s,{effect:i,fragment:f})}else An(i);F(this,ls).delete(s),F(this,Gr).delete(s)};F(this,to)||!r?(F(this,ls).add(s),cs(i,o,!1)):o()}}});Me(this,Rl,e=>{F(this,Tr).delete(e);const n=Array.from(F(this,Tr).values());for(const[r,a]of F(this,lr))n.includes(r)||(An(a.effect),F(this,lr).delete(r))});this.anchor=e,St(this,to,n)}ensure(e,n){var r=Et,a=Rh();if(n&&!F(this,Gr).has(e)&&!F(this,lr).has(e))if(a){var s=document.createDocumentFragment(),i=ba();s.append(i),F(this,lr).set(e,{effect:$n(()=>n(i)),fragment:s})}else F(this,Gr).set(e,$n(()=>n(this.anchor)));if(F(this,Tr).set(r,e),a){for(const[o,u]of F(this,Gr))o===e?r.unskip_effect(u):r.skip_effect(u);for(const[o,u]of F(this,lr))o===e?r.unskip_effect(u.effect):r.skip_effect(u.effect);r.oncommit(F(this,no)),r.ondiscard(F(this,Rl))}else F(this,no).call(this)}}Tr=new WeakMap,Gr=new WeakMap,lr=new WeakMap,ls=new WeakMap,to=new WeakMap,no=new WeakMap,Rl=new WeakMap;function pe(t,e,n=!1){var r=new ld(t),a=n?za:0;function s(i,o){r.ensure(i,o)}vo(()=>{var i=!1;e((o,u=0)=>{i=!0,s(u,o)}),i||s(!1,null)},a)}function Wt(t,e){return e}function rb(t,e,n){for(var r=[],a=e.length,s,i=e.length,o=0;o<a;o++){let p=e[o];cs(p,()=>{if(s){if(s.pending.delete(p),s.done.add(p),s.pending.size===0){var h=t.outrogroups;bu(zl(s.done)),h.delete(s),h.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var u=r.length===0&&n!==null;if(u){var f=n,v=f.parentNode;Ly(v),v.append(f),t.items.clear()}bu(e,!u)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function bu(t,e=!0){for(var n=0;n<t.length;n++)An(t[n],e)}var Mf;function Ct(t,e,n,r,a,s=null){var i=t,o=new Map,u=(e&lh)!==0;if(u){var f=t;i=f.appendChild(ba())}var v=null,p=td(()=>{var N=n();return jl(N)?N:N==null?[]:zl(N)}),h,m=!0;function x(){T.fallback=v,ab(T,h,i,e,r),v!==null&&(h.length===0?(v.f&va)===0?id(v):(v.f^=va,Ni(v,null,i)):cs(v,()=>{v=null}))}var k=vo(()=>{h=l(p);for(var N=h.length,z=new Set,G=Et,S=Rh(),j=0;j<N;j+=1){var L=h[j],D=r(L,j),J=m?null:o.get(D);J?(J.v&&ei(J.v,L),J.i&&ei(J.i,j),S&&G.unskip_effect(J.e)):(J=sb(o,m?i:Mf??(Mf=ba()),L,D,j,a,e,n),m||(J.e.f|=va),o.set(D,J)),z.add(D)}if(N===0&&s&&!v&&(m?v=$n(()=>s(i)):(v=$n(()=>s(Mf??(Mf=ba()))),v.f|=va)),N>z.size&&qm(),!m)if(S){for(const[ae,ke]of o)z.has(ae)||G.skip_effect(ke.e);G.oncommit(x),G.ondiscard(()=>{})}else x();l(p)}),T={effect:k,items:o,outrogroups:null,fallback:v};m=!1}function ki(t){for(;t!==null&&(t.f&jr)===0;)t=t.next;return t}function ab(t,e,n,r,a){var ke,X,A,K,P,O,I,Q,W;var s=(r&Jm)!==0,i=e.length,o=t.items,u=ki(t.effect.first),f,v=null,p,h=[],m=[],x,k,T,N;if(s)for(N=0;N<i;N+=1)x=e[N],k=a(x,N),T=o.get(k).e,(T.f&va)===0&&((X=(ke=T.nodes)==null?void 0:ke.a)==null||X.measure(),(p??(p=new Set)).add(T));for(N=0;N<i;N+=1){if(x=e[N],k=a(x,N),T=o.get(k).e,t.outrogroups!==null)for(const Z of t.outrogroups)Z.pending.delete(T),Z.done.delete(T);if((T.f&va)!==0)if(T.f^=va,T===u)Ni(T,null,n);else{var z=v?v.next:u;T===t.effect.last&&(t.effect.last=T.prev),T.prev&&(T.prev.next=T.next),T.next&&(T.next.prev=T.prev),Ta(t,v,T),Ta(t,T,z),Ni(T,z,n),v=T,h=[],m=[],u=ki(v.next);continue}if((T.f&cr)!==0&&(id(T),s&&((K=(A=T.nodes)==null?void 0:A.a)==null||K.unfix(),(p??(p=new Set)).delete(T))),T!==u){if(f!==void 0&&f.has(T)){if(h.length<m.length){var G=m[0],S;v=G.prev;var j=h[0],L=h[h.length-1];for(S=0;S<h.length;S+=1)Ni(h[S],G,n);for(S=0;S<m.length;S+=1)f.delete(m[S]);Ta(t,j.prev,L.next),Ta(t,v,j),Ta(t,L,G),u=G,v=L,N-=1,h=[],m=[]}else f.delete(T),Ni(T,u,n),Ta(t,T.prev,T.next),Ta(t,T,v===null?t.effect.first:v.next),Ta(t,v,T),v=T;continue}for(h=[],m=[];u!==null&&u!==T;)(f??(f=new Set)).add(u),m.push(u),u=ki(u.next);if(u===null)continue}(T.f&va)===0&&h.push(T),v=T,u=ki(T.next)}if(t.outrogroups!==null){for(const Z of t.outrogroups)Z.pending.size===0&&(bu(zl(Z.done)),(P=t.outrogroups)==null||P.delete(Z));t.outrogroups.size===0&&(t.outrogroups=null)}if(u!==null||f!==void 0){var D=[];if(f!==void 0)for(T of f)(T.f&cr)===0&&D.push(T);for(;u!==null;)(u.f&cr)===0&&u!==t.fallback&&D.push(u),u=ki(u.next);var J=D.length;if(J>0){var ae=(r&lh)!==0&&i===0?n:null;if(s){for(N=0;N<J;N+=1)(I=(O=D[N].nodes)==null?void 0:O.a)==null||I.measure();for(N=0;N<J;N+=1)(W=(Q=D[N].nodes)==null?void 0:Q.a)==null||W.fix()}rb(t,D,ae)}}s&&Xr(()=>{var Z,B;if(p!==void 0)for(T of p)(B=(Z=T.nodes)==null?void 0:Z.a)==null||B.apply()})}function sb(t,e,n,r,a,s,i,o){var u=(i&Zm)!==0?(i&$m)===0?Oy(n,!1,!1):hs(n):null,f=(i&Qm)!==0?hs(a):null;return{v:u,i:f,e:$n(()=>(s(e,u??n,f??a,o),()=>{t.delete(r)}))}}function Ni(t,e,n){if(t.nodes)for(var r=t.nodes.start,a=t.nodes.end,s=e&&(e.f&va)===0?e.nodes.start:n;r!==null;){var i=fo(r);if(s.before(r),r===a)return;r=i}}function Ta(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function ib(t,e,n=!1,r=!1,a=!1){var s=t,i="";se(()=>{var o=Kt;if(i!==(i=e()??"")&&(o.nodes!==null&&(Hh(o.nodes.start,o.nodes.end),o.nodes=null),i!=="")){var u=n?iy:r?oy:void 0,f=Dh(n?"svg":r?"math":"template",u);f.innerHTML=i;var v=n||r?f:f.content;if(ps(gr(v),v.lastChild),n||r)for(;gr(v);)s.before(gr(v));else s.before(v)}})}function br(t,e,...n){var r=new ld(t);vo(()=>{const a=e()??null;r.ensure(a,a&&(s=>a(s,...n)))},za)}function cd(t,e,n){var r=new ld(t);vo(()=>{var a=e()??null;r.ensure(a,a&&(s=>n(s,a)))},za)}function Xn(t,e,n){ci(()=>{var r=er(()=>e(t,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var a=!1,s={};Kl(()=>{var i=n();np(i),a&&fh(s,i)&&(s=i,r.update(i))}),a=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function ob(t,e){var n=void 0,r;Fh(()=>{n!==(n=e())&&(r&&(An(r),r=null),n&&(r=$n(()=>{ci(()=>n(t))})))})}function sp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=sp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function lb(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=sp(t))&&(r&&(r+=" "),r+=e);return r}function Ss(t){return typeof t=="object"?lb(t):t??""}const Of=[...` 	
\r\fÂ \v\uFEFF`];function cb(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var a of Object.keys(n))if(n[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,i=0;(i=r.indexOf(a,i))>=0;){var o=i+s;(i===0||Of.includes(r[i-1]))&&(o===r.length||Of.includes(r[o]))?r=(i===0?"":r.substring(0,i))+r.substring(o+1):i=o}}return r===""?null:r}function Nf(t,e=!1){var n=e?" !important;":";",r="";for(var a of Object.keys(t)){var s=t[a];s!=null&&s!==""&&(r+=" "+a+": "+s+n)}return r}function Oc(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function ub(t,e){if(e){var n="",r,a;if(Array.isArray(e)?(r=e[0],a=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,i=0,o=!1,u=[];r&&u.push(...Object.keys(r).map(Oc)),a&&u.push(...Object.keys(a).map(Oc));var f=0,v=-1;const k=t.length;for(var p=0;p<k;p++){var h=t[p];if(o?h==="/"&&t[p-1]==="*"&&(o=!1):s?s===h&&(s=!1):h==="/"&&t[p+1]==="*"?o=!0:h==='"'||h==="'"?s=h:h==="("?i++:h===")"&&i--,!o&&s===!1&&i===0){if(h===":"&&v===-1)v=p;else if(h===";"||p===k-1){if(v!==-1){var m=Oc(t.substring(f,v).trim());if(!u.includes(m)){h!==";"&&p++;var x=t.substring(f,p).trim();n+=" "+x+";"}}f=p+1,v=-1}}}}return r&&(n+=Nf(r)),a&&(n+=Nf(a,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Pt(t,e,n,r,a,s){var i=t.__className;if(i!==n||i===void 0){var o=cb(n,r,s);o==null?t.removeAttribute("class"):e?t.className=o:t.setAttribute("class",o),t.__className=n}else if(s&&a!==s)for(var u in s){var f=!!s[u];(a==null||f!==!!a[u])&&t.classList.toggle(u,f)}return s}function Nc(t,e={},n,r){for(var a in n){var s=n[a];e[a]!==s&&(n[a]==null?t.style.removeProperty(a):t.style.setProperty(a,s,r))}}function jt(t,e,n,r){var a=t.__style;if(a!==e){var s=ub(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Nc(t,n==null?void 0:n[0],r[0]),Nc(t,n==null?void 0:n[1],r[1],"important")):Nc(t,n,r));return r}function vl(t,e,n=!1){if(t.multiple){if(e==null)return;if(!jl(e))return cy();for(var r of t.options)r.selected=e.includes(Bi(r));return}for(r of t.options){var a=Bi(r);if(Ry(a,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ip(t){var e=new MutationObserver(()=>{vl(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ad(()=>{e.disconnect()})}function po(t,e,n=e){var r=new WeakSet,a=!0;Lh(t,"change",s=>{var i=s?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(i),Bi);else{var u=t.querySelector(i)??t.querySelector("option:not([disabled])");o=u&&Bi(u)}n(o),Et!==null&&r.add(Et)}),ci(()=>{var s=e();if(t===document.activeElement){var i=dl??Et;if(r.has(i))return}if(vl(t,s,a),a&&s===void 0){var o=t.querySelector(":checked");o!==null&&(s=Bi(o),n(s))}t.__value=s,a=!1}),ip(t)}function Bi(t){return"__value"in t?t.__value:t.value}const Ia=Symbol("class"),da=Symbol("style"),op=Symbol("is custom element"),lp=Symbol("is html"),db=oh?"option":"OPTION",fb=oh?"select":"SELECT";function vb(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function wt(t,e,n,r){var a=cp(t);a[e]!==(a[e]=n)&&(e==="loading"&&(t[zm]=n),n==null?t.removeAttribute(e):typeof n!="string"&&up(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function hb(t,e,n,r,a=!1,s=!1){var i=cp(t),o=i[op],u=!i[lp],f=e||{},v=t.nodeName===db;for(var p in e)p in n||(n[p]=null);n.class?n.class=Ss(n.class):(r||n[Ia])&&(n.class=null),n[da]&&(n.style??(n.style=null));var h=up(t);for(const G in n){let S=n[G];if(v&&G==="value"&&S==null){t.value=t.__value="",f[G]=S;continue}if(G==="class"){var m=t.namespaceURI==="http://www.w3.org/1999/xhtml";Pt(t,m,S,r,e==null?void 0:e[Ia],n[Ia]),f[G]=S,f[Ia]=n[Ia];continue}if(G==="style"){jt(t,S,e==null?void 0:e[da],n[da]),f[G]=S,f[da]=n[da];continue}var x=f[G];if(!(S===x&&!(S===void 0&&t.hasAttribute(G)))){f[G]=S;var k=G[0]+G[1];if(k!=="$$")if(k==="on"){const j={},L="$$"+G;let D=G.slice(2);var T=Wy(D);if(Uy(D)&&(D=D.slice(0,-7),j.capture=!0),!T&&x){if(S!=null)continue;t.removeEventListener(D,f[L],j),f[L]=null}if(T)Ce(D,t,S),$t([D]);else if(S!=null){let J=function(ae){f[G].call(this,ae)};f[L]=od(D,t,J,j)}}else if(G==="style")wt(t,G,S);else if(G==="autofocus")jy(t,!!S);else if(!o&&(G==="__value"||G==="value"&&S!=null))t.value=t.__value=S;else if(G==="selected"&&v)vb(t,S);else{var N=G;u||(N=Xy(N));var z=N==="defaultValue"||N==="defaultChecked";if(S==null&&!o&&!z)if(i[G]=null,N==="value"||N==="checked"){let j=t;const L=e===void 0;if(N==="value"){let D=j.defaultValue;j.removeAttribute(N),j.defaultValue=D,j.value=j.__value=L?D:null}else{let D=j.defaultChecked;j.removeAttribute(N),j.defaultChecked=D,j.checked=L?D:!1}}else t.removeAttribute(G);else z||h.includes(N)&&(o||typeof S!="string")?(t[N]=S,N in i&&(i[N]=Sn)):typeof S!="function"&&wt(t,N,S)}}}return f}function Ha(t,e,n=[],r=[],a=[],s,i=!1,o=!1){Ah(a,n,r,u=>{var f=void 0,v={},p=t.nodeName===fb,h=!1;if(Fh(()=>{var x=e(...u.map(l)),k=hb(t,f,x,s,i,o);h&&p&&"value"in x&&vl(t,x.value);for(let N of Object.getOwnPropertySymbols(v))x[N]||An(v[N]);for(let N of Object.getOwnPropertySymbols(x)){var T=x[N];N.description===ly&&(!f||T!==f[N])&&(v[N]&&An(v[N]),v[N]=$n(()=>ob(t,()=>T))),k[N]=T}f=k}),p){var m=t;ci(()=>{vl(m,f.value,!0),ip(m)})}h=!0})}function cp(t){return t.__attributes??(t.__attributes={[op]:t.nodeName.includes("-"),[lp]:t.namespaceURI===uh})}var Rf=new Map;function up(t){var e=t.getAttribute("is")||t.nodeName,n=Rf.get(e);if(n)return n;Rf.set(e,n=[]);for(var r,a=t,s=Element.prototype;s!==a;){r=th(a);for(var i in r)r[i].set&&n.push(i);a=Bl(a)}return n}function ha(t,e,n=e){var r=new WeakSet;Lh(t,"input",async a=>{var s=a?t.defaultValue:t.value;if(s=Rc(t)?Dc(s):s,n(s),Et!==null&&r.add(Et),await $h(),s!==(s=e())){var i=t.selectionStart,o=t.selectionEnd,u=t.value.length;if(t.value=s??"",o!==null){var f=t.value.length;i===o&&o===u&&f>u?(t.selectionStart=f,t.selectionEnd=f):(t.selectionStart=i,t.selectionEnd=Math.min(o,f))}}}),er(e)==null&&t.value&&(n(Rc(t)?Dc(t.value):t.value),Et!==null&&r.add(Et)),Kl(()=>{var a=e();if(t===document.activeElement){var s=dl??Et;if(r.has(s))return}Rc(t)&&a===Dc(t.value)||t.type==="date"&&!a&&!t.value||a!==t.value&&(t.value=a??"")})}function Rc(t){var e=t.type;return e==="number"||e==="range"}function Dc(t){return t===""?null:+t}var Oa,Qs,ro,Dl,dp;const Ll=class Ll{constructor(e){Me(this,Dl);Me(this,Oa,new WeakMap);Me(this,Qs);Me(this,ro);St(this,ro,e)}observe(e,n){var r=F(this,Oa).get(e)||new Set;return r.add(n),F(this,Oa).set(e,r),wn(this,Dl,dp).call(this).observe(e,F(this,ro)),()=>{var a=F(this,Oa).get(e);a.delete(n),a.size===0&&(F(this,Oa).delete(e),F(this,Qs).unobserve(e))}}};Oa=new WeakMap,Qs=new WeakMap,ro=new WeakMap,Dl=new WeakSet,dp=function(){return F(this,Qs)??St(this,Qs,new ResizeObserver(e=>{for(var n of e){Ll.entries.set(n.target,n);for(var r of F(this,Oa).get(n.target)||[])r(n)}}))},pt(Ll,"entries",new WeakMap);let _u=Ll;var pb=new _u({box:"border-box"});function Df(t,e,n){var r=pb.observe(t,()=>n(t[e]));ci(()=>(er(()=>n(t[e])),r))}function Lf(t,e){return t===e||(t==null?void 0:t[Yr])===e}function Es(t={},e,n,r){return ci(()=>{var a,s;return Kl(()=>{a=s,s=[],er(()=>{t!==n(...s)&&(e(t,...s),a&&Lf(n(...a),t)&&e(null,...a))})}),()=>{Xr(()=>{s&&Lf(n(...s),t)&&e(null,...s)})}}),t}function gb(t=!1){const e=rn,n=e.l.u;if(!n)return;let r=()=>np(e.s);if(t){let a=0,s={};const i=uo(()=>{let o=!1;const u=e.s;for(const f in u)u[f]!==s[f]&&(s[f]=u[f],o=!0);return o&&a++,a});r=()=>l(i)}n.b.length&&Bh(()=>{jf(e,r),au(n.b)}),Nn(()=>{const a=er(()=>n.m.map(Lm));return()=>{for(const s of a)typeof s=="function"&&s()}}),n.a.length&&Nn(()=>{jf(e,r),au(n.a)})}function jf(t,e){if(t.l.s)for(const n of t.l.s)l(n);e()}let qo=!1;function mb(t){var e=qo;try{return qo=!1,[t(),qo]}finally{qo=e}}const yb={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function As(t,e,n){return new Proxy({props:t,exclude:e},yb)}const bb={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(xi(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let a=t.props[r];xi(a)&&(a=a());const s=Ra(a,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(xi(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const a=Ra(r,e);return a&&!a.configurable&&(a.configurable=!0),a}}},has(t,e){if(e===Yr||e===ih)return!1;for(let n of t.props)if(xi(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(xi(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function zs(...t){return new Proxy({props:t},bb)}function Ae(t,e,n,r){var G;var a=!li||(n&ty)!==0,s=(n&ry)!==0,i=(n&ay)!==0,o=r,u=!0,f=()=>(u&&(u=!1,o=i?er(r):r),o),v;if(s){var p=Yr in t||ih in t;v=((G=Ra(t,e))==null?void 0:G.set)??(p&&e in t?S=>t[e]=S:void 0)}var h,m=!1;s?[h,m]=mb(()=>t[e]):h=t[e],h===void 0&&r!==void 0&&(h=f(),v&&(a&&Um(),v(h)));var x;if(a?x=()=>{var S=t[e];return S===void 0?f():(u=!0,S)}:x=()=>{var S=t[e];return S!==void 0&&(o=void 0),S===void 0?o:S},a&&(n&ny)===0)return x;if(v){var k=t.$$legacy;return(function(S,j){return arguments.length>0?((!a||!j||k||m)&&v(j?x():S),S):x()})}var T=!1,N=((n&ey)!==0?uo:td)(()=>(T=!1,x()));s&&l(N);var z=Kt;return(function(S,j){if(arguments.length>0){const L=j?l(N):a&&s?tn(S):S;return M(N,L),T=!0,o!==void 0&&(o=L),S}return Ba&&T||(z.f&ma)!==0?N.v:l(N)})}function Tn(t){rn===null&&Qu(),li&&rn.l!==null?_b(rn).m.push(t):Nn(()=>{const e=er(t);if(typeof e=="function")return e})}function ud(t){rn===null&&Qu(),Tn(()=>()=>er(t))}function _b(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const wb="5";var eh;typeof window<"u"&&((eh=window.__svelte??(window.__svelte={})).v??(eh.v=new Set)).add(wb);var xb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rl={exports:{}},Sb=rl.exports,zf;function Eb(){return zf||(zf=1,(function(t,e){((n,r)=>{t.exports=r()})(Sb,function(){var n=function(c,d){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(g,y){g.__proto__=y}:function(g,y){for(var _ in y)Object.prototype.hasOwnProperty.call(y,_)&&(g[_]=y[_])}))(c,d)},r=function(){return(r=Object.assign||function(c){for(var d,g=1,y=arguments.length;g<y;g++)for(var _ in d=arguments[g])Object.prototype.hasOwnProperty.call(d,_)&&(c[_]=d[_]);return c}).apply(this,arguments)};function a(c,d,g){for(var y,_=0,E=d.length;_<E;_++)!y&&_ in d||((y=y||Array.prototype.slice.call(d,0,_))[_]=d[_]);return c.concat(y||Array.prototype.slice.call(d))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:xb,i=Object.keys,o=Array.isArray;function u(c,d){return typeof d=="object"&&i(d).forEach(function(g){c[g]=d[g]}),c}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var f=Object.getPrototypeOf,v={}.hasOwnProperty;function p(c,d){return v.call(c,d)}function h(c,d){typeof d=="function"&&(d=d(f(c))),(typeof Reflect>"u"?i:Reflect.ownKeys)(d).forEach(function(g){x(c,g,d[g])})}var m=Object.defineProperty;function x(c,d,g,y){m(c,d,u(g&&p(g,"get")&&typeof g.get=="function"?{get:g.get,set:g.set,configurable:!0}:{value:g,configurable:!0,writable:!0},y))}function k(c){return{from:function(d){return c.prototype=Object.create(d.prototype),x(c.prototype,"constructor",c),{extend:h.bind(null,c.prototype)}}}}var T=Object.getOwnPropertyDescriptor,N=[].slice;function z(c,d,g){return N.call(c,d,g)}function G(c,d){return d(c)}function S(c){if(!c)throw new Error("Assertion Failed")}function j(c){s.setImmediate?setImmediate(c):setTimeout(c,0)}function L(c,d){if(typeof d=="string"&&p(c,d))return c[d];if(!d)return c;if(typeof d!="string"){for(var g=[],y=0,_=d.length;y<_;++y){var E=L(c,d[y]);g.push(E)}return g}var R,V=d.indexOf(".");return V===-1||(R=c[d.substr(0,V)])==null?void 0:L(R,d.substr(V+1))}function D(c,d,g){if(c&&d!==void 0&&!("isFrozen"in Object&&Object.isFrozen(c)))if(typeof d!="string"&&"length"in d){S(typeof g!="string"&&"length"in g);for(var y=0,_=d.length;y<_;++y)D(c,d[y],g[y])}else{var E,R,V=d.indexOf(".");V!==-1?(E=d.substr(0,V),(V=d.substr(V+1))===""?g===void 0?o(c)&&!isNaN(parseInt(E))?c.splice(E,1):delete c[E]:c[E]=g:D(R=(R=c[E])&&p(c,E)?R:c[E]={},V,g)):g===void 0?o(c)&&!isNaN(parseInt(d))?c.splice(d,1):delete c[d]:c[d]=g}}function J(c){var d,g={};for(d in c)p(c,d)&&(g[d]=c[d]);return g}var ae=[].concat;function ke(c){return ae.apply([],c)}var ne="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(c){return["Int","Uint","Float"].map(function(d){return d+c+"Array"})}))).filter(function(c){return s[c]}),X=new Set(ne.map(function(c){return s[c]})),A=null;function K(c){return A=new WeakMap,c=(function d(g){if(!g||typeof g!="object")return g;var y=A.get(g);if(y)return y;if(o(g)){y=[],A.set(g,y);for(var _=0,E=g.length;_<E;++_)y.push(d(g[_]))}else if(X.has(g.constructor))y=g;else{var R,V=f(g);for(R in y=V===Object.prototype?{}:Object.create(V),A.set(g,y),g)p(g,R)&&(y[R]=d(g[R]))}return y})(c),A=null,c}var P={}.toString;function O(c){return P.call(c).slice(8,-1)}var I=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Q=typeof I=="symbol"?function(c){var d;return c!=null&&(d=c[I])&&d.apply(c)}:function(){return null};function W(c,d){d=c.indexOf(d),0<=d&&c.splice(d,1)}var Z={};function B(c){var d,g,y,_;if(arguments.length===1){if(o(c))return c.slice();if(this===Z&&typeof c=="string")return[c];if(_=Q(c))for(g=[];!(y=_.next()).done;)g.push(y.value);else{if(c==null)return[c];if(typeof(d=c.length)!="number")return[c];for(g=new Array(d);d--;)g[d]=c[d]}}else for(d=arguments.length,g=new Array(d);d--;)g[d]=arguments[d];return g}var ee=typeof Symbol<"u"?function(c){return c[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ne=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],rt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ne),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function U(c,d){this.name=c,this.message=d}function le(c,d){return c+". Errors: "+Object.keys(d).map(function(g){return d[g].toString()}).filter(function(g,y,_){return _.indexOf(g)===y}).join(`
`)}function Y(c,d,g,y){this.failures=d,this.failedKeys=y,this.successCount=g,this.message=le(c,d)}function ue(c,d){this.name="BulkError",this.failures=Object.keys(d).map(function(g){return d[g]}),this.failuresByPos=d,this.message=le(c,this.failures)}k(U).from(Error).extend({toString:function(){return this.name+": "+this.message}}),k(Y).from(U),k(ue).from(U);var be=rt.reduce(function(c,d){return c[d]=d+"Error",c},{}),ge=U,re=rt.reduce(function(c,d){var g=d+"Error";function y(_,E){this.name=g,_?typeof _=="string"?(this.message="".concat(_).concat(E?`
 `+E:""),this.inner=E||null):typeof _=="object"&&(this.message="".concat(_.name," ").concat(_.message),this.inner=_):(this.message=H[d]||g,this.inner=null)}return k(y).from(ge),c[d]=y,c},{}),Te=(re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError,ne.reduce(function(c,d){return c[d+"Error"]=re[d],c},{}));ne=rt.reduce(function(c,d){return["Syntax","Type","Range"].indexOf(d)===-1&&(c[d+"Error"]=re[d]),c},{});function _e(){}function Pe(c){return c}function He(c,d){return c==null||c===Pe?d:function(g){return d(c(g))}}function Ze(c,d){return function(){c.apply(this,arguments),d.apply(this,arguments)}}function vt(c,d){return c===_e?d:function(){var g=c.apply(this,arguments),y=(g!==void 0&&(arguments[0]=g),this.onsuccess),_=this.onerror,E=(this.onsuccess=null,this.onerror=null,d.apply(this,arguments));return y&&(this.onsuccess=this.onsuccess?Ze(y,this.onsuccess):y),_&&(this.onerror=this.onerror?Ze(_,this.onerror):_),E!==void 0?E:g}}function ht(c,d){return c===_e?d:function(){c.apply(this,arguments);var g=this.onsuccess,y=this.onerror;this.onsuccess=this.onerror=null,d.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?Ze(g,this.onsuccess):g),y&&(this.onerror=this.onerror?Ze(y,this.onerror):y)}}function je(c,d){return c===_e?d:function(_){var y=c.apply(this,arguments),_=(u(_,y),this.onsuccess),E=this.onerror,R=(this.onsuccess=null,this.onerror=null,d.apply(this,arguments));return _&&(this.onsuccess=this.onsuccess?Ze(_,this.onsuccess):_),E&&(this.onerror=this.onerror?Ze(E,this.onerror):E),y===void 0?R===void 0?void 0:R:u(y,R)}}function De(c,d){return c===_e?d:function(){return d.apply(this,arguments)!==!1&&c.apply(this,arguments)}}function Fe(c,d){return c===_e?d:function(){var g=c.apply(this,arguments);if(g&&typeof g.then=="function"){for(var y=this,_=arguments.length,E=new Array(_);_--;)E[_]=arguments[_];return g.then(function(){return d.apply(y,E)})}return d.apply(this,arguments)}}ne.ModifyError=Y,ne.DexieError=U,ne.BulkError=ue;var Ne=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Je(c){Ne=c}var ut={},$e=100,it=typeof Promise>"u"?[]:(rt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[it=crypto.subtle.digest("SHA-512",new Uint8Array([0])),f(it),rt]:[rt,f(rt),rt]),rt=it[0],Rs=it[1],Rs=Rs&&Rs.then,We=rt&&rt.constructor,mt=!!it[2],dt=function(c,d){Ot.push([c,d]),Ft&&(queueMicrotask(Rn),Ft=!1)},Rt=!0,Ft=!0,xt=[],yt=[],bt=Pe,lt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:_e,pgp:!1,env:{},finalize:_e},ze=lt,Ot=[],Dt=0,zt=[];function Re(c){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var d=this._PSD=ze;if(typeof c!="function"){if(c!==ut)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ye(this,this._value)}else this._state=null,this._value=null,++d.ref,(function g(y,_){try{_(function(E){if(y._state===null){if(E===y)throw new TypeError("A promise cannot be resolved with itself.");var R=y._lib&&Xt();E&&typeof E.then=="function"?g(y,function(V,de){E instanceof Re?E._then(V,de):E.then(V,de)}):(y._state=!0,y._value=E,un(y)),R&&ft()}},ye.bind(null,y))}catch(E){ye(y,E)}})(this,c)}var Yt={get:function(){var c=ze,d=Zt;function g(y,_){var E=this,R=!c.global&&(c!==ze||d!==Zt),V=R&&!rr(),de=new Re(function(xe,fe){Cn(E,new zn(oe(y,c,R,V),oe(_,c,R,V),xe,fe,c))});return this._consoleTask&&(de._consoleTask=this._consoleTask),de}return g.prototype=ut,g},set:function(c){x(this,"then",c&&c.prototype===ut?Yt:{get:function(){return c},set:Yt.set})}};function zn(c,d,g,y,_){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof d=="function"?d:null,this.resolve=g,this.reject=y,this.psd=_}function ye(c,d){var g,y;yt.push(d),c._state===null&&(g=c._lib&&Xt(),d=bt(d),c._state=!1,c._value=d,y=c,xt.some(function(_){return _._value===y._value})||xt.push(y),un(c),g)&&ft()}function un(c){var d=c._listeners;c._listeners=[];for(var g=0,y=d.length;g<y;++g)Cn(c,d[g]);var _=c._PSD;--_.ref||_.finalize(),Dt===0&&(++Dt,dt(function(){--Dt==0&&ot()},[]))}function Cn(c,d){if(c._state===null)c._listeners.push(d);else{var g=c._state?d.onFulfilled:d.onRejected;if(g===null)return(c._state?d.resolve:d.reject)(c._value);++d.psd.ref,++Dt,dt(At,[g,c,d])}}function At(c,d,g){try{var y,_=d._value;!d._state&&yt.length&&(yt=[]),y=Ne&&d._consoleTask?d._consoleTask.run(function(){return c(_)}):c(_),d._state||yt.indexOf(_)!==-1||(E=>{for(var R=xt.length;R;)if(xt[--R]._value===E._value)return xt.splice(R,1)})(d),g.resolve(y)}catch(E){g.reject(E)}finally{--Dt==0&&ot(),--g.psd.ref||g.psd.finalize()}}function Rn(){at(lt,function(){Xt()&&ft()})}function Xt(){var c=Rt;return Ft=Rt=!1,c}function ft(){var c,d,g;do for(;0<Ot.length;)for(c=Ot,Ot=[],g=c.length,d=0;d<g;++d){var y=c[d];y[0].apply(null,y[1])}while(0<Ot.length);Ft=Rt=!0}function ot(){for(var c=xt,d=(xt=[],c.forEach(function(y){y._PSD.onunhandled.call(null,y._value,y)}),zt.slice(0)),g=d.length;g;)d[--g]()}function Ht(c){return new Re(ut,!1,c)}function ct(c,d){var g=ze;return function(){var y=Xt(),_=ze;try{return Vn(g,!0),c.apply(this,arguments)}catch(E){d&&d(E)}finally{Vn(_,!1),y&&ft()}}}h(Re.prototype,{then:Yt,_then:function(c,d){Cn(this,new zn(null,null,c,d,ze))},catch:function(c){var d,g;return arguments.length===1?this.then(null,c):(d=c,g=arguments[1],typeof d=="function"?this.then(null,function(y){return(y instanceof d?g:Ht)(y)}):this.then(null,function(y){return(y&&y.name===d?g:Ht)(y)}))},finally:function(c){return this.then(function(d){return Re.resolve(c()).then(function(){return d})},function(d){return Re.resolve(c()).then(function(){return Ht(d)})})},timeout:function(c,d){var g=this;return c<1/0?new Re(function(y,_){var E=setTimeout(function(){return _(new re.Timeout(d))},c);g.then(y,_).finally(clearTimeout.bind(null,E))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&x(Re.prototype,Symbol.toStringTag,"Dexie.Promise"),lt.env=Ps(),h(Re,{all:function(){var c=B.apply(null,arguments).map(ra);return new Re(function(d,g){c.length===0&&d([]);var y=c.length;c.forEach(function(_,E){return Re.resolve(_).then(function(R){c[E]=R,--y||d(c)},g)})})},resolve:function(c){return c instanceof Re?c:c&&typeof c.then=="function"?new Re(function(d,g){c.then(d,g)}):new Re(ut,!0,c)},reject:Ht,race:function(){var c=B.apply(null,arguments).map(ra);return new Re(function(d,g){c.map(function(y){return Re.resolve(y).then(d,g)})})},PSD:{get:function(){return ze},set:function(c){return ze=c}},totalEchoes:{get:function(){return Zt}},newPSD:_n,usePSD:at,scheduler:{get:function(){return dt},set:function(c){dt=c}},rejectionMapper:{get:function(){return bt},set:function(c){bt=c}},follow:function(c,d){return new Re(function(g,y){return _n(function(_,E){var R=ze;R.unhandleds=[],R.onunhandled=E,R.finalize=Ze(function(){var V,de=this;V=function(){de.unhandleds.length===0?_():E(de.unhandleds[0])},zt.push(function xe(){V(),zt.splice(zt.indexOf(xe),1)}),++Dt,dt(function(){--Dt==0&&ot()},[])},R.finalize),c()},d,g,y)})}}),We&&(We.allSettled&&x(Re,"allSettled",function(){var c=B.apply(null,arguments).map(ra);return new Re(function(d){c.length===0&&d([]);var g=c.length,y=new Array(g);c.forEach(function(_,E){return Re.resolve(_).then(function(R){return y[E]={status:"fulfilled",value:R}},function(R){return y[E]={status:"rejected",reason:R}}).then(function(){return--g||d(y)})})})}),We.any&&typeof AggregateError<"u"&&x(Re,"any",function(){var c=B.apply(null,arguments).map(ra);return new Re(function(d,g){c.length===0&&g(new AggregateError([]));var y=c.length,_=new Array(y);c.forEach(function(E,R){return Re.resolve(E).then(function(V){return d(V)},function(V){_[R]=V,--y||g(new AggregateError(_))})})})}),We.withResolvers)&&(Re.withResolvers=We.withResolvers);var kt={awaits:0,echoes:0,id:0},nn=0,an=[],Dn=0,Zt=0,en=0;function _n(c,R,g,y){var _=ze,E=Object.create(_),R=(E.parent=_,E.ref=0,E.global=!1,E.id=++en,lt.env,E.env=mt?{Promise:Re,PromiseProp:{value:Re,configurable:!0,writable:!0},all:Re.all,race:Re.race,allSettled:Re.allSettled,any:Re.any,resolve:Re.resolve,reject:Re.reject}:{},R&&u(E,R),++_.ref,E.finalize=function(){--this.parent.ref||this.parent.finalize()},at(E,c,g,y));return E.ref===0&&E.finalize(),R}function hn(){return kt.id||(kt.id=++nn),++kt.awaits,kt.echoes+=$e,kt.id}function rr(){return!!kt.awaits&&(--kt.awaits==0&&(kt.id=0),kt.echoes=kt.awaits*$e,!0)}function ra(c){return kt.echoes&&c&&c.constructor===We?(hn(),c.then(function(d){return rr(),d},function(d){return rr(),Ve(d)})):c}function ka(){var c=an[an.length-1];an.pop(),Vn(c,!1)}function Vn(c,d){var g,y,_=ze;(d?!kt.echoes||Dn++&&c===ze:!Dn||--Dn&&c===ze)||queueMicrotask(d?(function(E){++Zt,kt.echoes&&--kt.echoes!=0||(kt.echoes=kt.awaits=kt.id=0),an.push(ze),Vn(E,!0)}).bind(null,c):ka),c!==ze&&(ze=c,_===lt&&(lt.env=Ps()),mt)&&(g=lt.env.Promise,y=c.env,_.global||c.global)&&(Object.defineProperty(s,"Promise",y.PromiseProp),g.all=y.all,g.race=y.race,g.resolve=y.resolve,g.reject=y.reject,y.allSettled&&(g.allSettled=y.allSettled),y.any)&&(g.any=y.any)}function Ps(){var c=s.Promise;return mt?{Promise:c,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:c.all,race:c.race,allSettled:c.allSettled,any:c.any,resolve:c.resolve,reject:c.reject}:{}}function at(c,d,g,y,_){var E=ze;try{return Vn(c,!0),d(g,y,_)}finally{Vn(E,!1)}}function oe(c,d,g,y){return typeof c!="function"?c:function(){var _=ze;g&&hn(),Vn(d,!0);try{return c.apply(this,arguments)}finally{Vn(_,!1),y&&queueMicrotask(rr)}}}function qe(c){Promise===We&&kt.echoes===0?Dn===0?c():enqueueNativeMicroTask(c):setTimeout(c,0)}(""+Rs).indexOf("[native code]")===-1&&(hn=rr=_e);var Ve=Re.reject,Vt="ï¿¿",sn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",dn="String expected.",pn=[],Un="__dbnames",Br="readonly",Va="readwrite";function ln(c,d){return c?d?function(){return c.apply(this,arguments)&&d.apply(this,arguments)}:c:d}var fi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ua(c){return typeof c!="string"||/\./.test(c)?function(d){return d}:function(d){return d[c]===void 0&&c in d&&delete(d=K(d))[c],d}}function Yd(){throw re.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Lt(c,d){try{var g=Xd(c),y=Xd(d);if(g!==y)return g==="Array"?1:y==="Array"?-1:g==="binary"?1:y==="binary"?-1:g==="string"?1:y==="string"?-1:g==="Date"?1:y!=="Date"?NaN:-1;switch(g){case"number":case"Date":case"string":return d<c?1:c<d?-1:0;case"binary":for(var _=Zd(c),E=Zd(d),R=_.length,V=E.length,de=R<V?R:V,xe=0;xe<de;++xe)if(_[xe]!==E[xe])return _[xe]<E[xe]?-1:1;return R===V?0:R<V?-1:1;case"Array":for(var fe=c,ie=d,he=fe.length,me=ie.length,ve=he<me?he:me,ce=0;ce<ve;++ce){var Se=Lt(fe[ce],ie[ce]);if(Se!==0)return Se}return he===me?0:he<me?-1:1}}catch{}return NaN}function Xd(c){var d=typeof c;return d=="object"&&(ArrayBuffer.isView(c)||(d=O(c))==="ArrayBuffer")?"binary":d}function Zd(c){return c instanceof Uint8Array?c:ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c)}function ko(c,d,g){var y=c.schema.yProps;return y?(d&&0<g.numFailures&&(d=d.filter(function(_,E){return!g.failures[E]})),Promise.all(y.map(function(_){return _=_.updatesTable,d?c.db.table(_).where("k").anyOf(d).delete():c.db.table(_).clear()})).then(function(){return g})):g}Qd.prototype.execute=function(c){var d=this["@@propmod"];if(d.add!==void 0){var g=d.add;if(o(g))return a(a([],o(c)?c:[],!0),g).sort();if(typeof g=="number")return(Number(c)||0)+g;if(typeof g=="bigint")try{return BigInt(c)+g}catch{return BigInt(0)+g}throw new TypeError("Invalid term ".concat(g))}if(d.remove!==void 0){var y=d.remove;if(o(y))return o(c)?c.filter(function(_){return!y.includes(_)}).sort():[];if(typeof y=="number")return Number(c)-y;if(typeof y=="bigint")try{return BigInt(c)-y}catch{return BigInt(0)-y}throw new TypeError("Invalid subtrahend ".concat(y))}return g=(g=d.replacePrefix)==null?void 0:g[0],g&&typeof c=="string"&&c.startsWith(g)?d.replacePrefix[1]+c.substring(g.length):c};var vi=Qd;function Qd(c){this["@@propmod"]=c}function Jd(c,d){for(var g=i(d),y=g.length,_=!1,E=0;E<y;++E){var R=g[E],V=d[R],de=L(c,R);V instanceof vi?(D(c,R,V.execute(de)),_=!0):de!==V&&(D(c,R,V),_=!0)}return _}on.prototype._trans=function(c,d,g){var y=this._tx||ze.trans,_=this.name,E=Ne&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(c==="readonly"?"read":"write"," ").concat(this.name));function R(xe,fe,ie){if(ie.schema[_])return d(ie.idbtrans,ie);throw new re.NotFound("Table "+_+" not part of transaction")}var V=Xt();try{var de=y&&y.db._novip===this.db._novip?y===ze.trans?y._promise(c,R,g):_n(function(){return y._promise(c,R,g)},{trans:y,transless:ze.transless||ze}):(function xe(fe,ie,he,me){if(fe.idbdb&&(fe._state.openComplete||ze.letThrough||fe._vip)){var ve=fe._createTransaction(ie,he,fe._dbSchema);try{ve.create(),fe._state.PR1398_maxLoop=3}catch(ce){return ce.name===be.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,ie,he,me)})):Ve(ce)}return ve._promise(ie,function(ce,Se){return _n(function(){return ze.trans=ve,me(ce,Se,ve)})}).then(function(ce){if(ie==="readwrite")try{ve.idbtrans.commit()}catch{}return ie==="readonly"?ce:ve._completion.then(function(){return ce})})}if(fe._state.openComplete)return Ve(new re.DatabaseClosed(fe._state.dbOpenError));if(!fe._state.isBeingOpened){if(!fe._state.autoOpen)return Ve(new re.DatabaseClosed);fe.open().catch(_e)}return fe._state.dbReadyPromise.then(function(){return xe(fe,ie,he,me)})})(this.db,c,[this.name],R);return E&&(de._consoleTask=E,de=de.catch(function(xe){return console.trace(xe),Ve(xe)})),de}finally{V&&ft()}},on.prototype.get=function(c,d){var g=this;return c&&c.constructor===Object?this.where(c).first(d):c==null?Ve(new re.Type("Invalid argument to Table.get()")):this._trans("readonly",function(y){return g.core.get({trans:y,key:c}).then(function(_){return g.hook.reading.fire(_)})}).then(d)},on.prototype.where=function(c){if(typeof c=="string")return new this.db.WhereClause(this,c);if(o(c))return new this.db.WhereClause(this,"[".concat(c.join("+"),"]"));var d=i(c);if(d.length===1)return this.where(d[0]).equals(c[d[0]]);var g=this.schema.indexes.concat(this.schema.primKey).filter(function(V){if(V.compound&&d.every(function(xe){return 0<=V.keyPath.indexOf(xe)})){for(var de=0;de<d.length;++de)if(d.indexOf(V.keyPath[de])===-1)return!1;return!0}return!1}).sort(function(V,de){return V.keyPath.length-de.keyPath.length})[0];if(g&&this.db._maxKey!==Vt)return R=g.keyPath.slice(0,d.length),this.where(R).equals(R.map(function(V){return c[V]}));!g&&Ne&&console.warn("The query ".concat(JSON.stringify(c)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(d.join("+"),"]"));var y=this.schema.idxByName;function _(V,de){return Lt(V,de)===0}var R=d.reduce(function(fe,de){var xe=fe[0],fe=fe[1],ie=y[de],he=c[de];return[xe||ie,xe||!ie?ln(fe,ie&&ie.multi?function(me){return me=L(me,de),o(me)&&me.some(function(ve){return _(he,ve)})}:function(me){return _(he,L(me,de))}):fe]},[null,null]),E=R[0],R=R[1];return E?this.where(E.name).equals(c[E.keyPath]).filter(R):g?this.filter(R):this.where(d).equals("")},on.prototype.filter=function(c){return this.toCollection().and(c)},on.prototype.count=function(c){return this.toCollection().count(c)},on.prototype.offset=function(c){return this.toCollection().offset(c)},on.prototype.limit=function(c){return this.toCollection().limit(c)},on.prototype.each=function(c){return this.toCollection().each(c)},on.prototype.toArray=function(c){return this.toCollection().toArray(c)},on.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},on.prototype.orderBy=function(c){return new this.db.Collection(new this.db.WhereClause(this,o(c)?"[".concat(c.join("+"),"]"):c))},on.prototype.reverse=function(){return this.toCollection().reverse()},on.prototype.mapToClass=function(c){for(var d=this.db,g=this.name,y=((this.schema.mappedClass=c).prototype instanceof Yd&&(c=(R=>{var V=fe,de=R;if(typeof de!="function"&&de!==null)throw new TypeError("Class extends value "+String(de)+" is not a constructor or null");function xe(){this.constructor=V}function fe(){return R!==null&&R.apply(this,arguments)||this}return n(V,de),V.prototype=de===null?Object.create(de):(xe.prototype=de.prototype,new xe),Object.defineProperty(fe.prototype,"db",{get:function(){return d},enumerable:!1,configurable:!0}),fe.prototype.table=function(){return g},fe})(c)),new Set),_=c.prototype;_;_=f(_))Object.getOwnPropertyNames(_).forEach(function(R){return y.add(R)});function E(R){if(!R)return R;var V,de=Object.create(c.prototype);for(V in R)if(!y.has(V))try{de[V]=R[V]}catch{}return de}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=E,this.hook("reading",E),c},on.prototype.defineClass=function(){return this.mapToClass(function(c){u(this,c)})},on.prototype.add=function(c,d){var g=this,y=this.schema.primKey,_=y.auto,E=y.keyPath,R=c;return E&&_&&(R=Ua(E)(c)),this._trans("readwrite",function(V){return g.core.mutate({trans:V,type:"add",keys:d!=null?[d]:null,values:[R]})}).then(function(V){return V.numFailures?Re.reject(V.failures[0]):V.lastResult}).then(function(V){if(E)try{D(c,E,V)}catch{}return V})},on.prototype.upsert=function(c,d){var g=this,y=this.schema.primKey.keyPath;return this._trans("readwrite",function(_){return g.core.get({trans:_,key:c}).then(function(E){var R=E??{};return Jd(R,d),y&&D(R,y,c),g.core.mutate({trans:_,type:"put",values:[R],keys:[c],upsert:!0,updates:{keys:[c],changeSpecs:[d]}}).then(function(V){return V.numFailures?Re.reject(V.failures[0]):!!E})})})},on.prototype.update=function(c,d){return typeof c!="object"||o(c)?this.where(":id").equals(c).modify(d):(c=L(c,this.schema.primKey.keyPath))===void 0?Ve(new re.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(d)},on.prototype.put=function(c,d){var g=this,y=this.schema.primKey,_=y.auto,E=y.keyPath,R=c;return E&&_&&(R=Ua(E)(c)),this._trans("readwrite",function(V){return g.core.mutate({trans:V,type:"put",values:[R],keys:d!=null?[d]:null})}).then(function(V){return V.numFailures?Re.reject(V.failures[0]):V.lastResult}).then(function(V){if(E)try{D(c,E,V)}catch{}return V})},on.prototype.delete=function(c){var d=this;return this._trans("readwrite",function(g){return d.core.mutate({trans:g,type:"delete",keys:[c]}).then(function(y){return ko(d,[c],y)}).then(function(y){return y.numFailures?Re.reject(y.failures[0]):void 0})})},on.prototype.clear=function(){var c=this;return this._trans("readwrite",function(d){return c.core.mutate({trans:d,type:"deleteRange",range:fi}).then(function(g){return ko(c,null,g)})}).then(function(d){return d.numFailures?Re.reject(d.failures[0]):void 0})},on.prototype.bulkGet=function(c){var d=this;return this._trans("readonly",function(g){return d.core.getMany({keys:c,trans:g}).then(function(y){return y.map(function(_){return d.hook.reading.fire(_)})})})},on.prototype.bulkAdd=function(c,d,g){var y=this,_=Array.isArray(d)?d:void 0,E=(g=g||(_?void 0:d))?g.allKeys:void 0;return this._trans("readwrite",function(R){var V=y.schema.primKey,xe=V.auto,V=V.keyPath;if(V&&_)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(_&&_.length!==c.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=V&&xe?c.map(Ua(V)):c;return y.core.mutate({trans:R,type:"add",keys:_,values:xe,wantResults:E}).then(function(fe){var ie=fe.numFailures,he=fe.failures;if(ie===0)return E?fe.results:fe.lastResult;throw new ue("".concat(y.name,".bulkAdd(): ").concat(ie," of ").concat(de," operations failed"),he)})})},on.prototype.bulkPut=function(c,d,g){var y=this,_=Array.isArray(d)?d:void 0,E=(g=g||(_?void 0:d))?g.allKeys:void 0;return this._trans("readwrite",function(R){var V=y.schema.primKey,xe=V.auto,V=V.keyPath;if(V&&_)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(_&&_.length!==c.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=V&&xe?c.map(Ua(V)):c;return y.core.mutate({trans:R,type:"put",keys:_,values:xe,wantResults:E}).then(function(fe){var ie=fe.numFailures,he=fe.failures;if(ie===0)return E?fe.results:fe.lastResult;throw new ue("".concat(y.name,".bulkPut(): ").concat(ie," of ").concat(de," operations failed"),he)})})},on.prototype.bulkUpdate=function(c){var d=this,g=this.core,y=c.map(function(R){return R.key}),_=c.map(function(R){return R.changes}),E=[];return this._trans("readwrite",function(R){return g.getMany({trans:R,keys:y,cache:"clone"}).then(function(V){var de=[],xe=[],fe=(c.forEach(function(ie,he){var me=ie.key,ve=ie.changes,ce=V[he];if(ce){for(var Se=0,Ee=Object.keys(ve);Se<Ee.length;Se++){var we=Ee[Se],Ie=ve[we];if(we===d.schema.primKey.keyPath){if(Lt(Ie,me)!==0)throw new re.Constraint("Cannot update primary key in bulkUpdate()")}else D(ce,we,Ie)}E.push(he),de.push(me),xe.push(ce)}}),de.length);return g.mutate({trans:R,type:"put",keys:de,values:xe,updates:{keys:y,changeSpecs:_}}).then(function(ie){var he=ie.numFailures,me=ie.failures;if(he===0)return fe;for(var ve=0,ce=Object.keys(me);ve<ce.length;ve++){var Se,Ee=ce[ve],we=E[Number(Ee)];we!=null&&(Se=me[Ee],delete me[Ee],me[we]=Se)}throw new ue("".concat(d.name,".bulkUpdate(): ").concat(he," of ").concat(fe," operations failed"),me)})})})},on.prototype.bulkDelete=function(c){var d=this,g=c.length;return this._trans("readwrite",function(y){return d.core.mutate({trans:y,type:"delete",keys:c}).then(function(_){return ko(d,c,_)})}).then(function(y){var _=y.numFailures,E=y.failures;if(_===0)return y.lastResult;throw new ue("".concat(d.name,".bulkDelete(): ").concat(_," of ").concat(g," operations failed"),E)})};var $d=on;function on(){}function hi(c){function d(R,V){if(V){for(var de=arguments.length,xe=new Array(de-1);--de;)xe[de-1]=arguments[de];return g[R].subscribe.apply(null,xe),c}if(typeof R=="string")return g[R]}var g={};d.addEventType=E;for(var y=1,_=arguments.length;y<_;++y)E(arguments[y]);return d;function E(R,V,de){var xe,fe;if(typeof R!="object")return V=V||De,fe={subscribers:[],fire:de=de||_e,subscribe:function(ie){fe.subscribers.indexOf(ie)===-1&&(fe.subscribers.push(ie),fe.fire=V(fe.fire,ie))},unsubscribe:function(ie){fe.subscribers=fe.subscribers.filter(function(he){return he!==ie}),fe.fire=fe.subscribers.reduce(V,de)}},g[R]=d[R]=fe;i(xe=R).forEach(function(ie){var he=xe[ie];if(o(he))E(ie,xe[ie][0],xe[ie][1]);else{if(he!=="asap")throw new re.InvalidArgument("Invalid event config");var me=E(ie,Pe,function(){for(var ve=arguments.length,ce=new Array(ve);ve--;)ce[ve]=arguments[ve];me.subscribers.forEach(function(Se){j(function(){Se.apply(null,ce)})})})}})}}function pi(c,d){return k(d).from({prototype:c}),d}function Ms(c,d){return!(c.filter||c.algorithm||c.or)&&(d?c.justLimit:!c.replayFilter)}function ic(c,d){c.filter=ln(c.filter,d)}function oc(c,d,g){var y=c.replayFilter;c.replayFilter=y?function(){return ln(y(),d())}:d,c.justLimit=g&&!y}function So(c,d){if(c.isPrimKey)return d.primaryKey;var g=d.getIndexByKeyPath(c.index);if(g)return g;throw new re.Schema("KeyPath "+c.index+" on object store "+d.name+" is not indexed")}function ef(c,d,g){var y=So(c,d.schema);return d.openCursor({trans:g,values:!c.keysOnly,reverse:c.dir==="prev",unique:!!c.unique,query:{index:y,range:c.range}})}function Eo(c,d,g,y){var _,E,R=c.replayFilter?ln(c.filter,c.replayFilter()):c.filter;return c.or?(_={},E=function(V,de,xe){var fe,ie;R&&!R(de,xe,function(he){return de.stop(he)},function(he){return de.fail(he)})||((ie=""+(fe=de.primaryKey))=="[object ArrayBuffer]"&&(ie=""+new Uint8Array(fe)),p(_,ie))||(_[ie]=!0,d(V,de,xe))},Promise.all([c.or._iterate(E,g),tf(ef(c,y,g),c.algorithm,E,!c.keysOnly&&c.valueMapper)])):tf(ef(c,y,g),ln(c.algorithm,R),d,!c.keysOnly&&c.valueMapper)}function tf(c,d,g,y){var _=ct(y?function(E,R,V){return g(y(E),R,V)}:g);return c.then(function(E){if(E)return E.start(function(){var R=function(){return E.continue()};d&&!d(E,function(V){return R=V},function(V){E.stop(V),R=_e},function(V){E.fail(V),R=_e})||_(E.value,E,function(V){return R=V}),R()})})}Ut.prototype._read=function(c,d){var g=this._ctx;return g.error?g.table._trans(null,Ve.bind(null,g.error)):g.table._trans("readonly",c).then(d)},Ut.prototype._write=function(c){var d=this._ctx;return d.error?d.table._trans(null,Ve.bind(null,d.error)):d.table._trans("readwrite",c,"locked")},Ut.prototype._addAlgorithm=function(c){var d=this._ctx;d.algorithm=ln(d.algorithm,c)},Ut.prototype._iterate=function(c,d){return Eo(this._ctx,c,d,this._ctx.table.core)},Ut.prototype.clone=function(c){var d=Object.create(this.constructor.prototype),g=Object.create(this._ctx);return c&&u(g,c),d._ctx=g,d},Ut.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ut.prototype.each=function(c){var d=this._ctx;return this._read(function(g){return Eo(d,c,g,d.table.core)})},Ut.prototype.count=function(c){var d=this;return this._read(function(g){var y,_=d._ctx,E=_.table.core;return Ms(_,!0)?E.count({trans:g,query:{index:So(_,E.schema),range:_.range}}).then(function(R){return Math.min(R,_.limit)}):(y=0,Eo(_,function(){return++y,!1},g,E).then(function(){return y}))}).then(c)},Ut.prototype.sortBy=function(c,d){var g=c.split(".").reverse(),y=g[0],_=g.length-1;function E(de,xe){return xe?E(de[g[xe]],xe-1):de[y]}var R=this._ctx.dir==="next"?1:-1;function V(de,xe){return Lt(E(de,_),E(xe,_))*R}return this.toArray(function(de){return de.sort(V)}).then(d)},Ut.prototype.toArray=function(c){var d=this;return this._read(function(g){var y,_,E,R=d._ctx;return R.dir==="next"&&Ms(R,!0)&&0<R.limit?(y=R.valueMapper,_=So(R,R.table.core.schema),R.table.core.query({trans:g,limit:R.limit,values:!0,query:{index:_,range:R.range}}).then(function(V){return V=V.result,y?V.map(y):V})):(E=[],Eo(R,function(V){return E.push(V)},g,R.table.core).then(function(){return E}))},c)},Ut.prototype.offset=function(c){var d=this._ctx;return c<=0||(d.offset+=c,Ms(d)?oc(d,function(){var g=c;return function(y,_){return g===0||(g===1?--g:_(function(){y.advance(g),g=0}),!1)}}):oc(d,function(){var g=c;return function(){return--g<0}})),this},Ut.prototype.limit=function(c){return this._ctx.limit=Math.min(this._ctx.limit,c),oc(this._ctx,function(){var d=c;return function(g,y,_){return--d<=0&&y(_),0<=d}},!0),this},Ut.prototype.until=function(c,d){return ic(this._ctx,function(g,y,_){return!c(g.value)||(y(_),d)}),this},Ut.prototype.first=function(c){return this.limit(1).toArray(function(d){return d[0]}).then(c)},Ut.prototype.last=function(c){return this.reverse().first(c)},Ut.prototype.filter=function(c){var d;return ic(this._ctx,function(g){return c(g.value)}),(d=this._ctx).isMatch=ln(d.isMatch,c),this},Ut.prototype.and=function(c){return this.filter(c)},Ut.prototype.or=function(c){return new this.db.WhereClause(this._ctx.table,c,this)},Ut.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ut.prototype.desc=function(){return this.reverse()},Ut.prototype.eachKey=function(c){var d=this._ctx;return d.keysOnly=!d.isMatch,this.each(function(g,y){c(y.key,y)})},Ut.prototype.eachUniqueKey=function(c){return this._ctx.unique="unique",this.eachKey(c)},Ut.prototype.eachPrimaryKey=function(c){var d=this._ctx;return d.keysOnly=!d.isMatch,this.each(function(g,y){c(y.primaryKey,y)})},Ut.prototype.keys=function(c){var d=this._ctx,g=(d.keysOnly=!d.isMatch,[]);return this.each(function(y,_){g.push(_.key)}).then(function(){return g}).then(c)},Ut.prototype.primaryKeys=function(c){var d=this._ctx;if(d.dir==="next"&&Ms(d,!0)&&0<d.limit)return this._read(function(y){var _=So(d,d.table.core.schema);return d.table.core.query({trans:y,values:!1,limit:d.limit,query:{index:_,range:d.range}})}).then(function(y){return y.result}).then(c);d.keysOnly=!d.isMatch;var g=[];return this.each(function(y,_){g.push(_.primaryKey)}).then(function(){return g}).then(c)},Ut.prototype.uniqueKeys=function(c){return this._ctx.unique="unique",this.keys(c)},Ut.prototype.firstKey=function(c){return this.limit(1).keys(function(d){return d[0]}).then(c)},Ut.prototype.lastKey=function(c){return this.reverse().firstKey(c)},Ut.prototype.distinct=function(){var c,d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];return d&&d.multi&&(c={},ic(this._ctx,function(y){var y=y.primaryKey.toString(),_=p(c,y);return c[y]=!0,!_})),this},Ut.prototype.modify=function(c){var d=this,g=this._ctx;return this._write(function(y){function _(ce,Se){var Ee=Se.failures;he+=ce-Se.numFailures;for(var we=0,Ie=i(Ee);we<Ie.length;we++){var Le=Ie[we];ie.push(Ee[Le])}}var E=typeof c=="function"?c:function(ce){return Jd(ce,c)},R=g.table.core,fe=R.schema.primaryKey,V=fe.outbound,de=fe.extractKey,xe=200,fe=d.db._options.modifyChunkSize,ie=(fe&&(xe=typeof fe=="object"?fe[R.name]||fe["*"]||200:fe),[]),he=0,me=[],ve=c===nf;return d.clone().primaryKeys().then(function(ce){function Se(we){var Ie=Math.min(xe,ce.length-we),Le=ce.slice(we,we+Ie);return(ve?Promise.resolve([]):R.getMany({trans:y,keys:Le,cache:"immutable"})).then(function(Ue){var Ge=[],Be=[],Qe=V?[]:null,Xe=ve?Le:[];if(!ve)for(var Ke=0;Ke<Ie;++Ke){var et=Ue[Ke],Bt={value:K(et),primKey:ce[we+Ke]};E.call(Bt,Bt.value,Bt)!==!1&&(Bt.value==null?Xe.push(ce[we+Ke]):V||Lt(de(et),de(Bt.value))===0?(Be.push(Bt.value),V&&Qe.push(ce[we+Ke])):(Xe.push(ce[we+Ke]),Ge.push(Bt.value)))}return Promise.resolve(0<Ge.length&&R.mutate({trans:y,type:"add",values:Ge}).then(function(Gt){for(var gt in Gt.failures)Xe.splice(parseInt(gt),1);_(Ge.length,Gt)})).then(function(){return(0<Be.length||Ee&&typeof c=="object")&&R.mutate({trans:y,type:"put",keys:Qe,values:Be,criteria:Ee,changeSpec:typeof c!="function"&&c,isAdditionalChunk:0<we}).then(function(Gt){return _(Be.length,Gt)})}).then(function(){return(0<Xe.length||Ee&&ve)&&R.mutate({trans:y,type:"delete",keys:Xe,criteria:Ee,isAdditionalChunk:0<we}).then(function(Gt){return ko(g.table,Xe,Gt)}).then(function(Gt){return _(Xe.length,Gt)})}).then(function(){return ce.length>we+Ie&&Se(we+xe)})})}var Ee=Ms(g)&&g.limit===1/0&&(typeof c!="function"||ve)&&{index:g.index,range:g.range};return Se(0).then(function(){if(0<ie.length)throw new Y("Error modifying one or more objects",ie,he,me);return ce.length})})})},Ut.prototype.delete=function(){var c=this._ctx,d=c.range;return!Ms(c)||c.table.schema.yProps||!c.isPrimKey&&d.type!==3?this.modify(nf):this._write(function(g){var y=c.table.core.schema.primaryKey,_=d;return c.table.core.count({trans:g,query:{index:y,range:_}}).then(function(E){return c.table.core.mutate({trans:g,type:"deleteRange",range:_}).then(function(de){var V=de.failures,de=de.numFailures;if(de)throw new Y("Could not delete some values",Object.keys(V).map(function(xe){return V[xe]}),E-de);return E-de})})})};var dm=Ut;function Ut(){}var nf=function(c,d){return d.value=null};function fm(c,d){return c<d?-1:c===d?0:1}function vm(c,d){return d<c?-1:c===d?0:1}function ar(c,d,g){return c=c instanceof af?new c.Collection(c):c,c._ctx.error=new(g||TypeError)(d),c}function Os(c){return new c.Collection(c,function(){return rf("")}).limit(0)}function Ao(me,d,g,y){var _,E,R,V,de,xe,fe,ie=g.length;if(!g.every(function(ce){return typeof ce=="string"}))return ar(me,dn);function he(ce){_=ce==="next"?function(Ee){return Ee.toUpperCase()}:function(Ee){return Ee.toLowerCase()},E=ce==="next"?function(Ee){return Ee.toLowerCase()}:function(Ee){return Ee.toUpperCase()},R=ce==="next"?fm:vm;var Se=g.map(function(Ee){return{lower:E(Ee),upper:_(Ee)}}).sort(function(Ee,we){return R(Ee.lower,we.lower)});V=Se.map(function(Ee){return Ee.upper}),de=Se.map(function(Ee){return Ee.lower}),fe=(xe=ce)==="next"?"":y}he("next");var me=new me.Collection(me,function(){return Sa(V[0],de[ie-1]+y)}),ve=(me._ondirectionchange=function(ce){he(ce)},0);return me._addAlgorithm(function(ce,Se,Ee){var we=ce.key;if(typeof we=="string"){var Ie=E(we);if(d(Ie,de,ve))return!0;for(var Le=null,Ue=ve;Ue<ie;++Ue){var Ge=((Be,Qe,Xe,Ke,et,Bt)=>{for(var Gt=Math.min(Be.length,Ke.length),gt=-1,It=0;It<Gt;++It){var fn=Qe[It];if(fn!==Ke[It])return et(Be[It],Xe[It])<0?Be.substr(0,It)+Xe[It]+Xe.substr(It+1):et(Be[It],Ke[It])<0?Be.substr(0,It)+Ke[It]+Xe.substr(It+1):0<=gt?Be.substr(0,gt)+Qe[gt]+Xe.substr(gt+1):null;et(Be[It],fn)<0&&(gt=It)}return Gt<Ke.length&&Bt==="next"?Be+Xe.substr(Be.length):Gt<Be.length&&Bt==="prev"?Be.substr(0,Xe.length):gt<0?null:Be.substr(0,gt)+Ke[gt]+Xe.substr(gt+1)})(we,Ie,V[Ue],de[Ue],R,xe);Ge===null&&Le===null?ve=Ue+1:(Le===null||0<R(Le,Ge))&&(Le=Ge)}Se(Le!==null?function(){ce.continue(Le+fe)}:Ee)}return!1}),me}function Sa(c,d,g,y){return{type:2,lower:c,upper:d,lowerOpen:g,upperOpen:y}}function rf(c){return{type:1,lower:c,upper:c}}Object.defineProperty(kn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),kn.prototype.between=function(c,d,g,y){g=g!==!1,y=y===!0;try{return 0<this._cmp(c,d)||this._cmp(c,d)===0&&(g||y)&&(!g||!y)?Os(this):new this.Collection(this,function(){return Sa(c,d,!g,!y)})}catch{return ar(this,sn)}},kn.prototype.equals=function(c){return c==null?ar(this,sn):new this.Collection(this,function(){return rf(c)})},kn.prototype.above=function(c){return c==null?ar(this,sn):new this.Collection(this,function(){return Sa(c,void 0,!0)})},kn.prototype.aboveOrEqual=function(c){return c==null?ar(this,sn):new this.Collection(this,function(){return Sa(c,void 0,!1)})},kn.prototype.below=function(c){return c==null?ar(this,sn):new this.Collection(this,function(){return Sa(void 0,c,!1,!0)})},kn.prototype.belowOrEqual=function(c){return c==null?ar(this,sn):new this.Collection(this,function(){return Sa(void 0,c)})},kn.prototype.startsWith=function(c){return typeof c!="string"?ar(this,dn):this.between(c,c+Vt,!0,!0)},kn.prototype.startsWithIgnoreCase=function(c){return c===""?this.startsWith(c):Ao(this,function(d,g){return d.indexOf(g[0])===0},[c],Vt)},kn.prototype.equalsIgnoreCase=function(c){return Ao(this,function(d,g){return d===g[0]},[c],"")},kn.prototype.anyOfIgnoreCase=function(){var c=B.apply(Z,arguments);return c.length===0?Os(this):Ao(this,function(d,g){return g.indexOf(d)!==-1},c,"")},kn.prototype.startsWithAnyOfIgnoreCase=function(){var c=B.apply(Z,arguments);return c.length===0?Os(this):Ao(this,function(d,g){return g.some(function(y){return d.indexOf(y)===0})},c,Vt)},kn.prototype.anyOf=function(){var c,d,g=this,y=B.apply(Z,arguments),_=this._cmp;try{y.sort(_)}catch{return ar(this,sn)}return y.length===0?Os(this):((c=new this.Collection(this,function(){return Sa(y[0],y[y.length-1])}))._ondirectionchange=function(E){_=E==="next"?g._ascending:g._descending,y.sort(_)},d=0,c._addAlgorithm(function(E,R,V){for(var de=E.key;0<_(de,y[d]);)if(++d===y.length)return R(V),!1;return _(de,y[d])===0||(R(function(){E.continue(y[d])}),!1)}),c)},kn.prototype.notEqual=function(c){return this.inAnyRange([[-1/0,c],[c,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},kn.prototype.noneOf=function(){var c=B.apply(Z,arguments);if(c.length===0)return new this.Collection(this);try{c.sort(this._ascending)}catch{return ar(this,sn)}var d=c.reduce(function(g,y){return g?g.concat([[g[g.length-1][1],y]]):[[-1/0,y]]},null);return d.push([c[c.length-1],this.db._maxKey]),this.inAnyRange(d,{includeLowers:!1,includeUppers:!1})},kn.prototype.inAnyRange=function(c,Ee){var g=this,y=this._cmp,_=this._ascending,E=this._descending,R=this._min,V=this._max;if(c.length===0)return Os(this);if(!c.every(function(we){return we[0]!==void 0&&we[1]!==void 0&&_(we[0],we[1])<=0}))return ar(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var de=!Ee||Ee.includeLowers!==!1,xe=Ee&&Ee.includeUppers===!0,fe,ie=_;function he(we,Ie){return ie(we[0],Ie[0])}try{(fe=c.reduce(function(we,Ie){for(var Le=0,Ue=we.length;Le<Ue;++Le){var Ge=we[Le];if(y(Ie[0],Ge[1])<0&&0<y(Ie[1],Ge[0])){Ge[0]=R(Ge[0],Ie[0]),Ge[1]=V(Ge[1],Ie[1]);break}}return Le===Ue&&we.push(Ie),we},[])).sort(he)}catch{return ar(this,sn)}var me=0,ve=xe?function(we){return 0<_(we,fe[me][1])}:function(we){return 0<=_(we,fe[me][1])},ce=de?function(we){return 0<E(we,fe[me][0])}:function(we){return 0<=E(we,fe[me][0])},Se=ve,Ee=new this.Collection(this,function(){return Sa(fe[0][0],fe[fe.length-1][1],!de,!xe)});return Ee._ondirectionchange=function(we){ie=we==="next"?(Se=ve,_):(Se=ce,E),fe.sort(he)},Ee._addAlgorithm(function(we,Ie,Le){for(var Ue,Ge=we.key;Se(Ge);)if(++me===fe.length)return Ie(Le),!1;return!ve(Ue=Ge)&&!ce(Ue)||(g._cmp(Ge,fe[me][1])===0||g._cmp(Ge,fe[me][0])===0||Ie(function(){ie===_?we.continue(fe[me][0]):we.continue(fe[me][1])}),!1)}),Ee},kn.prototype.startsWithAnyOf=function(){var c=B.apply(Z,arguments);return c.every(function(d){return typeof d=="string"})?c.length===0?Os(this):this.inAnyRange(c.map(function(d){return[d,d+Vt]})):ar(this,"startsWithAnyOf() only works with strings")};var af=kn;function kn(){}function qr(c){return ct(function(d){return gi(d),c(d.target.error),!1})}function gi(c){c.stopPropagation&&c.stopPropagation(),c.preventDefault&&c.preventDefault()}var mi="storagemutated",lc="x-storagemutated-1",Ea=hi(null,mi),hm=(Fr.prototype._lock=function(){return S(!ze.global),++this._reculock,this._reculock!==1||ze.global||(ze.lockOwnerFor=this),this},Fr.prototype._unlock=function(){if(S(!ze.global),--this._reculock==0)for(ze.global||(ze.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var c=this._blockedFuncs.shift();try{at(c[1],c[0])}catch{}}return this},Fr.prototype._locked=function(){return this._reculock&&ze.lockOwnerFor!==this},Fr.prototype.create=function(c){var d=this;if(this.mode){var g=this.db.idbdb,y=this.db._state.dbOpenError;if(S(!this.idbtrans),!c&&!g)switch(y&&y.name){case"DatabaseClosedError":throw new re.DatabaseClosed(y);case"MissingAPIError":throw new re.MissingAPI(y.message,y);default:throw new re.OpenFailed(y)}if(!this.active)throw new re.TransactionInactive;S(this._completion._state===null),(c=this.idbtrans=c||(this.db.core||g).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ct(function(_){gi(_),d._reject(c.error)}),c.onabort=ct(function(_){gi(_),d.active&&d._reject(new re.Abort(c.error)),d.active=!1,d.on("abort").fire(_)}),c.oncomplete=ct(function(){d.active=!1,d._resolve(),"mutatedParts"in c&&Ea.storagemutated.fire(c.mutatedParts)})}return this},Fr.prototype._promise=function(c,d,g){var y,_=this;return c==="readwrite"&&this.mode!=="readwrite"?Ve(new re.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Re(function(E,R){_._blockedFuncs.push([function(){_._promise(c,d,g).then(E,R)},ze])}):g?_n(function(){var E=new Re(function(R,V){_._lock();var de=d(R,V,_);de&&de.then&&de.then(R,V)});return E.finally(function(){return _._unlock()}),E._lib=!0,E}):((y=new Re(function(E,R){var V=d(E,R,_);V&&V.then&&V.then(E,R)}))._lib=!0,y):Ve(new re.TransactionInactive)},Fr.prototype._root=function(){return this.parent?this.parent._root():this},Fr.prototype.waitFor=function(c){var d,g=this._root(),y=Re.resolve(c),_=(g._waitingFor?g._waitingFor=g._waitingFor.then(function(){return y}):(g._waitingFor=y,g._waitingQueue=[],d=g.idbtrans.objectStore(g.storeNames[0]),(function E(){for(++g._spinCount;g._waitingQueue.length;)g._waitingQueue.shift()();g._waitingFor&&(d.get(-1/0).onsuccess=E)})()),g._waitingFor);return new Re(function(E,R){y.then(function(V){return g._waitingQueue.push(ct(E.bind(null,V)))},function(V){return g._waitingQueue.push(ct(R.bind(null,V)))}).finally(function(){g._waitingFor===_&&(g._waitingFor=null)})})},Fr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new re.Abort))},Fr.prototype.table=function(c){var d=this._memoizedTables||(this._memoizedTables={});if(p(d,c))return d[c];var g=this.schema[c];if(g)return(g=new this.db.Table(c,g,this)).core=this.db.core.table(c),d[c]=g;throw new re.NotFound("Table "+c+" not part of transaction")},Fr);function Fr(){}function cc(c,d,g,y,_,E,R,V){return{name:c,keyPath:d,unique:g,multi:y,auto:_,compound:E,src:(g&&!R?"&":"")+(y?"*":"")+(_?"++":"")+sf(d),type:V}}function sf(c){return typeof c=="string"?c:c?"["+[].join.call(c,"+")+"]":""}function uc(c,d,g){return{name:c,primKey:d,indexes:g,mappedClass:null,idxByName:(y=function(_){return[_.name,_]},g.reduce(function(_,E,R){return E=y(E,R),E&&(_[E[0]]=E[1]),_},{}))};var y}var yi=function(c){try{return c.only([[]]),yi=function(){return[[]]},[[]]}catch{return yi=function(){return Vt},Vt}};function dc(c){return c==null?function(){}:typeof c=="string"?(d=c).split(".").length===1?function(g){return g[d]}:function(g){return L(g,d)}:function(g){return L(g,c)};var d}function of(c){return[].slice.call(c)}var pm=0;function bi(c){return c==null?":id":typeof c=="string"?c:"[".concat(c.join("+"),"]")}function gm(c,d,de){function y(ve){if(ve.type===3)return null;if(ve.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ie=ve.lower,he=ve.upper,me=ve.lowerOpen,ve=ve.upperOpen;return ie===void 0?he===void 0?null:d.upperBound(he,!!ve):he===void 0?d.lowerBound(ie,!!me):d.bound(ie,he,!!me,!!ve)}function _(fe){var ie,he=fe.name;return{name:he,schema:fe,mutate:function(me){var ve=me.trans,ce=me.type,Se=me.keys,Ee=me.values,we=me.range;return new Promise(function(Ie,Le){Ie=ct(Ie);var Ue=ve.objectStore(he),Ge=Ue.keyPath==null,Be=ce==="put"||ce==="add";if(!Be&&ce!=="delete"&&ce!=="deleteRange")throw new Error("Invalid operation type: "+ce);var Qe,Xe=(Se||Ee||{length:1}).length;if(Se&&Ee&&Se.length!==Ee.length)throw new Error("Given keys array must have same length as given values array.");if(Xe===0)return Ie({numFailures:0,failures:{},results:[],lastResult:void 0});function Ke(vn){++Gt,gi(vn)}var et=[],Bt=[],Gt=0;if(ce==="deleteRange"){if(we.type===4)return Ie({numFailures:Gt,failures:Bt,results:[],lastResult:void 0});we.type===3?et.push(Qe=Ue.clear()):et.push(Qe=Ue.delete(y(we)))}else{var Ge=Be?Ge?[Ee,Se]:[Ee,null]:[Se,null],gt=Ge[0],It=Ge[1];if(Be)for(var fn=0;fn<Xe;++fn)et.push(Qe=It&&It[fn]!==void 0?Ue[ce](gt[fn],It[fn]):Ue[ce](gt[fn])),Qe.onerror=Ke;else for(fn=0;fn<Xe;++fn)et.push(Qe=Ue[ce](gt[fn])),Qe.onerror=Ke}function vr(vn){vn=vn.target.result,et.forEach(function(Ya,Ic){return Ya.error!=null&&(Bt[Ic]=Ya.error)}),Ie({numFailures:Gt,failures:Bt,results:ce==="delete"?Se:et.map(function(Ya){return Ya.result}),lastResult:vn})}Qe.onerror=function(vn){Ke(vn),vr(vn)},Qe.onsuccess=vr})},getMany:function(me){var ve=me.trans,ce=me.keys;return new Promise(function(Se,Ee){Se=ct(Se);for(var we,Ie=ve.objectStore(he),Le=ce.length,Ue=new Array(Le),Ge=0,Be=0,Qe=function(et){et=et.target,Ue[et._pos]=et.result,++Be===Ge&&Se(Ue)},Xe=qr(Ee),Ke=0;Ke<Le;++Ke)ce[Ke]!=null&&((we=Ie.get(ce[Ke]))._pos=Ke,we.onsuccess=Qe,we.onerror=Xe,++Ge);Ge===0&&Se(Ue)})},get:function(me){var ve=me.trans,ce=me.key;return new Promise(function(Se,Ee){Se=ct(Se);var we=ve.objectStore(he).get(ce);we.onsuccess=function(Ie){return Se(Ie.target.result)},we.onerror=qr(Ee)})},query:(ie=V,function(me){return new Promise(function(ve,ce){ve=ct(ve);var Se,Ee,we,Be=me.trans,Ie=me.values,Le=me.limit,Ge=me.query,Ue=Le===1/0?void 0:Le,Qe=Ge.index,Ge=Ge.range,Be=Be.objectStore(he),Be=Qe.isPrimaryKey?Be:Be.index(Qe.name),Qe=y(Ge);if(Le===0)return ve({result:[]});ie?((Ge=Ie?Be.getAll(Qe,Ue):Be.getAllKeys(Qe,Ue)).onsuccess=function(Xe){return ve({result:Xe.target.result})},Ge.onerror=qr(ce)):(Se=0,Ee=!Ie&&"openKeyCursor"in Be?Be.openKeyCursor(Qe):Be.openCursor(Qe),we=[],Ee.onsuccess=function(Xe){var Ke=Ee.result;return!Ke||(we.push(Ie?Ke.value:Ke.primaryKey),++Se===Le)?ve({result:we}):void Ke.continue()},Ee.onerror=qr(ce))})}),openCursor:function(me){var ve=me.trans,ce=me.values,Se=me.query,Ee=me.reverse,we=me.unique;return new Promise(function(Ie,Le){Ie=ct(Ie);var Be=Se.index,Ue=Se.range,Ge=ve.objectStore(he),Ge=Be.isPrimaryKey?Ge:Ge.index(Be.name),Be=Ee?we?"prevunique":"prev":we?"nextunique":"next",Qe=!ce&&"openKeyCursor"in Ge?Ge.openKeyCursor(y(Ue),Be):Ge.openCursor(y(Ue),Be);Qe.onerror=qr(Le),Qe.onsuccess=ct(function(Xe){var Ke,et,Bt,Gt,gt=Qe.result;gt?(gt.___id=++pm,gt.done=!1,Ke=gt.continue.bind(gt),et=(et=gt.continuePrimaryKey)&&et.bind(gt),Bt=gt.advance.bind(gt),Gt=function(){throw new Error("Cursor not stopped")},gt.trans=ve,gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=function(){throw new Error("Cursor not started")},gt.fail=ct(Le),gt.next=function(){var It=this,fn=1;return this.start(function(){return fn--?It.continue():It.stop()}).then(function(){return It})},gt.start=function(It){function fn(){if(Qe.result)try{It()}catch(vn){gt.fail(vn)}else gt.done=!0,gt.start=function(){throw new Error("Cursor behind last entry")},gt.stop()}var vr=new Promise(function(vn,Ya){vn=ct(vn),Qe.onerror=qr(Ya),gt.fail=Ya,gt.stop=function(Ic){gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=Gt,vn(Ic)}});return Qe.onsuccess=ct(function(vn){Qe.onsuccess=fn,fn()}),gt.continue=Ke,gt.continuePrimaryKey=et,gt.advance=Bt,fn(),vr},Ie(gt)):Ie(null)},Le)})},count:function(me){var ve=me.query,ce=me.trans,Se=ve.index,Ee=ve.range;return new Promise(function(we,Ie){var Le=ce.objectStore(he),Le=Se.isPrimaryKey?Le:Le.index(Se.name),Ue=y(Ee),Ue=Ue?Le.count(Ue):Le.count();Ue.onsuccess=ct(function(Ge){return we(Ge.target.result)}),Ue.onerror=qr(Ie)})}}}E=de,R=of((de=c).objectStoreNames);var E,de={schema:{name:de.name,tables:R.map(function(fe){return E.objectStore(fe)}).map(function(fe){var ie=fe.keyPath,he=fe.autoIncrement,ve=o(ie),me={},ve={name:fe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ie==null,compound:ve,keyPath:ie,autoIncrement:he,unique:!0,extractKey:dc(ie)},indexes:of(fe.indexNames).map(function(ce){return fe.index(ce)}).map(function(we){var Ie=we.name,Se=we.unique,Ee=we.multiEntry,we=we.keyPath,Ie={name:Ie,compound:o(we),keyPath:we,unique:Se,multiEntry:Ee,extractKey:dc(we)};return me[bi(we)]=Ie}),getIndexByKeyPath:function(ce){return me[bi(ce)]}};return me[":id"]=ve.primaryKey,ie!=null&&(me[bi(ie)]=ve.primaryKey),ve})},hasGetAll:0<R.length&&"getAll"in E.objectStore(R[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},R=de.schema,V=de.hasGetAll,de=R.tables.map(_),xe={};return de.forEach(function(fe){return xe[fe.name]=fe}),{stack:"dbcore",transaction:c.transaction.bind(c),table:function(fe){if(xe[fe])return xe[fe];throw new Error("Table '".concat(fe,"' not found"))},MIN_KEY:-1/0,MAX_KEY:yi(d),schema:R}}function mm(c,d,g,y){return g=g.IDBKeyRange,d=gm(d,g,y),{dbcore:c.dbcore.reduce(function(_,E){return E=E.create,r(r({},_),E(_))},d)}}function To(c,d){var g=d.db,g=mm(c._middlewares,g,c._deps,d);c.core=g.dbcore,c.tables.forEach(function(y){var _=y.name;c.core.schema.tables.some(function(E){return E.name===_})&&(y.core=c.core.table(_),c[_]instanceof c.Table)&&(c[_].core=y.core)})}function Co(c,d,g,y){g.forEach(function(_){var E=y[_];d.forEach(function(R){var V=(function de(xe,fe){return T(xe,fe)||(xe=f(xe))&&de(xe,fe)})(R,_);(!V||"value"in V&&V.value===void 0)&&(R===c.Transaction.prototype||R instanceof c.Transaction?x(R,_,{get:function(){return this.table(_)},set:function(de){m(this,_,{value:de,writable:!0,configurable:!0,enumerable:!0})}}):R[_]=new c.Table(_,E))})})}function fc(c,d){d.forEach(function(g){for(var y in g)g[y]instanceof c.Table&&delete g[y]})}function ym(c,d){return c._cfg.version-d._cfg.version}function bm(c,d,g,y){var _=c._dbSchema,E=(g.objectStoreNames.contains("$meta")&&!_.$meta&&(_.$meta=uc("$meta",cf("")[0],[]),c._storeNames.push("$meta")),c._createTransaction("readwrite",c._storeNames,_)),R=(E.create(g),E._completion.catch(y),E._reject.bind(E)),V=ze.transless||ze;_n(function(){if(ze.trans=E,ze.transless=V,d!==0)return To(c,g),xe=d,((de=E).storeNames.includes("$meta")?de.table("$meta").get("version").then(function(fe){return fe??xe}):Re.resolve(xe)).then(function(Se){var ie=c,he=Se,me=E,ve=g,ce=[],Se=ie._versions,Ee=ie._dbSchema=Po(0,ie.idbdb,ve);return(Se=Se.filter(function(we){return we._cfg.version>=he})).length===0?Re.resolve():(Se.forEach(function(we){ce.push(function(){var Ie,Le,Ue,Ge=Ee,Be=we._cfg.dbschema,Qe=(Mo(ie,Ge,ve),Mo(ie,Be,ve),Ee=ie._dbSchema=Be,vc(Ge,Be)),Xe=(Qe.add.forEach(function(Ke){hc(ve,Ke[0],Ke[1].primKey,Ke[1].indexes)}),Qe.change.forEach(function(Ke){if(Ke.recreate)throw new re.Upgrade("Not yet support for changing primary key");var et=ve.objectStore(Ke.name);Ke.add.forEach(function(Bt){return Io(et,Bt)}),Ke.change.forEach(function(Bt){et.deleteIndex(Bt.name),Io(et,Bt)}),Ke.del.forEach(function(Bt){return et.deleteIndex(Bt)})}),we._cfg.contentUpgrade);if(Xe&&we._cfg.version>he)return To(ie,ve),me._memoizedTables={},Ie=J(Be),Qe.del.forEach(function(Ke){Ie[Ke]=Ge[Ke]}),fc(ie,[ie.Transaction.prototype]),Co(ie,[ie.Transaction.prototype],i(Ie),Ie),me.schema=Ie,(Le=ee(Xe))&&hn(),Be=Re.follow(function(){var Ke;(Ue=Xe(me))&&Le&&(Ke=rr.bind(null,null),Ue.then(Ke,Ke))}),Ue&&typeof Ue.then=="function"?Re.resolve(Ue):Be.then(function(){return Ue})}),ce.push(function(Ie){var Le,Ue,Ge=we._cfg.dbschema;Le=Ge,Ue=Ie,[].slice.call(Ue.db.objectStoreNames).forEach(function(Be){return Le[Be]==null&&Ue.db.deleteObjectStore(Be)}),fc(ie,[ie.Transaction.prototype]),Co(ie,[ie.Transaction.prototype],ie._storeNames,ie._dbSchema),me.schema=ie._dbSchema}),ce.push(function(Ie){ie.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(ie.idbdb.version/10)===we._cfg.version?(ie.idbdb.deleteObjectStore("$meta"),delete ie._dbSchema.$meta,ie._storeNames=ie._storeNames.filter(function(Le){return Le!=="$meta"})):Ie.objectStore("$meta").put(we._cfg.version,"version"))})}),(function we(){return ce.length?Re.resolve(ce.shift()(me.idbtrans)).then(we):Re.resolve()})().then(function(){lf(Ee,ve)}))}).catch(R);var de,xe;i(_).forEach(function(fe){hc(g,fe,_[fe].primKey,_[fe].indexes)}),To(c,g),Re.follow(function(){return c.on.populate.fire(E)}).catch(R)})}function _m(c,d){lf(c._dbSchema,d),d.db.version%10!=0||d.objectStoreNames.contains("$meta")||d.db.createObjectStore("$meta").add(Math.ceil(d.db.version/10-1),"version");var g=Po(0,c.idbdb,d);Mo(c,c._dbSchema,d);for(var y=0,_=vc(g,c._dbSchema).change;y<_.length;y++){var E=(R=>{if(R.change.length||R.recreate)return console.warn("Unable to patch indexes of table ".concat(R.name," because it has changes on the type of index or primary key.")),{value:void 0};var V=d.objectStore(R.name);R.add.forEach(function(de){Ne&&console.debug("Dexie upgrade patch: Creating missing index ".concat(R.name,".").concat(de.src)),Io(V,de)})})(_[y]);if(typeof E=="object")return E.value}}function vc(c,d){var g,y={del:[],add:[],change:[]};for(g in c)d[g]||y.del.push(g);for(g in d){var _=c[g],E=d[g];if(_){var R={name:g,def:E,recreate:!1,del:[],add:[],change:[]};if(""+(_.primKey.keyPath||"")!=""+(E.primKey.keyPath||"")||_.primKey.auto!==E.primKey.auto)R.recreate=!0,y.change.push(R);else{var V=_.idxByName,de=E.idxByName,xe=void 0;for(xe in V)de[xe]||R.del.push(xe);for(xe in de){var fe=V[xe],ie=de[xe];fe?fe.src!==ie.src&&R.change.push(ie):R.add.push(ie)}(0<R.del.length||0<R.add.length||0<R.change.length)&&y.change.push(R)}}else y.add.push([g,E])}return y}function hc(c,d,g,y){var _=c.db.createObjectStore(d,g.keyPath?{keyPath:g.keyPath,autoIncrement:g.auto}:{autoIncrement:g.auto});y.forEach(function(E){return Io(_,E)})}function lf(c,d){i(c).forEach(function(g){d.db.objectStoreNames.contains(g)||(Ne&&console.debug("Dexie: Creating missing table",g),hc(d,g,c[g].primKey,c[g].indexes))})}function Io(c,d){c.createIndex(d.name,d.keyPath,{unique:d.unique,multiEntry:d.multi})}function Po(c,d,g){var y={};return z(d.objectStoreNames,0).forEach(function(_){for(var E=g.objectStore(_),R=cc(sf(xe=E.keyPath),xe||"",!0,!1,!!E.autoIncrement,xe&&typeof xe!="string",!0),V=[],de=0;de<E.indexNames.length;++de){var fe=E.index(E.indexNames[de]),xe=fe.keyPath,fe=cc(fe.name,xe,!!fe.unique,!!fe.multiEntry,!1,xe&&typeof xe!="string",!1);V.push(fe)}y[_]=uc(_,R,V)}),y}function Mo(c,d,g){for(var y=g.db.objectStoreNames,_=0;_<y.length;++_){var E=y[_],R=g.objectStore(E);c._hasGetAll="getAll"in R;for(var V=0;V<R.indexNames.length;++V){var de,xe=R.indexNames[V],fe=R.index(xe).keyPath,fe=typeof fe=="string"?fe:"["+z(fe).join("+")+"]";d[E]&&(de=d[E].idxByName[fe])&&(de.name=xe,delete d[E].idxByName[fe],d[E].idxByName[xe]=de)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(c._hasGetAll=!1)}function cf(c){return c.split(",").map(function(d,g){var _=d.split(":"),y=(y=_[1])==null?void 0:y.trim(),_=(d=_[0].trim()).replace(/([&*]|\+\+)/g,""),E=/^\[/.test(_)?_.match(/^\[(.*)\]$/)[1].split("+"):_;return cc(_,E||null,/\&/.test(d),/\*/.test(d),/\+\+/.test(d),o(E),g===0,y)})}Ns.prototype._createTableSchema=uc,Ns.prototype._parseIndexSyntax=cf,Ns.prototype._parseStoresSpec=function(c,d){var g=this;i(c).forEach(function(y){if(c[y]!==null){var _=g._parseIndexSyntax(c[y]),E=_.shift();if(!E)throw new re.Schema("Invalid schema for table "+y+": "+c[y]);if(E.unique=!0,E.multi)throw new re.Schema("Primary key cannot be multiEntry*");_.forEach(function(R){if(R.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")}),E=g._createTableSchema(y,E,_),d[y]=E}})},Ns.prototype.stores=function(g){var d=this.db,g=(this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,g):g,d._versions),y={},_={};return g.forEach(function(E){u(y,E._cfg.storesSource),_=E._cfg.dbschema={},E._parseStoresSpec(y,_)}),d._dbSchema=_,fc(d,[d._allTables,d,d.Transaction.prototype]),Co(d,[d._allTables,d,d.Transaction.prototype,this._cfg.tables],i(_),_),d._storeNames=i(_),this},Ns.prototype.upgrade=function(c){return this._cfg.contentUpgrade=Fe(this._cfg.contentUpgrade||_e,c),this};var wm=Ns;function Ns(){}function pc(c,d){var g=c._dbNamesDB;return g||(g=c._dbNamesDB=new aa(Un,{addons:[],indexedDB:c,IDBKeyRange:d})).version(1).stores({dbnames:"name"}),g.table("dbnames")}function gc(c){return c&&typeof c.databases=="function"}function mc(c){return _n(function(){return ze.letThrough=!0,c()})}function yc(c){return!("from"in c)}var Ln=function(c,d){var g;if(!this)return g=new Ln,c&&"d"in c&&u(g,c),g;u(this,arguments.length?{d:1,from:c,to:1<arguments.length?d:c}:{d:0})};function _i(c,d,g){var y=Lt(d,g);if(!isNaN(y)){if(0<y)throw RangeError();if(yc(c))return u(c,{from:d,to:g,d:1});var y=c.l,_=c.r;if(Lt(g,c.from)<0)return y?_i(y,d,g):c.l={from:d,to:g,d:1,l:null,r:null},df(c);if(0<Lt(d,c.to))return _?_i(_,d,g):c.r={from:d,to:g,d:1,l:null,r:null},df(c);Lt(d,c.from)<0&&(c.from=d,c.l=null,c.d=_?_.d+1:1),0<Lt(g,c.to)&&(c.to=g,c.r=null,c.d=c.l?c.l.d+1:1),d=!c.r,y&&!c.l&&wi(c,y),_&&d&&wi(c,_)}}function wi(c,d){yc(d)||(function g(y,_){var E=_.from,R=_.l,V=_.r;_i(y,E,_.to),R&&g(y,R),V&&g(y,V)})(c,d)}function uf(c,d){var g=Oo(d),y=g.next();if(!y.done)for(var _=y.value,E=Oo(c),R=E.next(_.from),V=R.value;!y.done&&!R.done;){if(Lt(V.from,_.to)<=0&&0<=Lt(V.to,_.from))return!0;Lt(_.from,V.from)<0?_=(y=g.next(V.from)).value:V=(R=E.next(_.from)).value}return!1}function Oo(c){var d=yc(c)?null:{s:0,n:c};return{next:function(g){for(var y=0<arguments.length;d;)switch(d.s){case 0:if(d.s=1,y)for(;d.n.l&&Lt(g,d.n.from)<0;)d={up:d,n:d.n.l,s:1};else for(;d.n.l;)d={up:d,n:d.n.l,s:1};case 1:if(d.s=2,!y||Lt(g,d.n.to)<=0)return{value:d.n,done:!1};case 2:if(d.n.r){d.s=3,d={up:d,n:d.n.r,s:0};continue}case 3:d=d.up}return{done:!0}}}}function df(c){var d,g,y,_=(((_=c.r)==null?void 0:_.d)||0)-(((_=c.l)==null?void 0:_.d)||0),_=1<_?"r":_<-1?"l":"";_&&(d=_=="r"?"l":"r",g=r({},c),y=c[_],c.from=y.from,c.to=y.to,c[_]=y[_],g[_]=y[d],(c[d]=g).d=ff(g)),c.d=ff(c)}function ff(g){var d=g.r,g=g.l;return(d?g?Math.max(d.d,g.d):d.d:g?g.d:0)+1}function No(c,d){return i(d).forEach(function(g){c[g]?wi(c[g],d[g]):c[g]=(function y(_){var E,R,V={};for(E in _)p(_,E)&&(R=_[E],V[E]=!R||typeof R!="object"||X.has(R.constructor)?R:y(R));return V})(d[g])}),c}function bc(c,d){return c.all||d.all||Object.keys(c).some(function(g){return d[g]&&uf(d[g],c[g])})}h(Ln.prototype,((rt={add:function(c){return wi(this,c),this},addKey:function(c){return _i(this,c,c),this},addKeys:function(c){var d=this;return c.forEach(function(g){return _i(d,g,g)}),this},hasKey:function(c){var d=Oo(this).next(c).value;return d&&Lt(d.from,c)<=0&&0<=Lt(d.to,c)}})[I]=function(){return Oo(this)},rt));var Ga={},_c={},wc=!1;function Ro(c){No(_c,c),wc||(wc=!0,setTimeout(function(){wc=!1,xc(_c,!(_c={}))},0))}function xc(c,d){d===void 0&&(d=!1);var g=new Set;if(c.all)for(var y=0,_=Object.values(Ga);y<_.length;y++)vf(V=_[y],c,g,d);else for(var E in c){var R,V,E=/^idb\:\/\/(.*)\/(.*)\//.exec(E);E&&(R=E[1],E=E[2],V=Ga["idb://".concat(R,"/").concat(E)])&&vf(V,c,g,d)}g.forEach(function(de){return de()})}function vf(c,d,g,y){for(var _=[],E=0,R=Object.entries(c.queries.query);E<R.length;E++){for(var V=R[E],de=V[0],xe=[],fe=0,ie=V[1];fe<ie.length;fe++){var he=ie[fe];bc(d,he.obsSet)?he.subscribers.forEach(function(Se){return g.add(Se)}):y&&xe.push(he)}y&&_.push([de,xe])}if(y)for(var me=0,ve=_;me<ve.length;me++){var ce=ve[me],de=ce[0],xe=ce[1];c.queries.query[de]=xe}}function xm(c){var d=c._state,g=c._deps.indexedDB;if(d.isBeingOpened||c.idbdb)return d.dbReadyPromise.then(function(){return d.dbOpenError?Ve(d.dbOpenError):c});d.isBeingOpened=!0,d.dbOpenError=null,d.openComplete=!1;var y=d.openCanceller,_=Math.round(10*c.verno),E=!1;function R(){if(d.openCanceller!==y)throw new re.DatabaseClosed("db.open() was cancelled")}function V(){return new Re(function(he,me){if(R(),!g)throw new re.MissingAPI;var ve=c.name,ce=d.autoSchema||!_?g.open(ve):g.open(ve,_);if(!ce)throw new re.MissingAPI;ce.onerror=qr(me),ce.onblocked=ct(c._fireOnBlocked),ce.onupgradeneeded=ct(function(Se){var Ee;fe=ce.transaction,d.autoSchema&&!c._options.allowEmptyDB?(ce.onerror=gi,fe.abort(),ce.result.close(),(Ee=g.deleteDatabase(ve)).onsuccess=Ee.onerror=ct(function(){me(new re.NoSuchDatabase("Database ".concat(ve," doesnt exist")))})):(fe.onerror=qr(me),Ee=Se.oldVersion>Math.pow(2,62)?0:Se.oldVersion,ie=Ee<1,c.idbdb=ce.result,E&&_m(c,fe),bm(c,Ee/10,fe,me))},me),ce.onsuccess=ct(function(){fe=null;var Se,Ee,we,Ie,Le,Ue,Ge=c.idbdb=ce.result,Be=z(Ge.objectStoreNames);if(0<Be.length)try{var Qe=Ge.transaction((Le=Be).length===1?Le[0]:Le,"readonly");if(d.autoSchema)Ue=Ge,Ie=Qe,(we=c).verno=Ue.version/10,Ie=we._dbSchema=Po(0,Ue,Ie),we._storeNames=z(Ue.objectStoreNames,0),Co(we,[we._allTables],i(Ie),Ie);else if(Mo(c,c._dbSchema,Qe),Ee=Qe,((Ee=vc(Po(0,(Se=c).idbdb,Ee),Se._dbSchema)).add.length||Ee.change.some(function(Xe){return Xe.add.length||Xe.change.length}))&&!E)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ge.close(),_=Ge.version+1,E=!0,he(V());To(c,Qe)}catch{}pn.push(c),Ge.onversionchange=ct(function(Xe){d.vcFired=!0,c.on("versionchange").fire(Xe)}),Ge.onclose=ct(function(){c.close({disableAutoOpen:!1})}),ie&&(Be=c._deps,Le=ve,gc(Ue=Be.indexedDB)||Le===Un||pc(Ue,Be.IDBKeyRange).put({name:Le}).catch(_e)),he()},me)}).catch(function(he){switch(he==null?void 0:he.name){case"UnknownError":if(0<d.PR1398_maxLoop)return d.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),V();break;case"VersionError":if(0<_)return _=0,V()}return Re.reject(he)})}var de,xe=d.dbReadyResolve,fe=null,ie=!1;return Re.race([y,(typeof navigator>"u"?Re.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(he){function me(){return indexedDB.databases().finally(he)}de=setInterval(me,100),me()}).finally(function(){return clearInterval(de)}):Promise.resolve()).then(V)]).then(function(){return R(),d.onReadyBeingFired=[],Re.resolve(mc(function(){return c.on.ready.fire(c.vip)})).then(function he(){var me;if(0<d.onReadyBeingFired.length)return me=d.onReadyBeingFired.reduce(Fe,_e),d.onReadyBeingFired=[],Re.resolve(mc(function(){return me(c.vip)})).then(he)})}).finally(function(){d.openCanceller===y&&(d.onReadyBeingFired=null,d.isBeingOpened=!1)}).catch(function(he){d.dbOpenError=he;try{fe&&fe.abort()}catch{}return y===d.openCanceller&&c._close(),Ve(he)}).finally(function(){d.openComplete=!0,xe()}).then(function(){var he;return ie&&(he={},c.tables.forEach(function(me){me.schema.indexes.forEach(function(ve){ve.name&&(he["idb://".concat(c.name,"/").concat(me.name,"/").concat(ve.name)]=new Ln(-1/0,[[[]]]))}),he["idb://".concat(c.name,"/").concat(me.name,"/")]=he["idb://".concat(c.name,"/").concat(me.name,"/:dels")]=new Ln(-1/0,[[[]]])}),Ea(mi).fire(he),xc(he,!0)),c})}function kc(c){function d(E){return c.next(E)}var g=_(d),y=_(function(E){return c.throw(E)});function _(E){return function(V){var V=E(V),de=V.value;return V.done?de:de&&typeof de.then=="function"?de.then(g,y):o(de)?Promise.all(de).then(g,y):g(de)}}return _(d)()}function Do(c,d,g){for(var y=o(c)?c.slice():[c],_=0;_<g;++_)y.push(d);return y}var km={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(c){return r(r({},c),{table:function(y){var g=c.table(y),y=g.schema,_={},E=[];function R(he,me,ve){var we=bi(he),ce=_[we]=_[we]||[],Se=he==null?0:typeof he=="string"?1:he.length,Ee=0<me,we=r(r({},ve),{name:Ee?"".concat(we,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Ee,keyTail:me,keyLength:Se,extractKey:dc(he),unique:!Ee&&ve.unique});return ce.push(we),we.isPrimaryKey||E.push(we),1<Se&&R(Se===2?he[0]:he.slice(0,Se-1),me+1,ve),ce.sort(function(Ie,Le){return Ie.keyTail-Le.keyTail}),we}var V=R(y.primaryKey.keyPath,0,y.primaryKey);_[":id"]=[V];for(var de=0,xe=y.indexes;de<xe.length;de++){var fe=xe[de];R(fe.keyPath,0,fe)}function ie(he){var me,ve=he.query.index;return ve.isVirtual?r(r({},he),{query:{index:ve.lowLevelIndex,range:(me=he.query.range,ve=ve.keyTail,{type:me.type===1?2:me.type,lower:Do(me.lower,me.lowerOpen?c.MAX_KEY:c.MIN_KEY,ve),lowerOpen:!0,upper:Do(me.upper,me.upperOpen?c.MIN_KEY:c.MAX_KEY,ve),upperOpen:!0})}}):he}return r(r({},g),{schema:r(r({},y),{primaryKey:V,indexes:E,getIndexByKeyPath:function(he){return(he=_[bi(he)])&&he[0]}}),count:function(he){return g.count(ie(he))},query:function(he){return g.query(ie(he))},openCursor:function(he){var me=he.query.index,ve=me.keyTail,ce=me.keyLength;return me.isVirtual?g.openCursor(ie(he)).then(function(Ee){return Ee&&Se(Ee)}):g.openCursor(he);function Se(Ee){return Object.create(Ee,{continue:{value:function(we){we!=null?Ee.continue(Do(we,he.reverse?c.MAX_KEY:c.MIN_KEY,ve)):he.unique?Ee.continue(Ee.key.slice(0,ce).concat(he.reverse?c.MIN_KEY:c.MAX_KEY,ve)):Ee.continue()}},continuePrimaryKey:{value:function(we,Ie){Ee.continuePrimaryKey(Do(we,c.MAX_KEY,ve),Ie)}},primaryKey:{get:function(){return Ee.primaryKey}},key:{get:function(){var we=Ee.key;return ce===1?we[0]:we.slice(0,ce)}},value:{get:function(){return Ee.value}}})}}})}})}};function Sc(c,d,g,y){return g=g||{},y=y||"",i(c).forEach(function(_){var E,R,V;p(d,_)?(E=c[_],R=d[_],typeof E=="object"&&typeof R=="object"&&E&&R?(V=O(E))!==O(R)?g[y+_]=d[_]:V==="Object"?Sc(E,R,g,y+_+"."):E!==R&&(g[y+_]=d[_]):E!==R&&(g[y+_]=d[_])):g[y+_]=void 0}),i(d).forEach(function(_){p(c,_)||(g[y+_]=d[_])}),g}function Ec(c,d){return d.type==="delete"?d.keys:d.keys||d.values.map(c.extractKey)}var Sm={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(c){return r(r({},c),{table:function(d){var g=c.table(d),y=g.schema.primaryKey;return r(r({},g),{mutate:function(_){var E=ze.trans,R=E.table(d).hook,V=R.deleting,de=R.creating,xe=R.updating;switch(_.type){case"add":if(de.fire===_e)break;return E._promise("readwrite",function(){return fe(_)},!0);case"put":if(de.fire===_e&&xe.fire===_e)break;return E._promise("readwrite",function(){return fe(_)},!0);case"delete":if(V.fire===_e)break;return E._promise("readwrite",function(){return fe(_)},!0);case"deleteRange":if(V.fire===_e)break;return E._promise("readwrite",function(){return(function ie(he,me,ve){return g.query({trans:he,values:!1,query:{index:y,range:me},limit:ve}).then(function(ce){var Se=ce.result;return fe({type:"delete",keys:Se,trans:he}).then(function(Ee){return 0<Ee.numFailures?Promise.reject(Ee.failures[0]):Se.length<ve?{failures:[],numFailures:0,lastResult:void 0}:ie(he,r(r({},me),{lower:Se[Se.length-1],lowerOpen:!0}),ve)})})})(_.trans,_.range,1e4)},!0)}return g.mutate(_);function fe(ie){var he,me,ve,ce=ze.trans,Se=ie.keys||Ec(y,ie);if(Se)return(ie=ie.type==="add"||ie.type==="put"?r(r({},ie),{keys:Se}):r({},ie)).type!=="delete"&&(ie.values=a([],ie.values)),ie.keys&&(ie.keys=a([],ie.keys)),he=g,ve=Se,((me=ie).type==="add"?Promise.resolve([]):he.getMany({trans:me.trans,keys:ve,cache:"immutable"})).then(function(Ee){var we=Se.map(function(Ie,Le){var Ue,Ge,Be,Qe=Ee[Le],Xe={onerror:null,onsuccess:null};return ie.type==="delete"?V.fire.call(Xe,Ie,Qe,ce):ie.type==="add"||Qe===void 0?(Ue=de.fire.call(Xe,Ie,ie.values[Le],ce),Ie==null&&Ue!=null&&(ie.keys[Le]=Ie=Ue,y.outbound||D(ie.values[Le],y.keyPath,Ie))):(Ue=Sc(Qe,ie.values[Le]),(Ge=xe.fire.call(Xe,Ue,Ie,Qe,ce))&&(Be=ie.values[Le],Object.keys(Ge).forEach(function(Ke){p(Be,Ke)?Be[Ke]=Ge[Ke]:D(Be,Ke,Ge[Ke])}))),Xe});return g.mutate(ie).then(function(Ie){for(var Le=Ie.failures,Ue=Ie.results,Ge=Ie.numFailures,Ie=Ie.lastResult,Be=0;Be<Se.length;++Be){var Qe=(Ue||Se)[Be],Xe=we[Be];Qe==null?Xe.onerror&&Xe.onerror(Le[Be]):Xe.onsuccess&&Xe.onsuccess(ie.type==="put"&&Ee[Be]?ie.values[Be]:Qe)}return{failures:Le,results:Ue,numFailures:Ge,lastResult:Ie}}).catch(function(Ie){return we.forEach(function(Le){return Le.onerror&&Le.onerror(Ie)}),Promise.reject(Ie)})});throw new Error("Keys missing")}}})}})}};function hf(c,d,g){try{if(!d||d.keys.length<c.length)return null;for(var y=[],_=0,E=0;_<d.keys.length&&E<c.length;++_)Lt(d.keys[_],c[E])===0&&(y.push(g?K(d.values[_]):d.values[_]),++E);return y.length===c.length?y:null}catch{return null}}var Em={stack:"dbcore",level:-1,create:function(c){return{table:function(d){var g=c.table(d);return r(r({},g),{getMany:function(y){var _;return y.cache?(_=hf(y.keys,y.trans._cache,y.cache==="clone"))?Re.resolve(_):g.getMany(y).then(function(E){return y.trans._cache={keys:y.keys,values:y.cache==="clone"?K(E):E},E}):g.getMany(y)},mutate:function(y){return y.type!=="add"&&(y.trans._cache=null),g.mutate(y)}})}}}};function pf(c,d){return c.trans.mode==="readonly"&&!!c.subscr&&!c.trans.explicit&&c.trans.db._options.cache!=="disabled"&&!d.schema.primaryKey.outbound}function gf(c,d){switch(c){case"query":return d.values&&!d.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Am={stack:"dbcore",level:0,name:"Observability",create:function(c){var d=c.schema.name,g=new Ln(c.MIN_KEY,c.MAX_KEY);return r(r({},c),{transaction:function(y,_,E){if(ze.subscr&&_!=="readonly")throw new re.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ze.querier));return c.transaction(y,_,E)},table:function(y){function _(Se){var ce,Se=Se.query;return[ce=Se.index,new Ln((ce=(Se=Se.range).lower)!=null?ce:c.MIN_KEY,(ce=Se.upper)!=null?ce:c.MAX_KEY)]}var E=c.table(y),R=E.schema,V=R.primaryKey,de=R.indexes,xe=V.extractKey,fe=V.outbound,ie=V.autoIncrement&&de.filter(function(ve){return ve.compound&&ve.keyPath.includes(V.keyPath)}),he=r(r({},E),{mutate:function(ve){function ce(et){return et="idb://".concat(d,"/").concat(y,"/").concat(et),Le[et]||(Le[et]=new Ln)}var Se,Ee,we,Ie=ve.trans,Le=ve.mutatedParts||(ve.mutatedParts={}),Ue=ce(""),Ge=ce(":dels"),Be=ve.type,Xe=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[Ec(V,ve).filter(function(et){return et}),ve.values]:[],Qe=Xe[0],Xe=Xe[1],Ke=ve.trans._cache;return o(Qe)?(Ue.addKeys(Qe),(Be=Be==="delete"||Qe.length===Xe.length?hf(Qe,Ke):null)||Ge.addKeys(Qe),(Be||Xe)&&(Se=ce,Ee=Be,we=Xe,R.indexes.forEach(function(et){var Bt=Se(et.name||"");function Gt(It){return It!=null?et.extractKey(It):null}function gt(It){et.multiEntry&&o(It)?It.forEach(function(fn){return Bt.addKey(fn)}):Bt.addKey(It)}(Ee||we).forEach(function(It,vn){var vr=Ee&&Gt(Ee[vn]),vn=we&&Gt(we[vn]);Lt(vr,vn)!==0&&(vr!=null&&gt(vr),vn!=null)&&gt(vn)})}))):Qe?(Xe={from:(Ke=Qe.lower)!=null?Ke:c.MIN_KEY,to:(Be=Qe.upper)!=null?Be:c.MAX_KEY},Ge.add(Xe),Ue.add(Xe)):(Ue.add(g),Ge.add(g),R.indexes.forEach(function(et){return ce(et.name).add(g)})),E.mutate(ve).then(function(et){return!Qe||ve.type!=="add"&&ve.type!=="put"||(Ue.addKeys(et.results),ie&&ie.forEach(function(Bt){for(var Gt=ve.values.map(function(vr){return Bt.extractKey(vr)}),gt=Bt.keyPath.findIndex(function(vr){return vr===V.keyPath}),It=0,fn=et.results.length;It<fn;++It)Gt[It][gt]=et.results[It];ce(Bt.name).addKeys(Gt)})),Ie.mutatedParts=No(Ie.mutatedParts||{},Le),et})}}),me={get:function(ve){return[V,new Ln(ve.key)]},getMany:function(ve){return[V,new Ln().addKeys(ve.keys)]},count:_,query:_,openCursor:_};return i(me).forEach(function(ve){he[ve]=function(ce){var Se=ze.subscr,Ee=!!Se,we=pf(ze,E)&&gf(ve,ce)?ce.obsSet={}:Se;if(Ee){var Ie,Se=function(Xe){return Xe="idb://".concat(d,"/").concat(y,"/").concat(Xe),we[Xe]||(we[Xe]=new Ln)},Le=Se(""),Ue=Se(":dels"),Ee=me[ve](ce),Ge=Ee[0],Ee=Ee[1];if((ve==="query"&&Ge.isPrimaryKey&&!ce.values?Ue:Se(Ge.name||"")).add(Ee),!Ge.isPrimaryKey){if(ve!=="count")return Ie=ve==="query"&&fe&&ce.values&&E.query(r(r({},ce),{values:!1})),E[ve].apply(this,arguments).then(function(Xe){if(ve==="query"){if(fe&&ce.values)return Ie.then(function(Gt){return Gt=Gt.result,Le.addKeys(Gt),Xe});var Ke=ce.values?Xe.result.map(xe):Xe.result;(ce.values?Le:Ue).addKeys(Ke)}else{var et,Bt;if(ve==="openCursor")return Bt=ce.values,(et=Xe)&&Object.create(et,{key:{get:function(){return Ue.addKey(et.primaryKey),et.key}},primaryKey:{get:function(){var Gt=et.primaryKey;return Ue.addKey(Gt),Gt}},value:{get:function(){return Bt&&Le.addKey(et.primaryKey),et.value}}})}return Xe});Ue.add(g)}}return E[ve].apply(this,arguments)}}),he}})}};function mf(c,d,g){var y;return g.numFailures===0?d:d.type==="deleteRange"||(y=d.keys?d.keys.length:"values"in d&&d.values?d.values.length:1,g.numFailures===y)?null:(y=r({},d),o(y.keys)&&(y.keys=y.keys.filter(function(_,E){return!(E in g.failures)})),"values"in y&&o(y.values)&&(y.values=y.values.filter(function(_,E){return!(E in g.failures)})),y)}function Ac(c,d){return g=c,((y=d).lower===void 0||(y.lowerOpen?0<Lt(g,y.lower):0<=Lt(g,y.lower)))&&(g=c,(y=d).upper===void 0||(y.upperOpen?Lt(g,y.upper)<0:Lt(g,y.upper)<=0));var g,y}function yf(c,d,g,y,_,E){var R,V,de,xe,fe,ie;return!g||g.length===0||(R=d.query.index,V=R.multiEntry,de=d.query.range,xe=y.schema.primaryKey.extractKey,fe=R.extractKey,ie=(R.lowLevelIndex||R).extractKey,(y=g.reduce(function(he,me){var ve=he,ce=[];if(me.type==="add"||me.type==="put")for(var Se=new Ln,Ee=me.values.length-1;0<=Ee;--Ee){var we,Ie=me.values[Ee],Le=xe(Ie);!Se.hasKey(Le)&&(we=fe(Ie),V&&o(we)?we.some(function(Xe){return Ac(Xe,de)}):Ac(we,de))&&(Se.addKey(Le),ce.push(Ie))}switch(me.type){case"add":var Ue=new Ln().addKeys(d.values?he.map(function(Ke){return xe(Ke)}):he),ve=he.concat(d.values?ce.filter(function(Ke){return Ke=xe(Ke),!Ue.hasKey(Ke)&&(Ue.addKey(Ke),!0)}):ce.map(function(Ke){return xe(Ke)}).filter(function(Ke){return!Ue.hasKey(Ke)&&(Ue.addKey(Ke),!0)}));break;case"put":var Ge=new Ln().addKeys(me.values.map(function(Ke){return xe(Ke)}));ve=he.filter(function(Ke){return!Ge.hasKey(d.values?xe(Ke):Ke)}).concat(d.values?ce:ce.map(function(Ke){return xe(Ke)}));break;case"delete":var Be=new Ln().addKeys(me.keys);ve=he.filter(function(Ke){return!Be.hasKey(d.values?xe(Ke):Ke)});break;case"deleteRange":var Qe=me.range;ve=he.filter(function(Ke){return!Ac(xe(Ke),Qe)})}return ve},c))===c)?c:(y.sort(function(he,me){return Lt(ie(he),ie(me))||Lt(xe(he),xe(me))}),d.limit&&d.limit<1/0&&(y.length>d.limit?y.length=d.limit:c.length===d.limit&&y.length<d.limit&&(_.dirty=!0)),E?Object.freeze(y):y)}function bf(c,d){return Lt(c.lower,d.lower)===0&&Lt(c.upper,d.upper)===0&&!!c.lowerOpen==!!d.lowerOpen&&!!c.upperOpen==!!d.upperOpen}function Tm(c,d){return((g,y,_,E)=>{if(g===void 0)return y!==void 0?-1:0;if(y===void 0)return 1;if((g=Lt(g,y))===0){if(_&&E)return 0;if(_)return 1;if(E)return-1}return g})(c.lower,d.lower,c.lowerOpen,d.lowerOpen)<=0&&0<=((g,y,_,E)=>{if(g===void 0)return y!==void 0?1:0;if(y===void 0)return-1;if((g=Lt(g,y))===0){if(_&&E)return 0;if(_)return-1;if(E)return 1}return g})(c.upper,d.upper,c.upperOpen,d.upperOpen)}function Cm(c,d,g,y){c.subscribers.add(g),y.addEventListener("abort",function(){var _,E;c.subscribers.delete(g),c.subscribers.size===0&&(_=c,E=d,setTimeout(function(){_.subscribers.size===0&&W(E,_)},3e3))})}var Im={stack:"dbcore",level:0,name:"Cache",create:function(c){var d=c.schema.name;return r(r({},c),{transaction:function(g,y,_){var E,R,V=c.transaction(g,y,_);return y==="readwrite"&&(_=(E=new AbortController).signal,V.addEventListener("abort",(R=function(de){return function(){if(E.abort(),y==="readwrite"){for(var xe=new Set,fe=0,ie=g;fe<ie.length;fe++){var he=ie[fe],me=Ga["idb://".concat(d,"/").concat(he)];if(me){var ve=c.table(he),ce=me.optimisticOps.filter(function(et){return et.trans===V});if(V._explicit&&de&&V.mutatedParts)for(var Se=0,Ee=Object.values(me.queries.query);Se<Ee.length;Se++)for(var we=0,Ie=(Ge=Ee[Se]).slice();we<Ie.length;we++)bc((Be=Ie[we]).obsSet,V.mutatedParts)&&(W(Ge,Be),Be.subscribers.forEach(function(et){return xe.add(et)}));else if(0<ce.length){me.optimisticOps=me.optimisticOps.filter(function(et){return et.trans!==V});for(var Le=0,Ue=Object.values(me.queries.query);Le<Ue.length;Le++)for(var Ge,Be,Qe,Xe=0,Ke=(Ge=Ue[Le]).slice();Xe<Ke.length;Xe++)(Be=Ke[Xe]).res!=null&&V.mutatedParts&&(de&&!Be.dirty?(Qe=Object.isFrozen(Be.res),Qe=yf(Be.res,Be.req,ce,ve,Be,Qe),Be.dirty?(W(Ge,Be),Be.subscribers.forEach(function(et){return xe.add(et)})):Qe!==Be.res&&(Be.res=Qe,Be.promise=Re.resolve({result:Qe}))):(Be.dirty&&W(Ge,Be),Be.subscribers.forEach(function(et){return xe.add(et)})))}}}xe.forEach(function(et){return et()})}}})(!1),{signal:_}),V.addEventListener("error",R(!1),{signal:_}),V.addEventListener("complete",R(!0),{signal:_})),V},table:function(g){var y=c.table(g),_=y.schema.primaryKey;return r(r({},y),{mutate:function(E){var R,V=ze.trans;return!_.outbound&&V.db._options.cache!=="disabled"&&!V.explicit&&V.idbtrans.mode==="readwrite"&&(R=Ga["idb://".concat(d,"/").concat(g)])?(V=y.mutate(E),E.type!=="add"&&E.type!=="put"||!(50<=E.values.length||Ec(_,E).some(function(de){return de==null}))?(R.optimisticOps.push(E),E.mutatedParts&&Ro(E.mutatedParts),V.then(function(de){0<de.numFailures&&(W(R.optimisticOps,E),(de=mf(0,E,de))&&R.optimisticOps.push(de),E.mutatedParts)&&Ro(E.mutatedParts)}),V.catch(function(){W(R.optimisticOps,E),E.mutatedParts&&Ro(E.mutatedParts)})):V.then(function(de){var xe=mf(0,r(r({},E),{values:E.values.map(function(fe,ie){var he;return de.failures[ie]?fe:(D(he=(he=_.keyPath)!=null&&he.includes(".")?K(fe):r({},fe),_.keyPath,de.results[ie]),he)})}),de);R.optimisticOps.push(xe),queueMicrotask(function(){return E.mutatedParts&&Ro(E.mutatedParts)})}),V):y.mutate(E)},query:function(E){var R,V,de,xe,fe,ie,he;return pf(ze,y)&&gf("query",E)?(R=((de=ze.trans)==null?void 0:de.db._options.cache)==="immutable",V=(de=ze).requery,de=de.signal,ie=((me,ve,ce,Se)=>{var Ee=Ga["idb://".concat(me,"/").concat(ve)];if(!Ee)return[];if(!(me=Ee.queries[ce]))return[null,!1,Ee,null];var we=me[(Se.query?Se.query.index.name:null)||""];if(!we)return[null,!1,Ee,null];switch(ce){case"query":var Ie=we.find(function(Le){return Le.req.limit===Se.limit&&Le.req.values===Se.values&&bf(Le.req.query.range,Se.query.range)});return Ie?[Ie,!0,Ee,we]:[we.find(function(Le){return("limit"in Le.req?Le.req.limit:1/0)>=Se.limit&&(!Se.values||Le.req.values)&&Tm(Le.req.query.range,Se.query.range)}),!1,Ee,we];case"count":return Ie=we.find(function(Le){return bf(Le.req.query.range,Se.query.range)}),[Ie,!!Ie,Ee,we]}})(d,g,"query",E),he=ie[0],xe=ie[2],fe=ie[3],he&&ie[1]?he.obsSet=E.obsSet:(ie=y.query(E).then(function(me){var ve=me.result;if(he&&(he.res=ve),R){for(var ce=0,Se=ve.length;ce<Se;++ce)Object.freeze(ve[ce]);Object.freeze(ve)}else me.result=K(ve);return me}).catch(function(me){return fe&&he&&W(fe,he),Promise.reject(me)}),he={obsSet:E.obsSet,promise:ie,subscribers:new Set,type:"query",req:E,dirty:!1},fe?fe.push(he):(fe=[he],(xe=xe||(Ga["idb://".concat(d,"/").concat(g)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[E.query.index.name||""]=fe)),Cm(he,fe,V,de),he.promise.then(function(me){return{result:yf(me.result,E,xe==null?void 0:xe.optimisticOps,y,he,R)}})):y.query(E)}})}})}};function Lo(c,d){return new Proxy(c,{get:function(g,y,_){return y==="db"?d:Reflect.get(g,y,_)}})}gn.prototype.version=function(c){if(isNaN(c)||c<.1)throw new re.Type("Given version is not a positive number");if(c=Math.round(10*c)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,c);var d=this._versions,g=d.filter(function(y){return y._cfg.version===c})[0];return g||(g=new this.Version(c),d.push(g),d.sort(ym),g.stores({}),this._state.autoSchema=!1),g},gn.prototype._whenReady=function(c){var d=this;return this.idbdb&&(this._state.openComplete||ze.letThrough||this._vip)?c():new Re(function(g,y){if(d._state.openComplete)return y(new re.DatabaseClosed(d._state.dbOpenError));if(!d._state.isBeingOpened){if(!d._state.autoOpen)return void y(new re.DatabaseClosed);d.open().catch(_e)}d._state.dbReadyPromise.then(g,y)}).then(c)},gn.prototype.use=function(_){var d=_.stack,g=_.create,y=_.level,_=_.name,E=(_&&this.unuse({stack:d,name:_}),this._middlewares[d]||(this._middlewares[d]=[]));return E.push({stack:d,create:g,level:y??10,name:_}),E.sort(function(R,V){return R.level-V.level}),this},gn.prototype.unuse=function(c){var d=c.stack,g=c.name,y=c.create;return d&&this._middlewares[d]&&(this._middlewares[d]=this._middlewares[d].filter(function(_){return y?_.create!==y:!!g&&_.name!==g})),this},gn.prototype.open=function(){var c=this;return at(lt,function(){return xm(c)})},gn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var c=this._state,d=pn.indexOf(this);if(0<=d&&pn.splice(d,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}c.isBeingOpened||(c.dbReadyPromise=new Re(function(g){c.dbReadyResolve=g}),c.openCanceller=new Re(function(g,y){c.cancelOpen=y}))},gn.prototype.close=function(d){var d=(d===void 0?{disableAutoOpen:!0}:d).disableAutoOpen,g=this._state;d?(g.isBeingOpened&&g.cancelOpen(new re.DatabaseClosed),this._close(),g.autoOpen=!1,g.dbOpenError=new re.DatabaseClosed):(this._close(),g.autoOpen=this._options.autoOpen||g.isBeingOpened,g.openComplete=!1,g.dbOpenError=null)},gn.prototype.delete=function(c){var d=this,g=(c===void 0&&(c={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),y=this._state;return new Re(function(_,E){function R(){d.close(c);var V=d._deps.indexedDB.deleteDatabase(d.name);V.onsuccess=ct(function(){var de,xe,fe;de=d._deps,xe=d.name,gc(fe=de.indexedDB)||xe===Un||pc(fe,de.IDBKeyRange).delete(xe).catch(_e),_()}),V.onerror=qr(E),V.onblocked=d._fireOnBlocked}if(g)throw new re.InvalidArgument("Invalid closeOptions argument to db.delete()");y.isBeingOpened?y.dbReadyPromise.then(R):R()})},gn.prototype.backendDB=function(){return this.idbdb},gn.prototype.isOpen=function(){return this.idbdb!==null},gn.prototype.hasBeenClosed=function(){var c=this._state.dbOpenError;return c&&c.name==="DatabaseClosed"},gn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},gn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(gn.prototype,"tables",{get:function(){var c=this;return i(this._allTables).map(function(d){return c._allTables[d]})},enumerable:!1,configurable:!0}),gn.prototype.transaction=function(){var c=(function(d,g,y){var _=arguments.length;if(_<2)throw new re.InvalidArgument("Too few arguments");for(var E=new Array(_-1);--_;)E[_-1]=arguments[_];return y=E.pop(),[d,ke(E),y]}).apply(this,arguments);return this._transaction.apply(this,c)},gn.prototype._transaction=function(c,d,g){var y,_,E=this,R=ze.trans,V=(R&&R.db===this&&c.indexOf("!")===-1||(R=null),c.indexOf("?")!==-1);c=c.replace("!","").replace("?","");try{if(_=d.map(function(xe){if(xe=xe instanceof E.Table?xe.name:xe,typeof xe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xe}),c=="r"||c===Br)y=Br;else{if(c!="rw"&&c!=Va)throw new re.InvalidArgument("Invalid transaction mode: "+c);y=Va}if(R){if(R.mode===Br&&y===Va){if(!V)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");R=null}R&&_.forEach(function(xe){if(R&&R.storeNames.indexOf(xe)===-1){if(!V)throw new re.SubTransaction("Table "+xe+" not included in parent transaction.");R=null}}),V&&R&&!R.active&&(R=null)}}catch(xe){return R?R._promise(null,function(fe,ie){ie(xe)}):Ve(xe)}var de=(function xe(fe,ie,he,me,ve){return Re.resolve().then(function(){var we=ze.transless||ze,ce=fe._createTransaction(ie,he,fe._dbSchema,me),we=(ce.explicit=!0,{trans:ce,transless:we});if(me)ce.idbtrans=me.idbtrans;else try{ce.create(),ce.idbtrans._explicit=!0,fe._state.PR1398_maxLoop=3}catch(Ie){return Ie.name===be.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,ie,he,null,ve)})):Ve(Ie)}var Se,Ee=ee(ve),we=(Ee&&hn(),Re.follow(function(){var Ie;(Se=ve.call(ce,ce))&&(Ee?(Ie=rr.bind(null,null),Se.then(Ie,Ie)):typeof Se.next=="function"&&typeof Se.throw=="function"&&(Se=kc(Se)))},we));return(Se&&typeof Se.then=="function"?Re.resolve(Se).then(function(Ie){return ce.active?Ie:Ve(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):we.then(function(){return Se})).then(function(Ie){return me&&ce._resolve(),ce._completion.then(function(){return Ie})}).catch(function(Ie){return ce._reject(Ie),Ve(Ie)})})}).bind(null,this,y,_,R,g);return R?R._promise(y,de,"lock"):ze.trans?at(ze.transless,function(){return E._whenReady(de)}):this._whenReady(de)},gn.prototype.table=function(c){if(p(this._allTables,c))return this._allTables[c];throw new re.InvalidTable("Table ".concat(c," does not exist"))};var aa=gn;function gn(c,d){var g,y,_,E,R,V=this,de=(this._middlewares={},this.verno=0,gn.dependencies),de=(this._options=d=r({addons:gn.addons,autoOpen:!0,indexedDB:de.indexedDB,IDBKeyRange:de.IDBKeyRange,cache:"cloned"},d),this._deps={indexedDB:d.indexedDB,IDBKeyRange:d.IDBKeyRange},d.addons),xe=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:_e,dbReadyPromise:null,cancelOpen:_e,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:d.autoOpen}),fe=(xe.dbReadyPromise=new Re(function(ie){xe.dbReadyResolve=ie}),xe.openCanceller=new Re(function(ie,he){xe.cancelOpen=he}),this._state=xe,this.name=c,this.on=hi(this,"populate","blocked","versionchange","close",{ready:[Fe,_e]}),this.once=function(ie,he){var me=function(){for(var ve=[],ce=0;ce<arguments.length;ce++)ve[ce]=arguments[ce];V.on(ie).unsubscribe(me),he.apply(V,ve)};return V.on(ie,me)},this.on.ready.subscribe=G(this.on.ready.subscribe,function(ie){return function(he,me){gn.vip(function(){var ve,ce=V._state;ce.openComplete?(ce.dbOpenError||Re.resolve().then(he),me&&ie(he)):ce.onReadyBeingFired?(ce.onReadyBeingFired.push(he),me&&ie(he)):(ie(he),ve=V,me||ie(function Se(){ve.on.ready.unsubscribe(he),ve.on.ready.unsubscribe(Se)}))})}}),this.Collection=(g=this,pi(dm.prototype,function(Se,ce){this.db=g;var me=fi,ve=null;if(ce)try{me=ce()}catch(we){ve=we}var ce=Se._ctx,Se=ce.table,Ee=Se.hook.reading.fire;this._ctx={table:Se,index:ce.index,isPrimKey:!ce.index||Se.schema.primKey.keyPath&&ce.index===Se.schema.primKey.name,range:me,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ve,or:ce.or,valueMapper:Ee!==Pe?Ee:null}})),this.Table=(y=this,pi($d.prototype,function(ie,he,me){this.db=y,this._tx=me,this.name=ie,this.schema=he,this.hook=y._allTables[ie]?y._allTables[ie].hook:hi(null,{creating:[vt,_e],reading:[He,Pe],updating:[je,_e],deleting:[ht,_e]})})),this.Transaction=(_=this,pi(hm.prototype,function(ie,he,me,ve,ce){var Se=this;ie!=="readonly"&&he.forEach(function(Ee){Ee=(Ee=me[Ee])==null?void 0:Ee.yProps,Ee&&(he=he.concat(Ee.map(function(we){return we.updatesTable})))}),this.db=_,this.mode=ie,this.storeNames=he,this.schema=me,this.chromeTransactionDurability=ve,this.idbtrans=null,this.on=hi(this,"complete","error","abort"),this.parent=ce||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Re(function(Ee,we){Se._resolve=Ee,Se._reject=we}),this._completion.then(function(){Se.active=!1,Se.on.complete.fire()},function(Ee){var we=Se.active;return Se.active=!1,Se.on.error.fire(Ee),Se.parent?Se.parent._reject(Ee):we&&Se.idbtrans&&Se.idbtrans.abort(),Ve(Ee)})})),this.Version=(E=this,pi(wm.prototype,function(ie){this.db=E,this._cfg={version:ie,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,pi(af.prototype,function(ie,he,me){if(this.db=R,this._ctx={table:ie,index:he===":id"?null:he,or:me},this._cmp=this._ascending=Lt,this._descending=function(ve,ce){return Lt(ce,ve)},this._max=function(ve,ce){return 0<Lt(ve,ce)?ve:ce},this._min=function(ve,ce){return Lt(ve,ce)<0?ve:ce},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new re.MissingAPI})),this.on("versionchange",function(ie){0<ie.newVersion?console.warn("Another connection wants to upgrade database '".concat(V.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(V.name,"'. Closing db now to resume the delete request.")),V.close({disableAutoOpen:!1})}),this.on("blocked",function(ie){!ie.newVersion||ie.newVersion<ie.oldVersion?console.warn("Dexie.delete('".concat(V.name,"') was blocked")):console.warn("Upgrade '".concat(V.name,"' blocked by other connection holding version ").concat(ie.oldVersion/10))}),this._maxKey=yi(d.IDBKeyRange),this._createTransaction=function(ie,he,me,ve){return new V.Transaction(ie,he,me,V._options.chromeTransactionDurability,ve)},this._fireOnBlocked=function(ie){V.on("blocked").fire(ie),pn.filter(function(he){return he.name===V.name&&he!==V&&!he._state.vcFired}).map(function(he){return he.on("versionchange").fire(ie)})},this.use(Em),this.use(Im),this.use(Am),this.use(km),this.use(Sm),new Proxy(this,{get:function(ie,he,me){var ve;return he==="_vip"||(he==="table"?function(ce){return Lo(V.table(ce),fe)}:(ve=Reflect.get(ie,he,me))instanceof $d?Lo(ve,fe):he==="tables"?ve.map(function(ce){return Lo(ce,fe)}):he==="_createTransaction"?function(){return Lo(ve.apply(this,arguments),fe)}:ve)}}));this.vip=fe,de.forEach(function(ie){return ie(V)})}var jo,Rs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Pm=(Tc.prototype.subscribe=function(c,d,g){return this._subscribe(c&&typeof c!="function"?c:{next:c,error:d,complete:g})},Tc.prototype[Rs]=function(){return this},Tc);function Tc(c){this._subscribe=c}try{jo={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{jo={indexedDB:null,IDBKeyRange:null}}function _f(c){var d,g=!1,y=new Pm(function(_){var E=ee(c),R,V=!1,de={},xe={},fe={get closed(){return V},unsubscribe:function(){V||(V=!0,R&&R.abort(),ie&&Ea.storagemutated.unsubscribe(me))}},ie=(_.start&&_.start(fe),!1),he=function(){return qe(ve)},me=function(ce){No(de,ce),bc(xe,de)&&he()},ve=function(){var ce,Se,Ee;!V&&jo.indexedDB&&(de={},ce={},R&&R.abort(),R=new AbortController,Ee=(we=>{var Ie=Xt();try{E&&hn();var Le=_n(c,we);return Le=E?Le.finally(rr):Le}finally{Ie&&ft()}})(Se={subscr:ce,signal:R.signal,requery:he,querier:c,trans:null}),Promise.resolve(Ee).then(function(we){g=!0,d=we,V||Se.signal.aborted||(de={},(Ie=>{for(var Le in Ie)if(p(Ie,Le))return;return 1})(xe=ce)||ie||(Ea(mi,me),ie=!0),qe(function(){return!V&&_.next&&_.next(we)}))},function(we){g=!1,["DatabaseClosedError","AbortError"].includes(we==null?void 0:we.name)||V||qe(function(){V||_.error&&_.error(we)})}))};return setTimeout(he,0),fe});return y.hasValue=function(){return g},y.getValue=function(){return d},y}var Wa=aa;function Cc(c){var d=Aa;try{Aa=!0,Ea.storagemutated.fire(c),xc(c,!0)}finally{Aa=d}}h(Wa,r(r({},ne),{delete:function(c){return new Wa(c,{addons:[]}).delete()},exists:function(c){return new Wa(c,{addons:[]}).open().then(function(d){return d.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(c){try{return d=Wa.dependencies,g=d.indexedDB,d=d.IDBKeyRange,(gc(g)?Promise.resolve(g.databases()).then(function(y){return y.map(function(_){return _.name}).filter(function(_){return _!==Un})}):pc(g,d).toCollection().primaryKeys()).then(c)}catch{return Ve(new re.MissingAPI)}var d,g},defineClass:function(){return function(c){u(this,c)}},ignoreTransaction:function(c){return ze.trans?at(ze.transless,c):c()},vip:mc,async:function(c){return function(){try{var d=kc(c.apply(this,arguments));return d&&typeof d.then=="function"?d:Re.resolve(d)}catch(g){return Ve(g)}}},spawn:function(c,d,g){try{var y=kc(c.apply(g,d||[]));return y&&typeof y.then=="function"?y:Re.resolve(y)}catch(_){return Ve(_)}},currentTransaction:{get:function(){return ze.trans||null}},waitFor:function(c,d){return c=Re.resolve(typeof c=="function"?Wa.ignoreTransaction(c):c).timeout(d||6e4),ze.trans?ze.trans.waitFor(c):c},Promise:Re,debug:{get:function(){return Ne},set:function(c){Je(c)}},derive:k,extend:u,props:h,override:G,Events:hi,on:Ea,liveQuery:_f,extendObservabilitySet:No,getByKeyPath:L,setByKeyPath:D,delByKeyPath:function(c,d){typeof d=="string"?D(c,d,void 0):"length"in d&&[].map.call(d,function(g){D(c,g,void 0)})},shallowClone:J,deepClone:K,getObjectDiff:Sc,cmp:Lt,asap:j,minKey:-1/0,addons:[],connections:pn,errnames:be,dependencies:jo,cache:Ga,semVer:"4.3.0",version:"4.3.0".split(".").map(function(c){return parseInt(c)}).reduce(function(c,d,g){return c+d/Math.pow(10,2*g)})})),Wa.maxKey=yi(Wa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ea(mi,function(c){Aa||(c=new CustomEvent(lc,{detail:c}),Aa=!0,dispatchEvent(c),Aa=!1)}),addEventListener(lc,function(c){c=c.detail,Aa||Cc(c)}));var Ds,Aa=!1,wf=function(){};return typeof BroadcastChannel<"u"&&((wf=function(){(Ds=new BroadcastChannel(lc)).onmessage=function(c){return c.data&&Cc(c.data)}})(),typeof Ds.unref=="function"&&Ds.unref(),Ea(mi,function(c){Aa||Ds.postMessage(c)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(c){if(!aa.disableBfCache&&c.persisted){Ne&&console.debug("Dexie: handling persisted pagehide"),Ds!=null&&Ds.close();for(var d=0,g=pn;d<g.length;d++)g[d].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(c){!aa.disableBfCache&&c.persisted&&(Ne&&console.debug("Dexie: handling persisted pageshow"),wf(),Cc({all:new Ln(-1/0,[[]])}))})),Re.rejectionMapper=function(c,d){return!c||c instanceof U||c instanceof TypeError||c instanceof SyntaxError||!c.name||!Te[c.name]?c:(d=new Te[c.name](d||c.message,c),"stack"in c&&x(d,"stack",{get:function(){return this.inner.stack}}),d)},Je(Ne),r(aa,Object.freeze({__proto__:null,Dexie:aa,Entity:Yd,PropModification:vi,RangeSet:Ln,add:function(c){return new vi({add:c})},cmp:Lt,default:aa,liveQuery:_f,mergeRanges:wi,rangesOverlap:uf,remove:function(c){return new vi({remove:c})},replacePrefix:function(c,d){return new vi({replacePrefix:[c,d]})}}),{default:aa}),aa})})(rl)),rl.exports}var Ab=Eb();const wu=kb(Ab),Bf=Symbol.for("Dexie"),jn=globalThis[Bf]||(globalThis[Bf]=wu);if(wu.semVer!==jn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${wu.semVer} and ${jn.semVer}`);const{liveQuery:l3,mergeRanges:c3,rangesOverlap:u3,RangeSet:d3,cmp:f3,Entity:v3,PropModification:h3,replacePrefix:p3,add:g3,remove:m3,DexieYProvider:y3}=jn,st=new jn("me-ai-store");st.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});st.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});st.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});st.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});st.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});st.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function dd(t,e){return`${t}:${e}`}const Tb=Object.freeze(Object.defineProperty({__proto__:null,db:st,makeItemId:dd},Symbol.toStringTag,{value:"Module"}));async function Vi(t,e=null){try{const n=await st.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Ui(t,e){try{await st.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function fd(t){try{await st.settings.delete(t)}catch{}}async function Cb(t){const e=await st.settings.bulkGet(t);return Object.fromEntries(t.map((n,r)=>{var a;return[n,((a=e[r])==null?void 0:a.value)??null]}))}const xa=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Vi,getSettings:Cb,removeSetting:fd,setSetting:Ui},Symbol.toStringTag,{value:"Module"})),Zr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function vd(t){return Zr.find(e=>e.id===t)}const Ib=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Zr,getModelInfo:vd},Symbol.toStringTag,{value:"Module"})),Qr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function fp(){return Qr.filter(t=>t.recommended)}function hd(t){return Qr.find(e=>e.name===t||e.name.startsWith(t+":"))}const Pb=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Qr,getOllamaModelInfo:hd,getRecommendedOllamaModels:fp},Symbol.toStringTag,{value:"Module"}));let Zn=null,fa="idle",al=null,Za=new Set;function Fo(){return Zn||(Zn=new Worker(new URL(""+new URL("worker-CB9TH5z_.js",import.meta.url).href,import.meta.url),{type:"module"}),Zn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(fa="loading"),e.status==="ready"&&(fa="ready"),e.status==="start"&&(fa="generating"),(e.status==="complete"||e.status==="error")&&(fa=al?"ready":"idle");for(const n of Za)try{n(e)}catch{}})),Zn}function Lc(){return{check(){Fo().postMessage({type:"check"})},loadModel(t){al=t,fa="loading",Fo().postMessage({type:"load",modelId:t})},generate(t,e){Fo().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,o=0,u=0;const f=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(s+=p.output,i=p.tps??i,o=p.numTokens??o,n)try{n({tps:i,numTokens:o,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:o,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Za.delete(f)};Za.add(f),Fo().postMessage({type:"generate",data:t,options:e})})},interrupt(){Zn==null||Zn.postMessage({type:"interrupt"})},reset(){Zn==null||Zn.postMessage({type:"reset"})},onMessage(t){return Za.add(t),()=>Za.delete(t)},offMessage(t){Za.delete(t)},get status(){return fa},get isReady(){return fa==="ready"},get isGenerating(){return fa==="generating"},get modelId(){return al},terminate(){Zn==null||Zn.terminate(),Zn=null,fa="idle",al=null,Za.clear()}}}const Mb="modulepreload",Ob=function(t,e){return new URL(t,e).href},qf={},nr=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(v){return Promise.all(v.map(p=>Promise.resolve(p).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=i(n.map(v=>{if(v=Ob(v,r),v in qf)return;qf[v]=!0;const p=v.endsWith(".css"),h=p?'[rel="stylesheet"]':"";if(!!r)for(let k=o.length-1;k>=0;k--){const T=o[k];if(T.href===v&&(!p||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${h}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":Mb,p||(x.as="script"),x.crossOrigin="",x.href=v,f&&x.setAttribute("nonce",f),document.head.appendChild(x),p)return new Promise((k,T)=>{x.addEventListener("load",k),x.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${v}`)))})}))}function s(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return a.then(i=>{for(const o of i||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},Ff="http://localhost:11434",Nb="https://me-ai.metaelon.space";function vp(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?Ff:Nb}catch{return Ff}}function go(){return vp()}async function Rb(){const{getSetting:t}=await nr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>xa);return{getSetting:e}},void 0,import.meta.url);return await t("ollamaUrl")||vp()}async function Db(t){const{setSetting:e}=await nr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>xa);return{setSetting:n}},void 0,import.meta.url);await e("ollamaUrl",t)}async function xu(t=go()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function Lb(t=go()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function jb(t,e,{temperature:n=.7,maxTokens:r=4096,keepAlive:a}={},s=()=>{},i=go()){var x;const o={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:r}};a!==void 0?o.keep_alive=a:o.keep_alive="10m";const u=new AbortController,f=setTimeout(()=>u.abort(),3e5),v=await fetch(`${i}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:u.signal});if(clearTimeout(f),!v.ok){const k=await v.text();throw new Error(`Ollama API error: ${k}`)}const p=v.body.getReader(),h=new TextDecoder;let m="";try{for(;;){const{done:k,value:T}=await p.read();if(k)break;const z=h.decode(T).split(`
`).filter(Boolean);for(const G of z)try{const S=JSON.parse(G);if((x=S.message)!=null&&x.content&&(m+=S.message.content,s({content:S.message.content,done:!1,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration})),S.done){s({content:"",done:!0,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration});break}}catch{}}}finally{p.releaseLock()}return m}let sr="idle",Ls=null,Qa=new Set;function kr(t){for(const e of Qa)try{e(t)}catch{}}function zb(){return{async check(){sr="loading",kr({status:"loading",data:"Testing Ollama connection..."});const t=await xu();t.connected?(sr="idle",kr({status:"ready",data:{type:"ollama",version:t.version,url:go()}})):(sr="idle",kr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ls=t,sr="loading",kr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await xu();if(!e.connected){sr="idle",Ls=null,kr({status:"error",data:`Ollama not available: ${e.error}`});return}sr="ready",kr({status:"ready"})},async generate(t,e={}){if(!Ls){kr({status:"error",data:"No Ollama model selected"});return}sr="generating",kr({status:"start",inputTokens:0});let n=0,r=performance.now();try{await jb(Ls,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},a=>{if(a.content){n++;const s=performance.now()-r,i=s>0?n/s*1e3:0;kr({status:"update",output:a.content,tps:Math.round(i*10)/10,numTokens:n})}a.done&&(sr="ready",kr({status:"complete",tps:a.eval_duration?Math.round(a.eval_count/(a.eval_duration/1e9)*10)/10:null,numTokens:a.eval_count||n}))})}catch(a){sr="ready",kr({status:"error",data:a.message})}},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,o=0,u=0;const f=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"update":if(s+=p.output,i=p.tps??i,o=p.numTokens??o,n)try{n({tps:i,numTokens:o,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:o,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Qa.delete(f)};Qa.add(f),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return Qa.add(t),()=>Qa.delete(t)},offMessage(t){Qa.delete(t)},get status(){return sr},get isReady(){return sr==="ready"},get isGenerating(){return sr==="generating"},get modelId(){return Ls},get backend(){return"ollama"},terminate(){sr="idle",Ls=null,Qa.clear()}}}let Xa=null,Tt=null,jc=new Set;function Bb(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function hp(){return{loadModel(t){const e=Bb(t);if(Xa!==e){Tt&&Tt.terminate(),Xa=e,Tt=e==="webgpu"?Lc():zb();for(const n of jc)Tt.onMessage(n)}Tt.loadModel(t)},check(){Tt||(Tt=Lc(),Xa="webgpu"),Tt.check()},generate(t,e){if(!Tt)throw new Error("No engine loaded. Call loadModel() first.");return Tt.generate(t,e)},generateFull(t,e,n){return Tt?Tt.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Tt==null||Tt.interrupt()},reset(){Tt==null||Tt.reset()},onMessage(t){return Tt||(Tt=Lc(),Xa="webgpu"),jc.add(t),Tt.onMessage(t)},offMessage(t){jc.delete(t),Tt==null||Tt.offMessage(t)},get status(){return(Tt==null?void 0:Tt.status)||"idle"},get isReady(){return(Tt==null?void 0:Tt.isReady)||!1},get isGenerating(){return(Tt==null?void 0:Tt.isGenerating)||!1},get modelId(){return(Tt==null?void 0:Tt.modelId)||null},get backend(){return Xa},getModelInfo(){const t=this.modelId;return t?Xa==="webgpu"?vd(t):hd(t):null},terminate(){Tt==null||Tt.terminate(),Tt=null,Xa=null}}}function ku(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,r)).toFixed(1)+" "+n[r]}function zc(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e)),a=t/Math.pow(e,r),s=r>=2?2:r>=1?1:0;return a.toFixed(s)+" "+n[r]}function qb(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Fb(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Hl(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const Kb="https://gmail.googleapis.com/gmail/v1/users/me";class pd extends Error{constructor(e,n,r){super(e),this.name="GmailApiError",this.status=n,this.code=r||null}}function Hb(t){return{Authorization:`Bearer ${t}`}}async function Vl(t,e){var r,a,s,i;const n=await fetch(`${Kb}${e}`,{headers:Hb(t)});if(!n.ok){const o=await n.json().catch(()=>({})),u=((r=o.error)==null?void 0:r.message)||`Gmail API error: ${n.status}`,f=((i=(s=(a=o.error)==null?void 0:a.errors)==null?void 0:s[0])==null?void 0:i.reason)||void 0;throw new pd(u,n.status,f)}return n.json()}function pp(t){return Vl(t,"/profile")}function gp(t,{maxResults:e=20,pageToken:n,q:r}={}){const a=new URLSearchParams;return a.set("maxResults",String(e)),n&&a.set("pageToken",n),r&&a.set("q",r),Vl(t,`/messages?${a}`)}function mp(t,e,n="full"){return Vl(t,`/messages/${e}?format=${n}`)}function Vb(t,{startHistoryId:e,pageToken:n,maxResults:r=500}={}){const a=new URLSearchParams;return a.set("startHistoryId",e),a.set("maxResults",String(r)),a.append("historyTypes","messageAdded"),a.append("historyTypes","messageDeleted"),n&&a.set("pageToken",n),Vl(t,`/history?${a}`)}function Ca(t,e){var s;const n=((s=t==null?void 0:t.payload)==null?void 0:s.headers)||[],r=e.toLowerCase(),a=n.find(i=>i.name.toLowerCase()===r);return(a==null?void 0:a.value)||""}function qi(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const r=atob(e),a=Uint8Array.from(r,s=>s.charCodeAt(0));return new TextDecoder().decode(a)}function Ub(t){var s,i,o;const e=t==null?void 0:t.payload;if(!e)return"";if((s=e.body)!=null&&s.data)return qi(e.body.data);const n=e.parts||[],r=hl(n,"text/plain");if((i=r==null?void 0:r.body)!=null&&i.data)return qi(r.body.data);const a=hl(n,"text/html");if((o=a==null?void 0:a.body)!=null&&o.data){const u=qi(a.body.data);return Wb(u)}return"(no body)"}function Gb(t){var a,s;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((a=e.body)!=null&&a.data))return qi(e.body.data);const n=e.parts||[],r=hl(n,"text/html");return(s=r==null?void 0:r.body)!=null&&s.data?qi(r.body.data):null}function hl(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const r=hl(n.parts,e);if(r)return r}}return null}function Wb(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function gd(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function yp(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function bp(t){return yp(t).charAt(0).toUpperCase()}function Yb(t){try{const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}catch{return"email"}}function Xb(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function _p(t,e){return`${Yb(t.date)}_${Xb(t.subject)}.${e}`}function wp(t){const e={};for(const r of t){const a=r.action||"UNKNOWN";e[a]||(e[a]=[]),e[a].push(r)}for(const r of Object.keys(e))e[r].sort((a,s)=>(s.date||0)-(a.date||0));const n=Object.keys(e).sort((r,a)=>e[a].length-e[r].length);return{groups:e,order:n}}async function Zb(){const t=await st.items.where("sourceType").equals("gmail").count(),e=await st.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:r,newest:a}=await xp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`Date range: ${s} to ${i}.`)}return n.join(" ")}async function Qb(){const t=await st.items.where("sourceType").equals("gmail").count(),e=await st.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:r,newest:a}=await xp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`- **Date range:** ${s} â ${i}`)}return n.join(`
`)}async function Jb(t=10){const e=await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(kp).join(`

---

`)}async function $b(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),a=(await st.items.where("sourceType").equals("gmail").toArray()).map(s=>{var o,u,f,v,p;let i=0;return(o=s.subject)!=null&&o.toLowerCase().includes(n)&&(i+=3),(u=s.from)!=null&&u.toLowerCase().includes(n)&&(i+=2),(f=s.to)!=null&&f.toLowerCase().includes(n)&&(i+=2),(v=s.snippet)!=null&&v.toLowerCase().includes(n)&&(i+=1),(p=s.body)!=null&&p.toLowerCase().includes(n)&&(i+=1),{item:s,score:i}}).filter(({score:s})=>s>0).sort((s,i)=>i.score-s.score).slice(0,e);return a.length===0?`No results found for "${t}".`:a.map(({item:s})=>kp(s)).join(`

---

`)}async function Kf(){const t=await st.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=wp(t);return{groups:e,order:n,total:t.length}}async function e_({query:t,limit:e=50,offset:n=0}={}){if(t){const s=t.toLowerCase(),i=await st.items.where("sourceType").equals("gmail").filter(o=>{var u,f,v,p;return((u=o.subject)==null?void 0:u.toLowerCase().includes(s))||((f=o.from)==null?void 0:f.toLowerCase().includes(s))||((v=o.to)==null?void 0:v.toLowerCase().includes(s))||((p=o.snippet)==null?void 0:p.toLowerCase().includes(s))}).toArray();return i.sort((o,u)=>(u.date||0)-(o.date||0)),{items:i.slice(n,n+e),total:i.length}}const r=await st.items.where("sourceType").equals("gmail").count();return{items:await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).reverse().offset(n).limit(e).toArray(),total:r}}async function xp(){const t=await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).first(),e=await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).last();return{oldest:t,newest:e}}function kp(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=Fb(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function t_(){const t=await Zb();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function n_(t){const e=[],n=await Qb();if(e.push(n),t){const r=await $b(t,5);e.push("","## Relevant Emails",r)}else{const r=await Jb(5);e.push("","## Recent Emails",r)}return e.join(`
`)}const Lr={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},md="INFO",Sp="me-ai-events",Ep="me-ai-event-groups";async function ui(){const{getSetting:t}=await nr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>xa);return{getSetting:e}},void 0,import.meta.url);return await t(Sp)||{}}async function Ul(t){const{setSetting:e}=await nr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>xa);return{setSetting:n}},void 0,import.meta.url);await e(Sp,t)}async function Gl(){const{getSetting:t}=await nr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>xa);return{getSetting:e}},void 0,import.meta.url);return await t(Ep)||{}}async function Ap(t){const{setSetting:e}=await nr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>xa);return{setSetting:n}},void 0,import.meta.url);await e(Ep,t)}async function r_(){try{const{db:t}=await nr(async()=>{const{db:r}=await Promise.resolve().then(()=>Tb);return{db:r}},void 0,import.meta.url),e=await t.emailClassifications.toArray();return[...new Set(e.map(r=>r.action).filter(Boolean))].sort()}catch{return[]}}async function a_(){const t=await ui(),e=await r_();return[...new Set([...Object.keys(t),...e])].sort()}async function pl(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await Gl())[e]||md}async function s_(t,e){const n=t.toUpperCase();if(!Lr[e])throw new Error(`Unknown group: ${e}`);const r=await Gl();r[n]=e,await Ap(r)}async function i_(){return Gl()}async function Tp(t){const e=await pl(t),n=Lr[e]||Lr[md];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function ea(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await ui())[e]||[]}const Bc=ea;async function o_(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await ui();e in n||(n[e]=[],await Ul(n))}async function l_(t,e,n){const r=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!r)return;const a=await ui(),s=await Gl();if(!(r in s)){const i=Lr[e]?e:md;s[r]=i,await Ap(s)}if(!(r in a)){const{pluginRegistry:i}=await nr(async()=>{const{pluginRegistry:v}=await Promise.resolve().then(()=>k_);return{pluginRegistry:v}},void 0,import.meta.url),o=i.getAvailableActions("gmail"),u=Object.fromEntries(o.map(v=>[v.actionId,v])),f=(n||[]).filter(v=>u[v]).map(v=>({id:v,pluginId:"gmail",commandId:v,name:u[v].name,description:u[v].description}));a[r]=f,await Ul(a)}}async function c_(t){const e=t.toUpperCase(),n=await ui();delete n[e],await Ul(n)}async function yd(t,e){const n=t.toUpperCase(),r=await ui();r[n]=e,await Ul(r)}async function u_(t,e){const n=await ea(t);await yd(t,[...n,e])}const Hf=u_;async function d_(t,e){const n=await ea(t);await yd(t,n.filter(r=>r.id!==e))}const f_=d_;async function v_(t,e,n){const r=await ea(t);await yd(t,r.map(a=>a.id===e?{...a,...n}:a))}const h_=v_;async function p_(t,e){var a;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((a=e.body)==null?void 0:a.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},r=await ea(t.action);return{event:n,commands:r}}async function g_(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:r,commands:a}=await p_(n.classification,n.email);return{event:r,commands:a}})),content:""}}async function m_(t){const e=await Promise.all(t.order.map(async r=>{const a=t.groups[r]||[],s=await ea(r),i=await pl(r),o=a.map(u=>({emailId:u.emailId,subject:u.subject||"(no subject)",from:u.from||"",date:u.date,summary:u.summary||"",reason:u.reason||"",tags:u.tags||[],status:u.status||"pending"}));return{eventType:r,group:i,emails:o,commands:s}})),n=e.reduce((r,a)=>r+a.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class y_{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var a,s,i;const r=this.handlers.get(e);if(!r)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(a=n.onProgress)==null||a.call(n,{phase:"executing",actionId:e,actionName:r.name});const o=await r.execute(n);return(s=n.onProgress)==null||s.call(n,{phase:"completed",actionId:e,actionName:r.name,result:o}),o}catch(o){const u={success:!1,error:o,message:o.message||"Unknown error"};return(i=n.onProgress)==null||i.call(n,{phase:"failed",actionId:e,actionName:r.name,error:o.message}),u}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const b_="https://gmail.googleapis.com/gmail/v1/users/me",sa={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Gn(t,e,n,r=null){var i;const a={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};r&&(a.body=JSON.stringify(r));const s=await fetch(`${b_}${n}`,a);if(!s.ok){const u=((i=(await s.json().catch(()=>({}))).error)==null?void 0:i.message)||`Gmail API error: ${s.status}`;throw new Error(u)}return s.status===204?{success:!0}:s.json()}class __ extends y_{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}extractMessageId(e){const n=e.event.data.emailId||e.event.data.id;return n?n.startsWith("gmail:")?n.substring(6):n:null}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[sa.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[sa.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[sa.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[sa.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[sa.SPAM],removeLabelIds:[sa.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[sa.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[r]}),{success:!0,message:`Applied label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[r]}),{success:!0,message:`Removed label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[sa.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Gn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[sa.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,r=[],a=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Gn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:r,removeLabelIds:a}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Gn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const w_=new __;let x_=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(w_)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const r=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,a=r.pluginId||this.resolvePluginId(n.event.source),s=r.commandId||r.id,i=this.getPlugin(a);return i?i.canExecute(s)?i.execute(s,n):{success:!1,message:`Command "${s}" not found in plugin "${i.serviceName}". Available: ${i.getHandlers().map(o=>o.actionId).join(", ")}`,error:new Error(`Command not supported: ${s}`)}:{success:!1,message:`Plugin "${a}" not found. Is it registered?`,error:new Error(`Plugin not found: ${a}`)}}async executePipeline(e,n){var u,f;const r=[];let a=!0;for(const v of e){(u=n.onProgress)==null||u.call(n,{phase:"action_start",actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId});const p=await this.executeAction(v,n);r.push({actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId,...p}),p.success||(a=!1),(f=n.onProgress)==null||f.call(n,{phase:"action_complete",actionId:v.id,actionName:v.name,result:p})}const i=r.filter(v=>!v.success).map(v=>{var p;return`${v.pluginId}Â·${v.commandId}: ${v.message||((p=v.error)==null?void 0:p.message)||"Unknown error"}`}).join("; "),o=r.filter(v=>v.success).map(v=>`${v.pluginId}Â·${v.commandId}`).join(", ");return{success:a,results:r,message:a?`Successfully executed: ${o}`:`Pipeline failed: ${i}`}}async executePipelineBatch(e,n,r){var o,u;const a=[];for(let f=0;f<n.length;f++){const v=n[f];(o=r.onProgress)==null||o.call(r,{phase:"batch_event_start",eventIndex:f,totalEvents:n.length,event:v});const p={...r,event:v},h=await this.executePipeline(e,p);a.push({event:v,...h}),(u=r.onProgress)==null||u.call(r,{phase:"batch_event_complete",eventIndex:f,totalEvents:n.length,event:v,result:h})}const s=a.filter(f=>f.success).length,i=a.filter(f=>!f.success).length;return{success:i===0,results:a,total:n.length,successful:s,failed:i,message:`Processed ${n.length} event(s): ${s} successful, ${i} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),r=this.getPlugin(n);return r?r.getHandlers():[]}getRequiredScopes(e,n){const r=this.resolvePluginId(n),a=this.getPlugin(r);return a?a.getRequiredScopes(e):[]}};const di=new x_,k_=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:di},Symbol.toStringTag,{value:"Module"})),S_=20,E_={maxTokens:512};function Cp(t){const e=[],n=[];for(const s of t)if(s.actions.length){e.push(`${s.pluginName} plugin:`);for(const i of s.actions)e.push(`  ${i.actionId.padEnd(22)} â ${i.name}: ${i.description}`),n.push(i.actionId)}const r=e.length?e.join(`
`):"  (no actions available)",a=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${r}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${a})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function Ip(){return di.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const Pp=Cp(Ip());async function Mp(t,{count:e=S_,force:n=!1,onProgress:r=()=>{},signal:a}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");r({phase:"loading",message:"Loading recent emails..."});let s,i=0;if(n)s=await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).reverse().limit(e).toArray();else{const L=new Set(await st.emailClassifications.toCollection().primaryKeys());i=0,s=[],await st.items.where("[sourceType+date]").between(["gmail",jn.minKey],["gmail",jn.maxKey]).reverse().until(()=>s.length>=e).each(D=>{L.has(D.id)?i++:s.push(D)})}if(s.length===0){const L=n?"No emails to scan.":`All emails already classified (${i} total). Use "Rescan All" to reclassify.`;return r({phase:"done",message:L,classified:0}),{scanned:0,classified:0,skipped:i,errors:0}}const o=Date.now(),u=performance.now();let f=0,v=0,p=0,h=0;const m=[],x=Ip(),k=Cp(x),T=new Set(x.flatMap(L=>L.actions.map(D=>D.actionId))),N=t.modelId,z=vd(N)||hd(N);if(!z)throw new Error(`Unknown model: ${N}`);if(!z.recommendedForEmailProcessing&&s.length>0){const{MODELS:L}=await nr(async()=>{const{MODELS:ke}=await Promise.resolve().then(()=>Ib);return{MODELS:ke}},void 0,import.meta.url),{OLLAMA_MODELS:D}=await nr(async()=>{const{OLLAMA_MODELS:ke}=await Promise.resolve().then(()=>Pb);return{OLLAMA_MODELS:ke}},void 0,import.meta.url),J=[...L.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.name),...D.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.displayName)],ae=z.displayName||z.name;console.warn(`â ï¸ Current model (${ae}) is not optimized for email processing. For best results with long emails, use: ${J.join(", ")}. Some emails may fail due to memory limits.`)}for(let L=0;L<s.length&&!(a!=null&&a.aborted);L++){const D=s[L],J=Rp(D),ae=[{role:"system",content:k},{role:"user",content:J}];r({phase:"scanning",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:D.subject,from:D.from,date:D.date},prompt:{system:Pp,user:J},systemPromptLength:k.length,live:null,lastResult:null,totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}});const ke=performance.now();try{const{text:X,tps:A,numTokens:K,inputTokens:P}=await t.generateFull(ae,{maxTokens:512,enableThinking:!1,temperature:0},Q=>{r({phase:"generating",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:D.subject,from:D.from,date:D.date},live:{tps:Q.tps,numTokens:Q.numTokens},streamingText:Q.text||"",totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})});p+=K,h+=P;const O=T_(X,T),I=performance.now()-ke;if(O){await st.emailClassifications.put({emailId:D.id,action:O.action,group:O.group,reason:O.reason,summary:O.summary,tags:O.tags,subject:D.subject||"(no subject)",from:D.from||"",date:D.date,scannedAt:o,status:"pending"}),await l_(O.action,O.group,O.suggestedActions),f++;const Q={success:!0,email:{subject:D.subject,from:D.from,date:D.date},classification:O,rawResponse:X,stats:{tps:A,numTokens:K,inputTokens:P,elapsed:I},promptSize:J.length};m.push(Q),r({phase:"classified",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:D.subject,from:D.from,date:D.date},result:O,rawResponse:X,emailStats:{tps:A,numTokens:K,inputTokens:P,elapsed:I},totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})}}catch(X){console.error(`Triage email ${L+1} failed:`,X),v++;const A=X.message||String(X),K=A.length>200?A.slice(0,200)+"...":A;m.push({success:!1,email:{subject:D.subject,from:D.from,date:D.date},error:K,promptSize:J.length})}}const G=performance.now()-u,S=m.length>0?Math.round(m.reduce((L,D)=>L+D.promptSize,0)/m.length):0,j=m.filter(L=>{var D;return L.success&&((D=L.stats)==null?void 0:D.tps)}).length>0?Math.round(m.filter(L=>L.success).reduce((L,D)=>{var J;return L+(((J=D.stats)==null?void 0:J.tps)||0)},0)/m.filter(L=>{var D;return L.success&&((D=L.stats)==null?void 0:D.tps)}).length):null;return r({phase:"done",current:s.length,total:s.length,classified:f,errors:v,results:m,summary:{avgPromptSize:S,avgTps:j,systemPromptSize:k.length,processed:s.length,skipped:i,modelName:z.displayName||z.name,modelContextWindow:z.contextWindow,modelMaxEmailTokens:z.maxEmailTokens},totals:{outputTokens:p,inputTokens:h,elapsed:G}}),{scanned:s.length,classified:f,skipped:i,errors:v}}async function Op(){const t=await st.emailClassifications.toArray();return wp(t)}async function A_(){const t=await st.emailClassifications.toArray(),e={total:t.length};for(const n of t){const r=n.action||"UNKNOWN";e[r]=(e[r]||0)+1}return e}async function gl(t,e){await st.emailClassifications.update(t,{status:e})}async function Vf(){await st.emailClassifications.clear()}async function bd(t){await st.emailClassifications.where("action").equals(t).delete()}async function Np(t){await st.emailClassifications.delete(t)}async function Su(){const t=await st.items.where("sourceType").equals("gmail").count(),e=await st.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Rp(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function T_(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const r=n.indexOf("{"),a=n.lastIndexOf("}");if(r===-1||a===-1||a<=r)return console.warn("Triage: no JSON object found in response"),null;const s=n.indexOf("[");if(s!==-1&&s<r)return console.warn("Triage: expected JSON object, got array"),null;const i=n.slice(r,a+1);try{const o=JSON.parse(i);if(!o||typeof o!="object"||Array.isArray(o))return null;const u=C_(o.action);if(!u)return console.warn("Triage: missing or invalid action field"),null;const v=["NOISE","INFO","CRITICAL"].includes(o.group)?o.group:"INFO";let p=[];Array.isArray(o.suggestedActions)&&(p=o.suggestedActions.filter(m=>typeof m!="string"||!m.trim()?!1:e?e.has(m.trim()):!0).map(m=>m.trim()).slice(0,5)),p.length===0&&Array.isArray(o.suggestedActions)&&o.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",o.suggestedActions);let h=[];return Array.isArray(o.tags)&&(h=o.tags.filter(m=>typeof m=="string"&&m.trim()).map(m=>m.trim().toLowerCase()).slice(0,10)),{action:u,group:v,suggestedActions:p,reason:String(o.reason||"").slice(0,300),summary:String(o.summary||"").slice(0,500),tags:h}}catch(o){return console.warn("Triage: failed to parse JSON response:",o.message),null}}function C_(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Eu(t){return`hsl(${Hl(t)}, 55%, 55%)`}function I_(t){return`hsl(${Hl(t)}, 40%, 35%)`}var P_=q('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),M_=q('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function O_(t,e){tt(e,!0);let n=Ae(e,"backend",15,"webgpu"),r=Ae(e,"isWebGPUAvailable",3,!0);var a=M_(),s=w(b(a),2),i=b(s);let o;var u=w(i,2);let f;var v=w(s,2);{var p=h=>{var m=P_();C(h,m)};pe(v,h=>{!r()&&n()==="webgpu"&&h(p)})}se(()=>{o=Pt(i,1,"backend-btn svelte-1n2kfl0",null,o,{active:n()==="webgpu"}),i.disabled=!r(),f=Pt(u,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="ollama"})}),Ce("click",i,()=>n("webgpu")),Ce("click",u,()=>n("ollama")),C(t,a),nt()}$t(["click"]);const N_=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Uf(...t){N_&&console.log("[debug]",...t)}function fr(t){return Uf(`[MOUNT] ${t}`),()=>Uf(`[DESTROY] ${t}`)}var R_=q("<option> </option>"),D_=q('<p class="model-description svelte-1p89qnn"> </p>'),L_=q('<span class="current-badge svelte-1p89qnn">Current</span>'),j_=q('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),z_=q('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),B_=q('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),q_=q('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),F_=q('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),K_=q('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),H_=q('<p class="error svelte-1p89qnn"> </p>'),V_=q('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function U_(t,e){tt(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"gpuInfo",3,null),a=Ae(e,"error",3,null);Tn(()=>fr("ModelSelector"));var s=V_(),i=b(s),o=w(b(i),2),u=w(b(o),2);Ct(u,21,()=>Zr,Wt,(S,j)=>{var L=R_(),D=b(L),J={};se(()=>{te(D,`${l(j).name??""} â ${l(j).size??""}`),J!==(J=l(j).id)&&(L.value=(L.__value=l(j).id)??"")}),C(S,L)});var f=w(u,2);{var v=S=>{const j=$(()=>Zr.find(ae=>ae.id===n()));var L=cn(),D=Ye(L);{var J=ae=>{var ke=D_(),X=b(ke);se(()=>te(X,l(j).description)),C(ae,ke)};pe(D,ae=>{l(j)&&ae(J)})}C(S,L)};pe(f,S=>{n()&&S(v)})}var p=w(o,2),h=w(b(p),2),m=b(h),x=w(b(m));Ct(x,21,()=>Zr,Wt,(S,j)=>{var L=q_();let D;var J=b(L),ae=b(J),ke=w(ae);{var X=ne=>{var H=L_();C(ne,H)};pe(ke,ne=>{l(j).id===n()&&ne(X)})}var A=w(J),K=b(A),P=b(K),O=w(A),I=b(O),Q=w(O),W=b(Q);{var Z=ne=>{var H=j_();C(ne,H)},B=ne=>{var H=z_();C(ne,H)},ee=ne=>{var H=B_();C(ne,H)};pe(W,ne=>{l(j).recommendedForEmailProcessing?ne(Z):l(j).maxEmailTokens>=6e3?ne(B,1):ne(ee,!1)})}se((ne,H)=>{D=Pt(L,1,"svelte-1p89qnn",null,D,{selected:l(j).id===n()}),te(ae,`${l(j).name??""} `),te(P,`${ne??""}k`),te(I,`~${H??""}k`)},[()=>(l(j).contextWindow/1024).toFixed(0),()=>(l(j).maxEmailTokens/1e3).toFixed(0)]),C(S,L)});var k=w(p,2);{var T=S=>{var j=K_(),L=w(b(j),2),D=b(L),J=w(b(D)),ae=b(J),ke=w(D,2),X=w(b(ke)),A=b(X),K=w(ke,2);{var P=O=>{var I=F_(),Q=w(b(I)),W=b(Q);se(Z=>te(W,Z),[()=>ku(r().limits.maxBufferSize)]),C(O,I)};pe(K,O=>{var I;(I=r().limits)!=null&&I.maxBufferSize&&O(P)})}se(()=>{te(ae,r().vendor),te(A,r().architecture)}),C(S,j)};pe(k,S=>{r()&&S(T)})}var N=w(k,2);{var z=S=>{var j=H_(),L=b(j);se(()=>te(L,a())),C(S,j)};pe(N,S=>{a()&&S(z)})}var G=w(N,2);se(()=>G.disabled=a()),po(u,n),Ce("click",G,function(...S){var j;(j=e.onload)==null||j.apply(this,S)}),C(t,s),nt()}$t(["click"]);var G_=q('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),W_=q('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),Y_=q('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),X_=q("<div><!></div>"),Z_=q("<option> <!></option>"),Q_=q("<option> <!></option>"),J_=q('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),$_=q('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),e0=q('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),t0=q('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),n0=q('<span class="current-badge svelte-1bvvk8o">Current</span>'),r0=q('<span class="installed-badge svelte-1bvvk8o">â</span>'),a0=q('<span class="rec-badge svelte-1bvvk8o">â</span>'),s0=q('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),i0=q('<p class="error svelte-1bvvk8o"> </p>'),o0=q('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function l0(t,e){tt(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"error",15);const a=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let s=Oe(tn(go())),i=Oe(!1),o=Oe(null),u=Oe(tn([])),f=Oe(!1);Nn(()=>{Rb().then(U=>{M(s,U,!0),v()})});async function v(){M(i,!0),M(o,null);const U=await xu(l(s));M(o,U,!0),M(i,!1),U.connected&&p()}async function p(){M(f,!0);try{const U=await Lb(l(s));M(u,U.map(le=>le.name),!0)}catch(U){console.error("Failed to load Ollama models:",U),M(u,[],!0)}M(f,!1)}function h(){Db(l(s)),v()}function m(){if(!n()){r("Please select a model");return}e.onload()}function x(U){return l(u).length?l(u).includes(U):!1}const k=fp();var T=o0(),N=b(T),z=b(N),G=w(b(z)),S=b(G),j=w(z,2),L=b(j),D=w(L,2),J=b(D),ae=w(j,2);{var ke=U=>{var le=X_();let Y;var ue=b(le);{var be=re=>{var Te=G_(),_e=w(Ye(Te),2),Pe=b(_e);se(()=>te(Pe,`Connected â¢ v${l(o).version??""}`)),C(re,Te)},ge=re=>{var Te=Y_(),_e=w(Ye(Te),2),Pe=b(_e),He=b(Pe),Ze=w(Pe,2);{var vt=ht=>{var je=W_(),De=w(b(je),2),Fe=b(De),Ne=w(b(Fe));Ne.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var Je=w(Fe,2),ut=w(b(Je));ut.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,C(ht,je)};pe(Ze,ht=>{l(o).corsError&&ht(vt)})}se(()=>te(He,`Disconnected: ${l(o).error??""}`)),C(re,Te)};pe(ue,re=>{l(o).connected?re(be):re(ge,!1)})}se(()=>Y=Pt(le,1,"connection-status svelte-1bvvk8o",null,Y,{connected:l(o).connected})),C(U,le)};pe(ae,U=>{l(o)&&U(ke)})}var X=w(N,2),A=w(b(X),2),K=b(A);Ct(K,21,()=>k,Wt,(U,le)=>{var Y=Z_(),ue=b(Y),be=w(ue);{var ge=_e=>{var Pe=yn("â");C(_e,Pe)},re=$(()=>x(l(le).name));pe(be,_e=>{l(re)&&_e(ge)})}var Te={};se(_e=>{te(ue,`${l(le).displayName??""} (${l(le).params??""}) - ${_e??""}k context `),Te!==(Te=l(le).name)&&(Y.value=(Y.__value=l(le).name)??"")},[()=>(l(le).contextWindow/1024).toFixed(0)]),C(U,Y)});var P=w(K);Ct(P,21,()=>Qr.filter(U=>!U.recommended),Wt,(U,le)=>{var Y=Q_(),ue=b(Y),be=w(ue);{var ge=_e=>{var Pe=yn("â");C(_e,Pe)},re=$(()=>x(l(le).name));pe(be,_e=>{l(re)&&_e(ge)})}var Te={};se(_e=>{te(ue,`${l(le).displayName??""} (${l(le).params??""}) - ${_e??""}k context `),Te!==(Te=l(le).name)&&(Y.value=(Y.__value=l(le).name)??"")},[()=>(l(le).contextWindow/1024).toFixed(0)]),C(U,Y)});var O=w(A,2);{var I=U=>{const le=$(()=>Qr.find(ge=>ge.name===n()));var Y=cn(),ue=Ye(Y);{var be=ge=>{var re=t0(),Te=b(re),_e=b(Te),Pe=w(Te,2),He=b(Pe),Ze=b(He),vt=w(He,4),ht=b(vt),je=w(vt,2);{var De=$e=>{var it=J_(),rt=w(Ye(it),2),We=b(rt);se(mt=>te(We,mt),[()=>l(le).tags.join(", ")]),C($e,it)};pe(je,$e=>{var it;(it=l(le).tags)!=null&&it.length&&$e(De)})}var Fe=w(Pe,2);{var Ne=$e=>{var it=$_(),rt=w(b(it),2),We=b(rt);se(()=>te(We,`ollama pull ${n()??""}`)),C($e,it)},Je=$(()=>!x(n())),ut=$e=>{var it=e0();C($e,it)};pe(Fe,$e=>{l(Je)?$e(Ne):$e(ut,!1)})}se($e=>{te(_e,l(le).description),te(Ze,`${$e??""}k context`),te(ht,`${l(le).params??""} params`)},[()=>(l(le).contextWindow/1024).toFixed(0)]),C(ge,re)};pe(ue,ge=>{l(le)&&ge(be)})}C(U,Y)};pe(O,U=>{n()&&U(I)})}var Q=w(X,2),W=w(b(Q),2),Z=b(W),B=w(b(Z));Ct(B,21,()=>Qr,Wt,(U,le)=>{var Y=s0();let ue;var be=b(Y),ge=b(be),re=w(ge);{var Te=$e=>{var it=n0();C($e,it)};pe(re,$e=>{l(le).name===n()&&$e(Te)})}var _e=w(re,2);{var Pe=$e=>{var it=r0();C($e,it)},He=$(()=>x(l(le).name));pe(_e,$e=>{l(He)&&$e(Pe)})}var Ze=w(be),vt=b(Ze),ht=b(vt),je=w(Ze),De=b(je),Fe=w(je),Ne=b(Fe);{var Je=$e=>{var it=a0();C($e,it)};pe(Ne,$e=>{l(le).recommended&&$e(Je)})}var ut=w(Ne);se(($e,it,rt)=>{ue=Pt(Y,1,"svelte-1bvvk8o",null,ue,$e),te(ge,`${l(le).displayName??""} `),te(ht,`${it??""}k`),te(De,l(le).params),te(ut,` ${rt??""}`)},[()=>({selected:l(le).name===n(),installed:x(l(le).name)}),()=>(l(le).contextWindow/1024).toFixed(0),()=>l(le).tags.slice(0,2).join(", ")]),C(U,Y)});var ee=w(Q,2);{var ne=U=>{var le=i0(),Y=b(le);se(()=>te(Y,r())),C(U,le)};pe(ee,U=>{r()&&U(ne)})}var H=w(ee,2);se(()=>{var U;te(S,a?"ð¥ local":"âï¸ remote"),wt(L,"placeholder",a?"http://localhost:11434":"https://me-ai.metaelon.space"),D.disabled=l(i),te(J,l(i)?"Testing...":"Test"),H.disabled=!((U=l(o))!=null&&U.connected)||r()}),Ce("change",L,h),ha(L,()=>l(s),U=>M(s,U)),Ce("click",D,v),po(A,n),Ce("click",H,m),C(t,T),nt()}$t(["change","click"]);var c0=q('<span class="progress-percent svelte-r5fnze"> </span>'),u0=q('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),d0=q('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),f0=q('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),v0=q('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),h0=q('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),p0=q('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function g0(t,e){tt(e,!0);let n=Ae(e,"message",3,""),r=Ae(e,"items",19,()=>[]);Tn(()=>fr("LoadingProgress"));var a=p0(),s=b(a),i=b(s),o=w(s,2);Ct(o,17,r,Wt,(u,f)=>{const v=$(()=>l(f).total?qb(l(f).loaded||0,l(f).total):null);var p=h0(),h=b(p),m=b(h),x=b(m),k=w(m,2);{var T=S=>{var j=c0(),L=b(j);se(D=>te(L,`${D??""}%`),[()=>l(v).toFixed(1)]),C(S,j)};pe(k,S=>{l(v)!==null&&S(T)})}var N=w(h,2);{var z=S=>{var j=u0(),L=Ye(j),D=b(L),J=w(L,2),ae=b(J),ke=b(ae),X=w(ae,4),A=b(X),K=w(X,2),P=b(K);se((O,I,Q,W,Z)=>{jt(D,`width: ${O??""}%`),te(ke,I),te(A,Q),te(P,`(${W??""} / ${Z??""} B)`)},[()=>Math.max(l(f).progress??0,.5).toFixed(1),()=>zc(l(f).loaded||0),()=>zc(l(f).total),()=>(l(f).loaded||0).toLocaleString(),()=>l(f).total.toLocaleString()]),C(S,j)},G=S=>{var j=v0(),L=w(Ye(j),2),D=b(L);{var J=ke=>{var X=d0(),A=Ye(X),K=b(A),P=w(A,2),O=b(P);se((I,Q)=>{te(K,I),te(O,`(${Q??""} B)`)},[()=>zc(l(f).loaded),()=>l(f).loaded.toLocaleString()]),C(ke,X)},ae=ke=>{var X=f0();C(ke,X)};pe(D,ke=>{l(f).loaded?ke(J):ke(ae,!1)})}C(S,j)};pe(N,S=>{l(f).total?S(z):S(G,!1)})}se(()=>{wt(m,"title",l(f).file),te(x,l(f).file)}),C(u,p)}),se(()=>te(i,n())),C(t,a),nt()}var m0=q('<span class="thinking-tokens svelte-11gjw00"> </span>'),y0=q('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),b0=q('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),_0=q('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),w0=q('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),x0=q('<span class="cursor svelte-11gjw00">|</span>'),k0=q(" <!>",1),S0=q('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),E0=q('<div class="content svelte-11gjw00"> </div>'),A0=q('<div><div class="role svelte-11gjw00"> </div> <!></div>');function T0(t,e){tt(e,!0);let n=Ae(e,"isLast",3,!1),r=Ae(e,"isRunning",3,!1),a=Ae(e,"generationPhase",3,null),s=Ae(e,"numTokens",3,null);Tn(()=>fr(`MessageBubble[${e.msg.role}]`));var i=A0(),o=b(i),u=b(o),f=w(o,2);{var v=h=>{var m=S0(),x=Ye(m);{var k=D=>{var J=y0(),ae=w(b(J),4);{var ke=X=>{var A=m0(),K=b(A);se(()=>te(K,`${s()??""} tokens`)),C(X,A)};pe(ae,X=>{s()&&X(ke)})}C(D,J)},T=D=>{var J=b0();C(D,J)};pe(x,D=>{r()&&n()&&a()==="thinking"?D(k):r()&&n()&&a()==="preparing"&&D(T,1)})}var N=w(x,2);{var z=D=>{var J=_0(),ae=b(J),ke=w(b(ae),2),X=b(ke),A=w(ae,2),K=b(A);se(P=>{te(X,`${P??""} words`),te(K,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),C(D,J)};pe(N,D=>{e.msg.thinking&&D(z)})}var G=w(N,2),S=b(G);{var j=D=>{var J=w0();C(D,J)},L=D=>{var J=k0(),ae=Ye(J,!0),ke=w(ae);{var X=A=>{var K=x0();C(A,K)};pe(ke,A=>{r()&&n()&&A(X)})}se(()=>te(ae,e.msg.content)),C(D,J)};pe(S,D=>{r()&&n()&&!e.msg.content&&a()!=="thinking"?D(j):D(L,!1)})}C(h,m)},p=h=>{var m=E0(),x=b(m);se(()=>te(x,e.msg.content)),C(h,m)};pe(f,h=>{e.msg.role==="assistant"?h(v):h(p,!1)})}se(()=>{Pt(i,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),te(u,e.msg.role==="user"?"You":"AI")}),C(t,i),nt()}var C0=q('<span class="cmd-icon svelte-1m7x4wq"> </span>'),I0=q('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),P0=q('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Gf(t,e){tt(e,!0);var n=P0(),r=Ye(n),a=b(r);{var s=m=>{var x=C0(),k=b(x);se(()=>te(k,e.command.icon)),C(m,x)};pe(a,m=>{e.command.icon&&m(s)})}var i=w(a,2),o=b(i),u=b(o),f=w(o,2),v=b(f),p=w(r,2);{var h=m=>{var x=I0(),k=b(x),T=b(k);se(()=>te(T,e.command.body)),C(m,x)};pe(p,m=>{e.command.body&&m(h)})}se(()=>{te(u,e.command.name),te(v,e.command.description)}),Ce("click",r,()=>{var m;return(m=e.onexecute)==null?void 0:m.call(e,e.command.id)}),C(t,n),nt()}$t(["click"]);const Wf="https://accounts.google.com/gsi/client",M0="https://www.googleapis.com/auth/gmail.modify",_d="me-ai:oauth-token",wd=300*1e3;let Gi=null,Fi=null,qa=0;async function Dp(t,e){qa=Date.now()+e*1e3;const{setSetting:n}=await nr(async()=>{const{setSetting:r}=await Promise.resolve().then(()=>xa);return{setSetting:r}},void 0,import.meta.url);await n(_d,{access_token:t,expires_at:qa})}async function Au(){qa=0;const{removeSetting:t}=await nr(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>xa);return{removeSetting:e}},void 0,import.meta.url);await t(_d)}async function Wl(){try{const{getSetting:t}=await nr(async()=>{const{getSetting:a}=await Promise.resolve().then(()=>xa);return{getSetting:a}},void 0,import.meta.url),e=await t(_d);if(!e)return null;const{access_token:n,expires_at:r}=e;return!n||Date.now()>r-wd?(await Au(),null):(qa=r,{access_token:n})}catch{return await Au(),null}}function O0(){return qa>0&&Date.now()<qa-wd}function N0(){return qa<=0?0:Math.max(0,qa-wd-Date.now())}function Yf(){return new Promise((t,e)=>{if(!Gi){e(new Error("Google Auth not initialized."));return}Fi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Dp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Gi.requestAccessToken({prompt:""})})}function R0(){return new Promise((t,e)=>{var a,s;if((s=(a=window.google)==null?void 0:a.accounts)!=null&&s.oauth2){t();return}const n=document.querySelector(`script[src="${Wf}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const r=document.createElement("script");r.src=Wf,r.async=!0,r.defer=!0,r.onload=()=>t(),r.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async function Xf(t){await R0(),Gi=google.accounts.oauth2.initTokenClient({client_id:t,scope:M0,callback:e=>{Fi&&(Fi(e),Fi=null)}})}function D0(){return new Promise((t,e)=>{if(!Gi){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Fi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Dp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Gi.requestAccessToken()})}async function L0(t){return await Au(),new Promise(e=>{var n,r;(r=(n=window.google)==null?void 0:n.accounts)!=null&&r.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function Lp(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const r=await Tp(t.type);if(e==null||e({phase:"policy_check",group:r.group,policy:r}),r.requiresApproval&&!n){const f=await ea(t.type);return{success:!1,requiresApproval:!0,group:r.group,actions:f,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const a=await Wl();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,i=await ea(t.type);if(!i||i.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:i,actionCount:i.length});const o={accessToken:s,event:t,onProgress:e},u=await di.executePipeline(i,o);return e==null||e({phase:"done",result:u}),u}catch(r){return e==null||e({phase:"error",error:r.message}),{success:!1,error:r,message:r.message||"Unknown error"}}}async function jp(t,e,n,r=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=await Tp(t);if(a.requiresApproval&&!r){const p=await ea(t);return{success:!1,requiresApproval:!0,group:a.group,actions:p,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await Wl();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const i=s.access_token,o=await ea(t);if(!o||o.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:o,actionCount:o.length});const u=e.map(p=>({type:t,source:"gmail",data:p})),f={accessToken:i,onProgress:n},v=await di.executePipelineBatch(o,u,f);return n==null||n({phase:"done",result:v}),v}catch(a){return n==null||n({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function zp(t){return di.getAvailableActions(t)}async function Tu(){const t=await Wl();return!!(t!=null&&t.access_token)}const j0=Object.freeze(Object.defineProperty({__proto__:null,EVENT_GROUPS:Lr,executePipeline:Lp,executePipelineBatch:jp,getAvailableActions:zp,isAuthenticated:Tu},Symbol.toStringTag,{value:"Module"}));var z0=q('<div class="event-subject svelte-1w66m1k"> </div>'),B0=q('<span class="sep svelte-1w66m1k">Â·</span> ',1),q0=q('<div class="event-summary svelte-1w66m1k"> </div>'),F0=q('<span class="tag svelte-1w66m1k"> </span>'),K0=q('<div class="event-tags svelte-1w66m1k"></div>'),H0=q('<div class="event-reason svelte-1w66m1k"> </div>'),V0=q('<div class="commands svelte-1w66m1k"></div>'),U0=q('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),G0=q('<span class="event-subject-inline svelte-1w66m1k"> </span>'),W0=q('<span class="sep svelte-1w66m1k">Â·</span> ',1),Y0=q('<div class="event-summary svelte-1w66m1k"> </div>'),X0=q('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),Z0=q('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),Q0=q('<span class="group-tier-chip svelte-1w66m1k"> </span>'),J0=q("<button><!></button>"),$0=q("<span> </span>"),ew=q('<span class="approval-action-desc svelte-1w66m1k"> </span>'),tw=q("<li><!> <strong> </strong> <!></li>"),nw=q('<ul class="approval-actions svelte-1w66m1k"></ul>'),rw=q(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),aw=q("<div> </div>"),sw=q('<span class="email-from svelte-1w66m1k"> </span>'),iw=q('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),ow=q('<div class="email-summary svelte-1w66m1k"> </div>'),lw=q('<span class="tag svelte-1w66m1k"> </span>'),cw=q('<div class="email-tags svelte-1w66m1k"></div>'),uw=q("<button><!></button>"),dw=q('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),fw=q('<span class="step-icon svelte-1w66m1k"> </span>'),vw=q('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),hw=q('<div class="pipeline-steps svelte-1w66m1k"></div>'),pw=q('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Actions page</div>'),gw=q("<div> </div>"),mw=q('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),yw=q('<div class="group-emails svelte-1w66m1k"></div>'),bw=q('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),_w=q('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function ww(t,e){tt(e,!0);let n=Oe(tn({})),r=tn({}),a=Oe(tn({}));function s(j){if(!j)return"â";const L=j.replace(/<.*>/,"").trim();return L.length>40?L.slice(0,38)+"â¦":L}function i(j){if(!j)return"";try{return new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function o(j,L){var D;(D=e.oncommand)==null||D.call(e,{event:j,commandId:L})}async function u(j,L,D=!1){if(!await Tu()){alert("Please sign in to Gmail first (Dashboard page)");return}const J=`single_${L}`;r[J]={running:!0,progress:null,result:null};try{const ae=await Lp(j,ke=>{r[J]={...r[J],progress:ke}},D);if(ae.requiresApproval){r[J]={running:!1,progress:null,result:null},l(a)[J]={event:j,emailId:L,actions:ae.actions,group:ae.group,isBatch:!1};return}r[J]={running:!1,progress:null,result:ae}}catch(ae){r[J]={running:!1,progress:null,result:{success:!1,message:ae.message}}}}async function f(j,L,D=!1){if(!await Tu()){alert("Please sign in to Gmail first (Dashboard page)");return}const J=`batch_${j}`;r[J]={running:!0,progress:null,result:null};try{const ae=await jp(j,L,ke=>{r[J]={...r[J],progress:ke}},D);if(ae.requiresApproval){r[J]={running:!1,progress:null,result:null},l(a)[J]={eventType:j,emails:L,actions:ae.actions,group:ae.group,isBatch:!0};return}r[J]={running:!1,progress:null,result:ae}}catch(ae){r[J]={running:!1,progress:null,result:{success:!1,message:ae.message}}}}async function v(j){const L=l(a)[j];L&&(delete l(a)[j],M(a,{...l(a)},!0),L.isBatch?await f(L.eventType,L.emails,!0):await u(L.event,L.emailId,!0))}function p(j){delete l(a)[j],M(a,{...l(a)},!0)}function h(j){M(n,{...l(n),[j]:!l(n)[j]},!0)}function m(j){return j.split("_").map(L=>L.charAt(0)+L.slice(1).toLowerCase()).join(" ")}function x(j){return`hsl(${Hl(j)}, 55%, 55%)`}function k(j){return r[j]}var T=cn(),N=Ye(T);{var z=j=>{var L=U0(),D=b(L),J=b(D),ae=b(J),ke=b(ae),X=w(ae,2),A=b(X),K=w(J,2);{var P=be=>{var ge=z0(),re=b(ge);se(()=>te(re,e.msg.event.data.subject)),C(be,ge)};pe(K,be=>{var ge;(ge=e.msg.event.data)!=null&&ge.subject&&be(P)})}var O=w(K,2),I=b(O);{var Q=be=>{var ge=yn();se(re=>te(ge,re),[()=>s(e.msg.event.data.from)]),C(be,ge)};pe(I,be=>{var ge;(ge=e.msg.event.data)!=null&&ge.from&&be(Q)})}var W=w(I,2);{var Z=be=>{var ge=B0(),re=w(Ye(ge),1,!0);se(Te=>te(re,Te),[()=>i(e.msg.event.data.date)]),C(be,ge)};pe(W,be=>{var ge;(ge=e.msg.event.data)!=null&&ge.date&&be(Z)})}var B=w(O,2);{var ee=be=>{var ge=q0(),re=b(ge);se(()=>te(re,e.msg.event.metadata.summary)),C(be,ge)};pe(B,be=>{var ge;(ge=e.msg.event.metadata)!=null&&ge.summary&&be(ee)})}var ne=w(B,2);{var H=be=>{var ge=K0();Ct(ge,21,()=>e.msg.event.metadata.tags,Wt,(re,Te)=>{var _e=F0(),Pe=b(_e);se(()=>te(Pe,l(Te))),C(re,_e)}),C(be,ge)};pe(ne,be=>{var ge,re;(re=(ge=e.msg.event.metadata)==null?void 0:ge.tags)!=null&&re.length&&be(H)})}var U=w(ne,2);{var le=be=>{var ge=H0(),re=b(ge);se(()=>te(re,e.msg.event.metadata.reason)),C(be,ge)};pe(U,be=>{var ge;(ge=e.msg.event.metadata)!=null&&ge.reason&&be(le)})}var Y=w(D,2);{var ue=be=>{var ge=V0();Ct(ge,21,()=>e.msg.commands,Wt,(re,Te)=>{Gf(re,{get command(){return l(Te)},onexecute:_e=>o(e.msg.event,_e)})}),C(be,ge)};pe(Y,be=>{var ge;(ge=e.msg.commands)!=null&&ge.length&&be(ue)})}se(()=>{te(ke,e.msg.event.type),te(A,e.msg.event.source)}),C(j,L)},G=j=>{var L=Z0(),D=b(L),J=b(D),ae=b(J),ke=w(D,2);Ct(ke,17,()=>e.msg.items,Wt,(X,A)=>{var K=X0(),P=b(K),O=b(P),I=b(O),Q=b(I),W=w(I,2);{var Z=be=>{var ge=G0(),re=b(ge);se(()=>te(re,l(A).event.data.subject)),C(be,ge)};pe(W,be=>{var ge;(ge=l(A).event.data)!=null&&ge.subject&&be(Z)})}var B=w(O,2),ee=b(B);{var ne=be=>{var ge=yn();se(re=>te(ge,re),[()=>s(l(A).event.data.from)]),C(be,ge)};pe(ee,be=>{var ge;(ge=l(A).event.data)!=null&&ge.from&&be(ne)})}var H=w(ee,2);{var U=be=>{var ge=W0(),re=w(Ye(ge),1,!0);se(Te=>te(re,Te),[()=>i(l(A).event.data.date)]),C(be,ge)};pe(H,be=>{var ge;(ge=l(A).event.data)!=null&&ge.date&&be(U)})}var le=w(B,2);{var Y=be=>{var ge=Y0(),re=b(ge);se(()=>te(re,l(A).event.metadata.summary)),C(be,ge)};pe(le,be=>{var ge;(ge=l(A).event.metadata)!=null&&ge.summary&&be(Y)})}var ue=w(P,2);Ct(ue,21,()=>l(A).commands,Wt,(be,ge)=>{Gf(be,{get command(){return l(ge)},onexecute:re=>o(l(A).event,re)})}),se(()=>te(Q,l(A).event.type)),C(X,K)}),se(()=>te(ae,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),C(j,L)},S=j=>{var L=_w(),D=b(L),J=w(b(D),2),ae=b(J),ke=w(D,2);Ct(ke,17,()=>e.msg.groups,Wt,(X,A)=>{const K=$(()=>l(n)[l(A).eventType]??!0),P=$(()=>`batch_${l(A).eventType}`),O=$(()=>k(l(P))),I=$(()=>l(a)[l(P)]),Q=$(()=>l(A).group?Lr[l(A).group]:null);var W=bw(),Z=b(W),B=b(Z),ee=b(B);let ne;var H=b(ee),U=w(ee,2);{var le=je=>{var De=Q0();let Fe;var Ne=b(De);se(()=>{wt(De,"title",l(Q).description),Fe=jt(De,"",Fe,{color:l(Q).color}),te(Ne,l(Q).label)}),C(je,De)};pe(U,je=>{l(Q)&&je(le)})}var Y=w(U,2),ue=b(Y),be=w(Y,4);let ge;var re=w(B,2);{var Te=je=>{var De=J0();let Fe;var Ne=b(De);{var Je=rt=>{var We=yn("â³ Running...");C(rt,We)},ut=rt=>{var We=yn();se(()=>te(We,l(O).result.success?`â Done (${l(O).result.successful}/${l(O).result.total})`:"â Failed")),C(rt,We)},$e=rt=>{var We=yn();se(()=>te(We,`ð Review & Execute (${l(A).emails.length??""})`)),C(rt,We)},it=rt=>{var We=yn();se(()=>te(We,`â¶ Execute All (${l(A).emails.length??""})`)),C(rt,We)};pe(Ne,rt=>{var We,mt,dt;(We=l(O))!=null&&We.running?rt(Je):(mt=l(O))!=null&&mt.result?rt(ut,1):(dt=l(Q))!=null&&dt.requiresApproval?rt($e,2):rt(it,!1)})}se(()=>{var rt,We;Fe=Pt(De,1,"execute-all-btn svelte-1w66m1k",null,Fe,{critical:(rt=l(Q))==null?void 0:rt.requiresApproval}),De.disabled=(We=l(O))==null?void 0:We.running}),Ce("click",De,rt=>{rt.stopPropagation(),f(l(A).eventType,l(A).emails)}),C(je,De)};pe(re,je=>{l(I)||je(Te)})}var _e=w(Z,2);{var Pe=je=>{var De=rw(),Fe=w(b(De),2),Ne=w(b(Fe)),Je=b(Ne),ut=w(Fe,2);{var $e=mt=>{var dt=nw();Ct(dt,21,()=>l(I).actions,Wt,(Rt,Ft)=>{var xt=tw(),yt=b(xt);{var bt=zt=>{var Re=$0(),Yt=b(Re);se(()=>te(Yt,l(Ft).icon)),C(zt,Re)};pe(yt,zt=>{l(Ft).icon&&zt(bt)})}var lt=w(yt,2),ze=b(lt),Ot=w(lt,2);{var Dt=zt=>{var Re=ew(),Yt=b(Re);se(()=>te(Yt,`â ${l(Ft).description??""}`)),C(zt,Re)};pe(Ot,zt=>{l(Ft).description&&zt(Dt)})}se(()=>te(ze,l(Ft).name)),C(Rt,xt)}),C(mt,dt)};pe(ut,mt=>{var dt;(dt=l(I).actions)!=null&&dt.length&&mt($e)})}var it=w(ut,2),rt=b(it),We=w(rt,2);se(()=>te(Je,`${l(A).emails.length??""} email${l(A).emails.length===1?"":"s"}`)),Ce("click",rt,()=>v(l(P))),Ce("click",We,()=>p(l(P))),C(je,De)};pe(_e,je=>{l(I)&&je(Pe)})}var He=w(_e,2);{var Ze=je=>{var De=aw();let Fe;var Ne=b(De);se(()=>{Fe=Pt(De,1,"batch-result svelte-1w66m1k",null,Fe,{success:l(O).result.success,error:!l(O).result.success}),te(Ne,l(O).result.message)}),C(je,De)};pe(He,je=>{var De;(De=l(O))!=null&&De.result&&!l(I)&&je(Ze)})}var vt=w(He,2);{var ht=je=>{var De=yw();Ct(De,21,()=>l(A).emails,Wt,(Fe,Ne)=>{const Je=$(()=>`single_${l(Ne).emailId}`),ut=$(()=>k(l(Je))),$e=$(()=>l(a)[l(Je)]);var it=mw(),rt=b(it),We=b(rt),mt=b(We),dt=w(We,2),Rt=b(dt);{var Ft=ft=>{var ot=sw(),Ht=b(ot);se(ct=>te(Ht,ct),[()=>s(l(Ne).from)]),C(ft,ot)};pe(Rt,ft=>{l(Ne).from&&ft(Ft)})}var xt=w(Rt,2);{var yt=ft=>{var ot=iw(),Ht=w(Ye(ot)),ct=b(Ht);se(kt=>te(ct,kt),[()=>i(l(Ne).date)]),C(ft,ot)};pe(xt,ft=>{l(Ne).date&&ft(yt)})}var bt=w(dt,2);{var lt=ft=>{var ot=ow(),Ht=b(ot);se(()=>te(Ht,l(Ne).summary)),C(ft,ot)};pe(bt,ft=>{l(Ne).summary&&ft(lt)})}var ze=w(bt,2);{var Ot=ft=>{var ot=cw();Ct(ot,21,()=>l(Ne).tags,Wt,(Ht,ct)=>{var kt=lw(),nn=b(kt);se(()=>te(nn,l(ct))),C(Ht,kt)}),C(ft,ot)};pe(ze,ft=>{var ot;(ot=l(Ne).tags)!=null&&ot.length&&ft(Ot)})}var Dt=w(rt,2),zt=b(Dt),Re=w(b(zt),2);{var Yt=ft=>{var ot=uw();let Ht;var ct=b(ot);{var kt=Zt=>{var en=yn("â³ Running...");C(Zt,en)},nn=Zt=>{var en=yn();se(()=>te(en,l(ut).result.success?"â Done":"â Failed")),C(Zt,en)},an=Zt=>{var en=yn("ð Review");C(Zt,en)},Dn=Zt=>{var en=yn("â¶ Execute");C(Zt,en)};pe(ct,Zt=>{var en,_n,hn;(en=l(ut))!=null&&en.running?Zt(kt):(_n=l(ut))!=null&&_n.result?Zt(nn,1):(hn=l(Q))!=null&&hn.requiresApproval?Zt(an,2):Zt(Dn,!1)})}se(()=>{var Zt,en;Ht=Pt(ot,1,"execute-btn svelte-1w66m1k",null,Ht,{critical:(Zt=l(Q))==null?void 0:Zt.requiresApproval}),ot.disabled=(en=l(ut))==null?void 0:en.running}),Ce("click",ot,()=>u({type:l(A).eventType,source:"gmail",data:l(Ne)},l(Ne).emailId)),C(ft,ot)};pe(Re,ft=>{l($e)||ft(Yt)})}var zn=w(zt,2);{var ye=ft=>{var ot=dw(),Ht=w(b(ot),4),ct=b(Ht),kt=w(ct,2);Ce("click",ct,()=>v(l(Je))),Ce("click",kt,()=>p(l(Je))),C(ft,ot)};pe(zn,ft=>{l($e)&&ft(ye)})}var un=w(zn,2);{var Cn=ft=>{var ot=hw();Ct(ot,21,()=>l(A).commands,Wt,(Ht,ct,kt)=>{var nn=vw(),an=b(nn);an.textContent=kt+1;var Dn=w(an,2),Zt=b(Dn);{var en=ka=>{var Vn=fw(),Ps=b(Vn);se(()=>te(Ps,l(ct).icon)),C(ka,Vn)};pe(Zt,ka=>{l(ct).icon&&ka(en)})}var _n=w(Zt,2),hn=b(_n),rr=w(_n,2),ra=b(rr);se(()=>{te(hn,l(ct).name),te(ra,l(ct).description)}),C(Ht,nn)}),C(ft,ot)},At=ft=>{var ot=pw();C(ft,ot)};pe(un,ft=>{var ot;(ot=l(A).commands)!=null&&ot.length?ft(Cn):ft(At,!1)})}var Rn=w(un,2);{var Xt=ft=>{var ot=gw();let Ht;var ct=b(ot);se(()=>{Ht=Pt(ot,1,"execution-result svelte-1w66m1k",null,Ht,{success:l(ut).result.success,error:!l(ut).result.success}),te(ct,l(ut).result.message)}),C(ft,ot)};pe(Rn,ft=>{var ot;(ot=l(ut))!=null&&ot.result&&ft(Xt)})}se(()=>te(mt,l(Ne).subject)),C(Fe,it)}),C(je,De)};pe(vt,je=>{l(K)&&je(ht)})}se((je,De)=>{ne=jt(ee,"",ne,je),te(H,De),te(ue,l(A).emails.length),ge=Pt(be,0,"chevron svelte-1w66m1k",null,ge,{open:l(K)})},[()=>({background:x(l(A).eventType)}),()=>m(l(A).eventType)]),Ce("click",B,()=>h(l(A).eventType)),C(X,W)}),se(()=>te(ae,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),C(j,L)};pe(N,j=>{e.msg.type==="event"?j(z):e.msg.type==="event-batch"?j(G,1):e.msg.type==="events-grouped"&&j(S,2)})}C(t,T),nt()}$t(["click"]);var xw=q('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),kw=q('<span class="edate svelte-mt5nvh"> </span>'),Sw=q('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Ew=q('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Aw=q('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),Tw=q('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Cw=q('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Iw(t,e){tt(e,!0);let n=Ae(e,"pendingData",3,null),r=Oe(null),a=Oe(null);function s(m){M(r,l(r)===m?null:m,!0),M(a,null)}function i(m){return m.split("_").map(x=>x.charAt(0)+x.slice(1).toLowerCase()).join(" ")}function o(m){if(!m)return"";try{return new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function u(m){if(!m)return"";const x=m.replace(/<.*>/,"").trim();return x.length>24?x.slice(0,22)+"â¦":x}var f={toggleGroup:s},v=cn(),p=Ye(v);{var h=m=>{var x=Cw(),k=b(x),T=b(k),N=w(k,2);Ct(N,20,()=>n().order,S=>S,(S,j)=>{const L=$(()=>n().groups[j]),D=$(()=>Eu(j)),J=$(()=>l(r)===j);var ae=xw();let ke,X;var A=b(ae);let K;var P=w(A),O=w(P),I=b(O);se(Q=>{ke=Pt(ae,1,"chip svelte-mt5nvh",null,ke,{active:l(J)}),X=jt(ae,"",X,{"--c":l(D)}),K=jt(A,"",K,{background:l(D)}),te(P,` ${Q??""} `),te(I,l(L).length)},[()=>i(j)]),Ce("click",ae,()=>s(j)),C(S,ae)});var z=w(N,2);{var G=S=>{const j=$(()=>n().groups[l(r)]),L=$(()=>Eu(l(r)));var D=Tw(),J=b(D);let ae;var ke=b(J),X=w(ke,2),A=b(X),K=w(X,2),P=b(K),O=w(J,2);Ct(O,21,()=>l(j),B=>B.emailId,(B,ee)=>{var ne=Sw(),H=b(ne),U=b(H),le=b(U),Y=w(U,2),ue=b(Y),be=w(ue);{var ge=Pe=>{var He=kw(),Ze=b(He);se(vt=>te(Ze,vt),[()=>o(l(ee).date)]),C(Pe,He)};pe(be,Pe=>{l(ee).date&&Pe(ge)})}var re=w(H,2),Te=b(re),_e=w(Te,2);se(Pe=>{te(le,l(ee).subject),te(ue,Pe)},[()=>u(l(ee).from)]),Ce("click",H,()=>{var Pe;return(Pe=e.onaskai)==null?void 0:Pe.call(e,`Tell me about the email "${l(ee).subject}" from ${l(ee).from}`)}),Ce("click",Te,()=>{var Pe;return(Pe=e.onmarkacted)==null?void 0:Pe.call(e,l(ee).emailId)}),Ce("click",_e,()=>{var Pe;return(Pe=e.ondismiss)==null?void 0:Pe.call(e,l(ee).emailId)}),C(B,ne)});var I=w(O,2),Q=b(I);{var W=B=>{var ee=Ew(),ne=Ye(ee),H=w(ne,2);Ce("click",ne,()=>l(j).forEach(U=>{var le;return(le=e.onmarkacted)==null?void 0:le.call(e,U.emailId)})),Ce("click",H,()=>M(a,l(r),!0)),C(B,ee)},Z=B=>{var ee=Aw(),ne=Ye(ee),H=b(ne),U=w(ne,2),le=w(U,2);se(()=>te(H,`Remove ${l(j).length??""}?`)),Ce("click",U,()=>M(a,null)),Ce("click",le,()=>{var Y;(Y=e.oncleargroup)==null||Y.call(e,l(r)),M(a,null),M(r,null)}),C(B,ee)};pe(Q,B=>{l(a)!==l(r)?B(W):B(Z,!1)})}se(B=>{ae=jt(J,"",ae,{"border-color":l(L)}),te(A,B),te(P,l(j).length)},[()=>i(l(r))]),Ce("click",ke,()=>{M(r,null),M(a,null)}),C(S,D)};pe(z,S=>{l(r)&&n().groups[l(r)]&&S(G)})}se(()=>te(T,`${n().total??""} item${n().total!==1?"s":""} need attention`)),C(m,x)};pe(p,m=>{n()&&n().total>0&&m(h)})}return C(t,v),nt(f)}$t(["click"]);var Pw=q('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Mw=q('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Ow=q('<div class="strip svelte-1ed7zw1"><!></div>');function Nw(t,e){let n=Ae(e,"hasScanData",3,!1),r=Ae(e,"engineReady",3,!1),a=Ae(e,"isScanning",3,!1),s=$(()=>r()&&!n()&&!a()),i=$(()=>l(s)||a());var o=cn(),u=Ye(o);{var f=v=>{var p=Ow(),h=b(p);{var m=k=>{var T=Pw();C(k,T)},x=k=>{var T=Mw();Ce("click",T,function(...N){var z;(z=e.onscan)==null||z.apply(this,N)}),C(k,T)};pe(h,k=>{a()?k(m):l(s)&&k(x,1)})}C(v,p)};pe(u,v=>{l(i)&&v(f)})}C(t,o)}$t(["click"]);var Rw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Dw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Lw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),jw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),zw=q('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),Bw=q('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),qw=q('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Fw(t,e){tt(e,!0),Tn(()=>fr("GpuPanel"));var n=qw(),r=b(n),a=w(b(r),2),s=w(b(a),2),i=b(s),o=w(a,2),u=w(b(o),2),f=b(u),v=w(o,2);{var p=S=>{var j=Rw(),L=w(b(j),2),D=b(L);se(()=>te(D,e.gpuInfo.device)),C(S,j)};pe(v,S=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&S(p)})}var h=w(v,2);{var m=S=>{var j=Dw(),L=w(b(j),2),D=b(L);se(J=>te(D,J),[()=>ku(e.gpuInfo.limits.maxBufferSize)]),C(S,j)};pe(h,S=>{var j;(j=e.gpuInfo.limits)!=null&&j.maxBufferSize&&S(m)})}var x=w(h,2);{var k=S=>{var j=Lw(),L=w(b(j),2),D=b(L);se(()=>te(D,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),C(S,j)};pe(x,S=>{var j;(j=e.gpuInfo.limits)!=null&&j.maxComputeInvocationsPerWorkgroup&&S(k)})}var T=w(x,2);{var N=S=>{var j=jw(),L=w(b(j),2),D=b(L);se(J=>te(D,J),[()=>ku(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),C(S,j)};pe(T,S=>{var j;(j=e.gpuInfo.limits)!=null&&j.maxComputeWorkgroupStorageSize&&S(N)})}var z=w(T,2);{var G=S=>{var j=Bw(),L=b(j),D=b(L),J=w(L,2);Ct(J,21,()=>e.gpuInfo.features,Wt,(ae,ke)=>{var X=zw(),A=b(X);se(()=>te(A,l(ke))),C(ae,X)}),se(()=>te(D,`Features (${e.gpuInfo.features.length??""})`)),C(S,j)};pe(z,S=>{var j;(j=e.gpuInfo.features)!=null&&j.length&&S(G)})}se(()=>{te(i,e.gpuInfo.vendor),te(f,e.gpuInfo.architecture)}),C(t,n),nt()}var Kw=q('<button class="gpu-badge svelte-1ktw27c"> </button>'),Hw=q('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Vw=q('<span class="stats svelte-1ktw27c"> </span>'),Uw=q('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Gw=q('<span class="stats preparing svelte-1ktw27c"> </span>'),Ww=q('<span class="stats svelte-1ktw27c"> </span>'),Yw=q('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Xw=q('<button class="btn svelte-1ktw27c">Stop</button>'),Zw=q('<button class="btn primary svelte-1ktw27c">Send</button>'),Qw=q('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Jw(t,e){tt(e,!0),Tn(()=>fr("ChatView"));let n=Ae(e,"messages",19,()=>[]),r=Ae(e,"pendingData",3,null),a=Ae(e,"hasScanData",3,!1),s=Ae(e,"engineReady",3,!1),i=Ae(e,"isScanning",3,!1),o=Ae(e,"isRunning",3,!1),u=Ae(e,"tps",3,null),f=Ae(e,"numTokens",3,null),v=Ae(e,"generationPhase",3,null),p=Ae(e,"gpuInfo",3,null),h=Ae(e,"backend",3,"webgpu"),m=Ae(e,"chatContainer",15),x=Oe(""),k=Oe(!1);function T(Y){Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),N())}function N(){const Y=l(x).trim();!Y||o()||(M(x,""),e.onsend(Y))}function z(Y){Y&&!o()&&e.onsend(Y)}var G=Qw(),S=b(G),j=b(S);{var L=Y=>{var ue=Kw(),be=b(ue);se(()=>te(be,`WebGPU ${l(k)?"â²":"â¼"}`)),Ce("click",ue,()=>M(k,!l(k))),C(Y,ue)},D=Y=>{var ue=Hw();C(Y,ue)};pe(j,Y=>{p()?Y(L):h()==="ollama"&&Y(D,1)})}var J=w(j,2);{var ae=Y=>{var ue=Vw(),be=b(ue);se((ge,re)=>te(be,`${f()??""} tokens in ${ge??""}s
        (${re??""} tok/s)`),[()=>(f()/u()).toFixed(1),()=>u().toFixed(1)]),C(Y,ue)},ke=Y=>{var ue=Uw();C(Y,ue)},X=Y=>{var ue=Gw(),be=b(ue);se(ge=>te(be,`thinking... ${ge??""}`),[()=>u()?`${u().toFixed(0)} tok/s`:""]),C(Y,ue)},A=Y=>{var ue=Ww(),be=b(ue);se(ge=>te(be,`${ge??""} tok/s`),[()=>u().toFixed(1)]),C(Y,ue)};pe(J,Y=>{u()&&!o()?Y(ae):o()&&v()==="preparing"?Y(ke,1):o()&&v()==="thinking"?Y(X,2):u()&&o()&&Y(A,3)})}var K=w(J,4),P=w(S,2);{var O=Y=>{Fw(Y,{get gpuInfo(){return p()}})};pe(P,Y=>{l(k)&&p()&&Y(O)})}var I=w(P,2),Q=b(I);{var W=Y=>{var ue=Yw();C(Y,ue)};pe(Q,Y=>{n().length===0&&!(r()&&r().total>0)&&Y(W)})}var Z=w(Q,2);Ct(Z,17,n,Wt,(Y,ue,be)=>{var ge=cn(),re=Ye(ge);{var Te=He=>{Iw(He,{get pendingData(){return l(ue).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:z})},_e=He=>{ww(He,{get msg(){return l(ue)},get oncommand(){return e.oncommand}})},Pe=He=>{{let Ze=$(()=>be===n().length-1);T0(He,{get msg(){return l(ue)},get isLast(){return l(Ze)},get isRunning(){return o()},get generationPhase(){return v()},get numTokens(){return f()}})}};pe(re,He=>{l(ue).type==="dashboard"?He(Te):l(ue).type==="event"||l(ue).type==="event-batch"||l(ue).type==="events-grouped"?He(_e,1):He(Pe,!1)})}C(Y,ge)}),Es(I,Y=>m(Y),()=>m());var B=w(I,2);Nw(B,{get hasScanData(){return a()},get engineReady(){return s()},get isScanning(){return i()},get onscan(){return e.onscan}});var ee=w(B,2),ne=b(ee),H=w(ne,2);{var U=Y=>{var ue=Xw();Ce("click",ue,function(...be){var ge;(ge=e.onstop)==null||ge.apply(this,be)}),C(Y,ue)},le=Y=>{var ue=Zw();se(be=>ue.disabled=be,[()=>!l(x).trim()]),Ce("click",ue,N),C(Y,ue)};pe(H,Y=>{o()?Y(U):Y(le,!1)})}se(()=>{K.disabled=o(),ne.disabled=o()}),Ce("click",K,function(...Y){var ue;(ue=e.onreset)==null||ue.apply(this,Y)}),Ce("keydown",ne,T),ha(ne,()=>l(x),Y=>M(x,Y)),C(t,G),nt()}$t(["click","keydown"]);var $w=q('<div class="container center svelte-1bi93vx"><!> <!></div>');function e1(t,e){tt(e,!0);const n=!!navigator.gpu,r=hp();let a=Oe("webgpu"),s=Oe(tn(Zr[0].id)),i=Oe(null),o=Oe(null),u=Oe(""),f=Oe(tn([])),v=Oe(tn([])),p=Oe(!1),h=Oe(null),m=Oe(null),x=Oe(null),k=Oe(null),T=Oe(null),N=Oe(null),z=Oe(!1),G=Oe(!1),S=!1;Tn(async()=>{const[H,U]=await Promise.all([Vi("aiBackend"),Vi("selectedModel")]);H&&M(a,H,!0),U&&M(s,U,!0),r.check(),r.isReady&&j();const le=r.onMessage(Y=>{switch(Y.status){case"webgpu-info":M(k,Y.data,!0);break;case"loading":M(i,"loading"),M(u,Y.data,!0);break;case"initiate":M(f,[...l(f),Y],!0);break;case"progress":M(f,l(f).map(ue=>ue.file===Y.file?{...ue,...Y}:ue),!0);break;case"done":M(f,l(f).filter(ue=>ue.file!==Y.file),!0);break;case"ready":M(i,"ready"),j();break;case"start":if(!l(p))break;M(T,Y.phase||"preparing",!0),M(v,[...l(v),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!l(p))break;M(T,Y.phase,!0);break;case"thinking":{if(!l(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=l(v)[l(v).length-1];M(v,[...l(v).slice(0,-1),{...ue,thinking:(ue.thinking||"")+Y.content}],!0),K();break}case"thinking-done":{if(!l(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=l(v)[l(v).length-1];M(v,[...l(v).slice(0,-1),{...ue,thinking:Y.content}],!0);break}case"update":{if(!l(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=l(v)[l(v).length-1];M(v,[...l(v).slice(0,-1),{...ue,content:ue.content+Y.output}],!0),K();break}case"complete":if(!l(p))break;Y.tps!==void 0&&M(h,Y.tps,!0),Y.numTokens!==void 0&&M(m,Y.numTokens,!0),M(p,!1),M(T,null),L();break;case"error":M(o,Y.data,!0),l(i)==="loading"&&M(i,null),l(p)&&(M(p,!1),M(T,null));break}});return()=>le()});async function j(){if(!(S||l(v).length>0))try{const H=await Kf();M(N,H,!0),H&&(S=!0,M(v,[{role:"assistant",type:"dashboard",pendingData:H}],!0),K());const U=await Su();M(z,U.classified>0)}catch{}}async function L(){try{const H=await Kf();M(N,H,!0);const U=l(v).findIndex(Y=>Y.type==="dashboard");U!==-1&&(H&&H.total>0?M(v,l(v).map((Y,ue)=>ue===U?{...Y,pendingData:H}:Y),!0):M(v,l(v).filter((Y,ue)=>ue!==U),!0));const le=await Su();M(z,le.classified>0)}catch{}}async function D(H){await gl(H,"acted"),await L()}async function J(H){await gl(H,"dismissed"),await L()}async function ae(H){await Np(H),await L()}async function ke(H){await bd(H),await L()}async function X(){if(l(G)||!r.isReady)return;M(G,!0);let H=null;try{if(await Mp(r,{count:20,onProgress:U=>{var le;U.phase==="done"&&((le=U.results)==null?void 0:le.length)>0&&(H=U.results)}}),await L(),(H==null?void 0:H.length)>0){const U=await g_(H);M(v,[...l(v),U],!0),K()}l(N)&&!l(v).some(U=>U.type==="dashboard")&&(M(v,[{role:"assistant",type:"dashboard",pendingData:l(N)},...l(v)],!0),K())}catch(U){console.error("Scan failed:",U)}finally{M(G,!1)}}function A({event:H,commandId:U}){var le,Y;`${U}${H.type}${((le=H.data)==null?void 0:le.subject)||"unknown"}`,M(v,[...l(v),{role:"assistant",content:`Command: ${U}

This command is not yet implemented. In the future, "${U}" will be executed on the ${H.source} event "${((Y=H.data)==null?void 0:Y.subject)||""}".`}],!0),K()}function K(){$h().then(()=>{l(x)&&(l(x).scrollTop=l(x).scrollHeight)})}async function P(){M(i,"loading"),await Ui("selectedModel",l(s)),await Ui("aiBackend",l(a)),l(a)==="ollama"&&M(k,null),r.loadModel(l(s))}Nn(()=>{l(a)==="webgpu"&&!Zr.find(H=>H.id===l(s))?M(s,Zr[0].id,!0):l(a)==="ollama"&&!Qr.find(H=>H.name===l(s))&&M(s,Qr[0].name,!0)});async function O(H){if(!H||l(p))return;if(H.trim().toLowerCase()==="/events"){M(v,[...l(v),{role:"user",content:H}],!0);try{const Y=await Op();if(!Y.order.length)M(v,[...l(v),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const ue=await m_(Y);M(v,[...l(v),ue],!0)}}catch(Y){M(v,[...l(v),{role:"assistant",content:`Failed to load events: ${Y.message}`}],!0)}K();return}M(v,[...l(v),{role:"user",content:H}],!0),M(h,null),M(p,!0);let U=[];try{const ue=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(H)?await n_(H):await t_();ue&&(U=[{role:"system",content:ue}])}catch{}const le=l(v).filter(Y=>Y.type!=="dashboard"&&Y.type!=="events-grouped"&&Y.type!=="event-batch"&&Y.type!=="event").map(Y=>({role:Y.role,content:Y.content}));r.generate([...U,...le]),K()}function I(){r.interrupt()}function Q(){r.reset(),M(v,[],!0),M(h,null),M(m,null),S=!1,j()}var W=cn(),Z=Ye(W);{var B=H=>{var U=$w(),le=b(U);O_(le,{get isWebGPUAvailable(){return n},get backend(){return l(a)},set backend(ge){M(a,ge,!0)}});var Y=w(le,2);{var ue=ge=>{U_(ge,{get gpuInfo(){return l(k)},get error(){return l(o)},onload:P,get selectedModel(){return l(s)},set selectedModel(re){M(s,re,!0)}})},be=ge=>{l0(ge,{onload:P,get selectedModel(){return l(s)},set selectedModel(re){M(s,re,!0)},get error(){return l(o)},set error(re){M(o,re,!0)}})};pe(Y,ge=>{l(a)==="webgpu"?ge(ue):l(a)==="ollama"&&ge(be,1)})}C(H,U)},ee=H=>{g0(H,{get message(){return l(u)},get items(){return l(f)}})},ne=H=>{Jw(H,{get messages(){return l(v)},get pendingData(){return l(N)},get hasScanData(){return l(z)},get engineReady(){return r.isReady},get isScanning(){return l(G)},get isRunning(){return l(p)},get tps(){return l(h)},get numTokens(){return l(m)},get generationPhase(){return l(T)},get gpuInfo(){return l(k)},get backend(){return l(a)},onsend:O,onstop:I,onreset:Q,onmarkacted:D,ondismiss:J,onremove:ae,oncleargroup:ke,onscan:X,oncommand:A,get chatContainer(){return l(x)},set chatContainer(U){M(x,U,!0)}})};pe(Z,H=>{l(i)===null?H(B):l(i)==="loading"?H(ee,1):H(ne,!1)})}C(t,W),nt()}const Pn="gmail",Zf=8,Bp=50,qp=100;async function t1(t,{limit:e=Bp,onProgress:n=()=>{},signal:r}={}){var i;const a=await st.syncState.get(Pn);if(a!=null&&a.historyId)try{return await i1(t,a,n,r)}catch(o){if(o instanceof pd&&(o.status===404||o.code==="notFound")||((i=o.message)==null?void 0:i.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await st.syncState.delete(Pn);else throw o}return await a1(t,e===0?1/0:e,n,r)}async function n1(t,{limit:e=Bp,onProgress:n=()=>{},signal:r}={}){const a=await st.syncState.get(Pn);return a!=null&&a.oldestPageToken?await s1(t,a,e===0?1/0:e,n,r):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function r1(){const t=await st.syncState.get(Pn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Fp(){await st.transaction("rw",[st.items,st.syncState],async()=>{await st.items.where("sourceType").equals(Pn).delete(),await st.syncState.delete(Pn)})}async function a1(t,e,n,r){n({phase:"counting",message:"Getting mailbox info..."}),gs(r);const a=await pp(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(a.messagesTotal||e,e)});const s=[];let i,o=null;for(;s.length<e;){gs(r);const p=e-s.length,h=await gp(t,{maxResults:Math.min(qp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),n({phase:"listing",message:`Listed ${s.length} messages...`,current:s.length,total:Math.min(a.messagesTotal||e,e)}),i=h.nextPageToken,!i||m.length===0)break}if(o=i||null,s.length===0)return await st.syncState.put({sourceType:Pn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:u,errors:f}=await Kp(t,s,n,r),v=await st.items.where("sourceType").equals(Pn).count();return await st.syncState.put({sourceType:Pn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:v,oldestPageToken:o}),n({phase:"done",message:`Synced ${u} messages`,current:u,total:u}),{added:u,deleted:0,errors:f}}async function s1(t,e,n,r,a){r({phase:"listing",message:"Loading more messages...",current:0}),gs(a);const s=[];let i=e.oldestPageToken,o=null;for(;s.length<n;){gs(a);const p=n-s.length,h=await gp(t,{maxResults:Math.min(qp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),r({phase:"listing",message:`Listed ${s.length} more messages...`,current:s.length}),i=h.nextPageToken,!i||m.length===0)break}if(o=i||null,s.length===0)return await st.syncState.update(Pn,{oldestPageToken:null,lastSyncAt:Date.now()}),r({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:u,errors:f}=await Kp(t,s,r,a),v=await st.items.where("sourceType").equals(Pn).count();return await st.syncState.update(Pn,{totalItems:v,lastSyncAt:Date.now(),oldestPageToken:o}),r({phase:"done",message:o?`Downloaded ${u} more (more available)`:`Downloaded ${u} more (all synced)`,current:v,total:v}),{added:u,errors:f}}async function i1(t,e,n,r){n({phase:"syncing",message:"Checking for changes..."}),gs(r);let a=0,s=0,i=0,o,u=e.historyId;do{gs(r);const v=await Vb(t,{startHistoryId:e.historyId,pageToken:o});if(u=v.historyId||u,o=v.nextPageToken,!!v.history){for(const p of v.history){if(p.messagesAdded){const h=p.messagesAdded.map(x=>x.message.id),m=[...new Set(h.filter(x=>x))];if(m.length>0){const x=await Promise.allSettled(m.map(T=>mp(t,T))),k=[];for(const T of x)T.status==="fulfilled"?k.push(Hp(T.value)):i++;k.length>0&&(await st.items.bulkPut(k),await Vp(k),a+=k.length)}}if(p.messagesDeleted){const h=p.messagesDeleted.map(m=>dd(Pn,m.message.id)).filter(m=>m);h.length>0&&(await st.items.bulkDelete(h),s+=h.length)}}n({phase:"syncing",message:`Changes: +${a} -${s}`,current:a+s})}}while(o);const f=await st.items.where("sourceType").equals(Pn).count();return await st.syncState.put({sourceType:Pn,historyId:u,lastSyncAt:Date.now(),totalItems:f,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:a===0&&s===0?"Already up to date":`Synced: +${a} -${s}`,current:f,total:f}),{added:a,deleted:s,errors:i}}async function Kp(t,e,n,r){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let a=0,s=0;for(let i=0;i<e.length;i+=Zf){gs(r);const o=e.slice(i,i+Zf),u=await Promise.allSettled(o.map(v=>mp(t,v))),f=[];for(const v of u)v.status==="fulfilled"?f.push(Hp(v.value)):s++;f.length>0&&(await st.items.bulkPut(f),await Vp(f)),a+=f.length,n({phase:"downloading",message:`Downloaded ${a} of ${e.length} messages`,current:a,total:e.length})}return{added:a,errors:s}}function Hp(t){const e=Ca(t,"From"),n=Ca(t,"To"),r=Ca(t,"Cc"),a=Ca(t,"Subject")||"(no subject)",s=Ca(t,"Date"),i=Ca(t,"Message-ID"),o=Ca(t,"In-Reply-To"),u=Ca(t,"References");let f;try{f=s?new Date(s).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{f=Date.now()}return{id:dd(Pn,t.id),sourceType:Pn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:r,subject:a,snippet:t.snippet||"",body:Ub(t),htmlBody:Gb(t),date:f,labels:t.labelIds||[],messageId:i,inReplyTo:o,references:u,raw:t,syncedAt:Date.now()}}async function Vp(t){const e=new Map;for(const n of t)for(const r of[n.from,n.to,n.cc]){if(!r)continue;const a=r.split(",").map(s=>s.trim()).filter(Boolean);for(const s of a){const i=o1(s);i&&!e.has(i.email)&&e.set(i.email,{...i,date:n.date})}}for(const[n,{name:r,date:a}]of e)try{const s=await st.contacts.where("email").equals(n).first();if(s){const i={};r&&!s.name&&(i.name=r),a>(s.lastSeen||0)&&(i.lastSeen=a),Object.keys(i).length>0&&await st.contacts.update(s.id,i)}else await st.contacts.add({email:n,name:r||"",firstSeen:a,lastSeen:a})}catch(s){(s==null?void 0:s.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(s==null?void 0:s.message)||s)}}function o1(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const r=e[1].toLowerCase().trim(),a=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:r,name:a}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function gs(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var l1=q(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),c1=q(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),u1=q(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function d1(t,e){tt(e,!0);let n=Ae(e,"clientIdInput",15),r=Ae(e,"defaultClientId",3,"");Tn(()=>fr("SetupGuide"));let a=Oe(null);async function s(x){try{await navigator.clipboard.writeText(x),M(a,x,!0),setTimeout(()=>{M(a,null)},1500)}catch{const k=document.createElement("input");k.value=x,document.body.appendChild(k),k.select(),document.execCommand("copy"),document.body.removeChild(k),M(a,x,!0),setTimeout(()=>{M(a,null)},1500)}}const i="http://localhost:5173",o="https://cypherkitty.github.io",u="https://cypherkitty.github.io/me-ai/";var f=u1(),v=b(f),p=w(b(v),4);{var h=x=>{var k=l1(),T=Ye(k),N=w(b(T),2),z=w(T,2),G=w(b(z),2),S=b(G),j=w(b(S),6),L=w(b(j),2),D=w(b(L),2),J=w(b(D),2),ae=b(J),ke=b(ae);ke.textContent="http://localhost:5173";var X=w(ke,2),A=b(X),K=w(ae,2),P=b(K);P.textContent="https://cypherkitty.github.io";var O=w(P,2),I=b(O),Q=w(D,2),W=w(b(Q),2),Z=b(W),B=b(Z);B.textContent="http://localhost:5173";var ee=w(B,2),ne=b(ee),H=w(Z,2),U=b(H);U.textContent="https://cypherkitty.github.io";var le=w(U,2),Y=b(le),ue=w(H,2),be=b(ue);be.textContent="https://cypherkitty.github.io/me-ai/";var ge=w(be,2),re=b(ge),Te=w(S,2),_e=b(Te),Pe=w(_e,2);se(He=>{te(A,l(a)===i?"â":"â§"),te(I,l(a)===o?"â":"â§"),te(ne,l(a)===i?"â":"â§"),te(Y,l(a)===o?"â":"â§"),te(re,l(a)===u?"â":"â§"),Pe.disabled=He},[()=>!n().trim()]),Ce("click",N,()=>{n(r()),e.onsave()}),Ce("click",ae,()=>s(i)),Ce("click",K,()=>s(o)),Ce("click",Z,()=>s(i)),Ce("click",H,()=>s(o)),Ce("click",ue,()=>s(u)),Ce("keydown",_e,He=>He.key==="Enter"&&e.onsave()),ha(_e,n),Ce("click",Pe,function(...He){var Ze;(Ze=e.onsave)==null||Ze.apply(this,He)}),C(x,k)},m=x=>{var k=c1(),T=Ye(k),N=w(b(T),6),z=w(b(N),2),G=w(b(z),2),S=w(b(G),2),j=b(S),L=b(j);L.textContent="http://localhost:5173";var D=w(L,2),J=b(D),ae=w(j,2),ke=b(ae);ke.textContent="https://cypherkitty.github.io";var X=w(ke,2),A=b(X),K=w(G,2),P=w(b(K),2),O=b(P),I=b(O);I.textContent="http://localhost:5173";var Q=w(I,2),W=b(Q),Z=w(O,2),B=b(Z);B.textContent="https://cypherkitty.github.io";var ee=w(B,2),ne=b(ee),H=w(Z,2),U=b(H);U.textContent="https://cypherkitty.github.io/me-ai/";var le=w(U,2),Y=b(le),ue=w(T,2),be=b(ue),ge=w(be,2);se(re=>{te(J,l(a)===i?"â":"â§"),te(A,l(a)===o?"â":"â§"),te(W,l(a)===i?"â":"â§"),te(ne,l(a)===o?"â":"â§"),te(Y,l(a)===u?"â":"â§"),ge.disabled=re},[()=>!n().trim()]),Ce("click",j,()=>s(i)),Ce("click",ae,()=>s(o)),Ce("click",O,()=>s(i)),Ce("click",Z,()=>s(o)),Ce("click",H,()=>s(u)),Ce("keydown",be,re=>re.key==="Enter"&&e.onsave()),ha(be,n),Ce("click",ge,function(...re){var Te;(Te=e.onsave)==null||Te.apply(this,re)}),C(x,k)};pe(p,x=>{r()?x(h):x(m,!1)})}C(t,f),nt()}$t(["click","keydown"]);function f1(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),r=e instanceof pd?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const a=n.match(/project\s+(\d+)/),s=a==null?void 0:a[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:s?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${s}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return r===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:r===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:r===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var v1=q('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),h1=q('<div class="error-card-title svelte-14buhqq"> </div>'),p1=q('<p class="error-card-fix svelte-14buhqq"> </p>'),g1=q('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),m1=q('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),y1=q('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function Up(t,e){tt(e,!0);let n=Ae(e,"ondismiss",3,null),r=Ae(e,"onsignout",3,null),a=$(()=>f1(e.error));Tn(()=>fr("ErrorCard"));var s=y1(),i=b(s);{var o=N=>{var z=v1(),G=b(z),S=b(G),j=w(G,2);se(()=>te(S,l(a).title)),Ce("click",j,function(...L){var D;(D=n())==null||D.apply(this,L)}),C(N,z)},u=N=>{var z=h1(),G=b(z);se(()=>te(G,l(a).title)),C(N,z)};pe(i,N=>{n()?N(o):N(u,!1)})}var f=w(i,2),v=b(f),p=w(f,2);{var h=N=>{var z=p1(),G=b(z);se(()=>te(G,l(a).fix)),C(N,z)};pe(p,N=>{l(a).fix&&N(h)})}var m=w(p,2);{var x=N=>{var z=g1(),G=b(z);se(()=>{wt(z,"href",l(a).link.url),te(G,`${l(a).link.label??""} â`)}),C(N,z)};pe(m,N=>{l(a).link&&N(x)})}var k=w(m,2);{var T=N=>{var z=m1();Ce("click",z,function(...G){var S;(S=r())==null||S.apply(this,G)}),C(N,z)};pe(k,N=>{l(a).action==="signout"&&r()&&N(T)})}se(()=>te(v,l(a).description)),C(t,s),nt()}$t(["click"]);var b1=q('<span class="spinner svelte-nyqevv"></span> Signing in...',1),_1=bn('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),w1=q('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),x1=q('<span class="client-id-value svelte-nyqevv"> </span>'),k1=q(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function S1(t,e){tt(e,!0);let n=Ae(e,"isDefaultClientId",3,!1),r=Ae(e,"error",3,null),a=Ae(e,"loadingAuth",3,!1);Tn(()=>fr("AuthCard"));var s=k1(),i=b(s),o=w(b(i),4);{var u=z=>{Up(z,{get error(){return r()},get onsignout(){return e.onsignout}})};pe(o,z=>{r()&&z(u)})}var f=w(o,2),v=b(f);{var p=z=>{var G=b1();C(z,G)},h=z=>{var G=_1();C(z,G)};pe(v,z=>{a()?z(p):z(h,!1)})}var m=w(f,4),x=w(b(m),2);{var k=z=>{var G=w1();C(z,G)},T=z=>{var G=x1(),S=b(G);se(j=>te(S,`${j??""}...`),[()=>e.clientId.slice(0,20)]),C(z,G)};pe(x,z=>{n()?z(k):z(T,!1)})}var N=w(x,2);se(()=>f.disabled=a()),Ce("click",f,function(...z){var G;(G=e.onsignin)==null||G.apply(this,z)}),Ce("click",N,function(...z){var G;(G=e.onclear)==null||G.apply(this,z)}),C(t,s),nt()}$t(["click"]);var E1=q('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),A1=q('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),T1=q('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function C1(t,e){tt(e,!0);let n=Ae(e,"profile",3,null),r=Ae(e,"loadingProfile",3,!1);Tn(()=>fr("ProfileCard"));var a=T1(),s=b(a),i=b(s),o=w(s,2),u=b(o);{var f=h=>{var m=E1();C(h,m)},v=h=>{var m=A1(),x=Ye(m),k=b(x),T=w(x,2),N=b(T);se((z,G)=>{te(k,n().emailAddress),te(N,`${z??""} messages
        Â· ${G??""} threads`)},[()=>{var z;return((z=n().messagesTotal)==null?void 0:z.toLocaleString())||"?"},()=>{var z;return((z=n().threadsTotal)==null?void 0:z.toLocaleString())||"?"}]),C(h,m)};pe(u,h=>{r()?h(f):n()&&h(v,1)})}var p=w(o,2);se(h=>te(i,h),[()=>n()?bp(n().emailAddress):"?"]),Ce("click",p,function(...h){var m;(m=e.onsignout)==null||m.apply(this,h)}),C(t,a),nt()}$t(["click"]);var I1=q('<span class="spinner svelte-1ds3j4k"></span>'),P1=bn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),M1=q('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),O1=q('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),N1=q('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),R1=q('<option class="svelte-1ds3j4k"> </option>'),D1=q('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),L1=q('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),j1=q('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),z1=q('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),B1=q('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),q1=q('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function F1(t,e){tt(e,!0),Tn(()=>fr("SyncStatus"));let n=Ae(e,"syncStatus",3,null),r=Ae(e,"syncProgress",3,null),a=Ae(e,"isSyncing",3,!1),s=Oe(!1),i=Oe(50);const o=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function u(W){if(!W)return"never";const Z=Math.floor((Date.now()-W)/1e3);if(Z<60)return"just now";const B=Math.floor(Z/60);if(B<60)return`${B}m ago`;const ee=Math.floor(B/60);return ee<24?`${ee}h ago`:`${Math.floor(ee/24)}d ago`}function f(){var W,Z;return!((W=r())!=null&&W.total)||!((Z=r())!=null&&Z.current)?0:Math.round(r().current/r().total*100)}var v=q1(),p=b(v),h=b(p),m=b(h);{var x=W=>{var Z=I1();C(W,Z)},k=W=>{var Z=P1();C(W,Z)};pe(m,W=>{a()?W(x):W(k,!1)})}var T=w(h,2),N=w(b(T),2);{var z=W=>{var Z=M1(),B=b(Z),ee=w(B);{var ne=U=>{var le=yn("Â· more available");C(U,le)},H=U=>{var le=yn("Â· all synced");C(U,le)};pe(ee,U=>{n().hasMore?U(ne):U(H,!1)})}se((U,le)=>te(B,`${U??""} emails stored
          Â· synced ${le??""} `),[()=>n().totalItems.toLocaleString(),()=>u(n().lastSyncAt)]),C(W,Z)},G=W=>{var Z=O1();C(W,Z)};pe(N,W=>{var Z;(Z=n())!=null&&Z.synced?W(z):W(G,!1)})}var S=w(T,2),j=b(S);{var L=W=>{var Z=N1();Ce("click",Z,()=>M(s,!l(s))),C(W,Z)};pe(j,W=>{var Z;(Z=n())!=null&&Z.synced&&!a()&&W(L)})}var D=w(p,2),J=b(D),ae=w(b(J),2);Ct(ae,21,()=>o,Wt,(W,Z)=>{var B=R1(),ee=b(B),ne={};se(()=>{te(ee,l(Z).label),ne!==(ne=l(Z).value)&&(B.value=(B.__value=l(Z).value)??"")}),C(W,B)});var ke=w(J,2),X=b(ke);{var A=W=>{var Z=L1(),B=Ye(Z),ee=b(B),ne=w(B,2);{var H=U=>{var le=D1(),Y=b(le);se(()=>{le.disabled=a(),te(Y,a()?"Loading...":"Sync More")}),Ce("click",le,()=>e.onsyncmore(l(i))),C(U,le)};pe(ne,U=>{n().hasMore&&U(H)})}se(()=>{B.disabled=a(),te(ee,a()?"Syncing...":"Sync New")}),Ce("click",B,()=>e.onsync(l(i))),C(W,Z)},K=W=>{var Z=j1(),B=b(Z);se(()=>{Z.disabled=a(),te(B,a()?"Syncing...":"Download Emails")}),Ce("click",Z,()=>e.onsync(l(i))),C(W,Z)};pe(X,W=>{var Z;(Z=n())!=null&&Z.synced?W(A):W(K,!1)})}var P=w(D,2);{var O=W=>{var Z=z1(),B=b(Z),ee=b(B);let ne,H;var U=w(B,2),le=b(U);se(Y=>{ne=Pt(ee,1,"progress-fill svelte-1ds3j4k",null,ne,{indeterminate:!r().total}),H=jt(ee,"",H,Y),te(le,r().message||"Syncing...")},[()=>({width:`${f()??""}%`})]),C(W,Z)};pe(P,W=>{a()&&r()&&W(O)})}var I=w(P,2);{var Q=W=>{var Z=B1(),B=w(b(Z),2),ee=b(B),ne=w(ee,2);Ce("click",ee,()=>M(s,!1)),Ce("click",ne,()=>{e.onclear(),M(s,!1)}),C(W,Z)};pe(I,W=>{l(s)&&W(Q)})}se(()=>ae.disabled=a()),po(ae,()=>l(i),W=>M(i,W)),C(t,v),nt()}$t(["click"]);var K1=q('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),H1=q('<div class="message-list svelte-y2uamw"></div>');function V1(t,e){tt(e,!0);let n=Ae(e,"messages",19,()=>[]);Tn(()=>fr("MessageList"));var r=H1();Ct(r,21,n,Wt,(a,s)=>{var i=K1(),o=b(i),u=b(o),f=w(o,2),v=b(f),p=b(v),h=b(p),m=w(p,2),x=b(m),k=w(v,2),T=b(k),N=w(k,2),z=b(N);se((G,S,j)=>{te(u,G),te(h,S),te(x,j),te(T,l(s).subject),te(z,l(s).snippet)},[()=>bp(l(s).from),()=>yp(l(s).from),()=>gd(l(s).date)]),Ce("click",i,()=>e.onselect(l(s))),C(a,i)}),C(t,r),nt()}$t(["click"]);function xd(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ts=xd();function Gp(t){Ts=t}var Ja={exec:()=>null};function qt(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(a,s)=>{let i=typeof s=="string"?s:s.source;return i=i.replace(Fn.caret,"$1"),n=n.replace(a,i),r},getRegex:()=>new RegExp(n,e)};return r}var U1=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Fn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},G1=/^(?:[ \t]*(?:\n|$))+/,W1=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Y1=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,mo=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,X1=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,kd=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,Wp=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Yp=qt(Wp).replace(/bull/g,kd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Z1=qt(Wp).replace(/bull/g,kd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Sd=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Q1=/^[^\n]+/,Ed=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,J1=qt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ed).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$1=qt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,kd).getRegex(),Yl="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ad=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ex=qt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ad).replace("tag",Yl).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Xp=qt(Sd).replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex(),tx=qt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Xp).getRegex(),Td={blockquote:tx,code:W1,def:J1,fences:Y1,heading:X1,hr:mo,html:ex,lheading:Yp,list:$1,newline:G1,paragraph:Xp,table:Ja,text:Q1},Qf=qt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex(),nx={...Td,lheading:Z1,table:Qf,paragraph:qt(Sd).replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Qf).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex()},rx={...Td,html:qt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ad).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ja,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:qt(Sd).replace("hr",mo).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Yp).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ax=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,sx=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Zp=/^( {2,}|\\)\n(?!\s*$)/,ix=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Xl=/[\p{P}\p{S}]/u,Cd=/[\s\p{P}\p{S}]/u,Qp=/[^\s\p{P}\p{S}]/u,ox=qt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Cd).getRegex(),Jp=/(?!~)[\p{P}\p{S}]/u,lx=/(?!~)[\s\p{P}\p{S}]/u,cx=/(?:[^\s\p{P}\p{S}]|~)/u,$p=/(?![*_])[\p{P}\p{S}]/u,ux=/(?![*_])[\s\p{P}\p{S}]/u,dx=/(?:[^\s\p{P}\p{S}]|[*_])/u,fx=qt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",U1?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),eg=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,vx=qt(eg,"u").replace(/punct/g,Xl).getRegex(),hx=qt(eg,"u").replace(/punct/g,Jp).getRegex(),tg="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",px=qt(tg,"gu").replace(/notPunctSpace/g,Qp).replace(/punctSpace/g,Cd).replace(/punct/g,Xl).getRegex(),gx=qt(tg,"gu").replace(/notPunctSpace/g,cx).replace(/punctSpace/g,lx).replace(/punct/g,Jp).getRegex(),mx=qt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Qp).replace(/punctSpace/g,Cd).replace(/punct/g,Xl).getRegex(),yx=qt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,$p).getRegex(),bx="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",_x=qt(bx,"gu").replace(/notPunctSpace/g,dx).replace(/punctSpace/g,ux).replace(/punct/g,$p).getRegex(),wx=qt(/\\(punct)/,"gu").replace(/punct/g,Xl).getRegex(),xx=qt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),kx=qt(Ad).replace("(?:-->|$)","-->").getRegex(),Sx=qt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",kx).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ml=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ex=qt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",ml).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ng=qt(/^!?\[(label)\]\[(ref)\]/).replace("label",ml).replace("ref",Ed).getRegex(),rg=qt(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ed).getRegex(),Ax=qt("reflink|nolink(?!\\()","g").replace("reflink",ng).replace("nolink",rg).getRegex(),Jf=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Id={_backpedal:Ja,anyPunctuation:wx,autolink:xx,blockSkip:fx,br:Zp,code:sx,del:Ja,delLDelim:Ja,delRDelim:Ja,emStrongLDelim:vx,emStrongRDelimAst:px,emStrongRDelimUnd:mx,escape:ax,link:Ex,nolink:rg,punctuation:ox,reflink:ng,reflinkSearch:Ax,tag:Sx,text:ix,url:Ja},Tx={...Id,link:qt(/^!?\[(label)\]\((.*?)\)/).replace("label",ml).getRegex(),reflink:qt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ml).getRegex()},Cu={...Id,emStrongRDelimAst:gx,emStrongLDelim:hx,delLDelim:yx,delRDelim:_x,url:qt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Jf).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:qt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Jf).getRegex()},Cx={...Cu,br:qt(Zp).replace("{2,}","*").getRegex(),text:qt(Cu.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ko={normal:Td,gfm:nx,pedantic:rx},Si={normal:Id,gfm:Cu,breaks:Cx,pedantic:Tx},Ix={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$f=t=>Ix[t];function oa(t,e){if(e){if(Fn.escapeTest.test(t))return t.replace(Fn.escapeReplace,$f)}else if(Fn.escapeTestNoEncode.test(t))return t.replace(Fn.escapeReplaceNoEncode,$f);return t}function ev(t){try{t=encodeURI(t).replace(Fn.percentDecode,"%")}catch{return null}return t}function tv(t,e){var s;let n=t.replace(Fn.findPipe,(i,o,u)=>{let f=!1,v=o;for(;--v>=0&&u[v]==="\\";)f=!f;return f?"|":" |"}),r=n.split(Fn.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((s=r.at(-1))!=null&&s.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Fn.slashPipe,"|");return r}function Ei(t,e,n){let r=t.length;if(r===0)return"";let a=0;for(;a<r&&t.charAt(r-a-1)===e;)a++;return t.slice(0,r-a)}function Px(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function Mx(t,e=0){let n=e,r="";for(let a of t)if(a==="	"){let s=4-n%4;r+=" ".repeat(s),n+=s}else r+=a,n++;return r}function nv(t,e,n,r,a){let s=e.href,i=e.title||null,o=t[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:i,text:o,tokens:r.inlineTokens(o)};return r.state.inLink=!1,u}function Ox(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let a=r[1];return e.split(`
`).map(s=>{let i=s.match(n.other.beginningSpace);if(i===null)return s;let[o]=i;return o.length>=a.length?s.slice(a.length):s}).join(`
`)}var yl=class{constructor(t){pt(this,"options");pt(this,"rules");pt(this,"lexer");this.options=t||Ts}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Ei(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=Ox(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=Ei(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Ei(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=Ei(e[0],`
`).split(`
`),r="",a="",s=[];for(;n.length>0;){let i=!1,o=[],u;for(u=0;u<n.length;u++)if(this.rules.other.blockquoteStart.test(n[u]))o.push(n[u]),i=!0;else if(!i)o.push(n[u]);else break;n=n.slice(u);let f=o.join(`
`),v=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${f}`:f,a=a?`${a}
${v}`:v;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(v,s,!0),this.lexer.state.top=p,n.length===0)break;let h=s.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.blockquote(x);s[s.length-1]=k,r=r.substring(0,r.length-m.raw.length)+k.raw,a=a.substring(0,a.length-m.text.length)+k.text;break}else if((h==null?void 0:h.type)==="list"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.list(x);s[s.length-1]=k,r=r.substring(0,r.length-h.raw.length)+k.raw,a=a.substring(0,a.length-m.raw.length)+k.raw,n=x.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:a}}}list(t){var n,r;let e=this.rules.block.list.exec(t);if(e){let a=e[1].trim(),s=a.length>1,i={type:"list",raw:"",ordered:s,start:s?+a.slice(0,-1):"",loose:!1,items:[]};a=s?`\\d{1,9}\\${a.slice(-1)}`:`\\${a}`,this.options.pedantic&&(a=s?a:"[*+-]");let o=this.rules.other.listItemRegex(a),u=!1;for(;t;){let v=!1,p="",h="";if(!(e=o.exec(t))||this.rules.block.hr.test(t))break;p=e[0],t=t.substring(p.length);let m=Mx(e[2].split(`
`,1)[0],e[1].length),x=t.split(`
`,1)[0],k=!m.trim(),T=0;if(this.options.pedantic?(T=2,h=m.trimStart()):k?T=e[1].length+1:(T=m.search(this.rules.other.nonSpaceChar),T=T>4?1:T,h=m.slice(T),T+=e[1].length),k&&this.rules.other.blankLine.test(x)&&(p+=x+`
`,t=t.substring(x.length+1),v=!0),!v){let N=this.rules.other.nextBulletRegex(T),z=this.rules.other.hrRegex(T),G=this.rules.other.fencesBeginRegex(T),S=this.rules.other.headingBeginRegex(T),j=this.rules.other.htmlBeginRegex(T),L=this.rules.other.blockquoteBeginRegex(T);for(;t;){let D=t.split(`
`,1)[0],J;if(x=D,this.options.pedantic?(x=x.replace(this.rules.other.listReplaceNesting,"  "),J=x):J=x.replace(this.rules.other.tabCharGlobal,"    "),G.test(x)||S.test(x)||j.test(x)||L.test(x)||N.test(x)||z.test(x))break;if(J.search(this.rules.other.nonSpaceChar)>=T||!x.trim())h+=`
`+J.slice(T);else{if(k||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||G.test(m)||S.test(m)||z.test(m))break;h+=`
`+x}k=!x.trim(),p+=D+`
`,t=t.substring(D.length+1),m=J.slice(T)}}i.loose||(u?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(u=!0)),i.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(h),loose:!1,text:h,tokens:[]}),i.raw+=p}let f=i.items.at(-1);if(f)f.raw=f.raw.trimEnd(),f.text=f.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let v of i.items){if(this.lexer.state.top=!1,v.tokens=this.lexer.blockTokens(v.text,[]),v.task){if(v.text=v.text.replace(this.rules.other.listReplaceTask,""),((n=v.tokens[0])==null?void 0:n.type)==="text"||((r=v.tokens[0])==null?void 0:r.type)==="paragraph"){v.tokens[0].raw=v.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),v.tokens[0].text=v.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let h=this.lexer.inlineQueue.length-1;h>=0;h--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[h].src)){this.lexer.inlineQueue[h].src=this.lexer.inlineQueue[h].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(v.raw);if(p){let h={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};v.checked=h.checked,i.loose?v.tokens[0]&&["paragraph","text"].includes(v.tokens[0].type)&&"tokens"in v.tokens[0]&&v.tokens[0].tokens?(v.tokens[0].raw=h.raw+v.tokens[0].raw,v.tokens[0].text=h.raw+v.tokens[0].text,v.tokens[0].tokens.unshift(h)):v.tokens.unshift({type:"paragraph",raw:h.raw,text:h.raw,tokens:[h]}):v.tokens.unshift(h)}}if(!i.loose){let p=v.tokens.filter(m=>m.type==="space"),h=p.length>0&&p.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=h}}if(i.loose)for(let v of i.items){v.loose=!0;for(let p of v.tokens)p.type==="text"&&(p.type="paragraph")}return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:a}}}table(t){var i;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=tv(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(i=e[3])!=null&&i.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<n.length;o++)s.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:s.align[o]});for(let o of a)s.rows.push(tv(o,s.header.length).map((u,f)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:s.align[f]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=Ei(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Px(e[2],"()");if(s===-2)return;if(s>-1){let i=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,i).trim(),e[3]=""}}let r=e[2],a="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],a=s[3])}else a=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),nv(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[r.toLowerCase()];if(!a){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return nv(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,o=a,u=0,f=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,e=e.slice(-1*t.length+a);(r=f.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(i=[...s].length,r[3]||r[4]){o+=i;continue}else if((r[5]||r[6])&&a%3&&!((a+i)%3)){u+=i;continue}if(o-=i,o>0)continue;i=Math.min(i,i+o+u);let v=[...r[0]][0].length,p=t.slice(0,a+r.index+v+i);if(Math.min(a,i)%2){let m=p.slice(1,-1);return{type:"em",raw:p,text:m,tokens:this.lexer.inlineTokens(m)}}let h=p.slice(2,-2);return{type:"strong",raw:p,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let r=this.rules.inline.delLDelim.exec(t);if(r&&(!r[1]||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,o=a,u=this.rules.inline.delRDelim;for(u.lastIndex=0,e=e.slice(-1*t.length+a);(r=u.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s||(i=[...s].length,i!==a))continue;if(r[3]||r[4]){o+=i;continue}if(o-=i,o>0)continue;i=Math.min(i,i+o);let f=[...r[0]][0].length,v=t.slice(0,a+r.index+f+i),p=v.slice(a,-a);return{type:"del",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,a;if(e[2]==="@")r=e[0],a="mailto:"+r;else{let s;do s=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(s!==e[0]);r=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Cr=class Iu{constructor(e){pt(this,"tokens");pt(this,"options");pt(this,"state");pt(this,"inlineQueue");pt(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ts,this.options.tokenizer=this.options.tokenizer||new yl,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Fn,block:Ko.normal,inline:Si.normal};this.options.pedantic?(n.block=Ko.pedantic,n.inline=Si.pedantic):this.options.gfm&&(n.block=Ko.gfm,this.options.breaks?n.inline=Si.breaks:n.inline=Si.gfm),this.tokenizer.rules=n}static get rules(){return{block:Ko,inline:Si}}static lex(e,n){return new Iu(n).lex(e)}static lexInline(e,n){return new Iu(n).inlineTokens(e)}lex(e){e=e.replace(Fn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var a,s,i;for(this.options.pedantic&&(e=e.replace(Fn.tabCharGlobal,"    ").replace(Fn.spaceLine,""));e;){let o;if((s=(a=this.options.extensions)==null?void 0:a.block)!=null&&s.some(f=>(o=f.call({lexer:this},e,n))?(e=e.substring(o.raw.length),n.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);let f=n.at(-1);o.raw.length===1&&f!==void 0?f.raw+=`
`:n.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+o.raw,f.text+=`
`+o.text,this.inlineQueue.at(-1).src=f.text):n.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+o.raw,f.text+=`
`+o.raw,this.inlineQueue.at(-1).src=f.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title},n.push(o));continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),n.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),n.push(o);continue}let u=e;if((i=this.options.extensions)!=null&&i.startBlock){let f=1/0,v=e.slice(1),p;this.options.extensions.startBlock.forEach(h=>{p=h.call({lexer:this},v),typeof p=="number"&&p>=0&&(f=Math.min(f,p))}),f<1/0&&f>=0&&(u=e.substring(0,f+1))}if(this.state.top&&(o=this.tokenizer.paragraph(u))){let f=n.at(-1);r&&(f==null?void 0:f.type)==="paragraph"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+o.raw,f.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(o),r=u.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+o.raw,f.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(o);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,f,v,p,h;let r=e,a=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)m.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=a[2]?a[2].length:0,r=r.slice(0,a.index+s)+"["+"a".repeat(a[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((f=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:f.call({lexer:this},r))??r;let i=!1,o="";for(;e;){i||(o=""),i=!1;let m;if((p=(v=this.options.extensions)==null?void 0:v.inline)!=null&&p.some(k=>(m=k.call({lexer:this},e,n))?(e=e.substring(m.raw.length),n.push(m),!0):!1))continue;if(m=this.tokenizer.escape(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.tag(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.link(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(m.raw.length);let k=n.at(-1);m.type==="text"&&(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(m=this.tokenizer.emStrong(e,r,o)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.codespan(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.br(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.del(e,r,o)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.autolink(e)){e=e.substring(m.raw.length),n.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(e))){e=e.substring(m.raw.length),n.push(m);continue}let x=e;if((h=this.options.extensions)!=null&&h.startInline){let k=1/0,T=e.slice(1),N;this.options.extensions.startInline.forEach(z=>{N=z.call({lexer:this},T),typeof N=="number"&&N>=0&&(k=Math.min(k,N))}),k<1/0&&k>=0&&(x=e.substring(0,k+1))}if(m=this.tokenizer.inlineText(x)){e=e.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(o=m.raw.slice(-1)),i=!0;let k=n.at(-1);(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(e){let k="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return n}},bl=class{constructor(t){pt(this,"options");pt(this,"parser");this.options=t||Ts}space(t){return""}code({text:t,lang:e,escaped:n}){var s;let r=(s=(e||"").match(Fn.notSpaceStart))==null?void 0:s[0],a=t.replace(Fn.endingNewline,"")+`
`;return r?'<pre><code class="language-'+oa(r)+'">'+(n?a:oa(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:oa(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let i=0;i<t.items.length;i++){let o=t.items[i];r+=this.listitem(o)}let a=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+a+s+`>
`+r+"</"+a+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let r="";for(let a=0;a<t.rows.length;a++){let s=t.rows[a];n="";for(let i=0;i<s.length;i++)n+=this.tablecell(s[i]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${oa(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),a=ev(t);if(a===null)return r;t=a;let s='<a href="'+t+'"';return e&&(s+=' title="'+oa(e)+'"'),s+=">"+r+"</a>",s}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=ev(t);if(a===null)return oa(n);t=a;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${oa(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:oa(t.text)}},Pd=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Ir=class Pu{constructor(e){pt(this,"options");pt(this,"renderer");pt(this,"textRenderer");this.options=e||Ts,this.options.renderer=this.options.renderer||new bl,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Pd}static parse(e,n){return new Pu(n).parse(e)}static parseInline(e,n){return new Pu(n).parseInline(e)}parse(e){var r,a;let n="";for(let s=0;s<e.length;s++){let i=e[s];if((a=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&a[i.type]){let u=i,f=this.options.extensions.renderers[u.type].call({parser:this},u);if(f!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(u.type)){n+=f||"";continue}}let o=i;switch(o.type){case"space":{n+=this.renderer.space(o);break}case"hr":{n+=this.renderer.hr(o);break}case"heading":{n+=this.renderer.heading(o);break}case"code":{n+=this.renderer.code(o);break}case"table":{n+=this.renderer.table(o);break}case"blockquote":{n+=this.renderer.blockquote(o);break}case"list":{n+=this.renderer.list(o);break}case"checkbox":{n+=this.renderer.checkbox(o);break}case"html":{n+=this.renderer.html(o);break}case"def":{n+=this.renderer.def(o);break}case"paragraph":{n+=this.renderer.paragraph(o);break}case"text":{n+=this.renderer.text(o);break}default:{let u='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return n}parseInline(e,n=this.renderer){var a,s;let r="";for(let i=0;i<e.length;i++){let o=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[o.type]){let f=this.options.extensions.renderers[o.type].call({parser:this},o);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=f||"";continue}}let u=o;switch(u.type){case"escape":{r+=n.text(u);break}case"html":{r+=n.html(u);break}case"link":{r+=n.link(u);break}case"image":{r+=n.image(u);break}case"checkbox":{r+=n.checkbox(u);break}case"strong":{r+=n.strong(u);break}case"em":{r+=n.em(u);break}case"codespan":{r+=n.codespan(u);break}case"br":{r+=n.br(u);break}case"del":{r+=n.del(u);break}case"text":{r+=n.text(u);break}default:{let f='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return r}},Jo,Ri=(Jo=class{constructor(t){pt(this,"options");pt(this,"block");this.options=t||Ts}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Cr.lex:Cr.lexInline}provideParser(){return this.block?Ir.parse:Ir.parseInline}},pt(Jo,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),pt(Jo,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Jo),Nx=class{constructor(...t){pt(this,"defaults",xd());pt(this,"options",this.setOptions);pt(this,"parse",this.parseMarkdown(!0));pt(this,"parseInline",this.parseMarkdown(!1));pt(this,"Parser",Ir);pt(this,"Renderer",bl);pt(this,"TextRenderer",Pd);pt(this,"Lexer",Cr);pt(this,"Tokenizer",yl);pt(this,"Hooks",Ri);this.use(...t)}walkTokens(t,e){var r,a;let n=[];for(let s of t)switch(n=n.concat(e.call(this,s)),s.type){case"table":{let i=s;for(let o of i.header)n=n.concat(this.walkTokens(o.tokens,e));for(let o of i.rows)for(let u of o)n=n.concat(this.walkTokens(u.tokens,e));break}case"list":{let i=s;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=s;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[i.type]?this.defaults.extensions.childTokens[i.type].forEach(o=>{let u=i[o].flat(1/0);n=n.concat(this.walkTokens(u,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let s=e.renderers[a.name];s?e.renderers[a.name]=function(...i){let o=a.renderer.apply(this,i);return o===!1&&(o=s.apply(this,i)),o}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[a.level];s?s.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),r.extensions=e),n.renderer){let a=this.defaults.renderer||new bl(this.defaults);for(let s in n.renderer){if(!(s in a))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let i=s,o=n.renderer[i],u=a[i];a[i]=(...f)=>{let v=o.apply(a,f);return v===!1&&(v=u.apply(a,f)),v||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new yl(this.defaults);for(let s in n.tokenizer){if(!(s in a))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let i=s,o=n.tokenizer[i],u=a[i];a[i]=(...f)=>{let v=o.apply(a,f);return v===!1&&(v=u.apply(a,f)),v}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Ri;for(let s in n.hooks){if(!(s in a))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let i=s,o=n.hooks[i],u=a[i];Ri.passThroughHooks.has(s)?a[i]=f=>{if(this.defaults.async&&Ri.passThroughHooksRespectAsync.has(s))return(async()=>{let p=await o.call(a,f);return u.call(a,p)})();let v=o.call(a,f);return u.call(a,v)}:a[i]=(...f)=>{if(this.defaults.async)return(async()=>{let p=await o.apply(a,f);return p===!1&&(p=await u.apply(a,f)),p})();let v=o.apply(a,f);return v===!1&&(v=u.apply(a,f)),v}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(i){let o=[];return o.push(s.call(this,i)),a&&(o=o.concat(a.call(this,i))),o}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Cr.lex(t,e??this.defaults)}parser(t,e){return Ir.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},a={...this.defaults,...r},s=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let i=a.hooks?await a.hooks.preprocess(e):e,o=await(a.hooks?await a.hooks.provideLexer():t?Cr.lex:Cr.lexInline)(i,a),u=a.hooks?await a.hooks.processAllTokens(o):o;a.walkTokens&&await Promise.all(this.walkTokens(u,a.walkTokens));let f=await(a.hooks?await a.hooks.provideParser():t?Ir.parse:Ir.parseInline)(u,a);return a.hooks?await a.hooks.postprocess(f):f})().catch(s);try{a.hooks&&(e=a.hooks.preprocess(e));let i=(a.hooks?a.hooks.provideLexer():t?Cr.lex:Cr.lexInline)(e,a);a.hooks&&(i=a.hooks.processAllTokens(i)),a.walkTokens&&this.walkTokens(i,a.walkTokens);let o=(a.hooks?a.hooks.provideParser():t?Ir.parse:Ir.parseInline)(i,a);return a.hooks&&(o=a.hooks.postprocess(o)),o}catch(i){return s(i)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+oa(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},ms=new Nx;function Qt(t,e){return ms.parse(t,e)}Qt.options=Qt.setOptions=function(t){return ms.setOptions(t),Qt.defaults=ms.defaults,Gp(Qt.defaults),Qt};Qt.getDefaults=xd;Qt.defaults=Ts;Qt.use=function(...t){return ms.use(...t),Qt.defaults=ms.defaults,Gp(Qt.defaults),Qt};Qt.walkTokens=function(t,e){return ms.walkTokens(t,e)};Qt.parseInline=ms.parseInline;Qt.Parser=Ir;Qt.parser=Ir.parse;Qt.Renderer=bl;Qt.TextRenderer=Pd;Qt.Lexer=Cr;Qt.lexer=Cr.lex;Qt.Tokenizer=yl;Qt.Hooks=Ri;Qt.parse=Qt;Qt.options;Qt.setOptions;Qt.use;Qt.walkTokens;Qt.parseInline;Ir.parse;Cr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:ag,setPrototypeOf:rv,isFrozen:Rx,getPrototypeOf:Dx,getOwnPropertyDescriptor:Lx}=Object;let{freeze:Kn,seal:wr,create:Mu}=Object,{apply:Ou,construct:Nu}=typeof Reflect<"u"&&Reflect;Kn||(Kn=function(e){return e});wr||(wr=function(e){return e});Ou||(Ou=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return e.apply(n,a)});Nu||(Nu=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const Ho=Hn(Array.prototype.forEach),jx=Hn(Array.prototype.lastIndexOf),av=Hn(Array.prototype.pop),Ai=Hn(Array.prototype.push),zx=Hn(Array.prototype.splice),sl=Hn(String.prototype.toLowerCase),qc=Hn(String.prototype.toString),Fc=Hn(String.prototype.match),Ti=Hn(String.prototype.replace),Bx=Hn(String.prototype.indexOf),qx=Hn(String.prototype.trim),Er=Hn(Object.prototype.hasOwnProperty),Bn=Hn(RegExp.prototype.test),Ci=Fx(TypeError);function Hn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Ou(t,e,r)}}function Fx(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Nu(t,n)}}function Mt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:sl;rv&&rv(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const s=n(a);s!==a&&(Rx(e)||(e[r]=s),a=s)}t[a]=!0}return t}function Kx(t){for(let e=0;e<t.length;e++)Er(t,e)||(t[e]=null);return t}function Kr(t){const e=Mu(null);for(const[n,r]of ag(t))Er(t,n)&&(Array.isArray(r)?e[n]=Kx(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=Kr(r):e[n]=r);return e}function Ii(t,e){for(;t!==null;){const r=Lx(t,e);if(r){if(r.get)return Hn(r.get);if(typeof r.value=="function")return Hn(r.value)}t=Dx(t)}function n(){return null}return n}const sv=Kn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Kc=Kn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Hc=Kn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Hx=Kn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Vc=Kn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Vx=Kn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),iv=Kn(["#text"]),ov=Kn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Uc=Kn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),lv=Kn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Vo=Kn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ux=wr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Gx=wr(/<%[\w\W]*|[\w\W]*%>/gm),Wx=wr(/\$\{[\w\W]*/gm),Yx=wr(/^data-[\-\w.\u00B7-\uFFFF]+$/),Xx=wr(/^aria-[\-\w]+$/),sg=wr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Zx=wr(/^(?:\w+script|data):/i),Qx=wr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ig=wr(/^html$/i),Jx=wr(/^[a-z][.\w]*(-[.\w]+)+$/i);var cv=Object.freeze({__proto__:null,ARIA_ATTR:Xx,ATTR_WHITESPACE:Qx,CUSTOM_ELEMENT:Jx,DATA_ATTR:Yx,DOCTYPE_NAME:ig,ERB_EXPR:Gx,IS_ALLOWED_URI:sg,IS_SCRIPT_OR_DATA:Zx,MUSTACHE_EXPR:Ux,TMPLIT_EXPR:Wx});const Pi={element:1,text:3,progressingInstruction:7,comment:8,document:9},$x=function(){return typeof window>"u"?null:window},ek=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},uv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function og(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$x();const e=at=>og(at);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Pi.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:o,Element:u,NodeFilter:f,NamedNodeMap:v=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:h,trustedTypes:m}=t,x=u.prototype,k=Ii(x,"cloneNode"),T=Ii(x,"remove"),N=Ii(x,"nextSibling"),z=Ii(x,"childNodes"),G=Ii(x,"parentNode");if(typeof i=="function"){const at=n.createElement("template");at.content&&at.content.ownerDocument&&(n=at.content.ownerDocument)}let S,j="";const{implementation:L,createNodeIterator:D,createDocumentFragment:J,getElementsByTagName:ae}=n,{importNode:ke}=r;let X=uv();e.isSupported=typeof ag=="function"&&typeof G=="function"&&L&&L.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:A,ERB_EXPR:K,TMPLIT_EXPR:P,DATA_ATTR:O,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:Q,ATTR_WHITESPACE:W,CUSTOM_ELEMENT:Z}=cv;let{IS_ALLOWED_URI:B}=cv,ee=null;const ne=Mt({},[...sv,...Kc,...Hc,...Vc,...iv]);let H=null;const U=Mt({},[...ov,...Uc,...lv,...Vo]);let le=Object.seal(Mu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Y=null,ue=null;const be=Object.seal(Mu(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ge=!0,re=!0,Te=!1,_e=!0,Pe=!1,He=!0,Ze=!1,vt=!1,ht=!1,je=!1,De=!1,Fe=!1,Ne=!0,Je=!1;const ut="user-content-";let $e=!0,it=!1,rt={},We=null;const mt=Mt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let dt=null;const Rt=Mt({},["audio","video","img","source","image","track"]);let Ft=null;const xt=Mt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),yt="http://www.w3.org/1998/Math/MathML",bt="http://www.w3.org/2000/svg",lt="http://www.w3.org/1999/xhtml";let ze=lt,Ot=!1,Dt=null;const zt=Mt({},[yt,bt,lt],qc);let Re=Mt({},["mi","mo","mn","ms","mtext"]),Yt=Mt({},["annotation-xml"]);const zn=Mt({},["title","style","font","a","script"]);let ye=null;const un=["application/xhtml+xml","text/html"],Cn="text/html";let At=null,Rn=null;const Xt=n.createElement("form"),ft=function(oe){return oe instanceof RegExp||oe instanceof Function},ot=function(){let oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Rn&&Rn===oe)){if((!oe||typeof oe!="object")&&(oe={}),oe=Kr(oe),ye=un.indexOf(oe.PARSER_MEDIA_TYPE)===-1?Cn:oe.PARSER_MEDIA_TYPE,At=ye==="application/xhtml+xml"?qc:sl,ee=Er(oe,"ALLOWED_TAGS")?Mt({},oe.ALLOWED_TAGS,At):ne,H=Er(oe,"ALLOWED_ATTR")?Mt({},oe.ALLOWED_ATTR,At):U,Dt=Er(oe,"ALLOWED_NAMESPACES")?Mt({},oe.ALLOWED_NAMESPACES,qc):zt,Ft=Er(oe,"ADD_URI_SAFE_ATTR")?Mt(Kr(xt),oe.ADD_URI_SAFE_ATTR,At):xt,dt=Er(oe,"ADD_DATA_URI_TAGS")?Mt(Kr(Rt),oe.ADD_DATA_URI_TAGS,At):Rt,We=Er(oe,"FORBID_CONTENTS")?Mt({},oe.FORBID_CONTENTS,At):mt,Y=Er(oe,"FORBID_TAGS")?Mt({},oe.FORBID_TAGS,At):Kr({}),ue=Er(oe,"FORBID_ATTR")?Mt({},oe.FORBID_ATTR,At):Kr({}),rt=Er(oe,"USE_PROFILES")?oe.USE_PROFILES:!1,ge=oe.ALLOW_ARIA_ATTR!==!1,re=oe.ALLOW_DATA_ATTR!==!1,Te=oe.ALLOW_UNKNOWN_PROTOCOLS||!1,_e=oe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=oe.SAFE_FOR_TEMPLATES||!1,He=oe.SAFE_FOR_XML!==!1,Ze=oe.WHOLE_DOCUMENT||!1,je=oe.RETURN_DOM||!1,De=oe.RETURN_DOM_FRAGMENT||!1,Fe=oe.RETURN_TRUSTED_TYPE||!1,ht=oe.FORCE_BODY||!1,Ne=oe.SANITIZE_DOM!==!1,Je=oe.SANITIZE_NAMED_PROPS||!1,$e=oe.KEEP_CONTENT!==!1,it=oe.IN_PLACE||!1,B=oe.ALLOWED_URI_REGEXP||sg,ze=oe.NAMESPACE||lt,Re=oe.MATHML_TEXT_INTEGRATION_POINTS||Re,Yt=oe.HTML_INTEGRATION_POINTS||Yt,le=oe.CUSTOM_ELEMENT_HANDLING||{},oe.CUSTOM_ELEMENT_HANDLING&&ft(oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&ft(oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&typeof oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(re=!1),De&&(je=!0),rt&&(ee=Mt({},iv),H=[],rt.html===!0&&(Mt(ee,sv),Mt(H,ov)),rt.svg===!0&&(Mt(ee,Kc),Mt(H,Uc),Mt(H,Vo)),rt.svgFilters===!0&&(Mt(ee,Hc),Mt(H,Uc),Mt(H,Vo)),rt.mathMl===!0&&(Mt(ee,Vc),Mt(H,lv),Mt(H,Vo))),oe.ADD_TAGS&&(typeof oe.ADD_TAGS=="function"?be.tagCheck=oe.ADD_TAGS:(ee===ne&&(ee=Kr(ee)),Mt(ee,oe.ADD_TAGS,At))),oe.ADD_ATTR&&(typeof oe.ADD_ATTR=="function"?be.attributeCheck=oe.ADD_ATTR:(H===U&&(H=Kr(H)),Mt(H,oe.ADD_ATTR,At))),oe.ADD_URI_SAFE_ATTR&&Mt(Ft,oe.ADD_URI_SAFE_ATTR,At),oe.FORBID_CONTENTS&&(We===mt&&(We=Kr(We)),Mt(We,oe.FORBID_CONTENTS,At)),oe.ADD_FORBID_CONTENTS&&(We===mt&&(We=Kr(We)),Mt(We,oe.ADD_FORBID_CONTENTS,At)),$e&&(ee["#text"]=!0),Ze&&Mt(ee,["html","head","body"]),ee.table&&(Mt(ee,["tbody"]),delete Y.tbody),oe.TRUSTED_TYPES_POLICY){if(typeof oe.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ci('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof oe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ci('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=oe.TRUSTED_TYPES_POLICY,j=S.createHTML("")}else S===void 0&&(S=ek(m,a)),S!==null&&typeof j=="string"&&(j=S.createHTML(""));Kn&&Kn(oe),Rn=oe}},Ht=Mt({},[...Kc,...Hc,...Hx]),ct=Mt({},[...Vc,...Vx]),kt=function(oe){let qe=G(oe);(!qe||!qe.tagName)&&(qe={namespaceURI:ze,tagName:"template"});const Ve=sl(oe.tagName),Vt=sl(qe.tagName);return Dt[oe.namespaceURI]?oe.namespaceURI===bt?qe.namespaceURI===lt?Ve==="svg":qe.namespaceURI===yt?Ve==="svg"&&(Vt==="annotation-xml"||Re[Vt]):!!Ht[Ve]:oe.namespaceURI===yt?qe.namespaceURI===lt?Ve==="math":qe.namespaceURI===bt?Ve==="math"&&Yt[Vt]:!!ct[Ve]:oe.namespaceURI===lt?qe.namespaceURI===bt&&!Yt[Vt]||qe.namespaceURI===yt&&!Re[Vt]?!1:!ct[Ve]&&(zn[Ve]||!Ht[Ve]):!!(ye==="application/xhtml+xml"&&Dt[oe.namespaceURI]):!1},nn=function(oe){Ai(e.removed,{element:oe});try{G(oe).removeChild(oe)}catch{T(oe)}},an=function(oe,qe){try{Ai(e.removed,{attribute:qe.getAttributeNode(oe),from:qe})}catch{Ai(e.removed,{attribute:null,from:qe})}if(qe.removeAttribute(oe),oe==="is")if(je||De)try{nn(qe)}catch{}else try{qe.setAttribute(oe,"")}catch{}},Dn=function(oe){let qe=null,Ve=null;if(ht)oe="<remove></remove>"+oe;else{const dn=Fc(oe,/^[\r\n\t ]+/);Ve=dn&&dn[0]}ye==="application/xhtml+xml"&&ze===lt&&(oe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+oe+"</body></html>");const Vt=S?S.createHTML(oe):oe;if(ze===lt)try{qe=new h().parseFromString(Vt,ye)}catch{}if(!qe||!qe.documentElement){qe=L.createDocument(ze,"template",null);try{qe.documentElement.innerHTML=Ot?j:Vt}catch{}}const sn=qe.body||qe.documentElement;return oe&&Ve&&sn.insertBefore(n.createTextNode(Ve),sn.childNodes[0]||null),ze===lt?ae.call(qe,Ze?"html":"body")[0]:Ze?qe.documentElement:sn},Zt=function(oe){return D.call(oe.ownerDocument||oe,oe,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},en=function(oe){return oe instanceof p&&(typeof oe.nodeName!="string"||typeof oe.textContent!="string"||typeof oe.removeChild!="function"||!(oe.attributes instanceof v)||typeof oe.removeAttribute!="function"||typeof oe.setAttribute!="function"||typeof oe.namespaceURI!="string"||typeof oe.insertBefore!="function"||typeof oe.hasChildNodes!="function")},_n=function(oe){return typeof o=="function"&&oe instanceof o};function hn(at,oe,qe){Ho(at,Ve=>{Ve.call(e,oe,qe,Rn)})}const rr=function(oe){let qe=null;if(hn(X.beforeSanitizeElements,oe,null),en(oe))return nn(oe),!0;const Ve=At(oe.nodeName);if(hn(X.uponSanitizeElement,oe,{tagName:Ve,allowedTags:ee}),He&&oe.hasChildNodes()&&!_n(oe.firstElementChild)&&Bn(/<[/\w!]/g,oe.innerHTML)&&Bn(/<[/\w!]/g,oe.textContent)||oe.nodeType===Pi.progressingInstruction||He&&oe.nodeType===Pi.comment&&Bn(/<[/\w]/g,oe.data))return nn(oe),!0;if(!(be.tagCheck instanceof Function&&be.tagCheck(Ve))&&(!ee[Ve]||Y[Ve])){if(!Y[Ve]&&ka(Ve)&&(le.tagNameCheck instanceof RegExp&&Bn(le.tagNameCheck,Ve)||le.tagNameCheck instanceof Function&&le.tagNameCheck(Ve)))return!1;if($e&&!We[Ve]){const Vt=G(oe)||oe.parentNode,sn=z(oe)||oe.childNodes;if(sn&&Vt){const dn=sn.length;for(let pn=dn-1;pn>=0;--pn){const Un=k(sn[pn],!0);Un.__removalCount=(oe.__removalCount||0)+1,Vt.insertBefore(Un,N(oe))}}}return nn(oe),!0}return oe instanceof u&&!kt(oe)||(Ve==="noscript"||Ve==="noembed"||Ve==="noframes")&&Bn(/<\/no(script|embed|frames)/i,oe.innerHTML)?(nn(oe),!0):(Pe&&oe.nodeType===Pi.text&&(qe=oe.textContent,Ho([A,K,P],Vt=>{qe=Ti(qe,Vt," ")}),oe.textContent!==qe&&(Ai(e.removed,{element:oe.cloneNode()}),oe.textContent=qe)),hn(X.afterSanitizeElements,oe,null),!1)},ra=function(oe,qe,Ve){if(Ne&&(qe==="id"||qe==="name")&&(Ve in n||Ve in Xt))return!1;if(!(re&&!ue[qe]&&Bn(O,qe))){if(!(ge&&Bn(I,qe))){if(!(be.attributeCheck instanceof Function&&be.attributeCheck(qe,oe))){if(!H[qe]||ue[qe]){if(!(ka(oe)&&(le.tagNameCheck instanceof RegExp&&Bn(le.tagNameCheck,oe)||le.tagNameCheck instanceof Function&&le.tagNameCheck(oe))&&(le.attributeNameCheck instanceof RegExp&&Bn(le.attributeNameCheck,qe)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(qe,oe))||qe==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&Bn(le.tagNameCheck,Ve)||le.tagNameCheck instanceof Function&&le.tagNameCheck(Ve))))return!1}else if(!Ft[qe]){if(!Bn(B,Ti(Ve,W,""))){if(!((qe==="src"||qe==="xlink:href"||qe==="href")&&oe!=="script"&&Bx(Ve,"data:")===0&&dt[oe])){if(!(Te&&!Bn(Q,Ti(Ve,W,"")))){if(Ve)return!1}}}}}}}return!0},ka=function(oe){return oe!=="annotation-xml"&&Fc(oe,Z)},Vn=function(oe){hn(X.beforeSanitizeAttributes,oe,null);const{attributes:qe}=oe;if(!qe||en(oe))return;const Ve={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let Vt=qe.length;for(;Vt--;){const sn=qe[Vt],{name:dn,namespaceURI:pn,value:Un}=sn,Br=At(dn),Va=Un;let ln=dn==="value"?Va:qx(Va);if(Ve.attrName=Br,Ve.attrValue=ln,Ve.keepAttr=!0,Ve.forceKeepAttr=void 0,hn(X.uponSanitizeAttribute,oe,Ve),ln=Ve.attrValue,Je&&(Br==="id"||Br==="name")&&(an(dn,oe),ln=ut+ln),He&&Bn(/((--!?|])>)|<\/(style|title|textarea)/i,ln)){an(dn,oe);continue}if(Br==="attributename"&&Fc(ln,"href")){an(dn,oe);continue}if(Ve.forceKeepAttr)continue;if(!Ve.keepAttr){an(dn,oe);continue}if(!_e&&Bn(/\/>/i,ln)){an(dn,oe);continue}Pe&&Ho([A,K,P],Ua=>{ln=Ti(ln,Ua," ")});const fi=At(oe.nodeName);if(!ra(fi,Br,ln)){an(dn,oe);continue}if(S&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!pn)switch(m.getAttributeType(fi,Br)){case"TrustedHTML":{ln=S.createHTML(ln);break}case"TrustedScriptURL":{ln=S.createScriptURL(ln);break}}if(ln!==Va)try{pn?oe.setAttributeNS(pn,dn,ln):oe.setAttribute(dn,ln),en(oe)?nn(oe):av(e.removed)}catch{an(dn,oe)}}hn(X.afterSanitizeAttributes,oe,null)},Ps=function at(oe){let qe=null;const Ve=Zt(oe);for(hn(X.beforeSanitizeShadowDOM,oe,null);qe=Ve.nextNode();)hn(X.uponSanitizeShadowNode,qe,null),rr(qe),Vn(qe),qe.content instanceof s&&at(qe.content);hn(X.afterSanitizeShadowDOM,oe,null)};return e.sanitize=function(at){let oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},qe=null,Ve=null,Vt=null,sn=null;if(Ot=!at,Ot&&(at="<!-->"),typeof at!="string"&&!_n(at))if(typeof at.toString=="function"){if(at=at.toString(),typeof at!="string")throw Ci("dirty is not a string, aborting")}else throw Ci("toString is not a function");if(!e.isSupported)return at;if(vt||ot(oe),e.removed=[],typeof at=="string"&&(it=!1),it){if(at.nodeName){const Un=At(at.nodeName);if(!ee[Un]||Y[Un])throw Ci("root node is forbidden and cannot be sanitized in-place")}}else if(at instanceof o)qe=Dn("<!---->"),Ve=qe.ownerDocument.importNode(at,!0),Ve.nodeType===Pi.element&&Ve.nodeName==="BODY"||Ve.nodeName==="HTML"?qe=Ve:qe.appendChild(Ve);else{if(!je&&!Pe&&!Ze&&at.indexOf("<")===-1)return S&&Fe?S.createHTML(at):at;if(qe=Dn(at),!qe)return je?null:Fe?j:""}qe&&ht&&nn(qe.firstChild);const dn=Zt(it?at:qe);for(;Vt=dn.nextNode();)rr(Vt),Vn(Vt),Vt.content instanceof s&&Ps(Vt.content);if(it)return at;if(je){if(De)for(sn=J.call(qe.ownerDocument);qe.firstChild;)sn.appendChild(qe.firstChild);else sn=qe;return(H.shadowroot||H.shadowrootmode)&&(sn=ke.call(r,sn,!0)),sn}let pn=Ze?qe.outerHTML:qe.innerHTML;return Ze&&ee["!doctype"]&&qe.ownerDocument&&qe.ownerDocument.doctype&&qe.ownerDocument.doctype.name&&Bn(ig,qe.ownerDocument.doctype.name)&&(pn="<!DOCTYPE "+qe.ownerDocument.doctype.name+`>
`+pn),Pe&&Ho([A,K,P],Un=>{pn=Ti(pn,Un," ")}),S&&Fe?S.createHTML(pn):pn},e.setConfig=function(){let at=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ot(at),vt=!0},e.clearConfig=function(){Rn=null,vt=!1},e.isValidAttribute=function(at,oe,qe){Rn||ot({});const Ve=At(at),Vt=At(oe);return ra(Ve,Vt,qe)},e.addHook=function(at,oe){typeof oe=="function"&&Ai(X[at],oe)},e.removeHook=function(at,oe){if(oe!==void 0){const qe=jx(X[at],oe);return qe===-1?void 0:zx(X[at],qe,1)[0]}return av(X[at])},e.removeHooks=function(at){X[at]=[]},e.removeAllHooks=function(){X=uv()},e}var tk=og();function nk(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${dv(t.from)} |`),e.push(`| **To** | ${dv(t.to)} |`),e.push(`| **Date** | ${gd(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?rk(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function dv(t){return(t||"").replace(/\|/g,"\\|")}function rk(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Ru(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function ak(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),r=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||r>0&&r<=3)return!0;const a=e.toLowerCase();return a.includes("spacer")||a.includes("transparent")||a.includes("transp.gif")||a.includes("/track")&&a.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(a)?!0:a.includes("mail.google.com/mail/u/")&&a.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(a)||a.endsWith(".gif")&&a.includes("1x1"))}function Ru(t){var a;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const s=t.getAttribute("src")||"",i=t.getAttribute("alt")||"";return ak(t,s)?"":`![${i}](${s})`}const n=Array.from(t.childNodes).map(Ru).join(""),r=n.trim();if(!r&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${r}

`;if(e==="blockquote")return`

> ${r.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const s=Number(e[1]);return`

${"#".repeat(s)} ${r}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((a=t.parentElement)==null?void 0:a.tagName.toLowerCase())==="ol"?"1.":"-"} ${r}
`;if(e==="a"){const s=t.getAttribute("href")||"";return!s||s.startsWith("mailto:")?r:r===s?s:`[${r}](${s})`}if(e==="strong"||e==="b")return`**${r}**`;if(e==="em"||e==="i")return`*${r}*`;if(e==="code")return`\`${r}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(i=>Ru(i).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const s=n.trim(),i=(s.match(/\|/g)||[]).length-1,o="| "+Array(Math.max(i,1)).fill("---").join(" | ")+" |";return`${s}${o}
`}return n}function sk(t){return _p(t,"md")}function fv(t,e,n="text/markdown;charset=utf-8"){const r=new Blob([t],{type:n}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function ik(t){return t.raw||null}function ok(t){const e=ik(t);return e?JSON.stringify(e,null,2):"null"}function lk(t){return _p(t,"json")}var ck=q('<button title="View as Markdown">.md</button>'),uk=q('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),dk=q('<pre class="md-raw svelte-1b0rzpb"> </pre>'),fk=q('<div class="md-preview svelte-1b0rzpb"><!></div>'),vk=q('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),hk=q('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),pk=q('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),gk=q('<pre class="message-text svelte-1b0rzpb"> </pre>'),mk=q('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),yk=q('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),bk=q('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function _k(t,e){tt(e,!0);let n=Ae(e,"loading",3,!1);Tn(()=>fr("MessageModal"));const r=new Qt.Renderer;r.link=({href:A,title:K,text:P})=>{const O=K?` title="${K}"`:"";return`<a href="${A}"${O} target="_blank" rel="noopener">${P}</a>`},Qt.setOptions({breaks:!0,gfm:!0,renderer:r});let a=Oe("email"),s=$(()=>e.message.body?nk(e.message):""),i=$(()=>ok(e.message)),o=Oe("raw");function u(A){M(a,l(a)===A?"email":A,!0),A==="markdown"&&M(o,"raw")}function f(){fv(l(s),sk(e.message))}function v(){fv(l(i),lk(e.message),"application/json;charset=utf-8")}function p(A){const K=Qt.parse(A);return tk.sanitize(K,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let h=Oe(null);Nn(()=>{var A;if(l(h)&&e.message.htmlBody&&!n()&&l(a)==="email"){const K=l(h).contentDocument||((A=l(h).contentWindow)==null?void 0:A.document);K&&(K.open(),K.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),K.close())}});var m=bk(),x=b(m),k=b(x),T=b(k),N=b(T),z=w(T,2),G=b(z);let S;var j=w(G,2);{var L=A=>{var K=ck();let P;se(()=>P=Pt(K,1,"action-btn svelte-1b0rzpb",null,P,{active:l(a)==="markdown"})),Ce("click",K,()=>u("markdown")),C(A,K)};pe(j,A=>{e.message.body&&A(L)})}var D=w(j,2),J=w(k,2);{var ae=A=>{var K=uk(),P=Ye(K),O=w(b(P),2),I=w(P,2),Q=b(I),W=b(Q);se(()=>te(W,l(i))),Ce("click",O,v),C(A,K)},ke=A=>{var K=vk(),P=Ye(K),O=b(P),I=b(O);let Q;var W=w(I,2);let Z;var B=w(O,2),ee=w(P,2),ne=b(ee);{var H=le=>{var Y=dk(),ue=b(Y);se(()=>te(ue,l(s))),C(le,Y)},U=le=>{var Y=fk(),ue=b(Y);ib(ue,()=>p(l(s))),C(le,Y)};pe(ne,le=>{l(o)==="raw"?le(H):le(U,!1)})}se(()=>{Q=Pt(I,1,"md-tab svelte-1b0rzpb",null,Q,{active:l(o)==="raw"}),Z=Pt(W,1,"md-tab svelte-1b0rzpb",null,Z,{active:l(o)==="preview"})}),Ce("click",I,()=>M(o,"raw")),Ce("click",W,()=>M(o,"preview")),Ce("click",B,f),C(A,K)},X=A=>{var K=yk(),P=Ye(K),O=b(P),I=w(b(O),2),Q=b(I),W=w(O,2),Z=w(b(W),2),B=b(Z),ee=w(W,2),ne=w(b(ee),2),H=b(ne),U=w(P,2),le=b(U);{var Y=re=>{var Te=hk();C(re,Te)},ue=re=>{var Te=pk();Es(Te,_e=>M(h,_e),()=>l(h)),C(re,Te)},be=re=>{var Te=gk(),_e=b(Te);se(()=>te(_e,e.message.body)),C(re,Te)},ge=re=>{var Te=mk();C(re,Te)};pe(le,re=>{n()?re(Y):e.message.htmlBody?re(ue,1):e.message.body?re(be,2):re(ge,!1)})}se(re=>{te(Q,e.message.from),te(B,e.message.to),te(H,re)},[()=>gd(e.message.date)]),C(A,K)};pe(J,A=>{l(a)==="json"?A(ae):l(a)==="markdown"?A(ke,1):A(X,!1)})}se(()=>{te(N,e.message.subject),S=Pt(G,1,"action-btn svelte-1b0rzpb",null,S,{active:l(a)==="json"})}),Ce("click",m,function(...A){var K;(K=e.onclose)==null||K.apply(this,A)}),Ce("click",x,A=>A.stopPropagation()),Ce("click",G,()=>u("json")),Ce("click",D,function(...A){var K;(K=e.onclose)==null||K.apply(this,A)}),C(t,m),nt()}$t(["click"]);var wk=q('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),xk=q('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),kk=q('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),Sk=q("<p> </p>"),Ek=q('<p>No emails in local storage. Click "Sync New" to download.</p>'),Ak=q('<div class="empty-state svelte-6ts5xm"><!></div>'),Tk=q('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Ck=q('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Ik(t,e){tt(e,!0),Tn(()=>fr("DashboardView"));let n=Ae(e,"error",3,null),r=Ae(e,"profile",3,null),a=Ae(e,"loadingProfile",3,!1),s=Ae(e,"emailMessages",19,()=>[]),i=Ae(e,"totalLocalMessages",3,0),o=Ae(e,"hasMoreLocal",3,!1),u=Ae(e,"loadingMessages",3,!1),f=Ae(e,"selectedMessage",3,null),v=Ae(e,"syncStatus",3,null),p=Ae(e,"syncProgress",3,null),h=Ae(e,"isSyncing",3,!1),m=Ae(e,"searchQuery",15);var x=Ck(),k=Ye(x),T=b(k);{var N=O=>{Up(O,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};pe(T,O=>{n()&&O(N)})}var z=w(T,2);C1(z,{get profile(){return r()},get loadingProfile(){return a()},get onsignout(){return e.onsignout}});var G=w(z,2);F1(G,{get syncStatus(){return v()},get syncProgress(){return p()},get isSyncing(){return h()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var S=w(G,2),j=b(S),L=w(j,2),D=b(L),J=w(S,2);{var ae=O=>{var I=xk(),Q=Ye(I),W=b(Q),Z=b(W),B=w(Q,2);V1(B,{get messages(){return s()},get onselect(){return e.onviewmessage}});var ee=w(B,2);{var ne=H=>{var U=wk(),le=b(U),Y=b(le);se(()=>{le.disabled=u(),te(Y,u()?"Loading...":"Load More")}),Ce("click",le,function(...ue){var be;(be=e.onloadmore)==null||be.apply(this,ue)}),C(H,U)};pe(ee,H=>{o()&&H(ne)})}se(H=>te(Z,`Showing ${s().length??""} of ${H??""}
        ${m()?" matching":""} emails`),[()=>i().toLocaleString()]),C(O,I)},ke=O=>{var I=kk();C(O,I)},X=O=>{var I=Ak(),Q=b(I);{var W=B=>{var ee=Sk(),ne=b(ee);se(()=>te(ne,`No emails match "${m()??""}".`)),C(B,ee)},Z=B=>{var ee=Ek();C(B,ee)};pe(Q,B=>{m()?B(W):B(Z,!1)})}C(O,I)},A=O=>{var I=Tk();C(O,I)};pe(J,O=>{var I;s().length>0?O(ae):u()?O(ke,1):(I=v())!=null&&I.synced?O(X,2):O(A,!1)})}var K=w(k,2);{var P=O=>{_k(O,{get message(){return f()},loading:!1,get onclose(){return e.onclosedetail}})};pe(K,O=>{f()&&O(P)})}se(()=>{L.disabled=u(),te(D,u()?"Searching...":"Search")}),Ce("keydown",j,O=>O.key==="Enter"&&e.onsearch()),ha(j,m),Ce("click",L,function(...O){var I;(I=e.onsearch)==null||I.apply(this,O)}),C(t,x),nt()}$t(["keydown","click"]);var Pk=q('<div class="dashboard svelte-1q5o2lv"><!></div>');function Mk(t,e){tt(e,!0);function n(_e){_e.key==="Escape"&&l(h)&&ne()}let r=null;Tn(async()=>{if(window.addEventListener("keydown",n),!l(o)){const _e=await Vi("googleClientId");M(o,_e||i,!0),M(u,_e||i,!0)}return()=>{window.removeEventListener("keydown",n),r&&clearTimeout(r)}});function a(){r&&clearTimeout(r);const _e=N0();if(_e<=0)return;const Pe=Math.max(0,_e-120*1e3);r=setTimeout(async()=>{try{const He=await Yf();M(v,He.access_token,!0),a()}catch{M(v,null),M(p,null),M(S,"Session expired. Please sign in again.")}},Pe)}async function s(){if(O0())return l(v);try{const _e=await Yf();return M(v,_e.access_token,!0),a(),l(v)}catch{return M(v,null),M(p,null),M(S,"Session expired. Please sign in again."),null}}const i="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let o=Oe(tn(i)),u=Oe(tn(i)),f=Oe(!1),v=Oe(null),p=Oe(null),h=Oe(null),m=Oe(""),x=Oe(tn([])),k=Oe(0),T=Oe(0),N=Oe(!1),z=Oe(!1),G=Oe(!1),S=Oe(null),j=Oe(null),L=Oe(null),D=Oe(!1);const J=50;Nn(()=>{l(v)&&(H(),W())});let ae=$(()=>!l(o)),ke=$(()=>l(o)===i),X=$(()=>!!l(v)),A=$(()=>l(x).length<l(k));Nn(()=>{l(o)&&!l(f)&&Xf(l(o)).then(async()=>{if(M(f,!0),!l(v)){const _e=await Wl();_e&&(M(v,_e.access_token,!0),a(),Q())}}).catch(_e=>{M(S,`Auth init failed: ${_e.message}`)})});async function K(){const _e=l(u).trim();_e&&(await Ui("googleClientId",_e),M(o,_e,!0),M(S,null))}async function P(){await fd("googleClientId"),M(o,""),M(u,i),M(f,!1),M(v,null),M(p,null),M(x,[],!0),M(k,0)}async function O(){M(S,null),M(z,!0);try{l(f)||(await Xf(l(o)),M(f,!0));const _e=await D0();M(v,_e.access_token,!0),a(),await Q()}catch(_e){M(S,_e.message,!0)}finally{M(z,!1)}}async function I(){if(r&&clearTimeout(r),l(v))try{await L0(l(v))}catch{}M(v,null),M(p,null),M(x,[],!0),M(k,0),M(h,null),M(S,null)}async function Q(){M(G,!0);try{const _e=await pp(l(v));if(!l(v))return;M(p,_e,!0)}catch(_e){if(!l(v))return;M(S,`Profile fetch failed: ${_e.message}`)}finally{M(G,!1)}}async function W(_e=!1){M(N,!0);try{const Pe=_e?l(T):0,He=await e_({query:l(m)||void 0,limit:J,offset:Pe});_e?M(x,[...l(x),...He.items],!0):M(x,He.items,!0),M(k,He.total,!0),M(T,l(x).length,!0)}catch(Pe){M(S,`Failed to load messages: ${Pe.message}`)}finally{M(N,!1)}}function Z(){M(T,0),W(!1)}function B(){W(!0)}function ee(_e){M(h,_e,!0)}function ne(){M(h,null)}async function H(){try{M(j,await r1(),!0)}catch{}}async function U(_e){if(l(D)||!l(v))return;const Pe=await s();if(!Pe)return;M(S,null),M(D,!0),M(L,null);const He=new AbortController;try{await t1(Pe,{limit:_e,onProgress:Ze=>{M(L,{...Ze},!0)},signal:He.signal}),await H(),await W(!1)}catch(Ze){if(Ze.name!=="AbortError"){if(!l(v))return;M(S,`Sync failed: ${Ze.message}`)}}finally{M(D,!1)}}async function le(_e){if(l(D)||!l(v))return;const Pe=await s();if(!Pe)return;M(S,null),M(D,!0),M(L,null);const He=new AbortController;try{await n1(Pe,{limit:_e,onProgress:Ze=>{M(L,{...Ze},!0)},signal:He.signal}),await H(),await W(!1)}catch(Ze){if(Ze.name!=="AbortError"){if(!l(v))return;M(S,`Sync more failed: ${Ze.message}`)}}finally{M(D,!1)}}async function Y(){try{await Fp(),await H(),M(x,[],!0),M(k,0),M(T,0)}catch(_e){M(S,`Failed to clear data: ${_e.message}`)}}var ue=Pk(),be=b(ue);{var ge=_e=>{d1(_e,{onsave:K,defaultClientId:i,get clientIdInput(){return l(u)},set clientIdInput(Pe){M(u,Pe,!0)}})},re=_e=>{S1(_e,{get clientId(){return l(o)},get isDefaultClientId(){return l(ke)},get error(){return l(S)},get loadingAuth(){return l(z)},onsignin:O,onclear:P,onsignout:I})},Te=_e=>{Ik(_e,{get error(){return l(S)},get profile(){return l(p)},get loadingProfile(){return l(G)},get emailMessages(){return l(x)},get totalLocalMessages(){return l(k)},get hasMoreLocal(){return l(A)},get loadingMessages(){return l(N)},get selectedMessage(){return l(h)},get syncStatus(){return l(j)},get syncProgress(){return l(L)},get isSyncing(){return l(D)},onsignout:I,onsearch:Z,onloadmore:B,onviewmessage:ee,onclosedetail:ne,ondismisserror:()=>M(S,null),onsync:U,onsyncmore:le,oncleardata:Y,get searchQuery(){return l(m)},set searchQuery(Pe){M(m,Pe,!0)}})};pe(be,_e=>{l(ae)?_e(ge):l(X)?_e(Te,!1):_e(re,1)})}C(t,ue),nt()}var Ok=q('<span class="err svelte-t1ig66"> </span>'),Nk=q('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Rk=q('<span class="stream-stats svelte-t1ig66"> </span>'),Dk=q('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),Lk=q('<span class="ei-group svelte-t1ig66"> </span>'),jk=q('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),zk=q('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),Bk=q('<span class="sep svelte-t1ig66">Â·</span> ',1),qk=q('<div class="ei-summary svelte-t1ig66"> </div>'),Fk=q('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Kk=q('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Hk=q("<!> <!> <!>",1),Vk=q('<div class="ei-error svelte-t1ig66"> </div>'),Uk=q('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Gk=q('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Wk=q('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Yk=q('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Xk=q(' <span class="sep svelte-t1ig66">Â·</span>',1),Zk=q('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Qk=q('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Jk=q('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),$k=q('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function e2(t,e){tt(e,!0);let n=Ae(e,"progress",3,null);function r(h){return!h||h<0?"â":h<1e3?`${Math.round(h)}ms`:`${(h/1e3).toFixed(1)}s`}function a(h){return h?h>=1e3?`${(h/1e3).toFixed(1)}k`:String(h):"0"}function s(h){if(!h)return"â";const m=h.replace(/<.*>/,"").trim();return m.length>30?m.slice(0,28)+"â¦":m}function i(h){if(!h)return"";try{return new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=$(()=>{var h;return(h=n())!=null&&h.total?Math.round(n().current/n().total*100):0}),u=$(()=>{var h;return((h=n())==null?void 0:h.phase)==="done"});var f=cn(),v=Ye(f);{var p=h=>{var m=$k(),x=b(m),k=b(x),T=b(k);{var N=ne=>{var H=yn();se(()=>te(H,`Scan complete â ${(n().classified||0)??""} classified`)),C(ne,H)},z=ne=>{var H=yn("Loading emailsâ¦");C(ne,H)},G=ne=>{var H=yn();se(()=>te(H,`Processing ${n().current??0??""} / ${n().total??0??""}`)),C(ne,H)};pe(T,ne=>{l(u)?ne(N):n().phase==="loading"?ne(z,1):ne(G,!1)})}var S=w(k,2),j=b(S),L=w(x,2),D=b(L);let J,ae;var ke=w(L,2);{var X=ne=>{var H=Nk(),U=b(H),le=w(U);{var Y=ge=>{var re=Ok(),Te=b(re);se(()=>te(Te,`Â· ${n().errors??""} errors`)),C(ge,re)};pe(le,ge=>{n().errors&&ge(Y)})}var ue=w(le,3),be=w(ue,2);se((ge,re,Te)=>{te(U,`${(n().classified||0)??""} classified `),te(ue,` ${ge??""} in + ${re??""} out `),te(be,` ${Te??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),C(ne,H)};pe(ke,ne=>{n().totals&&!l(u)&&ne(X)})}var A=w(ke,2);{var K=ne=>{var H=Dk(),U=b(H),le=b(U),Y=b(le),ue=w(le,2);{var be=Te=>{var _e=Rk(),Pe=b(_e);se(He=>te(Pe,`${He??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),C(Te,_e)};pe(ue,Te=>{var _e;(_e=n().live)!=null&&_e.tps&&Te(be)})}var ge=w(U,2),re=b(ge);se(()=>{te(Y,n().email.subject||"(no subject)"),te(re,n().streamingText||"Waiting for modelâ¦")}),C(ne,H)};pe(A,ne=>{!l(u)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&ne(K)})}var P=w(A,2);{var O=ne=>{var H=Gk(),U=b(H),le=w(b(U),2),Y=b(le),ue=w(U,2);Ct(ue,17,()=>n().results,Wt,(be,ge,re)=>{var Te=Uk();let _e;var Pe=b(Te),He=b(Pe);He.textContent=`${re+1}.`;var Ze=w(He,2),vt=b(Ze),ht=w(Ze,2);{var je=We=>{var mt=jk(),dt=Ye(mt),Rt=b(dt),Ft=w(dt,2);{var xt=yt=>{const bt=$(()=>Lr[l(ge).classification.group]);var lt=cn(),ze=Ye(lt);{var Ot=Dt=>{var zt=Lk();let Re;var Yt=b(zt);se(()=>{wt(zt,"title",l(bt).description),Re=jt(zt,"",Re,{color:l(bt).color}),te(Yt,l(bt).label)}),C(Dt,zt)};pe(ze,Dt=>{l(bt)&&Dt(Ot)})}C(yt,lt)};pe(Ft,yt=>{l(ge).classification.group&&yt(xt)})}se(()=>te(Rt,l(ge).classification.action)),C(We,mt)},De=We=>{var mt=zk();C(We,mt)};pe(ht,We=>{l(ge).success?We(je):We(De,!1)})}var Fe=w(Pe,2),Ne=b(Fe),Je=w(Ne);{var ut=We=>{var mt=Bk(),dt=w(Ye(mt),1,!0);se(Rt=>te(dt,Rt),[()=>i(l(ge).email.date)]),C(We,mt)};pe(Je,We=>{l(ge).email.date&&We(ut)})}var $e=w(Fe,2);{var it=We=>{var mt=Hk(),dt=Ye(mt);{var Rt=lt=>{var ze=qk(),Ot=b(ze);se(()=>te(Ot,l(ge).classification.summary)),C(lt,ze)};pe(dt,lt=>{l(ge).classification.summary&&lt(Rt)})}var Ft=w(dt,2);{var xt=lt=>{var ze=Fk(),Ot=b(ze),Dt=w(Ot,2),zt=w(Dt,2);se((Re,Yt)=>{te(Ot,`${Re??""} `),te(Dt,` ${(l(ge).stats.inputTokens||0)??""} in + ${(l(ge).stats.numTokens||0)??""} out `),te(zt,` ${Yt??""}`)},[()=>l(ge).stats.tps?`${l(ge).stats.tps.toFixed(0)} tok/s`:"â",()=>r(l(ge).stats.elapsed)]),C(lt,ze)};pe(Ft,lt=>{l(ge).stats&&lt(xt)})}var yt=w(Ft,2);{var bt=lt=>{var ze=Kk(),Ot=w(b(ze),2),Dt=b(Ot);se(()=>te(Dt,l(ge).rawResponse)),C(lt,ze)};pe(yt,lt=>{l(ge).rawResponse&&lt(bt)})}C(We,mt)},rt=We=>{var mt=Vk(),dt=b(mt);se(()=>te(dt,l(ge).error)),C(We,mt)};pe($e,We=>{l(ge).success?We(it):We(rt,!1)})}se(We=>{_e=Pt(Te,1,"email-item svelte-t1ig66",null,_e,{failed:!l(ge).success}),te(vt,l(ge).email.subject||"(no subject)"),te(Ne,We)},[()=>s(l(ge).email.from)]),C(be,Te)}),se(()=>te(Y,n().results.length)),C(ne,H)};pe(P,ne=>{var H;((H=n().results)==null?void 0:H.length)>0&&ne(O)})}var I=w(P,2);{var Q=ne=>{var H=Zk(),U=b(H),le=b(U),Y=b(le),ue=w(le,4),be=b(ue),ge=w(ue,2);{var re=De=>{var Fe=Wk(),Ne=w(Ye(Fe)),Je=b(Ne);se(()=>te(Je,`${n().errors??""} errors`)),C(De,Fe)};pe(ge,De=>{n().errors>0&&De(re)})}var Te=w(ge,2);{var _e=De=>{var Fe=Yk(),Ne=w(Ye(Fe)),Je=b(Ne);se(()=>te(Je,`${n().summary.skipped??""} skipped`)),C(De,Fe)};pe(Te,De=>{var Fe;(Fe=n().summary)!=null&&Fe.skipped&&De(_e)})}var Pe=w(U,2),He=b(Pe);{var Ze=De=>{var Fe=Xk(),Ne=Ye(Fe);se(()=>te(Ne,`Avg ${n().summary.avgTps??""} tok/s`)),C(De,Fe)};pe(He,De=>{var Fe;(Fe=n().summary)!=null&&Fe.avgTps&&De(Ze)})}var vt=w(He),ht=w(vt,2),je=w(ht,2);se((De,Fe,Ne)=>{var Je,ut;te(Y,`${(((Je=n().summary)==null?void 0:Je.processed)||n().total||0)??""} processed`),te(be,`${(n().classified||0)??""} classified`),te(vt,` ${De??""} in + ${Fe??""} out `),te(ht,` ${Ne??""} `),te(je,` Model: ${(((ut=n().summary)==null?void 0:ut.modelName)||"Unknown")??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),C(ne,H)};pe(I,ne=>{l(u)&&n().totals&&ne(Q)})}var W=w(I,2),Z=b(W);{var B=ne=>{var H=Qk(),U=Ye(H),le=w(U,2);Ce("click",U,function(...Y){var ue;(ue=e.oninspect)==null||ue.apply(this,Y)}),Ce("click",le,function(...Y){var ue;(ue=e.onclose)==null||ue.apply(this,Y)}),C(ne,H)},ee=ne=>{var H=Jk(),U=Ye(H),le=w(U,2);Ce("click",U,function(...Y){var ue;(ue=e.oninspect)==null||ue.apply(this,Y)}),Ce("click",le,function(...Y){var ue;(ue=e.onstop)==null||ue.apply(this,Y)}),C(ne,H)};pe(Z,ne=>{l(u)?ne(B):ne(ee,!1)})}se(()=>{te(j,`${l(o)??""}%`),J=Pt(D,1,"bar-fill svelte-t1ig66",null,J,{done:l(u)}),ae=jt(D,"",ae,{width:`${l(o)??""}%`})}),C(h,m)};pe(v,h=>{n()&&h(p)})}C(t,f),nt()}$t(["click"]);var t2=q('<span class="spinner svelte-ois7em"></span>'),n2=bn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),r2=q('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),a2=q("<option> </option>"),s2=q('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),i2=q('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function o2(t,e){tt(e,!0);let n=Ae(e,"engineStatus",3,"idle"),r=Ae(e,"modelName",3,""),a=Ae(e,"isScanning",3,!1),s=Ae(e,"scanProgress",3,null),i=Ae(e,"scanCount",15,20),o=Ae(e,"stats",3,null);const u=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function f(){return n()==="ready"?`${r()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function v(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function p(){return n()==="ready"&&!a()}let h=$(()=>{var H;return a()&&((H=s())==null?void 0:H.phase)!=="done"});var m=i2(),x=b(m),k=b(x),T=b(k);{var N=H=>{var U=t2();C(H,U)},z=H=>{var U=n2();C(H,U)};pe(T,H=>{l(h)?H(N):H(z,!1)})}var G=w(k,2),S=b(G),j=w(b(S),2),L=w(S,2),D=b(L);let J;var ae=w(D),ke=w(x,2);{var X=H=>{var U=r2(),le=b(U),Y=b(le),ue=w(le,4),be=b(ue),ge=w(ue,4),re=b(ge);se(()=>{te(Y,`${o().totalEmails??""} emails in storage`),te(be,`${o().classified??""} classified`),te(re,`${o().unclassified??""} new`)}),C(H,U)};pe(ke,H=>{o()&&H(X)})}var A=w(ke,2),K=b(A),P=w(b(K),2);Ct(P,21,()=>u,Wt,(H,U)=>{var le=a2(),Y=b(le),ue={};se(()=>{te(Y,l(U).label),ue!==(ue=l(U).value)&&(le.value=(le.__value=l(U).value)??"")}),C(H,le)});var O=w(K,2),I=b(O),Q=b(I),W=w(I,2),Z=w(A,2);{var B=H=>{var U=s2();C(H,U)};pe(Z,H=>{n()!=="ready"&&n()!=="loading"&&H(B)})}var ee=w(Z,2);{var ne=H=>{e2(H,{get progress(){return s()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};pe(ee,H=>{var U;(a()||((U=s())==null?void 0:U.phase)==="done")&&H(ne)})}se((H,U,le,Y)=>{J=jt(D,"",J,H),te(ae,` ${U??""}`),P.disabled=a(),I.disabled=le,te(Q,l(h)?"Scanning...":a()?"Finalizing...":"Scan New"),W.disabled=Y},[()=>({background:v()}),f,()=>!p(),()=>!p()]),Ce("click",j,function(...H){var U;(U=e.oninspect)==null||U.apply(this,H)}),po(P,i),Ce("click",I,function(...H){var U;(U=e.onscan)==null||U.apply(this,H)}),Ce("click",W,function(...H){var U;(U=e.onrescan)==null||U.apply(this,H)}),C(t,m),nt()}$t(["click"]);var l2=q('<span class="row-date svelte-1czytqk"> </span>'),c2=q('<span class="tag svelte-1czytqk"> </span>'),u2=q('<span class="row-tags svelte-1czytqk"></span>'),d2=q('<span class="row-reason svelte-1czytqk"> </span>'),f2=q('<button class="icon-btn exec-btn svelte-1czytqk" title="Execute actions"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>'),v2=q('<!> <button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),h2=q('<span class="status-label svelte-1czytqk"> </span>'),p2=q('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),g2=q('<p class="summary-reason svelte-1czytqk"> </p>'),m2=q('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),y2=q('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function vv(t,e){tt(e,!0);let n=Ae(e,"actionColor",3,"#666"),r=Ae(e,"dimmed",3,!1);function a(O){if(!O)return"";try{return new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let s=$(()=>e.item.status==="pending"),i=Oe(!1);var o=y2(),u=Ye(o);let f;var v=b(u);let p;var h=b(v),m=b(h),x=w(h,2),k=b(x),T=b(k),N=w(k,2);{var z=O=>{var I=l2(),Q=b(I);se(W=>te(Q,W),[()=>a(e.item.date)]),C(O,I)};pe(N,O=>{e.item.date&&O(z)})}var G=w(x,2);{var S=O=>{var I=u2();Ct(I,21,()=>e.item.tags,Wt,(Q,W)=>{var Z=c2();let B;var ee=b(Z);se(ne=>{B=jt(Z,"",B,ne),te(ee,l(W))},[()=>({background:I_(l(W))})]),C(Q,Z)}),C(O,I)};pe(G,O=>{e.item.tags&&e.item.tags.length>0&&O(S)})}var j=w(G,2);{var L=O=>{var I=d2(),Q=b(I);se(()=>te(Q,e.item.reason)),C(O,I)};pe(j,O=>{e.item.reason&&!l(i)&&O(L)})}var D=w(v,2),J=b(D);{var ae=O=>{var I=v2(),Q=Ye(I);{var W=ee=>{var ne=f2();Ce("click",ne,H=>{H.stopPropagation(),e.onexecute(e.item)}),C(ee,ne)};pe(Q,ee=>{e.onexecute&&ee(W)})}var Z=w(Q,2),B=w(Z,2);Ce("click",Z,ee=>{ee.stopPropagation(),e.onmarkacted(e.item.emailId)}),Ce("click",B,ee=>{ee.stopPropagation(),e.ondismiss(e.item.emailId)}),C(O,I)},ke=O=>{var I=h2(),Q=b(I);se(()=>te(Q,e.item.status)),C(O,I)};pe(J,O=>{l(s)?O(ae):O(ke,!1)})}var X=w(J,2);{var A=O=>{var I=p2();Ce("click",I,Q=>{Q.stopPropagation(),e.onremove(e.item.emailId)}),C(O,I)};pe(X,O=>{e.onremove&&O(A)})}var K=w(u,2);{var P=O=>{var I=m2();let Q;var W=b(I),Z=b(W),B=w(W,2);{var ee=ne=>{var H=g2(),U=b(H);se(()=>te(U,e.item.reason)),C(ne,H)};pe(B,ne=>{e.item.reason&&ne(ee)})}se(()=>{Q=jt(I,"",Q,{"border-left-color":n()}),te(Z,e.item.summary)}),C(O,I)};pe(K,O=>{l(i)&&e.item.summary&&O(P)})}se(()=>{f=Pt(u,1,"email-row svelte-1czytqk",null,f,{dimmed:r()}),p=jt(v,"",p,{"border-left-color":n()}),te(m,e.item.subject),te(T,e.item.from)}),Ce("click",v,()=>M(i,!l(i))),C(t,o),nt()}$t(["click"]);var b2=q('<span class="group-acted svelte-tl1unp"> </span>'),_2=q('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),w2=q('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),x2=q('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),k2=q('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),S2=q('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),E2=q('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function A2(t,e){tt(e,!0);let n=Ae(e,"color",3,"#888");Ae(e,"count",3,0);let r=Ae(e,"items",19,()=>[]),a=Ae(e,"expanded",3,!1),s=$(()=>r().filter(L=>L.status==="pending")),i=$(()=>r().filter(L=>L.status!=="pending")),o=Oe(!1);function u(L){return L.split("_").map(D=>D.charAt(0)+D.slice(1).toLowerCase()).join(" ")}var f=E2(),v=b(f),p=b(v);let h;var m=b(p),x=w(p,2),k=b(x),T=w(x,2);{var N=L=>{var D=b2(),J=b(D);se(()=>te(J,`${l(i).length??""} handled`)),C(L,D)};pe(T,L=>{l(i).length>0&&L(N)})}var z=w(T,4);let G;var S=w(v,2);{var j=L=>{var D=S2(),J=b(D);{var ae=Q=>{var W=_2();C(Q,W)};pe(J,Q=>{l(s).length===0&&l(i).length===0&&Q(ae)})}var ke=w(J,2);Ct(ke,17,()=>l(s),Q=>Q.emailId,(Q,W)=>{vv(Q,{get item(){return l(W)},get actionColor(){return n()},get onexecute(){return e.onexecute},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var X=w(ke,2);{var A=Q=>{var W=w2(),Z=b(W),B=b(Z),ee=w(Z,2);Ct(ee,17,()=>l(i),ne=>ne.emailId,(ne,H)=>{vv(ne,{get item(){return l(H)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),se(()=>te(B,`${l(i).length??""} handled`)),C(Q,W)};pe(X,Q=>{l(i).length>0&&Q(A)})}var K=w(X,2),P=b(K);{var O=Q=>{var W=x2();Ce("click",W,()=>M(o,!0)),C(Q,W)},I=Q=>{var W=k2(),Z=b(W),B=w(Z),ee=w(B,2);se(()=>te(Z,`Clear ${r().length??""} items? `)),Ce("click",B,()=>M(o,!1)),Ce("click",ee,()=>{e.oncleargroup(),M(o,!1)}),C(Q,W)};pe(P,Q=>{l(o)?Q(I,!1):Q(O)})}C(L,D)};pe(S,L=>{a()&&L(j)})}se(L=>{h=jt(p,"",h,{background:n()}),te(m,L),te(k,l(s).length),G=Pt(z,0,"chevron svelte-tl1unp",null,G,{open:a()})},[()=>u(e.action)]),Ce("click",v,function(...L){var D;(D=e.ontoggle)==null||D.apply(this,L)}),C(t,f),nt()}$t(["click"]);var T2=q(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),C2=q(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),I2=q(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),P2=q('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function M2(t,e){tt(e,!0);let n=Ae(e,"open",15,!1),r=Ae(e,"sampleEmail",3,null),a=Oe("system");function s(){return r()?Rp(r()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function i(){n(!1)}function o(p){p.target===p.currentTarget&&i()}var u=cn(),f=Ye(u);{var v=p=>{var h=P2(),m=b(h),x=b(m),k=w(b(x),2),T=w(x,2),N=b(T);let z;var G=w(N,2);let S;var j=w(G,2);let L;var D=w(T,2),J=b(D);{var ae=A=>{var K=T2(),P=w(Ye(K),2),O=b(P);se(()=>te(O,Pp)),C(A,K)},ke=A=>{var K=C2(),P=w(Ye(K),2),O=w(b(P),2);O.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var I=w(P,2),Q=w(b(I),2),W=b(Q);se(Z=>te(W,Z),[s]),C(A,K)},X=A=>{var K=I2(),P=w(Ye(K),2),O=b(P),I=w(b(O),2),Q=b(I),W=w(O,2),Z=w(b(W),2),B=b(Z),ee=w(W,2),ne=w(b(ee),2),H=b(ne),U=w(P,4);U.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,se(()=>{te(Q,E_.maxTokens),te(B,"false"),te(H,"false")}),C(A,K)};pe(J,A=>{l(a)==="system"?A(ae):l(a)==="email"?A(ke,1):l(a)==="config"&&A(X,2)})}se(()=>{z=Pt(N,1,"tab svelte-10pcy9j",null,z,{active:l(a)==="system"}),S=Pt(G,1,"tab svelte-10pcy9j",null,S,{active:l(a)==="email"}),L=Pt(j,1,"tab svelte-10pcy9j",null,L,{active:l(a)==="config"})}),Ce("click",h,o),Ce("keydown",h,A=>A.key==="Escape"&&i()),Ce("click",k,i),Ce("click",N,()=>M(a,"system")),Ce("click",G,()=>M(a,"email")),Ce("click",j,()=>M(a,"config")),C(p,h)};pe(f,p=>{n()&&p(v)})}C(t,u),nt()}$t(["click","keydown"]);var O2={value:()=>{}};function Zl(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new il(n)}function il(t){this._=t}function N2(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}il.prototype=Zl.prototype={constructor:il,on:function(t,e){var n=this._,r=N2(t+"",n),a,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((a=(t=r[s]).type)&&(a=R2(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<i;)if(a=(t=r[s]).type)n[a]=hv(n[a],t.name,e);else if(e==null)for(a in n)n[a]=hv(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new il(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,s;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,a=s.length;r<a;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,s=r.length;a<s;++a)r[a].value.apply(e,n)}};function R2(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function hv(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=O2,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Du="http://www.w3.org/1999/xhtml";const pv={svg:"http://www.w3.org/2000/svg",xhtml:Du,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ql(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),pv.hasOwnProperty(e)?{space:pv[e],local:t}:t}function D2(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Du&&e.documentElement.namespaceURI===Du?e.createElement(t):e.createElementNS(n,t)}}function L2(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function lg(t){var e=Ql(t);return(e.local?L2:D2)(e)}function j2(){}function Md(t){return t==null?j2:function(){return this.querySelector(t)}}function z2(t){typeof t!="function"&&(t=Md(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,o=r[a]=new Array(i),u,f,v=0;v<i;++v)(u=s[v])&&(f=t.call(u,u.__data__,v,s))&&("__data__"in u&&(f.__data__=u.__data__),o[v]=f);return new ur(r,this._parents)}function B2(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function q2(){return[]}function cg(t){return t==null?q2:function(){return this.querySelectorAll(t)}}function F2(t){return function(){return B2(t.apply(this,arguments))}}function K2(t){typeof t=="function"?t=F2(t):t=cg(t);for(var e=this._groups,n=e.length,r=[],a=[],s=0;s<n;++s)for(var i=e[s],o=i.length,u,f=0;f<o;++f)(u=i[f])&&(r.push(t.call(u,u.__data__,f,i)),a.push(u));return new ur(r,a)}function ug(t){return function(){return this.matches(t)}}function dg(t){return function(e){return e.matches(t)}}var H2=Array.prototype.find;function V2(t){return function(){return H2.call(this.children,t)}}function U2(){return this.firstElementChild}function G2(t){return this.select(t==null?U2:V2(typeof t=="function"?t:dg(t)))}var W2=Array.prototype.filter;function Y2(){return Array.from(this.children)}function X2(t){return function(){return W2.call(this.children,t)}}function Z2(t){return this.selectAll(t==null?Y2:X2(typeof t=="function"?t:dg(t)))}function Q2(t){typeof t!="function"&&(t=ug(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,o=r[a]=[],u,f=0;f<i;++f)(u=s[f])&&t.call(u,u.__data__,f,s)&&o.push(u);return new ur(r,this._parents)}function fg(t){return new Array(t.length)}function J2(){return new ur(this._enter||this._groups.map(fg),this._parents)}function _l(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_l.prototype={constructor:_l,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function $2(t){return function(){return t}}function eS(t,e,n,r,a,s){for(var i=0,o,u=e.length,f=s.length;i<f;++i)(o=e[i])?(o.__data__=s[i],r[i]=o):n[i]=new _l(t,s[i]);for(;i<u;++i)(o=e[i])&&(a[i]=o)}function tS(t,e,n,r,a,s,i){var o,u,f=new Map,v=e.length,p=s.length,h=new Array(v),m;for(o=0;o<v;++o)(u=e[o])&&(h[o]=m=i.call(u,u.__data__,o,e)+"",f.has(m)?a[o]=u:f.set(m,u));for(o=0;o<p;++o)m=i.call(t,s[o],o,s)+"",(u=f.get(m))?(r[o]=u,u.__data__=s[o],f.delete(m)):n[o]=new _l(t,s[o]);for(o=0;o<v;++o)(u=e[o])&&f.get(h[o])===u&&(a[o]=u)}function nS(t){return t.__data__}function rS(t,e){if(!arguments.length)return Array.from(this,nS);var n=e?tS:eS,r=this._parents,a=this._groups;typeof t!="function"&&(t=$2(t));for(var s=a.length,i=new Array(s),o=new Array(s),u=new Array(s),f=0;f<s;++f){var v=r[f],p=a[f],h=p.length,m=aS(t.call(v,v&&v.__data__,f,r)),x=m.length,k=o[f]=new Array(x),T=i[f]=new Array(x),N=u[f]=new Array(h);n(v,p,k,T,N,m,e);for(var z=0,G=0,S,j;z<x;++z)if(S=k[z]){for(z>=G&&(G=z+1);!(j=T[G])&&++G<x;);S._next=j||null}}return i=new ur(i,r),i._enter=o,i._exit=u,i}function aS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function sS(){return new ur(this._exit||this._groups.map(fg),this._parents)}function iS(t,e,n){var r=this.enter(),a=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?s.remove():n(s),r&&a?r.merge(a).order():a}function oS(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,s=r.length,i=Math.min(a,s),o=new Array(a),u=0;u<i;++u)for(var f=n[u],v=r[u],p=f.length,h=o[u]=new Array(p),m,x=0;x<p;++x)(m=f[x]||v[x])&&(h[x]=m);for(;u<a;++u)o[u]=n[u];return new ur(o,this._parents)}function lS(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,s=r[a],i;--a>=0;)(i=r[a])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function cS(t){t||(t=uS);function e(p,h){return p&&h?t(p.__data__,h.__data__):!p-!h}for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s){for(var i=n[s],o=i.length,u=a[s]=new Array(o),f,v=0;v<o;++v)(f=i[v])&&(u[v]=f);u.sort(e)}return new ur(a,this._parents).order()}function uS(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function dS(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function fS(){return Array.from(this)}function vS(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length;a<s;++a){var i=r[a];if(i)return i}return null}function hS(){let t=0;for(const e of this)++t;return t}function pS(){return!this.node()}function gS(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],s=0,i=a.length,o;s<i;++s)(o=a[s])&&t.call(o,o.__data__,s,a);return this}function mS(t){return function(){this.removeAttribute(t)}}function yS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function bS(t,e){return function(){this.setAttribute(t,e)}}function _S(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function wS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function xS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function kS(t,e){var n=Ql(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?yS:mS:typeof e=="function"?n.local?xS:wS:n.local?_S:bS)(n,e))}function vg(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function SS(t){return function(){this.style.removeProperty(t)}}function ES(t,e,n){return function(){this.style.setProperty(t,e,n)}}function AS(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function TS(t,e,n){return arguments.length>1?this.each((e==null?SS:typeof e=="function"?AS:ES)(t,e,n??"")):ni(this.node(),t)}function ni(t,e){return t.style.getPropertyValue(e)||vg(t).getComputedStyle(t,null).getPropertyValue(e)}function CS(t){return function(){delete this[t]}}function IS(t,e){return function(){this[t]=e}}function PS(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function MS(t,e){return arguments.length>1?this.each((e==null?CS:typeof e=="function"?PS:IS)(t,e)):this.node()[t]}function hg(t){return t.trim().split(/^|\s+/)}function Od(t){return t.classList||new pg(t)}function pg(t){this._node=t,this._names=hg(t.getAttribute("class")||"")}pg.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function gg(t,e){for(var n=Od(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function mg(t,e){for(var n=Od(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function OS(t){return function(){gg(this,t)}}function NS(t){return function(){mg(this,t)}}function RS(t,e){return function(){(e.apply(this,arguments)?gg:mg)(this,t)}}function DS(t,e){var n=hg(t+"");if(arguments.length<2){for(var r=Od(this.node()),a=-1,s=n.length;++a<s;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?RS:e?OS:NS)(n,e))}function LS(){this.textContent=""}function jS(t){return function(){this.textContent=t}}function zS(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function BS(t){return arguments.length?this.each(t==null?LS:(typeof t=="function"?zS:jS)(t)):this.node().textContent}function qS(){this.innerHTML=""}function FS(t){return function(){this.innerHTML=t}}function KS(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function HS(t){return arguments.length?this.each(t==null?qS:(typeof t=="function"?KS:FS)(t)):this.node().innerHTML}function VS(){this.nextSibling&&this.parentNode.appendChild(this)}function US(){return this.each(VS)}function GS(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function WS(){return this.each(GS)}function YS(t){var e=typeof t=="function"?t:lg(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function XS(){return null}function ZS(t,e){var n=typeof t=="function"?t:lg(t),r=e==null?XS:typeof e=="function"?e:Md(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function QS(){var t=this.parentNode;t&&t.removeChild(this)}function JS(){return this.each(QS)}function $S(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function eE(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function tE(t){return this.select(t?eE:$S)}function nE(t){return arguments.length?this.property("__data__",t):this.node().__data__}function rE(t){return function(e){t.call(this,e,this.__data__)}}function aE(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function sE(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,s;n<a;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function iE(t,e,n){return function(){var r=this.__on,a,s=rE(e);if(r){for(var i=0,o=r.length;i<o;++i)if((a=r[i]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=s,a.options=n),a.value=e;return}}this.addEventListener(t.type,s,n),a={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(a):this.__on=[a]}}function oE(t,e,n){var r=aE(t+""),a,s=r.length,i;if(arguments.length<2){var o=this.node().__on;if(o){for(var u=0,f=o.length,v;u<f;++u)for(a=0,v=o[u];a<s;++a)if((i=r[a]).type===v.type&&i.name===v.name)return v.value}return}for(o=e?iE:sE,a=0;a<s;++a)this.each(o(r[a],e,n));return this}function yg(t,e,n){var r=vg(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function lE(t,e){return function(){return yg(this,t,e)}}function cE(t,e){return function(){return yg(this,t,e.apply(this,arguments))}}function uE(t,e){return this.each((typeof e=="function"?cE:lE)(t,e))}function*dE(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length,i;a<s;++a)(i=r[a])&&(yield i)}var bg=[null];function ur(t,e){this._groups=t,this._parents=e}function yo(){return new ur([[document.documentElement]],bg)}function fE(){return this}ur.prototype=yo.prototype={constructor:ur,select:z2,selectAll:K2,selectChild:G2,selectChildren:Z2,filter:Q2,data:rS,enter:J2,exit:sS,join:iS,merge:oS,selection:fE,order:lS,sort:cS,call:dS,nodes:fS,node:vS,size:hS,empty:pS,each:gS,attr:kS,style:TS,property:MS,classed:DS,text:BS,html:HS,raise:US,lower:WS,append:YS,insert:ZS,remove:JS,clone:tE,datum:nE,on:oE,dispatch:uE,[Symbol.iterator]:dE};function Pr(t){return typeof t=="string"?new ur([[document.querySelector(t)]],[document.documentElement]):new ur([[t]],bg)}function vE(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Hr(t,e){if(t=vE(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const hE={passive:!1},Wi={capture:!0,passive:!1};function Gc(t){t.stopImmediatePropagation()}function qs(t){t.preventDefault(),t.stopImmediatePropagation()}function _g(t){var e=t.document.documentElement,n=Pr(t).on("dragstart.drag",qs,Wi);"onselectstart"in e?n.on("selectstart.drag",qs,Wi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function wg(t,e){var n=t.document.documentElement,r=Pr(t).on("dragstart.drag",null);e&&(r.on("click.drag",qs,Wi),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Uo=t=>()=>t;function Lu(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:s,x:i,y:o,dx:u,dy:f,dispatch:v}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:o,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:v}})}Lu.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function pE(t){return!t.ctrlKey&&!t.button}function gE(){return this.parentNode}function mE(t,e){return e??{x:t.x,y:t.y}}function yE(){return navigator.maxTouchPoints||"ontouchstart"in this}function bE(){var t=pE,e=gE,n=mE,r=yE,a={},s=Zl("start","drag","end"),i=0,o,u,f,v,p=0;function h(S){S.on("mousedown.drag",m).filter(r).on("touchstart.drag",T).on("touchmove.drag",N,hE).on("touchend.drag touchcancel.drag",z).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(S,j){if(!(v||!t.call(this,S,j))){var L=G(this,e.call(this,S,j),S,j,"mouse");L&&(Pr(S.view).on("mousemove.drag",x,Wi).on("mouseup.drag",k,Wi),_g(S.view),Gc(S),f=!1,o=S.clientX,u=S.clientY,L("start",S))}}function x(S){if(qs(S),!f){var j=S.clientX-o,L=S.clientY-u;f=j*j+L*L>p}a.mouse("drag",S)}function k(S){Pr(S.view).on("mousemove.drag mouseup.drag",null),wg(S.view,f),qs(S),a.mouse("end",S)}function T(S,j){if(t.call(this,S,j)){var L=S.changedTouches,D=e.call(this,S,j),J=L.length,ae,ke;for(ae=0;ae<J;++ae)(ke=G(this,D,S,j,L[ae].identifier,L[ae]))&&(Gc(S),ke("start",S,L[ae]))}}function N(S){var j=S.changedTouches,L=j.length,D,J;for(D=0;D<L;++D)(J=a[j[D].identifier])&&(qs(S),J("drag",S,j[D]))}function z(S){var j=S.changedTouches,L=j.length,D,J;for(v&&clearTimeout(v),v=setTimeout(function(){v=null},500),D=0;D<L;++D)(J=a[j[D].identifier])&&(Gc(S),J("end",S,j[D]))}function G(S,j,L,D,J,ae){var ke=s.copy(),X=Hr(ae||L,j),A,K,P;if((P=n.call(S,new Lu("beforestart",{sourceEvent:L,target:h,identifier:J,active:i,x:X[0],y:X[1],dx:0,dy:0,dispatch:ke}),D))!=null)return A=P.x-X[0]||0,K=P.y-X[1]||0,function O(I,Q,W){var Z=X,B;switch(I){case"start":a[J]=O,B=i++;break;case"end":delete a[J],--i;case"drag":X=Hr(W||Q,j),B=i;break}ke.call(I,S,new Lu(I,{sourceEvent:Q,subject:P,target:h,identifier:J,active:B,x:X[0]+A,y:X[1]+K,dx:X[0]-Z[0],dy:X[1]-Z[1],dispatch:ke}),D)}}return h.filter=function(S){return arguments.length?(t=typeof S=="function"?S:Uo(!!S),h):t},h.container=function(S){return arguments.length?(e=typeof S=="function"?S:Uo(S),h):e},h.subject=function(S){return arguments.length?(n=typeof S=="function"?S:Uo(S),h):n},h.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Uo(!!S),h):r},h.on=function(){var S=s.on.apply(s,arguments);return S===s?h:S},h.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,h):Math.sqrt(p)},h}function Nd(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function xg(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function bo(){}var Yi=.7,wl=1/Yi,Fs="\\s*([+-]?\\d+)\\s*",Xi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Jr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_E=/^#([0-9a-f]{3,8})$/,wE=new RegExp(`^rgb\\(${Fs},${Fs},${Fs}\\)$`),xE=new RegExp(`^rgb\\(${Jr},${Jr},${Jr}\\)$`),kE=new RegExp(`^rgba\\(${Fs},${Fs},${Fs},${Xi}\\)$`),SE=new RegExp(`^rgba\\(${Jr},${Jr},${Jr},${Xi}\\)$`),EE=new RegExp(`^hsl\\(${Xi},${Jr},${Jr}\\)$`),AE=new RegExp(`^hsla\\(${Xi},${Jr},${Jr},${Xi}\\)$`),gv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Nd(bo,ys,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:mv,formatHex:mv,formatHex8:TE,formatHsl:CE,formatRgb:yv,toString:yv});function mv(){return this.rgb().formatHex()}function TE(){return this.rgb().formatHex8()}function CE(){return kg(this).formatHsl()}function yv(){return this.rgb().formatRgb()}function ys(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=_E.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?bv(e):n===3?new tr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Go(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Go(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=wE.exec(t))?new tr(e[1],e[2],e[3],1):(e=xE.exec(t))?new tr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=kE.exec(t))?Go(e[1],e[2],e[3],e[4]):(e=SE.exec(t))?Go(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=EE.exec(t))?xv(e[1],e[2]/100,e[3]/100,1):(e=AE.exec(t))?xv(e[1],e[2]/100,e[3]/100,e[4]):gv.hasOwnProperty(t)?bv(gv[t]):t==="transparent"?new tr(NaN,NaN,NaN,0):null}function bv(t){return new tr(t>>16&255,t>>8&255,t&255,1)}function Go(t,e,n,r){return r<=0&&(t=e=n=NaN),new tr(t,e,n,r)}function IE(t){return t instanceof bo||(t=ys(t)),t?(t=t.rgb(),new tr(t.r,t.g,t.b,t.opacity)):new tr}function ju(t,e,n,r){return arguments.length===1?IE(t):new tr(t,e,n,r??1)}function tr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Nd(tr,ju,xg(bo,{brighter(t){return t=t==null?wl:Math.pow(wl,t),new tr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Yi:Math.pow(Yi,t),new tr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new tr(ds(this.r),ds(this.g),ds(this.b),xl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_v,formatHex:_v,formatHex8:PE,formatRgb:wv,toString:wv}));function _v(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}`}function PE(){return`#${rs(this.r)}${rs(this.g)}${rs(this.b)}${rs((isNaN(this.opacity)?1:this.opacity)*255)}`}function wv(){const t=xl(this.opacity);return`${t===1?"rgb(":"rgba("}${ds(this.r)}, ${ds(this.g)}, ${ds(this.b)}${t===1?")":`, ${t})`}`}function xl(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ds(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function rs(t){return t=ds(t),(t<16?"0":"")+t.toString(16)}function xv(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Mr(t,e,n,r)}function kg(t){if(t instanceof Mr)return new Mr(t.h,t.s,t.l,t.opacity);if(t instanceof bo||(t=ys(t)),!t)return new Mr;if(t instanceof Mr)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,o=s-a,u=(s+a)/2;return o?(e===s?i=(n-r)/o+(n<r)*6:n===s?i=(r-e)/o+2:i=(e-n)/o+4,o/=u<.5?s+a:2-s-a,i*=60):o=u>0&&u<1?0:i,new Mr(i,o,u,t.opacity)}function ME(t,e,n,r){return arguments.length===1?kg(t):new Mr(t,e,n,r??1)}function Mr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Nd(Mr,ME,xg(bo,{brighter(t){return t=t==null?wl:Math.pow(wl,t),new Mr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yi:Math.pow(Yi,t),new Mr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new tr(Wc(t>=240?t-240:t+120,a,r),Wc(t,a,r),Wc(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new Mr(kv(this.h),Wo(this.s),Wo(this.l),xl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=xl(this.opacity);return`${t===1?"hsl(":"hsla("}${kv(this.h)}, ${Wo(this.s)*100}%, ${Wo(this.l)*100}%${t===1?")":`, ${t})`}`}}));function kv(t){return t=(t||0)%360,t<0?t+360:t}function Wo(t){return Math.max(0,Math.min(1,t||0))}function Wc(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Rd=t=>()=>t;function OE(t,e){return function(n){return t+n*e}}function NE(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function RE(t){return(t=+t)==1?Sg:function(e,n){return n-e?NE(e,n,t):Rd(isNaN(e)?n:e)}}function Sg(t,e){var n=e-t;return n?OE(t,n):Rd(isNaN(t)?e:t)}const kl=(function t(e){var n=RE(e);function r(a,s){var i=n((a=ju(a)).r,(s=ju(s)).r),o=n(a.g,s.g),u=n(a.b,s.b),f=Sg(a.opacity,s.opacity);return function(v){return a.r=i(v),a.g=o(v),a.b=u(v),a.opacity=f(v),a+""}}return r.gamma=t,r})(1);function DE(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function LE(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function jE(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=Ki(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(o){for(i=0;i<r;++i)s[i]=a[i](o);return s}}function zE(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Wr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function BE(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Ki(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var zu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yc=new RegExp(zu.source,"g");function qE(t){return function(){return t}}function FE(t){return function(e){return t(e)+""}}function Eg(t,e){var n=zu.lastIndex=Yc.lastIndex=0,r,a,s,i=-1,o=[],u=[];for(t=t+"",e=e+"";(r=zu.exec(t))&&(a=Yc.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),o[i]?o[i]+=s:o[++i]=s),(r=r[0])===(a=a[0])?o[i]?o[i]+=a:o[++i]=a:(o[++i]=null,u.push({i,x:Wr(r,a)})),n=Yc.lastIndex;return n<e.length&&(s=e.slice(n),o[i]?o[i]+=s:o[++i]=s),o.length<2?u[0]?FE(u[0].x):qE(e):(e=u.length,function(f){for(var v=0,p;v<e;++v)o[(p=u[v]).i]=p.x(f);return o.join("")})}function Ki(t,e){var n=typeof e,r;return e==null||n==="boolean"?Rd(e):(n==="number"?Wr:n==="string"?(r=ys(e))?(e=r,kl):Eg:e instanceof ys?kl:e instanceof Date?zE:LE(e)?DE:Array.isArray(e)?jE:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?BE:Wr)(t,e)}var Sv=180/Math.PI,Bu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ag(t,e,n,r,a,s){var i,o,u;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,u/=o),t*r<e*n&&(t=-t,e=-e,u=-u,i=-i),{translateX:a,translateY:s,rotate:Math.atan2(e,t)*Sv,skewX:Math.atan(u)*Sv,scaleX:i,scaleY:o}}var Yo;function KE(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Bu:Ag(e.a,e.b,e.c,e.d,e.e,e.f)}function HE(t){return t==null||(Yo||(Yo=document.createElementNS("http://www.w3.org/2000/svg","g")),Yo.setAttribute("transform",t),!(t=Yo.transform.baseVal.consolidate()))?Bu:(t=t.matrix,Ag(t.a,t.b,t.c,t.d,t.e,t.f))}function Tg(t,e,n,r){function a(f){return f.length?f.pop()+" ":""}function s(f,v,p,h,m,x){if(f!==p||v!==h){var k=m.push("translate(",null,e,null,n);x.push({i:k-4,x:Wr(f,p)},{i:k-2,x:Wr(v,h)})}else(p||h)&&m.push("translate("+p+e+h+n)}function i(f,v,p,h){f!==v?(f-v>180?v+=360:v-f>180&&(f+=360),h.push({i:p.push(a(p)+"rotate(",null,r)-2,x:Wr(f,v)})):v&&p.push(a(p)+"rotate("+v+r)}function o(f,v,p,h){f!==v?h.push({i:p.push(a(p)+"skewX(",null,r)-2,x:Wr(f,v)}):v&&p.push(a(p)+"skewX("+v+r)}function u(f,v,p,h,m,x){if(f!==p||v!==h){var k=m.push(a(m)+"scale(",null,",",null,")");x.push({i:k-4,x:Wr(f,p)},{i:k-2,x:Wr(v,h)})}else(p!==1||h!==1)&&m.push(a(m)+"scale("+p+","+h+")")}return function(f,v){var p=[],h=[];return f=t(f),v=t(v),s(f.translateX,f.translateY,v.translateX,v.translateY,p,h),i(f.rotate,v.rotate,p,h),o(f.skewX,v.skewX,p,h),u(f.scaleX,f.scaleY,v.scaleX,v.scaleY,p,h),f=v=null,function(m){for(var x=-1,k=h.length,T;++x<k;)p[(T=h[x]).i]=T.x(m);return p.join("")}}}var VE=Tg(KE,"px, ","px)","deg)"),UE=Tg(HE,", ",")",")"),GE=1e-12;function Ev(t){return((t=Math.exp(t))+1/t)/2}function WE(t){return((t=Math.exp(t))-1/t)/2}function YE(t){return((t=Math.exp(2*t))-1)/(t+1)}const ol=(function t(e,n,r){function a(s,i){var o=s[0],u=s[1],f=s[2],v=i[0],p=i[1],h=i[2],m=v-o,x=p-u,k=m*m+x*x,T,N;if(k<GE)N=Math.log(h/f)/e,T=function(D){return[o+D*m,u+D*x,f*Math.exp(e*D*N)]};else{var z=Math.sqrt(k),G=(h*h-f*f+r*k)/(2*f*n*z),S=(h*h-f*f-r*k)/(2*h*n*z),j=Math.log(Math.sqrt(G*G+1)-G),L=Math.log(Math.sqrt(S*S+1)-S);N=(L-j)/e,T=function(D){var J=D*N,ae=Ev(j),ke=f/(n*z)*(ae*YE(e*J+j)-WE(j));return[o+ke*m,u+ke*x,f*ae/Ev(e*J+j)]}}return T.duration=N*1e3*e/Math.SQRT2,T}return a.rho=function(s){var i=Math.max(.001,+s),o=i*i,u=o*o;return t(i,o,u)},a})(Math.SQRT2,2,4);var ri=0,Di=0,Mi=0,Cg=1e3,Sl,Li,El=0,bs=0,Jl=0,Zi=typeof performance=="object"&&performance.now?performance:Date,Ig=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dd(){return bs||(Ig(XE),bs=Zi.now()+Jl)}function XE(){bs=0}function Al(){this._call=this._time=this._next=null}Al.prototype=Pg.prototype={constructor:Al,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Dd():+n)+(e==null?0:+e),!this._next&&Li!==this&&(Li?Li._next=this:Sl=this,Li=this),this._call=t,this._time=n,qu()},stop:function(){this._call&&(this._call=null,this._time=1/0,qu())}};function Pg(t,e,n){var r=new Al;return r.restart(t,e,n),r}function ZE(){Dd(),++ri;for(var t=Sl,e;t;)(e=bs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ri}function Av(){bs=(El=Zi.now())+Jl,ri=Di=0;try{ZE()}finally{ri=0,JE(),bs=0}}function QE(){var t=Zi.now(),e=t-El;e>Cg&&(Jl-=e,El=t)}function JE(){for(var t,e=Sl,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Sl=n);Li=t,qu(r)}function qu(t){if(!ri){Di&&(Di=clearTimeout(Di));var e=t-bs;e>24?(t<1/0&&(Di=setTimeout(Av,t-Zi.now()-Jl)),Mi&&(Mi=clearInterval(Mi))):(Mi||(El=Zi.now(),Mi=setInterval(QE,Cg)),ri=1,Ig(Av))}}function Tv(t,e,n){var r=new Al;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var $E=Zl("start","end","cancel","interrupt"),eA=[],Mg=0,Cv=1,Fu=2,ll=3,Iv=4,Ku=5,cl=6;function $l(t,e,n,r,a,s){var i=t.__transition;if(!i)t.__transition={};else if(n in i)return;tA(t,n,{name:e,index:r,group:a,on:$E,tween:eA,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Mg})}function Ld(t,e){var n=zr(t,e);if(n.state>Mg)throw new Error("too late; already scheduled");return n}function na(t,e){var n=zr(t,e);if(n.state>ll)throw new Error("too late; already running");return n}function zr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function tA(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Pg(s,0,n.time);function s(f){n.state=Cv,n.timer.restart(i,n.delay,n.time),n.delay<=f&&i(f-n.delay)}function i(f){var v,p,h,m;if(n.state!==Cv)return u();for(v in r)if(m=r[v],m.name===n.name){if(m.state===ll)return Tv(i);m.state===Iv?(m.state=cl,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete r[v]):+v<e&&(m.state=cl,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete r[v])}if(Tv(function(){n.state===ll&&(n.state=Iv,n.timer.restart(o,n.delay,n.time),o(f))}),n.state=Fu,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Fu){for(n.state=ll,a=new Array(h=n.tween.length),v=0,p=-1;v<h;++v)(m=n.tween[v].value.call(t,t.__data__,n.index,n.group))&&(a[++p]=m);a.length=p+1}}function o(f){for(var v=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(u),n.state=Ku,1),p=-1,h=a.length;++p<h;)a[p].call(t,v);n.state===Ku&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=cl,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function ul(t,e){var n=t.__transition,r,a,s=!0,i;if(n){e=e==null?null:e+"";for(i in n){if((r=n[i]).name!==e){s=!1;continue}a=r.state>Fu&&r.state<Ku,r.state=cl,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[i]}s&&delete t.__transition}}function nA(t){return this.each(function(){ul(this,t)})}function rA(t,e){var n,r;return function(){var a=na(this,t),s=a.tween;if(s!==n){r=n=s;for(var i=0,o=r.length;i<o;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}a.tween=r}}function aA(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var s=na(this,t),i=s.tween;if(i!==r){a=(r=i).slice();for(var o={name:e,value:n},u=0,f=a.length;u<f;++u)if(a[u].name===e){a[u]=o;break}u===f&&a.push(o)}s.tween=a}}function sA(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=zr(this.node(),n).tween,a=0,s=r.length,i;a<s;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((e==null?rA:aA)(n,t,e))}function jd(t,e,n){var r=t._id;return t.each(function(){var a=na(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return zr(a,r).value[e]}}function Og(t,e){var n;return(typeof e=="number"?Wr:e instanceof ys?kl:(n=ys(e))?(e=n,kl):Eg)(t,e)}function iA(t){return function(){this.removeAttribute(t)}}function oA(t){return function(){this.removeAttributeNS(t.space,t.local)}}function lA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttribute(t);return i===a?null:i===r?s:s=e(r=i,n)}}function cA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttributeNS(t.space,t.local);return i===a?null:i===r?s:s=e(r=i,n)}}function uA(t,e,n){var r,a,s;return function(){var i,o=n(this),u;return o==null?void this.removeAttribute(t):(i=this.getAttribute(t),u=o+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,o)))}}function dA(t,e,n){var r,a,s;return function(){var i,o=n(this),u;return o==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),u=o+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,o)))}}function fA(t,e){var n=Ql(t),r=n==="transform"?UE:Og;return this.attrTween(t,typeof e=="function"?(n.local?dA:uA)(n,r,jd(this,"attr."+t,e)):e==null?(n.local?oA:iA)(n):(n.local?cA:lA)(n,r,e))}function vA(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function hA(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function pA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&hA(t,s)),n}return a._value=e,a}function gA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&vA(t,s)),n}return a._value=e,a}function mA(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ql(t);return this.tween(n,(r.local?pA:gA)(r,e))}function yA(t,e){return function(){Ld(this,t).delay=+e.apply(this,arguments)}}function bA(t,e){return e=+e,function(){Ld(this,t).delay=e}}function _A(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?yA:bA)(e,t)):zr(this.node(),e).delay}function wA(t,e){return function(){na(this,t).duration=+e.apply(this,arguments)}}function xA(t,e){return e=+e,function(){na(this,t).duration=e}}function kA(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?wA:xA)(e,t)):zr(this.node(),e).duration}function SA(t,e){if(typeof e!="function")throw new Error;return function(){na(this,t).ease=e}}function EA(t){var e=this._id;return arguments.length?this.each(SA(e,t)):zr(this.node(),e).ease}function AA(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;na(this,t).ease=n}}function TA(t){if(typeof t!="function")throw new Error;return this.each(AA(this._id,t))}function CA(t){typeof t!="function"&&(t=ug(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,o=r[a]=[],u,f=0;f<i;++f)(u=s[f])&&t.call(u,u.__data__,f,s)&&o.push(u);return new _a(r,this._parents,this._name,this._id)}function IA(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,s=Math.min(r,a),i=new Array(r),o=0;o<s;++o)for(var u=e[o],f=n[o],v=u.length,p=i[o]=new Array(v),h,m=0;m<v;++m)(h=u[m]||f[m])&&(p[m]=h);for(;o<r;++o)i[o]=e[o];return new _a(i,this._parents,this._name,this._id)}function PA(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function MA(t,e,n){var r,a,s=PA(e)?Ld:na;return function(){var i=s(this,t),o=i.on;o!==r&&(a=(r=o).copy()).on(e,n),i.on=a}}function OA(t,e){var n=this._id;return arguments.length<2?zr(this.node(),n).on.on(t):this.each(MA(n,t,e))}function NA(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function RA(){return this.on("end.remove",NA(this._id))}function DA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Md(t));for(var r=this._groups,a=r.length,s=new Array(a),i=0;i<a;++i)for(var o=r[i],u=o.length,f=s[i]=new Array(u),v,p,h=0;h<u;++h)(v=o[h])&&(p=t.call(v,v.__data__,h,o))&&("__data__"in v&&(p.__data__=v.__data__),f[h]=p,$l(f[h],e,n,h,f,zr(v,n)));return new _a(s,this._parents,e,n)}function LA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=cg(t));for(var r=this._groups,a=r.length,s=[],i=[],o=0;o<a;++o)for(var u=r[o],f=u.length,v,p=0;p<f;++p)if(v=u[p]){for(var h=t.call(v,v.__data__,p,u),m,x=zr(v,n),k=0,T=h.length;k<T;++k)(m=h[k])&&$l(m,e,n,k,h,x);s.push(h),i.push(v)}return new _a(s,i,e,n)}var jA=yo.prototype.constructor;function zA(){return new jA(this._groups,this._parents)}function BA(t,e){var n,r,a;return function(){var s=ni(this,t),i=(this.style.removeProperty(t),ni(this,t));return s===i?null:s===n&&i===r?a:a=e(n=s,r=i)}}function Ng(t){return function(){this.style.removeProperty(t)}}function qA(t,e,n){var r,a=n+"",s;return function(){var i=ni(this,t);return i===a?null:i===r?s:s=e(r=i,n)}}function FA(t,e,n){var r,a,s;return function(){var i=ni(this,t),o=n(this),u=o+"";return o==null&&(u=o=(this.style.removeProperty(t),ni(this,t))),i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,o))}}function KA(t,e){var n,r,a,s="style."+e,i="end."+s,o;return function(){var u=na(this,t),f=u.on,v=u.value[s]==null?o||(o=Ng(e)):void 0;(f!==n||a!==v)&&(r=(n=f).copy()).on(i,a=v),u.on=r}}function HA(t,e,n){var r=(t+="")=="transform"?VE:Og;return e==null?this.styleTween(t,BA(t,r)).on("end.style."+t,Ng(t)):typeof e=="function"?this.styleTween(t,FA(t,r,jd(this,"style."+t,e))).each(KA(this._id,t)):this.styleTween(t,qA(t,r,e),n).on("end.style."+t,null)}function VA(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function UA(t,e,n){var r,a;function s(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&VA(t,i,n)),r}return s._value=e,s}function GA(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,UA(t,e,n??""))}function WA(t){return function(){this.textContent=t}}function YA(t){return function(){var e=t(this);this.textContent=e??""}}function XA(t){return this.tween("text",typeof t=="function"?YA(jd(this,"text",t)):WA(t==null?"":t+""))}function ZA(t){return function(e){this.textContent=t.call(this,e)}}function QA(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&ZA(a)),e}return r._value=t,r}function JA(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,QA(t))}function $A(){for(var t=this._name,e=this._id,n=Rg(),r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],o=i.length,u,f=0;f<o;++f)if(u=i[f]){var v=zr(u,e);$l(u,t,n,f,i,{time:v.time+v.delay+v.duration,delay:0,duration:v.duration,ease:v.ease})}return new _a(r,this._parents,t,n)}function eT(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(s,i){var o={value:i},u={value:function(){--a===0&&s()}};n.each(function(){var f=na(this,r),v=f.on;v!==t&&(e=(t=v).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(u)),f.on=e}),a===0&&s()})}var tT=0;function _a(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Rg(){return++tT}var ia=yo.prototype;_a.prototype={constructor:_a,select:DA,selectAll:LA,selectChild:ia.selectChild,selectChildren:ia.selectChildren,filter:CA,merge:IA,selection:zA,transition:$A,call:ia.call,nodes:ia.nodes,node:ia.node,size:ia.size,empty:ia.empty,each:ia.each,on:OA,attr:fA,attrTween:mA,style:HA,styleTween:GA,text:XA,textTween:JA,remove:RA,tween:sA,delay:_A,duration:kA,ease:EA,easeVarying:TA,end:eT,[Symbol.iterator]:ia[Symbol.iterator]};function nT(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var rT={time:null,delay:0,duration:250,ease:nT};function aT(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function sT(t){var e,n;t instanceof _a?(e=t._id,t=t._name):(e=Rg(),(n=rT).time=Dd(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],o=i.length,u,f=0;f<o;++f)(u=i[f])&&$l(u,t,e,f,i,n||aT(u,e));return new _a(r,this._parents,t,e)}yo.prototype.interrupt=nA;yo.prototype.transition=sT;const Xo=t=>()=>t;function iT(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function pa(t,e,n){this.k=t,this.x=e,this.y=n}pa.prototype={constructor:pa,scale:function(t){return t===1?this:new pa(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new pa(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ec=new pa(1,0,0);Dg.prototype=pa.prototype;function Dg(t){for(;!t.__zoom;)if(!(t=t.parentNode))return ec;return t.__zoom}function Xc(t){t.stopImmediatePropagation()}function Oi(t){t.preventDefault(),t.stopImmediatePropagation()}function oT(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function lT(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Pv(){return this.__zoom||ec}function cT(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function uT(){return navigator.maxTouchPoints||"ontouchstart"in this}function dT(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],i=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function fT(){var t=oT,e=lT,n=dT,r=cT,a=uT,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],o=250,u=ol,f=Zl("start","zoom","end"),v,p,h,m=500,x=150,k=0,T=10;function N(P){P.property("__zoom",Pv).on("wheel.zoom",J,{passive:!1}).on("mousedown.zoom",ae).on("dblclick.zoom",ke).filter(a).on("touchstart.zoom",X).on("touchmove.zoom",A).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}N.transform=function(P,O,I,Q){var W=P.selection?P.selection():P;W.property("__zoom",Pv),P!==W?j(P,O,I,Q):W.interrupt().each(function(){L(this,arguments).event(Q).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},N.scaleBy=function(P,O,I,Q){N.scaleTo(P,function(){var W=this.__zoom.k,Z=typeof O=="function"?O.apply(this,arguments):O;return W*Z},I,Q)},N.scaleTo=function(P,O,I,Q){N.transform(P,function(){var W=e.apply(this,arguments),Z=this.__zoom,B=I==null?S(W):typeof I=="function"?I.apply(this,arguments):I,ee=Z.invert(B),ne=typeof O=="function"?O.apply(this,arguments):O;return n(G(z(Z,ne),B,ee),W,i)},I,Q)},N.translateBy=function(P,O,I,Q){N.transform(P,function(){return n(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof I=="function"?I.apply(this,arguments):I),e.apply(this,arguments),i)},null,Q)},N.translateTo=function(P,O,I,Q,W){N.transform(P,function(){var Z=e.apply(this,arguments),B=this.__zoom,ee=Q==null?S(Z):typeof Q=="function"?Q.apply(this,arguments):Q;return n(ec.translate(ee[0],ee[1]).scale(B.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof I=="function"?-I.apply(this,arguments):-I),Z,i)},Q,W)};function z(P,O){return O=Math.max(s[0],Math.min(s[1],O)),O===P.k?P:new pa(O,P.x,P.y)}function G(P,O,I){var Q=O[0]-I[0]*P.k,W=O[1]-I[1]*P.k;return Q===P.x&&W===P.y?P:new pa(P.k,Q,W)}function S(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function j(P,O,I,Q){P.on("start.zoom",function(){L(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){L(this,arguments).event(Q).end()}).tween("zoom",function(){var W=this,Z=arguments,B=L(W,Z).event(Q),ee=e.apply(W,Z),ne=I==null?S(ee):typeof I=="function"?I.apply(W,Z):I,H=Math.max(ee[1][0]-ee[0][0],ee[1][1]-ee[0][1]),U=W.__zoom,le=typeof O=="function"?O.apply(W,Z):O,Y=u(U.invert(ne).concat(H/U.k),le.invert(ne).concat(H/le.k));return function(ue){if(ue===1)ue=le;else{var be=Y(ue),ge=H/be[2];ue=new pa(ge,ne[0]-be[0]*ge,ne[1]-be[1]*ge)}B.zoom(null,ue)}})}function L(P,O,I){return!I&&P.__zooming||new D(P,O)}function D(P,O){this.that=P,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(P,O),this.taps=0}D.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,O){return this.mouse&&P!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var O=Pr(this.that).datum();f.call(P,this.that,new iT(P,{sourceEvent:this.sourceEvent,target:N,transform:this.that.__zoom,dispatch:f}),O)}};function J(P,...O){if(!t.apply(this,arguments))return;var I=L(this,O).event(P),Q=this.__zoom,W=Math.max(s[0],Math.min(s[1],Q.k*Math.pow(2,r.apply(this,arguments)))),Z=Hr(P);if(I.wheel)(I.mouse[0][0]!==Z[0]||I.mouse[0][1]!==Z[1])&&(I.mouse[1]=Q.invert(I.mouse[0]=Z)),clearTimeout(I.wheel);else{if(Q.k===W)return;I.mouse=[Z,Q.invert(Z)],ul(this),I.start()}Oi(P),I.wheel=setTimeout(B,x),I.zoom("mouse",n(G(z(Q,W),I.mouse[0],I.mouse[1]),I.extent,i));function B(){I.wheel=null,I.end()}}function ae(P,...O){if(h||!t.apply(this,arguments))return;var I=P.currentTarget,Q=L(this,O,!0).event(P),W=Pr(P.view).on("mousemove.zoom",ne,!0).on("mouseup.zoom",H,!0),Z=Hr(P,I),B=P.clientX,ee=P.clientY;_g(P.view),Xc(P),Q.mouse=[Z,this.__zoom.invert(Z)],ul(this),Q.start();function ne(U){if(Oi(U),!Q.moved){var le=U.clientX-B,Y=U.clientY-ee;Q.moved=le*le+Y*Y>k}Q.event(U).zoom("mouse",n(G(Q.that.__zoom,Q.mouse[0]=Hr(U,I),Q.mouse[1]),Q.extent,i))}function H(U){W.on("mousemove.zoom mouseup.zoom",null),wg(U.view,Q.moved),Oi(U),Q.event(U).end()}}function ke(P,...O){if(t.apply(this,arguments)){var I=this.__zoom,Q=Hr(P.changedTouches?P.changedTouches[0]:P,this),W=I.invert(Q),Z=I.k*(P.shiftKey?.5:2),B=n(G(z(I,Z),Q,W),e.apply(this,O),i);Oi(P),o>0?Pr(this).transition().duration(o).call(j,B,Q,P):Pr(this).call(N.transform,B,Q,P)}}function X(P,...O){if(t.apply(this,arguments)){var I=P.touches,Q=I.length,W=L(this,O,P.changedTouches.length===Q).event(P),Z,B,ee,ne;for(Xc(P),B=0;B<Q;++B)ee=I[B],ne=Hr(ee,this),ne=[ne,this.__zoom.invert(ne),ee.identifier],W.touch0?!W.touch1&&W.touch0[2]!==ne[2]&&(W.touch1=ne,W.taps=0):(W.touch0=ne,Z=!0,W.taps=1+!!v);v&&(v=clearTimeout(v)),Z&&(W.taps<2&&(p=ne[0],v=setTimeout(function(){v=null},m)),ul(this),W.start())}}function A(P,...O){if(this.__zooming){var I=L(this,O).event(P),Q=P.changedTouches,W=Q.length,Z,B,ee,ne;for(Oi(P),Z=0;Z<W;++Z)B=Q[Z],ee=Hr(B,this),I.touch0&&I.touch0[2]===B.identifier?I.touch0[0]=ee:I.touch1&&I.touch1[2]===B.identifier&&(I.touch1[0]=ee);if(B=I.that.__zoom,I.touch1){var H=I.touch0[0],U=I.touch0[1],le=I.touch1[0],Y=I.touch1[1],ue=(ue=le[0]-H[0])*ue+(ue=le[1]-H[1])*ue,be=(be=Y[0]-U[0])*be+(be=Y[1]-U[1])*be;B=z(B,Math.sqrt(ue/be)),ee=[(H[0]+le[0])/2,(H[1]+le[1])/2],ne=[(U[0]+Y[0])/2,(U[1]+Y[1])/2]}else if(I.touch0)ee=I.touch0[0],ne=I.touch0[1];else return;I.zoom("touch",n(G(B,ee,ne),I.extent,i))}}function K(P,...O){if(this.__zooming){var I=L(this,O).event(P),Q=P.changedTouches,W=Q.length,Z,B;for(Xc(P),h&&clearTimeout(h),h=setTimeout(function(){h=null},m),Z=0;Z<W;++Z)B=Q[Z],I.touch0&&I.touch0[2]===B.identifier?delete I.touch0:I.touch1&&I.touch1[2]===B.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(B=Hr(B,this),Math.hypot(p[0]-B[0],p[1]-B[1])<T)){var ee=Pr(this).on("dblclick.zoom");ee&&ee.apply(this,arguments)}}}return N.wheelDelta=function(P){return arguments.length?(r=typeof P=="function"?P:Xo(+P),N):r},N.filter=function(P){return arguments.length?(t=typeof P=="function"?P:Xo(!!P),N):t},N.touchable=function(P){return arguments.length?(a=typeof P=="function"?P:Xo(!!P),N):a},N.extent=function(P){return arguments.length?(e=typeof P=="function"?P:Xo([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),N):e},N.scaleExtent=function(P){return arguments.length?(s[0]=+P[0],s[1]=+P[1],N):[s[0],s[1]]},N.translateExtent=function(P){return arguments.length?(i[0][0]=+P[0][0],i[1][0]=+P[1][0],i[0][1]=+P[0][1],i[1][1]=+P[1][1],N):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},N.constrain=function(P){return arguments.length?(n=P,N):n},N.duration=function(P){return arguments.length?(o=+P,N):o},N.interpolate=function(P){return arguments.length?(u=P,N):u},N.on=function(){var P=f.on.apply(f,arguments);return P===f?N:P},N.clickDistance=function(P){return arguments.length?(k=(P=+P)*P,N):Math.sqrt(k)},N.tapDistance=function(P){return arguments.length?(T=+P,N):T},N}const Qi={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Hu=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Lg=["Enter"," ","Escape"],vT={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ai;(function(t){t.Strict="strict",t.Loose="loose"})(ai||(ai={}));var Ks;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(Ks||(Ks={}));var Tl;(function(t){t.Partial="partial",t.Full="full"})(Tl||(Tl={}));const Vu={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Pa;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(Pa||(Pa={}));var Cl;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Cl||(Cl={}));var _t;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(_t||(_t={}));const Mv={[_t.Left]:_t.Right,[_t.Right]:_t.Left,[_t.Top]:_t.Bottom,[_t.Bottom]:_t.Top};function hT(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function Ov(t,e,n){if(!n)return;const r=[];t.forEach((a,s)=>{e!=null&&e.has(s)||r.push(a)}),r.length&&n(r)}function pT(t){return t===null?null:t?"valid":"invalid"}const jg=t=>"id"in t&&"source"in t&&"target"in t,gT=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),zd=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),_o=(t,e=[0,0])=>{const{width:n,height:r}=Cs(t),a=t.origin??e,s=n*a[0],i=r*a[1];return{x:t.position.x-s,y:t.position.y-i}},mT=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,a)=>{const s=typeof a=="string";let i=!e.nodeLookup&&!s?a:void 0;e.nodeLookup&&(i=s?e.nodeLookup.get(a):zd(a)?a:e.nodeLookup.get(a.id));const o=i?Il(i,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return nc(r,o)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return rc(n)},tc=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(a=>{(e.filter===void 0||e.filter(a))&&(n=nc(n,Il(a)),r=!0)}),r?rc(n):{x:0,y:0,width:0,height:0}},Bd=(t,e,[n,r,a]=[0,0,1],s=!1,i=!1)=>{const o={...xo(e,[n,r,a]),width:e.width/a,height:e.height/a},u=[];for(const f of t.values()){const{measured:v,selectable:p=!0,hidden:h=!1}=f;if(i&&!p||h)continue;const m=v.width??f.width??f.initialWidth??null,x=v.height??f.height??f.initialHeight??null,k=Ji(o,ii(f)),T=(m??0)*(x??0),N=s&&k>0;(!f.internals.handleBounds||N||k>=T||f.dragging)&&u.push(f)}return u},yT=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function bT(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(a=>a.id)):null;return t.forEach(a=>{a.measured.width&&a.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!a.hidden)&&(!r||r.has(a.id))&&n.set(a.id,a)}),n}async function _T({nodes:t,width:e,height:n,panZoom:r,minZoom:a,maxZoom:s},i){if(t.size===0)return Promise.resolve(!0);const o=bT(t,i),u=tc(o),f=qd(u,e,n,(i==null?void 0:i.minZoom)??a,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await r.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function zg({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:a,onError:s}){const i=n.get(t),o=i.parentId?n.get(i.parentId):void 0,{x:u,y:f}=o?o.internals.positionAbsolute:{x:0,y:0},v=i.origin??r;let p=i.extent||a;if(i.extent==="parent"&&!i.expandParent)if(!o)s==null||s("005",Qi.error005());else{const m=o.measured.width,x=o.measured.height;m&&x&&(p=[[u,f],[u+m,f+x]])}else o&&oi(i.extent)&&(p=[[i.extent[0][0]+u,i.extent[0][1]+f],[i.extent[1][0]+u,i.extent[1][1]+f]]);const h=oi(p)?_s(e,p,i.measured):e;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",Qi.error015())),{position:{x:h.x-u+(i.measured.width??0)*v[0],y:h.y-f+(i.measured.height??0)*v[1]},positionAbsolute:h}}async function wT({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:a}){const s=new Set(t.map(h=>h.id)),i=[];for(const h of n){if(h.deletable===!1)continue;const m=s.has(h.id),x=!m&&h.parentId&&i.find(k=>k.id===h.parentId);(m||x)&&i.push(h)}const o=new Set(e.map(h=>h.id)),u=r.filter(h=>h.deletable!==!1),v=yT(i,u);for(const h of u)o.has(h.id)&&!v.find(x=>x.id===h.id)&&v.push(h);if(!a)return{edges:v,nodes:i};const p=await a({nodes:i,edges:v});return typeof p=="boolean"?p?{edges:v,nodes:i}:{edges:[],nodes:[]}:p}const si=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),_s=(t={x:0,y:0},e,n)=>({x:si(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:si(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function Bg(t,e,n){const{width:r,height:a}=Cs(n),{x:s,y:i}=n.internals.positionAbsolute;return _s(t,[[s,i],[s+r,i+a]],e)}const Nv=(t,e,n)=>t<e?si(Math.abs(t-e),1,e)/e:t>n?-si(Math.abs(t-n),1,e)/e:0,qg=(t,e,n=15,r=40)=>{const a=Nv(t.x,r,e.width-r)*n,s=Nv(t.y,r,e.height-r)*n;return[a,s]},nc=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Uu=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),rc=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),ii=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=zd(t)?t.internals.positionAbsolute:_o(t,e);return{x:n,y:r,width:((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0,height:((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0}},Il=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=zd(t)?t.internals.positionAbsolute:_o(t,e);return{x:n,y:r,x2:n+(((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0),y2:r+(((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0)}},xT=(t,e)=>rc(nc(Uu(t),Uu(e))),Ji=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Rv=t=>ga(t.width)&&ga(t.height)&&ga(t.x)&&ga(t.y),ga=t=>!isNaN(t)&&isFinite(t),kT=(t,e)=>{},wo=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),xo=({x:t,y:e},[n,r,a],s=!1,i=[1,1])=>{const o={x:(t-n)/a,y:(e-r)/a};return s?wo(o,i):o},Pl=({x:t,y:e},[n,r,a])=>({x:t*a+n,y:e*a+r});function js(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function ST(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=js(t,n),a=js(t,e);return{top:r,right:a,bottom:r,left:a,x:a*2,y:r*2}}if(typeof t=="object"){const r=js(t.top??t.y??0,n),a=js(t.bottom??t.y??0,n),s=js(t.left??t.x??0,e),i=js(t.right??t.x??0,e);return{top:r,right:i,bottom:a,left:s,x:s+i,y:r+a}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function ET(t,e,n,r,a,s){const{x:i,y:o}=Pl(t,[e,n,r]),{x:u,y:f}=Pl({x:t.x+t.width,y:t.y+t.height},[e,n,r]),v=a-u,p=s-f;return{left:Math.floor(i),top:Math.floor(o),right:Math.floor(v),bottom:Math.floor(p)}}const qd=(t,e,n,r,a,s)=>{const i=ST(s,e,n),o=(e-i.x)/t.width,u=(n-i.y)/t.height,f=Math.min(o,u),v=si(f,r,a),p=t.x+t.width/2,h=t.y+t.height/2,m=e/2-p*v,x=n/2-h*v,k=ET(t,m,x,v,e,n),T={left:Math.min(k.left-i.left,0),top:Math.min(k.top-i.top,0),right:Math.min(k.right-i.right,0),bottom:Math.min(k.bottom-i.bottom,0)};return{x:m-T.left+T.right,y:x-T.top+T.bottom,zoom:v}},Ml=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function oi(t){return t!=null&&t!=="parent"}function Cs(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function AT(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function TT(t,e={width:0,height:0},n,r,a){const s={...t},i=r.get(n);if(i){const o=i.origin||a;s.x+=i.internals.positionAbsolute.x-(e.width??0)*o[0],s.y+=i.internals.positionAbsolute.y-(e.height??0)*o[1]}return s}function CT(t){return{...vT,...t||{}}}function Zc(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:a}){const{x:s,y:i}=Rr(t),o=xo({x:s-((a==null?void 0:a.left)??0),y:i-((a==null?void 0:a.top)??0)},r),{x:u,y:f}=n?wo(o,e):o;return{xSnapped:u,ySnapped:f,...o}}const Fg=t=>({width:t.offsetWidth,height:t.offsetHeight}),Kg=t=>{var e;return((e=t==null?void 0:t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},IT=["INPUT","SELECT","TEXTAREA"];function Hg(t){var r,a;const e=((a=(r=t.composedPath)==null?void 0:r.call(t))==null?void 0:a[0])||t.target;return(e==null?void 0:e.nodeType)!==1?!1:IT.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const Vg=t=>"clientX"in t,Rr=(t,e)=>{var s,i;const n=Vg(t),r=n?t.clientX:(s=t.touches)==null?void 0:s[0].clientX,a=n?t.clientY:(i=t.touches)==null?void 0:i[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:a-((e==null?void 0:e.top)??0)}},Dv=(t,e,n,r,a)=>{const s=e.querySelectorAll(`.${t}`);return!s||!s.length?null:Array.from(s).map(i=>{const o=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:t,nodeId:a,position:i.getAttribute("data-handlepos"),x:(o.left-n.left)/r,y:(o.top-n.top)/r,...Fg(i)}})};function PT({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:s,targetControlX:i,targetControlY:o}){const u=t*.125+a*.375+i*.375+n*.125,f=e*.125+s*.375+o*.375+r*.125,v=Math.abs(u-t),p=Math.abs(f-e);return[u,f,v,p]}function Zo(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function Lv({pos:t,x1:e,y1:n,x2:r,y2:a,c:s}){switch(t){case _t.Left:return[e-Zo(e-r,s),n];case _t.Right:return[e+Zo(r-e,s),n];case _t.Top:return[e,n-Zo(n-a,s)];case _t.Bottom:return[e,n+Zo(a-n,s)]}}function Ug({sourceX:t,sourceY:e,sourcePosition:n=_t.Bottom,targetX:r,targetY:a,targetPosition:s=_t.Top,curvature:i=.25}){const[o,u]=Lv({pos:n,x1:t,y1:e,x2:r,y2:a,c:i}),[f,v]=Lv({pos:s,x1:r,y1:a,x2:t,y2:e,c:i}),[p,h,m,x]=PT({sourceX:t,sourceY:e,targetX:r,targetY:a,sourceControlX:o,sourceControlY:u,targetControlX:f,targetControlY:v});return[`M${t},${e} C${o},${u} ${f},${v} ${r},${a}`,p,h,m,x]}function Gg({sourceX:t,sourceY:e,targetX:n,targetY:r}){const a=Math.abs(n-t)/2,s=n<t?n+a:n-a,i=Math.abs(r-e)/2,o=r<e?r+i:r-i;return[s,o,a,i]}function MT({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:a=!1,zIndexMode:s="basic"}){if(s==="manual")return r;const i=a&&n?r+1e3:r,o=Math.max(t.parentId||a&&t.selected?t.internals.z:0,e.parentId||a&&e.selected?e.internals.z:0);return i+o}function OT({sourceNode:t,targetNode:e,width:n,height:r,transform:a}){const s=nc(Il(t),Il(e));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-a[0]/a[2],y:-a[1]/a[2],width:n/a[2],height:r/a[2]};return Ji(i,rc(s))>0}const NT=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,RT=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),DT=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||NT;let a;return jg(t)?a={...t}:a={...t,id:r(t)},RT(a,e)?e:(a.sourceHandle===null&&delete a.sourceHandle,a.targetHandle===null&&delete a.targetHandle,e.concat(a))};function Wg({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[a,s,i,o]=Gg({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,a,s,i,o]}const jv={[_t.Left]:{x:-1,y:0},[_t.Right]:{x:1,y:0},[_t.Top]:{x:0,y:-1},[_t.Bottom]:{x:0,y:1}},LT=({source:t,sourcePosition:e=_t.Bottom,target:n})=>e===_t.Left||e===_t.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},zv=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function jT({source:t,sourcePosition:e=_t.Bottom,target:n,targetPosition:r=_t.Top,center:a,offset:s,stepPosition:i}){const o=jv[e],u=jv[r],f={x:t.x+o.x*s,y:t.y+o.y*s},v={x:n.x+u.x*s,y:n.y+u.y*s},p=LT({source:f,sourcePosition:e,target:v}),h=p.x!==0?"x":"y",m=p[h];let x=[],k,T;const N={x:0,y:0},z={x:0,y:0},[,,G,S]=Gg({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(o[h]*u[h]===-1){h==="x"?(k=a.x??f.x+(v.x-f.x)*i,T=a.y??(f.y+v.y)/2):(k=a.x??(f.x+v.x)/2,T=a.y??f.y+(v.y-f.y)*i);const L=[{x:k,y:f.y},{x:k,y:v.y}],D=[{x:f.x,y:T},{x:v.x,y:T}];o[h]===m?x=h==="x"?L:D:x=h==="x"?D:L}else{const L=[{x:f.x,y:v.y}],D=[{x:v.x,y:f.y}];if(h==="x"?x=o.x===m?D:L:x=o.y===m?L:D,e===r){const A=Math.abs(t[h]-n[h]);if(A<=s){const K=Math.min(s-1,s-A);o[h]===m?N[h]=(f[h]>t[h]?-1:1)*K:z[h]=(v[h]>n[h]?-1:1)*K}}if(e!==r){const A=h==="x"?"y":"x",K=o[h]===u[A],P=f[A]>v[A],O=f[A]<v[A];(o[h]===1&&(!K&&P||K&&O)||o[h]!==1&&(!K&&O||K&&P))&&(x=h==="x"?L:D)}const J={x:f.x+N.x,y:f.y+N.y},ae={x:v.x+z.x,y:v.y+z.y},ke=Math.max(Math.abs(J.x-x[0].x),Math.abs(ae.x-x[0].x)),X=Math.max(Math.abs(J.y-x[0].y),Math.abs(ae.y-x[0].y));ke>=X?(k=(J.x+ae.x)/2,T=x[0].y):(k=x[0].x,T=(J.y+ae.y)/2)}return[[t,{x:f.x+N.x,y:f.y+N.y},...x,{x:v.x+z.x,y:v.y+z.y},n],k,T,G,S]}function zT(t,e,n,r){const a=Math.min(zv(t,e)/2,zv(e,n)/2,r),{x:s,y:i}=e;if(t.x===s&&s===n.x||t.y===i&&i===n.y)return`L${s} ${i}`;if(t.y===i){const f=t.x<n.x?-1:1,v=t.y<n.y?1:-1;return`L ${s+a*f},${i}Q ${s},${i} ${s},${i+a*v}`}const o=t.x<n.x?1:-1,u=t.y<n.y?-1:1;return`L ${s},${i+a*u}Q ${s},${i} ${s+a*o},${i}`}function Fd({sourceX:t,sourceY:e,sourcePosition:n=_t.Bottom,targetX:r,targetY:a,targetPosition:s=_t.Top,borderRadius:i=5,centerX:o,centerY:u,offset:f=20,stepPosition:v=.5}){const[p,h,m,x,k]=jT({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:a},targetPosition:s,center:{x:o,y:u},offset:f,stepPosition:v});return[p.reduce((N,z,G)=>{let S="";return G>0&&G<p.length-1?S=zT(p[G-1],z,p[G+1],i):S=`${G===0?"M":"L"}${z.x} ${z.y}`,N+=S,N},""),h,m,x,k]}function Bv(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function BT(t){var p;const{sourceNode:e,targetNode:n}=t;if(!Bv(e)||!Bv(n))return null;const r=e.internals.handleBounds||qv(e.handles),a=n.internals.handleBounds||qv(n.handles),s=Fv((r==null?void 0:r.source)??[],t.sourceHandle),i=Fv(t.connectionMode===ai.Strict?(a==null?void 0:a.target)??[]:((a==null?void 0:a.target)??[]).concat((a==null?void 0:a.source)??[]),t.targetHandle);if(!s||!i)return(p=t.onError)==null||p.call(t,"008",Qi.error008(s?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const o=(s==null?void 0:s.position)||_t.Bottom,u=(i==null?void 0:i.position)||_t.Top,f=ws(e,s,o),v=ws(n,i,u);return{sourceX:f.x,sourceY:f.y,targetX:v.x,targetY:v.y,sourcePosition:o,targetPosition:u}}function qv(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function ws(t,e,n=_t.Left,r=!1){const a=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,s=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:i,height:o}=e??Cs(t);if(r)return{x:a+i/2,y:s+o/2};switch((e==null?void 0:e.position)??n){case _t.Top:return{x:a+i/2,y:s};case _t.Right:return{x:a+i,y:s+o/2};case _t.Bottom:return{x:a+i/2,y:s+o};case _t.Left:return{x:a,y:s+o/2}}}function Fv(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function Gu(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function qT(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:a}){const s=new Set;return t.reduce((i,o)=>([o.markerStart||r,o.markerEnd||a].forEach(u=>{if(u&&typeof u=="object"){const f=Gu(u,e);s.has(f)||(i.push({id:f,color:u.color||n,...u}),s.add(f))}}),i),[]).sort((i,o)=>i.id.localeCompare(o.id))}const Yg=1e3,FT=10,Kd={nodeOrigin:[0,0],nodeExtent:Hu,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},KT={...Kd,checkEquality:!0};function Hd(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function HT(t,e,n){const r=Hd(Kd,n);for(const a of t.values())if(a.parentId)Ud(a,t,e,r);else{const s=_o(a,r.nodeOrigin),i=oi(a.extent)?a.extent:r.nodeExtent,o=_s(s,i,Cs(a));a.internals.positionAbsolute=o}}function VT(t,e){if(!t.handles)return t.measured?e==null?void 0:e.internals.handleBounds:void 0;const n=[],r=[];for(const a of t.handles){const s={id:a.id,width:a.width??1,height:a.height??1,nodeId:t.id,x:a.x,y:a.y,position:a.position,type:a.type};a.type==="source"?n.push(s):a.type==="target"&&r.push(s)}return{source:n,target:r}}function Vd(t){return t==="manual"}function UT(t,e,n,r={}){var f,v;const a=Hd(KT,r),s={i:0},i=new Map(e),o=a!=null&&a.elevateNodesOnSelect&&!Vd(a.zIndexMode)?Yg:0;let u=t.length>0;e.clear(),n.clear();for(const p of t){let h=i.get(p.id);if(a.checkEquality&&p===(h==null?void 0:h.internals.userNode))e.set(p.id,h);else{const m=_o(p,a.nodeOrigin),x=oi(p.extent)?p.extent:a.nodeExtent,k=_s(m,x,Cs(p));h={...a.defaults,...p,measured:{width:(f=p.measured)==null?void 0:f.width,height:(v=p.measured)==null?void 0:v.height},internals:{positionAbsolute:k,handleBounds:VT(p,h),z:Xg(p,o,a.zIndexMode),userNode:p}},e.set(p.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(u=!1),p.parentId&&Ud(h,e,n,r,s)}return u}function GT(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function Ud(t,e,n,r,a){const{elevateNodesOnSelect:s,nodeOrigin:i,nodeExtent:o,zIndexMode:u}=Hd(Kd,r),f=t.parentId,v=e.get(f);if(!v){console.warn(`Parent node ${f} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}GT(t,n),a&&!v.parentId&&v.internals.rootParentIndex===void 0&&u==="auto"&&(v.internals.rootParentIndex=++a.i,v.internals.z=v.internals.z+a.i*FT),a&&v.internals.rootParentIndex!==void 0&&(a.i=v.internals.rootParentIndex);const p=s&&!Vd(u)?Yg:0,{x:h,y:m,z:x}=WT(t,v,i,o,p,u),{positionAbsolute:k}=t.internals,T=h!==k.x||m!==k.y;(T||x!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:T?{x:h,y:m}:k,z:x}})}function Xg(t,e,n){const r=ga(t.zIndex)?t.zIndex:0;return Vd(n)?r:r+(t.selected?e:0)}function WT(t,e,n,r,a,s){const{x:i,y:o}=e.internals.positionAbsolute,u=Cs(t),f=_o(t,n),v=oi(t.extent)?_s(f,t.extent,u):f;let p=_s({x:i+v.x,y:o+v.y},r,u);t.extent==="parent"&&(p=Bg(p,u,e));const h=Xg(t,a,s),m=e.internals.z??0;return{x:p.x,y:p.y,z:m>=h?m+1:h}}function YT(t,e,n,r=[0,0]){var i;const a=[],s=new Map;for(const o of t){const u=e.get(o.parentId);if(!u)continue;const f=((i=s.get(o.parentId))==null?void 0:i.expandedRect)??ii(u),v=xT(f,o.rect);s.set(o.parentId,{expandedRect:v,parent:u})}return s.size>0&&s.forEach(({expandedRect:o,parent:u},f)=>{var G;const v=u.internals.positionAbsolute,p=Cs(u),h=u.origin??r,m=o.x<v.x?Math.round(Math.abs(v.x-o.x)):0,x=o.y<v.y?Math.round(Math.abs(v.y-o.y)):0,k=Math.max(p.width,Math.round(o.width)),T=Math.max(p.height,Math.round(o.height)),N=(k-p.width)*h[0],z=(T-p.height)*h[1];(m>0||x>0||N||z)&&(a.push({id:f,type:"position",position:{x:u.position.x-m+N,y:u.position.y-x+z}}),(G=n.get(f))==null||G.forEach(S=>{t.some(j=>j.id===S.id)||a.push({id:S.id,type:"position",position:{x:S.position.x+m,y:S.position.y+x}})})),(p.width<o.width||p.height<o.height||m||x)&&a.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:k+(m?h[0]*m-N:0),height:T+(x?h[1]*x-z:0)}})}),a}function XT(t,e,n,r,a,s,i){const o=r==null?void 0:r.querySelector(".xyflow__viewport");let u=!1;if(!o)return{changes:[],updatedInternals:u};const f=[],v=window.getComputedStyle(o),{m22:p}=new window.DOMMatrixReadOnly(v.transform),h=[];for(const m of t.values()){const x=e.get(m.id);if(!x)continue;if(x.hidden){e.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),u=!0;continue}const k=Fg(m.nodeElement),T=x.measured.width!==k.width||x.measured.height!==k.height;if(!!(k.width&&k.height&&(T||!x.internals.handleBounds||m.force))){const z=m.nodeElement.getBoundingClientRect(),G=oi(x.extent)?x.extent:s;let{positionAbsolute:S}=x.internals;x.parentId&&x.extent==="parent"?S=Bg(S,k,e.get(x.parentId)):G&&(S=_s(S,G,k));const j={...x,measured:k,internals:{...x.internals,positionAbsolute:S,handleBounds:{source:Dv("source",m.nodeElement,z,p,x.id),target:Dv("target",m.nodeElement,z,p,x.id)}}};e.set(x.id,j),x.parentId&&Ud(j,e,n,{nodeOrigin:a,zIndexMode:i}),u=!0,T&&(f.push({id:x.id,type:"dimensions",dimensions:k}),x.expandParent&&x.parentId&&h.push({id:x.id,parentId:x.parentId,rect:ii(j,a)}))}}if(h.length>0){const m=YT(h,e,n,a);f.push(...m)}return{changes:f,updatedInternals:u}}async function ZT({delta:t,panZoom:e,transform:n,translateExtent:r,width:a,height:s}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const i=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[a,s]],r),o=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(o)}function Kv(t,e,n,r,a,s){let i=a;const o=r.get(i)||new Map;r.set(i,o.set(n,e)),i=`${a}-${t}`;const u=r.get(i)||new Map;if(r.set(i,u.set(n,e)),s){i=`${a}-${t}-${s}`;const f=r.get(i)||new Map;r.set(i,f.set(n,e))}}function QT(t,e,n){t.clear(),e.clear();for(const r of n){const{source:a,target:s,sourceHandle:i=null,targetHandle:o=null}=r,u={edgeId:r.id,source:a,target:s,sourceHandle:i,targetHandle:o},f=`${a}-${i}--${s}-${o}`,v=`${s}-${o}--${a}-${i}`;Kv("source",u,v,t,a,i),Kv("target",u,f,t,s,o),e.set(r.id,r)}}function Zg(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Zg(n,e):!1}function Hv(t,e,n){var a;let r=t;do{if((a=r==null?void 0:r.matches)!=null&&a.call(r,e))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function JT(t,e,n,r){const a=new Map;for(const[s,i]of t)if((i.selected||i.id===r)&&(!i.parentId||!Zg(i,t))&&(i.draggable||e&&typeof i.draggable>"u")){const o=t.get(s);o&&a.set(s,{id:s,position:o.position||{x:0,y:0},distance:{x:n.x-o.internals.positionAbsolute.x,y:n.y-o.internals.positionAbsolute.y},extent:o.extent,parentId:o.parentId,origin:o.origin,expandParent:o.expandParent,internals:{positionAbsolute:o.internals.positionAbsolute||{x:0,y:0}},measured:{width:o.measured.width??0,height:o.measured.height??0}})}return a}function Qc({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var i,o,u;const a=[];for(const[f,v]of e){const p=(i=n.get(f))==null?void 0:i.internals.userNode;p&&a.push({...p,position:v.position,dragging:r})}if(!t)return[a[0],a];const s=(o=n.get(t))==null?void 0:o.internals.userNode;return[s?{...s,position:((u=e.get(t))==null?void 0:u.position)||s.position,dragging:r}:a[0],a]}function $T({dragItems:t,snapGrid:e,x:n,y:r}){const a=t.values().next().value;if(!a)return null;const s={x:n-a.distance.x,y:r-a.distance.y},i=wo(s,e);return{x:i.x-s.x,y:i.y-s.y}}function eC({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:a}){let s={x:null,y:null},i=0,o=new Map,u=!1,f={x:0,y:0},v=null,p=!1,h=null,m=!1,x=!1,k=null;function T({noDragClassName:z,handleSelector:G,domNode:S,isSelectable:j,nodeId:L,nodeClickDistance:D=0}){h=Pr(S);function J({x:A,y:K}){const{nodeLookup:P,nodeExtent:O,snapGrid:I,snapToGrid:Q,nodeOrigin:W,onNodeDrag:Z,onSelectionDrag:B,onError:ee,updateNodePositions:ne}=e();s={x:A,y:K};let H=!1;const U=o.size>1,le=U&&O?Uu(tc(o)):null,Y=U&&Q?$T({dragItems:o,snapGrid:I,x:A,y:K}):null;for(const[ue,be]of o){if(!P.has(ue))continue;let ge={x:A-be.distance.x,y:K-be.distance.y};Q&&(ge=Y?{x:Math.round(ge.x+Y.x),y:Math.round(ge.y+Y.y)}:wo(ge,I));let re=null;if(U&&O&&!be.extent&&le){const{positionAbsolute:Pe}=be.internals,He=Pe.x-le.x+O[0][0],Ze=Pe.x+be.measured.width-le.x2+O[1][0],vt=Pe.y-le.y+O[0][1],ht=Pe.y+be.measured.height-le.y2+O[1][1];re=[[He,vt],[Ze,ht]]}const{position:Te,positionAbsolute:_e}=zg({nodeId:ue,nextPosition:ge,nodeLookup:P,nodeExtent:re||O,nodeOrigin:W,onError:ee});H=H||be.position.x!==Te.x||be.position.y!==Te.y,be.position=Te,be.internals.positionAbsolute=_e}if(x=x||H,!!H&&(ne(o,!0),k&&(r||Z||!L&&B))){const[ue,be]=Qc({nodeId:L,dragItems:o,nodeLookup:P});r==null||r(k,o,ue,be),Z==null||Z(k,ue,be),L||B==null||B(k,be)}}async function ae(){if(!v)return;const{transform:A,panBy:K,autoPanSpeed:P,autoPanOnNodeDrag:O}=e();if(!O){u=!1,cancelAnimationFrame(i);return}const[I,Q]=qg(f,v,P);(I!==0||Q!==0)&&(s.x=(s.x??0)-I/A[2],s.y=(s.y??0)-Q/A[2],await K({x:I,y:Q})&&J(s)),i=requestAnimationFrame(ae)}function ke(A){var U;const{nodeLookup:K,multiSelectionActive:P,nodesDraggable:O,transform:I,snapGrid:Q,snapToGrid:W,selectNodesOnDrag:Z,onNodeDragStart:B,onSelectionDragStart:ee,unselectNodesAndEdges:ne}=e();p=!0,(!Z||!j)&&!P&&L&&((U=K.get(L))!=null&&U.selected||ne()),j&&Z&&L&&(t==null||t(L));const H=Zc(A.sourceEvent,{transform:I,snapGrid:Q,snapToGrid:W,containerBounds:v});if(s=H,o=JT(K,O,H,L),o.size>0&&(n||B||!L&&ee)){const[le,Y]=Qc({nodeId:L,dragItems:o,nodeLookup:K});n==null||n(A.sourceEvent,o,le,Y),B==null||B(A.sourceEvent,le,Y),L||ee==null||ee(A.sourceEvent,Y)}}const X=bE().clickDistance(D).on("start",A=>{const{domNode:K,nodeDragThreshold:P,transform:O,snapGrid:I,snapToGrid:Q}=e();v=(K==null?void 0:K.getBoundingClientRect())||null,m=!1,x=!1,k=A.sourceEvent,P===0&&ke(A),s=Zc(A.sourceEvent,{transform:O,snapGrid:I,snapToGrid:Q,containerBounds:v}),f=Rr(A.sourceEvent,v)}).on("drag",A=>{const{autoPanOnNodeDrag:K,transform:P,snapGrid:O,snapToGrid:I,nodeDragThreshold:Q,nodeLookup:W}=e(),Z=Zc(A.sourceEvent,{transform:P,snapGrid:O,snapToGrid:I,containerBounds:v});if(k=A.sourceEvent,(A.sourceEvent.type==="touchmove"&&A.sourceEvent.touches.length>1||L&&!W.has(L))&&(m=!0),!m){if(!u&&K&&p&&(u=!0,ae()),!p){const B=Rr(A.sourceEvent,v),ee=B.x-f.x,ne=B.y-f.y;Math.sqrt(ee*ee+ne*ne)>Q&&ke(A)}(s.x!==Z.xSnapped||s.y!==Z.ySnapped)&&o&&p&&(f=Rr(A.sourceEvent,v),J(Z))}}).on("end",A=>{if(!(!p||m)&&(u=!1,p=!1,cancelAnimationFrame(i),o.size>0)){const{nodeLookup:K,updateNodePositions:P,onNodeDragStop:O,onSelectionDragStop:I}=e();if(x&&(P(o,!1),x=!1),a||O||!L&&I){const[Q,W]=Qc({nodeId:L,dragItems:o,nodeLookup:K,dragging:!1});a==null||a(A.sourceEvent,o,Q,W),O==null||O(A.sourceEvent,Q,W),L||I==null||I(A.sourceEvent,W)}}}).filter(A=>{const K=A.target;return!A.button&&(!z||!Hv(K,`.${z}`,S))&&(!G||Hv(K,G,S))});h.call(X)}function N(){h==null||h.on(".drag",null)}return{update:T,destroy:N}}function tC(t,e,n){const r=[],a={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const s of e.values())Ji(a,ii(s))>0&&r.push(s);return r}const nC=250;function rC(t,e,n,r){var o,u;let a=[],s=1/0;const i=tC(t,n,e+nC);for(const f of i){const v=[...((o=f.internals.handleBounds)==null?void 0:o.source)??[],...((u=f.internals.handleBounds)==null?void 0:u.target)??[]];for(const p of v){if(r.nodeId===p.nodeId&&r.type===p.type&&r.id===p.id)continue;const{x:h,y:m}=ws(f,p,p.position,!0),x=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(m-t.y,2));x>e||(x<s?(a=[{...p,x:h,y:m}],s=x):x===s&&a.push({...p,x:h,y:m}))}}if(!a.length)return null;if(a.length>1){const f=r.type==="source"?"target":"source";return a.find(v=>v.type===f)??a[0]}return a[0]}function Qg(t,e,n,r,a,s=!1){var f,v,p;const i=r.get(t);if(!i)return null;const o=a==="strict"?(f=i.internals.handleBounds)==null?void 0:f[e]:[...((v=i.internals.handleBounds)==null?void 0:v.source)??[],...((p=i.internals.handleBounds)==null?void 0:p.target)??[]],u=(n?o==null?void 0:o.find(h=>h.id===n):o==null?void 0:o[0])??null;return u&&s?{...u,...ws(i,u,u.position,!0)}:u}function Jg(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function aC(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const $g=()=>!0;function sC(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:a,edgeUpdaterType:s,isTarget:i,domNode:o,nodeLookup:u,lib:f,autoPanOnConnect:v,flowId:p,panBy:h,cancelConnection:m,onConnectStart:x,onConnect:k,onConnectEnd:T,isValidConnection:N=$g,onReconnectEnd:z,updateConnection:G,getTransform:S,getFromHandle:j,autoPanSpeed:L,dragThreshold:D=1,handleDomNode:J}){const ae=Kg(t.target);let ke=0,X;const{x:A,y:K}=Rr(t),P=Jg(s,J),O=o==null?void 0:o.getBoundingClientRect();let I=!1;if(!O||!P)return;const Q=Qg(a,P,r,u,e);if(!Q)return;let W=Rr(t,O),Z=!1,B=null,ee=!1,ne=null;function H(){if(!v||!O)return;const[Te,_e]=qg(W,O,L);h({x:Te,y:_e}),ke=requestAnimationFrame(H)}const U={...Q,nodeId:a,type:P,position:Q.position},le=u.get(a);let ue={inProgress:!0,isValid:null,from:ws(le,U,_t.Left,!0),fromHandle:U,fromPosition:U.position,fromNode:le,to:W,toHandle:null,toPosition:Mv[U.position],toNode:null,pointer:W};function be(){I=!0,G(ue),x==null||x(t,{nodeId:a,handleId:r,handleType:P})}D===0&&be();function ge(Te){if(!I){const{x:ht,y:je}=Rr(Te),De=ht-A,Fe=je-K;if(!(De*De+Fe*Fe>D*D))return;be()}if(!j()||!U){re(Te);return}const _e=S();W=Rr(Te,O),X=rC(xo(W,_e,!1,[1,1]),n,u,U),Z||(H(),Z=!0);const Pe=em(Te,{handle:X,connectionMode:e,fromNodeId:a,fromHandleId:r,fromType:i?"target":"source",isValidConnection:N,doc:ae,lib:f,flowId:p,nodeLookup:u});ne=Pe.handleDomNode,B=Pe.connection,ee=aC(!!X,Pe.isValid);const He=u.get(a),Ze=He?ws(He,U,_t.Left,!0):ue.from,vt={...ue,from:Ze,isValid:ee,to:Pe.toHandle&&ee?Pl({x:Pe.toHandle.x,y:Pe.toHandle.y},_e):W,toHandle:Pe.toHandle,toPosition:ee&&Pe.toHandle?Pe.toHandle.position:Mv[U.position],toNode:Pe.toHandle?u.get(Pe.toHandle.nodeId):null,pointer:W};G(vt),ue=vt}function re(Te){if(!("touches"in Te&&Te.touches.length>0)){if(I){(X||ne)&&B&&ee&&(k==null||k(B));const{inProgress:_e,...Pe}=ue,He={...Pe,toPosition:ue.toHandle?ue.toPosition:null};T==null||T(Te,He),s&&(z==null||z(Te,He))}m(),cancelAnimationFrame(ke),Z=!1,ee=!1,B=null,ne=null,ae.removeEventListener("mousemove",ge),ae.removeEventListener("mouseup",re),ae.removeEventListener("touchmove",ge),ae.removeEventListener("touchend",re)}}ae.addEventListener("mousemove",ge),ae.addEventListener("mouseup",re),ae.addEventListener("touchmove",ge),ae.addEventListener("touchend",re)}function em(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:a,fromType:s,doc:i,lib:o,flowId:u,isValidConnection:f=$g,nodeLookup:v}){const p=s==="target",h=e?i.querySelector(`.${o}-flow__handle[data-id="${u}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:m,y:x}=Rr(t),k=i.elementFromPoint(m,x),T=k!=null&&k.classList.contains(`${o}-flow__handle`)?k:h,N={handleDomNode:T,isValid:!1,connection:null,toHandle:null};if(T){const z=Jg(void 0,T),G=T.getAttribute("data-nodeid"),S=T.getAttribute("data-handleid"),j=T.classList.contains("connectable"),L=T.classList.contains("connectableend");if(!G||!z)return N;const D={source:p?G:r,sourceHandle:p?S:a,target:p?r:G,targetHandle:p?a:S};N.connection=D;const ae=j&&L&&(n===ai.Strict?p&&z==="source"||!p&&z==="target":G!==r||S!==a);N.isValid=ae&&f(D),N.toHandle=Qg(G,z,S,v,n,!0)}return N}const Vv={onPointerDown:sC,isValid:em},ac=t=>({x:t.x,y:t.y,zoom:t.k}),Jc=({x:t,y:e,zoom:n})=>ec.translate(t,e).scale(n),Bs=(t,e)=>t.target.closest(`.${e}`),tm=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),iC=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,$c=(t,e=0,n=iC,r=()=>{})=>{const a=typeof e=="number"&&e>0;return a||r(),a?t.transition().duration(e).ease(n).on("end",r):t},nm=t=>{const e=t.ctrlKey&&Ml()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function oC({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:a,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:o,onPanZoom:u,onPanZoomEnd:f}){return v=>{if(Bs(v,e))return v.ctrlKey&&v.preventDefault(),!1;v.preventDefault(),v.stopImmediatePropagation();const p=n.property("__zoom").k||1;if(v.ctrlKey&&i){const T=Hr(v),N=nm(v),z=p*Math.pow(2,N);r.scaleTo(n,z,T,v);return}const h=v.deltaMode===1?20:1;let m=a===Ks.Vertical?0:v.deltaX*h,x=a===Ks.Horizontal?0:v.deltaY*h;!Ml()&&v.shiftKey&&a!==Ks.Vertical&&(m=v.deltaY*h,x=0),r.translateBy(n,-(m/p)*s,-(x/p)*s,{internal:!0});const k=ac(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(u==null||u(v,k),t.panScrollTimeout=setTimeout(()=>{f==null||f(v,k),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,o==null||o(v,k))}}function lC({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,a){const s=r.type==="wheel",i=!e&&s&&!r.ctrlKey,o=Bs(r,t);if(r.ctrlKey&&s&&o&&r.preventDefault(),i||o)return null;r.preventDefault(),n.call(this,r,a)}}function cC({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var s,i,o;if((s=r.sourceEvent)!=null&&s.internal)return;const a=ac(r.transform);t.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=a,((o=r.sourceEvent)==null?void 0:o.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,a))}}function uC({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:a}){return s=>{var i,o;t.usedRightMouseButton=!!(n&&tm(e,t.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||r([s.transform.x,s.transform.y,s.transform.k]),a&&!((o=s.sourceEvent)!=null&&o.internal)&&(a==null||a(s.sourceEvent,ac(s.transform)))}}function dC({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:a,onPaneContextMenu:s}){return i=>{var o;if(!((o=i.sourceEvent)!=null&&o.internal)&&(t.isZoomingOrPanning=!1,s&&tm(e,t.mouseButton??0)&&!t.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),t.usedRightMouseButton=!1,r(!1),a)){const u=ac(i.transform);t.prevViewport=u,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{a==null||a(i.sourceEvent,u)},n?150:0)}}}function fC({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:a,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:o,noPanClassName:u,lib:f,connectionInProgress:v}){return p=>{var T;const h=t||e,m=n&&p.ctrlKey,x=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(Bs(p,`${f}-flow__node`)||Bs(p,`${f}-flow__edge`)))return!0;if(!r&&!h&&!a&&!s&&!n||i||v&&!x||Bs(p,o)&&x||Bs(p,u)&&(!x||a&&x&&!t)||!n&&p.ctrlKey&&x)return!1;if(!n&&p.type==="touchstart"&&((T=p.touches)==null?void 0:T.length)>1)return p.preventDefault(),!1;if(!h&&!a&&!m&&x||!r&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(r)&&!r.includes(p.button)&&p.type==="mousedown")return!1;const k=Array.isArray(r)&&r.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||x)&&k}}function vC({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:a,onPanZoom:s,onPanZoomStart:i,onPanZoomEnd:o,onDraggingChange:u}){const f={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},v=t.getBoundingClientRect(),p=fT().scaleExtent([e,n]).translateExtent(r),h=Pr(t).call(p);z({x:a.x,y:a.y,zoom:si(a.zoom,e,n)},[[0,0],[v.width,v.height]],r);const m=h.on("wheel.zoom"),x=h.on("dblclick.zoom");p.wheelDelta(nm);function k(X,A){return h?new Promise(K=>{p==null||p.interpolate((A==null?void 0:A.interpolate)==="linear"?Ki:ol).transform($c(h,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function T({noWheelClassName:X,noPanClassName:A,onPaneContextMenu:K,userSelectionActive:P,panOnScroll:O,panOnDrag:I,panOnScrollMode:Q,panOnScrollSpeed:W,preventScrolling:Z,zoomOnPinch:B,zoomOnScroll:ee,zoomOnDoubleClick:ne,zoomActivationKeyPressed:H,lib:U,onTransformChange:le,connectionInProgress:Y,paneClickDistance:ue,selectionOnDrag:be}){P&&!f.isZoomingOrPanning&&N();const ge=O&&!H&&!P;p.clickDistance(be?1/0:!ga(ue)||ue<0?0:ue);const re=ge?oC({zoomPanValues:f,noWheelClassName:X,d3Selection:h,d3Zoom:p,panOnScrollMode:Q,panOnScrollSpeed:W,zoomOnPinch:B,onPanZoomStart:i,onPanZoom:s,onPanZoomEnd:o}):lC({noWheelClassName:X,preventScrolling:Z,d3ZoomHandler:m});if(h.on("wheel.zoom",re,{passive:!1}),!P){const _e=cC({zoomPanValues:f,onDraggingChange:u,onPanZoomStart:i});p.on("start",_e);const Pe=uC({zoomPanValues:f,panOnDrag:I,onPaneContextMenu:!!K,onPanZoom:s,onTransformChange:le});p.on("zoom",Pe);const He=dC({zoomPanValues:f,panOnDrag:I,panOnScroll:O,onPaneContextMenu:K,onPanZoomEnd:o,onDraggingChange:u});p.on("end",He)}const Te=fC({zoomActivationKeyPressed:H,panOnDrag:I,zoomOnScroll:ee,panOnScroll:O,zoomOnDoubleClick:ne,zoomOnPinch:B,userSelectionActive:P,noPanClassName:A,noWheelClassName:X,lib:U,connectionInProgress:Y});p.filter(Te),ne?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function N(){p.on("zoom",null)}async function z(X,A,K){const P=Jc(X),O=p==null?void 0:p.constrain()(P,A,K);return O&&await k(O),new Promise(I=>I(O))}async function G(X,A){const K=Jc(X);return await k(K,A),new Promise(P=>P(K))}function S(X){if(h){const A=Jc(X),K=h.property("__zoom");(K.k!==X.zoom||K.x!==X.x||K.y!==X.y)&&(p==null||p.transform(h,A,null,{sync:!0}))}}function j(){const X=h?Dg(h.node()):{x:0,y:0,k:1};return{x:X.x,y:X.y,zoom:X.k}}function L(X,A){return h?new Promise(K=>{p==null||p.interpolate((A==null?void 0:A.interpolate)==="linear"?Ki:ol).scaleTo($c(h,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function D(X,A){return h?new Promise(K=>{p==null||p.interpolate((A==null?void 0:A.interpolate)==="linear"?Ki:ol).scaleBy($c(h,A==null?void 0:A.duration,A==null?void 0:A.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function J(X){p==null||p.scaleExtent(X)}function ae(X){p==null||p.translateExtent(X)}function ke(X){const A=!ga(X)||X<0?0:X;p==null||p.clickDistance(A)}return{update:T,destroy:N,setViewport:G,setViewportConstrained:z,getViewport:j,scaleTo:L,scaleBy:D,setScaleExtent:J,setTranslateExtent:ae,syncViewport:S,setClickDistance:ke}}var Uv;(function(t){t.Line="line",t.Handle="handle"})(Uv||(Uv={}));function Gd(){const t={};return[e=>{if(e&&!hy(t))throw new Error(e);return Ju(t)},e=>ph(t,e)]}const[hC,pC]=Gd(),[gC,mC]=Gd(),[yC,bC]=Gd();var _C=q("<div><!></div>");function Fa(t,e){tt(e,!0);let n=Ae(e,"id",3,null),r=Ae(e,"type",3,"source"),a=Ae(e,"position",19,()=>_t.Top),s=Ae(e,"isConnectableStart",3,!0),i=Ae(e,"isConnectableEnd",3,!0),o=As(e,["$$slots","$$events","$$legacy","id","type","position","style","class","isConnectable","isConnectableStart","isConnectableEnd","isValidConnection","onconnect","ondisconnect","children"]);const u=hC("Handle must be used within a Custom Node component"),f=gC("Handle must be used within a Custom Node component");let v=$(()=>r()==="target"),p=$(()=>e.isConnectable!==void 0?e.isConnectable:f.value),h=Is(),m=$(()=>h.ariaLabelConfig),x=null;Bh(()=>{if(e.onconnect||e.ondisconnect){h.edges;let A=h.connectionLookup.get(`${u}-${r()}${n()?`-${n()}`:""}`);if(x&&!hT(A,x)){const K=A??new Map;Ov(x,K,e.ondisconnect),Ov(K,x,e.onconnect)}x=new Map(A)}});let k=$(()=>{if(!h.connection.inProgress)return[!1,!1,!1,!1,null];const{fromHandle:A,toHandle:K,isValid:P}=h.connection,O=A&&A.nodeId===u&&A.type===r()&&A.id===n(),I=K&&K.nodeId===u&&K.type===r()&&K.id===n(),Q=h.connectionMode===ai.Strict?(A==null?void 0:A.type)!==r():u!==(A==null?void 0:A.nodeId)||n()!==(A==null?void 0:A.id);return[!0,O,I,Q,I&&P]}),T=$(()=>io(l(k),5)),N=$(()=>l(T)[0]),z=$(()=>l(T)[1]),G=$(()=>l(T)[2]),S=$(()=>l(T)[3]),j=$(()=>l(T)[4]);function L(A){var P;const K=h.onbeforeconnect?h.onbeforeconnect(A):A;K&&(h.addEdge(K),(P=h.onconnect)==null||P.call(h,A))}function D(A){const K=Vg(A);A.currentTarget&&(K&&A.button===0||!K)&&Vv.onPointerDown(A,{handleId:n(),nodeId:u,isTarget:l(v),connectionRadius:h.connectionRadius,domNode:h.domNode,nodeLookup:h.nodeLookup,connectionMode:h.connectionMode,lib:"svelte",autoPanOnConnect:h.autoPanOnConnect,autoPanSpeed:h.autoPanSpeed,flowId:h.flowId,isValidConnection:e.isValidConnection||((...P)=>{var O;return((O=h.isValidConnection)==null?void 0:O.call(h,...P))??!0}),updateConnection:h.updateConnection,cancelConnection:h.cancelConnection,panBy:h.panBy,onConnect:L,onConnectStart:h.onconnectstart,onConnectEnd:(...P)=>{var O;return(O=h.onconnectend)==null?void 0:O.call(h,...P)},getTransform:()=>[h.viewport.x,h.viewport.y,h.viewport.zoom],getFromHandle:()=>h.connection.fromHandle,dragThreshold:h.connectionDragThreshold,handleDomNode:A.currentTarget})}function J(A){var ne,H;if(!u||!h.clickConnectStartHandle&&!s())return;if(!h.clickConnectStartHandle){(ne=h.onclickconnectstart)==null||ne.call(h,A,{nodeId:u,handleId:n(),handleType:r()}),h.clickConnectStartHandle={nodeId:u,type:r(),id:n()};return}const K=Kg(A.target),P=e.isValidConnection??h.isValidConnection,{connectionMode:O,clickConnectStartHandle:I,flowId:Q,nodeLookup:W}=h,{connection:Z,isValid:B}=Vv.isValid(A,{handle:{nodeId:u,id:n(),type:r()},connectionMode:O,fromNodeId:I.nodeId,fromHandleId:I.id??null,fromType:I.type,isValidConnection:P,flowId:Q,doc:K,lib:"svelte",nodeLookup:W});B&&Z&&L(Z);const ee=structuredClone(hh(h.connection));delete ee.inProgress,ee.toPosition=ee.toHandle?ee.toHandle.position:null,(H=h.onclickconnectend)==null||H.call(h,A,ee),h.clickConnectStartHandle=null}var ae=_C(),ke=()=>{};Ha(ae,()=>({"data-handleid":n(),"data-nodeid":u,"data-handlepos":a(),"data-id":`${h.flowId??""}-${u??""}-${n()??"null"??""}-${r()??""}`,class:["svelte-flow__handle",`svelte-flow__handle-${a()}`,h.noDragClass,h.noPanClass,a(),e.class],onmousedown:D,ontouchstart:D,onclick:h.clickConnect?J:void 0,onkeypress:ke,style:e.style,role:"button","aria-label":l(m)["handle.ariaLabel"],tabindex:"-1",...o,[Ia]:{valid:l(j),connectingto:l(G),connectingfrom:l(z),source:!l(v),target:l(v),connectablestart:s(),connectableend:i(),connectable:l(p),connectionindicator:l(p)&&(!l(N)||l(S))&&(l(N)||h.clickConnectStartHandle?i():s())}}));var X=b(ae);br(X,()=>e.children??xs),C(t,ae),nt()}var wC=q("<!> <!>",1);function rm(t,e){tt(e,!0);let n=Ae(e,"targetPosition",19,()=>_t.Top),r=Ae(e,"sourcePosition",19,()=>_t.Bottom);var a=wC(),s=Ye(a);Fa(s,{type:"target",get position(){return n()}});var i=w(s),o=w(i);Fa(o,{type:"source",get position(){return r()}}),se(()=>{var u;return te(i,` ${((u=e.data)==null?void 0:u.label)??""} `)}),C(t,a),nt()}var xC=q(" <!>",1);function kC(t,e){tt(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"sourcePosition",19,()=>_t.Bottom);var a=xC(),s=Ye(a),i=w(s);Fa(i,{type:"source",get position(){return r()}}),se(()=>{var o;return te(s,`${((o=n())==null?void 0:o.label)??""} `)}),C(t,a),nt()}var SC=q(" <!>",1);function EC(t,e){tt(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"targetPosition",19,()=>_t.Top);var a=SC(),s=Ye(a),i=w(s);Fa(i,{type:"target",get position(){return r()}}),se(()=>{var o;return te(s,`${((o=n())==null?void 0:o.label)??""} `)}),C(t,a),nt()}function AC(t,e){}function eu(t,e,n){if(!n||!e)return;const r=n==="root"?e:e.querySelector(`.svelte-flow__${n}`);r&&r.appendChild(t)}function tu(t,e){const n=$(Is),r=$(()=>l(n).domNode);let a;return l(r)?eu(t,l(r),e):a=qh(()=>{Nn(()=>{eu(t,l(r),e),a==null||a()})}),{async update(s){eu(t,l(r),s)},destroy(){t.parentNode&&t.parentNode.removeChild(t),a==null||a()}}}function TC(){let t=Oe(typeof window>"u");if(l(t)){const e=qh(()=>{Nn(()=>{M(t,!1),e==null||e()})})}return{get value(){return l(t)}}}const Gv=t=>gT(t),CC=t=>jg(t);function ta(t){return t===void 0?void 0:`${t}px`}const Ol={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var IC=q("<div><!></div>");function PC(t,e){tt(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"selectEdgeOnClick",3,!1),s=Ae(e,"transparent",3,!1),i=As(e,["$$slots","$$events","$$legacy","x","y","width","height","selectEdgeOnClick","transparent","class","children"]);const o=Is(),u=yC("EdgeLabel must be used within a Custom Edge component");let f=$(()=>{var m;return(m=o.visible.edges.get(u))==null?void 0:m.zIndex});var v=IC(),p=()=>{a()&&u&&o.handleEdgeSelection(u)};Ha(v,m=>({class:["svelte-flow__edge-label",{transparent:s()},e.class],tabindex:"-1",onclick:p,...i,[da]:m}),[()=>({display:TC().value?"none":void 0,cursor:a()?"pointer":void 0,transform:`translate(-50%, -50%) translate(${n()??""}px,${r()??""}px)`,"pointer-events":"all",width:ta(e.width),height:ta(e.height),"z-index":l(f)})],void 0,void 0,"svelte-1wg91mu");var h=b(v);br(h,()=>e.children??xs),Xn(v,(m,x)=>tu==null?void 0:tu(m,x),()=>"edge-labels"),C(t,v),nt()}var MC=bn("<path></path>"),OC=bn('<path fill="none"></path><!><!>',1);function sc(t,e){let n=Ae(e,"interactionWidth",3,20),r=As(e,["$$slots","$$events","$$legacy","id","path","label","labelX","labelY","labelStyle","markerStart","markerEnd","style","interactionWidth","class"]);var a=OC(),s=Ye(a),i=w(s);{var o=v=>{var p=MC();Ha(p,()=>({d:e.path,"stroke-opacity":0,"stroke-width":n(),fill:"none",class:"svelte-flow__edge-interaction",...r})),C(v,p)};pe(i,v=>{n()>0&&v(o)})}var u=w(i);{var f=v=>{PC(v,{get x(){return e.labelX},get y(){return e.labelY},get style(){return e.labelStyle},selectEdgeOnClick:!0,children:(p,h)=>{var m=yn();se(()=>te(m,e.label)),C(p,m)},$$slots:{default:!0}})};pe(u,v=>{e.label&&v(f)})}se(()=>{wt(s,"id",e.id),wt(s,"d",e.path),Pt(s,0,Ss(["svelte-flow__edge-path",e.class])),wt(s,"marker-start",e.markerStart),wt(s,"marker-end",e.markerEnd),jt(s,e.style)}),C(t,a)}function am(t,e){tt(e,!0);let n=$(()=>{var o;return Ug({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,curvature:(o=e.pathOptions)==null?void 0:o.curvature})}),r=$(()=>io(l(n),3)),a=$(()=>l(r)[0]),s=$(()=>l(r)[1]),i=$(()=>l(r)[2]);sc(t,{get id(){return e.id},get path(){return l(a)},get labelX(){return l(s)},get labelY(){return l(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),nt()}function NC(t,e){tt(e,!0);let n=$(()=>Fd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition})),r=$(()=>io(l(n),3)),a=$(()=>l(r)[0]),s=$(()=>l(r)[1]),i=$(()=>l(r)[2]);sc(t,{get path(){return l(a)},get labelX(){return l(s)},get labelY(){return l(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),nt()}function RC(t,e){tt(e,!0);let n=$(()=>Wg({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY})),r=$(()=>io(l(n),3)),a=$(()=>l(r)[0]),s=$(()=>l(r)[1]),i=$(()=>l(r)[2]);sc(t,{get path(){return l(a)},get labelX(){return l(s)},get labelY(){return l(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),nt()}function DC(t,e){tt(e,!0);let n=$(()=>Fd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,borderRadius:0})),r=$(()=>io(l(n),3)),a=$(()=>l(r)[0]),s=$(()=>l(r)[1]),i=$(()=>l(r)[2]);sc(t,{get path(){return l(a)},get labelX(){return l(s)},get labelY(){return l(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),nt()}var ao,so;class LC{constructor(e,n){Me(this,ao);Me(this,so);St(this,ao,e),St(this,so,Eh(n))}get current(){return F(this,so).call(this),F(this,ao).call(this)}}ao=new WeakMap,so=new WeakMap;const jC=/\(.+\)/,zC=new Set(["all","print","screen","and","or","not","only"]);class BC extends LC{constructor(e,n){let r=jC.test(e)||e.split(/[\s,]+/).some(s=>zC.has(s.trim()))?e:`(${e})`;const a=window.matchMedia(r);super(()=>a.matches,s=>mu(a,"change",s))}}function qC(t,e,n,r){const a=new Map;return Bd(t,{x:0,y:0,width:n,height:r},e,!0).forEach(s=>{a.set(s.id,s)}),a}function Wv(t){const{edges:e,defaultEdgeOptions:n,nodeLookup:r,previousEdges:a,connectionMode:s,onerror:i,onlyRenderVisible:o,elevateEdgesOnSelect:u,zIndexMode:f}=t,v=new Map;for(const p of e){const h=r.get(p.source),m=r.get(p.target);if(!h||!m)continue;if(o){const{visibleNodes:T,transform:N,width:z,height:G}=t;if(OT({sourceNode:h,targetNode:m,width:z,height:G,transform:N}))T.set(h.id,h),T.set(m.id,m);else continue}const x=a.get(p.id);if(x&&p===x.edge&&h==x.sourceNode&&m==x.targetNode){v.set(p.id,x);continue}const k=BT({id:p.id,sourceNode:h,targetNode:m,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:s,onError:i});k&&v.set(p.id,{...n,...p,...k,zIndex:MT({selected:p.selected,zIndex:p.zIndex??n.zIndex,sourceNode:h,targetNode:m,elevateOnSelect:u,zIndexMode:f}),sourceNode:h,targetNode:m,edge:p})}return v}const sm={input:kC,output:EC,default:rm,group:AC},im={straight:RC,smoothstep:NC,default:am,step:DC};function FC(t,e,n,r,a,s){if(e&&!n&&r&&a){const i=tc(s,{filter:o=>!!((o.width||o.initialWidth)&&(o.height||o.initialHeight))});return qd(i,r,a,.5,2,.1)}else return n??{x:0,y:0,zoom:1}}function KC(t){var n,r,a,s,i,o,u,f,v,p,h,m,x,k,T,N,z,G,S,j,L,D,J,ae,ke,X,A,K,P,O,I,Q,W,Z,B,ee,ne,H,U,le,Y,ue,be,ge,re,Te,_e,Pe,He,Ze,vt,ht,je,De,Fe,Ne,Je,ut,$e,it,rt,We,mt,dt,Rt,Ft,xt,yt,bt,lt,ze,Ot,Dt,zt,Re,Yt;class e{constructor(){Me(this,n,$(()=>t.props.id??"1"));Me(this,r,Oe(null));Me(this,a,Oe(null));Me(this,s,Oe(t.width??0));Me(this,i,Oe(t.height??0));Me(this,o,Oe(t.props.zIndexMode??"basic"));Me(this,u,$(()=>{var un;const ye=UT(t.nodes,this.nodeLookup,this.parentLookup,{nodeExtent:this.nodeExtent,nodeOrigin:this.nodeOrigin,elevateNodesOnSelect:t.props.elevateNodesOnSelect??!0,checkEquality:!0,zIndexMode:this.zIndexMode});return this.fitViewQueued&&ye&&((un=this.fitViewOptions)!=null&&un.duration?this.resolveFitView():queueMicrotask(()=>{this.resolveFitView()})),ye}));Me(this,f,$(()=>this.panZoom!==null));Me(this,v,$(()=>(QT(this.connectionLookup,this.edgeLookup,t.edges),t.edges)));pt(this,"_prevSelectedNodes",[]);pt(this,"_prevSelectedNodeIds",new Set);Me(this,p,$(()=>{const ye=this._prevSelectedNodeIds.size,un=new Set,Cn=this.nodes.filter(At=>(At.selected&&(un.add(At.id),this._prevSelectedNodeIds.delete(At.id)),At.selected));return(ye!==un.size||this._prevSelectedNodeIds.size>0)&&(this._prevSelectedNodes=Cn),this._prevSelectedNodeIds=un,this._prevSelectedNodes}));pt(this,"_prevSelectedEdges",[]);pt(this,"_prevSelectedEdgeIds",new Set);Me(this,h,$(()=>{const ye=this._prevSelectedEdgeIds.size,un=new Set,Cn=this.edges.filter(At=>(At.selected&&(un.add(At.id),this._prevSelectedEdgeIds.delete(At.id)),At.selected));return(ye!==un.size||this._prevSelectedEdgeIds.size>0)&&(this._prevSelectedEdges=Cn),this._prevSelectedEdgeIds=un,this._prevSelectedEdges}));pt(this,"selectionChangeHandlers",new Map);pt(this,"nodeLookup",new Map);pt(this,"parentLookup",new Map);pt(this,"connectionLookup",new Map);pt(this,"edgeLookup",new Map);pt(this,"_prevVisibleEdges",new Map);Me(this,m,$(()=>{const{nodes:ye,_edges:un,_prevVisibleEdges:Cn,nodeLookup:At,connectionMode:Rn,onerror:Xt,onlyRenderVisibleElements:ft,defaultEdgeOptions:ot,zIndexMode:Ht}=this;let ct,kt;const nn={edges:un,defaultEdgeOptions:ot,previousEdges:Cn,nodeLookup:At,connectionMode:Rn,elevateEdgesOnSelect:t.props.elevateEdgesOnSelect??!0,zIndexMode:Ht,onerror:Xt};if(ft){const{viewport:an,width:Dn,height:Zt}=this,en=[an.x,an.y,an.zoom];ct=qC(At,en,Dn,Zt),kt=Wv({...nn,onlyRenderVisible:!0,visibleNodes:ct,transform:en,width:Dn,height:Zt})}else ct=this.nodeLookup,kt=Wv(nn);return{nodes:ct,edges:kt}}));Me(this,x,$(()=>t.props.nodesDraggable??!0));Me(this,k,$(()=>t.props.nodesConnectable??!0));Me(this,T,$(()=>t.props.elementsSelectable??!0));Me(this,N,$(()=>t.props.nodesFocusable??!0));Me(this,z,$(()=>t.props.edgesFocusable??!0));Me(this,G,$(()=>t.props.disableKeyboardA11y??!1));Me(this,S,$(()=>t.props.minZoom??.5));Me(this,j,$(()=>t.props.maxZoom??2));Me(this,L,$(()=>t.props.nodeOrigin??[0,0]));Me(this,D,$(()=>t.props.nodeExtent??Hu));Me(this,J,$(()=>t.props.translateExtent??Hu));Me(this,ae,$(()=>t.props.defaultEdgeOptions??{}));Me(this,ke,$(()=>t.props.nodeDragThreshold??1));Me(this,X,$(()=>t.props.autoPanOnNodeDrag??!0));Me(this,A,$(()=>t.props.autoPanOnConnect??!0));Me(this,K,$(()=>t.props.autoPanOnNodeFocus??!0));Me(this,P,$(()=>t.props.autoPanSpeed??15));Me(this,O,$(()=>t.props.connectionDragThreshold??1));pt(this,"fitViewQueued",t.props.fitView??!1);pt(this,"fitViewOptions",t.props.fitViewOptions);pt(this,"fitViewResolver",null);Me(this,I,$(()=>t.props.snapGrid??null));Me(this,Q,Oe(!1));Me(this,W,Oe(null));Me(this,Z,Oe(!1));Me(this,B,Oe(!1));Me(this,ee,Oe(!1));Me(this,ne,Oe(!1));Me(this,H,Oe(!1));Me(this,U,Oe(null));Me(this,le,Oe(""));Me(this,Y,$(()=>t.props.selectionMode??Tl.Partial));Me(this,ue,$(()=>({...sm,...t.props.nodeTypes})));Me(this,be,$(()=>({...im,...t.props.edgeTypes})));Me(this,ge,$(()=>t.props.noPanClass??"nopan"));Me(this,re,$(()=>t.props.noDragClass??"nodrag"));Me(this,Te,$(()=>t.props.noWheelClass??"nowheel"));Me(this,_e,$(()=>CT(t.props.ariaLabelConfig)));Me(this,Pe,Oe(FC(this.nodesInitialized,t.props.fitView,t.props.initialViewport,this.width,this.height,this.nodeLookup)));Me(this,He,Oe(Vu));Me(this,Ze,$(()=>this._connection.inProgress?{...this._connection,to:xo(this._connection.to,[this.viewport.x,this.viewport.y,this.viewport.zoom])}:this._connection));Me(this,vt,$(()=>t.props.connectionMode??ai.Strict));Me(this,ht,$(()=>t.props.connectionRadius??20));Me(this,je,$(()=>t.props.isValidConnection??(()=>!0)));Me(this,De,$(()=>t.props.selectNodesOnDrag??!0));Me(this,Fe,$(()=>t.props.defaultMarkerColor===void 0?"#b1b1b7":t.props.defaultMarkerColor));Me(this,Ne,$(()=>qT(t.edges,{defaultColor:this.defaultMarkerColor,id:this.flowId,defaultMarkerStart:this.defaultEdgeOptions.markerStart,defaultMarkerEnd:this.defaultEdgeOptions.markerEnd})));Me(this,Je,$(()=>t.props.onlyRenderVisibleElements??!1));Me(this,ut,$(()=>t.props.onflowerror??kT));Me(this,$e,$(()=>t.props.ondelete));Me(this,it,$(()=>t.props.onbeforedelete));Me(this,rt,$(()=>t.props.onbeforeconnect));Me(this,We,$(()=>t.props.onconnect));Me(this,mt,$(()=>t.props.onconnectstart));Me(this,dt,$(()=>t.props.onconnectend));Me(this,Rt,$(()=>t.props.onbeforereconnect));Me(this,Ft,$(()=>t.props.onreconnect));Me(this,xt,$(()=>t.props.onreconnectstart));Me(this,yt,$(()=>t.props.onreconnectend));Me(this,bt,$(()=>t.props.clickConnect??!0));Me(this,lt,$(()=>t.props.onclickconnectstart));Me(this,ze,$(()=>t.props.onclickconnectend));Me(this,Ot,Oe(null));Me(this,Dt,$(()=>t.props.onselectiondrag));Me(this,zt,$(()=>t.props.onselectiondragstart));Me(this,Re,$(()=>t.props.onselectiondragstop));pt(this,"resolveFitView",async()=>{var ye;this.panZoom&&(await _T({nodes:this.nodeLookup,width:this.width,height:this.height,panZoom:this.panZoom,minZoom:this.minZoom,maxZoom:this.maxZoom},this.fitViewOptions),(ye=this.fitViewResolver)==null||ye.resolve(!0),this.fitViewQueued=!1,this.fitViewOptions=void 0,this.fitViewResolver=null)});pt(this,"_prefersDark",new BC("(prefers-color-scheme: dark)",t.props.colorModeSSR==="dark"));Me(this,Yt,$(()=>t.props.colorMode==="system"?this._prefersDark.current?"dark":"light":t.props.colorMode??"light"))}get flowId(){return l(F(this,n))}set flowId(ye){M(F(this,n),ye)}get domNode(){return l(F(this,r))}set domNode(ye){M(F(this,r),ye)}get panZoom(){return l(F(this,a))}set panZoom(ye){M(F(this,a),ye)}get width(){return l(F(this,s))}set width(ye){M(F(this,s),ye)}get height(){return l(F(this,i))}set height(ye){M(F(this,i),ye)}get zIndexMode(){return l(F(this,o))}set zIndexMode(ye){M(F(this,o),ye)}get nodesInitialized(){return l(F(this,u))}set nodesInitialized(ye){M(F(this,u),ye)}get viewportInitialized(){return l(F(this,f))}set viewportInitialized(ye){M(F(this,f),ye)}get _edges(){return l(F(this,v))}set _edges(ye){M(F(this,v),ye)}get nodes(){return this.nodesInitialized,t.nodes}set nodes(ye){t.nodes=ye}get edges(){return this._edges}set edges(ye){t.edges=ye}get selectedNodes(){return l(F(this,p))}set selectedNodes(ye){M(F(this,p),ye)}get selectedEdges(){return l(F(this,h))}set selectedEdges(ye){M(F(this,h),ye)}get visible(){return l(F(this,m))}set visible(ye){M(F(this,m),ye)}get nodesDraggable(){return l(F(this,x))}set nodesDraggable(ye){M(F(this,x),ye)}get nodesConnectable(){return l(F(this,k))}set nodesConnectable(ye){M(F(this,k),ye)}get elementsSelectable(){return l(F(this,T))}set elementsSelectable(ye){M(F(this,T),ye)}get nodesFocusable(){return l(F(this,N))}set nodesFocusable(ye){M(F(this,N),ye)}get edgesFocusable(){return l(F(this,z))}set edgesFocusable(ye){M(F(this,z),ye)}get disableKeyboardA11y(){return l(F(this,G))}set disableKeyboardA11y(ye){M(F(this,G),ye)}get minZoom(){return l(F(this,S))}set minZoom(ye){M(F(this,S),ye)}get maxZoom(){return l(F(this,j))}set maxZoom(ye){M(F(this,j),ye)}get nodeOrigin(){return l(F(this,L))}set nodeOrigin(ye){M(F(this,L),ye)}get nodeExtent(){return l(F(this,D))}set nodeExtent(ye){M(F(this,D),ye)}get translateExtent(){return l(F(this,J))}set translateExtent(ye){M(F(this,J),ye)}get defaultEdgeOptions(){return l(F(this,ae))}set defaultEdgeOptions(ye){M(F(this,ae),ye)}get nodeDragThreshold(){return l(F(this,ke))}set nodeDragThreshold(ye){M(F(this,ke),ye)}get autoPanOnNodeDrag(){return l(F(this,X))}set autoPanOnNodeDrag(ye){M(F(this,X),ye)}get autoPanOnConnect(){return l(F(this,A))}set autoPanOnConnect(ye){M(F(this,A),ye)}get autoPanOnNodeFocus(){return l(F(this,K))}set autoPanOnNodeFocus(ye){M(F(this,K),ye)}get autoPanSpeed(){return l(F(this,P))}set autoPanSpeed(ye){M(F(this,P),ye)}get connectionDragThreshold(){return l(F(this,O))}set connectionDragThreshold(ye){M(F(this,O),ye)}get snapGrid(){return l(F(this,I))}set snapGrid(ye){M(F(this,I),ye)}get dragging(){return l(F(this,Q))}set dragging(ye){M(F(this,Q),ye)}get selectionRect(){return l(F(this,W))}set selectionRect(ye){M(F(this,W),ye)}get selectionKeyPressed(){return l(F(this,Z))}set selectionKeyPressed(ye){M(F(this,Z),ye)}get multiselectionKeyPressed(){return l(F(this,B))}set multiselectionKeyPressed(ye){M(F(this,B),ye)}get deleteKeyPressed(){return l(F(this,ee))}set deleteKeyPressed(ye){M(F(this,ee),ye)}get panActivationKeyPressed(){return l(F(this,ne))}set panActivationKeyPressed(ye){M(F(this,ne),ye)}get zoomActivationKeyPressed(){return l(F(this,H))}set zoomActivationKeyPressed(ye){M(F(this,H),ye)}get selectionRectMode(){return l(F(this,U))}set selectionRectMode(ye){M(F(this,U),ye)}get ariaLiveMessage(){return l(F(this,le))}set ariaLiveMessage(ye){M(F(this,le),ye)}get selectionMode(){return l(F(this,Y))}set selectionMode(ye){M(F(this,Y),ye)}get nodeTypes(){return l(F(this,ue))}set nodeTypes(ye){M(F(this,ue),ye)}get edgeTypes(){return l(F(this,be))}set edgeTypes(ye){M(F(this,be),ye)}get noPanClass(){return l(F(this,ge))}set noPanClass(ye){M(F(this,ge),ye)}get noDragClass(){return l(F(this,re))}set noDragClass(ye){M(F(this,re),ye)}get noWheelClass(){return l(F(this,Te))}set noWheelClass(ye){M(F(this,Te),ye)}get ariaLabelConfig(){return l(F(this,_e))}set ariaLabelConfig(ye){M(F(this,_e),ye)}get _viewport(){return l(F(this,Pe))}set _viewport(ye){M(F(this,Pe),ye)}get viewport(){return t.viewport??this._viewport}set viewport(ye){t.viewport&&(t.viewport=ye),this._viewport=ye}get _connection(){return l(F(this,He))}set _connection(ye){M(F(this,He),ye)}get connection(){return l(F(this,Ze))}set connection(ye){M(F(this,Ze),ye)}get connectionMode(){return l(F(this,vt))}set connectionMode(ye){M(F(this,vt),ye)}get connectionRadius(){return l(F(this,ht))}set connectionRadius(ye){M(F(this,ht),ye)}get isValidConnection(){return l(F(this,je))}set isValidConnection(ye){M(F(this,je),ye)}get selectNodesOnDrag(){return l(F(this,De))}set selectNodesOnDrag(ye){M(F(this,De),ye)}get defaultMarkerColor(){return l(F(this,Fe))}set defaultMarkerColor(ye){M(F(this,Fe),ye)}get markers(){return l(F(this,Ne))}set markers(ye){M(F(this,Ne),ye)}get onlyRenderVisibleElements(){return l(F(this,Je))}set onlyRenderVisibleElements(ye){M(F(this,Je),ye)}get onerror(){return l(F(this,ut))}set onerror(ye){M(F(this,ut),ye)}get ondelete(){return l(F(this,$e))}set ondelete(ye){M(F(this,$e),ye)}get onbeforedelete(){return l(F(this,it))}set onbeforedelete(ye){M(F(this,it),ye)}get onbeforeconnect(){return l(F(this,rt))}set onbeforeconnect(ye){M(F(this,rt),ye)}get onconnect(){return l(F(this,We))}set onconnect(ye){M(F(this,We),ye)}get onconnectstart(){return l(F(this,mt))}set onconnectstart(ye){M(F(this,mt),ye)}get onconnectend(){return l(F(this,dt))}set onconnectend(ye){M(F(this,dt),ye)}get onbeforereconnect(){return l(F(this,Rt))}set onbeforereconnect(ye){M(F(this,Rt),ye)}get onreconnect(){return l(F(this,Ft))}set onreconnect(ye){M(F(this,Ft),ye)}get onreconnectstart(){return l(F(this,xt))}set onreconnectstart(ye){M(F(this,xt),ye)}get onreconnectend(){return l(F(this,yt))}set onreconnectend(ye){M(F(this,yt),ye)}get clickConnect(){return l(F(this,bt))}set clickConnect(ye){M(F(this,bt),ye)}get onclickconnectstart(){return l(F(this,lt))}set onclickconnectstart(ye){M(F(this,lt),ye)}get onclickconnectend(){return l(F(this,ze))}set onclickconnectend(ye){M(F(this,ze),ye)}get clickConnectStartHandle(){return l(F(this,Ot))}set clickConnectStartHandle(ye){M(F(this,Ot),ye)}get onselectiondrag(){return l(F(this,Dt))}set onselectiondrag(ye){M(F(this,Dt),ye)}get onselectiondragstart(){return l(F(this,zt))}set onselectiondragstart(ye){M(F(this,zt),ye)}get onselectiondragstop(){return l(F(this,Re))}set onselectiondragstop(ye){M(F(this,Re),ye)}get colorMode(){return l(F(this,Yt))}set colorMode(ye){M(F(this,Yt),ye)}resetStoreValues(){this.dragging=!1,this.selectionRect=null,this.selectionRectMode=null,this.selectionKeyPressed=!1,this.multiselectionKeyPressed=!1,this.deleteKeyPressed=!1,this.panActivationKeyPressed=!1,this.zoomActivationKeyPressed=!1,this._connection=Vu,this.clickConnectStartHandle=null,this.viewport=t.props.initialViewport??{x:0,y:0,zoom:1},this.ariaLiveMessage=""}}return n=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,u=new WeakMap,f=new WeakMap,v=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,x=new WeakMap,k=new WeakMap,T=new WeakMap,N=new WeakMap,z=new WeakMap,G=new WeakMap,S=new WeakMap,j=new WeakMap,L=new WeakMap,D=new WeakMap,J=new WeakMap,ae=new WeakMap,ke=new WeakMap,X=new WeakMap,A=new WeakMap,K=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,Q=new WeakMap,W=new WeakMap,Z=new WeakMap,B=new WeakMap,ee=new WeakMap,ne=new WeakMap,H=new WeakMap,U=new WeakMap,le=new WeakMap,Y=new WeakMap,ue=new WeakMap,be=new WeakMap,ge=new WeakMap,re=new WeakMap,Te=new WeakMap,_e=new WeakMap,Pe=new WeakMap,He=new WeakMap,Ze=new WeakMap,vt=new WeakMap,ht=new WeakMap,je=new WeakMap,De=new WeakMap,Fe=new WeakMap,Ne=new WeakMap,Je=new WeakMap,ut=new WeakMap,$e=new WeakMap,it=new WeakMap,rt=new WeakMap,We=new WeakMap,mt=new WeakMap,dt=new WeakMap,Rt=new WeakMap,Ft=new WeakMap,xt=new WeakMap,yt=new WeakMap,bt=new WeakMap,lt=new WeakMap,ze=new WeakMap,Ot=new WeakMap,Dt=new WeakMap,zt=new WeakMap,Re=new WeakMap,Yt=new WeakMap,new e}function Is(){const t=Ju(Wu);if(!t)throw new Error("To call useStore outside of <SvelteFlow /> you need to wrap your component in a <SvelteFlowProvider />");return t.getStore()}const Wu=Symbol();function HC(t){const e=KC(t);function n(X){e.nodeTypes={...sm,...X}}function r(X){e.edgeTypes={...im,...X}}function a(X){e.edges=DT(X,e.edges)}const s=(X,A=!1)=>{e.nodes=e.nodes.map(K=>{if(e.connection.inProgress&&e.connection.fromNode.id===K.id){const O=e.nodeLookup.get(K.id);O&&(e.connection={...e.connection,from:ws(O,e.connection.fromHandle,_t.Left,!0)})}const P=X.get(K.id);return P?{...K,position:P.position,dragging:A}:K})};function i(X){var O,I,Q;const{changes:A,updatedInternals:K}=XT(X,e.nodeLookup,e.parentLookup,e.domNode,e.nodeOrigin,e.nodeExtent,e.zIndexMode);if(!K)return;HT(e.nodeLookup,e.parentLookup,{nodeOrigin:e.nodeOrigin,nodeExtent:e.nodeExtent,zIndexMode:e.zIndexMode}),e.fitViewQueued&&e.resolveFitView();const P=new Map;for(const W of A){const Z=(O=e.nodeLookup.get(W.id))==null?void 0:O.internals.userNode;if(!Z)continue;const B={...Z};switch(W.type){case"dimensions":{const ee={...B.measured,...W.dimensions};W.setAttributes&&(B.width=((I=W.dimensions)==null?void 0:I.width)??B.width,B.height=((Q=W.dimensions)==null?void 0:Q.height)??B.height),B.measured=ee;break}case"position":B.position=W.position??B.position;break}P.set(W.id,B)}e.nodes=e.nodes.map(W=>P.get(W.id)??W)}function o(X){const A=e.fitViewResolver??Promise.withResolvers();return e.fitViewQueued=!0,e.fitViewOptions=X,e.fitViewResolver=A,e.nodes=[...e.nodes],A.promise}async function u(X,A,K){const P=typeof(K==null?void 0:K.zoom)<"u"?K.zoom:e.maxZoom,O=e.panZoom;return O?(await O.setViewport({x:e.width/2-X*P,y:e.height/2-A*P,zoom:P},{duration:K==null?void 0:K.duration,ease:K==null?void 0:K.ease,interpolate:K==null?void 0:K.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)}function f(X,A){const K=e.panZoom;return K?K.scaleBy(X,A):Promise.resolve(!1)}function v(X){return f(1.2,X)}function p(X){return f(1/1.2,X)}function h(X){const A=e.panZoom;A&&(A.setScaleExtent([X,e.maxZoom]),e.minZoom=X)}function m(X){const A=e.panZoom;A&&(A.setScaleExtent([e.minZoom,X]),e.maxZoom=X)}function x(X){const A=e.panZoom;A&&(A.setTranslateExtent(X),e.translateExtent=X)}function k(X,A=null){let K=!1;const P=X.map(O=>(A?A.has(O.id):!0)&&O.selected?(K=!0,{...O,selected:!1}):O);return[K,P]}function T(X){const A=X!=null&&X.nodes?new Set(X.nodes.map(W=>W.id)):null,[K,P]=k(e.nodes,A);K&&(e.nodes=P);const O=X!=null&&X.edges?new Set(X.edges.map(W=>W.id)):null,[I,Q]=k(e.edges,O);I&&(e.edges=Q)}function N(X){const A=e.multiselectionKeyPressed;e.nodes=e.nodes.map(K=>{const P=X.includes(K.id),O=A&&K.selected||P;return!!K.selected!==O?{...K,selected:O}:K}),A||T({nodes:[]})}function z(X){const A=e.multiselectionKeyPressed;e.edges=e.edges.map(K=>{const P=X.includes(K.id),O=A&&K.selected||P;return!!K.selected!==O?{...K,selected:O}:K}),A||T({edges:[]})}function G(X,A,K){const P=e.nodeLookup.get(X);if(!P){console.warn("012",Qi.error012(X));return}e.selectionRect=null,e.selectionRectMode=null,P.selected?(A||P.selected&&e.multiselectionKeyPressed)&&(T({nodes:[P],edges:[]}),requestAnimationFrame(()=>K==null?void 0:K.blur())):N([X])}function S(X){const A=e.edgeLookup.get(X);if(!A){console.warn("012",Qi.error012(X));return}(A.selectable||e.elementsSelectable&&typeof A.selectable>"u")&&(e.selectionRect=null,e.selectionRectMode=null,A.selected?A.selected&&e.multiselectionKeyPressed&&T({nodes:[],edges:[A]}):z([X]))}function j(X,A){const{nodeExtent:K,snapGrid:P,nodeOrigin:O,nodeLookup:I,nodesDraggable:Q,onerror:W}=e,Z=new Map,B=(P==null?void 0:P[0])??5,ee=(P==null?void 0:P[1])??5,ne=X.x*B*A,H=X.y*ee*A;for(const U of I.values()){if(!(U.selected&&(U.draggable||Q&&typeof U.draggable>"u")))continue;let Y={x:U.internals.positionAbsolute.x+ne,y:U.internals.positionAbsolute.y+H};P&&(Y=wo(Y,P));const{position:ue,positionAbsolute:be}=zg({nodeId:U.id,nextPosition:Y,nodeLookup:I,nodeExtent:K,nodeOrigin:O,onError:W});U.position=ue,U.internals.positionAbsolute=be,Z.set(U.id,U)}s(Z)}function L(X){return ZT({delta:X,panZoom:e.panZoom,transform:[e.viewport.x,e.viewport.y,e.viewport.zoom],translateExtent:e.translateExtent,width:e.width,height:e.height})}const D=X=>{e._connection={...X}};function J(){e._connection=Vu}function ae(){e.resetStoreValues(),T()}return Object.assign(e,{setNodeTypes:n,setEdgeTypes:r,addEdge:a,updateNodePositions:s,updateNodeInternals:i,zoomIn:v,zoomOut:p,fitView:o,setCenter:u,setMinZoom:h,setMaxZoom:m,setTranslateExtent:x,unselectNodesAndEdges:T,addSelectedNodes:N,addSelectedEdges:z,handleNodeSelection:G,handleEdgeSelection:S,moveSelectedNodes:j,panBy:L,updateConnection:D,cancelConnection:J,reset:ae})}function nu(t,e){const{minZoom:n,maxZoom:r,initialViewport:a,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:o,translateExtent:u,setPanZoomInstance:f,onDraggingChange:v,onTransformChange:p}=e,h=vC({domNode:t,minZoom:n,maxZoom:r,translateExtent:u,viewport:a,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:o,onDraggingChange:v}),m=h.getViewport();return(a.x!==m.x||a.y!==m.y||a.zoom!==m.zoom)&&p([m.x,m.y,m.zoom]),f(h),h.update(e),{update(x){h.update(x)}}}var VC=q('<div class="svelte-flow__zoom svelte-flow__container"><!></div>');function UC(t,e){tt(e,!0);let n=Ae(e,"store",15),r=$(()=>n().panActivationKeyPressed||e.panOnDrag),a=$(()=>n().panActivationKeyPressed||e.panOnScroll);const{viewport:s}=n();let i=!1;Nn(()=>{var f;!i&&n().viewportInitialized&&((f=e.oninit)==null||f.call(e),i=!0)});var o=VC(),u=b(o);br(u,()=>e.children),Xn(o,(f,v)=>nu==null?void 0:nu(f,v),()=>({viewport:n().viewport,minZoom:n().minZoom,maxZoom:n().maxZoom,initialViewport:s,onDraggingChange:f=>{n(n().dragging=f,!0)},setPanZoomInstance:f=>{n(n().panZoom=f,!0)},onPanZoomStart:e.onmovestart,onPanZoom:e.onmove,onPanZoomEnd:e.onmoveend,zoomOnScroll:e.zoomOnScroll,zoomOnDoubleClick:e.zoomOnDoubleClick,zoomOnPinch:e.zoomOnPinch,panOnScroll:l(a),panOnDrag:l(r),panOnScrollSpeed:e.panOnScrollSpeed,panOnScrollMode:e.panOnScrollMode,zoomActivationKeyPressed:n().zoomActivationKeyPressed,preventScrolling:typeof e.preventScrolling=="boolean"?e.preventScrolling:!0,noPanClassName:n().noPanClass,noWheelClassName:n().noWheelClass,userSelectionActive:!!n().selectionRect,translateExtent:n().translateExtent,lib:"svelte",paneClickDistance:e.paneClickDistance,selectionOnDrag:e.selectionOnDrag,onTransformChange:f=>{n(n().viewport={x:f[0],y:f[1],zoom:f[2]},!0)},connectionInProgress:n().connection.inProgress})),C(t,o),nt()}function Yv(t,e){return n=>{n.target===e&&(t==null||t(n))}}function Xv(t){return e=>{const n=t.has(e.id);return!!e.selected!==n?{...e,selected:n}:e}}function Zv(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}var GC=q("<div><!></div>");function WC(t,e){tt(e,!0);let n=Ae(e,"store",15),r=Ae(e,"panOnDrag",3,!0),a=Ae(e,"paneClickDistance",3,1),s,i=null,o=new Set,u=new Set,f=$(()=>n().panActivationKeyPressed||r()),v=$(()=>n().selectionKeyPressed||!!n().selectionRect||e.selectionOnDrag&&l(f)!==!0),p=$(()=>n().elementsSelectable&&(l(v)||n().selectionRectMode==="user")),h=!1;function m(J){var P,O;if(i=s==null?void 0:s.getBoundingClientRect(),!i)return;const ae=J.target===s,ke=!ae&&!!J.target.closest(".nokey"),X=e.selectionOnDrag&&ae||n().selectionKeyPressed;if(ke||!l(v)||!X||J.button!==0||!J.isPrimary)return;(O=(P=J.target)==null?void 0:P.setPointerCapture)==null||O.call(P,J.pointerId),h=!1;const{x:A,y:K}=Rr(J,i);n(n().selectionRect={width:0,height:0,startX:A,startY:K,x:A,y:K},!0),ae||(J.stopPropagation(),J.preventDefault())}function x(J){var I;if(!l(v)||!i||!n().selectionRect)return;const ae=Rr(J,i),{startX:ke=0,startY:X=0}=n().selectionRect;if(!h){const Q=n().selectionKeyPressed?0:a();if(Math.hypot(ae.x-ke,ae.y-X)<=Q)return;n().unselectNodesAndEdges(),(I=e.onselectionstart)==null||I.call(e,J)}h=!0;const A={...n().selectionRect,x:ae.x<ke?ae.x:ke,y:ae.y<X?ae.y:X,width:Math.abs(ae.x-ke),height:Math.abs(ae.y-X)},K=o,P=u;o=new Set(Bd(n().nodeLookup,A,[n().viewport.x,n().viewport.y,n().viewport.zoom],n().selectionMode===Tl.Partial,!0).map(Q=>Q.id));const O=n().defaultEdgeOptions.selectable??!0;u=new Set;for(const Q of o){const W=n().connectionLookup.get(Q);if(W)for(const{edgeId:Z}of W.values()){const B=n().edgeLookup.get(Z);B&&(B.selectable??O)&&u.add(Z)}}Zv(K,o)||n(n().nodes=n().nodes.map(Xv(o)),!0),Zv(P,u)||n(n().edges=n().edges.map(Xv(u)),!0),n(n().selectionRectMode="user",!0),n(n().selectionRect=A,!0)}function k(J){var ae,ke,X;J.button===0&&((ke=(ae=J.target)==null?void 0:ae.releasePointerCapture)==null||ke.call(ae,J.pointerId),!h&&J.target===s&&(z==null||z(J)),n(n().selectionRect=null,!0),h&&n(n().selectionRectMode=o.size>0?"nodes":null,!0),h&&((X=e.onselectionend)==null||X.call(e,J)))}const T=J=>{var ae;if(Array.isArray(l(f))&&l(f).includes(2)){J.preventDefault();return}(ae=e.onpanecontextmenu)==null||ae.call(e,{event:J})},N=J=>{h&&(J.stopPropagation(),h=!1)};function z(J){var ae;if(h||n().connection.inProgress){h=!1;return}(ae=e.onpaneclick)==null||ae.call(e,{event:J}),n().unselectNodesAndEdges(),n(n().selectionRectMode=null,!0),n(n().selectionRect=null,!0)}var G=GC();let S;var j=$(()=>l(p)?void 0:Yv(z,s)),L=$(()=>Yv(T,s)),D=b(G);br(D,()=>e.children),Es(G,J=>s=J,()=>s),se(J=>S=Pt(G,1,"svelte-flow__pane svelte-flow__container",null,S,J),[()=>({draggable:r()===!0||Array.isArray(r())&&r().includes(0),dragging:n().dragging,selection:l(v)})]),Ce("click",G,function(...J){var ae;(ae=l(j))==null||ae.apply(this,J)}),fl("pointerdown",G,function(...J){var ae;(ae=l(p)?m:void 0)==null||ae.apply(this,J)},!0),Ce("pointermove",G,function(...J){var ae;(ae=l(p)?x:void 0)==null||ae.apply(this,J)}),Ce("pointerup",G,function(...J){var ae;(ae=l(p)?k:void 0)==null||ae.apply(this,J)}),Ce("contextmenu",G,function(...J){var ae;(ae=l(L))==null||ae.apply(this,J)}),fl("click",G,function(...J){var ae;(ae=l(p)?N:void 0)==null||ae.apply(this,J)},!0),C(t,G),nt()}$t(["click","pointermove","pointerup","contextmenu"]);var YC=q('<div class="svelte-flow__viewport xyflow__viewport svelte-flow__container"><!></div>');function XC(t,e){tt(e,!0);var n=YC();let r;var a=b(n);br(a,()=>e.children),se(()=>r=jt(n,"",r,{transform:`translate(${e.store.viewport.x??""}px, ${e.store.viewport.y??""}px) scale(${e.store.viewport.zoom??""})`})),C(t,n),nt()}function Hs(t,e){const{store:n,onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i}=e,o=eC({onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i,getStoreItems:()=>{const{snapGrid:f,viewport:v}=n;return{nodes:n.nodes,nodeLookup:n.nodeLookup,edges:n.edges,nodeExtent:n.nodeExtent,snapGrid:f||[0,0],snapToGrid:!!f,nodeOrigin:n.nodeOrigin,multiSelectionActive:n.multiselectionKeyPressed,domNode:n.domNode,transform:[v.x,v.y,v.zoom],autoPanOnNodeDrag:n.autoPanOnNodeDrag,nodesDraggable:n.nodesDraggable,selectNodesOnDrag:n.selectNodesOnDrag,nodeDragThreshold:n.nodeDragThreshold,unselectNodesAndEdges:n.unselectNodesAndEdges,updateNodePositions:n.updateNodePositions,onSelectionDrag:n.onselectiondrag,onSelectionDragStart:n.onselectiondragstart,onSelectionDragStop:n.onselectiondragstop,panBy:n.panBy}}});function u(f,v){if(v.disabled){o.destroy();return}o.update({domNode:f,noDragClassName:v.noDragClass,handleSelector:v.handleSelector,nodeId:v.nodeId,isSelectable:v.isSelectable,nodeClickDistance:v.nodeClickDistance})}return u(t,e),{update(f){u(t,f)},destroy(){o.destroy()}}}var ZC=q('<div aria-live="assertive" aria-atomic="true" class="a11y-live-msg svelte-13pq11u"> </div>'),QC=q('<div class="a11y-hidden svelte-13pq11u"> </div> <div class="a11y-hidden svelte-13pq11u"> </div> <!>',1);function JC(t,e){tt(e,!0);var n=QC(),r=Ye(n),a=b(r),s=w(r,2),i=b(s),o=w(s,2);{var u=f=>{var v=ZC(),p=b(v);se(()=>{wt(v,"id",`${$C}-${e.store.flowId}`),te(p,e.store.ariaLiveMessage)}),C(f,v)};pe(o,f=>{e.store.disableKeyboardA11y||f(u)})}se(()=>{wt(r,"id",`${om}-${e.store.flowId}`),te(a,e.store.disableKeyboardA11y?e.store.ariaLabelConfig["node.a11yDescription.default"]:e.store.ariaLabelConfig["node.a11yDescription.keyboardDisabled"]),wt(s,"id",`${lm}-${e.store.flowId}`),te(i,e.store.ariaLabelConfig["edge.a11yDescription.default"])}),C(t,n),nt()}const om="svelte-flow__node-desc",lm="svelte-flow__edge-desc",$C="svelte-flow__aria-live";var eI=q("<div><!></div>");function tI(t,e){tt(e,!0);let n=Ae(e,"store",15),r=$(()=>qn(e.node.data,()=>({}),!0)),a=$(()=>qn(e.node.selected,!1)),s=$(()=>e.node.draggable),i=$(()=>e.node.selectable),o=$(()=>qn(e.node.deletable,!0)),u=$(()=>e.node.connectable),f=$(()=>e.node.focusable),v=$(()=>qn(e.node.hidden,!1)),p=$(()=>qn(e.node.dragging,!1)),h=$(()=>qn(e.node.style,"")),m=$(()=>e.node.class),x=$(()=>qn(e.node.type,"default")),k=$(()=>e.node.parentId),T=$(()=>e.node.sourcePosition),N=$(()=>e.node.targetPosition),z=$(()=>qn(e.node.measured,()=>({width:0,height:0}),!0).width),G=$(()=>qn(e.node.measured,()=>({width:0,height:0}),!0).height),S=$(()=>e.node.initialWidth),j=$(()=>e.node.initialHeight),L=$(()=>e.node.width),D=$(()=>e.node.height),J=$(()=>e.node.dragHandle),ae=$(()=>qn(e.node.internals.z,0)),ke=$(()=>e.node.internals.positionAbsolute.x),X=$(()=>e.node.internals.positionAbsolute.y),A=$(()=>e.node.internals.userNode),{id:K}=e.node,P=$(()=>l(s)??n().nodesDraggable),O=$(()=>l(i)??n().elementsSelectable),I=$(()=>l(u)??n().nodesConnectable),Q=$(()=>AT(e.node)),W=$(()=>!!e.node.internals.handleBounds),Z=$(()=>l(Q)&&l(W)),B=$(()=>l(f)??n().nodesFocusable);function ee(je){return n().parentLookup.has(je)}let ne=$(()=>ee(K)),H=Oe(null),U=null,le=l(x),Y=l(T),ue=l(N),be=$(()=>n().nodeTypes[l(x)]??rm),ge=$(()=>n().ariaLabelConfig),re={get value(){return l(I)}};pC(K),mC(re);let Te=$(()=>{const je=l(z)===void 0?l(L)??l(S):l(L),De=l(G)===void 0?l(D)??l(j):l(D);if(!(je===void 0&&De===void 0&&l(h)===void 0))return`${l(h)};${je?`width:${ta(je)};`:""}${De?`height:${ta(De)};`:""}`});Nn(()=>{(l(x)!==le||l(T)!==Y||l(N)!==ue)&&l(H)!==null&&requestAnimationFrame(()=>{l(H)!==null&&n().updateNodeInternals(new Map([[K,{id:K,nodeElement:l(H),force:!0}]]))}),le=l(x),Y=l(T),ue=l(N)}),Nn(()=>{e.resizeObserver&&(!l(Z)||l(H)!==U)&&(U&&e.resizeObserver.unobserve(U),l(H)&&e.resizeObserver.observe(l(H)),U=l(H))}),ud(()=>{var je;U&&((je=e.resizeObserver)==null||je.unobserve(U))});function _e(je){var De;l(O)&&(!n().selectNodesOnDrag||!l(P)||n().nodeDragThreshold>0)&&n().handleNodeSelection(K),(De=e.onnodeclick)==null||De.call(e,{node:l(A),event:je})}function Pe(je){if(!(Hg(je)||n().disableKeyboardA11y))if(Lg.includes(je.key)&&l(O)){const De=je.key==="Escape";n().handleNodeSelection(K,De,l(H))}else l(P)&&e.node.selected&&Object.prototype.hasOwnProperty.call(Ol,je.key)&&(je.preventDefault(),n(n().ariaLiveMessage=l(ge)["node.a11yDescription.ariaLiveMessage"]({direction:je.key.replace("Arrow","").toLowerCase(),x:~~e.node.internals.positionAbsolute.x,y:~~e.node.internals.positionAbsolute.y}),!0),n().moveSelectedNodes(Ol[je.key],je.shiftKey?4:1))}const He=()=>{var Je;if(n().disableKeyboardA11y||!n().autoPanOnNodeFocus||!((Je=l(H))!=null&&Je.matches(":focus-visible")))return;const{width:je,height:De,viewport:Fe}=n();Bd(new Map([[K,e.node]]),{x:0,y:0,width:je,height:De},[Fe.x,Fe.y,Fe.zoom],!0).length>0||n().setCenter(e.node.position.x+(e.node.measured.width??0)/2,e.node.position.y+(e.node.measured.height??0)/2,{zoom:Fe.zoom})};var Ze=cn(),vt=Ye(Ze);{var ht=je=>{var De=eI();Ha(De,()=>({"data-id":K,class:["svelte-flow__node",`svelte-flow__node-${l(x)}`,l(m)],style:l(Te),onclick:_e,onpointerenter:e.onnodepointerenter?Ne=>e.onnodepointerenter({node:l(A),event:Ne}):void 0,onpointerleave:e.onnodepointerleave?Ne=>e.onnodepointerleave({node:l(A),event:Ne}):void 0,onpointermove:e.onnodepointermove?Ne=>e.onnodepointermove({node:l(A),event:Ne}):void 0,oncontextmenu:e.onnodecontextmenu?Ne=>e.onnodecontextmenu({node:l(A),event:Ne}):void 0,onkeydown:l(B)?Pe:void 0,onfocus:l(B)?He:void 0,tabIndex:l(B)?0:void 0,role:e.node.ariaRole??(l(B)?"group":void 0),"aria-roledescription":"node","aria-describedby":n().disableKeyboardA11y?void 0:`${om}-${n().flowId}`,...e.node.domAttributes,[Ia]:{dragging:l(p),selected:l(a),draggable:l(P),connectable:l(I),selectable:l(O),nopan:l(P),parent:l(ne)},[da]:{"z-index":l(ae),transform:`translate(${l(ke)??""}px, ${l(X)??""}px)`,visibility:l(Q)?"visible":"hidden"}}));var Fe=b(De);cd(Fe,()=>l(be),(Ne,Je)=>{Je(Ne,{get data(){return l(r)},get id(){return K},get selected(){return l(a)},get selectable(){return l(O)},get deletable(){return l(o)},get sourcePosition(){return l(T)},get targetPosition(){return l(N)},get zIndex(){return l(ae)},get dragging(){return l(p)},get draggable(){return l(P)},get dragHandle(){return l(J)},get parentId(){return l(k)},get type(){return l(x)},get isConnectable(){return l(I)},get positionAbsoluteX(){return l(ke)},get positionAbsoluteY(){return l(X)},get width(){return l(L)},get height(){return l(D)}})}),Xn(De,(Ne,Je)=>Hs==null?void 0:Hs(Ne,Je),()=>({nodeId:K,isSelectable:l(O),disabled:!l(P),handleSelector:l(J),noDragClass:n().noDragClass,nodeClickDistance:e.nodeClickDistance,onNodeMouseDown:n().handleNodeSelection,onDrag:(Ne,Je,ut,$e)=>{var it;(it=e.onnodedrag)==null||it.call(e,{event:Ne,targetNode:ut,nodes:$e})},onDragStart:(Ne,Je,ut,$e)=>{var it;(it=e.onnodedragstart)==null||it.call(e,{event:Ne,targetNode:ut,nodes:$e})},onDragStop:(Ne,Je,ut,$e)=>{var it;(it=e.onnodedragstop)==null||it.call(e,{event:Ne,targetNode:ut,nodes:$e})},store:n()})),Es(De,Ne=>M(H,Ne),()=>l(H)),C(je,De)};pe(vt,je=>{l(v)||je(ht)})}C(t,Ze),nt()}var nI=q('<div class="svelte-flow__nodes"></div>');function rI(t,e){tt(e,!0);let n=Ae(e,"store",15);const r=typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const i=new Map;s.forEach(o=>{const u=o.target.getAttribute("data-id");i.set(u,{id:u,nodeElement:o.target,force:!0})}),n().updateNodeInternals(i)});ud(()=>{r==null||r.disconnect()});var a=nI();Ct(a,21,()=>n().visible.nodes.values(),s=>s.id,(s,i)=>{tI(s,{get node(){return l(i)},get resizeObserver(){return r},get nodeClickDistance(){return e.nodeClickDistance},get onnodeclick(){return e.onnodeclick},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get onnodecontextmenu(){return e.onnodecontextmenu},get store(){return n()},set store(o){n(o)}})}),C(t,a),nt()}var aI=bn('<svg class="svelte-flow__edge-wrapper"><g><!></g></svg>');function sI(t,e){tt(e,!0);let n=$(()=>e.edge.id),r=$(()=>e.edge.source),a=$(()=>e.edge.target),s=$(()=>e.edge.sourceX),i=$(()=>e.edge.sourceY),o=$(()=>e.edge.targetX),u=$(()=>e.edge.targetY),f=$(()=>e.edge.sourcePosition),v=$(()=>e.edge.targetPosition),p=$(()=>qn(e.edge.animated,!1)),h=$(()=>qn(e.edge.selected,!1)),m=$(()=>e.edge.label),x=$(()=>e.edge.labelStyle),k=$(()=>qn(e.edge.data,()=>({}),!0)),T=$(()=>e.edge.style),N=$(()=>e.edge.interactionWidth),z=$(()=>qn(e.edge.type,"default")),G=$(()=>e.edge.sourceHandle),S=$(()=>e.edge.targetHandle),j=$(()=>e.edge.markerStart),L=$(()=>e.edge.markerEnd),D=$(()=>e.edge.selectable),J=$(()=>e.edge.focusable),ae=$(()=>qn(e.edge.deletable,!0)),ke=$(()=>e.edge.hidden),X=$(()=>e.edge.zIndex),A=$(()=>e.edge.class),K=$(()=>e.edge.ariaLabel);bC(l(n));let P=null,O=$(()=>l(D)??e.store.elementsSelectable),I=$(()=>l(J)??e.store.edgesFocusable),Q=$(()=>e.store.edgeTypes[l(z)]??am),W=$(()=>l(j)?`url('#${Gu(l(j),e.store.flowId)}')`:void 0),Z=$(()=>l(L)?`url('#${Gu(l(L),e.store.flowId)}')`:void 0);function B(Y){var be;const ue=e.store.edgeLookup.get(l(n));ue&&(l(O)&&e.store.handleEdgeSelection(l(n)),(be=e.onedgeclick)==null||be.call(e,{event:Y,edge:ue}))}function ee(Y,ue){const be=e.store.edgeLookup.get(l(n));be&&ue({event:Y,edge:be})}function ne(Y){if(!e.store.disableKeyboardA11y&&Lg.includes(Y.key)&&l(O)){const{unselectNodesAndEdges:ue,addSelectedEdges:be}=e.store;Y.key==="Escape"?(P==null||P.blur(),ue({edges:[e.edge]})):be([l(n)])}}var H=cn(),U=Ye(H);{var le=Y=>{var ue=aI();let be;var ge=b(ue);Ha(ge,()=>({class:["svelte-flow__edge",l(A)],"data-id":l(n),onclick:B,oncontextmenu:e.onedgecontextmenu?Te=>{ee(Te,e.onedgecontextmenu)}:void 0,onpointerenter:e.onedgepointerenter?Te=>{ee(Te,e.onedgepointerenter)}:void 0,onpointerleave:e.onedgepointerleave?Te=>{ee(Te,e.onedgepointerleave)}:void 0,"aria-label":l(K)===null?void 0:l(K)?l(K):`Edge from ${l(r)} to ${l(a)}`,"aria-describedby":l(I)?`${lm}-${e.store.flowId}`:void 0,role:e.edge.ariaRole??(l(I)?"group":"img"),"aria-roledescription":"edge",onkeydown:l(I)?ne:void 0,tabindex:l(I)?0:void 0,...e.edge.domAttributes,[Ia]:{animated:l(p),selected:l(h),selectable:l(O)}}));var re=b(ge);cd(re,()=>l(Q),(Te,_e)=>{_e(Te,{get id(){return l(n)},get source(){return l(r)},get target(){return l(a)},get sourceX(){return l(s)},get sourceY(){return l(i)},get targetX(){return l(o)},get targetY(){return l(u)},get sourcePosition(){return l(f)},get targetPosition(){return l(v)},get animated(){return l(p)},get selected(){return l(h)},get label(){return l(m)},get labelStyle(){return l(x)},get data(){return l(k)},get style(){return l(T)},get interactionWidth(){return l(N)},get selectable(){return l(O)},get deletable(){return l(ae)},get type(){return l(z)},get sourceHandleId(){return l(G)},get targetHandleId(){return l(S)},get markerStart(){return l(W)},get markerEnd(){return l(Z)}})}),Es(ge,Te=>P=Te,()=>P),se(()=>be=jt(ue,"",be,{"z-index":l(X)})),C(Y,ue)};pe(U,Y=>{l(ke)||Y(le)})}C(t,H),nt()}fy();var iI=bn("<defs></defs>");function oI(t,e){tt(e,!1);const n=Is();gb();var r=iI();Ct(r,5,()=>n.markers,a=>a.id,(a,s)=>{dI(a,zs(()=>l(s)))}),C(t,r),nt()}var lI=bn('<polyline class="arrow" fill="none" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4"></polyline>'),cI=bn('<polyline class="arrowclosed" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4 -5,-4"></polyline>'),uI=bn('<marker class="svelte-flow__arrowhead" viewBox="-10 -10 20 20" refX="0" refY="0"><!></marker>');function dI(t,e){tt(e,!0);let n=Ae(e,"width",3,12.5),r=Ae(e,"height",3,12.5),a=Ae(e,"markerUnits",3,"strokeWidth"),s=Ae(e,"orient",3,"auto-start-reverse"),i=Ae(e,"color",3,"none");var o=uI(),u=b(o);{var f=p=>{var h=lI();let m;se(()=>{wt(h,"stroke-width",e.strokeWidth),m=jt(h,"",m,{stroke:i()})}),C(p,h)},v=p=>{var h=cI();let m;se(()=>{wt(h,"stroke-width",e.strokeWidth),m=jt(h,"",m,{stroke:i(),fill:i()})}),C(p,h)};pe(u,p=>{e.type===Cl.Arrow?p(f):e.type===Cl.ArrowClosed&&p(v,1)})}se(()=>{wt(o,"id",e.id),wt(o,"markerWidth",`${n()}`),wt(o,"markerHeight",`${r()}`),wt(o,"markerUnits",a()),wt(o,"orient",s())}),C(t,o),nt()}var fI=q('<div class="svelte-flow__edges"><svg class="svelte-flow__marker"><!></svg> <!></div>');function vI(t,e){tt(e,!0);let n=Ae(e,"store",15);var r=fI(),a=b(r),s=b(a);oI(s,{});var i=w(a,2);Ct(i,17,()=>n().visible.edges.values(),o=>o.id,(o,u)=>{sI(o,{get edge(){return l(u)},get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return n()},set store(f){n(f)}})}),C(t,r),nt()}var hI=q('<div class="svelte-flow__selection svelte-1vr3gfi"></div>');function cm(t,e){tt(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"width",3,0),s=Ae(e,"height",3,0),i=Ae(e,"isVisible",3,!0);var o=cn(),u=Ye(o);{var f=v=>{var p=hI();let h;se(m=>h=jt(p,"",h,m),[()=>({width:typeof a()=="string"?a():ta(a()),height:typeof s()=="string"?s():ta(s()),transform:`translate(${n()}px, ${r()}px)`})]),C(v,p)};pe(u,v=>{i()&&v(f)})}C(t,o),nt()}var pI=q("<div><!></div>");function gI(t,e){tt(e,!0);let n=Oe(void 0);Nn(()=>{var p;e.store.disableKeyboardA11y||(p=l(n))==null||p.focus({preventScroll:!0})});let r=$(()=>{if(e.store.selectionRectMode==="nodes"){e.store.nodes;const p=tc(e.store.nodeLookup,{filter:h=>!!h.selected});if(p.width>0&&p.height>0)return p}return null});function a(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectioncontextmenu)==null||m.call(e,{nodes:h,event:p})}function s(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectionclick)==null||m.call(e,{nodes:h,event:p})}function i(p){Object.prototype.hasOwnProperty.call(Ol,p.key)&&(p.preventDefault(),e.store.moveSelectedNodes(Ol[p.key],p.shiftKey?4:1))}var o=cn(),u=Ye(o);{var f=p=>{var h=pI();let m;var x=b(h);cm(x,{width:"100%",height:"100%",x:0,y:0}),Xn(h,(k,T)=>Hs==null?void 0:Hs(k,T),()=>({disabled:!1,store:e.store,onDrag:(k,T,N,z)=>{var G;(G=e.onnodedrag)==null||G.call(e,{event:k,targetNode:null,nodes:z})},onDragStart:(k,T,N,z)=>{var G;(G=e.onnodedragstart)==null||G.call(e,{event:k,targetNode:null,nodes:z})},onDragStop:(k,T,N,z)=>{var G;(G=e.onnodedragstop)==null||G.call(e,{event:k,targetNode:null,nodes:z})}})),Es(h,k=>M(n,k),()=>l(n)),se(k=>{Pt(h,1,Ss(["svelte-flow__selection-wrapper",e.store.noPanClass]),"svelte-sf2y5e"),wt(h,"role",e.store.disableKeyboardA11y?void 0:"button"),wt(h,"tabindex",e.store.disableKeyboardA11y?void 0:-1),m=jt(h,"",m,k)},[()=>({width:ta(l(r).width),height:ta(l(r).height),transform:`translate(${l(r).x??""}px, ${l(r).y??""}px)`})]),Ce("contextmenu",h,a),Ce("click",h,s),Ce("keydown",h,function(...k){var T;(T=e.store.disableKeyboardA11y?void 0:i)==null||T.apply(this,k)}),C(p,h)},v=$(()=>e.store.selectionRectMode==="nodes"&&l(r)&&ga(l(r).x)&&ga(l(r).y));pe(u,p=>{l(v)&&p(f)})}C(t,o),nt()}$t(["contextmenu","click","keydown"]);function mI(t){switch(t){case"ctrl":return 8;case"shift":return 4;case"alt":return 2;case"meta":return 1}}function Jt(t,e){let{enabled:n=!0,trigger:r,type:a="keydown"}=e;function s(o){var v;const u=Array.isArray(r)?r:[r],f=[o.metaKey,o.altKey,o.shiftKey,o.ctrlKey].reduce((p,h,m)=>h?p|1<<m:p,0);for(const p of u){const h={preventDefault:!1,enabled:!0,...p},{modifier:m,key:x,callback:k,preventDefault:T,enabled:N}=h;if(N){if(o.key!==x)continue;if(m===null||m===!1){if(f!==0)continue}else if(m!==void 0&&((v=m==null?void 0:m[0])==null?void 0:v.length)>0){const G=Array.isArray(m)?m:[m];let S=!1;for(const j of G)if((Array.isArray(j)?j:[j]).reduce((D,J)=>D|mI(J),0)===f){S=!0;break}if(!S)continue}T&&o.preventDefault();const z={node:t,trigger:h,originalEvent:o};t.dispatchEvent(new CustomEvent("shortcut",{detail:z})),k==null||k(z)}}}let i;return n&&(i=mu(t,a,s)),{update:o=>{const{enabled:u=!0,type:f="keydown"}=o;n&&(!u||a!==f)?i==null||i():!n&&u&&(i=mu(t,f,s)),n=u,a=f,r=o.trigger},destroy:()=>{i==null||i()}}}function yI(){const t=$(Is),e=s=>{var f,v;const i=Gv(s)?s:l(t).nodeLookup.get(s.id),o=i.parentId?TT(i.position,i.measured,i.parentId,l(t).nodeLookup,l(t).nodeOrigin):i.position,u={...i,position:o,width:((f=i.measured)==null?void 0:f.width)??i.width,height:((v=i.measured)==null?void 0:v.height)??i.height};return ii(u)};function n(s,i,o={replace:!1}){l(t).nodes=er(()=>l(t).nodes).map(u=>{if(u.id===s){const f=typeof i=="function"?i(u):i;return o!=null&&o.replace&&Gv(f)?f:{...u,...f}}return u})}function r(s,i,o={replace:!1}){l(t).edges=er(()=>l(t).edges).map(u=>{if(u.id===s){const f=typeof i=="function"?i(u):i;return o.replace&&CC(f)?f:{...u,...f}}return u})}const a=s=>l(t).nodeLookup.get(s);return{zoomIn:l(t).zoomIn,zoomOut:l(t).zoomOut,getInternalNode:a,getNode:s=>{var i;return(i=a(s))==null?void 0:i.internals.userNode},getNodes:s=>s===void 0?l(t).nodes:Qv(l(t).nodeLookup,s),getEdge:s=>l(t).edgeLookup.get(s),getEdges:s=>s===void 0?l(t).edges:Qv(l(t).edgeLookup,s),setZoom:(s,i)=>{const o=l(t).panZoom;return o?o.scaleTo(s,{duration:i==null?void 0:i.duration}):Promise.resolve(!1)},getZoom:()=>l(t).viewport.zoom,setViewport:async(s,i)=>{const o=l(t).viewport;return l(t).panZoom?(await l(t).panZoom.setViewport({x:s.x??o.x,y:s.y??o.y,zoom:s.zoom??o.zoom},i),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>hh(l(t).viewport),setCenter:async(s,i,o)=>l(t).setCenter(s,i,o),fitView:s=>l(t).fitView(s),fitBounds:async(s,i)=>{if(!l(t).panZoom)return Promise.resolve(!1);const o=qd(s,l(t).width,l(t).height,l(t).minZoom,l(t).maxZoom,(i==null?void 0:i.padding)??.1);return await l(t).panZoom.setViewport(o,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)},getIntersectingNodes:(s,i=!0,o)=>{const u=Rv(s),f=u?s:e(s);return f?(o||l(t).nodes).filter(v=>{const p=l(t).nodeLookup.get(v.id);if(!p||!u&&v.id===s.id)return!1;const h=ii(p),m=Ji(h,f);return i&&m>0||m>=h.width*h.height||m>=f.width*f.height}):[]},isNodeIntersecting:(s,i,o=!0)=>{const f=Rv(s)?s:e(s);if(!f)return!1;const v=Ji(f,i);return o&&v>0||v>=i.width*i.height||v>=f.width*f.height},deleteElements:async({nodes:s=[],edges:i=[]})=>{var f,v;const{nodes:o,edges:u}=await wT({nodesToRemove:s,edgesToRemove:i,nodes:l(t).nodes,edges:l(t).edges,onBeforeDelete:l(t).onbeforedelete});return o&&(l(t).nodes=er(()=>l(t).nodes).filter(p=>!o.some(({id:h})=>h===p.id))),u&&(l(t).edges=er(()=>l(t).edges).filter(p=>!u.some(({id:h})=>h===p.id))),(o.length>0||u.length>0)&&((v=(f=l(t)).ondelete)==null||v.call(f,{nodes:o,edges:u})),{deletedNodes:o,deletedEdges:u}},screenToFlowPosition:(s,i={snapToGrid:!0})=>{if(!l(t).domNode)return s;const o=i.snapToGrid?l(t).snapGrid:!1,{x:u,y:f,zoom:v}=l(t).viewport,{x:p,y:h}=l(t).domNode.getBoundingClientRect(),m={x:s.x-p,y:s.y-h};return xo(m,[u,f,v],o!==null,o||[1,1])},flowToScreenPosition:s=>{if(!l(t).domNode)return s;const{x:i,y:o,zoom:u}=l(t).viewport,{x:f,y:v}=l(t).domNode.getBoundingClientRect(),p=Pl(s,[i,o,u]);return{x:p.x+f,y:p.y+v}},toObject:()=>structuredClone({nodes:[...l(t).nodes],edges:[...l(t).edges],viewport:{...l(t).viewport}}),updateNode:n,updateNodeData:(s,i,o)=>{var v;const u=(v=l(t).nodeLookup.get(s))==null?void 0:v.internals.userNode;if(!u)return;const f=typeof i=="function"?i(u):i;n(s,p=>({...p,data:o!=null&&o.replace?f:{...p.data,...f}}))},updateEdge:r,getNodesBounds:s=>mT(s,{nodeLookup:l(t).nodeLookup,nodeOrigin:l(t).nodeOrigin}),getHandleConnections:({type:s,id:i,nodeId:o})=>{var u;return Array.from(((u=l(t).connectionLookup.get(`${o}-${s}-${i??null}`))==null?void 0:u.values())??[])}}}function Qv(t,e){var r;const n=[];for(const a of e){const s=t.get(a);if(s){const i="internals"in s?(r=s.internals)==null?void 0:r.userNode:s;n.push(i)}}return n}function bI(t,e){tt(e,!0);let n=Ae(e,"store",15),r=Ae(e,"selectionKey",3,"Shift"),a=Ae(e,"multiSelectionKey",19,()=>Ml()?"Meta":"Control"),s=Ae(e,"deleteKey",3,"Backspace"),i=Ae(e,"panActivationKey",3," "),o=Ae(e,"zoomActivationKey",19,()=>Ml()?"Meta":"Control"),{deleteElements:u}=yI();function f(k){return k!==null&&typeof k=="object"}function v(k){return f(k)?k.modifier||[]:[]}function p(k){return k==null?"":f(k)?k.key:k}function h(k,T){return(Array.isArray(k)?k:[k]).map(z=>{const G=p(z);return{key:G,modifier:v(z),enabled:G!==null,callback:T}})}function m(){n(n().selectionRect=null,!0),n(n().selectionKeyPressed=!1,!0),n(n().multiselectionKeyPressed=!1,!0),n(n().deleteKeyPressed=!1,!0),n(n().panActivationKeyPressed=!1,!0),n(n().zoomActivationKeyPressed=!1,!0)}function x(){const k=n().nodes.filter(N=>N.selected),T=n().edges.filter(N=>N.selected);u({nodes:k,edges:T})}fl("blur",Wn,m),fl("contextmenu",Wn,m),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(a(),()=>{n(n().multiselectionKeyPressed=!0,!0)}),type:"keydown"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(a(),()=>n(n().multiselectionKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(s(),k=>{!(k.originalEvent.ctrlKey||k.originalEvent.metaKey||k.originalEvent.shiftKey)&&!Hg(k.originalEvent)&&(n(n().deleteKeyPressed=!0,!0),x())}),type:"keydown"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(s(),()=>n(n().deleteKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(o(),()=>n(n().zoomActivationKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,T)=>Jt==null?void 0:Jt(k,T),()=>({trigger:h(o(),()=>n(n().zoomActivationKeyPressed=!1,!0)),type:"keyup"})),nt()}var _I=bn('<path fill="none" class="svelte-flow__connection-path"></path>'),wI=bn('<svg class="svelte-flow__connectionline"><g><!></g></svg>');function xI(t,e){tt(e,!0);let n=$(()=>{if(!e.store.connection.inProgress)return"";const i={sourceX:e.store.connection.from.x,sourceY:e.store.connection.from.y,sourcePosition:e.store.connection.fromPosition,targetX:e.store.connection.to.x,targetY:e.store.connection.to.y,targetPosition:e.store.connection.toPosition};switch(e.type){case Pa.Bezier:{const[o]=Ug(i);return o}case Pa.Straight:{const[o]=Wg(i);return o}case Pa.Step:case Pa.SmoothStep:{const[o]=Fd({...i,borderRadius:e.type===Pa.Step?0:void 0});return o}}});var r=cn(),a=Ye(r);{var s=i=>{var o=wI(),u=b(o),f=b(u);{var v=h=>{var m=cn(),x=Ye(m);cd(x,()=>e.LineComponent,(k,T)=>{T(k,{})}),C(h,m)},p=h=>{var m=_I();se(()=>{wt(m,"d",l(n)),jt(m,e.style)}),C(h,m)};pe(f,h=>{e.LineComponent?h(v):h(p,!1)})}se(h=>{wt(o,"width",e.store.width),wt(o,"height",e.store.height),jt(o,e.containerStyle),Pt(u,0,h)},[()=>Ss(["svelte-flow__connection",pT(e.store.connection.isValid)])]),C(i,o)};pe(a,i=>{e.store.connection.inProgress&&i(s)})}C(t,r),nt()}var kI=q("<div><!></div>");function um(t,e){tt(e,!0);let n=Ae(e,"position",3,"top-right"),r=As(e,["$$slots","$$events","$$legacy","position","style","class","children"]),a=$(()=>`${n()}`.split("-"));var s=kI();Ha(s,o=>({class:o,style:e.style,...r}),[()=>["svelte-flow__panel",e.class,...l(a)]]);var i=b(s);br(i,()=>e.children??xs),C(t,s),nt()}var SI=q('<a href="https://svelteflow.dev" target="_blank" rel="noopener noreferrer" aria-label="Svelte Flow attribution">Svelte Flow</a>');function EI(t,e){tt(e,!0);let n=Ae(e,"position",3,"bottom-right");var r=cn(),a=Ye(r);{var s=i=>{um(i,{get position(){return n()},class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",children:(o,u)=>{var f=SI();C(o,f)},$$slots:{default:!0}})};pe(a,i=>{var o;(o=e.proOptions)!=null&&o.hideAttribution||i(s)})}C(t,r),nt()}var AI=q("<div><!></div>");function TI(t,e){tt(e,!0);let n=Ae(e,"domNode",15),r=Ae(e,"clientWidth",15),a=Ae(e,"clientHeight",15),s=$(()=>e.rest.class),i=$(()=>jm(e.rest,["id","class","nodeTypes","edgeTypes","colorMode","isValidConnection","onmove","onmovestart","onmoveend","onflowerror","ondelete","onbeforedelete","onbeforeconnect","onconnect","onconnectstart","onconnectend","onbeforereconnect","onreconnect","onreconnectstart","onreconnectend","onclickconnectstart","onclickconnectend","oninit","onselectionchange","onselectiondragstart","onselectiondrag","onselectiondragstop","onselectionstart","onselectionend","clickConnect","fitView","fitViewOptions","nodeOrigin","nodeDragThreshold","connectionDragThreshold","minZoom","maxZoom","initialViewport","connectionRadius","connectionMode","selectionMode","selectNodesOnDrag","snapGrid","defaultMarkerColor","translateExtent","nodeExtent","onlyRenderVisibleElements","autoPanOnConnect","autoPanOnNodeDrag","colorModeSSR","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","elementsSelectable","nodesFocusable","edgesFocusable","disableKeyboardA11y","noDragClass","noPanClass","noWheelClass","ariaLabelConfig","autoPanSpeed","panOnScrollSpeed","zIndexMode"]));function o(v){v.currentTarget.scrollTo({top:0,left:0,behavior:"auto"}),e.rest.onscroll&&e.rest.onscroll(v)}var u=AI();Ha(u,v=>({class:["svelte-flow","svelte-flow__container",l(s),e.colorMode],"data-testid":"svelte-flow__wrapper",role:"application",onscroll:o,...l(i),[da]:v}),[()=>({width:ta(e.width),height:ta(e.height)})],void 0,void 0,"svelte-mkap6j");var f=b(u);br(f,()=>e.children??xs),Es(u,v=>n(v),()=>n()),Df(u,"clientHeight",a),Df(u,"clientWidth",r),C(t,u),nt()}var CI=q('<div class="svelte-flow__viewport-back svelte-flow__container"></div> <!> <div class="svelte-flow__edge-labels svelte-flow__container"></div> <!> <!> <!> <div class="svelte-flow__viewport-front svelte-flow__container"></div>',1),II=q("<!> <!>",1),PI=q("<!> <!> <!> <!> <!>",1);function MI(t,e){tt(e,!0);let n=Ae(e,"paneClickDistance",3,1),r=Ae(e,"nodeClickDistance",3,1),a=Ae(e,"panOnScrollMode",19,()=>Ks.Free),s=Ae(e,"preventScrolling",3,!0),i=Ae(e,"zoomOnScroll",3,!0),o=Ae(e,"zoomOnDoubleClick",3,!0),u=Ae(e,"zoomOnPinch",3,!0),f=Ae(e,"panOnScroll",3,!1),v=Ae(e,"panOnScrollSpeed",3,.5),p=Ae(e,"panOnDrag",3,!0),h=Ae(e,"selectionOnDrag",3,!1),m=Ae(e,"connectionLineType",19,()=>Pa.Bezier),x=Ae(e,"nodes",31,()=>tn([])),k=Ae(e,"edges",31,()=>tn([])),T=Ae(e,"viewport",15,void 0),N=As(e,["$$slots","$$events","$$legacy","width","height","proOptions","selectionKey","deleteKey","panActivationKey","multiSelectionKey","zoomActivationKey","paneClickDistance","nodeClickDistance","onmovestart","onmoveend","onmove","oninit","onnodeclick","onnodecontextmenu","onnodedrag","onnodedragstart","onnodedragstop","onnodepointerenter","onnodepointermove","onnodepointerleave","onselectionclick","onselectioncontextmenu","onselectionstart","onselectionend","onedgeclick","onedgecontextmenu","onedgepointerenter","onedgepointerleave","onpaneclick","onpanecontextmenu","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnDrag","selectionOnDrag","connectionLineComponent","connectionLineStyle","connectionLineContainerStyle","connectionLineType","attributionPosition","children","nodes","edges","viewport"]),z=HC({props:N,width:e.width,height:e.height,get nodes(){return x()},set nodes(S){x(S)},get edges(){return k()},set edges(S){k(S)},get viewport(){return T()},set viewport(S){T(S)}});const G=Ju(Wu);G&&G.setStore&&G.setStore(z),ph(Wu,{provider:!1,getStore(){return z}}),Nn(()=>{var j;const S={nodes:z.selectedNodes,edges:z.selectedEdges};(j=er(()=>e.onselectionchange))==null||j(S);for(const L of z.selectionChangeHandlers.values())L(S)}),ud(()=>{z.reset()}),TI(t,{get colorMode(){return z.colorMode},get width(){return e.width},get height(){return e.height},get rest(){return N},get domNode(){return z.domNode},set domNode(S){z.domNode=S},get clientWidth(){return z.width},set clientWidth(S){z.width=S},get clientHeight(){return z.height},set clientHeight(S){z.height=S},children:(S,j)=>{var L=PI(),D=Ye(L);bI(D,{get selectionKey(){return e.selectionKey},get deleteKey(){return e.deleteKey},get panActivationKey(){return e.panActivationKey},get multiSelectionKey(){return e.multiSelectionKey},get zoomActivationKey(){return e.zoomActivationKey},get store(){return z},set store(A){z=A}});var J=w(D,2);UC(J,{get panOnScrollMode(){return a()},get preventScrolling(){return s()},get zoomOnScroll(){return i()},get zoomOnDoubleClick(){return o()},get zoomOnPinch(){return u()},get panOnScroll(){return f()},get panOnScrollSpeed(){return v()},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get onmovestart(){return e.onmovestart},get onmove(){return e.onmove},get onmoveend(){return e.onmoveend},get oninit(){return e.oninit},get store(){return z},set store(A){z=A},children:(A,K)=>{WC(A,{get onpaneclick(){return e.onpaneclick},get onpanecontextmenu(){return e.onpanecontextmenu},get onselectionstart(){return e.onselectionstart},get onselectionend(){return e.onselectionend},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get store(){return z},set store(P){z=P},children:(P,O)=>{var I=II(),Q=Ye(I);XC(Q,{get store(){return z},set store(Z){z=Z},children:(Z,B)=>{var ee=CI(),ne=w(Ye(ee),2);vI(ne,{get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return z},set store(Y){z=Y}});var H=w(ne,4);xI(H,{get type(){return m()},get LineComponent(){return e.connectionLineComponent},get containerStyle(){return e.connectionLineContainerStyle},get style(){return e.connectionLineStyle},get store(){return z},set store(Y){z=Y}});var U=w(H,2);rI(U,{get nodeClickDistance(){return r()},get onnodeclick(){return e.onnodeclick},get onnodecontextmenu(){return e.onnodecontextmenu},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return z},set store(Y){z=Y}});var le=w(U,2);gI(le,{get onselectionclick(){return e.onselectionclick},get onselectioncontextmenu(){return e.onselectioncontextmenu},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return z},set store(Y){z=Y}}),C(Z,ee)},$$slots:{default:!0}});var W=w(Q,2);{let Z=$(()=>!!(z.selectionRect&&z.selectionRectMode==="user")),B=$(()=>{var U;return(U=z.selectionRect)==null?void 0:U.width}),ee=$(()=>{var U;return(U=z.selectionRect)==null?void 0:U.height}),ne=$(()=>{var U;return(U=z.selectionRect)==null?void 0:U.x}),H=$(()=>{var U;return(U=z.selectionRect)==null?void 0:U.y});cm(W,{get isVisible(){return l(Z)},get width(){return l(B)},get height(){return l(ee)},get x(){return l(ne)},get y(){return l(H)}})}C(P,I)},$$slots:{default:!0}})},$$slots:{default:!0}});var ae=w(J,2);EI(ae,{get proOptions(){return e.proOptions},get position(){return e.attributionPosition}});var ke=w(ae,2);JC(ke,{get store(){return z}});var X=w(ke,2);br(X,()=>e.children??xs),C(S,L)},$$slots:{default:!0}}),nt()}var OI=q("<button><!></button>");function Qo(t,e){let n=As(e,["$$slots","$$events","$$legacy","class","bgColor","bgColorHover","color","colorHover","borderColor","onclick","children"]);var r=OI();Ha(r,()=>({type:"button",onclick:e.onclick,class:["svelte-flow__controls-button",e.class],...n,[da]:{"--xy-controls-button-background-color-props":e.bgColor,"--xy-controls-button-background-color-hover-props":e.bgColorHover,"--xy-controls-button-color-props":e.color,"--xy-controls-button-color-hover-props":e.colorHover,"--xy-controls-button-border-color-props":e.borderColor}}));var a=b(r);br(a,()=>e.children??xs),C(t,r)}var NI=bn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"></path></svg>');function RI(t){var e=NI();C(t,e)}var DI=bn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 5"><path d="M0 0h32v4.2H0z"></path></svg>');function LI(t){var e=DI();C(t,e)}var jI=bn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 30"><path d="M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"></path></svg>');function zI(t){var e=jI();C(t,e)}var BI=bn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"></path></svg>');function qI(t){var e=BI();C(t,e)}var FI=bn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"></path></svg>');function KI(t){var e=FI();C(t,e)}var HI=q("<!> <!>",1),VI=q("<!> <!> <!> <!> <!> <!>",1);function UI(t,e){tt(e,!0);let n=Ae(e,"position",3,"bottom-left"),r=Ae(e,"orientation",3,"vertical"),a=Ae(e,"showZoom",3,!0),s=Ae(e,"showFitView",3,!0),i=Ae(e,"showLock",3,!0),o=As(e,["$$slots","$$events","$$legacy","position","orientation","showZoom","showFitView","showLock","style","class","buttonBgColor","buttonBgColorHover","buttonColor","buttonColorHover","buttonBorderColor","fitViewOptions","children","before","after"]),u=$(Is);const f={bgColor:e.buttonBgColor,bgColorHover:e.buttonBgColorHover,color:e.buttonColor,colorHover:e.buttonColorHover,borderColor:e.buttonBorderColor};let v=$(()=>l(u).nodesDraggable||l(u).nodesConnectable||l(u).elementsSelectable),p=$(()=>l(u).viewport.zoom<=l(u).minZoom),h=$(()=>l(u).viewport.zoom>=l(u).maxZoom),m=$(()=>l(u).ariaLabelConfig),x=$(()=>r()==="horizontal"?"horizontal":"vertical");const k=()=>{l(u).zoomIn()},T=()=>{l(u).zoomOut()},N=()=>{l(u).fitView(e.fitViewOptions)},z=()=>{let G=!l(v);l(u).nodesDraggable=G,l(u).nodesConnectable=G,l(u).elementsSelectable=G};{let G=$(()=>["svelte-flow__controls",l(x),e.class]);um(t,zs({get class(){return l(G)},get position(){return n()},"data-testid":"svelte-flow__controls",get"aria-label"(){return l(m)["controls.ariaLabel"]},get style(){return e.style}},()=>o,{children:(S,j)=>{var L=VI(),D=Ye(L);{var J=Z=>{var B=cn(),ee=Ye(B);br(ee,()=>e.before),C(Z,B)};pe(D,Z=>{e.before&&Z(J)})}var ae=w(D,2);{var ke=Z=>{var B=HI(),ee=Ye(B);Qo(ee,zs({onclick:k,class:"svelte-flow__controls-zoomin",get title(){return l(m)["controls.zoomIn.ariaLabel"]},get"aria-label"(){return l(m)["controls.zoomIn.ariaLabel"]},get disabled(){return l(h)}},()=>f,{children:(H,U)=>{RI(H)},$$slots:{default:!0}}));var ne=w(ee,2);Qo(ne,zs({onclick:T,class:"svelte-flow__controls-zoomout",get title(){return l(m)["controls.zoomOut.ariaLabel"]},get"aria-label"(){return l(m)["controls.zoomOut.ariaLabel"]},get disabled(){return l(p)}},()=>f,{children:(H,U)=>{LI(H)},$$slots:{default:!0}})),C(Z,B)};pe(ae,Z=>{a()&&Z(ke)})}var X=w(ae,2);{var A=Z=>{Qo(Z,zs({class:"svelte-flow__controls-fitview",onclick:N,get title(){return l(m)["controls.fitView.ariaLabel"]},get"aria-label"(){return l(m)["controls.fitView.ariaLabel"]}},()=>f,{children:(B,ee)=>{zI(B)},$$slots:{default:!0}}))};pe(X,Z=>{s()&&Z(A)})}var K=w(X,2);{var P=Z=>{Qo(Z,zs({class:"svelte-flow__controls-interactive",onclick:z,get title(){return l(m)["controls.interactive.ariaLabel"]},get"aria-label"(){return l(m)["controls.interactive.ariaLabel"]}},()=>f,{children:(B,ee)=>{var ne=cn(),H=Ye(ne);{var U=Y=>{KI(Y)},le=Y=>{qI(Y)};pe(H,Y=>{l(v)?Y(U):Y(le,!1)})}C(B,ne)},$$slots:{default:!0}}))};pe(K,Z=>{i()&&Z(P)})}var O=w(K,2);{var I=Z=>{var B=cn(),ee=Ye(B);br(ee,()=>e.children),C(Z,B)};pe(O,Z=>{e.children&&Z(I)})}var Q=w(O,2);{var W=Z=>{var B=cn(),ee=Ye(B);br(ee,()=>e.after),C(Z,B)};pe(Q,Z=>{e.after&&Z(W)})}C(S,L)},$$slots:{default:!0}}))}nt()}var ja;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(ja||(ja={}));var GI=bn("<circle></circle>");function WI(t,e){var n=GI();se(()=>{wt(n,"cx",e.radius),wt(n,"cy",e.radius),wt(n,"r",e.radius),Pt(n,0,Ss(["svelte-flow__background-pattern","dots",e.class]))}),C(t,n)}var YI=bn("<path></path>");function XI(t,e){tt(e,!0);var n=YI();se(()=>{wt(n,"stroke-width",e.lineWidth),wt(n,"d",`M${e.dimensions[0]/2} 0 V${e.dimensions[1]} M0 ${e.dimensions[1]/2} H${e.dimensions[0]}`),Pt(n,0,Ss(["svelte-flow__background-pattern",e.variant,e.class]))}),C(t,n),nt()}const ZI={[ja.Dots]:1,[ja.Lines]:1,[ja.Cross]:6};var QI=bn('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function JI(t,e){tt(e,!0);let n=Ae(e,"variant",19,()=>ja.Dots),r=Ae(e,"gap",3,20),a=Ae(e,"lineWidth",3,1),s=$(Is),i=$(()=>n()===ja.Dots),o=$(()=>n()===ja.Cross),u=$(()=>Array.isArray(r())?r():[r(),r()]),f=$(()=>`background-pattern-${l(s).flowId}-${e.id??""}`),v=$(()=>[l(u)[0]*l(s).viewport.zoom||1,l(u)[1]*l(s).viewport.zoom||1]),p=$(()=>(e.size??ZI[n()])*l(s).viewport.zoom),h=$(()=>l(o)?[l(p),l(p)]:l(v)),m=$(()=>l(i)?[l(p)/2,l(p)/2]:[l(h)[0]/2,l(h)[1]/2]);var x=QI();let k;var T=b(x),N=b(T);{var z=j=>{{let L=$(()=>l(p)/2);WI(j,{get radius(){return l(L)},get class(){return e.patternClass}})}},G=j=>{XI(j,{get dimensions(){return l(h)},get variant(){return n()},get lineWidth(){return a()},get class(){return e.patternClass}})};pe(N,j=>{l(i)?j(z):j(G,!1)})}var S=w(T);se(()=>{Pt(x,0,Ss(["svelte-flow__background","svelte-flow__container",e.class])),k=jt(x,"",k,{"--xy-background-color-props":e.bgColor,"--xy-background-pattern-color-props":e.patternColor}),wt(T,"id",l(f)),wt(T,"x",l(s).viewport.x%l(v)[0]),wt(T,"y",l(s).viewport.y%l(v)[1]),wt(T,"width",l(v)[0]),wt(T,"height",l(v)[1]),wt(T,"patternTransform",`translate(-${l(m)[0]},-${l(m)[1]})`),wt(S,"fill",`url(#${l(f)})`)}),C(t,x),nt()}var $I=q('<div class="trigger-node svelte-a1pdcu"><div class="trigger-header svelte-a1pdcu"><span class="icon">â¡</span> Trigger</div> <div class="trigger-body svelte-a1pdcu"><div class="label svelte-a1pdcu"> </div> <div class="group svelte-a1pdcu"> </div></div> <!></div>');function eP(t,e){tt(e,!0);let n=$(()=>Lr[e.data.group]||Lr.INFO);var r=$I();let a;var s=b(r);let i;var o=w(s,2),u=b(o),f=b(u),v=w(u,2);let p;var h=b(v),m=w(o,2);Fa(m,{type:"source",get position(){return _t.Right}}),se(()=>{a=jt(r,"",a,{"border-color":l(n).color}),i=jt(s,"",i,{background:l(n).color}),te(f,`Event: ${e.data.label??""}`),p=jt(v,"",p,{color:l(n).color}),te(h,l(n).label)}),C(t,r),nt()}var tP=q('<div class="binding svelte-1bgwygg"> </div>'),nP=q('<div class="binding unbound svelte-1bgwygg">unbound</div>'),rP=q('<div class="action-node svelte-1bgwygg"><!> <div class="action-header svelte-1bgwygg"><span class="icon svelte-1bgwygg"> </span> </div> <div class="action-body svelte-1bgwygg"><div class="desc svelte-1bgwygg"> </div> <!></div> <div class="action-footer svelte-1bgwygg"><button title="Edit" class="svelte-1bgwygg">âï¸ Edit</button> <button title="Delete" class="danger svelte-1bgwygg">ðï¸</button></div> <!></div>');function aP(t,e){tt(e,!0);let n=$(()=>e.data.cmd);var r=rP(),a=b(r);Fa(a,{type:"target",get position(){return _t.Left}});var s=w(a,2),i=b(s),o=b(i),u=w(i),f=w(s,2),v=b(f),p=b(v),h=w(v,2);{var m=G=>{var S=tP(),j=b(S);se(()=>te(j,`${l(n).pluginId??""}Â·${l(n).commandId??""}`)),C(G,S)},x=G=>{var S=nP();C(G,S)};pe(h,G=>{l(n).pluginId&&l(n).commandId?G(m):G(x,!1)})}var k=w(f,2),T=b(k),N=w(T,2),z=w(k,2);Fa(z,{type:"source",get position(){return _t.Right}}),se(()=>{te(o,l(n).icon||"âï¸"),te(u,` ${l(n).name??""}`),wt(v,"title",l(n).description),te(p,l(n).description)}),Ce("click",T,function(...G){var S;(S=e.data.onEdit)==null||S.apply(this,G)}),Ce("click",N,function(...G){var S;(S=e.data.onDelete)==null||S.apply(this,G)}),C(t,r),nt()}$t(["click"]);var sP=q('<button class="add-node svelte-w8wqxx" title="Add next action"><!> <div class="plus svelte-w8wqxx">+</div></button>');function iP(t,e){tt(e,!0);var n=sP(),r=b(n);Fa(r,{type:"target",get position(){return _t.Left},style:"opacity: 0"}),Ce("click",n,function(...a){var s;(s=e.data.onClick)==null||s.apply(this,a)}),C(t,n),nt()}$t(["click"]);var oP=q('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),lP=q('<span class="type-group-chip svelte-d25j4l"> </span>'),cP=q('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),uP=q("<button> </button>"),dP=q("<!> <!>",1),fP=q('<span class="picker-tile-added svelte-d25j4l">â added</span>'),vP=q('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),hP=q('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),pP=q('<div class="floating-panel picker-panel svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Add Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="action-picker svelte-d25j4l"><!> <div class="picker-custom-row svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">+ Create Custom Action</button> <span class="picker-hint svelte-d25j4l" style="margin-left: 0.5rem;">Link to any plugin command</span></div></div></div>'),gP=q("<option> </option>"),mP=q("<optgroup></optgroup>"),yP=q('<div class="floating-panel editor-panel-inner svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Edit Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-row svelte-d25j4l"><select class="plugin-select svelte-d25j4l"><option>-- Select Plugin Command --</option><!></select></div> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div></div>'),bP=q('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button></div> <div class="canvas-wrapper svelte-d25j4l"><!> <!> <!></div>',1),_P=q('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),wP=q('<p class="svelte-d25j4l">Select an event type on the left to view and edit its visual graph.</p>'),xP=q('<div class="no-selection svelte-d25j4l"><!></div>'),kP=q('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">n8n-like visual graph editor</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function SP(t,e){tt(e,!0);const n={trigger:eP,action:aP,add:iP};let r=Ae(e,"open",15,!1),a=Oe(tn([])),s=Oe(tn({})),i=Oe(tn({})),o=Oe(null),u=Oe("INFO"),f=Oe(tn([])),v=Oe(null),p=Oe(!1),h=Oe(""),m=Oe(!1),x=Oe([]),k=Oe([]);const T=[{pluginId:"gmail",pluginName:"Gmail",actions:zp("gmail")}],N={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function z(){M(a,await a_(),!0);const B={};await Promise.all(l(a).map(async ee=>{B[ee]=(await Bc(ee)).length})),M(s,B,!0),M(i,await i_(),!0),l(o)&&(M(f,(await Bc(l(o))).map(ee=>({...ee})),!0),M(u,await pl(l(o)),!0))}Nn(()=>{r()&&z()}),Nn(()=>{l(o)?G():(M(x,[]),M(k,[]))});function G(){const B=[],ee=[];B.push({id:"trigger",type:"trigger",position:{x:50,y:100},data:{label:l(o),group:l(u)}});let ne="trigger",H=300;l(f).forEach((U,le)=>{B.push({id:U.id,type:"action",position:{x:H,y:100},data:{cmd:U,onEdit:()=>K(U),onDelete:()=>A(U.id)}}),ee.push({id:`e-${ne}-${U.id}`,source:ne,target:U.id,animated:!0,style:"stroke: #666; stroke-width: 2"}),ne=U.id,H+=270}),B.push({id:"add-action",type:"add",position:{x:H,y:135},data:{onClick:()=>{M(m,!0),M(v,null)}}}),ee.push({id:`e-${ne}-add-action`,source:ne,target:"add-action",style:"stroke: #444; stroke-width: 2; stroke-dasharray: 4"}),M(x,B),M(k,ee)}async function S(B){M(o,B,!0),M(f,(await Bc(B)).map(ee=>({...ee})),!0),M(u,await pl(B),!0),M(v,null),M(m,!1)}async function j(B){l(o)&&(await s_(l(o),B),M(u,B,!0),G())}function L(B){return B.split("_").map(ee=>ee.charAt(0)+ee.slice(1).toLowerCase()).join(" ")}function D(B){return`hsl(${Hl(B)}, 55%, 55%)`}async function J(){const B=l(h).trim();if(!B)return;await o_(B),M(h,""),M(p,!1),await z();const ee=B.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await S(ee)}async function ae(){l(o)&&(await c_(l(o)),M(o,null),M(f,[],!0),await z())}async function ke(B,ee){await Hf(l(o),{id:B.actionId,pluginId:ee,commandId:B.actionId,name:B.name,description:B.description,icon:N[B.actionId]||void 0}),M(m,!1),await z()}function X(B){return l(f).some(ee=>ee.id===B)}async function A(B){await f_(l(o),B),await z()}function K(B){M(m,!1),M(v,{...B,pluginCommandKey:B.pluginId&&B.commandId?`${B.pluginId}:${B.commandId}`:""},!0)}async function P(){l(v)&&(await h_(l(o),l(v).id,{name:l(v).name,description:l(v).description,icon:l(v).icon,pluginId:l(v).pluginId,commandId:l(v).commandId}),M(v,null),await z())}function O(){M(v,null)}async function I(){const B=`custom_${Date.now()}`;await Hf(l(o),{id:B,pluginId:"",commandId:"",name:"New Custom Action",description:"",icon:"â¡"}),M(m,!1),await z();const ee=l(f).find(ne=>ne.id===B);ee&&K(ee)}var Q=cn(),W=Ye(Q);{var Z=B=>{var ee=kP(),ne=b(ee),H=b(ne),U=w(b(H),4),le=w(H,2),Y=b(le),ue=b(Y),be=w(b(ue),2),ge=w(ue,2);{var re=vt=>{var ht=oP(),je=b(ht),De=w(je,2);Ce("keydown",je,Fe=>Fe.key==="Enter"&&J()),ha(je,()=>l(h),Fe=>M(h,Fe)),Ce("click",De,J),C(vt,ht)};pe(ge,vt=>{l(p)&&vt(re)})}var Te=w(ge,2);Ct(Te,21,()=>l(a),Wt,(vt,ht)=>{var je=cP();let De;var Fe=b(je);let Ne;var Je=w(Fe,2),ut=b(Je),$e=w(Je,4);{var it=mt=>{const dt=$(()=>Lr[l(i)[l(ht)]]);var Rt=cn(),Ft=Ye(Rt);{var xt=yt=>{var bt=lP();let lt;var ze=b(bt);se(()=>{wt(bt,"title",l(dt).description),lt=jt(bt,"",lt,{color:l(dt).color}),te(ze,l(dt).label)}),C(yt,bt)};pe(Ft,yt=>{l(dt)&&yt(xt)})}C(mt,Rt)};pe($e,mt=>{l(i)[l(ht)]&&mt(it)})}var rt=w($e,2),We=b(rt);se((mt,dt)=>{De=Pt(je,1,"type-item svelte-d25j4l",null,De,{selected:l(o)===l(ht)}),Ne=jt(Fe,"",Ne,mt),te(ut,dt),te(We,l(s)[l(ht)]??0)},[()=>({background:D(l(ht))}),()=>L(l(ht))]),Ce("click",je,()=>S(l(ht))),C(vt,je)});var _e=w(Y,2),Pe=b(_e);{var He=vt=>{var ht=bP(),je=Ye(ht),De=b(je);let Fe;var Ne=b(De),Je=w(De,2),ut=b(Je),$e=w(Je,4);Ct($e,21,()=>Object.values(Lr),Wt,(xt,yt)=>{var bt=uP();let lt,ze;var Ot=b(bt);se(()=>{lt=Pt(bt,1,"group-chip svelte-d25j4l",null,lt,{active:l(u)===l(yt).id}),wt(bt,"title",l(yt).description),ze=jt(bt,"",ze,{"--grp-color":l(yt).color}),te(Ot,l(yt).label)}),Ce("click",bt,()=>j(l(yt).id)),C(xt,bt)});var it=w($e,2),rt=w(je,2),We=b(rt);MI(We,{get nodes(){return l(x)},get edges(){return l(k)},get nodeTypes(){return n},fitView:!0,fitViewOptions:{padding:.2,minZoom:.8},minZoom:.5,maxZoom:1.5,colorMode:"dark",children:(xt,yt)=>{var bt=dP(),lt=Ye(bt);JI(lt,{bgColor:"#111",patternColor:"#333"});var ze=w(lt,2);UI(ze,{showInteractive:!1}),C(xt,bt)},$$slots:{default:!0}});var mt=w(We,2);{var dt=xt=>{var yt=pP(),bt=b(yt),lt=w(b(bt),2),ze=w(bt,2),Ot=b(ze);Ct(Ot,17,()=>T,Wt,(Re,Yt)=>{var zn=hP(),ye=b(zn),un=b(ye),Cn=b(un),At=w(ye,2);Ct(At,21,()=>l(Yt).actions,Wt,(Rn,Xt)=>{const ft=$(()=>X(l(Xt).actionId));var ot=vP();let Ht;var ct=b(ot),kt=b(ct),nn=w(ct,2),an=b(nn),Dn=w(nn,2);{var Zt=en=>{var _n=fP();C(en,_n)};pe(Dn,en=>{l(ft)&&en(Zt)})}se(()=>{Ht=Pt(ot,1,"picker-tile svelte-d25j4l",null,Ht,{added:l(ft)}),wt(ot,"title",l(Xt).description),te(kt,N[l(Xt).actionId]??"Â·"),te(an,l(Xt).name)}),Ce("click",ot,()=>ke(l(Xt),l(Yt).pluginId)),C(Rn,ot)}),se(()=>te(Cn,l(Yt).pluginName)),C(Re,zn)});var Dt=w(Ot,2),zt=b(Dt);Ce("click",lt,()=>M(m,!1)),Ce("click",zt,I),C(xt,yt)};pe(mt,xt=>{l(m)&&xt(dt)})}var Rt=w(mt,2);{var Ft=xt=>{var yt=yP(),bt=b(yt),lt=w(b(bt),2),ze=w(bt,2),Ot=b(ze),Dt=b(Ot),zt=w(Dt,2),Re=w(Ot,2),Yt=w(Re,2),zn=b(Yt),ye=b(zn);ye.value=ye.__value="";var un=w(ye);Ct(un,17,()=>T,Wt,(Xt,ft)=>{var ot=mP();Ct(ot,21,()=>l(ft).actions,Wt,(Ht,ct)=>{var kt=gP(),nn=b(kt),an={};se(()=>{te(nn,`${l(ct).name??""} (${l(ct).actionId??""})`),an!==(an=`${l(ft).pluginId??""}:${l(ct).actionId??""}`)&&(kt.value=kt.__value=`${l(ft).pluginId??""}:${l(ct).actionId??""}`)}),C(Ht,kt)}),se(()=>wt(ot,"label",l(ft).pluginName)),C(Xt,ot)});var Cn=w(Yt,2),At=b(Cn),Rn=w(At,2);Ce("click",lt,O),ha(Dt,()=>l(v).icon,Xt=>l(v).icon=Xt),ha(zt,()=>l(v).name,Xt=>l(v).name=Xt),ha(Re,()=>l(v).description,Xt=>l(v).description=Xt),Ce("change",zn,Xt=>{if(Xt.target.value){const[ft,ot]=Xt.target.value.split(":");l(v).pluginId=ft,l(v).commandId=ot}else l(v).pluginId="",l(v).commandId=""}),po(zn,()=>l(v).pluginCommandKey,Xt=>l(v).pluginCommandKey=Xt),Ce("click",At,P),Ce("click",Rn,O),C(xt,yt)};pe(Rt,xt=>{l(v)&&xt(Ft)})}se((xt,yt)=>{Fe=jt(De,"",Fe,xt),te(Ne,yt),te(ut,`${l(f).length??""} action${l(f).length===1?"":"s"}`)},[()=>({background:D(l(o))}),()=>L(l(o))]),Ce("click",it,ae),C(vt,ht)},Ze=vt=>{var ht=xP(),je=b(ht);{var De=Ne=>{var Je=_P();C(Ne,Je)},Fe=Ne=>{var Je=wP();C(Ne,Je)};pe(je,Ne=>{l(a).length===0?Ne(De):Ne(Fe,!1)})}C(vt,ht)};pe(Pe,vt=>{l(o)?vt(He):vt(Ze,!1)})}Ce("click",U,()=>r(!1)),Ce("click",be,()=>M(p,!l(p))),C(B,ee)};pe(W,B=>{r()&&B(Z)})}C(t,Q),nt()}$t(["click","keydown","change"]);var EP=q('<span class="scope-chip svelte-1e15788"> </span>'),AP=q('<div class="scopes-list svelte-1e15788"></div>'),TP=q('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),CP=q('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),IP=q('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),PP=q('<div class="empty svelte-1e15788">No plugins registered.</div>'),MP=q('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function OP(t,e){tt(e,!0);let n=Ae(e,"open",15,!1);const r=$(()=>n()?di.getAllPlugins().map(h=>({id:h.pluginId,name:h.serviceName,actions:h.getHandlers().map(m=>({id:m.actionId,name:m.name,description:m.description,scopes:m.requiredScopes||[]}))})):[]),a={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},s=$(()=>l(r).reduce((h,m)=>h+m.actions.length,0));let i=Oe(tn(new Set));function o(h){const m=new Set(l(i));m.has(h)?m.delete(h):m.add(h),M(i,m,!0)}function u(h){return h.replace(/^https?:\/\/[^/]+\/auth\//,"")}var f=cn(),v=Ye(f);{var p=h=>{var m=MP(),x=b(m),k=b(x),T=b(k),N=w(b(T),2),z=w(b(N),2),G=b(z),S=w(T,2),j=w(k,2),L=b(j);Ct(L,17,()=>l(r),Wt,(X,A)=>{var K=IP(),P=b(K),O=b(P),I=b(O),Q=b(I),W=w(I,2),Z=b(W),B=w(O,2),ee=b(B),ne=w(P,2);Ct(ne,21,()=>l(A).actions,Wt,(H,U)=>{const le=$(()=>`${l(A).id}:${l(U).id}`),Y=$(()=>l(i).has(l(le)));var ue=CP(),be=b(ue),ge=b(be),re=w(be,2),Te=b(re),_e=b(Te),Pe=b(_e),He=w(_e,2),Ze=b(He),vt=w(Te,2),ht=b(vt),je=w(vt,2);{var De=Fe=>{var Ne=TP(),Je=b(Ne),ut=b(Je);{var $e=dt=>{var Rt=yn("â¾");C(dt,Rt)},it=dt=>{var Rt=yn("â¸");C(dt,Rt)};pe(ut,dt=>{l(Y)?dt($e):dt(it,!1)})}var rt=w(ut),We=w(Je,2);{var mt=dt=>{var Rt=AP();Ct(Rt,21,()=>l(U).scopes,Wt,(Ft,xt)=>{var yt=EP(),bt=b(yt);se(lt=>{wt(yt,"title",l(xt)),te(bt,lt)},[()=>u(l(xt))]),C(Ft,yt)}),C(dt,Rt)};pe(We,dt=>{l(Y)&&dt(mt)})}se(()=>te(rt,` ${l(U).scopes.length??""} scope${l(U).scopes.length===1?"":"s"}`)),Ce("click",Je,()=>o(l(le))),C(Fe,Ne)};pe(je,Fe=>{l(U).scopes.length&&Fe(De)})}se(()=>{wt(be,"title",l(U).id),te(ge,a[l(U).id]??"Â·"),te(Pe,l(U).name),te(Ze,l(U).id),te(ht,l(U).description)}),C(H,ue)}),se(()=>{te(Q,l(A).name),te(Z,l(A).id),te(ee,`${l(A).actions.length??""} action${l(A).actions.length===1?"":"s"}`)}),C(X,K)});var D=w(L,2);{var J=X=>{var A=PP();C(X,A)};pe(D,X=>{l(r).length===0&&X(J)})}var ae=w(j,2),ke=w(b(ae),2);se(()=>te(G,`${l(r).length??""} plugin${l(r).length===1?"":"s"} Â· ${l(s)??""} actions available`)),Ce("keydown",m,X=>X.key==="Escape"&&n(!1)),Ce("click",S,()=>n(!1)),Ce("click",ke,()=>n(!1)),C(h,m)};pe(v,h=>{n()&&h(p)})}C(t,f),nt()}$t(["keydown","click"]);var NP=q('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),RP=q('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),DP=q('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),LP=q('<button class="chip svelte-s2dwjj"> </button>'),jP=q('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),zP=q('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),BP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),qP=q('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),FP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),KP=q('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),HP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),VP=q('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),UP=q('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),GP=q('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),WP=q('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),YP=q('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function XP(t,e){tt(e,!0);let n=Ae(e,"groupOrder",19,()=>[]),r=Oe(!1),a=Oe(null),s=Oe(!1),i=Oe(null);async function o(){var X;const[D,J,ae]=await Promise.all([st.items.where("sourceType").equals("gmail").count(),st.emailClassifications.count(),st.contacts.count()]);let ke=0;try{const A=await((X=navigator.storage)==null?void 0:X.estimate());ke=(A==null?void 0:A.usage)??0}catch{}M(i,{emailCount:D,classCount:J,contactCount:ae,totalBytes:ke},!0)}function u(D){return D?D<1024?`${D} B`:D<1024*1024?`${(D/1024).toFixed(1)} KB`:`${(D/(1024*1024)).toFixed(1)} MB`:"â"}function f(){M(r,!l(r)),l(r)&&o()}async function v(D){var J;M(s,!0),M(a,null);try{await D(),await o(),(J=e.onrefresh)==null||J.call(e)}finally{M(s,!1)}}async function p(){await v(()=>Vf())}async function h(D){await v(()=>bd(D))}async function m(){await v(async()=>{await Fp(),await Vf()})}async function x(){await v(()=>st.contacts.clear())}async function k(){await v(async()=>{await st.delete(),window.location.reload()})}function T(D){return D.split("_").map(J=>J.charAt(0)+J.slice(1).toLowerCase()).join(" ")}var N=YP(),z=b(N),G=w(b(z),2);let S;var j=w(z,2);{var L=D=>{var J=WP(),ae=b(J);{var ke=re=>{var Te=RP(),_e=b(Te),Pe=b(_e),He=w(_e,4),Ze=b(He),vt=w(He,4),ht=b(vt),je=w(vt,2);{var De=Fe=>{var Ne=NP(),Je=w(Ye(Ne),2),ut=b(Je);se($e=>te(ut,`${$e??""} used`),[()=>u(l(i).totalBytes)]),C(Fe,Ne)};pe(je,Fe=>{l(i).totalBytes&&Fe(De)})}se(()=>{te(Pe,`${l(i).emailCount??""} emails`),te(Ze,`${l(i).classCount??""} classifications`),te(ht,`${l(i).contactCount??""} contacts`)}),C(re,Te)};pe(ae,re=>{l(i)&&re(ke)})}var X=w(ae,2);{var A=re=>{var Te=jP(),_e=w(b(Te),2);Ct(_e,21,n,Wt,(Pe,He)=>{var Ze=cn(),vt=Ye(Ze);{var ht=De=>{var Fe=DP(),Ne=b(Fe),Je=w(Ne),ut=w(Je,2);se($e=>{te(Ne,`Delete ${$e??""}? `),ut.disabled=l(s)},[()=>T(l(He))]),Ce("click",Je,()=>M(a,null)),Ce("click",ut,()=>h(l(He))),C(De,Fe)},je=De=>{var Fe=LP(),Ne=b(Fe);se(Je=>{Fe.disabled=l(s),te(Ne,`${Je??""} â`)},[()=>T(l(He))]),Ce("click",Fe,()=>M(a,`group:${l(He)}`)),C(De,Fe)};pe(vt,De=>{l(a)===`group:${l(He)}`?De(ht):De(je,!1)})}C(Pe,Ze)}),C(re,Te)};pe(X,re=>{n().length>0&&re(A)})}var K=w(X,2),P=w(b(K),2),O=b(P);{var I=re=>{var Te=zP(),_e=w(b(Te),2),Pe=w(_e,2);se(()=>Pe.disabled=l(s)),Ce("click",_e,()=>M(a,null)),Ce("click",Pe,p),C(re,Te)},Q=re=>{var Te=BP();se(()=>Te.disabled=l(s)),Ce("click",Te,()=>M(a,"classifications")),C(re,Te)};pe(O,re=>{l(a)==="classifications"?re(I):re(Q,!1)})}var W=w(O,2);{var Z=re=>{var Te=qP(),_e=w(b(Te),2),Pe=w(_e,2);se(()=>Pe.disabled=l(s)),Ce("click",_e,()=>M(a,null)),Ce("click",Pe,m),C(re,Te)},B=re=>{var Te=FP();se(()=>Te.disabled=l(s)),Ce("click",Te,()=>M(a,"emails")),C(re,Te)};pe(W,re=>{l(a)==="emails"?re(Z):re(B,!1)})}var ee=w(W,2);{var ne=re=>{var Te=KP(),_e=w(b(Te),2),Pe=w(_e,2);se(()=>Pe.disabled=l(s)),Ce("click",_e,()=>M(a,null)),Ce("click",Pe,x),C(re,Te)},H=re=>{var Te=HP();se(()=>Te.disabled=l(s)),Ce("click",Te,()=>M(a,"contacts")),C(re,Te)};pe(ee,re=>{l(a)==="contacts"?re(ne):re(H,!1)})}var U=w(K,2),le=b(U);{var Y=re=>{var Te=VP(),_e=w(b(Te),2),Pe=w(_e,2);se(()=>Pe.disabled=l(s)),Ce("click",_e,()=>M(a,null)),Ce("click",Pe,k),C(re,Te)},ue=re=>{var Te=UP();se(()=>Te.disabled=l(s)),Ce("click",Te,()=>M(a,"nuke")),C(re,Te)};pe(le,re=>{l(a)==="nuke"?re(Y):re(ue,!1)})}var be=w(U,2);{var ge=re=>{var Te=GP();C(re,Te)};pe(be,re=>{l(s)&&re(ge)})}C(D,J)};pe(j,D=>{l(r)&&D(L)})}se(()=>S=Pt(G,0,"chev svelte-s2dwjj",null,S,{open:l(r)})),Ce("click",z,f),C(t,N),nt()}$t(["click"]);var ZP=q('<div class="error-card svelte-aym646"><span> </span> <button class="error-dismiss svelte-aym646">â</button></div>'),QP=q('<div class="success-card svelte-aym646"><span> </span> <button class="success-dismiss svelte-aym646">â</button></div>'),JP=q('<div class="groups-list svelte-aym646"></div> <div class="actions-footer svelte-aym646"><span class="footer-stat svelte-aym646"> </span></div>',1),$P=q('<div class="empty-state svelte-aym646"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-aym646">No emails classified yet</h3> <p class="svelte-aym646">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),e3=q('<div class="actions-container svelte-aym646"><!> <!> <!> <!> <div class="toolbar svelte-aym646"><button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!> <!></div>');function t3(t,e){tt(e,!0);let n=Ae(e,"groups",19,()=>({})),r=Ae(e,"groupOrder",19,()=>[]),a=Ae(e,"counts",19,()=>({})),s=Ae(e,"stats",3,null),i=Ae(e,"expandedGroup",3,null),o=Ae(e,"isScanning",3,!1),u=Ae(e,"scanProgress",3,null),f=Ae(e,"scanCount",15,20),v=Ae(e,"error",3,null),p=Ae(e,"successMsg",3,null),h=Oe(!1),m=Oe(!1),x=Oe(!1),k=$(()=>{for(const I of r()){const Q=n()[I];if((Q==null?void 0:Q.length)>0)return Q[0]}return null});var T=e3(),N=b(T);o2(N,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return o()},get scanProgress(){return u()},get stats(){return s()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>M(h,!0),get scanCount(){return f()},set scanCount(I){f(I)}});var z=w(N,2);M2(z,{get sampleEmail(){return l(k)},get open(){return l(h)},set open(I){M(h,I,!0)}});var G=w(z,2);SP(G,{get open(){return l(m)},set open(I){M(m,I,!0)}});var S=w(G,2);OP(S,{get open(){return l(x)},set open(I){M(x,I,!0)}});var j=w(S,2),L=b(j),D=w(L,2),J=w(j,2);{var ae=I=>{var Q=ZP(),W=b(Q),Z=b(W),B=w(W,2);se(()=>te(Z,v())),Ce("click",B,function(...ee){var ne;(ne=e.ondismisserror)==null||ne.apply(this,ee)}),C(I,Q)};pe(J,I=>{v()&&I(ae)})}var ke=w(J,2);{var X=I=>{var Q=QP(),W=b(Q),Z=b(W),B=w(W,2);se(()=>te(Z,p())),Ce("click",B,function(...ee){var ne;(ne=e.ondismisssuccess)==null||ne.apply(this,ee)}),C(I,Q)};pe(ke,I=>{p()&&I(X)})}var A=w(ke,2);{var K=I=>{var Q=JP(),W=Ye(Q);Ct(W,20,r,ne=>ne,(ne,H)=>{{let U=$(()=>Eu(H)),le=$(()=>{var be;return((be=n()[H])==null?void 0:be.length)||0}),Y=$(()=>n()[H]||[]),ue=$(()=>i()===H);A2(ne,{get action(){return H},get color(){return l(U)},get count(){return l(le)},get items(){return l(Y)},get expanded(){return l(ue)},ontoggle:()=>e.ontogglegroup(H),onexecute:be=>e.onexecute(H,be),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(H)})}});var Z=w(W,2),B=b(Z),ee=b(B);se(()=>te(ee,`${a().total??""} emails classified into ${r().length??""} groups`)),C(I,Q)},P=I=>{var Q=$P();C(I,Q)};pe(A,I=>{a().total>0?I(K):o()||I(P,1)})}var O=w(A,2);XP(O,{get groupOrder(){return r()},get onrefresh(){return e.onrefresh}}),Ce("click",L,()=>M(x,!0)),Ce("click",D,()=>M(m,!0)),C(t,T),nt()}$t(["click"]);var n3=q('<div class="control-board-page svelte-v2lwbo"><!></div>');function r3(t,e){tt(e,!0);const n=hp();let r=Oe(tn(n.status)),a=Oe(""),s=Oe(tn({})),i=Oe(tn([])),o=Oe(tn({total:0})),u=Oe(null),f=Oe(null),v=Oe(!1),p=Oe(null),h=Oe(3),m=Oe(null),x=Oe(null),k=Oe(null);const T="me-ai-scan-history";async function N(){return await Vi(T)}async function z(I){!I||I.phase!=="done"||await Ui(T,{timestamp:Date.now(),classified:I.classified||0,errors:I.errors||0,total:I.total||0,totals:I.totals||{},summary:I.summary||{}})}Tn(async()=>{const I=n.onMessage(W=>{if(W.status==="ready"){M(r,"ready");const Z=Zr.find(ne=>ne.id===n.modelId),B=Qr.find(ne=>ne.name===n.modelId),ee=Z||B;M(a,(ee==null?void 0:ee.name)||(ee==null?void 0:ee.displayName)||n.modelId||"",!0)}W.status==="loading"&&M(r,"loading")});if(M(r,n.status,!0),n.modelId){const W=Zr.find(ee=>ee.id===n.modelId),Z=Qr.find(ee=>ee.name===n.modelId),B=W||Z;M(a,(B==null?void 0:B.name)||(B==null?void 0:B.displayName)||n.modelId||"",!0)}const Q=await N();return Q&&M(p,{phase:"done",...Q},!0),G(),()=>I()});async function G(){try{const I=await Op();M(s,I.groups,!0),M(i,I.order,!0),M(o,await A_(),!0),M(u,await Su(),!0)}catch(I){M(m,`Failed to load data: ${I.message}`)}}async function S(){await L(!1)}async function j(){await L(!0)}async function L(I){if(l(v)||!n.isReady)return;M(m,null),M(x,null),M(v,!0),M(p,null);const Q=new AbortController;M(k,Q,!0);try{await Mp(n,{count:l(h),force:I,signal:Q.signal,onProgress:W=>{M(p,{...W},!0),W.phase==="done"&&z(W)}}),await G()}catch(W){Q.signal.aborted||M(m,`Scan failed: ${W.message}`)}finally{M(v,!1),M(k,null)}}function D(){var I;(I=l(k))==null||I.abort()}async function J(I){await gl(I,"acted"),await G()}async function ae(I,Q){const{executePipeline:W,isAuthenticated:Z}=await nr(async()=>{const{executePipeline:B,isAuthenticated:ee}=await Promise.resolve().then(()=>j0);return{executePipeline:B,isAuthenticated:ee}},void 0,import.meta.url);if(!await Z()){alert("Please sign in to Gmail first (Dashboard page)");return}try{const ee=await W({type:I,source:"gmail",data:Q},ne=>{console.log("Pipeline progress:",ne)},!0);ee.success?(M(x,ee.message,!0),M(m,null),await J(Q.emailId)):(M(m,`Execution failed: ${ee.message}`),M(x,null))}catch(B){M(m,`Execution error: ${B.message}`),M(x,null)}}async function ke(I){await gl(I,"dismissed"),await G()}async function X(I){await Np(I),await G()}async function A(I){await bd(I),await G()}function K(I){M(f,l(f)===I?null:I,!0)}var P=n3(),O=b(P);t3(O,{get engineStatus(){return l(r)},get modelName(){return l(a)},get groups(){return l(s)},get groupOrder(){return l(i)},get counts(){return l(o)},get stats(){return l(u)},get expandedGroup(){return l(f)},get isScanning(){return l(v)},get scanProgress(){return l(p)},get error(){return l(m)},get successMsg(){return l(x)},onscan:S,onrescan:j,ontogglegroup:K,onexecute:ae,onmarkacted:J,ondismiss:ke,onremove:X,oncleargroup:A,ondismisserror:()=>M(m,null),ondismisssuccess:()=>M(x,null),onstop:D,onrefresh:G,oncloseprogress:async()=>{M(p,null),await fd(T)},get scanCount(){return l(h)},set scanCount(I){M(h,I,!0)}}),C(t,P),nt()}var a3=q('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#control">Control Board</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function s3(t,e){tt(e,!0);function n(){const D=location.hash;return D==="#dashboard"?"dashboard":D==="#control"?"control":"chat"}let r=Oe(tn(n()));Tn(()=>{function D(){M(r,n(),!0)}return window.addEventListener("hashchange",D),()=>window.removeEventListener("hashchange",D)});var a=a3(),s=b(a),i=w(b(s),2),o=b(i);let u;var f=w(o,2);let v;var p=w(f,2);let h;var m=w(s,2),x=b(m);let k;var T=b(x);e1(T,{});var N=w(x,2);let z;var G=b(N);r3(G,{});var S=w(N,2);let j;var L=b(S);Mk(L,{}),se(()=>{u=Pt(o,1,"svelte-1n46o8q",null,u,{active:l(r)==="chat"}),v=Pt(f,1,"svelte-1n46o8q",null,v,{active:l(r)==="control"}),h=Pt(p,1,"svelte-1n46o8q",null,h,{active:l(r)==="dashboard"}),k=jt(x,"",k,{display:l(r)==="chat"?"flex":"none"}),z=jt(N,"",z,{display:l(r)==="control"?"flex":"none"}),j=jt(S,"",j,{display:l(r)==="dashboard"?"flex":"none"})}),C(t,a),nt()}eb(s3,{target:document.getElementById("app")});
