var Pm=Object.defineProperty;var wf=t=>{throw TypeError(t)};var Mm=(t,e,n)=>e in t?Pm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ht=(t,e,n)=>Mm(t,typeof e!="symbol"?e+"":e,n),Pc=(t,e,n)=>e.has(t)||wf("Cannot "+n);var B=(t,e,n)=>(Pc(t,e,"read from private field"),n?n.call(t):e.get(t)),Pe=(t,e,n)=>e.has(t)?wf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),xt=(t,e,n,r)=>(Pc(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Tn=(t,e,n)=>(Pc(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const ru=!1;var zl=Array.isArray,Om=Array.prototype.indexOf,Zs=Array.prototype.includes,jl=Array.from,Nm=Object.defineProperty,Na=Object.getOwnPropertyDescriptor,th=Object.getOwnPropertyDescriptors,nh=Object.prototype,Rm=Array.prototype,Bl=Object.getPrototypeOf,xf=Object.isExtensible;function wi(t){return typeof t=="function"}const bs=()=>{};function Dm(t){return t()}function au(t){for(var e=0;e<t.length;e++)t[e]()}function rh(){var t,e,n=new Promise((r,a)=>{t=r,e=a});return{promise:n,resolve:t,reject:e}}function Bn(t,e,n=!1){return t===void 0?n?e():e:t}function io(t,e){if(Array.isArray(t))return t;if(e===void 0||!(Symbol.iterator in t))return Array.from(t);const n=[];for(const r of t)if(n.push(r),n.length===e)break;return n}const Pn=2,Ki=4,oo=8,Wu=1<<24,ba=16,Rr=32,Fa=64,ah=128,pr=512,xn=1024,Mn=2048,Or=4096,lr=8192,ga=16384,lo=32768,za=65536,kf=1<<17,sh=1<<18,ws=1<<19,ih=1<<20,fa=1<<25,ds=65536,su=1<<21,Yu=1<<22,Ra=1<<23,Gr=Symbol("$state"),oh=Symbol("legacy props"),Lm=Symbol(""),Ja=new class extends Error{constructor(){super(...arguments);ht(this,"name","StaleReactionError");ht(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};var Qv;const lh=((Qv=globalThis.document)==null?void 0:Qv.contentType.includes("xml"))??!1;function Xu(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function zm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function jm(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function Bm(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function qm(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Fm(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Km(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Hm(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Vm(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Um(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Gm(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Wm(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Ym=1,Xm=2,ch=4,Zm=8,Qm=16,Jm=1,$m=2,ey=4,ty=8,ny=16,uh=1,ry=2,wn=Symbol(),dh="http://www.w3.org/1999/xhtml",ay="@attach";function sy(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function iy(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function fh(t){return t===this.v}function vh(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function hh(t){return!vh(t,this.v)}let oi=!1,oy=!1;function ly(){oi=!0}const cy=[];function ph(t,e=!1,n=!1){return $o(t,new Map,"",cy,null,n)}function $o(t,e,n,r,a=null,s=!1){if(typeof t=="object"&&t!==null){var i=e.get(t);if(i!==void 0)return i;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(zl(t)){var l=Array(t.length);e.set(t,l),a!==null&&e.set(a,l);for(var u=0;u<t.length;u+=1){var f=t[u];u in t&&(l[u]=$o(f,e,n,r,null,s))}return l}if(Bl(t)===nh){l={},e.set(t,l),a!==null&&e.set(a,l);for(var v in t)l[v]=$o(t[v],e,n,r,null,s);return l}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return $o(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let nn=null;function Qs(t){nn=t}function Zu(t){return Qu().get(t)}function gh(t,e){return Qu().set(t,e),e}function uy(t){return Qu().has(t)}function et(t,e=!1,n){nn={p:nn,i:!1,c:null,e:null,s:t,x:null,l:oi&&!e?{s:null,u:null,$:[]}:null}}function tt(t){var e=nn,n=e.e;if(n!==null){e.e=null;for(var r of n)jh(r)}return t!==void 0&&(e.x=t),e.i=!0,nn=e.p,t??{}}function co(){return!oi||nn!==null&&nn.l===null}function Qu(t){return nn===null&&Xu(),nn.c??(nn.c=new Map(dy(nn)||void 0))}function dy(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let $a=[];function mh(){var t=$a;$a=[],au(t)}function Wr(t){if($a.length===0&&!Li){var e=$a;queueMicrotask(()=>{e===$a&&mh()})}$a.push(t)}function fy(){for(;$a.length>0;)mh()}function yh(t){var e=Zt;if(e===null)return Ot.f|=Ra,t;if((e.f&lo)===0&&(e.f&Ki)===0)throw t;Js(t,e)}function Js(t,e){for(;e!==null;){if((e.f&ah)!==0){if((e.f&lo)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const vy=-7169;function gn(t,e){t.f=t.f&vy|e}function Ju(t){(t.f&pr)!==0||t.deps===null?gn(t,xn):gn(t,Or)}function _h(t){if(t!==null)for(const e of t)(e.f&Pn)===0||(e.f&ds)===0||(e.f^=ds,_h(e.deps))}function bh(t,e,n){(t.f&Mn)!==0?e.add(t):(t.f&Or)!==0&&n.add(t),_h(t.deps),gn(t,xn)}const jo=new Set;let At=null,dl=null,Cn=null,Zn=[],ql=null,iu=!1,Li=!1;var Ks,Hs,ns,Vs,$i,eo,rs,oa,Us,ea,ou,lu,wh;const Gd=class Gd{constructor(){Pe(this,ea);ht(this,"committed",!1);ht(this,"current",new Map);ht(this,"previous",new Map);Pe(this,Ks,new Set);Pe(this,Hs,new Set);Pe(this,ns,0);Pe(this,Vs,0);Pe(this,$i,null);Pe(this,eo,new Set);Pe(this,rs,new Set);Pe(this,oa,new Map);ht(this,"is_fork",!1);Pe(this,Us,!1)}is_deferred(){return this.is_fork||B(this,Vs)>0}skip_effect(e){B(this,oa).has(e)||B(this,oa).set(e,{d:[],m:[]})}unskip_effect(e){var n=B(this,oa).get(e);if(n){B(this,oa).delete(e);for(var r of n.d)gn(r,Mn),Ir(r);for(r of n.m)gn(r,Or),Ir(r)}}process(e){var a;Zn=[],this.apply();var n=[],r=[];for(const s of e)Tn(this,ea,ou).call(this,s,n,r);if(this.is_deferred()){Tn(this,ea,lu).call(this,r),Tn(this,ea,lu).call(this,n);for(const[s,i]of B(this,oa))Eh(s,i)}else{for(const s of B(this,Ks))s();B(this,Ks).clear(),B(this,ns)===0&&Tn(this,ea,wh).call(this),dl=this,At=null,Sf(r),Sf(n),dl=null,(a=B(this,$i))==null||a.resolve()}Cn=null}capture(e,n){n!==wn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Ra)===0&&(this.current.set(e,e.v),Cn==null||Cn.set(e,e.v))}activate(){At=this,this.apply()}deactivate(){At===this&&(At=null,Cn=null)}flush(){if(this.activate(),Zn.length>0){if(xh(),At!==null&&At!==this)return}else B(this,ns)===0&&this.process([]);this.deactivate()}discard(){for(const e of B(this,Hs))e(this);B(this,Hs).clear()}increment(e){xt(this,ns,B(this,ns)+1),e&&xt(this,Vs,B(this,Vs)+1)}decrement(e){xt(this,ns,B(this,ns)-1),e&&xt(this,Vs,B(this,Vs)-1),!B(this,Us)&&(xt(this,Us,!0),Wr(()=>{xt(this,Us,!1),this.is_deferred()?Zn.length>0&&this.flush():this.revive()}))}revive(){for(const e of B(this,eo))B(this,rs).delete(e),gn(e,Mn),Ir(e);for(const e of B(this,rs))gn(e,Or),Ir(e);this.flush()}oncommit(e){B(this,Ks).add(e)}ondiscard(e){B(this,Hs).add(e)}settled(){return(B(this,$i)??xt(this,$i,rh())).promise}static ensure(){if(At===null){const e=At=new Gd;jo.add(At),Li||Wr(()=>{At===e&&e.flush()})}return At}apply(){}};Ks=new WeakMap,Hs=new WeakMap,ns=new WeakMap,Vs=new WeakMap,$i=new WeakMap,eo=new WeakMap,rs=new WeakMap,oa=new WeakMap,Us=new WeakMap,ea=new WeakSet,ou=function(e,n,r){e.f^=xn;for(var a=e.first,s=null;a!==null;){var i=a.f,l=(i&(Rr|Fa))!==0,u=l&&(i&xn)!==0,f=u||(i&lr)!==0||B(this,oa).has(a);if(!f&&a.fn!==null){l?a.f^=xn:s!==null&&(i&(Ki|oo|Wu))!==0?s.b.defer_effect(a):(i&Ki)!==0?n.push(a):ho(a)&&((i&ba)!==0&&B(this,rs).add(a),ei(a));var v=a.first;if(v!==null){a=v;continue}}var p=a.parent;for(a=a.next;a===null&&p!==null;)p===s&&(s=null),a=p.next,p=p.parent}},lu=function(e){for(var n=0;n<e.length;n+=1)bh(e[n],B(this,eo),B(this,rs))},wh=function(){var a;if(jo.size>1){this.previous.clear();var e=Cn,n=!0;for(const s of jo){if(s===this){n=!1;continue}const i=[];for(const[u,f]of this.current){if(s.current.has(u))if(n&&f!==s.current.get(u))s.current.set(u,f);else continue;i.push(u)}if(i.length===0)continue;const l=[...s.current.keys()].filter(u=>!this.current.has(u));if(l.length>0){var r=Zn;Zn=[];const u=new Set,f=new Map;for(const v of i)kh(v,l,u,f);if(Zn.length>0){At=s,s.apply();for(const v of Zn)Tn(a=s,ea,ou).call(a,v,[],[]);s.deactivate()}Zn=r}}At=null,Cn=e}this.committed=!0,jo.delete(this)};let ma=Gd;function hy(t){var e=Li;Li=!0;try{for(var n;;){if(fy(),Zn.length===0&&(At==null||At.flush(),Zn.length===0))return ql=null,n;xh()}}finally{Li=e}}function xh(){iu=!0;var t=null;try{for(var e=0;Zn.length>0;){var n=ma.ensure();if(e++>1e3){var r,a;py()}n.process(Zn),Da.clear()}}finally{Zn=[],iu=!1,ql=null}}function py(){try{Km()}catch(t){Js(t,ql)}}let xr=null;function Sf(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(ga|lr))===0&&ho(r)&&(xr=new Set,ei(r),r.deps===null&&r.first===null&&r.nodes===null&&r.teardown===null&&r.ac===null&&Vh(r),(xr==null?void 0:xr.size)>0)){Da.clear();for(const a of xr){if((a.f&(ga|lr))!==0)continue;const s=[a];let i=a.parent;for(;i!==null;)xr.has(i)&&(xr.delete(i),s.push(i)),i=i.parent;for(let l=s.length-1;l>=0;l--){const u=s[l];(u.f&(ga|lr))===0&&ei(u)}}xr.clear()}}xr=null}}function kh(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const a of t.reactions){const s=a.f;(s&Pn)!==0?kh(a,e,n,r):(s&(Yu|ba))!==0&&(s&Mn)===0&&Sh(a,e,r)&&(gn(a,Mn),Ir(a))}}function Sh(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const a of t.deps){if(Zs.call(e,a))return!0;if((a.f&Pn)!==0&&Sh(a,e,n))return n.set(a,!0),!0}return n.set(t,!1),!1}function Ir(t){for(var e=ql=t;e.parent!==null;){e=e.parent;var n=e.f;if(iu&&e===Zt&&(n&ba)!==0&&(n&sh)===0)return;if((n&(Fa|Rr))!==0){if((n&xn)===0)return;e.f^=xn}}Zn.push(e)}function Eh(t,e){if(!((t.f&Rr)!==0&&(t.f&xn)!==0)){(t.f&Mn)!==0?e.d.push(t):(t.f&Or)!==0&&e.m.push(t),gn(t,xn);for(var n=t.first;n!==null;)Eh(n,e),n=n.next}}function Ah(t){let e=0,n=fs(0),r;return()=>{td()&&(o(n),Kl(()=>(e===0&&(r=$n(()=>t(()=>zi(n)))),e+=1,()=>{Wr(()=>{e-=1,e===0&&(r==null||r(),r=void 0,zi(n))})})))}}var gy=za|ws|ah;function my(t,e,n){new yy(t,e,n)}var vr,Gu,Fr,as,Kr,hr,Wn,Hr,la,Pa,ss,Ma,Gs,is,Ws,Ys,ca,Nl,Sn,_y,by,cu,el,tl,uu;class yy{constructor(e,n,r){Pe(this,Sn);ht(this,"parent");ht(this,"is_pending",!1);Pe(this,vr);Pe(this,Gu,null);Pe(this,Fr);Pe(this,as);Pe(this,Kr);Pe(this,hr,null);Pe(this,Wn,null);Pe(this,Hr,null);Pe(this,la,null);Pe(this,Pa,null);Pe(this,ss,0);Pe(this,Ma,0);Pe(this,Gs,!1);Pe(this,is,!1);Pe(this,Ws,new Set);Pe(this,Ys,new Set);Pe(this,ca,null);Pe(this,Nl,Ah(()=>(xt(this,ca,fs(B(this,ss))),()=>{xt(this,ca,null)})));xt(this,vr,e),xt(this,Fr,n),xt(this,as,r),this.parent=Zt.b,this.is_pending=!!B(this,Fr).pending,xt(this,Kr,vo(()=>{Zt.b=this;{var a=Tn(this,Sn,cu).call(this);try{xt(this,hr,Jn(()=>r(a)))}catch(s){this.error(s)}B(this,Ma)>0?Tn(this,Sn,tl).call(this):this.is_pending=!1}return()=>{var s;(s=B(this,Pa))==null||s.remove()}},gy))}defer_effect(e){bh(e,B(this,Ws),B(this,Ys))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!B(this,Fr).pending}update_pending_count(e){Tn(this,Sn,uu).call(this,e),xt(this,ss,B(this,ss)+e),!(!B(this,ca)||B(this,Gs))&&(xt(this,Gs,!0),Wr(()=>{xt(this,Gs,!1),B(this,ca)&&$s(B(this,ca),B(this,ss))}))}get_effect_pending(){return B(this,Nl).call(this),o(B(this,ca))}error(e){var n=B(this,Fr).onerror;let r=B(this,Fr).failed;if(B(this,is)||!n&&!r)throw e;B(this,hr)&&(kn(B(this,hr)),xt(this,hr,null)),B(this,Wn)&&(kn(B(this,Wn)),xt(this,Wn,null)),B(this,Hr)&&(kn(B(this,Hr)),xt(this,Hr,null));var a=!1,s=!1;const i=()=>{if(a){iy();return}a=!0,s&&Wm(),ma.ensure(),xt(this,ss,0),B(this,Hr)!==null&&ls(B(this,Hr),()=>{xt(this,Hr,null)}),this.is_pending=this.has_pending_snippet(),xt(this,hr,Tn(this,Sn,el).call(this,()=>(xt(this,is,!1),Jn(()=>B(this,as).call(this,B(this,vr)))))),B(this,Ma)>0?Tn(this,Sn,tl).call(this):this.is_pending=!1};Wr(()=>{try{s=!0,n==null||n(e,i),s=!1}catch(l){Js(l,B(this,Kr)&&B(this,Kr).parent)}r&&xt(this,Hr,Tn(this,Sn,el).call(this,()=>{ma.ensure(),xt(this,is,!0);try{return Jn(()=>{r(B(this,vr),()=>e,()=>i)})}catch(l){return Js(l,B(this,Kr).parent),null}finally{xt(this,is,!1)}}))})}}vr=new WeakMap,Gu=new WeakMap,Fr=new WeakMap,as=new WeakMap,Kr=new WeakMap,hr=new WeakMap,Wn=new WeakMap,Hr=new WeakMap,la=new WeakMap,Pa=new WeakMap,ss=new WeakMap,Ma=new WeakMap,Gs=new WeakMap,is=new WeakMap,Ws=new WeakMap,Ys=new WeakMap,ca=new WeakMap,Nl=new WeakMap,Sn=new WeakSet,_y=function(){try{xt(this,hr,Jn(()=>B(this,as).call(this,B(this,vr))))}catch(e){this.error(e)}},by=function(){const e=B(this,Fr).pending;e&&(xt(this,Wn,Jn(()=>e(B(this,vr)))),Wr(()=>{var n=Tn(this,Sn,cu).call(this);xt(this,hr,Tn(this,Sn,el).call(this,()=>(ma.ensure(),Jn(()=>B(this,as).call(this,n))))),B(this,Ma)>0?Tn(this,Sn,tl).call(this):(ls(B(this,Wn),()=>{xt(this,Wn,null)}),this.is_pending=!1)}))},cu=function(){var e=B(this,vr);return this.is_pending&&(xt(this,Pa,ya()),B(this,vr).before(B(this,Pa)),e=B(this,Pa)),e},el=function(e){var n=Zt,r=Ot,a=nn;Qr(B(this,Kr)),yr(B(this,Kr)),Qs(B(this,Kr).ctx);try{return e()}catch(s){return yh(s),null}finally{Qr(n),yr(r),Qs(a)}},tl=function(){const e=B(this,Fr).pending;B(this,hr)!==null&&(xt(this,la,document.createDocumentFragment()),B(this,la).append(B(this,Pa)),Wh(B(this,hr),B(this,la))),B(this,Wn)===null&&xt(this,Wn,Jn(()=>e(B(this,vr))))},uu=function(e){var n;if(!this.has_pending_snippet()){this.parent&&Tn(n=this.parent,Sn,uu).call(n,e);return}if(xt(this,Ma,B(this,Ma)+e),B(this,Ma)===0){this.is_pending=!1;for(const r of B(this,Ws))gn(r,Mn),Ir(r);for(const r of B(this,Ys))gn(r,Or),Ir(r);B(this,Ws).clear(),B(this,Ys).clear(),B(this,Wn)&&ls(B(this,Wn),()=>{xt(this,Wn,null)}),B(this,la)&&(B(this,vr).before(B(this,la)),xt(this,la,null))}};function Th(t,e,n,r){const a=co()?uo:$u;var s=t.filter(h=>!h.settled);if(n.length===0&&s.length===0){r(e.map(a));return}var i=At,l=Zt,u=wy(),f=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(h=>h.promise)):null;function v(h){u();try{r(h)}catch(m){(l.f&ga)===0&&Js(m,l)}i==null||i.deactivate(),du()}if(n.length===0){f.then(()=>v(e.map(a)));return}function p(){u(),Promise.all(n.map(h=>xy(h))).then(h=>v([...e.map(a),...h])).catch(h=>Js(h,l))}f?f.then(p):p()}function wy(){var t=Zt,e=Ot,n=nn,r=At;return function(s=!0){Qr(t),yr(e),Qs(n),s&&(r==null||r.activate())}}function du(){Qr(null),yr(null),Qs(null)}function uo(t){var e=Pn|Mn,n=Ot!==null&&(Ot.f&Pn)!==0?Ot:null;return Zt!==null&&(Zt.f|=ws),{ctx:nn,deps:null,effects:null,equals:fh,f:e,fn:t,reactions:null,rv:0,v:wn,wv:0,parent:n??Zt,ac:null}}function xy(t,e,n){let r=Zt;r===null&&zm();var a=r.b,s=void 0,i=fs(wn),l=!Ot,u=new Map;return Ly(()=>{var m;var f=rh();s=f.promise;try{Promise.resolve(t()).then(f.resolve,f.reject).then(()=>{v===At&&v.committed&&v.deactivate(),du()})}catch(x){f.reject(x),du()}var v=At;if(l){var p=a.is_rendered();a.update_pending_count(1),v.increment(p),(m=u.get(v))==null||m.reject(Ja),u.delete(v),u.set(v,f)}const h=(x,k=void 0)=>{if(v.activate(),k)k!==Ja&&(i.f|=Ra,$s(i,k));else{(i.f&Ra)!==0&&(i.f^=Ra),$s(i,x);for(const[A,D]of u){if(u.delete(A),A===v)break;D.reject(Ja)}}l&&(a.update_pending_count(-1),v.decrement(p))};f.promise.then(h,x=>h(null,x||"unknown"))}),nd(()=>{for(const f of u.values())f.reject(Ja)}),new Promise(f=>{function v(p){function h(){p===s?f(i):v(s)}p.then(h,h)}v(s)})}function $(t){const e=uo(t);return Yh(e),e}function $u(t){const e=uo(t);return e.equals=hh,e}function ky(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)kn(e[n])}}function Sy(t){for(var e=t.parent;e!==null;){if((e.f&Pn)===0)return(e.f&ga)===0?e:null;e=e.parent}return null}function ed(t){var e,n=Zt;Qr(Sy(t));try{t.f&=~ds,ky(t),e=Jh(t)}finally{Qr(n)}return e}function Ch(t){var e=ed(t);if(!t.equals(e)&&(t.wv=Zh(),(!(At!=null&&At.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){gn(t,xn);return}ja||(Cn!==null?(td()||At!=null&&At.is_fork)&&Cn.set(t,e):Ju(t))}function Ey(t){var e,n;if(t.effects!==null)for(const r of t.effects)(r.teardown||r.ac)&&((e=r.teardown)==null||e.call(r),(n=r.ac)==null||n.abort(Ja),r.teardown=bs,r.ac=null,Hi(r,0),rd(r))}function Ih(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&ei(e)}let fu=new Set;const Da=new Map;let Ph=!1;function fs(t,e){var n={f:0,v:t,reactions:null,equals:fh,rv:0,wv:0};return n}function Me(t,e){const n=fs(t);return Yh(n),n}function Ay(t,e=!1,n=!0){var a;const r=fs(t);return e||(r.equals=hh),oi&&n&&nn!==null&&nn.l!==null&&((a=nn.l).s??(a.s=[])).push(r),r}function M(t,e,n=!1){Ot!==null&&(!Pr||(Ot.f&kf)!==0)&&co()&&(Ot.f&(Pn|ba|Yu|kf))!==0&&(gr===null||!Zs.call(gr,t))&&Gm();let r=n?en(e):e;return $s(t,r)}function $s(t,e){if(!t.equals(e)){var n=t.v;ja?Da.set(t,e):Da.set(t,n),t.v=e;var r=ma.ensure();if(r.capture(t,n),(t.f&Pn)!==0){const a=t;(t.f&Mn)!==0&&ed(a),Ju(a)}t.wv=Zh(),Mh(t,Mn),co()&&Zt!==null&&(Zt.f&xn)!==0&&(Zt.f&(Rr|Fa))===0&&(fr===null?jy([t]):fr.push(t)),!r.is_fork&&fu.size>0&&!Ph&&Ty()}return e}function Ty(){Ph=!1;for(const t of fu)(t.f&xn)!==0&&gn(t,Or),ho(t)&&ei(t);fu.clear()}function zi(t){M(t,t.v+1)}function Mh(t,e){var n=t.reactions;if(n!==null)for(var r=co(),a=n.length,s=0;s<a;s++){var i=n[s],l=i.f;if(!(!r&&i===Zt)){var u=(l&Mn)===0;if(u&&gn(i,e),(l&Pn)!==0){var f=i;Cn==null||Cn.delete(f),(l&ds)===0&&(l&pr&&(i.f|=ds),Mh(f,Or))}else u&&((l&ba)!==0&&xr!==null&&xr.add(i),Ir(i))}}}function en(t){if(typeof t!="object"||t===null||Gr in t)return t;const e=Bl(t);if(e!==nh&&e!==Rm)return t;var n=new Map,r=zl(t),a=Me(0),s=cs,i=l=>{if(cs===s)return l();var u=Ot,f=cs;yr(null),Cf(s);var v=l();return yr(u),Cf(f),v};return r&&n.set("length",Me(t.length)),new Proxy(t,{defineProperty(l,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Vm();var v=n.get(u);return v===void 0?i(()=>{var p=Me(f.value);return n.set(u,p),p}):M(v,f.value,!0),!0},deleteProperty(l,u){var f=n.get(u);if(f===void 0){if(u in l){const v=i(()=>Me(wn));n.set(u,v),zi(a)}}else M(f,wn),zi(a);return!0},get(l,u,f){var m;if(u===Gr)return t;var v=n.get(u),p=u in l;if(v===void 0&&(!p||(m=Na(l,u))!=null&&m.writable)&&(v=i(()=>{var x=en(p?l[u]:wn),k=Me(x);return k}),n.set(u,v)),v!==void 0){var h=o(v);return h===wn?void 0:h}return Reflect.get(l,u,f)},getOwnPropertyDescriptor(l,u){var f=Reflect.getOwnPropertyDescriptor(l,u);if(f&&"value"in f){var v=n.get(u);v&&(f.value=o(v))}else if(f===void 0){var p=n.get(u),h=p==null?void 0:p.v;if(p!==void 0&&h!==wn)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return f},has(l,u){var h;if(u===Gr)return!0;var f=n.get(u),v=f!==void 0&&f.v!==wn||Reflect.has(l,u);if(f!==void 0||Zt!==null&&(!v||(h=Na(l,u))!=null&&h.writable)){f===void 0&&(f=i(()=>{var m=v?en(l[u]):wn,x=Me(m);return x}),n.set(u,f));var p=o(f);if(p===wn)return!1}return v},set(l,u,f,v){var G;var p=n.get(u),h=u in l;if(r&&u==="length")for(var m=f;m<p.v;m+=1){var x=n.get(m+"");x!==void 0?M(x,wn):m in l&&(x=i(()=>Me(wn)),n.set(m+"",x))}if(p===void 0)(!h||(G=Na(l,u))!=null&&G.writable)&&(p=i(()=>Me(void 0)),M(p,en(f)),n.set(u,p));else{h=p.v!==wn;var k=i(()=>en(f));M(p,k)}var A=Reflect.getOwnPropertyDescriptor(l,u);if(A!=null&&A.set&&A.set.call(v,f),!h){if(r&&typeof u=="string"){var D=n.get("length"),q=Number(u);Number.isInteger(q)&&q>=D.v&&M(D,q+1)}zi(a)}return!0},ownKeys(l){o(a);var u=Reflect.ownKeys(l).filter(p=>{var h=n.get(p);return h===void 0||h.v!==wn});for(var[f,v]of n)v.v!==wn&&!(f in l)&&u.push(f);return u},setPrototypeOf(){Um()}})}function Ef(t){try{if(t!==null&&typeof t=="object"&&Gr in t)return t[Gr]}catch{}return t}function Cy(t,e){return Object.is(Ef(t),Ef(e))}var Gn,Oh,Nh,Rh;function Iy(){if(Gn===void 0){Gn=window,Oh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Nh=Na(e,"firstChild").get,Rh=Na(e,"nextSibling").get,xf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),xf(n)&&(n.__t=void 0)}}function ya(t=""){return document.createTextNode(t)}function or(t){return Nh.call(t)}function fo(t){return Rh.call(t)}function _(t,e){return or(t)}function We(t,e=!1){{var n=or(t);return n instanceof Comment&&n.data===""?fo(n):n}}function w(t,e=1,n=!1){let r=t;for(;e--;)r=fo(r);return r}function Py(t){t.textContent=""}function Dh(){return!1}function My(t,e,n){return document.createElementNS(dh,t,void 0)}function Oy(t,e){if(e){const n=document.body;t.autofocus=!0,Wr(()=>{document.activeElement===n&&t.focus()})}}let Af=!1;function Ny(){Af||(Af=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Fl(t){var e=Ot,n=Zt;yr(null),Qr(null);try{return t()}finally{yr(e),Qr(n)}}function Lh(t,e,n,r=n){t.addEventListener(e,()=>Fl(n));const a=t.__on_r;a?t.__on_r=()=>{a(),r(!0)}:t.__on_r=()=>r(!0),Ny()}function zh(t){Zt===null&&(Ot===null&&Fm(),qm()),ja&&Bm()}function Ry(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function br(t,e,n){var r=Zt;r!==null&&(r.f&lr)!==0&&(t|=lr);var a={ctx:nn,deps:null,nodes:null,f:t|Mn|pr,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{ei(a)}catch(l){throw kn(a),l}else e!==null&&Ir(a);var s=a;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&ws)===0&&(s=s.first,(t&ba)!==0&&(t&za)!==0&&s!==null&&(s.f|=za)),s!==null&&(s.parent=r,r!==null&&Ry(s,r),Ot!==null&&(Ot.f&Pn)!==0&&(t&Fa)===0)){var i=Ot;(i.effects??(i.effects=[])).push(s)}return a}function td(){return Ot!==null&&!Pr}function nd(t){const e=br(oo,null,!1);return gn(e,xn),e.teardown=t,e}function On(t){zh();var e=Zt.f,n=!Ot&&(e&Rr)!==0&&(e&lo)===0;if(n){var r=nn;(r.e??(r.e=[])).push(t)}else return jh(t)}function jh(t){return br(Ki|ih,t,!1)}function Bh(t){return zh(),br(oo|ih,t,!0)}function qh(t){ma.ensure();const e=br(Fa|ws,t,!0);return()=>{kn(e)}}function Dy(t){ma.ensure();const e=br(Fa|ws,t,!0);return(n={})=>new Promise(r=>{n.outro?ls(e,()=>{kn(e),r(void 0)}):(kn(e),r(void 0))})}function li(t){return br(Ki,t,!1)}function Ly(t){return br(Yu|ws,t,!0)}function Kl(t,e=0){return br(oo|e,t,!0)}function se(t,e=[],n=[],r=[]){Th(r,e,n,a=>{br(oo,()=>t(...a.map(o)),!0)})}function vo(t,e=0){var n=br(ba|e,t,!0);return n}function Fh(t,e=0){var n=br(Wu|e,t,!0);return n}function Jn(t){return br(Rr|ws,t,!0)}function Kh(t){var e=t.teardown;if(e!==null){const n=ja,r=Ot;Tf(!0),yr(null);try{e.call(null)}finally{Tf(n),yr(r)}}}function rd(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const a=n.ac;a!==null&&Fl(()=>{a.abort(Ja)});var r=n.next;(n.f&Fa)!==0?n.parent=null:kn(n,e),n=r}}function zy(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Rr)===0&&kn(e),e=n}}function kn(t,e=!0){var n=!1;(e||(t.f&sh)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Hh(t.nodes.start,t.nodes.end),n=!0),rd(t,e&&!n),Hi(t,0),gn(t,ga);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Kh(t);var a=t.parent;a!==null&&a.first!==null&&Vh(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Hh(t,e){for(;t!==null;){var n=t===e?null:fo(t);t.remove(),t=n}}function Vh(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function ls(t,e,n=!0){var r=[];Uh(t,r,!0);var a=()=>{n&&kn(t),e&&e()},s=r.length;if(s>0){var i=()=>--s||a();for(var l of r)l.out(i)}else a()}function Uh(t,e,n){if((t.f&lr)===0){t.f^=lr;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||n)&&e.push(l);for(var a=t.first;a!==null;){var s=a.next,i=(a.f&za)!==0||(a.f&Rr)!==0&&(t.f&ba)!==0;Uh(a,e,i?n:!1),a=s}}}function ad(t){Gh(t,!0)}function Gh(t,e){if((t.f&lr)!==0){t.f^=lr,(t.f&xn)===0&&(gn(t,Mn),Ir(t));for(var n=t.first;n!==null;){var r=n.next,a=(n.f&za)!==0||(n.f&Rr)!==0;Gh(n,a?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)(i.is_global||e)&&i.in()}}function Wh(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var a=n===r?null:fo(n);e.append(n),n=a}}let nl=!1,ja=!1;function Tf(t){ja=t}let Ot=null,Pr=!1;function yr(t){Ot=t}let Zt=null;function Qr(t){Zt=t}let gr=null;function Yh(t){Ot!==null&&(gr===null?gr=[t]:gr.push(t))}let Qn=null,sr=0,fr=null;function jy(t){fr=t}let Xh=1,es=0,cs=es;function Cf(t){cs=t}function Zh(){return++Xh}function ho(t){var e=t.f;if((e&Mn)!==0)return!0;if(e&Pn&&(t.f&=~ds),(e&Or)!==0){for(var n=t.deps,r=n.length,a=0;a<r;a++){var s=n[a];if(ho(s)&&Ch(s),s.wv>t.wv)return!0}(e&pr)!==0&&Cn===null&&gn(t,xn)}return!1}function Qh(t,e,n=!0){var r=t.reactions;if(r!==null&&!(gr!==null&&Zs.call(gr,t)))for(var a=0;a<r.length;a++){var s=r[a];(s.f&Pn)!==0?Qh(s,e,!1):e===s&&(n?gn(s,Mn):(s.f&xn)!==0&&gn(s,Or),Ir(s))}}function Jh(t){var k;var e=Qn,n=sr,r=fr,a=Ot,s=gr,i=nn,l=Pr,u=cs,f=t.f;Qn=null,sr=0,fr=null,Ot=(f&(Rr|Fa))===0?t:null,gr=null,Qs(t.ctx),Pr=!1,cs=++es,t.ac!==null&&(Fl(()=>{t.ac.abort(Ja)}),t.ac=null);try{t.f|=su;var v=t.fn,p=v();t.f|=lo;var h=t.deps,m=At==null?void 0:At.is_fork;if(Qn!==null){var x;if(m||Hi(t,sr),h!==null&&sr>0)for(h.length=sr+Qn.length,x=0;x<Qn.length;x++)h[sr+x]=Qn[x];else t.deps=h=Qn;if(td()&&(t.f&pr)!==0)for(x=sr;x<h.length;x++)((k=h[x]).reactions??(k.reactions=[])).push(t)}else!m&&h!==null&&sr<h.length&&(Hi(t,sr),h.length=sr);if(co()&&fr!==null&&!Pr&&h!==null&&(t.f&(Pn|Or|Mn))===0)for(x=0;x<fr.length;x++)Qh(fr[x],t);if(a!==null&&a!==t){if(es++,a.deps!==null)for(let A=0;A<n;A+=1)a.deps[A].rv=es;if(e!==null)for(const A of e)A.rv=es;fr!==null&&(r===null?r=fr:r.push(...fr))}return(t.f&Ra)!==0&&(t.f^=Ra),p}catch(A){return yh(A)}finally{t.f^=su,Qn=e,sr=n,fr=r,Ot=a,gr=s,Qs(i),Pr=l,cs=u}}function By(t,e){let n=e.reactions;if(n!==null){var r=Om.call(n,t);if(r!==-1){var a=n.length-1;a===0?n=e.reactions=null:(n[r]=n[a],n.pop())}}if(n===null&&(e.f&Pn)!==0&&(Qn===null||!Zs.call(Qn,e))){var s=e;(s.f&pr)!==0&&(s.f^=pr,s.f&=~ds),Ju(s),Ey(s),Hi(s,0)}}function Hi(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)By(t,n[r])}function ei(t){var e=t.f;if((e&ga)===0){gn(t,xn);var n=Zt,r=nl;Zt=t,nl=!0;try{(e&(ba|Wu))!==0?zy(t):rd(t),Kh(t);var a=Jh(t);t.teardown=typeof a=="function"?a:null,t.wv=Xh;var s;ru&&oy&&(t.f&Mn)!==0&&t.deps}finally{nl=r,Zt=n}}}async function $h(){await Promise.resolve(),hy()}function o(t){var e=t.f,n=(e&Pn)!==0;if(Ot!==null&&!Pr){var r=Zt!==null&&(Zt.f&ga)!==0;if(!r&&(gr===null||!Zs.call(gr,t))){var a=Ot.deps;if((Ot.f&su)!==0)t.rv<es&&(t.rv=es,Qn===null&&a!==null&&a[sr]===t?sr++:Qn===null?Qn=[t]:Qn.push(t));else{(Ot.deps??(Ot.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[Ot]:Zs.call(s,Ot)||s.push(Ot)}}}if(ja&&Da.has(t))return Da.get(t);if(n){var i=t;if(ja){var l=i.v;return((i.f&xn)===0&&i.reactions!==null||tp(i))&&(l=ed(i)),Da.set(i,l),l}var u=(i.f&pr)===0&&!Pr&&Ot!==null&&(nl||(Ot.f&pr)!==0),f=(i.f&lo)===0;ho(i)&&(u&&(i.f|=pr),Ch(i)),u&&!f&&(Ih(i),ep(i))}if(Cn!=null&&Cn.has(t))return Cn.get(t);if((t.f&Ra)!==0)throw t.v;return t.v}function ep(t){if(t.f|=pr,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&Pn)!==0&&(e.f&pr)===0&&(Ih(e),ep(e))}function tp(t){if(t.v===wn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Da.has(e)||(e.f&Pn)!==0&&tp(e))return!0;return!1}function $n(t){var e=Pr;try{return Pr=!0,t()}finally{Pr=e}}function qy(t,e){var n={};for(var r in t)e.includes(r)||(n[r]=t[r]);for(var a of Object.getOwnPropertySymbols(t))Object.propertyIsEnumerable.call(t,a)&&!e.includes(a)&&(n[a]=t[a]);return n}function np(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Gr in t)vu(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Gr in n&&vu(n)}}}function vu(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{vu(t[r],e)}catch{}const n=Bl(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=th(n);for(let a in r){const s=r[a].get;if(s)try{s.call(t)}catch{}}}}}function Fy(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const Ky=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Hy(t){return Ky.includes(t)}const Vy={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Uy(t){return t=t.toLowerCase(),Vy[t]??t}const Gy=["touchstart","touchmove"];function Wy(t){return Gy.includes(t)}const rp=new Set,hu=new Set;function sd(t,e,n,r={}){function a(s){if(r.capture||gu.call(e,s),!s.cancelBubble)return Fl(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Wr(()=>{e.addEventListener(t,a,r)}):e.addEventListener(t,a,r),a}function pu(t,e,n,r={}){var a=sd(e,t,n,r);return()=>{t.removeEventListener(e,a,r)}}function fl(t,e,n,r,a){var s={capture:r,passive:a},i=sd(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&nd(()=>{e.removeEventListener(t,i,s)})}function Jt(t){for(var e=0;e<t.length;e++)rp.add(t[e]);for(var n of hu)n(t)}let If=null;function gu(t){var A;var e=this,n=e.ownerDocument,r=t.type,a=((A=t.composedPath)==null?void 0:A.call(t))||[],s=a[0]||t.target;If=t;var i=0,l=If===t&&t.__root;if(l){var u=a.indexOf(l);if(u!==-1&&(e===document||e===window)){t.__root=e;return}var f=a.indexOf(e);if(f===-1)return;u<=f&&(i=u)}if(s=a[i]||t.target,s!==e){Nm(t,"currentTarget",{configurable:!0,get(){return s||n}});var v=Ot,p=Zt;yr(null),Qr(null);try{for(var h,m=[];s!==null;){var x=s.assignedSlot||s.parentNode||s.host||null;try{var k=s["__"+r];k!=null&&(!s.disabled||t.target===s)&&k.call(s,t)}catch(D){h?m.push(D):h=D}if(t.cancelBubble||x===e||x===null)break;s=x}if(h){for(let D of m)queueMicrotask(()=>{throw D});throw h}}finally{t.__root=e,delete t.currentTarget,yr(v),Qr(p)}}}var Jv,$v;const Mc=($v=(Jv=globalThis==null?void 0:globalThis.window)==null?void 0:Jv.trustedTypes)==null?void 0:$v.createPolicy("svelte-trusted-html",{createHTML:t=>t});function Yy(t){return(Mc==null?void 0:Mc.createHTML(t))??t}function id(t,e=!1){var n=My("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?Yy(t):t,n.content}function vs(t,e){var n=Zt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function F(t,e){var n=(e&uh)!==0,r=(e&ry)!==0,a,s=!t.startsWith("<!>");return()=>{a===void 0&&(a=id(s?t:"<!>"+t,!0),n||(a=or(a)));var i=r||Oh?document.importNode(a,!0):a.cloneNode(!0);if(n){var l=or(i),u=i.lastChild;vs(l,u)}else vs(i,i);return i}}function Xy(t,e,n="svg"){var r=!t.startsWith("<!>"),a=(e&uh)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,i;return()=>{if(!i){var l=id(s,!0),u=or(l);if(a)for(i=document.createDocumentFragment();or(u);)i.appendChild(or(u));else i=or(u)}var f=i.cloneNode(!0);if(a){var v=or(f),p=f.lastChild;vs(v,p)}else vs(f,f);return f}}function yn(t,e){return Xy(t,e,"svg")}function mn(t=""){{var e=ya(t+"");return vs(e,e),e}}function ln(){var t=document.createDocumentFragment(),e=document.createComment(""),n=ya();return t.append(e,n),vs(e,n),t}function C(t,e){t!==null&&t.before(e)}function te(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Zy(t,e){return Qy(t,e)}const Bo=new Map;function Qy(t,{target:e,anchor:n,props:r={},events:a,context:s,intro:i=!0}){Iy();var l=new Set,u=p=>{for(var h=0;h<p.length;h++){var m=p[h];if(!l.has(m)){l.add(m);var x=Wy(m);for(const D of[e,document]){var k=Bo.get(D);k===void 0&&(k=new Map,Bo.set(D,k));var A=k.get(m);A===void 0?(D.addEventListener(m,gu,{passive:x}),k.set(m,1)):k.set(m,A+1)}}}};u(jl(rp)),hu.add(u);var f=void 0,v=Dy(()=>{var p=n??e.appendChild(ya());return my(p,{pending:()=>{}},h=>{et({});var m=nn;s&&(m.c=s),a&&(r.$$events=a),f=t(h,r)||{},tt()}),()=>{var k;for(var h of l)for(const A of[e,document]){var m=Bo.get(A),x=m.get(h);--x==0?(A.removeEventListener(h,gu),m.delete(h),m.size===0&&Bo.delete(A)):m.set(h,x)}hu.delete(u),p!==n&&((k=p.parentNode)==null||k.removeChild(p))}});return Jy.set(f,v),f}let Jy=new WeakMap;var Sr,Vr,ir,os,to,no,Rl;class od{constructor(e,n=!0){ht(this,"anchor");Pe(this,Sr,new Map);Pe(this,Vr,new Map);Pe(this,ir,new Map);Pe(this,os,new Set);Pe(this,to,!0);Pe(this,no,()=>{var e=At;if(B(this,Sr).has(e)){var n=B(this,Sr).get(e),r=B(this,Vr).get(n);if(r)ad(r),B(this,os).delete(n);else{var a=B(this,ir).get(n);a&&(B(this,Vr).set(n,a.effect),B(this,ir).delete(n),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),r=a.effect)}for(const[s,i]of B(this,Sr)){if(B(this,Sr).delete(s),s===e)break;const l=B(this,ir).get(i);l&&(kn(l.effect),B(this,ir).delete(i))}for(const[s,i]of B(this,Vr)){if(s===n||B(this,os).has(s))continue;const l=()=>{if(Array.from(B(this,Sr).values()).includes(s)){var f=document.createDocumentFragment();Wh(i,f),f.append(ya()),B(this,ir).set(s,{effect:i,fragment:f})}else kn(i);B(this,os).delete(s),B(this,Vr).delete(s)};B(this,to)||!r?(B(this,os).add(s),ls(i,l,!1)):l()}}});Pe(this,Rl,e=>{B(this,Sr).delete(e);const n=Array.from(B(this,Sr).values());for(const[r,a]of B(this,ir))n.includes(r)||(kn(a.effect),B(this,ir).delete(r))});this.anchor=e,xt(this,to,n)}ensure(e,n){var r=At,a=Dh();if(n&&!B(this,Vr).has(e)&&!B(this,ir).has(e))if(a){var s=document.createDocumentFragment(),i=ya();s.append(i),B(this,ir).set(e,{effect:Jn(()=>n(i)),fragment:s})}else B(this,Vr).set(e,Jn(()=>n(this.anchor)));if(B(this,Sr).set(r,e),a){for(const[l,u]of B(this,Vr))l===e?r.unskip_effect(u):r.skip_effect(u);for(const[l,u]of B(this,ir))l===e?r.unskip_effect(u.effect):r.skip_effect(u.effect);r.oncommit(B(this,no)),r.ondiscard(B(this,Rl))}else B(this,no).call(this)}}Sr=new WeakMap,Vr=new WeakMap,ir=new WeakMap,os=new WeakMap,to=new WeakMap,no=new WeakMap,Rl=new WeakMap;function pe(t,e,n=!1){var r=new od(t),a=n?za:0;function s(i,l){r.ensure(i,l)}vo(()=>{var i=!1;e((l,u=0)=>{i=!0,s(u,l)}),i||s(!1,null)},a)}function Ut(t,e){return e}function $y(t,e,n){for(var r=[],a=e.length,s,i=e.length,l=0;l<a;l++){let p=e[l];ls(p,()=>{if(s){if(s.pending.delete(p),s.done.add(p),s.pending.size===0){var h=t.outrogroups;mu(jl(s.done)),h.delete(s),h.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var u=r.length===0&&n!==null;if(u){var f=n,v=f.parentNode;Py(v),v.append(f),t.items.clear()}mu(e,!u)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function mu(t,e=!0){for(var n=0;n<t.length;n++)kn(t[n],e)}var Pf;function Tt(t,e,n,r,a,s=null){var i=t,l=new Map,u=(e&ch)!==0;if(u){var f=t;i=f.appendChild(ya())}var v=null,p=$u(()=>{var D=n();return zl(D)?D:D==null?[]:jl(D)}),h,m=!0;function x(){A.fallback=v,e_(A,h,i,e,r),v!==null&&(h.length===0?(v.f&fa)===0?ad(v):(v.f^=fa,Oi(v,null,i)):ls(v,()=>{v=null}))}var k=vo(()=>{h=o(p);for(var D=h.length,q=new Set,G=At,S=Dh(),z=0;z<D;z+=1){var L=h[z],N=r(L,z),J=m?null:l.get(N);J?(J.v&&$s(J.v,L),J.i&&$s(J.i,z),S&&G.unskip_effect(J.e)):(J=t_(l,m?i:Pf??(Pf=ya()),L,N,z,a,e,n),m||(J.e.f|=fa),l.set(N,J)),q.add(N)}if(D===0&&s&&!v&&(m?v=Jn(()=>s(i)):(v=Jn(()=>s(Pf??(Pf=ya()))),v.f|=fa)),D>q.size&&jm(),!m)if(S){for(const[ae,ke]of l)q.has(ae)||G.skip_effect(ke.e);G.oncommit(x),G.ondiscard(()=>{})}else x();o(p)}),A={effect:k,items:l,outrogroups:null,fallback:v};m=!1}function xi(t){for(;t!==null&&(t.f&Rr)===0;)t=t.next;return t}function e_(t,e,n,r,a){var ke,X,T,K,P,O,I,Q,W;var s=(r&Zm)!==0,i=e.length,l=t.items,u=xi(t.effect.first),f,v=null,p,h=[],m=[],x,k,A,D;if(s)for(D=0;D<i;D+=1)x=e[D],k=a(x,D),A=l.get(k).e,(A.f&fa)===0&&((X=(ke=A.nodes)==null?void 0:ke.a)==null||X.measure(),(p??(p=new Set)).add(A));for(D=0;D<i;D+=1){if(x=e[D],k=a(x,D),A=l.get(k).e,t.outrogroups!==null)for(const Z of t.outrogroups)Z.pending.delete(A),Z.done.delete(A);if((A.f&fa)!==0)if(A.f^=fa,A===u)Oi(A,null,n);else{var q=v?v.next:u;A===t.effect.last&&(t.effect.last=A.prev),A.prev&&(A.prev.next=A.next),A.next&&(A.next.prev=A.prev),Aa(t,v,A),Aa(t,A,q),Oi(A,q,n),v=A,h=[],m=[],u=xi(v.next);continue}if((A.f&lr)!==0&&(ad(A),s&&((K=(T=A.nodes)==null?void 0:T.a)==null||K.unfix(),(p??(p=new Set)).delete(A))),A!==u){if(f!==void 0&&f.has(A)){if(h.length<m.length){var G=m[0],S;v=G.prev;var z=h[0],L=h[h.length-1];for(S=0;S<h.length;S+=1)Oi(h[S],G,n);for(S=0;S<m.length;S+=1)f.delete(m[S]);Aa(t,z.prev,L.next),Aa(t,v,z),Aa(t,L,G),u=G,v=L,D-=1,h=[],m=[]}else f.delete(A),Oi(A,u,n),Aa(t,A.prev,A.next),Aa(t,A,v===null?t.effect.first:v.next),Aa(t,v,A),v=A;continue}for(h=[],m=[];u!==null&&u!==A;)(f??(f=new Set)).add(u),m.push(u),u=xi(u.next);if(u===null)continue}(A.f&fa)===0&&h.push(A),v=A,u=xi(A.next)}if(t.outrogroups!==null){for(const Z of t.outrogroups)Z.pending.size===0&&(mu(jl(Z.done)),(P=t.outrogroups)==null||P.delete(Z));t.outrogroups.size===0&&(t.outrogroups=null)}if(u!==null||f!==void 0){var N=[];if(f!==void 0)for(A of f)(A.f&lr)===0&&N.push(A);for(;u!==null;)(u.f&lr)===0&&u!==t.fallback&&N.push(u),u=xi(u.next);var J=N.length;if(J>0){var ae=(r&ch)!==0&&i===0?n:null;if(s){for(D=0;D<J;D+=1)(I=(O=N[D].nodes)==null?void 0:O.a)==null||I.measure();for(D=0;D<J;D+=1)(W=(Q=N[D].nodes)==null?void 0:Q.a)==null||W.fix()}$y(t,N,ae)}}s&&Wr(()=>{var Z,j;if(p!==void 0)for(A of p)(j=(Z=A.nodes)==null?void 0:Z.a)==null||j.apply()})}function t_(t,e,n,r,a,s,i,l){var u=(i&Ym)!==0?(i&Qm)===0?Ay(n,!1,!1):fs(n):null,f=(i&Xm)!==0?fs(a):null;return{v:u,i:f,e:Jn(()=>(s(e,u??n,f??a,l),()=>{t.delete(r)}))}}function Oi(t,e,n){if(t.nodes)for(var r=t.nodes.start,a=t.nodes.end,s=e&&(e.f&fa)===0?e.nodes.start:n;r!==null;){var i=fo(r);if(s.before(r),r===a)return;r=i}}function Aa(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function n_(t,e,n=!1,r=!1,a=!1){var s=t,i="";se(()=>{var l=Zt;if(i!==(i=e()??"")&&(l.nodes!==null&&(Hh(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var u=i+"";n?u=`<svg>${u}</svg>`:r&&(u=`<math>${u}</math>`);var f=id(u);if((n||r)&&(f=or(f)),vs(or(f),f.lastChild),n||r)for(;or(f);)s.before(or(f));else s.before(f)}})}function mr(t,e,...n){var r=new od(t);vo(()=>{const a=e()??null;r.ensure(a,a&&(s=>a(s,...n)))},za)}function ld(t,e,n){var r=new od(t);vo(()=>{var a=e()??null;r.ensure(a,a&&(s=>n(s,a)))},za)}function Yn(t,e,n){li(()=>{var r=$n(()=>e(t,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var a=!1,s={};Kl(()=>{var i=n();np(i),a&&vh(s,i)&&(s=i,r.update(i))}),a=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function r_(t,e){var n=void 0,r;Fh(()=>{n!==(n=e())&&(r&&(kn(r),r=null),n&&(r=Jn(()=>{li(()=>n(t))})))})}function ap(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=ap(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function a_(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=ap(t))&&(r&&(r+=" "),r+=e);return r}function xs(t){return typeof t=="object"?a_(t):t??""}const Mf=[...` 	
\r\fÂ \v\uFEFF`];function s_(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var a in n)if(n[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,i=0;(i=r.indexOf(a,i))>=0;){var l=i+s;(i===0||Mf.includes(r[i-1]))&&(l===r.length||Mf.includes(r[l]))?r=(i===0?"":r.substring(0,i))+r.substring(l+1):i=l}}return r===""?null:r}function Of(t,e=!1){var n=e?" !important;":";",r="";for(var a in t){var s=t[a];s!=null&&s!==""&&(r+=" "+a+": "+s+n)}return r}function Oc(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function i_(t,e){if(e){var n="",r,a;if(Array.isArray(e)?(r=e[0],a=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,i=0,l=!1,u=[];r&&u.push(...Object.keys(r).map(Oc)),a&&u.push(...Object.keys(a).map(Oc));var f=0,v=-1;const k=t.length;for(var p=0;p<k;p++){var h=t[p];if(l?h==="/"&&t[p-1]==="*"&&(l=!1):s?s===h&&(s=!1):h==="/"&&t[p+1]==="*"?l=!0:h==='"'||h==="'"?s=h:h==="("?i++:h===")"&&i--,!l&&s===!1&&i===0){if(h===":"&&v===-1)v=p;else if(h===";"||p===k-1){if(v!==-1){var m=Oc(t.substring(f,v).trim());if(!u.includes(m)){h!==";"&&p++;var x=t.substring(f,p).trim();n+=" "+x+";"}}f=p+1,v=-1}}}}return r&&(n+=Of(r)),a&&(n+=Of(a,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function It(t,e,n,r,a,s){var i=t.__className;if(i!==n||i===void 0){var l=s_(n,r,s);l==null?t.removeAttribute("class"):e?t.className=l:t.setAttribute("class",l),t.__className=n}else if(s&&a!==s)for(var u in s){var f=!!s[u];(a==null||f!==!!a[u])&&t.classList.toggle(u,f)}return s}function Nc(t,e={},n,r){for(var a in n){var s=n[a];e[a]!==s&&(n[a]==null?t.style.removeProperty(a):t.style.setProperty(a,s,r))}}function Lt(t,e,n,r){var a=t.__style;if(a!==e){var s=i_(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Nc(t,n==null?void 0:n[0],r[0]),Nc(t,n==null?void 0:n[1],r[1],"important")):Nc(t,n,r));return r}function vl(t,e,n=!1){if(t.multiple){if(e==null)return;if(!zl(e))return sy();for(var r of t.options)r.selected=e.includes(ji(r));return}for(r of t.options){var a=ji(r);if(Cy(a,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function sp(t){var e=new MutationObserver(()=>{vl(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),nd(()=>{e.disconnect()})}function po(t,e,n=e){var r=new WeakSet,a=!0;Lh(t,"change",s=>{var i=s?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(i),ji);else{var u=t.querySelector(i)??t.querySelector("option:not([disabled])");l=u&&ji(u)}n(l),At!==null&&r.add(At)}),li(()=>{var s=e();if(t===document.activeElement){var i=dl??At;if(r.has(i))return}if(vl(t,s,a),a&&s===void 0){var l=t.querySelector(":checked");l!==null&&(s=ji(l),n(s))}t.__value=s,a=!1}),sp(t)}function ji(t){return"__value"in t?t.__value:t.value}const Ca=Symbol("class"),ua=Symbol("style"),ip=Symbol("is custom element"),op=Symbol("is html"),o_=lh?"option":"OPTION",l_=lh?"select":"SELECT";function c_(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function bt(t,e,n,r){var a=lp(t);a[e]!==(a[e]=n)&&(e==="loading"&&(t[Lm]=n),n==null?t.removeAttribute(e):typeof n!="string"&&cp(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function u_(t,e,n,r,a=!1,s=!1){var i=lp(t),l=i[ip],u=!i[op],f=e||{},v=t.nodeName===o_;for(var p in e)p in n||(n[p]=null);n.class?n.class=xs(n.class):(r||n[Ca])&&(n.class=null),n[ua]&&(n.style??(n.style=null));var h=cp(t);for(const G in n){let S=n[G];if(v&&G==="value"&&S==null){t.value=t.__value="",f[G]=S;continue}if(G==="class"){var m=t.namespaceURI==="http://www.w3.org/1999/xhtml";It(t,m,S,r,e==null?void 0:e[Ca],n[Ca]),f[G]=S,f[Ca]=n[Ca];continue}if(G==="style"){Lt(t,S,e==null?void 0:e[ua],n[ua]),f[G]=S,f[ua]=n[ua];continue}var x=f[G];if(!(S===x&&!(S===void 0&&t.hasAttribute(G)))){f[G]=S;var k=G[0]+G[1];if(k!=="$$")if(k==="on"){const z={},L="$$"+G;let N=G.slice(2);var A=Hy(N);if(Fy(N)&&(N=N.slice(0,-7),z.capture=!0),!A&&x){if(S!=null)continue;t.removeEventListener(N,f[L],z),f[L]=null}if(S!=null)if(A)t[`__${N}`]=S,Jt([N]);else{let J=function(ae){f[G].call(this,ae)};f[L]=sd(N,t,J,z)}else A&&(t[`__${N}`]=void 0)}else if(G==="style")bt(t,G,S);else if(G==="autofocus")Oy(t,!!S);else if(!l&&(G==="__value"||G==="value"&&S!=null))t.value=t.__value=S;else if(G==="selected"&&v)c_(t,S);else{var D=G;u||(D=Uy(D));var q=D==="defaultValue"||D==="defaultChecked";if(S==null&&!l&&!q)if(i[G]=null,D==="value"||D==="checked"){let z=t;const L=e===void 0;if(D==="value"){let N=z.defaultValue;z.removeAttribute(D),z.defaultValue=N,z.value=z.__value=L?N:null}else{let N=z.defaultChecked;z.removeAttribute(D),z.defaultChecked=N,z.checked=L?N:!1}}else t.removeAttribute(G);else q||h.includes(D)&&(l||typeof S!="string")?(t[D]=S,D in i&&(i[D]=wn)):typeof S!="function"&&bt(t,D,S)}}}return f}function Ka(t,e,n=[],r=[],a=[],s,i=!1,l=!1){Th(a,n,r,u=>{var f=void 0,v={},p=t.nodeName===l_,h=!1;if(Fh(()=>{var x=e(...u.map(o)),k=u_(t,f,x,s,i,l);h&&p&&"value"in x&&vl(t,x.value);for(let D of Object.getOwnPropertySymbols(v))x[D]||kn(v[D]);for(let D of Object.getOwnPropertySymbols(x)){var A=x[D];D.description===ay&&(!f||A!==f[D])&&(v[D]&&kn(v[D]),v[D]=Jn(()=>r_(t,()=>A))),k[D]=A}f=k}),p){var m=t;li(()=>{vl(m,f.value,!0),sp(m)})}h=!0})}function lp(t){return t.__attributes??(t.__attributes={[ip]:t.nodeName.includes("-"),[op]:t.namespaceURI===dh})}var Nf=new Map;function cp(t){var e=t.getAttribute("is")||t.nodeName,n=Nf.get(e);if(n)return n;Nf.set(e,n=[]);for(var r,a=t,s=Element.prototype;s!==a;){r=th(a);for(var i in r)r[i].set&&n.push(i);a=Bl(a)}return n}function va(t,e,n=e){var r=new WeakSet;Lh(t,"input",async a=>{var s=a?t.defaultValue:t.value;if(s=Rc(t)?Dc(s):s,n(s),At!==null&&r.add(At),await $h(),s!==(s=e())){var i=t.selectionStart,l=t.selectionEnd,u=t.value.length;if(t.value=s??"",l!==null){var f=t.value.length;i===l&&l===u&&f>u?(t.selectionStart=f,t.selectionEnd=f):(t.selectionStart=i,t.selectionEnd=Math.min(l,f))}}}),$n(e)==null&&t.value&&(n(Rc(t)?Dc(t.value):t.value),At!==null&&r.add(At)),Kl(()=>{var a=e();if(t===document.activeElement){var s=dl??At;if(r.has(s))return}Rc(t)&&a===Dc(t.value)||t.type==="date"&&!a&&!t.value||a!==t.value&&(t.value=a??"")})}function Rc(t){var e=t.type;return e==="number"||e==="range"}function Dc(t){return t===""?null:+t}var Oa,Xs,ro,Dl,up;const Ll=class Ll{constructor(e){Pe(this,Dl);Pe(this,Oa,new WeakMap);Pe(this,Xs);Pe(this,ro);xt(this,ro,e)}observe(e,n){var r=B(this,Oa).get(e)||new Set;return r.add(n),B(this,Oa).set(e,r),Tn(this,Dl,up).call(this).observe(e,B(this,ro)),()=>{var a=B(this,Oa).get(e);a.delete(n),a.size===0&&(B(this,Oa).delete(e),B(this,Xs).unobserve(e))}}};Oa=new WeakMap,Xs=new WeakMap,ro=new WeakMap,Dl=new WeakSet,up=function(){return B(this,Xs)??xt(this,Xs,new ResizeObserver(e=>{for(var n of e){Ll.entries.set(n.target,n);for(var r of B(this,Oa).get(n.target)||[])r(n)}}))},ht(Ll,"entries",new WeakMap);let yu=Ll;var d_=new yu({box:"border-box"});function Rf(t,e,n){var r=d_.observe(t,()=>n(t[e]));li(()=>($n(()=>n(t[e])),r))}function Df(t,e){return t===e||(t==null?void 0:t[Gr])===e}function ks(t={},e,n,r){return li(()=>{var a,s;return Kl(()=>{a=s,s=[],$n(()=>{t!==n(...s)&&(e(t,...s),a&&Df(n(...a),t)&&e(null,...a))})}),()=>{Wr(()=>{s&&Df(n(...s),t)&&e(null,...s)})}}),t}function f_(t=!1){const e=nn,n=e.l.u;if(!n)return;let r=()=>np(e.s);if(t){let a=0,s={};const i=uo(()=>{let l=!1;const u=e.s;for(const f in u)u[f]!==s[f]&&(s[f]=u[f],l=!0);return l&&a++,a});r=()=>o(i)}n.b.length&&Bh(()=>{Lf(e,r),au(n.b)}),On(()=>{const a=$n(()=>n.m.map(Dm));return()=>{for(const s of a)typeof s=="function"&&s()}}),n.a.length&&On(()=>{Lf(e,r),au(n.a)})}function Lf(t,e){if(t.l.s)for(const n of t.l.s)o(n);e()}let qo=!1;function v_(t){var e=qo;try{return qo=!1,[t(),qo]}finally{qo=e}}const h_={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function Ss(t,e,n){return new Proxy({props:t,exclude:e},h_)}const p_={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(wi(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let a=t.props[r];wi(a)&&(a=a());const s=Na(a,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(wi(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const a=Na(r,e);return a&&!a.configurable&&(a.configurable=!0),a}}},has(t,e){if(e===Gr||e===oh)return!1;for(let n of t.props)if(wi(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(wi(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function Ls(...t){return new Proxy({props:t},p_)}function Ae(t,e,n,r){var G;var a=!oi||(n&$m)!==0,s=(n&ty)!==0,i=(n&ny)!==0,l=r,u=!0,f=()=>(u&&(u=!1,l=i?$n(r):r),l),v;if(s){var p=Gr in t||oh in t;v=((G=Na(t,e))==null?void 0:G.set)??(p&&e in t?S=>t[e]=S:void 0)}var h,m=!1;s?[h,m]=v_(()=>t[e]):h=t[e],h===void 0&&r!==void 0&&(h=f(),v&&(a&&Hm(),v(h)));var x;if(a?x=()=>{var S=t[e];return S===void 0?f():(u=!0,S)}:x=()=>{var S=t[e];return S!==void 0&&(l=void 0),S===void 0?l:S},a&&(n&ey)===0)return x;if(v){var k=t.$$legacy;return(function(S,z){return arguments.length>0?((!a||!z||k||m)&&v(z?x():S),S):x()})}var A=!1,D=((n&Jm)!==0?uo:$u)(()=>(A=!1,x()));s&&o(D);var q=Zt;return(function(S,z){if(arguments.length>0){const L=z?o(D):a&&s?en(S):S;return M(D,L),A=!0,l!==void 0&&(l=L),S}return ja&&A||(q.f&ga)!==0?D.v:o(D)})}function En(t){nn===null&&Xu(),oi&&nn.l!==null?g_(nn).m.push(t):On(()=>{const e=$n(t);if(typeof e=="function")return e})}function cd(t){nn===null&&Xu(),En(()=>()=>$n(t))}function g_(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const m_="5";var eh;typeof window<"u"&&((eh=window.__svelte??(window.__svelte={})).v??(eh.v=new Set)).add(m_);var y_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function __(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rl={exports:{}},b_=rl.exports,zf;function w_(){return zf||(zf=1,(function(t,e){((n,r)=>{t.exports=r()})(b_,function(){var n=function(c,d){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(g,y){g.__proto__=y}:function(g,y){for(var b in y)Object.prototype.hasOwnProperty.call(y,b)&&(g[b]=y[b])}))(c,d)},r=function(){return(r=Object.assign||function(c){for(var d,g=1,y=arguments.length;g<y;g++)for(var b in d=arguments[g])Object.prototype.hasOwnProperty.call(d,b)&&(c[b]=d[b]);return c}).apply(this,arguments)};function a(c,d,g){for(var y,b=0,E=d.length;b<E;b++)!y&&b in d||((y=y||Array.prototype.slice.call(d,0,b))[b]=d[b]);return c.concat(y||Array.prototype.slice.call(d))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:y_,i=Object.keys,l=Array.isArray;function u(c,d){return typeof d=="object"&&i(d).forEach(function(g){c[g]=d[g]}),c}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var f=Object.getPrototypeOf,v={}.hasOwnProperty;function p(c,d){return v.call(c,d)}function h(c,d){typeof d=="function"&&(d=d(f(c))),(typeof Reflect>"u"?i:Reflect.ownKeys)(d).forEach(function(g){x(c,g,d[g])})}var m=Object.defineProperty;function x(c,d,g,y){m(c,d,u(g&&p(g,"get")&&typeof g.get=="function"?{get:g.get,set:g.set,configurable:!0}:{value:g,configurable:!0,writable:!0},y))}function k(c){return{from:function(d){return c.prototype=Object.create(d.prototype),x(c.prototype,"constructor",c),{extend:h.bind(null,c.prototype)}}}}var A=Object.getOwnPropertyDescriptor,D=[].slice;function q(c,d,g){return D.call(c,d,g)}function G(c,d){return d(c)}function S(c){if(!c)throw new Error("Assertion Failed")}function z(c){s.setImmediate?setImmediate(c):setTimeout(c,0)}function L(c,d){if(typeof d=="string"&&p(c,d))return c[d];if(!d)return c;if(typeof d!="string"){for(var g=[],y=0,b=d.length;y<b;++y){var E=L(c,d[y]);g.push(E)}return g}var R,V=d.indexOf(".");return V===-1||(R=c[d.substr(0,V)])==null?void 0:L(R,d.substr(V+1))}function N(c,d,g){if(c&&d!==void 0&&!("isFrozen"in Object&&Object.isFrozen(c)))if(typeof d!="string"&&"length"in d){S(typeof g!="string"&&"length"in g);for(var y=0,b=d.length;y<b;++y)N(c,d[y],g[y])}else{var E,R,V=d.indexOf(".");V!==-1?(E=d.substr(0,V),(V=d.substr(V+1))===""?g===void 0?l(c)&&!isNaN(parseInt(E))?c.splice(E,1):delete c[E]:c[E]=g:N(R=(R=c[E])&&p(c,E)?R:c[E]={},V,g)):g===void 0?l(c)&&!isNaN(parseInt(d))?c.splice(d,1):delete c[d]:c[d]=g}}function J(c){var d,g={};for(d in c)p(c,d)&&(g[d]=c[d]);return g}var ae=[].concat;function ke(c){return ae.apply([],c)}var ne="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(c){return["Int","Uint","Float"].map(function(d){return d+c+"Array"})}))).filter(function(c){return s[c]}),X=new Set(ne.map(function(c){return s[c]})),T=null;function K(c){return T=new WeakMap,c=(function d(g){if(!g||typeof g!="object")return g;var y=T.get(g);if(y)return y;if(l(g)){y=[],T.set(g,y);for(var b=0,E=g.length;b<E;++b)y.push(d(g[b]))}else if(X.has(g.constructor))y=g;else{var R,V=f(g);for(R in y=V===Object.prototype?{}:Object.create(V),T.set(g,y),g)p(g,R)&&(y[R]=d(g[R]))}return y})(c),T=null,c}var P={}.toString;function O(c){return P.call(c).slice(8,-1)}var I=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Q=typeof I=="symbol"?function(c){var d;return c!=null&&(d=c[I])&&d.apply(c)}:function(){return null};function W(c,d){d=c.indexOf(d),0<=d&&c.splice(d,1)}var Z={};function j(c){var d,g,y,b;if(arguments.length===1){if(l(c))return c.slice();if(this===Z&&typeof c=="string")return[c];if(b=Q(c))for(g=[];!(y=b.next()).done;)g.push(y.value);else{if(c==null)return[c];if(typeof(d=c.length)!="number")return[c];for(g=new Array(d);d--;)g[d]=c[d]}}else for(d=arguments.length,g=new Array(d);d--;)g[d]=arguments[d];return g}var ee=typeof Symbol<"u"?function(c){return c[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ne=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],nt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ne),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function U(c,d){this.name=c,this.message=d}function le(c,d){return c+". Errors: "+Object.keys(d).map(function(g){return d[g].toString()}).filter(function(g,y,b){return b.indexOf(g)===y}).join(`
`)}function Y(c,d,g,y){this.failures=d,this.failedKeys=y,this.successCount=g,this.message=le(c,d)}function ue(c,d){this.name="BulkError",this.failures=Object.keys(d).map(function(g){return d[g]}),this.failuresByPos=d,this.message=le(c,this.failures)}k(U).from(Error).extend({toString:function(){return this.name+": "+this.message}}),k(Y).from(U),k(ue).from(U);var _e=nt.reduce(function(c,d){return c[d]=d+"Error",c},{}),ge=U,re=nt.reduce(function(c,d){var g=d+"Error";function y(b,E){this.name=g,b?typeof b=="string"?(this.message="".concat(b).concat(E?`
 `+E:""),this.inner=E||null):typeof b=="object"&&(this.message="".concat(b.name," ").concat(b.message),this.inner=b):(this.message=H[d]||g,this.inner=null)}return k(y).from(ge),c[d]=y,c},{}),Te=(re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError,ne.reduce(function(c,d){return c[d+"Error"]=re[d],c},{}));ne=nt.reduce(function(c,d){return["Syntax","Type","Range"].indexOf(d)===-1&&(c[d+"Error"]=re[d]),c},{});function be(){}function Ie(c){return c}function Ke(c,d){return c==null||c===Ie?d:function(g){return d(c(g))}}function Xe(c,d){return function(){c.apply(this,arguments),d.apply(this,arguments)}}function ft(c,d){return c===be?d:function(){var g=c.apply(this,arguments),y=(g!==void 0&&(arguments[0]=g),this.onsuccess),b=this.onerror,E=(this.onsuccess=null,this.onerror=null,d.apply(this,arguments));return y&&(this.onsuccess=this.onsuccess?Xe(y,this.onsuccess):y),b&&(this.onerror=this.onerror?Xe(b,this.onerror):b),E!==void 0?E:g}}function vt(c,d){return c===be?d:function(){c.apply(this,arguments);var g=this.onsuccess,y=this.onerror;this.onsuccess=this.onerror=null,d.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?Xe(g,this.onsuccess):g),y&&(this.onerror=this.onerror?Xe(y,this.onerror):y)}}function Le(c,d){return c===be?d:function(b){var y=c.apply(this,arguments),b=(u(b,y),this.onsuccess),E=this.onerror,R=(this.onsuccess=null,this.onerror=null,d.apply(this,arguments));return b&&(this.onsuccess=this.onsuccess?Xe(b,this.onsuccess):b),E&&(this.onerror=this.onerror?Xe(E,this.onerror):E),y===void 0?R===void 0?void 0:R:u(y,R)}}function Re(c,d){return c===be?d:function(){return d.apply(this,arguments)!==!1&&c.apply(this,arguments)}}function qe(c,d){return c===be?d:function(){var g=c.apply(this,arguments);if(g&&typeof g.then=="function"){for(var y=this,b=arguments.length,E=new Array(b);b--;)E[b]=arguments[b];return g.then(function(){return d.apply(y,E)})}return d.apply(this,arguments)}}ne.ModifyError=Y,ne.DexieError=U,ne.BulkError=ue;var Oe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Qe(c){Oe=c}var ct={},Je=100,st=typeof Promise>"u"?[]:(nt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[st=crypto.subtle.digest("SHA-512",new Uint8Array([0])),f(st),nt]:[nt,f(nt),nt]),nt=st[0],Os=st[1],Os=Os&&Os.then,Ge=nt&&nt.constructor,gt=!!st[2],ut=function(c,d){Mt.push([c,d]),qt&&(queueMicrotask(Nn),qt=!1)},Nt=!0,qt=!0,wt=[],mt=[],yt=Ie,ot={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:be,pgp:!1,env:{},finalize:be},ze=ot,Mt=[],Rt=0,zt=[];function Ne(c){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var d=this._PSD=ze;if(typeof c!="function"){if(c!==ct)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ye(this,this._value)}else this._state=null,this._value=null,++d.ref,(function g(y,b){try{b(function(E){if(y._state===null){if(E===y)throw new TypeError("A promise cannot be resolved with itself.");var R=y._lib&&Wt();E&&typeof E.then=="function"?g(y,function(V,de){E instanceof Ne?E._then(V,de):E.then(V,de)}):(y._state=!0,y._value=E,cn(y)),R&&dt()}},ye.bind(null,y))}catch(E){ye(y,E)}})(this,c)}var Gt={get:function(){var c=ze,d=Yt;function g(y,b){var E=this,R=!c.global&&(c!==ze||d!==Yt),V=R&&!nr(),de=new Ne(function(xe,fe){An(E,new zn(oe(y,c,R,V),oe(b,c,R,V),xe,fe,c))});return this._consoleTask&&(de._consoleTask=this._consoleTask),de}return g.prototype=ct,g},set:function(c){x(this,"then",c&&c.prototype===ct?Gt:{get:function(){return c},set:Gt.set})}};function zn(c,d,g,y,b){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof d=="function"?d:null,this.resolve=g,this.reject=y,this.psd=b}function ye(c,d){var g,y;mt.push(d),c._state===null&&(g=c._lib&&Wt(),d=yt(d),c._state=!1,c._value=d,y=c,wt.some(function(b){return b._value===y._value})||wt.push(y),cn(c),g)&&dt()}function cn(c){var d=c._listeners;c._listeners=[];for(var g=0,y=d.length;g<y;++g)An(c,d[g]);var b=c._PSD;--b.ref||b.finalize(),Rt===0&&(++Rt,ut(function(){--Rt==0&&it()},[]))}function An(c,d){if(c._state===null)c._listeners.push(d);else{var g=c._state?d.onFulfilled:d.onRejected;if(g===null)return(c._state?d.resolve:d.reject)(c._value);++d.psd.ref,++Rt,ut(St,[g,c,d])}}function St(c,d,g){try{var y,b=d._value;!d._state&&mt.length&&(mt=[]),y=Oe&&d._consoleTask?d._consoleTask.run(function(){return c(b)}):c(b),d._state||mt.indexOf(b)!==-1||(E=>{for(var R=wt.length;R;)if(wt[--R]._value===E._value)return wt.splice(R,1)})(d),g.resolve(y)}catch(E){g.reject(E)}finally{--Rt==0&&it(),--g.psd.ref||g.psd.finalize()}}function Nn(){rt(ot,function(){Wt()&&dt()})}function Wt(){var c=Nt;return qt=Nt=!1,c}function dt(){var c,d,g;do for(;0<Mt.length;)for(c=Mt,Mt=[],g=c.length,d=0;d<g;++d){var y=c[d];y[0].apply(null,y[1])}while(0<Mt.length);qt=Nt=!0}function it(){for(var c=wt,d=(wt=[],c.forEach(function(y){y._PSD.onunhandled.call(null,y._value,y)}),zt.slice(0)),g=d.length;g;)d[--g]()}function Ft(c){return new Ne(ct,!1,c)}function lt(c,d){var g=ze;return function(){var y=Wt(),b=ze;try{return Hn(g,!0),c.apply(this,arguments)}catch(E){d&&d(E)}finally{Hn(b,!1),y&&dt()}}}h(Ne.prototype,{then:Gt,_then:function(c,d){An(this,new zn(null,null,c,d,ze))},catch:function(c){var d,g;return arguments.length===1?this.then(null,c):(d=c,g=arguments[1],typeof d=="function"?this.then(null,function(y){return(y instanceof d?g:Ft)(y)}):this.then(null,function(y){return(y&&y.name===d?g:Ft)(y)}))},finally:function(c){return this.then(function(d){return Ne.resolve(c()).then(function(){return d})},function(d){return Ne.resolve(c()).then(function(){return Ft(d)})})},timeout:function(c,d){var g=this;return c<1/0?new Ne(function(y,b){var E=setTimeout(function(){return b(new re.Timeout(d))},c);g.then(y,b).finally(clearTimeout.bind(null,E))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&x(Ne.prototype,Symbol.toStringTag,"Dexie.Promise"),ot.env=Cs(),h(Ne,{all:function(){var c=j.apply(null,arguments).map(na);return new Ne(function(d,g){c.length===0&&d([]);var y=c.length;c.forEach(function(b,E){return Ne.resolve(b).then(function(R){c[E]=R,--y||d(c)},g)})})},resolve:function(c){return c instanceof Ne?c:c&&typeof c.then=="function"?new Ne(function(d,g){c.then(d,g)}):new Ne(ct,!0,c)},reject:Ft,race:function(){var c=j.apply(null,arguments).map(na);return new Ne(function(d,g){c.map(function(y){return Ne.resolve(y).then(d,g)})})},PSD:{get:function(){return ze},set:function(c){return ze=c}},totalEchoes:{get:function(){return Yt}},newPSD:_n,usePSD:rt,scheduler:{get:function(){return ut},set:function(c){ut=c}},rejectionMapper:{get:function(){return yt},set:function(c){yt=c}},follow:function(c,d){return new Ne(function(g,y){return _n(function(b,E){var R=ze;R.unhandleds=[],R.onunhandled=E,R.finalize=Xe(function(){var V,de=this;V=function(){de.unhandleds.length===0?b():E(de.unhandleds[0])},zt.push(function xe(){V(),zt.splice(zt.indexOf(xe),1)}),++Rt,ut(function(){--Rt==0&&it()},[])},R.finalize),c()},d,g,y)})}}),Ge&&(Ge.allSettled&&x(Ne,"allSettled",function(){var c=j.apply(null,arguments).map(na);return new Ne(function(d){c.length===0&&d([]);var g=c.length,y=new Array(g);c.forEach(function(b,E){return Ne.resolve(b).then(function(R){return y[E]={status:"fulfilled",value:R}},function(R){return y[E]={status:"rejected",reason:R}}).then(function(){return--g||d(y)})})})}),Ge.any&&typeof AggregateError<"u"&&x(Ne,"any",function(){var c=j.apply(null,arguments).map(na);return new Ne(function(d,g){c.length===0&&g(new AggregateError([]));var y=c.length,b=new Array(y);c.forEach(function(E,R){return Ne.resolve(E).then(function(V){return d(V)},function(V){b[R]=V,--y||g(new AggregateError(b))})})})}),Ge.withResolvers)&&(Ne.withResolvers=Ge.withResolvers);var kt={awaits:0,echoes:0,id:0},tn=0,rn=[],Rn=0,Yt=0,$t=0;function _n(c,R,g,y){var b=ze,E=Object.create(b),R=(E.parent=b,E.ref=0,E.global=!1,E.id=++$t,ot.env,E.env=gt?{Promise:Ne,PromiseProp:{value:Ne,configurable:!0,writable:!0},all:Ne.all,race:Ne.race,allSettled:Ne.allSettled,any:Ne.any,resolve:Ne.resolve,reject:Ne.reject}:{},R&&u(E,R),++b.ref,E.finalize=function(){--this.parent.ref||this.parent.finalize()},rt(E,c,g,y));return E.ref===0&&E.finalize(),R}function vn(){return kt.id||(kt.id=++tn),++kt.awaits,kt.echoes+=Je,kt.id}function nr(){return!!kt.awaits&&(--kt.awaits==0&&(kt.id=0),kt.echoes=kt.awaits*Je,!0)}function na(c){return kt.echoes&&c&&c.constructor===Ge?(vn(),c.then(function(d){return nr(),d},function(d){return nr(),He(d)})):c}function xa(){var c=rn[rn.length-1];rn.pop(),Hn(c,!1)}function Hn(c,d){var g,y,b=ze;(d?!kt.echoes||Rn++&&c===ze:!Rn||--Rn&&c===ze)||queueMicrotask(d?(function(E){++Yt,kt.echoes&&--kt.echoes!=0||(kt.echoes=kt.awaits=kt.id=0),rn.push(ze),Hn(E,!0)}).bind(null,c):xa),c!==ze&&(ze=c,b===ot&&(ot.env=Cs()),gt)&&(g=ot.env.Promise,y=c.env,b.global||c.global)&&(Object.defineProperty(s,"Promise",y.PromiseProp),g.all=y.all,g.race=y.race,g.resolve=y.resolve,g.reject=y.reject,y.allSettled&&(g.allSettled=y.allSettled),y.any)&&(g.any=y.any)}function Cs(){var c=s.Promise;return gt?{Promise:c,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:c.all,race:c.race,allSettled:c.allSettled,any:c.any,resolve:c.resolve,reject:c.reject}:{}}function rt(c,d,g,y,b){var E=ze;try{return Hn(c,!0),d(g,y,b)}finally{Hn(E,!1)}}function oe(c,d,g,y){return typeof c!="function"?c:function(){var b=ze;g&&vn(),Hn(d,!0);try{return c.apply(this,arguments)}finally{Hn(b,!1),y&&queueMicrotask(nr)}}}function Be(c){Promise===Ge&&kt.echoes===0?Rn===0?c():enqueueNativeMicroTask(c):setTimeout(c,0)}(""+Os).indexOf("[native code]")===-1&&(vn=nr=be);var He=Ne.reject,Kt="ï¿¿",an="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",un="String expected.",hn=[],Vn="__dbnames",Lr="readonly",Ha="readwrite";function on(c,d){return c?d?function(){return c.apply(this,arguments)&&d.apply(this,arguments)}:c:d}var di={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Va(c){return typeof c!="string"||/\./.test(c)?function(d){return d}:function(d){return d[c]===void 0&&c in d&&delete(d=K(d))[c],d}}function Wd(){throw re.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Dt(c,d){try{var g=Yd(c),y=Yd(d);if(g!==y)return g==="Array"?1:y==="Array"?-1:g==="binary"?1:y==="binary"?-1:g==="string"?1:y==="string"?-1:g==="Date"?1:y!=="Date"?NaN:-1;switch(g){case"number":case"Date":case"string":return d<c?1:c<d?-1:0;case"binary":for(var b=Xd(c),E=Xd(d),R=b.length,V=E.length,de=R<V?R:V,xe=0;xe<de;++xe)if(b[xe]!==E[xe])return b[xe]<E[xe]?-1:1;return R===V?0:R<V?-1:1;case"Array":for(var fe=c,ie=d,he=fe.length,me=ie.length,ve=he<me?he:me,ce=0;ce<ve;++ce){var Se=Dt(fe[ce],ie[ce]);if(Se!==0)return Se}return he===me?0:he<me?-1:1}}catch{}return NaN}function Yd(c){var d=typeof c;return d=="object"&&(ArrayBuffer.isView(c)||(d=O(c))==="ArrayBuffer")?"binary":d}function Xd(c){return c instanceof Uint8Array?c:ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c)}function ko(c,d,g){var y=c.schema.yProps;return y?(d&&0<g.numFailures&&(d=d.filter(function(b,E){return!g.failures[E]})),Promise.all(y.map(function(b){return b=b.updatesTable,d?c.db.table(b).where("k").anyOf(d).delete():c.db.table(b).clear()})).then(function(){return g})):g}Zd.prototype.execute=function(c){var d=this["@@propmod"];if(d.add!==void 0){var g=d.add;if(l(g))return a(a([],l(c)?c:[],!0),g).sort();if(typeof g=="number")return(Number(c)||0)+g;if(typeof g=="bigint")try{return BigInt(c)+g}catch{return BigInt(0)+g}throw new TypeError("Invalid term ".concat(g))}if(d.remove!==void 0){var y=d.remove;if(l(y))return l(c)?c.filter(function(b){return!y.includes(b)}).sort():[];if(typeof y=="number")return Number(c)-y;if(typeof y=="bigint")try{return BigInt(c)-y}catch{return BigInt(0)-y}throw new TypeError("Invalid subtrahend ".concat(y))}return g=(g=d.replacePrefix)==null?void 0:g[0],g&&typeof c=="string"&&c.startsWith(g)?d.replacePrefix[1]+c.substring(g.length):c};var fi=Zd;function Zd(c){this["@@propmod"]=c}function Qd(c,d){for(var g=i(d),y=g.length,b=!1,E=0;E<y;++E){var R=g[E],V=d[R],de=L(c,R);V instanceof fi?(N(c,R,V.execute(de)),b=!0):de!==V&&(N(c,R,V),b=!0)}return b}sn.prototype._trans=function(c,d,g){var y=this._tx||ze.trans,b=this.name,E=Oe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(c==="readonly"?"read":"write"," ").concat(this.name));function R(xe,fe,ie){if(ie.schema[b])return d(ie.idbtrans,ie);throw new re.NotFound("Table "+b+" not part of transaction")}var V=Wt();try{var de=y&&y.db._novip===this.db._novip?y===ze.trans?y._promise(c,R,g):_n(function(){return y._promise(c,R,g)},{trans:y,transless:ze.transless||ze}):(function xe(fe,ie,he,me){if(fe.idbdb&&(fe._state.openComplete||ze.letThrough||fe._vip)){var ve=fe._createTransaction(ie,he,fe._dbSchema);try{ve.create(),fe._state.PR1398_maxLoop=3}catch(ce){return ce.name===_e.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,ie,he,me)})):He(ce)}return ve._promise(ie,function(ce,Se){return _n(function(){return ze.trans=ve,me(ce,Se,ve)})}).then(function(ce){if(ie==="readwrite")try{ve.idbtrans.commit()}catch{}return ie==="readonly"?ce:ve._completion.then(function(){return ce})})}if(fe._state.openComplete)return He(new re.DatabaseClosed(fe._state.dbOpenError));if(!fe._state.isBeingOpened){if(!fe._state.autoOpen)return He(new re.DatabaseClosed);fe.open().catch(be)}return fe._state.dbReadyPromise.then(function(){return xe(fe,ie,he,me)})})(this.db,c,[this.name],R);return E&&(de._consoleTask=E,de=de.catch(function(xe){return console.trace(xe),He(xe)})),de}finally{V&&dt()}},sn.prototype.get=function(c,d){var g=this;return c&&c.constructor===Object?this.where(c).first(d):c==null?He(new re.Type("Invalid argument to Table.get()")):this._trans("readonly",function(y){return g.core.get({trans:y,key:c}).then(function(b){return g.hook.reading.fire(b)})}).then(d)},sn.prototype.where=function(c){if(typeof c=="string")return new this.db.WhereClause(this,c);if(l(c))return new this.db.WhereClause(this,"[".concat(c.join("+"),"]"));var d=i(c);if(d.length===1)return this.where(d[0]).equals(c[d[0]]);var g=this.schema.indexes.concat(this.schema.primKey).filter(function(V){if(V.compound&&d.every(function(xe){return 0<=V.keyPath.indexOf(xe)})){for(var de=0;de<d.length;++de)if(d.indexOf(V.keyPath[de])===-1)return!1;return!0}return!1}).sort(function(V,de){return V.keyPath.length-de.keyPath.length})[0];if(g&&this.db._maxKey!==Kt)return R=g.keyPath.slice(0,d.length),this.where(R).equals(R.map(function(V){return c[V]}));!g&&Oe&&console.warn("The query ".concat(JSON.stringify(c)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(d.join("+"),"]"));var y=this.schema.idxByName;function b(V,de){return Dt(V,de)===0}var R=d.reduce(function(fe,de){var xe=fe[0],fe=fe[1],ie=y[de],he=c[de];return[xe||ie,xe||!ie?on(fe,ie&&ie.multi?function(me){return me=L(me,de),l(me)&&me.some(function(ve){return b(he,ve)})}:function(me){return b(he,L(me,de))}):fe]},[null,null]),E=R[0],R=R[1];return E?this.where(E.name).equals(c[E.keyPath]).filter(R):g?this.filter(R):this.where(d).equals("")},sn.prototype.filter=function(c){return this.toCollection().and(c)},sn.prototype.count=function(c){return this.toCollection().count(c)},sn.prototype.offset=function(c){return this.toCollection().offset(c)},sn.prototype.limit=function(c){return this.toCollection().limit(c)},sn.prototype.each=function(c){return this.toCollection().each(c)},sn.prototype.toArray=function(c){return this.toCollection().toArray(c)},sn.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},sn.prototype.orderBy=function(c){return new this.db.Collection(new this.db.WhereClause(this,l(c)?"[".concat(c.join("+"),"]"):c))},sn.prototype.reverse=function(){return this.toCollection().reverse()},sn.prototype.mapToClass=function(c){for(var d=this.db,g=this.name,y=((this.schema.mappedClass=c).prototype instanceof Wd&&(c=(R=>{var V=fe,de=R;if(typeof de!="function"&&de!==null)throw new TypeError("Class extends value "+String(de)+" is not a constructor or null");function xe(){this.constructor=V}function fe(){return R!==null&&R.apply(this,arguments)||this}return n(V,de),V.prototype=de===null?Object.create(de):(xe.prototype=de.prototype,new xe),Object.defineProperty(fe.prototype,"db",{get:function(){return d},enumerable:!1,configurable:!0}),fe.prototype.table=function(){return g},fe})(c)),new Set),b=c.prototype;b;b=f(b))Object.getOwnPropertyNames(b).forEach(function(R){return y.add(R)});function E(R){if(!R)return R;var V,de=Object.create(c.prototype);for(V in R)if(!y.has(V))try{de[V]=R[V]}catch{}return de}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=E,this.hook("reading",E),c},sn.prototype.defineClass=function(){return this.mapToClass(function(c){u(this,c)})},sn.prototype.add=function(c,d){var g=this,y=this.schema.primKey,b=y.auto,E=y.keyPath,R=c;return E&&b&&(R=Va(E)(c)),this._trans("readwrite",function(V){return g.core.mutate({trans:V,type:"add",keys:d!=null?[d]:null,values:[R]})}).then(function(V){return V.numFailures?Ne.reject(V.failures[0]):V.lastResult}).then(function(V){if(E)try{N(c,E,V)}catch{}return V})},sn.prototype.upsert=function(c,d){var g=this,y=this.schema.primKey.keyPath;return this._trans("readwrite",function(b){return g.core.get({trans:b,key:c}).then(function(E){var R=E??{};return Qd(R,d),y&&N(R,y,c),g.core.mutate({trans:b,type:"put",values:[R],keys:[c],upsert:!0,updates:{keys:[c],changeSpecs:[d]}}).then(function(V){return V.numFailures?Ne.reject(V.failures[0]):!!E})})})},sn.prototype.update=function(c,d){return typeof c!="object"||l(c)?this.where(":id").equals(c).modify(d):(c=L(c,this.schema.primKey.keyPath))===void 0?He(new re.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(d)},sn.prototype.put=function(c,d){var g=this,y=this.schema.primKey,b=y.auto,E=y.keyPath,R=c;return E&&b&&(R=Va(E)(c)),this._trans("readwrite",function(V){return g.core.mutate({trans:V,type:"put",values:[R],keys:d!=null?[d]:null})}).then(function(V){return V.numFailures?Ne.reject(V.failures[0]):V.lastResult}).then(function(V){if(E)try{N(c,E,V)}catch{}return V})},sn.prototype.delete=function(c){var d=this;return this._trans("readwrite",function(g){return d.core.mutate({trans:g,type:"delete",keys:[c]}).then(function(y){return ko(d,[c],y)}).then(function(y){return y.numFailures?Ne.reject(y.failures[0]):void 0})})},sn.prototype.clear=function(){var c=this;return this._trans("readwrite",function(d){return c.core.mutate({trans:d,type:"deleteRange",range:di}).then(function(g){return ko(c,null,g)})}).then(function(d){return d.numFailures?Ne.reject(d.failures[0]):void 0})},sn.prototype.bulkGet=function(c){var d=this;return this._trans("readonly",function(g){return d.core.getMany({keys:c,trans:g}).then(function(y){return y.map(function(b){return d.hook.reading.fire(b)})})})},sn.prototype.bulkAdd=function(c,d,g){var y=this,b=Array.isArray(d)?d:void 0,E=(g=g||(b?void 0:d))?g.allKeys:void 0;return this._trans("readwrite",function(R){var V=y.schema.primKey,xe=V.auto,V=V.keyPath;if(V&&b)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(b&&b.length!==c.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=V&&xe?c.map(Va(V)):c;return y.core.mutate({trans:R,type:"add",keys:b,values:xe,wantResults:E}).then(function(fe){var ie=fe.numFailures,he=fe.failures;if(ie===0)return E?fe.results:fe.lastResult;throw new ue("".concat(y.name,".bulkAdd(): ").concat(ie," of ").concat(de," operations failed"),he)})})},sn.prototype.bulkPut=function(c,d,g){var y=this,b=Array.isArray(d)?d:void 0,E=(g=g||(b?void 0:d))?g.allKeys:void 0;return this._trans("readwrite",function(R){var V=y.schema.primKey,xe=V.auto,V=V.keyPath;if(V&&b)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(b&&b.length!==c.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=V&&xe?c.map(Va(V)):c;return y.core.mutate({trans:R,type:"put",keys:b,values:xe,wantResults:E}).then(function(fe){var ie=fe.numFailures,he=fe.failures;if(ie===0)return E?fe.results:fe.lastResult;throw new ue("".concat(y.name,".bulkPut(): ").concat(ie," of ").concat(de," operations failed"),he)})})},sn.prototype.bulkUpdate=function(c){var d=this,g=this.core,y=c.map(function(R){return R.key}),b=c.map(function(R){return R.changes}),E=[];return this._trans("readwrite",function(R){return g.getMany({trans:R,keys:y,cache:"clone"}).then(function(V){var de=[],xe=[],fe=(c.forEach(function(ie,he){var me=ie.key,ve=ie.changes,ce=V[he];if(ce){for(var Se=0,Ee=Object.keys(ve);Se<Ee.length;Se++){var we=Ee[Se],Ce=ve[we];if(we===d.schema.primKey.keyPath){if(Dt(Ce,me)!==0)throw new re.Constraint("Cannot update primary key in bulkUpdate()")}else N(ce,we,Ce)}E.push(he),de.push(me),xe.push(ce)}}),de.length);return g.mutate({trans:R,type:"put",keys:de,values:xe,updates:{keys:y,changeSpecs:b}}).then(function(ie){var he=ie.numFailures,me=ie.failures;if(he===0)return fe;for(var ve=0,ce=Object.keys(me);ve<ce.length;ve++){var Se,Ee=ce[ve],we=E[Number(Ee)];we!=null&&(Se=me[Ee],delete me[Ee],me[we]=Se)}throw new ue("".concat(d.name,".bulkUpdate(): ").concat(he," of ").concat(fe," operations failed"),me)})})})},sn.prototype.bulkDelete=function(c){var d=this,g=c.length;return this._trans("readwrite",function(y){return d.core.mutate({trans:y,type:"delete",keys:c}).then(function(b){return ko(d,c,b)})}).then(function(y){var b=y.numFailures,E=y.failures;if(b===0)return y.lastResult;throw new ue("".concat(d.name,".bulkDelete(): ").concat(b," of ").concat(g," operations failed"),E)})};var Jd=sn;function sn(){}function vi(c){function d(R,V){if(V){for(var de=arguments.length,xe=new Array(de-1);--de;)xe[de-1]=arguments[de];return g[R].subscribe.apply(null,xe),c}if(typeof R=="string")return g[R]}var g={};d.addEventType=E;for(var y=1,b=arguments.length;y<b;++y)E(arguments[y]);return d;function E(R,V,de){var xe,fe;if(typeof R!="object")return V=V||Re,fe={subscribers:[],fire:de=de||be,subscribe:function(ie){fe.subscribers.indexOf(ie)===-1&&(fe.subscribers.push(ie),fe.fire=V(fe.fire,ie))},unsubscribe:function(ie){fe.subscribers=fe.subscribers.filter(function(he){return he!==ie}),fe.fire=fe.subscribers.reduce(V,de)}},g[R]=d[R]=fe;i(xe=R).forEach(function(ie){var he=xe[ie];if(l(he))E(ie,xe[ie][0],xe[ie][1]);else{if(he!=="asap")throw new re.InvalidArgument("Invalid event config");var me=E(ie,Ie,function(){for(var ve=arguments.length,ce=new Array(ve);ve--;)ce[ve]=arguments[ve];me.subscribers.forEach(function(Se){z(function(){Se.apply(null,ce)})})})}})}}function hi(c,d){return k(d).from({prototype:c}),d}function Is(c,d){return!(c.filter||c.algorithm||c.or)&&(d?c.justLimit:!c.replayFilter)}function ic(c,d){c.filter=on(c.filter,d)}function oc(c,d,g){var y=c.replayFilter;c.replayFilter=y?function(){return on(y(),d())}:d,c.justLimit=g&&!y}function So(c,d){if(c.isPrimKey)return d.primaryKey;var g=d.getIndexByKeyPath(c.index);if(g)return g;throw new re.Schema("KeyPath "+c.index+" on object store "+d.name+" is not indexed")}function $d(c,d,g){var y=So(c,d.schema);return d.openCursor({trans:g,values:!c.keysOnly,reverse:c.dir==="prev",unique:!!c.unique,query:{index:y,range:c.range}})}function Eo(c,d,g,y){var b,E,R=c.replayFilter?on(c.filter,c.replayFilter()):c.filter;return c.or?(b={},E=function(V,de,xe){var fe,ie;R&&!R(de,xe,function(he){return de.stop(he)},function(he){return de.fail(he)})||((ie=""+(fe=de.primaryKey))=="[object ArrayBuffer]"&&(ie=""+new Uint8Array(fe)),p(b,ie))||(b[ie]=!0,d(V,de,xe))},Promise.all([c.or._iterate(E,g),ef($d(c,y,g),c.algorithm,E,!c.keysOnly&&c.valueMapper)])):ef($d(c,y,g),on(c.algorithm,R),d,!c.keysOnly&&c.valueMapper)}function ef(c,d,g,y){var b=lt(y?function(E,R,V){return g(y(E),R,V)}:g);return c.then(function(E){if(E)return E.start(function(){var R=function(){return E.continue()};d&&!d(E,function(V){return R=V},function(V){E.stop(V),R=be},function(V){E.fail(V),R=be})||b(E.value,E,function(V){return R=V}),R()})})}Ht.prototype._read=function(c,d){var g=this._ctx;return g.error?g.table._trans(null,He.bind(null,g.error)):g.table._trans("readonly",c).then(d)},Ht.prototype._write=function(c){var d=this._ctx;return d.error?d.table._trans(null,He.bind(null,d.error)):d.table._trans("readwrite",c,"locked")},Ht.prototype._addAlgorithm=function(c){var d=this._ctx;d.algorithm=on(d.algorithm,c)},Ht.prototype._iterate=function(c,d){return Eo(this._ctx,c,d,this._ctx.table.core)},Ht.prototype.clone=function(c){var d=Object.create(this.constructor.prototype),g=Object.create(this._ctx);return c&&u(g,c),d._ctx=g,d},Ht.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ht.prototype.each=function(c){var d=this._ctx;return this._read(function(g){return Eo(d,c,g,d.table.core)})},Ht.prototype.count=function(c){var d=this;return this._read(function(g){var y,b=d._ctx,E=b.table.core;return Is(b,!0)?E.count({trans:g,query:{index:So(b,E.schema),range:b.range}}).then(function(R){return Math.min(R,b.limit)}):(y=0,Eo(b,function(){return++y,!1},g,E).then(function(){return y}))}).then(c)},Ht.prototype.sortBy=function(c,d){var g=c.split(".").reverse(),y=g[0],b=g.length-1;function E(de,xe){return xe?E(de[g[xe]],xe-1):de[y]}var R=this._ctx.dir==="next"?1:-1;function V(de,xe){return Dt(E(de,b),E(xe,b))*R}return this.toArray(function(de){return de.sort(V)}).then(d)},Ht.prototype.toArray=function(c){var d=this;return this._read(function(g){var y,b,E,R=d._ctx;return R.dir==="next"&&Is(R,!0)&&0<R.limit?(y=R.valueMapper,b=So(R,R.table.core.schema),R.table.core.query({trans:g,limit:R.limit,values:!0,query:{index:b,range:R.range}}).then(function(V){return V=V.result,y?V.map(y):V})):(E=[],Eo(R,function(V){return E.push(V)},g,R.table.core).then(function(){return E}))},c)},Ht.prototype.offset=function(c){var d=this._ctx;return c<=0||(d.offset+=c,Is(d)?oc(d,function(){var g=c;return function(y,b){return g===0||(g===1?--g:b(function(){y.advance(g),g=0}),!1)}}):oc(d,function(){var g=c;return function(){return--g<0}})),this},Ht.prototype.limit=function(c){return this._ctx.limit=Math.min(this._ctx.limit,c),oc(this._ctx,function(){var d=c;return function(g,y,b){return--d<=0&&y(b),0<=d}},!0),this},Ht.prototype.until=function(c,d){return ic(this._ctx,function(g,y,b){return!c(g.value)||(y(b),d)}),this},Ht.prototype.first=function(c){return this.limit(1).toArray(function(d){return d[0]}).then(c)},Ht.prototype.last=function(c){return this.reverse().first(c)},Ht.prototype.filter=function(c){var d;return ic(this._ctx,function(g){return c(g.value)}),(d=this._ctx).isMatch=on(d.isMatch,c),this},Ht.prototype.and=function(c){return this.filter(c)},Ht.prototype.or=function(c){return new this.db.WhereClause(this._ctx.table,c,this)},Ht.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ht.prototype.desc=function(){return this.reverse()},Ht.prototype.eachKey=function(c){var d=this._ctx;return d.keysOnly=!d.isMatch,this.each(function(g,y){c(y.key,y)})},Ht.prototype.eachUniqueKey=function(c){return this._ctx.unique="unique",this.eachKey(c)},Ht.prototype.eachPrimaryKey=function(c){var d=this._ctx;return d.keysOnly=!d.isMatch,this.each(function(g,y){c(y.primaryKey,y)})},Ht.prototype.keys=function(c){var d=this._ctx,g=(d.keysOnly=!d.isMatch,[]);return this.each(function(y,b){g.push(b.key)}).then(function(){return g}).then(c)},Ht.prototype.primaryKeys=function(c){var d=this._ctx;if(d.dir==="next"&&Is(d,!0)&&0<d.limit)return this._read(function(y){var b=So(d,d.table.core.schema);return d.table.core.query({trans:y,values:!1,limit:d.limit,query:{index:b,range:d.range}})}).then(function(y){return y.result}).then(c);d.keysOnly=!d.isMatch;var g=[];return this.each(function(y,b){g.push(b.primaryKey)}).then(function(){return g}).then(c)},Ht.prototype.uniqueKeys=function(c){return this._ctx.unique="unique",this.keys(c)},Ht.prototype.firstKey=function(c){return this.limit(1).keys(function(d){return d[0]}).then(c)},Ht.prototype.lastKey=function(c){return this.reverse().firstKey(c)},Ht.prototype.distinct=function(){var c,d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];return d&&d.multi&&(c={},ic(this._ctx,function(y){var y=y.primaryKey.toString(),b=p(c,y);return c[y]=!0,!b})),this},Ht.prototype.modify=function(c){var d=this,g=this._ctx;return this._write(function(y){function b(ce,Se){var Ee=Se.failures;he+=ce-Se.numFailures;for(var we=0,Ce=i(Ee);we<Ce.length;we++){var De=Ce[we];ie.push(Ee[De])}}var E=typeof c=="function"?c:function(ce){return Qd(ce,c)},R=g.table.core,fe=R.schema.primaryKey,V=fe.outbound,de=fe.extractKey,xe=200,fe=d.db._options.modifyChunkSize,ie=(fe&&(xe=typeof fe=="object"?fe[R.name]||fe["*"]||200:fe),[]),he=0,me=[],ve=c===tf;return d.clone().primaryKeys().then(function(ce){function Se(we){var Ce=Math.min(xe,ce.length-we),De=ce.slice(we,we+Ce);return(ve?Promise.resolve([]):R.getMany({trans:y,keys:De,cache:"immutable"})).then(function(Ve){var Ue=[],je=[],Ze=V?[]:null,Ye=ve?De:[];if(!ve)for(var Fe=0;Fe<Ce;++Fe){var $e=Ve[Fe],jt={value:K($e),primKey:ce[we+Fe]};E.call(jt,jt.value,jt)!==!1&&(jt.value==null?Ye.push(ce[we+Fe]):V||Dt(de($e),de(jt.value))===0?(je.push(jt.value),V&&Ze.push(ce[we+Fe])):(Ye.push(ce[we+Fe]),Ue.push(jt.value)))}return Promise.resolve(0<Ue.length&&R.mutate({trans:y,type:"add",values:Ue}).then(function(Vt){for(var pt in Vt.failures)Ye.splice(parseInt(pt),1);b(Ue.length,Vt)})).then(function(){return(0<je.length||Ee&&typeof c=="object")&&R.mutate({trans:y,type:"put",keys:Ze,values:je,criteria:Ee,changeSpec:typeof c!="function"&&c,isAdditionalChunk:0<we}).then(function(Vt){return b(je.length,Vt)})}).then(function(){return(0<Ye.length||Ee&&ve)&&R.mutate({trans:y,type:"delete",keys:Ye,criteria:Ee,isAdditionalChunk:0<we}).then(function(Vt){return ko(g.table,Ye,Vt)}).then(function(Vt){return b(Ye.length,Vt)})}).then(function(){return ce.length>we+Ce&&Se(we+xe)})})}var Ee=Is(g)&&g.limit===1/0&&(typeof c!="function"||ve)&&{index:g.index,range:g.range};return Se(0).then(function(){if(0<ie.length)throw new Y("Error modifying one or more objects",ie,he,me);return ce.length})})})},Ht.prototype.delete=function(){var c=this._ctx,d=c.range;return!Is(c)||c.table.schema.yProps||!c.isPrimKey&&d.type!==3?this.modify(tf):this._write(function(g){var y=c.table.core.schema.primaryKey,b=d;return c.table.core.count({trans:g,query:{index:y,range:b}}).then(function(E){return c.table.core.mutate({trans:g,type:"deleteRange",range:b}).then(function(de){var V=de.failures,de=de.numFailures;if(de)throw new Y("Could not delete some values",Object.keys(V).map(function(xe){return V[xe]}),E-de);return E-de})})})};var um=Ht;function Ht(){}var tf=function(c,d){return d.value=null};function dm(c,d){return c<d?-1:c===d?0:1}function fm(c,d){return d<c?-1:c===d?0:1}function rr(c,d,g){return c=c instanceof rf?new c.Collection(c):c,c._ctx.error=new(g||TypeError)(d),c}function Ps(c){return new c.Collection(c,function(){return nf("")}).limit(0)}function Ao(me,d,g,y){var b,E,R,V,de,xe,fe,ie=g.length;if(!g.every(function(ce){return typeof ce=="string"}))return rr(me,un);function he(ce){b=ce==="next"?function(Ee){return Ee.toUpperCase()}:function(Ee){return Ee.toLowerCase()},E=ce==="next"?function(Ee){return Ee.toLowerCase()}:function(Ee){return Ee.toUpperCase()},R=ce==="next"?dm:fm;var Se=g.map(function(Ee){return{lower:E(Ee),upper:b(Ee)}}).sort(function(Ee,we){return R(Ee.lower,we.lower)});V=Se.map(function(Ee){return Ee.upper}),de=Se.map(function(Ee){return Ee.lower}),fe=(xe=ce)==="next"?"":y}he("next");var me=new me.Collection(me,function(){return ka(V[0],de[ie-1]+y)}),ve=(me._ondirectionchange=function(ce){he(ce)},0);return me._addAlgorithm(function(ce,Se,Ee){var we=ce.key;if(typeof we=="string"){var Ce=E(we);if(d(Ce,de,ve))return!0;for(var De=null,Ve=ve;Ve<ie;++Ve){var Ue=((je,Ze,Ye,Fe,$e,jt)=>{for(var Vt=Math.min(je.length,Fe.length),pt=-1,Ct=0;Ct<Vt;++Ct){var dn=Ze[Ct];if(dn!==Fe[Ct])return $e(je[Ct],Ye[Ct])<0?je.substr(0,Ct)+Ye[Ct]+Ye.substr(Ct+1):$e(je[Ct],Fe[Ct])<0?je.substr(0,Ct)+Fe[Ct]+Ye.substr(Ct+1):0<=pt?je.substr(0,pt)+Ze[pt]+Ye.substr(pt+1):null;$e(je[Ct],dn)<0&&(pt=Ct)}return Vt<Fe.length&&jt==="next"?je+Ye.substr(je.length):Vt<je.length&&jt==="prev"?je.substr(0,Ye.length):pt<0?null:je.substr(0,pt)+Fe[pt]+Ye.substr(pt+1)})(we,Ce,V[Ve],de[Ve],R,xe);Ue===null&&De===null?ve=Ve+1:(De===null||0<R(De,Ue))&&(De=Ue)}Se(De!==null?function(){ce.continue(De+fe)}:Ee)}return!1}),me}function ka(c,d,g,y){return{type:2,lower:c,upper:d,lowerOpen:g,upperOpen:y}}function nf(c){return{type:1,lower:c,upper:c}}Object.defineProperty(bn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),bn.prototype.between=function(c,d,g,y){g=g!==!1,y=y===!0;try{return 0<this._cmp(c,d)||this._cmp(c,d)===0&&(g||y)&&(!g||!y)?Ps(this):new this.Collection(this,function(){return ka(c,d,!g,!y)})}catch{return rr(this,an)}},bn.prototype.equals=function(c){return c==null?rr(this,an):new this.Collection(this,function(){return nf(c)})},bn.prototype.above=function(c){return c==null?rr(this,an):new this.Collection(this,function(){return ka(c,void 0,!0)})},bn.prototype.aboveOrEqual=function(c){return c==null?rr(this,an):new this.Collection(this,function(){return ka(c,void 0,!1)})},bn.prototype.below=function(c){return c==null?rr(this,an):new this.Collection(this,function(){return ka(void 0,c,!1,!0)})},bn.prototype.belowOrEqual=function(c){return c==null?rr(this,an):new this.Collection(this,function(){return ka(void 0,c)})},bn.prototype.startsWith=function(c){return typeof c!="string"?rr(this,un):this.between(c,c+Kt,!0,!0)},bn.prototype.startsWithIgnoreCase=function(c){return c===""?this.startsWith(c):Ao(this,function(d,g){return d.indexOf(g[0])===0},[c],Kt)},bn.prototype.equalsIgnoreCase=function(c){return Ao(this,function(d,g){return d===g[0]},[c],"")},bn.prototype.anyOfIgnoreCase=function(){var c=j.apply(Z,arguments);return c.length===0?Ps(this):Ao(this,function(d,g){return g.indexOf(d)!==-1},c,"")},bn.prototype.startsWithAnyOfIgnoreCase=function(){var c=j.apply(Z,arguments);return c.length===0?Ps(this):Ao(this,function(d,g){return g.some(function(y){return d.indexOf(y)===0})},c,Kt)},bn.prototype.anyOf=function(){var c,d,g=this,y=j.apply(Z,arguments),b=this._cmp;try{y.sort(b)}catch{return rr(this,an)}return y.length===0?Ps(this):((c=new this.Collection(this,function(){return ka(y[0],y[y.length-1])}))._ondirectionchange=function(E){b=E==="next"?g._ascending:g._descending,y.sort(b)},d=0,c._addAlgorithm(function(E,R,V){for(var de=E.key;0<b(de,y[d]);)if(++d===y.length)return R(V),!1;return b(de,y[d])===0||(R(function(){E.continue(y[d])}),!1)}),c)},bn.prototype.notEqual=function(c){return this.inAnyRange([[-1/0,c],[c,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},bn.prototype.noneOf=function(){var c=j.apply(Z,arguments);if(c.length===0)return new this.Collection(this);try{c.sort(this._ascending)}catch{return rr(this,an)}var d=c.reduce(function(g,y){return g?g.concat([[g[g.length-1][1],y]]):[[-1/0,y]]},null);return d.push([c[c.length-1],this.db._maxKey]),this.inAnyRange(d,{includeLowers:!1,includeUppers:!1})},bn.prototype.inAnyRange=function(c,Ee){var g=this,y=this._cmp,b=this._ascending,E=this._descending,R=this._min,V=this._max;if(c.length===0)return Ps(this);if(!c.every(function(we){return we[0]!==void 0&&we[1]!==void 0&&b(we[0],we[1])<=0}))return rr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var de=!Ee||Ee.includeLowers!==!1,xe=Ee&&Ee.includeUppers===!0,fe,ie=b;function he(we,Ce){return ie(we[0],Ce[0])}try{(fe=c.reduce(function(we,Ce){for(var De=0,Ve=we.length;De<Ve;++De){var Ue=we[De];if(y(Ce[0],Ue[1])<0&&0<y(Ce[1],Ue[0])){Ue[0]=R(Ue[0],Ce[0]),Ue[1]=V(Ue[1],Ce[1]);break}}return De===Ve&&we.push(Ce),we},[])).sort(he)}catch{return rr(this,an)}var me=0,ve=xe?function(we){return 0<b(we,fe[me][1])}:function(we){return 0<=b(we,fe[me][1])},ce=de?function(we){return 0<E(we,fe[me][0])}:function(we){return 0<=E(we,fe[me][0])},Se=ve,Ee=new this.Collection(this,function(){return ka(fe[0][0],fe[fe.length-1][1],!de,!xe)});return Ee._ondirectionchange=function(we){ie=we==="next"?(Se=ve,b):(Se=ce,E),fe.sort(he)},Ee._addAlgorithm(function(we,Ce,De){for(var Ve,Ue=we.key;Se(Ue);)if(++me===fe.length)return Ce(De),!1;return!ve(Ve=Ue)&&!ce(Ve)||(g._cmp(Ue,fe[me][1])===0||g._cmp(Ue,fe[me][0])===0||Ce(function(){ie===b?we.continue(fe[me][0]):we.continue(fe[me][1])}),!1)}),Ee},bn.prototype.startsWithAnyOf=function(){var c=j.apply(Z,arguments);return c.every(function(d){return typeof d=="string"})?c.length===0?Ps(this):this.inAnyRange(c.map(function(d){return[d,d+Kt]})):rr(this,"startsWithAnyOf() only works with strings")};var rf=bn;function bn(){}function zr(c){return lt(function(d){return pi(d),c(d.target.error),!1})}function pi(c){c.stopPropagation&&c.stopPropagation(),c.preventDefault&&c.preventDefault()}var gi="storagemutated",lc="x-storagemutated-1",Sa=vi(null,gi),vm=(jr.prototype._lock=function(){return S(!ze.global),++this._reculock,this._reculock!==1||ze.global||(ze.lockOwnerFor=this),this},jr.prototype._unlock=function(){if(S(!ze.global),--this._reculock==0)for(ze.global||(ze.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var c=this._blockedFuncs.shift();try{rt(c[1],c[0])}catch{}}return this},jr.prototype._locked=function(){return this._reculock&&ze.lockOwnerFor!==this},jr.prototype.create=function(c){var d=this;if(this.mode){var g=this.db.idbdb,y=this.db._state.dbOpenError;if(S(!this.idbtrans),!c&&!g)switch(y&&y.name){case"DatabaseClosedError":throw new re.DatabaseClosed(y);case"MissingAPIError":throw new re.MissingAPI(y.message,y);default:throw new re.OpenFailed(y)}if(!this.active)throw new re.TransactionInactive;S(this._completion._state===null),(c=this.idbtrans=c||(this.db.core||g).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=lt(function(b){pi(b),d._reject(c.error)}),c.onabort=lt(function(b){pi(b),d.active&&d._reject(new re.Abort(c.error)),d.active=!1,d.on("abort").fire(b)}),c.oncomplete=lt(function(){d.active=!1,d._resolve(),"mutatedParts"in c&&Sa.storagemutated.fire(c.mutatedParts)})}return this},jr.prototype._promise=function(c,d,g){var y,b=this;return c==="readwrite"&&this.mode!=="readwrite"?He(new re.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ne(function(E,R){b._blockedFuncs.push([function(){b._promise(c,d,g).then(E,R)},ze])}):g?_n(function(){var E=new Ne(function(R,V){b._lock();var de=d(R,V,b);de&&de.then&&de.then(R,V)});return E.finally(function(){return b._unlock()}),E._lib=!0,E}):((y=new Ne(function(E,R){var V=d(E,R,b);V&&V.then&&V.then(E,R)}))._lib=!0,y):He(new re.TransactionInactive)},jr.prototype._root=function(){return this.parent?this.parent._root():this},jr.prototype.waitFor=function(c){var d,g=this._root(),y=Ne.resolve(c),b=(g._waitingFor?g._waitingFor=g._waitingFor.then(function(){return y}):(g._waitingFor=y,g._waitingQueue=[],d=g.idbtrans.objectStore(g.storeNames[0]),(function E(){for(++g._spinCount;g._waitingQueue.length;)g._waitingQueue.shift()();g._waitingFor&&(d.get(-1/0).onsuccess=E)})()),g._waitingFor);return new Ne(function(E,R){y.then(function(V){return g._waitingQueue.push(lt(E.bind(null,V)))},function(V){return g._waitingQueue.push(lt(R.bind(null,V)))}).finally(function(){g._waitingFor===b&&(g._waitingFor=null)})})},jr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new re.Abort))},jr.prototype.table=function(c){var d=this._memoizedTables||(this._memoizedTables={});if(p(d,c))return d[c];var g=this.schema[c];if(g)return(g=new this.db.Table(c,g,this)).core=this.db.core.table(c),d[c]=g;throw new re.NotFound("Table "+c+" not part of transaction")},jr);function jr(){}function cc(c,d,g,y,b,E,R,V){return{name:c,keyPath:d,unique:g,multi:y,auto:b,compound:E,src:(g&&!R?"&":"")+(y?"*":"")+(b?"++":"")+af(d),type:V}}function af(c){return typeof c=="string"?c:c?"["+[].join.call(c,"+")+"]":""}function uc(c,d,g){return{name:c,primKey:d,indexes:g,mappedClass:null,idxByName:(y=function(b){return[b.name,b]},g.reduce(function(b,E,R){return E=y(E,R),E&&(b[E[0]]=E[1]),b},{}))};var y}var mi=function(c){try{return c.only([[]]),mi=function(){return[[]]},[[]]}catch{return mi=function(){return Kt},Kt}};function dc(c){return c==null?function(){}:typeof c=="string"?(d=c).split(".").length===1?function(g){return g[d]}:function(g){return L(g,d)}:function(g){return L(g,c)};var d}function sf(c){return[].slice.call(c)}var hm=0;function yi(c){return c==null?":id":typeof c=="string"?c:"[".concat(c.join("+"),"]")}function pm(c,d,de){function y(ve){if(ve.type===3)return null;if(ve.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ie=ve.lower,he=ve.upper,me=ve.lowerOpen,ve=ve.upperOpen;return ie===void 0?he===void 0?null:d.upperBound(he,!!ve):he===void 0?d.lowerBound(ie,!!me):d.bound(ie,he,!!me,!!ve)}function b(fe){var ie,he=fe.name;return{name:he,schema:fe,mutate:function(me){var ve=me.trans,ce=me.type,Se=me.keys,Ee=me.values,we=me.range;return new Promise(function(Ce,De){Ce=lt(Ce);var Ve=ve.objectStore(he),Ue=Ve.keyPath==null,je=ce==="put"||ce==="add";if(!je&&ce!=="delete"&&ce!=="deleteRange")throw new Error("Invalid operation type: "+ce);var Ze,Ye=(Se||Ee||{length:1}).length;if(Se&&Ee&&Se.length!==Ee.length)throw new Error("Given keys array must have same length as given values array.");if(Ye===0)return Ce({numFailures:0,failures:{},results:[],lastResult:void 0});function Fe(fn){++Vt,pi(fn)}var $e=[],jt=[],Vt=0;if(ce==="deleteRange"){if(we.type===4)return Ce({numFailures:Vt,failures:jt,results:[],lastResult:void 0});we.type===3?$e.push(Ze=Ve.clear()):$e.push(Ze=Ve.delete(y(we)))}else{var Ue=je?Ue?[Ee,Se]:[Ee,null]:[Se,null],pt=Ue[0],Ct=Ue[1];if(je)for(var dn=0;dn<Ye;++dn)$e.push(Ze=Ct&&Ct[dn]!==void 0?Ve[ce](pt[dn],Ct[dn]):Ve[ce](pt[dn])),Ze.onerror=Fe;else for(dn=0;dn<Ye;++dn)$e.push(Ze=Ve[ce](pt[dn])),Ze.onerror=Fe}function dr(fn){fn=fn.target.result,$e.forEach(function(Wa,Ic){return Wa.error!=null&&(jt[Ic]=Wa.error)}),Ce({numFailures:Vt,failures:jt,results:ce==="delete"?Se:$e.map(function(Wa){return Wa.result}),lastResult:fn})}Ze.onerror=function(fn){Fe(fn),dr(fn)},Ze.onsuccess=dr})},getMany:function(me){var ve=me.trans,ce=me.keys;return new Promise(function(Se,Ee){Se=lt(Se);for(var we,Ce=ve.objectStore(he),De=ce.length,Ve=new Array(De),Ue=0,je=0,Ze=function($e){$e=$e.target,Ve[$e._pos]=$e.result,++je===Ue&&Se(Ve)},Ye=zr(Ee),Fe=0;Fe<De;++Fe)ce[Fe]!=null&&((we=Ce.get(ce[Fe]))._pos=Fe,we.onsuccess=Ze,we.onerror=Ye,++Ue);Ue===0&&Se(Ve)})},get:function(me){var ve=me.trans,ce=me.key;return new Promise(function(Se,Ee){Se=lt(Se);var we=ve.objectStore(he).get(ce);we.onsuccess=function(Ce){return Se(Ce.target.result)},we.onerror=zr(Ee)})},query:(ie=V,function(me){return new Promise(function(ve,ce){ve=lt(ve);var Se,Ee,we,je=me.trans,Ce=me.values,De=me.limit,Ue=me.query,Ve=De===1/0?void 0:De,Ze=Ue.index,Ue=Ue.range,je=je.objectStore(he),je=Ze.isPrimaryKey?je:je.index(Ze.name),Ze=y(Ue);if(De===0)return ve({result:[]});ie?((Ue=Ce?je.getAll(Ze,Ve):je.getAllKeys(Ze,Ve)).onsuccess=function(Ye){return ve({result:Ye.target.result})},Ue.onerror=zr(ce)):(Se=0,Ee=!Ce&&"openKeyCursor"in je?je.openKeyCursor(Ze):je.openCursor(Ze),we=[],Ee.onsuccess=function(Ye){var Fe=Ee.result;return!Fe||(we.push(Ce?Fe.value:Fe.primaryKey),++Se===De)?ve({result:we}):void Fe.continue()},Ee.onerror=zr(ce))})}),openCursor:function(me){var ve=me.trans,ce=me.values,Se=me.query,Ee=me.reverse,we=me.unique;return new Promise(function(Ce,De){Ce=lt(Ce);var je=Se.index,Ve=Se.range,Ue=ve.objectStore(he),Ue=je.isPrimaryKey?Ue:Ue.index(je.name),je=Ee?we?"prevunique":"prev":we?"nextunique":"next",Ze=!ce&&"openKeyCursor"in Ue?Ue.openKeyCursor(y(Ve),je):Ue.openCursor(y(Ve),je);Ze.onerror=zr(De),Ze.onsuccess=lt(function(Ye){var Fe,$e,jt,Vt,pt=Ze.result;pt?(pt.___id=++hm,pt.done=!1,Fe=pt.continue.bind(pt),$e=($e=pt.continuePrimaryKey)&&$e.bind(pt),jt=pt.advance.bind(pt),Vt=function(){throw new Error("Cursor not stopped")},pt.trans=ve,pt.stop=pt.continue=pt.continuePrimaryKey=pt.advance=function(){throw new Error("Cursor not started")},pt.fail=lt(De),pt.next=function(){var Ct=this,dn=1;return this.start(function(){return dn--?Ct.continue():Ct.stop()}).then(function(){return Ct})},pt.start=function(Ct){function dn(){if(Ze.result)try{Ct()}catch(fn){pt.fail(fn)}else pt.done=!0,pt.start=function(){throw new Error("Cursor behind last entry")},pt.stop()}var dr=new Promise(function(fn,Wa){fn=lt(fn),Ze.onerror=zr(Wa),pt.fail=Wa,pt.stop=function(Ic){pt.stop=pt.continue=pt.continuePrimaryKey=pt.advance=Vt,fn(Ic)}});return Ze.onsuccess=lt(function(fn){Ze.onsuccess=dn,dn()}),pt.continue=Fe,pt.continuePrimaryKey=$e,pt.advance=jt,dn(),dr},Ce(pt)):Ce(null)},De)})},count:function(me){var ve=me.query,ce=me.trans,Se=ve.index,Ee=ve.range;return new Promise(function(we,Ce){var De=ce.objectStore(he),De=Se.isPrimaryKey?De:De.index(Se.name),Ve=y(Ee),Ve=Ve?De.count(Ve):De.count();Ve.onsuccess=lt(function(Ue){return we(Ue.target.result)}),Ve.onerror=zr(Ce)})}}}E=de,R=sf((de=c).objectStoreNames);var E,de={schema:{name:de.name,tables:R.map(function(fe){return E.objectStore(fe)}).map(function(fe){var ie=fe.keyPath,he=fe.autoIncrement,ve=l(ie),me={},ve={name:fe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ie==null,compound:ve,keyPath:ie,autoIncrement:he,unique:!0,extractKey:dc(ie)},indexes:sf(fe.indexNames).map(function(ce){return fe.index(ce)}).map(function(we){var Ce=we.name,Se=we.unique,Ee=we.multiEntry,we=we.keyPath,Ce={name:Ce,compound:l(we),keyPath:we,unique:Se,multiEntry:Ee,extractKey:dc(we)};return me[yi(we)]=Ce}),getIndexByKeyPath:function(ce){return me[yi(ce)]}};return me[":id"]=ve.primaryKey,ie!=null&&(me[yi(ie)]=ve.primaryKey),ve})},hasGetAll:0<R.length&&"getAll"in E.objectStore(R[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},R=de.schema,V=de.hasGetAll,de=R.tables.map(b),xe={};return de.forEach(function(fe){return xe[fe.name]=fe}),{stack:"dbcore",transaction:c.transaction.bind(c),table:function(fe){if(xe[fe])return xe[fe];throw new Error("Table '".concat(fe,"' not found"))},MIN_KEY:-1/0,MAX_KEY:mi(d),schema:R}}function gm(c,d,g,y){return g=g.IDBKeyRange,d=pm(d,g,y),{dbcore:c.dbcore.reduce(function(b,E){return E=E.create,r(r({},b),E(b))},d)}}function To(c,d){var g=d.db,g=gm(c._middlewares,g,c._deps,d);c.core=g.dbcore,c.tables.forEach(function(y){var b=y.name;c.core.schema.tables.some(function(E){return E.name===b})&&(y.core=c.core.table(b),c[b]instanceof c.Table)&&(c[b].core=y.core)})}function Co(c,d,g,y){g.forEach(function(b){var E=y[b];d.forEach(function(R){var V=(function de(xe,fe){return A(xe,fe)||(xe=f(xe))&&de(xe,fe)})(R,b);(!V||"value"in V&&V.value===void 0)&&(R===c.Transaction.prototype||R instanceof c.Transaction?x(R,b,{get:function(){return this.table(b)},set:function(de){m(this,b,{value:de,writable:!0,configurable:!0,enumerable:!0})}}):R[b]=new c.Table(b,E))})})}function fc(c,d){d.forEach(function(g){for(var y in g)g[y]instanceof c.Table&&delete g[y]})}function mm(c,d){return c._cfg.version-d._cfg.version}function ym(c,d,g,y){var b=c._dbSchema,E=(g.objectStoreNames.contains("$meta")&&!b.$meta&&(b.$meta=uc("$meta",lf("")[0],[]),c._storeNames.push("$meta")),c._createTransaction("readwrite",c._storeNames,b)),R=(E.create(g),E._completion.catch(y),E._reject.bind(E)),V=ze.transless||ze;_n(function(){if(ze.trans=E,ze.transless=V,d!==0)return To(c,g),xe=d,((de=E).storeNames.includes("$meta")?de.table("$meta").get("version").then(function(fe){return fe??xe}):Ne.resolve(xe)).then(function(Se){var ie=c,he=Se,me=E,ve=g,ce=[],Se=ie._versions,Ee=ie._dbSchema=Po(0,ie.idbdb,ve);return(Se=Se.filter(function(we){return we._cfg.version>=he})).length===0?Ne.resolve():(Se.forEach(function(we){ce.push(function(){var Ce,De,Ve,Ue=Ee,je=we._cfg.dbschema,Ze=(Mo(ie,Ue,ve),Mo(ie,je,ve),Ee=ie._dbSchema=je,vc(Ue,je)),Ye=(Ze.add.forEach(function(Fe){hc(ve,Fe[0],Fe[1].primKey,Fe[1].indexes)}),Ze.change.forEach(function(Fe){if(Fe.recreate)throw new re.Upgrade("Not yet support for changing primary key");var $e=ve.objectStore(Fe.name);Fe.add.forEach(function(jt){return Io($e,jt)}),Fe.change.forEach(function(jt){$e.deleteIndex(jt.name),Io($e,jt)}),Fe.del.forEach(function(jt){return $e.deleteIndex(jt)})}),we._cfg.contentUpgrade);if(Ye&&we._cfg.version>he)return To(ie,ve),me._memoizedTables={},Ce=J(je),Ze.del.forEach(function(Fe){Ce[Fe]=Ue[Fe]}),fc(ie,[ie.Transaction.prototype]),Co(ie,[ie.Transaction.prototype],i(Ce),Ce),me.schema=Ce,(De=ee(Ye))&&vn(),je=Ne.follow(function(){var Fe;(Ve=Ye(me))&&De&&(Fe=nr.bind(null,null),Ve.then(Fe,Fe))}),Ve&&typeof Ve.then=="function"?Ne.resolve(Ve):je.then(function(){return Ve})}),ce.push(function(Ce){var De,Ve,Ue=we._cfg.dbschema;De=Ue,Ve=Ce,[].slice.call(Ve.db.objectStoreNames).forEach(function(je){return De[je]==null&&Ve.db.deleteObjectStore(je)}),fc(ie,[ie.Transaction.prototype]),Co(ie,[ie.Transaction.prototype],ie._storeNames,ie._dbSchema),me.schema=ie._dbSchema}),ce.push(function(Ce){ie.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(ie.idbdb.version/10)===we._cfg.version?(ie.idbdb.deleteObjectStore("$meta"),delete ie._dbSchema.$meta,ie._storeNames=ie._storeNames.filter(function(De){return De!=="$meta"})):Ce.objectStore("$meta").put(we._cfg.version,"version"))})}),(function we(){return ce.length?Ne.resolve(ce.shift()(me.idbtrans)).then(we):Ne.resolve()})().then(function(){of(Ee,ve)}))}).catch(R);var de,xe;i(b).forEach(function(fe){hc(g,fe,b[fe].primKey,b[fe].indexes)}),To(c,g),Ne.follow(function(){return c.on.populate.fire(E)}).catch(R)})}function _m(c,d){of(c._dbSchema,d),d.db.version%10!=0||d.objectStoreNames.contains("$meta")||d.db.createObjectStore("$meta").add(Math.ceil(d.db.version/10-1),"version");var g=Po(0,c.idbdb,d);Mo(c,c._dbSchema,d);for(var y=0,b=vc(g,c._dbSchema).change;y<b.length;y++){var E=(R=>{if(R.change.length||R.recreate)return console.warn("Unable to patch indexes of table ".concat(R.name," because it has changes on the type of index or primary key.")),{value:void 0};var V=d.objectStore(R.name);R.add.forEach(function(de){Oe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(R.name,".").concat(de.src)),Io(V,de)})})(b[y]);if(typeof E=="object")return E.value}}function vc(c,d){var g,y={del:[],add:[],change:[]};for(g in c)d[g]||y.del.push(g);for(g in d){var b=c[g],E=d[g];if(b){var R={name:g,def:E,recreate:!1,del:[],add:[],change:[]};if(""+(b.primKey.keyPath||"")!=""+(E.primKey.keyPath||"")||b.primKey.auto!==E.primKey.auto)R.recreate=!0,y.change.push(R);else{var V=b.idxByName,de=E.idxByName,xe=void 0;for(xe in V)de[xe]||R.del.push(xe);for(xe in de){var fe=V[xe],ie=de[xe];fe?fe.src!==ie.src&&R.change.push(ie):R.add.push(ie)}(0<R.del.length||0<R.add.length||0<R.change.length)&&y.change.push(R)}}else y.add.push([g,E])}return y}function hc(c,d,g,y){var b=c.db.createObjectStore(d,g.keyPath?{keyPath:g.keyPath,autoIncrement:g.auto}:{autoIncrement:g.auto});y.forEach(function(E){return Io(b,E)})}function of(c,d){i(c).forEach(function(g){d.db.objectStoreNames.contains(g)||(Oe&&console.debug("Dexie: Creating missing table",g),hc(d,g,c[g].primKey,c[g].indexes))})}function Io(c,d){c.createIndex(d.name,d.keyPath,{unique:d.unique,multiEntry:d.multi})}function Po(c,d,g){var y={};return q(d.objectStoreNames,0).forEach(function(b){for(var E=g.objectStore(b),R=cc(af(xe=E.keyPath),xe||"",!0,!1,!!E.autoIncrement,xe&&typeof xe!="string",!0),V=[],de=0;de<E.indexNames.length;++de){var fe=E.index(E.indexNames[de]),xe=fe.keyPath,fe=cc(fe.name,xe,!!fe.unique,!!fe.multiEntry,!1,xe&&typeof xe!="string",!1);V.push(fe)}y[b]=uc(b,R,V)}),y}function Mo(c,d,g){for(var y=g.db.objectStoreNames,b=0;b<y.length;++b){var E=y[b],R=g.objectStore(E);c._hasGetAll="getAll"in R;for(var V=0;V<R.indexNames.length;++V){var de,xe=R.indexNames[V],fe=R.index(xe).keyPath,fe=typeof fe=="string"?fe:"["+q(fe).join("+")+"]";d[E]&&(de=d[E].idxByName[fe])&&(de.name=xe,delete d[E].idxByName[fe],d[E].idxByName[xe]=de)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(c._hasGetAll=!1)}function lf(c){return c.split(",").map(function(d,g){var b=d.split(":"),y=(y=b[1])==null?void 0:y.trim(),b=(d=b[0].trim()).replace(/([&*]|\+\+)/g,""),E=/^\[/.test(b)?b.match(/^\[(.*)\]$/)[1].split("+"):b;return cc(b,E||null,/\&/.test(d),/\*/.test(d),/\+\+/.test(d),l(E),g===0,y)})}Ms.prototype._createTableSchema=uc,Ms.prototype._parseIndexSyntax=lf,Ms.prototype._parseStoresSpec=function(c,d){var g=this;i(c).forEach(function(y){if(c[y]!==null){var b=g._parseIndexSyntax(c[y]),E=b.shift();if(!E)throw new re.Schema("Invalid schema for table "+y+": "+c[y]);if(E.unique=!0,E.multi)throw new re.Schema("Primary key cannot be multiEntry*");b.forEach(function(R){if(R.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")}),E=g._createTableSchema(y,E,b),d[y]=E}})},Ms.prototype.stores=function(g){var d=this.db,g=(this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,g):g,d._versions),y={},b={};return g.forEach(function(E){u(y,E._cfg.storesSource),b=E._cfg.dbschema={},E._parseStoresSpec(y,b)}),d._dbSchema=b,fc(d,[d._allTables,d,d.Transaction.prototype]),Co(d,[d._allTables,d,d.Transaction.prototype,this._cfg.tables],i(b),b),d._storeNames=i(b),this},Ms.prototype.upgrade=function(c){return this._cfg.contentUpgrade=qe(this._cfg.contentUpgrade||be,c),this};var bm=Ms;function Ms(){}function pc(c,d){var g=c._dbNamesDB;return g||(g=c._dbNamesDB=new ra(Vn,{addons:[],indexedDB:c,IDBKeyRange:d})).version(1).stores({dbnames:"name"}),g.table("dbnames")}function gc(c){return c&&typeof c.databases=="function"}function mc(c){return _n(function(){return ze.letThrough=!0,c()})}function yc(c){return!("from"in c)}var Dn=function(c,d){var g;if(!this)return g=new Dn,c&&"d"in c&&u(g,c),g;u(this,arguments.length?{d:1,from:c,to:1<arguments.length?d:c}:{d:0})};function _i(c,d,g){var y=Dt(d,g);if(!isNaN(y)){if(0<y)throw RangeError();if(yc(c))return u(c,{from:d,to:g,d:1});var y=c.l,b=c.r;if(Dt(g,c.from)<0)return y?_i(y,d,g):c.l={from:d,to:g,d:1,l:null,r:null},uf(c);if(0<Dt(d,c.to))return b?_i(b,d,g):c.r={from:d,to:g,d:1,l:null,r:null},uf(c);Dt(d,c.from)<0&&(c.from=d,c.l=null,c.d=b?b.d+1:1),0<Dt(g,c.to)&&(c.to=g,c.r=null,c.d=c.l?c.l.d+1:1),d=!c.r,y&&!c.l&&bi(c,y),b&&d&&bi(c,b)}}function bi(c,d){yc(d)||(function g(y,b){var E=b.from,R=b.l,V=b.r;_i(y,E,b.to),R&&g(y,R),V&&g(y,V)})(c,d)}function cf(c,d){var g=Oo(d),y=g.next();if(!y.done)for(var b=y.value,E=Oo(c),R=E.next(b.from),V=R.value;!y.done&&!R.done;){if(Dt(V.from,b.to)<=0&&0<=Dt(V.to,b.from))return!0;Dt(b.from,V.from)<0?b=(y=g.next(V.from)).value:V=(R=E.next(b.from)).value}return!1}function Oo(c){var d=yc(c)?null:{s:0,n:c};return{next:function(g){for(var y=0<arguments.length;d;)switch(d.s){case 0:if(d.s=1,y)for(;d.n.l&&Dt(g,d.n.from)<0;)d={up:d,n:d.n.l,s:1};else for(;d.n.l;)d={up:d,n:d.n.l,s:1};case 1:if(d.s=2,!y||Dt(g,d.n.to)<=0)return{value:d.n,done:!1};case 2:if(d.n.r){d.s=3,d={up:d,n:d.n.r,s:0};continue}case 3:d=d.up}return{done:!0}}}}function uf(c){var d,g,y,b=(((b=c.r)==null?void 0:b.d)||0)-(((b=c.l)==null?void 0:b.d)||0),b=1<b?"r":b<-1?"l":"";b&&(d=b=="r"?"l":"r",g=r({},c),y=c[b],c.from=y.from,c.to=y.to,c[b]=y[b],g[b]=y[d],(c[d]=g).d=df(g)),c.d=df(c)}function df(g){var d=g.r,g=g.l;return(d?g?Math.max(d.d,g.d):d.d:g?g.d:0)+1}function No(c,d){return i(d).forEach(function(g){c[g]?bi(c[g],d[g]):c[g]=(function y(b){var E,R,V={};for(E in b)p(b,E)&&(R=b[E],V[E]=!R||typeof R!="object"||X.has(R.constructor)?R:y(R));return V})(d[g])}),c}function _c(c,d){return c.all||d.all||Object.keys(c).some(function(g){return d[g]&&cf(d[g],c[g])})}h(Dn.prototype,((nt={add:function(c){return bi(this,c),this},addKey:function(c){return _i(this,c,c),this},addKeys:function(c){var d=this;return c.forEach(function(g){return _i(d,g,g)}),this},hasKey:function(c){var d=Oo(this).next(c).value;return d&&Dt(d.from,c)<=0&&0<=Dt(d.to,c)}})[I]=function(){return Oo(this)},nt));var Ua={},bc={},wc=!1;function Ro(c){No(bc,c),wc||(wc=!0,setTimeout(function(){wc=!1,xc(bc,!(bc={}))},0))}function xc(c,d){d===void 0&&(d=!1);var g=new Set;if(c.all)for(var y=0,b=Object.values(Ua);y<b.length;y++)ff(V=b[y],c,g,d);else for(var E in c){var R,V,E=/^idb\:\/\/(.*)\/(.*)\//.exec(E);E&&(R=E[1],E=E[2],V=Ua["idb://".concat(R,"/").concat(E)])&&ff(V,c,g,d)}g.forEach(function(de){return de()})}function ff(c,d,g,y){for(var b=[],E=0,R=Object.entries(c.queries.query);E<R.length;E++){for(var V=R[E],de=V[0],xe=[],fe=0,ie=V[1];fe<ie.length;fe++){var he=ie[fe];_c(d,he.obsSet)?he.subscribers.forEach(function(Se){return g.add(Se)}):y&&xe.push(he)}y&&b.push([de,xe])}if(y)for(var me=0,ve=b;me<ve.length;me++){var ce=ve[me],de=ce[0],xe=ce[1];c.queries.query[de]=xe}}function wm(c){var d=c._state,g=c._deps.indexedDB;if(d.isBeingOpened||c.idbdb)return d.dbReadyPromise.then(function(){return d.dbOpenError?He(d.dbOpenError):c});d.isBeingOpened=!0,d.dbOpenError=null,d.openComplete=!1;var y=d.openCanceller,b=Math.round(10*c.verno),E=!1;function R(){if(d.openCanceller!==y)throw new re.DatabaseClosed("db.open() was cancelled")}function V(){return new Ne(function(he,me){if(R(),!g)throw new re.MissingAPI;var ve=c.name,ce=d.autoSchema||!b?g.open(ve):g.open(ve,b);if(!ce)throw new re.MissingAPI;ce.onerror=zr(me),ce.onblocked=lt(c._fireOnBlocked),ce.onupgradeneeded=lt(function(Se){var Ee;fe=ce.transaction,d.autoSchema&&!c._options.allowEmptyDB?(ce.onerror=pi,fe.abort(),ce.result.close(),(Ee=g.deleteDatabase(ve)).onsuccess=Ee.onerror=lt(function(){me(new re.NoSuchDatabase("Database ".concat(ve," doesnt exist")))})):(fe.onerror=zr(me),Ee=Se.oldVersion>Math.pow(2,62)?0:Se.oldVersion,ie=Ee<1,c.idbdb=ce.result,E&&_m(c,fe),ym(c,Ee/10,fe,me))},me),ce.onsuccess=lt(function(){fe=null;var Se,Ee,we,Ce,De,Ve,Ue=c.idbdb=ce.result,je=q(Ue.objectStoreNames);if(0<je.length)try{var Ze=Ue.transaction((De=je).length===1?De[0]:De,"readonly");if(d.autoSchema)Ve=Ue,Ce=Ze,(we=c).verno=Ve.version/10,Ce=we._dbSchema=Po(0,Ve,Ce),we._storeNames=q(Ve.objectStoreNames,0),Co(we,[we._allTables],i(Ce),Ce);else if(Mo(c,c._dbSchema,Ze),Ee=Ze,((Ee=vc(Po(0,(Se=c).idbdb,Ee),Se._dbSchema)).add.length||Ee.change.some(function(Ye){return Ye.add.length||Ye.change.length}))&&!E)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ue.close(),b=Ue.version+1,E=!0,he(V());To(c,Ze)}catch{}hn.push(c),Ue.onversionchange=lt(function(Ye){d.vcFired=!0,c.on("versionchange").fire(Ye)}),Ue.onclose=lt(function(){c.close({disableAutoOpen:!1})}),ie&&(je=c._deps,De=ve,gc(Ve=je.indexedDB)||De===Vn||pc(Ve,je.IDBKeyRange).put({name:De}).catch(be)),he()},me)}).catch(function(he){switch(he==null?void 0:he.name){case"UnknownError":if(0<d.PR1398_maxLoop)return d.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),V();break;case"VersionError":if(0<b)return b=0,V()}return Ne.reject(he)})}var de,xe=d.dbReadyResolve,fe=null,ie=!1;return Ne.race([y,(typeof navigator>"u"?Ne.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(he){function me(){return indexedDB.databases().finally(he)}de=setInterval(me,100),me()}).finally(function(){return clearInterval(de)}):Promise.resolve()).then(V)]).then(function(){return R(),d.onReadyBeingFired=[],Ne.resolve(mc(function(){return c.on.ready.fire(c.vip)})).then(function he(){var me;if(0<d.onReadyBeingFired.length)return me=d.onReadyBeingFired.reduce(qe,be),d.onReadyBeingFired=[],Ne.resolve(mc(function(){return me(c.vip)})).then(he)})}).finally(function(){d.openCanceller===y&&(d.onReadyBeingFired=null,d.isBeingOpened=!1)}).catch(function(he){d.dbOpenError=he;try{fe&&fe.abort()}catch{}return y===d.openCanceller&&c._close(),He(he)}).finally(function(){d.openComplete=!0,xe()}).then(function(){var he;return ie&&(he={},c.tables.forEach(function(me){me.schema.indexes.forEach(function(ve){ve.name&&(he["idb://".concat(c.name,"/").concat(me.name,"/").concat(ve.name)]=new Dn(-1/0,[[[]]]))}),he["idb://".concat(c.name,"/").concat(me.name,"/")]=he["idb://".concat(c.name,"/").concat(me.name,"/:dels")]=new Dn(-1/0,[[[]]])}),Sa(gi).fire(he),xc(he,!0)),c})}function kc(c){function d(E){return c.next(E)}var g=b(d),y=b(function(E){return c.throw(E)});function b(E){return function(V){var V=E(V),de=V.value;return V.done?de:de&&typeof de.then=="function"?de.then(g,y):l(de)?Promise.all(de).then(g,y):g(de)}}return b(d)()}function Do(c,d,g){for(var y=l(c)?c.slice():[c],b=0;b<g;++b)y.push(d);return y}var xm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(c){return r(r({},c),{table:function(y){var g=c.table(y),y=g.schema,b={},E=[];function R(he,me,ve){var we=yi(he),ce=b[we]=b[we]||[],Se=he==null?0:typeof he=="string"?1:he.length,Ee=0<me,we=r(r({},ve),{name:Ee?"".concat(we,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Ee,keyTail:me,keyLength:Se,extractKey:dc(he),unique:!Ee&&ve.unique});return ce.push(we),we.isPrimaryKey||E.push(we),1<Se&&R(Se===2?he[0]:he.slice(0,Se-1),me+1,ve),ce.sort(function(Ce,De){return Ce.keyTail-De.keyTail}),we}var V=R(y.primaryKey.keyPath,0,y.primaryKey);b[":id"]=[V];for(var de=0,xe=y.indexes;de<xe.length;de++){var fe=xe[de];R(fe.keyPath,0,fe)}function ie(he){var me,ve=he.query.index;return ve.isVirtual?r(r({},he),{query:{index:ve.lowLevelIndex,range:(me=he.query.range,ve=ve.keyTail,{type:me.type===1?2:me.type,lower:Do(me.lower,me.lowerOpen?c.MAX_KEY:c.MIN_KEY,ve),lowerOpen:!0,upper:Do(me.upper,me.upperOpen?c.MIN_KEY:c.MAX_KEY,ve),upperOpen:!0})}}):he}return r(r({},g),{schema:r(r({},y),{primaryKey:V,indexes:E,getIndexByKeyPath:function(he){return(he=b[yi(he)])&&he[0]}}),count:function(he){return g.count(ie(he))},query:function(he){return g.query(ie(he))},openCursor:function(he){var me=he.query.index,ve=me.keyTail,ce=me.keyLength;return me.isVirtual?g.openCursor(ie(he)).then(function(Ee){return Ee&&Se(Ee)}):g.openCursor(he);function Se(Ee){return Object.create(Ee,{continue:{value:function(we){we!=null?Ee.continue(Do(we,he.reverse?c.MAX_KEY:c.MIN_KEY,ve)):he.unique?Ee.continue(Ee.key.slice(0,ce).concat(he.reverse?c.MIN_KEY:c.MAX_KEY,ve)):Ee.continue()}},continuePrimaryKey:{value:function(we,Ce){Ee.continuePrimaryKey(Do(we,c.MAX_KEY,ve),Ce)}},primaryKey:{get:function(){return Ee.primaryKey}},key:{get:function(){var we=Ee.key;return ce===1?we[0]:we.slice(0,ce)}},value:{get:function(){return Ee.value}}})}}})}})}};function Sc(c,d,g,y){return g=g||{},y=y||"",i(c).forEach(function(b){var E,R,V;p(d,b)?(E=c[b],R=d[b],typeof E=="object"&&typeof R=="object"&&E&&R?(V=O(E))!==O(R)?g[y+b]=d[b]:V==="Object"?Sc(E,R,g,y+b+"."):E!==R&&(g[y+b]=d[b]):E!==R&&(g[y+b]=d[b])):g[y+b]=void 0}),i(d).forEach(function(b){p(c,b)||(g[y+b]=d[b])}),g}function Ec(c,d){return d.type==="delete"?d.keys:d.keys||d.values.map(c.extractKey)}var km={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(c){return r(r({},c),{table:function(d){var g=c.table(d),y=g.schema.primaryKey;return r(r({},g),{mutate:function(b){var E=ze.trans,R=E.table(d).hook,V=R.deleting,de=R.creating,xe=R.updating;switch(b.type){case"add":if(de.fire===be)break;return E._promise("readwrite",function(){return fe(b)},!0);case"put":if(de.fire===be&&xe.fire===be)break;return E._promise("readwrite",function(){return fe(b)},!0);case"delete":if(V.fire===be)break;return E._promise("readwrite",function(){return fe(b)},!0);case"deleteRange":if(V.fire===be)break;return E._promise("readwrite",function(){return(function ie(he,me,ve){return g.query({trans:he,values:!1,query:{index:y,range:me},limit:ve}).then(function(ce){var Se=ce.result;return fe({type:"delete",keys:Se,trans:he}).then(function(Ee){return 0<Ee.numFailures?Promise.reject(Ee.failures[0]):Se.length<ve?{failures:[],numFailures:0,lastResult:void 0}:ie(he,r(r({},me),{lower:Se[Se.length-1],lowerOpen:!0}),ve)})})})(b.trans,b.range,1e4)},!0)}return g.mutate(b);function fe(ie){var he,me,ve,ce=ze.trans,Se=ie.keys||Ec(y,ie);if(Se)return(ie=ie.type==="add"||ie.type==="put"?r(r({},ie),{keys:Se}):r({},ie)).type!=="delete"&&(ie.values=a([],ie.values)),ie.keys&&(ie.keys=a([],ie.keys)),he=g,ve=Se,((me=ie).type==="add"?Promise.resolve([]):he.getMany({trans:me.trans,keys:ve,cache:"immutable"})).then(function(Ee){var we=Se.map(function(Ce,De){var Ve,Ue,je,Ze=Ee[De],Ye={onerror:null,onsuccess:null};return ie.type==="delete"?V.fire.call(Ye,Ce,Ze,ce):ie.type==="add"||Ze===void 0?(Ve=de.fire.call(Ye,Ce,ie.values[De],ce),Ce==null&&Ve!=null&&(ie.keys[De]=Ce=Ve,y.outbound||N(ie.values[De],y.keyPath,Ce))):(Ve=Sc(Ze,ie.values[De]),(Ue=xe.fire.call(Ye,Ve,Ce,Ze,ce))&&(je=ie.values[De],Object.keys(Ue).forEach(function(Fe){p(je,Fe)?je[Fe]=Ue[Fe]:N(je,Fe,Ue[Fe])}))),Ye});return g.mutate(ie).then(function(Ce){for(var De=Ce.failures,Ve=Ce.results,Ue=Ce.numFailures,Ce=Ce.lastResult,je=0;je<Se.length;++je){var Ze=(Ve||Se)[je],Ye=we[je];Ze==null?Ye.onerror&&Ye.onerror(De[je]):Ye.onsuccess&&Ye.onsuccess(ie.type==="put"&&Ee[je]?ie.values[je]:Ze)}return{failures:De,results:Ve,numFailures:Ue,lastResult:Ce}}).catch(function(Ce){return we.forEach(function(De){return De.onerror&&De.onerror(Ce)}),Promise.reject(Ce)})});throw new Error("Keys missing")}}})}})}};function vf(c,d,g){try{if(!d||d.keys.length<c.length)return null;for(var y=[],b=0,E=0;b<d.keys.length&&E<c.length;++b)Dt(d.keys[b],c[E])===0&&(y.push(g?K(d.values[b]):d.values[b]),++E);return y.length===c.length?y:null}catch{return null}}var Sm={stack:"dbcore",level:-1,create:function(c){return{table:function(d){var g=c.table(d);return r(r({},g),{getMany:function(y){var b;return y.cache?(b=vf(y.keys,y.trans._cache,y.cache==="clone"))?Ne.resolve(b):g.getMany(y).then(function(E){return y.trans._cache={keys:y.keys,values:y.cache==="clone"?K(E):E},E}):g.getMany(y)},mutate:function(y){return y.type!=="add"&&(y.trans._cache=null),g.mutate(y)}})}}}};function hf(c,d){return c.trans.mode==="readonly"&&!!c.subscr&&!c.trans.explicit&&c.trans.db._options.cache!=="disabled"&&!d.schema.primaryKey.outbound}function pf(c,d){switch(c){case"query":return d.values&&!d.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Em={stack:"dbcore",level:0,name:"Observability",create:function(c){var d=c.schema.name,g=new Dn(c.MIN_KEY,c.MAX_KEY);return r(r({},c),{transaction:function(y,b,E){if(ze.subscr&&b!=="readonly")throw new re.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ze.querier));return c.transaction(y,b,E)},table:function(y){function b(Se){var ce,Se=Se.query;return[ce=Se.index,new Dn((ce=(Se=Se.range).lower)!=null?ce:c.MIN_KEY,(ce=Se.upper)!=null?ce:c.MAX_KEY)]}var E=c.table(y),R=E.schema,V=R.primaryKey,de=R.indexes,xe=V.extractKey,fe=V.outbound,ie=V.autoIncrement&&de.filter(function(ve){return ve.compound&&ve.keyPath.includes(V.keyPath)}),he=r(r({},E),{mutate:function(ve){function ce($e){return $e="idb://".concat(d,"/").concat(y,"/").concat($e),De[$e]||(De[$e]=new Dn)}var Se,Ee,we,Ce=ve.trans,De=ve.mutatedParts||(ve.mutatedParts={}),Ve=ce(""),Ue=ce(":dels"),je=ve.type,Ye=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[Ec(V,ve).filter(function($e){return $e}),ve.values]:[],Ze=Ye[0],Ye=Ye[1],Fe=ve.trans._cache;return l(Ze)?(Ve.addKeys(Ze),(je=je==="delete"||Ze.length===Ye.length?vf(Ze,Fe):null)||Ue.addKeys(Ze),(je||Ye)&&(Se=ce,Ee=je,we=Ye,R.indexes.forEach(function($e){var jt=Se($e.name||"");function Vt(Ct){return Ct!=null?$e.extractKey(Ct):null}function pt(Ct){$e.multiEntry&&l(Ct)?Ct.forEach(function(dn){return jt.addKey(dn)}):jt.addKey(Ct)}(Ee||we).forEach(function(Ct,fn){var dr=Ee&&Vt(Ee[fn]),fn=we&&Vt(we[fn]);Dt(dr,fn)!==0&&(dr!=null&&pt(dr),fn!=null)&&pt(fn)})}))):Ze?(Ye={from:(Fe=Ze.lower)!=null?Fe:c.MIN_KEY,to:(je=Ze.upper)!=null?je:c.MAX_KEY},Ue.add(Ye),Ve.add(Ye)):(Ve.add(g),Ue.add(g),R.indexes.forEach(function($e){return ce($e.name).add(g)})),E.mutate(ve).then(function($e){return!Ze||ve.type!=="add"&&ve.type!=="put"||(Ve.addKeys($e.results),ie&&ie.forEach(function(jt){for(var Vt=ve.values.map(function(dr){return jt.extractKey(dr)}),pt=jt.keyPath.findIndex(function(dr){return dr===V.keyPath}),Ct=0,dn=$e.results.length;Ct<dn;++Ct)Vt[Ct][pt]=$e.results[Ct];ce(jt.name).addKeys(Vt)})),Ce.mutatedParts=No(Ce.mutatedParts||{},De),$e})}}),me={get:function(ve){return[V,new Dn(ve.key)]},getMany:function(ve){return[V,new Dn().addKeys(ve.keys)]},count:b,query:b,openCursor:b};return i(me).forEach(function(ve){he[ve]=function(ce){var Se=ze.subscr,Ee=!!Se,we=hf(ze,E)&&pf(ve,ce)?ce.obsSet={}:Se;if(Ee){var Ce,Se=function(Ye){return Ye="idb://".concat(d,"/").concat(y,"/").concat(Ye),we[Ye]||(we[Ye]=new Dn)},De=Se(""),Ve=Se(":dels"),Ee=me[ve](ce),Ue=Ee[0],Ee=Ee[1];if((ve==="query"&&Ue.isPrimaryKey&&!ce.values?Ve:Se(Ue.name||"")).add(Ee),!Ue.isPrimaryKey){if(ve!=="count")return Ce=ve==="query"&&fe&&ce.values&&E.query(r(r({},ce),{values:!1})),E[ve].apply(this,arguments).then(function(Ye){if(ve==="query"){if(fe&&ce.values)return Ce.then(function(Vt){return Vt=Vt.result,De.addKeys(Vt),Ye});var Fe=ce.values?Ye.result.map(xe):Ye.result;(ce.values?De:Ve).addKeys(Fe)}else{var $e,jt;if(ve==="openCursor")return jt=ce.values,($e=Ye)&&Object.create($e,{key:{get:function(){return Ve.addKey($e.primaryKey),$e.key}},primaryKey:{get:function(){var Vt=$e.primaryKey;return Ve.addKey(Vt),Vt}},value:{get:function(){return jt&&De.addKey($e.primaryKey),$e.value}}})}return Ye});Ve.add(g)}}return E[ve].apply(this,arguments)}}),he}})}};function gf(c,d,g){var y;return g.numFailures===0?d:d.type==="deleteRange"||(y=d.keys?d.keys.length:"values"in d&&d.values?d.values.length:1,g.numFailures===y)?null:(y=r({},d),l(y.keys)&&(y.keys=y.keys.filter(function(b,E){return!(E in g.failures)})),"values"in y&&l(y.values)&&(y.values=y.values.filter(function(b,E){return!(E in g.failures)})),y)}function Ac(c,d){return g=c,((y=d).lower===void 0||(y.lowerOpen?0<Dt(g,y.lower):0<=Dt(g,y.lower)))&&(g=c,(y=d).upper===void 0||(y.upperOpen?Dt(g,y.upper)<0:Dt(g,y.upper)<=0));var g,y}function mf(c,d,g,y,b,E){var R,V,de,xe,fe,ie;return!g||g.length===0||(R=d.query.index,V=R.multiEntry,de=d.query.range,xe=y.schema.primaryKey.extractKey,fe=R.extractKey,ie=(R.lowLevelIndex||R).extractKey,(y=g.reduce(function(he,me){var ve=he,ce=[];if(me.type==="add"||me.type==="put")for(var Se=new Dn,Ee=me.values.length-1;0<=Ee;--Ee){var we,Ce=me.values[Ee],De=xe(Ce);!Se.hasKey(De)&&(we=fe(Ce),V&&l(we)?we.some(function(Ye){return Ac(Ye,de)}):Ac(we,de))&&(Se.addKey(De),ce.push(Ce))}switch(me.type){case"add":var Ve=new Dn().addKeys(d.values?he.map(function(Fe){return xe(Fe)}):he),ve=he.concat(d.values?ce.filter(function(Fe){return Fe=xe(Fe),!Ve.hasKey(Fe)&&(Ve.addKey(Fe),!0)}):ce.map(function(Fe){return xe(Fe)}).filter(function(Fe){return!Ve.hasKey(Fe)&&(Ve.addKey(Fe),!0)}));break;case"put":var Ue=new Dn().addKeys(me.values.map(function(Fe){return xe(Fe)}));ve=he.filter(function(Fe){return!Ue.hasKey(d.values?xe(Fe):Fe)}).concat(d.values?ce:ce.map(function(Fe){return xe(Fe)}));break;case"delete":var je=new Dn().addKeys(me.keys);ve=he.filter(function(Fe){return!je.hasKey(d.values?xe(Fe):Fe)});break;case"deleteRange":var Ze=me.range;ve=he.filter(function(Fe){return!Ac(xe(Fe),Ze)})}return ve},c))===c)?c:(y.sort(function(he,me){return Dt(ie(he),ie(me))||Dt(xe(he),xe(me))}),d.limit&&d.limit<1/0&&(y.length>d.limit?y.length=d.limit:c.length===d.limit&&y.length<d.limit&&(b.dirty=!0)),E?Object.freeze(y):y)}function yf(c,d){return Dt(c.lower,d.lower)===0&&Dt(c.upper,d.upper)===0&&!!c.lowerOpen==!!d.lowerOpen&&!!c.upperOpen==!!d.upperOpen}function Am(c,d){return((g,y,b,E)=>{if(g===void 0)return y!==void 0?-1:0;if(y===void 0)return 1;if((g=Dt(g,y))===0){if(b&&E)return 0;if(b)return 1;if(E)return-1}return g})(c.lower,d.lower,c.lowerOpen,d.lowerOpen)<=0&&0<=((g,y,b,E)=>{if(g===void 0)return y!==void 0?1:0;if(y===void 0)return-1;if((g=Dt(g,y))===0){if(b&&E)return 0;if(b)return-1;if(E)return 1}return g})(c.upper,d.upper,c.upperOpen,d.upperOpen)}function Tm(c,d,g,y){c.subscribers.add(g),y.addEventListener("abort",function(){var b,E;c.subscribers.delete(g),c.subscribers.size===0&&(b=c,E=d,setTimeout(function(){b.subscribers.size===0&&W(E,b)},3e3))})}var Cm={stack:"dbcore",level:0,name:"Cache",create:function(c){var d=c.schema.name;return r(r({},c),{transaction:function(g,y,b){var E,R,V=c.transaction(g,y,b);return y==="readwrite"&&(b=(E=new AbortController).signal,V.addEventListener("abort",(R=function(de){return function(){if(E.abort(),y==="readwrite"){for(var xe=new Set,fe=0,ie=g;fe<ie.length;fe++){var he=ie[fe],me=Ua["idb://".concat(d,"/").concat(he)];if(me){var ve=c.table(he),ce=me.optimisticOps.filter(function($e){return $e.trans===V});if(V._explicit&&de&&V.mutatedParts)for(var Se=0,Ee=Object.values(me.queries.query);Se<Ee.length;Se++)for(var we=0,Ce=(Ue=Ee[Se]).slice();we<Ce.length;we++)_c((je=Ce[we]).obsSet,V.mutatedParts)&&(W(Ue,je),je.subscribers.forEach(function($e){return xe.add($e)}));else if(0<ce.length){me.optimisticOps=me.optimisticOps.filter(function($e){return $e.trans!==V});for(var De=0,Ve=Object.values(me.queries.query);De<Ve.length;De++)for(var Ue,je,Ze,Ye=0,Fe=(Ue=Ve[De]).slice();Ye<Fe.length;Ye++)(je=Fe[Ye]).res!=null&&V.mutatedParts&&(de&&!je.dirty?(Ze=Object.isFrozen(je.res),Ze=mf(je.res,je.req,ce,ve,je,Ze),je.dirty?(W(Ue,je),je.subscribers.forEach(function($e){return xe.add($e)})):Ze!==je.res&&(je.res=Ze,je.promise=Ne.resolve({result:Ze}))):(je.dirty&&W(Ue,je),je.subscribers.forEach(function($e){return xe.add($e)})))}}}xe.forEach(function($e){return $e()})}}})(!1),{signal:b}),V.addEventListener("error",R(!1),{signal:b}),V.addEventListener("complete",R(!0),{signal:b})),V},table:function(g){var y=c.table(g),b=y.schema.primaryKey;return r(r({},y),{mutate:function(E){var R,V=ze.trans;return!b.outbound&&V.db._options.cache!=="disabled"&&!V.explicit&&V.idbtrans.mode==="readwrite"&&(R=Ua["idb://".concat(d,"/").concat(g)])?(V=y.mutate(E),E.type!=="add"&&E.type!=="put"||!(50<=E.values.length||Ec(b,E).some(function(de){return de==null}))?(R.optimisticOps.push(E),E.mutatedParts&&Ro(E.mutatedParts),V.then(function(de){0<de.numFailures&&(W(R.optimisticOps,E),(de=gf(0,E,de))&&R.optimisticOps.push(de),E.mutatedParts)&&Ro(E.mutatedParts)}),V.catch(function(){W(R.optimisticOps,E),E.mutatedParts&&Ro(E.mutatedParts)})):V.then(function(de){var xe=gf(0,r(r({},E),{values:E.values.map(function(fe,ie){var he;return de.failures[ie]?fe:(N(he=(he=b.keyPath)!=null&&he.includes(".")?K(fe):r({},fe),b.keyPath,de.results[ie]),he)})}),de);R.optimisticOps.push(xe),queueMicrotask(function(){return E.mutatedParts&&Ro(E.mutatedParts)})}),V):y.mutate(E)},query:function(E){var R,V,de,xe,fe,ie,he;return hf(ze,y)&&pf("query",E)?(R=((de=ze.trans)==null?void 0:de.db._options.cache)==="immutable",V=(de=ze).requery,de=de.signal,ie=((me,ve,ce,Se)=>{var Ee=Ua["idb://".concat(me,"/").concat(ve)];if(!Ee)return[];if(!(me=Ee.queries[ce]))return[null,!1,Ee,null];var we=me[(Se.query?Se.query.index.name:null)||""];if(!we)return[null,!1,Ee,null];switch(ce){case"query":var Ce=we.find(function(De){return De.req.limit===Se.limit&&De.req.values===Se.values&&yf(De.req.query.range,Se.query.range)});return Ce?[Ce,!0,Ee,we]:[we.find(function(De){return("limit"in De.req?De.req.limit:1/0)>=Se.limit&&(!Se.values||De.req.values)&&Am(De.req.query.range,Se.query.range)}),!1,Ee,we];case"count":return Ce=we.find(function(De){return yf(De.req.query.range,Se.query.range)}),[Ce,!!Ce,Ee,we]}})(d,g,"query",E),he=ie[0],xe=ie[2],fe=ie[3],he&&ie[1]?he.obsSet=E.obsSet:(ie=y.query(E).then(function(me){var ve=me.result;if(he&&(he.res=ve),R){for(var ce=0,Se=ve.length;ce<Se;++ce)Object.freeze(ve[ce]);Object.freeze(ve)}else me.result=K(ve);return me}).catch(function(me){return fe&&he&&W(fe,he),Promise.reject(me)}),he={obsSet:E.obsSet,promise:ie,subscribers:new Set,type:"query",req:E,dirty:!1},fe?fe.push(he):(fe=[he],(xe=xe||(Ua["idb://".concat(d,"/").concat(g)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[E.query.index.name||""]=fe)),Tm(he,fe,V,de),he.promise.then(function(me){return{result:mf(me.result,E,xe==null?void 0:xe.optimisticOps,y,he,R)}})):y.query(E)}})}})}};function Lo(c,d){return new Proxy(c,{get:function(g,y,b){return y==="db"?d:Reflect.get(g,y,b)}})}pn.prototype.version=function(c){if(isNaN(c)||c<.1)throw new re.Type("Given version is not a positive number");if(c=Math.round(10*c)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,c);var d=this._versions,g=d.filter(function(y){return y._cfg.version===c})[0];return g||(g=new this.Version(c),d.push(g),d.sort(mm),g.stores({}),this._state.autoSchema=!1),g},pn.prototype._whenReady=function(c){var d=this;return this.idbdb&&(this._state.openComplete||ze.letThrough||this._vip)?c():new Ne(function(g,y){if(d._state.openComplete)return y(new re.DatabaseClosed(d._state.dbOpenError));if(!d._state.isBeingOpened){if(!d._state.autoOpen)return void y(new re.DatabaseClosed);d.open().catch(be)}d._state.dbReadyPromise.then(g,y)}).then(c)},pn.prototype.use=function(b){var d=b.stack,g=b.create,y=b.level,b=b.name,E=(b&&this.unuse({stack:d,name:b}),this._middlewares[d]||(this._middlewares[d]=[]));return E.push({stack:d,create:g,level:y??10,name:b}),E.sort(function(R,V){return R.level-V.level}),this},pn.prototype.unuse=function(c){var d=c.stack,g=c.name,y=c.create;return d&&this._middlewares[d]&&(this._middlewares[d]=this._middlewares[d].filter(function(b){return y?b.create!==y:!!g&&b.name!==g})),this},pn.prototype.open=function(){var c=this;return rt(ot,function(){return wm(c)})},pn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var c=this._state,d=hn.indexOf(this);if(0<=d&&hn.splice(d,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}c.isBeingOpened||(c.dbReadyPromise=new Ne(function(g){c.dbReadyResolve=g}),c.openCanceller=new Ne(function(g,y){c.cancelOpen=y}))},pn.prototype.close=function(d){var d=(d===void 0?{disableAutoOpen:!0}:d).disableAutoOpen,g=this._state;d?(g.isBeingOpened&&g.cancelOpen(new re.DatabaseClosed),this._close(),g.autoOpen=!1,g.dbOpenError=new re.DatabaseClosed):(this._close(),g.autoOpen=this._options.autoOpen||g.isBeingOpened,g.openComplete=!1,g.dbOpenError=null)},pn.prototype.delete=function(c){var d=this,g=(c===void 0&&(c={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),y=this._state;return new Ne(function(b,E){function R(){d.close(c);var V=d._deps.indexedDB.deleteDatabase(d.name);V.onsuccess=lt(function(){var de,xe,fe;de=d._deps,xe=d.name,gc(fe=de.indexedDB)||xe===Vn||pc(fe,de.IDBKeyRange).delete(xe).catch(be),b()}),V.onerror=zr(E),V.onblocked=d._fireOnBlocked}if(g)throw new re.InvalidArgument("Invalid closeOptions argument to db.delete()");y.isBeingOpened?y.dbReadyPromise.then(R):R()})},pn.prototype.backendDB=function(){return this.idbdb},pn.prototype.isOpen=function(){return this.idbdb!==null},pn.prototype.hasBeenClosed=function(){var c=this._state.dbOpenError;return c&&c.name==="DatabaseClosed"},pn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pn.prototype,"tables",{get:function(){var c=this;return i(this._allTables).map(function(d){return c._allTables[d]})},enumerable:!1,configurable:!0}),pn.prototype.transaction=function(){var c=(function(d,g,y){var b=arguments.length;if(b<2)throw new re.InvalidArgument("Too few arguments");for(var E=new Array(b-1);--b;)E[b-1]=arguments[b];return y=E.pop(),[d,ke(E),y]}).apply(this,arguments);return this._transaction.apply(this,c)},pn.prototype._transaction=function(c,d,g){var y,b,E=this,R=ze.trans,V=(R&&R.db===this&&c.indexOf("!")===-1||(R=null),c.indexOf("?")!==-1);c=c.replace("!","").replace("?","");try{if(b=d.map(function(xe){if(xe=xe instanceof E.Table?xe.name:xe,typeof xe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xe}),c=="r"||c===Lr)y=Lr;else{if(c!="rw"&&c!=Ha)throw new re.InvalidArgument("Invalid transaction mode: "+c);y=Ha}if(R){if(R.mode===Lr&&y===Ha){if(!V)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");R=null}R&&b.forEach(function(xe){if(R&&R.storeNames.indexOf(xe)===-1){if(!V)throw new re.SubTransaction("Table "+xe+" not included in parent transaction.");R=null}}),V&&R&&!R.active&&(R=null)}}catch(xe){return R?R._promise(null,function(fe,ie){ie(xe)}):He(xe)}var de=(function xe(fe,ie,he,me,ve){return Ne.resolve().then(function(){var we=ze.transless||ze,ce=fe._createTransaction(ie,he,fe._dbSchema,me),we=(ce.explicit=!0,{trans:ce,transless:we});if(me)ce.idbtrans=me.idbtrans;else try{ce.create(),ce.idbtrans._explicit=!0,fe._state.PR1398_maxLoop=3}catch(Ce){return Ce.name===_e.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,ie,he,null,ve)})):He(Ce)}var Se,Ee=ee(ve),we=(Ee&&vn(),Ne.follow(function(){var Ce;(Se=ve.call(ce,ce))&&(Ee?(Ce=nr.bind(null,null),Se.then(Ce,Ce)):typeof Se.next=="function"&&typeof Se.throw=="function"&&(Se=kc(Se)))},we));return(Se&&typeof Se.then=="function"?Ne.resolve(Se).then(function(Ce){return ce.active?Ce:He(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):we.then(function(){return Se})).then(function(Ce){return me&&ce._resolve(),ce._completion.then(function(){return Ce})}).catch(function(Ce){return ce._reject(Ce),He(Ce)})})}).bind(null,this,y,b,R,g);return R?R._promise(y,de,"lock"):ze.trans?rt(ze.transless,function(){return E._whenReady(de)}):this._whenReady(de)},pn.prototype.table=function(c){if(p(this._allTables,c))return this._allTables[c];throw new re.InvalidTable("Table ".concat(c," does not exist"))};var ra=pn;function pn(c,d){var g,y,b,E,R,V=this,de=(this._middlewares={},this.verno=0,pn.dependencies),de=(this._options=d=r({addons:pn.addons,autoOpen:!0,indexedDB:de.indexedDB,IDBKeyRange:de.IDBKeyRange,cache:"cloned"},d),this._deps={indexedDB:d.indexedDB,IDBKeyRange:d.IDBKeyRange},d.addons),xe=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:be,dbReadyPromise:null,cancelOpen:be,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:d.autoOpen}),fe=(xe.dbReadyPromise=new Ne(function(ie){xe.dbReadyResolve=ie}),xe.openCanceller=new Ne(function(ie,he){xe.cancelOpen=he}),this._state=xe,this.name=c,this.on=vi(this,"populate","blocked","versionchange","close",{ready:[qe,be]}),this.once=function(ie,he){var me=function(){for(var ve=[],ce=0;ce<arguments.length;ce++)ve[ce]=arguments[ce];V.on(ie).unsubscribe(me),he.apply(V,ve)};return V.on(ie,me)},this.on.ready.subscribe=G(this.on.ready.subscribe,function(ie){return function(he,me){pn.vip(function(){var ve,ce=V._state;ce.openComplete?(ce.dbOpenError||Ne.resolve().then(he),me&&ie(he)):ce.onReadyBeingFired?(ce.onReadyBeingFired.push(he),me&&ie(he)):(ie(he),ve=V,me||ie(function Se(){ve.on.ready.unsubscribe(he),ve.on.ready.unsubscribe(Se)}))})}}),this.Collection=(g=this,hi(um.prototype,function(Se,ce){this.db=g;var me=di,ve=null;if(ce)try{me=ce()}catch(we){ve=we}var ce=Se._ctx,Se=ce.table,Ee=Se.hook.reading.fire;this._ctx={table:Se,index:ce.index,isPrimKey:!ce.index||Se.schema.primKey.keyPath&&ce.index===Se.schema.primKey.name,range:me,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ve,or:ce.or,valueMapper:Ee!==Ie?Ee:null}})),this.Table=(y=this,hi(Jd.prototype,function(ie,he,me){this.db=y,this._tx=me,this.name=ie,this.schema=he,this.hook=y._allTables[ie]?y._allTables[ie].hook:vi(null,{creating:[ft,be],reading:[Ke,Ie],updating:[Le,be],deleting:[vt,be]})})),this.Transaction=(b=this,hi(vm.prototype,function(ie,he,me,ve,ce){var Se=this;ie!=="readonly"&&he.forEach(function(Ee){Ee=(Ee=me[Ee])==null?void 0:Ee.yProps,Ee&&(he=he.concat(Ee.map(function(we){return we.updatesTable})))}),this.db=b,this.mode=ie,this.storeNames=he,this.schema=me,this.chromeTransactionDurability=ve,this.idbtrans=null,this.on=vi(this,"complete","error","abort"),this.parent=ce||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ne(function(Ee,we){Se._resolve=Ee,Se._reject=we}),this._completion.then(function(){Se.active=!1,Se.on.complete.fire()},function(Ee){var we=Se.active;return Se.active=!1,Se.on.error.fire(Ee),Se.parent?Se.parent._reject(Ee):we&&Se.idbtrans&&Se.idbtrans.abort(),He(Ee)})})),this.Version=(E=this,hi(bm.prototype,function(ie){this.db=E,this._cfg={version:ie,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,hi(rf.prototype,function(ie,he,me){if(this.db=R,this._ctx={table:ie,index:he===":id"?null:he,or:me},this._cmp=this._ascending=Dt,this._descending=function(ve,ce){return Dt(ce,ve)},this._max=function(ve,ce){return 0<Dt(ve,ce)?ve:ce},this._min=function(ve,ce){return Dt(ve,ce)<0?ve:ce},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new re.MissingAPI})),this.on("versionchange",function(ie){0<ie.newVersion?console.warn("Another connection wants to upgrade database '".concat(V.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(V.name,"'. Closing db now to resume the delete request.")),V.close({disableAutoOpen:!1})}),this.on("blocked",function(ie){!ie.newVersion||ie.newVersion<ie.oldVersion?console.warn("Dexie.delete('".concat(V.name,"') was blocked")):console.warn("Upgrade '".concat(V.name,"' blocked by other connection holding version ").concat(ie.oldVersion/10))}),this._maxKey=mi(d.IDBKeyRange),this._createTransaction=function(ie,he,me,ve){return new V.Transaction(ie,he,me,V._options.chromeTransactionDurability,ve)},this._fireOnBlocked=function(ie){V.on("blocked").fire(ie),hn.filter(function(he){return he.name===V.name&&he!==V&&!he._state.vcFired}).map(function(he){return he.on("versionchange").fire(ie)})},this.use(Sm),this.use(Cm),this.use(Em),this.use(xm),this.use(km),new Proxy(this,{get:function(ie,he,me){var ve;return he==="_vip"||(he==="table"?function(ce){return Lo(V.table(ce),fe)}:(ve=Reflect.get(ie,he,me))instanceof Jd?Lo(ve,fe):he==="tables"?ve.map(function(ce){return Lo(ce,fe)}):he==="_createTransaction"?function(){return Lo(ve.apply(this,arguments),fe)}:ve)}}));this.vip=fe,de.forEach(function(ie){return ie(V)})}var zo,Os=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Im=(Tc.prototype.subscribe=function(c,d,g){return this._subscribe(c&&typeof c!="function"?c:{next:c,error:d,complete:g})},Tc.prototype[Os]=function(){return this},Tc);function Tc(c){this._subscribe=c}try{zo={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{zo={indexedDB:null,IDBKeyRange:null}}function _f(c){var d,g=!1,y=new Im(function(b){var E=ee(c),R,V=!1,de={},xe={},fe={get closed(){return V},unsubscribe:function(){V||(V=!0,R&&R.abort(),ie&&Sa.storagemutated.unsubscribe(me))}},ie=(b.start&&b.start(fe),!1),he=function(){return Be(ve)},me=function(ce){No(de,ce),_c(xe,de)&&he()},ve=function(){var ce,Se,Ee;!V&&zo.indexedDB&&(de={},ce={},R&&R.abort(),R=new AbortController,Ee=(we=>{var Ce=Wt();try{E&&vn();var De=_n(c,we);return De=E?De.finally(nr):De}finally{Ce&&dt()}})(Se={subscr:ce,signal:R.signal,requery:he,querier:c,trans:null}),Promise.resolve(Ee).then(function(we){g=!0,d=we,V||Se.signal.aborted||(de={},(Ce=>{for(var De in Ce)if(p(Ce,De))return;return 1})(xe=ce)||ie||(Sa(gi,me),ie=!0),Be(function(){return!V&&b.next&&b.next(we)}))},function(we){g=!1,["DatabaseClosedError","AbortError"].includes(we==null?void 0:we.name)||V||Be(function(){V||b.error&&b.error(we)})}))};return setTimeout(he,0),fe});return y.hasValue=function(){return g},y.getValue=function(){return d},y}var Ga=ra;function Cc(c){var d=Ea;try{Ea=!0,Sa.storagemutated.fire(c),xc(c,!0)}finally{Ea=d}}h(Ga,r(r({},ne),{delete:function(c){return new Ga(c,{addons:[]}).delete()},exists:function(c){return new Ga(c,{addons:[]}).open().then(function(d){return d.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(c){try{return d=Ga.dependencies,g=d.indexedDB,d=d.IDBKeyRange,(gc(g)?Promise.resolve(g.databases()).then(function(y){return y.map(function(b){return b.name}).filter(function(b){return b!==Vn})}):pc(g,d).toCollection().primaryKeys()).then(c)}catch{return He(new re.MissingAPI)}var d,g},defineClass:function(){return function(c){u(this,c)}},ignoreTransaction:function(c){return ze.trans?rt(ze.transless,c):c()},vip:mc,async:function(c){return function(){try{var d=kc(c.apply(this,arguments));return d&&typeof d.then=="function"?d:Ne.resolve(d)}catch(g){return He(g)}}},spawn:function(c,d,g){try{var y=kc(c.apply(g,d||[]));return y&&typeof y.then=="function"?y:Ne.resolve(y)}catch(b){return He(b)}},currentTransaction:{get:function(){return ze.trans||null}},waitFor:function(c,d){return c=Ne.resolve(typeof c=="function"?Ga.ignoreTransaction(c):c).timeout(d||6e4),ze.trans?ze.trans.waitFor(c):c},Promise:Ne,debug:{get:function(){return Oe},set:function(c){Qe(c)}},derive:k,extend:u,props:h,override:G,Events:vi,on:Sa,liveQuery:_f,extendObservabilitySet:No,getByKeyPath:L,setByKeyPath:N,delByKeyPath:function(c,d){typeof d=="string"?N(c,d,void 0):"length"in d&&[].map.call(d,function(g){N(c,g,void 0)})},shallowClone:J,deepClone:K,getObjectDiff:Sc,cmp:Dt,asap:z,minKey:-1/0,addons:[],connections:hn,errnames:_e,dependencies:zo,cache:Ua,semVer:"4.3.0",version:"4.3.0".split(".").map(function(c){return parseInt(c)}).reduce(function(c,d,g){return c+d/Math.pow(10,2*g)})})),Ga.maxKey=mi(Ga.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Sa(gi,function(c){Ea||(c=new CustomEvent(lc,{detail:c}),Ea=!0,dispatchEvent(c),Ea=!1)}),addEventListener(lc,function(c){c=c.detail,Ea||Cc(c)}));var Ns,Ea=!1,bf=function(){};return typeof BroadcastChannel<"u"&&((bf=function(){(Ns=new BroadcastChannel(lc)).onmessage=function(c){return c.data&&Cc(c.data)}})(),typeof Ns.unref=="function"&&Ns.unref(),Sa(gi,function(c){Ea||Ns.postMessage(c)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(c){if(!ra.disableBfCache&&c.persisted){Oe&&console.debug("Dexie: handling persisted pagehide"),Ns!=null&&Ns.close();for(var d=0,g=hn;d<g.length;d++)g[d].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(c){!ra.disableBfCache&&c.persisted&&(Oe&&console.debug("Dexie: handling persisted pageshow"),bf(),Cc({all:new Dn(-1/0,[[]])}))})),Ne.rejectionMapper=function(c,d){return!c||c instanceof U||c instanceof TypeError||c instanceof SyntaxError||!c.name||!Te[c.name]?c:(d=new Te[c.name](d||c.message,c),"stack"in c&&x(d,"stack",{get:function(){return this.inner.stack}}),d)},Qe(Oe),r(ra,Object.freeze({__proto__:null,Dexie:ra,Entity:Wd,PropModification:fi,RangeSet:Dn,add:function(c){return new fi({add:c})},cmp:Dt,default:ra,liveQuery:_f,mergeRanges:bi,rangesOverlap:cf,remove:function(c){return new fi({remove:c})},replacePrefix:function(c,d){return new fi({replacePrefix:[c,d]})}}),{default:ra}),ra})})(rl)),rl.exports}var x_=w_();const _u=__(x_),jf=Symbol.for("Dexie"),Ln=globalThis[jf]||(globalThis[jf]=_u);if(_u.semVer!==Ln.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_u.semVer} and ${Ln.semVer}`);const{liveQuery:a3,mergeRanges:s3,rangesOverlap:i3,RangeSet:o3,cmp:l3,Entity:c3,PropModification:u3,replacePrefix:d3,add:f3,remove:v3,DexieYProvider:h3}=Ln,at=new Ln("me-ai-store");at.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});at.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});at.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});at.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});at.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});at.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function ud(t,e){return`${t}:${e}`}const k_=Object.freeze(Object.defineProperty({__proto__:null,db:at,makeItemId:ud},Symbol.toStringTag,{value:"Module"}));async function Vi(t,e=null){try{const n=await at.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Ui(t,e){try{await at.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function dd(t){try{await at.settings.delete(t)}catch{}}async function S_(t){const e=await at.settings.bulkGet(t);return Object.fromEntries(t.map((n,r)=>{var a;return[n,((a=e[r])==null?void 0:a.value)??null]}))}const wa=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Vi,getSettings:S_,removeSetting:dd,setSetting:Ui},Symbol.toStringTag,{value:"Module"})),Yr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function fd(t){return Yr.find(e=>e.id===t)}const E_=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Yr,getModelInfo:fd},Symbol.toStringTag,{value:"Module"})),Xr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function dp(){return Xr.filter(t=>t.recommended)}function vd(t){return Xr.find(e=>e.name===t||e.name.startsWith(t+":"))}const A_=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Xr,getOllamaModelInfo:vd,getRecommendedOllamaModels:dp},Symbol.toStringTag,{value:"Module"}));let Xn=null,da="idle",al=null,Xa=new Set;function Fo(){return Xn||(Xn=new Worker(new URL(""+new URL("worker-CB9TH5z_.js",import.meta.url).href,import.meta.url),{type:"module"}),Xn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(da="loading"),e.status==="ready"&&(da="ready"),e.status==="start"&&(da="generating"),(e.status==="complete"||e.status==="error")&&(da=al?"ready":"idle");for(const n of Xa)try{n(e)}catch{}})),Xn}function Lc(){return{check(){Fo().postMessage({type:"check"})},loadModel(t){al=t,da="loading",Fo().postMessage({type:"load",modelId:t})},generate(t,e){Fo().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,u=0;const f=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Xa.delete(f)};Xa.add(f),Fo().postMessage({type:"generate",data:t,options:e})})},interrupt(){Xn==null||Xn.postMessage({type:"interrupt"})},reset(){Xn==null||Xn.postMessage({type:"reset"})},onMessage(t){return Xa.add(t),()=>Xa.delete(t)},offMessage(t){Xa.delete(t)},get status(){return da},get isReady(){return da==="ready"},get isGenerating(){return da==="generating"},get modelId(){return al},terminate(){Xn==null||Xn.terminate(),Xn=null,da="idle",al=null,Xa.clear()}}}const T_="modulepreload",C_=function(t,e){return new URL(t,e).href},Bf={},tr=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(v){return Promise.all(v.map(p=>Promise.resolve(p).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const l=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=i(n.map(v=>{if(v=C_(v,r),v in Bf)return;Bf[v]=!0;const p=v.endsWith(".css"),h=p?'[rel="stylesheet"]':"";if(!!r)for(let k=l.length-1;k>=0;k--){const A=l[k];if(A.href===v&&(!p||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${h}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":T_,p||(x.as="script"),x.crossOrigin="",x.href=v,f&&x.setAttribute("nonce",f),document.head.appendChild(x),p)return new Promise((k,A)=>{x.addEventListener("load",k),x.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${v}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},qf="http://localhost:11434",I_="https://me-ai.metaelon.space";function fp(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?qf:I_}catch{return qf}}function go(){return fp()}async function P_(){const{getSetting:t}=await tr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>wa);return{getSetting:e}},void 0,import.meta.url);return await t("ollamaUrl")||fp()}async function M_(t){const{setSetting:e}=await tr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>wa);return{setSetting:n}},void 0,import.meta.url);await e("ollamaUrl",t)}async function bu(t=go()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function O_(t=go()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function N_(t,e,{temperature:n=.7,maxTokens:r=4096,keepAlive:a}={},s=()=>{},i=go()){var x;const l={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:r}};a!==void 0?l.keep_alive=a:l.keep_alive="10m";const u=new AbortController,f=setTimeout(()=>u.abort(),3e5),v=await fetch(`${i}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),signal:u.signal});if(clearTimeout(f),!v.ok){const k=await v.text();throw new Error(`Ollama API error: ${k}`)}const p=v.body.getReader(),h=new TextDecoder;let m="";try{for(;;){const{done:k,value:A}=await p.read();if(k)break;const q=h.decode(A).split(`
`).filter(Boolean);for(const G of q)try{const S=JSON.parse(G);if((x=S.message)!=null&&x.content&&(m+=S.message.content,s({content:S.message.content,done:!1,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration})),S.done){s({content:"",done:!0,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration});break}}catch{}}}finally{p.releaseLock()}return m}let ar="idle",Rs=null,Za=new Set;function wr(t){for(const e of Za)try{e(t)}catch{}}function R_(){return{async check(){ar="loading",wr({status:"loading",data:"Testing Ollama connection..."});const t=await bu();t.connected?(ar="idle",wr({status:"ready",data:{type:"ollama",version:t.version,url:go()}})):(ar="idle",wr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Rs=t,ar="loading",wr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await bu();if(!e.connected){ar="idle",Rs=null,wr({status:"error",data:`Ollama not available: ${e.error}`});return}ar="ready",wr({status:"ready"})},async generate(t,e={}){if(!Rs){wr({status:"error",data:"No Ollama model selected"});return}ar="generating",wr({status:"start",inputTokens:0});let n=0,r=performance.now();try{await N_(Rs,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},a=>{if(a.content){n++;const s=performance.now()-r,i=s>0?n/s*1e3:0;wr({status:"update",output:a.content,tps:Math.round(i*10)/10,numTokens:n})}a.done&&(ar="ready",wr({status:"complete",tps:a.eval_duration?Math.round(a.eval_count/(a.eval_duration/1e9)*10)/10:null,numTokens:a.eval_count||n}))})}catch(a){ar="ready",wr({status:"error",data:a.message})}},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,u=0;const f=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Za.delete(f)};Za.add(f),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return Za.add(t),()=>Za.delete(t)},offMessage(t){Za.delete(t)},get status(){return ar},get isReady(){return ar==="ready"},get isGenerating(){return ar==="generating"},get modelId(){return Rs},get backend(){return"ollama"},terminate(){ar="idle",Rs=null,Za.clear()}}}let Ya=null,Et=null,zc=new Set;function D_(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function vp(){return{loadModel(t){const e=D_(t);if(Ya!==e){Et&&Et.terminate(),Ya=e,Et=e==="webgpu"?Lc():R_();for(const n of zc)Et.onMessage(n)}Et.loadModel(t)},check(){Et||(Et=Lc(),Ya="webgpu"),Et.check()},generate(t,e){if(!Et)throw new Error("No engine loaded. Call loadModel() first.");return Et.generate(t,e)},generateFull(t,e,n){return Et?Et.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Et==null||Et.interrupt()},reset(){Et==null||Et.reset()},onMessage(t){return Et||(Et=Lc(),Ya="webgpu"),zc.add(t),Et.onMessage(t)},offMessage(t){zc.delete(t),Et==null||Et.offMessage(t)},get status(){return(Et==null?void 0:Et.status)||"idle"},get isReady(){return(Et==null?void 0:Et.isReady)||!1},get isGenerating(){return(Et==null?void 0:Et.isGenerating)||!1},get modelId(){return(Et==null?void 0:Et.modelId)||null},get backend(){return Ya},getModelInfo(){const t=this.modelId;return t?Ya==="webgpu"?fd(t):vd(t):null},terminate(){Et==null||Et.terminate(),Et=null,Ya=null}}}function wu(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,r)).toFixed(1)+" "+n[r]}function jc(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e)),a=t/Math.pow(e,r),s=r>=2?2:r>=1?1:0;return a.toFixed(s)+" "+n[r]}function L_(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function z_(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Hl(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const j_="https://gmail.googleapis.com/gmail/v1/users/me";class hd extends Error{constructor(e,n,r){super(e),this.name="GmailApiError",this.status=n,this.code=r||null}}function B_(t){return{Authorization:`Bearer ${t}`}}async function Vl(t,e){var r,a,s,i;const n=await fetch(`${j_}${e}`,{headers:B_(t)});if(!n.ok){const l=await n.json().catch(()=>({})),u=((r=l.error)==null?void 0:r.message)||`Gmail API error: ${n.status}`,f=((i=(s=(a=l.error)==null?void 0:a.errors)==null?void 0:s[0])==null?void 0:i.reason)||void 0;throw new hd(u,n.status,f)}return n.json()}function hp(t){return Vl(t,"/profile")}function pp(t,{maxResults:e=20,pageToken:n,q:r}={}){const a=new URLSearchParams;return a.set("maxResults",String(e)),n&&a.set("pageToken",n),r&&a.set("q",r),Vl(t,`/messages?${a}`)}function gp(t,e,n="full"){return Vl(t,`/messages/${e}?format=${n}`)}function q_(t,{startHistoryId:e,pageToken:n,maxResults:r=500}={}){const a=new URLSearchParams;return a.set("startHistoryId",e),a.set("maxResults",String(r)),a.append("historyTypes","messageAdded"),a.append("historyTypes","messageDeleted"),n&&a.set("pageToken",n),Vl(t,`/history?${a}`)}function Ta(t,e){var s;const n=((s=t==null?void 0:t.payload)==null?void 0:s.headers)||[],r=e.toLowerCase(),a=n.find(i=>i.name.toLowerCase()===r);return(a==null?void 0:a.value)||""}function Bi(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const r=atob(e),a=Uint8Array.from(r,s=>s.charCodeAt(0));return new TextDecoder().decode(a)}function F_(t){var s,i,l;const e=t==null?void 0:t.payload;if(!e)return"";if((s=e.body)!=null&&s.data)return Bi(e.body.data);const n=e.parts||[],r=hl(n,"text/plain");if((i=r==null?void 0:r.body)!=null&&i.data)return Bi(r.body.data);const a=hl(n,"text/html");if((l=a==null?void 0:a.body)!=null&&l.data){const u=Bi(a.body.data);return H_(u)}return"(no body)"}function K_(t){var a,s;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((a=e.body)!=null&&a.data))return Bi(e.body.data);const n=e.parts||[],r=hl(n,"text/html");return(s=r==null?void 0:r.body)!=null&&s.data?Bi(r.body.data):null}function hl(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const r=hl(n.parts,e);if(r)return r}}return null}function H_(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function pd(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function mp(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function yp(t){return mp(t).charAt(0).toUpperCase()}function V_(t){try{const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}catch{return"email"}}function U_(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function _p(t,e){return`${V_(t.date)}_${U_(t.subject)}.${e}`}function bp(t){const e={};for(const r of t){const a=r.action||"UNKNOWN";e[a]||(e[a]=[]),e[a].push(r)}for(const r of Object.keys(e))e[r].sort((a,s)=>(s.date||0)-(a.date||0));const n=Object.keys(e).sort((r,a)=>e[a].length-e[r].length);return{groups:e,order:n}}async function G_(){const t=await at.items.where("sourceType").equals("gmail").count(),e=await at.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:r,newest:a}=await wp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`Date range: ${s} to ${i}.`)}return n.join(" ")}async function W_(){const t=await at.items.where("sourceType").equals("gmail").count(),e=await at.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:r,newest:a}=await wp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`- **Date range:** ${s} â ${i}`)}return n.join(`
`)}async function Y_(t=10){const e=await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(xp).join(`

---

`)}async function X_(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),a=(await at.items.where("sourceType").equals("gmail").toArray()).map(s=>{var l,u,f,v,p;let i=0;return(l=s.subject)!=null&&l.toLowerCase().includes(n)&&(i+=3),(u=s.from)!=null&&u.toLowerCase().includes(n)&&(i+=2),(f=s.to)!=null&&f.toLowerCase().includes(n)&&(i+=2),(v=s.snippet)!=null&&v.toLowerCase().includes(n)&&(i+=1),(p=s.body)!=null&&p.toLowerCase().includes(n)&&(i+=1),{item:s,score:i}}).filter(({score:s})=>s>0).sort((s,i)=>i.score-s.score).slice(0,e);return a.length===0?`No results found for "${t}".`:a.map(({item:s})=>xp(s)).join(`

---

`)}async function Ff(){const t=await at.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=bp(t);return{groups:e,order:n,total:t.length}}async function Z_({query:t,limit:e=50,offset:n=0}={}){if(t){const s=t.toLowerCase(),i=await at.items.where("sourceType").equals("gmail").filter(l=>{var u,f,v,p;return((u=l.subject)==null?void 0:u.toLowerCase().includes(s))||((f=l.from)==null?void 0:f.toLowerCase().includes(s))||((v=l.to)==null?void 0:v.toLowerCase().includes(s))||((p=l.snippet)==null?void 0:p.toLowerCase().includes(s))}).toArray();return i.sort((l,u)=>(u.date||0)-(l.date||0)),{items:i.slice(n,n+e),total:i.length}}const r=await at.items.where("sourceType").equals("gmail").count();return{items:await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).reverse().offset(n).limit(e).toArray(),total:r}}async function wp(){const t=await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).first(),e=await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).last();return{oldest:t,newest:e}}function xp(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=z_(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function Q_(){const t=await G_();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function J_(t){const e=[],n=await W_();if(e.push(n),t){const r=await X_(t,5);e.push("","## Relevant Emails",r)}else{const r=await Y_(5);e.push("","## Recent Emails",r)}return e.join(`
`)}const Nr={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},gd="INFO",kp="me-ai-events",Sp="me-ai-event-groups";async function ci(){const{getSetting:t}=await tr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>wa);return{getSetting:e}},void 0,import.meta.url);return await t(kp)||{}}async function Ul(t){const{setSetting:e}=await tr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>wa);return{setSetting:n}},void 0,import.meta.url);await e(kp,t)}async function Gl(){const{getSetting:t}=await tr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>wa);return{getSetting:e}},void 0,import.meta.url);return await t(Sp)||{}}async function Ep(t){const{setSetting:e}=await tr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>wa);return{setSetting:n}},void 0,import.meta.url);await e(Sp,t)}async function $_(){try{const{db:t}=await tr(async()=>{const{db:r}=await Promise.resolve().then(()=>k_);return{db:r}},void 0,import.meta.url),e=await t.emailClassifications.toArray();return[...new Set(e.map(r=>r.action).filter(Boolean))].sort()}catch{return[]}}async function eb(){const t=await ci(),e=await $_();return[...new Set([...Object.keys(t),...e])].sort()}async function pl(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await Gl())[e]||gd}async function tb(t,e){const n=t.toUpperCase();if(!Nr[e])throw new Error(`Unknown group: ${e}`);const r=await Gl();r[n]=e,await Ep(r)}async function nb(){return Gl()}async function Ap(t){const e=await pl(t),n=Nr[e]||Nr[gd];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function Jr(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await ci())[e]||[]}const Bc=Jr;async function rb(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await ci();e in n||(n[e]=[],await Ul(n))}async function ab(t,e,n){const r=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!r)return;const a=await ci(),s=await Gl();if(!(r in s)){const i=Nr[e]?e:gd;s[r]=i,await Ep(s)}if(!(r in a)){const{pluginRegistry:i}=await tr(async()=>{const{pluginRegistry:v}=await Promise.resolve().then(()=>_b);return{pluginRegistry:v}},void 0,import.meta.url),l=i.getAvailableActions("gmail"),u=Object.fromEntries(l.map(v=>[v.actionId,v])),f=(n||[]).filter(v=>u[v]).map(v=>({id:v,pluginId:"gmail",commandId:v,name:u[v].name,description:u[v].description}));a[r]=f,await Ul(a)}}async function sb(t){const e=t.toUpperCase(),n=await ci();delete n[e],await Ul(n)}async function md(t,e){const n=t.toUpperCase(),r=await ci();r[n]=e,await Ul(r)}async function ib(t,e){const n=await Jr(t);await md(t,[...n,e])}const Kf=ib;async function ob(t,e){const n=await Jr(t);await md(t,n.filter(r=>r.id!==e))}const lb=ob;async function cb(t,e,n){const r=await Jr(t);await md(t,r.map(a=>a.id===e?{...a,...n}:a))}const ub=cb;async function db(t,e){var a;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((a=e.body)==null?void 0:a.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},r=await Jr(t.action);return{event:n,commands:r}}async function fb(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:r,commands:a}=await db(n.classification,n.email);return{event:r,commands:a}})),content:""}}async function vb(t){const e=await Promise.all(t.order.map(async r=>{const a=t.groups[r]||[],s=await Jr(r),i=await pl(r),l=a.map(u=>({emailId:u.emailId,subject:u.subject||"(no subject)",from:u.from||"",date:u.date,summary:u.summary||"",reason:u.reason||"",tags:u.tags||[],status:u.status||"pending"}));return{eventType:r,group:i,emails:l,commands:s}})),n=e.reduce((r,a)=>r+a.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class hb{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var a,s,i;const r=this.handlers.get(e);if(!r)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(a=n.onProgress)==null||a.call(n,{phase:"executing",actionId:e,actionName:r.name});const l=await r.execute(n);return(s=n.onProgress)==null||s.call(n,{phase:"completed",actionId:e,actionName:r.name,result:l}),l}catch(l){const u={success:!1,error:l,message:l.message||"Unknown error"};return(i=n.onProgress)==null||i.call(n,{phase:"failed",actionId:e,actionName:r.name,error:l.message}),u}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const pb="https://gmail.googleapis.com/gmail/v1/users/me",aa={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Un(t,e,n,r=null){var i;const a={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};r&&(a.body=JSON.stringify(r));const s=await fetch(`${pb}${n}`,a);if(!s.ok){const u=((i=(await s.json().catch(()=>({}))).error)==null?void 0:i.message)||`Gmail API error: ${s.status}`;throw new Error(u)}return s.status===204?{success:!0}:s.json()}class gb extends hb{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}extractMessageId(e){const n=e.event.data.emailId||e.event.data.id;return n?n.startsWith("gmail:")?n.substring(6):n:null}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[aa.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[aa.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[aa.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[aa.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[aa.SPAM],removeLabelIds:[aa.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[aa.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[r]}),{success:!0,message:`Applied label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[r]}),{success:!0,message:`Removed label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[aa.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Un(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[aa.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,r=[],a=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Un(e,"POST","/messages/batchModify",{ids:n,addLabelIds:r,removeLabelIds:a}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Un(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const mb=new gb;let yb=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(mb)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const r=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,a=r.pluginId||this.resolvePluginId(n.event.source),s=r.commandId||r.id,i=this.getPlugin(a);return i?i.canExecute(s)?i.execute(s,n):{success:!1,message:`Command "${s}" not found in plugin "${i.serviceName}". Available: ${i.getHandlers().map(l=>l.actionId).join(", ")}`,error:new Error(`Command not supported: ${s}`)}:{success:!1,message:`Plugin "${a}" not found. Is it registered?`,error:new Error(`Plugin not found: ${a}`)}}async executePipeline(e,n){var u,f;const r=[];let a=!0;for(const v of e){(u=n.onProgress)==null||u.call(n,{phase:"action_start",actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId});const p=await this.executeAction(v,n);r.push({actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId,...p}),p.success||(a=!1),(f=n.onProgress)==null||f.call(n,{phase:"action_complete",actionId:v.id,actionName:v.name,result:p})}const i=r.filter(v=>!v.success).map(v=>{var p;return`${v.pluginId}Â·${v.commandId}: ${v.message||((p=v.error)==null?void 0:p.message)||"Unknown error"}`}).join("; "),l=r.filter(v=>v.success).map(v=>`${v.pluginId}Â·${v.commandId}`).join(", ");return{success:a,results:r,message:a?`Successfully executed: ${l}`:`Pipeline failed: ${i}`}}async executePipelineBatch(e,n,r){var l,u;const a=[];for(let f=0;f<n.length;f++){const v=n[f];(l=r.onProgress)==null||l.call(r,{phase:"batch_event_start",eventIndex:f,totalEvents:n.length,event:v});const p={...r,event:v},h=await this.executePipeline(e,p);a.push({event:v,...h}),(u=r.onProgress)==null||u.call(r,{phase:"batch_event_complete",eventIndex:f,totalEvents:n.length,event:v,result:h})}const s=a.filter(f=>f.success).length,i=a.filter(f=>!f.success).length;return{success:i===0,results:a,total:n.length,successful:s,failed:i,message:`Processed ${n.length} event(s): ${s} successful, ${i} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),r=this.getPlugin(n);return r?r.getHandlers():[]}getRequiredScopes(e,n){const r=this.resolvePluginId(n),a=this.getPlugin(r);return a?a.getRequiredScopes(e):[]}};const ui=new yb,_b=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:ui},Symbol.toStringTag,{value:"Module"})),bb=20,wb={maxTokens:512};function Tp(t){const e=[],n=[];for(const s of t)if(s.actions.length){e.push(`${s.pluginName} plugin:`);for(const i of s.actions)e.push(`  ${i.actionId.padEnd(22)} â ${i.name}: ${i.description}`),n.push(i.actionId)}const r=e.length?e.join(`
`):"  (no actions available)",a=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${r}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${a})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function Cp(){return ui.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const Ip=Tp(Cp());async function Pp(t,{count:e=bb,force:n=!1,onProgress:r=()=>{},signal:a}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");r({phase:"loading",message:"Loading recent emails..."});let s,i=0;if(n)s=await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).reverse().limit(e).toArray();else{const L=new Set(await at.emailClassifications.toCollection().primaryKeys());i=0,s=[],await at.items.where("[sourceType+date]").between(["gmail",Ln.minKey],["gmail",Ln.maxKey]).reverse().until(()=>s.length>=e).each(N=>{L.has(N.id)?i++:s.push(N)})}if(s.length===0){const L=n?"No emails to scan.":`All emails already classified (${i} total). Use "Rescan All" to reclassify.`;return r({phase:"done",message:L,classified:0}),{scanned:0,classified:0,skipped:i,errors:0}}const l=Date.now(),u=performance.now();let f=0,v=0,p=0,h=0;const m=[],x=Cp(),k=Tp(x),A=new Set(x.flatMap(L=>L.actions.map(N=>N.actionId))),D=t.modelId,q=fd(D)||vd(D);if(!q)throw new Error(`Unknown model: ${D}`);if(!q.recommendedForEmailProcessing&&s.length>0){const{MODELS:L}=await tr(async()=>{const{MODELS:ke}=await Promise.resolve().then(()=>E_);return{MODELS:ke}},void 0,import.meta.url),{OLLAMA_MODELS:N}=await tr(async()=>{const{OLLAMA_MODELS:ke}=await Promise.resolve().then(()=>A_);return{OLLAMA_MODELS:ke}},void 0,import.meta.url),J=[...L.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.name),...N.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.displayName)],ae=q.displayName||q.name;console.warn(`â ï¸ Current model (${ae}) is not optimized for email processing. For best results with long emails, use: ${J.join(", ")}. Some emails may fail due to memory limits.`)}for(let L=0;L<s.length&&!(a!=null&&a.aborted);L++){const N=s[L],J=Np(N),ae=[{role:"system",content:k},{role:"user",content:J}];r({phase:"scanning",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:N.subject,from:N.from,date:N.date},prompt:{system:Ip,user:J},systemPromptLength:k.length,live:null,lastResult:null,totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}});const ke=performance.now();try{const{text:X,tps:T,numTokens:K,inputTokens:P}=await t.generateFull(ae,{maxTokens:512,enableThinking:!1,temperature:0},Q=>{r({phase:"generating",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:N.subject,from:N.from,date:N.date},live:{tps:Q.tps,numTokens:Q.numTokens},streamingText:Q.text||"",totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})});p+=K,h+=P;const O=kb(X,A),I=performance.now()-ke;if(O){await at.emailClassifications.put({emailId:N.id,action:O.action,group:O.group,reason:O.reason,summary:O.summary,tags:O.tags,subject:N.subject||"(no subject)",from:N.from||"",date:N.date,scannedAt:l,status:"pending"}),await ab(O.action,O.group,O.suggestedActions),f++;const Q={success:!0,email:{subject:N.subject,from:N.from,date:N.date},classification:O,rawResponse:X,stats:{tps:T,numTokens:K,inputTokens:P,elapsed:I},promptSize:J.length};m.push(Q),r({phase:"classified",current:L+1,total:s.length,classified:f,errors:v,results:m,email:{subject:N.subject,from:N.from,date:N.date},result:O,rawResponse:X,emailStats:{tps:T,numTokens:K,inputTokens:P,elapsed:I},totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})}}catch(X){console.error(`Triage email ${L+1} failed:`,X),v++;const T=X.message||String(X),K=T.length>200?T.slice(0,200)+"...":T;m.push({success:!1,email:{subject:N.subject,from:N.from,date:N.date},error:K,promptSize:J.length})}}const G=performance.now()-u,S=m.length>0?Math.round(m.reduce((L,N)=>L+N.promptSize,0)/m.length):0,z=m.filter(L=>{var N;return L.success&&((N=L.stats)==null?void 0:N.tps)}).length>0?Math.round(m.filter(L=>L.success).reduce((L,N)=>{var J;return L+(((J=N.stats)==null?void 0:J.tps)||0)},0)/m.filter(L=>{var N;return L.success&&((N=L.stats)==null?void 0:N.tps)}).length):null;return r({phase:"done",current:s.length,total:s.length,classified:f,errors:v,results:m,summary:{avgPromptSize:S,avgTps:z,systemPromptSize:k.length,processed:s.length,skipped:i,modelName:q.displayName||q.name,modelContextWindow:q.contextWindow,modelMaxEmailTokens:q.maxEmailTokens},totals:{outputTokens:p,inputTokens:h,elapsed:G}}),{scanned:s.length,classified:f,skipped:i,errors:v}}async function Mp(){const t=await at.emailClassifications.toArray();return bp(t)}async function xb(){const t=await at.emailClassifications.toArray(),e={total:t.length};for(const n of t){const r=n.action||"UNKNOWN";e[r]=(e[r]||0)+1}return e}async function gl(t,e){await at.emailClassifications.update(t,{status:e})}async function Hf(){await at.emailClassifications.clear()}async function yd(t){await at.emailClassifications.where("action").equals(t).delete()}async function Op(t){await at.emailClassifications.delete(t)}async function xu(){const t=await at.items.where("sourceType").equals("gmail").count(),e=await at.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Np(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function kb(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const r=n.indexOf("{"),a=n.lastIndexOf("}");if(r===-1||a===-1||a<=r)return console.warn("Triage: no JSON object found in response"),null;const s=n.indexOf("[");if(s!==-1&&s<r)return console.warn("Triage: expected JSON object, got array"),null;const i=n.slice(r,a+1);try{const l=JSON.parse(i);if(!l||typeof l!="object"||Array.isArray(l))return null;const u=Sb(l.action);if(!u)return console.warn("Triage: missing or invalid action field"),null;const v=["NOISE","INFO","CRITICAL"].includes(l.group)?l.group:"INFO";let p=[];Array.isArray(l.suggestedActions)&&(p=l.suggestedActions.filter(m=>typeof m!="string"||!m.trim()?!1:e?e.has(m.trim()):!0).map(m=>m.trim()).slice(0,5)),p.length===0&&Array.isArray(l.suggestedActions)&&l.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",l.suggestedActions);let h=[];return Array.isArray(l.tags)&&(h=l.tags.filter(m=>typeof m=="string"&&m.trim()).map(m=>m.trim().toLowerCase()).slice(0,10)),{action:u,group:v,suggestedActions:p,reason:String(l.reason||"").slice(0,300),summary:String(l.summary||"").slice(0,500),tags:h}}catch(l){return console.warn("Triage: failed to parse JSON response:",l.message),null}}function Sb(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function ku(t){return`hsl(${Hl(t)}, 55%, 55%)`}function Eb(t){return`hsl(${Hl(t)}, 40%, 35%)`}var Ab=F('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Tb=F('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function Cb(t,e){et(e,!0);let n=Ae(e,"backend",15,"webgpu"),r=Ae(e,"isWebGPUAvailable",3,!0);var a=Tb(),s=w(_(a),2),i=_(s);let l;i.__click=()=>n("webgpu");var u=w(i,2);let f;u.__click=()=>n("ollama");var v=w(s,2);{var p=h=>{var m=Ab();C(h,m)};pe(v,h=>{!r()&&n()==="webgpu"&&h(p)})}se(()=>{l=It(i,1,"backend-btn svelte-1n2kfl0",null,l,{active:n()==="webgpu"}),i.disabled=!r(),f=It(u,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="ollama"})}),C(t,a),tt()}Jt(["click"]);const Ib=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Vf(...t){Ib&&console.log("[debug]",...t)}function ur(t){return Vf(`[MOUNT] ${t}`),()=>Vf(`[DESTROY] ${t}`)}var Pb=F("<option> </option>"),Mb=F('<p class="model-description svelte-1p89qnn"> </p>'),Ob=F('<span class="current-badge svelte-1p89qnn">Current</span>'),Nb=F('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Rb=F('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Db=F('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),Lb=F('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),zb=F('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),jb=F('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),Bb=F('<p class="error svelte-1p89qnn"> </p>'),qb=F('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Fb(t,e){et(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"gpuInfo",3,null),a=Ae(e,"error",3,null);En(()=>ur("ModelSelector"));var s=qb(),i=_(s),l=w(_(i),2),u=w(_(l),2);Tt(u,21,()=>Yr,Ut,(S,z)=>{var L=Pb(),N=_(L),J={};se(()=>{te(N,`${o(z).name??""} â ${o(z).size??""}`),J!==(J=o(z).id)&&(L.value=(L.__value=o(z).id)??"")}),C(S,L)});var f=w(u,2);{var v=S=>{const z=$(()=>Yr.find(ae=>ae.id===n()));var L=ln(),N=We(L);{var J=ae=>{var ke=Mb(),X=_(ke);se(()=>te(X,o(z).description)),C(ae,ke)};pe(N,ae=>{o(z)&&ae(J)})}C(S,L)};pe(f,S=>{n()&&S(v)})}var p=w(l,2),h=w(_(p),2),m=_(h),x=w(_(m));Tt(x,21,()=>Yr,Ut,(S,z)=>{var L=Lb();let N;var J=_(L),ae=_(J),ke=w(ae);{var X=ne=>{var H=Ob();C(ne,H)};pe(ke,ne=>{o(z).id===n()&&ne(X)})}var T=w(J),K=_(T),P=_(K),O=w(T),I=_(O),Q=w(O),W=_(Q);{var Z=ne=>{var H=Nb();C(ne,H)},j=ne=>{var H=Rb();C(ne,H)},ee=ne=>{var H=Db();C(ne,H)};pe(W,ne=>{o(z).recommendedForEmailProcessing?ne(Z):o(z).maxEmailTokens>=6e3?ne(j,1):ne(ee,!1)})}se((ne,H)=>{N=It(L,1,"svelte-1p89qnn",null,N,{selected:o(z).id===n()}),te(ae,`${o(z).name??""} `),te(P,`${ne??""}k`),te(I,`~${H??""}k`)},[()=>(o(z).contextWindow/1024).toFixed(0),()=>(o(z).maxEmailTokens/1e3).toFixed(0)]),C(S,L)});var k=w(p,2);{var A=S=>{var z=jb(),L=w(_(z),2),N=_(L),J=w(_(N)),ae=_(J),ke=w(N,2),X=w(_(ke)),T=_(X),K=w(ke,2);{var P=O=>{var I=zb(),Q=w(_(I)),W=_(Q);se(Z=>te(W,Z),[()=>wu(r().limits.maxBufferSize)]),C(O,I)};pe(K,O=>{var I;(I=r().limits)!=null&&I.maxBufferSize&&O(P)})}se(()=>{te(ae,r().vendor),te(T,r().architecture)}),C(S,z)};pe(k,S=>{r()&&S(A)})}var D=w(k,2);{var q=S=>{var z=Bb(),L=_(z);se(()=>te(L,a())),C(S,z)};pe(D,S=>{a()&&S(q)})}var G=w(D,2);G.__click=function(...S){var z;(z=e.onload)==null||z.apply(this,S)},se(()=>G.disabled=a()),po(u,n),C(t,s),tt()}Jt(["click"]);var Kb=F('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),Hb=F('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),Vb=F('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),Ub=F("<div><!></div>"),Gb=F("<option> <!></option>"),Wb=F("<option> <!></option>"),Yb=F('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Xb=F('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Zb=F('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Qb=F('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Jb=F('<span class="current-badge svelte-1bvvk8o">Current</span>'),$b=F('<span class="installed-badge svelte-1bvvk8o">â</span>'),e0=F('<span class="rec-badge svelte-1bvvk8o">â</span>'),t0=F('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),n0=F('<p class="error svelte-1bvvk8o"> </p>'),r0=F('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function a0(t,e){et(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"error",15);const a=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let s=Me(en(go())),i=Me(!1),l=Me(null),u=Me(en([])),f=Me(!1);On(()=>{P_().then(U=>{M(s,U,!0),v()})});async function v(){M(i,!0),M(l,null);const U=await bu(o(s));M(l,U,!0),M(i,!1),U.connected&&p()}async function p(){M(f,!0);try{const U=await O_(o(s));M(u,U.map(le=>le.name),!0)}catch(U){console.error("Failed to load Ollama models:",U),M(u,[],!0)}M(f,!1)}function h(){M_(o(s)),v()}function m(){if(!n()){r("Please select a model");return}e.onload()}function x(U){return o(u).length?o(u).includes(U):!1}const k=dp();var A=r0(),D=_(A),q=_(D),G=w(_(q)),S=_(G),z=w(q,2),L=_(z);L.__change=h;var N=w(L,2);N.__click=v;var J=_(N),ae=w(z,2);{var ke=U=>{var le=Ub();let Y;var ue=_(le);{var _e=re=>{var Te=Kb(),be=w(We(Te),2),Ie=_(be);se(()=>te(Ie,`Connected â¢ v${o(l).version??""}`)),C(re,Te)},ge=re=>{var Te=Vb(),be=w(We(Te),2),Ie=_(be),Ke=_(Ie),Xe=w(Ie,2);{var ft=vt=>{var Le=Hb(),Re=w(_(Le),2),qe=_(Re),Oe=w(_(qe));Oe.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var Qe=w(qe,2),ct=w(_(Qe));ct.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,C(vt,Le)};pe(Xe,vt=>{o(l).corsError&&vt(ft)})}se(()=>te(Ke,`Disconnected: ${o(l).error??""}`)),C(re,Te)};pe(ue,re=>{o(l).connected?re(_e):re(ge,!1)})}se(()=>Y=It(le,1,"connection-status svelte-1bvvk8o",null,Y,{connected:o(l).connected})),C(U,le)};pe(ae,U=>{o(l)&&U(ke)})}var X=w(D,2),T=w(_(X),2),K=_(T);Tt(K,21,()=>k,Ut,(U,le)=>{var Y=Gb(),ue=_(Y),_e=w(ue);{var ge=be=>{var Ie=mn("â");C(be,Ie)},re=$(()=>x(o(le).name));pe(_e,be=>{o(re)&&be(ge)})}var Te={};se(be=>{te(ue,`${o(le).displayName??""} (${o(le).params??""}) - ${be??""}k context `),Te!==(Te=o(le).name)&&(Y.value=(Y.__value=o(le).name)??"")},[()=>(o(le).contextWindow/1024).toFixed(0)]),C(U,Y)});var P=w(K);Tt(P,21,()=>Xr.filter(U=>!U.recommended),Ut,(U,le)=>{var Y=Wb(),ue=_(Y),_e=w(ue);{var ge=be=>{var Ie=mn("â");C(be,Ie)},re=$(()=>x(o(le).name));pe(_e,be=>{o(re)&&be(ge)})}var Te={};se(be=>{te(ue,`${o(le).displayName??""} (${o(le).params??""}) - ${be??""}k context `),Te!==(Te=o(le).name)&&(Y.value=(Y.__value=o(le).name)??"")},[()=>(o(le).contextWindow/1024).toFixed(0)]),C(U,Y)});var O=w(T,2);{var I=U=>{const le=$(()=>Xr.find(ge=>ge.name===n()));var Y=ln(),ue=We(Y);{var _e=ge=>{var re=Qb(),Te=_(re),be=_(Te),Ie=w(Te,2),Ke=_(Ie),Xe=_(Ke),ft=w(Ke,4),vt=_(ft),Le=w(ft,2);{var Re=Je=>{var st=Yb(),nt=w(We(st),2),Ge=_(nt);se(gt=>te(Ge,gt),[()=>o(le).tags.join(", ")]),C(Je,st)};pe(Le,Je=>{var st;(st=o(le).tags)!=null&&st.length&&Je(Re)})}var qe=w(Ie,2);{var Oe=Je=>{var st=Xb(),nt=w(_(st),2),Ge=_(nt);se(()=>te(Ge,`ollama pull ${n()??""}`)),C(Je,st)},Qe=$(()=>!x(n())),ct=Je=>{var st=Zb();C(Je,st)};pe(qe,Je=>{o(Qe)?Je(Oe):Je(ct,!1)})}se(Je=>{te(be,o(le).description),te(Xe,`${Je??""}k context`),te(vt,`${o(le).params??""} params`)},[()=>(o(le).contextWindow/1024).toFixed(0)]),C(ge,re)};pe(ue,ge=>{o(le)&&ge(_e)})}C(U,Y)};pe(O,U=>{n()&&U(I)})}var Q=w(X,2),W=w(_(Q),2),Z=_(W),j=w(_(Z));Tt(j,21,()=>Xr,Ut,(U,le)=>{var Y=t0();let ue;var _e=_(Y),ge=_(_e),re=w(ge);{var Te=Je=>{var st=Jb();C(Je,st)};pe(re,Je=>{o(le).name===n()&&Je(Te)})}var be=w(re,2);{var Ie=Je=>{var st=$b();C(Je,st)},Ke=$(()=>x(o(le).name));pe(be,Je=>{o(Ke)&&Je(Ie)})}var Xe=w(_e),ft=_(Xe),vt=_(ft),Le=w(Xe),Re=_(Le),qe=w(Le),Oe=_(qe);{var Qe=Je=>{var st=e0();C(Je,st)};pe(Oe,Je=>{o(le).recommended&&Je(Qe)})}var ct=w(Oe);se((Je,st,nt)=>{ue=It(Y,1,"svelte-1bvvk8o",null,ue,Je),te(ge,`${o(le).displayName??""} `),te(vt,`${st??""}k`),te(Re,o(le).params),te(ct,` ${nt??""}`)},[()=>({selected:o(le).name===n(),installed:x(o(le).name)}),()=>(o(le).contextWindow/1024).toFixed(0),()=>o(le).tags.slice(0,2).join(", ")]),C(U,Y)});var ee=w(Q,2);{var ne=U=>{var le=n0(),Y=_(le);se(()=>te(Y,r())),C(U,le)};pe(ee,U=>{r()&&U(ne)})}var H=w(ee,2);H.__click=m,se(()=>{var U;te(S,a?"ð¥ local":"âï¸ remote"),bt(L,"placeholder",a?"http://localhost:11434":"https://me-ai.metaelon.space"),N.disabled=o(i),te(J,o(i)?"Testing...":"Test"),H.disabled=!((U=o(l))!=null&&U.connected)||r()}),va(L,()=>o(s),U=>M(s,U)),po(T,n),C(t,A),tt()}Jt(["change","click"]);var s0=F('<span class="progress-percent svelte-r5fnze"> </span>'),i0=F('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),o0=F('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),l0=F('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),c0=F('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),u0=F('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),d0=F('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function f0(t,e){et(e,!0);let n=Ae(e,"message",3,""),r=Ae(e,"items",19,()=>[]);En(()=>ur("LoadingProgress"));var a=d0(),s=_(a),i=_(s),l=w(s,2);Tt(l,17,r,Ut,(u,f)=>{const v=$(()=>o(f).total?L_(o(f).loaded||0,o(f).total):null);var p=u0(),h=_(p),m=_(h),x=_(m),k=w(m,2);{var A=S=>{var z=s0(),L=_(z);se(N=>te(L,`${N??""}%`),[()=>o(v).toFixed(1)]),C(S,z)};pe(k,S=>{o(v)!==null&&S(A)})}var D=w(h,2);{var q=S=>{var z=i0(),L=We(z),N=_(L),J=w(L,2),ae=_(J),ke=_(ae),X=w(ae,4),T=_(X),K=w(X,2),P=_(K);se((O,I,Q,W,Z)=>{Lt(N,`width: ${O??""}%`),te(ke,I),te(T,Q),te(P,`(${W??""} / ${Z??""} B)`)},[()=>Math.max(o(f).progress??0,.5).toFixed(1),()=>jc(o(f).loaded||0),()=>jc(o(f).total),()=>(o(f).loaded||0).toLocaleString(),()=>o(f).total.toLocaleString()]),C(S,z)},G=S=>{var z=c0(),L=w(We(z),2),N=_(L);{var J=ke=>{var X=o0(),T=We(X),K=_(T),P=w(T,2),O=_(P);se((I,Q)=>{te(K,I),te(O,`(${Q??""} B)`)},[()=>jc(o(f).loaded),()=>o(f).loaded.toLocaleString()]),C(ke,X)},ae=ke=>{var X=l0();C(ke,X)};pe(N,ke=>{o(f).loaded?ke(J):ke(ae,!1)})}C(S,z)};pe(D,S=>{o(f).total?S(q):S(G,!1)})}se(()=>{bt(m,"title",o(f).file),te(x,o(f).file)}),C(u,p)}),se(()=>te(i,n())),C(t,a),tt()}var v0=F('<span class="thinking-tokens svelte-11gjw00"> </span>'),h0=F('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),p0=F('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),g0=F('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),m0=F('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),y0=F('<span class="cursor svelte-11gjw00">|</span>'),_0=F(" <!>",1),b0=F('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),w0=F('<div class="content svelte-11gjw00"> </div>'),x0=F('<div><div class="role svelte-11gjw00"> </div> <!></div>');function k0(t,e){et(e,!0);let n=Ae(e,"isLast",3,!1),r=Ae(e,"isRunning",3,!1),a=Ae(e,"generationPhase",3,null),s=Ae(e,"numTokens",3,null);En(()=>ur(`MessageBubble[${e.msg.role}]`));var i=x0(),l=_(i),u=_(l),f=w(l,2);{var v=h=>{var m=b0(),x=We(m);{var k=N=>{var J=h0(),ae=w(_(J),4);{var ke=X=>{var T=v0(),K=_(T);se(()=>te(K,`${s()??""} tokens`)),C(X,T)};pe(ae,X=>{s()&&X(ke)})}C(N,J)},A=N=>{var J=p0();C(N,J)};pe(x,N=>{r()&&n()&&a()==="thinking"?N(k):r()&&n()&&a()==="preparing"&&N(A,1)})}var D=w(x,2);{var q=N=>{var J=g0(),ae=_(J),ke=w(_(ae),2),X=_(ke),T=w(ae,2),K=_(T);se(P=>{te(X,`${P??""} words`),te(K,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),C(N,J)};pe(D,N=>{e.msg.thinking&&N(q)})}var G=w(D,2),S=_(G);{var z=N=>{var J=m0();C(N,J)},L=N=>{var J=_0(),ae=We(J,!0),ke=w(ae);{var X=T=>{var K=y0();C(T,K)};pe(ke,T=>{r()&&n()&&T(X)})}se(()=>te(ae,e.msg.content)),C(N,J)};pe(S,N=>{r()&&n()&&!e.msg.content&&a()!=="thinking"?N(z):N(L,!1)})}C(h,m)},p=h=>{var m=w0(),x=_(m);se(()=>te(x,e.msg.content)),C(h,m)};pe(f,h=>{e.msg.role==="assistant"?h(v):h(p,!1)})}se(()=>{It(i,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),te(u,e.msg.role==="user"?"You":"AI")}),C(t,i),tt()}var S0=F('<span class="cmd-icon svelte-1m7x4wq"> </span>'),E0=F('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),A0=F('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Uf(t,e){et(e,!0);var n=A0(),r=We(n);r.__click=()=>{var m;return(m=e.onexecute)==null?void 0:m.call(e,e.command.id)};var a=_(r);{var s=m=>{var x=S0(),k=_(x);se(()=>te(k,e.command.icon)),C(m,x)};pe(a,m=>{e.command.icon&&m(s)})}var i=w(a,2),l=_(i),u=_(l),f=w(l,2),v=_(f),p=w(r,2);{var h=m=>{var x=E0(),k=_(x),A=_(k);se(()=>te(A,e.command.body)),C(m,x)};pe(p,m=>{e.command.body&&m(h)})}se(()=>{te(u,e.command.name),te(v,e.command.description)}),C(t,n),tt()}Jt(["click"]);const Gf="https://accounts.google.com/gsi/client",T0="https://www.googleapis.com/auth/gmail.modify",_d="me-ai:oauth-token",bd=300*1e3;let Gi=null,qi=null,Ba=0;async function Rp(t,e){Ba=Date.now()+e*1e3;const{setSetting:n}=await tr(async()=>{const{setSetting:r}=await Promise.resolve().then(()=>wa);return{setSetting:r}},void 0,import.meta.url);await n(_d,{access_token:t,expires_at:Ba})}async function Su(){Ba=0;const{removeSetting:t}=await tr(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>wa);return{removeSetting:e}},void 0,import.meta.url);await t(_d)}async function Wl(){try{const{getSetting:t}=await tr(async()=>{const{getSetting:a}=await Promise.resolve().then(()=>wa);return{getSetting:a}},void 0,import.meta.url),e=await t(_d);if(!e)return null;const{access_token:n,expires_at:r}=e;return!n||Date.now()>r-bd?(await Su(),null):(Ba=r,{access_token:n})}catch{return await Su(),null}}function C0(){return Ba>0&&Date.now()<Ba-bd}function I0(){return Ba<=0?0:Math.max(0,Ba-bd-Date.now())}function Wf(){return new Promise((t,e)=>{if(!Gi){e(new Error("Google Auth not initialized."));return}qi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Rp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Gi.requestAccessToken({prompt:""})})}function P0(){return new Promise((t,e)=>{var a,s;if((s=(a=window.google)==null?void 0:a.accounts)!=null&&s.oauth2){t();return}const n=document.querySelector(`script[src="${Gf}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const r=document.createElement("script");r.src=Gf,r.async=!0,r.defer=!0,r.onload=()=>t(),r.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async function Yf(t){await P0(),Gi=google.accounts.oauth2.initTokenClient({client_id:t,scope:T0,callback:e=>{qi&&(qi(e),qi=null)}})}function M0(){return new Promise((t,e)=>{if(!Gi){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}qi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Rp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Gi.requestAccessToken()})}async function O0(t){return await Su(),new Promise(e=>{var n,r;(r=(n=window.google)==null?void 0:n.accounts)!=null&&r.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function Dp(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const r=await Ap(t.type);if(e==null||e({phase:"policy_check",group:r.group,policy:r}),r.requiresApproval&&!n){const f=await Jr(t.type);return{success:!1,requiresApproval:!0,group:r.group,actions:f,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const a=await Wl();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,i=await Jr(t.type);if(!i||i.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:i,actionCount:i.length});const l={accessToken:s,event:t,onProgress:e},u=await ui.executePipeline(i,l);return e==null||e({phase:"done",result:u}),u}catch(r){return e==null||e({phase:"error",error:r.message}),{success:!1,error:r,message:r.message||"Unknown error"}}}async function Lp(t,e,n,r=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=await Ap(t);if(a.requiresApproval&&!r){const p=await Jr(t);return{success:!1,requiresApproval:!0,group:a.group,actions:p,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await Wl();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const i=s.access_token,l=await Jr(t);if(!l||l.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:l,actionCount:l.length});const u=e.map(p=>({type:t,source:"gmail",data:p})),f={accessToken:i,onProgress:n},v=await ui.executePipelineBatch(l,u,f);return n==null||n({phase:"done",result:v}),v}catch(a){return n==null||n({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function zp(t){return ui.getAvailableActions(t)}async function Eu(){const t=await Wl();return!!(t!=null&&t.access_token)}const N0=Object.freeze(Object.defineProperty({__proto__:null,EVENT_GROUPS:Nr,executePipeline:Dp,executePipelineBatch:Lp,getAvailableActions:zp,isAuthenticated:Eu},Symbol.toStringTag,{value:"Module"}));var R0=F('<div class="event-subject svelte-1w66m1k"> </div>'),D0=F('<span class="sep svelte-1w66m1k">Â·</span> ',1),L0=F('<div class="event-summary svelte-1w66m1k"> </div>'),z0=F('<span class="tag svelte-1w66m1k"> </span>'),j0=F('<div class="event-tags svelte-1w66m1k"></div>'),B0=F('<div class="event-reason svelte-1w66m1k"> </div>'),q0=F('<div class="commands svelte-1w66m1k"></div>'),F0=F('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),K0=F('<span class="event-subject-inline svelte-1w66m1k"> </span>'),H0=F('<span class="sep svelte-1w66m1k">Â·</span> ',1),V0=F('<div class="event-summary svelte-1w66m1k"> </div>'),U0=F('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),G0=F('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),W0=F('<span class="group-tier-chip svelte-1w66m1k"> </span>'),Y0=F("<button><!></button>"),X0=F("<span> </span>"),Z0=F('<span class="approval-action-desc svelte-1w66m1k"> </span>'),Q0=F("<li><!> <strong> </strong> <!></li>"),J0=F('<ul class="approval-actions svelte-1w66m1k"></ul>'),$0=F(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),ew=F("<div> </div>"),tw=F('<span class="email-from svelte-1w66m1k"> </span>'),nw=F('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),rw=F('<div class="email-summary svelte-1w66m1k"> </div>'),aw=F('<span class="tag svelte-1w66m1k"> </span>'),sw=F('<div class="email-tags svelte-1w66m1k"></div>'),iw=F("<button><!></button>"),ow=F('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),lw=F('<span class="step-icon svelte-1w66m1k"> </span>'),cw=F('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),uw=F('<div class="pipeline-steps svelte-1w66m1k"></div>'),dw=F('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Actions page</div>'),fw=F("<div> </div>"),vw=F('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),hw=F('<div class="group-emails svelte-1w66m1k"></div>'),pw=F('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),gw=F('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function mw(t,e){et(e,!0);let n=Me(en({})),r=en({}),a=Me(en({}));function s(z){if(!z)return"â";const L=z.replace(/<.*>/,"").trim();return L.length>40?L.slice(0,38)+"â¦":L}function i(z){if(!z)return"";try{return new Date(z).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function l(z,L){var N;(N=e.oncommand)==null||N.call(e,{event:z,commandId:L})}async function u(z,L,N=!1){if(!await Eu()){alert("Please sign in to Gmail first (Dashboard page)");return}const J=`single_${L}`;r[J]={running:!0,progress:null,result:null};try{const ae=await Dp(z,ke=>{r[J]={...r[J],progress:ke}},N);if(ae.requiresApproval){r[J]={running:!1,progress:null,result:null},o(a)[J]={event:z,emailId:L,actions:ae.actions,group:ae.group,isBatch:!1};return}r[J]={running:!1,progress:null,result:ae}}catch(ae){r[J]={running:!1,progress:null,result:{success:!1,message:ae.message}}}}async function f(z,L,N=!1){if(!await Eu()){alert("Please sign in to Gmail first (Dashboard page)");return}const J=`batch_${z}`;r[J]={running:!0,progress:null,result:null};try{const ae=await Lp(z,L,ke=>{r[J]={...r[J],progress:ke}},N);if(ae.requiresApproval){r[J]={running:!1,progress:null,result:null},o(a)[J]={eventType:z,emails:L,actions:ae.actions,group:ae.group,isBatch:!0};return}r[J]={running:!1,progress:null,result:ae}}catch(ae){r[J]={running:!1,progress:null,result:{success:!1,message:ae.message}}}}async function v(z){const L=o(a)[z];L&&(delete o(a)[z],M(a,{...o(a)},!0),L.isBatch?await f(L.eventType,L.emails,!0):await u(L.event,L.emailId,!0))}function p(z){delete o(a)[z],M(a,{...o(a)},!0)}function h(z){M(n,{...o(n),[z]:!o(n)[z]},!0)}function m(z){return z.split("_").map(L=>L.charAt(0)+L.slice(1).toLowerCase()).join(" ")}function x(z){return`hsl(${Hl(z)}, 55%, 55%)`}function k(z){return r[z]}var A=ln(),D=We(A);{var q=z=>{var L=F0(),N=_(L),J=_(N),ae=_(J),ke=_(ae),X=w(ae,2),T=_(X),K=w(J,2);{var P=_e=>{var ge=R0(),re=_(ge);se(()=>te(re,e.msg.event.data.subject)),C(_e,ge)};pe(K,_e=>{var ge;(ge=e.msg.event.data)!=null&&ge.subject&&_e(P)})}var O=w(K,2),I=_(O);{var Q=_e=>{var ge=mn();se(re=>te(ge,re),[()=>s(e.msg.event.data.from)]),C(_e,ge)};pe(I,_e=>{var ge;(ge=e.msg.event.data)!=null&&ge.from&&_e(Q)})}var W=w(I,2);{var Z=_e=>{var ge=D0(),re=w(We(ge),1,!0);se(Te=>te(re,Te),[()=>i(e.msg.event.data.date)]),C(_e,ge)};pe(W,_e=>{var ge;(ge=e.msg.event.data)!=null&&ge.date&&_e(Z)})}var j=w(O,2);{var ee=_e=>{var ge=L0(),re=_(ge);se(()=>te(re,e.msg.event.metadata.summary)),C(_e,ge)};pe(j,_e=>{var ge;(ge=e.msg.event.metadata)!=null&&ge.summary&&_e(ee)})}var ne=w(j,2);{var H=_e=>{var ge=j0();Tt(ge,21,()=>e.msg.event.metadata.tags,Ut,(re,Te)=>{var be=z0(),Ie=_(be);se(()=>te(Ie,o(Te))),C(re,be)}),C(_e,ge)};pe(ne,_e=>{var ge,re;(re=(ge=e.msg.event.metadata)==null?void 0:ge.tags)!=null&&re.length&&_e(H)})}var U=w(ne,2);{var le=_e=>{var ge=B0(),re=_(ge);se(()=>te(re,e.msg.event.metadata.reason)),C(_e,ge)};pe(U,_e=>{var ge;(ge=e.msg.event.metadata)!=null&&ge.reason&&_e(le)})}var Y=w(N,2);{var ue=_e=>{var ge=q0();Tt(ge,21,()=>e.msg.commands,Ut,(re,Te)=>{Uf(re,{get command(){return o(Te)},onexecute:be=>l(e.msg.event,be)})}),C(_e,ge)};pe(Y,_e=>{var ge;(ge=e.msg.commands)!=null&&ge.length&&_e(ue)})}se(()=>{te(ke,e.msg.event.type),te(T,e.msg.event.source)}),C(z,L)},G=z=>{var L=G0(),N=_(L),J=_(N),ae=_(J),ke=w(N,2);Tt(ke,17,()=>e.msg.items,Ut,(X,T)=>{var K=U0(),P=_(K),O=_(P),I=_(O),Q=_(I),W=w(I,2);{var Z=_e=>{var ge=K0(),re=_(ge);se(()=>te(re,o(T).event.data.subject)),C(_e,ge)};pe(W,_e=>{var ge;(ge=o(T).event.data)!=null&&ge.subject&&_e(Z)})}var j=w(O,2),ee=_(j);{var ne=_e=>{var ge=mn();se(re=>te(ge,re),[()=>s(o(T).event.data.from)]),C(_e,ge)};pe(ee,_e=>{var ge;(ge=o(T).event.data)!=null&&ge.from&&_e(ne)})}var H=w(ee,2);{var U=_e=>{var ge=H0(),re=w(We(ge),1,!0);se(Te=>te(re,Te),[()=>i(o(T).event.data.date)]),C(_e,ge)};pe(H,_e=>{var ge;(ge=o(T).event.data)!=null&&ge.date&&_e(U)})}var le=w(j,2);{var Y=_e=>{var ge=V0(),re=_(ge);se(()=>te(re,o(T).event.metadata.summary)),C(_e,ge)};pe(le,_e=>{var ge;(ge=o(T).event.metadata)!=null&&ge.summary&&_e(Y)})}var ue=w(P,2);Tt(ue,21,()=>o(T).commands,Ut,(_e,ge)=>{Uf(_e,{get command(){return o(ge)},onexecute:re=>l(o(T).event,re)})}),se(()=>te(Q,o(T).event.type)),C(X,K)}),se(()=>te(ae,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),C(z,L)},S=z=>{var L=gw(),N=_(L),J=w(_(N),2),ae=_(J),ke=w(N,2);Tt(ke,17,()=>e.msg.groups,Ut,(X,T)=>{const K=$(()=>o(n)[o(T).eventType]??!0),P=$(()=>`batch_${o(T).eventType}`),O=$(()=>k(o(P))),I=$(()=>o(a)[o(P)]),Q=$(()=>o(T).group?Nr[o(T).group]:null);var W=pw(),Z=_(W),j=_(Z);j.__click=()=>h(o(T).eventType);var ee=_(j);let ne;var H=_(ee),U=w(ee,2);{var le=Le=>{var Re=W0();let qe;var Oe=_(Re);se(()=>{bt(Re,"title",o(Q).description),qe=Lt(Re,"",qe,{color:o(Q).color}),te(Oe,o(Q).label)}),C(Le,Re)};pe(U,Le=>{o(Q)&&Le(le)})}var Y=w(U,2),ue=_(Y),_e=w(Y,4);let ge;var re=w(j,2);{var Te=Le=>{var Re=Y0();let qe;Re.__click=nt=>{nt.stopPropagation(),f(o(T).eventType,o(T).emails)};var Oe=_(Re);{var Qe=nt=>{var Ge=mn("â³ Running...");C(nt,Ge)},ct=nt=>{var Ge=mn();se(()=>te(Ge,o(O).result.success?`â Done (${o(O).result.successful}/${o(O).result.total})`:"â Failed")),C(nt,Ge)},Je=nt=>{var Ge=mn();se(()=>te(Ge,`ð Review & Execute (${o(T).emails.length??""})`)),C(nt,Ge)},st=nt=>{var Ge=mn();se(()=>te(Ge,`â¶ Execute All (${o(T).emails.length??""})`)),C(nt,Ge)};pe(Oe,nt=>{var Ge,gt,ut;(Ge=o(O))!=null&&Ge.running?nt(Qe):(gt=o(O))!=null&&gt.result?nt(ct,1):(ut=o(Q))!=null&&ut.requiresApproval?nt(Je,2):nt(st,!1)})}se(()=>{var nt,Ge;qe=It(Re,1,"execute-all-btn svelte-1w66m1k",null,qe,{critical:(nt=o(Q))==null?void 0:nt.requiresApproval}),Re.disabled=(Ge=o(O))==null?void 0:Ge.running}),C(Le,Re)};pe(re,Le=>{o(I)||Le(Te)})}var be=w(Z,2);{var Ie=Le=>{var Re=$0(),qe=w(_(Re),2),Oe=w(_(qe)),Qe=_(Oe),ct=w(qe,2);{var Je=gt=>{var ut=J0();Tt(ut,21,()=>o(I).actions,Ut,(Nt,qt)=>{var wt=Q0(),mt=_(wt);{var yt=zt=>{var Ne=X0(),Gt=_(Ne);se(()=>te(Gt,o(qt).icon)),C(zt,Ne)};pe(mt,zt=>{o(qt).icon&&zt(yt)})}var ot=w(mt,2),ze=_(ot),Mt=w(ot,2);{var Rt=zt=>{var Ne=Z0(),Gt=_(Ne);se(()=>te(Gt,`â ${o(qt).description??""}`)),C(zt,Ne)};pe(Mt,zt=>{o(qt).description&&zt(Rt)})}se(()=>te(ze,o(qt).name)),C(Nt,wt)}),C(gt,ut)};pe(ct,gt=>{var ut;(ut=o(I).actions)!=null&&ut.length&&gt(Je)})}var st=w(ct,2),nt=_(st);nt.__click=()=>v(o(P));var Ge=w(nt,2);Ge.__click=()=>p(o(P)),se(()=>te(Qe,`${o(T).emails.length??""} email${o(T).emails.length===1?"":"s"}`)),C(Le,Re)};pe(be,Le=>{o(I)&&Le(Ie)})}var Ke=w(be,2);{var Xe=Le=>{var Re=ew();let qe;var Oe=_(Re);se(()=>{qe=It(Re,1,"batch-result svelte-1w66m1k",null,qe,{success:o(O).result.success,error:!o(O).result.success}),te(Oe,o(O).result.message)}),C(Le,Re)};pe(Ke,Le=>{var Re;(Re=o(O))!=null&&Re.result&&!o(I)&&Le(Xe)})}var ft=w(Ke,2);{var vt=Le=>{var Re=hw();Tt(Re,21,()=>o(T).emails,Ut,(qe,Oe)=>{const Qe=$(()=>`single_${o(Oe).emailId}`),ct=$(()=>k(o(Qe))),Je=$(()=>o(a)[o(Qe)]);var st=vw(),nt=_(st),Ge=_(nt),gt=_(Ge),ut=w(Ge,2),Nt=_(ut);{var qt=dt=>{var it=tw(),Ft=_(it);se(lt=>te(Ft,lt),[()=>s(o(Oe).from)]),C(dt,it)};pe(Nt,dt=>{o(Oe).from&&dt(qt)})}var wt=w(Nt,2);{var mt=dt=>{var it=nw(),Ft=w(We(it)),lt=_(Ft);se(kt=>te(lt,kt),[()=>i(o(Oe).date)]),C(dt,it)};pe(wt,dt=>{o(Oe).date&&dt(mt)})}var yt=w(ut,2);{var ot=dt=>{var it=rw(),Ft=_(it);se(()=>te(Ft,o(Oe).summary)),C(dt,it)};pe(yt,dt=>{o(Oe).summary&&dt(ot)})}var ze=w(yt,2);{var Mt=dt=>{var it=sw();Tt(it,21,()=>o(Oe).tags,Ut,(Ft,lt)=>{var kt=aw(),tn=_(kt);se(()=>te(tn,o(lt))),C(Ft,kt)}),C(dt,it)};pe(ze,dt=>{var it;(it=o(Oe).tags)!=null&&it.length&&dt(Mt)})}var Rt=w(nt,2),zt=_(Rt),Ne=w(_(zt),2);{var Gt=dt=>{var it=iw();let Ft;it.__click=()=>u({type:o(T).eventType,source:"gmail",data:o(Oe)},o(Oe).emailId);var lt=_(it);{var kt=Yt=>{var $t=mn("â³ Running...");C(Yt,$t)},tn=Yt=>{var $t=mn();se(()=>te($t,o(ct).result.success?"â Done":"â Failed")),C(Yt,$t)},rn=Yt=>{var $t=mn("ð Review");C(Yt,$t)},Rn=Yt=>{var $t=mn("â¶ Execute");C(Yt,$t)};pe(lt,Yt=>{var $t,_n,vn;($t=o(ct))!=null&&$t.running?Yt(kt):(_n=o(ct))!=null&&_n.result?Yt(tn,1):(vn=o(Q))!=null&&vn.requiresApproval?Yt(rn,2):Yt(Rn,!1)})}se(()=>{var Yt,$t;Ft=It(it,1,"execute-btn svelte-1w66m1k",null,Ft,{critical:(Yt=o(Q))==null?void 0:Yt.requiresApproval}),it.disabled=($t=o(ct))==null?void 0:$t.running}),C(dt,it)};pe(Ne,dt=>{o(Je)||dt(Gt)})}var zn=w(zt,2);{var ye=dt=>{var it=ow(),Ft=w(_(it),4),lt=_(Ft);lt.__click=()=>v(o(Qe));var kt=w(lt,2);kt.__click=()=>p(o(Qe)),C(dt,it)};pe(zn,dt=>{o(Je)&&dt(ye)})}var cn=w(zn,2);{var An=dt=>{var it=uw();Tt(it,21,()=>o(T).commands,Ut,(Ft,lt,kt)=>{var tn=cw(),rn=_(tn);rn.textContent=kt+1;var Rn=w(rn,2),Yt=_(Rn);{var $t=xa=>{var Hn=lw(),Cs=_(Hn);se(()=>te(Cs,o(lt).icon)),C(xa,Hn)};pe(Yt,xa=>{o(lt).icon&&xa($t)})}var _n=w(Yt,2),vn=_(_n),nr=w(_n,2),na=_(nr);se(()=>{te(vn,o(lt).name),te(na,o(lt).description)}),C(Ft,tn)}),C(dt,it)},St=dt=>{var it=dw();C(dt,it)};pe(cn,dt=>{var it;(it=o(T).commands)!=null&&it.length?dt(An):dt(St,!1)})}var Nn=w(cn,2);{var Wt=dt=>{var it=fw();let Ft;var lt=_(it);se(()=>{Ft=It(it,1,"execution-result svelte-1w66m1k",null,Ft,{success:o(ct).result.success,error:!o(ct).result.success}),te(lt,o(ct).result.message)}),C(dt,it)};pe(Nn,dt=>{var it;(it=o(ct))!=null&&it.result&&dt(Wt)})}se(()=>te(gt,o(Oe).subject)),C(qe,st)}),C(Le,Re)};pe(ft,Le=>{o(K)&&Le(vt)})}se((Le,Re)=>{ne=Lt(ee,"",ne,Le),te(H,Re),te(ue,o(T).emails.length),ge=It(_e,0,"chevron svelte-1w66m1k",null,ge,{open:o(K)})},[()=>({background:x(o(T).eventType)}),()=>m(o(T).eventType)]),C(X,W)}),se(()=>te(ae,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),C(z,L)};pe(D,z=>{e.msg.type==="event"?z(q):e.msg.type==="event-batch"?z(G,1):e.msg.type==="events-grouped"&&z(S,2)})}C(t,A),tt()}Jt(["click"]);var yw=F('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),_w=F('<span class="edate svelte-mt5nvh"> </span>'),bw=F('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),ww=F('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),xw=F('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),kw=F('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Sw=F('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Ew(t,e){et(e,!0);let n=Ae(e,"pendingData",3,null),r=Me(null),a=Me(null);function s(m){M(r,o(r)===m?null:m,!0),M(a,null)}function i(m){return m.split("_").map(x=>x.charAt(0)+x.slice(1).toLowerCase()).join(" ")}function l(m){if(!m)return"";try{return new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function u(m){if(!m)return"";const x=m.replace(/<.*>/,"").trim();return x.length>24?x.slice(0,22)+"â¦":x}var f={toggleGroup:s},v=ln(),p=We(v);{var h=m=>{var x=Sw(),k=_(x),A=_(k),D=w(k,2);Tt(D,20,()=>n().order,S=>S,(S,z)=>{const L=$(()=>n().groups[z]),N=$(()=>ku(z)),J=$(()=>o(r)===z);var ae=yw();let ke;ae.__click=()=>s(z);let X;var T=_(ae);let K;var P=w(T),O=w(P),I=_(O);se(Q=>{ke=It(ae,1,"chip svelte-mt5nvh",null,ke,{active:o(J)}),X=Lt(ae,"",X,{"--c":o(N)}),K=Lt(T,"",K,{background:o(N)}),te(P,` ${Q??""} `),te(I,o(L).length)},[()=>i(z)]),C(S,ae)});var q=w(D,2);{var G=S=>{const z=$(()=>n().groups[o(r)]),L=$(()=>ku(o(r)));var N=kw(),J=_(N);let ae;var ke=_(J);ke.__click=()=>{M(r,null),M(a,null)};var X=w(ke,2),T=_(X),K=w(X,2),P=_(K),O=w(J,2);Tt(O,21,()=>o(z),j=>j.emailId,(j,ee)=>{var ne=bw(),H=_(ne);H.__click=()=>{var Ie;return(Ie=e.onaskai)==null?void 0:Ie.call(e,`Tell me about the email "${o(ee).subject}" from ${o(ee).from}`)};var U=_(H),le=_(U),Y=w(U,2),ue=_(Y),_e=w(ue);{var ge=Ie=>{var Ke=_w(),Xe=_(Ke);se(ft=>te(Xe,ft),[()=>l(o(ee).date)]),C(Ie,Ke)};pe(_e,Ie=>{o(ee).date&&Ie(ge)})}var re=w(H,2),Te=_(re);Te.__click=()=>{var Ie;return(Ie=e.onmarkacted)==null?void 0:Ie.call(e,o(ee).emailId)};var be=w(Te,2);be.__click=()=>{var Ie;return(Ie=e.ondismiss)==null?void 0:Ie.call(e,o(ee).emailId)},se(Ie=>{te(le,o(ee).subject),te(ue,Ie)},[()=>u(o(ee).from)]),C(j,ne)});var I=w(O,2),Q=_(I);{var W=j=>{var ee=ww(),ne=We(ee);ne.__click=()=>o(z).forEach(U=>{var le;return(le=e.onmarkacted)==null?void 0:le.call(e,U.emailId)});var H=w(ne,2);H.__click=()=>M(a,o(r),!0),C(j,ee)},Z=j=>{var ee=xw(),ne=We(ee),H=_(ne),U=w(ne,2);U.__click=()=>M(a,null);var le=w(U,2);le.__click=()=>{var Y;(Y=e.oncleargroup)==null||Y.call(e,o(r)),M(a,null),M(r,null)},se(()=>te(H,`Remove ${o(z).length??""}?`)),C(j,ee)};pe(Q,j=>{o(a)!==o(r)?j(W):j(Z,!1)})}se(j=>{ae=Lt(J,"",ae,{"border-color":o(L)}),te(T,j),te(P,o(z).length)},[()=>i(o(r))]),C(S,N)};pe(q,S=>{o(r)&&n().groups[o(r)]&&S(G)})}se(()=>te(A,`${n().total??""} item${n().total!==1?"s":""} need attention`)),C(m,x)};pe(p,m=>{n()&&n().total>0&&m(h)})}return C(t,v),tt(f)}Jt(["click"]);var Aw=F('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Tw=F('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Cw=F('<div class="strip svelte-1ed7zw1"><!></div>');function Iw(t,e){let n=Ae(e,"hasScanData",3,!1),r=Ae(e,"engineReady",3,!1),a=Ae(e,"isScanning",3,!1),s=$(()=>r()&&!n()&&!a()),i=$(()=>o(s)||a());var l=ln(),u=We(l);{var f=v=>{var p=Cw(),h=_(p);{var m=k=>{var A=Aw();C(k,A)},x=k=>{var A=Tw();A.__click=function(...D){var q;(q=e.onscan)==null||q.apply(this,D)},C(k,A)};pe(h,k=>{a()?k(m):o(s)&&k(x,1)})}C(v,p)};pe(u,v=>{o(i)&&v(f)})}C(t,l)}Jt(["click"]);var Pw=F('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Mw=F('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Ow=F('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Nw=F('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Rw=F('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),Dw=F('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),Lw=F('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function zw(t,e){et(e,!0),En(()=>ur("GpuPanel"));var n=Lw(),r=_(n),a=w(_(r),2),s=w(_(a),2),i=_(s),l=w(a,2),u=w(_(l),2),f=_(u),v=w(l,2);{var p=S=>{var z=Pw(),L=w(_(z),2),N=_(L);se(()=>te(N,e.gpuInfo.device)),C(S,z)};pe(v,S=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&S(p)})}var h=w(v,2);{var m=S=>{var z=Mw(),L=w(_(z),2),N=_(L);se(J=>te(N,J),[()=>wu(e.gpuInfo.limits.maxBufferSize)]),C(S,z)};pe(h,S=>{var z;(z=e.gpuInfo.limits)!=null&&z.maxBufferSize&&S(m)})}var x=w(h,2);{var k=S=>{var z=Ow(),L=w(_(z),2),N=_(L);se(()=>te(N,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),C(S,z)};pe(x,S=>{var z;(z=e.gpuInfo.limits)!=null&&z.maxComputeInvocationsPerWorkgroup&&S(k)})}var A=w(x,2);{var D=S=>{var z=Nw(),L=w(_(z),2),N=_(L);se(J=>te(N,J),[()=>wu(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),C(S,z)};pe(A,S=>{var z;(z=e.gpuInfo.limits)!=null&&z.maxComputeWorkgroupStorageSize&&S(D)})}var q=w(A,2);{var G=S=>{var z=Dw(),L=_(z),N=_(L),J=w(L,2);Tt(J,21,()=>e.gpuInfo.features,Ut,(ae,ke)=>{var X=Rw(),T=_(X);se(()=>te(T,o(ke))),C(ae,X)}),se(()=>te(N,`Features (${e.gpuInfo.features.length??""})`)),C(S,z)};pe(q,S=>{var z;(z=e.gpuInfo.features)!=null&&z.length&&S(G)})}se(()=>{te(i,e.gpuInfo.vendor),te(f,e.gpuInfo.architecture)}),C(t,n),tt()}var jw=F('<button class="gpu-badge svelte-1ktw27c"> </button>'),Bw=F('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),qw=F('<span class="stats svelte-1ktw27c"> </span>'),Fw=F('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Kw=F('<span class="stats preparing svelte-1ktw27c"> </span>'),Hw=F('<span class="stats svelte-1ktw27c"> </span>'),Vw=F('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Uw=F('<button class="btn svelte-1ktw27c">Stop</button>'),Gw=F('<button class="btn primary svelte-1ktw27c">Send</button>'),Ww=F('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Yw(t,e){et(e,!0),En(()=>ur("ChatView"));let n=Ae(e,"messages",19,()=>[]),r=Ae(e,"pendingData",3,null),a=Ae(e,"hasScanData",3,!1),s=Ae(e,"engineReady",3,!1),i=Ae(e,"isScanning",3,!1),l=Ae(e,"isRunning",3,!1),u=Ae(e,"tps",3,null),f=Ae(e,"numTokens",3,null),v=Ae(e,"generationPhase",3,null),p=Ae(e,"gpuInfo",3,null),h=Ae(e,"backend",3,"webgpu"),m=Ae(e,"chatContainer",15),x=Me(""),k=Me(!1);function A(Y){Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),D())}function D(){const Y=o(x).trim();!Y||l()||(M(x,""),e.onsend(Y))}function q(Y){Y&&!l()&&e.onsend(Y)}var G=Ww(),S=_(G),z=_(S);{var L=Y=>{var ue=jw();ue.__click=()=>M(k,!o(k));var _e=_(ue);se(()=>te(_e,`WebGPU ${o(k)?"â²":"â¼"}`)),C(Y,ue)},N=Y=>{var ue=Bw();C(Y,ue)};pe(z,Y=>{p()?Y(L):h()==="ollama"&&Y(N,1)})}var J=w(z,2);{var ae=Y=>{var ue=qw(),_e=_(ue);se((ge,re)=>te(_e,`${f()??""} tokens in ${ge??""}s
        (${re??""} tok/s)`),[()=>(f()/u()).toFixed(1),()=>u().toFixed(1)]),C(Y,ue)},ke=Y=>{var ue=Fw();C(Y,ue)},X=Y=>{var ue=Kw(),_e=_(ue);se(ge=>te(_e,`thinking... ${ge??""}`),[()=>u()?`${u().toFixed(0)} tok/s`:""]),C(Y,ue)},T=Y=>{var ue=Hw(),_e=_(ue);se(ge=>te(_e,`${ge??""} tok/s`),[()=>u().toFixed(1)]),C(Y,ue)};pe(J,Y=>{u()&&!l()?Y(ae):l()&&v()==="preparing"?Y(ke,1):l()&&v()==="thinking"?Y(X,2):u()&&l()&&Y(T,3)})}var K=w(J,4);K.__click=function(...Y){var ue;(ue=e.onreset)==null||ue.apply(this,Y)};var P=w(S,2);{var O=Y=>{zw(Y,{get gpuInfo(){return p()}})};pe(P,Y=>{o(k)&&p()&&Y(O)})}var I=w(P,2),Q=_(I);{var W=Y=>{var ue=Vw();C(Y,ue)};pe(Q,Y=>{n().length===0&&!(r()&&r().total>0)&&Y(W)})}var Z=w(Q,2);Tt(Z,17,n,Ut,(Y,ue,_e)=>{var ge=ln(),re=We(ge);{var Te=Ke=>{Ew(Ke,{get pendingData(){return o(ue).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:q})},be=Ke=>{mw(Ke,{get msg(){return o(ue)},get oncommand(){return e.oncommand}})},Ie=Ke=>{{let Xe=$(()=>_e===n().length-1);k0(Ke,{get msg(){return o(ue)},get isLast(){return o(Xe)},get isRunning(){return l()},get generationPhase(){return v()},get numTokens(){return f()}})}};pe(re,Ke=>{o(ue).type==="dashboard"?Ke(Te):o(ue).type==="event"||o(ue).type==="event-batch"||o(ue).type==="events-grouped"?Ke(be,1):Ke(Ie,!1)})}C(Y,ge)}),ks(I,Y=>m(Y),()=>m());var j=w(I,2);Iw(j,{get hasScanData(){return a()},get engineReady(){return s()},get isScanning(){return i()},get onscan(){return e.onscan}});var ee=w(j,2),ne=_(ee);ne.__keydown=A;var H=w(ne,2);{var U=Y=>{var ue=Uw();ue.__click=function(..._e){var ge;(ge=e.onstop)==null||ge.apply(this,_e)},C(Y,ue)},le=Y=>{var ue=Gw();ue.__click=D,se(_e=>ue.disabled=_e,[()=>!o(x).trim()]),C(Y,ue)};pe(H,Y=>{l()?Y(U):Y(le,!1)})}se(()=>{K.disabled=l(),ne.disabled=l()}),va(ne,()=>o(x),Y=>M(x,Y)),C(t,G),tt()}Jt(["click","keydown"]);var Xw=F('<div class="container center svelte-1bi93vx"><!> <!></div>');function Zw(t,e){et(e,!0);const n=!!navigator.gpu,r=vp();let a=Me("webgpu"),s=Me(en(Yr[0].id)),i=Me(null),l=Me(null),u=Me(""),f=Me(en([])),v=Me(en([])),p=Me(!1),h=Me(null),m=Me(null),x=Me(null),k=Me(null),A=Me(null),D=Me(null),q=Me(!1),G=Me(!1),S=!1;En(async()=>{const[H,U]=await Promise.all([Vi("aiBackend"),Vi("selectedModel")]);H&&M(a,H,!0),U&&M(s,U,!0),r.check(),r.isReady&&z();const le=r.onMessage(Y=>{switch(Y.status){case"webgpu-info":M(k,Y.data,!0);break;case"loading":M(i,"loading"),M(u,Y.data,!0);break;case"initiate":M(f,[...o(f),Y],!0);break;case"progress":M(f,o(f).map(ue=>ue.file===Y.file?{...ue,...Y}:ue),!0);break;case"done":M(f,o(f).filter(ue=>ue.file!==Y.file),!0);break;case"ready":M(i,"ready"),z();break;case"start":if(!o(p))break;M(A,Y.phase||"preparing",!0),M(v,[...o(v),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!o(p))break;M(A,Y.phase,!0);break;case"thinking":{if(!o(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=o(v)[o(v).length-1];M(v,[...o(v).slice(0,-1),{...ue,thinking:(ue.thinking||"")+Y.content}],!0),K();break}case"thinking-done":{if(!o(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=o(v)[o(v).length-1];M(v,[...o(v).slice(0,-1),{...ue,thinking:Y.content}],!0);break}case"update":{if(!o(p))break;M(h,Y.tps,!0),M(m,Y.numTokens,!0);const ue=o(v)[o(v).length-1];M(v,[...o(v).slice(0,-1),{...ue,content:ue.content+Y.output}],!0),K();break}case"complete":if(!o(p))break;Y.tps!==void 0&&M(h,Y.tps,!0),Y.numTokens!==void 0&&M(m,Y.numTokens,!0),M(p,!1),M(A,null),L();break;case"error":M(l,Y.data,!0),o(i)==="loading"&&M(i,null),o(p)&&(M(p,!1),M(A,null));break}});return()=>le()});async function z(){if(!(S||o(v).length>0))try{const H=await Ff();M(D,H,!0),H&&(S=!0,M(v,[{role:"assistant",type:"dashboard",pendingData:H}],!0),K());const U=await xu();M(q,U.classified>0)}catch{}}async function L(){try{const H=await Ff();M(D,H,!0);const U=o(v).findIndex(Y=>Y.type==="dashboard");U!==-1&&(H&&H.total>0?M(v,o(v).map((Y,ue)=>ue===U?{...Y,pendingData:H}:Y),!0):M(v,o(v).filter((Y,ue)=>ue!==U),!0));const le=await xu();M(q,le.classified>0)}catch{}}async function N(H){await gl(H,"acted"),await L()}async function J(H){await gl(H,"dismissed"),await L()}async function ae(H){await Op(H),await L()}async function ke(H){await yd(H),await L()}async function X(){if(o(G)||!r.isReady)return;M(G,!0);let H=null;try{if(await Pp(r,{count:20,onProgress:U=>{var le;U.phase==="done"&&((le=U.results)==null?void 0:le.length)>0&&(H=U.results)}}),await L(),(H==null?void 0:H.length)>0){const U=await fb(H);M(v,[...o(v),U],!0),K()}o(D)&&!o(v).some(U=>U.type==="dashboard")&&(M(v,[{role:"assistant",type:"dashboard",pendingData:o(D)},...o(v)],!0),K())}catch(U){console.error("Scan failed:",U)}finally{M(G,!1)}}function T({event:H,commandId:U}){var le,Y;`${U}${H.type}${((le=H.data)==null?void 0:le.subject)||"unknown"}`,M(v,[...o(v),{role:"assistant",content:`Command: ${U}

This command is not yet implemented. In the future, "${U}" will be executed on the ${H.source} event "${((Y=H.data)==null?void 0:Y.subject)||""}".`}],!0),K()}function K(){$h().then(()=>{o(x)&&(o(x).scrollTop=o(x).scrollHeight)})}async function P(){M(i,"loading"),await Ui("selectedModel",o(s)),await Ui("aiBackend",o(a)),o(a)==="ollama"&&M(k,null),r.loadModel(o(s))}On(()=>{o(a)==="webgpu"&&!Yr.find(H=>H.id===o(s))?M(s,Yr[0].id,!0):o(a)==="ollama"&&!Xr.find(H=>H.name===o(s))&&M(s,Xr[0].name,!0)});async function O(H){if(!H||o(p))return;if(H.trim().toLowerCase()==="/events"){M(v,[...o(v),{role:"user",content:H}],!0);try{const Y=await Mp();if(!Y.order.length)M(v,[...o(v),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const ue=await vb(Y);M(v,[...o(v),ue],!0)}}catch(Y){M(v,[...o(v),{role:"assistant",content:`Failed to load events: ${Y.message}`}],!0)}K();return}M(v,[...o(v),{role:"user",content:H}],!0),M(h,null),M(p,!0);let U=[];try{const ue=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(H)?await J_(H):await Q_();ue&&(U=[{role:"system",content:ue}])}catch{}const le=o(v).filter(Y=>Y.type!=="dashboard"&&Y.type!=="events-grouped"&&Y.type!=="event-batch"&&Y.type!=="event").map(Y=>({role:Y.role,content:Y.content}));r.generate([...U,...le]),K()}function I(){r.interrupt()}function Q(){r.reset(),M(v,[],!0),M(h,null),M(m,null),S=!1,z()}var W=ln(),Z=We(W);{var j=H=>{var U=Xw(),le=_(U);Cb(le,{get isWebGPUAvailable(){return n},get backend(){return o(a)},set backend(ge){M(a,ge,!0)}});var Y=w(le,2);{var ue=ge=>{Fb(ge,{get gpuInfo(){return o(k)},get error(){return o(l)},onload:P,get selectedModel(){return o(s)},set selectedModel(re){M(s,re,!0)}})},_e=ge=>{a0(ge,{onload:P,get selectedModel(){return o(s)},set selectedModel(re){M(s,re,!0)},get error(){return o(l)},set error(re){M(l,re,!0)}})};pe(Y,ge=>{o(a)==="webgpu"?ge(ue):o(a)==="ollama"&&ge(_e,1)})}C(H,U)},ee=H=>{f0(H,{get message(){return o(u)},get items(){return o(f)}})},ne=H=>{Yw(H,{get messages(){return o(v)},get pendingData(){return o(D)},get hasScanData(){return o(q)},get engineReady(){return r.isReady},get isScanning(){return o(G)},get isRunning(){return o(p)},get tps(){return o(h)},get numTokens(){return o(m)},get generationPhase(){return o(A)},get gpuInfo(){return o(k)},get backend(){return o(a)},onsend:O,onstop:I,onreset:Q,onmarkacted:N,ondismiss:J,onremove:ae,oncleargroup:ke,onscan:X,oncommand:T,get chatContainer(){return o(x)},set chatContainer(U){M(x,U,!0)}})};pe(Z,H=>{o(i)===null?H(j):o(i)==="loading"?H(ee,1):H(ne,!1)})}C(t,W),tt()}const In="gmail",Xf=8,jp=50,Bp=100;async function Qw(t,{limit:e=jp,onProgress:n=()=>{},signal:r}={}){var i;const a=await at.syncState.get(In);if(a!=null&&a.historyId)try{return await n1(t,a,n,r)}catch(l){if(l instanceof hd&&(l.status===404||l.code==="notFound")||((i=l.message)==null?void 0:i.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await at.syncState.delete(In);else throw l}return await e1(t,e===0?1/0:e,n,r)}async function Jw(t,{limit:e=jp,onProgress:n=()=>{},signal:r}={}){const a=await at.syncState.get(In);return a!=null&&a.oldestPageToken?await t1(t,a,e===0?1/0:e,n,r):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function $w(){const t=await at.syncState.get(In);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function qp(){await at.transaction("rw",[at.items,at.syncState],async()=>{await at.items.where("sourceType").equals(In).delete(),await at.syncState.delete(In)})}async function e1(t,e,n,r){n({phase:"counting",message:"Getting mailbox info..."}),hs(r);const a=await hp(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(a.messagesTotal||e,e)});const s=[];let i,l=null;for(;s.length<e;){hs(r);const p=e-s.length,h=await pp(t,{maxResults:Math.min(Bp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),n({phase:"listing",message:`Listed ${s.length} messages...`,current:s.length,total:Math.min(a.messagesTotal||e,e)}),i=h.nextPageToken,!i||m.length===0)break}if(l=i||null,s.length===0)return await at.syncState.put({sourceType:In,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:u,errors:f}=await Fp(t,s,n,r),v=await at.items.where("sourceType").equals(In).count();return await at.syncState.put({sourceType:In,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:v,oldestPageToken:l}),n({phase:"done",message:`Synced ${u} messages`,current:u,total:u}),{added:u,deleted:0,errors:f}}async function t1(t,e,n,r,a){r({phase:"listing",message:"Loading more messages...",current:0}),hs(a);const s=[];let i=e.oldestPageToken,l=null;for(;s.length<n;){hs(a);const p=n-s.length,h=await pp(t,{maxResults:Math.min(Bp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),r({phase:"listing",message:`Listed ${s.length} more messages...`,current:s.length}),i=h.nextPageToken,!i||m.length===0)break}if(l=i||null,s.length===0)return await at.syncState.update(In,{oldestPageToken:null,lastSyncAt:Date.now()}),r({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:u,errors:f}=await Fp(t,s,r,a),v=await at.items.where("sourceType").equals(In).count();return await at.syncState.update(In,{totalItems:v,lastSyncAt:Date.now(),oldestPageToken:l}),r({phase:"done",message:l?`Downloaded ${u} more (more available)`:`Downloaded ${u} more (all synced)`,current:v,total:v}),{added:u,errors:f}}async function n1(t,e,n,r){n({phase:"syncing",message:"Checking for changes..."}),hs(r);let a=0,s=0,i=0,l,u=e.historyId;do{hs(r);const v=await q_(t,{startHistoryId:e.historyId,pageToken:l});if(u=v.historyId||u,l=v.nextPageToken,!!v.history){for(const p of v.history){if(p.messagesAdded){const h=p.messagesAdded.map(x=>x.message.id),m=[...new Set(h.filter(x=>x))];if(m.length>0){const x=await Promise.allSettled(m.map(A=>gp(t,A))),k=[];for(const A of x)A.status==="fulfilled"?k.push(Kp(A.value)):i++;k.length>0&&(await at.items.bulkPut(k),await Hp(k),a+=k.length)}}if(p.messagesDeleted){const h=p.messagesDeleted.map(m=>ud(In,m.message.id)).filter(m=>m);h.length>0&&(await at.items.bulkDelete(h),s+=h.length)}}n({phase:"syncing",message:`Changes: +${a} -${s}`,current:a+s})}}while(l);const f=await at.items.where("sourceType").equals(In).count();return await at.syncState.put({sourceType:In,historyId:u,lastSyncAt:Date.now(),totalItems:f,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:a===0&&s===0?"Already up to date":`Synced: +${a} -${s}`,current:f,total:f}),{added:a,deleted:s,errors:i}}async function Fp(t,e,n,r){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let a=0,s=0;for(let i=0;i<e.length;i+=Xf){hs(r);const l=e.slice(i,i+Xf),u=await Promise.allSettled(l.map(v=>gp(t,v))),f=[];for(const v of u)v.status==="fulfilled"?f.push(Kp(v.value)):s++;f.length>0&&(await at.items.bulkPut(f),await Hp(f)),a+=f.length,n({phase:"downloading",message:`Downloaded ${a} of ${e.length} messages`,current:a,total:e.length})}return{added:a,errors:s}}function Kp(t){const e=Ta(t,"From"),n=Ta(t,"To"),r=Ta(t,"Cc"),a=Ta(t,"Subject")||"(no subject)",s=Ta(t,"Date"),i=Ta(t,"Message-ID"),l=Ta(t,"In-Reply-To"),u=Ta(t,"References");let f;try{f=s?new Date(s).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{f=Date.now()}return{id:ud(In,t.id),sourceType:In,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:r,subject:a,snippet:t.snippet||"",body:F_(t),htmlBody:K_(t),date:f,labels:t.labelIds||[],messageId:i,inReplyTo:l,references:u,raw:t,syncedAt:Date.now()}}async function Hp(t){const e=new Map;for(const n of t)for(const r of[n.from,n.to,n.cc]){if(!r)continue;const a=r.split(",").map(s=>s.trim()).filter(Boolean);for(const s of a){const i=r1(s);i&&!e.has(i.email)&&e.set(i.email,{...i,date:n.date})}}for(const[n,{name:r,date:a}]of e)try{const s=await at.contacts.where("email").equals(n).first();if(s){const i={};r&&!s.name&&(i.name=r),a>(s.lastSeen||0)&&(i.lastSeen=a),Object.keys(i).length>0&&await at.contacts.update(s.id,i)}else await at.contacts.add({email:n,name:r||"",firstSeen:a,lastSeen:a})}catch(s){(s==null?void 0:s.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(s==null?void 0:s.message)||s)}}function r1(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const r=e[1].toLowerCase().trim(),a=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:r,name:a}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function hs(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var a1=F(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),s1=F(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),i1=F(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function o1(t,e){et(e,!0);let n=Ae(e,"clientIdInput",15),r=Ae(e,"defaultClientId",3,"");En(()=>ur("SetupGuide"));let a=Me(null);async function s(x){try{await navigator.clipboard.writeText(x),M(a,x,!0),setTimeout(()=>{M(a,null)},1500)}catch{const k=document.createElement("input");k.value=x,document.body.appendChild(k),k.select(),document.execCommand("copy"),document.body.removeChild(k),M(a,x,!0),setTimeout(()=>{M(a,null)},1500)}}const i="http://localhost:5173",l="https://cypherkitty.github.io",u="https://cypherkitty.github.io/me-ai/";var f=i1(),v=_(f),p=w(_(v),4);{var h=x=>{var k=a1(),A=We(k),D=w(_(A),2);D.__click=()=>{n(r()),e.onsave()};var q=w(A,2),G=w(_(q),2),S=_(G),z=w(_(S),6),L=w(_(z),2),N=w(_(L),2),J=w(_(N),2),ae=_(J);ae.__click=()=>s(i);var ke=_(ae);ke.textContent="http://localhost:5173";var X=w(ke,2),T=_(X),K=w(ae,2);K.__click=()=>s(l);var P=_(K);P.textContent="https://cypherkitty.github.io";var O=w(P,2),I=_(O),Q=w(N,2),W=w(_(Q),2),Z=_(W);Z.__click=()=>s(i);var j=_(Z);j.textContent="http://localhost:5173";var ee=w(j,2),ne=_(ee),H=w(Z,2);H.__click=()=>s(l);var U=_(H);U.textContent="https://cypherkitty.github.io";var le=w(U,2),Y=_(le),ue=w(H,2);ue.__click=()=>s(u);var _e=_(ue);_e.textContent="https://cypherkitty.github.io/me-ai/";var ge=w(_e,2),re=_(ge),Te=w(S,2),be=_(Te);be.__keydown=Ke=>Ke.key==="Enter"&&e.onsave();var Ie=w(be,2);Ie.__click=function(...Ke){var Xe;(Xe=e.onsave)==null||Xe.apply(this,Ke)},se(Ke=>{te(T,o(a)===i?"â":"â§"),te(I,o(a)===l?"â":"â§"),te(ne,o(a)===i?"â":"â§"),te(Y,o(a)===l?"â":"â§"),te(re,o(a)===u?"â":"â§"),Ie.disabled=Ke},[()=>!n().trim()]),va(be,n),C(x,k)},m=x=>{var k=s1(),A=We(k),D=w(_(A),6),q=w(_(D),2),G=w(_(q),2),S=w(_(G),2),z=_(S);z.__click=()=>s(i);var L=_(z);L.textContent="http://localhost:5173";var N=w(L,2),J=_(N),ae=w(z,2);ae.__click=()=>s(l);var ke=_(ae);ke.textContent="https://cypherkitty.github.io";var X=w(ke,2),T=_(X),K=w(G,2),P=w(_(K),2),O=_(P);O.__click=()=>s(i);var I=_(O);I.textContent="http://localhost:5173";var Q=w(I,2),W=_(Q),Z=w(O,2);Z.__click=()=>s(l);var j=_(Z);j.textContent="https://cypherkitty.github.io";var ee=w(j,2),ne=_(ee),H=w(Z,2);H.__click=()=>s(u);var U=_(H);U.textContent="https://cypherkitty.github.io/me-ai/";var le=w(U,2),Y=_(le),ue=w(A,2),_e=_(ue);_e.__keydown=re=>re.key==="Enter"&&e.onsave();var ge=w(_e,2);ge.__click=function(...re){var Te;(Te=e.onsave)==null||Te.apply(this,re)},se(re=>{te(J,o(a)===i?"â":"â§"),te(T,o(a)===l?"â":"â§"),te(W,o(a)===i?"â":"â§"),te(ne,o(a)===l?"â":"â§"),te(Y,o(a)===u?"â":"â§"),ge.disabled=re},[()=>!n().trim()]),va(_e,n),C(x,k)};pe(p,x=>{r()?x(h):x(m,!1)})}C(t,f),tt()}Jt(["click","keydown"]);function l1(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),r=e instanceof hd?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const a=n.match(/project\s+(\d+)/),s=a==null?void 0:a[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:s?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${s}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return r===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:r===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:r===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var c1=F('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),u1=F('<div class="error-card-title svelte-14buhqq"> </div>'),d1=F('<p class="error-card-fix svelte-14buhqq"> </p>'),f1=F('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),v1=F('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),h1=F('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function Vp(t,e){et(e,!0);let n=Ae(e,"ondismiss",3,null),r=Ae(e,"onsignout",3,null),a=$(()=>l1(e.error));En(()=>ur("ErrorCard"));var s=h1(),i=_(s);{var l=D=>{var q=c1(),G=_(q),S=_(G),z=w(G,2);z.__click=function(...L){var N;(N=n())==null||N.apply(this,L)},se(()=>te(S,o(a).title)),C(D,q)},u=D=>{var q=u1(),G=_(q);se(()=>te(G,o(a).title)),C(D,q)};pe(i,D=>{n()?D(l):D(u,!1)})}var f=w(i,2),v=_(f),p=w(f,2);{var h=D=>{var q=d1(),G=_(q);se(()=>te(G,o(a).fix)),C(D,q)};pe(p,D=>{o(a).fix&&D(h)})}var m=w(p,2);{var x=D=>{var q=f1(),G=_(q);se(()=>{bt(q,"href",o(a).link.url),te(G,`${o(a).link.label??""} â`)}),C(D,q)};pe(m,D=>{o(a).link&&D(x)})}var k=w(m,2);{var A=D=>{var q=v1();q.__click=function(...G){var S;(S=r())==null||S.apply(this,G)},C(D,q)};pe(k,D=>{o(a).action==="signout"&&r()&&D(A)})}se(()=>te(v,o(a).description)),C(t,s),tt()}Jt(["click"]);var p1=F('<span class="spinner svelte-nyqevv"></span> Signing in...',1),g1=yn('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),m1=F('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),y1=F('<span class="client-id-value svelte-nyqevv"> </span>'),_1=F(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function b1(t,e){et(e,!0);let n=Ae(e,"isDefaultClientId",3,!1),r=Ae(e,"error",3,null),a=Ae(e,"loadingAuth",3,!1);En(()=>ur("AuthCard"));var s=_1(),i=_(s),l=w(_(i),4);{var u=q=>{Vp(q,{get error(){return r()},get onsignout(){return e.onsignout}})};pe(l,q=>{r()&&q(u)})}var f=w(l,2);f.__click=function(...q){var G;(G=e.onsignin)==null||G.apply(this,q)};var v=_(f);{var p=q=>{var G=p1();C(q,G)},h=q=>{var G=g1();C(q,G)};pe(v,q=>{a()?q(p):q(h,!1)})}var m=w(f,4),x=w(_(m),2);{var k=q=>{var G=m1();C(q,G)},A=q=>{var G=y1(),S=_(G);se(z=>te(S,`${z??""}...`),[()=>e.clientId.slice(0,20)]),C(q,G)};pe(x,q=>{n()?q(k):q(A,!1)})}var D=w(x,2);D.__click=function(...q){var G;(G=e.onclear)==null||G.apply(this,q)},se(()=>f.disabled=a()),C(t,s),tt()}Jt(["click"]);var w1=F('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),x1=F('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),k1=F('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function S1(t,e){et(e,!0);let n=Ae(e,"profile",3,null),r=Ae(e,"loadingProfile",3,!1);En(()=>ur("ProfileCard"));var a=k1(),s=_(a),i=_(s),l=w(s,2),u=_(l);{var f=h=>{var m=w1();C(h,m)},v=h=>{var m=x1(),x=We(m),k=_(x),A=w(x,2),D=_(A);se((q,G)=>{te(k,n().emailAddress),te(D,`${q??""} messages
        Â· ${G??""} threads`)},[()=>{var q;return((q=n().messagesTotal)==null?void 0:q.toLocaleString())||"?"},()=>{var q;return((q=n().threadsTotal)==null?void 0:q.toLocaleString())||"?"}]),C(h,m)};pe(u,h=>{r()?h(f):n()&&h(v,1)})}var p=w(l,2);p.__click=function(...h){var m;(m=e.onsignout)==null||m.apply(this,h)},se(h=>te(i,h),[()=>n()?yp(n().emailAddress):"?"]),C(t,a),tt()}Jt(["click"]);var E1=F('<span class="spinner svelte-1ds3j4k"></span>'),A1=yn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),T1=F('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),C1=F('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),I1=F('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),P1=F('<option class="svelte-1ds3j4k"> </option>'),M1=F('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),O1=F('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),N1=F('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),R1=F('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),D1=F('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),L1=F('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function z1(t,e){et(e,!0),En(()=>ur("SyncStatus"));let n=Ae(e,"syncStatus",3,null),r=Ae(e,"syncProgress",3,null),a=Ae(e,"isSyncing",3,!1),s=Me(!1),i=Me(50);const l=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function u(W){if(!W)return"never";const Z=Math.floor((Date.now()-W)/1e3);if(Z<60)return"just now";const j=Math.floor(Z/60);if(j<60)return`${j}m ago`;const ee=Math.floor(j/60);return ee<24?`${ee}h ago`:`${Math.floor(ee/24)}d ago`}function f(){var W,Z;return!((W=r())!=null&&W.total)||!((Z=r())!=null&&Z.current)?0:Math.round(r().current/r().total*100)}var v=L1(),p=_(v),h=_(p),m=_(h);{var x=W=>{var Z=E1();C(W,Z)},k=W=>{var Z=A1();C(W,Z)};pe(m,W=>{a()?W(x):W(k,!1)})}var A=w(h,2),D=w(_(A),2);{var q=W=>{var Z=T1(),j=_(Z),ee=w(j);{var ne=U=>{var le=mn("Â· more available");C(U,le)},H=U=>{var le=mn("Â· all synced");C(U,le)};pe(ee,U=>{n().hasMore?U(ne):U(H,!1)})}se((U,le)=>te(j,`${U??""} emails stored
          Â· synced ${le??""} `),[()=>n().totalItems.toLocaleString(),()=>u(n().lastSyncAt)]),C(W,Z)},G=W=>{var Z=C1();C(W,Z)};pe(D,W=>{var Z;(Z=n())!=null&&Z.synced?W(q):W(G,!1)})}var S=w(A,2),z=_(S);{var L=W=>{var Z=I1();Z.__click=()=>M(s,!o(s)),C(W,Z)};pe(z,W=>{var Z;(Z=n())!=null&&Z.synced&&!a()&&W(L)})}var N=w(p,2),J=_(N),ae=w(_(J),2);Tt(ae,21,()=>l,Ut,(W,Z)=>{var j=P1(),ee=_(j),ne={};se(()=>{te(ee,o(Z).label),ne!==(ne=o(Z).value)&&(j.value=(j.__value=o(Z).value)??"")}),C(W,j)});var ke=w(J,2),X=_(ke);{var T=W=>{var Z=O1(),j=We(Z);j.__click=()=>e.onsync(o(i));var ee=_(j),ne=w(j,2);{var H=U=>{var le=M1();le.__click=()=>e.onsyncmore(o(i));var Y=_(le);se(()=>{le.disabled=a(),te(Y,a()?"Loading...":"Sync More")}),C(U,le)};pe(ne,U=>{n().hasMore&&U(H)})}se(()=>{j.disabled=a(),te(ee,a()?"Syncing...":"Sync New")}),C(W,Z)},K=W=>{var Z=N1();Z.__click=()=>e.onsync(o(i));var j=_(Z);se(()=>{Z.disabled=a(),te(j,a()?"Syncing...":"Download Emails")}),C(W,Z)};pe(X,W=>{var Z;(Z=n())!=null&&Z.synced?W(T):W(K,!1)})}var P=w(N,2);{var O=W=>{var Z=R1(),j=_(Z),ee=_(j);let ne,H;var U=w(j,2),le=_(U);se(Y=>{ne=It(ee,1,"progress-fill svelte-1ds3j4k",null,ne,{indeterminate:!r().total}),H=Lt(ee,"",H,Y),te(le,r().message||"Syncing...")},[()=>({width:`${f()??""}%`})]),C(W,Z)};pe(P,W=>{a()&&r()&&W(O)})}var I=w(P,2);{var Q=W=>{var Z=D1(),j=w(_(Z),2),ee=_(j);ee.__click=()=>M(s,!1);var ne=w(ee,2);ne.__click=()=>{e.onclear(),M(s,!1)},C(W,Z)};pe(I,W=>{o(s)&&W(Q)})}se(()=>ae.disabled=a()),po(ae,()=>o(i),W=>M(i,W)),C(t,v),tt()}Jt(["click"]);var j1=F('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),B1=F('<div class="message-list svelte-y2uamw"></div>');function q1(t,e){et(e,!0);let n=Ae(e,"messages",19,()=>[]);En(()=>ur("MessageList"));var r=B1();Tt(r,21,n,Ut,(a,s)=>{var i=j1();i.__click=()=>e.onselect(o(s));var l=_(i),u=_(l),f=w(l,2),v=_(f),p=_(v),h=_(p),m=w(p,2),x=_(m),k=w(v,2),A=_(k),D=w(k,2),q=_(D);se((G,S,z)=>{te(u,G),te(h,S),te(x,z),te(A,o(s).subject),te(q,o(s).snippet)},[()=>yp(o(s).from),()=>mp(o(s).from),()=>pd(o(s).date)]),C(a,i)}),C(t,r),tt()}Jt(["click"]);function wd(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Es=wd();function Up(t){Es=t}var Qa={exec:()=>null};function Bt(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(a,s)=>{let i=typeof s=="string"?s:s.source;return i=i.replace(qn.caret,"$1"),n=n.replace(a,i),r},getRegex:()=>new RegExp(n,e)};return r}var F1=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),qn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},K1=/^(?:[ \t]*(?:\n|$))+/,H1=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,V1=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,mo=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,U1=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,xd=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,Gp=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Wp=Bt(Gp).replace(/bull/g,xd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),G1=Bt(Gp).replace(/bull/g,xd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),kd=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,W1=/^[^\n]+/,Sd=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Y1=Bt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Sd).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),X1=Bt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,xd).getRegex(),Yl="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ed=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Z1=Bt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ed).replace("tag",Yl).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Yp=Bt(kd).replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex(),Q1=Bt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Yp).getRegex(),Ad={blockquote:Q1,code:H1,def:Y1,fences:V1,heading:U1,hr:mo,html:Z1,lheading:Wp,list:X1,newline:K1,paragraph:Yp,table:Qa,text:W1},Zf=Bt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex(),J1={...Ad,lheading:G1,table:Zf,paragraph:Bt(kd).replace("hr",mo).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Zf).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Yl).getRegex()},$1={...Ad,html:Bt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ed).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Qa,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Bt(kd).replace("hr",mo).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Wp).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ex=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,tx=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Xp=/^( {2,}|\\)\n(?!\s*$)/,nx=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Xl=/[\p{P}\p{S}]/u,Td=/[\s\p{P}\p{S}]/u,Zp=/[^\s\p{P}\p{S}]/u,rx=Bt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Td).getRegex(),Qp=/(?!~)[\p{P}\p{S}]/u,ax=/(?!~)[\s\p{P}\p{S}]/u,sx=/(?:[^\s\p{P}\p{S}]|~)/u,Jp=/(?![*_])[\p{P}\p{S}]/u,ix=/(?![*_])[\s\p{P}\p{S}]/u,ox=/(?:[^\s\p{P}\p{S}]|[*_])/u,lx=Bt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",F1?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),$p=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,cx=Bt($p,"u").replace(/punct/g,Xl).getRegex(),ux=Bt($p,"u").replace(/punct/g,Qp).getRegex(),eg="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",dx=Bt(eg,"gu").replace(/notPunctSpace/g,Zp).replace(/punctSpace/g,Td).replace(/punct/g,Xl).getRegex(),fx=Bt(eg,"gu").replace(/notPunctSpace/g,sx).replace(/punctSpace/g,ax).replace(/punct/g,Qp).getRegex(),vx=Bt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Zp).replace(/punctSpace/g,Td).replace(/punct/g,Xl).getRegex(),hx=Bt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Jp).getRegex(),px="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",gx=Bt(px,"gu").replace(/notPunctSpace/g,ox).replace(/punctSpace/g,ix).replace(/punct/g,Jp).getRegex(),mx=Bt(/\\(punct)/,"gu").replace(/punct/g,Xl).getRegex(),yx=Bt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),_x=Bt(Ed).replace("(?:-->|$)","-->").getRegex(),bx=Bt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",_x).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ml=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,wx=Bt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",ml).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),tg=Bt(/^!?\[(label)\]\[(ref)\]/).replace("label",ml).replace("ref",Sd).getRegex(),ng=Bt(/^!?\[(ref)\](?:\[\])?/).replace("ref",Sd).getRegex(),xx=Bt("reflink|nolink(?!\\()","g").replace("reflink",tg).replace("nolink",ng).getRegex(),Qf=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Cd={_backpedal:Qa,anyPunctuation:mx,autolink:yx,blockSkip:lx,br:Xp,code:tx,del:Qa,delLDelim:Qa,delRDelim:Qa,emStrongLDelim:cx,emStrongRDelimAst:dx,emStrongRDelimUnd:vx,escape:ex,link:wx,nolink:ng,punctuation:rx,reflink:tg,reflinkSearch:xx,tag:bx,text:nx,url:Qa},kx={...Cd,link:Bt(/^!?\[(label)\]\((.*?)\)/).replace("label",ml).getRegex(),reflink:Bt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ml).getRegex()},Au={...Cd,emStrongRDelimAst:fx,emStrongLDelim:ux,delLDelim:hx,delRDelim:gx,url:Bt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Qf).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Bt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Qf).getRegex()},Sx={...Au,br:Bt(Xp).replace("{2,}","*").getRegex(),text:Bt(Au.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ko={normal:Ad,gfm:J1,pedantic:$1},ki={normal:Cd,gfm:Au,breaks:Sx,pedantic:kx},Ex={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Jf=t=>Ex[t];function ia(t,e){if(e){if(qn.escapeTest.test(t))return t.replace(qn.escapeReplace,Jf)}else if(qn.escapeTestNoEncode.test(t))return t.replace(qn.escapeReplaceNoEncode,Jf);return t}function $f(t){try{t=encodeURI(t).replace(qn.percentDecode,"%")}catch{return null}return t}function ev(t,e){var s;let n=t.replace(qn.findPipe,(i,l,u)=>{let f=!1,v=l;for(;--v>=0&&u[v]==="\\";)f=!f;return f?"|":" |"}),r=n.split(qn.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((s=r.at(-1))!=null&&s.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(qn.slashPipe,"|");return r}function Si(t,e,n){let r=t.length;if(r===0)return"";let a=0;for(;a<r&&t.charAt(r-a-1)===e;)a++;return t.slice(0,r-a)}function Ax(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function Tx(t,e=0){let n=e,r="";for(let a of t)if(a==="	"){let s=4-n%4;r+=" ".repeat(s),n+=s}else r+=a,n++;return r}function tv(t,e,n,r,a){let s=e.href,i=e.title||null,l=t[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:i,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,u}function Cx(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let a=r[1];return e.split(`
`).map(s=>{let i=s.match(n.other.beginningSpace);if(i===null)return s;let[l]=i;return l.length>=a.length?s.slice(a.length):s}).join(`
`)}var yl=class{constructor(t){ht(this,"options");ht(this,"rules");ht(this,"lexer");this.options=t||Es}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Si(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=Cx(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=Si(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Si(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=Si(e[0],`
`).split(`
`),r="",a="",s=[];for(;n.length>0;){let i=!1,l=[],u;for(u=0;u<n.length;u++)if(this.rules.other.blockquoteStart.test(n[u]))l.push(n[u]),i=!0;else if(!i)l.push(n[u]);else break;n=n.slice(u);let f=l.join(`
`),v=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${f}`:f,a=a?`${a}
${v}`:v;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(v,s,!0),this.lexer.state.top=p,n.length===0)break;let h=s.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.blockquote(x);s[s.length-1]=k,r=r.substring(0,r.length-m.raw.length)+k.raw,a=a.substring(0,a.length-m.text.length)+k.text;break}else if((h==null?void 0:h.type)==="list"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.list(x);s[s.length-1]=k,r=r.substring(0,r.length-h.raw.length)+k.raw,a=a.substring(0,a.length-m.raw.length)+k.raw,n=x.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:a}}}list(t){var n,r;let e=this.rules.block.list.exec(t);if(e){let a=e[1].trim(),s=a.length>1,i={type:"list",raw:"",ordered:s,start:s?+a.slice(0,-1):"",loose:!1,items:[]};a=s?`\\d{1,9}\\${a.slice(-1)}`:`\\${a}`,this.options.pedantic&&(a=s?a:"[*+-]");let l=this.rules.other.listItemRegex(a),u=!1;for(;t;){let v=!1,p="",h="";if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;p=e[0],t=t.substring(p.length);let m=Tx(e[2].split(`
`,1)[0],e[1].length),x=t.split(`
`,1)[0],k=!m.trim(),A=0;if(this.options.pedantic?(A=2,h=m.trimStart()):k?A=e[1].length+1:(A=m.search(this.rules.other.nonSpaceChar),A=A>4?1:A,h=m.slice(A),A+=e[1].length),k&&this.rules.other.blankLine.test(x)&&(p+=x+`
`,t=t.substring(x.length+1),v=!0),!v){let D=this.rules.other.nextBulletRegex(A),q=this.rules.other.hrRegex(A),G=this.rules.other.fencesBeginRegex(A),S=this.rules.other.headingBeginRegex(A),z=this.rules.other.htmlBeginRegex(A),L=this.rules.other.blockquoteBeginRegex(A);for(;t;){let N=t.split(`
`,1)[0],J;if(x=N,this.options.pedantic?(x=x.replace(this.rules.other.listReplaceNesting,"  "),J=x):J=x.replace(this.rules.other.tabCharGlobal,"    "),G.test(x)||S.test(x)||z.test(x)||L.test(x)||D.test(x)||q.test(x))break;if(J.search(this.rules.other.nonSpaceChar)>=A||!x.trim())h+=`
`+J.slice(A);else{if(k||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||G.test(m)||S.test(m)||q.test(m))break;h+=`
`+x}k=!x.trim(),p+=N+`
`,t=t.substring(N.length+1),m=J.slice(A)}}i.loose||(u?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(u=!0)),i.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(h),loose:!1,text:h,tokens:[]}),i.raw+=p}let f=i.items.at(-1);if(f)f.raw=f.raw.trimEnd(),f.text=f.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let v of i.items){if(this.lexer.state.top=!1,v.tokens=this.lexer.blockTokens(v.text,[]),v.task){if(v.text=v.text.replace(this.rules.other.listReplaceTask,""),((n=v.tokens[0])==null?void 0:n.type)==="text"||((r=v.tokens[0])==null?void 0:r.type)==="paragraph"){v.tokens[0].raw=v.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),v.tokens[0].text=v.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let h=this.lexer.inlineQueue.length-1;h>=0;h--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[h].src)){this.lexer.inlineQueue[h].src=this.lexer.inlineQueue[h].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(v.raw);if(p){let h={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};v.checked=h.checked,i.loose?v.tokens[0]&&["paragraph","text"].includes(v.tokens[0].type)&&"tokens"in v.tokens[0]&&v.tokens[0].tokens?(v.tokens[0].raw=h.raw+v.tokens[0].raw,v.tokens[0].text=h.raw+v.tokens[0].text,v.tokens[0].tokens.unshift(h)):v.tokens.unshift({type:"paragraph",raw:h.raw,text:h.raw,tokens:[h]}):v.tokens.unshift(h)}}if(!i.loose){let p=v.tokens.filter(m=>m.type==="space"),h=p.length>0&&p.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=h}}if(i.loose)for(let v of i.items){v.loose=!0;for(let p of v.tokens)p.type==="text"&&(p.type="paragraph")}return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:a}}}table(t){var i;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=ev(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(i=e[3])!=null&&i.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let l of r)this.rules.other.tableAlignRight.test(l)?s.align.push("right"):this.rules.other.tableAlignCenter.test(l)?s.align.push("center"):this.rules.other.tableAlignLeft.test(l)?s.align.push("left"):s.align.push(null);for(let l=0;l<n.length;l++)s.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:s.align[l]});for(let l of a)s.rows.push(ev(l,s.header.length).map((u,f)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:s.align[f]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=Si(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Ax(e[2],"()");if(s===-2)return;if(s>-1){let i=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,i).trim(),e[3]=""}}let r=e[2],a="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],a=s[3])}else a=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),tv(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[r.toLowerCase()];if(!a){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return tv(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,u=0,f=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,e=e.slice(-1*t.length+a);(r=f.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(i=[...s].length,r[3]||r[4]){l+=i;continue}else if((r[5]||r[6])&&a%3&&!((a+i)%3)){u+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l+u);let v=[...r[0]][0].length,p=t.slice(0,a+r.index+v+i);if(Math.min(a,i)%2){let m=p.slice(1,-1);return{type:"em",raw:p,text:m,tokens:this.lexer.inlineTokens(m)}}let h=p.slice(2,-2);return{type:"strong",raw:p,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let r=this.rules.inline.delLDelim.exec(t);if(r&&(!r[1]||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,u=this.rules.inline.delRDelim;for(u.lastIndex=0,e=e.slice(-1*t.length+a);(r=u.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s||(i=[...s].length,i!==a))continue;if(r[3]||r[4]){l+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l);let f=[...r[0]][0].length,v=t.slice(0,a+r.index+f+i),p=v.slice(a,-a);return{type:"del",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,a;if(e[2]==="@")r=e[0],a="mailto:"+r;else{let s;do s=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(s!==e[0]);r=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Er=class Tu{constructor(e){ht(this,"tokens");ht(this,"options");ht(this,"state");ht(this,"inlineQueue");ht(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Es,this.options.tokenizer=this.options.tokenizer||new yl,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:qn,block:Ko.normal,inline:ki.normal};this.options.pedantic?(n.block=Ko.pedantic,n.inline=ki.pedantic):this.options.gfm&&(n.block=Ko.gfm,this.options.breaks?n.inline=ki.breaks:n.inline=ki.gfm),this.tokenizer.rules=n}static get rules(){return{block:Ko,inline:ki}}static lex(e,n){return new Tu(n).lex(e)}static lexInline(e,n){return new Tu(n).inlineTokens(e)}lex(e){e=e.replace(qn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var a,s,i;for(this.options.pedantic&&(e=e.replace(qn.tabCharGlobal,"    ").replace(qn.spaceLine,""));e;){let l;if((s=(a=this.options.extensions)==null?void 0:a.block)!=null&&s.some(f=>(l=f.call({lexer:this},e,n))?(e=e.substring(l.raw.length),n.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);let f=n.at(-1);l.raw.length===1&&f!==void 0?f.raw+=`
`:n.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.at(-1).src=f.text):n.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.raw,this.inlineQueue.at(-1).src=f.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title},n.push(l));continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),n.push(l);continue}let u=e;if((i=this.options.extensions)!=null&&i.startBlock){let f=1/0,v=e.slice(1),p;this.options.extensions.startBlock.forEach(h=>{p=h.call({lexer:this},v),typeof p=="number"&&p>=0&&(f=Math.min(f,p))}),f<1/0&&f>=0&&(u=e.substring(0,f+1))}if(this.state.top&&(l=this.tokenizer.paragraph(u))){let f=n.at(-1);r&&(f==null?void 0:f.type)==="paragraph"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(l),r=u.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(l);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,f,v,p,h;let r=e,a=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)m.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=a[2]?a[2].length:0,r=r.slice(0,a.index+s)+"["+"a".repeat(a[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((f=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:f.call({lexer:this},r))??r;let i=!1,l="";for(;e;){i||(l=""),i=!1;let m;if((p=(v=this.options.extensions)==null?void 0:v.inline)!=null&&p.some(k=>(m=k.call({lexer:this},e,n))?(e=e.substring(m.raw.length),n.push(m),!0):!1))continue;if(m=this.tokenizer.escape(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.tag(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.link(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(m.raw.length);let k=n.at(-1);m.type==="text"&&(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(m=this.tokenizer.emStrong(e,r,l)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.codespan(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.br(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.del(e,r,l)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.autolink(e)){e=e.substring(m.raw.length),n.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(e))){e=e.substring(m.raw.length),n.push(m);continue}let x=e;if((h=this.options.extensions)!=null&&h.startInline){let k=1/0,A=e.slice(1),D;this.options.extensions.startInline.forEach(q=>{D=q.call({lexer:this},A),typeof D=="number"&&D>=0&&(k=Math.min(k,D))}),k<1/0&&k>=0&&(x=e.substring(0,k+1))}if(m=this.tokenizer.inlineText(x)){e=e.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(l=m.raw.slice(-1)),i=!0;let k=n.at(-1);(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(e){let k="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return n}},_l=class{constructor(t){ht(this,"options");ht(this,"parser");this.options=t||Es}space(t){return""}code({text:t,lang:e,escaped:n}){var s;let r=(s=(e||"").match(qn.notSpaceStart))==null?void 0:s[0],a=t.replace(qn.endingNewline,"")+`
`;return r?'<pre><code class="language-'+ia(r)+'">'+(n?a:ia(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:ia(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let i=0;i<t.items.length;i++){let l=t.items[i];r+=this.listitem(l)}let a=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+a+s+`>
`+r+"</"+a+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let r="";for(let a=0;a<t.rows.length;a++){let s=t.rows[a];n="";for(let i=0;i<s.length;i++)n+=this.tablecell(s[i]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${ia(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),a=$f(t);if(a===null)return r;t=a;let s='<a href="'+t+'"';return e&&(s+=' title="'+ia(e)+'"'),s+=">"+r+"</a>",s}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=$f(t);if(a===null)return ia(n);t=a;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${ia(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:ia(t.text)}},Id=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Ar=class Cu{constructor(e){ht(this,"options");ht(this,"renderer");ht(this,"textRenderer");this.options=e||Es,this.options.renderer=this.options.renderer||new _l,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Id}static parse(e,n){return new Cu(n).parse(e)}static parseInline(e,n){return new Cu(n).parseInline(e)}parse(e){var r,a;let n="";for(let s=0;s<e.length;s++){let i=e[s];if((a=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&a[i.type]){let u=i,f=this.options.extensions.renderers[u.type].call({parser:this},u);if(f!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(u.type)){n+=f||"";continue}}let l=i;switch(l.type){case"space":{n+=this.renderer.space(l);break}case"hr":{n+=this.renderer.hr(l);break}case"heading":{n+=this.renderer.heading(l);break}case"code":{n+=this.renderer.code(l);break}case"table":{n+=this.renderer.table(l);break}case"blockquote":{n+=this.renderer.blockquote(l);break}case"list":{n+=this.renderer.list(l);break}case"checkbox":{n+=this.renderer.checkbox(l);break}case"html":{n+=this.renderer.html(l);break}case"def":{n+=this.renderer.def(l);break}case"paragraph":{n+=this.renderer.paragraph(l);break}case"text":{n+=this.renderer.text(l);break}default:{let u='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return n}parseInline(e,n=this.renderer){var a,s;let r="";for(let i=0;i<e.length;i++){let l=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[l.type]){let f=this.options.extensions.renderers[l.type].call({parser:this},l);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){r+=f||"";continue}}let u=l;switch(u.type){case"escape":{r+=n.text(u);break}case"html":{r+=n.html(u);break}case"link":{r+=n.link(u);break}case"image":{r+=n.image(u);break}case"checkbox":{r+=n.checkbox(u);break}case"strong":{r+=n.strong(u);break}case"em":{r+=n.em(u);break}case"codespan":{r+=n.codespan(u);break}case"br":{r+=n.br(u);break}case"del":{r+=n.del(u);break}case"text":{r+=n.text(u);break}default:{let f='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return r}},Jo,Ni=(Jo=class{constructor(t){ht(this,"options");ht(this,"block");this.options=t||Es}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Er.lex:Er.lexInline}provideParser(){return this.block?Ar.parse:Ar.parseInline}},ht(Jo,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ht(Jo,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Jo),Ix=class{constructor(...t){ht(this,"defaults",wd());ht(this,"options",this.setOptions);ht(this,"parse",this.parseMarkdown(!0));ht(this,"parseInline",this.parseMarkdown(!1));ht(this,"Parser",Ar);ht(this,"Renderer",_l);ht(this,"TextRenderer",Id);ht(this,"Lexer",Er);ht(this,"Tokenizer",yl);ht(this,"Hooks",Ni);this.use(...t)}walkTokens(t,e){var r,a;let n=[];for(let s of t)switch(n=n.concat(e.call(this,s)),s.type){case"table":{let i=s;for(let l of i.header)n=n.concat(this.walkTokens(l.tokens,e));for(let l of i.rows)for(let u of l)n=n.concat(this.walkTokens(u.tokens,e));break}case"list":{let i=s;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=s;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[i.type]?this.defaults.extensions.childTokens[i.type].forEach(l=>{let u=i[l].flat(1/0);n=n.concat(this.walkTokens(u,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let s=e.renderers[a.name];s?e.renderers[a.name]=function(...i){let l=a.renderer.apply(this,i);return l===!1&&(l=s.apply(this,i)),l}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[a.level];s?s.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),r.extensions=e),n.renderer){let a=this.defaults.renderer||new _l(this.defaults);for(let s in n.renderer){if(!(s in a))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let i=s,l=n.renderer[i],u=a[i];a[i]=(...f)=>{let v=l.apply(a,f);return v===!1&&(v=u.apply(a,f)),v||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new yl(this.defaults);for(let s in n.tokenizer){if(!(s in a))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let i=s,l=n.tokenizer[i],u=a[i];a[i]=(...f)=>{let v=l.apply(a,f);return v===!1&&(v=u.apply(a,f)),v}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Ni;for(let s in n.hooks){if(!(s in a))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let i=s,l=n.hooks[i],u=a[i];Ni.passThroughHooks.has(s)?a[i]=f=>{if(this.defaults.async&&Ni.passThroughHooksRespectAsync.has(s))return(async()=>{let p=await l.call(a,f);return u.call(a,p)})();let v=l.call(a,f);return u.call(a,v)}:a[i]=(...f)=>{if(this.defaults.async)return(async()=>{let p=await l.apply(a,f);return p===!1&&(p=await u.apply(a,f)),p})();let v=l.apply(a,f);return v===!1&&(v=u.apply(a,f)),v}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(i){let l=[];return l.push(s.call(this,i)),a&&(l=l.concat(a.call(this,i))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Er.lex(t,e??this.defaults)}parser(t,e){return Ar.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},a={...this.defaults,...r},s=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let i=a.hooks?await a.hooks.preprocess(e):e,l=await(a.hooks?await a.hooks.provideLexer():t?Er.lex:Er.lexInline)(i,a),u=a.hooks?await a.hooks.processAllTokens(l):l;a.walkTokens&&await Promise.all(this.walkTokens(u,a.walkTokens));let f=await(a.hooks?await a.hooks.provideParser():t?Ar.parse:Ar.parseInline)(u,a);return a.hooks?await a.hooks.postprocess(f):f})().catch(s);try{a.hooks&&(e=a.hooks.preprocess(e));let i=(a.hooks?a.hooks.provideLexer():t?Er.lex:Er.lexInline)(e,a);a.hooks&&(i=a.hooks.processAllTokens(i)),a.walkTokens&&this.walkTokens(i,a.walkTokens);let l=(a.hooks?a.hooks.provideParser():t?Ar.parse:Ar.parseInline)(i,a);return a.hooks&&(l=a.hooks.postprocess(l)),l}catch(i){return s(i)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+ia(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},ps=new Ix;function Xt(t,e){return ps.parse(t,e)}Xt.options=Xt.setOptions=function(t){return ps.setOptions(t),Xt.defaults=ps.defaults,Up(Xt.defaults),Xt};Xt.getDefaults=wd;Xt.defaults=Es;Xt.use=function(...t){return ps.use(...t),Xt.defaults=ps.defaults,Up(Xt.defaults),Xt};Xt.walkTokens=function(t,e){return ps.walkTokens(t,e)};Xt.parseInline=ps.parseInline;Xt.Parser=Ar;Xt.parser=Ar.parse;Xt.Renderer=_l;Xt.TextRenderer=Id;Xt.Lexer=Er;Xt.lexer=Er.lex;Xt.Tokenizer=yl;Xt.Hooks=Ni;Xt.parse=Xt;Xt.options;Xt.setOptions;Xt.use;Xt.walkTokens;Xt.parseInline;Ar.parse;Er.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:rg,setPrototypeOf:nv,isFrozen:Px,getPrototypeOf:Mx,getOwnPropertyDescriptor:Ox}=Object;let{freeze:Fn,seal:_r,create:Iu}=Object,{apply:Pu,construct:Mu}=typeof Reflect<"u"&&Reflect;Fn||(Fn=function(e){return e});_r||(_r=function(e){return e});Pu||(Pu=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return e.apply(n,a)});Mu||(Mu=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const Ho=Kn(Array.prototype.forEach),Nx=Kn(Array.prototype.lastIndexOf),rv=Kn(Array.prototype.pop),Ei=Kn(Array.prototype.push),Rx=Kn(Array.prototype.splice),sl=Kn(String.prototype.toLowerCase),qc=Kn(String.prototype.toString),Fc=Kn(String.prototype.match),Ai=Kn(String.prototype.replace),Dx=Kn(String.prototype.indexOf),Lx=Kn(String.prototype.trim),kr=Kn(Object.prototype.hasOwnProperty),jn=Kn(RegExp.prototype.test),Ti=zx(TypeError);function Kn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Pu(t,e,r)}}function zx(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Mu(t,n)}}function Pt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:sl;nv&&nv(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const s=n(a);s!==a&&(Px(e)||(e[r]=s),a=s)}t[a]=!0}return t}function jx(t){for(let e=0;e<t.length;e++)kr(t,e)||(t[e]=null);return t}function Br(t){const e=Iu(null);for(const[n,r]of rg(t))kr(t,n)&&(Array.isArray(r)?e[n]=jx(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=Br(r):e[n]=r);return e}function Ci(t,e){for(;t!==null;){const r=Ox(t,e);if(r){if(r.get)return Kn(r.get);if(typeof r.value=="function")return Kn(r.value)}t=Mx(t)}function n(){return null}return n}const av=Fn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Kc=Fn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Hc=Fn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Bx=Fn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Vc=Fn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),qx=Fn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),sv=Fn(["#text"]),iv=Fn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Uc=Fn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ov=Fn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Vo=Fn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Fx=_r(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Kx=_r(/<%[\w\W]*|[\w\W]*%>/gm),Hx=_r(/\$\{[\w\W]*/gm),Vx=_r(/^data-[\-\w.\u00B7-\uFFFF]+$/),Ux=_r(/^aria-[\-\w]+$/),ag=_r(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Gx=_r(/^(?:\w+script|data):/i),Wx=_r(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),sg=_r(/^html$/i),Yx=_r(/^[a-z][.\w]*(-[.\w]+)+$/i);var lv=Object.freeze({__proto__:null,ARIA_ATTR:Ux,ATTR_WHITESPACE:Wx,CUSTOM_ELEMENT:Yx,DATA_ATTR:Vx,DOCTYPE_NAME:sg,ERB_EXPR:Kx,IS_ALLOWED_URI:ag,IS_SCRIPT_OR_DATA:Gx,MUSTACHE_EXPR:Fx,TMPLIT_EXPR:Hx});const Ii={element:1,text:3,progressingInstruction:7,comment:8,document:9},Xx=function(){return typeof window>"u"?null:window},Zx=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},cv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Xx();const e=rt=>ig(rt);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Ii.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:l,Element:u,NodeFilter:f,NamedNodeMap:v=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:h,trustedTypes:m}=t,x=u.prototype,k=Ci(x,"cloneNode"),A=Ci(x,"remove"),D=Ci(x,"nextSibling"),q=Ci(x,"childNodes"),G=Ci(x,"parentNode");if(typeof i=="function"){const rt=n.createElement("template");rt.content&&rt.content.ownerDocument&&(n=rt.content.ownerDocument)}let S,z="";const{implementation:L,createNodeIterator:N,createDocumentFragment:J,getElementsByTagName:ae}=n,{importNode:ke}=r;let X=cv();e.isSupported=typeof rg=="function"&&typeof G=="function"&&L&&L.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:T,ERB_EXPR:K,TMPLIT_EXPR:P,DATA_ATTR:O,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:Q,ATTR_WHITESPACE:W,CUSTOM_ELEMENT:Z}=lv;let{IS_ALLOWED_URI:j}=lv,ee=null;const ne=Pt({},[...av,...Kc,...Hc,...Vc,...sv]);let H=null;const U=Pt({},[...iv,...Uc,...ov,...Vo]);let le=Object.seal(Iu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Y=null,ue=null;const _e=Object.seal(Iu(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ge=!0,re=!0,Te=!1,be=!0,Ie=!1,Ke=!0,Xe=!1,ft=!1,vt=!1,Le=!1,Re=!1,qe=!1,Oe=!0,Qe=!1;const ct="user-content-";let Je=!0,st=!1,nt={},Ge=null;const gt=Pt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ut=null;const Nt=Pt({},["audio","video","img","source","image","track"]);let qt=null;const wt=Pt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),mt="http://www.w3.org/1998/Math/MathML",yt="http://www.w3.org/2000/svg",ot="http://www.w3.org/1999/xhtml";let ze=ot,Mt=!1,Rt=null;const zt=Pt({},[mt,yt,ot],qc);let Ne=Pt({},["mi","mo","mn","ms","mtext"]),Gt=Pt({},["annotation-xml"]);const zn=Pt({},["title","style","font","a","script"]);let ye=null;const cn=["application/xhtml+xml","text/html"],An="text/html";let St=null,Nn=null;const Wt=n.createElement("form"),dt=function(oe){return oe instanceof RegExp||oe instanceof Function},it=function(){let oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Nn&&Nn===oe)){if((!oe||typeof oe!="object")&&(oe={}),oe=Br(oe),ye=cn.indexOf(oe.PARSER_MEDIA_TYPE)===-1?An:oe.PARSER_MEDIA_TYPE,St=ye==="application/xhtml+xml"?qc:sl,ee=kr(oe,"ALLOWED_TAGS")?Pt({},oe.ALLOWED_TAGS,St):ne,H=kr(oe,"ALLOWED_ATTR")?Pt({},oe.ALLOWED_ATTR,St):U,Rt=kr(oe,"ALLOWED_NAMESPACES")?Pt({},oe.ALLOWED_NAMESPACES,qc):zt,qt=kr(oe,"ADD_URI_SAFE_ATTR")?Pt(Br(wt),oe.ADD_URI_SAFE_ATTR,St):wt,ut=kr(oe,"ADD_DATA_URI_TAGS")?Pt(Br(Nt),oe.ADD_DATA_URI_TAGS,St):Nt,Ge=kr(oe,"FORBID_CONTENTS")?Pt({},oe.FORBID_CONTENTS,St):gt,Y=kr(oe,"FORBID_TAGS")?Pt({},oe.FORBID_TAGS,St):Br({}),ue=kr(oe,"FORBID_ATTR")?Pt({},oe.FORBID_ATTR,St):Br({}),nt=kr(oe,"USE_PROFILES")?oe.USE_PROFILES:!1,ge=oe.ALLOW_ARIA_ATTR!==!1,re=oe.ALLOW_DATA_ATTR!==!1,Te=oe.ALLOW_UNKNOWN_PROTOCOLS||!1,be=oe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ie=oe.SAFE_FOR_TEMPLATES||!1,Ke=oe.SAFE_FOR_XML!==!1,Xe=oe.WHOLE_DOCUMENT||!1,Le=oe.RETURN_DOM||!1,Re=oe.RETURN_DOM_FRAGMENT||!1,qe=oe.RETURN_TRUSTED_TYPE||!1,vt=oe.FORCE_BODY||!1,Oe=oe.SANITIZE_DOM!==!1,Qe=oe.SANITIZE_NAMED_PROPS||!1,Je=oe.KEEP_CONTENT!==!1,st=oe.IN_PLACE||!1,j=oe.ALLOWED_URI_REGEXP||ag,ze=oe.NAMESPACE||ot,Ne=oe.MATHML_TEXT_INTEGRATION_POINTS||Ne,Gt=oe.HTML_INTEGRATION_POINTS||Gt,le=oe.CUSTOM_ELEMENT_HANDLING||{},oe.CUSTOM_ELEMENT_HANDLING&&dt(oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=oe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&dt(oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=oe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),oe.CUSTOM_ELEMENT_HANDLING&&typeof oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=oe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ie&&(re=!1),Re&&(Le=!0),nt&&(ee=Pt({},sv),H=[],nt.html===!0&&(Pt(ee,av),Pt(H,iv)),nt.svg===!0&&(Pt(ee,Kc),Pt(H,Uc),Pt(H,Vo)),nt.svgFilters===!0&&(Pt(ee,Hc),Pt(H,Uc),Pt(H,Vo)),nt.mathMl===!0&&(Pt(ee,Vc),Pt(H,ov),Pt(H,Vo))),oe.ADD_TAGS&&(typeof oe.ADD_TAGS=="function"?_e.tagCheck=oe.ADD_TAGS:(ee===ne&&(ee=Br(ee)),Pt(ee,oe.ADD_TAGS,St))),oe.ADD_ATTR&&(typeof oe.ADD_ATTR=="function"?_e.attributeCheck=oe.ADD_ATTR:(H===U&&(H=Br(H)),Pt(H,oe.ADD_ATTR,St))),oe.ADD_URI_SAFE_ATTR&&Pt(qt,oe.ADD_URI_SAFE_ATTR,St),oe.FORBID_CONTENTS&&(Ge===gt&&(Ge=Br(Ge)),Pt(Ge,oe.FORBID_CONTENTS,St)),oe.ADD_FORBID_CONTENTS&&(Ge===gt&&(Ge=Br(Ge)),Pt(Ge,oe.ADD_FORBID_CONTENTS,St)),Je&&(ee["#text"]=!0),Xe&&Pt(ee,["html","head","body"]),ee.table&&(Pt(ee,["tbody"]),delete Y.tbody),oe.TRUSTED_TYPES_POLICY){if(typeof oe.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ti('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof oe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ti('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=oe.TRUSTED_TYPES_POLICY,z=S.createHTML("")}else S===void 0&&(S=Zx(m,a)),S!==null&&typeof z=="string"&&(z=S.createHTML(""));Fn&&Fn(oe),Nn=oe}},Ft=Pt({},[...Kc,...Hc,...Bx]),lt=Pt({},[...Vc,...qx]),kt=function(oe){let Be=G(oe);(!Be||!Be.tagName)&&(Be={namespaceURI:ze,tagName:"template"});const He=sl(oe.tagName),Kt=sl(Be.tagName);return Rt[oe.namespaceURI]?oe.namespaceURI===yt?Be.namespaceURI===ot?He==="svg":Be.namespaceURI===mt?He==="svg"&&(Kt==="annotation-xml"||Ne[Kt]):!!Ft[He]:oe.namespaceURI===mt?Be.namespaceURI===ot?He==="math":Be.namespaceURI===yt?He==="math"&&Gt[Kt]:!!lt[He]:oe.namespaceURI===ot?Be.namespaceURI===yt&&!Gt[Kt]||Be.namespaceURI===mt&&!Ne[Kt]?!1:!lt[He]&&(zn[He]||!Ft[He]):!!(ye==="application/xhtml+xml"&&Rt[oe.namespaceURI]):!1},tn=function(oe){Ei(e.removed,{element:oe});try{G(oe).removeChild(oe)}catch{A(oe)}},rn=function(oe,Be){try{Ei(e.removed,{attribute:Be.getAttributeNode(oe),from:Be})}catch{Ei(e.removed,{attribute:null,from:Be})}if(Be.removeAttribute(oe),oe==="is")if(Le||Re)try{tn(Be)}catch{}else try{Be.setAttribute(oe,"")}catch{}},Rn=function(oe){let Be=null,He=null;if(vt)oe="<remove></remove>"+oe;else{const un=Fc(oe,/^[\r\n\t ]+/);He=un&&un[0]}ye==="application/xhtml+xml"&&ze===ot&&(oe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+oe+"</body></html>");const Kt=S?S.createHTML(oe):oe;if(ze===ot)try{Be=new h().parseFromString(Kt,ye)}catch{}if(!Be||!Be.documentElement){Be=L.createDocument(ze,"template",null);try{Be.documentElement.innerHTML=Mt?z:Kt}catch{}}const an=Be.body||Be.documentElement;return oe&&He&&an.insertBefore(n.createTextNode(He),an.childNodes[0]||null),ze===ot?ae.call(Be,Xe?"html":"body")[0]:Xe?Be.documentElement:an},Yt=function(oe){return N.call(oe.ownerDocument||oe,oe,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},$t=function(oe){return oe instanceof p&&(typeof oe.nodeName!="string"||typeof oe.textContent!="string"||typeof oe.removeChild!="function"||!(oe.attributes instanceof v)||typeof oe.removeAttribute!="function"||typeof oe.setAttribute!="function"||typeof oe.namespaceURI!="string"||typeof oe.insertBefore!="function"||typeof oe.hasChildNodes!="function")},_n=function(oe){return typeof l=="function"&&oe instanceof l};function vn(rt,oe,Be){Ho(rt,He=>{He.call(e,oe,Be,Nn)})}const nr=function(oe){let Be=null;if(vn(X.beforeSanitizeElements,oe,null),$t(oe))return tn(oe),!0;const He=St(oe.nodeName);if(vn(X.uponSanitizeElement,oe,{tagName:He,allowedTags:ee}),Ke&&oe.hasChildNodes()&&!_n(oe.firstElementChild)&&jn(/<[/\w!]/g,oe.innerHTML)&&jn(/<[/\w!]/g,oe.textContent)||oe.nodeType===Ii.progressingInstruction||Ke&&oe.nodeType===Ii.comment&&jn(/<[/\w]/g,oe.data))return tn(oe),!0;if(!(_e.tagCheck instanceof Function&&_e.tagCheck(He))&&(!ee[He]||Y[He])){if(!Y[He]&&xa(He)&&(le.tagNameCheck instanceof RegExp&&jn(le.tagNameCheck,He)||le.tagNameCheck instanceof Function&&le.tagNameCheck(He)))return!1;if(Je&&!Ge[He]){const Kt=G(oe)||oe.parentNode,an=q(oe)||oe.childNodes;if(an&&Kt){const un=an.length;for(let hn=un-1;hn>=0;--hn){const Vn=k(an[hn],!0);Vn.__removalCount=(oe.__removalCount||0)+1,Kt.insertBefore(Vn,D(oe))}}}return tn(oe),!0}return oe instanceof u&&!kt(oe)||(He==="noscript"||He==="noembed"||He==="noframes")&&jn(/<\/no(script|embed|frames)/i,oe.innerHTML)?(tn(oe),!0):(Ie&&oe.nodeType===Ii.text&&(Be=oe.textContent,Ho([T,K,P],Kt=>{Be=Ai(Be,Kt," ")}),oe.textContent!==Be&&(Ei(e.removed,{element:oe.cloneNode()}),oe.textContent=Be)),vn(X.afterSanitizeElements,oe,null),!1)},na=function(oe,Be,He){if(Oe&&(Be==="id"||Be==="name")&&(He in n||He in Wt))return!1;if(!(re&&!ue[Be]&&jn(O,Be))){if(!(ge&&jn(I,Be))){if(!(_e.attributeCheck instanceof Function&&_e.attributeCheck(Be,oe))){if(!H[Be]||ue[Be]){if(!(xa(oe)&&(le.tagNameCheck instanceof RegExp&&jn(le.tagNameCheck,oe)||le.tagNameCheck instanceof Function&&le.tagNameCheck(oe))&&(le.attributeNameCheck instanceof RegExp&&jn(le.attributeNameCheck,Be)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(Be,oe))||Be==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&jn(le.tagNameCheck,He)||le.tagNameCheck instanceof Function&&le.tagNameCheck(He))))return!1}else if(!qt[Be]){if(!jn(j,Ai(He,W,""))){if(!((Be==="src"||Be==="xlink:href"||Be==="href")&&oe!=="script"&&Dx(He,"data:")===0&&ut[oe])){if(!(Te&&!jn(Q,Ai(He,W,"")))){if(He)return!1}}}}}}}return!0},xa=function(oe){return oe!=="annotation-xml"&&Fc(oe,Z)},Hn=function(oe){vn(X.beforeSanitizeAttributes,oe,null);const{attributes:Be}=oe;if(!Be||$t(oe))return;const He={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let Kt=Be.length;for(;Kt--;){const an=Be[Kt],{name:un,namespaceURI:hn,value:Vn}=an,Lr=St(un),Ha=Vn;let on=un==="value"?Ha:Lx(Ha);if(He.attrName=Lr,He.attrValue=on,He.keepAttr=!0,He.forceKeepAttr=void 0,vn(X.uponSanitizeAttribute,oe,He),on=He.attrValue,Qe&&(Lr==="id"||Lr==="name")&&(rn(un,oe),on=ct+on),Ke&&jn(/((--!?|])>)|<\/(style|title|textarea)/i,on)){rn(un,oe);continue}if(Lr==="attributename"&&Fc(on,"href")){rn(un,oe);continue}if(He.forceKeepAttr)continue;if(!He.keepAttr){rn(un,oe);continue}if(!be&&jn(/\/>/i,on)){rn(un,oe);continue}Ie&&Ho([T,K,P],Va=>{on=Ai(on,Va," ")});const di=St(oe.nodeName);if(!na(di,Lr,on)){rn(un,oe);continue}if(S&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!hn)switch(m.getAttributeType(di,Lr)){case"TrustedHTML":{on=S.createHTML(on);break}case"TrustedScriptURL":{on=S.createScriptURL(on);break}}if(on!==Ha)try{hn?oe.setAttributeNS(hn,un,on):oe.setAttribute(un,on),$t(oe)?tn(oe):rv(e.removed)}catch{rn(un,oe)}}vn(X.afterSanitizeAttributes,oe,null)},Cs=function rt(oe){let Be=null;const He=Yt(oe);for(vn(X.beforeSanitizeShadowDOM,oe,null);Be=He.nextNode();)vn(X.uponSanitizeShadowNode,Be,null),nr(Be),Hn(Be),Be.content instanceof s&&rt(Be.content);vn(X.afterSanitizeShadowDOM,oe,null)};return e.sanitize=function(rt){let oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Be=null,He=null,Kt=null,an=null;if(Mt=!rt,Mt&&(rt="<!-->"),typeof rt!="string"&&!_n(rt))if(typeof rt.toString=="function"){if(rt=rt.toString(),typeof rt!="string")throw Ti("dirty is not a string, aborting")}else throw Ti("toString is not a function");if(!e.isSupported)return rt;if(ft||it(oe),e.removed=[],typeof rt=="string"&&(st=!1),st){if(rt.nodeName){const Vn=St(rt.nodeName);if(!ee[Vn]||Y[Vn])throw Ti("root node is forbidden and cannot be sanitized in-place")}}else if(rt instanceof l)Be=Rn("<!---->"),He=Be.ownerDocument.importNode(rt,!0),He.nodeType===Ii.element&&He.nodeName==="BODY"||He.nodeName==="HTML"?Be=He:Be.appendChild(He);else{if(!Le&&!Ie&&!Xe&&rt.indexOf("<")===-1)return S&&qe?S.createHTML(rt):rt;if(Be=Rn(rt),!Be)return Le?null:qe?z:""}Be&&vt&&tn(Be.firstChild);const un=Yt(st?rt:Be);for(;Kt=un.nextNode();)nr(Kt),Hn(Kt),Kt.content instanceof s&&Cs(Kt.content);if(st)return rt;if(Le){if(Re)for(an=J.call(Be.ownerDocument);Be.firstChild;)an.appendChild(Be.firstChild);else an=Be;return(H.shadowroot||H.shadowrootmode)&&(an=ke.call(r,an,!0)),an}let hn=Xe?Be.outerHTML:Be.innerHTML;return Xe&&ee["!doctype"]&&Be.ownerDocument&&Be.ownerDocument.doctype&&Be.ownerDocument.doctype.name&&jn(sg,Be.ownerDocument.doctype.name)&&(hn="<!DOCTYPE "+Be.ownerDocument.doctype.name+`>
`+hn),Ie&&Ho([T,K,P],Vn=>{hn=Ai(hn,Vn," ")}),S&&qe?S.createHTML(hn):hn},e.setConfig=function(){let rt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};it(rt),ft=!0},e.clearConfig=function(){Nn=null,ft=!1},e.isValidAttribute=function(rt,oe,Be){Nn||it({});const He=St(rt),Kt=St(oe);return na(He,Kt,Be)},e.addHook=function(rt,oe){typeof oe=="function"&&Ei(X[rt],oe)},e.removeHook=function(rt,oe){if(oe!==void 0){const Be=Nx(X[rt],oe);return Be===-1?void 0:Rx(X[rt],Be,1)[0]}return rv(X[rt])},e.removeHooks=function(rt){X[rt]=[]},e.removeAllHooks=function(){X=cv()},e}var Qx=ig();function Jx(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${uv(t.from)} |`),e.push(`| **To** | ${uv(t.to)} |`),e.push(`| **Date** | ${pd(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?$x(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function uv(t){return(t||"").replace(/\|/g,"\\|")}function $x(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Ou(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function ek(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),r=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||r>0&&r<=3)return!0;const a=e.toLowerCase();return a.includes("spacer")||a.includes("transparent")||a.includes("transp.gif")||a.includes("/track")&&a.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(a)?!0:a.includes("mail.google.com/mail/u/")&&a.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(a)||a.endsWith(".gif")&&a.includes("1x1"))}function Ou(t){var a;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const s=t.getAttribute("src")||"",i=t.getAttribute("alt")||"";return ek(t,s)?"":`![${i}](${s})`}const n=Array.from(t.childNodes).map(Ou).join(""),r=n.trim();if(!r&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${r}

`;if(e==="blockquote")return`

> ${r.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const s=Number(e[1]);return`

${"#".repeat(s)} ${r}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((a=t.parentElement)==null?void 0:a.tagName.toLowerCase())==="ol"?"1.":"-"} ${r}
`;if(e==="a"){const s=t.getAttribute("href")||"";return!s||s.startsWith("mailto:")?r:r===s?s:`[${r}](${s})`}if(e==="strong"||e==="b")return`**${r}**`;if(e==="em"||e==="i")return`*${r}*`;if(e==="code")return`\`${r}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(i=>Ou(i).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const s=n.trim(),i=(s.match(/\|/g)||[]).length-1,l="| "+Array(Math.max(i,1)).fill("---").join(" | ")+" |";return`${s}${l}
`}return n}function tk(t){return _p(t,"md")}function dv(t,e,n="text/markdown;charset=utf-8"){const r=new Blob([t],{type:n}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function nk(t){return t.raw||null}function rk(t){const e=nk(t);return e?JSON.stringify(e,null,2):"null"}function ak(t){return _p(t,"json")}var sk=F('<button title="View as Markdown">.md</button>'),ik=F('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),ok=F('<pre class="md-raw svelte-1b0rzpb"> </pre>'),lk=F('<div class="md-preview svelte-1b0rzpb"><!></div>'),ck=F('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),uk=F('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),dk=F('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),fk=F('<pre class="message-text svelte-1b0rzpb"> </pre>'),vk=F('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),hk=F('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),pk=F('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function gk(t,e){et(e,!0);let n=Ae(e,"loading",3,!1);En(()=>ur("MessageModal"));const r=new Xt.Renderer;r.link=({href:T,title:K,text:P})=>{const O=K?` title="${K}"`:"";return`<a href="${T}"${O} target="_blank" rel="noopener">${P}</a>`},Xt.setOptions({breaks:!0,gfm:!0,renderer:r});let a=Me("email"),s=$(()=>e.message.body?Jx(e.message):""),i=$(()=>rk(e.message)),l=Me("raw");function u(T){M(a,o(a)===T?"email":T,!0),T==="markdown"&&M(l,"raw")}function f(){dv(o(s),tk(e.message))}function v(){dv(o(i),ak(e.message),"application/json;charset=utf-8")}function p(T){const K=Xt.parse(T);return Qx.sanitize(K,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let h=Me(null);On(()=>{var T;if(o(h)&&e.message.htmlBody&&!n()&&o(a)==="email"){const K=o(h).contentDocument||((T=o(h).contentWindow)==null?void 0:T.document);K&&(K.open(),K.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),K.close())}});var m=pk();m.__click=function(...T){var K;(K=e.onclose)==null||K.apply(this,T)};var x=_(m);x.__click=T=>T.stopPropagation();var k=_(x),A=_(k),D=_(A),q=w(A,2),G=_(q);let S;G.__click=()=>u("json");var z=w(G,2);{var L=T=>{var K=sk();let P;K.__click=()=>u("markdown"),se(()=>P=It(K,1,"action-btn svelte-1b0rzpb",null,P,{active:o(a)==="markdown"})),C(T,K)};pe(z,T=>{e.message.body&&T(L)})}var N=w(z,2);N.__click=function(...T){var K;(K=e.onclose)==null||K.apply(this,T)};var J=w(k,2);{var ae=T=>{var K=ik(),P=We(K),O=w(_(P),2);O.__click=v;var I=w(P,2),Q=_(I),W=_(Q);se(()=>te(W,o(i))),C(T,K)},ke=T=>{var K=ck(),P=We(K),O=_(P),I=_(O);let Q;I.__click=()=>M(l,"raw");var W=w(I,2);let Z;W.__click=()=>M(l,"preview");var j=w(O,2);j.__click=f;var ee=w(P,2),ne=_(ee);{var H=le=>{var Y=ok(),ue=_(Y);se(()=>te(ue,o(s))),C(le,Y)},U=le=>{var Y=lk(),ue=_(Y);n_(ue,()=>p(o(s))),C(le,Y)};pe(ne,le=>{o(l)==="raw"?le(H):le(U,!1)})}se(()=>{Q=It(I,1,"md-tab svelte-1b0rzpb",null,Q,{active:o(l)==="raw"}),Z=It(W,1,"md-tab svelte-1b0rzpb",null,Z,{active:o(l)==="preview"})}),C(T,K)},X=T=>{var K=hk(),P=We(K),O=_(P),I=w(_(O),2),Q=_(I),W=w(O,2),Z=w(_(W),2),j=_(Z),ee=w(W,2),ne=w(_(ee),2),H=_(ne),U=w(P,2),le=_(U);{var Y=re=>{var Te=uk();C(re,Te)},ue=re=>{var Te=dk();ks(Te,be=>M(h,be),()=>o(h)),C(re,Te)},_e=re=>{var Te=fk(),be=_(Te);se(()=>te(be,e.message.body)),C(re,Te)},ge=re=>{var Te=vk();C(re,Te)};pe(le,re=>{n()?re(Y):e.message.htmlBody?re(ue,1):e.message.body?re(_e,2):re(ge,!1)})}se(re=>{te(Q,e.message.from),te(j,e.message.to),te(H,re)},[()=>pd(e.message.date)]),C(T,K)};pe(J,T=>{o(a)==="json"?T(ae):o(a)==="markdown"?T(ke,1):T(X,!1)})}se(()=>{te(D,e.message.subject),S=It(G,1,"action-btn svelte-1b0rzpb",null,S,{active:o(a)==="json"})}),C(t,m),tt()}Jt(["click"]);var mk=F('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),yk=F('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),_k=F('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),bk=F("<p> </p>"),wk=F('<p>No emails in local storage. Click "Sync New" to download.</p>'),xk=F('<div class="empty-state svelte-6ts5xm"><!></div>'),kk=F('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Sk=F('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Ek(t,e){et(e,!0),En(()=>ur("DashboardView"));let n=Ae(e,"error",3,null),r=Ae(e,"profile",3,null),a=Ae(e,"loadingProfile",3,!1),s=Ae(e,"emailMessages",19,()=>[]),i=Ae(e,"totalLocalMessages",3,0),l=Ae(e,"hasMoreLocal",3,!1),u=Ae(e,"loadingMessages",3,!1),f=Ae(e,"selectedMessage",3,null),v=Ae(e,"syncStatus",3,null),p=Ae(e,"syncProgress",3,null),h=Ae(e,"isSyncing",3,!1),m=Ae(e,"searchQuery",15);var x=Sk(),k=We(x),A=_(k);{var D=O=>{Vp(O,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};pe(A,O=>{n()&&O(D)})}var q=w(A,2);S1(q,{get profile(){return r()},get loadingProfile(){return a()},get onsignout(){return e.onsignout}});var G=w(q,2);z1(G,{get syncStatus(){return v()},get syncProgress(){return p()},get isSyncing(){return h()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var S=w(G,2),z=_(S);z.__keydown=O=>O.key==="Enter"&&e.onsearch();var L=w(z,2);L.__click=function(...O){var I;(I=e.onsearch)==null||I.apply(this,O)};var N=_(L),J=w(S,2);{var ae=O=>{var I=yk(),Q=We(I),W=_(Q),Z=_(W),j=w(Q,2);q1(j,{get messages(){return s()},get onselect(){return e.onviewmessage}});var ee=w(j,2);{var ne=H=>{var U=mk(),le=_(U);le.__click=function(...ue){var _e;(_e=e.onloadmore)==null||_e.apply(this,ue)};var Y=_(le);se(()=>{le.disabled=u(),te(Y,u()?"Loading...":"Load More")}),C(H,U)};pe(ee,H=>{l()&&H(ne)})}se(H=>te(Z,`Showing ${s().length??""} of ${H??""}
        ${m()?" matching":""} emails`),[()=>i().toLocaleString()]),C(O,I)},ke=O=>{var I=_k();C(O,I)},X=O=>{var I=xk(),Q=_(I);{var W=j=>{var ee=bk(),ne=_(ee);se(()=>te(ne,`No emails match "${m()??""}".`)),C(j,ee)},Z=j=>{var ee=wk();C(j,ee)};pe(Q,j=>{m()?j(W):j(Z,!1)})}C(O,I)},T=O=>{var I=kk();C(O,I)};pe(J,O=>{var I;s().length>0?O(ae):u()?O(ke,1):(I=v())!=null&&I.synced?O(X,2):O(T,!1)})}var K=w(k,2);{var P=O=>{gk(O,{get message(){return f()},loading:!1,get onclose(){return e.onclosedetail}})};pe(K,O=>{f()&&O(P)})}se(()=>{L.disabled=u(),te(N,u()?"Searching...":"Search")}),va(z,m),C(t,x),tt()}Jt(["keydown","click"]);var Ak=F('<div class="dashboard svelte-1q5o2lv"><!></div>');function Tk(t,e){et(e,!0);function n(be){be.key==="Escape"&&o(h)&&ne()}let r=null;En(async()=>{if(window.addEventListener("keydown",n),!o(l)){const be=await Vi("googleClientId");M(l,be||i,!0),M(u,be||i,!0)}return()=>{window.removeEventListener("keydown",n),r&&clearTimeout(r)}});function a(){r&&clearTimeout(r);const be=I0();if(be<=0)return;const Ie=Math.max(0,be-120*1e3);r=setTimeout(async()=>{try{const Ke=await Wf();M(v,Ke.access_token,!0),a()}catch{M(v,null),M(p,null),M(S,"Session expired. Please sign in again.")}},Ie)}async function s(){if(C0())return o(v);try{const be=await Wf();return M(v,be.access_token,!0),a(),o(v)}catch{return M(v,null),M(p,null),M(S,"Session expired. Please sign in again."),null}}const i="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let l=Me(en(i)),u=Me(en(i)),f=Me(!1),v=Me(null),p=Me(null),h=Me(null),m=Me(""),x=Me(en([])),k=Me(0),A=Me(0),D=Me(!1),q=Me(!1),G=Me(!1),S=Me(null),z=Me(null),L=Me(null),N=Me(!1);const J=50;On(()=>{o(v)&&(H(),W())});let ae=$(()=>!o(l)),ke=$(()=>o(l)===i),X=$(()=>!!o(v)),T=$(()=>o(x).length<o(k));On(()=>{o(l)&&!o(f)&&Yf(o(l)).then(async()=>{if(M(f,!0),!o(v)){const be=await Wl();be&&(M(v,be.access_token,!0),a(),Q())}}).catch(be=>{M(S,`Auth init failed: ${be.message}`)})});async function K(){const be=o(u).trim();be&&(await Ui("googleClientId",be),M(l,be,!0),M(S,null))}async function P(){await dd("googleClientId"),M(l,""),M(u,i),M(f,!1),M(v,null),M(p,null),M(x,[],!0),M(k,0)}async function O(){M(S,null),M(q,!0);try{o(f)||(await Yf(o(l)),M(f,!0));const be=await M0();M(v,be.access_token,!0),a(),await Q()}catch(be){M(S,be.message,!0)}finally{M(q,!1)}}async function I(){if(r&&clearTimeout(r),o(v))try{await O0(o(v))}catch{}M(v,null),M(p,null),M(x,[],!0),M(k,0),M(h,null),M(S,null)}async function Q(){M(G,!0);try{const be=await hp(o(v));if(!o(v))return;M(p,be,!0)}catch(be){if(!o(v))return;M(S,`Profile fetch failed: ${be.message}`)}finally{M(G,!1)}}async function W(be=!1){M(D,!0);try{const Ie=be?o(A):0,Ke=await Z_({query:o(m)||void 0,limit:J,offset:Ie});be?M(x,[...o(x),...Ke.items],!0):M(x,Ke.items,!0),M(k,Ke.total,!0),M(A,o(x).length,!0)}catch(Ie){M(S,`Failed to load messages: ${Ie.message}`)}finally{M(D,!1)}}function Z(){M(A,0),W(!1)}function j(){W(!0)}function ee(be){M(h,be,!0)}function ne(){M(h,null)}async function H(){try{M(z,await $w(),!0)}catch{}}async function U(be){if(o(N)||!o(v))return;const Ie=await s();if(!Ie)return;M(S,null),M(N,!0),M(L,null);const Ke=new AbortController;try{await Qw(Ie,{limit:be,onProgress:Xe=>{M(L,{...Xe},!0)},signal:Ke.signal}),await H(),await W(!1)}catch(Xe){if(Xe.name!=="AbortError"){if(!o(v))return;M(S,`Sync failed: ${Xe.message}`)}}finally{M(N,!1)}}async function le(be){if(o(N)||!o(v))return;const Ie=await s();if(!Ie)return;M(S,null),M(N,!0),M(L,null);const Ke=new AbortController;try{await Jw(Ie,{limit:be,onProgress:Xe=>{M(L,{...Xe},!0)},signal:Ke.signal}),await H(),await W(!1)}catch(Xe){if(Xe.name!=="AbortError"){if(!o(v))return;M(S,`Sync more failed: ${Xe.message}`)}}finally{M(N,!1)}}async function Y(){try{await qp(),await H(),M(x,[],!0),M(k,0),M(A,0)}catch(be){M(S,`Failed to clear data: ${be.message}`)}}var ue=Ak(),_e=_(ue);{var ge=be=>{o1(be,{onsave:K,defaultClientId:i,get clientIdInput(){return o(u)},set clientIdInput(Ie){M(u,Ie,!0)}})},re=be=>{b1(be,{get clientId(){return o(l)},get isDefaultClientId(){return o(ke)},get error(){return o(S)},get loadingAuth(){return o(q)},onsignin:O,onclear:P,onsignout:I})},Te=be=>{Ek(be,{get error(){return o(S)},get profile(){return o(p)},get loadingProfile(){return o(G)},get emailMessages(){return o(x)},get totalLocalMessages(){return o(k)},get hasMoreLocal(){return o(T)},get loadingMessages(){return o(D)},get selectedMessage(){return o(h)},get syncStatus(){return o(z)},get syncProgress(){return o(L)},get isSyncing(){return o(N)},onsignout:I,onsearch:Z,onloadmore:j,onviewmessage:ee,onclosedetail:ne,ondismisserror:()=>M(S,null),onsync:U,onsyncmore:le,oncleardata:Y,get searchQuery(){return o(m)},set searchQuery(Ie){M(m,Ie,!0)}})};pe(_e,be=>{o(ae)?be(ge):o(X)?be(Te,!1):be(re,1)})}C(t,ue),tt()}var Ck=F('<span class="err svelte-t1ig66"> </span>'),Ik=F('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Pk=F('<span class="stream-stats svelte-t1ig66"> </span>'),Mk=F('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),Ok=F('<span class="ei-group svelte-t1ig66"> </span>'),Nk=F('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),Rk=F('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),Dk=F('<span class="sep svelte-t1ig66">Â·</span> ',1),Lk=F('<div class="ei-summary svelte-t1ig66"> </div>'),zk=F('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),jk=F('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Bk=F("<!> <!> <!>",1),qk=F('<div class="ei-error svelte-t1ig66"> </div>'),Fk=F('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Kk=F('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Hk=F('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Vk=F('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Uk=F(' <span class="sep svelte-t1ig66">Â·</span>',1),Gk=F('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Wk=F('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Yk=F('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),Xk=F('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function Zk(t,e){et(e,!0);let n=Ae(e,"progress",3,null);function r(h){return!h||h<0?"â":h<1e3?`${Math.round(h)}ms`:`${(h/1e3).toFixed(1)}s`}function a(h){return h?h>=1e3?`${(h/1e3).toFixed(1)}k`:String(h):"0"}function s(h){if(!h)return"â";const m=h.replace(/<.*>/,"").trim();return m.length>30?m.slice(0,28)+"â¦":m}function i(h){if(!h)return"";try{return new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let l=$(()=>{var h;return(h=n())!=null&&h.total?Math.round(n().current/n().total*100):0}),u=$(()=>{var h;return((h=n())==null?void 0:h.phase)==="done"});var f=ln(),v=We(f);{var p=h=>{var m=Xk(),x=_(m),k=_(x),A=_(k);{var D=ne=>{var H=mn();se(()=>te(H,`Scan complete â ${(n().classified||0)??""} classified`)),C(ne,H)},q=ne=>{var H=mn("Loading emailsâ¦");C(ne,H)},G=ne=>{var H=mn();se(()=>te(H,`Processing ${n().current??0??""} / ${n().total??0??""}`)),C(ne,H)};pe(A,ne=>{o(u)?ne(D):n().phase==="loading"?ne(q,1):ne(G,!1)})}var S=w(k,2),z=_(S),L=w(x,2),N=_(L);let J,ae;var ke=w(L,2);{var X=ne=>{var H=Ik(),U=_(H),le=w(U);{var Y=ge=>{var re=Ck(),Te=_(re);se(()=>te(Te,`Â· ${n().errors??""} errors`)),C(ge,re)};pe(le,ge=>{n().errors&&ge(Y)})}var ue=w(le,3),_e=w(ue,2);se((ge,re,Te)=>{te(U,`${(n().classified||0)??""} classified `),te(ue,` ${ge??""} in + ${re??""} out `),te(_e,` ${Te??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),C(ne,H)};pe(ke,ne=>{n().totals&&!o(u)&&ne(X)})}var T=w(ke,2);{var K=ne=>{var H=Mk(),U=_(H),le=_(U),Y=_(le),ue=w(le,2);{var _e=Te=>{var be=Pk(),Ie=_(be);se(Ke=>te(Ie,`${Ke??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),C(Te,be)};pe(ue,Te=>{var be;(be=n().live)!=null&&be.tps&&Te(_e)})}var ge=w(U,2),re=_(ge);se(()=>{te(Y,n().email.subject||"(no subject)"),te(re,n().streamingText||"Waiting for modelâ¦")}),C(ne,H)};pe(T,ne=>{!o(u)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&ne(K)})}var P=w(T,2);{var O=ne=>{var H=Kk(),U=_(H),le=w(_(U),2),Y=_(le),ue=w(U,2);Tt(ue,17,()=>n().results,Ut,(_e,ge,re)=>{var Te=Fk();let be;var Ie=_(Te),Ke=_(Ie);Ke.textContent=`${re+1}.`;var Xe=w(Ke,2),ft=_(Xe),vt=w(Xe,2);{var Le=Ge=>{var gt=Nk(),ut=We(gt),Nt=_(ut),qt=w(ut,2);{var wt=mt=>{const yt=$(()=>Nr[o(ge).classification.group]);var ot=ln(),ze=We(ot);{var Mt=Rt=>{var zt=Ok();let Ne;var Gt=_(zt);se(()=>{bt(zt,"title",o(yt).description),Ne=Lt(zt,"",Ne,{color:o(yt).color}),te(Gt,o(yt).label)}),C(Rt,zt)};pe(ze,Rt=>{o(yt)&&Rt(Mt)})}C(mt,ot)};pe(qt,mt=>{o(ge).classification.group&&mt(wt)})}se(()=>te(Nt,o(ge).classification.action)),C(Ge,gt)},Re=Ge=>{var gt=Rk();C(Ge,gt)};pe(vt,Ge=>{o(ge).success?Ge(Le):Ge(Re,!1)})}var qe=w(Ie,2),Oe=_(qe),Qe=w(Oe);{var ct=Ge=>{var gt=Dk(),ut=w(We(gt),1,!0);se(Nt=>te(ut,Nt),[()=>i(o(ge).email.date)]),C(Ge,gt)};pe(Qe,Ge=>{o(ge).email.date&&Ge(ct)})}var Je=w(qe,2);{var st=Ge=>{var gt=Bk(),ut=We(gt);{var Nt=ot=>{var ze=Lk(),Mt=_(ze);se(()=>te(Mt,o(ge).classification.summary)),C(ot,ze)};pe(ut,ot=>{o(ge).classification.summary&&ot(Nt)})}var qt=w(ut,2);{var wt=ot=>{var ze=zk(),Mt=_(ze),Rt=w(Mt,2),zt=w(Rt,2);se((Ne,Gt)=>{te(Mt,`${Ne??""} `),te(Rt,` ${(o(ge).stats.inputTokens||0)??""} in + ${(o(ge).stats.numTokens||0)??""} out `),te(zt,` ${Gt??""}`)},[()=>o(ge).stats.tps?`${o(ge).stats.tps.toFixed(0)} tok/s`:"â",()=>r(o(ge).stats.elapsed)]),C(ot,ze)};pe(qt,ot=>{o(ge).stats&&ot(wt)})}var mt=w(qt,2);{var yt=ot=>{var ze=jk(),Mt=w(_(ze),2),Rt=_(Mt);se(()=>te(Rt,o(ge).rawResponse)),C(ot,ze)};pe(mt,ot=>{o(ge).rawResponse&&ot(yt)})}C(Ge,gt)},nt=Ge=>{var gt=qk(),ut=_(gt);se(()=>te(ut,o(ge).error)),C(Ge,gt)};pe(Je,Ge=>{o(ge).success?Ge(st):Ge(nt,!1)})}se(Ge=>{be=It(Te,1,"email-item svelte-t1ig66",null,be,{failed:!o(ge).success}),te(ft,o(ge).email.subject||"(no subject)"),te(Oe,Ge)},[()=>s(o(ge).email.from)]),C(_e,Te)}),se(()=>te(Y,n().results.length)),C(ne,H)};pe(P,ne=>{var H;((H=n().results)==null?void 0:H.length)>0&&ne(O)})}var I=w(P,2);{var Q=ne=>{var H=Gk(),U=_(H),le=_(U),Y=_(le),ue=w(le,4),_e=_(ue),ge=w(ue,2);{var re=Re=>{var qe=Hk(),Oe=w(We(qe)),Qe=_(Oe);se(()=>te(Qe,`${n().errors??""} errors`)),C(Re,qe)};pe(ge,Re=>{n().errors>0&&Re(re)})}var Te=w(ge,2);{var be=Re=>{var qe=Vk(),Oe=w(We(qe)),Qe=_(Oe);se(()=>te(Qe,`${n().summary.skipped??""} skipped`)),C(Re,qe)};pe(Te,Re=>{var qe;(qe=n().summary)!=null&&qe.skipped&&Re(be)})}var Ie=w(U,2),Ke=_(Ie);{var Xe=Re=>{var qe=Uk(),Oe=We(qe);se(()=>te(Oe,`Avg ${n().summary.avgTps??""} tok/s`)),C(Re,qe)};pe(Ke,Re=>{var qe;(qe=n().summary)!=null&&qe.avgTps&&Re(Xe)})}var ft=w(Ke),vt=w(ft,2),Le=w(vt,2);se((Re,qe,Oe)=>{var Qe,ct;te(Y,`${(((Qe=n().summary)==null?void 0:Qe.processed)||n().total||0)??""} processed`),te(_e,`${(n().classified||0)??""} classified`),te(ft,` ${Re??""} in + ${qe??""} out `),te(vt,` ${Oe??""} `),te(Le,` Model: ${(((ct=n().summary)==null?void 0:ct.modelName)||"Unknown")??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),C(ne,H)};pe(I,ne=>{o(u)&&n().totals&&ne(Q)})}var W=w(I,2),Z=_(W);{var j=ne=>{var H=Wk(),U=We(H);U.__click=function(...Y){var ue;(ue=e.oninspect)==null||ue.apply(this,Y)};var le=w(U,2);le.__click=function(...Y){var ue;(ue=e.onclose)==null||ue.apply(this,Y)},C(ne,H)},ee=ne=>{var H=Yk(),U=We(H);U.__click=function(...Y){var ue;(ue=e.oninspect)==null||ue.apply(this,Y)};var le=w(U,2);le.__click=function(...Y){var ue;(ue=e.onstop)==null||ue.apply(this,Y)},C(ne,H)};pe(Z,ne=>{o(u)?ne(j):ne(ee,!1)})}se(()=>{te(z,`${o(l)??""}%`),J=It(N,1,"bar-fill svelte-t1ig66",null,J,{done:o(u)}),ae=Lt(N,"",ae,{width:`${o(l)??""}%`})}),C(h,m)};pe(v,h=>{n()&&h(p)})}C(t,f),tt()}Jt(["click"]);var Qk=F('<span class="spinner svelte-ois7em"></span>'),Jk=yn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),$k=F('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),e2=F("<option> </option>"),t2=F('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),n2=F('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function r2(t,e){et(e,!0);let n=Ae(e,"engineStatus",3,"idle"),r=Ae(e,"modelName",3,""),a=Ae(e,"isScanning",3,!1),s=Ae(e,"scanProgress",3,null),i=Ae(e,"scanCount",15,20),l=Ae(e,"stats",3,null);const u=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function f(){return n()==="ready"?`${r()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function v(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function p(){return n()==="ready"&&!a()}let h=$(()=>{var H;return a()&&((H=s())==null?void 0:H.phase)!=="done"});var m=n2(),x=_(m),k=_(x),A=_(k);{var D=H=>{var U=Qk();C(H,U)},q=H=>{var U=Jk();C(H,U)};pe(A,H=>{o(h)?H(D):H(q,!1)})}var G=w(k,2),S=_(G),z=w(_(S),2);z.__click=function(...H){var U;(U=e.oninspect)==null||U.apply(this,H)};var L=w(S,2),N=_(L);let J;var ae=w(N),ke=w(x,2);{var X=H=>{var U=$k(),le=_(U),Y=_(le),ue=w(le,4),_e=_(ue),ge=w(ue,4),re=_(ge);se(()=>{te(Y,`${l().totalEmails??""} emails in storage`),te(_e,`${l().classified??""} classified`),te(re,`${l().unclassified??""} new`)}),C(H,U)};pe(ke,H=>{l()&&H(X)})}var T=w(ke,2),K=_(T),P=w(_(K),2);Tt(P,21,()=>u,Ut,(H,U)=>{var le=e2(),Y=_(le),ue={};se(()=>{te(Y,o(U).label),ue!==(ue=o(U).value)&&(le.value=(le.__value=o(U).value)??"")}),C(H,le)});var O=w(K,2),I=_(O);I.__click=function(...H){var U;(U=e.onscan)==null||U.apply(this,H)};var Q=_(I),W=w(I,2);W.__click=function(...H){var U;(U=e.onrescan)==null||U.apply(this,H)};var Z=w(T,2);{var j=H=>{var U=t2();C(H,U)};pe(Z,H=>{n()!=="ready"&&n()!=="loading"&&H(j)})}var ee=w(Z,2);{var ne=H=>{Zk(H,{get progress(){return s()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};pe(ee,H=>{var U;(a()||((U=s())==null?void 0:U.phase)==="done")&&H(ne)})}se((H,U,le,Y)=>{J=Lt(N,"",J,H),te(ae,` ${U??""}`),P.disabled=a(),I.disabled=le,te(Q,o(h)?"Scanning...":a()?"Finalizing...":"Scan New"),W.disabled=Y},[()=>({background:v()}),f,()=>!p(),()=>!p()]),po(P,i),C(t,m),tt()}Jt(["click"]);var a2=F('<span class="row-date svelte-1czytqk"> </span>'),s2=F('<span class="tag svelte-1czytqk"> </span>'),i2=F('<span class="row-tags svelte-1czytqk"></span>'),o2=F('<span class="row-reason svelte-1czytqk"> </span>'),l2=F('<button class="icon-btn exec-btn svelte-1czytqk" title="Execute actions"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>'),c2=F('<!> <button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),u2=F('<span class="status-label svelte-1czytqk"> </span>'),d2=F('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),f2=F('<p class="summary-reason svelte-1czytqk"> </p>'),v2=F('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),h2=F('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function fv(t,e){et(e,!0);let n=Ae(e,"actionColor",3,"#666"),r=Ae(e,"dimmed",3,!1);function a(O){if(!O)return"";try{return new Date(O).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let s=$(()=>e.item.status==="pending"),i=Me(!1);var l=h2(),u=We(l);let f;var v=_(u);v.__click=()=>M(i,!o(i));let p;var h=_(v),m=_(h),x=w(h,2),k=_(x),A=_(k),D=w(k,2);{var q=O=>{var I=a2(),Q=_(I);se(W=>te(Q,W),[()=>a(e.item.date)]),C(O,I)};pe(D,O=>{e.item.date&&O(q)})}var G=w(x,2);{var S=O=>{var I=i2();Tt(I,21,()=>e.item.tags,Ut,(Q,W)=>{var Z=s2();let j;var ee=_(Z);se(ne=>{j=Lt(Z,"",j,ne),te(ee,o(W))},[()=>({background:Eb(o(W))})]),C(Q,Z)}),C(O,I)};pe(G,O=>{e.item.tags&&e.item.tags.length>0&&O(S)})}var z=w(G,2);{var L=O=>{var I=o2(),Q=_(I);se(()=>te(Q,e.item.reason)),C(O,I)};pe(z,O=>{e.item.reason&&!o(i)&&O(L)})}var N=w(v,2),J=_(N);{var ae=O=>{var I=c2(),Q=We(I);{var W=ee=>{var ne=l2();ne.__click=H=>{H.stopPropagation(),e.onexecute(e.item)},C(ee,ne)};pe(Q,ee=>{e.onexecute&&ee(W)})}var Z=w(Q,2);Z.__click=ee=>{ee.stopPropagation(),e.onmarkacted(e.item.emailId)};var j=w(Z,2);j.__click=ee=>{ee.stopPropagation(),e.ondismiss(e.item.emailId)},C(O,I)},ke=O=>{var I=u2(),Q=_(I);se(()=>te(Q,e.item.status)),C(O,I)};pe(J,O=>{o(s)?O(ae):O(ke,!1)})}var X=w(J,2);{var T=O=>{var I=d2();I.__click=Q=>{Q.stopPropagation(),e.onremove(e.item.emailId)},C(O,I)};pe(X,O=>{e.onremove&&O(T)})}var K=w(u,2);{var P=O=>{var I=v2();let Q;var W=_(I),Z=_(W),j=w(W,2);{var ee=ne=>{var H=f2(),U=_(H);se(()=>te(U,e.item.reason)),C(ne,H)};pe(j,ne=>{e.item.reason&&ne(ee)})}se(()=>{Q=Lt(I,"",Q,{"border-left-color":n()}),te(Z,e.item.summary)}),C(O,I)};pe(K,O=>{o(i)&&e.item.summary&&O(P)})}se(()=>{f=It(u,1,"email-row svelte-1czytqk",null,f,{dimmed:r()}),p=Lt(v,"",p,{"border-left-color":n()}),te(m,e.item.subject),te(A,e.item.from)}),C(t,l),tt()}Jt(["click"]);var p2=F('<span class="group-acted svelte-tl1unp"> </span>'),g2=F('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),m2=F('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),y2=F('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),_2=F('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),b2=F('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),w2=F('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function x2(t,e){et(e,!0);let n=Ae(e,"color",3,"#888");Ae(e,"count",3,0);let r=Ae(e,"items",19,()=>[]),a=Ae(e,"expanded",3,!1),s=$(()=>r().filter(L=>L.status==="pending")),i=$(()=>r().filter(L=>L.status!=="pending")),l=Me(!1);function u(L){return L.split("_").map(N=>N.charAt(0)+N.slice(1).toLowerCase()).join(" ")}var f=w2(),v=_(f);v.__click=function(...L){var N;(N=e.ontoggle)==null||N.apply(this,L)};var p=_(v);let h;var m=_(p),x=w(p,2),k=_(x),A=w(x,2);{var D=L=>{var N=p2(),J=_(N);se(()=>te(J,`${o(i).length??""} handled`)),C(L,N)};pe(A,L=>{o(i).length>0&&L(D)})}var q=w(A,4);let G;var S=w(v,2);{var z=L=>{var N=b2(),J=_(N);{var ae=Q=>{var W=g2();C(Q,W)};pe(J,Q=>{o(s).length===0&&o(i).length===0&&Q(ae)})}var ke=w(J,2);Tt(ke,17,()=>o(s),Q=>Q.emailId,(Q,W)=>{fv(Q,{get item(){return o(W)},get actionColor(){return n()},get onexecute(){return e.onexecute},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var X=w(ke,2);{var T=Q=>{var W=m2(),Z=_(W),j=_(Z),ee=w(Z,2);Tt(ee,17,()=>o(i),ne=>ne.emailId,(ne,H)=>{fv(ne,{get item(){return o(H)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),se(()=>te(j,`${o(i).length??""} handled`)),C(Q,W)};pe(X,Q=>{o(i).length>0&&Q(T)})}var K=w(X,2),P=_(K);{var O=Q=>{var W=y2();W.__click=()=>M(l,!0),C(Q,W)},I=Q=>{var W=_2(),Z=_(W),j=w(Z);j.__click=()=>M(l,!1);var ee=w(j,2);ee.__click=()=>{e.oncleargroup(),M(l,!1)},se(()=>te(Z,`Clear ${r().length??""} items? `)),C(Q,W)};pe(P,Q=>{o(l)?Q(I,!1):Q(O)})}C(L,N)};pe(S,L=>{a()&&L(z)})}se(L=>{h=Lt(p,"",h,{background:n()}),te(m,L),te(k,o(s).length),G=It(q,0,"chevron svelte-tl1unp",null,G,{open:a()})},[()=>u(e.action)]),C(t,f),tt()}Jt(["click"]);var k2=F(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),S2=F(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),E2=F(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),A2=F('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function T2(t,e){et(e,!0);let n=Ae(e,"open",15,!1),r=Ae(e,"sampleEmail",3,null),a=Me("system");function s(){return r()?Np(r()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function i(){n(!1)}function l(p){p.target===p.currentTarget&&i()}var u=ln(),f=We(u);{var v=p=>{var h=A2();h.__click=l,h.__keydown=T=>T.key==="Escape"&&i();var m=_(h),x=_(m),k=w(_(x),2);k.__click=i;var A=w(x,2),D=_(A);let q;D.__click=()=>M(a,"system");var G=w(D,2);let S;G.__click=()=>M(a,"email");var z=w(G,2);let L;z.__click=()=>M(a,"config");var N=w(A,2),J=_(N);{var ae=T=>{var K=k2(),P=w(We(K),2),O=_(P);se(()=>te(O,Ip)),C(T,K)},ke=T=>{var K=S2(),P=w(We(K),2),O=w(_(P),2);O.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var I=w(P,2),Q=w(_(I),2),W=_(Q);se(Z=>te(W,Z),[s]),C(T,K)},X=T=>{var K=E2(),P=w(We(K),2),O=_(P),I=w(_(O),2),Q=_(I),W=w(O,2),Z=w(_(W),2),j=_(Z),ee=w(W,2),ne=w(_(ee),2),H=_(ne),U=w(P,4);U.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,se(()=>{te(Q,wb.maxTokens),te(j,"false"),te(H,"false")}),C(T,K)};pe(J,T=>{o(a)==="system"?T(ae):o(a)==="email"?T(ke,1):o(a)==="config"&&T(X,2)})}se(()=>{q=It(D,1,"tab svelte-10pcy9j",null,q,{active:o(a)==="system"}),S=It(G,1,"tab svelte-10pcy9j",null,S,{active:o(a)==="email"}),L=It(z,1,"tab svelte-10pcy9j",null,L,{active:o(a)==="config"})}),C(p,h)};pe(f,p=>{n()&&p(v)})}C(t,u),tt()}Jt(["click","keydown"]);var C2={value:()=>{}};function Zl(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new il(n)}function il(t){this._=t}function I2(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}il.prototype=Zl.prototype={constructor:il,on:function(t,e){var n=this._,r=I2(t+"",n),a,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((a=(t=r[s]).type)&&(a=P2(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<i;)if(a=(t=r[s]).type)n[a]=vv(n[a],t.name,e);else if(e==null)for(a in n)n[a]=vv(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new il(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,s;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,a=s.length;r<a;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,s=r.length;a<s;++a)r[a].value.apply(e,n)}};function P2(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function vv(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=C2,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Nu="http://www.w3.org/1999/xhtml";const hv={svg:"http://www.w3.org/2000/svg",xhtml:Nu,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ql(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),hv.hasOwnProperty(e)?{space:hv[e],local:t}:t}function M2(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Nu&&e.documentElement.namespaceURI===Nu?e.createElement(t):e.createElementNS(n,t)}}function O2(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function og(t){var e=Ql(t);return(e.local?O2:M2)(e)}function N2(){}function Pd(t){return t==null?N2:function(){return this.querySelector(t)}}function R2(t){typeof t!="function"&&(t=Pd(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=new Array(i),u,f,v=0;v<i;++v)(u=s[v])&&(f=t.call(u,u.__data__,v,s))&&("__data__"in u&&(f.__data__=u.__data__),l[v]=f);return new cr(r,this._parents)}function D2(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function L2(){return[]}function lg(t){return t==null?L2:function(){return this.querySelectorAll(t)}}function z2(t){return function(){return D2(t.apply(this,arguments))}}function j2(t){typeof t=="function"?t=z2(t):t=lg(t);for(var e=this._groups,n=e.length,r=[],a=[],s=0;s<n;++s)for(var i=e[s],l=i.length,u,f=0;f<l;++f)(u=i[f])&&(r.push(t.call(u,u.__data__,f,i)),a.push(u));return new cr(r,a)}function cg(t){return function(){return this.matches(t)}}function ug(t){return function(e){return e.matches(t)}}var B2=Array.prototype.find;function q2(t){return function(){return B2.call(this.children,t)}}function F2(){return this.firstElementChild}function K2(t){return this.select(t==null?F2:q2(typeof t=="function"?t:ug(t)))}var H2=Array.prototype.filter;function V2(){return Array.from(this.children)}function U2(t){return function(){return H2.call(this.children,t)}}function G2(t){return this.selectAll(t==null?V2:U2(typeof t=="function"?t:ug(t)))}function W2(t){typeof t!="function"&&(t=cg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],u,f=0;f<i;++f)(u=s[f])&&t.call(u,u.__data__,f,s)&&l.push(u);return new cr(r,this._parents)}function dg(t){return new Array(t.length)}function Y2(){return new cr(this._enter||this._groups.map(dg),this._parents)}function bl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}bl.prototype={constructor:bl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function X2(t){return function(){return t}}function Z2(t,e,n,r,a,s){for(var i=0,l,u=e.length,f=s.length;i<f;++i)(l=e[i])?(l.__data__=s[i],r[i]=l):n[i]=new bl(t,s[i]);for(;i<u;++i)(l=e[i])&&(a[i]=l)}function Q2(t,e,n,r,a,s,i){var l,u,f=new Map,v=e.length,p=s.length,h=new Array(v),m;for(l=0;l<v;++l)(u=e[l])&&(h[l]=m=i.call(u,u.__data__,l,e)+"",f.has(m)?a[l]=u:f.set(m,u));for(l=0;l<p;++l)m=i.call(t,s[l],l,s)+"",(u=f.get(m))?(r[l]=u,u.__data__=s[l],f.delete(m)):n[l]=new bl(t,s[l]);for(l=0;l<v;++l)(u=e[l])&&f.get(h[l])===u&&(a[l]=u)}function J2(t){return t.__data__}function $2(t,e){if(!arguments.length)return Array.from(this,J2);var n=e?Q2:Z2,r=this._parents,a=this._groups;typeof t!="function"&&(t=X2(t));for(var s=a.length,i=new Array(s),l=new Array(s),u=new Array(s),f=0;f<s;++f){var v=r[f],p=a[f],h=p.length,m=eS(t.call(v,v&&v.__data__,f,r)),x=m.length,k=l[f]=new Array(x),A=i[f]=new Array(x),D=u[f]=new Array(h);n(v,p,k,A,D,m,e);for(var q=0,G=0,S,z;q<x;++q)if(S=k[q]){for(q>=G&&(G=q+1);!(z=A[G])&&++G<x;);S._next=z||null}}return i=new cr(i,r),i._enter=l,i._exit=u,i}function eS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function tS(){return new cr(this._exit||this._groups.map(dg),this._parents)}function nS(t,e,n){var r=this.enter(),a=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?s.remove():n(s),r&&a?r.merge(a).order():a}function rS(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,s=r.length,i=Math.min(a,s),l=new Array(a),u=0;u<i;++u)for(var f=n[u],v=r[u],p=f.length,h=l[u]=new Array(p),m,x=0;x<p;++x)(m=f[x]||v[x])&&(h[x]=m);for(;u<a;++u)l[u]=n[u];return new cr(l,this._parents)}function aS(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,s=r[a],i;--a>=0;)(i=r[a])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function sS(t){t||(t=iS);function e(p,h){return p&&h?t(p.__data__,h.__data__):!p-!h}for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s){for(var i=n[s],l=i.length,u=a[s]=new Array(l),f,v=0;v<l;++v)(f=i[v])&&(u[v]=f);u.sort(e)}return new cr(a,this._parents).order()}function iS(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function oS(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function lS(){return Array.from(this)}function cS(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length;a<s;++a){var i=r[a];if(i)return i}return null}function uS(){let t=0;for(const e of this)++t;return t}function dS(){return!this.node()}function fS(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],s=0,i=a.length,l;s<i;++s)(l=a[s])&&t.call(l,l.__data__,s,a);return this}function vS(t){return function(){this.removeAttribute(t)}}function hS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pS(t,e){return function(){this.setAttribute(t,e)}}function gS(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function mS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function yS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function _S(t,e){var n=Ql(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?hS:vS:typeof e=="function"?n.local?yS:mS:n.local?gS:pS)(n,e))}function fg(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function bS(t){return function(){this.style.removeProperty(t)}}function wS(t,e,n){return function(){this.style.setProperty(t,e,n)}}function xS(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function kS(t,e,n){return arguments.length>1?this.each((e==null?bS:typeof e=="function"?xS:wS)(t,e,n??"")):ti(this.node(),t)}function ti(t,e){return t.style.getPropertyValue(e)||fg(t).getComputedStyle(t,null).getPropertyValue(e)}function SS(t){return function(){delete this[t]}}function ES(t,e){return function(){this[t]=e}}function AS(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function TS(t,e){return arguments.length>1?this.each((e==null?SS:typeof e=="function"?AS:ES)(t,e)):this.node()[t]}function vg(t){return t.trim().split(/^|\s+/)}function Md(t){return t.classList||new hg(t)}function hg(t){this._node=t,this._names=vg(t.getAttribute("class")||"")}hg.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function pg(t,e){for(var n=Md(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function gg(t,e){for(var n=Md(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function CS(t){return function(){pg(this,t)}}function IS(t){return function(){gg(this,t)}}function PS(t,e){return function(){(e.apply(this,arguments)?pg:gg)(this,t)}}function MS(t,e){var n=vg(t+"");if(arguments.length<2){for(var r=Md(this.node()),a=-1,s=n.length;++a<s;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?PS:e?CS:IS)(n,e))}function OS(){this.textContent=""}function NS(t){return function(){this.textContent=t}}function RS(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function DS(t){return arguments.length?this.each(t==null?OS:(typeof t=="function"?RS:NS)(t)):this.node().textContent}function LS(){this.innerHTML=""}function zS(t){return function(){this.innerHTML=t}}function jS(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function BS(t){return arguments.length?this.each(t==null?LS:(typeof t=="function"?jS:zS)(t)):this.node().innerHTML}function qS(){this.nextSibling&&this.parentNode.appendChild(this)}function FS(){return this.each(qS)}function KS(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function HS(){return this.each(KS)}function VS(t){var e=typeof t=="function"?t:og(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function US(){return null}function GS(t,e){var n=typeof t=="function"?t:og(t),r=e==null?US:typeof e=="function"?e:Pd(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function WS(){var t=this.parentNode;t&&t.removeChild(this)}function YS(){return this.each(WS)}function XS(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ZS(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function QS(t){return this.select(t?ZS:XS)}function JS(t){return arguments.length?this.property("__data__",t):this.node().__data__}function $S(t){return function(e){t.call(this,e,this.__data__)}}function eE(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function tE(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,s;n<a;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function nE(t,e,n){return function(){var r=this.__on,a,s=$S(e);if(r){for(var i=0,l=r.length;i<l;++i)if((a=r[i]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=s,a.options=n),a.value=e;return}}this.addEventListener(t.type,s,n),a={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(a):this.__on=[a]}}function rE(t,e,n){var r=eE(t+""),a,s=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,f=l.length,v;u<f;++u)for(a=0,v=l[u];a<s;++a)if((i=r[a]).type===v.type&&i.name===v.name)return v.value}return}for(l=e?nE:tE,a=0;a<s;++a)this.each(l(r[a],e,n));return this}function mg(t,e,n){var r=fg(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function aE(t,e){return function(){return mg(this,t,e)}}function sE(t,e){return function(){return mg(this,t,e.apply(this,arguments))}}function iE(t,e){return this.each((typeof e=="function"?sE:aE)(t,e))}function*oE(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length,i;a<s;++a)(i=r[a])&&(yield i)}var yg=[null];function cr(t,e){this._groups=t,this._parents=e}function yo(){return new cr([[document.documentElement]],yg)}function lE(){return this}cr.prototype=yo.prototype={constructor:cr,select:R2,selectAll:j2,selectChild:K2,selectChildren:G2,filter:W2,data:$2,enter:Y2,exit:tS,join:nS,merge:rS,selection:lE,order:aS,sort:sS,call:oS,nodes:lS,node:cS,size:uS,empty:dS,each:fS,attr:_S,style:kS,property:TS,classed:MS,text:DS,html:BS,raise:FS,lower:HS,append:VS,insert:GS,remove:YS,clone:QS,datum:JS,on:rE,dispatch:iE,[Symbol.iterator]:oE};function Tr(t){return typeof t=="string"?new cr([[document.querySelector(t)]],[document.documentElement]):new cr([[t]],yg)}function cE(t){let e;for(;e=t.sourceEvent;)t=e;return t}function qr(t,e){if(t=cE(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const uE={passive:!1},Wi={capture:!0,passive:!1};function Gc(t){t.stopImmediatePropagation()}function js(t){t.preventDefault(),t.stopImmediatePropagation()}function _g(t){var e=t.document.documentElement,n=Tr(t).on("dragstart.drag",js,Wi);"onselectstart"in e?n.on("selectstart.drag",js,Wi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function bg(t,e){var n=t.document.documentElement,r=Tr(t).on("dragstart.drag",null);e&&(r.on("click.drag",js,Wi),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Uo=t=>()=>t;function Ru(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:s,x:i,y:l,dx:u,dy:f,dispatch:v}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:v}})}Ru.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function dE(t){return!t.ctrlKey&&!t.button}function fE(){return this.parentNode}function vE(t,e){return e??{x:t.x,y:t.y}}function hE(){return navigator.maxTouchPoints||"ontouchstart"in this}function pE(){var t=dE,e=fE,n=vE,r=hE,a={},s=Zl("start","drag","end"),i=0,l,u,f,v,p=0;function h(S){S.on("mousedown.drag",m).filter(r).on("touchstart.drag",A).on("touchmove.drag",D,uE).on("touchend.drag touchcancel.drag",q).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(S,z){if(!(v||!t.call(this,S,z))){var L=G(this,e.call(this,S,z),S,z,"mouse");L&&(Tr(S.view).on("mousemove.drag",x,Wi).on("mouseup.drag",k,Wi),_g(S.view),Gc(S),f=!1,l=S.clientX,u=S.clientY,L("start",S))}}function x(S){if(js(S),!f){var z=S.clientX-l,L=S.clientY-u;f=z*z+L*L>p}a.mouse("drag",S)}function k(S){Tr(S.view).on("mousemove.drag mouseup.drag",null),bg(S.view,f),js(S),a.mouse("end",S)}function A(S,z){if(t.call(this,S,z)){var L=S.changedTouches,N=e.call(this,S,z),J=L.length,ae,ke;for(ae=0;ae<J;++ae)(ke=G(this,N,S,z,L[ae].identifier,L[ae]))&&(Gc(S),ke("start",S,L[ae]))}}function D(S){var z=S.changedTouches,L=z.length,N,J;for(N=0;N<L;++N)(J=a[z[N].identifier])&&(js(S),J("drag",S,z[N]))}function q(S){var z=S.changedTouches,L=z.length,N,J;for(v&&clearTimeout(v),v=setTimeout(function(){v=null},500),N=0;N<L;++N)(J=a[z[N].identifier])&&(Gc(S),J("end",S,z[N]))}function G(S,z,L,N,J,ae){var ke=s.copy(),X=qr(ae||L,z),T,K,P;if((P=n.call(S,new Ru("beforestart",{sourceEvent:L,target:h,identifier:J,active:i,x:X[0],y:X[1],dx:0,dy:0,dispatch:ke}),N))!=null)return T=P.x-X[0]||0,K=P.y-X[1]||0,function O(I,Q,W){var Z=X,j;switch(I){case"start":a[J]=O,j=i++;break;case"end":delete a[J],--i;case"drag":X=qr(W||Q,z),j=i;break}ke.call(I,S,new Ru(I,{sourceEvent:Q,subject:P,target:h,identifier:J,active:j,x:X[0]+T,y:X[1]+K,dx:X[0]-Z[0],dy:X[1]-Z[1],dispatch:ke}),N)}}return h.filter=function(S){return arguments.length?(t=typeof S=="function"?S:Uo(!!S),h):t},h.container=function(S){return arguments.length?(e=typeof S=="function"?S:Uo(S),h):e},h.subject=function(S){return arguments.length?(n=typeof S=="function"?S:Uo(S),h):n},h.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:Uo(!!S),h):r},h.on=function(){var S=s.on.apply(s,arguments);return S===s?h:S},h.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,h):Math.sqrt(p)},h}function Od(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function wg(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function _o(){}var Yi=.7,wl=1/Yi,Bs="\\s*([+-]?\\d+)\\s*",Xi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Zr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gE=/^#([0-9a-f]{3,8})$/,mE=new RegExp(`^rgb\\(${Bs},${Bs},${Bs}\\)$`),yE=new RegExp(`^rgb\\(${Zr},${Zr},${Zr}\\)$`),_E=new RegExp(`^rgba\\(${Bs},${Bs},${Bs},${Xi}\\)$`),bE=new RegExp(`^rgba\\(${Zr},${Zr},${Zr},${Xi}\\)$`),wE=new RegExp(`^hsl\\(${Xi},${Zr},${Zr}\\)$`),xE=new RegExp(`^hsla\\(${Xi},${Zr},${Zr},${Xi}\\)$`),pv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Od(_o,gs,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:gv,formatHex:gv,formatHex8:kE,formatHsl:SE,formatRgb:mv,toString:mv});function gv(){return this.rgb().formatHex()}function kE(){return this.rgb().formatHex8()}function SE(){return xg(this).formatHsl()}function mv(){return this.rgb().formatRgb()}function gs(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=gE.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?yv(e):n===3?new er(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Go(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Go(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=mE.exec(t))?new er(e[1],e[2],e[3],1):(e=yE.exec(t))?new er(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=_E.exec(t))?Go(e[1],e[2],e[3],e[4]):(e=bE.exec(t))?Go(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=wE.exec(t))?wv(e[1],e[2]/100,e[3]/100,1):(e=xE.exec(t))?wv(e[1],e[2]/100,e[3]/100,e[4]):pv.hasOwnProperty(t)?yv(pv[t]):t==="transparent"?new er(NaN,NaN,NaN,0):null}function yv(t){return new er(t>>16&255,t>>8&255,t&255,1)}function Go(t,e,n,r){return r<=0&&(t=e=n=NaN),new er(t,e,n,r)}function EE(t){return t instanceof _o||(t=gs(t)),t?(t=t.rgb(),new er(t.r,t.g,t.b,t.opacity)):new er}function Du(t,e,n,r){return arguments.length===1?EE(t):new er(t,e,n,r??1)}function er(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Od(er,Du,wg(_o,{brighter(t){return t=t==null?wl:Math.pow(wl,t),new er(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Yi:Math.pow(Yi,t),new er(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new er(us(this.r),us(this.g),us(this.b),xl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_v,formatHex:_v,formatHex8:AE,formatRgb:bv,toString:bv}));function _v(){return`#${ts(this.r)}${ts(this.g)}${ts(this.b)}`}function AE(){return`#${ts(this.r)}${ts(this.g)}${ts(this.b)}${ts((isNaN(this.opacity)?1:this.opacity)*255)}`}function bv(){const t=xl(this.opacity);return`${t===1?"rgb(":"rgba("}${us(this.r)}, ${us(this.g)}, ${us(this.b)}${t===1?")":`, ${t})`}`}function xl(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function us(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ts(t){return t=us(t),(t<16?"0":"")+t.toString(16)}function wv(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Cr(t,e,n,r)}function xg(t){if(t instanceof Cr)return new Cr(t.h,t.s,t.l,t.opacity);if(t instanceof _o||(t=gs(t)),!t)return new Cr;if(t instanceof Cr)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,l=s-a,u=(s+a)/2;return l?(e===s?i=(n-r)/l+(n<r)*6:n===s?i=(r-e)/l+2:i=(e-n)/l+4,l/=u<.5?s+a:2-s-a,i*=60):l=u>0&&u<1?0:i,new Cr(i,l,u,t.opacity)}function TE(t,e,n,r){return arguments.length===1?xg(t):new Cr(t,e,n,r??1)}function Cr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Od(Cr,TE,wg(_o,{brighter(t){return t=t==null?wl:Math.pow(wl,t),new Cr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yi:Math.pow(Yi,t),new Cr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new er(Wc(t>=240?t-240:t+120,a,r),Wc(t,a,r),Wc(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new Cr(xv(this.h),Wo(this.s),Wo(this.l),xl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=xl(this.opacity);return`${t===1?"hsl(":"hsla("}${xv(this.h)}, ${Wo(this.s)*100}%, ${Wo(this.l)*100}%${t===1?")":`, ${t})`}`}}));function xv(t){return t=(t||0)%360,t<0?t+360:t}function Wo(t){return Math.max(0,Math.min(1,t||0))}function Wc(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Nd=t=>()=>t;function CE(t,e){return function(n){return t+n*e}}function IE(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function PE(t){return(t=+t)==1?kg:function(e,n){return n-e?IE(e,n,t):Nd(isNaN(e)?n:e)}}function kg(t,e){var n=e-t;return n?CE(t,n):Nd(isNaN(t)?e:t)}const kl=(function t(e){var n=PE(e);function r(a,s){var i=n((a=Du(a)).r,(s=Du(s)).r),l=n(a.g,s.g),u=n(a.b,s.b),f=kg(a.opacity,s.opacity);return function(v){return a.r=i(v),a.g=l(v),a.b=u(v),a.opacity=f(v),a+""}}return r.gamma=t,r})(1);function ME(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function OE(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function NE(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=Fi(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(l){for(i=0;i<r;++i)s[i]=a[i](l);return s}}function RE(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ur(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function DE(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Fi(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var Lu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Yc=new RegExp(Lu.source,"g");function LE(t){return function(){return t}}function zE(t){return function(e){return t(e)+""}}function Sg(t,e){var n=Lu.lastIndex=Yc.lastIndex=0,r,a,s,i=-1,l=[],u=[];for(t=t+"",e=e+"";(r=Lu.exec(t))&&(a=Yc.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),l[i]?l[i]+=s:l[++i]=s),(r=r[0])===(a=a[0])?l[i]?l[i]+=a:l[++i]=a:(l[++i]=null,u.push({i,x:Ur(r,a)})),n=Yc.lastIndex;return n<e.length&&(s=e.slice(n),l[i]?l[i]+=s:l[++i]=s),l.length<2?u[0]?zE(u[0].x):LE(e):(e=u.length,function(f){for(var v=0,p;v<e;++v)l[(p=u[v]).i]=p.x(f);return l.join("")})}function Fi(t,e){var n=typeof e,r;return e==null||n==="boolean"?Nd(e):(n==="number"?Ur:n==="string"?(r=gs(e))?(e=r,kl):Sg:e instanceof gs?kl:e instanceof Date?RE:OE(e)?ME:Array.isArray(e)?NE:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?DE:Ur)(t,e)}var kv=180/Math.PI,zu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Eg(t,e,n,r,a,s){var i,l,u;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,i=-i),{translateX:a,translateY:s,rotate:Math.atan2(e,t)*kv,skewX:Math.atan(u)*kv,scaleX:i,scaleY:l}}var Yo;function jE(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?zu:Eg(e.a,e.b,e.c,e.d,e.e,e.f)}function BE(t){return t==null||(Yo||(Yo=document.createElementNS("http://www.w3.org/2000/svg","g")),Yo.setAttribute("transform",t),!(t=Yo.transform.baseVal.consolidate()))?zu:(t=t.matrix,Eg(t.a,t.b,t.c,t.d,t.e,t.f))}function Ag(t,e,n,r){function a(f){return f.length?f.pop()+" ":""}function s(f,v,p,h,m,x){if(f!==p||v!==h){var k=m.push("translate(",null,e,null,n);x.push({i:k-4,x:Ur(f,p)},{i:k-2,x:Ur(v,h)})}else(p||h)&&m.push("translate("+p+e+h+n)}function i(f,v,p,h){f!==v?(f-v>180?v+=360:v-f>180&&(f+=360),h.push({i:p.push(a(p)+"rotate(",null,r)-2,x:Ur(f,v)})):v&&p.push(a(p)+"rotate("+v+r)}function l(f,v,p,h){f!==v?h.push({i:p.push(a(p)+"skewX(",null,r)-2,x:Ur(f,v)}):v&&p.push(a(p)+"skewX("+v+r)}function u(f,v,p,h,m,x){if(f!==p||v!==h){var k=m.push(a(m)+"scale(",null,",",null,")");x.push({i:k-4,x:Ur(f,p)},{i:k-2,x:Ur(v,h)})}else(p!==1||h!==1)&&m.push(a(m)+"scale("+p+","+h+")")}return function(f,v){var p=[],h=[];return f=t(f),v=t(v),s(f.translateX,f.translateY,v.translateX,v.translateY,p,h),i(f.rotate,v.rotate,p,h),l(f.skewX,v.skewX,p,h),u(f.scaleX,f.scaleY,v.scaleX,v.scaleY,p,h),f=v=null,function(m){for(var x=-1,k=h.length,A;++x<k;)p[(A=h[x]).i]=A.x(m);return p.join("")}}}var qE=Ag(jE,"px, ","px)","deg)"),FE=Ag(BE,", ",")",")"),KE=1e-12;function Sv(t){return((t=Math.exp(t))+1/t)/2}function HE(t){return((t=Math.exp(t))-1/t)/2}function VE(t){return((t=Math.exp(2*t))-1)/(t+1)}const ol=(function t(e,n,r){function a(s,i){var l=s[0],u=s[1],f=s[2],v=i[0],p=i[1],h=i[2],m=v-l,x=p-u,k=m*m+x*x,A,D;if(k<KE)D=Math.log(h/f)/e,A=function(N){return[l+N*m,u+N*x,f*Math.exp(e*N*D)]};else{var q=Math.sqrt(k),G=(h*h-f*f+r*k)/(2*f*n*q),S=(h*h-f*f-r*k)/(2*h*n*q),z=Math.log(Math.sqrt(G*G+1)-G),L=Math.log(Math.sqrt(S*S+1)-S);D=(L-z)/e,A=function(N){var J=N*D,ae=Sv(z),ke=f/(n*q)*(ae*VE(e*J+z)-HE(z));return[l+ke*m,u+ke*x,f*ae/Sv(e*J+z)]}}return A.duration=D*1e3*e/Math.SQRT2,A}return a.rho=function(s){var i=Math.max(.001,+s),l=i*i,u=l*l;return t(i,l,u)},a})(Math.SQRT2,2,4);var ni=0,Ri=0,Pi=0,Tg=1e3,Sl,Di,El=0,ms=0,Jl=0,Zi=typeof performance=="object"&&performance.now?performance:Date,Cg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Rd(){return ms||(Cg(UE),ms=Zi.now()+Jl)}function UE(){ms=0}function Al(){this._call=this._time=this._next=null}Al.prototype=Ig.prototype={constructor:Al,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Rd():+n)+(e==null?0:+e),!this._next&&Di!==this&&(Di?Di._next=this:Sl=this,Di=this),this._call=t,this._time=n,ju()},stop:function(){this._call&&(this._call=null,this._time=1/0,ju())}};function Ig(t,e,n){var r=new Al;return r.restart(t,e,n),r}function GE(){Rd(),++ni;for(var t=Sl,e;t;)(e=ms-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ni}function Ev(){ms=(El=Zi.now())+Jl,ni=Ri=0;try{GE()}finally{ni=0,YE(),ms=0}}function WE(){var t=Zi.now(),e=t-El;e>Tg&&(Jl-=e,El=t)}function YE(){for(var t,e=Sl,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Sl=n);Di=t,ju(r)}function ju(t){if(!ni){Ri&&(Ri=clearTimeout(Ri));var e=t-ms;e>24?(t<1/0&&(Ri=setTimeout(Ev,t-Zi.now()-Jl)),Pi&&(Pi=clearInterval(Pi))):(Pi||(El=Zi.now(),Pi=setInterval(WE,Tg)),ni=1,Cg(Ev))}}function Av(t,e,n){var r=new Al;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var XE=Zl("start","end","cancel","interrupt"),ZE=[],Pg=0,Tv=1,Bu=2,ll=3,Cv=4,qu=5,cl=6;function $l(t,e,n,r,a,s){var i=t.__transition;if(!i)t.__transition={};else if(n in i)return;QE(t,n,{name:e,index:r,group:a,on:XE,tween:ZE,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Pg})}function Dd(t,e){var n=Dr(t,e);if(n.state>Pg)throw new Error("too late; already scheduled");return n}function ta(t,e){var n=Dr(t,e);if(n.state>ll)throw new Error("too late; already running");return n}function Dr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function QE(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Ig(s,0,n.time);function s(f){n.state=Tv,n.timer.restart(i,n.delay,n.time),n.delay<=f&&i(f-n.delay)}function i(f){var v,p,h,m;if(n.state!==Tv)return u();for(v in r)if(m=r[v],m.name===n.name){if(m.state===ll)return Av(i);m.state===Cv?(m.state=cl,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete r[v]):+v<e&&(m.state=cl,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete r[v])}if(Av(function(){n.state===ll&&(n.state=Cv,n.timer.restart(l,n.delay,n.time),l(f))}),n.state=Bu,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Bu){for(n.state=ll,a=new Array(h=n.tween.length),v=0,p=-1;v<h;++v)(m=n.tween[v].value.call(t,t.__data__,n.index,n.group))&&(a[++p]=m);a.length=p+1}}function l(f){for(var v=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(u),n.state=qu,1),p=-1,h=a.length;++p<h;)a[p].call(t,v);n.state===qu&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=cl,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function ul(t,e){var n=t.__transition,r,a,s=!0,i;if(n){e=e==null?null:e+"";for(i in n){if((r=n[i]).name!==e){s=!1;continue}a=r.state>Bu&&r.state<qu,r.state=cl,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[i]}s&&delete t.__transition}}function JE(t){return this.each(function(){ul(this,t)})}function $E(t,e){var n,r;return function(){var a=ta(this,t),s=a.tween;if(s!==n){r=n=s;for(var i=0,l=r.length;i<l;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}a.tween=r}}function eA(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var s=ta(this,t),i=s.tween;if(i!==r){a=(r=i).slice();for(var l={name:e,value:n},u=0,f=a.length;u<f;++u)if(a[u].name===e){a[u]=l;break}u===f&&a.push(l)}s.tween=a}}function tA(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Dr(this.node(),n).tween,a=0,s=r.length,i;a<s;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((e==null?$E:eA)(n,t,e))}function Ld(t,e,n){var r=t._id;return t.each(function(){var a=ta(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return Dr(a,r).value[e]}}function Mg(t,e){var n;return(typeof e=="number"?Ur:e instanceof gs?kl:(n=gs(e))?(e=n,kl):Sg)(t,e)}function nA(t){return function(){this.removeAttribute(t)}}function rA(t){return function(){this.removeAttributeNS(t.space,t.local)}}function aA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttribute(t);return i===a?null:i===r?s:s=e(r=i,n)}}function sA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttributeNS(t.space,t.local);return i===a?null:i===r?s:s=e(r=i,n)}}function iA(t,e,n){var r,a,s;return function(){var i,l=n(this),u;return l==null?void this.removeAttribute(t):(i=this.getAttribute(t),u=l+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l)))}}function oA(t,e,n){var r,a,s;return function(){var i,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),u=l+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l)))}}function lA(t,e){var n=Ql(t),r=n==="transform"?FE:Mg;return this.attrTween(t,typeof e=="function"?(n.local?oA:iA)(n,r,Ld(this,"attr."+t,e)):e==null?(n.local?rA:nA)(n):(n.local?sA:aA)(n,r,e))}function cA(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function uA(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function dA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&uA(t,s)),n}return a._value=e,a}function fA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&cA(t,s)),n}return a._value=e,a}function vA(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ql(t);return this.tween(n,(r.local?dA:fA)(r,e))}function hA(t,e){return function(){Dd(this,t).delay=+e.apply(this,arguments)}}function pA(t,e){return e=+e,function(){Dd(this,t).delay=e}}function gA(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?hA:pA)(e,t)):Dr(this.node(),e).delay}function mA(t,e){return function(){ta(this,t).duration=+e.apply(this,arguments)}}function yA(t,e){return e=+e,function(){ta(this,t).duration=e}}function _A(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?mA:yA)(e,t)):Dr(this.node(),e).duration}function bA(t,e){if(typeof e!="function")throw new Error;return function(){ta(this,t).ease=e}}function wA(t){var e=this._id;return arguments.length?this.each(bA(e,t)):Dr(this.node(),e).ease}function xA(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ta(this,t).ease=n}}function kA(t){if(typeof t!="function")throw new Error;return this.each(xA(this._id,t))}function SA(t){typeof t!="function"&&(t=cg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],u,f=0;f<i;++f)(u=s[f])&&t.call(u,u.__data__,f,s)&&l.push(u);return new _a(r,this._parents,this._name,this._id)}function EA(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,s=Math.min(r,a),i=new Array(r),l=0;l<s;++l)for(var u=e[l],f=n[l],v=u.length,p=i[l]=new Array(v),h,m=0;m<v;++m)(h=u[m]||f[m])&&(p[m]=h);for(;l<r;++l)i[l]=e[l];return new _a(i,this._parents,this._name,this._id)}function AA(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function TA(t,e,n){var r,a,s=AA(e)?Dd:ta;return function(){var i=s(this,t),l=i.on;l!==r&&(a=(r=l).copy()).on(e,n),i.on=a}}function CA(t,e){var n=this._id;return arguments.length<2?Dr(this.node(),n).on.on(t):this.each(TA(n,t,e))}function IA(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function PA(){return this.on("end.remove",IA(this._id))}function MA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Pd(t));for(var r=this._groups,a=r.length,s=new Array(a),i=0;i<a;++i)for(var l=r[i],u=l.length,f=s[i]=new Array(u),v,p,h=0;h<u;++h)(v=l[h])&&(p=t.call(v,v.__data__,h,l))&&("__data__"in v&&(p.__data__=v.__data__),f[h]=p,$l(f[h],e,n,h,f,Dr(v,n)));return new _a(s,this._parents,e,n)}function OA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=lg(t));for(var r=this._groups,a=r.length,s=[],i=[],l=0;l<a;++l)for(var u=r[l],f=u.length,v,p=0;p<f;++p)if(v=u[p]){for(var h=t.call(v,v.__data__,p,u),m,x=Dr(v,n),k=0,A=h.length;k<A;++k)(m=h[k])&&$l(m,e,n,k,h,x);s.push(h),i.push(v)}return new _a(s,i,e,n)}var NA=yo.prototype.constructor;function RA(){return new NA(this._groups,this._parents)}function DA(t,e){var n,r,a;return function(){var s=ti(this,t),i=(this.style.removeProperty(t),ti(this,t));return s===i?null:s===n&&i===r?a:a=e(n=s,r=i)}}function Og(t){return function(){this.style.removeProperty(t)}}function LA(t,e,n){var r,a=n+"",s;return function(){var i=ti(this,t);return i===a?null:i===r?s:s=e(r=i,n)}}function zA(t,e,n){var r,a,s;return function(){var i=ti(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),ti(this,t))),i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l))}}function jA(t,e){var n,r,a,s="style."+e,i="end."+s,l;return function(){var u=ta(this,t),f=u.on,v=u.value[s]==null?l||(l=Og(e)):void 0;(f!==n||a!==v)&&(r=(n=f).copy()).on(i,a=v),u.on=r}}function BA(t,e,n){var r=(t+="")=="transform"?qE:Mg;return e==null?this.styleTween(t,DA(t,r)).on("end.style."+t,Og(t)):typeof e=="function"?this.styleTween(t,zA(t,r,Ld(this,"style."+t,e))).each(jA(this._id,t)):this.styleTween(t,LA(t,r,e),n).on("end.style."+t,null)}function qA(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function FA(t,e,n){var r,a;function s(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&qA(t,i,n)),r}return s._value=e,s}function KA(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,FA(t,e,n??""))}function HA(t){return function(){this.textContent=t}}function VA(t){return function(){var e=t(this);this.textContent=e??""}}function UA(t){return this.tween("text",typeof t=="function"?VA(Ld(this,"text",t)):HA(t==null?"":t+""))}function GA(t){return function(e){this.textContent=t.call(this,e)}}function WA(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&GA(a)),e}return r._value=t,r}function YA(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,WA(t))}function XA(){for(var t=this._name,e=this._id,n=Ng(),r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,u,f=0;f<l;++f)if(u=i[f]){var v=Dr(u,e);$l(u,t,n,f,i,{time:v.time+v.delay+v.duration,delay:0,duration:v.duration,ease:v.ease})}return new _a(r,this._parents,t,n)}function ZA(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(s,i){var l={value:i},u={value:function(){--a===0&&s()}};n.each(function(){var f=ta(this,r),v=f.on;v!==t&&(e=(t=v).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),f.on=e}),a===0&&s()})}var QA=0;function _a(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Ng(){return++QA}var sa=yo.prototype;_a.prototype={constructor:_a,select:MA,selectAll:OA,selectChild:sa.selectChild,selectChildren:sa.selectChildren,filter:SA,merge:EA,selection:RA,transition:XA,call:sa.call,nodes:sa.nodes,node:sa.node,size:sa.size,empty:sa.empty,each:sa.each,on:CA,attr:lA,attrTween:vA,style:BA,styleTween:KA,text:UA,textTween:YA,remove:PA,tween:tA,delay:gA,duration:_A,ease:wA,easeVarying:kA,end:ZA,[Symbol.iterator]:sa[Symbol.iterator]};function JA(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var $A={time:null,delay:0,duration:250,ease:JA};function eT(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function tT(t){var e,n;t instanceof _a?(e=t._id,t=t._name):(e=Ng(),(n=$A).time=Rd(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,u,f=0;f<l;++f)(u=i[f])&&$l(u,t,e,f,i,n||eT(u,e));return new _a(r,this._parents,t,e)}yo.prototype.interrupt=JE;yo.prototype.transition=tT;const Xo=t=>()=>t;function nT(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function ha(t,e,n){this.k=t,this.x=e,this.y=n}ha.prototype={constructor:ha,scale:function(t){return t===1?this:new ha(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ha(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ec=new ha(1,0,0);Rg.prototype=ha.prototype;function Rg(t){for(;!t.__zoom;)if(!(t=t.parentNode))return ec;return t.__zoom}function Xc(t){t.stopImmediatePropagation()}function Mi(t){t.preventDefault(),t.stopImmediatePropagation()}function rT(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function aT(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Iv(){return this.__zoom||ec}function sT(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function iT(){return navigator.maxTouchPoints||"ontouchstart"in this}function oT(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],i=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function lT(){var t=rT,e=aT,n=oT,r=sT,a=iT,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,u=ol,f=Zl("start","zoom","end"),v,p,h,m=500,x=150,k=0,A=10;function D(P){P.property("__zoom",Iv).on("wheel.zoom",J,{passive:!1}).on("mousedown.zoom",ae).on("dblclick.zoom",ke).filter(a).on("touchstart.zoom",X).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",K).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}D.transform=function(P,O,I,Q){var W=P.selection?P.selection():P;W.property("__zoom",Iv),P!==W?z(P,O,I,Q):W.interrupt().each(function(){L(this,arguments).event(Q).start().zoom(null,typeof O=="function"?O.apply(this,arguments):O).end()})},D.scaleBy=function(P,O,I,Q){D.scaleTo(P,function(){var W=this.__zoom.k,Z=typeof O=="function"?O.apply(this,arguments):O;return W*Z},I,Q)},D.scaleTo=function(P,O,I,Q){D.transform(P,function(){var W=e.apply(this,arguments),Z=this.__zoom,j=I==null?S(W):typeof I=="function"?I.apply(this,arguments):I,ee=Z.invert(j),ne=typeof O=="function"?O.apply(this,arguments):O;return n(G(q(Z,ne),j,ee),W,i)},I,Q)},D.translateBy=function(P,O,I,Q){D.transform(P,function(){return n(this.__zoom.translate(typeof O=="function"?O.apply(this,arguments):O,typeof I=="function"?I.apply(this,arguments):I),e.apply(this,arguments),i)},null,Q)},D.translateTo=function(P,O,I,Q,W){D.transform(P,function(){var Z=e.apply(this,arguments),j=this.__zoom,ee=Q==null?S(Z):typeof Q=="function"?Q.apply(this,arguments):Q;return n(ec.translate(ee[0],ee[1]).scale(j.k).translate(typeof O=="function"?-O.apply(this,arguments):-O,typeof I=="function"?-I.apply(this,arguments):-I),Z,i)},Q,W)};function q(P,O){return O=Math.max(s[0],Math.min(s[1],O)),O===P.k?P:new ha(O,P.x,P.y)}function G(P,O,I){var Q=O[0]-I[0]*P.k,W=O[1]-I[1]*P.k;return Q===P.x&&W===P.y?P:new ha(P.k,Q,W)}function S(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function z(P,O,I,Q){P.on("start.zoom",function(){L(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){L(this,arguments).event(Q).end()}).tween("zoom",function(){var W=this,Z=arguments,j=L(W,Z).event(Q),ee=e.apply(W,Z),ne=I==null?S(ee):typeof I=="function"?I.apply(W,Z):I,H=Math.max(ee[1][0]-ee[0][0],ee[1][1]-ee[0][1]),U=W.__zoom,le=typeof O=="function"?O.apply(W,Z):O,Y=u(U.invert(ne).concat(H/U.k),le.invert(ne).concat(H/le.k));return function(ue){if(ue===1)ue=le;else{var _e=Y(ue),ge=H/_e[2];ue=new ha(ge,ne[0]-_e[0]*ge,ne[1]-_e[1]*ge)}j.zoom(null,ue)}})}function L(P,O,I){return!I&&P.__zooming||new N(P,O)}function N(P,O){this.that=P,this.args=O,this.active=0,this.sourceEvent=null,this.extent=e.apply(P,O),this.taps=0}N.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,O){return this.mouse&&P!=="mouse"&&(this.mouse[1]=O.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=O.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=O.invert(this.touch1[0])),this.that.__zoom=O,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var O=Tr(this.that).datum();f.call(P,this.that,new nT(P,{sourceEvent:this.sourceEvent,target:D,transform:this.that.__zoom,dispatch:f}),O)}};function J(P,...O){if(!t.apply(this,arguments))return;var I=L(this,O).event(P),Q=this.__zoom,W=Math.max(s[0],Math.min(s[1],Q.k*Math.pow(2,r.apply(this,arguments)))),Z=qr(P);if(I.wheel)(I.mouse[0][0]!==Z[0]||I.mouse[0][1]!==Z[1])&&(I.mouse[1]=Q.invert(I.mouse[0]=Z)),clearTimeout(I.wheel);else{if(Q.k===W)return;I.mouse=[Z,Q.invert(Z)],ul(this),I.start()}Mi(P),I.wheel=setTimeout(j,x),I.zoom("mouse",n(G(q(Q,W),I.mouse[0],I.mouse[1]),I.extent,i));function j(){I.wheel=null,I.end()}}function ae(P,...O){if(h||!t.apply(this,arguments))return;var I=P.currentTarget,Q=L(this,O,!0).event(P),W=Tr(P.view).on("mousemove.zoom",ne,!0).on("mouseup.zoom",H,!0),Z=qr(P,I),j=P.clientX,ee=P.clientY;_g(P.view),Xc(P),Q.mouse=[Z,this.__zoom.invert(Z)],ul(this),Q.start();function ne(U){if(Mi(U),!Q.moved){var le=U.clientX-j,Y=U.clientY-ee;Q.moved=le*le+Y*Y>k}Q.event(U).zoom("mouse",n(G(Q.that.__zoom,Q.mouse[0]=qr(U,I),Q.mouse[1]),Q.extent,i))}function H(U){W.on("mousemove.zoom mouseup.zoom",null),bg(U.view,Q.moved),Mi(U),Q.event(U).end()}}function ke(P,...O){if(t.apply(this,arguments)){var I=this.__zoom,Q=qr(P.changedTouches?P.changedTouches[0]:P,this),W=I.invert(Q),Z=I.k*(P.shiftKey?.5:2),j=n(G(q(I,Z),Q,W),e.apply(this,O),i);Mi(P),l>0?Tr(this).transition().duration(l).call(z,j,Q,P):Tr(this).call(D.transform,j,Q,P)}}function X(P,...O){if(t.apply(this,arguments)){var I=P.touches,Q=I.length,W=L(this,O,P.changedTouches.length===Q).event(P),Z,j,ee,ne;for(Xc(P),j=0;j<Q;++j)ee=I[j],ne=qr(ee,this),ne=[ne,this.__zoom.invert(ne),ee.identifier],W.touch0?!W.touch1&&W.touch0[2]!==ne[2]&&(W.touch1=ne,W.taps=0):(W.touch0=ne,Z=!0,W.taps=1+!!v);v&&(v=clearTimeout(v)),Z&&(W.taps<2&&(p=ne[0],v=setTimeout(function(){v=null},m)),ul(this),W.start())}}function T(P,...O){if(this.__zooming){var I=L(this,O).event(P),Q=P.changedTouches,W=Q.length,Z,j,ee,ne;for(Mi(P),Z=0;Z<W;++Z)j=Q[Z],ee=qr(j,this),I.touch0&&I.touch0[2]===j.identifier?I.touch0[0]=ee:I.touch1&&I.touch1[2]===j.identifier&&(I.touch1[0]=ee);if(j=I.that.__zoom,I.touch1){var H=I.touch0[0],U=I.touch0[1],le=I.touch1[0],Y=I.touch1[1],ue=(ue=le[0]-H[0])*ue+(ue=le[1]-H[1])*ue,_e=(_e=Y[0]-U[0])*_e+(_e=Y[1]-U[1])*_e;j=q(j,Math.sqrt(ue/_e)),ee=[(H[0]+le[0])/2,(H[1]+le[1])/2],ne=[(U[0]+Y[0])/2,(U[1]+Y[1])/2]}else if(I.touch0)ee=I.touch0[0],ne=I.touch0[1];else return;I.zoom("touch",n(G(j,ee,ne),I.extent,i))}}function K(P,...O){if(this.__zooming){var I=L(this,O).event(P),Q=P.changedTouches,W=Q.length,Z,j;for(Xc(P),h&&clearTimeout(h),h=setTimeout(function(){h=null},m),Z=0;Z<W;++Z)j=Q[Z],I.touch0&&I.touch0[2]===j.identifier?delete I.touch0:I.touch1&&I.touch1[2]===j.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(j=qr(j,this),Math.hypot(p[0]-j[0],p[1]-j[1])<A)){var ee=Tr(this).on("dblclick.zoom");ee&&ee.apply(this,arguments)}}}return D.wheelDelta=function(P){return arguments.length?(r=typeof P=="function"?P:Xo(+P),D):r},D.filter=function(P){return arguments.length?(t=typeof P=="function"?P:Xo(!!P),D):t},D.touchable=function(P){return arguments.length?(a=typeof P=="function"?P:Xo(!!P),D):a},D.extent=function(P){return arguments.length?(e=typeof P=="function"?P:Xo([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),D):e},D.scaleExtent=function(P){return arguments.length?(s[0]=+P[0],s[1]=+P[1],D):[s[0],s[1]]},D.translateExtent=function(P){return arguments.length?(i[0][0]=+P[0][0],i[1][0]=+P[1][0],i[0][1]=+P[0][1],i[1][1]=+P[1][1],D):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},D.constrain=function(P){return arguments.length?(n=P,D):n},D.duration=function(P){return arguments.length?(l=+P,D):l},D.interpolate=function(P){return arguments.length?(u=P,D):u},D.on=function(){var P=f.on.apply(f,arguments);return P===f?D:P},D.clickDistance=function(P){return arguments.length?(k=(P=+P)*P,D):Math.sqrt(k)},D.tapDistance=function(P){return arguments.length?(A=+P,D):A},D}const Qi={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Fu=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Dg=["Enter"," ","Escape"],cT={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ri;(function(t){t.Strict="strict",t.Loose="loose"})(ri||(ri={}));var qs;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(qs||(qs={}));var Tl;(function(t){t.Partial="partial",t.Full="full"})(Tl||(Tl={}));const Ku={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ia;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(Ia||(Ia={}));var Cl;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Cl||(Cl={}));var _t;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(_t||(_t={}));const Pv={[_t.Left]:_t.Right,[_t.Right]:_t.Left,[_t.Top]:_t.Bottom,[_t.Bottom]:_t.Top};function uT(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function Mv(t,e,n){if(!n)return;const r=[];t.forEach((a,s)=>{e!=null&&e.has(s)||r.push(a)}),r.length&&n(r)}function dT(t){return t===null?null:t?"valid":"invalid"}const Lg=t=>"id"in t&&"source"in t&&"target"in t,fT=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),zd=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),bo=(t,e=[0,0])=>{const{width:n,height:r}=As(t),a=t.origin??e,s=n*a[0],i=r*a[1];return{x:t.position.x-s,y:t.position.y-i}},vT=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,a)=>{const s=typeof a=="string";let i=!e.nodeLookup&&!s?a:void 0;e.nodeLookup&&(i=s?e.nodeLookup.get(a):zd(a)?a:e.nodeLookup.get(a.id));const l=i?Il(i,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return nc(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return rc(n)},tc=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(a=>{(e.filter===void 0||e.filter(a))&&(n=nc(n,Il(a)),r=!0)}),r?rc(n):{x:0,y:0,width:0,height:0}},jd=(t,e,[n,r,a]=[0,0,1],s=!1,i=!1)=>{const l={...xo(e,[n,r,a]),width:e.width/a,height:e.height/a},u=[];for(const f of t.values()){const{measured:v,selectable:p=!0,hidden:h=!1}=f;if(i&&!p||h)continue;const m=v.width??f.width??f.initialWidth??null,x=v.height??f.height??f.initialHeight??null,k=Ji(l,si(f)),A=(m??0)*(x??0),D=s&&k>0;(!f.internals.handleBounds||D||k>=A||f.dragging)&&u.push(f)}return u},hT=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function pT(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(a=>a.id)):null;return t.forEach(a=>{a.measured.width&&a.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!a.hidden)&&(!r||r.has(a.id))&&n.set(a.id,a)}),n}async function gT({nodes:t,width:e,height:n,panZoom:r,minZoom:a,maxZoom:s},i){if(t.size===0)return Promise.resolve(!0);const l=pT(t,i),u=tc(l),f=Bd(u,e,n,(i==null?void 0:i.minZoom)??a,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await r.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function zg({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:a,onError:s}){const i=n.get(t),l=i.parentId?n.get(i.parentId):void 0,{x:u,y:f}=l?l.internals.positionAbsolute:{x:0,y:0},v=i.origin??r;let p=i.extent||a;if(i.extent==="parent"&&!i.expandParent)if(!l)s==null||s("005",Qi.error005());else{const m=l.measured.width,x=l.measured.height;m&&x&&(p=[[u,f],[u+m,f+x]])}else l&&ii(i.extent)&&(p=[[i.extent[0][0]+u,i.extent[0][1]+f],[i.extent[1][0]+u,i.extent[1][1]+f]]);const h=ii(p)?ys(e,p,i.measured):e;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",Qi.error015())),{position:{x:h.x-u+(i.measured.width??0)*v[0],y:h.y-f+(i.measured.height??0)*v[1]},positionAbsolute:h}}async function mT({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:a}){const s=new Set(t.map(h=>h.id)),i=[];for(const h of n){if(h.deletable===!1)continue;const m=s.has(h.id),x=!m&&h.parentId&&i.find(k=>k.id===h.parentId);(m||x)&&i.push(h)}const l=new Set(e.map(h=>h.id)),u=r.filter(h=>h.deletable!==!1),v=hT(i,u);for(const h of u)l.has(h.id)&&!v.find(x=>x.id===h.id)&&v.push(h);if(!a)return{edges:v,nodes:i};const p=await a({nodes:i,edges:v});return typeof p=="boolean"?p?{edges:v,nodes:i}:{edges:[],nodes:[]}:p}const ai=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),ys=(t={x:0,y:0},e,n)=>({x:ai(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:ai(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function jg(t,e,n){const{width:r,height:a}=As(n),{x:s,y:i}=n.internals.positionAbsolute;return ys(t,[[s,i],[s+r,i+a]],e)}const Ov=(t,e,n)=>t<e?ai(Math.abs(t-e),1,e)/e:t>n?-ai(Math.abs(t-n),1,e)/e:0,Bg=(t,e,n=15,r=40)=>{const a=Ov(t.x,r,e.width-r)*n,s=Ov(t.y,r,e.height-r)*n;return[a,s]},nc=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Hu=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),rc=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),si=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=zd(t)?t.internals.positionAbsolute:bo(t,e);return{x:n,y:r,width:((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0,height:((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0}},Il=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=zd(t)?t.internals.positionAbsolute:bo(t,e);return{x:n,y:r,x2:n+(((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0),y2:r+(((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0)}},yT=(t,e)=>rc(nc(Hu(t),Hu(e))),Ji=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Nv=t=>pa(t.width)&&pa(t.height)&&pa(t.x)&&pa(t.y),pa=t=>!isNaN(t)&&isFinite(t),_T=(t,e)=>{},wo=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),xo=({x:t,y:e},[n,r,a],s=!1,i=[1,1])=>{const l={x:(t-n)/a,y:(e-r)/a};return s?wo(l,i):l},Pl=({x:t,y:e},[n,r,a])=>({x:t*a+n,y:e*a+r});function Ds(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function bT(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=Ds(t,n),a=Ds(t,e);return{top:r,right:a,bottom:r,left:a,x:a*2,y:r*2}}if(typeof t=="object"){const r=Ds(t.top??t.y??0,n),a=Ds(t.bottom??t.y??0,n),s=Ds(t.left??t.x??0,e),i=Ds(t.right??t.x??0,e);return{top:r,right:i,bottom:a,left:s,x:s+i,y:r+a}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function wT(t,e,n,r,a,s){const{x:i,y:l}=Pl(t,[e,n,r]),{x:u,y:f}=Pl({x:t.x+t.width,y:t.y+t.height},[e,n,r]),v=a-u,p=s-f;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(v),bottom:Math.floor(p)}}const Bd=(t,e,n,r,a,s)=>{const i=bT(s,e,n),l=(e-i.x)/t.width,u=(n-i.y)/t.height,f=Math.min(l,u),v=ai(f,r,a),p=t.x+t.width/2,h=t.y+t.height/2,m=e/2-p*v,x=n/2-h*v,k=wT(t,m,x,v,e,n),A={left:Math.min(k.left-i.left,0),top:Math.min(k.top-i.top,0),right:Math.min(k.right-i.right,0),bottom:Math.min(k.bottom-i.bottom,0)};return{x:m-A.left+A.right,y:x-A.top+A.bottom,zoom:v}},Ml=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function ii(t){return t!=null&&t!=="parent"}function As(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function xT(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function kT(t,e={width:0,height:0},n,r,a){const s={...t},i=r.get(n);if(i){const l=i.origin||a;s.x+=i.internals.positionAbsolute.x-(e.width??0)*l[0],s.y+=i.internals.positionAbsolute.y-(e.height??0)*l[1]}return s}function ST(t){return{...cT,...t||{}}}function Zc(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:a}){const{x:s,y:i}=Mr(t),l=xo({x:s-((a==null?void 0:a.left)??0),y:i-((a==null?void 0:a.top)??0)},r),{x:u,y:f}=n?wo(l,e):l;return{xSnapped:u,ySnapped:f,...l}}const qg=t=>({width:t.offsetWidth,height:t.offsetHeight}),Fg=t=>{var e;return((e=t==null?void 0:t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},ET=["INPUT","SELECT","TEXTAREA"];function Kg(t){var r,a;const e=((a=(r=t.composedPath)==null?void 0:r.call(t))==null?void 0:a[0])||t.target;return(e==null?void 0:e.nodeType)!==1?!1:ET.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const Hg=t=>"clientX"in t,Mr=(t,e)=>{var s,i;const n=Hg(t),r=n?t.clientX:(s=t.touches)==null?void 0:s[0].clientX,a=n?t.clientY:(i=t.touches)==null?void 0:i[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:a-((e==null?void 0:e.top)??0)}},Rv=(t,e,n,r,a)=>{const s=e.querySelectorAll(`.${t}`);return!s||!s.length?null:Array.from(s).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:t,nodeId:a,position:i.getAttribute("data-handlepos"),x:(l.left-n.left)/r,y:(l.top-n.top)/r,...qg(i)}})};function AT({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:s,targetControlX:i,targetControlY:l}){const u=t*.125+a*.375+i*.375+n*.125,f=e*.125+s*.375+l*.375+r*.125,v=Math.abs(u-t),p=Math.abs(f-e);return[u,f,v,p]}function Zo(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function Dv({pos:t,x1:e,y1:n,x2:r,y2:a,c:s}){switch(t){case _t.Left:return[e-Zo(e-r,s),n];case _t.Right:return[e+Zo(r-e,s),n];case _t.Top:return[e,n-Zo(n-a,s)];case _t.Bottom:return[e,n+Zo(a-n,s)]}}function Vg({sourceX:t,sourceY:e,sourcePosition:n=_t.Bottom,targetX:r,targetY:a,targetPosition:s=_t.Top,curvature:i=.25}){const[l,u]=Dv({pos:n,x1:t,y1:e,x2:r,y2:a,c:i}),[f,v]=Dv({pos:s,x1:r,y1:a,x2:t,y2:e,c:i}),[p,h,m,x]=AT({sourceX:t,sourceY:e,targetX:r,targetY:a,sourceControlX:l,sourceControlY:u,targetControlX:f,targetControlY:v});return[`M${t},${e} C${l},${u} ${f},${v} ${r},${a}`,p,h,m,x]}function Ug({sourceX:t,sourceY:e,targetX:n,targetY:r}){const a=Math.abs(n-t)/2,s=n<t?n+a:n-a,i=Math.abs(r-e)/2,l=r<e?r+i:r-i;return[s,l,a,i]}function TT({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:a=!1,zIndexMode:s="basic"}){if(s==="manual")return r;const i=a&&n?r+1e3:r,l=Math.max(t.parentId||a&&t.selected?t.internals.z:0,e.parentId||a&&e.selected?e.internals.z:0);return i+l}function CT({sourceNode:t,targetNode:e,width:n,height:r,transform:a}){const s=nc(Il(t),Il(e));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-a[0]/a[2],y:-a[1]/a[2],width:n/a[2],height:r/a[2]};return Ji(i,rc(s))>0}const IT=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,PT=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),MT=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||IT;let a;return Lg(t)?a={...t}:a={...t,id:r(t)},PT(a,e)?e:(a.sourceHandle===null&&delete a.sourceHandle,a.targetHandle===null&&delete a.targetHandle,e.concat(a))};function Gg({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[a,s,i,l]=Ug({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,a,s,i,l]}const Lv={[_t.Left]:{x:-1,y:0},[_t.Right]:{x:1,y:0},[_t.Top]:{x:0,y:-1},[_t.Bottom]:{x:0,y:1}},OT=({source:t,sourcePosition:e=_t.Bottom,target:n})=>e===_t.Left||e===_t.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},zv=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function NT({source:t,sourcePosition:e=_t.Bottom,target:n,targetPosition:r=_t.Top,center:a,offset:s,stepPosition:i}){const l=Lv[e],u=Lv[r],f={x:t.x+l.x*s,y:t.y+l.y*s},v={x:n.x+u.x*s,y:n.y+u.y*s},p=OT({source:f,sourcePosition:e,target:v}),h=p.x!==0?"x":"y",m=p[h];let x=[],k,A;const D={x:0,y:0},q={x:0,y:0},[,,G,S]=Ug({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(l[h]*u[h]===-1){h==="x"?(k=a.x??f.x+(v.x-f.x)*i,A=a.y??(f.y+v.y)/2):(k=a.x??(f.x+v.x)/2,A=a.y??f.y+(v.y-f.y)*i);const L=[{x:k,y:f.y},{x:k,y:v.y}],N=[{x:f.x,y:A},{x:v.x,y:A}];l[h]===m?x=h==="x"?L:N:x=h==="x"?N:L}else{const L=[{x:f.x,y:v.y}],N=[{x:v.x,y:f.y}];if(h==="x"?x=l.x===m?N:L:x=l.y===m?L:N,e===r){const T=Math.abs(t[h]-n[h]);if(T<=s){const K=Math.min(s-1,s-T);l[h]===m?D[h]=(f[h]>t[h]?-1:1)*K:q[h]=(v[h]>n[h]?-1:1)*K}}if(e!==r){const T=h==="x"?"y":"x",K=l[h]===u[T],P=f[T]>v[T],O=f[T]<v[T];(l[h]===1&&(!K&&P||K&&O)||l[h]!==1&&(!K&&O||K&&P))&&(x=h==="x"?L:N)}const J={x:f.x+D.x,y:f.y+D.y},ae={x:v.x+q.x,y:v.y+q.y},ke=Math.max(Math.abs(J.x-x[0].x),Math.abs(ae.x-x[0].x)),X=Math.max(Math.abs(J.y-x[0].y),Math.abs(ae.y-x[0].y));ke>=X?(k=(J.x+ae.x)/2,A=x[0].y):(k=x[0].x,A=(J.y+ae.y)/2)}return[[t,{x:f.x+D.x,y:f.y+D.y},...x,{x:v.x+q.x,y:v.y+q.y},n],k,A,G,S]}function RT(t,e,n,r){const a=Math.min(zv(t,e)/2,zv(e,n)/2,r),{x:s,y:i}=e;if(t.x===s&&s===n.x||t.y===i&&i===n.y)return`L${s} ${i}`;if(t.y===i){const f=t.x<n.x?-1:1,v=t.y<n.y?1:-1;return`L ${s+a*f},${i}Q ${s},${i} ${s},${i+a*v}`}const l=t.x<n.x?1:-1,u=t.y<n.y?-1:1;return`L ${s},${i+a*u}Q ${s},${i} ${s+a*l},${i}`}function qd({sourceX:t,sourceY:e,sourcePosition:n=_t.Bottom,targetX:r,targetY:a,targetPosition:s=_t.Top,borderRadius:i=5,centerX:l,centerY:u,offset:f=20,stepPosition:v=.5}){const[p,h,m,x,k]=NT({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:a},targetPosition:s,center:{x:l,y:u},offset:f,stepPosition:v});return[p.reduce((D,q,G)=>{let S="";return G>0&&G<p.length-1?S=RT(p[G-1],q,p[G+1],i):S=`${G===0?"M":"L"}${q.x} ${q.y}`,D+=S,D},""),h,m,x,k]}function jv(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function DT(t){var p;const{sourceNode:e,targetNode:n}=t;if(!jv(e)||!jv(n))return null;const r=e.internals.handleBounds||Bv(e.handles),a=n.internals.handleBounds||Bv(n.handles),s=qv((r==null?void 0:r.source)??[],t.sourceHandle),i=qv(t.connectionMode===ri.Strict?(a==null?void 0:a.target)??[]:((a==null?void 0:a.target)??[]).concat((a==null?void 0:a.source)??[]),t.targetHandle);if(!s||!i)return(p=t.onError)==null||p.call(t,"008",Qi.error008(s?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const l=(s==null?void 0:s.position)||_t.Bottom,u=(i==null?void 0:i.position)||_t.Top,f=_s(e,s,l),v=_s(n,i,u);return{sourceX:f.x,sourceY:f.y,targetX:v.x,targetY:v.y,sourcePosition:l,targetPosition:u}}function Bv(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function _s(t,e,n=_t.Left,r=!1){const a=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,s=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:i,height:l}=e??As(t);if(r)return{x:a+i/2,y:s+l/2};switch((e==null?void 0:e.position)??n){case _t.Top:return{x:a+i/2,y:s};case _t.Right:return{x:a+i,y:s+l/2};case _t.Bottom:return{x:a+i/2,y:s+l};case _t.Left:return{x:a,y:s+l/2}}}function qv(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function Vu(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function LT(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:a}){const s=new Set;return t.reduce((i,l)=>([l.markerStart||r,l.markerEnd||a].forEach(u=>{if(u&&typeof u=="object"){const f=Vu(u,e);s.has(f)||(i.push({id:f,color:u.color||n,...u}),s.add(f))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const Wg=1e3,zT=10,Fd={nodeOrigin:[0,0],nodeExtent:Fu,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},jT={...Fd,checkEquality:!0};function Kd(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function BT(t,e,n){const r=Kd(Fd,n);for(const a of t.values())if(a.parentId)Vd(a,t,e,r);else{const s=bo(a,r.nodeOrigin),i=ii(a.extent)?a.extent:r.nodeExtent,l=ys(s,i,As(a));a.internals.positionAbsolute=l}}function qT(t,e){if(!t.handles)return t.measured?e==null?void 0:e.internals.handleBounds:void 0;const n=[],r=[];for(const a of t.handles){const s={id:a.id,width:a.width??1,height:a.height??1,nodeId:t.id,x:a.x,y:a.y,position:a.position,type:a.type};a.type==="source"?n.push(s):a.type==="target"&&r.push(s)}return{source:n,target:r}}function Hd(t){return t==="manual"}function FT(t,e,n,r={}){var f,v;const a=Kd(jT,r),s={i:0},i=new Map(e),l=a!=null&&a.elevateNodesOnSelect&&!Hd(a.zIndexMode)?Wg:0;let u=t.length>0;e.clear(),n.clear();for(const p of t){let h=i.get(p.id);if(a.checkEquality&&p===(h==null?void 0:h.internals.userNode))e.set(p.id,h);else{const m=bo(p,a.nodeOrigin),x=ii(p.extent)?p.extent:a.nodeExtent,k=ys(m,x,As(p));h={...a.defaults,...p,measured:{width:(f=p.measured)==null?void 0:f.width,height:(v=p.measured)==null?void 0:v.height},internals:{positionAbsolute:k,handleBounds:qT(p,h),z:Yg(p,l,a.zIndexMode),userNode:p}},e.set(p.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(u=!1),p.parentId&&Vd(h,e,n,r,s)}return u}function KT(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function Vd(t,e,n,r,a){const{elevateNodesOnSelect:s,nodeOrigin:i,nodeExtent:l,zIndexMode:u}=Kd(Fd,r),f=t.parentId,v=e.get(f);if(!v){console.warn(`Parent node ${f} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}KT(t,n),a&&!v.parentId&&v.internals.rootParentIndex===void 0&&u==="auto"&&(v.internals.rootParentIndex=++a.i,v.internals.z=v.internals.z+a.i*zT),a&&v.internals.rootParentIndex!==void 0&&(a.i=v.internals.rootParentIndex);const p=s&&!Hd(u)?Wg:0,{x:h,y:m,z:x}=HT(t,v,i,l,p,u),{positionAbsolute:k}=t.internals,A=h!==k.x||m!==k.y;(A||x!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:A?{x:h,y:m}:k,z:x}})}function Yg(t,e,n){const r=pa(t.zIndex)?t.zIndex:0;return Hd(n)?r:r+(t.selected?e:0)}function HT(t,e,n,r,a,s){const{x:i,y:l}=e.internals.positionAbsolute,u=As(t),f=bo(t,n),v=ii(t.extent)?ys(f,t.extent,u):f;let p=ys({x:i+v.x,y:l+v.y},r,u);t.extent==="parent"&&(p=jg(p,u,e));const h=Yg(t,a,s),m=e.internals.z??0;return{x:p.x,y:p.y,z:m>=h?m+1:h}}function VT(t,e,n,r=[0,0]){var i;const a=[],s=new Map;for(const l of t){const u=e.get(l.parentId);if(!u)continue;const f=((i=s.get(l.parentId))==null?void 0:i.expandedRect)??si(u),v=yT(f,l.rect);s.set(l.parentId,{expandedRect:v,parent:u})}return s.size>0&&s.forEach(({expandedRect:l,parent:u},f)=>{var G;const v=u.internals.positionAbsolute,p=As(u),h=u.origin??r,m=l.x<v.x?Math.round(Math.abs(v.x-l.x)):0,x=l.y<v.y?Math.round(Math.abs(v.y-l.y)):0,k=Math.max(p.width,Math.round(l.width)),A=Math.max(p.height,Math.round(l.height)),D=(k-p.width)*h[0],q=(A-p.height)*h[1];(m>0||x>0||D||q)&&(a.push({id:f,type:"position",position:{x:u.position.x-m+D,y:u.position.y-x+q}}),(G=n.get(f))==null||G.forEach(S=>{t.some(z=>z.id===S.id)||a.push({id:S.id,type:"position",position:{x:S.position.x+m,y:S.position.y+x}})})),(p.width<l.width||p.height<l.height||m||x)&&a.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:k+(m?h[0]*m-D:0),height:A+(x?h[1]*x-q:0)}})}),a}function UT(t,e,n,r,a,s,i){const l=r==null?void 0:r.querySelector(".xyflow__viewport");let u=!1;if(!l)return{changes:[],updatedInternals:u};const f=[],v=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(v.transform),h=[];for(const m of t.values()){const x=e.get(m.id);if(!x)continue;if(x.hidden){e.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),u=!0;continue}const k=qg(m.nodeElement),A=x.measured.width!==k.width||x.measured.height!==k.height;if(!!(k.width&&k.height&&(A||!x.internals.handleBounds||m.force))){const q=m.nodeElement.getBoundingClientRect(),G=ii(x.extent)?x.extent:s;let{positionAbsolute:S}=x.internals;x.parentId&&x.extent==="parent"?S=jg(S,k,e.get(x.parentId)):G&&(S=ys(S,G,k));const z={...x,measured:k,internals:{...x.internals,positionAbsolute:S,handleBounds:{source:Rv("source",m.nodeElement,q,p,x.id),target:Rv("target",m.nodeElement,q,p,x.id)}}};e.set(x.id,z),x.parentId&&Vd(z,e,n,{nodeOrigin:a,zIndexMode:i}),u=!0,A&&(f.push({id:x.id,type:"dimensions",dimensions:k}),x.expandParent&&x.parentId&&h.push({id:x.id,parentId:x.parentId,rect:si(z,a)}))}}if(h.length>0){const m=VT(h,e,n,a);f.push(...m)}return{changes:f,updatedInternals:u}}async function GT({delta:t,panZoom:e,transform:n,translateExtent:r,width:a,height:s}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const i=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[a,s]],r),l=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(l)}function Fv(t,e,n,r,a,s){let i=a;const l=r.get(i)||new Map;r.set(i,l.set(n,e)),i=`${a}-${t}`;const u=r.get(i)||new Map;if(r.set(i,u.set(n,e)),s){i=`${a}-${t}-${s}`;const f=r.get(i)||new Map;r.set(i,f.set(n,e))}}function WT(t,e,n){t.clear(),e.clear();for(const r of n){const{source:a,target:s,sourceHandle:i=null,targetHandle:l=null}=r,u={edgeId:r.id,source:a,target:s,sourceHandle:i,targetHandle:l},f=`${a}-${i}--${s}-${l}`,v=`${s}-${l}--${a}-${i}`;Fv("source",u,v,t,a,i),Fv("target",u,f,t,s,l),e.set(r.id,r)}}function Xg(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Xg(n,e):!1}function Kv(t,e,n){var a;let r=t;do{if((a=r==null?void 0:r.matches)!=null&&a.call(r,e))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function YT(t,e,n,r){const a=new Map;for(const[s,i]of t)if((i.selected||i.id===r)&&(!i.parentId||!Xg(i,t))&&(i.draggable||e&&typeof i.draggable>"u")){const l=t.get(s);l&&a.set(s,{id:s,position:l.position||{x:0,y:0},distance:{x:n.x-l.internals.positionAbsolute.x,y:n.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return a}function Qc({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var i,l,u;const a=[];for(const[f,v]of e){const p=(i=n.get(f))==null?void 0:i.internals.userNode;p&&a.push({...p,position:v.position,dragging:r})}if(!t)return[a[0],a];const s=(l=n.get(t))==null?void 0:l.internals.userNode;return[s?{...s,position:((u=e.get(t))==null?void 0:u.position)||s.position,dragging:r}:a[0],a]}function XT({dragItems:t,snapGrid:e,x:n,y:r}){const a=t.values().next().value;if(!a)return null;const s={x:n-a.distance.x,y:r-a.distance.y},i=wo(s,e);return{x:i.x-s.x,y:i.y-s.y}}function ZT({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:a}){let s={x:null,y:null},i=0,l=new Map,u=!1,f={x:0,y:0},v=null,p=!1,h=null,m=!1,x=!1,k=null;function A({noDragClassName:q,handleSelector:G,domNode:S,isSelectable:z,nodeId:L,nodeClickDistance:N=0}){h=Tr(S);function J({x:T,y:K}){const{nodeLookup:P,nodeExtent:O,snapGrid:I,snapToGrid:Q,nodeOrigin:W,onNodeDrag:Z,onSelectionDrag:j,onError:ee,updateNodePositions:ne}=e();s={x:T,y:K};let H=!1;const U=l.size>1,le=U&&O?Hu(tc(l)):null,Y=U&&Q?XT({dragItems:l,snapGrid:I,x:T,y:K}):null;for(const[ue,_e]of l){if(!P.has(ue))continue;let ge={x:T-_e.distance.x,y:K-_e.distance.y};Q&&(ge=Y?{x:Math.round(ge.x+Y.x),y:Math.round(ge.y+Y.y)}:wo(ge,I));let re=null;if(U&&O&&!_e.extent&&le){const{positionAbsolute:Ie}=_e.internals,Ke=Ie.x-le.x+O[0][0],Xe=Ie.x+_e.measured.width-le.x2+O[1][0],ft=Ie.y-le.y+O[0][1],vt=Ie.y+_e.measured.height-le.y2+O[1][1];re=[[Ke,ft],[Xe,vt]]}const{position:Te,positionAbsolute:be}=zg({nodeId:ue,nextPosition:ge,nodeLookup:P,nodeExtent:re||O,nodeOrigin:W,onError:ee});H=H||_e.position.x!==Te.x||_e.position.y!==Te.y,_e.position=Te,_e.internals.positionAbsolute=be}if(x=x||H,!!H&&(ne(l,!0),k&&(r||Z||!L&&j))){const[ue,_e]=Qc({nodeId:L,dragItems:l,nodeLookup:P});r==null||r(k,l,ue,_e),Z==null||Z(k,ue,_e),L||j==null||j(k,_e)}}async function ae(){if(!v)return;const{transform:T,panBy:K,autoPanSpeed:P,autoPanOnNodeDrag:O}=e();if(!O){u=!1,cancelAnimationFrame(i);return}const[I,Q]=Bg(f,v,P);(I!==0||Q!==0)&&(s.x=(s.x??0)-I/T[2],s.y=(s.y??0)-Q/T[2],await K({x:I,y:Q})&&J(s)),i=requestAnimationFrame(ae)}function ke(T){var U;const{nodeLookup:K,multiSelectionActive:P,nodesDraggable:O,transform:I,snapGrid:Q,snapToGrid:W,selectNodesOnDrag:Z,onNodeDragStart:j,onSelectionDragStart:ee,unselectNodesAndEdges:ne}=e();p=!0,(!Z||!z)&&!P&&L&&((U=K.get(L))!=null&&U.selected||ne()),z&&Z&&L&&(t==null||t(L));const H=Zc(T.sourceEvent,{transform:I,snapGrid:Q,snapToGrid:W,containerBounds:v});if(s=H,l=YT(K,O,H,L),l.size>0&&(n||j||!L&&ee)){const[le,Y]=Qc({nodeId:L,dragItems:l,nodeLookup:K});n==null||n(T.sourceEvent,l,le,Y),j==null||j(T.sourceEvent,le,Y),L||ee==null||ee(T.sourceEvent,Y)}}const X=pE().clickDistance(N).on("start",T=>{const{domNode:K,nodeDragThreshold:P,transform:O,snapGrid:I,snapToGrid:Q}=e();v=(K==null?void 0:K.getBoundingClientRect())||null,m=!1,x=!1,k=T.sourceEvent,P===0&&ke(T),s=Zc(T.sourceEvent,{transform:O,snapGrid:I,snapToGrid:Q,containerBounds:v}),f=Mr(T.sourceEvent,v)}).on("drag",T=>{const{autoPanOnNodeDrag:K,transform:P,snapGrid:O,snapToGrid:I,nodeDragThreshold:Q,nodeLookup:W}=e(),Z=Zc(T.sourceEvent,{transform:P,snapGrid:O,snapToGrid:I,containerBounds:v});if(k=T.sourceEvent,(T.sourceEvent.type==="touchmove"&&T.sourceEvent.touches.length>1||L&&!W.has(L))&&(m=!0),!m){if(!u&&K&&p&&(u=!0,ae()),!p){const j=Mr(T.sourceEvent,v),ee=j.x-f.x,ne=j.y-f.y;Math.sqrt(ee*ee+ne*ne)>Q&&ke(T)}(s.x!==Z.xSnapped||s.y!==Z.ySnapped)&&l&&p&&(f=Mr(T.sourceEvent,v),J(Z))}}).on("end",T=>{if(!(!p||m)&&(u=!1,p=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:K,updateNodePositions:P,onNodeDragStop:O,onSelectionDragStop:I}=e();if(x&&(P(l,!1),x=!1),a||O||!L&&I){const[Q,W]=Qc({nodeId:L,dragItems:l,nodeLookup:K,dragging:!1});a==null||a(T.sourceEvent,l,Q,W),O==null||O(T.sourceEvent,Q,W),L||I==null||I(T.sourceEvent,W)}}}).filter(T=>{const K=T.target;return!T.button&&(!q||!Kv(K,`.${q}`,S))&&(!G||Kv(K,G,S))});h.call(X)}function D(){h==null||h.on(".drag",null)}return{update:A,destroy:D}}function QT(t,e,n){const r=[],a={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const s of e.values())Ji(a,si(s))>0&&r.push(s);return r}const JT=250;function $T(t,e,n,r){var l,u;let a=[],s=1/0;const i=QT(t,n,e+JT);for(const f of i){const v=[...((l=f.internals.handleBounds)==null?void 0:l.source)??[],...((u=f.internals.handleBounds)==null?void 0:u.target)??[]];for(const p of v){if(r.nodeId===p.nodeId&&r.type===p.type&&r.id===p.id)continue;const{x:h,y:m}=_s(f,p,p.position,!0),x=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(m-t.y,2));x>e||(x<s?(a=[{...p,x:h,y:m}],s=x):x===s&&a.push({...p,x:h,y:m}))}}if(!a.length)return null;if(a.length>1){const f=r.type==="source"?"target":"source";return a.find(v=>v.type===f)??a[0]}return a[0]}function Zg(t,e,n,r,a,s=!1){var f,v,p;const i=r.get(t);if(!i)return null;const l=a==="strict"?(f=i.internals.handleBounds)==null?void 0:f[e]:[...((v=i.internals.handleBounds)==null?void 0:v.source)??[],...((p=i.internals.handleBounds)==null?void 0:p.target)??[]],u=(n?l==null?void 0:l.find(h=>h.id===n):l==null?void 0:l[0])??null;return u&&s?{...u,..._s(i,u,u.position,!0)}:u}function Qg(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function eC(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const Jg=()=>!0;function tC(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:a,edgeUpdaterType:s,isTarget:i,domNode:l,nodeLookup:u,lib:f,autoPanOnConnect:v,flowId:p,panBy:h,cancelConnection:m,onConnectStart:x,onConnect:k,onConnectEnd:A,isValidConnection:D=Jg,onReconnectEnd:q,updateConnection:G,getTransform:S,getFromHandle:z,autoPanSpeed:L,dragThreshold:N=1,handleDomNode:J}){const ae=Fg(t.target);let ke=0,X;const{x:T,y:K}=Mr(t),P=Qg(s,J),O=l==null?void 0:l.getBoundingClientRect();let I=!1;if(!O||!P)return;const Q=Zg(a,P,r,u,e);if(!Q)return;let W=Mr(t,O),Z=!1,j=null,ee=!1,ne=null;function H(){if(!v||!O)return;const[Te,be]=Bg(W,O,L);h({x:Te,y:be}),ke=requestAnimationFrame(H)}const U={...Q,nodeId:a,type:P,position:Q.position},le=u.get(a);let ue={inProgress:!0,isValid:null,from:_s(le,U,_t.Left,!0),fromHandle:U,fromPosition:U.position,fromNode:le,to:W,toHandle:null,toPosition:Pv[U.position],toNode:null,pointer:W};function _e(){I=!0,G(ue),x==null||x(t,{nodeId:a,handleId:r,handleType:P})}N===0&&_e();function ge(Te){if(!I){const{x:vt,y:Le}=Mr(Te),Re=vt-T,qe=Le-K;if(!(Re*Re+qe*qe>N*N))return;_e()}if(!z()||!U){re(Te);return}const be=S();W=Mr(Te,O),X=$T(xo(W,be,!1,[1,1]),n,u,U),Z||(H(),Z=!0);const Ie=$g(Te,{handle:X,connectionMode:e,fromNodeId:a,fromHandleId:r,fromType:i?"target":"source",isValidConnection:D,doc:ae,lib:f,flowId:p,nodeLookup:u});ne=Ie.handleDomNode,j=Ie.connection,ee=eC(!!X,Ie.isValid);const Ke=u.get(a),Xe=Ke?_s(Ke,U,_t.Left,!0):ue.from,ft={...ue,from:Xe,isValid:ee,to:Ie.toHandle&&ee?Pl({x:Ie.toHandle.x,y:Ie.toHandle.y},be):W,toHandle:Ie.toHandle,toPosition:ee&&Ie.toHandle?Ie.toHandle.position:Pv[U.position],toNode:Ie.toHandle?u.get(Ie.toHandle.nodeId):null,pointer:W};G(ft),ue=ft}function re(Te){if(!("touches"in Te&&Te.touches.length>0)){if(I){(X||ne)&&j&&ee&&(k==null||k(j));const{inProgress:be,...Ie}=ue,Ke={...Ie,toPosition:ue.toHandle?ue.toPosition:null};A==null||A(Te,Ke),s&&(q==null||q(Te,Ke))}m(),cancelAnimationFrame(ke),Z=!1,ee=!1,j=null,ne=null,ae.removeEventListener("mousemove",ge),ae.removeEventListener("mouseup",re),ae.removeEventListener("touchmove",ge),ae.removeEventListener("touchend",re)}}ae.addEventListener("mousemove",ge),ae.addEventListener("mouseup",re),ae.addEventListener("touchmove",ge),ae.addEventListener("touchend",re)}function $g(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:a,fromType:s,doc:i,lib:l,flowId:u,isValidConnection:f=Jg,nodeLookup:v}){const p=s==="target",h=e?i.querySelector(`.${l}-flow__handle[data-id="${u}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:m,y:x}=Mr(t),k=i.elementFromPoint(m,x),A=k!=null&&k.classList.contains(`${l}-flow__handle`)?k:h,D={handleDomNode:A,isValid:!1,connection:null,toHandle:null};if(A){const q=Qg(void 0,A),G=A.getAttribute("data-nodeid"),S=A.getAttribute("data-handleid"),z=A.classList.contains("connectable"),L=A.classList.contains("connectableend");if(!G||!q)return D;const N={source:p?G:r,sourceHandle:p?S:a,target:p?r:G,targetHandle:p?a:S};D.connection=N;const ae=z&&L&&(n===ri.Strict?p&&q==="source"||!p&&q==="target":G!==r||S!==a);D.isValid=ae&&f(N),D.toHandle=Zg(G,q,S,v,n,!0)}return D}const Hv={onPointerDown:tC,isValid:$g},ac=t=>({x:t.x,y:t.y,zoom:t.k}),Jc=({x:t,y:e,zoom:n})=>ec.translate(t,e).scale(n),zs=(t,e)=>t.target.closest(`.${e}`),em=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),nC=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,$c=(t,e=0,n=nC,r=()=>{})=>{const a=typeof e=="number"&&e>0;return a||r(),a?t.transition().duration(e).ease(n).on("end",r):t},tm=t=>{const e=t.ctrlKey&&Ml()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function rC({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:a,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:u,onPanZoomEnd:f}){return v=>{if(zs(v,e))return v.ctrlKey&&v.preventDefault(),!1;v.preventDefault(),v.stopImmediatePropagation();const p=n.property("__zoom").k||1;if(v.ctrlKey&&i){const A=qr(v),D=tm(v),q=p*Math.pow(2,D);r.scaleTo(n,q,A,v);return}const h=v.deltaMode===1?20:1;let m=a===qs.Vertical?0:v.deltaX*h,x=a===qs.Horizontal?0:v.deltaY*h;!Ml()&&v.shiftKey&&a!==qs.Vertical&&(m=v.deltaY*h,x=0),r.translateBy(n,-(m/p)*s,-(x/p)*s,{internal:!0});const k=ac(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(u==null||u(v,k),t.panScrollTimeout=setTimeout(()=>{f==null||f(v,k),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,l==null||l(v,k))}}function aC({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,a){const s=r.type==="wheel",i=!e&&s&&!r.ctrlKey,l=zs(r,t);if(r.ctrlKey&&s&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),n.call(this,r,a)}}function sC({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var s,i,l;if((s=r.sourceEvent)!=null&&s.internal)return;const a=ac(r.transform);t.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=a,((l=r.sourceEvent)==null?void 0:l.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,a))}}function iC({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:a}){return s=>{var i,l;t.usedRightMouseButton=!!(n&&em(e,t.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||r([s.transform.x,s.transform.y,s.transform.k]),a&&!((l=s.sourceEvent)!=null&&l.internal)&&(a==null||a(s.sourceEvent,ac(s.transform)))}}function oC({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:a,onPaneContextMenu:s}){return i=>{var l;if(!((l=i.sourceEvent)!=null&&l.internal)&&(t.isZoomingOrPanning=!1,s&&em(e,t.mouseButton??0)&&!t.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),t.usedRightMouseButton=!1,r(!1),a)){const u=ac(i.transform);t.prevViewport=u,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{a==null||a(i.sourceEvent,u)},n?150:0)}}}function lC({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:a,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:l,noPanClassName:u,lib:f,connectionInProgress:v}){return p=>{var A;const h=t||e,m=n&&p.ctrlKey,x=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(zs(p,`${f}-flow__node`)||zs(p,`${f}-flow__edge`)))return!0;if(!r&&!h&&!a&&!s&&!n||i||v&&!x||zs(p,l)&&x||zs(p,u)&&(!x||a&&x&&!t)||!n&&p.ctrlKey&&x)return!1;if(!n&&p.type==="touchstart"&&((A=p.touches)==null?void 0:A.length)>1)return p.preventDefault(),!1;if(!h&&!a&&!m&&x||!r&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(r)&&!r.includes(p.button)&&p.type==="mousedown")return!1;const k=Array.isArray(r)&&r.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||x)&&k}}function cC({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:a,onPanZoom:s,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:u}){const f={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},v=t.getBoundingClientRect(),p=lT().scaleExtent([e,n]).translateExtent(r),h=Tr(t).call(p);q({x:a.x,y:a.y,zoom:ai(a.zoom,e,n)},[[0,0],[v.width,v.height]],r);const m=h.on("wheel.zoom"),x=h.on("dblclick.zoom");p.wheelDelta(tm);function k(X,T){return h?new Promise(K=>{p==null||p.interpolate((T==null?void 0:T.interpolate)==="linear"?Fi:ol).transform($c(h,T==null?void 0:T.duration,T==null?void 0:T.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function A({noWheelClassName:X,noPanClassName:T,onPaneContextMenu:K,userSelectionActive:P,panOnScroll:O,panOnDrag:I,panOnScrollMode:Q,panOnScrollSpeed:W,preventScrolling:Z,zoomOnPinch:j,zoomOnScroll:ee,zoomOnDoubleClick:ne,zoomActivationKeyPressed:H,lib:U,onTransformChange:le,connectionInProgress:Y,paneClickDistance:ue,selectionOnDrag:_e}){P&&!f.isZoomingOrPanning&&D();const ge=O&&!H&&!P;p.clickDistance(_e?1/0:!pa(ue)||ue<0?0:ue);const re=ge?rC({zoomPanValues:f,noWheelClassName:X,d3Selection:h,d3Zoom:p,panOnScrollMode:Q,panOnScrollSpeed:W,zoomOnPinch:j,onPanZoomStart:i,onPanZoom:s,onPanZoomEnd:l}):aC({noWheelClassName:X,preventScrolling:Z,d3ZoomHandler:m});if(h.on("wheel.zoom",re,{passive:!1}),!P){const be=sC({zoomPanValues:f,onDraggingChange:u,onPanZoomStart:i});p.on("start",be);const Ie=iC({zoomPanValues:f,panOnDrag:I,onPaneContextMenu:!!K,onPanZoom:s,onTransformChange:le});p.on("zoom",Ie);const Ke=oC({zoomPanValues:f,panOnDrag:I,panOnScroll:O,onPaneContextMenu:K,onPanZoomEnd:l,onDraggingChange:u});p.on("end",Ke)}const Te=lC({zoomActivationKeyPressed:H,panOnDrag:I,zoomOnScroll:ee,panOnScroll:O,zoomOnDoubleClick:ne,zoomOnPinch:j,userSelectionActive:P,noPanClassName:T,noWheelClassName:X,lib:U,connectionInProgress:Y});p.filter(Te),ne?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function D(){p.on("zoom",null)}async function q(X,T,K){const P=Jc(X),O=p==null?void 0:p.constrain()(P,T,K);return O&&await k(O),new Promise(I=>I(O))}async function G(X,T){const K=Jc(X);return await k(K,T),new Promise(P=>P(K))}function S(X){if(h){const T=Jc(X),K=h.property("__zoom");(K.k!==X.zoom||K.x!==X.x||K.y!==X.y)&&(p==null||p.transform(h,T,null,{sync:!0}))}}function z(){const X=h?Rg(h.node()):{x:0,y:0,k:1};return{x:X.x,y:X.y,zoom:X.k}}function L(X,T){return h?new Promise(K=>{p==null||p.interpolate((T==null?void 0:T.interpolate)==="linear"?Fi:ol).scaleTo($c(h,T==null?void 0:T.duration,T==null?void 0:T.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function N(X,T){return h?new Promise(K=>{p==null||p.interpolate((T==null?void 0:T.interpolate)==="linear"?Fi:ol).scaleBy($c(h,T==null?void 0:T.duration,T==null?void 0:T.ease,()=>K(!0)),X)}):Promise.resolve(!1)}function J(X){p==null||p.scaleExtent(X)}function ae(X){p==null||p.translateExtent(X)}function ke(X){const T=!pa(X)||X<0?0:X;p==null||p.clickDistance(T)}return{update:A,destroy:D,setViewport:G,setViewportConstrained:q,getViewport:z,scaleTo:L,scaleBy:N,setScaleExtent:J,setTranslateExtent:ae,syncViewport:S,setClickDistance:ke}}var Vv;(function(t){t.Line="line",t.Handle="handle"})(Vv||(Vv={}));function Ud(){const t={};return[e=>{if(e&&!uy(t))throw new Error(e);return Zu(t)},e=>gh(t,e)]}const[uC,dC]=Ud(),[fC,vC]=Ud(),[hC,pC]=Ud();var gC=F("<div><!></div>");function qa(t,e){et(e,!0);let n=Ae(e,"id",3,null),r=Ae(e,"type",3,"source"),a=Ae(e,"position",19,()=>_t.Top),s=Ae(e,"isConnectableStart",3,!0),i=Ae(e,"isConnectableEnd",3,!0),l=Ss(e,["$$slots","$$events","$$legacy","id","type","position","style","class","isConnectable","isConnectableStart","isConnectableEnd","isValidConnection","onconnect","ondisconnect","children"]);const u=uC("Handle must be used within a Custom Node component"),f=fC("Handle must be used within a Custom Node component");let v=$(()=>r()==="target"),p=$(()=>e.isConnectable!==void 0?e.isConnectable:f.value),h=Ts(),m=$(()=>h.ariaLabelConfig),x=null;Bh(()=>{if(e.onconnect||e.ondisconnect){h.edges;let T=h.connectionLookup.get(`${u}-${r()}${n()?`-${n()}`:""}`);if(x&&!uT(T,x)){const K=T??new Map;Mv(x,K,e.ondisconnect),Mv(K,x,e.onconnect)}x=new Map(T)}});let k=$(()=>{if(!h.connection.inProgress)return[!1,!1,!1,!1,null];const{fromHandle:T,toHandle:K,isValid:P}=h.connection,O=T&&T.nodeId===u&&T.type===r()&&T.id===n(),I=K&&K.nodeId===u&&K.type===r()&&K.id===n(),Q=h.connectionMode===ri.Strict?(T==null?void 0:T.type)!==r():u!==(T==null?void 0:T.nodeId)||n()!==(T==null?void 0:T.id);return[!0,O,I,Q,I&&P]}),A=$(()=>io(o(k),5)),D=$(()=>o(A)[0]),q=$(()=>o(A)[1]),G=$(()=>o(A)[2]),S=$(()=>o(A)[3]),z=$(()=>o(A)[4]);function L(T){var P;const K=h.onbeforeconnect?h.onbeforeconnect(T):T;K&&(h.addEdge(K),(P=h.onconnect)==null||P.call(h,T))}function N(T){const K=Hg(T);T.currentTarget&&(K&&T.button===0||!K)&&Hv.onPointerDown(T,{handleId:n(),nodeId:u,isTarget:o(v),connectionRadius:h.connectionRadius,domNode:h.domNode,nodeLookup:h.nodeLookup,connectionMode:h.connectionMode,lib:"svelte",autoPanOnConnect:h.autoPanOnConnect,autoPanSpeed:h.autoPanSpeed,flowId:h.flowId,isValidConnection:e.isValidConnection||((...P)=>{var O;return((O=h.isValidConnection)==null?void 0:O.call(h,...P))??!0}),updateConnection:h.updateConnection,cancelConnection:h.cancelConnection,panBy:h.panBy,onConnect:L,onConnectStart:h.onconnectstart,onConnectEnd:(...P)=>{var O;return(O=h.onconnectend)==null?void 0:O.call(h,...P)},getTransform:()=>[h.viewport.x,h.viewport.y,h.viewport.zoom],getFromHandle:()=>h.connection.fromHandle,dragThreshold:h.connectionDragThreshold,handleDomNode:T.currentTarget})}function J(T){var ne,H;if(!u||!h.clickConnectStartHandle&&!s())return;if(!h.clickConnectStartHandle){(ne=h.onclickconnectstart)==null||ne.call(h,T,{nodeId:u,handleId:n(),handleType:r()}),h.clickConnectStartHandle={nodeId:u,type:r(),id:n()};return}const K=Fg(T.target),P=e.isValidConnection??h.isValidConnection,{connectionMode:O,clickConnectStartHandle:I,flowId:Q,nodeLookup:W}=h,{connection:Z,isValid:j}=Hv.isValid(T,{handle:{nodeId:u,id:n(),type:r()},connectionMode:O,fromNodeId:I.nodeId,fromHandleId:I.id??null,fromType:I.type,isValidConnection:P,flowId:Q,doc:K,lib:"svelte",nodeLookup:W});j&&Z&&L(Z);const ee=structuredClone(ph(h.connection));delete ee.inProgress,ee.toPosition=ee.toHandle?ee.toHandle.position:null,(H=h.onclickconnectend)==null||H.call(h,T,ee),h.clickConnectStartHandle=null}var ae=gC(),ke=()=>{};Ka(ae,()=>({"data-handleid":n(),"data-nodeid":u,"data-handlepos":a(),"data-id":`${h.flowId??""}-${u??""}-${n()??"null"??""}-${r()??""}`,class:["svelte-flow__handle",`svelte-flow__handle-${a()}`,h.noDragClass,h.noPanClass,a(),e.class],onmousedown:N,ontouchstart:N,onclick:h.clickConnect?J:void 0,onkeypress:ke,style:e.style,role:"button","aria-label":o(m)["handle.ariaLabel"],tabindex:"-1",...l,[Ca]:{valid:o(z),connectingto:o(G),connectingfrom:o(q),source:!o(v),target:o(v),connectablestart:s(),connectableend:i(),connectable:o(p),connectionindicator:o(p)&&(!o(D)||o(S))&&(o(D)||h.clickConnectStartHandle?i():s())}}));var X=_(ae);mr(X,()=>e.children??bs),C(t,ae),tt()}var mC=F("<!> <!>",1);function nm(t,e){et(e,!0);let n=Ae(e,"targetPosition",19,()=>_t.Top),r=Ae(e,"sourcePosition",19,()=>_t.Bottom);var a=mC(),s=We(a);qa(s,{type:"target",get position(){return n()}});var i=w(s),l=w(i);qa(l,{type:"source",get position(){return r()}}),se(()=>{var u;return te(i,` ${((u=e.data)==null?void 0:u.label)??""} `)}),C(t,a),tt()}var yC=F(" <!>",1);function _C(t,e){et(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"sourcePosition",19,()=>_t.Bottom);var a=yC(),s=We(a),i=w(s);qa(i,{type:"source",get position(){return r()}}),se(()=>{var l;return te(s,`${((l=n())==null?void 0:l.label)??""} `)}),C(t,a),tt()}var bC=F(" <!>",1);function wC(t,e){et(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"targetPosition",19,()=>_t.Top);var a=bC(),s=We(a),i=w(s);qa(i,{type:"target",get position(){return r()}}),se(()=>{var l;return te(s,`${((l=n())==null?void 0:l.label)??""} `)}),C(t,a),tt()}function xC(t,e){}function eu(t,e,n){if(!n||!e)return;const r=n==="root"?e:e.querySelector(`.svelte-flow__${n}`);r&&r.appendChild(t)}function tu(t,e){const n=$(Ts),r=$(()=>o(n).domNode);let a;return o(r)?eu(t,o(r),e):a=qh(()=>{On(()=>{eu(t,o(r),e),a==null||a()})}),{async update(s){eu(t,o(r),s)},destroy(){t.parentNode&&t.parentNode.removeChild(t),a==null||a()}}}function kC(){let t=Me(typeof window>"u");if(o(t)){const e=qh(()=>{On(()=>{M(t,!1),e==null||e()})})}return{get value(){return o(t)}}}const Uv=t=>fT(t),SC=t=>Lg(t);function $r(t){return t===void 0?void 0:`${t}px`}const Ol={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var EC=F("<div><!></div>");function AC(t,e){et(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"selectEdgeOnClick",3,!1),s=Ae(e,"transparent",3,!1),i=Ss(e,["$$slots","$$events","$$legacy","x","y","width","height","selectEdgeOnClick","transparent","class","children"]);const l=Ts(),u=hC("EdgeLabel must be used within a Custom Edge component");let f=$(()=>{var m;return(m=l.visible.edges.get(u))==null?void 0:m.zIndex});var v=EC(),p=()=>{a()&&u&&l.handleEdgeSelection(u)};Ka(v,m=>({class:["svelte-flow__edge-label",{transparent:s()},e.class],tabindex:"-1",onclick:p,...i,[ua]:m}),[()=>({display:kC().value?"none":void 0,cursor:a()?"pointer":void 0,transform:`translate(-50%, -50%) translate(${n()??""}px,${r()??""}px)`,"pointer-events":"all",width:$r(e.width),height:$r(e.height),"z-index":o(f)})],void 0,void 0,"svelte-1wg91mu");var h=_(v);mr(h,()=>e.children??bs),Yn(v,(m,x)=>tu==null?void 0:tu(m,x),()=>"edge-labels"),C(t,v),tt()}var TC=yn("<path></path>"),CC=yn('<path fill="none"></path><!><!>',1);function sc(t,e){let n=Ae(e,"interactionWidth",3,20),r=Ss(e,["$$slots","$$events","$$legacy","id","path","label","labelX","labelY","labelStyle","markerStart","markerEnd","style","interactionWidth","class"]);var a=CC(),s=We(a),i=w(s);{var l=v=>{var p=TC();Ka(p,()=>({d:e.path,"stroke-opacity":0,"stroke-width":n(),fill:"none",class:"svelte-flow__edge-interaction",...r})),C(v,p)};pe(i,v=>{n()>0&&v(l)})}var u=w(i);{var f=v=>{AC(v,{get x(){return e.labelX},get y(){return e.labelY},get style(){return e.labelStyle},selectEdgeOnClick:!0,children:(p,h)=>{var m=mn();se(()=>te(m,e.label)),C(p,m)},$$slots:{default:!0}})};pe(u,v=>{e.label&&v(f)})}se(()=>{bt(s,"id",e.id),bt(s,"d",e.path),It(s,0,xs(["svelte-flow__edge-path",e.class])),bt(s,"marker-start",e.markerStart),bt(s,"marker-end",e.markerEnd),Lt(s,e.style)}),C(t,a)}function rm(t,e){et(e,!0);let n=$(()=>{var l;return Vg({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,curvature:(l=e.pathOptions)==null?void 0:l.curvature})}),r=$(()=>io(o(n),3)),a=$(()=>o(r)[0]),s=$(()=>o(r)[1]),i=$(()=>o(r)[2]);sc(t,{get id(){return e.id},get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),tt()}function IC(t,e){et(e,!0);let n=$(()=>qd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition})),r=$(()=>io(o(n),3)),a=$(()=>o(r)[0]),s=$(()=>o(r)[1]),i=$(()=>o(r)[2]);sc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),tt()}function PC(t,e){et(e,!0);let n=$(()=>Gg({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY})),r=$(()=>io(o(n),3)),a=$(()=>o(r)[0]),s=$(()=>o(r)[1]),i=$(()=>o(r)[2]);sc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),tt()}function MC(t,e){et(e,!0);let n=$(()=>qd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,borderRadius:0})),r=$(()=>io(o(n),3)),a=$(()=>o(r)[0]),s=$(()=>o(r)[1]),i=$(()=>o(r)[2]);sc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),tt()}var ao,so;class OC{constructor(e,n){Pe(this,ao);Pe(this,so);xt(this,ao,e),xt(this,so,Ah(n))}get current(){return B(this,so).call(this),B(this,ao).call(this)}}ao=new WeakMap,so=new WeakMap;const NC=/\(.+\)/,RC=new Set(["all","print","screen","and","or","not","only"]);class DC extends OC{constructor(e,n){let r=NC.test(e)||e.split(/[\s,]+/).some(s=>RC.has(s.trim()))?e:`(${e})`;const a=window.matchMedia(r);super(()=>a.matches,s=>pu(a,"change",s))}}function LC(t,e,n,r){const a=new Map;return jd(t,{x:0,y:0,width:n,height:r},e,!0).forEach(s=>{a.set(s.id,s)}),a}function Gv(t){const{edges:e,defaultEdgeOptions:n,nodeLookup:r,previousEdges:a,connectionMode:s,onerror:i,onlyRenderVisible:l,elevateEdgesOnSelect:u,zIndexMode:f}=t,v=new Map;for(const p of e){const h=r.get(p.source),m=r.get(p.target);if(!h||!m)continue;if(l){const{visibleNodes:A,transform:D,width:q,height:G}=t;if(CT({sourceNode:h,targetNode:m,width:q,height:G,transform:D}))A.set(h.id,h),A.set(m.id,m);else continue}const x=a.get(p.id);if(x&&p===x.edge&&h==x.sourceNode&&m==x.targetNode){v.set(p.id,x);continue}const k=DT({id:p.id,sourceNode:h,targetNode:m,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:s,onError:i});k&&v.set(p.id,{...n,...p,...k,zIndex:TT({selected:p.selected,zIndex:p.zIndex??n.zIndex,sourceNode:h,targetNode:m,elevateOnSelect:u,zIndexMode:f}),sourceNode:h,targetNode:m,edge:p})}return v}const am={input:_C,output:wC,default:nm,group:xC},sm={straight:PC,smoothstep:IC,default:rm,step:MC};function zC(t,e,n,r,a,s){if(e&&!n&&r&&a){const i=tc(s,{filter:l=>!!((l.width||l.initialWidth)&&(l.height||l.initialHeight))});return Bd(i,r,a,.5,2,.1)}else return n??{x:0,y:0,zoom:1}}function jC(t){var n,r,a,s,i,l,u,f,v,p,h,m,x,k,A,D,q,G,S,z,L,N,J,ae,ke,X,T,K,P,O,I,Q,W,Z,j,ee,ne,H,U,le,Y,ue,_e,ge,re,Te,be,Ie,Ke,Xe,ft,vt,Le,Re,qe,Oe,Qe,ct,Je,st,nt,Ge,gt,ut,Nt,qt,wt,mt,yt,ot,ze,Mt,Rt,zt,Ne,Gt;class e{constructor(){Pe(this,n,$(()=>t.props.id??"1"));Pe(this,r,Me(null));Pe(this,a,Me(null));Pe(this,s,Me(t.width??0));Pe(this,i,Me(t.height??0));Pe(this,l,Me(t.props.zIndexMode??"basic"));Pe(this,u,$(()=>{var cn;const ye=FT(t.nodes,this.nodeLookup,this.parentLookup,{nodeExtent:this.nodeExtent,nodeOrigin:this.nodeOrigin,elevateNodesOnSelect:t.props.elevateNodesOnSelect??!0,checkEquality:!0,zIndexMode:this.zIndexMode});return this.fitViewQueued&&ye&&((cn=this.fitViewOptions)!=null&&cn.duration?this.resolveFitView():queueMicrotask(()=>{this.resolveFitView()})),ye}));Pe(this,f,$(()=>this.panZoom!==null));Pe(this,v,$(()=>(WT(this.connectionLookup,this.edgeLookup,t.edges),t.edges)));ht(this,"_prevSelectedNodes",[]);ht(this,"_prevSelectedNodeIds",new Set);Pe(this,p,$(()=>{const ye=this._prevSelectedNodeIds.size,cn=new Set,An=this.nodes.filter(St=>(St.selected&&(cn.add(St.id),this._prevSelectedNodeIds.delete(St.id)),St.selected));return(ye!==cn.size||this._prevSelectedNodeIds.size>0)&&(this._prevSelectedNodes=An),this._prevSelectedNodeIds=cn,this._prevSelectedNodes}));ht(this,"_prevSelectedEdges",[]);ht(this,"_prevSelectedEdgeIds",new Set);Pe(this,h,$(()=>{const ye=this._prevSelectedEdgeIds.size,cn=new Set,An=this.edges.filter(St=>(St.selected&&(cn.add(St.id),this._prevSelectedEdgeIds.delete(St.id)),St.selected));return(ye!==cn.size||this._prevSelectedEdgeIds.size>0)&&(this._prevSelectedEdges=An),this._prevSelectedEdgeIds=cn,this._prevSelectedEdges}));ht(this,"selectionChangeHandlers",new Map);ht(this,"nodeLookup",new Map);ht(this,"parentLookup",new Map);ht(this,"connectionLookup",new Map);ht(this,"edgeLookup",new Map);ht(this,"_prevVisibleEdges",new Map);Pe(this,m,$(()=>{const{nodes:ye,_edges:cn,_prevVisibleEdges:An,nodeLookup:St,connectionMode:Nn,onerror:Wt,onlyRenderVisibleElements:dt,defaultEdgeOptions:it,zIndexMode:Ft}=this;let lt,kt;const tn={edges:cn,defaultEdgeOptions:it,previousEdges:An,nodeLookup:St,connectionMode:Nn,elevateEdgesOnSelect:t.props.elevateEdgesOnSelect??!0,zIndexMode:Ft,onerror:Wt};if(dt){const{viewport:rn,width:Rn,height:Yt}=this,$t=[rn.x,rn.y,rn.zoom];lt=LC(St,$t,Rn,Yt),kt=Gv({...tn,onlyRenderVisible:!0,visibleNodes:lt,transform:$t,width:Rn,height:Yt})}else lt=this.nodeLookup,kt=Gv(tn);return{nodes:lt,edges:kt}}));Pe(this,x,$(()=>t.props.nodesDraggable??!0));Pe(this,k,$(()=>t.props.nodesConnectable??!0));Pe(this,A,$(()=>t.props.elementsSelectable??!0));Pe(this,D,$(()=>t.props.nodesFocusable??!0));Pe(this,q,$(()=>t.props.edgesFocusable??!0));Pe(this,G,$(()=>t.props.disableKeyboardA11y??!1));Pe(this,S,$(()=>t.props.minZoom??.5));Pe(this,z,$(()=>t.props.maxZoom??2));Pe(this,L,$(()=>t.props.nodeOrigin??[0,0]));Pe(this,N,$(()=>t.props.nodeExtent??Fu));Pe(this,J,$(()=>t.props.translateExtent??Fu));Pe(this,ae,$(()=>t.props.defaultEdgeOptions??{}));Pe(this,ke,$(()=>t.props.nodeDragThreshold??1));Pe(this,X,$(()=>t.props.autoPanOnNodeDrag??!0));Pe(this,T,$(()=>t.props.autoPanOnConnect??!0));Pe(this,K,$(()=>t.props.autoPanOnNodeFocus??!0));Pe(this,P,$(()=>t.props.autoPanSpeed??15));Pe(this,O,$(()=>t.props.connectionDragThreshold??1));ht(this,"fitViewQueued",t.props.fitView??!1);ht(this,"fitViewOptions",t.props.fitViewOptions);ht(this,"fitViewResolver",null);Pe(this,I,$(()=>t.props.snapGrid??null));Pe(this,Q,Me(!1));Pe(this,W,Me(null));Pe(this,Z,Me(!1));Pe(this,j,Me(!1));Pe(this,ee,Me(!1));Pe(this,ne,Me(!1));Pe(this,H,Me(!1));Pe(this,U,Me(null));Pe(this,le,Me(""));Pe(this,Y,$(()=>t.props.selectionMode??Tl.Partial));Pe(this,ue,$(()=>({...am,...t.props.nodeTypes})));Pe(this,_e,$(()=>({...sm,...t.props.edgeTypes})));Pe(this,ge,$(()=>t.props.noPanClass??"nopan"));Pe(this,re,$(()=>t.props.noDragClass??"nodrag"));Pe(this,Te,$(()=>t.props.noWheelClass??"nowheel"));Pe(this,be,$(()=>ST(t.props.ariaLabelConfig)));Pe(this,Ie,Me(zC(this.nodesInitialized,t.props.fitView,t.props.initialViewport,this.width,this.height,this.nodeLookup)));Pe(this,Ke,Me(Ku));Pe(this,Xe,$(()=>this._connection.inProgress?{...this._connection,to:xo(this._connection.to,[this.viewport.x,this.viewport.y,this.viewport.zoom])}:this._connection));Pe(this,ft,$(()=>t.props.connectionMode??ri.Strict));Pe(this,vt,$(()=>t.props.connectionRadius??20));Pe(this,Le,$(()=>t.props.isValidConnection??(()=>!0)));Pe(this,Re,$(()=>t.props.selectNodesOnDrag??!0));Pe(this,qe,$(()=>t.props.defaultMarkerColor===void 0?"#b1b1b7":t.props.defaultMarkerColor));Pe(this,Oe,$(()=>LT(t.edges,{defaultColor:this.defaultMarkerColor,id:this.flowId,defaultMarkerStart:this.defaultEdgeOptions.markerStart,defaultMarkerEnd:this.defaultEdgeOptions.markerEnd})));Pe(this,Qe,$(()=>t.props.onlyRenderVisibleElements??!1));Pe(this,ct,$(()=>t.props.onflowerror??_T));Pe(this,Je,$(()=>t.props.ondelete));Pe(this,st,$(()=>t.props.onbeforedelete));Pe(this,nt,$(()=>t.props.onbeforeconnect));Pe(this,Ge,$(()=>t.props.onconnect));Pe(this,gt,$(()=>t.props.onconnectstart));Pe(this,ut,$(()=>t.props.onconnectend));Pe(this,Nt,$(()=>t.props.onbeforereconnect));Pe(this,qt,$(()=>t.props.onreconnect));Pe(this,wt,$(()=>t.props.onreconnectstart));Pe(this,mt,$(()=>t.props.onreconnectend));Pe(this,yt,$(()=>t.props.clickConnect??!0));Pe(this,ot,$(()=>t.props.onclickconnectstart));Pe(this,ze,$(()=>t.props.onclickconnectend));Pe(this,Mt,Me(null));Pe(this,Rt,$(()=>t.props.onselectiondrag));Pe(this,zt,$(()=>t.props.onselectiondragstart));Pe(this,Ne,$(()=>t.props.onselectiondragstop));ht(this,"resolveFitView",async()=>{var ye;this.panZoom&&(await gT({nodes:this.nodeLookup,width:this.width,height:this.height,panZoom:this.panZoom,minZoom:this.minZoom,maxZoom:this.maxZoom},this.fitViewOptions),(ye=this.fitViewResolver)==null||ye.resolve(!0),this.fitViewQueued=!1,this.fitViewOptions=void 0,this.fitViewResolver=null)});ht(this,"_prefersDark",new DC("(prefers-color-scheme: dark)",t.props.colorModeSSR==="dark"));Pe(this,Gt,$(()=>t.props.colorMode==="system"?this._prefersDark.current?"dark":"light":t.props.colorMode??"light"))}get flowId(){return o(B(this,n))}set flowId(ye){M(B(this,n),ye)}get domNode(){return o(B(this,r))}set domNode(ye){M(B(this,r),ye)}get panZoom(){return o(B(this,a))}set panZoom(ye){M(B(this,a),ye)}get width(){return o(B(this,s))}set width(ye){M(B(this,s),ye)}get height(){return o(B(this,i))}set height(ye){M(B(this,i),ye)}get zIndexMode(){return o(B(this,l))}set zIndexMode(ye){M(B(this,l),ye)}get nodesInitialized(){return o(B(this,u))}set nodesInitialized(ye){M(B(this,u),ye)}get viewportInitialized(){return o(B(this,f))}set viewportInitialized(ye){M(B(this,f),ye)}get _edges(){return o(B(this,v))}set _edges(ye){M(B(this,v),ye)}get nodes(){return this.nodesInitialized,t.nodes}set nodes(ye){t.nodes=ye}get edges(){return this._edges}set edges(ye){t.edges=ye}get selectedNodes(){return o(B(this,p))}set selectedNodes(ye){M(B(this,p),ye)}get selectedEdges(){return o(B(this,h))}set selectedEdges(ye){M(B(this,h),ye)}get visible(){return o(B(this,m))}set visible(ye){M(B(this,m),ye)}get nodesDraggable(){return o(B(this,x))}set nodesDraggable(ye){M(B(this,x),ye)}get nodesConnectable(){return o(B(this,k))}set nodesConnectable(ye){M(B(this,k),ye)}get elementsSelectable(){return o(B(this,A))}set elementsSelectable(ye){M(B(this,A),ye)}get nodesFocusable(){return o(B(this,D))}set nodesFocusable(ye){M(B(this,D),ye)}get edgesFocusable(){return o(B(this,q))}set edgesFocusable(ye){M(B(this,q),ye)}get disableKeyboardA11y(){return o(B(this,G))}set disableKeyboardA11y(ye){M(B(this,G),ye)}get minZoom(){return o(B(this,S))}set minZoom(ye){M(B(this,S),ye)}get maxZoom(){return o(B(this,z))}set maxZoom(ye){M(B(this,z),ye)}get nodeOrigin(){return o(B(this,L))}set nodeOrigin(ye){M(B(this,L),ye)}get nodeExtent(){return o(B(this,N))}set nodeExtent(ye){M(B(this,N),ye)}get translateExtent(){return o(B(this,J))}set translateExtent(ye){M(B(this,J),ye)}get defaultEdgeOptions(){return o(B(this,ae))}set defaultEdgeOptions(ye){M(B(this,ae),ye)}get nodeDragThreshold(){return o(B(this,ke))}set nodeDragThreshold(ye){M(B(this,ke),ye)}get autoPanOnNodeDrag(){return o(B(this,X))}set autoPanOnNodeDrag(ye){M(B(this,X),ye)}get autoPanOnConnect(){return o(B(this,T))}set autoPanOnConnect(ye){M(B(this,T),ye)}get autoPanOnNodeFocus(){return o(B(this,K))}set autoPanOnNodeFocus(ye){M(B(this,K),ye)}get autoPanSpeed(){return o(B(this,P))}set autoPanSpeed(ye){M(B(this,P),ye)}get connectionDragThreshold(){return o(B(this,O))}set connectionDragThreshold(ye){M(B(this,O),ye)}get snapGrid(){return o(B(this,I))}set snapGrid(ye){M(B(this,I),ye)}get dragging(){return o(B(this,Q))}set dragging(ye){M(B(this,Q),ye)}get selectionRect(){return o(B(this,W))}set selectionRect(ye){M(B(this,W),ye)}get selectionKeyPressed(){return o(B(this,Z))}set selectionKeyPressed(ye){M(B(this,Z),ye)}get multiselectionKeyPressed(){return o(B(this,j))}set multiselectionKeyPressed(ye){M(B(this,j),ye)}get deleteKeyPressed(){return o(B(this,ee))}set deleteKeyPressed(ye){M(B(this,ee),ye)}get panActivationKeyPressed(){return o(B(this,ne))}set panActivationKeyPressed(ye){M(B(this,ne),ye)}get zoomActivationKeyPressed(){return o(B(this,H))}set zoomActivationKeyPressed(ye){M(B(this,H),ye)}get selectionRectMode(){return o(B(this,U))}set selectionRectMode(ye){M(B(this,U),ye)}get ariaLiveMessage(){return o(B(this,le))}set ariaLiveMessage(ye){M(B(this,le),ye)}get selectionMode(){return o(B(this,Y))}set selectionMode(ye){M(B(this,Y),ye)}get nodeTypes(){return o(B(this,ue))}set nodeTypes(ye){M(B(this,ue),ye)}get edgeTypes(){return o(B(this,_e))}set edgeTypes(ye){M(B(this,_e),ye)}get noPanClass(){return o(B(this,ge))}set noPanClass(ye){M(B(this,ge),ye)}get noDragClass(){return o(B(this,re))}set noDragClass(ye){M(B(this,re),ye)}get noWheelClass(){return o(B(this,Te))}set noWheelClass(ye){M(B(this,Te),ye)}get ariaLabelConfig(){return o(B(this,be))}set ariaLabelConfig(ye){M(B(this,be),ye)}get _viewport(){return o(B(this,Ie))}set _viewport(ye){M(B(this,Ie),ye)}get viewport(){return t.viewport??this._viewport}set viewport(ye){t.viewport&&(t.viewport=ye),this._viewport=ye}get _connection(){return o(B(this,Ke))}set _connection(ye){M(B(this,Ke),ye)}get connection(){return o(B(this,Xe))}set connection(ye){M(B(this,Xe),ye)}get connectionMode(){return o(B(this,ft))}set connectionMode(ye){M(B(this,ft),ye)}get connectionRadius(){return o(B(this,vt))}set connectionRadius(ye){M(B(this,vt),ye)}get isValidConnection(){return o(B(this,Le))}set isValidConnection(ye){M(B(this,Le),ye)}get selectNodesOnDrag(){return o(B(this,Re))}set selectNodesOnDrag(ye){M(B(this,Re),ye)}get defaultMarkerColor(){return o(B(this,qe))}set defaultMarkerColor(ye){M(B(this,qe),ye)}get markers(){return o(B(this,Oe))}set markers(ye){M(B(this,Oe),ye)}get onlyRenderVisibleElements(){return o(B(this,Qe))}set onlyRenderVisibleElements(ye){M(B(this,Qe),ye)}get onerror(){return o(B(this,ct))}set onerror(ye){M(B(this,ct),ye)}get ondelete(){return o(B(this,Je))}set ondelete(ye){M(B(this,Je),ye)}get onbeforedelete(){return o(B(this,st))}set onbeforedelete(ye){M(B(this,st),ye)}get onbeforeconnect(){return o(B(this,nt))}set onbeforeconnect(ye){M(B(this,nt),ye)}get onconnect(){return o(B(this,Ge))}set onconnect(ye){M(B(this,Ge),ye)}get onconnectstart(){return o(B(this,gt))}set onconnectstart(ye){M(B(this,gt),ye)}get onconnectend(){return o(B(this,ut))}set onconnectend(ye){M(B(this,ut),ye)}get onbeforereconnect(){return o(B(this,Nt))}set onbeforereconnect(ye){M(B(this,Nt),ye)}get onreconnect(){return o(B(this,qt))}set onreconnect(ye){M(B(this,qt),ye)}get onreconnectstart(){return o(B(this,wt))}set onreconnectstart(ye){M(B(this,wt),ye)}get onreconnectend(){return o(B(this,mt))}set onreconnectend(ye){M(B(this,mt),ye)}get clickConnect(){return o(B(this,yt))}set clickConnect(ye){M(B(this,yt),ye)}get onclickconnectstart(){return o(B(this,ot))}set onclickconnectstart(ye){M(B(this,ot),ye)}get onclickconnectend(){return o(B(this,ze))}set onclickconnectend(ye){M(B(this,ze),ye)}get clickConnectStartHandle(){return o(B(this,Mt))}set clickConnectStartHandle(ye){M(B(this,Mt),ye)}get onselectiondrag(){return o(B(this,Rt))}set onselectiondrag(ye){M(B(this,Rt),ye)}get onselectiondragstart(){return o(B(this,zt))}set onselectiondragstart(ye){M(B(this,zt),ye)}get onselectiondragstop(){return o(B(this,Ne))}set onselectiondragstop(ye){M(B(this,Ne),ye)}get colorMode(){return o(B(this,Gt))}set colorMode(ye){M(B(this,Gt),ye)}resetStoreValues(){this.dragging=!1,this.selectionRect=null,this.selectionRectMode=null,this.selectionKeyPressed=!1,this.multiselectionKeyPressed=!1,this.deleteKeyPressed=!1,this.panActivationKeyPressed=!1,this.zoomActivationKeyPressed=!1,this._connection=Ku,this.clickConnectStartHandle=null,this.viewport=t.props.initialViewport??{x:0,y:0,zoom:1},this.ariaLiveMessage=""}}return n=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,l=new WeakMap,u=new WeakMap,f=new WeakMap,v=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,x=new WeakMap,k=new WeakMap,A=new WeakMap,D=new WeakMap,q=new WeakMap,G=new WeakMap,S=new WeakMap,z=new WeakMap,L=new WeakMap,N=new WeakMap,J=new WeakMap,ae=new WeakMap,ke=new WeakMap,X=new WeakMap,T=new WeakMap,K=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,Q=new WeakMap,W=new WeakMap,Z=new WeakMap,j=new WeakMap,ee=new WeakMap,ne=new WeakMap,H=new WeakMap,U=new WeakMap,le=new WeakMap,Y=new WeakMap,ue=new WeakMap,_e=new WeakMap,ge=new WeakMap,re=new WeakMap,Te=new WeakMap,be=new WeakMap,Ie=new WeakMap,Ke=new WeakMap,Xe=new WeakMap,ft=new WeakMap,vt=new WeakMap,Le=new WeakMap,Re=new WeakMap,qe=new WeakMap,Oe=new WeakMap,Qe=new WeakMap,ct=new WeakMap,Je=new WeakMap,st=new WeakMap,nt=new WeakMap,Ge=new WeakMap,gt=new WeakMap,ut=new WeakMap,Nt=new WeakMap,qt=new WeakMap,wt=new WeakMap,mt=new WeakMap,yt=new WeakMap,ot=new WeakMap,ze=new WeakMap,Mt=new WeakMap,Rt=new WeakMap,zt=new WeakMap,Ne=new WeakMap,Gt=new WeakMap,new e}function Ts(){const t=Zu(Uu);if(!t)throw new Error("To call useStore outside of <SvelteFlow /> you need to wrap your component in a <SvelteFlowProvider />");return t.getStore()}const Uu=Symbol();function BC(t){const e=jC(t);function n(X){e.nodeTypes={...am,...X}}function r(X){e.edgeTypes={...sm,...X}}function a(X){e.edges=MT(X,e.edges)}const s=(X,T=!1)=>{e.nodes=e.nodes.map(K=>{if(e.connection.inProgress&&e.connection.fromNode.id===K.id){const O=e.nodeLookup.get(K.id);O&&(e.connection={...e.connection,from:_s(O,e.connection.fromHandle,_t.Left,!0)})}const P=X.get(K.id);return P?{...K,position:P.position,dragging:T}:K})};function i(X){var O,I,Q;const{changes:T,updatedInternals:K}=UT(X,e.nodeLookup,e.parentLookup,e.domNode,e.nodeOrigin,e.nodeExtent,e.zIndexMode);if(!K)return;BT(e.nodeLookup,e.parentLookup,{nodeOrigin:e.nodeOrigin,nodeExtent:e.nodeExtent,zIndexMode:e.zIndexMode}),e.fitViewQueued&&e.resolveFitView();const P=new Map;for(const W of T){const Z=(O=e.nodeLookup.get(W.id))==null?void 0:O.internals.userNode;if(!Z)continue;const j={...Z};switch(W.type){case"dimensions":{const ee={...j.measured,...W.dimensions};W.setAttributes&&(j.width=((I=W.dimensions)==null?void 0:I.width)??j.width,j.height=((Q=W.dimensions)==null?void 0:Q.height)??j.height),j.measured=ee;break}case"position":j.position=W.position??j.position;break}P.set(W.id,j)}e.nodes=e.nodes.map(W=>P.get(W.id)??W)}function l(X){const T=e.fitViewResolver??Promise.withResolvers();return e.fitViewQueued=!0,e.fitViewOptions=X,e.fitViewResolver=T,e.nodes=[...e.nodes],T.promise}async function u(X,T,K){const P=typeof(K==null?void 0:K.zoom)<"u"?K.zoom:e.maxZoom,O=e.panZoom;return O?(await O.setViewport({x:e.width/2-X*P,y:e.height/2-T*P,zoom:P},{duration:K==null?void 0:K.duration,ease:K==null?void 0:K.ease,interpolate:K==null?void 0:K.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)}function f(X,T){const K=e.panZoom;return K?K.scaleBy(X,T):Promise.resolve(!1)}function v(X){return f(1.2,X)}function p(X){return f(1/1.2,X)}function h(X){const T=e.panZoom;T&&(T.setScaleExtent([X,e.maxZoom]),e.minZoom=X)}function m(X){const T=e.panZoom;T&&(T.setScaleExtent([e.minZoom,X]),e.maxZoom=X)}function x(X){const T=e.panZoom;T&&(T.setTranslateExtent(X),e.translateExtent=X)}function k(X,T=null){let K=!1;const P=X.map(O=>(T?T.has(O.id):!0)&&O.selected?(K=!0,{...O,selected:!1}):O);return[K,P]}function A(X){const T=X!=null&&X.nodes?new Set(X.nodes.map(W=>W.id)):null,[K,P]=k(e.nodes,T);K&&(e.nodes=P);const O=X!=null&&X.edges?new Set(X.edges.map(W=>W.id)):null,[I,Q]=k(e.edges,O);I&&(e.edges=Q)}function D(X){const T=e.multiselectionKeyPressed;e.nodes=e.nodes.map(K=>{const P=X.includes(K.id),O=T&&K.selected||P;return!!K.selected!==O?{...K,selected:O}:K}),T||A({nodes:[]})}function q(X){const T=e.multiselectionKeyPressed;e.edges=e.edges.map(K=>{const P=X.includes(K.id),O=T&&K.selected||P;return!!K.selected!==O?{...K,selected:O}:K}),T||A({edges:[]})}function G(X,T,K){const P=e.nodeLookup.get(X);if(!P){console.warn("012",Qi.error012(X));return}e.selectionRect=null,e.selectionRectMode=null,P.selected?(T||P.selected&&e.multiselectionKeyPressed)&&(A({nodes:[P],edges:[]}),requestAnimationFrame(()=>K==null?void 0:K.blur())):D([X])}function S(X){const T=e.edgeLookup.get(X);if(!T){console.warn("012",Qi.error012(X));return}(T.selectable||e.elementsSelectable&&typeof T.selectable>"u")&&(e.selectionRect=null,e.selectionRectMode=null,T.selected?T.selected&&e.multiselectionKeyPressed&&A({nodes:[],edges:[T]}):q([X]))}function z(X,T){const{nodeExtent:K,snapGrid:P,nodeOrigin:O,nodeLookup:I,nodesDraggable:Q,onerror:W}=e,Z=new Map,j=(P==null?void 0:P[0])??5,ee=(P==null?void 0:P[1])??5,ne=X.x*j*T,H=X.y*ee*T;for(const U of I.values()){if(!(U.selected&&(U.draggable||Q&&typeof U.draggable>"u")))continue;let Y={x:U.internals.positionAbsolute.x+ne,y:U.internals.positionAbsolute.y+H};P&&(Y=wo(Y,P));const{position:ue,positionAbsolute:_e}=zg({nodeId:U.id,nextPosition:Y,nodeLookup:I,nodeExtent:K,nodeOrigin:O,onError:W});U.position=ue,U.internals.positionAbsolute=_e,Z.set(U.id,U)}s(Z)}function L(X){return GT({delta:X,panZoom:e.panZoom,transform:[e.viewport.x,e.viewport.y,e.viewport.zoom],translateExtent:e.translateExtent,width:e.width,height:e.height})}const N=X=>{e._connection={...X}};function J(){e._connection=Ku}function ae(){e.resetStoreValues(),A()}return Object.assign(e,{setNodeTypes:n,setEdgeTypes:r,addEdge:a,updateNodePositions:s,updateNodeInternals:i,zoomIn:v,zoomOut:p,fitView:l,setCenter:u,setMinZoom:h,setMaxZoom:m,setTranslateExtent:x,unselectNodesAndEdges:A,addSelectedNodes:D,addSelectedEdges:q,handleNodeSelection:G,handleEdgeSelection:S,moveSelectedNodes:z,panBy:L,updateConnection:N,cancelConnection:J,reset:ae})}function nu(t,e){const{minZoom:n,maxZoom:r,initialViewport:a,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:l,translateExtent:u,setPanZoomInstance:f,onDraggingChange:v,onTransformChange:p}=e,h=cC({domNode:t,minZoom:n,maxZoom:r,translateExtent:u,viewport:a,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:v}),m=h.getViewport();return(a.x!==m.x||a.y!==m.y||a.zoom!==m.zoom)&&p([m.x,m.y,m.zoom]),f(h),h.update(e),{update(x){h.update(x)}}}var qC=F('<div class="svelte-flow__zoom svelte-flow__container"><!></div>');function FC(t,e){et(e,!0);let n=Ae(e,"store",15),r=$(()=>n().panActivationKeyPressed||e.panOnDrag),a=$(()=>n().panActivationKeyPressed||e.panOnScroll);const{viewport:s}=n();let i=!1;On(()=>{var f;!i&&n().viewportInitialized&&((f=e.oninit)==null||f.call(e),i=!0)});var l=qC(),u=_(l);mr(u,()=>e.children),Yn(l,(f,v)=>nu==null?void 0:nu(f,v),()=>({viewport:n().viewport,minZoom:n().minZoom,maxZoom:n().maxZoom,initialViewport:s,onDraggingChange:f=>{n(n().dragging=f,!0)},setPanZoomInstance:f=>{n(n().panZoom=f,!0)},onPanZoomStart:e.onmovestart,onPanZoom:e.onmove,onPanZoomEnd:e.onmoveend,zoomOnScroll:e.zoomOnScroll,zoomOnDoubleClick:e.zoomOnDoubleClick,zoomOnPinch:e.zoomOnPinch,panOnScroll:o(a),panOnDrag:o(r),panOnScrollSpeed:e.panOnScrollSpeed,panOnScrollMode:e.panOnScrollMode,zoomActivationKeyPressed:n().zoomActivationKeyPressed,preventScrolling:typeof e.preventScrolling=="boolean"?e.preventScrolling:!0,noPanClassName:n().noPanClass,noWheelClassName:n().noWheelClass,userSelectionActive:!!n().selectionRect,translateExtent:n().translateExtent,lib:"svelte",paneClickDistance:e.paneClickDistance,selectionOnDrag:e.selectionOnDrag,onTransformChange:f=>{n(n().viewport={x:f[0],y:f[1],zoom:f[2]},!0)},connectionInProgress:n().connection.inProgress})),C(t,l),tt()}function Wv(t,e){return n=>{n.target===e&&(t==null||t(n))}}function Yv(t){return e=>{const n=t.has(e.id);return!!e.selected!==n?{...e,selected:n}:e}}function Xv(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}var KC=F("<div><!></div>");function HC(t,e){et(e,!0);let n=Ae(e,"store",15),r=Ae(e,"panOnDrag",3,!0),a=Ae(e,"paneClickDistance",3,1),s,i=null,l=new Set,u=new Set,f=$(()=>n().panActivationKeyPressed||r()),v=$(()=>n().selectionKeyPressed||!!n().selectionRect||e.selectionOnDrag&&o(f)!==!0),p=$(()=>n().elementsSelectable&&(o(v)||n().selectionRectMode==="user")),h=!1;function m(J){var P,O;if(i=s==null?void 0:s.getBoundingClientRect(),!i)return;const ae=J.target===s,ke=!ae&&!!J.target.closest(".nokey"),X=e.selectionOnDrag&&ae||n().selectionKeyPressed;if(ke||!o(v)||!X||J.button!==0||!J.isPrimary)return;(O=(P=J.target)==null?void 0:P.setPointerCapture)==null||O.call(P,J.pointerId),h=!1;const{x:T,y:K}=Mr(J,i);n(n().selectionRect={width:0,height:0,startX:T,startY:K,x:T,y:K},!0),ae||(J.stopPropagation(),J.preventDefault())}function x(J){var I;if(!o(v)||!i||!n().selectionRect)return;const ae=Mr(J,i),{startX:ke=0,startY:X=0}=n().selectionRect;if(!h){const Q=n().selectionKeyPressed?0:a();if(Math.hypot(ae.x-ke,ae.y-X)<=Q)return;n().unselectNodesAndEdges(),(I=e.onselectionstart)==null||I.call(e,J)}h=!0;const T={...n().selectionRect,x:ae.x<ke?ae.x:ke,y:ae.y<X?ae.y:X,width:Math.abs(ae.x-ke),height:Math.abs(ae.y-X)},K=l,P=u;l=new Set(jd(n().nodeLookup,T,[n().viewport.x,n().viewport.y,n().viewport.zoom],n().selectionMode===Tl.Partial,!0).map(Q=>Q.id));const O=n().defaultEdgeOptions.selectable??!0;u=new Set;for(const Q of l){const W=n().connectionLookup.get(Q);if(W)for(const{edgeId:Z}of W.values()){const j=n().edgeLookup.get(Z);j&&(j.selectable??O)&&u.add(Z)}}Xv(K,l)||n(n().nodes=n().nodes.map(Yv(l)),!0),Xv(P,u)||n(n().edges=n().edges.map(Yv(u)),!0),n(n().selectionRectMode="user",!0),n(n().selectionRect=T,!0)}function k(J){var ae,ke,X;J.button===0&&((ke=(ae=J.target)==null?void 0:ae.releasePointerCapture)==null||ke.call(ae,J.pointerId),!h&&J.target===s&&(q==null||q(J)),n(n().selectionRect=null,!0),h&&n(n().selectionRectMode=l.size>0?"nodes":null,!0),h&&((X=e.onselectionend)==null||X.call(e,J)))}const A=J=>{var ae;if(Array.isArray(o(f))&&o(f).includes(2)){J.preventDefault();return}(ae=e.onpanecontextmenu)==null||ae.call(e,{event:J})},D=J=>{h&&(J.stopPropagation(),h=!1)};function q(J){var ae;if(h||n().connection.inProgress){h=!1;return}(ae=e.onpaneclick)==null||ae.call(e,{event:J}),n().unselectNodesAndEdges(),n(n().selectionRectMode=null,!0),n(n().selectionRect=null,!0)}var G=KC();let S;var z=$(()=>o(p)?void 0:Wv(q,s));G.__click=function(...J){var ae;(ae=o(z))==null||ae.apply(this,J)},G.__pointermove=function(...J){var ae;(ae=o(p)?x:void 0)==null||ae.apply(this,J)},G.__pointerup=function(...J){var ae;(ae=o(p)?k:void 0)==null||ae.apply(this,J)};var L=$(()=>Wv(A,s));G.__contextmenu=function(...J){var ae;(ae=o(L))==null||ae.apply(this,J)};var N=_(G);mr(N,()=>e.children),ks(G,J=>s=J,()=>s),se(J=>S=It(G,1,"svelte-flow__pane svelte-flow__container",null,S,J),[()=>({draggable:r()===!0||Array.isArray(r())&&r().includes(0),dragging:n().dragging,selection:o(v)})]),fl("pointerdown",G,function(...J){var ae;(ae=o(p)?m:void 0)==null||ae.apply(this,J)},!0),fl("click",G,function(...J){var ae;(ae=o(p)?D:void 0)==null||ae.apply(this,J)},!0),C(t,G),tt()}Jt(["click","pointermove","pointerup","contextmenu"]);var VC=F('<div class="svelte-flow__viewport xyflow__viewport svelte-flow__container"><!></div>');function UC(t,e){et(e,!0);var n=VC();let r;var a=_(n);mr(a,()=>e.children),se(()=>r=Lt(n,"",r,{transform:`translate(${e.store.viewport.x??""}px, ${e.store.viewport.y??""}px) scale(${e.store.viewport.zoom??""})`})),C(t,n),tt()}function Fs(t,e){const{store:n,onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i}=e,l=ZT({onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i,getStoreItems:()=>{const{snapGrid:f,viewport:v}=n;return{nodes:n.nodes,nodeLookup:n.nodeLookup,edges:n.edges,nodeExtent:n.nodeExtent,snapGrid:f||[0,0],snapToGrid:!!f,nodeOrigin:n.nodeOrigin,multiSelectionActive:n.multiselectionKeyPressed,domNode:n.domNode,transform:[v.x,v.y,v.zoom],autoPanOnNodeDrag:n.autoPanOnNodeDrag,nodesDraggable:n.nodesDraggable,selectNodesOnDrag:n.selectNodesOnDrag,nodeDragThreshold:n.nodeDragThreshold,unselectNodesAndEdges:n.unselectNodesAndEdges,updateNodePositions:n.updateNodePositions,onSelectionDrag:n.onselectiondrag,onSelectionDragStart:n.onselectiondragstart,onSelectionDragStop:n.onselectiondragstop,panBy:n.panBy}}});function u(f,v){if(v.disabled){l.destroy();return}l.update({domNode:f,noDragClassName:v.noDragClass,handleSelector:v.handleSelector,nodeId:v.nodeId,isSelectable:v.isSelectable,nodeClickDistance:v.nodeClickDistance})}return u(t,e),{update(f){u(t,f)},destroy(){l.destroy()}}}var GC=F('<div aria-live="assertive" aria-atomic="true" class="a11y-live-msg svelte-13pq11u"> </div>'),WC=F('<div class="a11y-hidden svelte-13pq11u"> </div> <div class="a11y-hidden svelte-13pq11u"> </div> <!>',1);function YC(t,e){et(e,!0);var n=WC(),r=We(n),a=_(r),s=w(r,2),i=_(s),l=w(s,2);{var u=f=>{var v=GC(),p=_(v);se(()=>{bt(v,"id",`${XC}-${e.store.flowId}`),te(p,e.store.ariaLiveMessage)}),C(f,v)};pe(l,f=>{e.store.disableKeyboardA11y||f(u)})}se(()=>{bt(r,"id",`${im}-${e.store.flowId}`),te(a,e.store.disableKeyboardA11y?e.store.ariaLabelConfig["node.a11yDescription.default"]:e.store.ariaLabelConfig["node.a11yDescription.keyboardDisabled"]),bt(s,"id",`${om}-${e.store.flowId}`),te(i,e.store.ariaLabelConfig["edge.a11yDescription.default"])}),C(t,n),tt()}const im="svelte-flow__node-desc",om="svelte-flow__edge-desc",XC="svelte-flow__aria-live";var ZC=F("<div><!></div>");function QC(t,e){et(e,!0);let n=Ae(e,"store",15),r=$(()=>Bn(e.node.data,()=>({}),!0)),a=$(()=>Bn(e.node.selected,!1)),s=$(()=>e.node.draggable),i=$(()=>e.node.selectable),l=$(()=>Bn(e.node.deletable,!0)),u=$(()=>e.node.connectable),f=$(()=>e.node.focusable),v=$(()=>Bn(e.node.hidden,!1)),p=$(()=>Bn(e.node.dragging,!1)),h=$(()=>Bn(e.node.style,"")),m=$(()=>e.node.class),x=$(()=>Bn(e.node.type,"default")),k=$(()=>e.node.parentId),A=$(()=>e.node.sourcePosition),D=$(()=>e.node.targetPosition),q=$(()=>Bn(e.node.measured,()=>({width:0,height:0}),!0).width),G=$(()=>Bn(e.node.measured,()=>({width:0,height:0}),!0).height),S=$(()=>e.node.initialWidth),z=$(()=>e.node.initialHeight),L=$(()=>e.node.width),N=$(()=>e.node.height),J=$(()=>e.node.dragHandle),ae=$(()=>Bn(e.node.internals.z,0)),ke=$(()=>e.node.internals.positionAbsolute.x),X=$(()=>e.node.internals.positionAbsolute.y),T=$(()=>e.node.internals.userNode),{id:K}=e.node,P=$(()=>o(s)??n().nodesDraggable),O=$(()=>o(i)??n().elementsSelectable),I=$(()=>o(u)??n().nodesConnectable),Q=$(()=>xT(e.node)),W=$(()=>!!e.node.internals.handleBounds),Z=$(()=>o(Q)&&o(W)),j=$(()=>o(f)??n().nodesFocusable);function ee(Le){return n().parentLookup.has(Le)}let ne=$(()=>ee(K)),H=Me(null),U=null,le=o(x),Y=o(A),ue=o(D),_e=$(()=>n().nodeTypes[o(x)]??nm),ge=$(()=>n().ariaLabelConfig),re={get value(){return o(I)}};dC(K),vC(re);let Te=$(()=>{const Le=o(q)===void 0?o(L)??o(S):o(L),Re=o(G)===void 0?o(N)??o(z):o(N);if(!(Le===void 0&&Re===void 0&&o(h)===void 0))return`${o(h)};${Le?`width:${$r(Le)};`:""}${Re?`height:${$r(Re)};`:""}`});On(()=>{(o(x)!==le||o(A)!==Y||o(D)!==ue)&&o(H)!==null&&requestAnimationFrame(()=>{o(H)!==null&&n().updateNodeInternals(new Map([[K,{id:K,nodeElement:o(H),force:!0}]]))}),le=o(x),Y=o(A),ue=o(D)}),On(()=>{e.resizeObserver&&(!o(Z)||o(H)!==U)&&(U&&e.resizeObserver.unobserve(U),o(H)&&e.resizeObserver.observe(o(H)),U=o(H))}),cd(()=>{var Le;U&&((Le=e.resizeObserver)==null||Le.unobserve(U))});function be(Le){var Re;o(O)&&(!n().selectNodesOnDrag||!o(P)||n().nodeDragThreshold>0)&&n().handleNodeSelection(K),(Re=e.onnodeclick)==null||Re.call(e,{node:o(T),event:Le})}function Ie(Le){if(!(Kg(Le)||n().disableKeyboardA11y))if(Dg.includes(Le.key)&&o(O)){const Re=Le.key==="Escape";n().handleNodeSelection(K,Re,o(H))}else o(P)&&e.node.selected&&Object.prototype.hasOwnProperty.call(Ol,Le.key)&&(Le.preventDefault(),n(n().ariaLiveMessage=o(ge)["node.a11yDescription.ariaLiveMessage"]({direction:Le.key.replace("Arrow","").toLowerCase(),x:~~e.node.internals.positionAbsolute.x,y:~~e.node.internals.positionAbsolute.y}),!0),n().moveSelectedNodes(Ol[Le.key],Le.shiftKey?4:1))}const Ke=()=>{var Qe;if(n().disableKeyboardA11y||!n().autoPanOnNodeFocus||!((Qe=o(H))!=null&&Qe.matches(":focus-visible")))return;const{width:Le,height:Re,viewport:qe}=n();jd(new Map([[K,e.node]]),{x:0,y:0,width:Le,height:Re},[qe.x,qe.y,qe.zoom],!0).length>0||n().setCenter(e.node.position.x+(e.node.measured.width??0)/2,e.node.position.y+(e.node.measured.height??0)/2,{zoom:qe.zoom})};var Xe=ln(),ft=We(Xe);{var vt=Le=>{var Re=ZC();Ka(Re,()=>({"data-id":K,class:["svelte-flow__node",`svelte-flow__node-${o(x)}`,o(m)],style:o(Te),onclick:be,onpointerenter:e.onnodepointerenter?Oe=>e.onnodepointerenter({node:o(T),event:Oe}):void 0,onpointerleave:e.onnodepointerleave?Oe=>e.onnodepointerleave({node:o(T),event:Oe}):void 0,onpointermove:e.onnodepointermove?Oe=>e.onnodepointermove({node:o(T),event:Oe}):void 0,oncontextmenu:e.onnodecontextmenu?Oe=>e.onnodecontextmenu({node:o(T),event:Oe}):void 0,onkeydown:o(j)?Ie:void 0,onfocus:o(j)?Ke:void 0,tabIndex:o(j)?0:void 0,role:e.node.ariaRole??(o(j)?"group":void 0),"aria-roledescription":"node","aria-describedby":n().disableKeyboardA11y?void 0:`${im}-${n().flowId}`,...e.node.domAttributes,[Ca]:{dragging:o(p),selected:o(a),draggable:o(P),connectable:o(I),selectable:o(O),nopan:o(P),parent:o(ne)},[ua]:{"z-index":o(ae),transform:`translate(${o(ke)??""}px, ${o(X)??""}px)`,visibility:o(Q)?"visible":"hidden"}}));var qe=_(Re);ld(qe,()=>o(_e),(Oe,Qe)=>{Qe(Oe,{get data(){return o(r)},get id(){return K},get selected(){return o(a)},get selectable(){return o(O)},get deletable(){return o(l)},get sourcePosition(){return o(A)},get targetPosition(){return o(D)},get zIndex(){return o(ae)},get dragging(){return o(p)},get draggable(){return o(P)},get dragHandle(){return o(J)},get parentId(){return o(k)},get type(){return o(x)},get isConnectable(){return o(I)},get positionAbsoluteX(){return o(ke)},get positionAbsoluteY(){return o(X)},get width(){return o(L)},get height(){return o(N)}})}),Yn(Re,(Oe,Qe)=>Fs==null?void 0:Fs(Oe,Qe),()=>({nodeId:K,isSelectable:o(O),disabled:!o(P),handleSelector:o(J),noDragClass:n().noDragClass,nodeClickDistance:e.nodeClickDistance,onNodeMouseDown:n().handleNodeSelection,onDrag:(Oe,Qe,ct,Je)=>{var st;(st=e.onnodedrag)==null||st.call(e,{event:Oe,targetNode:ct,nodes:Je})},onDragStart:(Oe,Qe,ct,Je)=>{var st;(st=e.onnodedragstart)==null||st.call(e,{event:Oe,targetNode:ct,nodes:Je})},onDragStop:(Oe,Qe,ct,Je)=>{var st;(st=e.onnodedragstop)==null||st.call(e,{event:Oe,targetNode:ct,nodes:Je})},store:n()})),ks(Re,Oe=>M(H,Oe),()=>o(H)),C(Le,Re)};pe(ft,Le=>{o(v)||Le(vt)})}C(t,Xe),tt()}var JC=F('<div class="svelte-flow__nodes"></div>');function $C(t,e){et(e,!0);let n=Ae(e,"store",15);const r=typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const i=new Map;s.forEach(l=>{const u=l.target.getAttribute("data-id");i.set(u,{id:u,nodeElement:l.target,force:!0})}),n().updateNodeInternals(i)});cd(()=>{r==null||r.disconnect()});var a=JC();Tt(a,21,()=>n().visible.nodes.values(),s=>s.id,(s,i)=>{QC(s,{get node(){return o(i)},get resizeObserver(){return r},get nodeClickDistance(){return e.nodeClickDistance},get onnodeclick(){return e.onnodeclick},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get onnodecontextmenu(){return e.onnodecontextmenu},get store(){return n()},set store(l){n(l)}})}),C(t,a),tt()}var eI=yn('<svg class="svelte-flow__edge-wrapper"><g><!></g></svg>');function tI(t,e){et(e,!0);let n=$(()=>e.edge.id),r=$(()=>e.edge.source),a=$(()=>e.edge.target),s=$(()=>e.edge.sourceX),i=$(()=>e.edge.sourceY),l=$(()=>e.edge.targetX),u=$(()=>e.edge.targetY),f=$(()=>e.edge.sourcePosition),v=$(()=>e.edge.targetPosition),p=$(()=>Bn(e.edge.animated,!1)),h=$(()=>Bn(e.edge.selected,!1)),m=$(()=>e.edge.label),x=$(()=>e.edge.labelStyle),k=$(()=>Bn(e.edge.data,()=>({}),!0)),A=$(()=>e.edge.style),D=$(()=>e.edge.interactionWidth),q=$(()=>Bn(e.edge.type,"default")),G=$(()=>e.edge.sourceHandle),S=$(()=>e.edge.targetHandle),z=$(()=>e.edge.markerStart),L=$(()=>e.edge.markerEnd),N=$(()=>e.edge.selectable),J=$(()=>e.edge.focusable),ae=$(()=>Bn(e.edge.deletable,!0)),ke=$(()=>e.edge.hidden),X=$(()=>e.edge.zIndex),T=$(()=>e.edge.class),K=$(()=>e.edge.ariaLabel);pC(o(n));let P=null,O=$(()=>o(N)??e.store.elementsSelectable),I=$(()=>o(J)??e.store.edgesFocusable),Q=$(()=>e.store.edgeTypes[o(q)]??rm),W=$(()=>o(z)?`url('#${Vu(o(z),e.store.flowId)}')`:void 0),Z=$(()=>o(L)?`url('#${Vu(o(L),e.store.flowId)}')`:void 0);function j(Y){var _e;const ue=e.store.edgeLookup.get(o(n));ue&&(o(O)&&e.store.handleEdgeSelection(o(n)),(_e=e.onedgeclick)==null||_e.call(e,{event:Y,edge:ue}))}function ee(Y,ue){const _e=e.store.edgeLookup.get(o(n));_e&&ue({event:Y,edge:_e})}function ne(Y){if(!e.store.disableKeyboardA11y&&Dg.includes(Y.key)&&o(O)){const{unselectNodesAndEdges:ue,addSelectedEdges:_e}=e.store;Y.key==="Escape"?(P==null||P.blur(),ue({edges:[e.edge]})):_e([o(n)])}}var H=ln(),U=We(H);{var le=Y=>{var ue=eI();let _e;var ge=_(ue);Ka(ge,()=>({class:["svelte-flow__edge",o(T)],"data-id":o(n),onclick:j,oncontextmenu:e.onedgecontextmenu?Te=>{ee(Te,e.onedgecontextmenu)}:void 0,onpointerenter:e.onedgepointerenter?Te=>{ee(Te,e.onedgepointerenter)}:void 0,onpointerleave:e.onedgepointerleave?Te=>{ee(Te,e.onedgepointerleave)}:void 0,"aria-label":o(K)===null?void 0:o(K)?o(K):`Edge from ${o(r)} to ${o(a)}`,"aria-describedby":o(I)?`${om}-${e.store.flowId}`:void 0,role:e.edge.ariaRole??(o(I)?"group":"img"),"aria-roledescription":"edge",onkeydown:o(I)?ne:void 0,tabindex:o(I)?0:void 0,...e.edge.domAttributes,[Ca]:{animated:o(p),selected:o(h),selectable:o(O)}}));var re=_(ge);ld(re,()=>o(Q),(Te,be)=>{be(Te,{get id(){return o(n)},get source(){return o(r)},get target(){return o(a)},get sourceX(){return o(s)},get sourceY(){return o(i)},get targetX(){return o(l)},get targetY(){return o(u)},get sourcePosition(){return o(f)},get targetPosition(){return o(v)},get animated(){return o(p)},get selected(){return o(h)},get label(){return o(m)},get labelStyle(){return o(x)},get data(){return o(k)},get style(){return o(A)},get interactionWidth(){return o(D)},get selectable(){return o(O)},get deletable(){return o(ae)},get type(){return o(q)},get sourceHandleId(){return o(G)},get targetHandleId(){return o(S)},get markerStart(){return o(W)},get markerEnd(){return o(Z)}})}),ks(ge,Te=>P=Te,()=>P),se(()=>_e=Lt(ue,"",_e,{"z-index":o(X)})),C(Y,ue)};pe(U,Y=>{o(ke)||Y(le)})}C(t,H),tt()}ly();var nI=yn("<defs></defs>");function rI(t,e){et(e,!1);const n=Ts();f_();var r=nI();Tt(r,5,()=>n.markers,a=>a.id,(a,s)=>{oI(a,Ls(()=>o(s)))}),C(t,r),tt()}var aI=yn('<polyline class="arrow" fill="none" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4"></polyline>'),sI=yn('<polyline class="arrowclosed" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4 -5,-4"></polyline>'),iI=yn('<marker class="svelte-flow__arrowhead" viewBox="-10 -10 20 20" refX="0" refY="0"><!></marker>');function oI(t,e){et(e,!0);let n=Ae(e,"width",3,12.5),r=Ae(e,"height",3,12.5),a=Ae(e,"markerUnits",3,"strokeWidth"),s=Ae(e,"orient",3,"auto-start-reverse"),i=Ae(e,"color",3,"none");var l=iI(),u=_(l);{var f=p=>{var h=aI();let m;se(()=>{bt(h,"stroke-width",e.strokeWidth),m=Lt(h,"",m,{stroke:i()})}),C(p,h)},v=p=>{var h=sI();let m;se(()=>{bt(h,"stroke-width",e.strokeWidth),m=Lt(h,"",m,{stroke:i(),fill:i()})}),C(p,h)};pe(u,p=>{e.type===Cl.Arrow?p(f):e.type===Cl.ArrowClosed&&p(v,1)})}se(()=>{bt(l,"id",e.id),bt(l,"markerWidth",`${n()}`),bt(l,"markerHeight",`${r()}`),bt(l,"markerUnits",a()),bt(l,"orient",s())}),C(t,l),tt()}var lI=F('<div class="svelte-flow__edges"><svg class="svelte-flow__marker"><!></svg> <!></div>');function cI(t,e){et(e,!0);let n=Ae(e,"store",15);var r=lI(),a=_(r),s=_(a);rI(s,{});var i=w(a,2);Tt(i,17,()=>n().visible.edges.values(),l=>l.id,(l,u)=>{tI(l,{get edge(){return o(u)},get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return n()},set store(f){n(f)}})}),C(t,r),tt()}var uI=F('<div class="svelte-flow__selection svelte-1vr3gfi"></div>');function lm(t,e){et(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"width",3,0),s=Ae(e,"height",3,0),i=Ae(e,"isVisible",3,!0);var l=ln(),u=We(l);{var f=v=>{var p=uI();let h;se(m=>h=Lt(p,"",h,m),[()=>({width:typeof a()=="string"?a():$r(a()),height:typeof s()=="string"?s():$r(s()),transform:`translate(${n()}px, ${r()}px)`})]),C(v,p)};pe(u,v=>{i()&&v(f)})}C(t,l),tt()}var dI=F("<div><!></div>");function fI(t,e){et(e,!0);let n=Me(void 0);On(()=>{var p;e.store.disableKeyboardA11y||(p=o(n))==null||p.focus({preventScroll:!0})});let r=$(()=>{if(e.store.selectionRectMode==="nodes"){e.store.nodes;const p=tc(e.store.nodeLookup,{filter:h=>!!h.selected});if(p.width>0&&p.height>0)return p}return null});function a(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectioncontextmenu)==null||m.call(e,{nodes:h,event:p})}function s(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectionclick)==null||m.call(e,{nodes:h,event:p})}function i(p){Object.prototype.hasOwnProperty.call(Ol,p.key)&&(p.preventDefault(),e.store.moveSelectedNodes(Ol[p.key],p.shiftKey?4:1))}var l=ln(),u=We(l);{var f=p=>{var h=dI();h.__contextmenu=a,h.__click=s,h.__keydown=function(...k){var A;(A=e.store.disableKeyboardA11y?void 0:i)==null||A.apply(this,k)};let m;var x=_(h);lm(x,{width:"100%",height:"100%",x:0,y:0}),Yn(h,(k,A)=>Fs==null?void 0:Fs(k,A),()=>({disabled:!1,store:e.store,onDrag:(k,A,D,q)=>{var G;(G=e.onnodedrag)==null||G.call(e,{event:k,targetNode:null,nodes:q})},onDragStart:(k,A,D,q)=>{var G;(G=e.onnodedragstart)==null||G.call(e,{event:k,targetNode:null,nodes:q})},onDragStop:(k,A,D,q)=>{var G;(G=e.onnodedragstop)==null||G.call(e,{event:k,targetNode:null,nodes:q})}})),ks(h,k=>M(n,k),()=>o(n)),se(k=>{It(h,1,xs(["svelte-flow__selection-wrapper",e.store.noPanClass]),"svelte-sf2y5e"),bt(h,"role",e.store.disableKeyboardA11y?void 0:"button"),bt(h,"tabindex",e.store.disableKeyboardA11y?void 0:-1),m=Lt(h,"",m,k)},[()=>({width:$r(o(r).width),height:$r(o(r).height),transform:`translate(${o(r).x??""}px, ${o(r).y??""}px)`})]),C(p,h)},v=$(()=>e.store.selectionRectMode==="nodes"&&o(r)&&pa(o(r).x)&&pa(o(r).y));pe(u,p=>{o(v)&&p(f)})}C(t,l),tt()}Jt(["contextmenu","click","keydown"]);function vI(t){switch(t){case"ctrl":return 8;case"shift":return 4;case"alt":return 2;case"meta":return 1}}function Qt(t,e){let{enabled:n=!0,trigger:r,type:a="keydown"}=e;function s(l){var v;const u=Array.isArray(r)?r:[r],f=[l.metaKey,l.altKey,l.shiftKey,l.ctrlKey].reduce((p,h,m)=>h?p|1<<m:p,0);for(const p of u){const h={preventDefault:!1,enabled:!0,...p},{modifier:m,key:x,callback:k,preventDefault:A,enabled:D}=h;if(D){if(l.key!==x)continue;if(m===null||m===!1){if(f!==0)continue}else if(m!==void 0&&((v=m==null?void 0:m[0])==null?void 0:v.length)>0){const G=Array.isArray(m)?m:[m];let S=!1;for(const z of G)if((Array.isArray(z)?z:[z]).reduce((N,J)=>N|vI(J),0)===f){S=!0;break}if(!S)continue}A&&l.preventDefault();const q={node:t,trigger:h,originalEvent:l};t.dispatchEvent(new CustomEvent("shortcut",{detail:q})),k==null||k(q)}}}let i;return n&&(i=pu(t,a,s)),{update:l=>{const{enabled:u=!0,type:f="keydown"}=l;n&&(!u||a!==f)?i==null||i():!n&&u&&(i=pu(t,f,s)),n=u,a=f,r=l.trigger},destroy:()=>{i==null||i()}}}function hI(){const t=$(Ts),e=s=>{var f,v;const i=Uv(s)?s:o(t).nodeLookup.get(s.id),l=i.parentId?kT(i.position,i.measured,i.parentId,o(t).nodeLookup,o(t).nodeOrigin):i.position,u={...i,position:l,width:((f=i.measured)==null?void 0:f.width)??i.width,height:((v=i.measured)==null?void 0:v.height)??i.height};return si(u)};function n(s,i,l={replace:!1}){o(t).nodes=$n(()=>o(t).nodes).map(u=>{if(u.id===s){const f=typeof i=="function"?i(u):i;return l!=null&&l.replace&&Uv(f)?f:{...u,...f}}return u})}function r(s,i,l={replace:!1}){o(t).edges=$n(()=>o(t).edges).map(u=>{if(u.id===s){const f=typeof i=="function"?i(u):i;return l.replace&&SC(f)?f:{...u,...f}}return u})}const a=s=>o(t).nodeLookup.get(s);return{zoomIn:o(t).zoomIn,zoomOut:o(t).zoomOut,getInternalNode:a,getNode:s=>{var i;return(i=a(s))==null?void 0:i.internals.userNode},getNodes:s=>s===void 0?o(t).nodes:Zv(o(t).nodeLookup,s),getEdge:s=>o(t).edgeLookup.get(s),getEdges:s=>s===void 0?o(t).edges:Zv(o(t).edgeLookup,s),setZoom:(s,i)=>{const l=o(t).panZoom;return l?l.scaleTo(s,{duration:i==null?void 0:i.duration}):Promise.resolve(!1)},getZoom:()=>o(t).viewport.zoom,setViewport:async(s,i)=>{const l=o(t).viewport;return o(t).panZoom?(await o(t).panZoom.setViewport({x:s.x??l.x,y:s.y??l.y,zoom:s.zoom??l.zoom},i),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>ph(o(t).viewport),setCenter:async(s,i,l)=>o(t).setCenter(s,i,l),fitView:s=>o(t).fitView(s),fitBounds:async(s,i)=>{if(!o(t).panZoom)return Promise.resolve(!1);const l=Bd(s,o(t).width,o(t).height,o(t).minZoom,o(t).maxZoom,(i==null?void 0:i.padding)??.1);return await o(t).panZoom.setViewport(l,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)},getIntersectingNodes:(s,i=!0,l)=>{const u=Nv(s),f=u?s:e(s);return f?(l||o(t).nodes).filter(v=>{const p=o(t).nodeLookup.get(v.id);if(!p||!u&&v.id===s.id)return!1;const h=si(p),m=Ji(h,f);return i&&m>0||m>=h.width*h.height||m>=f.width*f.height}):[]},isNodeIntersecting:(s,i,l=!0)=>{const f=Nv(s)?s:e(s);if(!f)return!1;const v=Ji(f,i);return l&&v>0||v>=i.width*i.height||v>=f.width*f.height},deleteElements:async({nodes:s=[],edges:i=[]})=>{var f,v;const{nodes:l,edges:u}=await mT({nodesToRemove:s,edgesToRemove:i,nodes:o(t).nodes,edges:o(t).edges,onBeforeDelete:o(t).onbeforedelete});return l&&(o(t).nodes=$n(()=>o(t).nodes).filter(p=>!l.some(({id:h})=>h===p.id))),u&&(o(t).edges=$n(()=>o(t).edges).filter(p=>!u.some(({id:h})=>h===p.id))),(l.length>0||u.length>0)&&((v=(f=o(t)).ondelete)==null||v.call(f,{nodes:l,edges:u})),{deletedNodes:l,deletedEdges:u}},screenToFlowPosition:(s,i={snapToGrid:!0})=>{if(!o(t).domNode)return s;const l=i.snapToGrid?o(t).snapGrid:!1,{x:u,y:f,zoom:v}=o(t).viewport,{x:p,y:h}=o(t).domNode.getBoundingClientRect(),m={x:s.x-p,y:s.y-h};return xo(m,[u,f,v],l!==null,l||[1,1])},flowToScreenPosition:s=>{if(!o(t).domNode)return s;const{x:i,y:l,zoom:u}=o(t).viewport,{x:f,y:v}=o(t).domNode.getBoundingClientRect(),p=Pl(s,[i,l,u]);return{x:p.x+f,y:p.y+v}},toObject:()=>structuredClone({nodes:[...o(t).nodes],edges:[...o(t).edges],viewport:{...o(t).viewport}}),updateNode:n,updateNodeData:(s,i,l)=>{var v;const u=(v=o(t).nodeLookup.get(s))==null?void 0:v.internals.userNode;if(!u)return;const f=typeof i=="function"?i(u):i;n(s,p=>({...p,data:l!=null&&l.replace?f:{...p.data,...f}}))},updateEdge:r,getNodesBounds:s=>vT(s,{nodeLookup:o(t).nodeLookup,nodeOrigin:o(t).nodeOrigin}),getHandleConnections:({type:s,id:i,nodeId:l})=>{var u;return Array.from(((u=o(t).connectionLookup.get(`${l}-${s}-${i??null}`))==null?void 0:u.values())??[])}}}function Zv(t,e){var r;const n=[];for(const a of e){const s=t.get(a);if(s){const i="internals"in s?(r=s.internals)==null?void 0:r.userNode:s;n.push(i)}}return n}function pI(t,e){et(e,!0);let n=Ae(e,"store",15),r=Ae(e,"selectionKey",3,"Shift"),a=Ae(e,"multiSelectionKey",19,()=>Ml()?"Meta":"Control"),s=Ae(e,"deleteKey",3,"Backspace"),i=Ae(e,"panActivationKey",3," "),l=Ae(e,"zoomActivationKey",19,()=>Ml()?"Meta":"Control"),{deleteElements:u}=hI();function f(k){return k!==null&&typeof k=="object"}function v(k){return f(k)?k.modifier||[]:[]}function p(k){return k==null?"":f(k)?k.key:k}function h(k,A){return(Array.isArray(k)?k:[k]).map(q=>{const G=p(q);return{key:G,modifier:v(q),enabled:G!==null,callback:A}})}function m(){n(n().selectionRect=null,!0),n(n().selectionKeyPressed=!1,!0),n(n().multiselectionKeyPressed=!1,!0),n(n().deleteKeyPressed=!1,!0),n(n().panActivationKeyPressed=!1,!0),n(n().zoomActivationKeyPressed=!1,!0)}function x(){const k=n().nodes.filter(D=>D.selected),A=n().edges.filter(D=>D.selected);u({nodes:k,edges:A})}fl("blur",Gn,m),fl("contextmenu",Gn,m),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!0,!0)),type:"keydown"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!1,!0)),type:"keyup"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(a(),()=>{n(n().multiselectionKeyPressed=!0,!0)}),type:"keydown"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(a(),()=>n(n().multiselectionKeyPressed=!1,!0)),type:"keyup"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(s(),k=>{!(k.originalEvent.ctrlKey||k.originalEvent.metaKey||k.originalEvent.shiftKey)&&!Kg(k.originalEvent)&&(n(n().deleteKeyPressed=!0,!0),x())}),type:"keydown"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(s(),()=>n(n().deleteKeyPressed=!1,!0)),type:"keyup"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!0,!0)),type:"keydown"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!1,!0)),type:"keyup"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!0,!0)),type:"keydown"})),Yn(Gn,(k,A)=>Qt==null?void 0:Qt(k,A),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!1,!0)),type:"keyup"})),tt()}var gI=yn('<path fill="none" class="svelte-flow__connection-path"></path>'),mI=yn('<svg class="svelte-flow__connectionline"><g><!></g></svg>');function yI(t,e){et(e,!0);let n=$(()=>{if(!e.store.connection.inProgress)return"";const i={sourceX:e.store.connection.from.x,sourceY:e.store.connection.from.y,sourcePosition:e.store.connection.fromPosition,targetX:e.store.connection.to.x,targetY:e.store.connection.to.y,targetPosition:e.store.connection.toPosition};switch(e.type){case Ia.Bezier:{const[l]=Vg(i);return l}case Ia.Straight:{const[l]=Gg(i);return l}case Ia.Step:case Ia.SmoothStep:{const[l]=qd({...i,borderRadius:e.type===Ia.Step?0:void 0});return l}}});var r=ln(),a=We(r);{var s=i=>{var l=mI(),u=_(l),f=_(u);{var v=h=>{var m=ln(),x=We(m);ld(x,()=>e.LineComponent,(k,A)=>{A(k,{})}),C(h,m)},p=h=>{var m=gI();se(()=>{bt(m,"d",o(n)),Lt(m,e.style)}),C(h,m)};pe(f,h=>{e.LineComponent?h(v):h(p,!1)})}se(h=>{bt(l,"width",e.store.width),bt(l,"height",e.store.height),Lt(l,e.containerStyle),It(u,0,h)},[()=>xs(["svelte-flow__connection",dT(e.store.connection.isValid)])]),C(i,l)};pe(a,i=>{e.store.connection.inProgress&&i(s)})}C(t,r),tt()}var _I=F("<div><!></div>");function cm(t,e){et(e,!0);let n=Ae(e,"position",3,"top-right"),r=Ss(e,["$$slots","$$events","$$legacy","position","style","class","children"]),a=$(()=>`${n()}`.split("-"));var s=_I();Ka(s,l=>({class:l,style:e.style,...r}),[()=>["svelte-flow__panel",e.class,...o(a)]]);var i=_(s);mr(i,()=>e.children??bs),C(t,s),tt()}var bI=F('<a href="https://svelteflow.dev" target="_blank" rel="noopener noreferrer" aria-label="Svelte Flow attribution">Svelte Flow</a>');function wI(t,e){et(e,!0);let n=Ae(e,"position",3,"bottom-right");var r=ln(),a=We(r);{var s=i=>{cm(i,{get position(){return n()},class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",children:(l,u)=>{var f=bI();C(l,f)},$$slots:{default:!0}})};pe(a,i=>{var l;(l=e.proOptions)!=null&&l.hideAttribution||i(s)})}C(t,r),tt()}var xI=F("<div><!></div>");function kI(t,e){et(e,!0);let n=Ae(e,"domNode",15),r=Ae(e,"clientWidth",15),a=Ae(e,"clientHeight",15),s=$(()=>e.rest.class),i=$(()=>qy(e.rest,["id","class","nodeTypes","edgeTypes","colorMode","isValidConnection","onmove","onmovestart","onmoveend","onflowerror","ondelete","onbeforedelete","onbeforeconnect","onconnect","onconnectstart","onconnectend","onbeforereconnect","onreconnect","onreconnectstart","onreconnectend","onclickconnectstart","onclickconnectend","oninit","onselectionchange","onselectiondragstart","onselectiondrag","onselectiondragstop","onselectionstart","onselectionend","clickConnect","fitView","fitViewOptions","nodeOrigin","nodeDragThreshold","connectionDragThreshold","minZoom","maxZoom","initialViewport","connectionRadius","connectionMode","selectionMode","selectNodesOnDrag","snapGrid","defaultMarkerColor","translateExtent","nodeExtent","onlyRenderVisibleElements","autoPanOnConnect","autoPanOnNodeDrag","colorModeSSR","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","elementsSelectable","nodesFocusable","edgesFocusable","disableKeyboardA11y","noDragClass","noPanClass","noWheelClass","ariaLabelConfig","autoPanSpeed","panOnScrollSpeed","zIndexMode"]));function l(v){v.currentTarget.scrollTo({top:0,left:0,behavior:"auto"}),e.rest.onscroll&&e.rest.onscroll(v)}var u=xI();Ka(u,v=>({class:["svelte-flow","svelte-flow__container",o(s),e.colorMode],"data-testid":"svelte-flow__wrapper",role:"application",onscroll:l,...o(i),[ua]:v}),[()=>({width:$r(e.width),height:$r(e.height)})],void 0,void 0,"svelte-mkap6j");var f=_(u);mr(f,()=>e.children??bs),ks(u,v=>n(v),()=>n()),Rf(u,"clientHeight",a),Rf(u,"clientWidth",r),C(t,u),tt()}var SI=F('<div class="svelte-flow__viewport-back svelte-flow__container"></div> <!> <div class="svelte-flow__edge-labels svelte-flow__container"></div> <!> <!> <!> <div class="svelte-flow__viewport-front svelte-flow__container"></div>',1),EI=F("<!> <!>",1),AI=F("<!> <!> <!> <!> <!>",1);function TI(t,e){et(e,!0);let n=Ae(e,"paneClickDistance",3,1),r=Ae(e,"nodeClickDistance",3,1),a=Ae(e,"panOnScrollMode",19,()=>qs.Free),s=Ae(e,"preventScrolling",3,!0),i=Ae(e,"zoomOnScroll",3,!0),l=Ae(e,"zoomOnDoubleClick",3,!0),u=Ae(e,"zoomOnPinch",3,!0),f=Ae(e,"panOnScroll",3,!1),v=Ae(e,"panOnScrollSpeed",3,.5),p=Ae(e,"panOnDrag",3,!0),h=Ae(e,"selectionOnDrag",3,!1),m=Ae(e,"connectionLineType",19,()=>Ia.Bezier),x=Ae(e,"nodes",31,()=>en([])),k=Ae(e,"edges",31,()=>en([])),A=Ae(e,"viewport",15,void 0),D=Ss(e,["$$slots","$$events","$$legacy","width","height","proOptions","selectionKey","deleteKey","panActivationKey","multiSelectionKey","zoomActivationKey","paneClickDistance","nodeClickDistance","onmovestart","onmoveend","onmove","oninit","onnodeclick","onnodecontextmenu","onnodedrag","onnodedragstart","onnodedragstop","onnodepointerenter","onnodepointermove","onnodepointerleave","onselectionclick","onselectioncontextmenu","onselectionstart","onselectionend","onedgeclick","onedgecontextmenu","onedgepointerenter","onedgepointerleave","onpaneclick","onpanecontextmenu","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnDrag","selectionOnDrag","connectionLineComponent","connectionLineStyle","connectionLineContainerStyle","connectionLineType","attributionPosition","children","nodes","edges","viewport"]),q=BC({props:D,width:e.width,height:e.height,get nodes(){return x()},set nodes(S){x(S)},get edges(){return k()},set edges(S){k(S)},get viewport(){return A()},set viewport(S){A(S)}});const G=Zu(Uu);G&&G.setStore&&G.setStore(q),gh(Uu,{provider:!1,getStore(){return q}}),On(()=>{var z;const S={nodes:q.selectedNodes,edges:q.selectedEdges};(z=$n(()=>e.onselectionchange))==null||z(S);for(const L of q.selectionChangeHandlers.values())L(S)}),cd(()=>{q.reset()}),kI(t,{get colorMode(){return q.colorMode},get width(){return e.width},get height(){return e.height},get rest(){return D},get domNode(){return q.domNode},set domNode(S){q.domNode=S},get clientWidth(){return q.width},set clientWidth(S){q.width=S},get clientHeight(){return q.height},set clientHeight(S){q.height=S},children:(S,z)=>{var L=AI(),N=We(L);pI(N,{get selectionKey(){return e.selectionKey},get deleteKey(){return e.deleteKey},get panActivationKey(){return e.panActivationKey},get multiSelectionKey(){return e.multiSelectionKey},get zoomActivationKey(){return e.zoomActivationKey},get store(){return q},set store(T){q=T}});var J=w(N,2);FC(J,{get panOnScrollMode(){return a()},get preventScrolling(){return s()},get zoomOnScroll(){return i()},get zoomOnDoubleClick(){return l()},get zoomOnPinch(){return u()},get panOnScroll(){return f()},get panOnScrollSpeed(){return v()},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get onmovestart(){return e.onmovestart},get onmove(){return e.onmove},get onmoveend(){return e.onmoveend},get oninit(){return e.oninit},get store(){return q},set store(T){q=T},children:(T,K)=>{HC(T,{get onpaneclick(){return e.onpaneclick},get onpanecontextmenu(){return e.onpanecontextmenu},get onselectionstart(){return e.onselectionstart},get onselectionend(){return e.onselectionend},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get store(){return q},set store(P){q=P},children:(P,O)=>{var I=EI(),Q=We(I);UC(Q,{get store(){return q},set store(Z){q=Z},children:(Z,j)=>{var ee=SI(),ne=w(We(ee),2);cI(ne,{get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return q},set store(Y){q=Y}});var H=w(ne,4);yI(H,{get type(){return m()},get LineComponent(){return e.connectionLineComponent},get containerStyle(){return e.connectionLineContainerStyle},get style(){return e.connectionLineStyle},get store(){return q},set store(Y){q=Y}});var U=w(H,2);$C(U,{get nodeClickDistance(){return r()},get onnodeclick(){return e.onnodeclick},get onnodecontextmenu(){return e.onnodecontextmenu},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return q},set store(Y){q=Y}});var le=w(U,2);fI(le,{get onselectionclick(){return e.onselectionclick},get onselectioncontextmenu(){return e.onselectioncontextmenu},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return q},set store(Y){q=Y}}),C(Z,ee)},$$slots:{default:!0}});var W=w(Q,2);{let Z=$(()=>!!(q.selectionRect&&q.selectionRectMode==="user")),j=$(()=>{var U;return(U=q.selectionRect)==null?void 0:U.width}),ee=$(()=>{var U;return(U=q.selectionRect)==null?void 0:U.height}),ne=$(()=>{var U;return(U=q.selectionRect)==null?void 0:U.x}),H=$(()=>{var U;return(U=q.selectionRect)==null?void 0:U.y});lm(W,{get isVisible(){return o(Z)},get width(){return o(j)},get height(){return o(ee)},get x(){return o(ne)},get y(){return o(H)}})}C(P,I)},$$slots:{default:!0}})},$$slots:{default:!0}});var ae=w(J,2);wI(ae,{get proOptions(){return e.proOptions},get position(){return e.attributionPosition}});var ke=w(ae,2);YC(ke,{get store(){return q}});var X=w(ke,2);mr(X,()=>e.children??bs),C(S,L)},$$slots:{default:!0}}),tt()}var CI=F("<button><!></button>");function Qo(t,e){let n=Ss(e,["$$slots","$$events","$$legacy","class","bgColor","bgColorHover","color","colorHover","borderColor","onclick","children"]);var r=CI();Ka(r,()=>({type:"button",onclick:e.onclick,class:["svelte-flow__controls-button",e.class],...n,[ua]:{"--xy-controls-button-background-color-props":e.bgColor,"--xy-controls-button-background-color-hover-props":e.bgColorHover,"--xy-controls-button-color-props":e.color,"--xy-controls-button-color-hover-props":e.colorHover,"--xy-controls-button-border-color-props":e.borderColor}}));var a=_(r);mr(a,()=>e.children??bs),C(t,r)}var II=yn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"></path></svg>');function PI(t){var e=II();C(t,e)}var MI=yn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 5"><path d="M0 0h32v4.2H0z"></path></svg>');function OI(t){var e=MI();C(t,e)}var NI=yn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 30"><path d="M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"></path></svg>');function RI(t){var e=NI();C(t,e)}var DI=yn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"></path></svg>');function LI(t){var e=DI();C(t,e)}var zI=yn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"></path></svg>');function jI(t){var e=zI();C(t,e)}var BI=F("<!> <!>",1),qI=F("<!> <!> <!> <!> <!> <!>",1);function FI(t,e){et(e,!0);let n=Ae(e,"position",3,"bottom-left"),r=Ae(e,"orientation",3,"vertical"),a=Ae(e,"showZoom",3,!0),s=Ae(e,"showFitView",3,!0),i=Ae(e,"showLock",3,!0),l=Ss(e,["$$slots","$$events","$$legacy","position","orientation","showZoom","showFitView","showLock","style","class","buttonBgColor","buttonBgColorHover","buttonColor","buttonColorHover","buttonBorderColor","fitViewOptions","children","before","after"]),u=$(Ts);const f={bgColor:e.buttonBgColor,bgColorHover:e.buttonBgColorHover,color:e.buttonColor,colorHover:e.buttonColorHover,borderColor:e.buttonBorderColor};let v=$(()=>o(u).nodesDraggable||o(u).nodesConnectable||o(u).elementsSelectable),p=$(()=>o(u).viewport.zoom<=o(u).minZoom),h=$(()=>o(u).viewport.zoom>=o(u).maxZoom),m=$(()=>o(u).ariaLabelConfig),x=$(()=>r()==="horizontal"?"horizontal":"vertical");const k=()=>{o(u).zoomIn()},A=()=>{o(u).zoomOut()},D=()=>{o(u).fitView(e.fitViewOptions)},q=()=>{let G=!o(v);o(u).nodesDraggable=G,o(u).nodesConnectable=G,o(u).elementsSelectable=G};{let G=$(()=>["svelte-flow__controls",o(x),e.class]);cm(t,Ls({get class(){return o(G)},get position(){return n()},"data-testid":"svelte-flow__controls",get"aria-label"(){return o(m)["controls.ariaLabel"]},get style(){return e.style}},()=>l,{children:(S,z)=>{var L=qI(),N=We(L);{var J=Z=>{var j=ln(),ee=We(j);mr(ee,()=>e.before),C(Z,j)};pe(N,Z=>{e.before&&Z(J)})}var ae=w(N,2);{var ke=Z=>{var j=BI(),ee=We(j);Qo(ee,Ls({onclick:k,class:"svelte-flow__controls-zoomin",get title(){return o(m)["controls.zoomIn.ariaLabel"]},get"aria-label"(){return o(m)["controls.zoomIn.ariaLabel"]},get disabled(){return o(h)}},()=>f,{children:(H,U)=>{PI(H)},$$slots:{default:!0}}));var ne=w(ee,2);Qo(ne,Ls({onclick:A,class:"svelte-flow__controls-zoomout",get title(){return o(m)["controls.zoomOut.ariaLabel"]},get"aria-label"(){return o(m)["controls.zoomOut.ariaLabel"]},get disabled(){return o(p)}},()=>f,{children:(H,U)=>{OI(H)},$$slots:{default:!0}})),C(Z,j)};pe(ae,Z=>{a()&&Z(ke)})}var X=w(ae,2);{var T=Z=>{Qo(Z,Ls({class:"svelte-flow__controls-fitview",onclick:D,get title(){return o(m)["controls.fitView.ariaLabel"]},get"aria-label"(){return o(m)["controls.fitView.ariaLabel"]}},()=>f,{children:(j,ee)=>{RI(j)},$$slots:{default:!0}}))};pe(X,Z=>{s()&&Z(T)})}var K=w(X,2);{var P=Z=>{Qo(Z,Ls({class:"svelte-flow__controls-interactive",onclick:q,get title(){return o(m)["controls.interactive.ariaLabel"]},get"aria-label"(){return o(m)["controls.interactive.ariaLabel"]}},()=>f,{children:(j,ee)=>{var ne=ln(),H=We(ne);{var U=Y=>{jI(Y)},le=Y=>{LI(Y)};pe(H,Y=>{o(v)?Y(U):Y(le,!1)})}C(j,ne)},$$slots:{default:!0}}))};pe(K,Z=>{i()&&Z(P)})}var O=w(K,2);{var I=Z=>{var j=ln(),ee=We(j);mr(ee,()=>e.children),C(Z,j)};pe(O,Z=>{e.children&&Z(I)})}var Q=w(O,2);{var W=Z=>{var j=ln(),ee=We(j);mr(ee,()=>e.after),C(Z,j)};pe(Q,Z=>{e.after&&Z(W)})}C(S,L)},$$slots:{default:!0}}))}tt()}var La;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(La||(La={}));var KI=yn("<circle></circle>");function HI(t,e){var n=KI();se(()=>{bt(n,"cx",e.radius),bt(n,"cy",e.radius),bt(n,"r",e.radius),It(n,0,xs(["svelte-flow__background-pattern","dots",e.class]))}),C(t,n)}var VI=yn("<path></path>");function UI(t,e){et(e,!0);var n=VI();se(()=>{bt(n,"stroke-width",e.lineWidth),bt(n,"d",`M${e.dimensions[0]/2} 0 V${e.dimensions[1]} M0 ${e.dimensions[1]/2} H${e.dimensions[0]}`),It(n,0,xs(["svelte-flow__background-pattern",e.variant,e.class]))}),C(t,n),tt()}const GI={[La.Dots]:1,[La.Lines]:1,[La.Cross]:6};var WI=yn('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function YI(t,e){et(e,!0);let n=Ae(e,"variant",19,()=>La.Dots),r=Ae(e,"gap",3,20),a=Ae(e,"lineWidth",3,1),s=$(Ts),i=$(()=>n()===La.Dots),l=$(()=>n()===La.Cross),u=$(()=>Array.isArray(r())?r():[r(),r()]),f=$(()=>`background-pattern-${o(s).flowId}-${e.id??""}`),v=$(()=>[o(u)[0]*o(s).viewport.zoom||1,o(u)[1]*o(s).viewport.zoom||1]),p=$(()=>(e.size??GI[n()])*o(s).viewport.zoom),h=$(()=>o(l)?[o(p),o(p)]:o(v)),m=$(()=>o(i)?[o(p)/2,o(p)/2]:[o(h)[0]/2,o(h)[1]/2]);var x=WI();let k;var A=_(x),D=_(A);{var q=z=>{{let L=$(()=>o(p)/2);HI(z,{get radius(){return o(L)},get class(){return e.patternClass}})}},G=z=>{UI(z,{get dimensions(){return o(h)},get variant(){return n()},get lineWidth(){return a()},get class(){return e.patternClass}})};pe(D,z=>{o(i)?z(q):z(G,!1)})}var S=w(A);se(()=>{It(x,0,xs(["svelte-flow__background","svelte-flow__container",e.class])),k=Lt(x,"",k,{"--xy-background-color-props":e.bgColor,"--xy-background-pattern-color-props":e.patternColor}),bt(A,"id",o(f)),bt(A,"x",o(s).viewport.x%o(v)[0]),bt(A,"y",o(s).viewport.y%o(v)[1]),bt(A,"width",o(v)[0]),bt(A,"height",o(v)[1]),bt(A,"patternTransform",`translate(-${o(m)[0]},-${o(m)[1]})`),bt(S,"fill",`url(#${o(f)})`)}),C(t,x),tt()}var XI=F('<div class="trigger-node svelte-a1pdcu"><div class="trigger-header svelte-a1pdcu"><span class="icon">â¡</span> Trigger</div> <div class="trigger-body svelte-a1pdcu"><div class="label svelte-a1pdcu"> </div> <div class="group svelte-a1pdcu"> </div></div> <!></div>');function ZI(t,e){et(e,!0);let n=$(()=>Nr[e.data.group]||Nr.INFO);var r=XI();let a;var s=_(r);let i;var l=w(s,2),u=_(l),f=_(u),v=w(u,2);let p;var h=_(v),m=w(l,2);qa(m,{type:"source",get position(){return _t.Right}}),se(()=>{a=Lt(r,"",a,{"border-color":o(n).color}),i=Lt(s,"",i,{background:o(n).color}),te(f,`Event: ${e.data.label??""}`),p=Lt(v,"",p,{color:o(n).color}),te(h,o(n).label)}),C(t,r),tt()}var QI=F('<div class="binding svelte-1bgwygg"> </div>'),JI=F('<div class="binding unbound svelte-1bgwygg">unbound</div>'),$I=F('<div class="action-node svelte-1bgwygg"><!> <div class="action-header svelte-1bgwygg"><span class="icon svelte-1bgwygg"> </span> </div> <div class="action-body svelte-1bgwygg"><div class="desc svelte-1bgwygg"> </div> <!></div> <div class="action-footer svelte-1bgwygg"><button title="Edit" class="svelte-1bgwygg">âï¸ Edit</button> <button title="Delete" class="danger svelte-1bgwygg">ðï¸</button></div> <!></div>');function eP(t,e){et(e,!0);let n=$(()=>e.data.cmd);var r=$I(),a=_(r);qa(a,{type:"target",get position(){return _t.Left}});var s=w(a,2),i=_(s),l=_(i),u=w(i),f=w(s,2),v=_(f),p=_(v),h=w(v,2);{var m=G=>{var S=QI(),z=_(S);se(()=>te(z,`${o(n).pluginId??""}Â·${o(n).commandId??""}`)),C(G,S)},x=G=>{var S=JI();C(G,S)};pe(h,G=>{o(n).pluginId&&o(n).commandId?G(m):G(x,!1)})}var k=w(f,2),A=_(k);A.__click=function(...G){var S;(S=e.data.onEdit)==null||S.apply(this,G)};var D=w(A,2);D.__click=function(...G){var S;(S=e.data.onDelete)==null||S.apply(this,G)};var q=w(k,2);qa(q,{type:"source",get position(){return _t.Right}}),se(()=>{te(l,o(n).icon||"âï¸"),te(u,` ${o(n).name??""}`),bt(v,"title",o(n).description),te(p,o(n).description)}),C(t,r),tt()}Jt(["click"]);var tP=F('<button class="add-node svelte-w8wqxx" title="Add next action"><!> <div class="plus svelte-w8wqxx">+</div></button>');function nP(t,e){et(e,!0);var n=tP();n.__click=function(...a){var s;(s=e.data.onClick)==null||s.apply(this,a)};var r=_(n);qa(r,{type:"target",get position(){return _t.Left},style:"opacity: 0"}),C(t,n),tt()}Jt(["click"]);var rP=F('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),aP=F('<span class="type-group-chip svelte-d25j4l"> </span>'),sP=F('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),iP=F("<button> </button>"),oP=F("<!> <!>",1),lP=F('<span class="picker-tile-added svelte-d25j4l">â added</span>'),cP=F('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),uP=F('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),dP=F('<div class="floating-panel picker-panel svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Add Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="action-picker svelte-d25j4l"><!> <div class="picker-custom-row svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">+ Create Custom Action</button> <span class="picker-hint svelte-d25j4l" style="margin-left: 0.5rem;">Link to any plugin command</span></div></div></div>'),fP=F("<option> </option>"),vP=F("<optgroup></optgroup>"),hP=F('<div class="floating-panel editor-panel-inner svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Edit Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-row svelte-d25j4l"><select class="plugin-select svelte-d25j4l"><option>-- Select Plugin Command --</option><!></select></div> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div></div>'),pP=F('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button></div> <div class="canvas-wrapper svelte-d25j4l"><!> <!> <!></div>',1),gP=F('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),mP=F('<p class="svelte-d25j4l">Select an event type on the left to view and edit its visual graph.</p>'),yP=F('<div class="no-selection svelte-d25j4l"><!></div>'),_P=F('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">n8n-like visual graph editor</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function bP(t,e){et(e,!0);const n={trigger:ZI,action:eP,add:nP};let r=Ae(e,"open",15,!1),a=Me(en([])),s=Me(en({})),i=Me(en({})),l=Me(null),u=Me("INFO"),f=Me(en([])),v=Me(null),p=Me(!1),h=Me(""),m=Me(!1),x=Me([]),k=Me([]);const A=[{pluginId:"gmail",pluginName:"Gmail",actions:zp("gmail")}],D={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function q(){M(a,await eb(),!0);const j={};await Promise.all(o(a).map(async ee=>{j[ee]=(await Bc(ee)).length})),M(s,j,!0),M(i,await nb(),!0),o(l)&&(M(f,(await Bc(o(l))).map(ee=>({...ee})),!0),M(u,await pl(o(l)),!0))}On(()=>{r()&&q()}),On(()=>{o(l)?G():(M(x,[]),M(k,[]))});function G(){const j=[],ee=[];j.push({id:"trigger",type:"trigger",position:{x:50,y:100},data:{label:o(l),group:o(u)}});let ne="trigger",H=300;o(f).forEach((U,le)=>{j.push({id:U.id,type:"action",position:{x:H,y:100},data:{cmd:U,onEdit:()=>K(U),onDelete:()=>T(U.id)}}),ee.push({id:`e-${ne}-${U.id}`,source:ne,target:U.id,animated:!0,style:"stroke: #666; stroke-width: 2"}),ne=U.id,H+=270}),j.push({id:"add-action",type:"add",position:{x:H,y:135},data:{onClick:()=>{M(m,!0),M(v,null)}}}),ee.push({id:`e-${ne}-add-action`,source:ne,target:"add-action",style:"stroke: #444; stroke-width: 2; stroke-dasharray: 4"}),M(x,j),M(k,ee)}async function S(j){M(l,j,!0),M(f,(await Bc(j)).map(ee=>({...ee})),!0),M(u,await pl(j),!0),M(v,null),M(m,!1)}async function z(j){o(l)&&(await tb(o(l),j),M(u,j,!0),G())}function L(j){return j.split("_").map(ee=>ee.charAt(0)+ee.slice(1).toLowerCase()).join(" ")}function N(j){return`hsl(${Hl(j)}, 55%, 55%)`}async function J(){const j=o(h).trim();if(!j)return;await rb(j),M(h,""),M(p,!1),await q();const ee=j.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await S(ee)}async function ae(){o(l)&&(await sb(o(l)),M(l,null),M(f,[],!0),await q())}async function ke(j,ee){await Kf(o(l),{id:j.actionId,pluginId:ee,commandId:j.actionId,name:j.name,description:j.description,icon:D[j.actionId]||void 0}),M(m,!1),await q()}function X(j){return o(f).some(ee=>ee.id===j)}async function T(j){await lb(o(l),j),await q()}function K(j){M(m,!1),M(v,{...j,pluginCommandKey:j.pluginId&&j.commandId?`${j.pluginId}:${j.commandId}`:""},!0)}async function P(){o(v)&&(await ub(o(l),o(v).id,{name:o(v).name,description:o(v).description,icon:o(v).icon,pluginId:o(v).pluginId,commandId:o(v).commandId}),M(v,null),await q())}function O(){M(v,null)}async function I(){const j=`custom_${Date.now()}`;await Kf(o(l),{id:j,pluginId:"",commandId:"",name:"New Custom Action",description:"",icon:"â¡"}),M(m,!1),await q();const ee=o(f).find(ne=>ne.id===j);ee&&K(ee)}var Q=ln(),W=We(Q);{var Z=j=>{var ee=_P(),ne=_(ee),H=_(ne),U=w(_(H),4);U.__click=()=>r(!1);var le=w(H,2),Y=_(le),ue=_(Y),_e=w(_(ue),2);_e.__click=()=>M(p,!o(p));var ge=w(ue,2);{var re=ft=>{var vt=rP(),Le=_(vt);Le.__keydown=qe=>qe.key==="Enter"&&J();var Re=w(Le,2);Re.__click=J,va(Le,()=>o(h),qe=>M(h,qe)),C(ft,vt)};pe(ge,ft=>{o(p)&&ft(re)})}var Te=w(ge,2);Tt(Te,21,()=>o(a),Ut,(ft,vt)=>{var Le=sP();let Re;Le.__click=()=>S(o(vt));var qe=_(Le);let Oe;var Qe=w(qe,2),ct=_(Qe),Je=w(Qe,4);{var st=gt=>{const ut=$(()=>Nr[o(i)[o(vt)]]);var Nt=ln(),qt=We(Nt);{var wt=mt=>{var yt=aP();let ot;var ze=_(yt);se(()=>{bt(yt,"title",o(ut).description),ot=Lt(yt,"",ot,{color:o(ut).color}),te(ze,o(ut).label)}),C(mt,yt)};pe(qt,mt=>{o(ut)&&mt(wt)})}C(gt,Nt)};pe(Je,gt=>{o(i)[o(vt)]&&gt(st)})}var nt=w(Je,2),Ge=_(nt);se((gt,ut)=>{Re=It(Le,1,"type-item svelte-d25j4l",null,Re,{selected:o(l)===o(vt)}),Oe=Lt(qe,"",Oe,gt),te(ct,ut),te(Ge,o(s)[o(vt)]??0)},[()=>({background:N(o(vt))}),()=>L(o(vt))]),C(ft,Le)});var be=w(Y,2),Ie=_(be);{var Ke=ft=>{var vt=pP(),Le=We(vt),Re=_(Le);let qe;var Oe=_(Re),Qe=w(Re,2),ct=_(Qe),Je=w(Qe,4);Tt(Je,21,()=>Object.values(Nr),Ut,(wt,mt)=>{var yt=iP();let ot;yt.__click=()=>z(o(mt).id);let ze;var Mt=_(yt);se(()=>{ot=It(yt,1,"group-chip svelte-d25j4l",null,ot,{active:o(u)===o(mt).id}),bt(yt,"title",o(mt).description),ze=Lt(yt,"",ze,{"--grp-color":o(mt).color}),te(Mt,o(mt).label)}),C(wt,yt)});var st=w(Je,2);st.__click=ae;var nt=w(Le,2),Ge=_(nt);TI(Ge,{get nodes(){return o(x)},get edges(){return o(k)},get nodeTypes(){return n},fitView:!0,fitViewOptions:{padding:.2,minZoom:.8},minZoom:.5,maxZoom:1.5,colorMode:"dark",children:(wt,mt)=>{var yt=oP(),ot=We(yt);YI(ot,{bgColor:"#111",patternColor:"#333"});var ze=w(ot,2);FI(ze,{showInteractive:!1}),C(wt,yt)},$$slots:{default:!0}});var gt=w(Ge,2);{var ut=wt=>{var mt=dP(),yt=_(mt),ot=w(_(yt),2);ot.__click=()=>M(m,!1);var ze=w(yt,2),Mt=_(ze);Tt(Mt,17,()=>A,Ut,(Ne,Gt)=>{var zn=uP(),ye=_(zn),cn=_(ye),An=_(cn),St=w(ye,2);Tt(St,21,()=>o(Gt).actions,Ut,(Nn,Wt)=>{const dt=$(()=>X(o(Wt).actionId));var it=cP();let Ft;it.__click=()=>ke(o(Wt),o(Gt).pluginId);var lt=_(it),kt=_(lt),tn=w(lt,2),rn=_(tn),Rn=w(tn,2);{var Yt=$t=>{var _n=lP();C($t,_n)};pe(Rn,$t=>{o(dt)&&$t(Yt)})}se(()=>{Ft=It(it,1,"picker-tile svelte-d25j4l",null,Ft,{added:o(dt)}),bt(it,"title",o(Wt).description),te(kt,D[o(Wt).actionId]??"Â·"),te(rn,o(Wt).name)}),C(Nn,it)}),se(()=>te(An,o(Gt).pluginName)),C(Ne,zn)});var Rt=w(Mt,2),zt=_(Rt);zt.__click=I,C(wt,mt)};pe(gt,wt=>{o(m)&&wt(ut)})}var Nt=w(gt,2);{var qt=wt=>{var mt=hP(),yt=_(mt),ot=w(_(yt),2);ot.__click=O;var ze=w(yt,2),Mt=_(ze),Rt=_(Mt),zt=w(Rt,2),Ne=w(Mt,2),Gt=w(Ne,2),zn=_(Gt);zn.__change=Wt=>{if(Wt.target.value){const[dt,it]=Wt.target.value.split(":");o(v).pluginId=dt,o(v).commandId=it}else o(v).pluginId="",o(v).commandId=""};var ye=_(zn);ye.value=ye.__value="";var cn=w(ye);Tt(cn,17,()=>A,Ut,(Wt,dt)=>{var it=vP();Tt(it,21,()=>o(dt).actions,Ut,(Ft,lt)=>{var kt=fP(),tn=_(kt),rn={};se(()=>{te(tn,`${o(lt).name??""} (${o(lt).actionId??""})`),rn!==(rn=`${o(dt).pluginId??""}:${o(lt).actionId??""}`)&&(kt.value=kt.__value=`${o(dt).pluginId??""}:${o(lt).actionId??""}`)}),C(Ft,kt)}),se(()=>bt(it,"label",o(dt).pluginName)),C(Wt,it)});var An=w(Gt,2),St=_(An);St.__click=P;var Nn=w(St,2);Nn.__click=O,va(Rt,()=>o(v).icon,Wt=>o(v).icon=Wt),va(zt,()=>o(v).name,Wt=>o(v).name=Wt),va(Ne,()=>o(v).description,Wt=>o(v).description=Wt),po(zn,()=>o(v).pluginCommandKey,Wt=>o(v).pluginCommandKey=Wt),C(wt,mt)};pe(Nt,wt=>{o(v)&&wt(qt)})}se((wt,mt)=>{qe=Lt(Re,"",qe,wt),te(Oe,mt),te(ct,`${o(f).length??""} action${o(f).length===1?"":"s"}`)},[()=>({background:N(o(l))}),()=>L(o(l))]),C(ft,vt)},Xe=ft=>{var vt=yP(),Le=_(vt);{var Re=Oe=>{var Qe=gP();C(Oe,Qe)},qe=Oe=>{var Qe=mP();C(Oe,Qe)};pe(Le,Oe=>{o(a).length===0?Oe(Re):Oe(qe,!1)})}C(ft,vt)};pe(Ie,ft=>{o(l)?ft(Ke):ft(Xe,!1)})}C(j,ee)};pe(W,j=>{r()&&j(Z)})}C(t,Q),tt()}Jt(["click","keydown","change"]);var wP=F('<span class="scope-chip svelte-1e15788"> </span>'),xP=F('<div class="scopes-list svelte-1e15788"></div>'),kP=F('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),SP=F('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),EP=F('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),AP=F('<div class="empty svelte-1e15788">No plugins registered.</div>'),TP=F('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function CP(t,e){et(e,!0);let n=Ae(e,"open",15,!1);const r=$(()=>n()?ui.getAllPlugins().map(h=>({id:h.pluginId,name:h.serviceName,actions:h.getHandlers().map(m=>({id:m.actionId,name:m.name,description:m.description,scopes:m.requiredScopes||[]}))})):[]),a={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},s=$(()=>o(r).reduce((h,m)=>h+m.actions.length,0));let i=Me(en(new Set));function l(h){const m=new Set(o(i));m.has(h)?m.delete(h):m.add(h),M(i,m,!0)}function u(h){return h.replace(/^https?:\/\/[^/]+\/auth\//,"")}var f=ln(),v=We(f);{var p=h=>{var m=TP();m.__keydown=X=>X.key==="Escape"&&n(!1);var x=_(m),k=_(x),A=_(k),D=w(_(A),2),q=w(_(D),2),G=_(q),S=w(A,2);S.__click=()=>n(!1);var z=w(k,2),L=_(z);Tt(L,17,()=>o(r),Ut,(X,T)=>{var K=EP(),P=_(K),O=_(P),I=_(O),Q=_(I),W=w(I,2),Z=_(W),j=w(O,2),ee=_(j),ne=w(P,2);Tt(ne,21,()=>o(T).actions,Ut,(H,U)=>{const le=$(()=>`${o(T).id}:${o(U).id}`),Y=$(()=>o(i).has(o(le)));var ue=SP(),_e=_(ue),ge=_(_e),re=w(_e,2),Te=_(re),be=_(Te),Ie=_(be),Ke=w(be,2),Xe=_(Ke),ft=w(Te,2),vt=_(ft),Le=w(ft,2);{var Re=qe=>{var Oe=kP(),Qe=_(Oe);Qe.__click=()=>l(o(le));var ct=_(Qe);{var Je=ut=>{var Nt=mn("â¾");C(ut,Nt)},st=ut=>{var Nt=mn("â¸");C(ut,Nt)};pe(ct,ut=>{o(Y)?ut(Je):ut(st,!1)})}var nt=w(ct),Ge=w(Qe,2);{var gt=ut=>{var Nt=xP();Tt(Nt,21,()=>o(U).scopes,Ut,(qt,wt)=>{var mt=wP(),yt=_(mt);se(ot=>{bt(mt,"title",o(wt)),te(yt,ot)},[()=>u(o(wt))]),C(qt,mt)}),C(ut,Nt)};pe(Ge,ut=>{o(Y)&&ut(gt)})}se(()=>te(nt,` ${o(U).scopes.length??""} scope${o(U).scopes.length===1?"":"s"}`)),C(qe,Oe)};pe(Le,qe=>{o(U).scopes.length&&qe(Re)})}se(()=>{bt(_e,"title",o(U).id),te(ge,a[o(U).id]??"Â·"),te(Ie,o(U).name),te(Xe,o(U).id),te(vt,o(U).description)}),C(H,ue)}),se(()=>{te(Q,o(T).name),te(Z,o(T).id),te(ee,`${o(T).actions.length??""} action${o(T).actions.length===1?"":"s"}`)}),C(X,K)});var N=w(L,2);{var J=X=>{var T=AP();C(X,T)};pe(N,X=>{o(r).length===0&&X(J)})}var ae=w(z,2),ke=w(_(ae),2);ke.__click=()=>n(!1),se(()=>te(G,`${o(r).length??""} plugin${o(r).length===1?"":"s"} Â· ${o(s)??""} actions available`)),C(h,m)};pe(v,h=>{n()&&h(p)})}C(t,f),tt()}Jt(["keydown","click"]);var IP=F('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),PP=F('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),MP=F('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),OP=F('<button class="chip svelte-s2dwjj"> </button>'),NP=F('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),RP=F('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),DP=F('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),LP=F('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),zP=F('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),jP=F('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),BP=F('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),qP=F('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),FP=F('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),KP=F('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),HP=F('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),VP=F('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function UP(t,e){et(e,!0);let n=Ae(e,"groupOrder",19,()=>[]),r=Me(!1),a=Me(null),s=Me(!1),i=Me(null);async function l(){var X;const[N,J,ae]=await Promise.all([at.items.where("sourceType").equals("gmail").count(),at.emailClassifications.count(),at.contacts.count()]);let ke=0;try{const T=await((X=navigator.storage)==null?void 0:X.estimate());ke=(T==null?void 0:T.usage)??0}catch{}M(i,{emailCount:N,classCount:J,contactCount:ae,totalBytes:ke},!0)}function u(N){return N?N<1024?`${N} B`:N<1024*1024?`${(N/1024).toFixed(1)} KB`:`${(N/(1024*1024)).toFixed(1)} MB`:"â"}function f(){M(r,!o(r)),o(r)&&l()}async function v(N){var J;M(s,!0),M(a,null);try{await N(),await l(),(J=e.onrefresh)==null||J.call(e)}finally{M(s,!1)}}async function p(){await v(()=>Hf())}async function h(N){await v(()=>yd(N))}async function m(){await v(async()=>{await qp(),await Hf()})}async function x(){await v(()=>at.contacts.clear())}async function k(){await v(async()=>{await at.delete(),window.location.reload()})}function A(N){return N.split("_").map(J=>J.charAt(0)+J.slice(1).toLowerCase()).join(" ")}var D=VP(),q=_(D);q.__click=f;var G=w(_(q),2);let S;var z=w(q,2);{var L=N=>{var J=HP(),ae=_(J);{var ke=re=>{var Te=PP(),be=_(Te),Ie=_(be),Ke=w(be,4),Xe=_(Ke),ft=w(Ke,4),vt=_(ft),Le=w(ft,2);{var Re=qe=>{var Oe=IP(),Qe=w(We(Oe),2),ct=_(Qe);se(Je=>te(ct,`${Je??""} used`),[()=>u(o(i).totalBytes)]),C(qe,Oe)};pe(Le,qe=>{o(i).totalBytes&&qe(Re)})}se(()=>{te(Ie,`${o(i).emailCount??""} emails`),te(Xe,`${o(i).classCount??""} classifications`),te(vt,`${o(i).contactCount??""} contacts`)}),C(re,Te)};pe(ae,re=>{o(i)&&re(ke)})}var X=w(ae,2);{var T=re=>{var Te=NP(),be=w(_(Te),2);Tt(be,21,n,Ut,(Ie,Ke)=>{var Xe=ln(),ft=We(Xe);{var vt=Re=>{var qe=MP(),Oe=_(qe),Qe=w(Oe);Qe.__click=()=>M(a,null);var ct=w(Qe,2);ct.__click=()=>h(o(Ke)),se(Je=>{te(Oe,`Delete ${Je??""}? `),ct.disabled=o(s)},[()=>A(o(Ke))]),C(Re,qe)},Le=Re=>{var qe=OP();qe.__click=()=>M(a,`group:${o(Ke)}`);var Oe=_(qe);se(Qe=>{qe.disabled=o(s),te(Oe,`${Qe??""} â`)},[()=>A(o(Ke))]),C(Re,qe)};pe(ft,Re=>{o(a)===`group:${o(Ke)}`?Re(vt):Re(Le,!1)})}C(Ie,Xe)}),C(re,Te)};pe(X,re=>{n().length>0&&re(T)})}var K=w(X,2),P=w(_(K),2),O=_(P);{var I=re=>{var Te=RP(),be=w(_(Te),2);be.__click=()=>M(a,null);var Ie=w(be,2);Ie.__click=p,se(()=>Ie.disabled=o(s)),C(re,Te)},Q=re=>{var Te=DP();Te.__click=()=>M(a,"classifications"),se(()=>Te.disabled=o(s)),C(re,Te)};pe(O,re=>{o(a)==="classifications"?re(I):re(Q,!1)})}var W=w(O,2);{var Z=re=>{var Te=LP(),be=w(_(Te),2);be.__click=()=>M(a,null);var Ie=w(be,2);Ie.__click=m,se(()=>Ie.disabled=o(s)),C(re,Te)},j=re=>{var Te=zP();Te.__click=()=>M(a,"emails"),se(()=>Te.disabled=o(s)),C(re,Te)};pe(W,re=>{o(a)==="emails"?re(Z):re(j,!1)})}var ee=w(W,2);{var ne=re=>{var Te=jP(),be=w(_(Te),2);be.__click=()=>M(a,null);var Ie=w(be,2);Ie.__click=x,se(()=>Ie.disabled=o(s)),C(re,Te)},H=re=>{var Te=BP();Te.__click=()=>M(a,"contacts"),se(()=>Te.disabled=o(s)),C(re,Te)};pe(ee,re=>{o(a)==="contacts"?re(ne):re(H,!1)})}var U=w(K,2),le=_(U);{var Y=re=>{var Te=qP(),be=w(_(Te),2);be.__click=()=>M(a,null);var Ie=w(be,2);Ie.__click=k,se(()=>Ie.disabled=o(s)),C(re,Te)},ue=re=>{var Te=FP();Te.__click=()=>M(a,"nuke"),se(()=>Te.disabled=o(s)),C(re,Te)};pe(le,re=>{o(a)==="nuke"?re(Y):re(ue,!1)})}var _e=w(U,2);{var ge=re=>{var Te=KP();C(re,Te)};pe(_e,re=>{o(s)&&re(ge)})}C(N,J)};pe(z,N=>{o(r)&&N(L)})}se(()=>S=It(G,0,"chev svelte-s2dwjj",null,S,{open:o(r)})),C(t,D),tt()}Jt(["click"]);var GP=F('<div class="error-card svelte-aym646"><span> </span> <button class="error-dismiss svelte-aym646">â</button></div>'),WP=F('<div class="success-card svelte-aym646"><span> </span> <button class="success-dismiss svelte-aym646">â</button></div>'),YP=F('<div class="groups-list svelte-aym646"></div> <div class="actions-footer svelte-aym646"><span class="footer-stat svelte-aym646"> </span></div>',1),XP=F('<div class="empty-state svelte-aym646"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-aym646">No emails classified yet</h3> <p class="svelte-aym646">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),ZP=F('<div class="actions-container svelte-aym646"><!> <!> <!> <!> <div class="toolbar svelte-aym646"><button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!> <!></div>');function QP(t,e){et(e,!0);let n=Ae(e,"groups",19,()=>({})),r=Ae(e,"groupOrder",19,()=>[]),a=Ae(e,"counts",19,()=>({})),s=Ae(e,"stats",3,null),i=Ae(e,"expandedGroup",3,null),l=Ae(e,"isScanning",3,!1),u=Ae(e,"scanProgress",3,null),f=Ae(e,"scanCount",15,20),v=Ae(e,"error",3,null),p=Ae(e,"successMsg",3,null),h=Me(!1),m=Me(!1),x=Me(!1),k=$(()=>{for(const I of r()){const Q=n()[I];if((Q==null?void 0:Q.length)>0)return Q[0]}return null});var A=ZP(),D=_(A);r2(D,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return l()},get scanProgress(){return u()},get stats(){return s()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>M(h,!0),get scanCount(){return f()},set scanCount(I){f(I)}});var q=w(D,2);T2(q,{get sampleEmail(){return o(k)},get open(){return o(h)},set open(I){M(h,I,!0)}});var G=w(q,2);bP(G,{get open(){return o(m)},set open(I){M(m,I,!0)}});var S=w(G,2);CP(S,{get open(){return o(x)},set open(I){M(x,I,!0)}});var z=w(S,2),L=_(z);L.__click=()=>M(x,!0);var N=w(L,2);N.__click=()=>M(m,!0);var J=w(z,2);{var ae=I=>{var Q=GP(),W=_(Q),Z=_(W),j=w(W,2);j.__click=function(...ee){var ne;(ne=e.ondismisserror)==null||ne.apply(this,ee)},se(()=>te(Z,v())),C(I,Q)};pe(J,I=>{v()&&I(ae)})}var ke=w(J,2);{var X=I=>{var Q=WP(),W=_(Q),Z=_(W),j=w(W,2);j.__click=function(...ee){var ne;(ne=e.ondismisssuccess)==null||ne.apply(this,ee)},se(()=>te(Z,p())),C(I,Q)};pe(ke,I=>{p()&&I(X)})}var T=w(ke,2);{var K=I=>{var Q=YP(),W=We(Q);Tt(W,20,r,ne=>ne,(ne,H)=>{{let U=$(()=>ku(H)),le=$(()=>{var _e;return((_e=n()[H])==null?void 0:_e.length)||0}),Y=$(()=>n()[H]||[]),ue=$(()=>i()===H);x2(ne,{get action(){return H},get color(){return o(U)},get count(){return o(le)},get items(){return o(Y)},get expanded(){return o(ue)},ontoggle:()=>e.ontogglegroup(H),onexecute:_e=>e.onexecute(H,_e),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(H)})}});var Z=w(W,2),j=_(Z),ee=_(j);se(()=>te(ee,`${a().total??""} emails classified into ${r().length??""} groups`)),C(I,Q)},P=I=>{var Q=XP();C(I,Q)};pe(T,I=>{a().total>0?I(K):l()||I(P,1)})}var O=w(T,2);UP(O,{get groupOrder(){return r()},get onrefresh(){return e.onrefresh}}),C(t,A),tt()}Jt(["click"]);var JP=F('<div class="control-board-page svelte-v2lwbo"><!></div>');function $P(t,e){et(e,!0);const n=vp();let r=Me(en(n.status)),a=Me(""),s=Me(en({})),i=Me(en([])),l=Me(en({total:0})),u=Me(null),f=Me(null),v=Me(!1),p=Me(null),h=Me(3),m=Me(null),x=Me(null),k=Me(null);const A="me-ai-scan-history";async function D(){return await Vi(A)}async function q(I){!I||I.phase!=="done"||await Ui(A,{timestamp:Date.now(),classified:I.classified||0,errors:I.errors||0,total:I.total||0,totals:I.totals||{},summary:I.summary||{}})}En(async()=>{const I=n.onMessage(W=>{if(W.status==="ready"){M(r,"ready");const Z=Yr.find(ne=>ne.id===n.modelId),j=Xr.find(ne=>ne.name===n.modelId),ee=Z||j;M(a,(ee==null?void 0:ee.name)||(ee==null?void 0:ee.displayName)||n.modelId||"",!0)}W.status==="loading"&&M(r,"loading")});if(M(r,n.status,!0),n.modelId){const W=Yr.find(ee=>ee.id===n.modelId),Z=Xr.find(ee=>ee.name===n.modelId),j=W||Z;M(a,(j==null?void 0:j.name)||(j==null?void 0:j.displayName)||n.modelId||"",!0)}const Q=await D();return Q&&M(p,{phase:"done",...Q},!0),G(),()=>I()});async function G(){try{const I=await Mp();M(s,I.groups,!0),M(i,I.order,!0),M(l,await xb(),!0),M(u,await xu(),!0)}catch(I){M(m,`Failed to load data: ${I.message}`)}}async function S(){await L(!1)}async function z(){await L(!0)}async function L(I){if(o(v)||!n.isReady)return;M(m,null),M(x,null),M(v,!0),M(p,null);const Q=new AbortController;M(k,Q,!0);try{await Pp(n,{count:o(h),force:I,signal:Q.signal,onProgress:W=>{M(p,{...W},!0),W.phase==="done"&&q(W)}}),await G()}catch(W){Q.signal.aborted||M(m,`Scan failed: ${W.message}`)}finally{M(v,!1),M(k,null)}}function N(){var I;(I=o(k))==null||I.abort()}async function J(I){await gl(I,"acted"),await G()}async function ae(I,Q){const{executePipeline:W,isAuthenticated:Z}=await tr(async()=>{const{executePipeline:j,isAuthenticated:ee}=await Promise.resolve().then(()=>N0);return{executePipeline:j,isAuthenticated:ee}},void 0,import.meta.url);if(!await Z()){alert("Please sign in to Gmail first (Dashboard page)");return}try{const ee=await W({type:I,source:"gmail",data:Q},ne=>{console.log("Pipeline progress:",ne)},!0);ee.success?(M(x,ee.message,!0),M(m,null),await J(Q.emailId)):(M(m,`Execution failed: ${ee.message}`),M(x,null))}catch(j){M(m,`Execution error: ${j.message}`),M(x,null)}}async function ke(I){await gl(I,"dismissed"),await G()}async function X(I){await Op(I),await G()}async function T(I){await yd(I),await G()}function K(I){M(f,o(f)===I?null:I,!0)}var P=JP(),O=_(P);QP(O,{get engineStatus(){return o(r)},get modelName(){return o(a)},get groups(){return o(s)},get groupOrder(){return o(i)},get counts(){return o(l)},get stats(){return o(u)},get expandedGroup(){return o(f)},get isScanning(){return o(v)},get scanProgress(){return o(p)},get error(){return o(m)},get successMsg(){return o(x)},onscan:S,onrescan:z,ontogglegroup:K,onexecute:ae,onmarkacted:J,ondismiss:ke,onremove:X,oncleargroup:T,ondismisserror:()=>M(m,null),ondismisssuccess:()=>M(x,null),onstop:N,onrefresh:G,oncloseprogress:async()=>{M(p,null),await dd(A)},get scanCount(){return o(h)},set scanCount(I){M(h,I,!0)}}),C(t,P),tt()}var e3=F('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#control">Control Board</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function t3(t,e){et(e,!0);function n(){const N=location.hash;return N==="#dashboard"?"dashboard":N==="#control"?"control":"chat"}let r=Me(en(n()));En(()=>{function N(){M(r,n(),!0)}return window.addEventListener("hashchange",N),()=>window.removeEventListener("hashchange",N)});var a=e3(),s=_(a),i=w(_(s),2),l=_(i);let u;var f=w(l,2);let v;var p=w(f,2);let h;var m=w(s,2),x=_(m);let k;var A=_(x);Zw(A,{});var D=w(x,2);let q;var G=_(D);$P(G,{});var S=w(D,2);let z;var L=_(S);Tk(L,{}),se(()=>{u=It(l,1,"svelte-1n46o8q",null,u,{active:o(r)==="chat"}),v=It(f,1,"svelte-1n46o8q",null,v,{active:o(r)==="control"}),h=It(p,1,"svelte-1n46o8q",null,h,{active:o(r)==="dashboard"}),k=Lt(x,"",k,{display:o(r)==="chat"?"flex":"none"}),q=Lt(D,"",q,{display:o(r)==="control"?"flex":"none"}),z=Lt(S,"",z,{display:o(r)==="dashboard"?"flex":"none"})}),C(t,a),tt()}Zy(t3,{target:document.getElementById("app")});
