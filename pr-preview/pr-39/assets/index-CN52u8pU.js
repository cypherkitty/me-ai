var Bd=Object.defineProperty;var Fl=t=>{throw TypeError(t)};var zd=(t,e,r)=>e in t?Bd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var et=(t,e,r)=>zd(t,typeof e!="symbol"?e+"":e,r),Ji=(t,e,r)=>e.has(t)||Fl("Cannot "+r);var pe=(t,e,r)=>(Ji(t,e,"read from private field"),r?r.call(t):e.get(t)),tt=(t,e,r)=>e.has(t)?Fl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),Ze=(t,e,r,a)=>(Ji(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),tn=(t,e,r)=>(Ji(t,e,"access private method"),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const po=!1;var Bo=Array.isArray,Fd=Array.prototype.indexOf,Na=Array.prototype.includes,yi=Array.from,Kd=Object.defineProperty,Ra=Object.getOwnPropertyDescriptor,Ud=Object.getOwnPropertyDescriptors,Gd=Object.prototype,Wd=Array.prototype,jc=Object.getPrototypeOf,Kl=Object.isExtensible;const Hd=()=>{};function Vd(t){for(var e=0;e<t.length;e++)t[e]()}function Nc(){var t,e,r=new Promise((a,i)=>{t=a,e=i});return{promise:r,resolve:t,reject:e}}const Yt=2,ys=4,bi=8,qc=1<<24,Er=16,Jn=32,wa=64,Bc=128,Mn=512,Kt=1024,Qt=2048,Zn=4096,kn=8192,xr=16384,Es=32768,qa=65536,Ul=1<<17,zc=1<<18,Ga=1<<19,Yd=1<<20,kr=1<<25,ma=65536,ho=1<<21,zo=1<<22,qr=1<<23,va=Symbol("$state"),Qd=Symbol("legacy props"),Xd=Symbol(""),aa=new class extends Error{constructor(){super(...arguments);et(this,"name","StaleReactionError");et(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Zd(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Jd(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function $d(t,e,r){throw new Error("https://svelte.dev/e/each_key_duplicate")}function ef(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function tf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function nf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function rf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function af(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function sf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function of(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function lf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function cf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const uf=1,df=2,Fc=4,ff=8,vf=16,pf=1,hf=4,mf=8,gf=16,Kc=1,_f=2,Wt=Symbol(),Uc="http://www.w3.org/1999/xhtml";function yf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function bf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Gc(t){return t===this.v}function wf(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Wc(t){return!wf(t,this.v)}let kf=!1,xn=null;function Ba(t){xn=t}function ht(t,e=!1,r){xn={p:xn,i:!1,c:null,e:null,s:t,x:null,l:null}}function mt(t){var e=xn,r=e.e;if(r!==null){e.e=null;for(var a of r)vu(a)}return t!==void 0&&(e.x=t),e.i=!0,xn=e.p,t??{}}function Hc(){return!0}let sa=[];function Vc(){var t=sa;sa=[],Vd(t)}function Br(t){if(sa.length===0&&!ps){var e=sa;queueMicrotask(()=>{e===sa&&Vc()})}sa.push(t)}function xf(){for(;sa.length>0;)Vc()}function Yc(t){var e=pt;if(e===null)return nt.f|=qr,t;if((e.f&Es)===0&&(e.f&ys)===0)throw t;za(t,e)}function za(t,e){for(;e!==null;){if((e.f&Bc)!==0){if((e.f&Es)===0)throw t;try{e.b.error(t);return}catch(r){t=r}}e=e.parent}throw t}const Sf=-7169;function Lt(t,e){t.f=t.f&Sf|e}function Fo(t){(t.f&Mn)!==0||t.deps===null?Lt(t,Kt):Lt(t,Zn)}function Qc(t){if(t!==null)for(const e of t)(e.f&Yt)===0||(e.f&ma)===0||(e.f^=ma,Qc(e.deps))}function Xc(t,e,r){(t.f&Qt)!==0?e.add(t):(t.f&Zn)!==0&&r.add(t),Qc(t.deps),Lt(t,Kt)}const Zs=new Set;let Qe=null,di=null,Ht=null,fn=[],wi=null,mo=!1,ps=!1;var Pa,Ia,oa,Oa,ks,xs,la,_r,Ma,fr,go,_o,Zc;const vl=class vl{constructor(){tt(this,fr);et(this,"committed",!1);et(this,"current",new Map);et(this,"previous",new Map);tt(this,Pa,new Set);tt(this,Ia,new Set);tt(this,oa,0);tt(this,Oa,0);tt(this,ks,null);tt(this,xs,new Set);tt(this,la,new Set);tt(this,_r,new Map);et(this,"is_fork",!1);tt(this,Ma,!1)}is_deferred(){return this.is_fork||pe(this,Oa)>0}skip_effect(e){pe(this,_r).has(e)||pe(this,_r).set(e,{d:[],m:[]})}unskip_effect(e){var r=pe(this,_r).get(e);if(r){pe(this,_r).delete(e);for(var a of r.d)Lt(a,Qt),Yn(a);for(a of r.m)Lt(a,Zn),Yn(a)}}process(e){var i;fn=[],this.apply();var r=[],a=[];for(const o of e)tn(this,fr,go).call(this,o,r,a);if(this.is_deferred()){tn(this,fr,_o).call(this,a),tn(this,fr,_o).call(this,r);for(const[o,u]of pe(this,_r))tu(o,u)}else{for(const o of pe(this,Pa))o();pe(this,Pa).clear(),pe(this,oa)===0&&tn(this,fr,Zc).call(this),di=this,Qe=null,Gl(a),Gl(r),di=null,(i=pe(this,ks))==null||i.resolve()}Ht=null}capture(e,r){r!==Wt&&!this.previous.has(e)&&this.previous.set(e,r),(e.f&qr)===0&&(this.current.set(e,e.v),Ht==null||Ht.set(e,e.v))}activate(){Qe=this,this.apply()}deactivate(){Qe===this&&(Qe=null,Ht=null)}flush(){if(this.activate(),fn.length>0){if(Jc(),Qe!==null&&Qe!==this)return}else pe(this,oa)===0&&this.process([]);this.deactivate()}discard(){for(const e of pe(this,Ia))e(this);pe(this,Ia).clear()}increment(e){Ze(this,oa,pe(this,oa)+1),e&&Ze(this,Oa,pe(this,Oa)+1)}decrement(e){Ze(this,oa,pe(this,oa)-1),e&&Ze(this,Oa,pe(this,Oa)-1),!pe(this,Ma)&&(Ze(this,Ma,!0),Br(()=>{Ze(this,Ma,!1),this.is_deferred()?fn.length>0&&this.flush():this.revive()}))}revive(){for(const e of pe(this,xs))pe(this,la).delete(e),Lt(e,Qt),Yn(e);for(const e of pe(this,la))Lt(e,Zn),Yn(e);this.flush()}oncommit(e){pe(this,Pa).add(e)}ondiscard(e){pe(this,Ia).add(e)}settled(){return(pe(this,ks)??Ze(this,ks,Nc())).promise}static ensure(){if(Qe===null){const e=Qe=new vl;Zs.add(Qe),ps||Br(()=>{Qe===e&&e.flush()})}return Qe}apply(){}};Pa=new WeakMap,Ia=new WeakMap,oa=new WeakMap,Oa=new WeakMap,ks=new WeakMap,xs=new WeakMap,la=new WeakMap,_r=new WeakMap,Ma=new WeakMap,fr=new WeakSet,go=function(e,r,a){e.f^=Kt;for(var i=e.first,o=null;i!==null;){var u=i.f,d=(u&(Jn|wa))!==0,h=d&&(u&Kt)!==0,p=h||(u&kn)!==0||pe(this,_r).has(i);if(!p&&i.fn!==null){d?i.f^=Kt:o!==null&&(u&(ys|bi|qc))!==0?o.b.defer_effect(i):(u&ys)!==0?r.push(i):Cs(i)&&((u&Er)!==0&&pe(this,la).add(i),Ua(i));var _=i.first;if(_!==null){i=_;continue}}var b=i.parent;for(i=i.next;i===null&&b!==null;)b===o&&(o=null),i=b.next,b=b.parent}},_o=function(e){for(var r=0;r<e.length;r+=1)Xc(e[r],pe(this,xs),pe(this,la))},Zc=function(){var i;if(Zs.size>1){this.previous.clear();var e=Ht,r=!0;for(const o of Zs){if(o===this){r=!1;continue}const u=[];for(const[h,p]of this.current){if(o.current.has(h))if(r&&p!==o.current.get(h))o.current.set(h,p);else continue;u.push(h)}if(u.length===0)continue;const d=[...o.current.keys()].filter(h=>!this.current.has(h));if(d.length>0){var a=fn;fn=[];const h=new Set,p=new Map;for(const _ of u)$c(_,d,h,p);if(fn.length>0){Qe=o,o.apply();for(const _ of fn)tn(i=o,fr,go).call(i,_,[],[]);o.deactivate()}fn=a}}Qe=null,Ht=e}this.committed=!0,Zs.delete(this)};let zr=vl;function Tf(t){var e=ps;ps=!0;try{for(var r;;){if(xf(),fn.length===0&&(Qe==null||Qe.flush(),fn.length===0))return wi=null,r;Jc()}}finally{ps=e}}function Jc(){mo=!0;var t=null;try{for(var e=0;fn.length>0;){var r=zr.ensure();if(e++>1e3){var a,i;Ef()}r.process(fn),Fr.clear()}}finally{fn=[],mo=!1,wi=null}}function Ef(){try{rf()}catch(t){za(t,wi)}}let Un=null;function Gl(t){var e=t.length;if(e!==0){for(var r=0;r<e;){var a=t[r++];if((a.f&(xr|kn))===0&&Cs(a)&&(Un=new Set,Ua(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&gu(a),(Un==null?void 0:Un.size)>0)){Fr.clear();for(const i of Un){if((i.f&(xr|kn))!==0)continue;const o=[i];let u=i.parent;for(;u!==null;)Un.has(u)&&(Un.delete(u),o.push(u)),u=u.parent;for(let d=o.length-1;d>=0;d--){const h=o[d];(h.f&(xr|kn))===0&&Ua(h)}}Un.clear()}}Un=null}}function $c(t,e,r,a){if(!r.has(t)&&(r.add(t),t.reactions!==null))for(const i of t.reactions){const o=i.f;(o&Yt)!==0?$c(i,e,r,a):(o&(zo|Er))!==0&&(o&Qt)===0&&eu(i,e,a)&&(Lt(i,Qt),Yn(i))}}function eu(t,e,r){const a=r.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const i of t.deps){if(Na.call(e,i))return!0;if((i.f&Yt)!==0&&eu(i,e,r))return r.set(i,!0),!0}return r.set(t,!1),!1}function Yn(t){for(var e=wi=t;e.parent!==null;){e=e.parent;var r=e.f;if(mo&&e===pt&&(r&Er)!==0&&(r&zc)===0)return;if((r&(wa|Jn))!==0){if((r&Kt)===0)return;e.f^=Kt}}fn.push(e)}function tu(t,e){if(!((t.f&Jn)!==0&&(t.f&Kt)!==0)){(t.f&Qt)!==0?e.d.push(t):(t.f&Zn)!==0&&e.m.push(t),Lt(t,Kt);for(var r=t.first;r!==null;)tu(r,e),r=r.next}}function Af(t){let e=0,r=ga(0),a;return()=>{Go()&&(v(r),Wo(()=>(e===0&&(a=Rs(()=>t(()=>hs(r)))),e+=1,()=>{Br(()=>{e-=1,e===0&&(a==null||a(),a=void 0,hs(r))})})))}}var Cf=qa|Ga|Bc;function Rf(t,e,r){new Pf(t,e,r)}var Pn,qo,ir,ca,or,In,un,lr,yr,jr,ua,Nr,Da,da,La,ja,br,gi,Ut,If,Of,yo,si,ii,bo;class Pf{constructor(e,r,a){tt(this,Ut);et(this,"parent");et(this,"is_pending",!1);tt(this,Pn);tt(this,qo,null);tt(this,ir);tt(this,ca);tt(this,or);tt(this,In,null);tt(this,un,null);tt(this,lr,null);tt(this,yr,null);tt(this,jr,null);tt(this,ua,0);tt(this,Nr,0);tt(this,Da,!1);tt(this,da,!1);tt(this,La,new Set);tt(this,ja,new Set);tt(this,br,null);tt(this,gi,Af(()=>(Ze(this,br,ga(pe(this,ua))),()=>{Ze(this,br,null)})));Ze(this,Pn,e),Ze(this,ir,r),Ze(this,ca,a),this.parent=pt.b,this.is_pending=!!pe(this,ir).pending,Ze(this,or,Ho(()=>{pt.b=this;{var i=tn(this,Ut,yo).call(this);try{Ze(this,In,On(()=>a(i)))}catch(o){this.error(o)}pe(this,Nr)>0?tn(this,Ut,ii).call(this):this.is_pending=!1}return()=>{var o;(o=pe(this,jr))==null||o.remove()}},Cf))}defer_effect(e){Xc(e,pe(this,La),pe(this,ja))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!pe(this,ir).pending}update_pending_count(e){tn(this,Ut,bo).call(this,e),Ze(this,ua,pe(this,ua)+e),!(!pe(this,br)||pe(this,Da))&&(Ze(this,Da,!0),Br(()=>{Ze(this,Da,!1),pe(this,br)&&Fa(pe(this,br),pe(this,ua))}))}get_effect_pending(){return pe(this,gi).call(this),v(pe(this,br))}error(e){var r=pe(this,ir).onerror;let a=pe(this,ir).failed;if(pe(this,da)||!r&&!a)throw e;pe(this,In)&&(pn(pe(this,In)),Ze(this,In,null)),pe(this,un)&&(pn(pe(this,un)),Ze(this,un,null)),pe(this,lr)&&(pn(pe(this,lr)),Ze(this,lr,null));var i=!1,o=!1;const u=()=>{if(i){bf();return}i=!0,o&&cf(),zr.ensure(),Ze(this,ua,0),pe(this,lr)!==null&&pa(pe(this,lr),()=>{Ze(this,lr,null)}),this.is_pending=this.has_pending_snippet(),Ze(this,In,tn(this,Ut,si).call(this,()=>(Ze(this,da,!1),On(()=>pe(this,ca).call(this,pe(this,Pn)))))),pe(this,Nr)>0?tn(this,Ut,ii).call(this):this.is_pending=!1};Br(()=>{try{o=!0,r==null||r(e,u),o=!1}catch(d){za(d,pe(this,or)&&pe(this,or).parent)}a&&Ze(this,lr,tn(this,Ut,si).call(this,()=>{zr.ensure(),Ze(this,da,!0);try{return On(()=>{a(pe(this,Pn),()=>e,()=>u)})}catch(d){return za(d,pe(this,or).parent),null}finally{Ze(this,da,!1)}}))})}}Pn=new WeakMap,qo=new WeakMap,ir=new WeakMap,ca=new WeakMap,or=new WeakMap,In=new WeakMap,un=new WeakMap,lr=new WeakMap,yr=new WeakMap,jr=new WeakMap,ua=new WeakMap,Nr=new WeakMap,Da=new WeakMap,da=new WeakMap,La=new WeakMap,ja=new WeakMap,br=new WeakMap,gi=new WeakMap,Ut=new WeakSet,If=function(){try{Ze(this,In,On(()=>pe(this,ca).call(this,pe(this,Pn))))}catch(e){this.error(e)}},Of=function(){const e=pe(this,ir).pending;e&&(Ze(this,un,On(()=>e(pe(this,Pn)))),Br(()=>{var r=tn(this,Ut,yo).call(this);Ze(this,In,tn(this,Ut,si).call(this,()=>(zr.ensure(),On(()=>pe(this,ca).call(this,r))))),pe(this,Nr)>0?tn(this,Ut,ii).call(this):(pa(pe(this,un),()=>{Ze(this,un,null)}),this.is_pending=!1)}))},yo=function(){var e=pe(this,Pn);return this.is_pending&&(Ze(this,jr,Sr()),pe(this,Pn).before(pe(this,jr)),e=pe(this,jr)),e},si=function(e){var r=pt,a=nt,i=xn;dr(pe(this,or)),Ln(pe(this,or)),Ba(pe(this,or).ctx);try{return e()}catch(o){return Yc(o),null}finally{dr(r),Ln(a),Ba(i)}},ii=function(){const e=pe(this,ir).pending;pe(this,In)!==null&&(Ze(this,yr,document.createDocumentFragment()),pe(this,yr).append(pe(this,jr)),bu(pe(this,In),pe(this,yr))),pe(this,un)===null&&Ze(this,un,On(()=>e(pe(this,Pn))))},bo=function(e){var r;if(!this.has_pending_snippet()){this.parent&&tn(r=this.parent,Ut,bo).call(r,e);return}if(Ze(this,Nr,pe(this,Nr)+e),pe(this,Nr)===0){this.is_pending=!1;for(const a of pe(this,La))Lt(a,Qt),Yn(a);for(const a of pe(this,ja))Lt(a,Zn),Yn(a);pe(this,La).clear(),pe(this,ja).clear(),pe(this,un)&&pa(pe(this,un),()=>{Ze(this,un,null)}),pe(this,yr)&&(pe(this,Pn).before(pe(this,yr)),Ze(this,yr,null))}};function Mf(t,e,r,a){const i=ki;var o=t.filter(k=>!k.settled);if(r.length===0&&o.length===0){a(e.map(i));return}var u=Qe,d=pt,h=Df(),p=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(k=>k.promise)):null;function _(k){h();try{a(k)}catch(x){(d.f&xr)===0&&za(x,d)}u==null||u.deactivate(),wo()}if(r.length===0){p.then(()=>_(e.map(i)));return}function b(){h(),Promise.all(r.map(k=>Lf(k))).then(k=>_([...e.map(i),...k])).catch(k=>za(k,d))}p?p.then(b):b()}function Df(){var t=pt,e=nt,r=xn,a=Qe;return function(o=!0){dr(t),Ln(e),Ba(r),o&&(a==null||a.activate())}}function wo(){dr(null),Ln(null),Ba(null)}function ki(t){var e=Yt|Qt,r=nt!==null&&(nt.f&Yt)!==0?nt:null;return pt!==null&&(pt.f|=Ga),{ctx:xn,deps:null,effects:null,equals:Gc,f:e,fn:t,reactions:null,rv:0,v:Wt,wv:0,parent:r??pt,ac:null}}function Lf(t,e,r){let a=pt;a===null&&Jd();var i=a.b,o=void 0,u=ga(Wt),d=!nt,h=new Map;return Qf(()=>{var x;var p=Nc();o=p.promise;try{Promise.resolve(t()).then(p.resolve,p.reject).then(()=>{_===Qe&&_.committed&&_.deactivate(),wo()})}catch(A){p.reject(A),wo()}var _=Qe;if(d){var b=i.is_rendered();i.update_pending_count(1),_.increment(b),(x=h.get(_))==null||x.reject(aa),h.delete(_),h.set(_,p)}const k=(A,N=void 0)=>{if(_.activate(),N)N!==aa&&(u.f|=qr,Fa(u,N));else{(u.f&qr)!==0&&(u.f^=qr),Fa(u,A);for(const[E,J]of h){if(h.delete(E),E===_)break;J.reject(aa)}}d&&(i.update_pending_count(-1),_.decrement(b))};p.promise.then(k,A=>k(null,A||"unknown"))}),fu(()=>{for(const p of h.values())p.reject(aa)}),new Promise(p=>{function _(b){function k(){b===o?p(u):_(o)}b.then(k,k)}_(o)})}function dt(t){const e=ki(t);return wu(e),e}function nu(t){const e=ki(t);return e.equals=Wc,e}function jf(t){var e=t.effects;if(e!==null){t.effects=null;for(var r=0;r<e.length;r+=1)pn(e[r])}}function Nf(t){for(var e=t.parent;e!==null;){if((e.f&Yt)===0)return(e.f&xr)===0?e:null;e=e.parent}return null}function Ko(t){var e,r=pt;dr(Nf(t));try{t.f&=~ma,jf(t),e=Tu(t)}finally{dr(r)}return e}function ru(t){var e=Ko(t);if(!t.equals(e)&&(t.wv=xu(),(!(Qe!=null&&Qe.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Lt(t,Kt);return}Kr||(Ht!==null?(Go()||Qe!=null&&Qe.is_fork)&&Ht.set(t,e):Fo(t))}function qf(t){var e,r;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(r=a.ac)==null||r.abort(aa),a.teardown=Hd,a.ac=null,bs(a,0),Vo(a))}function au(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Ua(e)}let ko=new Set;const Fr=new Map;let su=!1;function ga(t,e){var r={f:0,v:t,reactions:null,equals:Gc,rv:0,wv:0};return r}function Me(t,e){const r=ga(t);return wu(r),r}function Bf(t,e=!1,r=!0){const a=ga(t);return e||(a.equals=Wc),a}function C(t,e,r=!1){nt!==null&&(!Qn||(nt.f&Ul)!==0)&&Hc()&&(nt.f&(Yt|Er|zo|Ul))!==0&&(Dn===null||!Na.call(Dn,t))&&lf();let a=r?qt(e):e;return Fa(t,a)}function Fa(t,e){if(!t.equals(e)){var r=t.v;Kr?Fr.set(t,e):Fr.set(t,r),t.v=e;var a=zr.ensure();if(a.capture(t,r),(t.f&Yt)!==0){const i=t;(t.f&Qt)!==0&&Ko(i),Fo(i)}t.wv=xu(),iu(t,Qt),pt!==null&&(pt.f&Kt)!==0&&(pt.f&(Jn|wa))===0&&(Rn===null?Zf([t]):Rn.push(t)),!a.is_fork&&ko.size>0&&!su&&zf()}return e}function zf(){su=!1;for(const t of ko)(t.f&Kt)!==0&&Lt(t,Zn),Cs(t)&&Ua(t);ko.clear()}function hs(t){C(t,t.v+1)}function iu(t,e){var r=t.reactions;if(r!==null)for(var a=r.length,i=0;i<a;i++){var o=r[i],u=o.f,d=(u&Qt)===0;if(d&&Lt(o,e),(u&Yt)!==0){var h=o;Ht==null||Ht.delete(h),(u&ma)===0&&(u&Mn&&(o.f|=ma),iu(h,Zn))}else d&&((u&Er)!==0&&Un!==null&&Un.add(o),Yn(o))}}function qt(t){if(typeof t!="object"||t===null||va in t)return t;const e=jc(t);if(e!==Gd&&e!==Wd)return t;var r=new Map,a=Bo(t),i=Me(0),o=ha,u=d=>{if(ha===o)return d();var h=nt,p=ha;Ln(null),Ql(o);var _=d();return Ln(h),Ql(p),_};return a&&r.set("length",Me(t.length)),new Proxy(t,{defineProperty(d,h,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&sf();var _=r.get(h);return _===void 0?u(()=>{var b=Me(p.value);return r.set(h,b),b}):C(_,p.value,!0),!0},deleteProperty(d,h){var p=r.get(h);if(p===void 0){if(h in d){const _=u(()=>Me(Wt));r.set(h,_),hs(i)}}else C(p,Wt),hs(i);return!0},get(d,h,p){var x;if(h===va)return t;var _=r.get(h),b=h in d;if(_===void 0&&(!b||(x=Ra(d,h))!=null&&x.writable)&&(_=u(()=>{var A=qt(b?d[h]:Wt),N=Me(A);return N}),r.set(h,_)),_!==void 0){var k=v(_);return k===Wt?void 0:k}return Reflect.get(d,h,p)},getOwnPropertyDescriptor(d,h){var p=Reflect.getOwnPropertyDescriptor(d,h);if(p&&"value"in p){var _=r.get(h);_&&(p.value=v(_))}else if(p===void 0){var b=r.get(h),k=b==null?void 0:b.v;if(b!==void 0&&k!==Wt)return{enumerable:!0,configurable:!0,value:k,writable:!0}}return p},has(d,h){var k;if(h===va)return!0;var p=r.get(h),_=p!==void 0&&p.v!==Wt||Reflect.has(d,h);if(p!==void 0||pt!==null&&(!_||(k=Ra(d,h))!=null&&k.writable)){p===void 0&&(p=u(()=>{var x=_?qt(d[h]):Wt,A=Me(x);return A}),r.set(h,p));var b=v(p);if(b===Wt)return!1}return _},set(d,h,p,_){var $;var b=r.get(h),k=h in d;if(a&&h==="length")for(var x=p;x<b.v;x+=1){var A=r.get(x+"");A!==void 0?C(A,Wt):x in d&&(A=u(()=>Me(Wt)),r.set(x+"",A))}if(b===void 0)(!k||($=Ra(d,h))!=null&&$.writable)&&(b=u(()=>Me(void 0)),C(b,qt(p)),r.set(h,b));else{k=b.v!==Wt;var N=u(()=>qt(p));C(b,N)}var E=Reflect.getOwnPropertyDescriptor(d,h);if(E!=null&&E.set&&E.set.call(_,p),!k){if(a&&typeof h=="string"){var J=r.get("length"),he=Number(h);Number.isInteger(he)&&he>=J.v&&C(J,he+1)}hs(i)}return!0},ownKeys(d){v(i);var h=Reflect.ownKeys(d).filter(b=>{var k=r.get(b);return k===void 0||k.v!==Wt});for(var[p,_]of r)_.v!==Wt&&!(p in d)&&h.push(p);return h},setPrototypeOf(){of()}})}function Wl(t){try{if(t!==null&&typeof t=="object"&&va in t)return t[va]}catch{}return t}function Ff(t,e){return Object.is(Wl(t),Wl(e))}var Hl,ou,lu,cu;function Kf(){if(Hl===void 0){Hl=window,ou=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,r=Text.prototype;lu=Ra(e,"firstChild").get,cu=Ra(e,"nextSibling").get,Kl(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Kl(r)&&(r.__t=void 0)}}function Sr(t=""){return document.createTextNode(t)}function wn(t){return lu.call(t)}function As(t){return cu.call(t)}function g(t,e){return wn(t)}function He(t,e=!1){{var r=wn(t);return r instanceof Comment&&r.data===""?As(r):r}}function y(t,e=1,r=!1){let a=t;for(;e--;)a=As(a);return a}function Uf(t){t.textContent=""}function uu(){return!1}function Gf(t,e,r){return document.createElementNS(Uc,t,void 0)}let Vl=!1;function Wf(){Vl||(Vl=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const r of t.target.elements)(e=r.__on_r)==null||e.call(r)})},{capture:!0}))}function Uo(t){var e=nt,r=pt;Ln(null),dr(null);try{return t()}finally{Ln(e),dr(r)}}function du(t,e,r,a=r){t.addEventListener(e,()=>Uo(r));const i=t.__on_r;i?t.__on_r=()=>{i(),a(!0)}:t.__on_r=()=>a(!0),Wf()}function Hf(t){pt===null&&(nt===null&&nf(),tf()),Kr&&ef()}function Vf(t,e){var r=e.last;r===null?e.last=e.first=t:(r.next=t,t.prev=r,e.last=t)}function Ar(t,e,r){var a=pt;a!==null&&(a.f&kn)!==0&&(t|=kn);var i={ctx:xn,deps:null,nodes:null,f:t|Qt|Mn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(r)try{Ua(i)}catch(d){throw pn(i),d}else e!==null&&Yn(i);var o=i;if(r&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&Ga)===0&&(o=o.first,(t&Er)!==0&&(t&qa)!==0&&o!==null&&(o.f|=qa)),o!==null&&(o.parent=a,a!==null&&Vf(o,a),nt!==null&&(nt.f&Yt)!==0&&(t&wa)===0)){var u=nt;(u.effects??(u.effects=[])).push(o)}return i}function Go(){return nt!==null&&!Qn}function fu(t){const e=Ar(bi,null,!1);return Lt(e,Kt),e.teardown=t,e}function Ka(t){Hf();var e=pt.f,r=!nt&&(e&Jn)!==0&&(e&Es)===0;if(r){var a=xn;(a.e??(a.e=[])).push(t)}else return vu(t)}function vu(t){return Ar(ys|Yd,t,!1)}function Yf(t){zr.ensure();const e=Ar(wa|Ga,t,!0);return(r={})=>new Promise(a=>{r.outro?pa(e,()=>{pn(e),a(void 0)}):(pn(e),a(void 0))})}function pu(t){return Ar(ys,t,!1)}function Qf(t){return Ar(zo|Ga,t,!0)}function Wo(t,e=0){return Ar(bi|e,t,!0)}function ae(t,e=[],r=[],a=[]){Mf(a,e,r,i=>{Ar(bi,()=>t(...i.map(v)),!0)})}function Ho(t,e=0){var r=Ar(Er|e,t,!0);return r}function On(t){return Ar(Jn|Ga,t,!0)}function hu(t){var e=t.teardown;if(e!==null){const r=Kr,a=nt;Yl(!0),Ln(null);try{e.call(null)}finally{Yl(r),Ln(a)}}}function Vo(t,e=!1){var r=t.first;for(t.first=t.last=null;r!==null;){const i=r.ac;i!==null&&Uo(()=>{i.abort(aa)});var a=r.next;(r.f&wa)!==0?r.parent=null:pn(r,e),r=a}}function Xf(t){for(var e=t.first;e!==null;){var r=e.next;(e.f&Jn)===0&&pn(e),e=r}}function pn(t,e=!0){var r=!1;(e||(t.f&zc)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(mu(t.nodes.start,t.nodes.end),r=!0),Vo(t,e&&!r),bs(t,0),Lt(t,xr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();hu(t);var i=t.parent;i!==null&&i.first!==null&&gu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function mu(t,e){for(;t!==null;){var r=t===e?null:As(t);t.remove(),t=r}}function gu(t){var e=t.parent,r=t.prev,a=t.next;r!==null&&(r.next=a),a!==null&&(a.prev=r),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=r))}function pa(t,e,r=!0){var a=[];_u(t,a,!0);var i=()=>{r&&pn(t),e&&e()},o=a.length;if(o>0){var u=()=>--o||i();for(var d of a)d.out(u)}else i()}function _u(t,e,r){if((t.f&kn)===0){t.f^=kn;var a=t.nodes&&t.nodes.t;if(a!==null)for(const d of a)(d.is_global||r)&&e.push(d);for(var i=t.first;i!==null;){var o=i.next,u=(i.f&qa)!==0||(i.f&Jn)!==0&&(t.f&Er)!==0;_u(i,e,u?r:!1),i=o}}}function Yo(t){yu(t,!0)}function yu(t,e){if((t.f&kn)!==0){t.f^=kn,(t.f&Kt)===0&&(Lt(t,Qt),Yn(t));for(var r=t.first;r!==null;){var a=r.next,i=(r.f&qa)!==0||(r.f&Jn)!==0;yu(r,i?e:!1),r=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const u of o)(u.is_global||e)&&u.in()}}function bu(t,e){if(t.nodes)for(var r=t.nodes.start,a=t.nodes.end;r!==null;){var i=r===a?null:As(r);e.append(r),r=i}}let oi=!1,Kr=!1;function Yl(t){Kr=t}let nt=null,Qn=!1;function Ln(t){nt=t}let pt=null;function dr(t){pt=t}let Dn=null;function wu(t){nt!==null&&(Dn===null?Dn=[t]:Dn.push(t))}let vn=null,yn=0,Rn=null;function Zf(t){Rn=t}let ku=1,ia=0,ha=ia;function Ql(t){ha=t}function xu(){return++ku}function Cs(t){var e=t.f;if((e&Qt)!==0)return!0;if(e&Yt&&(t.f&=~ma),(e&Zn)!==0){for(var r=t.deps,a=r.length,i=0;i<a;i++){var o=r[i];if(Cs(o)&&ru(o),o.wv>t.wv)return!0}(e&Mn)!==0&&Ht===null&&Lt(t,Kt)}return!1}function Su(t,e,r=!0){var a=t.reactions;if(a!==null&&!(Dn!==null&&Na.call(Dn,t)))for(var i=0;i<a.length;i++){var o=a[i];(o.f&Yt)!==0?Su(o,e,!1):e===o&&(r?Lt(o,Qt):(o.f&Kt)!==0&&Lt(o,Zn),Yn(o))}}function Tu(t){var N;var e=vn,r=yn,a=Rn,i=nt,o=Dn,u=xn,d=Qn,h=ha,p=t.f;vn=null,yn=0,Rn=null,nt=(p&(Jn|wa))===0?t:null,Dn=null,Ba(t.ctx),Qn=!1,ha=++ia,t.ac!==null&&(Uo(()=>{t.ac.abort(aa)}),t.ac=null);try{t.f|=ho;var _=t.fn,b=_();t.f|=Es;var k=t.deps,x=Qe==null?void 0:Qe.is_fork;if(vn!==null){var A;if(x||bs(t,yn),k!==null&&yn>0)for(k.length=yn+vn.length,A=0;A<vn.length;A++)k[yn+A]=vn[A];else t.deps=k=vn;if(Go()&&(t.f&Mn)!==0)for(A=yn;A<k.length;A++)((N=k[A]).reactions??(N.reactions=[])).push(t)}else!x&&k!==null&&yn<k.length&&(bs(t,yn),k.length=yn);if(Hc()&&Rn!==null&&!Qn&&k!==null&&(t.f&(Yt|Zn|Qt))===0)for(A=0;A<Rn.length;A++)Su(Rn[A],t);if(i!==null&&i!==t){if(ia++,i.deps!==null)for(let E=0;E<r;E+=1)i.deps[E].rv=ia;if(e!==null)for(const E of e)E.rv=ia;Rn!==null&&(a===null?a=Rn:a.push(...Rn))}return(t.f&qr)!==0&&(t.f^=qr),b}catch(E){return Yc(E)}finally{t.f^=ho,vn=e,yn=r,Rn=a,nt=i,Dn=o,Ba(u),Qn=d,ha=h}}function Jf(t,e){let r=e.reactions;if(r!==null){var a=Fd.call(r,t);if(a!==-1){var i=r.length-1;i===0?r=e.reactions=null:(r[a]=r[i],r.pop())}}if(r===null&&(e.f&Yt)!==0&&(vn===null||!Na.call(vn,e))){var o=e;(o.f&Mn)!==0&&(o.f^=Mn,o.f&=~ma),Fo(o),qf(o),bs(o,0)}}function bs(t,e){var r=t.deps;if(r!==null)for(var a=e;a<r.length;a++)Jf(t,r[a])}function Ua(t){var e=t.f;if((e&xr)===0){Lt(t,Kt);var r=pt,a=oi;pt=t,oi=!0;try{(e&(Er|qc))!==0?Xf(t):Vo(t),hu(t);var i=Tu(t);t.teardown=typeof i=="function"?i:null,t.wv=ku;var o;po&&kf&&(t.f&Qt)!==0&&t.deps}finally{oi=a,pt=r}}}async function Eu(){await Promise.resolve(),Tf()}function v(t){var e=t.f,r=(e&Yt)!==0;if(nt!==null&&!Qn){var a=pt!==null&&(pt.f&xr)!==0;if(!a&&(Dn===null||!Na.call(Dn,t))){var i=nt.deps;if((nt.f&ho)!==0)t.rv<ia&&(t.rv=ia,vn===null&&i!==null&&i[yn]===t?yn++:vn===null?vn=[t]:vn.push(t));else{(nt.deps??(nt.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[nt]:Na.call(o,nt)||o.push(nt)}}}if(Kr&&Fr.has(t))return Fr.get(t);if(r){var u=t;if(Kr){var d=u.v;return((u.f&Kt)===0&&u.reactions!==null||Cu(u))&&(d=Ko(u)),Fr.set(u,d),d}var h=(u.f&Mn)===0&&!Qn&&nt!==null&&(oi||(nt.f&Mn)!==0),p=(u.f&Es)===0;Cs(u)&&(h&&(u.f|=Mn),ru(u)),h&&!p&&(au(u),Au(u))}if(Ht!=null&&Ht.has(t))return Ht.get(t);if((t.f&qr)!==0)throw t.v;return t.v}function Au(t){if(t.f|=Mn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&Yt)!==0&&(e.f&Mn)===0&&(au(e),Au(e))}function Cu(t){if(t.v===Wt)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Fr.has(e)||(e.f&Yt)!==0&&Cu(e))return!0;return!1}function Rs(t){var e=Qn;try{return Qn=!0,t()}finally{Qn=e}}const $f=["touchstart","touchmove"];function ev(t){return $f.includes(t)}const Ru=new Set,xo=new Set;function Ct(t){for(var e=0;e<t.length;e++)Ru.add(t[e]);for(var r of xo)r(t)}let Xl=null;function Zl(t){var E;var e=this,r=e.ownerDocument,a=t.type,i=((E=t.composedPath)==null?void 0:E.call(t))||[],o=i[0]||t.target;Xl=t;var u=0,d=Xl===t&&t.__root;if(d){var h=i.indexOf(d);if(h!==-1&&(e===document||e===window)){t.__root=e;return}var p=i.indexOf(e);if(p===-1)return;h<=p&&(u=h)}if(o=i[u]||t.target,o!==e){Kd(t,"currentTarget",{configurable:!0,get(){return o||r}});var _=nt,b=pt;Ln(null),dr(null);try{for(var k,x=[];o!==null;){var A=o.assignedSlot||o.parentNode||o.host||null;try{var N=o["__"+a];N!=null&&(!o.disabled||t.target===o)&&N.call(o,t)}catch(J){k?x.push(J):k=J}if(t.cancelBubble||A===e||A===null)break;o=A}if(k){for(let J of x)queueMicrotask(()=>{throw J});throw k}}finally{t.__root=e,delete t.currentTarget,Ln(_),dr(b)}}}var Mc,Dc;const $i=(Dc=(Mc=globalThis==null?void 0:globalThis.window)==null?void 0:Mc.trustedTypes)==null?void 0:Dc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function tv(t){return($i==null?void 0:$i.createHTML(t))??t}function Qo(t,e=!1){var r=Gf("template");return t=t.replaceAll("<!>","<!---->"),r.innerHTML=e?tv(t):t,r.content}function _a(t,e){var r=pt;r.nodes===null&&(r.nodes={start:t,end:e,a:null,t:null})}function O(t,e){var r=(e&Kc)!==0,a=(e&_f)!==0,i,o=!t.startsWith("<!>");return()=>{i===void 0&&(i=Qo(o?t:"<!>"+t,!0),r||(i=wn(i)));var u=a||ou?document.importNode(i,!0):i.cloneNode(!0);if(r){var d=wn(u),h=u.lastChild;_a(d,h)}else _a(u,u);return u}}function nv(t,e,r="svg"){var a=!t.startsWith("<!>"),i=(e&Kc)!==0,o=`<${r}>${a?t:"<!>"+t}</${r}>`,u;return()=>{if(!u){var d=Qo(o,!0),h=wn(d);if(i)for(u=document.createDocumentFragment();wn(h);)u.appendChild(wn(h));else u=wn(h)}var p=u.cloneNode(!0);if(i){var _=wn(p),b=p.lastChild;_a(_,b)}else _a(p,p);return p}}function Xo(t,e){return nv(t,e,"svg")}function Tr(t=""){{var e=Sr(t+"");return _a(e,e),e}}function vr(){var t=document.createDocumentFragment(),e=document.createComment(""),r=Sr();return t.append(e,r),_a(e,r),t}function T(t,e){t!==null&&t.before(e)}function K(t,e){var r=e==null?"":typeof e=="object"?e+"":e;r!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=r,t.nodeValue=r+"")}function rv(t,e){return av(t,e)}const Js=new Map;function av(t,{target:e,anchor:r,props:a={},events:i,context:o,intro:u=!0}){Kf();var d=new Set,h=b=>{for(var k=0;k<b.length;k++){var x=b[k];if(!d.has(x)){d.add(x);var A=ev(x);for(const J of[e,document]){var N=Js.get(J);N===void 0&&(N=new Map,Js.set(J,N));var E=N.get(x);E===void 0?(J.addEventListener(x,Zl,{passive:A}),N.set(x,1)):N.set(x,E+1)}}}};h(yi(Ru)),xo.add(h);var p=void 0,_=Yf(()=>{var b=r??e.appendChild(Sr());return Rf(b,{pending:()=>{}},k=>{ht({});var x=xn;o&&(x.c=o),i&&(a.$$events=i),p=t(k,a)||{},mt()}),()=>{var N;for(var k of d)for(const E of[e,document]){var x=Js.get(E),A=x.get(k);--A==0?(E.removeEventListener(k,Zl),x.delete(k),x.size===0&&Js.delete(E)):x.set(k,A)}xo.delete(h),b!==r&&((N=b.parentNode)==null||N.removeChild(b))}});return sv.set(p,_),p}let sv=new WeakMap;var Wn,cr,bn,fa,Ss,Ts,_i;class iv{constructor(e,r=!0){et(this,"anchor");tt(this,Wn,new Map);tt(this,cr,new Map);tt(this,bn,new Map);tt(this,fa,new Set);tt(this,Ss,!0);tt(this,Ts,()=>{var e=Qe;if(pe(this,Wn).has(e)){var r=pe(this,Wn).get(e),a=pe(this,cr).get(r);if(a)Yo(a),pe(this,fa).delete(r);else{var i=pe(this,bn).get(r);i&&(pe(this,cr).set(r,i.effect),pe(this,bn).delete(r),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),a=i.effect)}for(const[o,u]of pe(this,Wn)){if(pe(this,Wn).delete(o),o===e)break;const d=pe(this,bn).get(u);d&&(pn(d.effect),pe(this,bn).delete(u))}for(const[o,u]of pe(this,cr)){if(o===r||pe(this,fa).has(o))continue;const d=()=>{if(Array.from(pe(this,Wn).values()).includes(o)){var p=document.createDocumentFragment();bu(u,p),p.append(Sr()),pe(this,bn).set(o,{effect:u,fragment:p})}else pn(u);pe(this,fa).delete(o),pe(this,cr).delete(o)};pe(this,Ss)||!a?(pe(this,fa).add(o),pa(u,d,!1)):d()}}});tt(this,_i,e=>{pe(this,Wn).delete(e);const r=Array.from(pe(this,Wn).values());for(const[a,i]of pe(this,bn))r.includes(a)||(pn(i.effect),pe(this,bn).delete(a))});this.anchor=e,Ze(this,Ss,r)}ensure(e,r){var a=Qe,i=uu();if(r&&!pe(this,cr).has(e)&&!pe(this,bn).has(e))if(i){var o=document.createDocumentFragment(),u=Sr();o.append(u),pe(this,bn).set(e,{effect:On(()=>r(u)),fragment:o})}else pe(this,cr).set(e,On(()=>r(this.anchor)));if(pe(this,Wn).set(a,e),i){for(const[d,h]of pe(this,cr))d===e?a.unskip_effect(h):a.skip_effect(h);for(const[d,h]of pe(this,bn))d===e?a.unskip_effect(h.effect):a.skip_effect(h.effect);a.oncommit(pe(this,Ts)),a.ondiscard(pe(this,_i))}else pe(this,Ts).call(this)}}Wn=new WeakMap,cr=new WeakMap,bn=new WeakMap,fa=new WeakMap,Ss=new WeakMap,Ts=new WeakMap,_i=new WeakMap;function le(t,e,r=!1){var a=new iv(t),i=r?qa:0;function o(u,d){a.ensure(u,d)}Ho(()=>{var u=!1;e((d,h=0)=>{u=!0,o(h,d)}),u||o(!1,null)},i)}function Ft(t,e){return e}function ov(t,e,r){for(var a=[],i=e.length,o,u=e.length,d=0;d<i;d++){let b=e[d];pa(b,()=>{if(o){if(o.pending.delete(b),o.done.add(b),o.pending.size===0){var k=t.outrogroups;So(yi(o.done)),k.delete(o),k.size===0&&(t.outrogroups=null)}}else u-=1},!1)}if(u===0){var h=a.length===0&&r!==null;if(h){var p=r,_=p.parentNode;Uf(_),_.append(p),t.items.clear()}So(e,!h)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function So(t,e=!0){for(var r=0;r<t.length;r++)pn(t[r],e)}var Jl;function St(t,e,r,a,i,o=null){var u=t,d=new Map,h=(e&Fc)!==0;if(h){var p=t;u=p.appendChild(Sr())}var _=null,b=nu(()=>{var J=r();return Bo(J)?J:J==null?[]:yi(J)}),k,x=!0;function A(){E.fallback=_,lv(E,k,u,e,a),_!==null&&(k.length===0?(_.f&kr)===0?Yo(_):(_.f^=kr,ds(_,null,u)):pa(_,()=>{_=null}))}var N=Ho(()=>{k=v(b);for(var J=k.length,he=new Set,$=Qe,R=uu(),Y=0;Y<J;Y+=1){var ne=k[Y],F=a(ne,Y),fe=x?null:d.get(F);fe?(fe.v&&Fa(fe.v,ne),fe.i&&Fa(fe.i,Y),R&&$.unskip_effect(fe.e)):(fe=cv(d,x?u:Jl??(Jl=Sr()),ne,F,Y,i,e,r),x||(fe.e.f|=kr),d.set(F,fe)),he.add(F)}if(J===0&&o&&!_&&(x?_=On(()=>o(u)):(_=On(()=>o(Jl??(Jl=Sr()))),_.f|=kr)),J>he.size&&$d(),!x)if(R){for(const[we,Te]of d)he.has(we)||$.skip_effect(Te.e);$.oncommit(A),$.ondiscard(()=>{})}else A();v(b)}),E={effect:N,items:d,outrogroups:null,fallback:_};x=!1}function rs(t){for(;t!==null&&(t.f&Jn)===0;)t=t.next;return t}function lv(t,e,r,a,i){var Te,ye,de,_e,ve,ce,V,Q,X;var o=(a&ff)!==0,u=e.length,d=t.items,h=rs(t.effect.first),p,_=null,b,k=[],x=[],A,N,E,J;if(o)for(J=0;J<u;J+=1)A=e[J],N=i(A,J),E=d.get(N).e,(E.f&kr)===0&&((ye=(Te=E.nodes)==null?void 0:Te.a)==null||ye.measure(),(b??(b=new Set)).add(E));for(J=0;J<u;J+=1){if(A=e[J],N=i(A,J),E=d.get(N).e,t.outrogroups!==null)for(const ue of t.outrogroups)ue.pending.delete(E),ue.done.delete(E);if((E.f&kr)!==0)if(E.f^=kr,E===h)ds(E,null,r);else{var he=_?_.next:h;E===t.effect.last&&(t.effect.last=E.prev),E.prev&&(E.prev.next=E.next),E.next&&(E.next.prev=E.prev),Dr(t,_,E),Dr(t,E,he),ds(E,he,r),_=E,k=[],x=[],h=rs(_.next);continue}if((E.f&kn)!==0&&(Yo(E),o&&((_e=(de=E.nodes)==null?void 0:de.a)==null||_e.unfix(),(b??(b=new Set)).delete(E))),E!==h){if(p!==void 0&&p.has(E)){if(k.length<x.length){var $=x[0],R;_=$.prev;var Y=k[0],ne=k[k.length-1];for(R=0;R<k.length;R+=1)ds(k[R],$,r);for(R=0;R<x.length;R+=1)p.delete(x[R]);Dr(t,Y.prev,ne.next),Dr(t,_,Y),Dr(t,ne,$),h=$,_=ne,J-=1,k=[],x=[]}else p.delete(E),ds(E,h,r),Dr(t,E.prev,E.next),Dr(t,E,_===null?t.effect.first:_.next),Dr(t,_,E),_=E;continue}for(k=[],x=[];h!==null&&h!==E;)(p??(p=new Set)).add(h),x.push(h),h=rs(h.next);if(h===null)continue}(E.f&kr)===0&&k.push(E),_=E,h=rs(E.next)}if(t.outrogroups!==null){for(const ue of t.outrogroups)ue.pending.size===0&&(So(yi(ue.done)),(ve=t.outrogroups)==null||ve.delete(ue));t.outrogroups.size===0&&(t.outrogroups=null)}if(h!==null||p!==void 0){var F=[];if(p!==void 0)for(E of p)(E.f&kn)===0&&F.push(E);for(;h!==null;)(h.f&kn)===0&&h!==t.fallback&&F.push(h),h=rs(h.next);var fe=F.length;if(fe>0){var we=(a&Fc)!==0&&u===0?r:null;if(o){for(J=0;J<fe;J+=1)(V=(ce=F[J].nodes)==null?void 0:ce.a)==null||V.measure();for(J=0;J<fe;J+=1)(X=(Q=F[J].nodes)==null?void 0:Q.a)==null||X.fix()}ov(t,F,we)}}o&&Br(()=>{var ue,ie;if(b!==void 0)for(E of b)(ie=(ue=E.nodes)==null?void 0:ue.a)==null||ie.apply()})}function cv(t,e,r,a,i,o,u,d){var h=(u&uf)!==0?(u&vf)===0?Bf(r,!1,!1):ga(r):null,p=(u&df)!==0?ga(i):null;return{v:h,i:p,e:On(()=>(o(e,h??r,p??i,d),()=>{t.delete(a)}))}}function ds(t,e,r){if(t.nodes)for(var a=t.nodes.start,i=t.nodes.end,o=e&&(e.f&kr)===0?e.nodes.start:r;a!==null;){var u=As(a);if(o.before(a),a===i)return;a=u}}function Dr(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function uv(t,e,r=!1,a=!1,i=!1){var o=t,u="";ae(()=>{var d=pt;if(u!==(u=e()??"")&&(d.nodes!==null&&(mu(d.nodes.start,d.nodes.end),d.nodes=null),u!=="")){var h=u+"";r?h=`<svg>${h}</svg>`:a&&(h=`<math>${h}</math>`);var p=Qo(h);if((r||a)&&(p=wn(p)),_a(wn(p),p.lastChild),r||a)for(;wn(p);)o.before(wn(p));else o.before(p)}})}const $l=[...` 	
\r\fÂ \v\uFEFF`];function dv(t,e,r){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),r){for(var i in r)if(r[i])a=a?a+" "+i:i;else if(a.length)for(var o=i.length,u=0;(u=a.indexOf(i,u))>=0;){var d=u+o;(u===0||$l.includes(a[u-1]))&&(d===a.length||$l.includes(a[d]))?a=(u===0?"":a.substring(0,u))+a.substring(d+1):u=d}}return a===""?null:a}function ec(t,e=!1){var r=e?" !important;":";",a="";for(var i in t){var o=t[i];o!=null&&o!==""&&(a+=" "+i+": "+o+r)}return a}function eo(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function fv(t,e){if(e){var r="",a,i;if(Array.isArray(e)?(a=e[0],i=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,u=0,d=!1,h=[];a&&h.push(...Object.keys(a).map(eo)),i&&h.push(...Object.keys(i).map(eo));var p=0,_=-1;const N=t.length;for(var b=0;b<N;b++){var k=t[b];if(d?k==="/"&&t[b-1]==="*"&&(d=!1):o?o===k&&(o=!1):k==="/"&&t[b+1]==="*"?d=!0:k==='"'||k==="'"?o=k:k==="("?u++:k===")"&&u--,!d&&o===!1&&u===0){if(k===":"&&_===-1)_=b;else if(k===";"||b===N-1){if(_!==-1){var x=eo(t.substring(p,_).trim());if(!h.includes(x)){k!==";"&&b++;var A=t.substring(p,b).trim();r+=" "+A+";"}}p=b+1,_=-1}}}}return a&&(r+=ec(a)),i&&(r+=ec(i,!0)),r=r.trim(),r===""?null:r}return t==null?null:String(t)}function Tt(t,e,r,a,i,o){var u=t.__className;if(u!==r||u===void 0){var d=dv(r,a,o);d==null?t.removeAttribute("class"):e?t.className=d:t.setAttribute("class",d),t.__className=r}else if(o&&i!==o)for(var h in o){var p=!!o[h];(i==null||p!==!!i[h])&&t.classList.toggle(h,p)}return o}function to(t,e={},r,a){for(var i in r){var o=r[i];e[i]!==o&&(r[i]==null?t.style.removeProperty(i):t.style.setProperty(i,o,a))}}function hn(t,e,r,a){var i=t.__style;if(i!==e){var o=fv(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(to(t,r==null?void 0:r[0],a[0]),to(t,r==null?void 0:r[1],a[1],"important")):to(t,r,a));return a}function Pu(t,e,r=!1){if(t.multiple){if(e==null)return;if(!Bo(e))return yf();for(var a of t.options)a.selected=e.includes(ms(a));return}for(a of t.options){var i=ms(a);if(Ff(i,e)){a.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function vv(t){var e=new MutationObserver(()=>{Pu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),fu(()=>{e.disconnect()})}function xi(t,e,r=e){var a=new WeakSet,i=!0;du(t,"change",o=>{var u=o?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(u),ms);else{var h=t.querySelector(u)??t.querySelector("option:not([disabled])");d=h&&ms(h)}r(d),Qe!==null&&a.add(Qe)}),pu(()=>{var o=e();if(t===document.activeElement){var u=di??Qe;if(a.has(u))return}if(Pu(t,o,i),i&&o===void 0){var d=t.querySelector(":checked");d!==null&&(o=ms(d),r(o))}t.__value=o,i=!1}),vv(t)}function ms(t){return"__value"in t?t.__value:t.value}const pv=Symbol("is custom element"),hv=Symbol("is html");function Iu(t,e,r,a){var i=mv(t);i[e]!==(i[e]=r)&&(e==="loading"&&(t[Xd]=r),r==null?t.removeAttribute(e):typeof r!="string"&&gv(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function mv(t){return t.__attributes??(t.__attributes={[pv]:t.nodeName.includes("-"),[hv]:t.namespaceURI===Uc})}var tc=new Map;function gv(t){var e=t.getAttribute("is")||t.nodeName,r=tc.get(e);if(r)return r;tc.set(e,r=[]);for(var a,i=t,o=Element.prototype;o!==i;){a=Ud(i);for(var u in a)a[u].set&&r.push(u);i=jc(i)}return r}function Si(t,e,r=e){var a=new WeakSet;du(t,"input",async i=>{var o=i?t.defaultValue:t.value;if(o=no(t)?ro(o):o,r(o),Qe!==null&&a.add(Qe),await Eu(),o!==(o=e())){var u=t.selectionStart,d=t.selectionEnd,h=t.value.length;if(t.value=o??"",d!==null){var p=t.value.length;u===d&&d===h&&p>h?(t.selectionStart=p,t.selectionEnd=p):(t.selectionStart=u,t.selectionEnd=Math.min(d,p))}}}),Rs(e)==null&&t.value&&(r(no(t)?ro(t.value):t.value),Qe!==null&&a.add(Qe)),Wo(()=>{var i=e();if(t===document.activeElement){var o=di??Qe;if(a.has(o))return}no(t)&&i===ro(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function no(t){var e=t.type;return e==="number"||e==="range"}function ro(t){return t===""?null:+t}function nc(t,e){return t===e||(t==null?void 0:t[va])===e}function Ou(t={},e,r,a){return pu(()=>{var i,o;return Wo(()=>{i=o,o=[],Rs(()=>{t!==r(...o)&&(e(t,...o),i&&nc(r(...i),t)&&e(null,...i))})}),()=>{Br(()=>{o&&nc(r(...o),t)&&e(null,...o)})}}),t}let $s=!1;function _v(t){var e=$s;try{return $s=!1,[t(),$s]}finally{$s=e}}function Oe(t,e,r,a){var he;var i=(r&mf)!==0,o=(r&gf)!==0,u=a,d=!0,h=()=>(d&&(d=!1,u=o?Rs(a):a),u),p;if(i){var _=va in t||Qd in t;p=((he=Ra(t,e))==null?void 0:he.set)??(_&&e in t?$=>t[e]=$:void 0)}var b,k=!1;i?[b,k]=_v(()=>t[e]):b=t[e],b===void 0&&a!==void 0&&(b=h(),p&&(af(),p(b)));var x;if(x=()=>{var $=t[e];return $===void 0?h():(d=!0,$)},(r&hf)===0)return x;if(p){var A=t.$$legacy;return(function($,R){return arguments.length>0?((!R||A||k)&&p(R?x():$),$):x()})}var N=!1,E=((r&pf)!==0?ki:nu)(()=>(N=!1,x()));i&&v(E);var J=pt;return(function($,R){if(arguments.length>0){const Y=R?v(E):i?qt($):$;return C(E,Y),N=!0,u!==void 0&&(u=Y),$}return Kr&&N||(J.f&xr)!==0?E.v:v(E)})}function Xt(t){xn===null&&Zd(),Ka(()=>{const e=Rs(t);if(typeof e=="function")return e})}const yv="5";var Lc;typeof window<"u"&&((Lc=window.__svelte??(window.__svelte={})).v??(Lc.v=new Set)).add(yv);const ur=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function Zo(t){return ur.find(e=>e.id===t)}const bv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:ur,getModelInfo:Zo},Symbol.toStringTag,{value:"Module"})),Xn=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Mu(){return Xn.filter(t=>t.recommended)}function Jo(t){return Xn.find(e=>e.name===t||e.name.startsWith(t+":"))}const wv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Xn,getOllamaModelInfo:Jo,getRecommendedOllamaModels:Mu},Symbol.toStringTag,{value:"Module"}));let dn=null,wr="idle",li=null,ta=new Set;function ei(){return dn||(dn=new Worker(new URL(""+new URL("worker-CB9TH5z_.js",import.meta.url).href,import.meta.url),{type:"module"}),dn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(wr="loading"),e.status==="ready"&&(wr="ready"),e.status==="start"&&(wr="generating"),(e.status==="complete"||e.status==="error")&&(wr=li?"ready":"idle");for(const r of ta)try{r(e)}catch{}})),dn}function ao(){return{check(){ei().postMessage({type:"check"})},loadModel(t){li=t,wr="loading",ei().postMessage({type:"load",modelId:t})},generate(t,e){ei().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,r){return new Promise((a,i)=>{let o="",u=null,d=0,h=0;const p=b=>{switch(b.status){case"start":h=b.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=b.output,u=b.tps??u,d=b.numTokens??d,r)try{r({tps:u,numTokens:d,text:o})}catch{}break;case"complete":_(),a({text:o,tps:u,numTokens:d,inputTokens:h});break;case"error":_(),i(new Error(b.data));break}},_=()=>{ta.delete(p)};ta.add(p),ei().postMessage({type:"generate",data:t,options:e})})},interrupt(){dn==null||dn.postMessage({type:"interrupt"})},reset(){dn==null||dn.postMessage({type:"reset"})},onMessage(t){return ta.add(t),()=>ta.delete(t)},offMessage(t){ta.delete(t)},get status(){return wr},get isReady(){return wr==="ready"},get isGenerating(){return wr==="generating"},get modelId(){return li},terminate(){dn==null||dn.terminate(),dn=null,wr="idle",li=null,ta.clear()}}}const rc="http://localhost:11434";function Ps(){try{return localStorage.getItem("ollamaUrl")||rc}catch{return rc}}function kv(t){try{localStorage.setItem("ollamaUrl",t)}catch{}}async function To(t=Ps()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function xv(t=Ps()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function Sv(t,e,{temperature:r=.7,maxTokens:a=4096,keepAlive:i}={},o=()=>{},u=Ps()){var A;const d={model:t,messages:e,stream:!0,options:{temperature:r,num_predict:a}};i!==void 0?d.keep_alive=i:d.keep_alive="10m";const h=new AbortController,p=setTimeout(()=>h.abort(),3e5),_=await fetch(`${u}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:h.signal});if(clearTimeout(p),!_.ok){const N=await _.text();throw new Error(`Ollama API error: ${N}`)}const b=_.body.getReader(),k=new TextDecoder;let x="";try{for(;;){const{done:N,value:E}=await b.read();if(N)break;const he=k.decode(E).split(`
`).filter(Boolean);for(const $ of he)try{const R=JSON.parse($);if((A=R.message)!=null&&A.content&&(x+=R.message.content,o({content:R.message.content,done:!1,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration})),R.done){o({content:"",done:!0,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration});break}}catch{}}}finally{b.releaseLock()}return x}let _n="idle",Ca=null,na=new Set;function Kn(t){for(const e of na)try{e(t)}catch{}}function Tv(){return{async check(){_n="loading",Kn({status:"loading",data:"Testing Ollama connection..."});const t=await To();t.connected?(_n="idle",Kn({status:"ready",data:{type:"ollama",version:t.version,url:Ps()}})):(_n="idle",Kn({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ca=t,_n="loading",Kn({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await To();if(!e.connected){_n="idle",Ca=null,Kn({status:"error",data:`Ollama not available: ${e.error}`});return}_n="ready",Kn({status:"ready"})},async generate(t,e={}){if(!Ca){Kn({status:"error",data:"No Ollama model selected"});return}_n="generating",Kn({status:"start",inputTokens:0});let r=0,a=performance.now();try{await Sv(Ca,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},i=>{if(i.content){r++;const o=performance.now()-a,u=o>0?r/o*1e3:0;Kn({status:"update",output:i.content,tps:Math.round(u*10)/10,numTokens:r})}i.done&&(_n="ready",Kn({status:"complete",tps:i.eval_duration?Math.round(i.eval_count/(i.eval_duration/1e9)*10)/10:null,numTokens:i.eval_count||r}))})}catch(i){_n="ready",Kn({status:"error",data:i.message})}},generateFull(t,e,r){return new Promise((a,i)=>{let o="",u=null,d=0,h=0;const p=b=>{switch(b.status){case"start":h=b.inputTokens||0;break;case"update":if(o+=b.output,u=b.tps??u,d=b.numTokens??d,r)try{r({tps:u,numTokens:d,text:o})}catch{}break;case"complete":_(),a({text:o,tps:u,numTokens:d,inputTokens:h});break;case"error":_(),i(new Error(b.data));break}},_=()=>{na.delete(p)};na.add(p),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return na.add(t),()=>na.delete(t)},offMessage(t){na.delete(t)},get status(){return _n},get isReady(){return _n==="ready"},get isGenerating(){return _n==="generating"},get modelId(){return Ca},get backend(){return"ollama"},terminate(){_n="idle",Ca=null,na.clear()}}}let ea=null,Ye=null,so=new Set;function Ev(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function Du(){return{loadModel(t){const e=Ev(t);if(ea!==e){Ye&&Ye.terminate(),ea=e,Ye=e==="webgpu"?ao():Tv();for(const r of so)Ye.onMessage(r)}Ye.loadModel(t)},check(){Ye||(Ye=ao(),ea="webgpu"),Ye.check()},generate(t,e){if(!Ye)throw new Error("No engine loaded. Call loadModel() first.");return Ye.generate(t,e)},generateFull(t,e,r){return Ye?Ye.generateFull(t,e,r):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Ye==null||Ye.interrupt()},reset(){Ye==null||Ye.reset()},onMessage(t){return Ye||(Ye=ao(),ea="webgpu"),so.add(t),Ye.onMessage(t)},offMessage(t){so.delete(t),Ye==null||Ye.offMessage(t)},get status(){return(Ye==null?void 0:Ye.status)||"idle"},get isReady(){return(Ye==null?void 0:Ye.isReady)||!1},get isGenerating(){return(Ye==null?void 0:Ye.isGenerating)||!1},get modelId(){return(Ye==null?void 0:Ye.modelId)||null},get backend(){return ea},getModelInfo(){const t=this.modelId;return t?ea==="webgpu"?Zo(t):Jo(t):null},terminate(){Ye==null||Ye.terminate(),Ye=null,ea=null}}}var Av=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ci={exports:{}},Rv=ci.exports,ac;function Pv(){return ac||(ac=1,(function(t,e){((r,a)=>{t.exports=a()})(Rv,function(){var r=function(n,s){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,c){l.__proto__=c}:function(l,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(l[f]=c[f])}))(n,s)},a=function(){return(a=Object.assign||function(n){for(var s,l=1,c=arguments.length;l<c;l++)for(var f in s=arguments[l])Object.prototype.hasOwnProperty.call(s,f)&&(n[f]=s[f]);return n}).apply(this,arguments)};function i(n,s,l){for(var c,f=0,m=s.length;f<m;f++)!c&&f in s||((c=c||Array.prototype.slice.call(s,0,f))[f]=s[f]);return n.concat(c||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Av,u=Object.keys,d=Array.isArray;function h(n,s){return typeof s=="object"&&u(s).forEach(function(l){n[l]=s[l]}),n}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var p=Object.getPrototypeOf,_={}.hasOwnProperty;function b(n,s){return _.call(n,s)}function k(n,s){typeof s=="function"&&(s=s(p(n))),(typeof Reflect>"u"?u:Reflect.ownKeys)(s).forEach(function(l){A(n,l,s[l])})}var x=Object.defineProperty;function A(n,s,l,c){x(n,s,h(l&&b(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},c))}function N(n){return{from:function(s){return n.prototype=Object.create(s.prototype),A(n.prototype,"constructor",n),{extend:k.bind(null,n.prototype)}}}}var E=Object.getOwnPropertyDescriptor,J=[].slice;function he(n,s,l){return J.call(n,s,l)}function $(n,s){return s(n)}function R(n){if(!n)throw new Error("Assertion Failed")}function Y(n){o.setImmediate?setImmediate(n):setTimeout(n,0)}function ne(n,s){if(typeof s=="string"&&b(n,s))return n[s];if(!s)return n;if(typeof s!="string"){for(var l=[],c=0,f=s.length;c<f;++c){var m=ne(n,s[c]);l.push(m)}return l}var w,S=s.indexOf(".");return S===-1||(w=n[s.substr(0,S)])==null?void 0:ne(w,s.substr(S+1))}function F(n,s,l){if(n&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof s!="string"&&"length"in s){R(typeof l!="string"&&"length"in l);for(var c=0,f=s.length;c<f;++c)F(n,s[c],l[c])}else{var m,w,S=s.indexOf(".");S!==-1?(m=s.substr(0,S),(S=s.substr(S+1))===""?l===void 0?d(n)&&!isNaN(parseInt(m))?n.splice(m,1):delete n[m]:n[m]=l:F(w=(w=n[m])&&b(n,m)?w:n[m]={},S,l)):l===void 0?d(n)&&!isNaN(parseInt(s))?n.splice(s,1):delete n[s]:n[s]=l}}function fe(n){var s,l={};for(s in n)b(n,s)&&(l[s]=n[s]);return l}var we=[].concat;function Te(n){return we.apply([],n)}var se="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Te([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(s){return s+n+"Array"})}))).filter(function(n){return o[n]}),ye=new Set(se.map(function(n){return o[n]})),de=null;function _e(n){return de=new WeakMap,n=(function s(l){if(!l||typeof l!="object")return l;var c=de.get(l);if(c)return c;if(d(l)){c=[],de.set(l,c);for(var f=0,m=l.length;f<m;++f)c.push(s(l[f]))}else if(ye.has(l.constructor))c=l;else{var w,S=p(l);for(w in c=S===Object.prototype?{}:Object.create(S),de.set(l,c),l)b(l,w)&&(c[w]=s(l[w]))}return c})(n),de=null,n}var ve={}.toString;function ce(n){return ve.call(n).slice(8,-1)}var V=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Q=typeof V=="symbol"?function(n){var s;return n!=null&&(s=n[V])&&s.apply(n)}:function(){return null};function X(n,s){s=n.indexOf(s),0<=s&&n.splice(s,1)}var ue={};function ie(n){var s,l,c,f;if(arguments.length===1){if(d(n))return n.slice();if(this===ue&&typeof n=="string")return[n];if(f=Q(n))for(l=[];!(c=f.next()).done;)l.push(c.value);else{if(n==null)return[n];if(typeof(s=n.length)!="number")return[n];for(l=new Array(s);s--;)l[s]=n[s]}}else for(s=arguments.length,l=new Array(s);s--;)l[s]=arguments[s];return l}var oe=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},se=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Et=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(se),re={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function G(n,s){this.name=n,this.message=s}function H(n,s){return n+". Errors: "+Object.keys(s).map(function(l){return s[l].toString()}).filter(function(l,c,f){return f.indexOf(l)===c}).join(`
`)}function ee(n,s,l,c){this.failures=s,this.failedKeys=c,this.successCount=l,this.message=H(n,s)}function me(n,s){this.name="BulkError",this.failures=Object.keys(s).map(function(l){return s[l]}),this.failuresByPos=s,this.message=H(n,this.failures)}N(G).from(Error).extend({toString:function(){return this.name+": "+this.message}}),N(ee).from(G),N(me).from(G);var De=Et.reduce(function(n,s){return n[s]=s+"Error",n},{}),Ne=G,z=Et.reduce(function(n,s){var l=s+"Error";function c(f,m){this.name=l,f?typeof f=="string"?(this.message="".concat(f).concat(m?`
 `+m:""),this.inner=m||null):typeof f=="object"&&(this.message="".concat(f.name," ").concat(f.message),this.inner=f):(this.message=re[s]||l,this.inner=null)}return N(c).from(Ne),n[s]=c,n},{}),ke=(z.Syntax=SyntaxError,z.Type=TypeError,z.Range=RangeError,se.reduce(function(n,s){return n[s+"Error"]=z[s],n},{}));se=Et.reduce(function(n,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(n[s+"Error"]=z[s]),n},{});function Ce(){}function ze(n){return n}function Ve(n,s){return n==null||n===ze?s:function(l){return s(n(l))}}function ot(n,s){return function(){n.apply(this,arguments),s.apply(this,arguments)}}function Rt(n,s){return n===Ce?s:function(){var l=n.apply(this,arguments),c=(l!==void 0&&(arguments[0]=l),this.onsuccess),f=this.onerror,m=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return c&&(this.onsuccess=this.onsuccess?ot(c,this.onsuccess):c),f&&(this.onerror=this.onerror?ot(f,this.onerror):f),m!==void 0?m:l}}function Bt(n,s){return n===Ce?s:function(){n.apply(this,arguments);var l=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?ot(l,this.onsuccess):l),c&&(this.onerror=this.onerror?ot(c,this.onerror):c)}}function jt(n,s){return n===Ce?s:function(f){var c=n.apply(this,arguments),f=(h(f,c),this.onsuccess),m=this.onerror,w=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return f&&(this.onsuccess=this.onsuccess?ot(f,this.onsuccess):f),m&&(this.onerror=this.onerror?ot(m,this.onerror):m),c===void 0?w===void 0?void 0:w:h(c,w)}}function rt(n,s){return n===Ce?s:function(){return s.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function Be(n,s){return n===Ce?s:function(){var l=n.apply(this,arguments);if(l&&typeof l.then=="function"){for(var c=this,f=arguments.length,m=new Array(f);f--;)m[f]=arguments[f];return l.then(function(){return s.apply(c,m)})}return s.apply(this,arguments)}}se.ModifyError=ee,se.DexieError=G,se.BulkError=me;var We=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function gt(n){We=n}var Pt={},ln=100,mn=typeof Promise>"u"?[]:(Et=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[mn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),p(mn),Et]:[Et,p(Et),Et]),Et=mn[0],Ea=mn[1],Ea=Ea&&Ea.then,Je=Et&&Et.constructor,It=!!mn[2],Gt=function(n,s){Zt.push([n,s]),Nn&&(queueMicrotask(Rr),Nn=!1)},$n=!0,Nn=!0,Tn=[],qn=[],er=ze,vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ce,pgp:!1,env:{},finalize:Ce},Le=vt,Zt=[],Jt=0,Cr=[];function Ie(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=Le;if(typeof n!="function"){if(n!==Pt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&pr(this,this._value)}else this._state=null,this._value=null,++s.ref,(function l(c,f){try{f(function(m){if(c._state===null){if(m===c)throw new TypeError("A promise cannot be resolved with itself.");var w=c._lib&&Pr();m&&typeof m.then=="function"?l(c,function(S,D){m instanceof Ie?m._then(S,D):m.then(S,D)}):(c._state=!0,c._value=m,Ms(c)),w&&hr()}},pr.bind(null,c))}catch(m){pr(c,m)}})(this,n)}var tr={get:function(){var n=Le,s=Vr;function l(c,f){var m=this,w=!n.global&&(n!==Le||s!==Vr),S=w&&!zn(),D=new Ie(function(W,L){Wa(m,new Os(I(c,n,w,S),I(f,n,w,S),W,L,n))});return this._consoleTask&&(D._consoleTask=this._consoleTask),D}return l.prototype=Pt,l},set:function(n){A(this,"then",n&&n.prototype===Pt?tr:{get:function(){return n},set:tr.set})}};function Os(n,s,l,c,f){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof s=="function"?s:null,this.resolve=l,this.reject=c,this.psd=f}function pr(n,s){var l,c;qn.push(s),n._state===null&&(l=n._lib&&Pr(),s=er(s),n._state=!1,n._value=s,c=n,Tn.some(function(f){return f._value===c._value})||Tn.push(c),Ms(n),l)&&hr()}function Ms(n){var s=n._listeners;n._listeners=[];for(var l=0,c=s.length;l<c;++l)Wa(n,s[l]);var f=n._PSD;--f.ref||f.finalize(),Jt===0&&(++Jt,Gt(function(){--Jt==0&&Gr()},[]))}function Wa(n,s){if(n._state===null)n._listeners.push(s);else{var l=n._state?s.onFulfilled:s.onRejected;if(l===null)return(n._state?s.resolve:s.reject)(n._value);++s.psd.ref,++Jt,Gt(Ot,[l,n,s])}}function Ot(n,s,l){try{var c,f=s._value;!s._state&&qn.length&&(qn=[]),c=We&&s._consoleTask?s._consoleTask.run(function(){return n(f)}):n(f),s._state||qn.indexOf(f)!==-1||(m=>{for(var w=Tn.length;w;)if(Tn[--w]._value===m._value)return Tn.splice(w,1)})(s),l.resolve(c)}catch(m){l.reject(m)}finally{--Jt==0&&Gr(),--l.psd.ref||l.psd.finalize()}}function Rr(){Ke(vt,function(){Pr()&&hr()})}function Pr(){var n=$n;return Nn=$n=!1,n}function hr(){var n,s,l;do for(;0<Zt.length;)for(n=Zt,Zt=[],l=n.length,s=0;s<l;++s){var c=n[s];c[0].apply(null,c[1])}while(0<Zt.length);Nn=$n=!0}function Gr(){for(var n=Tn,s=(Tn=[],n.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)}),Cr.slice(0)),l=s.length;l;)s[--l]()}function Wr(n){return new Ie(Pt,!1,n)}function _t(n,s){var l=Le;return function(){var c=Pr(),f=Le;try{return Fn(l,!0),n.apply(this,arguments)}catch(m){s&&s(m)}finally{Fn(f,!1),c&&hr()}}}k(Ie.prototype,{then:tr,_then:function(n,s){Wa(this,new Os(null,null,n,s,Le))},catch:function(n){var s,l;return arguments.length===1?this.then(null,n):(s=n,l=arguments[1],typeof s=="function"?this.then(null,function(c){return(c instanceof s?l:Wr)(c)}):this.then(null,function(c){return(c&&c.name===s?l:Wr)(c)}))},finally:function(n){return this.then(function(s){return Ie.resolve(n()).then(function(){return s})},function(s){return Ie.resolve(n()).then(function(){return Wr(s)})})},timeout:function(n,s){var l=this;return n<1/0?new Ie(function(c,f){var m=setTimeout(function(){return f(new z.Timeout(s))},n);l.then(c,f).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&A(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),vt.env=Ls(),k(Ie,{all:function(){var n=ie.apply(null,arguments).map(Yr);return new Ie(function(s,l){n.length===0&&s([]);var c=n.length;n.forEach(function(f,m){return Ie.resolve(f).then(function(w){n[m]=w,--c||s(n)},l)})})},resolve:function(n){return n instanceof Ie?n:n&&typeof n.then=="function"?new Ie(function(s,l){n.then(s,l)}):new Ie(Pt,!0,n)},reject:Wr,race:function(){var n=ie.apply(null,arguments).map(Yr);return new Ie(function(s,l){n.map(function(c){return Ie.resolve(c).then(s,l)})})},PSD:{get:function(){return Le},set:function(n){return Le=n}},totalEchoes:{get:function(){return Vr}},newPSD:Bn,usePSD:Ke,scheduler:{get:function(){return Gt},set:function(n){Gt=n}},rejectionMapper:{get:function(){return er},set:function(n){er=n}},follow:function(n,s){return new Ie(function(l,c){return Bn(function(f,m){var w=Le;w.unhandleds=[],w.onunhandled=m,w.finalize=ot(function(){var S,D=this;S=function(){D.unhandleds.length===0?f():m(D.unhandleds[0])},Cr.push(function W(){S(),Cr.splice(Cr.indexOf(W),1)}),++Jt,Gt(function(){--Jt==0&&Gr()},[])},w.finalize),n()},s,l,c)})}}),Je&&(Je.allSettled&&A(Ie,"allSettled",function(){var n=ie.apply(null,arguments).map(Yr);return new Ie(function(s){n.length===0&&s([]);var l=n.length,c=new Array(l);n.forEach(function(f,m){return Ie.resolve(f).then(function(w){return c[m]={status:"fulfilled",value:w}},function(w){return c[m]={status:"rejected",reason:w}}).then(function(){return--l||s(c)})})})}),Je.any&&typeof AggregateError<"u"&&A(Ie,"any",function(){var n=ie.apply(null,arguments).map(Yr);return new Ie(function(s,l){n.length===0&&l(new AggregateError([]));var c=n.length,f=new Array(c);n.forEach(function(m,w){return Ie.resolve(m).then(function(S){return s(S)},function(S){f[w]=S,--c||l(new AggregateError(f))})})})}),Je.withResolvers)&&(Ie.withResolvers=Je.withResolvers);var Nt={awaits:0,echoes:0,id:0},En=0,An=[],Hr=0,Vr=0,Ha=0;function Bn(n,w,l,c){var f=Le,m=Object.create(f),w=(m.parent=f,m.ref=0,m.global=!1,m.id=++Ha,vt.env,m.env=It?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject}:{},w&&h(m,w),++f.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()},Ke(m,n,l,c));return m.ref===0&&m.finalize(),w}function $t(){return Nt.id||(Nt.id=++En),++Nt.awaits,Nt.echoes+=ln,Nt.id}function zn(){return!!Nt.awaits&&(--Nt.awaits==0&&(Nt.id=0),Nt.echoes=Nt.awaits*ln,!0)}function Yr(n){return Nt.echoes&&n&&n.constructor===Je?($t(),n.then(function(s){return zn(),s},function(s){return zn(),Ae(s)})):n}function Ds(){var n=An[An.length-1];An.pop(),Fn(n,!1)}function Fn(n,s){var l,c,f=Le;(s?!Nt.echoes||Hr++&&n===Le:!Hr||--Hr&&n===Le)||queueMicrotask(s?(function(m){++Vr,Nt.echoes&&--Nt.echoes!=0||(Nt.echoes=Nt.awaits=Nt.id=0),An.push(Le),Fn(m,!0)}).bind(null,n):Ds),n!==Le&&(Le=n,f===vt&&(vt.env=Ls()),It)&&(l=vt.env.Promise,c=n.env,f.global||n.global)&&(Object.defineProperty(o,"Promise",c.PromiseProp),l.all=c.all,l.race=c.race,l.resolve=c.resolve,l.reject=c.reject,c.allSettled&&(l.allSettled=c.allSettled),c.any)&&(l.any=c.any)}function Ls(){var n=o.Promise;return It?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function Ke(n,s,l,c,f){var m=Le;try{return Fn(n,!0),s(l,c,f)}finally{Fn(m,!1)}}function I(n,s,l,c){return typeof n!="function"?n:function(){var f=Le;l&&$t(),Fn(s,!0);try{return n.apply(this,arguments)}finally{Fn(f,!1),c&&queueMicrotask(zn)}}}function Se(n){Promise===Je&&Nt.echoes===0?Hr===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+Ea).indexOf("[native code]")===-1&&($t=zn=Ce);var Ae=Ie.reject,lt="ï¿¿",yt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",kt="String expected.",Mt=[],cn="__dbnames",nr="readonly",Qr="readwrite";function wt(n,s){return n?s?function(){return n.apply(this,arguments)&&s.apply(this,arguments)}:n:s}var Va={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Xr(n){return typeof n!="string"||/\./.test(n)?function(s){return s}:function(s){return s[n]===void 0&&n in s&&delete(s=_e(s))[n],s}}function pl(){throw z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function at(n,s){try{var l=hl(n),c=hl(s);if(l!==c)return l==="Array"?1:c==="Array"?-1:l==="binary"?1:c==="binary"?-1:l==="string"?1:c==="string"?-1:l==="Date"?1:c!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return s<n?1:n<s?-1:0;case"binary":for(var f=ml(n),m=ml(s),w=f.length,S=m.length,D=w<S?w:S,W=0;W<D;++W)if(f[W]!==m[W])return f[W]<m[W]?-1:1;return w===S?0:w<S?-1:1;case"Array":for(var L=n,P=s,q=L.length,B=P.length,j=q<B?q:B,M=0;M<j;++M){var Z=at(L[M],P[M]);if(Z!==0)return Z}return q===B?0:q<B?-1:1}}catch{}return NaN}function hl(n){var s=typeof n;return s=="object"&&(ArrayBuffer.isView(n)||(s=ce(n))==="ArrayBuffer")?"binary":s}function ml(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}function js(n,s,l){var c=n.schema.yProps;return c?(s&&0<l.numFailures&&(s=s.filter(function(f,m){return!l.failures[m]})),Promise.all(c.map(function(f){return f=f.updatesTable,s?n.db.table(f).where("k").anyOf(s).delete():n.db.table(f).clear()})).then(function(){return l})):l}gl.prototype.execute=function(n){var s=this["@@propmod"];if(s.add!==void 0){var l=s.add;if(d(l))return i(i([],d(n)?n:[],!0),l).sort();if(typeof l=="number")return(Number(n)||0)+l;if(typeof l=="bigint")try{return BigInt(n)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(s.remove!==void 0){var c=s.remove;if(d(c))return d(n)?n.filter(function(f){return!c.includes(f)}).sort():[];if(typeof c=="number")return Number(n)-c;if(typeof c=="bigint")try{return BigInt(n)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return l=(l=s.replacePrefix)==null?void 0:l[0],l&&typeof n=="string"&&n.startsWith(l)?s.replacePrefix[1]+n.substring(l.length):n};var Ya=gl;function gl(n){this["@@propmod"]=n}function _l(n,s){for(var l=u(s),c=l.length,f=!1,m=0;m<c;++m){var w=l[m],S=s[w],D=ne(n,w);S instanceof Ya?(F(n,w,S.execute(D)),f=!0):D!==S&&(F(n,w,S),f=!0)}return f}bt.prototype._trans=function(n,s,l){var c=this._tx||Le.trans,f=this.name,m=We&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function w(W,L,P){if(P.schema[f])return s(P.idbtrans,P);throw new z.NotFound("Table "+f+" not part of transaction")}var S=Pr();try{var D=c&&c.db._novip===this.db._novip?c===Le.trans?c._promise(n,w,l):Bn(function(){return c._promise(n,w,l)},{trans:c,transless:Le.transless||Le}):(function W(L,P,q,B){if(L.idbdb&&(L._state.openComplete||Le.letThrough||L._vip)){var j=L._createTransaction(P,q,L._dbSchema);try{j.create(),L._state.PR1398_maxLoop=3}catch(M){return M.name===De.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return W(L,P,q,B)})):Ae(M)}return j._promise(P,function(M,Z){return Bn(function(){return Le.trans=j,B(M,Z,j)})}).then(function(M){if(P==="readwrite")try{j.idbtrans.commit()}catch{}return P==="readonly"?M:j._completion.then(function(){return M})})}if(L._state.openComplete)return Ae(new z.DatabaseClosed(L._state.dbOpenError));if(!L._state.isBeingOpened){if(!L._state.autoOpen)return Ae(new z.DatabaseClosed);L.open().catch(Ce)}return L._state.dbReadyPromise.then(function(){return W(L,P,q,B)})})(this.db,n,[this.name],w);return m&&(D._consoleTask=m,D=D.catch(function(W){return console.trace(W),Ae(W)})),D}finally{S&&hr()}},bt.prototype.get=function(n,s){var l=this;return n&&n.constructor===Object?this.where(n).first(s):n==null?Ae(new z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(c){return l.core.get({trans:c,key:n}).then(function(f){return l.hook.reading.fire(f)})}).then(s)},bt.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(d(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var s=u(n);if(s.length===1)return this.where(s[0]).equals(n[s[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&s.every(function(W){return 0<=S.keyPath.indexOf(W)})){for(var D=0;D<s.length;++D)if(s.indexOf(S.keyPath[D])===-1)return!1;return!0}return!1}).sort(function(S,D){return S.keyPath.length-D.keyPath.length})[0];if(l&&this.db._maxKey!==lt)return w=l.keyPath.slice(0,s.length),this.where(w).equals(w.map(function(S){return n[S]}));!l&&We&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var c=this.schema.idxByName;function f(S,D){return at(S,D)===0}var w=s.reduce(function(L,D){var W=L[0],L=L[1],P=c[D],q=n[D];return[W||P,W||!P?wt(L,P&&P.multi?function(B){return B=ne(B,D),d(B)&&B.some(function(j){return f(q,j)})}:function(B){return f(q,ne(B,D))}):L]},[null,null]),m=w[0],w=w[1];return m?this.where(m.name).equals(n[m.keyPath]).filter(w):l?this.filter(w):this.where(s).equals("")},bt.prototype.filter=function(n){return this.toCollection().and(n)},bt.prototype.count=function(n){return this.toCollection().count(n)},bt.prototype.offset=function(n){return this.toCollection().offset(n)},bt.prototype.limit=function(n){return this.toCollection().limit(n)},bt.prototype.each=function(n){return this.toCollection().each(n)},bt.prototype.toArray=function(n){return this.toCollection().toArray(n)},bt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},bt.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,d(n)?"[".concat(n.join("+"),"]"):n))},bt.prototype.reverse=function(){return this.toCollection().reverse()},bt.prototype.mapToClass=function(n){for(var s=this.db,l=this.name,c=((this.schema.mappedClass=n).prototype instanceof pl&&(n=(w=>{var S=L,D=w;if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function W(){this.constructor=S}function L(){return w!==null&&w.apply(this,arguments)||this}return r(S,D),S.prototype=D===null?Object.create(D):(W.prototype=D.prototype,new W),Object.defineProperty(L.prototype,"db",{get:function(){return s},enumerable:!1,configurable:!0}),L.prototype.table=function(){return l},L})(n)),new Set),f=n.prototype;f;f=p(f))Object.getOwnPropertyNames(f).forEach(function(w){return c.add(w)});function m(w){if(!w)return w;var S,D=Object.create(n.prototype);for(S in w)if(!c.has(S))try{D[S]=w[S]}catch{}return D}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=m,this.hook("reading",m),n},bt.prototype.defineClass=function(){return this.mapToClass(function(n){h(this,n)})},bt.prototype.add=function(n,s){var l=this,c=this.schema.primKey,f=c.auto,m=c.keyPath,w=n;return m&&f&&(w=Xr(m)(n)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:s!=null?[s]:null,values:[w]})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(m)try{F(n,m,S)}catch{}return S})},bt.prototype.upsert=function(n,s){var l=this,c=this.schema.primKey.keyPath;return this._trans("readwrite",function(f){return l.core.get({trans:f,key:n}).then(function(m){var w=m??{};return _l(w,s),c&&F(w,c,n),l.core.mutate({trans:f,type:"put",values:[w],keys:[n],upsert:!0,updates:{keys:[n],changeSpecs:[s]}}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):!!m})})})},bt.prototype.update=function(n,s){return typeof n!="object"||d(n)?this.where(":id").equals(n).modify(s):(n=ne(n,this.schema.primKey.keyPath))===void 0?Ae(new z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(s)},bt.prototype.put=function(n,s){var l=this,c=this.schema.primKey,f=c.auto,m=c.keyPath,w=n;return m&&f&&(w=Xr(m)(n)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[w],keys:s!=null?[s]:null})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(m)try{F(n,m,S)}catch{}return S})},bt.prototype.delete=function(n){var s=this;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:[n]}).then(function(c){return js(s,[n],c)}).then(function(c){return c.numFailures?Ie.reject(c.failures[0]):void 0})})},bt.prototype.clear=function(){var n=this;return this._trans("readwrite",function(s){return n.core.mutate({trans:s,type:"deleteRange",range:Va}).then(function(l){return js(n,null,l)})}).then(function(s){return s.numFailures?Ie.reject(s.failures[0]):void 0})},bt.prototype.bulkGet=function(n){var s=this;return this._trans("readonly",function(l){return s.core.getMany({keys:n,trans:l}).then(function(c){return c.map(function(f){return s.hook.reading.fire(f)})})})},bt.prototype.bulkAdd=function(n,s,l){var c=this,f=Array.isArray(s)?s:void 0,m=(l=l||(f?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=c.schema.primKey,W=S.auto,S=S.keyPath;if(S&&f)throw new z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(f&&f.length!==n.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var D=n.length,W=S&&W?n.map(Xr(S)):n;return c.core.mutate({trans:w,type:"add",keys:f,values:W,wantResults:m}).then(function(L){var P=L.numFailures,q=L.failures;if(P===0)return m?L.results:L.lastResult;throw new me("".concat(c.name,".bulkAdd(): ").concat(P," of ").concat(D," operations failed"),q)})})},bt.prototype.bulkPut=function(n,s,l){var c=this,f=Array.isArray(s)?s:void 0,m=(l=l||(f?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=c.schema.primKey,W=S.auto,S=S.keyPath;if(S&&f)throw new z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(f&&f.length!==n.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var D=n.length,W=S&&W?n.map(Xr(S)):n;return c.core.mutate({trans:w,type:"put",keys:f,values:W,wantResults:m}).then(function(L){var P=L.numFailures,q=L.failures;if(P===0)return m?L.results:L.lastResult;throw new me("".concat(c.name,".bulkPut(): ").concat(P," of ").concat(D," operations failed"),q)})})},bt.prototype.bulkUpdate=function(n){var s=this,l=this.core,c=n.map(function(w){return w.key}),f=n.map(function(w){return w.changes}),m=[];return this._trans("readwrite",function(w){return l.getMany({trans:w,keys:c,cache:"clone"}).then(function(S){var D=[],W=[],L=(n.forEach(function(P,q){var B=P.key,j=P.changes,M=S[q];if(M){for(var Z=0,te=Object.keys(j);Z<te.length;Z++){var U=te[Z],ge=j[U];if(U===s.schema.primKey.keyPath){if(at(ge,B)!==0)throw new z.Constraint("Cannot update primary key in bulkUpdate()")}else F(M,U,ge)}m.push(q),D.push(B),W.push(M)}}),D.length);return l.mutate({trans:w,type:"put",keys:D,values:W,updates:{keys:c,changeSpecs:f}}).then(function(P){var q=P.numFailures,B=P.failures;if(q===0)return L;for(var j=0,M=Object.keys(B);j<M.length;j++){var Z,te=M[j],U=m[Number(te)];U!=null&&(Z=B[te],delete B[te],B[U]=Z)}throw new me("".concat(s.name,".bulkUpdate(): ").concat(q," of ").concat(L," operations failed"),B)})})})},bt.prototype.bulkDelete=function(n){var s=this,l=n.length;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:n}).then(function(f){return js(s,n,f)})}).then(function(c){var f=c.numFailures,m=c.failures;if(f===0)return c.lastResult;throw new me("".concat(s.name,".bulkDelete(): ").concat(f," of ").concat(l," operations failed"),m)})};var yl=bt;function bt(){}function Qa(n){function s(w,S){if(S){for(var D=arguments.length,W=new Array(D-1);--D;)W[D-1]=arguments[D];return l[w].subscribe.apply(null,W),n}if(typeof w=="string")return l[w]}var l={};s.addEventType=m;for(var c=1,f=arguments.length;c<f;++c)m(arguments[c]);return s;function m(w,S,D){var W,L;if(typeof w!="object")return S=S||rt,L={subscribers:[],fire:D=D||Ce,subscribe:function(P){L.subscribers.indexOf(P)===-1&&(L.subscribers.push(P),L.fire=S(L.fire,P))},unsubscribe:function(P){L.subscribers=L.subscribers.filter(function(q){return q!==P}),L.fire=L.subscribers.reduce(S,D)}},l[w]=s[w]=L;u(W=w).forEach(function(P){var q=W[P];if(d(q))m(P,W[P][0],W[P][1]);else{if(q!=="asap")throw new z.InvalidArgument("Invalid event config");var B=m(P,ze,function(){for(var j=arguments.length,M=new Array(j);j--;)M[j]=arguments[j];B.subscribers.forEach(function(Z){Y(function(){Z.apply(null,M)})})})}})}}function Xa(n,s){return N(s).from({prototype:n}),s}function xa(n,s){return!(n.filter||n.algorithm||n.or)&&(s?n.justLimit:!n.replayFilter)}function Ci(n,s){n.filter=wt(n.filter,s)}function Ri(n,s,l){var c=n.replayFilter;n.replayFilter=c?function(){return wt(c(),s())}:s,n.justLimit=l&&!c}function Ns(n,s){if(n.isPrimKey)return s.primaryKey;var l=s.getIndexByKeyPath(n.index);if(l)return l;throw new z.Schema("KeyPath "+n.index+" on object store "+s.name+" is not indexed")}function bl(n,s,l){var c=Ns(n,s.schema);return s.openCursor({trans:l,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:c,range:n.range}})}function qs(n,s,l,c){var f,m,w=n.replayFilter?wt(n.filter,n.replayFilter()):n.filter;return n.or?(f={},m=function(S,D,W){var L,P;w&&!w(D,W,function(q){return D.stop(q)},function(q){return D.fail(q)})||((P=""+(L=D.primaryKey))=="[object ArrayBuffer]"&&(P=""+new Uint8Array(L)),b(f,P))||(f[P]=!0,s(S,D,W))},Promise.all([n.or._iterate(m,l),wl(bl(n,c,l),n.algorithm,m,!n.keysOnly&&n.valueMapper)])):wl(bl(n,c,l),wt(n.algorithm,w),s,!n.keysOnly&&n.valueMapper)}function wl(n,s,l,c){var f=_t(c?function(m,w,S){return l(c(m),w,S)}:l);return n.then(function(m){if(m)return m.start(function(){var w=function(){return m.continue()};s&&!s(m,function(S){return w=S},function(S){m.stop(S),w=Ce},function(S){m.fail(S),w=Ce})||f(m.value,m,function(S){return w=S}),w()})})}ct.prototype._read=function(n,s){var l=this._ctx;return l.error?l.table._trans(null,Ae.bind(null,l.error)):l.table._trans("readonly",n).then(s)},ct.prototype._write=function(n){var s=this._ctx;return s.error?s.table._trans(null,Ae.bind(null,s.error)):s.table._trans("readwrite",n,"locked")},ct.prototype._addAlgorithm=function(n){var s=this._ctx;s.algorithm=wt(s.algorithm,n)},ct.prototype._iterate=function(n,s){return qs(this._ctx,n,s,this._ctx.table.core)},ct.prototype.clone=function(n){var s=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return n&&h(l,n),s._ctx=l,s},ct.prototype.raw=function(){return this._ctx.valueMapper=null,this},ct.prototype.each=function(n){var s=this._ctx;return this._read(function(l){return qs(s,n,l,s.table.core)})},ct.prototype.count=function(n){var s=this;return this._read(function(l){var c,f=s._ctx,m=f.table.core;return xa(f,!0)?m.count({trans:l,query:{index:Ns(f,m.schema),range:f.range}}).then(function(w){return Math.min(w,f.limit)}):(c=0,qs(f,function(){return++c,!1},l,m).then(function(){return c}))}).then(n)},ct.prototype.sortBy=function(n,s){var l=n.split(".").reverse(),c=l[0],f=l.length-1;function m(D,W){return W?m(D[l[W]],W-1):D[c]}var w=this._ctx.dir==="next"?1:-1;function S(D,W){return at(m(D,f),m(W,f))*w}return this.toArray(function(D){return D.sort(S)}).then(s)},ct.prototype.toArray=function(n){var s=this;return this._read(function(l){var c,f,m,w=s._ctx;return w.dir==="next"&&xa(w,!0)&&0<w.limit?(c=w.valueMapper,f=Ns(w,w.table.core.schema),w.table.core.query({trans:l,limit:w.limit,values:!0,query:{index:f,range:w.range}}).then(function(S){return S=S.result,c?S.map(c):S})):(m=[],qs(w,function(S){return m.push(S)},l,w.table.core).then(function(){return m}))},n)},ct.prototype.offset=function(n){var s=this._ctx;return n<=0||(s.offset+=n,xa(s)?Ri(s,function(){var l=n;return function(c,f){return l===0||(l===1?--l:f(function(){c.advance(l),l=0}),!1)}}):Ri(s,function(){var l=n;return function(){return--l<0}})),this},ct.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),Ri(this._ctx,function(){var s=n;return function(l,c,f){return--s<=0&&c(f),0<=s}},!0),this},ct.prototype.until=function(n,s){return Ci(this._ctx,function(l,c,f){return!n(l.value)||(c(f),s)}),this},ct.prototype.first=function(n){return this.limit(1).toArray(function(s){return s[0]}).then(n)},ct.prototype.last=function(n){return this.reverse().first(n)},ct.prototype.filter=function(n){var s;return Ci(this._ctx,function(l){return n(l.value)}),(s=this._ctx).isMatch=wt(s.isMatch,n),this},ct.prototype.and=function(n){return this.filter(n)},ct.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},ct.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ct.prototype.desc=function(){return this.reverse()},ct.prototype.eachKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,c){n(c.key,c)})},ct.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},ct.prototype.eachPrimaryKey=function(n){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,c){n(c.primaryKey,c)})},ct.prototype.keys=function(n){var s=this._ctx,l=(s.keysOnly=!s.isMatch,[]);return this.each(function(c,f){l.push(f.key)}).then(function(){return l}).then(n)},ct.prototype.primaryKeys=function(n){var s=this._ctx;if(s.dir==="next"&&xa(s,!0)&&0<s.limit)return this._read(function(c){var f=Ns(s,s.table.core.schema);return s.table.core.query({trans:c,values:!1,limit:s.limit,query:{index:f,range:s.range}})}).then(function(c){return c.result}).then(n);s.keysOnly=!s.isMatch;var l=[];return this.each(function(c,f){l.push(f.primaryKey)}).then(function(){return l}).then(n)},ct.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},ct.prototype.firstKey=function(n){return this.limit(1).keys(function(s){return s[0]}).then(n)},ct.prototype.lastKey=function(n){return this.reverse().firstKey(n)},ct.prototype.distinct=function(){var n,s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];return s&&s.multi&&(n={},Ci(this._ctx,function(c){var c=c.primaryKey.toString(),f=b(n,c);return n[c]=!0,!f})),this},ct.prototype.modify=function(n){var s=this,l=this._ctx;return this._write(function(c){function f(M,Z){var te=Z.failures;q+=M-Z.numFailures;for(var U=0,ge=u(te);U<ge.length;U++){var be=ge[U];P.push(te[be])}}var m=typeof n=="function"?n:function(M){return _l(M,n)},w=l.table.core,L=w.schema.primaryKey,S=L.outbound,D=L.extractKey,W=200,L=s.db._options.modifyChunkSize,P=(L&&(W=typeof L=="object"?L[w.name]||L["*"]||200:L),[]),q=0,B=[],j=n===kl;return s.clone().primaryKeys().then(function(M){function Z(U){var ge=Math.min(W,M.length-U),be=M.slice(U,U+ge);return(j?Promise.resolve([]):w.getMany({trans:c,keys:be,cache:"immutable"})).then(function(Re){var Pe=[],xe=[],qe=S?[]:null,je=j?be:[];if(!j)for(var Ee=0;Ee<ge;++Ee){var Fe=Re[Ee],st={value:_e(Fe),primKey:M[U+Ee]};m.call(st,st.value,st)!==!1&&(st.value==null?je.push(M[U+Ee]):S||at(D(Fe),D(st.value))===0?(xe.push(st.value),S&&qe.push(M[U+Ee])):(je.push(M[U+Ee]),Pe.push(st.value)))}return Promise.resolve(0<Pe.length&&w.mutate({trans:c,type:"add",values:Pe}).then(function(ut){for(var Ge in ut.failures)je.splice(parseInt(Ge),1);f(Pe.length,ut)})).then(function(){return(0<xe.length||te&&typeof n=="object")&&w.mutate({trans:c,type:"put",keys:qe,values:xe,criteria:te,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<U}).then(function(ut){return f(xe.length,ut)})}).then(function(){return(0<je.length||te&&j)&&w.mutate({trans:c,type:"delete",keys:je,criteria:te,isAdditionalChunk:0<U}).then(function(ut){return js(l.table,je,ut)}).then(function(ut){return f(je.length,ut)})}).then(function(){return M.length>U+ge&&Z(U+W)})})}var te=xa(l)&&l.limit===1/0&&(typeof n!="function"||j)&&{index:l.index,range:l.range};return Z(0).then(function(){if(0<P.length)throw new ee("Error modifying one or more objects",P,q,B);return M.length})})})},ct.prototype.delete=function(){var n=this._ctx,s=n.range;return!xa(n)||n.table.schema.yProps||!n.isPrimKey&&s.type!==3?this.modify(kl):this._write(function(l){var c=n.table.core.schema.primaryKey,f=s;return n.table.core.count({trans:l,query:{index:c,range:f}}).then(function(m){return n.table.core.mutate({trans:l,type:"deleteRange",range:f}).then(function(D){var S=D.failures,D=D.numFailures;if(D)throw new ee("Could not delete some values",Object.keys(S).map(function(W){return S[W]}),m-D);return m-D})})})};var yd=ct;function ct(){}var kl=function(n,s){return s.value=null};function bd(n,s){return n<s?-1:n===s?0:1}function wd(n,s){return s<n?-1:n===s?0:1}function gn(n,s,l){return n=n instanceof Sl?new n.Collection(n):n,n._ctx.error=new(l||TypeError)(s),n}function Sa(n){return new n.Collection(n,function(){return xl("")}).limit(0)}function Bs(B,s,l,c){var f,m,w,S,D,W,L,P=l.length;if(!l.every(function(M){return typeof M=="string"}))return gn(B,kt);function q(M){f=M==="next"?function(te){return te.toUpperCase()}:function(te){return te.toLowerCase()},m=M==="next"?function(te){return te.toLowerCase()}:function(te){return te.toUpperCase()},w=M==="next"?bd:wd;var Z=l.map(function(te){return{lower:m(te),upper:f(te)}}).sort(function(te,U){return w(te.lower,U.lower)});S=Z.map(function(te){return te.upper}),D=Z.map(function(te){return te.lower}),L=(W=M)==="next"?"":c}q("next");var B=new B.Collection(B,function(){return Ir(S[0],D[P-1]+c)}),j=(B._ondirectionchange=function(M){q(M)},0);return B._addAlgorithm(function(M,Z,te){var U=M.key;if(typeof U=="string"){var ge=m(U);if(s(ge,D,j))return!0;for(var be=null,Re=j;Re<P;++Re){var Pe=((xe,qe,je,Ee,Fe,st)=>{for(var ut=Math.min(xe.length,Ee.length),Ge=-1,Xe=0;Xe<ut;++Xe){var xt=qe[Xe];if(xt!==Ee[Xe])return Fe(xe[Xe],je[Xe])<0?xe.substr(0,Xe)+je[Xe]+je.substr(Xe+1):Fe(xe[Xe],Ee[Xe])<0?xe.substr(0,Xe)+Ee[Xe]+je.substr(Xe+1):0<=Ge?xe.substr(0,Ge)+qe[Ge]+je.substr(Ge+1):null;Fe(xe[Xe],xt)<0&&(Ge=Xe)}return ut<Ee.length&&st==="next"?xe+je.substr(xe.length):ut<xe.length&&st==="prev"?xe.substr(0,je.length):Ge<0?null:xe.substr(0,Ge)+Ee[Ge]+je.substr(Ge+1)})(U,ge,S[Re],D[Re],w,W);Pe===null&&be===null?j=Re+1:(be===null||0<w(be,Pe))&&(be=Pe)}Z(be!==null?function(){M.continue(be+L)}:te)}return!1}),B}function Ir(n,s,l,c){return{type:2,lower:n,upper:s,lowerOpen:l,upperOpen:c}}function xl(n){return{type:1,lower:n,upper:n}}Object.defineProperty(zt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),zt.prototype.between=function(n,s,l,c){l=l!==!1,c=c===!0;try{return 0<this._cmp(n,s)||this._cmp(n,s)===0&&(l||c)&&(!l||!c)?Sa(this):new this.Collection(this,function(){return Ir(n,s,!l,!c)})}catch{return gn(this,yt)}},zt.prototype.equals=function(n){return n==null?gn(this,yt):new this.Collection(this,function(){return xl(n)})},zt.prototype.above=function(n){return n==null?gn(this,yt):new this.Collection(this,function(){return Ir(n,void 0,!0)})},zt.prototype.aboveOrEqual=function(n){return n==null?gn(this,yt):new this.Collection(this,function(){return Ir(n,void 0,!1)})},zt.prototype.below=function(n){return n==null?gn(this,yt):new this.Collection(this,function(){return Ir(void 0,n,!1,!0)})},zt.prototype.belowOrEqual=function(n){return n==null?gn(this,yt):new this.Collection(this,function(){return Ir(void 0,n)})},zt.prototype.startsWith=function(n){return typeof n!="string"?gn(this,kt):this.between(n,n+lt,!0,!0)},zt.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):Bs(this,function(s,l){return s.indexOf(l[0])===0},[n],lt)},zt.prototype.equalsIgnoreCase=function(n){return Bs(this,function(s,l){return s===l[0]},[n],"")},zt.prototype.anyOfIgnoreCase=function(){var n=ie.apply(ue,arguments);return n.length===0?Sa(this):Bs(this,function(s,l){return l.indexOf(s)!==-1},n,"")},zt.prototype.startsWithAnyOfIgnoreCase=function(){var n=ie.apply(ue,arguments);return n.length===0?Sa(this):Bs(this,function(s,l){return l.some(function(c){return s.indexOf(c)===0})},n,lt)},zt.prototype.anyOf=function(){var n,s,l=this,c=ie.apply(ue,arguments),f=this._cmp;try{c.sort(f)}catch{return gn(this,yt)}return c.length===0?Sa(this):((n=new this.Collection(this,function(){return Ir(c[0],c[c.length-1])}))._ondirectionchange=function(m){f=m==="next"?l._ascending:l._descending,c.sort(f)},s=0,n._addAlgorithm(function(m,w,S){for(var D=m.key;0<f(D,c[s]);)if(++s===c.length)return w(S),!1;return f(D,c[s])===0||(w(function(){m.continue(c[s])}),!1)}),n)},zt.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},zt.prototype.noneOf=function(){var n=ie.apply(ue,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return gn(this,yt)}var s=n.reduce(function(l,c){return l?l.concat([[l[l.length-1][1],c]]):[[-1/0,c]]},null);return s.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},zt.prototype.inAnyRange=function(n,te){var l=this,c=this._cmp,f=this._ascending,m=this._descending,w=this._min,S=this._max;if(n.length===0)return Sa(this);if(!n.every(function(U){return U[0]!==void 0&&U[1]!==void 0&&f(U[0],U[1])<=0}))return gn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",z.InvalidArgument);var D=!te||te.includeLowers!==!1,W=te&&te.includeUppers===!0,L,P=f;function q(U,ge){return P(U[0],ge[0])}try{(L=n.reduce(function(U,ge){for(var be=0,Re=U.length;be<Re;++be){var Pe=U[be];if(c(ge[0],Pe[1])<0&&0<c(ge[1],Pe[0])){Pe[0]=w(Pe[0],ge[0]),Pe[1]=S(Pe[1],ge[1]);break}}return be===Re&&U.push(ge),U},[])).sort(q)}catch{return gn(this,yt)}var B=0,j=W?function(U){return 0<f(U,L[B][1])}:function(U){return 0<=f(U,L[B][1])},M=D?function(U){return 0<m(U,L[B][0])}:function(U){return 0<=m(U,L[B][0])},Z=j,te=new this.Collection(this,function(){return Ir(L[0][0],L[L.length-1][1],!D,!W)});return te._ondirectionchange=function(U){P=U==="next"?(Z=j,f):(Z=M,m),L.sort(q)},te._addAlgorithm(function(U,ge,be){for(var Re,Pe=U.key;Z(Pe);)if(++B===L.length)return ge(be),!1;return!j(Re=Pe)&&!M(Re)||(l._cmp(Pe,L[B][1])===0||l._cmp(Pe,L[B][0])===0||ge(function(){P===f?U.continue(L[B][0]):U.continue(L[B][1])}),!1)}),te},zt.prototype.startsWithAnyOf=function(){var n=ie.apply(ue,arguments);return n.every(function(s){return typeof s=="string"})?n.length===0?Sa(this):this.inAnyRange(n.map(function(s){return[s,s+lt]})):gn(this,"startsWithAnyOf() only works with strings")};var Sl=zt;function zt(){}function rr(n){return _t(function(s){return Za(s),n(s.target.error),!1})}function Za(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Ja="storagemutated",Pi="x-storagemutated-1",Or=Qa(null,Ja),kd=(ar.prototype._lock=function(){return R(!Le.global),++this._reculock,this._reculock!==1||Le.global||(Le.lockOwnerFor=this),this},ar.prototype._unlock=function(){if(R(!Le.global),--this._reculock==0)for(Le.global||(Le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{Ke(n[1],n[0])}catch{}}return this},ar.prototype._locked=function(){return this._reculock&&Le.lockOwnerFor!==this},ar.prototype.create=function(n){var s=this;if(this.mode){var l=this.db.idbdb,c=this.db._state.dbOpenError;if(R(!this.idbtrans),!n&&!l)switch(c&&c.name){case"DatabaseClosedError":throw new z.DatabaseClosed(c);case"MissingAPIError":throw new z.MissingAPI(c.message,c);default:throw new z.OpenFailed(c)}if(!this.active)throw new z.TransactionInactive;R(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=_t(function(f){Za(f),s._reject(n.error)}),n.onabort=_t(function(f){Za(f),s.active&&s._reject(new z.Abort(n.error)),s.active=!1,s.on("abort").fire(f)}),n.oncomplete=_t(function(){s.active=!1,s._resolve(),"mutatedParts"in n&&Or.storagemutated.fire(n.mutatedParts)})}return this},ar.prototype._promise=function(n,s,l){var c,f=this;return n==="readwrite"&&this.mode!=="readwrite"?Ae(new z.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ie(function(m,w){f._blockedFuncs.push([function(){f._promise(n,s,l).then(m,w)},Le])}):l?Bn(function(){var m=new Ie(function(w,S){f._lock();var D=s(w,S,f);D&&D.then&&D.then(w,S)});return m.finally(function(){return f._unlock()}),m._lib=!0,m}):((c=new Ie(function(m,w){var S=s(m,w,f);S&&S.then&&S.then(m,w)}))._lib=!0,c):Ae(new z.TransactionInactive)},ar.prototype._root=function(){return this.parent?this.parent._root():this},ar.prototype.waitFor=function(n){var s,l=this._root(),c=Ie.resolve(n),f=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return c}):(l._waitingFor=c,l._waitingQueue=[],s=l.idbtrans.objectStore(l.storeNames[0]),(function m(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(s.get(-1/0).onsuccess=m)})()),l._waitingFor);return new Ie(function(m,w){c.then(function(S){return l._waitingQueue.push(_t(m.bind(null,S)))},function(S){return l._waitingQueue.push(_t(w.bind(null,S)))}).finally(function(){l._waitingFor===f&&(l._waitingFor=null)})})},ar.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new z.Abort))},ar.prototype.table=function(n){var s=this._memoizedTables||(this._memoizedTables={});if(b(s,n))return s[n];var l=this.schema[n];if(l)return(l=new this.db.Table(n,l,this)).core=this.db.core.table(n),s[n]=l;throw new z.NotFound("Table "+n+" not part of transaction")},ar);function ar(){}function Ii(n,s,l,c,f,m,w,S){return{name:n,keyPath:s,unique:l,multi:c,auto:f,compound:m,src:(l&&!w?"&":"")+(c?"*":"")+(f?"++":"")+Tl(s),type:S}}function Tl(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Oi(n,s,l){return{name:n,primKey:s,indexes:l,mappedClass:null,idxByName:(c=function(f){return[f.name,f]},l.reduce(function(f,m,w){return m=c(m,w),m&&(f[m[0]]=m[1]),f},{}))};var c}var $a=function(n){try{return n.only([[]]),$a=function(){return[[]]},[[]]}catch{return $a=function(){return lt},lt}};function Mi(n){return n==null?function(){}:typeof n=="string"?(s=n).split(".").length===1?function(l){return l[s]}:function(l){return ne(l,s)}:function(l){return ne(l,n)};var s}function El(n){return[].slice.call(n)}var xd=0;function es(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function Sd(n,s,D){function c(j){if(j.type===3)return null;if(j.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var P=j.lower,q=j.upper,B=j.lowerOpen,j=j.upperOpen;return P===void 0?q===void 0?null:s.upperBound(q,!!j):q===void 0?s.lowerBound(P,!!B):s.bound(P,q,!!B,!!j)}function f(L){var P,q=L.name;return{name:q,schema:L,mutate:function(B){var j=B.trans,M=B.type,Z=B.keys,te=B.values,U=B.range;return new Promise(function(ge,be){ge=_t(ge);var Re=j.objectStore(q),Pe=Re.keyPath==null,xe=M==="put"||M==="add";if(!xe&&M!=="delete"&&M!=="deleteRange")throw new Error("Invalid operation type: "+M);var qe,je=(Z||te||{length:1}).length;if(Z&&te&&Z.length!==te.length)throw new Error("Given keys array must have same length as given values array.");if(je===0)return ge({numFailures:0,failures:{},results:[],lastResult:void 0});function Ee(At){++ut,Za(At)}var Fe=[],st=[],ut=0;if(M==="deleteRange"){if(U.type===4)return ge({numFailures:ut,failures:st,results:[],lastResult:void 0});U.type===3?Fe.push(qe=Re.clear()):Fe.push(qe=Re.delete(c(U)))}else{var Pe=xe?Pe?[te,Z]:[te,null]:[Z,null],Ge=Pe[0],Xe=Pe[1];if(xe)for(var xt=0;xt<je;++xt)Fe.push(qe=Xe&&Xe[xt]!==void 0?Re[M](Ge[xt],Xe[xt]):Re[M](Ge[xt])),qe.onerror=Ee;else for(xt=0;xt<je;++xt)Fe.push(qe=Re[M](Ge[xt])),qe.onerror=Ee}function Cn(At){At=At.target.result,Fe.forEach(function($r,Zi){return $r.error!=null&&(st[Zi]=$r.error)}),ge({numFailures:ut,failures:st,results:M==="delete"?Z:Fe.map(function($r){return $r.result}),lastResult:At})}qe.onerror=function(At){Ee(At),Cn(At)},qe.onsuccess=Cn})},getMany:function(B){var j=B.trans,M=B.keys;return new Promise(function(Z,te){Z=_t(Z);for(var U,ge=j.objectStore(q),be=M.length,Re=new Array(be),Pe=0,xe=0,qe=function(Fe){Fe=Fe.target,Re[Fe._pos]=Fe.result,++xe===Pe&&Z(Re)},je=rr(te),Ee=0;Ee<be;++Ee)M[Ee]!=null&&((U=ge.get(M[Ee]))._pos=Ee,U.onsuccess=qe,U.onerror=je,++Pe);Pe===0&&Z(Re)})},get:function(B){var j=B.trans,M=B.key;return new Promise(function(Z,te){Z=_t(Z);var U=j.objectStore(q).get(M);U.onsuccess=function(ge){return Z(ge.target.result)},U.onerror=rr(te)})},query:(P=S,function(B){return new Promise(function(j,M){j=_t(j);var Z,te,U,xe=B.trans,ge=B.values,be=B.limit,Pe=B.query,Re=be===1/0?void 0:be,qe=Pe.index,Pe=Pe.range,xe=xe.objectStore(q),xe=qe.isPrimaryKey?xe:xe.index(qe.name),qe=c(Pe);if(be===0)return j({result:[]});P?((Pe=ge?xe.getAll(qe,Re):xe.getAllKeys(qe,Re)).onsuccess=function(je){return j({result:je.target.result})},Pe.onerror=rr(M)):(Z=0,te=!ge&&"openKeyCursor"in xe?xe.openKeyCursor(qe):xe.openCursor(qe),U=[],te.onsuccess=function(je){var Ee=te.result;return!Ee||(U.push(ge?Ee.value:Ee.primaryKey),++Z===be)?j({result:U}):void Ee.continue()},te.onerror=rr(M))})}),openCursor:function(B){var j=B.trans,M=B.values,Z=B.query,te=B.reverse,U=B.unique;return new Promise(function(ge,be){ge=_t(ge);var xe=Z.index,Re=Z.range,Pe=j.objectStore(q),Pe=xe.isPrimaryKey?Pe:Pe.index(xe.name),xe=te?U?"prevunique":"prev":U?"nextunique":"next",qe=!M&&"openKeyCursor"in Pe?Pe.openKeyCursor(c(Re),xe):Pe.openCursor(c(Re),xe);qe.onerror=rr(be),qe.onsuccess=_t(function(je){var Ee,Fe,st,ut,Ge=qe.result;Ge?(Ge.___id=++xd,Ge.done=!1,Ee=Ge.continue.bind(Ge),Fe=(Fe=Ge.continuePrimaryKey)&&Fe.bind(Ge),st=Ge.advance.bind(Ge),ut=function(){throw new Error("Cursor not stopped")},Ge.trans=j,Ge.stop=Ge.continue=Ge.continuePrimaryKey=Ge.advance=function(){throw new Error("Cursor not started")},Ge.fail=_t(be),Ge.next=function(){var Xe=this,xt=1;return this.start(function(){return xt--?Xe.continue():Xe.stop()}).then(function(){return Xe})},Ge.start=function(Xe){function xt(){if(qe.result)try{Xe()}catch(At){Ge.fail(At)}else Ge.done=!0,Ge.start=function(){throw new Error("Cursor behind last entry")},Ge.stop()}var Cn=new Promise(function(At,$r){At=_t(At),qe.onerror=rr($r),Ge.fail=$r,Ge.stop=function(Zi){Ge.stop=Ge.continue=Ge.continuePrimaryKey=Ge.advance=ut,At(Zi)}});return qe.onsuccess=_t(function(At){qe.onsuccess=xt,xt()}),Ge.continue=Ee,Ge.continuePrimaryKey=Fe,Ge.advance=st,xt(),Cn},ge(Ge)):ge(null)},be)})},count:function(B){var j=B.query,M=B.trans,Z=j.index,te=j.range;return new Promise(function(U,ge){var be=M.objectStore(q),be=Z.isPrimaryKey?be:be.index(Z.name),Re=c(te),Re=Re?be.count(Re):be.count();Re.onsuccess=_t(function(Pe){return U(Pe.target.result)}),Re.onerror=rr(ge)})}}}m=D,w=El((D=n).objectStoreNames);var m,D={schema:{name:D.name,tables:w.map(function(L){return m.objectStore(L)}).map(function(L){var P=L.keyPath,q=L.autoIncrement,j=d(P),B={},j={name:L.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:P==null,compound:j,keyPath:P,autoIncrement:q,unique:!0,extractKey:Mi(P)},indexes:El(L.indexNames).map(function(M){return L.index(M)}).map(function(U){var ge=U.name,Z=U.unique,te=U.multiEntry,U=U.keyPath,ge={name:ge,compound:d(U),keyPath:U,unique:Z,multiEntry:te,extractKey:Mi(U)};return B[es(U)]=ge}),getIndexByKeyPath:function(M){return B[es(M)]}};return B[":id"]=j.primaryKey,P!=null&&(B[es(P)]=j.primaryKey),j})},hasGetAll:0<w.length&&"getAll"in m.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},w=D.schema,S=D.hasGetAll,D=w.tables.map(f),W={};return D.forEach(function(L){return W[L.name]=L}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(L){if(W[L])return W[L];throw new Error("Table '".concat(L,"' not found"))},MIN_KEY:-1/0,MAX_KEY:$a(s),schema:w}}function Td(n,s,l,c){return l=l.IDBKeyRange,s=Sd(s,l,c),{dbcore:n.dbcore.reduce(function(f,m){return m=m.create,a(a({},f),m(f))},s)}}function zs(n,s){var l=s.db,l=Td(n._middlewares,l,n._deps,s);n.core=l.dbcore,n.tables.forEach(function(c){var f=c.name;n.core.schema.tables.some(function(m){return m.name===f})&&(c.core=n.core.table(f),n[f]instanceof n.Table)&&(n[f].core=c.core)})}function Fs(n,s,l,c){l.forEach(function(f){var m=c[f];s.forEach(function(w){var S=(function D(W,L){return E(W,L)||(W=p(W))&&D(W,L)})(w,f);(!S||"value"in S&&S.value===void 0)&&(w===n.Transaction.prototype||w instanceof n.Transaction?A(w,f,{get:function(){return this.table(f)},set:function(D){x(this,f,{value:D,writable:!0,configurable:!0,enumerable:!0})}}):w[f]=new n.Table(f,m))})})}function Di(n,s){s.forEach(function(l){for(var c in l)l[c]instanceof n.Table&&delete l[c]})}function Ed(n,s){return n._cfg.version-s._cfg.version}function Ad(n,s,l,c){var f=n._dbSchema,m=(l.objectStoreNames.contains("$meta")&&!f.$meta&&(f.$meta=Oi("$meta",Cl("")[0],[]),n._storeNames.push("$meta")),n._createTransaction("readwrite",n._storeNames,f)),w=(m.create(l),m._completion.catch(c),m._reject.bind(m)),S=Le.transless||Le;Bn(function(){if(Le.trans=m,Le.transless=S,s!==0)return zs(n,l),W=s,((D=m).storeNames.includes("$meta")?D.table("$meta").get("version").then(function(L){return L??W}):Ie.resolve(W)).then(function(Z){var P=n,q=Z,B=m,j=l,M=[],Z=P._versions,te=P._dbSchema=Us(0,P.idbdb,j);return(Z=Z.filter(function(U){return U._cfg.version>=q})).length===0?Ie.resolve():(Z.forEach(function(U){M.push(function(){var ge,be,Re,Pe=te,xe=U._cfg.dbschema,qe=(Gs(P,Pe,j),Gs(P,xe,j),te=P._dbSchema=xe,Li(Pe,xe)),je=(qe.add.forEach(function(Ee){ji(j,Ee[0],Ee[1].primKey,Ee[1].indexes)}),qe.change.forEach(function(Ee){if(Ee.recreate)throw new z.Upgrade("Not yet support for changing primary key");var Fe=j.objectStore(Ee.name);Ee.add.forEach(function(st){return Ks(Fe,st)}),Ee.change.forEach(function(st){Fe.deleteIndex(st.name),Ks(Fe,st)}),Ee.del.forEach(function(st){return Fe.deleteIndex(st)})}),U._cfg.contentUpgrade);if(je&&U._cfg.version>q)return zs(P,j),B._memoizedTables={},ge=fe(xe),qe.del.forEach(function(Ee){ge[Ee]=Pe[Ee]}),Di(P,[P.Transaction.prototype]),Fs(P,[P.Transaction.prototype],u(ge),ge),B.schema=ge,(be=oe(je))&&$t(),xe=Ie.follow(function(){var Ee;(Re=je(B))&&be&&(Ee=zn.bind(null,null),Re.then(Ee,Ee))}),Re&&typeof Re.then=="function"?Ie.resolve(Re):xe.then(function(){return Re})}),M.push(function(ge){var be,Re,Pe=U._cfg.dbschema;be=Pe,Re=ge,[].slice.call(Re.db.objectStoreNames).forEach(function(xe){return be[xe]==null&&Re.db.deleteObjectStore(xe)}),Di(P,[P.Transaction.prototype]),Fs(P,[P.Transaction.prototype],P._storeNames,P._dbSchema),B.schema=P._dbSchema}),M.push(function(ge){P.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(P.idbdb.version/10)===U._cfg.version?(P.idbdb.deleteObjectStore("$meta"),delete P._dbSchema.$meta,P._storeNames=P._storeNames.filter(function(be){return be!=="$meta"})):ge.objectStore("$meta").put(U._cfg.version,"version"))})}),(function U(){return M.length?Ie.resolve(M.shift()(B.idbtrans)).then(U):Ie.resolve()})().then(function(){Al(te,j)}))}).catch(w);var D,W;u(f).forEach(function(L){ji(l,L,f[L].primKey,f[L].indexes)}),zs(n,l),Ie.follow(function(){return n.on.populate.fire(m)}).catch(w)})}function Cd(n,s){Al(n._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var l=Us(0,n.idbdb,s);Gs(n,n._dbSchema,s);for(var c=0,f=Li(l,n._dbSchema).change;c<f.length;c++){var m=(w=>{if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=s.objectStore(w.name);w.add.forEach(function(D){We&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(D.src)),Ks(S,D)})})(f[c]);if(typeof m=="object")return m.value}}function Li(n,s){var l,c={del:[],add:[],change:[]};for(l in n)s[l]||c.del.push(l);for(l in s){var f=n[l],m=s[l];if(f){var w={name:l,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(f.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||f.primKey.auto!==m.primKey.auto)w.recreate=!0,c.change.push(w);else{var S=f.idxByName,D=m.idxByName,W=void 0;for(W in S)D[W]||w.del.push(W);for(W in D){var L=S[W],P=D[W];L?L.src!==P.src&&w.change.push(P):w.add.push(P)}(0<w.del.length||0<w.add.length||0<w.change.length)&&c.change.push(w)}}else c.add.push([l,m])}return c}function ji(n,s,l,c){var f=n.db.createObjectStore(s,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});c.forEach(function(m){return Ks(f,m)})}function Al(n,s){u(n).forEach(function(l){s.db.objectStoreNames.contains(l)||(We&&console.debug("Dexie: Creating missing table",l),ji(s,l,n[l].primKey,n[l].indexes))})}function Ks(n,s){n.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function Us(n,s,l){var c={};return he(s.objectStoreNames,0).forEach(function(f){for(var m=l.objectStore(f),w=Ii(Tl(W=m.keyPath),W||"",!0,!1,!!m.autoIncrement,W&&typeof W!="string",!0),S=[],D=0;D<m.indexNames.length;++D){var L=m.index(m.indexNames[D]),W=L.keyPath,L=Ii(L.name,W,!!L.unique,!!L.multiEntry,!1,W&&typeof W!="string",!1);S.push(L)}c[f]=Oi(f,w,S)}),c}function Gs(n,s,l){for(var c=l.db.objectStoreNames,f=0;f<c.length;++f){var m=c[f],w=l.objectStore(m);n._hasGetAll="getAll"in w;for(var S=0;S<w.indexNames.length;++S){var D,W=w.indexNames[S],L=w.index(W).keyPath,L=typeof L=="string"?L:"["+he(L).join("+")+"]";s[m]&&(D=s[m].idxByName[L])&&(D.name=W,delete s[m].idxByName[L],s[m].idxByName[W]=D)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function Cl(n){return n.split(",").map(function(s,l){var f=s.split(":"),c=(c=f[1])==null?void 0:c.trim(),f=(s=f[0].trim()).replace(/([&*]|\+\+)/g,""),m=/^\[/.test(f)?f.match(/^\[(.*)\]$/)[1].split("+"):f;return Ii(f,m||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),d(m),l===0,c)})}Ta.prototype._createTableSchema=Oi,Ta.prototype._parseIndexSyntax=Cl,Ta.prototype._parseStoresSpec=function(n,s){var l=this;u(n).forEach(function(c){if(n[c]!==null){var f=l._parseIndexSyntax(n[c]),m=f.shift();if(!m)throw new z.Schema("Invalid schema for table "+c+": "+n[c]);if(m.unique=!0,m.multi)throw new z.Schema("Primary key cannot be multiEntry*");f.forEach(function(w){if(w.auto)throw new z.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new z.Schema("Index must have a name and cannot be an empty string")}),m=l._createTableSchema(c,m,f),s[c]=m}})},Ta.prototype.stores=function(l){var s=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,l):l,s._versions),c={},f={};return l.forEach(function(m){h(c,m._cfg.storesSource),f=m._cfg.dbschema={},m._parseStoresSpec(c,f)}),s._dbSchema=f,Di(s,[s._allTables,s,s.Transaction.prototype]),Fs(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],u(f),f),s._storeNames=u(f),this},Ta.prototype.upgrade=function(n){return this._cfg.contentUpgrade=Be(this._cfg.contentUpgrade||Ce,n),this};var Rd=Ta;function Ta(){}function Ni(n,s){var l=n._dbNamesDB;return l||(l=n._dbNamesDB=new mr(cn,{addons:[],indexedDB:n,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function qi(n){return n&&typeof n.databases=="function"}function Bi(n){return Bn(function(){return Le.letThrough=!0,n()})}function zi(n){return!("from"in n)}var en=function(n,s){var l;if(!this)return l=new en,n&&"d"in n&&h(l,n),l;h(this,arguments.length?{d:1,from:n,to:1<arguments.length?s:n}:{d:0})};function ts(n,s,l){var c=at(s,l);if(!isNaN(c)){if(0<c)throw RangeError();if(zi(n))return h(n,{from:s,to:l,d:1});var c=n.l,f=n.r;if(at(l,n.from)<0)return c?ts(c,s,l):n.l={from:s,to:l,d:1,l:null,r:null},Pl(n);if(0<at(s,n.to))return f?ts(f,s,l):n.r={from:s,to:l,d:1,l:null,r:null},Pl(n);at(s,n.from)<0&&(n.from=s,n.l=null,n.d=f?f.d+1:1),0<at(l,n.to)&&(n.to=l,n.r=null,n.d=n.l?n.l.d+1:1),s=!n.r,c&&!n.l&&ns(n,c),f&&s&&ns(n,f)}}function ns(n,s){zi(s)||(function l(c,f){var m=f.from,w=f.l,S=f.r;ts(c,m,f.to),w&&l(c,w),S&&l(c,S)})(n,s)}function Rl(n,s){var l=Ws(s),c=l.next();if(!c.done)for(var f=c.value,m=Ws(n),w=m.next(f.from),S=w.value;!c.done&&!w.done;){if(at(S.from,f.to)<=0&&0<=at(S.to,f.from))return!0;at(f.from,S.from)<0?f=(c=l.next(S.from)).value:S=(w=m.next(f.from)).value}return!1}function Ws(n){var s=zi(n)?null:{s:0,n};return{next:function(l){for(var c=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,c)for(;s.n.l&&at(l,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!c||at(l,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function Pl(n){var s,l,c,f=(((f=n.r)==null?void 0:f.d)||0)-(((f=n.l)==null?void 0:f.d)||0),f=1<f?"r":f<-1?"l":"";f&&(s=f=="r"?"l":"r",l=a({},n),c=n[f],n.from=c.from,n.to=c.to,n[f]=c[f],l[f]=c[s],(n[s]=l).d=Il(l)),n.d=Il(n)}function Il(l){var s=l.r,l=l.l;return(s?l?Math.max(s.d,l.d):s.d:l?l.d:0)+1}function Hs(n,s){return u(s).forEach(function(l){n[l]?ns(n[l],s[l]):n[l]=(function c(f){var m,w,S={};for(m in f)b(f,m)&&(w=f[m],S[m]=!w||typeof w!="object"||ye.has(w.constructor)?w:c(w));return S})(s[l])}),n}function Fi(n,s){return n.all||s.all||Object.keys(n).some(function(l){return s[l]&&Rl(s[l],n[l])})}k(en.prototype,((Et={add:function(n){return ns(this,n),this},addKey:function(n){return ts(this,n,n),this},addKeys:function(n){var s=this;return n.forEach(function(l){return ts(s,l,l)}),this},hasKey:function(n){var s=Ws(this).next(n).value;return s&&at(s.from,n)<=0&&0<=at(s.to,n)}})[V]=function(){return Ws(this)},Et));var Zr={},Ki={},Ui=!1;function Vs(n){Hs(Ki,n),Ui||(Ui=!0,setTimeout(function(){Ui=!1,Gi(Ki,!(Ki={}))},0))}function Gi(n,s){s===void 0&&(s=!1);var l=new Set;if(n.all)for(var c=0,f=Object.values(Zr);c<f.length;c++)Ol(S=f[c],n,l,s);else for(var m in n){var w,S,m=/^idb\:\/\/(.*)\/(.*)\//.exec(m);m&&(w=m[1],m=m[2],S=Zr["idb://".concat(w,"/").concat(m)])&&Ol(S,n,l,s)}l.forEach(function(D){return D()})}function Ol(n,s,l,c){for(var f=[],m=0,w=Object.entries(n.queries.query);m<w.length;m++){for(var S=w[m],D=S[0],W=[],L=0,P=S[1];L<P.length;L++){var q=P[L];Fi(s,q.obsSet)?q.subscribers.forEach(function(Z){return l.add(Z)}):c&&W.push(q)}c&&f.push([D,W])}if(c)for(var B=0,j=f;B<j.length;B++){var M=j[B],D=M[0],W=M[1];n.queries.query[D]=W}}function Pd(n){var s=n._state,l=n._deps.indexedDB;if(s.isBeingOpened||n.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?Ae(s.dbOpenError):n});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var c=s.openCanceller,f=Math.round(10*n.verno),m=!1;function w(){if(s.openCanceller!==c)throw new z.DatabaseClosed("db.open() was cancelled")}function S(){return new Ie(function(q,B){if(w(),!l)throw new z.MissingAPI;var j=n.name,M=s.autoSchema||!f?l.open(j):l.open(j,f);if(!M)throw new z.MissingAPI;M.onerror=rr(B),M.onblocked=_t(n._fireOnBlocked),M.onupgradeneeded=_t(function(Z){var te;L=M.transaction,s.autoSchema&&!n._options.allowEmptyDB?(M.onerror=Za,L.abort(),M.result.close(),(te=l.deleteDatabase(j)).onsuccess=te.onerror=_t(function(){B(new z.NoSuchDatabase("Database ".concat(j," doesnt exist")))})):(L.onerror=rr(B),te=Z.oldVersion>Math.pow(2,62)?0:Z.oldVersion,P=te<1,n.idbdb=M.result,m&&Cd(n,L),Ad(n,te/10,L,B))},B),M.onsuccess=_t(function(){L=null;var Z,te,U,ge,be,Re,Pe=n.idbdb=M.result,xe=he(Pe.objectStoreNames);if(0<xe.length)try{var qe=Pe.transaction((be=xe).length===1?be[0]:be,"readonly");if(s.autoSchema)Re=Pe,ge=qe,(U=n).verno=Re.version/10,ge=U._dbSchema=Us(0,Re,ge),U._storeNames=he(Re.objectStoreNames,0),Fs(U,[U._allTables],u(ge),ge);else if(Gs(n,n._dbSchema,qe),te=qe,((te=Li(Us(0,(Z=n).idbdb,te),Z._dbSchema)).add.length||te.change.some(function(je){return je.add.length||je.change.length}))&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Pe.close(),f=Pe.version+1,m=!0,q(S());zs(n,qe)}catch{}Mt.push(n),Pe.onversionchange=_t(function(je){s.vcFired=!0,n.on("versionchange").fire(je)}),Pe.onclose=_t(function(){n.close({disableAutoOpen:!1})}),P&&(xe=n._deps,be=j,qi(Re=xe.indexedDB)||be===cn||Ni(Re,xe.IDBKeyRange).put({name:be}).catch(Ce)),q()},B)}).catch(function(q){switch(q==null?void 0:q.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<f)return f=0,S()}return Ie.reject(q)})}var D,W=s.dbReadyResolve,L=null,P=!1;return Ie.race([c,(typeof navigator>"u"?Ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(q){function B(){return indexedDB.databases().finally(q)}D=setInterval(B,100),B()}).finally(function(){return clearInterval(D)}):Promise.resolve()).then(S)]).then(function(){return w(),s.onReadyBeingFired=[],Ie.resolve(Bi(function(){return n.on.ready.fire(n.vip)})).then(function q(){var B;if(0<s.onReadyBeingFired.length)return B=s.onReadyBeingFired.reduce(Be,Ce),s.onReadyBeingFired=[],Ie.resolve(Bi(function(){return B(n.vip)})).then(q)})}).finally(function(){s.openCanceller===c&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(q){s.dbOpenError=q;try{L&&L.abort()}catch{}return c===s.openCanceller&&n._close(),Ae(q)}).finally(function(){s.openComplete=!0,W()}).then(function(){var q;return P&&(q={},n.tables.forEach(function(B){B.schema.indexes.forEach(function(j){j.name&&(q["idb://".concat(n.name,"/").concat(B.name,"/").concat(j.name)]=new en(-1/0,[[[]]]))}),q["idb://".concat(n.name,"/").concat(B.name,"/")]=q["idb://".concat(n.name,"/").concat(B.name,"/:dels")]=new en(-1/0,[[[]]])}),Or(Ja).fire(q),Gi(q,!0)),n})}function Wi(n){function s(m){return n.next(m)}var l=f(s),c=f(function(m){return n.throw(m)});function f(m){return function(S){var S=m(S),D=S.value;return S.done?D:D&&typeof D.then=="function"?D.then(l,c):d(D)?Promise.all(D).then(l,c):l(D)}}return f(s)()}function Ys(n,s,l){for(var c=d(n)?n.slice():[n],f=0;f<l;++f)c.push(s);return c}var Id={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return a(a({},n),{table:function(c){var l=n.table(c),c=l.schema,f={},m=[];function w(q,B,j){var U=es(q),M=f[U]=f[U]||[],Z=q==null?0:typeof q=="string"?1:q.length,te=0<B,U=a(a({},j),{name:te?"".concat(U,"(virtual-from:").concat(j.name,")"):j.name,lowLevelIndex:j,isVirtual:te,keyTail:B,keyLength:Z,extractKey:Mi(q),unique:!te&&j.unique});return M.push(U),U.isPrimaryKey||m.push(U),1<Z&&w(Z===2?q[0]:q.slice(0,Z-1),B+1,j),M.sort(function(ge,be){return ge.keyTail-be.keyTail}),U}var S=w(c.primaryKey.keyPath,0,c.primaryKey);f[":id"]=[S];for(var D=0,W=c.indexes;D<W.length;D++){var L=W[D];w(L.keyPath,0,L)}function P(q){var B,j=q.query.index;return j.isVirtual?a(a({},q),{query:{index:j.lowLevelIndex,range:(B=q.query.range,j=j.keyTail,{type:B.type===1?2:B.type,lower:Ys(B.lower,B.lowerOpen?n.MAX_KEY:n.MIN_KEY,j),lowerOpen:!0,upper:Ys(B.upper,B.upperOpen?n.MIN_KEY:n.MAX_KEY,j),upperOpen:!0})}}):q}return a(a({},l),{schema:a(a({},c),{primaryKey:S,indexes:m,getIndexByKeyPath:function(q){return(q=f[es(q)])&&q[0]}}),count:function(q){return l.count(P(q))},query:function(q){return l.query(P(q))},openCursor:function(q){var B=q.query.index,j=B.keyTail,M=B.keyLength;return B.isVirtual?l.openCursor(P(q)).then(function(te){return te&&Z(te)}):l.openCursor(q);function Z(te){return Object.create(te,{continue:{value:function(U){U!=null?te.continue(Ys(U,q.reverse?n.MAX_KEY:n.MIN_KEY,j)):q.unique?te.continue(te.key.slice(0,M).concat(q.reverse?n.MIN_KEY:n.MAX_KEY,j)):te.continue()}},continuePrimaryKey:{value:function(U,ge){te.continuePrimaryKey(Ys(U,n.MAX_KEY,j),ge)}},primaryKey:{get:function(){return te.primaryKey}},key:{get:function(){var U=te.key;return M===1?U[0]:U.slice(0,M)}},value:{get:function(){return te.value}}})}}})}})}};function Hi(n,s,l,c){return l=l||{},c=c||"",u(n).forEach(function(f){var m,w,S;b(s,f)?(m=n[f],w=s[f],typeof m=="object"&&typeof w=="object"&&m&&w?(S=ce(m))!==ce(w)?l[c+f]=s[f]:S==="Object"?Hi(m,w,l,c+f+"."):m!==w&&(l[c+f]=s[f]):m!==w&&(l[c+f]=s[f])):l[c+f]=void 0}),u(s).forEach(function(f){b(n,f)||(l[c+f]=s[f])}),l}function Vi(n,s){return s.type==="delete"?s.keys:s.keys||s.values.map(n.extractKey)}var Od={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return a(a({},n),{table:function(s){var l=n.table(s),c=l.schema.primaryKey;return a(a({},l),{mutate:function(f){var m=Le.trans,w=m.table(s).hook,S=w.deleting,D=w.creating,W=w.updating;switch(f.type){case"add":if(D.fire===Ce)break;return m._promise("readwrite",function(){return L(f)},!0);case"put":if(D.fire===Ce&&W.fire===Ce)break;return m._promise("readwrite",function(){return L(f)},!0);case"delete":if(S.fire===Ce)break;return m._promise("readwrite",function(){return L(f)},!0);case"deleteRange":if(S.fire===Ce)break;return m._promise("readwrite",function(){return(function P(q,B,j){return l.query({trans:q,values:!1,query:{index:c,range:B},limit:j}).then(function(M){var Z=M.result;return L({type:"delete",keys:Z,trans:q}).then(function(te){return 0<te.numFailures?Promise.reject(te.failures[0]):Z.length<j?{failures:[],numFailures:0,lastResult:void 0}:P(q,a(a({},B),{lower:Z[Z.length-1],lowerOpen:!0}),j)})})})(f.trans,f.range,1e4)},!0)}return l.mutate(f);function L(P){var q,B,j,M=Le.trans,Z=P.keys||Vi(c,P);if(Z)return(P=P.type==="add"||P.type==="put"?a(a({},P),{keys:Z}):a({},P)).type!=="delete"&&(P.values=i([],P.values)),P.keys&&(P.keys=i([],P.keys)),q=l,j=Z,((B=P).type==="add"?Promise.resolve([]):q.getMany({trans:B.trans,keys:j,cache:"immutable"})).then(function(te){var U=Z.map(function(ge,be){var Re,Pe,xe,qe=te[be],je={onerror:null,onsuccess:null};return P.type==="delete"?S.fire.call(je,ge,qe,M):P.type==="add"||qe===void 0?(Re=D.fire.call(je,ge,P.values[be],M),ge==null&&Re!=null&&(P.keys[be]=ge=Re,c.outbound||F(P.values[be],c.keyPath,ge))):(Re=Hi(qe,P.values[be]),(Pe=W.fire.call(je,Re,ge,qe,M))&&(xe=P.values[be],Object.keys(Pe).forEach(function(Ee){b(xe,Ee)?xe[Ee]=Pe[Ee]:F(xe,Ee,Pe[Ee])}))),je});return l.mutate(P).then(function(ge){for(var be=ge.failures,Re=ge.results,Pe=ge.numFailures,ge=ge.lastResult,xe=0;xe<Z.length;++xe){var qe=(Re||Z)[xe],je=U[xe];qe==null?je.onerror&&je.onerror(be[xe]):je.onsuccess&&je.onsuccess(P.type==="put"&&te[xe]?P.values[xe]:qe)}return{failures:be,results:Re,numFailures:Pe,lastResult:ge}}).catch(function(ge){return U.forEach(function(be){return be.onerror&&be.onerror(ge)}),Promise.reject(ge)})});throw new Error("Keys missing")}}})}})}};function Ml(n,s,l){try{if(!s||s.keys.length<n.length)return null;for(var c=[],f=0,m=0;f<s.keys.length&&m<n.length;++f)at(s.keys[f],n[m])===0&&(c.push(l?_e(s.values[f]):s.values[f]),++m);return c.length===n.length?c:null}catch{return null}}var Md={stack:"dbcore",level:-1,create:function(n){return{table:function(s){var l=n.table(s);return a(a({},l),{getMany:function(c){var f;return c.cache?(f=Ml(c.keys,c.trans._cache,c.cache==="clone"))?Ie.resolve(f):l.getMany(c).then(function(m){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?_e(m):m},m}):l.getMany(c)},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),l.mutate(c)}})}}}};function Dl(n,s){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function Ll(n,s){switch(n){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Dd={stack:"dbcore",level:0,name:"Observability",create:function(n){var s=n.schema.name,l=new en(n.MIN_KEY,n.MAX_KEY);return a(a({},n),{transaction:function(c,f,m){if(Le.subscr&&f!=="readonly")throw new z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Le.querier));return n.transaction(c,f,m)},table:function(c){function f(Z){var M,Z=Z.query;return[M=Z.index,new en((M=(Z=Z.range).lower)!=null?M:n.MIN_KEY,(M=Z.upper)!=null?M:n.MAX_KEY)]}var m=n.table(c),w=m.schema,S=w.primaryKey,D=w.indexes,W=S.extractKey,L=S.outbound,P=S.autoIncrement&&D.filter(function(j){return j.compound&&j.keyPath.includes(S.keyPath)}),q=a(a({},m),{mutate:function(j){function M(Fe){return Fe="idb://".concat(s,"/").concat(c,"/").concat(Fe),be[Fe]||(be[Fe]=new en)}var Z,te,U,ge=j.trans,be=j.mutatedParts||(j.mutatedParts={}),Re=M(""),Pe=M(":dels"),xe=j.type,je=j.type==="deleteRange"?[j.range]:j.type==="delete"?[j.keys]:j.values.length<50?[Vi(S,j).filter(function(Fe){return Fe}),j.values]:[],qe=je[0],je=je[1],Ee=j.trans._cache;return d(qe)?(Re.addKeys(qe),(xe=xe==="delete"||qe.length===je.length?Ml(qe,Ee):null)||Pe.addKeys(qe),(xe||je)&&(Z=M,te=xe,U=je,w.indexes.forEach(function(Fe){var st=Z(Fe.name||"");function ut(Xe){return Xe!=null?Fe.extractKey(Xe):null}function Ge(Xe){Fe.multiEntry&&d(Xe)?Xe.forEach(function(xt){return st.addKey(xt)}):st.addKey(Xe)}(te||U).forEach(function(Xe,At){var Cn=te&&ut(te[At]),At=U&&ut(U[At]);at(Cn,At)!==0&&(Cn!=null&&Ge(Cn),At!=null)&&Ge(At)})}))):qe?(je={from:(Ee=qe.lower)!=null?Ee:n.MIN_KEY,to:(xe=qe.upper)!=null?xe:n.MAX_KEY},Pe.add(je),Re.add(je)):(Re.add(l),Pe.add(l),w.indexes.forEach(function(Fe){return M(Fe.name).add(l)})),m.mutate(j).then(function(Fe){return!qe||j.type!=="add"&&j.type!=="put"||(Re.addKeys(Fe.results),P&&P.forEach(function(st){for(var ut=j.values.map(function(Cn){return st.extractKey(Cn)}),Ge=st.keyPath.findIndex(function(Cn){return Cn===S.keyPath}),Xe=0,xt=Fe.results.length;Xe<xt;++Xe)ut[Xe][Ge]=Fe.results[Xe];M(st.name).addKeys(ut)})),ge.mutatedParts=Hs(ge.mutatedParts||{},be),Fe})}}),B={get:function(j){return[S,new en(j.key)]},getMany:function(j){return[S,new en().addKeys(j.keys)]},count:f,query:f,openCursor:f};return u(B).forEach(function(j){q[j]=function(M){var Z=Le.subscr,te=!!Z,U=Dl(Le,m)&&Ll(j,M)?M.obsSet={}:Z;if(te){var ge,Z=function(je){return je="idb://".concat(s,"/").concat(c,"/").concat(je),U[je]||(U[je]=new en)},be=Z(""),Re=Z(":dels"),te=B[j](M),Pe=te[0],te=te[1];if((j==="query"&&Pe.isPrimaryKey&&!M.values?Re:Z(Pe.name||"")).add(te),!Pe.isPrimaryKey){if(j!=="count")return ge=j==="query"&&L&&M.values&&m.query(a(a({},M),{values:!1})),m[j].apply(this,arguments).then(function(je){if(j==="query"){if(L&&M.values)return ge.then(function(ut){return ut=ut.result,be.addKeys(ut),je});var Ee=M.values?je.result.map(W):je.result;(M.values?be:Re).addKeys(Ee)}else{var Fe,st;if(j==="openCursor")return st=M.values,(Fe=je)&&Object.create(Fe,{key:{get:function(){return Re.addKey(Fe.primaryKey),Fe.key}},primaryKey:{get:function(){var ut=Fe.primaryKey;return Re.addKey(ut),ut}},value:{get:function(){return st&&be.addKey(Fe.primaryKey),Fe.value}}})}return je});Re.add(l)}}return m[j].apply(this,arguments)}}),q}})}};function jl(n,s,l){var c;return l.numFailures===0?s:s.type==="deleteRange"||(c=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1,l.numFailures===c)?null:(c=a({},s),d(c.keys)&&(c.keys=c.keys.filter(function(f,m){return!(m in l.failures)})),"values"in c&&d(c.values)&&(c.values=c.values.filter(function(f,m){return!(m in l.failures)})),c)}function Yi(n,s){return l=n,((c=s).lower===void 0||(c.lowerOpen?0<at(l,c.lower):0<=at(l,c.lower)))&&(l=n,(c=s).upper===void 0||(c.upperOpen?at(l,c.upper)<0:at(l,c.upper)<=0));var l,c}function Nl(n,s,l,c,f,m){var w,S,D,W,L,P;return!l||l.length===0||(w=s.query.index,S=w.multiEntry,D=s.query.range,W=c.schema.primaryKey.extractKey,L=w.extractKey,P=(w.lowLevelIndex||w).extractKey,(c=l.reduce(function(q,B){var j=q,M=[];if(B.type==="add"||B.type==="put")for(var Z=new en,te=B.values.length-1;0<=te;--te){var U,ge=B.values[te],be=W(ge);!Z.hasKey(be)&&(U=L(ge),S&&d(U)?U.some(function(je){return Yi(je,D)}):Yi(U,D))&&(Z.addKey(be),M.push(ge))}switch(B.type){case"add":var Re=new en().addKeys(s.values?q.map(function(Ee){return W(Ee)}):q),j=q.concat(s.values?M.filter(function(Ee){return Ee=W(Ee),!Re.hasKey(Ee)&&(Re.addKey(Ee),!0)}):M.map(function(Ee){return W(Ee)}).filter(function(Ee){return!Re.hasKey(Ee)&&(Re.addKey(Ee),!0)}));break;case"put":var Pe=new en().addKeys(B.values.map(function(Ee){return W(Ee)}));j=q.filter(function(Ee){return!Pe.hasKey(s.values?W(Ee):Ee)}).concat(s.values?M:M.map(function(Ee){return W(Ee)}));break;case"delete":var xe=new en().addKeys(B.keys);j=q.filter(function(Ee){return!xe.hasKey(s.values?W(Ee):Ee)});break;case"deleteRange":var qe=B.range;j=q.filter(function(Ee){return!Yi(W(Ee),qe)})}return j},n))===n)?n:(c.sort(function(q,B){return at(P(q),P(B))||at(W(q),W(B))}),s.limit&&s.limit<1/0&&(c.length>s.limit?c.length=s.limit:n.length===s.limit&&c.length<s.limit&&(f.dirty=!0)),m?Object.freeze(c):c)}function ql(n,s){return at(n.lower,s.lower)===0&&at(n.upper,s.upper)===0&&!!n.lowerOpen==!!s.lowerOpen&&!!n.upperOpen==!!s.upperOpen}function Ld(n,s){return((l,c,f,m)=>{if(l===void 0)return c!==void 0?-1:0;if(c===void 0)return 1;if((l=at(l,c))===0){if(f&&m)return 0;if(f)return 1;if(m)return-1}return l})(n.lower,s.lower,n.lowerOpen,s.lowerOpen)<=0&&0<=((l,c,f,m)=>{if(l===void 0)return c!==void 0?1:0;if(c===void 0)return-1;if((l=at(l,c))===0){if(f&&m)return 0;if(f)return-1;if(m)return 1}return l})(n.upper,s.upper,n.upperOpen,s.upperOpen)}function jd(n,s,l,c){n.subscribers.add(l),c.addEventListener("abort",function(){var f,m;n.subscribers.delete(l),n.subscribers.size===0&&(f=n,m=s,setTimeout(function(){f.subscribers.size===0&&X(m,f)},3e3))})}var Nd={stack:"dbcore",level:0,name:"Cache",create:function(n){var s=n.schema.name;return a(a({},n),{transaction:function(l,c,f){var m,w,S=n.transaction(l,c,f);return c==="readwrite"&&(f=(m=new AbortController).signal,S.addEventListener("abort",(w=function(D){return function(){if(m.abort(),c==="readwrite"){for(var W=new Set,L=0,P=l;L<P.length;L++){var q=P[L],B=Zr["idb://".concat(s,"/").concat(q)];if(B){var j=n.table(q),M=B.optimisticOps.filter(function(Fe){return Fe.trans===S});if(S._explicit&&D&&S.mutatedParts)for(var Z=0,te=Object.values(B.queries.query);Z<te.length;Z++)for(var U=0,ge=(Pe=te[Z]).slice();U<ge.length;U++)Fi((xe=ge[U]).obsSet,S.mutatedParts)&&(X(Pe,xe),xe.subscribers.forEach(function(Fe){return W.add(Fe)}));else if(0<M.length){B.optimisticOps=B.optimisticOps.filter(function(Fe){return Fe.trans!==S});for(var be=0,Re=Object.values(B.queries.query);be<Re.length;be++)for(var Pe,xe,qe,je=0,Ee=(Pe=Re[be]).slice();je<Ee.length;je++)(xe=Ee[je]).res!=null&&S.mutatedParts&&(D&&!xe.dirty?(qe=Object.isFrozen(xe.res),qe=Nl(xe.res,xe.req,M,j,xe,qe),xe.dirty?(X(Pe,xe),xe.subscribers.forEach(function(Fe){return W.add(Fe)})):qe!==xe.res&&(xe.res=qe,xe.promise=Ie.resolve({result:qe}))):(xe.dirty&&X(Pe,xe),xe.subscribers.forEach(function(Fe){return W.add(Fe)})))}}}W.forEach(function(Fe){return Fe()})}}})(!1),{signal:f}),S.addEventListener("error",w(!1),{signal:f}),S.addEventListener("complete",w(!0),{signal:f})),S},table:function(l){var c=n.table(l),f=c.schema.primaryKey;return a(a({},c),{mutate:function(m){var w,S=Le.trans;return!f.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(w=Zr["idb://".concat(s,"/").concat(l)])?(S=c.mutate(m),m.type!=="add"&&m.type!=="put"||!(50<=m.values.length||Vi(f,m).some(function(D){return D==null}))?(w.optimisticOps.push(m),m.mutatedParts&&Vs(m.mutatedParts),S.then(function(D){0<D.numFailures&&(X(w.optimisticOps,m),(D=jl(0,m,D))&&w.optimisticOps.push(D),m.mutatedParts)&&Vs(m.mutatedParts)}),S.catch(function(){X(w.optimisticOps,m),m.mutatedParts&&Vs(m.mutatedParts)})):S.then(function(D){var W=jl(0,a(a({},m),{values:m.values.map(function(L,P){var q;return D.failures[P]?L:(F(q=(q=f.keyPath)!=null&&q.includes(".")?_e(L):a({},L),f.keyPath,D.results[P]),q)})}),D);w.optimisticOps.push(W),queueMicrotask(function(){return m.mutatedParts&&Vs(m.mutatedParts)})}),S):c.mutate(m)},query:function(m){var w,S,D,W,L,P,q;return Dl(Le,c)&&Ll("query",m)?(w=((D=Le.trans)==null?void 0:D.db._options.cache)==="immutable",S=(D=Le).requery,D=D.signal,P=((B,j,M,Z)=>{var te=Zr["idb://".concat(B,"/").concat(j)];if(!te)return[];if(!(B=te.queries[M]))return[null,!1,te,null];var U=B[(Z.query?Z.query.index.name:null)||""];if(!U)return[null,!1,te,null];switch(M){case"query":var ge=U.find(function(be){return be.req.limit===Z.limit&&be.req.values===Z.values&&ql(be.req.query.range,Z.query.range)});return ge?[ge,!0,te,U]:[U.find(function(be){return("limit"in be.req?be.req.limit:1/0)>=Z.limit&&(!Z.values||be.req.values)&&Ld(be.req.query.range,Z.query.range)}),!1,te,U];case"count":return ge=U.find(function(be){return ql(be.req.query.range,Z.query.range)}),[ge,!!ge,te,U]}})(s,l,"query",m),q=P[0],W=P[2],L=P[3],q&&P[1]?q.obsSet=m.obsSet:(P=c.query(m).then(function(B){var j=B.result;if(q&&(q.res=j),w){for(var M=0,Z=j.length;M<Z;++M)Object.freeze(j[M]);Object.freeze(j)}else B.result=_e(j);return B}).catch(function(B){return L&&q&&X(L,q),Promise.reject(B)}),q={obsSet:m.obsSet,promise:P,subscribers:new Set,type:"query",req:m,dirty:!1},L?L.push(q):(L=[q],(W=W||(Zr["idb://".concat(s,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[m.query.index.name||""]=L)),jd(q,L,S,D),q.promise.then(function(B){return{result:Nl(B.result,m,W==null?void 0:W.optimisticOps,c,q,w)}})):c.query(m)}})}})}};function Qs(n,s){return new Proxy(n,{get:function(l,c,f){return c==="db"?s:Reflect.get(l,c,f)}})}Dt.prototype.version=function(n){if(isNaN(n)||n<.1)throw new z.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var s=this._versions,l=s.filter(function(c){return c._cfg.version===n})[0];return l||(l=new this.Version(n),s.push(l),s.sort(Ed),l.stores({}),this._state.autoSchema=!1),l},Dt.prototype._whenReady=function(n){var s=this;return this.idbdb&&(this._state.openComplete||Le.letThrough||this._vip)?n():new Ie(function(l,c){if(s._state.openComplete)return c(new z.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void c(new z.DatabaseClosed);s.open().catch(Ce)}s._state.dbReadyPromise.then(l,c)}).then(n)},Dt.prototype.use=function(f){var s=f.stack,l=f.create,c=f.level,f=f.name,m=(f&&this.unuse({stack:s,name:f}),this._middlewares[s]||(this._middlewares[s]=[]));return m.push({stack:s,create:l,level:c??10,name:f}),m.sort(function(w,S){return w.level-S.level}),this},Dt.prototype.unuse=function(n){var s=n.stack,l=n.name,c=n.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(f){return c?f.create!==c:!!l&&f.name!==l})),this},Dt.prototype.open=function(){var n=this;return Ke(vt,function(){return Pd(n)})},Dt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var n=this._state,s=Mt.indexOf(this);if(0<=s&&Mt.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new Ie(function(l){n.dbReadyResolve=l}),n.openCanceller=new Ie(function(l,c){n.cancelOpen=c}))},Dt.prototype.close=function(s){var s=(s===void 0?{disableAutoOpen:!0}:s).disableAutoOpen,l=this._state;s?(l.isBeingOpened&&l.cancelOpen(new z.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new z.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Dt.prototype.delete=function(n){var s=this,l=(n===void 0&&(n={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),c=this._state;return new Ie(function(f,m){function w(){s.close(n);var S=s._deps.indexedDB.deleteDatabase(s.name);S.onsuccess=_t(function(){var D,W,L;D=s._deps,W=s.name,qi(L=D.indexedDB)||W===cn||Ni(L,D.IDBKeyRange).delete(W).catch(Ce),f()}),S.onerror=rr(m),S.onblocked=s._fireOnBlocked}if(l)throw new z.InvalidArgument("Invalid closeOptions argument to db.delete()");c.isBeingOpened?c.dbReadyPromise.then(w):w()})},Dt.prototype.backendDB=function(){return this.idbdb},Dt.prototype.isOpen=function(){return this.idbdb!==null},Dt.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},Dt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Dt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Dt.prototype,"tables",{get:function(){var n=this;return u(this._allTables).map(function(s){return n._allTables[s]})},enumerable:!1,configurable:!0}),Dt.prototype.transaction=function(){var n=(function(s,l,c){var f=arguments.length;if(f<2)throw new z.InvalidArgument("Too few arguments");for(var m=new Array(f-1);--f;)m[f-1]=arguments[f];return c=m.pop(),[s,Te(m),c]}).apply(this,arguments);return this._transaction.apply(this,n)},Dt.prototype._transaction=function(n,s,l){var c,f,m=this,w=Le.trans,S=(w&&w.db===this&&n.indexOf("!")===-1||(w=null),n.indexOf("?")!==-1);n=n.replace("!","").replace("?","");try{if(f=s.map(function(W){if(W=W instanceof m.Table?W.name:W,typeof W!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return W}),n=="r"||n===nr)c=nr;else{if(n!="rw"&&n!=Qr)throw new z.InvalidArgument("Invalid transaction mode: "+n);c=Qr}if(w){if(w.mode===nr&&c===Qr){if(!S)throw new z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&f.forEach(function(W){if(w&&w.storeNames.indexOf(W)===-1){if(!S)throw new z.SubTransaction("Table "+W+" not included in parent transaction.");w=null}}),S&&w&&!w.active&&(w=null)}}catch(W){return w?w._promise(null,function(L,P){P(W)}):Ae(W)}var D=(function W(L,P,q,B,j){return Ie.resolve().then(function(){var U=Le.transless||Le,M=L._createTransaction(P,q,L._dbSchema,B),U=(M.explicit=!0,{trans:M,transless:U});if(B)M.idbtrans=B.idbtrans;else try{M.create(),M.idbtrans._explicit=!0,L._state.PR1398_maxLoop=3}catch(ge){return ge.name===De.InvalidState&&L.isOpen()&&0<--L._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),L.close({disableAutoOpen:!1}),L.open().then(function(){return W(L,P,q,null,j)})):Ae(ge)}var Z,te=oe(j),U=(te&&$t(),Ie.follow(function(){var ge;(Z=j.call(M,M))&&(te?(ge=zn.bind(null,null),Z.then(ge,ge)):typeof Z.next=="function"&&typeof Z.throw=="function"&&(Z=Wi(Z)))},U));return(Z&&typeof Z.then=="function"?Ie.resolve(Z).then(function(ge){return M.active?ge:Ae(new z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):U.then(function(){return Z})).then(function(ge){return B&&M._resolve(),M._completion.then(function(){return ge})}).catch(function(ge){return M._reject(ge),Ae(ge)})})}).bind(null,this,c,f,w,l);return w?w._promise(c,D,"lock"):Le.trans?Ke(Le.transless,function(){return m._whenReady(D)}):this._whenReady(D)},Dt.prototype.table=function(n){if(b(this._allTables,n))return this._allTables[n];throw new z.InvalidTable("Table ".concat(n," does not exist"))};var mr=Dt;function Dt(n,s){var l,c,f,m,w,S=this,D=(this._middlewares={},this.verno=0,Dt.dependencies),D=(this._options=s=a({addons:Dt.addons,autoOpen:!0,indexedDB:D.indexedDB,IDBKeyRange:D.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},s.addons),W=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ce,dbReadyPromise:null,cancelOpen:Ce,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen}),L=(W.dbReadyPromise=new Ie(function(P){W.dbReadyResolve=P}),W.openCanceller=new Ie(function(P,q){W.cancelOpen=q}),this._state=W,this.name=n,this.on=Qa(this,"populate","blocked","versionchange","close",{ready:[Be,Ce]}),this.once=function(P,q){var B=function(){for(var j=[],M=0;M<arguments.length;M++)j[M]=arguments[M];S.on(P).unsubscribe(B),q.apply(S,j)};return S.on(P,B)},this.on.ready.subscribe=$(this.on.ready.subscribe,function(P){return function(q,B){Dt.vip(function(){var j,M=S._state;M.openComplete?(M.dbOpenError||Ie.resolve().then(q),B&&P(q)):M.onReadyBeingFired?(M.onReadyBeingFired.push(q),B&&P(q)):(P(q),j=S,B||P(function Z(){j.on.ready.unsubscribe(q),j.on.ready.unsubscribe(Z)}))})}}),this.Collection=(l=this,Xa(yd.prototype,function(Z,M){this.db=l;var B=Va,j=null;if(M)try{B=M()}catch(U){j=U}var M=Z._ctx,Z=M.table,te=Z.hook.reading.fire;this._ctx={table:Z,index:M.index,isPrimKey:!M.index||Z.schema.primKey.keyPath&&M.index===Z.schema.primKey.name,range:B,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:j,or:M.or,valueMapper:te!==ze?te:null}})),this.Table=(c=this,Xa(yl.prototype,function(P,q,B){this.db=c,this._tx=B,this.name=P,this.schema=q,this.hook=c._allTables[P]?c._allTables[P].hook:Qa(null,{creating:[Rt,Ce],reading:[Ve,ze],updating:[jt,Ce],deleting:[Bt,Ce]})})),this.Transaction=(f=this,Xa(kd.prototype,function(P,q,B,j,M){var Z=this;P!=="readonly"&&q.forEach(function(te){te=(te=B[te])==null?void 0:te.yProps,te&&(q=q.concat(te.map(function(U){return U.updatesTable})))}),this.db=f,this.mode=P,this.storeNames=q,this.schema=B,this.chromeTransactionDurability=j,this.idbtrans=null,this.on=Qa(this,"complete","error","abort"),this.parent=M||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(function(te,U){Z._resolve=te,Z._reject=U}),this._completion.then(function(){Z.active=!1,Z.on.complete.fire()},function(te){var U=Z.active;return Z.active=!1,Z.on.error.fire(te),Z.parent?Z.parent._reject(te):U&&Z.idbtrans&&Z.idbtrans.abort(),Ae(te)})})),this.Version=(m=this,Xa(Rd.prototype,function(P){this.db=m,this._cfg={version:P,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(w=this,Xa(Sl.prototype,function(P,q,B){if(this.db=w,this._ctx={table:P,index:q===":id"?null:q,or:B},this._cmp=this._ascending=at,this._descending=function(j,M){return at(M,j)},this._max=function(j,M){return 0<at(j,M)?j:M},this._min=function(j,M){return at(j,M)<0?j:M},this._IDBKeyRange=w._deps.IDBKeyRange,!this._IDBKeyRange)throw new z.MissingAPI})),this.on("versionchange",function(P){0<P.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(P){!P.newVersion||P.newVersion<P.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(P.oldVersion/10))}),this._maxKey=$a(s.IDBKeyRange),this._createTransaction=function(P,q,B,j){return new S.Transaction(P,q,B,S._options.chromeTransactionDurability,j)},this._fireOnBlocked=function(P){S.on("blocked").fire(P),Mt.filter(function(q){return q.name===S.name&&q!==S&&!q._state.vcFired}).map(function(q){return q.on("versionchange").fire(P)})},this.use(Md),this.use(Nd),this.use(Dd),this.use(Id),this.use(Od),new Proxy(this,{get:function(P,q,B){var j;return q==="_vip"||(q==="table"?function(M){return Qs(S.table(M),L)}:(j=Reflect.get(P,q,B))instanceof yl?Qs(j,L):q==="tables"?j.map(function(M){return Qs(M,L)}):q==="_createTransaction"?function(){return Qs(j.apply(this,arguments),L)}:j)}}));this.vip=L,D.forEach(function(P){return P(S)})}var Xs,Ea=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",qd=(Qi.prototype.subscribe=function(n,s,l){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:s,complete:l})},Qi.prototype[Ea]=function(){return this},Qi);function Qi(n){this._subscribe=n}try{Xs={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{Xs={indexedDB:null,IDBKeyRange:null}}function Bl(n){var s,l=!1,c=new qd(function(f){var m=oe(n),w,S=!1,D={},W={},L={get closed(){return S},unsubscribe:function(){S||(S=!0,w&&w.abort(),P&&Or.storagemutated.unsubscribe(B))}},P=(f.start&&f.start(L),!1),q=function(){return Se(j)},B=function(M){Hs(D,M),Fi(W,D)&&q()},j=function(){var M,Z,te;!S&&Xs.indexedDB&&(D={},M={},w&&w.abort(),w=new AbortController,te=(U=>{var ge=Pr();try{m&&$t();var be=Bn(n,U);return be=m?be.finally(zn):be}finally{ge&&hr()}})(Z={subscr:M,signal:w.signal,requery:q,querier:n,trans:null}),Promise.resolve(te).then(function(U){l=!0,s=U,S||Z.signal.aborted||(D={},(ge=>{for(var be in ge)if(b(ge,be))return;return 1})(W=M)||P||(Or(Ja,B),P=!0),Se(function(){return!S&&f.next&&f.next(U)}))},function(U){l=!1,["DatabaseClosedError","AbortError"].includes(U==null?void 0:U.name)||S||Se(function(){S||f.error&&f.error(U)})}))};return setTimeout(q,0),L});return c.hasValue=function(){return l},c.getValue=function(){return s},c}var Jr=mr;function Xi(n){var s=Mr;try{Mr=!0,Or.storagemutated.fire(n),Gi(n,!0)}finally{Mr=s}}k(Jr,a(a({},se),{delete:function(n){return new Jr(n,{addons:[]}).delete()},exists:function(n){return new Jr(n,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return s=Jr.dependencies,l=s.indexedDB,s=s.IDBKeyRange,(qi(l)?Promise.resolve(l.databases()).then(function(c){return c.map(function(f){return f.name}).filter(function(f){return f!==cn})}):Ni(l,s).toCollection().primaryKeys()).then(n)}catch{return Ae(new z.MissingAPI)}var s,l},defineClass:function(){return function(n){h(this,n)}},ignoreTransaction:function(n){return Le.trans?Ke(Le.transless,n):n()},vip:Bi,async:function(n){return function(){try{var s=Wi(n.apply(this,arguments));return s&&typeof s.then=="function"?s:Ie.resolve(s)}catch(l){return Ae(l)}}},spawn:function(n,s,l){try{var c=Wi(n.apply(l,s||[]));return c&&typeof c.then=="function"?c:Ie.resolve(c)}catch(f){return Ae(f)}},currentTransaction:{get:function(){return Le.trans||null}},waitFor:function(n,s){return n=Ie.resolve(typeof n=="function"?Jr.ignoreTransaction(n):n).timeout(s||6e4),Le.trans?Le.trans.waitFor(n):n},Promise:Ie,debug:{get:function(){return We},set:function(n){gt(n)}},derive:N,extend:h,props:k,override:$,Events:Qa,on:Or,liveQuery:Bl,extendObservabilitySet:Hs,getByKeyPath:ne,setByKeyPath:F,delByKeyPath:function(n,s){typeof s=="string"?F(n,s,void 0):"length"in s&&[].map.call(s,function(l){F(n,l,void 0)})},shallowClone:fe,deepClone:_e,getObjectDiff:Hi,cmp:at,asap:Y,minKey:-1/0,addons:[],connections:Mt,errnames:De,dependencies:Xs,cache:Zr,semVer:"4.3.0",version:"4.3.0".split(".").map(function(n){return parseInt(n)}).reduce(function(n,s,l){return n+s/Math.pow(10,2*l)})})),Jr.maxKey=$a(Jr.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Or(Ja,function(n){Mr||(n=new CustomEvent(Pi,{detail:n}),Mr=!0,dispatchEvent(n),Mr=!1)}),addEventListener(Pi,function(n){n=n.detail,Mr||Xi(n)}));var Aa,Mr=!1,zl=function(){};return typeof BroadcastChannel<"u"&&((zl=function(){(Aa=new BroadcastChannel(Pi)).onmessage=function(n){return n.data&&Xi(n.data)}})(),typeof Aa.unref=="function"&&Aa.unref(),Or(Ja,function(n){Mr||Aa.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!mr.disableBfCache&&n.persisted){We&&console.debug("Dexie: handling persisted pagehide"),Aa!=null&&Aa.close();for(var s=0,l=Mt;s<l.length;s++)l[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!mr.disableBfCache&&n.persisted&&(We&&console.debug("Dexie: handling persisted pageshow"),zl(),Xi({all:new en(-1/0,[[]])}))})),Ie.rejectionMapper=function(n,s){return!n||n instanceof G||n instanceof TypeError||n instanceof SyntaxError||!n.name||!ke[n.name]?n:(s=new ke[n.name](s||n.message,n),"stack"in n&&A(s,"stack",{get:function(){return this.inner.stack}}),s)},gt(We),a(mr,Object.freeze({__proto__:null,Dexie:mr,Entity:pl,PropModification:Ya,RangeSet:en,add:function(n){return new Ya({add:n})},cmp:at,default:mr,liveQuery:Bl,mergeRanges:ns,rangesOverlap:Rl,remove:function(n){return new Ya({remove:n})},replacePrefix:function(n,s){return new Ya({replacePrefix:[n,s]})}}),{default:mr}),mr})})(ci)),ci.exports}var Iv=Pv();const Eo=Cv(Iv),sc=Symbol.for("Dexie"),nn=globalThis[sc]||(globalThis[sc]=Eo);if(Eo.semVer!==nn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Eo.semVer} and ${nn.semVer}`);const{liveQuery:lb,mergeRanges:cb,rangesOverlap:ub,RangeSet:db,cmp:fb,Entity:vb,PropModification:pb,replacePrefix:hb,add:mb,remove:gb,DexieYProvider:_b}=nn,Ue=new nn("me-ai-store");Ue.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Ue.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Ue.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Ue.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});function Lu(t,e){return`${t}:${e}`}function Ao(t){if(t===0)return"0 B";const e=1024,r=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+r[a]}function io(t){if(t===0)return"0 B";const e=1024,r=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),i=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return i.toFixed(o)+" "+r[a]}function Ov(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Mv(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function ju(t){let e=0;for(let r=0;r<t.length;r++)e=t.charCodeAt(r)+((e<<5)-e);return Math.abs(e)%360}const Dv="https://gmail.googleapis.com/gmail/v1/users/me";class $o extends Error{constructor(e,r,a){super(e),this.name="GmailApiError",this.status=r,this.code=a||null}}function Lv(t){return{Authorization:`Bearer ${t}`}}async function Ti(t,e){var a,i,o,u;const r=await fetch(`${Dv}${e}`,{headers:Lv(t)});if(!r.ok){const d=await r.json().catch(()=>({})),h=((a=d.error)==null?void 0:a.message)||`Gmail API error: ${r.status}`,p=((u=(o=(i=d.error)==null?void 0:i.errors)==null?void 0:o[0])==null?void 0:u.reason)||void 0;throw new $o(h,r.status,p)}return r.json()}function Nu(t){return Ti(t,"/profile")}function qu(t,{maxResults:e=20,pageToken:r,q:a}={}){const i=new URLSearchParams;return i.set("maxResults",String(e)),r&&i.set("pageToken",r),a&&i.set("q",a),Ti(t,`/messages?${i}`)}function Bu(t,e,r="full"){return Ti(t,`/messages/${e}?format=${r}`)}function jv(t,{startHistoryId:e,pageToken:r,maxResults:a=500}={}){const i=new URLSearchParams;return i.set("startHistoryId",e),i.set("maxResults",String(a)),i.append("historyTypes","messageAdded"),i.append("historyTypes","messageDeleted"),r&&i.set("pageToken",r),Ti(t,`/history?${i}`)}function Lr(t,e){var o;const r=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),i=r.find(u=>u.name.toLowerCase()===a);return(i==null?void 0:i.value)||""}function gs(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const r=e.length%4;r&&(e+="=".repeat(4-r));const a=atob(e),i=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(i)}function Nv(t){var o,u,d;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return gs(e.body.data);const r=e.parts||[],a=fi(r,"text/plain");if((u=a==null?void 0:a.body)!=null&&u.data)return gs(a.body.data);const i=fi(r,"text/html");if((d=i==null?void 0:i.body)!=null&&d.data){const h=gs(i.body.data);return Bv(h)}return"(no body)"}function qv(t){var i,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((i=e.body)!=null&&i.data))return gs(e.body.data);const r=e.parts||[],a=fi(r,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?gs(a.body.data):null}function fi(t,e){for(const r of t){if(r.mimeType===e)return r;if(r.parts){const a=fi(r.parts,e);if(a)return a}}return null}function Bv(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const r of e.querySelectorAll("style, script"))r.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,r)=>String.fromCodePoint(parseInt(r,16))).replace(/&#(\d+);/g,(e,r)=>String.fromCodePoint(Number(r))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function el(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function zu(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function Fu(t){return zu(t).charAt(0).toUpperCase()}function zv(t){try{const e=new Date(t),r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${r}-${a}-${i}`}catch{return"email"}}function Fv(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function Ku(t,e){return`${zv(t.date)}_${Fv(t.subject)}.${e}`}function Uu(t){const e={};for(const a of t){const i=a.action||"UNKNOWN";e[i]||(e[i]=[]),e[i].push(a)}for(const a of Object.keys(e))e[a].sort((i,o)=>(o.date||0)-(i.date||0));const r=Object.keys(e).sort((a,i)=>e[i].length-e[a].length);return{groups:e,order:r}}async function Kv(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.contacts.count();if(t===0)return null;const r=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:i}=await Gu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),u=new Date(i.date).toLocaleDateString();r.push(`Date range: ${o} to ${u}.`)}return r.join(" ")}async function Uv(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.contacts.count();if(t===0)return"No emails stored locally.";const r=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:i}=await Gu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),u=new Date(i.date).toLocaleDateString();r.push(`- **Date range:** ${o} â ${u}`)}return r.join(`
`)}async function Gv(t=10){const e=await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(Wu).join(`

---

`)}async function Wv(t,e=10){if(!t)return"No search query provided.";const r=t.toLowerCase(),i=(await Ue.items.where("sourceType").equals("gmail").toArray()).map(o=>{var d,h,p,_,b;let u=0;return(d=o.subject)!=null&&d.toLowerCase().includes(r)&&(u+=3),(h=o.from)!=null&&h.toLowerCase().includes(r)&&(u+=2),(p=o.to)!=null&&p.toLowerCase().includes(r)&&(u+=2),(_=o.snippet)!=null&&_.toLowerCase().includes(r)&&(u+=1),(b=o.body)!=null&&b.toLowerCase().includes(r)&&(u+=1),{item:o,score:u}}).filter(({score:o})=>o>0).sort((o,u)=>u.score-o.score).slice(0,e);return i.length===0?`No results found for "${t}".`:i.map(({item:o})=>Wu(o)).join(`

---

`)}async function ic(){const t=await Ue.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:r}=Uu(t);return{groups:e,order:r,total:t.length}}async function Hv({query:t,limit:e=50,offset:r=0}={}){if(t){const o=t.toLowerCase(),u=await Ue.items.where("sourceType").equals("gmail").filter(d=>{var h,p,_,b;return((h=d.subject)==null?void 0:h.toLowerCase().includes(o))||((p=d.from)==null?void 0:p.toLowerCase().includes(o))||((_=d.to)==null?void 0:_.toLowerCase().includes(o))||((b=d.snippet)==null?void 0:b.toLowerCase().includes(o))}).toArray();return u.sort((d,h)=>(h.date||0)-(d.date||0)),{items:u.slice(r,r+e),total:u.length}}const a=await Ue.items.where("sourceType").equals("gmail").count();return{items:await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).reverse().offset(r).limit(e).toArray(),total:a}}async function Gu(){const t=await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).first(),e=await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).last();return{oldest:t,newest:e}}function Wu(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",r=Mv(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",r].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",r].join(`
`)}}async function Vv(){const t=await Kv();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function Yv(t){const e=[],r=await Uv();if(e.push(r),t){const a=await Wv(t,5);e.push("","## Relevant Emails",a)}else{const a=await Gv(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const Qv={REPLY:[{id:"draft_reply",name:"Draft Reply",description:"Generate a reply draft using LLM",icon:"âï¸"},{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"},{id:"snooze",name:"Snooze",description:"Remind me later",icon:"â°"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],FOLLOW_UP:[{id:"draft_follow_up",name:"Draft Follow-up",description:"Generate a follow-up message",icon:"âï¸"},{id:"set_reminder",name:"Set Reminder",description:"Remind me to follow up",icon:"â°"},{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],DELETE:[{id:"confirm_delete",name:"Delete",description:"Confirm deletion",icon:"ðï¸"},{id:"archive",name:"Archive Instead",description:"Archive instead of deleting",icon:"ð¦"},{id:"dismiss",name:"Keep",description:"Keep in inbox",icon:"â©ï¸"}],ARCHIVE:[{id:"confirm_archive",name:"Archive",description:"Move to archive",icon:"ð¦"},{id:"dismiss",name:"Keep",description:"Keep in inbox",icon:"â©ï¸"}],READ_LATER:[{id:"snooze",name:"Snooze",description:"Remind me later",icon:"â°"},{id:"summarize",name:"Summarize",description:"Get a quick LLM summary",icon:"ð"},{id:"mark_done",name:"Mark Done",description:"Mark as read",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],REVIEW:[{id:"summarize",name:"Summarize",description:"Get a quick LLM summary",icon:"ð"},{id:"mark_done",name:"Mark Done",description:"Mark as reviewed",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],PAY_BILL:[{id:"extract_amount",name:"Extract Details",description:"Extract payment amount and due date",icon:"ð°"},{id:"set_reminder",name:"Set Reminder",description:"Remind me before due date",icon:"â°"},{id:"mark_done",name:"Mark Paid",description:"Mark as paid",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],TRACK_DELIVERY:[{id:"extract_tracking",name:"Extract Tracking",description:"Find tracking number and carrier",icon:"ð¦"},{id:"set_reminder",name:"Set Reminder",description:"Remind me to check delivery",icon:"â°"},{id:"mark_done",name:"Mark Delivered",description:"Mark as delivered",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],SCHEDULE_MEETING:[{id:"extract_details",name:"Extract Details",description:"Extract meeting time, location, attendees",icon:"ð"},{id:"draft_reply",name:"Confirm/Decline",description:"Draft a response",icon:"âï¸"},{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],UNSUBSCRIBE:[{id:"find_unsubscribe",name:"Find Unsubscribe Link",description:"Locate unsubscribe URL in email",icon:"ð"},{id:"confirm_delete",name:"Delete",description:"Delete this email",icon:"ðï¸"},{id:"dismiss",name:"Keep",description:"Keep subscription",icon:"â©ï¸"}],SAVE_RECEIPT:[{id:"extract_amount",name:"Extract Details",description:"Extract amount, vendor, date",icon:"ð§¾"},{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],ACKNOWLEDGE:[{id:"mark_done",name:"Acknowledge",description:"Mark as acknowledged",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],NO_ACTION:[{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}],IGNORE:[{id:"confirm_delete",name:"Delete",description:"Delete this email",icon:"ðï¸"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}]},Xv=[{id:"summarize",name:"Summarize",description:"Get a quick LLM summary",icon:"ð"},{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"},{id:"dismiss",name:"Dismiss",description:"Remove from queue",icon:"ðï¸"}];function Zv(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return Qv[e]||Xv}function Jv(t,e){var i;const r={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((i=e.body)==null?void 0:i.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=Zv(t.action);return{event:r,commands:a}}function $v(t){return{role:"assistant",type:"event-batch",items:t.filter(r=>r.success&&r.classification).map(r=>{const{event:a,commands:i}=Jv(r.classification,r.email);return{event:a,commands:i}}),content:""}}const ep="modulepreload",tp=function(t,e){return new URL(t,e).href},oc={},lc=function(e,r,a){let i=Promise.resolve();if(r&&r.length>0){let u=function(_){return Promise.all(_.map(b=>Promise.resolve(b).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const d=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),p=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));i=u(r.map(_=>{if(_=tp(_,a),_ in oc)return;oc[_]=!0;const b=_.endsWith(".css"),k=b?'[rel="stylesheet"]':"";if(!!a)for(let N=d.length-1;N>=0;N--){const E=d[N];if(E.href===_&&(!b||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${k}`))return;const A=document.createElement("link");if(A.rel=b?"stylesheet":ep,b||(A.as="script"),A.crossOrigin="",A.href=_,p&&A.setAttribute("nonce",p),document.head.appendChild(A),b)return new Promise((N,E)=>{A.addEventListener("load",N),A.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${_}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return i.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},np=20,rp={maxTokens:512},fs=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function Hu(t,{count:e=np,force:r=!1,onProgress:a=()=>{},signal:i}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,u=0;if(r)o=await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).reverse().limit(e).toArray();else{const $=new Set(await Ue.emailClassifications.toCollection().primaryKeys());u=0,o=[],await Ue.items.where("[sourceType+date]").between(["gmail",nn.minKey],["gmail",nn.maxKey]).reverse().until(()=>o.length>=e).each(R=>{$.has(R.id)?u++:o.push(R)})}if(o.length===0){const $=r?"No emails to scan.":`All emails already classified (${u} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:$,classified:0}),{scanned:0,classified:0,skipped:u,errors:0}}const d=Date.now(),h=performance.now();let p=0,_=0,b=0,k=0;const x=[],A=t.modelId,N=Zo(A)||Jo(A);if(!N)throw new Error(`Unknown model: ${A}`);if(!N.recommendedForEmailProcessing&&o.length>0){const{MODELS:$}=await lc(async()=>{const{MODELS:F}=await Promise.resolve().then(()=>bv);return{MODELS:F}},void 0,import.meta.url),{OLLAMA_MODELS:R}=await lc(async()=>{const{OLLAMA_MODELS:F}=await Promise.resolve().then(()=>wv);return{OLLAMA_MODELS:F}},void 0,import.meta.url),Y=[...$.filter(F=>F.recommendedForEmailProcessing).map(F=>F.name),...R.filter(F=>F.recommendedForEmailProcessing).map(F=>F.displayName)],ne=N.displayName||N.name;console.warn(`â ï¸ Current model (${ne}) is not optimized for email processing. For best results with long emails, use: ${Y.join(", ")}. Some emails may fail due to memory limits.`)}for(let $=0;$<o.length&&!(i!=null&&i.aborted);$++){const R=o[$],Y=Yu(R),ne=[{role:"system",content:fs},{role:"user",content:Y}];a({phase:"scanning",current:$+1,total:o.length,classified:p,errors:_,results:x,email:{subject:R.subject,from:R.from,date:R.date},prompt:{system:fs,user:Y},systemPromptLength:fs.length,live:null,lastResult:null,totals:{outputTokens:b,inputTokens:k,elapsed:performance.now()-h}});const F=performance.now();try{const{text:fe,tps:we,numTokens:Te,inputTokens:ye}=await t.generateFull(ne,{maxTokens:512,enableThinking:!1,temperature:0},ve=>{a({phase:"generating",current:$+1,total:o.length,classified:p,errors:_,results:x,email:{subject:R.subject,from:R.from,date:R.date},live:{tps:ve.tps,numTokens:ve.numTokens},streamingText:ve.text||"",totals:{outputTokens:b,inputTokens:k,elapsed:performance.now()-h}})});b+=Te,k+=ye;const de=ip(fe),_e=performance.now()-F;if(de){await Ue.emailClassifications.put({emailId:R.id,action:de.action,reason:de.reason,summary:de.summary,tags:de.tags,subject:R.subject||"(no subject)",from:R.from||"",date:R.date,scannedAt:d,status:"pending"}),p++;const ve={success:!0,email:{subject:R.subject,from:R.from,date:R.date},classification:de,rawResponse:fe,stats:{tps:we,numTokens:Te,inputTokens:ye,elapsed:_e},promptSize:Y.length};x.push(ve),a({phase:"classified",current:$+1,total:o.length,classified:p,errors:_,results:x,email:{subject:R.subject,from:R.from,date:R.date},result:de,rawResponse:fe,emailStats:{tps:we,numTokens:Te,inputTokens:ye,elapsed:_e},totals:{outputTokens:b,inputTokens:k,elapsed:performance.now()-h}})}}catch(fe){console.error(`Triage email ${$+1} failed:`,fe),_++;const we=fe.message||String(fe),Te=we.length>200?we.slice(0,200)+"...":we;x.push({success:!1,email:{subject:R.subject,from:R.from,date:R.date},error:Te,promptSize:Y.length})}}const E=performance.now()-h,J=x.length>0?Math.round(x.reduce(($,R)=>$+R.promptSize,0)/x.length):0,he=x.filter($=>{var R;return $.success&&((R=$.stats)==null?void 0:R.tps)}).length>0?Math.round(x.filter($=>$.success).reduce(($,R)=>{var Y;return $+(((Y=R.stats)==null?void 0:Y.tps)||0)},0)/x.filter($=>{var R;return $.success&&((R=$.stats)==null?void 0:R.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:p,errors:_,results:x,summary:{avgPromptSize:J,avgTps:he,systemPromptSize:fs.length,processed:o.length,skipped:u,modelName:N.displayName||N.name,modelContextWindow:N.contextWindow,modelMaxEmailTokens:N.maxEmailTokens},totals:{outputTokens:b,inputTokens:k,elapsed:E}}),{scanned:o.length,classified:p,skipped:u,errors:_}}async function ap(){const t=await Ue.emailClassifications.toArray();return Uu(t)}async function sp(){const t=await Ue.emailClassifications.toArray(),e={total:t.length};for(const r of t){const a=r.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function vi(t,e){await Ue.emailClassifications.update(t,{status:e})}async function cc(){await Ue.emailClassifications.clear()}async function tl(t){await Ue.emailClassifications.where("action").equals(t).delete()}async function Vu(t){await Ue.emailClassifications.delete(t)}async function Co(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Yu(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",r=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",r].join(`
`)}function ip(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const r=e.indexOf("{"),a=e.lastIndexOf("}");if(r===-1||a===-1||a<=r)return console.warn("Triage: no JSON object found in response"),null;const i=e.indexOf("[");if(i!==-1&&i<r)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(r,a+1);try{const u=JSON.parse(o);if(!u||typeof u!="object"||Array.isArray(u))return null;const d=op(u.action);if(!d)return console.warn("Triage: missing or invalid action field"),null;let h=[];return Array.isArray(u.tags)&&(h=u.tags.filter(p=>typeof p=="string"&&p.trim()).map(p=>p.trim().toLowerCase()).slice(0,10)),{action:d,reason:String(u.reason||"").slice(0,300),summary:String(u.summary||"").slice(0,500),tags:h}}catch(u){return console.warn("Triage: failed to parse JSON response:",u.message),null}}function op(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Ro(t){return`hsl(${ju(t)}, 55%, 55%)`}function lp(t){return`hsl(${ju(t)}, 40%, 35%)`}var cp=O('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),up=O('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function dp(t,e){ht(e,!0);let r=Oe(e,"backend",15,"webgpu"),a=Oe(e,"isWebGPUAvailable",3,!0);var i=up(),o=y(g(i),2),u=g(o);let d;u.__click=()=>r("webgpu");var h=y(u,2);let p;h.__click=()=>r("ollama");var _=y(o,2);{var b=k=>{var x=cp();T(k,x)};le(_,k=>{!a()&&r()==="webgpu"&&k(b)})}ae(()=>{d=Tt(u,1,"backend-btn svelte-1n2kfl0",null,d,{active:r()==="webgpu"}),u.disabled=!a(),p=Tt(h,1,"backend-btn svelte-1n2kfl0",null,p,{active:r()==="ollama"})}),T(t,i),mt()}Ct(["click"]);const fp=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function uc(...t){fp&&console.log("[debug]",...t)}function Sn(t){return uc(`[MOUNT] ${t}`),()=>uc(`[DESTROY] ${t}`)}var vp=O("<option> </option>"),pp=O('<p class="model-description svelte-1p89qnn"> </p>'),hp=O('<span class="current-badge svelte-1p89qnn">Current</span>'),mp=O('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),gp=O('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),_p=O('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),yp=O('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),bp=O('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),wp=O('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),kp=O('<p class="error svelte-1p89qnn"> </p>'),xp=O('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Sp(t,e){ht(e,!0);let r=Oe(e,"selectedModel",15),a=Oe(e,"gpuInfo",3,null),i=Oe(e,"error",3,null);Xt(()=>Sn("ModelSelector"));var o=xp(),u=g(o),d=y(g(u),2),h=y(g(d),2);St(h,21,()=>ur,Ft,(R,Y)=>{var ne=vp(),F=g(ne),fe={};ae(()=>{K(F,`${v(Y).name??""} â ${v(Y).size??""}`),fe!==(fe=v(Y).id)&&(ne.value=(ne.__value=v(Y).id)??"")}),T(R,ne)});var p=y(h,2);{var _=R=>{const Y=dt(()=>ur.find(we=>we.id===r()));var ne=vr(),F=He(ne);{var fe=we=>{var Te=pp(),ye=g(Te);ae(()=>K(ye,v(Y).description)),T(we,Te)};le(F,we=>{v(Y)&&we(fe)})}T(R,ne)};le(p,R=>{r()&&R(_)})}var b=y(d,2),k=y(g(b),2),x=g(k),A=y(g(x));St(A,21,()=>ur,Ft,(R,Y)=>{var ne=yp();let F;var fe=g(ne),we=g(fe),Te=y(we);{var ye=se=>{var re=hp();T(se,re)};le(Te,se=>{v(Y).id===r()&&se(ye)})}var de=y(fe),_e=g(de),ve=g(_e),ce=y(de),V=g(ce),Q=y(ce),X=g(Q);{var ue=se=>{var re=mp();T(se,re)},ie=se=>{var re=gp();T(se,re)},oe=se=>{var re=_p();T(se,re)};le(X,se=>{v(Y).recommendedForEmailProcessing?se(ue):v(Y).maxEmailTokens>=6e3?se(ie,1):se(oe,!1)})}ae((se,re)=>{F=Tt(ne,1,"svelte-1p89qnn",null,F,{selected:v(Y).id===r()}),K(we,`${v(Y).name??""} `),K(ve,`${se??""}k`),K(V,`~${re??""}k`)},[()=>(v(Y).contextWindow/1024).toFixed(0),()=>(v(Y).maxEmailTokens/1e3).toFixed(0)]),T(R,ne)});var N=y(b,2);{var E=R=>{var Y=wp(),ne=y(g(Y),2),F=g(ne),fe=y(g(F)),we=g(fe),Te=y(F,2),ye=y(g(Te)),de=g(ye),_e=y(Te,2);{var ve=ce=>{var V=bp(),Q=y(g(V)),X=g(Q);ae(ue=>K(X,ue),[()=>Ao(a().limits.maxBufferSize)]),T(ce,V)};le(_e,ce=>{var V;(V=a().limits)!=null&&V.maxBufferSize&&ce(ve)})}ae(()=>{K(we,a().vendor),K(de,a().architecture)}),T(R,Y)};le(N,R=>{a()&&R(E)})}var J=y(N,2);{var he=R=>{var Y=kp(),ne=g(Y);ae(()=>K(ne,i())),T(R,Y)};le(J,R=>{i()&&R(he)})}var $=y(J,2);$.__click=function(...R){var Y;(Y=e.onload)==null||Y.apply(this,R)},ae(()=>$.disabled=i()),xi(h,r),T(t,o),mt()}Ct(["click"]);var Tp=O('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),Ep=O('<span class="status-dot disconnected svelte-1bvvk8o"></span> <span> </span>',1),Ap=O("<div><!></div>"),Cp=O("<option> <!></option>"),Rp=O("<option> <!></option>"),Pp=O('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Ip=O('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Op=O('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Mp=O('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Dp=O('<span class="current-badge svelte-1bvvk8o">Current</span>'),Lp=O('<span class="installed-badge svelte-1bvvk8o">â</span>'),jp=O('<span class="rec-badge svelte-1bvvk8o">â</span>'),Np=O('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),qp=O('<p class="error svelte-1bvvk8o"> </p>'),Bp=O('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL:</label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" placeholder="http://localhost:11434" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function zp(t,e){ht(e,!0);let r=Oe(e,"selectedModel",15),a=Oe(e,"error",15),i=Me(qt(Ps())),o=Me(!1),u=Me(null),d=Me(qt([])),h=Me(!1);Ka(()=>{p()});async function p(){C(o,!0),C(u,null);const ie=await To(v(i));C(u,ie,!0),C(o,!1),ie.connected&&_()}async function _(){C(h,!0);try{const ie=await xv(v(i));C(d,ie.map(oe=>oe.name),!0)}catch(ie){console.error("Failed to load Ollama models:",ie),C(d,[],!0)}C(h,!1)}function b(){kv(v(i)),p()}function k(){if(!r()){a("Please select a model");return}e.onload()}function x(ie){return v(d).length?v(d).includes(ie):!1}const A=Mu();var N=Bp(),E=g(N),J=y(g(E),2),he=g(J);he.__change=b;var $=y(he,2);$.__click=p;var R=g($),Y=y(J,2);{var ne=ie=>{var oe=Ap();let se;var re=g(oe);{var G=ee=>{var me=Tp(),De=y(He(me),2),Ne=g(De);ae(()=>K(Ne,`Connected â¢ v${v(u).version??""}`)),T(ee,me)},H=ee=>{var me=Ep(),De=y(He(me),2),Ne=g(De);ae(()=>K(Ne,`Disconnected: ${v(u).error??""}`)),T(ee,me)};le(re,ee=>{v(u).connected?ee(G):ee(H,!1)})}ae(()=>se=Tt(oe,1,"connection-status svelte-1bvvk8o",null,se,{connected:v(u).connected})),T(ie,oe)};le(Y,ie=>{v(u)&&ie(ne)})}var F=y(E,2),fe=y(g(F),2),we=g(fe);St(we,21,()=>A,Ft,(ie,oe)=>{var se=Cp(),re=g(se),G=y(re);{var H=De=>{var Ne=Tr("â");T(De,Ne)},ee=dt(()=>x(v(oe).name));le(G,De=>{v(ee)&&De(H)})}var me={};ae(De=>{K(re,`${v(oe).displayName??""} (${v(oe).params??""}) - ${De??""}k context `),me!==(me=v(oe).name)&&(se.value=(se.__value=v(oe).name)??"")},[()=>(v(oe).contextWindow/1024).toFixed(0)]),T(ie,se)});var Te=y(we);St(Te,21,()=>Xn.filter(ie=>!ie.recommended),Ft,(ie,oe)=>{var se=Rp(),re=g(se),G=y(re);{var H=De=>{var Ne=Tr("â");T(De,Ne)},ee=dt(()=>x(v(oe).name));le(G,De=>{v(ee)&&De(H)})}var me={};ae(De=>{K(re,`${v(oe).displayName??""} (${v(oe).params??""}) - ${De??""}k context `),me!==(me=v(oe).name)&&(se.value=(se.__value=v(oe).name)??"")},[()=>(v(oe).contextWindow/1024).toFixed(0)]),T(ie,se)});var ye=y(fe,2);{var de=ie=>{const oe=dt(()=>Xn.find(H=>H.name===r()));var se=vr(),re=He(se);{var G=H=>{var ee=Mp(),me=g(ee),De=g(me),Ne=y(me,2),z=g(Ne),ke=g(z),Ce=y(z,4),ze=g(Ce),Ve=y(Ce,2);{var ot=Be=>{var We=Pp(),gt=y(He(We),2),Pt=g(gt);ae(ln=>K(Pt,ln),[()=>v(oe).tags.join(", ")]),T(Be,We)};le(Ve,Be=>{var We;(We=v(oe).tags)!=null&&We.length&&Be(ot)})}var Rt=y(Ne,2);{var Bt=Be=>{var We=Ip(),gt=y(g(We),2),Pt=g(gt);ae(()=>K(Pt,`ollama pull ${r()??""}`)),T(Be,We)},jt=dt(()=>!x(r())),rt=Be=>{var We=Op();T(Be,We)};le(Rt,Be=>{v(jt)?Be(Bt):Be(rt,!1)})}ae(Be=>{K(De,v(oe).description),K(ke,`${Be??""}k context`),K(ze,`${v(oe).params??""} params`)},[()=>(v(oe).contextWindow/1024).toFixed(0)]),T(H,ee)};le(re,H=>{v(oe)&&H(G)})}T(ie,se)};le(ye,ie=>{r()&&ie(de)})}var _e=y(F,2),ve=y(g(_e),2),ce=g(ve),V=y(g(ce));St(V,21,()=>Xn,Ft,(ie,oe)=>{var se=Np();let re;var G=g(se),H=g(G),ee=y(H);{var me=Be=>{var We=Dp();T(Be,We)};le(ee,Be=>{v(oe).name===r()&&Be(me)})}var De=y(ee,2);{var Ne=Be=>{var We=Lp();T(Be,We)},z=dt(()=>x(v(oe).name));le(De,Be=>{v(z)&&Be(Ne)})}var ke=y(G),Ce=g(ke),ze=g(Ce),Ve=y(ke),ot=g(Ve),Rt=y(Ve),Bt=g(Rt);{var jt=Be=>{var We=jp();T(Be,We)};le(Bt,Be=>{v(oe).recommended&&Be(jt)})}var rt=y(Bt);ae((Be,We,gt)=>{re=Tt(se,1,"svelte-1bvvk8o",null,re,Be),K(H,`${v(oe).displayName??""} `),K(ze,`${We??""}k`),K(ot,v(oe).params),K(rt,` ${gt??""}`)},[()=>({selected:v(oe).name===r(),installed:x(v(oe).name)}),()=>(v(oe).contextWindow/1024).toFixed(0),()=>v(oe).tags.slice(0,2).join(", ")]),T(ie,se)});var Q=y(_e,2);{var X=ie=>{var oe=qp(),se=g(oe);ae(()=>K(se,a())),T(ie,oe)};le(Q,ie=>{a()&&ie(X)})}var ue=y(Q,2);ue.__click=k,ae(()=>{var ie;$.disabled=v(o),K(R,v(o)?"Testing...":"Test"),ue.disabled=!((ie=v(u))!=null&&ie.connected)||a()}),Si(he,()=>v(i),ie=>C(i,ie)),xi(fe,r),T(t,N),mt()}Ct(["change","click"]);var Fp=O('<span class="progress-percent svelte-r5fnze"> </span>'),Kp=O('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),Up=O('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),Gp=O('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),Wp=O('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),Hp=O('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),Vp=O('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function Yp(t,e){ht(e,!0);let r=Oe(e,"message",3,""),a=Oe(e,"items",19,()=>[]);Xt(()=>Sn("LoadingProgress"));var i=Vp(),o=g(i),u=g(o),d=y(o,2);St(d,17,a,Ft,(h,p)=>{const _=dt(()=>v(p).total?Ov(v(p).loaded||0,v(p).total):null);var b=Hp(),k=g(b),x=g(k),A=g(x),N=y(x,2);{var E=R=>{var Y=Fp(),ne=g(Y);ae(F=>K(ne,`${F??""}%`),[()=>v(_).toFixed(1)]),T(R,Y)};le(N,R=>{v(_)!==null&&R(E)})}var J=y(k,2);{var he=R=>{var Y=Kp(),ne=He(Y),F=g(ne),fe=y(ne,2),we=g(fe),Te=g(we),ye=y(we,4),de=g(ye),_e=y(ye,2),ve=g(_e);ae((ce,V,Q,X,ue)=>{hn(F,`width: ${ce??""}%`),K(Te,V),K(de,Q),K(ve,`(${X??""} / ${ue??""} B)`)},[()=>Math.max(v(p).progress??0,.5).toFixed(1),()=>io(v(p).loaded||0),()=>io(v(p).total),()=>(v(p).loaded||0).toLocaleString(),()=>v(p).total.toLocaleString()]),T(R,Y)},$=R=>{var Y=Wp(),ne=y(He(Y),2),F=g(ne);{var fe=Te=>{var ye=Up(),de=He(ye),_e=g(de),ve=y(de,2),ce=g(ve);ae((V,Q)=>{K(_e,V),K(ce,`(${Q??""} B)`)},[()=>io(v(p).loaded),()=>v(p).loaded.toLocaleString()]),T(Te,ye)},we=Te=>{var ye=Gp();T(Te,ye)};le(F,Te=>{v(p).loaded?Te(fe):Te(we,!1)})}T(R,Y)};le(J,R=>{v(p).total?R(he):R($,!1)})}ae(()=>{Iu(x,"title",v(p).file),K(A,v(p).file)}),T(h,b)}),ae(()=>K(u,r())),T(t,i),mt()}var Qp=O('<span class="thinking-tokens svelte-11gjw00"> </span>'),Xp=O('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Zp=O('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Jp=O('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),$p=O('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),eh=O('<span class="cursor svelte-11gjw00">|</span>'),th=O(" <!>",1),nh=O('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),rh=O('<div class="content svelte-11gjw00"> </div>'),ah=O('<div><div class="role svelte-11gjw00"> </div> <!></div>');function sh(t,e){ht(e,!0);let r=Oe(e,"isLast",3,!1),a=Oe(e,"isRunning",3,!1),i=Oe(e,"generationPhase",3,null),o=Oe(e,"numTokens",3,null);Xt(()=>Sn(`MessageBubble[${e.msg.role}]`));var u=ah(),d=g(u),h=g(d),p=y(d,2);{var _=k=>{var x=nh(),A=He(x);{var N=F=>{var fe=Xp(),we=y(g(fe),4);{var Te=ye=>{var de=Qp(),_e=g(de);ae(()=>K(_e,`${o()??""} tokens`)),T(ye,de)};le(we,ye=>{o()&&ye(Te)})}T(F,fe)},E=F=>{var fe=Zp();T(F,fe)};le(A,F=>{a()&&r()&&i()==="thinking"?F(N):a()&&r()&&i()==="preparing"&&F(E,1)})}var J=y(A,2);{var he=F=>{var fe=Jp(),we=g(fe),Te=y(g(we),2),ye=g(Te),de=y(we,2),_e=g(de);ae(ve=>{K(ye,`${ve??""} words`),K(_e,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),T(F,fe)};le(J,F=>{e.msg.thinking&&F(he)})}var $=y(J,2),R=g($);{var Y=F=>{var fe=$p();T(F,fe)},ne=F=>{var fe=th(),we=He(fe,!0),Te=y(we);{var ye=de=>{var _e=eh();T(de,_e)};le(Te,de=>{a()&&r()&&de(ye)})}ae(()=>K(we,e.msg.content)),T(F,fe)};le(R,F=>{a()&&r()&&!e.msg.content&&i()!=="thinking"?F(Y):F(ne,!1)})}T(k,x)},b=k=>{var x=rh(),A=g(x);ae(()=>K(A,e.msg.content)),T(k,x)};le(p,k=>{e.msg.role==="assistant"?k(_):k(b,!1)})}ae(()=>{Tt(u,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),K(h,e.msg.role==="user"?"You":"AI")}),T(t,u),mt()}var ih=O('<span class="cmd-icon svelte-1m7x4wq"> </span>'),oh=O('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),lh=O('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function dc(t,e){ht(e,!0);var r=lh(),a=He(r);a.__click=()=>{var x;return(x=e.onexecute)==null?void 0:x.call(e,e.command.id)};var i=g(a);{var o=x=>{var A=ih(),N=g(A);ae(()=>K(N,e.command.icon)),T(x,A)};le(i,x=>{e.command.icon&&x(o)})}var u=y(i,2),d=g(u),h=g(d),p=y(d,2),_=g(p),b=y(a,2);{var k=x=>{var A=oh(),N=g(A),E=g(N);ae(()=>K(E,e.command.body)),T(x,A)};le(b,x=>{e.command.body&&x(k)})}ae(()=>{K(h,e.command.name),K(_,e.command.description)}),T(t,r),mt()}Ct(["click"]);var ch=O('<div class="event-subject svelte-1w66m1k"> </div>'),uh=O('<span class="sep svelte-1w66m1k">Â·</span> ',1),dh=O('<div class="event-summary svelte-1w66m1k"> </div>'),fh=O('<span class="tag svelte-1w66m1k"> </span>'),vh=O('<div class="event-tags svelte-1w66m1k"></div>'),ph=O('<div class="event-reason svelte-1w66m1k"> </div>'),hh=O('<div class="commands svelte-1w66m1k"></div>'),mh=O('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),gh=O('<span class="event-subject-inline svelte-1w66m1k"> </span>'),_h=O('<span class="sep svelte-1w66m1k">Â·</span> ',1),yh=O('<div class="event-summary svelte-1w66m1k"> </div>'),bh=O('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),wh=O('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>');function kh(t,e){ht(e,!0);function r(p){if(!p)return"â";const _=p.replace(/<.*>/,"").trim();return _.length>40?_.slice(0,38)+"â¦":_}function a(p){if(!p)return"";try{return new Date(p).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function i(p,_){var b;(b=e.oncommand)==null||b.call(e,{event:p,commandId:_})}var o=vr(),u=He(o);{var d=p=>{var _=mh(),b=g(_),k=g(b),x=g(k),A=g(x),N=y(x,2),E=g(N),J=y(k,2);{var he=V=>{var Q=ch(),X=g(Q);ae(()=>K(X,e.msg.event.data.subject)),T(V,Q)};le(J,V=>{var Q;(Q=e.msg.event.data)!=null&&Q.subject&&V(he)})}var $=y(J,2),R=g($);{var Y=V=>{var Q=Tr();ae(X=>K(Q,X),[()=>r(e.msg.event.data.from)]),T(V,Q)};le(R,V=>{var Q;(Q=e.msg.event.data)!=null&&Q.from&&V(Y)})}var ne=y(R,2);{var F=V=>{var Q=uh(),X=y(He(Q),1,!0);ae(ue=>K(X,ue),[()=>a(e.msg.event.data.date)]),T(V,Q)};le(ne,V=>{var Q;(Q=e.msg.event.data)!=null&&Q.date&&V(F)})}var fe=y($,2);{var we=V=>{var Q=dh(),X=g(Q);ae(()=>K(X,e.msg.event.metadata.summary)),T(V,Q)};le(fe,V=>{var Q;(Q=e.msg.event.metadata)!=null&&Q.summary&&V(we)})}var Te=y(fe,2);{var ye=V=>{var Q=vh();St(Q,21,()=>e.msg.event.metadata.tags,Ft,(X,ue)=>{var ie=fh(),oe=g(ie);ae(()=>K(oe,v(ue))),T(X,ie)}),T(V,Q)};le(Te,V=>{var Q,X;(X=(Q=e.msg.event.metadata)==null?void 0:Q.tags)!=null&&X.length&&V(ye)})}var de=y(Te,2);{var _e=V=>{var Q=ph(),X=g(Q);ae(()=>K(X,e.msg.event.metadata.reason)),T(V,Q)};le(de,V=>{var Q;(Q=e.msg.event.metadata)!=null&&Q.reason&&V(_e)})}var ve=y(b,2);{var ce=V=>{var Q=hh();St(Q,21,()=>e.msg.commands,Ft,(X,ue)=>{dc(X,{get command(){return v(ue)},onexecute:ie=>i(e.msg.event,ie)})}),T(V,Q)};le(ve,V=>{var Q;(Q=e.msg.commands)!=null&&Q.length&&V(ce)})}ae(()=>{K(A,e.msg.event.type),K(E,e.msg.event.source)}),T(p,_)},h=p=>{var _=wh(),b=g(_),k=g(b),x=g(k),A=y(b,2);St(A,17,()=>e.msg.items,Ft,(N,E)=>{var J=bh(),he=g(J),$=g(he),R=g($),Y=g(R),ne=y(R,2);{var F=V=>{var Q=gh(),X=g(Q);ae(()=>K(X,v(E).event.data.subject)),T(V,Q)};le(ne,V=>{var Q;(Q=v(E).event.data)!=null&&Q.subject&&V(F)})}var fe=y($,2),we=g(fe);{var Te=V=>{var Q=Tr();ae(X=>K(Q,X),[()=>r(v(E).event.data.from)]),T(V,Q)};le(we,V=>{var Q;(Q=v(E).event.data)!=null&&Q.from&&V(Te)})}var ye=y(we,2);{var de=V=>{var Q=_h(),X=y(He(Q),1,!0);ae(ue=>K(X,ue),[()=>a(v(E).event.data.date)]),T(V,Q)};le(ye,V=>{var Q;(Q=v(E).event.data)!=null&&Q.date&&V(de)})}var _e=y(fe,2);{var ve=V=>{var Q=yh(),X=g(Q);ae(()=>K(X,v(E).event.metadata.summary)),T(V,Q)};le(_e,V=>{var Q;(Q=v(E).event.metadata)!=null&&Q.summary&&V(ve)})}var ce=y(he,2);St(ce,21,()=>v(E).commands,Ft,(V,Q)=>{dc(V,{get command(){return v(Q)},onexecute:X=>i(v(E).event,X)})}),ae(()=>K(Y,v(E).event.type)),T(N,J)}),ae(()=>K(x,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),T(p,_)};le(u,p=>{e.msg.type==="event"?p(d):e.msg.type==="event-batch"&&p(h,1)})}T(t,o),mt()}var xh=O('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Sh=O('<span class="edate svelte-mt5nvh"> </span>'),Th=O('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Eh=O('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Ah=O('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),Ch=O('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Rh=O('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Ph(t,e){ht(e,!0);let r=Oe(e,"pendingData",3,null),a=Me(null),i=Me(null);function o(x){C(a,v(a)===x?null:x,!0),C(i,null)}function u(x){return x.split("_").map(A=>A.charAt(0)+A.slice(1).toLowerCase()).join(" ")}function d(x){if(!x)return"";try{return new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function h(x){if(!x)return"";const A=x.replace(/<.*>/,"").trim();return A.length>24?A.slice(0,22)+"â¦":A}var p={toggleGroup:o},_=vr(),b=He(_);{var k=x=>{var A=Rh(),N=g(A),E=g(N),J=y(N,2);St(J,20,()=>r().order,R=>R,(R,Y)=>{const ne=dt(()=>r().groups[Y]),F=dt(()=>Ro(Y)),fe=dt(()=>v(a)===Y);var we=xh();let Te;we.__click=()=>o(Y);let ye;var de=g(we);let _e;var ve=y(de),ce=y(ve),V=g(ce);ae(Q=>{Te=Tt(we,1,"chip svelte-mt5nvh",null,Te,{active:v(fe)}),ye=hn(we,"",ye,{"--c":v(F)}),_e=hn(de,"",_e,{background:v(F)}),K(ve,` ${Q??""} `),K(V,v(ne).length)},[()=>u(Y)]),T(R,we)});var he=y(J,2);{var $=R=>{const Y=dt(()=>r().groups[v(a)]),ne=dt(()=>Ro(v(a)));var F=Ch(),fe=g(F);let we;var Te=g(fe);Te.__click=()=>{C(a,null),C(i,null)};var ye=y(Te,2),de=g(ye),_e=y(ye,2),ve=g(_e),ce=y(fe,2);St(ce,21,()=>v(Y),ie=>ie.emailId,(ie,oe)=>{var se=Th(),re=g(se);re.__click=()=>{var ze;return(ze=e.onaskai)==null?void 0:ze.call(e,`Tell me about the email "${v(oe).subject}" from ${v(oe).from}`)};var G=g(re),H=g(G),ee=y(G,2),me=g(ee),De=y(me);{var Ne=ze=>{var Ve=Sh(),ot=g(Ve);ae(Rt=>K(ot,Rt),[()=>d(v(oe).date)]),T(ze,Ve)};le(De,ze=>{v(oe).date&&ze(Ne)})}var z=y(re,2),ke=g(z);ke.__click=()=>{var ze;return(ze=e.onmarkacted)==null?void 0:ze.call(e,v(oe).emailId)};var Ce=y(ke,2);Ce.__click=()=>{var ze;return(ze=e.ondismiss)==null?void 0:ze.call(e,v(oe).emailId)},ae(ze=>{K(H,v(oe).subject),K(me,ze)},[()=>h(v(oe).from)]),T(ie,se)});var V=y(ce,2),Q=g(V);{var X=ie=>{var oe=Eh(),se=He(oe);se.__click=()=>v(Y).forEach(G=>{var H;return(H=e.onmarkacted)==null?void 0:H.call(e,G.emailId)});var re=y(se,2);re.__click=()=>C(i,v(a),!0),T(ie,oe)},ue=ie=>{var oe=Ah(),se=He(oe),re=g(se),G=y(se,2);G.__click=()=>C(i,null);var H=y(G,2);H.__click=()=>{var ee;(ee=e.oncleargroup)==null||ee.call(e,v(a)),C(i,null),C(a,null)},ae(()=>K(re,`Remove ${v(Y).length??""}?`)),T(ie,oe)};le(Q,ie=>{v(i)!==v(a)?ie(X):ie(ue,!1)})}ae(ie=>{we=hn(fe,"",we,{"border-color":v(ne)}),K(de,ie),K(ve,v(Y).length)},[()=>u(v(a))]),T(R,F)};le(he,R=>{v(a)&&r().groups[v(a)]&&R($)})}ae(()=>K(E,`${r().total??""} item${r().total!==1?"s":""} need attention`)),T(x,A)};le(b,x=>{r()&&r().total>0&&x(k)})}return T(t,_),mt(p)}Ct(["click"]);var Ih=O('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Oh=O('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Mh=O('<div class="strip svelte-1ed7zw1"><!></div>');function Dh(t,e){let r=Oe(e,"hasScanData",3,!1),a=Oe(e,"engineReady",3,!1),i=Oe(e,"isScanning",3,!1),o=dt(()=>a()&&!r()&&!i()),u=dt(()=>v(o)||i());var d=vr(),h=He(d);{var p=_=>{var b=Mh(),k=g(b);{var x=N=>{var E=Ih();T(N,E)},A=N=>{var E=Oh();E.__click=function(...J){var he;(he=e.onscan)==null||he.apply(this,J)},T(N,E)};le(k,N=>{i()?N(x):v(o)&&N(A,1)})}T(_,b)};le(h,_=>{v(u)&&_(p)})}T(t,d)}Ct(["click"]);var Lh=O('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),jh=O('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Nh=O('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),qh=O('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Bh=O('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),zh=O('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),Fh=O('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Kh(t,e){ht(e,!0),Xt(()=>Sn("GpuPanel"));var r=Fh(),a=g(r),i=y(g(a),2),o=y(g(i),2),u=g(o),d=y(i,2),h=y(g(d),2),p=g(h),_=y(d,2);{var b=R=>{var Y=Lh(),ne=y(g(Y),2),F=g(ne);ae(()=>K(F,e.gpuInfo.device)),T(R,Y)};le(_,R=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&R(b)})}var k=y(_,2);{var x=R=>{var Y=jh(),ne=y(g(Y),2),F=g(ne);ae(fe=>K(F,fe),[()=>Ao(e.gpuInfo.limits.maxBufferSize)]),T(R,Y)};le(k,R=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxBufferSize&&R(x)})}var A=y(k,2);{var N=R=>{var Y=Nh(),ne=y(g(Y),2),F=g(ne);ae(()=>K(F,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),T(R,Y)};le(A,R=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxComputeInvocationsPerWorkgroup&&R(N)})}var E=y(A,2);{var J=R=>{var Y=qh(),ne=y(g(Y),2),F=g(ne);ae(fe=>K(F,fe),[()=>Ao(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),T(R,Y)};le(E,R=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxComputeWorkgroupStorageSize&&R(J)})}var he=y(E,2);{var $=R=>{var Y=zh(),ne=g(Y),F=g(ne),fe=y(ne,2);St(fe,21,()=>e.gpuInfo.features,Ft,(we,Te)=>{var ye=Bh(),de=g(ye);ae(()=>K(de,v(Te))),T(we,ye)}),ae(()=>K(F,`Features (${e.gpuInfo.features.length??""})`)),T(R,Y)};le(he,R=>{var Y;(Y=e.gpuInfo.features)!=null&&Y.length&&R($)})}ae(()=>{K(u,e.gpuInfo.vendor),K(p,e.gpuInfo.architecture)}),T(t,r),mt()}var Uh=O('<button class="gpu-badge svelte-1ktw27c"> </button>'),Gh=O('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Wh=O('<span class="stats svelte-1ktw27c"> </span>'),Hh=O('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Vh=O('<span class="stats preparing svelte-1ktw27c"> </span>'),Yh=O('<span class="stats svelte-1ktw27c"> </span>'),Qh=O('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Xh=O('<button class="btn svelte-1ktw27c">Stop</button>'),Zh=O('<button class="btn primary svelte-1ktw27c">Send</button>'),Jh=O('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function $h(t,e){ht(e,!0),Xt(()=>Sn("ChatView"));let r=Oe(e,"messages",19,()=>[]),a=Oe(e,"pendingData",3,null),i=Oe(e,"hasScanData",3,!1),o=Oe(e,"engineReady",3,!1),u=Oe(e,"isScanning",3,!1),d=Oe(e,"isRunning",3,!1),h=Oe(e,"tps",3,null),p=Oe(e,"numTokens",3,null),_=Oe(e,"generationPhase",3,null),b=Oe(e,"gpuInfo",3,null),k=Oe(e,"backend",3,"webgpu"),x=Oe(e,"chatContainer",15),A=Me(""),N=Me(!1);function E(ee){ee.key==="Enter"&&!ee.shiftKey&&(ee.preventDefault(),J())}function J(){const ee=v(A).trim();!ee||d()||(C(A,""),e.onsend(ee))}function he(ee){ee&&!d()&&e.onsend(ee)}var $=Jh(),R=g($),Y=g(R);{var ne=ee=>{var me=Uh();me.__click=()=>C(N,!v(N));var De=g(me);ae(()=>K(De,`WebGPU ${v(N)?"â²":"â¼"}`)),T(ee,me)},F=ee=>{var me=Gh();T(ee,me)};le(Y,ee=>{b()?ee(ne):k()==="ollama"&&ee(F,1)})}var fe=y(Y,2);{var we=ee=>{var me=Wh(),De=g(me);ae((Ne,z)=>K(De,`${p()??""} tokens in ${Ne??""}s
        (${z??""} tok/s)`),[()=>(p()/h()).toFixed(1),()=>h().toFixed(1)]),T(ee,me)},Te=ee=>{var me=Hh();T(ee,me)},ye=ee=>{var me=Vh(),De=g(me);ae(Ne=>K(De,`thinking... ${Ne??""}`),[()=>h()?`${h().toFixed(0)} tok/s`:""]),T(ee,me)},de=ee=>{var me=Yh(),De=g(me);ae(Ne=>K(De,`${Ne??""} tok/s`),[()=>h().toFixed(1)]),T(ee,me)};le(fe,ee=>{h()&&!d()?ee(we):d()&&_()==="preparing"?ee(Te,1):d()&&_()==="thinking"?ee(ye,2):h()&&d()&&ee(de,3)})}var _e=y(fe,4);_e.__click=function(...ee){var me;(me=e.onreset)==null||me.apply(this,ee)};var ve=y(R,2);{var ce=ee=>{Kh(ee,{get gpuInfo(){return b()}})};le(ve,ee=>{v(N)&&b()&&ee(ce)})}var V=y(ve,2),Q=g(V);{var X=ee=>{var me=Qh();T(ee,me)};le(Q,ee=>{r().length===0&&!(a()&&a().total>0)&&ee(X)})}var ue=y(Q,2);St(ue,17,r,Ft,(ee,me,De)=>{var Ne=vr(),z=He(Ne);{var ke=Ve=>{Ph(Ve,{get pendingData(){return v(me).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:he})},Ce=Ve=>{kh(Ve,{get msg(){return v(me)},get oncommand(){return e.oncommand}})},ze=Ve=>{{let ot=dt(()=>De===r().length-1);sh(Ve,{get msg(){return v(me)},get isLast(){return v(ot)},get isRunning(){return d()},get generationPhase(){return _()},get numTokens(){return p()}})}};le(z,Ve=>{v(me).type==="dashboard"?Ve(ke):v(me).type==="event"||v(me).type==="event-batch"?Ve(Ce,1):Ve(ze,!1)})}T(ee,Ne)}),Ou(V,ee=>x(ee),()=>x());var ie=y(V,2);Dh(ie,{get hasScanData(){return i()},get engineReady(){return o()},get isScanning(){return u()},get onscan(){return e.onscan}});var oe=y(ie,2),se=g(oe);se.__keydown=E;var re=y(se,2);{var G=ee=>{var me=Xh();me.__click=function(...De){var Ne;(Ne=e.onstop)==null||Ne.apply(this,De)},T(ee,me)},H=ee=>{var me=Zh();me.__click=J,ae(De=>me.disabled=De,[()=>!v(A).trim()]),T(ee,me)};le(re,ee=>{d()?ee(G):ee(H,!1)})}ae(()=>{_e.disabled=d(),se.disabled=d()}),Si(se,()=>v(A),ee=>C(A,ee)),T(t,$),mt()}Ct(["click","keydown"]);var em=O('<div class="container center svelte-1bi93vx"><!> <!></div>');function tm(t,e){ht(e,!0);const r=!!navigator.gpu,a=Du();let i=Me(qt(localStorage.getItem("aiBackend")||"webgpu"));function o(){const G=localStorage.getItem("selectedModel");return G||(v(i)==="webgpu"?ur[0].id:Xn[0].name)}let u=Me(qt(o())),d=Me(null),h=Me(null),p=Me(""),_=Me(qt([])),b=Me(qt([])),k=Me(!1),x=Me(null),A=Me(null),N=Me(null),E=Me(null),J=Me(null),he=Me(null),$=Me(!1),R=Me(!1),Y=!1;Xt(()=>{a.check(),a.isReady&&ne();const G=a.onMessage(H=>{switch(H.status){case"webgpu-info":C(E,H.data,!0);break;case"loading":C(d,"loading"),C(p,H.data,!0);break;case"initiate":C(_,[...v(_),H],!0);break;case"progress":C(_,v(_).map(ee=>ee.file===H.file?{...ee,...H}:ee),!0);break;case"done":C(_,v(_).filter(ee=>ee.file!==H.file),!0);break;case"ready":C(d,"ready"),ne();break;case"start":if(!v(k))break;C(J,H.phase||"preparing",!0),C(b,[...v(b),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!v(k))break;C(J,H.phase,!0);break;case"thinking":{if(!v(k))break;C(x,H.tps,!0),C(A,H.numTokens,!0);const ee=v(b)[v(b).length-1];C(b,[...v(b).slice(0,-1),{...ee,thinking:(ee.thinking||"")+H.content}],!0),ve();break}case"thinking-done":{if(!v(k))break;C(x,H.tps,!0),C(A,H.numTokens,!0);const ee=v(b)[v(b).length-1];C(b,[...v(b).slice(0,-1),{...ee,thinking:H.content}],!0);break}case"update":{if(!v(k))break;C(x,H.tps,!0),C(A,H.numTokens,!0);const ee=v(b)[v(b).length-1];C(b,[...v(b).slice(0,-1),{...ee,content:ee.content+H.output}],!0),ve();break}case"complete":if(!v(k))break;H.tps!==void 0&&C(x,H.tps,!0),H.numTokens!==void 0&&C(A,H.numTokens,!0),C(k,!1),C(J,null),F();break;case"error":C(h,H.data,!0),v(d)==="loading"&&C(d,null),v(k)&&(C(k,!1),C(J,null));break}});return()=>G()});async function ne(){if(!(Y||v(b).length>0))try{const G=await ic();C(he,G,!0),G&&(Y=!0,C(b,[{role:"assistant",type:"dashboard",pendingData:G}],!0),ve());const H=await Co();C($,H.classified>0)}catch{}}async function F(){try{const G=await ic();C(he,G,!0);const H=v(b).findIndex(me=>me.type==="dashboard");H!==-1&&(G&&G.total>0?C(b,v(b).map((me,De)=>De===H?{...me,pendingData:G}:me),!0):C(b,v(b).filter((me,De)=>De!==H),!0));const ee=await Co();C($,ee.classified>0)}catch{}}async function fe(G){await vi(G,"acted"),await F()}async function we(G){await vi(G,"dismissed"),await F()}async function Te(G){await Vu(G),await F()}async function ye(G){await tl(G),await F()}async function de(){if(v(R)||!a.isReady)return;C(R,!0);let G=null;try{if(await Hu(a,{count:20,onProgress:H=>{var ee;H.phase==="done"&&((ee=H.results)==null?void 0:ee.length)>0&&(G=H.results)}}),await F(),(G==null?void 0:G.length)>0){const H=$v(G);C(b,[...v(b),H],!0),ve()}v(he)&&!v(b).some(H=>H.type==="dashboard")&&(C(b,[{role:"assistant",type:"dashboard",pendingData:v(he)},...v(b)],!0),ve())}catch(H){console.error("Scan failed:",H)}finally{C(R,!1)}}function _e({event:G,commandId:H}){var ee,me;`${H}${G.type}${((ee=G.data)==null?void 0:ee.subject)||"unknown"}`,C(b,[...v(b),{role:"assistant",content:`Command: ${H}

This command is not yet implemented. In the future, "${H}" will be executed on the ${G.source} event "${((me=G.data)==null?void 0:me.subject)||""}".`}],!0),ve()}function ve(){Eu().then(()=>{v(N)&&(v(N).scrollTop=v(N).scrollHeight)})}function ce(){C(d,"loading"),localStorage.setItem("selectedModel",v(u)),localStorage.setItem("aiBackend",v(i)),v(i)==="ollama"&&C(E,null),a.loadModel(v(u))}Ka(()=>{v(i)==="webgpu"&&!ur.find(G=>G.id===v(u))?C(u,ur[0].id,!0):v(i)==="ollama"&&!Xn.find(G=>G.name===v(u))&&C(u,Xn[0].name,!0)});async function V(G){if(!G||v(k))return;C(b,[...v(b),{role:"user",content:G}],!0),C(x,null),C(k,!0);let H=[];try{const De=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(G)?await Yv(G):await Vv();De&&(H=[{role:"system",content:De}])}catch{}const ee=v(b).filter(me=>me.type!=="dashboard").map(me=>({role:me.role,content:me.content}));a.generate([...H,...ee]),ve()}function Q(){a.interrupt()}function X(){a.reset(),C(b,[],!0),C(x,null),C(A,null),Y=!1,ne()}var ue=vr(),ie=He(ue);{var oe=G=>{var H=em(),ee=g(H);dp(ee,{get isWebGPUAvailable(){return r},get backend(){return v(i)},set backend(z){C(i,z,!0)}});var me=y(ee,2);{var De=z=>{Sp(z,{get gpuInfo(){return v(E)},get error(){return v(h)},onload:ce,get selectedModel(){return v(u)},set selectedModel(ke){C(u,ke,!0)}})},Ne=z=>{zp(z,{onload:ce,get selectedModel(){return v(u)},set selectedModel(ke){C(u,ke,!0)},get error(){return v(h)},set error(ke){C(h,ke,!0)}})};le(me,z=>{v(i)==="webgpu"?z(De):v(i)==="ollama"&&z(Ne,1)})}T(G,H)},se=G=>{Yp(G,{get message(){return v(p)},get items(){return v(_)}})},re=G=>{$h(G,{get messages(){return v(b)},get pendingData(){return v(he)},get hasScanData(){return v($)},get engineReady(){return a.isReady},get isScanning(){return v(R)},get isRunning(){return v(k)},get tps(){return v(x)},get numTokens(){return v(A)},get generationPhase(){return v(J)},get gpuInfo(){return v(E)},get backend(){return v(i)},onsend:V,onstop:Q,onreset:X,onmarkacted:fe,ondismiss:we,onremove:Te,oncleargroup:ye,onscan:de,oncommand:_e,get chatContainer(){return v(N)},set chatContainer(H){C(N,H,!0)}})};le(ie,G=>{v(d)===null?G(oe):v(d)==="loading"?G(se,1):G(re,!1)})}T(t,ue),mt()}const fc="https://accounts.google.com/gsi/client",nm="https://www.googleapis.com/auth/gmail.readonly",nl="me-ai:oauth-token",rl=300*1e3;let ws=null,_s=null,Ur=0;function Qu(t,e){Ur=Date.now()+e*1e3;try{sessionStorage.setItem(nl,JSON.stringify({access_token:t,expires_at:Ur}))}catch{}}function Po(){Ur=0;try{sessionStorage.removeItem(nl)}catch{}}function rm(){try{const t=sessionStorage.getItem(nl);if(!t)return null;const{access_token:e,expires_at:r}=JSON.parse(t);return!e||Date.now()>r-rl?(Po(),null):(Ur=r,{access_token:e})}catch{return Po(),null}}function am(){return Ur>0&&Date.now()<Ur-rl}function sm(){return Ur<=0?0:Math.max(0,Ur-rl-Date.now())}function vc(){return new Promise((t,e)=>{if(!ws){e(new Error("Google Auth not initialized."));return}_s=r=>{r.error?e(new Error(r.error_description||r.error)):(Qu(r.access_token,r.expires_in),t({access_token:r.access_token,expires_in:r.expires_in}))},ws.requestAccessToken({prompt:""})})}function im(){return new Promise((t,e)=>{var i,o;if((o=(i=window.google)==null?void 0:i.accounts)!=null&&o.oauth2){t();return}const r=document.querySelector(`script[src="${fc}"]`);if(r){r.addEventListener("load",()=>t()),r.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=fc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function pc(t){await im(),ws=google.accounts.oauth2.initTokenClient({client_id:t,scope:nm,callback:e=>{_s&&(_s(e),_s=null)}})}function om(){return new Promise((t,e)=>{if(!ws){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}_s=r=>{r.error?e(new Error(r.error_description||r.error)):(Qu(r.access_token,r.expires_in),t({access_token:r.access_token,expires_in:r.expires_in}))},ws.requestAccessToken()})}function lm(t){return Po(),new Promise(e=>{var r,a;(a=(r=window.google)==null?void 0:r.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}const Vt="gmail",hc=8,Xu=50,Zu=100;async function cm(t,{limit:e=Xu,onProgress:r=()=>{},signal:a}={}){var u;const i=await Ue.syncState.get(Vt);if(i!=null&&i.historyId)try{return await pm(t,i,r,a)}catch(d){if(d instanceof $o&&(d.status===404||d.code==="notFound")||((u=d.message)==null?void 0:u.includes("Start history id")))r({phase:"info",message:"History expired, performing full re-sync..."}),await Ue.syncState.delete(Vt);else throw d}return await fm(t,e===0?1/0:e,r,a)}async function um(t,{limit:e=Xu,onProgress:r=()=>{},signal:a}={}){const i=await Ue.syncState.get(Vt);return i!=null&&i.oldestPageToken?await vm(t,i,e===0?1/0:e,r,a):(r({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function dm(){const t=await Ue.syncState.get(Vt);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Ju(){await Ue.transaction("rw",[Ue.items,Ue.syncState],async()=>{await Ue.items.where("sourceType").equals(Vt).delete(),await Ue.syncState.delete(Vt)})}async function fm(t,e,r,a){r({phase:"counting",message:"Getting mailbox info..."}),ya(a);const i=await Nu(t);r({phase:"listing",message:"Listing messages...",current:0,total:Math.min(i.messagesTotal||e,e)});const o=[];let u,d=null;for(;o.length<e;){ya(a);const b=e-o.length,k=await qu(t,{maxResults:Math.min(Zu,b),pageToken:u}),x=(k.messages||[]).map(A=>A.id);if(o.push(...x),r({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(i.messagesTotal||e,e)}),u=k.nextPageToken,!u||x.length===0)break}if(d=u||null,o.length===0)return await Ue.syncState.put({sourceType:Vt,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:h,errors:p}=await $u(t,o,r,a),_=await Ue.items.where("sourceType").equals(Vt).count();return await Ue.syncState.put({sourceType:Vt,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:_,oldestPageToken:d}),r({phase:"done",message:`Synced ${h} messages`,current:h,total:h}),{added:h,deleted:0,errors:p}}async function vm(t,e,r,a,i){a({phase:"listing",message:"Loading more messages...",current:0}),ya(i);const o=[];let u=e.oldestPageToken,d=null;for(;o.length<r;){ya(i);const b=r-o.length,k=await qu(t,{maxResults:Math.min(Zu,b),pageToken:u}),x=(k.messages||[]).map(A=>A.id);if(o.push(...x),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),u=k.nextPageToken,!u||x.length===0)break}if(d=u||null,o.length===0)return await Ue.syncState.update(Vt,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:h,errors:p}=await $u(t,o,a,i),_=await Ue.items.where("sourceType").equals(Vt).count();return await Ue.syncState.update(Vt,{totalItems:_,lastSyncAt:Date.now(),oldestPageToken:d}),a({phase:"done",message:d?`Downloaded ${h} more (more available)`:`Downloaded ${h} more (all synced)`,current:_,total:_}),{added:h,errors:p}}async function pm(t,e,r,a){r({phase:"syncing",message:"Checking for changes..."}),ya(a);let i=0,o=0,u=0,d,h=e.historyId;do{ya(a);const _=await jv(t,{startHistoryId:e.historyId,pageToken:d});if(h=_.historyId||h,d=_.nextPageToken,!!_.history){for(const b of _.history){if(b.messagesAdded){const k=b.messagesAdded.map(A=>A.message.id),x=[...new Set(k.filter(A=>A))];if(x.length>0){const A=await Promise.allSettled(x.map(E=>Bu(t,E))),N=[];for(const E of A)E.status==="fulfilled"?N.push(ed(E.value)):u++;N.length>0&&(await Ue.items.bulkPut(N),await td(N),i+=N.length)}}if(b.messagesDeleted){const k=b.messagesDeleted.map(x=>Lu(Vt,x.message.id)).filter(x=>x);k.length>0&&(await Ue.items.bulkDelete(k),o+=k.length)}}r({phase:"syncing",message:`Changes: +${i} -${o}`,current:i+o})}}while(d);const p=await Ue.items.where("sourceType").equals(Vt).count();return await Ue.syncState.put({sourceType:Vt,historyId:h,lastSyncAt:Date.now(),totalItems:p,oldestPageToken:e.oldestPageToken}),r({phase:"done",message:i===0&&o===0?"Already up to date":`Synced: +${i} -${o}`,current:p,total:p}),{added:i,deleted:o,errors:u}}async function $u(t,e,r,a){r({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let i=0,o=0;for(let u=0;u<e.length;u+=hc){ya(a);const d=e.slice(u,u+hc),h=await Promise.allSettled(d.map(_=>Bu(t,_))),p=[];for(const _ of h)_.status==="fulfilled"?p.push(ed(_.value)):o++;p.length>0&&(await Ue.items.bulkPut(p),await td(p)),i+=p.length,r({phase:"downloading",message:`Downloaded ${i} of ${e.length} messages`,current:i,total:e.length})}return{added:i,errors:o}}function ed(t){const e=Lr(t,"From"),r=Lr(t,"To"),a=Lr(t,"Cc"),i=Lr(t,"Subject")||"(no subject)",o=Lr(t,"Date"),u=Lr(t,"Message-ID"),d=Lr(t,"In-Reply-To"),h=Lr(t,"References");let p;try{p=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{p=Date.now()}return{id:Lu(Vt,t.id),sourceType:Vt,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:r,cc:a,subject:i,snippet:t.snippet||"",body:Nv(t),htmlBody:qv(t),date:p,labels:t.labelIds||[],messageId:u,inReplyTo:d,references:h,raw:t,syncedAt:Date.now()}}async function td(t){const e=new Map;for(const r of t)for(const a of[r.from,r.to,r.cc]){if(!a)continue;const i=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of i){const u=hm(o);u&&!e.has(u.email)&&e.set(u.email,{...u,date:r.date})}}for(const[r,{name:a,date:i}]of e)try{const o=await Ue.contacts.where("email").equals(r).first();if(o){const u={};a&&!o.name&&(u.name=a),i>(o.lastSeen||0)&&(u.lastSeen=i),Object.keys(u).length>0&&await Ue.contacts.update(o.id,u)}else await Ue.contacts.add({email:r,name:a||"",firstSeen:i,lastSeen:i})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",r,(o==null?void 0:o.message)||o)}}function hm(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),i=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:i}}const r=t.toLowerCase().trim();return r.includes("@")?{email:r,name:""}:null}function ya(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var mm=O(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">To access Gmail from the browser, you need a Google Cloud OAuth Client ID.
      This stays in your browser â no data is sent to any server.</p> <div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
            is required because the app is deployed at a subpath. Changes may take a
            few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></div>`);function gm(t,e){ht(e,!0);let r=Oe(e,"clientIdInput",15);Xt(()=>Sn("SetupGuide"));let a=Me(null);async function i(G){try{await navigator.clipboard.writeText(G),C(a,G,!0),setTimeout(()=>{C(a,null)},1500)}catch{const H=document.createElement("input");H.value=G,document.body.appendChild(H),H.select(),document.execCommand("copy"),document.body.removeChild(H),C(a,G,!0),setTimeout(()=>{C(a,null)},1500)}}const o="http://localhost:5173",u="https://cypherkitty.github.io",d="https://cypherkitty.github.io/me-ai/";var h=mm(),p=g(h),_=y(g(p),4),b=y(g(_),6),k=y(g(b),2),x=y(g(k),2),A=y(g(x),2),N=g(A);N.__click=()=>i(o);var E=g(N);E.textContent="http://localhost:5173";var J=y(E,2),he=g(J),$=y(N,2);$.__click=()=>i(u);var R=g($);R.textContent="https://cypherkitty.github.io";var Y=y(R,2),ne=g(Y),F=y(x,2),fe=y(g(F),2),we=g(fe);we.__click=()=>i(o);var Te=g(we);Te.textContent="http://localhost:5173";var ye=y(Te,2),de=g(ye),_e=y(we,2);_e.__click=()=>i(u);var ve=g(_e);ve.textContent="https://cypherkitty.github.io";var ce=y(ve,2),V=g(ce),Q=y(_e,2);Q.__click=()=>i(d);var X=g(Q);X.textContent="https://cypherkitty.github.io/me-ai/";var ue=y(X,2),ie=g(ue),oe=y(_,2),se=g(oe);se.__keydown=G=>G.key==="Enter"&&e.onsave();var re=y(se,2);re.__click=function(...G){var H;(H=e.onsave)==null||H.apply(this,G)},ae(G=>{K(he,v(a)===o?"â":"â§"),K(ne,v(a)===u?"â":"â§"),K(de,v(a)===o?"â":"â§"),K(V,v(a)===u?"â":"â§"),K(ie,v(a)===d?"â":"â§"),re.disabled=G},[()=>!r().trim()]),Si(se,r),T(t,h),mt()}Ct(["click","keydown"]);function _m(t){const e=typeof t=="object"&&t!==null?t:null,r=(e==null?void 0:e.message)||String(t||""),a=e instanceof $o?e.status:null;if(r.includes("has not been used in project")||r.includes("is disabled")){const i=r.match(/project\s+(\d+)/),o=i==null?void 0:i[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||r.includes("Invalid Credentials")||r.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||r.includes("insufficient")&&r.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:r.includes("access_denied")||r.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:r.includes("popup")||r.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||r.includes("Rate Limit")||r.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:r,fix:null}}var ym=O('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),bm=O('<div class="error-card-title svelte-14buhqq"> </div>'),wm=O('<p class="error-card-fix svelte-14buhqq"> </p>'),km=O('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),xm=O('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),Sm=O('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function nd(t,e){ht(e,!0);let r=Oe(e,"ondismiss",3,null),a=Oe(e,"onsignout",3,null),i=dt(()=>_m(e.error));Xt(()=>Sn("ErrorCard"));var o=Sm(),u=g(o);{var d=J=>{var he=ym(),$=g(he),R=g($),Y=y($,2);Y.__click=function(...ne){var F;(F=r())==null||F.apply(this,ne)},ae(()=>K(R,v(i).title)),T(J,he)},h=J=>{var he=bm(),$=g(he);ae(()=>K($,v(i).title)),T(J,he)};le(u,J=>{r()?J(d):J(h,!1)})}var p=y(u,2),_=g(p),b=y(p,2);{var k=J=>{var he=wm(),$=g(he);ae(()=>K($,v(i).fix)),T(J,he)};le(b,J=>{v(i).fix&&J(k)})}var x=y(b,2);{var A=J=>{var he=km(),$=g(he);ae(()=>{Iu(he,"href",v(i).link.url),K($,`${v(i).link.label??""} â`)}),T(J,he)};le(x,J=>{v(i).link&&J(A)})}var N=y(x,2);{var E=J=>{var he=xm();he.__click=function(...$){var R;(R=a())==null||R.apply(this,$)},T(J,he)};le(N,J=>{v(i).action==="signout"&&a()&&J(E)})}ae(()=>K(_,v(i).description)),T(t,o),mt()}Ct(["click"]);var Tm=O('<span class="spinner svelte-nyqevv"></span> Signing in...',1),Em=Xo('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),Am=O(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <span class="client-id-value svelte-nyqevv"> </span> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function Cm(t,e){ht(e,!0);let r=Oe(e,"error",3,null),a=Oe(e,"loadingAuth",3,!1);Xt(()=>Sn("AuthCard"));var i=Am(),o=g(i),u=y(g(o),4);{var d=E=>{nd(E,{get error(){return r()},get onsignout(){return e.onsignout}})};le(u,E=>{r()&&E(d)})}var h=y(u,2);h.__click=function(...E){var J;(J=e.onsignin)==null||J.apply(this,E)};var p=g(h);{var _=E=>{var J=Tm();T(E,J)},b=E=>{var J=Em();T(E,J)};le(p,E=>{a()?E(_):E(b,!1)})}var k=y(h,4),x=y(g(k),2),A=g(x),N=y(x,2);N.__click=function(...E){var J;(J=e.onclear)==null||J.apply(this,E)},ae(E=>{h.disabled=a(),K(A,`${E??""}...`)},[()=>e.clientId.slice(0,20)]),T(t,i),mt()}Ct(["click"]);var Rm=O('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),Pm=O('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),Im=O('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function Om(t,e){ht(e,!0);let r=Oe(e,"profile",3,null),a=Oe(e,"loadingProfile",3,!1);Xt(()=>Sn("ProfileCard"));var i=Im(),o=g(i),u=g(o),d=y(o,2),h=g(d);{var p=k=>{var x=Rm();T(k,x)},_=k=>{var x=Pm(),A=He(x),N=g(A),E=y(A,2),J=g(E);ae((he,$)=>{K(N,r().emailAddress),K(J,`${he??""} messages
        Â· ${$??""} threads`)},[()=>{var he;return((he=r().messagesTotal)==null?void 0:he.toLocaleString())||"?"},()=>{var he;return((he=r().threadsTotal)==null?void 0:he.toLocaleString())||"?"}]),T(k,x)};le(h,k=>{a()?k(p):r()&&k(_,1)})}var b=y(d,2);b.__click=function(...k){var x;(x=e.onsignout)==null||x.apply(this,k)},ae(k=>K(u,k),[()=>r()?Fu(r().emailAddress):"?"]),T(t,i),mt()}Ct(["click"]);var Mm=O('<span class="spinner svelte-1ds3j4k"></span>'),Dm=Xo('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),Lm=O('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),jm=O('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),Nm=O('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),qm=O('<option class="svelte-1ds3j4k"> </option>'),Bm=O('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),zm=O('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),Fm=O('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Km=O('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),Um=O('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),Gm=O('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function Wm(t,e){ht(e,!0),Xt(()=>Sn("SyncStatus"));let r=Oe(e,"syncStatus",3,null),a=Oe(e,"syncProgress",3,null),i=Oe(e,"isSyncing",3,!1),o=Me(!1),u=Me(50);const d=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function h(X){if(!X)return"never";const ue=Math.floor((Date.now()-X)/1e3);if(ue<60)return"just now";const ie=Math.floor(ue/60);if(ie<60)return`${ie}m ago`;const oe=Math.floor(ie/60);return oe<24?`${oe}h ago`:`${Math.floor(oe/24)}d ago`}function p(){var X,ue;return!((X=a())!=null&&X.total)||!((ue=a())!=null&&ue.current)?0:Math.round(a().current/a().total*100)}var _=Gm(),b=g(_),k=g(b),x=g(k);{var A=X=>{var ue=Mm();T(X,ue)},N=X=>{var ue=Dm();T(X,ue)};le(x,X=>{i()?X(A):X(N,!1)})}var E=y(k,2),J=y(g(E),2);{var he=X=>{var ue=Lm(),ie=g(ue),oe=y(ie);{var se=G=>{var H=Tr("Â· more available");T(G,H)},re=G=>{var H=Tr("Â· all synced");T(G,H)};le(oe,G=>{r().hasMore?G(se):G(re,!1)})}ae((G,H)=>K(ie,`${G??""} emails stored
          Â· synced ${H??""} `),[()=>r().totalItems.toLocaleString(),()=>h(r().lastSyncAt)]),T(X,ue)},$=X=>{var ue=jm();T(X,ue)};le(J,X=>{var ue;(ue=r())!=null&&ue.synced?X(he):X($,!1)})}var R=y(E,2),Y=g(R);{var ne=X=>{var ue=Nm();ue.__click=()=>C(o,!v(o)),T(X,ue)};le(Y,X=>{var ue;(ue=r())!=null&&ue.synced&&!i()&&X(ne)})}var F=y(b,2),fe=g(F),we=y(g(fe),2);St(we,21,()=>d,Ft,(X,ue)=>{var ie=qm(),oe=g(ie),se={};ae(()=>{K(oe,v(ue).label),se!==(se=v(ue).value)&&(ie.value=(ie.__value=v(ue).value)??"")}),T(X,ie)});var Te=y(fe,2),ye=g(Te);{var de=X=>{var ue=zm(),ie=He(ue);ie.__click=()=>e.onsync(v(u));var oe=g(ie),se=y(ie,2);{var re=G=>{var H=Bm();H.__click=()=>e.onsyncmore(v(u));var ee=g(H);ae(()=>{H.disabled=i(),K(ee,i()?"Loading...":"Sync More")}),T(G,H)};le(se,G=>{r().hasMore&&G(re)})}ae(()=>{ie.disabled=i(),K(oe,i()?"Syncing...":"Sync New")}),T(X,ue)},_e=X=>{var ue=Fm();ue.__click=()=>e.onsync(v(u));var ie=g(ue);ae(()=>{ue.disabled=i(),K(ie,i()?"Syncing...":"Download Emails")}),T(X,ue)};le(ye,X=>{var ue;(ue=r())!=null&&ue.synced?X(de):X(_e,!1)})}var ve=y(F,2);{var ce=X=>{var ue=Km(),ie=g(ue),oe=g(ie);let se,re;var G=y(ie,2),H=g(G);ae(ee=>{se=Tt(oe,1,"progress-fill svelte-1ds3j4k",null,se,{indeterminate:!a().total}),re=hn(oe,"",re,ee),K(H,a().message||"Syncing...")},[()=>({width:`${p()??""}%`})]),T(X,ue)};le(ve,X=>{i()&&a()&&X(ce)})}var V=y(ve,2);{var Q=X=>{var ue=Um(),ie=y(g(ue),2),oe=g(ie);oe.__click=()=>C(o,!1);var se=y(oe,2);se.__click=()=>{e.onclear(),C(o,!1)},T(X,ue)};le(V,X=>{v(o)&&X(Q)})}ae(()=>we.disabled=i()),xi(we,()=>v(u),X=>C(u,X)),T(t,_),mt()}Ct(["click"]);var Hm=O('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Vm=O('<div class="message-list svelte-y2uamw"></div>');function Ym(t,e){ht(e,!0);let r=Oe(e,"messages",19,()=>[]);Xt(()=>Sn("MessageList"));var a=Vm();St(a,21,r,Ft,(i,o)=>{var u=Hm();u.__click=()=>e.onselect(v(o));var d=g(u),h=g(d),p=y(d,2),_=g(p),b=g(_),k=g(b),x=y(b,2),A=g(x),N=y(_,2),E=g(N),J=y(N,2),he=g(J);ae(($,R,Y)=>{K(h,$),K(k,R),K(A,Y),K(E,v(o).subject),K(he,v(o).snippet)},[()=>Fu(v(o).from),()=>zu(v(o).from),()=>el(v(o).date)]),T(i,u)}),T(t,a),mt()}Ct(["click"]);function al(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var ka=al();function rd(t){ka=t}var ra={exec:()=>null};function it(t,e=""){let r=typeof t=="string"?t:t.source,a={replace:(i,o)=>{let u=typeof o=="string"?o:o.source;return u=u.replace(an.caret,"$1"),r=r.replace(i,u),a},getRegex:()=>new RegExp(r,e)};return a}var Qm=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),an={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},Xm=/^(?:[ \t]*(?:\n|$))+/,Zm=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Jm=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Is=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,$m=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,sl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,ad=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,sd=it(ad).replace(/bull/g,sl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),eg=it(ad).replace(/bull/g,sl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),il=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,tg=/^[^\n]+/,ol=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,ng=it(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ol).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),rg=it(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,sl).getRegex(),Ei="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",ll=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ag=it("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",ll).replace("tag",Ei).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),id=it(il).replace("hr",Is).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ei).getRegex(),sg=it(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",id).getRegex(),cl={blockquote:sg,code:Zm,def:ng,fences:Jm,heading:$m,hr:Is,html:ag,lheading:sd,list:rg,newline:Xm,paragraph:id,table:ra,text:tg},mc=it("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Is).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ei).getRegex(),ig={...cl,lheading:eg,table:mc,paragraph:it(il).replace("hr",Is).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",mc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ei).getRegex()},og={...cl,html:it(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",ll).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ra,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:it(il).replace("hr",Is).replace("heading",` *#{1,6} *[^
]`).replace("lheading",sd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},lg=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,cg=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,od=/^( {2,}|\\)\n(?!\s*$)/,ug=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ai=/[\p{P}\p{S}]/u,ul=/[\s\p{P}\p{S}]/u,ld=/[^\s\p{P}\p{S}]/u,dg=it(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ul).getRegex(),cd=/(?!~)[\p{P}\p{S}]/u,fg=/(?!~)[\s\p{P}\p{S}]/u,vg=/(?:[^\s\p{P}\p{S}]|~)/u,ud=/(?![*_])[\p{P}\p{S}]/u,pg=/(?![*_])[\s\p{P}\p{S}]/u,hg=/(?:[^\s\p{P}\p{S}]|[*_])/u,mg=it(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Qm?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),dd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,gg=it(dd,"u").replace(/punct/g,Ai).getRegex(),_g=it(dd,"u").replace(/punct/g,cd).getRegex(),fd="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",yg=it(fd,"gu").replace(/notPunctSpace/g,ld).replace(/punctSpace/g,ul).replace(/punct/g,Ai).getRegex(),bg=it(fd,"gu").replace(/notPunctSpace/g,vg).replace(/punctSpace/g,fg).replace(/punct/g,cd).getRegex(),wg=it("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ld).replace(/punctSpace/g,ul).replace(/punct/g,Ai).getRegex(),kg=it(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,ud).getRegex(),xg="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",Sg=it(xg,"gu").replace(/notPunctSpace/g,hg).replace(/punctSpace/g,pg).replace(/punct/g,ud).getRegex(),Tg=it(/\\(punct)/,"gu").replace(/punct/g,Ai).getRegex(),Eg=it(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ag=it(ll).replace("(?:-->|$)","-->").getRegex(),Cg=it("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ag).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),pi=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Rg=it(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",pi).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),vd=it(/^!?\[(label)\]\[(ref)\]/).replace("label",pi).replace("ref",ol).getRegex(),pd=it(/^!?\[(ref)\](?:\[\])?/).replace("ref",ol).getRegex(),Pg=it("reflink|nolink(?!\\()","g").replace("reflink",vd).replace("nolink",pd).getRegex(),gc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,dl={_backpedal:ra,anyPunctuation:Tg,autolink:Eg,blockSkip:mg,br:od,code:cg,del:ra,delLDelim:ra,delRDelim:ra,emStrongLDelim:gg,emStrongRDelimAst:yg,emStrongRDelimUnd:wg,escape:lg,link:Rg,nolink:pd,punctuation:dg,reflink:vd,reflinkSearch:Pg,tag:Cg,text:ug,url:ra},Ig={...dl,link:it(/^!?\[(label)\]\((.*?)\)/).replace("label",pi).getRegex(),reflink:it(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",pi).getRegex()},Io={...dl,emStrongRDelimAst:bg,emStrongLDelim:_g,delLDelim:kg,delRDelim:Sg,url:it(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",gc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:it(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",gc).getRegex()},Og={...Io,br:it(od).replace("{2,}","*").getRegex(),text:it(Io.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ti={normal:cl,gfm:ig,pedantic:og},as={normal:dl,gfm:Io,breaks:Og,pedantic:Ig},Mg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_c=t=>Mg[t];function gr(t,e){if(e){if(an.escapeTest.test(t))return t.replace(an.escapeReplace,_c)}else if(an.escapeTestNoEncode.test(t))return t.replace(an.escapeReplaceNoEncode,_c);return t}function yc(t){try{t=encodeURI(t).replace(an.percentDecode,"%")}catch{return null}return t}function bc(t,e){var o;let r=t.replace(an.findPipe,(u,d,h)=>{let p=!1,_=d;for(;--_>=0&&h[_]==="\\";)p=!p;return p?"|":" |"}),a=r.split(an.splitPipe),i=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;i<a.length;i++)a[i]=a[i].trim().replace(an.slashPipe,"|");return a}function ss(t,e,r){let a=t.length;if(a===0)return"";let i=0;for(;i<a&&t.charAt(a-i-1)===e;)i++;return t.slice(0,a-i)}function Dg(t,e){if(t.indexOf(e[1])===-1)return-1;let r=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])r++;else if(t[a]===e[1]&&(r--,r<0))return a;return r>0?-2:-1}function Lg(t,e=0){let r=e,a="";for(let i of t)if(i==="	"){let o=4-r%4;a+=" ".repeat(o),r+=o}else a+=i,r++;return a}function wc(t,e,r,a,i){let o=e.href,u=e.title||null,d=t[1].replace(i.other.outputLinkReplace,"$1");a.state.inLink=!0;let h={type:t[0].charAt(0)==="!"?"image":"link",raw:r,href:o,title:u,text:d,tokens:a.inlineTokens(d)};return a.state.inLink=!1,h}function jg(t,e,r){let a=t.match(r.other.indentCodeCompensation);if(a===null)return e;let i=a[1];return e.split(`
`).map(o=>{let u=o.match(r.other.beginningSpace);if(u===null)return o;let[d]=u;return d.length>=i.length?o.slice(i.length):o}).join(`
`)}var hi=class{constructor(t){et(this,"options");et(this,"rules");et(this,"lexer");this.options=t||ka}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let r=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?r:ss(r,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let r=e[0],a=jg(r,e[3]||"",this.rules);return{type:"code",raw:r,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let r=e[2].trim();if(this.rules.other.endingHash.test(r)){let a=ss(r,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(r=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ss(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let r=ss(e[0],`
`).split(`
`),a="",i="",o=[];for(;r.length>0;){let u=!1,d=[],h;for(h=0;h<r.length;h++)if(this.rules.other.blockquoteStart.test(r[h]))d.push(r[h]),u=!0;else if(!u)d.push(r[h]);else break;r=r.slice(h);let p=d.join(`
`),_=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${p}`:p,i=i?`${i}
${_}`:_;let b=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(_,o,!0),this.lexer.state.top=b,r.length===0)break;let k=o.at(-1);if((k==null?void 0:k.type)==="code")break;if((k==null?void 0:k.type)==="blockquote"){let x=k,A=x.raw+`
`+r.join(`
`),N=this.blockquote(A);o[o.length-1]=N,a=a.substring(0,a.length-x.raw.length)+N.raw,i=i.substring(0,i.length-x.text.length)+N.text;break}else if((k==null?void 0:k.type)==="list"){let x=k,A=x.raw+`
`+r.join(`
`),N=this.list(A);o[o.length-1]=N,a=a.substring(0,a.length-k.raw.length)+N.raw,i=i.substring(0,i.length-x.raw.length)+N.raw,r=A.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:i}}}list(t){var r,a;let e=this.rules.block.list.exec(t);if(e){let i=e[1].trim(),o=i.length>1,u={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");let d=this.rules.other.listItemRegex(i),h=!1;for(;t;){let _=!1,b="",k="";if(!(e=d.exec(t))||this.rules.block.hr.test(t))break;b=e[0],t=t.substring(b.length);let x=Lg(e[2].split(`
`,1)[0],e[1].length),A=t.split(`
`,1)[0],N=!x.trim(),E=0;if(this.options.pedantic?(E=2,k=x.trimStart()):N?E=e[1].length+1:(E=x.search(this.rules.other.nonSpaceChar),E=E>4?1:E,k=x.slice(E),E+=e[1].length),N&&this.rules.other.blankLine.test(A)&&(b+=A+`
`,t=t.substring(A.length+1),_=!0),!_){let J=this.rules.other.nextBulletRegex(E),he=this.rules.other.hrRegex(E),$=this.rules.other.fencesBeginRegex(E),R=this.rules.other.headingBeginRegex(E),Y=this.rules.other.htmlBeginRegex(E),ne=this.rules.other.blockquoteBeginRegex(E);for(;t;){let F=t.split(`
`,1)[0],fe;if(A=F,this.options.pedantic?(A=A.replace(this.rules.other.listReplaceNesting,"  "),fe=A):fe=A.replace(this.rules.other.tabCharGlobal,"    "),$.test(A)||R.test(A)||Y.test(A)||ne.test(A)||J.test(A)||he.test(A))break;if(fe.search(this.rules.other.nonSpaceChar)>=E||!A.trim())k+=`
`+fe.slice(E);else{if(N||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||$.test(x)||R.test(x)||he.test(x))break;k+=`
`+A}N=!A.trim(),b+=F+`
`,t=t.substring(F.length+1),x=fe.slice(E)}}u.loose||(h?u.loose=!0:this.rules.other.doubleBlankLine.test(b)&&(h=!0)),u.items.push({type:"list_item",raw:b,task:!!this.options.gfm&&this.rules.other.listIsTask.test(k),loose:!1,text:k,tokens:[]}),u.raw+=b}let p=u.items.at(-1);if(p)p.raw=p.raw.trimEnd(),p.text=p.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let _ of u.items){if(this.lexer.state.top=!1,_.tokens=this.lexer.blockTokens(_.text,[]),_.task){if(_.text=_.text.replace(this.rules.other.listReplaceTask,""),((r=_.tokens[0])==null?void 0:r.type)==="text"||((a=_.tokens[0])==null?void 0:a.type)==="paragraph"){_.tokens[0].raw=_.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),_.tokens[0].text=_.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let k=this.lexer.inlineQueue.length-1;k>=0;k--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[k].src)){this.lexer.inlineQueue[k].src=this.lexer.inlineQueue[k].src.replace(this.rules.other.listReplaceTask,"");break}}let b=this.rules.other.listTaskCheckbox.exec(_.raw);if(b){let k={type:"checkbox",raw:b[0]+" ",checked:b[0]!=="[ ]"};_.checked=k.checked,u.loose?_.tokens[0]&&["paragraph","text"].includes(_.tokens[0].type)&&"tokens"in _.tokens[0]&&_.tokens[0].tokens?(_.tokens[0].raw=k.raw+_.tokens[0].raw,_.tokens[0].text=k.raw+_.tokens[0].text,_.tokens[0].tokens.unshift(k)):_.tokens.unshift({type:"paragraph",raw:k.raw,text:k.raw,tokens:[k]}):_.tokens.unshift(k)}}if(!u.loose){let b=_.tokens.filter(x=>x.type==="space"),k=b.length>0&&b.some(x=>this.rules.other.anyLine.test(x.raw));u.loose=k}}if(u.loose)for(let _ of u.items){_.loose=!0;for(let b of _.tokens)b.type==="text"&&(b.type="paragraph")}return u}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let r=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:r,raw:e[0],href:a,title:i}}}table(t){var u;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let r=bc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(r.length===a.length){for(let d of a)this.rules.other.tableAlignRight.test(d)?o.align.push("right"):this.rules.other.tableAlignCenter.test(d)?o.align.push("center"):this.rules.other.tableAlignLeft.test(d)?o.align.push("left"):o.align.push(null);for(let d=0;d<r.length;d++)o.header.push({text:r[d],tokens:this.lexer.inline(r[d]),header:!0,align:o.align[d]});for(let d of i)o.rows.push(bc(d,o.header.length).map((h,p)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:o.align[p]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let r=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:r,tokens:this.lexer.inline(r)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let r=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let o=ss(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=Dg(e[2],"()");if(o===-2)return;if(o>-1){let u=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?a=a.slice(1):a=a.slice(1,-1)),wc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){let a=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[a.toLowerCase()];if(!i){let o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return wc(r,i,r[0],this.lexer,this.rules)}}emStrong(t,e,r=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!r||this.rules.inline.punctuation.exec(r))){let i=[...a[0]].length-1,o,u,d=i,h=0,p=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+i);(a=p.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(u=[...o].length,a[3]||a[4]){d+=u;continue}else if((a[5]||a[6])&&i%3&&!((i+u)%3)){h+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d+h);let _=[...a[0]][0].length,b=t.slice(0,i+a.index+_+u);if(Math.min(i,u)%2){let x=b.slice(1,-1);return{type:"em",raw:b,text:x,tokens:this.lexer.inlineTokens(x)}}let k=b.slice(2,-2);return{type:"strong",raw:b,text:k,tokens:this.lexer.inlineTokens(k)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let r=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(r),i=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return a&&i&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:e[0],text:r}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,r=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!r||this.rules.inline.punctuation.exec(r))){let i=[...a[0]].length-1,o,u,d=i,h=this.rules.inline.delRDelim;for(h.lastIndex=0,e=e.slice(-1*t.length+i);(a=h.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(u=[...o].length,u!==i))continue;if(a[3]||a[4]){d+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d);let p=[...a[0]][0].length,_=t.slice(0,i+a.index+p+u),b=_.slice(i,-i);return{type:"del",raw:_,text:b,tokens:this.lexer.inlineTokens(b)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let r,a;return e[2]==="@"?(r=e[1],a="mailto:"+r):(r=e[1],a=r),{type:"link",raw:e[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}url(t){var r;let e;if(e=this.rules.inline.url.exec(t)){let a,i;if(e[2]==="@")a=e[0],i="mailto:"+a;else{let o;do o=e[0],e[0]=((r=this.rules.inline._backpedal.exec(e[0]))==null?void 0:r[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:a,href:i,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let r=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:r}}}},Hn=class Oo{constructor(e){et(this,"tokens");et(this,"options");et(this,"state");et(this,"inlineQueue");et(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ka,this.options.tokenizer=this.options.tokenizer||new hi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:an,block:ti.normal,inline:as.normal};this.options.pedantic?(r.block=ti.pedantic,r.inline=as.pedantic):this.options.gfm&&(r.block=ti.gfm,this.options.breaks?r.inline=as.breaks:r.inline=as.gfm),this.tokenizer.rules=r}static get rules(){return{block:ti,inline:as}}static lex(e,r){return new Oo(r).lex(e)}static lexInline(e,r){return new Oo(r).inlineTokens(e)}lex(e){e=e.replace(an.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let a=this.inlineQueue[r];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,r=[],a=!1){var i,o,u;for(this.options.pedantic&&(e=e.replace(an.tabCharGlobal,"    ").replace(an.spaceLine,""));e;){let d;if((o=(i=this.options.extensions)==null?void 0:i.block)!=null&&o.some(p=>(d=p.call({lexer:this},e,r))?(e=e.substring(d.raw.length),r.push(d),!0):!1))continue;if(d=this.tokenizer.space(e)){e=e.substring(d.raw.length);let p=r.at(-1);d.raw.length===1&&p!==void 0?p.raw+=`
`:r.push(d);continue}if(d=this.tokenizer.code(e)){e=e.substring(d.raw.length);let p=r.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.at(-1).src=p.text):r.push(d);continue}if(d=this.tokenizer.fences(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.heading(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.hr(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.blockquote(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.list(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.html(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.def(e)){e=e.substring(d.raw.length);let p=r.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.raw,this.inlineQueue.at(-1).src=p.text):this.tokens.links[d.tag]||(this.tokens.links[d.tag]={href:d.href,title:d.title},r.push(d));continue}if(d=this.tokenizer.table(e)){e=e.substring(d.raw.length),r.push(d);continue}if(d=this.tokenizer.lheading(e)){e=e.substring(d.raw.length),r.push(d);continue}let h=e;if((u=this.options.extensions)!=null&&u.startBlock){let p=1/0,_=e.slice(1),b;this.options.extensions.startBlock.forEach(k=>{b=k.call({lexer:this},_),typeof b=="number"&&b>=0&&(p=Math.min(p,b))}),p<1/0&&p>=0&&(h=e.substring(0,p+1))}if(this.state.top&&(d=this.tokenizer.paragraph(h))){let p=r.at(-1);a&&(p==null?void 0:p.type)==="paragraph"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):r.push(d),a=h.length!==e.length,e=e.substring(d.raw.length);continue}if(d=this.tokenizer.text(e)){e=e.substring(d.raw.length);let p=r.at(-1);(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):r.push(d);continue}if(e){let p="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return this.state.top=!0,r}inline(e,r=[]){return this.inlineQueue.push({src:e,tokens:r}),r}inlineTokens(e,r=[]){var h,p,_,b,k;let a=e,i=null;if(this.tokens.links){let x=Object.keys(this.tokens.links);if(x.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)x.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,i.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=i[2]?i[2].length:0,a=a.slice(0,i.index+o)+"["+"a".repeat(i[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((p=(h=this.options.hooks)==null?void 0:h.emStrongMask)==null?void 0:p.call({lexer:this},a))??a;let u=!1,d="";for(;e;){u||(d=""),u=!1;let x;if((b=(_=this.options.extensions)==null?void 0:_.inline)!=null&&b.some(N=>(x=N.call({lexer:this},e,r))?(e=e.substring(x.raw.length),r.push(x),!0):!1))continue;if(x=this.tokenizer.escape(e)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.tag(e)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.link(e)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(x.raw.length);let N=r.at(-1);x.type==="text"&&(N==null?void 0:N.type)==="text"?(N.raw+=x.raw,N.text+=x.text):r.push(x);continue}if(x=this.tokenizer.emStrong(e,a,d)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.codespan(e)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.br(e)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.del(e,a,d)){e=e.substring(x.raw.length),r.push(x);continue}if(x=this.tokenizer.autolink(e)){e=e.substring(x.raw.length),r.push(x);continue}if(!this.state.inLink&&(x=this.tokenizer.url(e))){e=e.substring(x.raw.length),r.push(x);continue}let A=e;if((k=this.options.extensions)!=null&&k.startInline){let N=1/0,E=e.slice(1),J;this.options.extensions.startInline.forEach(he=>{J=he.call({lexer:this},E),typeof J=="number"&&J>=0&&(N=Math.min(N,J))}),N<1/0&&N>=0&&(A=e.substring(0,N+1))}if(x=this.tokenizer.inlineText(A)){e=e.substring(x.raw.length),x.raw.slice(-1)!=="_"&&(d=x.raw.slice(-1)),u=!0;let N=r.at(-1);(N==null?void 0:N.type)==="text"?(N.raw+=x.raw,N.text+=x.text):r.push(x);continue}if(e){let N="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(N);break}else throw new Error(N)}}return r}},mi=class{constructor(t){et(this,"options");et(this,"parser");this.options=t||ka}space(t){return""}code({text:t,lang:e,escaped:r}){var o;let a=(o=(e||"").match(an.notSpaceStart))==null?void 0:o[0],i=t.replace(an.endingNewline,"")+`
`;return a?'<pre><code class="language-'+gr(a)+'">'+(r?i:gr(i,!0))+`</code></pre>
`:"<pre><code>"+(r?i:gr(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,r=t.start,a="";for(let u=0;u<t.items.length;u++){let d=t.items[u];a+=this.listitem(d)}let i=e?"ol":"ul",o=e&&r!==1?' start="'+r+'"':"";return"<"+i+o+`>
`+a+"</"+i+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",r="";for(let i=0;i<t.header.length;i++)r+=this.tablecell(t.header[i]);e+=this.tablerow({text:r});let a="";for(let i=0;i<t.rows.length;i++){let o=t.rows[i];r="";for(let u=0;u<o.length;u++)r+=this.tablecell(o[u]);a+=this.tablerow({text:r})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${gr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:r}){let a=this.parser.parseInline(r),i=yc(t);if(i===null)return a;t=i;let o='<a href="'+t+'"';return e&&(o+=' title="'+gr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:r,tokens:a}){a&&(r=this.parser.parseInline(a,this.parser.textRenderer));let i=yc(t);if(i===null)return gr(r);t=i;let o=`<img src="${t}" alt="${r}"`;return e&&(o+=` title="${gr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:gr(t.text)}},fl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Vn=class Mo{constructor(e){et(this,"options");et(this,"renderer");et(this,"textRenderer");this.options=e||ka,this.options.renderer=this.options.renderer||new mi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new fl}static parse(e,r){return new Mo(r).parse(e)}static parseInline(e,r){return new Mo(r).parseInline(e)}parse(e){var a,i;let r="";for(let o=0;o<e.length;o++){let u=e[o];if((i=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&i[u.type]){let h=u,p=this.options.extensions.renderers[h.type].call({parser:this},h);if(p!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(h.type)){r+=p||"";continue}}let d=u;switch(d.type){case"space":{r+=this.renderer.space(d);break}case"hr":{r+=this.renderer.hr(d);break}case"heading":{r+=this.renderer.heading(d);break}case"code":{r+=this.renderer.code(d);break}case"table":{r+=this.renderer.table(d);break}case"blockquote":{r+=this.renderer.blockquote(d);break}case"list":{r+=this.renderer.list(d);break}case"checkbox":{r+=this.renderer.checkbox(d);break}case"html":{r+=this.renderer.html(d);break}case"def":{r+=this.renderer.def(d);break}case"paragraph":{r+=this.renderer.paragraph(d);break}case"text":{r+=this.renderer.text(d);break}default:{let h='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return r}parseInline(e,r=this.renderer){var i,o;let a="";for(let u=0;u<e.length;u++){let d=e[u];if((o=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&o[d.type]){let p=this.options.extensions.renderers[d.type].call({parser:this},d);if(p!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){a+=p||"";continue}}let h=d;switch(h.type){case"escape":{a+=r.text(h);break}case"html":{a+=r.html(h);break}case"link":{a+=r.link(h);break}case"image":{a+=r.image(h);break}case"checkbox":{a+=r.checkbox(h);break}case"strong":{a+=r.strong(h);break}case"em":{a+=r.em(h);break}case"codespan":{a+=r.codespan(h);break}case"br":{a+=r.br(h);break}case"del":{a+=r.del(h);break}case"text":{a+=r.text(h);break}default:{let p='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(p),"";throw new Error(p)}}}return a}},ai,vs=(ai=class{constructor(t){et(this,"options");et(this,"block");this.options=t||ka}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Hn.lex:Hn.lexInline}provideParser(){return this.block?Vn.parse:Vn.parseInline}},et(ai,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),et(ai,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),ai),Ng=class{constructor(...t){et(this,"defaults",al());et(this,"options",this.setOptions);et(this,"parse",this.parseMarkdown(!0));et(this,"parseInline",this.parseMarkdown(!1));et(this,"Parser",Vn);et(this,"Renderer",mi);et(this,"TextRenderer",fl);et(this,"Lexer",Hn);et(this,"Tokenizer",hi);et(this,"Hooks",vs);this.use(...t)}walkTokens(t,e){var a,i;let r=[];for(let o of t)switch(r=r.concat(e.call(this,o)),o.type){case"table":{let u=o;for(let d of u.header)r=r.concat(this.walkTokens(d.tokens,e));for(let d of u.rows)for(let h of d)r=r.concat(this.walkTokens(h.tokens,e));break}case"list":{let u=o;r=r.concat(this.walkTokens(u.items,e));break}default:{let u=o;(i=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&i[u.type]?this.defaults.extensions.childTokens[u.type].forEach(d=>{let h=u[d].flat(1/0);r=r.concat(this.walkTokens(h,e))}):u.tokens&&(r=r.concat(this.walkTokens(u.tokens,e)))}}return r}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(r=>{let a={...r};if(a.async=this.defaults.async||a.async||!1,r.extensions&&(r.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...u){let d=i.renderer.apply(this,u);return d===!1&&(d=o.apply(this,u)),d}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),a.extensions=e),r.renderer){let i=this.defaults.renderer||new mi(this.defaults);for(let o in r.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let u=o,d=r.renderer[u],h=i[u];i[u]=(...p)=>{let _=d.apply(i,p);return _===!1&&(_=h.apply(i,p)),_||""}}a.renderer=i}if(r.tokenizer){let i=this.defaults.tokenizer||new hi(this.defaults);for(let o in r.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let u=o,d=r.tokenizer[u],h=i[u];i[u]=(...p)=>{let _=d.apply(i,p);return _===!1&&(_=h.apply(i,p)),_}}a.tokenizer=i}if(r.hooks){let i=this.defaults.hooks||new vs;for(let o in r.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let u=o,d=r.hooks[u],h=i[u];vs.passThroughHooks.has(o)?i[u]=p=>{if(this.defaults.async&&vs.passThroughHooksRespectAsync.has(o))return(async()=>{let b=await d.call(i,p);return h.call(i,b)})();let _=d.call(i,p);return h.call(i,_)}:i[u]=(...p)=>{if(this.defaults.async)return(async()=>{let b=await d.apply(i,p);return b===!1&&(b=await h.apply(i,p)),b})();let _=d.apply(i,p);return _===!1&&(_=h.apply(i,p)),_}}a.hooks=i}if(r.walkTokens){let i=this.defaults.walkTokens,o=r.walkTokens;a.walkTokens=function(u){let d=[];return d.push(o.call(this,u)),i&&(d=d.concat(i.call(this,u))),d}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Hn.lex(t,e??this.defaults)}parser(t,e){return Vn.parse(t,e??this.defaults)}parseMarkdown(t){return(e,r)=>{let a={...r},i={...this.defaults,...a},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=t),i.async)return(async()=>{let u=i.hooks?await i.hooks.preprocess(e):e,d=await(i.hooks?await i.hooks.provideLexer():t?Hn.lex:Hn.lexInline)(u,i),h=i.hooks?await i.hooks.processAllTokens(d):d;i.walkTokens&&await Promise.all(this.walkTokens(h,i.walkTokens));let p=await(i.hooks?await i.hooks.provideParser():t?Vn.parse:Vn.parseInline)(h,i);return i.hooks?await i.hooks.postprocess(p):p})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let u=(i.hooks?i.hooks.provideLexer():t?Hn.lex:Hn.lexInline)(e,i);i.hooks&&(u=i.hooks.processAllTokens(u)),i.walkTokens&&this.walkTokens(u,i.walkTokens);let d=(i.hooks?i.hooks.provideParser():t?Vn.parse:Vn.parseInline)(u,i);return i.hooks&&(d=i.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(t,e){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+gr(r.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(r);throw r}}},ba=new Ng;function ft(t,e){return ba.parse(t,e)}ft.options=ft.setOptions=function(t){return ba.setOptions(t),ft.defaults=ba.defaults,rd(ft.defaults),ft};ft.getDefaults=al;ft.defaults=ka;ft.use=function(...t){return ba.use(...t),ft.defaults=ba.defaults,rd(ft.defaults),ft};ft.walkTokens=function(t,e){return ba.walkTokens(t,e)};ft.parseInline=ba.parseInline;ft.Parser=Vn;ft.parser=Vn.parse;ft.Renderer=mi;ft.TextRenderer=fl;ft.Lexer=Hn;ft.lexer=Hn.lex;ft.Tokenizer=hi;ft.Hooks=vs;ft.parse=ft;ft.options;ft.setOptions;ft.use;ft.walkTokens;ft.parseInline;Vn.parse;Hn.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:hd,setPrototypeOf:kc,isFrozen:qg,getPrototypeOf:Bg,getOwnPropertyDescriptor:zg}=Object;let{freeze:sn,seal:jn,create:Do}=Object,{apply:Lo,construct:jo}=typeof Reflect<"u"&&Reflect;sn||(sn=function(e){return e});jn||(jn=function(e){return e});Lo||(Lo=function(e,r){for(var a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];return e.apply(r,i)});jo||(jo=function(e){for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return new e(...a)});const ni=on(Array.prototype.forEach),Fg=on(Array.prototype.lastIndexOf),xc=on(Array.prototype.pop),is=on(Array.prototype.push),Kg=on(Array.prototype.splice),ui=on(String.prototype.toLowerCase),oo=on(String.prototype.toString),lo=on(String.prototype.match),os=on(String.prototype.replace),Ug=on(String.prototype.indexOf),Gg=on(String.prototype.trim),Gn=on(Object.prototype.hasOwnProperty),rn=on(RegExp.prototype.test),ls=Wg(TypeError);function on(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return Lo(t,e,a)}}function Wg(t){return function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return jo(t,r)}}function $e(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ui;kc&&kc(t,null);let a=e.length;for(;a--;){let i=e[a];if(typeof i=="string"){const o=r(i);o!==i&&(qg(e)||(e[a]=o),i=o)}t[i]=!0}return t}function Hg(t){for(let e=0;e<t.length;e++)Gn(t,e)||(t[e]=null);return t}function sr(t){const e=Do(null);for(const[r,a]of hd(t))Gn(t,r)&&(Array.isArray(a)?e[r]=Hg(a):a&&typeof a=="object"&&a.constructor===Object?e[r]=sr(a):e[r]=a);return e}function cs(t,e){for(;t!==null;){const a=zg(t,e);if(a){if(a.get)return on(a.get);if(typeof a.value=="function")return on(a.value)}t=Bg(t)}function r(){return null}return r}const Sc=sn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),co=sn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),uo=sn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Vg=sn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),fo=sn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Yg=sn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tc=sn(["#text"]),Ec=sn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),vo=sn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ac=sn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ri=sn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Qg=jn(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Xg=jn(/<%[\w\W]*|[\w\W]*%>/gm),Zg=jn(/\$\{[\w\W]*/gm),Jg=jn(/^data-[\-\w.\u00B7-\uFFFF]+$/),$g=jn(/^aria-[\-\w]+$/),md=jn(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),e_=jn(/^(?:\w+script|data):/i),t_=jn(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),gd=jn(/^html$/i),n_=jn(/^[a-z][.\w]*(-[.\w]+)+$/i);var Cc=Object.freeze({__proto__:null,ARIA_ATTR:$g,ATTR_WHITESPACE:t_,CUSTOM_ELEMENT:n_,DATA_ATTR:Jg,DOCTYPE_NAME:gd,ERB_EXPR:Xg,IS_ALLOWED_URI:md,IS_SCRIPT_OR_DATA:e_,MUSTACHE_EXPR:Qg,TMPLIT_EXPR:Zg});const us={element:1,text:3,progressingInstruction:7,comment:8,document:9},r_=function(){return typeof window>"u"?null:window},a_=function(e,r){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const i="data-tt-policy-suffix";r&&r.hasAttribute(i)&&(a=r.getAttribute(i));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Rc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function _d(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:r_();const e=Ke=>_d(Ke);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==us.document||!t.Element)return e.isSupported=!1,e;let{document:r}=t;const a=r,i=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:d,Element:h,NodeFilter:p,NamedNodeMap:_=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:b,DOMParser:k,trustedTypes:x}=t,A=h.prototype,N=cs(A,"cloneNode"),E=cs(A,"remove"),J=cs(A,"nextSibling"),he=cs(A,"childNodes"),$=cs(A,"parentNode");if(typeof u=="function"){const Ke=r.createElement("template");Ke.content&&Ke.content.ownerDocument&&(r=Ke.content.ownerDocument)}let R,Y="";const{implementation:ne,createNodeIterator:F,createDocumentFragment:fe,getElementsByTagName:we}=r,{importNode:Te}=a;let ye=Rc();e.isSupported=typeof hd=="function"&&typeof $=="function"&&ne&&ne.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:de,ERB_EXPR:_e,TMPLIT_EXPR:ve,DATA_ATTR:ce,ARIA_ATTR:V,IS_SCRIPT_OR_DATA:Q,ATTR_WHITESPACE:X,CUSTOM_ELEMENT:ue}=Cc;let{IS_ALLOWED_URI:ie}=Cc,oe=null;const se=$e({},[...Sc,...co,...uo,...fo,...Tc]);let re=null;const G=$e({},[...Ec,...vo,...Ac,...ri]);let H=Object.seal(Do(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ee=null,me=null;const De=Object.seal(Do(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ne=!0,z=!0,ke=!1,Ce=!0,ze=!1,Ve=!0,ot=!1,Rt=!1,Bt=!1,jt=!1,rt=!1,Be=!1,We=!0,gt=!1;const Pt="user-content-";let ln=!0,mn=!1,Et={},Je=null;const It=$e({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Gt=null;const $n=$e({},["audio","video","img","source","image","track"]);let Nn=null;const Tn=$e({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),qn="http://www.w3.org/1998/Math/MathML",er="http://www.w3.org/2000/svg",vt="http://www.w3.org/1999/xhtml";let Le=vt,Zt=!1,Jt=null;const Cr=$e({},[qn,er,vt],oo);let Ie=$e({},["mi","mo","mn","ms","mtext"]),tr=$e({},["annotation-xml"]);const Os=$e({},["title","style","font","a","script"]);let pr=null;const Ms=["application/xhtml+xml","text/html"],Wa="text/html";let Ot=null,Rr=null;const Pr=r.createElement("form"),hr=function(I){return I instanceof RegExp||I instanceof Function},Gr=function(){let I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Rr&&Rr===I)){if((!I||typeof I!="object")&&(I={}),I=sr(I),pr=Ms.indexOf(I.PARSER_MEDIA_TYPE)===-1?Wa:I.PARSER_MEDIA_TYPE,Ot=pr==="application/xhtml+xml"?oo:ui,oe=Gn(I,"ALLOWED_TAGS")?$e({},I.ALLOWED_TAGS,Ot):se,re=Gn(I,"ALLOWED_ATTR")?$e({},I.ALLOWED_ATTR,Ot):G,Jt=Gn(I,"ALLOWED_NAMESPACES")?$e({},I.ALLOWED_NAMESPACES,oo):Cr,Nn=Gn(I,"ADD_URI_SAFE_ATTR")?$e(sr(Tn),I.ADD_URI_SAFE_ATTR,Ot):Tn,Gt=Gn(I,"ADD_DATA_URI_TAGS")?$e(sr($n),I.ADD_DATA_URI_TAGS,Ot):$n,Je=Gn(I,"FORBID_CONTENTS")?$e({},I.FORBID_CONTENTS,Ot):It,ee=Gn(I,"FORBID_TAGS")?$e({},I.FORBID_TAGS,Ot):sr({}),me=Gn(I,"FORBID_ATTR")?$e({},I.FORBID_ATTR,Ot):sr({}),Et=Gn(I,"USE_PROFILES")?I.USE_PROFILES:!1,Ne=I.ALLOW_ARIA_ATTR!==!1,z=I.ALLOW_DATA_ATTR!==!1,ke=I.ALLOW_UNKNOWN_PROTOCOLS||!1,Ce=I.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ze=I.SAFE_FOR_TEMPLATES||!1,Ve=I.SAFE_FOR_XML!==!1,ot=I.WHOLE_DOCUMENT||!1,jt=I.RETURN_DOM||!1,rt=I.RETURN_DOM_FRAGMENT||!1,Be=I.RETURN_TRUSTED_TYPE||!1,Bt=I.FORCE_BODY||!1,We=I.SANITIZE_DOM!==!1,gt=I.SANITIZE_NAMED_PROPS||!1,ln=I.KEEP_CONTENT!==!1,mn=I.IN_PLACE||!1,ie=I.ALLOWED_URI_REGEXP||md,Le=I.NAMESPACE||vt,Ie=I.MATHML_TEXT_INTEGRATION_POINTS||Ie,tr=I.HTML_INTEGRATION_POINTS||tr,H=I.CUSTOM_ELEMENT_HANDLING||{},I.CUSTOM_ELEMENT_HANDLING&&hr(I.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(H.tagNameCheck=I.CUSTOM_ELEMENT_HANDLING.tagNameCheck),I.CUSTOM_ELEMENT_HANDLING&&hr(I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(H.attributeNameCheck=I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),I.CUSTOM_ELEMENT_HANDLING&&typeof I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(H.allowCustomizedBuiltInElements=I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ze&&(z=!1),rt&&(jt=!0),Et&&(oe=$e({},Tc),re=[],Et.html===!0&&($e(oe,Sc),$e(re,Ec)),Et.svg===!0&&($e(oe,co),$e(re,vo),$e(re,ri)),Et.svgFilters===!0&&($e(oe,uo),$e(re,vo),$e(re,ri)),Et.mathMl===!0&&($e(oe,fo),$e(re,Ac),$e(re,ri))),I.ADD_TAGS&&(typeof I.ADD_TAGS=="function"?De.tagCheck=I.ADD_TAGS:(oe===se&&(oe=sr(oe)),$e(oe,I.ADD_TAGS,Ot))),I.ADD_ATTR&&(typeof I.ADD_ATTR=="function"?De.attributeCheck=I.ADD_ATTR:(re===G&&(re=sr(re)),$e(re,I.ADD_ATTR,Ot))),I.ADD_URI_SAFE_ATTR&&$e(Nn,I.ADD_URI_SAFE_ATTR,Ot),I.FORBID_CONTENTS&&(Je===It&&(Je=sr(Je)),$e(Je,I.FORBID_CONTENTS,Ot)),I.ADD_FORBID_CONTENTS&&(Je===It&&(Je=sr(Je)),$e(Je,I.ADD_FORBID_CONTENTS,Ot)),ln&&(oe["#text"]=!0),ot&&$e(oe,["html","head","body"]),oe.table&&($e(oe,["tbody"]),delete ee.tbody),I.TRUSTED_TYPES_POLICY){if(typeof I.TRUSTED_TYPES_POLICY.createHTML!="function")throw ls('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof I.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ls('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');R=I.TRUSTED_TYPES_POLICY,Y=R.createHTML("")}else R===void 0&&(R=a_(x,i)),R!==null&&typeof Y=="string"&&(Y=R.createHTML(""));sn&&sn(I),Rr=I}},Wr=$e({},[...co,...uo,...Vg]),_t=$e({},[...fo,...Yg]),Nt=function(I){let Se=$(I);(!Se||!Se.tagName)&&(Se={namespaceURI:Le,tagName:"template"});const Ae=ui(I.tagName),lt=ui(Se.tagName);return Jt[I.namespaceURI]?I.namespaceURI===er?Se.namespaceURI===vt?Ae==="svg":Se.namespaceURI===qn?Ae==="svg"&&(lt==="annotation-xml"||Ie[lt]):!!Wr[Ae]:I.namespaceURI===qn?Se.namespaceURI===vt?Ae==="math":Se.namespaceURI===er?Ae==="math"&&tr[lt]:!!_t[Ae]:I.namespaceURI===vt?Se.namespaceURI===er&&!tr[lt]||Se.namespaceURI===qn&&!Ie[lt]?!1:!_t[Ae]&&(Os[Ae]||!Wr[Ae]):!!(pr==="application/xhtml+xml"&&Jt[I.namespaceURI]):!1},En=function(I){is(e.removed,{element:I});try{$(I).removeChild(I)}catch{E(I)}},An=function(I,Se){try{is(e.removed,{attribute:Se.getAttributeNode(I),from:Se})}catch{is(e.removed,{attribute:null,from:Se})}if(Se.removeAttribute(I),I==="is")if(jt||rt)try{En(Se)}catch{}else try{Se.setAttribute(I,"")}catch{}},Hr=function(I){let Se=null,Ae=null;if(Bt)I="<remove></remove>"+I;else{const kt=lo(I,/^[\r\n\t ]+/);Ae=kt&&kt[0]}pr==="application/xhtml+xml"&&Le===vt&&(I='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+I+"</body></html>");const lt=R?R.createHTML(I):I;if(Le===vt)try{Se=new k().parseFromString(lt,pr)}catch{}if(!Se||!Se.documentElement){Se=ne.createDocument(Le,"template",null);try{Se.documentElement.innerHTML=Zt?Y:lt}catch{}}const yt=Se.body||Se.documentElement;return I&&Ae&&yt.insertBefore(r.createTextNode(Ae),yt.childNodes[0]||null),Le===vt?we.call(Se,ot?"html":"body")[0]:ot?Se.documentElement:yt},Vr=function(I){return F.call(I.ownerDocument||I,I,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},Ha=function(I){return I instanceof b&&(typeof I.nodeName!="string"||typeof I.textContent!="string"||typeof I.removeChild!="function"||!(I.attributes instanceof _)||typeof I.removeAttribute!="function"||typeof I.setAttribute!="function"||typeof I.namespaceURI!="string"||typeof I.insertBefore!="function"||typeof I.hasChildNodes!="function")},Bn=function(I){return typeof d=="function"&&I instanceof d};function $t(Ke,I,Se){ni(Ke,Ae=>{Ae.call(e,I,Se,Rr)})}const zn=function(I){let Se=null;if($t(ye.beforeSanitizeElements,I,null),Ha(I))return En(I),!0;const Ae=Ot(I.nodeName);if($t(ye.uponSanitizeElement,I,{tagName:Ae,allowedTags:oe}),Ve&&I.hasChildNodes()&&!Bn(I.firstElementChild)&&rn(/<[/\w!]/g,I.innerHTML)&&rn(/<[/\w!]/g,I.textContent)||I.nodeType===us.progressingInstruction||Ve&&I.nodeType===us.comment&&rn(/<[/\w]/g,I.data))return En(I),!0;if(!(De.tagCheck instanceof Function&&De.tagCheck(Ae))&&(!oe[Ae]||ee[Ae])){if(!ee[Ae]&&Ds(Ae)&&(H.tagNameCheck instanceof RegExp&&rn(H.tagNameCheck,Ae)||H.tagNameCheck instanceof Function&&H.tagNameCheck(Ae)))return!1;if(ln&&!Je[Ae]){const lt=$(I)||I.parentNode,yt=he(I)||I.childNodes;if(yt&&lt){const kt=yt.length;for(let Mt=kt-1;Mt>=0;--Mt){const cn=N(yt[Mt],!0);cn.__removalCount=(I.__removalCount||0)+1,lt.insertBefore(cn,J(I))}}}return En(I),!0}return I instanceof h&&!Nt(I)||(Ae==="noscript"||Ae==="noembed"||Ae==="noframes")&&rn(/<\/no(script|embed|frames)/i,I.innerHTML)?(En(I),!0):(ze&&I.nodeType===us.text&&(Se=I.textContent,ni([de,_e,ve],lt=>{Se=os(Se,lt," ")}),I.textContent!==Se&&(is(e.removed,{element:I.cloneNode()}),I.textContent=Se)),$t(ye.afterSanitizeElements,I,null),!1)},Yr=function(I,Se,Ae){if(We&&(Se==="id"||Se==="name")&&(Ae in r||Ae in Pr))return!1;if(!(z&&!me[Se]&&rn(ce,Se))){if(!(Ne&&rn(V,Se))){if(!(De.attributeCheck instanceof Function&&De.attributeCheck(Se,I))){if(!re[Se]||me[Se]){if(!(Ds(I)&&(H.tagNameCheck instanceof RegExp&&rn(H.tagNameCheck,I)||H.tagNameCheck instanceof Function&&H.tagNameCheck(I))&&(H.attributeNameCheck instanceof RegExp&&rn(H.attributeNameCheck,Se)||H.attributeNameCheck instanceof Function&&H.attributeNameCheck(Se,I))||Se==="is"&&H.allowCustomizedBuiltInElements&&(H.tagNameCheck instanceof RegExp&&rn(H.tagNameCheck,Ae)||H.tagNameCheck instanceof Function&&H.tagNameCheck(Ae))))return!1}else if(!Nn[Se]){if(!rn(ie,os(Ae,X,""))){if(!((Se==="src"||Se==="xlink:href"||Se==="href")&&I!=="script"&&Ug(Ae,"data:")===0&&Gt[I])){if(!(ke&&!rn(Q,os(Ae,X,"")))){if(Ae)return!1}}}}}}}return!0},Ds=function(I){return I!=="annotation-xml"&&lo(I,ue)},Fn=function(I){$t(ye.beforeSanitizeAttributes,I,null);const{attributes:Se}=I;if(!Se||Ha(I))return;const Ae={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:re,forceKeepAttr:void 0};let lt=Se.length;for(;lt--;){const yt=Se[lt],{name:kt,namespaceURI:Mt,value:cn}=yt,nr=Ot(kt),Qr=cn;let wt=kt==="value"?Qr:Gg(Qr);if(Ae.attrName=nr,Ae.attrValue=wt,Ae.keepAttr=!0,Ae.forceKeepAttr=void 0,$t(ye.uponSanitizeAttribute,I,Ae),wt=Ae.attrValue,gt&&(nr==="id"||nr==="name")&&(An(kt,I),wt=Pt+wt),Ve&&rn(/((--!?|])>)|<\/(style|title|textarea)/i,wt)){An(kt,I);continue}if(nr==="attributename"&&lo(wt,"href")){An(kt,I);continue}if(Ae.forceKeepAttr)continue;if(!Ae.keepAttr){An(kt,I);continue}if(!Ce&&rn(/\/>/i,wt)){An(kt,I);continue}ze&&ni([de,_e,ve],Xr=>{wt=os(wt,Xr," ")});const Va=Ot(I.nodeName);if(!Yr(Va,nr,wt)){An(kt,I);continue}if(R&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Mt)switch(x.getAttributeType(Va,nr)){case"TrustedHTML":{wt=R.createHTML(wt);break}case"TrustedScriptURL":{wt=R.createScriptURL(wt);break}}if(wt!==Qr)try{Mt?I.setAttributeNS(Mt,kt,wt):I.setAttribute(kt,wt),Ha(I)?En(I):xc(e.removed)}catch{An(kt,I)}}$t(ye.afterSanitizeAttributes,I,null)},Ls=function Ke(I){let Se=null;const Ae=Vr(I);for($t(ye.beforeSanitizeShadowDOM,I,null);Se=Ae.nextNode();)$t(ye.uponSanitizeShadowNode,Se,null),zn(Se),Fn(Se),Se.content instanceof o&&Ke(Se.content);$t(ye.afterSanitizeShadowDOM,I,null)};return e.sanitize=function(Ke){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Se=null,Ae=null,lt=null,yt=null;if(Zt=!Ke,Zt&&(Ke="<!-->"),typeof Ke!="string"&&!Bn(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw ls("dirty is not a string, aborting")}else throw ls("toString is not a function");if(!e.isSupported)return Ke;if(Rt||Gr(I),e.removed=[],typeof Ke=="string"&&(mn=!1),mn){if(Ke.nodeName){const cn=Ot(Ke.nodeName);if(!oe[cn]||ee[cn])throw ls("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof d)Se=Hr("<!---->"),Ae=Se.ownerDocument.importNode(Ke,!0),Ae.nodeType===us.element&&Ae.nodeName==="BODY"||Ae.nodeName==="HTML"?Se=Ae:Se.appendChild(Ae);else{if(!jt&&!ze&&!ot&&Ke.indexOf("<")===-1)return R&&Be?R.createHTML(Ke):Ke;if(Se=Hr(Ke),!Se)return jt?null:Be?Y:""}Se&&Bt&&En(Se.firstChild);const kt=Vr(mn?Ke:Se);for(;lt=kt.nextNode();)zn(lt),Fn(lt),lt.content instanceof o&&Ls(lt.content);if(mn)return Ke;if(jt){if(rt)for(yt=fe.call(Se.ownerDocument);Se.firstChild;)yt.appendChild(Se.firstChild);else yt=Se;return(re.shadowroot||re.shadowrootmode)&&(yt=Te.call(a,yt,!0)),yt}let Mt=ot?Se.outerHTML:Se.innerHTML;return ot&&oe["!doctype"]&&Se.ownerDocument&&Se.ownerDocument.doctype&&Se.ownerDocument.doctype.name&&rn(gd,Se.ownerDocument.doctype.name)&&(Mt="<!DOCTYPE "+Se.ownerDocument.doctype.name+`>
`+Mt),ze&&ni([de,_e,ve],cn=>{Mt=os(Mt,cn," ")}),R&&Be?R.createHTML(Mt):Mt},e.setConfig=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gr(Ke),Rt=!0},e.clearConfig=function(){Rr=null,Rt=!1},e.isValidAttribute=function(Ke,I,Se){Rr||Gr({});const Ae=Ot(Ke),lt=Ot(I);return Yr(Ae,lt,Se)},e.addHook=function(Ke,I){typeof I=="function"&&is(ye[Ke],I)},e.removeHook=function(Ke,I){if(I!==void 0){const Se=Fg(ye[Ke],I);return Se===-1?void 0:Kg(ye[Ke],Se,1)[0]}return xc(ye[Ke])},e.removeHooks=function(Ke){ye[Ke]=[]},e.removeAllHooks=function(){ye=Rc()},e}var s_=_d();function i_(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Pc(t.from)} |`),e.push(`| **To** | ${Pc(t.to)} |`),e.push(`| **Date** | ${el(t.date)} |`),e.push(""),e.push("---"),e.push("");const r=t.htmlBody?o_(t.htmlBody):null;return e.push(r||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Pc(t){return(t||"").replace(/\|/g,"\\|")}function o_(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const r of e.querySelectorAll("style, script, head"))r.remove();return No(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function l_(t,e){if(!e||e.startsWith("data:"))return!0;const r=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(r>0&&r<=3||a>0&&a<=3)return!0;const i=e.toLowerCase();return i.includes("spacer")||i.includes("transparent")||i.includes("transp.gif")||i.includes("/track")&&i.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(i)?!0:i.includes("mail.google.com/mail/u/")&&i.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(i)||i.endsWith(".gif")&&i.includes("1x1"))}function No(t){var i;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",u=t.getAttribute("alt")||"";return l_(t,o)?"":`![${u}](${o})`}const r=Array.from(t.childNodes).map(No).join(""),a=r.trim();if(!a&&!["img","br","hr"].includes(e))return r;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${r}

`;if(e==="li")return`${((i=t.parentElement)==null?void 0:i.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${r}

`;if(e==="tr")return`| ${Array.from(t.children).map(u=>No(u).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return r;if(e==="thead"){const o=r.trim(),u=(o.match(/\|/g)||[]).length-1,d="| "+Array(Math.max(u,1)).fill("---").join(" | ")+" |";return`${o}${d}
`}return r}function c_(t){return Ku(t,"md")}function Ic(t,e,r="text/markdown;charset=utf-8"){const a=new Blob([t],{type:r}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}function u_(t){return t.raw||null}function d_(t){const e=u_(t);return e?JSON.stringify(e,null,2):"null"}function f_(t){return Ku(t,"json")}var v_=O('<button title="View as Markdown">.md</button>'),p_=O('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),h_=O('<pre class="md-raw svelte-1b0rzpb"> </pre>'),m_=O('<div class="md-preview svelte-1b0rzpb"><!></div>'),g_=O('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),__=O('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),y_=O('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),b_=O('<pre class="message-text svelte-1b0rzpb"> </pre>'),w_=O('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),k_=O('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),x_=O('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function S_(t,e){ht(e,!0);let r=Oe(e,"loading",3,!1);Xt(()=>Sn("MessageModal"));const a=new ft.Renderer;a.link=({href:de,title:_e,text:ve})=>{const ce=_e?` title="${_e}"`:"";return`<a href="${de}"${ce} target="_blank" rel="noopener">${ve}</a>`},ft.setOptions({breaks:!0,gfm:!0,renderer:a});let i=Me("email"),o=dt(()=>e.message.body?i_(e.message):""),u=dt(()=>d_(e.message)),d=Me("raw");function h(de){C(i,v(i)===de?"email":de,!0),de==="markdown"&&C(d,"raw")}function p(){Ic(v(o),c_(e.message))}function _(){Ic(v(u),f_(e.message),"application/json;charset=utf-8")}function b(de){const _e=ft.parse(de);return s_.sanitize(_e,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let k=Me(null);Ka(()=>{var de;if(v(k)&&e.message.htmlBody&&!r()&&v(i)==="email"){const _e=v(k).contentDocument||((de=v(k).contentWindow)==null?void 0:de.document);_e&&(_e.open(),_e.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),_e.close())}});var x=x_();x.__click=function(...de){var _e;(_e=e.onclose)==null||_e.apply(this,de)};var A=g(x);A.__click=de=>de.stopPropagation();var N=g(A),E=g(N),J=g(E),he=y(E,2),$=g(he);let R;$.__click=()=>h("json");var Y=y($,2);{var ne=de=>{var _e=v_();let ve;_e.__click=()=>h("markdown"),ae(()=>ve=Tt(_e,1,"action-btn svelte-1b0rzpb",null,ve,{active:v(i)==="markdown"})),T(de,_e)};le(Y,de=>{e.message.body&&de(ne)})}var F=y(Y,2);F.__click=function(...de){var _e;(_e=e.onclose)==null||_e.apply(this,de)};var fe=y(N,2);{var we=de=>{var _e=p_(),ve=He(_e),ce=y(g(ve),2);ce.__click=_;var V=y(ve,2),Q=g(V),X=g(Q);ae(()=>K(X,v(u))),T(de,_e)},Te=de=>{var _e=g_(),ve=He(_e),ce=g(ve),V=g(ce);let Q;V.__click=()=>C(d,"raw");var X=y(V,2);let ue;X.__click=()=>C(d,"preview");var ie=y(ce,2);ie.__click=p;var oe=y(ve,2),se=g(oe);{var re=H=>{var ee=h_(),me=g(ee);ae(()=>K(me,v(o))),T(H,ee)},G=H=>{var ee=m_(),me=g(ee);uv(me,()=>b(v(o))),T(H,ee)};le(se,H=>{v(d)==="raw"?H(re):H(G,!1)})}ae(()=>{Q=Tt(V,1,"md-tab svelte-1b0rzpb",null,Q,{active:v(d)==="raw"}),ue=Tt(X,1,"md-tab svelte-1b0rzpb",null,ue,{active:v(d)==="preview"})}),T(de,_e)},ye=de=>{var _e=k_(),ve=He(_e),ce=g(ve),V=y(g(ce),2),Q=g(V),X=y(ce,2),ue=y(g(X),2),ie=g(ue),oe=y(X,2),se=y(g(oe),2),re=g(se),G=y(ve,2),H=g(G);{var ee=z=>{var ke=__();T(z,ke)},me=z=>{var ke=y_();Ou(ke,Ce=>C(k,Ce),()=>v(k)),T(z,ke)},De=z=>{var ke=b_(),Ce=g(ke);ae(()=>K(Ce,e.message.body)),T(z,ke)},Ne=z=>{var ke=w_();T(z,ke)};le(H,z=>{r()?z(ee):e.message.htmlBody?z(me,1):e.message.body?z(De,2):z(Ne,!1)})}ae(z=>{K(Q,e.message.from),K(ie,e.message.to),K(re,z)},[()=>el(e.message.date)]),T(de,_e)};le(fe,de=>{v(i)==="json"?de(we):v(i)==="markdown"?de(Te,1):de(ye,!1)})}ae(()=>{K(J,e.message.subject),R=Tt($,1,"action-btn svelte-1b0rzpb",null,R,{active:v(i)==="json"})}),T(t,x),mt()}Ct(["click"]);var T_=O('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),E_=O('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),A_=O('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),C_=O("<p> </p>"),R_=O('<p>No emails in local storage. Click "Sync New" to download.</p>'),P_=O('<div class="empty-state svelte-6ts5xm"><!></div>'),I_=O('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),O_=O('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function M_(t,e){ht(e,!0),Xt(()=>Sn("DashboardView"));let r=Oe(e,"error",3,null),a=Oe(e,"profile",3,null),i=Oe(e,"loadingProfile",3,!1),o=Oe(e,"emailMessages",19,()=>[]),u=Oe(e,"totalLocalMessages",3,0),d=Oe(e,"hasMoreLocal",3,!1),h=Oe(e,"loadingMessages",3,!1),p=Oe(e,"selectedMessage",3,null),_=Oe(e,"syncStatus",3,null),b=Oe(e,"syncProgress",3,null),k=Oe(e,"isSyncing",3,!1),x=Oe(e,"searchQuery",15);var A=O_(),N=He(A),E=g(N);{var J=ce=>{nd(ce,{get error(){return r()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};le(E,ce=>{r()&&ce(J)})}var he=y(E,2);Om(he,{get profile(){return a()},get loadingProfile(){return i()},get onsignout(){return e.onsignout}});var $=y(he,2);Wm($,{get syncStatus(){return _()},get syncProgress(){return b()},get isSyncing(){return k()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var R=y($,2),Y=g(R);Y.__keydown=ce=>ce.key==="Enter"&&e.onsearch();var ne=y(Y,2);ne.__click=function(...ce){var V;(V=e.onsearch)==null||V.apply(this,ce)};var F=g(ne),fe=y(R,2);{var we=ce=>{var V=E_(),Q=He(V),X=g(Q),ue=g(X),ie=y(Q,2);Ym(ie,{get messages(){return o()},get onselect(){return e.onviewmessage}});var oe=y(ie,2);{var se=re=>{var G=T_(),H=g(G);H.__click=function(...me){var De;(De=e.onloadmore)==null||De.apply(this,me)};var ee=g(H);ae(()=>{H.disabled=h(),K(ee,h()?"Loading...":"Load More")}),T(re,G)};le(oe,re=>{d()&&re(se)})}ae(re=>K(ue,`Showing ${o().length??""} of ${re??""}
        ${x()?" matching":""} emails`),[()=>u().toLocaleString()]),T(ce,V)},Te=ce=>{var V=A_();T(ce,V)},ye=ce=>{var V=P_(),Q=g(V);{var X=ie=>{var oe=C_(),se=g(oe);ae(()=>K(se,`No emails match "${x()??""}".`)),T(ie,oe)},ue=ie=>{var oe=R_();T(ie,oe)};le(Q,ie=>{x()?ie(X):ie(ue,!1)})}T(ce,V)},de=ce=>{var V=I_();T(ce,V)};le(fe,ce=>{var V;o().length>0?ce(we):h()?ce(Te,1):(V=_())!=null&&V.synced?ce(ye,2):ce(de,!1)})}var _e=y(N,2);{var ve=ce=>{S_(ce,{get message(){return p()},loading:!1,get onclose(){return e.onclosedetail}})};le(_e,ce=>{p()&&ce(ve)})}ae(()=>{ne.disabled=h(),K(F,h()?"Searching...":"Search")}),Si(Y,x),T(t,A),mt()}Ct(["keydown","click"]);var D_=O('<div class="dashboard svelte-1q5o2lv"><!></div>');function L_(t,e){ht(e,!0);function r(z){z.key==="Escape"&&v(b)&&ie()}let a=null;Xt(()=>(window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r),a&&clearTimeout(a)}));function i(){a&&clearTimeout(a);const z=sm();if(z<=0)return;const ke=Math.max(0,z-120*1e3);a=setTimeout(async()=>{try{const Ce=await vc();C(p,Ce.access_token,!0),i()}catch{C(p,null),C(_,null),C($,"Session expired. Please sign in again.")}},ke)}async function o(){if(am())return v(p);try{const z=await vc();return C(p,z.access_token,!0),i(),v(p)}catch{return C(p,null),C(_,null),C($,"Session expired. Please sign in again."),null}}let u=Me(qt(localStorage.getItem("googleClientId")||"")),d=Me(qt(localStorage.getItem("googleClientId")||"")),h=Me(!1),p=Me(null),_=Me(null),b=Me(null),k=Me(""),x=Me(qt([])),A=Me(0),N=Me(0),E=Me(!1),J=Me(!1),he=Me(!1),$=Me(null),R=Me(null),Y=Me(null),ne=Me(!1);const F=50;Ka(()=>{v(p)&&(oe(),V())});let fe=dt(()=>!v(u)),we=dt(()=>!!v(p)),Te=dt(()=>v(x).length<v(A));Ka(()=>{v(u)&&!v(h)&&pc(v(u)).then(()=>{if(C(h,!0),!v(p)){const z=rm();z&&(C(p,z.access_token,!0),i(),ce())}}).catch(z=>{C($,`Auth init failed: ${z.message}`)})});function ye(){const z=v(d).trim();z&&(localStorage.setItem("googleClientId",z),C(u,z,!0),C($,null))}function de(){localStorage.removeItem("googleClientId"),C(u,""),C(d,""),C(h,!1),C(p,null),C(_,null),C(x,[],!0),C(A,0)}async function _e(){C($,null),C(J,!0);try{v(h)||(await pc(v(u)),C(h,!0));const z=await om();C(p,z.access_token,!0),i(),await ce()}catch(z){C($,z.message,!0)}finally{C(J,!1)}}async function ve(){if(a&&clearTimeout(a),v(p))try{await lm(v(p))}catch{}C(p,null),C(_,null),C(x,[],!0),C(A,0),C(b,null),C($,null)}async function ce(){C(he,!0);try{const z=await Nu(v(p));if(!v(p))return;C(_,z,!0)}catch(z){if(!v(p))return;C($,`Profile fetch failed: ${z.message}`)}finally{C(he,!1)}}async function V(z=!1){C(E,!0);try{const ke=z?v(N):0,Ce=await Hv({query:v(k)||void 0,limit:F,offset:ke});z?C(x,[...v(x),...Ce.items],!0):C(x,Ce.items,!0),C(A,Ce.total,!0),C(N,v(x).length,!0)}catch(ke){C($,`Failed to load messages: ${ke.message}`)}finally{C(E,!1)}}function Q(){C(N,0),V(!1)}function X(){V(!0)}function ue(z){C(b,z,!0)}function ie(){C(b,null)}async function oe(){try{C(R,await dm(),!0)}catch{}}async function se(z){if(v(ne)||!v(p))return;const ke=await o();if(!ke)return;C($,null),C(ne,!0),C(Y,null);const Ce=new AbortController;try{await cm(ke,{limit:z,onProgress:ze=>{C(Y,{...ze},!0)},signal:Ce.signal}),await oe(),await V(!1)}catch(ze){if(ze.name!=="AbortError"){if(!v(p))return;C($,`Sync failed: ${ze.message}`)}}finally{C(ne,!1)}}async function re(z){if(v(ne)||!v(p))return;const ke=await o();if(!ke)return;C($,null),C(ne,!0),C(Y,null);const Ce=new AbortController;try{await um(ke,{limit:z,onProgress:ze=>{C(Y,{...ze},!0)},signal:Ce.signal}),await oe(),await V(!1)}catch(ze){if(ze.name!=="AbortError"){if(!v(p))return;C($,`Sync more failed: ${ze.message}`)}}finally{C(ne,!1)}}async function G(){try{await Ju(),await oe(),C(x,[],!0),C(A,0),C(N,0)}catch(z){C($,`Failed to clear data: ${z.message}`)}}var H=D_(),ee=g(H);{var me=z=>{gm(z,{onsave:ye,get clientIdInput(){return v(d)},set clientIdInput(ke){C(d,ke,!0)}})},De=z=>{Cm(z,{get clientId(){return v(u)},get error(){return v($)},get loadingAuth(){return v(J)},onsignin:_e,onclear:de,onsignout:ve})},Ne=z=>{M_(z,{get error(){return v($)},get profile(){return v(_)},get loadingProfile(){return v(he)},get emailMessages(){return v(x)},get totalLocalMessages(){return v(A)},get hasMoreLocal(){return v(Te)},get loadingMessages(){return v(E)},get selectedMessage(){return v(b)},get syncStatus(){return v(R)},get syncProgress(){return v(Y)},get isSyncing(){return v(ne)},onsignout:ve,onsearch:Q,onloadmore:X,onviewmessage:ue,onclosedetail:ie,ondismisserror:()=>C($,null),onsync:se,onsyncmore:re,oncleardata:G,get searchQuery(){return v(k)},set searchQuery(ke){C(k,ke,!0)}})};le(ee,z=>{v(fe)?z(me):v(we)?z(Ne,!1):z(De,1)})}T(t,H),mt()}var j_=O('<span class="err svelte-t1ig66"> </span>'),N_=O('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),q_=O('<span class="stream-stats svelte-t1ig66"> </span>'),B_=O('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),z_=O('<span class="ei-action svelte-t1ig66"> </span>'),F_=O('<span class="ei-action err svelte-t1ig66">ERROR</span>'),K_=O('<span class="sep svelte-t1ig66">Â·</span> ',1),U_=O('<div class="ei-summary svelte-t1ig66"> </div>'),G_=O('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),W_=O('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),H_=O("<!> <!> <!>",1),V_=O('<div class="ei-error svelte-t1ig66"> </div>'),Y_=O('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Q_=O('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),X_=O('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Z_=O('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),J_=O(' <span class="sep svelte-t1ig66">Â·</span>',1),$_=O('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),ey=O('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),ty=O('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),ny=O('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function ry(t,e){ht(e,!0);let r=Oe(e,"progress",3,null);function a(k){return!k||k<0?"â":k<1e3?`${Math.round(k)}ms`:`${(k/1e3).toFixed(1)}s`}function i(k){return k?k>=1e3?`${(k/1e3).toFixed(1)}k`:String(k):"0"}function o(k){if(!k)return"â";const x=k.replace(/<.*>/,"").trim();return x.length>30?x.slice(0,28)+"â¦":x}function u(k){if(!k)return"";try{return new Date(k).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let d=dt(()=>{var k;return(k=r())!=null&&k.total?Math.round(r().current/r().total*100):0}),h=dt(()=>{var k;return((k=r())==null?void 0:k.phase)==="done"});var p=vr(),_=He(p);{var b=k=>{var x=ny(),A=g(x),N=g(A),E=g(N);{var J=se=>{var re=Tr();ae(()=>K(re,`Scan complete â ${(r().classified||0)??""} classified`)),T(se,re)},he=se=>{var re=Tr("Loading emailsâ¦");T(se,re)},$=se=>{var re=Tr();ae(()=>K(re,`Processing ${r().current??0??""} / ${r().total??0??""}`)),T(se,re)};le(E,se=>{v(h)?se(J):r().phase==="loading"?se(he,1):se($,!1)})}var R=y(N,2),Y=g(R),ne=y(A,2),F=g(ne);let fe,we;var Te=y(ne,2);{var ye=se=>{var re=N_(),G=g(re),H=y(G);{var ee=Ne=>{var z=j_(),ke=g(z);ae(()=>K(ke,`Â· ${r().errors??""} errors`)),T(Ne,z)};le(H,Ne=>{r().errors&&Ne(ee)})}var me=y(H,3),De=y(me,2);ae((Ne,z,ke)=>{K(G,`${(r().classified||0)??""} classified `),K(me,` ${Ne??""} in + ${z??""} out `),K(De,` ${ke??""}`)},[()=>i(r().totals.inputTokens),()=>i(r().totals.outputTokens),()=>a(r().totals.elapsed)]),T(se,re)};le(Te,se=>{r().totals&&!v(h)&&se(ye)})}var de=y(Te,2);{var _e=se=>{var re=B_(),G=g(re),H=g(G),ee=g(H),me=y(H,2);{var De=ke=>{var Ce=q_(),ze=g(Ce);ae(Ve=>K(ze,`${Ve??""} tok/s Â· ${(r().live.numTokens||0)??""} tokens`),[()=>r().live.tps.toFixed(0)]),T(ke,Ce)};le(me,ke=>{var Ce;(Ce=r().live)!=null&&Ce.tps&&ke(De)})}var Ne=y(G,2),z=g(Ne);ae(()=>{K(ee,r().email.subject||"(no subject)"),K(z,r().streamingText||"Waiting for modelâ¦")}),T(se,re)};le(de,se=>{!v(h)&&r().email&&(r().phase==="generating"||r().phase==="scanning")&&se(_e)})}var ve=y(de,2);{var ce=se=>{var re=Q_(),G=g(re),H=y(g(G),2),ee=g(H),me=y(G,2);St(me,17,()=>r().results,Ft,(De,Ne,z)=>{var ke=Y_();let Ce;var ze=g(ke),Ve=g(ze);Ve.textContent=`${z+1}.`;var ot=y(Ve,2),Rt=g(ot),Bt=y(ot,2);{var jt=Je=>{var It=z_(),Gt=g(It);ae(()=>K(Gt,v(Ne).classification.action)),T(Je,It)},rt=Je=>{var It=F_();T(Je,It)};le(Bt,Je=>{v(Ne).success?Je(jt):Je(rt,!1)})}var Be=y(ze,2),We=g(Be),gt=y(We);{var Pt=Je=>{var It=K_(),Gt=y(He(It),1,!0);ae($n=>K(Gt,$n),[()=>u(v(Ne).email.date)]),T(Je,It)};le(gt,Je=>{v(Ne).email.date&&Je(Pt)})}var ln=y(Be,2);{var mn=Je=>{var It=H_(),Gt=He(It);{var $n=vt=>{var Le=U_(),Zt=g(Le);ae(()=>K(Zt,v(Ne).classification.summary)),T(vt,Le)};le(Gt,vt=>{v(Ne).classification.summary&&vt($n)})}var Nn=y(Gt,2);{var Tn=vt=>{var Le=G_(),Zt=g(Le),Jt=y(Zt,2),Cr=y(Jt,2);ae((Ie,tr)=>{K(Zt,`${Ie??""} `),K(Jt,` ${(v(Ne).stats.inputTokens||0)??""} in + ${(v(Ne).stats.numTokens||0)??""} out `),K(Cr,` ${tr??""}`)},[()=>v(Ne).stats.tps?`${v(Ne).stats.tps.toFixed(0)} tok/s`:"â",()=>a(v(Ne).stats.elapsed)]),T(vt,Le)};le(Nn,vt=>{v(Ne).stats&&vt(Tn)})}var qn=y(Nn,2);{var er=vt=>{var Le=W_(),Zt=y(g(Le),2),Jt=g(Zt);ae(()=>K(Jt,v(Ne).rawResponse)),T(vt,Le)};le(qn,vt=>{v(Ne).rawResponse&&vt(er)})}T(Je,It)},Et=Je=>{var It=V_(),Gt=g(It);ae(()=>K(Gt,v(Ne).error)),T(Je,It)};le(ln,Je=>{v(Ne).success?Je(mn):Je(Et,!1)})}ae(Je=>{Ce=Tt(ke,1,"email-item svelte-t1ig66",null,Ce,{failed:!v(Ne).success}),K(Rt,v(Ne).email.subject||"(no subject)"),K(We,Je)},[()=>o(v(Ne).email.from)]),T(De,ke)}),ae(()=>K(ee,r().results.length)),T(se,re)};le(ve,se=>{var re;((re=r().results)==null?void 0:re.length)>0&&se(ce)})}var V=y(ve,2);{var Q=se=>{var re=$_(),G=g(re),H=g(G),ee=g(H),me=y(H,4),De=g(me),Ne=y(me,2);{var z=rt=>{var Be=X_(),We=y(He(Be)),gt=g(We);ae(()=>K(gt,`${r().errors??""} errors`)),T(rt,Be)};le(Ne,rt=>{r().errors>0&&rt(z)})}var ke=y(Ne,2);{var Ce=rt=>{var Be=Z_(),We=y(He(Be)),gt=g(We);ae(()=>K(gt,`${r().summary.skipped??""} skipped`)),T(rt,Be)};le(ke,rt=>{var Be;(Be=r().summary)!=null&&Be.skipped&&rt(Ce)})}var ze=y(G,2),Ve=g(ze);{var ot=rt=>{var Be=J_(),We=He(Be);ae(()=>K(We,`Avg ${r().summary.avgTps??""} tok/s`)),T(rt,Be)};le(Ve,rt=>{var Be;(Be=r().summary)!=null&&Be.avgTps&&rt(ot)})}var Rt=y(Ve),Bt=y(Rt,2),jt=y(Bt,2);ae((rt,Be,We)=>{var gt,Pt;K(ee,`${(((gt=r().summary)==null?void 0:gt.processed)||r().total||0)??""} processed`),K(De,`${(r().classified||0)??""} classified`),K(Rt,` ${rt??""} in + ${Be??""} out `),K(Bt,` ${We??""} `),K(jt,` Model: ${(((Pt=r().summary)==null?void 0:Pt.modelName)||"Unknown")??""}`)},[()=>i(r().totals.inputTokens),()=>i(r().totals.outputTokens),()=>a(r().totals.elapsed)]),T(se,re)};le(V,se=>{v(h)&&r().totals&&se(Q)})}var X=y(V,2),ue=g(X);{var ie=se=>{var re=ey(),G=He(re);G.__click=function(...ee){var me;(me=e.oninspect)==null||me.apply(this,ee)};var H=y(G,2);H.__click=function(...ee){var me;(me=e.onclose)==null||me.apply(this,ee)},T(se,re)},oe=se=>{var re=ty(),G=He(re);G.__click=function(...ee){var me;(me=e.oninspect)==null||me.apply(this,ee)};var H=y(G,2);H.__click=function(...ee){var me;(me=e.onstop)==null||me.apply(this,ee)},T(se,re)};le(ue,se=>{v(h)?se(ie):se(oe,!1)})}ae(()=>{K(Y,`${v(d)??""}%`),fe=Tt(F,1,"bar-fill svelte-t1ig66",null,fe,{done:v(h)}),we=hn(F,"",we,{width:`${v(d)??""}%`})}),T(k,x)};le(_,k=>{r()&&k(b)})}T(t,p),mt()}Ct(["click"]);var ay=O('<span class="spinner svelte-ois7em"></span>'),sy=Xo('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),iy=O('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),oy=O("<option> </option>"),ly=O('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),cy=O('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function uy(t,e){ht(e,!0);let r=Oe(e,"engineStatus",3,"idle"),a=Oe(e,"modelName",3,""),i=Oe(e,"isScanning",3,!1),o=Oe(e,"scanProgress",3,null),u=Oe(e,"scanCount",15,20),d=Oe(e,"stats",3,null);const h=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function p(){return r()==="ready"?`${a()} ready`:r()==="loading"?"Loading model...":r()==="generating"?"Model busy...":"No model loaded"}function _(){return r()==="ready"?"#34d399":r()==="loading"?"#fbbf24":"#666"}function b(){return r()==="ready"&&!i()}let k=dt(()=>{var re;return i()&&((re=o())==null?void 0:re.phase)!=="done"});var x=cy(),A=g(x),N=g(A),E=g(N);{var J=re=>{var G=ay();T(re,G)},he=re=>{var G=sy();T(re,G)};le(E,re=>{v(k)?re(J):re(he,!1)})}var $=y(N,2),R=g($),Y=y(g(R),2);Y.__click=function(...re){var G;(G=e.oninspect)==null||G.apply(this,re)};var ne=y(R,2),F=g(ne);let fe;var we=y(F),Te=y(A,2);{var ye=re=>{var G=iy(),H=g(G),ee=g(H),me=y(H,4),De=g(me),Ne=y(me,4),z=g(Ne);ae(()=>{K(ee,`${d().totalEmails??""} emails in storage`),K(De,`${d().classified??""} classified`),K(z,`${d().unclassified??""} new`)}),T(re,G)};le(Te,re=>{d()&&re(ye)})}var de=y(Te,2),_e=g(de),ve=y(g(_e),2);St(ve,21,()=>h,Ft,(re,G)=>{var H=oy(),ee=g(H),me={};ae(()=>{K(ee,v(G).label),me!==(me=v(G).value)&&(H.value=(H.__value=v(G).value)??"")}),T(re,H)});var ce=y(_e,2),V=g(ce);V.__click=function(...re){var G;(G=e.onscan)==null||G.apply(this,re)};var Q=g(V),X=y(V,2);X.__click=function(...re){var G;(G=e.onrescan)==null||G.apply(this,re)};var ue=y(de,2);{var ie=re=>{var G=ly();T(re,G)};le(ue,re=>{r()!=="ready"&&r()!=="loading"&&re(ie)})}var oe=y(ue,2);{var se=re=>{ry(re,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};le(oe,re=>{var G;(i()||((G=o())==null?void 0:G.phase)==="done")&&re(se)})}ae((re,G,H,ee)=>{fe=hn(F,"",fe,re),K(we,` ${G??""}`),ve.disabled=i(),V.disabled=H,K(Q,v(k)?"Scanning...":i()?"Finalizing...":"Scan New"),X.disabled=ee},[()=>({background:_()}),p,()=>!b(),()=>!b()]),xi(ve,u),T(t,x),mt()}Ct(["click"]);var dy=O('<span class="row-date svelte-1czytqk"> </span>'),fy=O('<span class="tag svelte-1czytqk"> </span>'),vy=O('<span class="row-tags svelte-1czytqk"></span>'),py=O('<span class="row-reason svelte-1czytqk"> </span>'),hy=O('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),my=O('<span class="status-label svelte-1czytqk"> </span>'),gy=O('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),_y=O('<p class="summary-reason svelte-1czytqk"> </p>'),yy=O('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),by=O('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function Oc(t,e){ht(e,!0);let r=Oe(e,"actionColor",3,"#666"),a=Oe(e,"dimmed",3,!1);function i(ce){if(!ce)return"";try{return new Date(ce).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=dt(()=>e.item.status==="pending"),u=Me(!1);var d=by(),h=He(d);let p;var _=g(h);_.__click=()=>C(u,!v(u));let b;var k=g(_),x=g(k),A=y(k,2),N=g(A),E=g(N),J=y(N,2);{var he=ce=>{var V=dy(),Q=g(V);ae(X=>K(Q,X),[()=>i(e.item.date)]),T(ce,V)};le(J,ce=>{e.item.date&&ce(he)})}var $=y(A,2);{var R=ce=>{var V=vy();St(V,21,()=>e.item.tags,Ft,(Q,X)=>{var ue=fy();let ie;var oe=g(ue);ae(se=>{ie=hn(ue,"",ie,se),K(oe,v(X))},[()=>({background:lp(v(X))})]),T(Q,ue)}),T(ce,V)};le($,ce=>{e.item.tags&&e.item.tags.length>0&&ce(R)})}var Y=y($,2);{var ne=ce=>{var V=py(),Q=g(V);ae(()=>K(Q,e.item.reason)),T(ce,V)};le(Y,ce=>{e.item.reason&&!v(u)&&ce(ne)})}var F=y(_,2),fe=g(F);{var we=ce=>{var V=hy(),Q=He(V);Q.__click=()=>e.onmarkacted(e.item.emailId);var X=y(Q,2);X.__click=()=>e.ondismiss(e.item.emailId),T(ce,V)},Te=ce=>{var V=my(),Q=g(V);ae(()=>K(Q,e.item.status)),T(ce,V)};le(fe,ce=>{v(o)?ce(we):ce(Te,!1)})}var ye=y(fe,2);{var de=ce=>{var V=gy();V.__click=()=>e.onremove(e.item.emailId),T(ce,V)};le(ye,ce=>{e.onremove&&ce(de)})}var _e=y(h,2);{var ve=ce=>{var V=yy();let Q;var X=g(V),ue=g(X),ie=y(X,2);{var oe=se=>{var re=_y(),G=g(re);ae(()=>K(G,e.item.reason)),T(se,re)};le(ie,se=>{e.item.reason&&se(oe)})}ae(()=>{Q=hn(V,"",Q,{"border-left-color":r()}),K(ue,e.item.summary)}),T(ce,V)};le(_e,ce=>{v(u)&&e.item.summary&&ce(ve)})}ae(()=>{p=Tt(h,1,"email-row svelte-1czytqk",null,p,{dimmed:a()}),b=hn(_,"",b,{"border-left-color":r()}),K(x,e.item.subject),K(E,e.item.from)}),T(t,d),mt()}Ct(["click"]);var wy=O('<span class="group-acted svelte-tl1unp"> </span>'),ky=O('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),xy=O('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),Sy=O('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),Ty=O('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),Ey=O('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),Ay=O('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Cy(t,e){ht(e,!0);let r=Oe(e,"color",3,"#888");Oe(e,"count",3,0);let a=Oe(e,"items",19,()=>[]),i=Oe(e,"expanded",3,!1),o=dt(()=>a().filter(ne=>ne.status==="pending")),u=dt(()=>a().filter(ne=>ne.status!=="pending")),d=Me(!1);function h(ne){return ne.split("_").map(F=>F.charAt(0)+F.slice(1).toLowerCase()).join(" ")}var p=Ay(),_=g(p);_.__click=function(...ne){var F;(F=e.ontoggle)==null||F.apply(this,ne)};var b=g(_);let k;var x=g(b),A=y(b,2),N=g(A),E=y(A,2);{var J=ne=>{var F=wy(),fe=g(F);ae(()=>K(fe,`${v(u).length??""} handled`)),T(ne,F)};le(E,ne=>{v(u).length>0&&ne(J)})}var he=y(E,4);let $;var R=y(_,2);{var Y=ne=>{var F=Ey(),fe=g(F);{var we=Q=>{var X=ky();T(Q,X)};le(fe,Q=>{v(o).length===0&&v(u).length===0&&Q(we)})}var Te=y(fe,2);St(Te,17,()=>v(o),Q=>Q.emailId,(Q,X)=>{Oc(Q,{get item(){return v(X)},get actionColor(){return r()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var ye=y(Te,2);{var de=Q=>{var X=xy(),ue=g(X),ie=g(ue),oe=y(ue,2);St(oe,17,()=>v(u),se=>se.emailId,(se,re)=>{Oc(se,{get item(){return v(re)},get actionColor(){return r()},get onremove(){return e.onremove},dimmed:!0})}),ae(()=>K(ie,`${v(u).length??""} handled`)),T(Q,X)};le(ye,Q=>{v(u).length>0&&Q(de)})}var _e=y(ye,2),ve=g(_e);{var ce=Q=>{var X=Sy();X.__click=()=>C(d,!0),T(Q,X)},V=Q=>{var X=Ty(),ue=g(X),ie=y(ue);ie.__click=()=>C(d,!1);var oe=y(ie,2);oe.__click=()=>{e.oncleargroup(),C(d,!1)},ae(()=>K(ue,`Clear ${a().length??""} items? `)),T(Q,X)};le(ve,Q=>{v(d)?Q(V,!1):Q(ce)})}T(ne,F)};le(R,ne=>{i()&&ne(Y)})}ae(ne=>{k=hn(b,"",k,{background:r()}),K(x,ne),K(N,v(o).length),$=Tt(he,0,"chevron svelte-tl1unp",null,$,{open:i()})},[()=>h(e.action)]),T(t,p),mt()}Ct(["click"]);var Ry=O(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),Py=O(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),Iy=O(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),Oy=O('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function My(t,e){ht(e,!0);let r=Oe(e,"open",15,!1),a=Oe(e,"sampleEmail",3,null),i=Me("system");function o(){return a()?Yu(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function u(){r(!1)}function d(b){b.target===b.currentTarget&&u()}var h=vr(),p=He(h);{var _=b=>{var k=Oy();k.__click=d,k.__keydown=de=>de.key==="Escape"&&u();var x=g(k),A=g(x),N=y(g(A),2);N.__click=u;var E=y(A,2),J=g(E);let he;J.__click=()=>C(i,"system");var $=y(J,2);let R;$.__click=()=>C(i,"email");var Y=y($,2);let ne;Y.__click=()=>C(i,"config");var F=y(E,2),fe=g(F);{var we=de=>{var _e=Ry(),ve=y(He(_e),2),ce=g(ve);ae(()=>K(ce,fs)),T(de,_e)},Te=de=>{var _e=Py(),ve=y(He(_e),2),ce=y(g(ve),2);ce.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var V=y(ve,2),Q=y(g(V),2),X=g(Q);ae(ue=>K(X,ue),[o]),T(de,_e)},ye=de=>{var _e=Iy(),ve=y(He(_e),2),ce=g(ve),V=y(g(ce),2),Q=g(V),X=y(ce,2),ue=y(g(X),2),ie=g(ue),oe=y(X,2),se=y(g(oe),2),re=g(se),G=y(ve,4);G.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,ae(()=>{K(Q,rp.maxTokens),K(ie,"false"),K(re,"false")}),T(de,_e)};le(fe,de=>{v(i)==="system"?de(we):v(i)==="email"?de(Te,1):v(i)==="config"&&de(ye,2)})}ae(()=>{he=Tt(J,1,"tab svelte-10pcy9j",null,he,{active:v(i)==="system"}),R=Tt($,1,"tab svelte-10pcy9j",null,R,{active:v(i)==="email"}),ne=Tt(Y,1,"tab svelte-10pcy9j",null,ne,{active:v(i)==="config"})}),T(b,k)};le(p,b=>{r()&&b(_)})}T(t,h),mt()}Ct(["click","keydown"]);var Dy=O('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Ly=O('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),jy=O('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),Ny=O('<button class="chip svelte-s2dwjj"> </button>'),qy=O('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),By=O('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),zy=O('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),Fy=O('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Ky=O('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),Uy=O('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Gy=O('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),Wy=O('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),Hy=O('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),Vy=O('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),Yy=O('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),Qy=O('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Xy(t,e){ht(e,!0);let r=Oe(e,"groupOrder",19,()=>[]),a=Me(!1),i=Me(null),o=Me(!1),u=Me(null);async function d(){var ye;const[F,fe,we]=await Promise.all([Ue.items.where("sourceType").equals("gmail").count(),Ue.emailClassifications.count(),Ue.contacts.count()]);let Te=0;try{const de=await((ye=navigator.storage)==null?void 0:ye.estimate());Te=(de==null?void 0:de.usage)??0}catch{}C(u,{emailCount:F,classCount:fe,contactCount:we,totalBytes:Te},!0)}function h(F){return F?F<1024?`${F} B`:F<1024*1024?`${(F/1024).toFixed(1)} KB`:`${(F/(1024*1024)).toFixed(1)} MB`:"â"}function p(){C(a,!v(a)),v(a)&&d()}async function _(F){var fe;C(o,!0),C(i,null);try{await F(),await d(),(fe=e.onrefresh)==null||fe.call(e)}finally{C(o,!1)}}async function b(){await _(()=>cc())}async function k(F){await _(()=>tl(F))}async function x(){await _(async()=>{await Ju(),await cc()})}async function A(){await _(()=>Ue.contacts.clear())}async function N(){await _(async()=>{await Ue.delete(),window.location.reload()})}function E(F){return F.split("_").map(fe=>fe.charAt(0)+fe.slice(1).toLowerCase()).join(" ")}var J=Qy(),he=g(J);he.__click=p;var $=y(g(he),2);let R;var Y=y(he,2);{var ne=F=>{var fe=Yy(),we=g(fe);{var Te=z=>{var ke=Ly(),Ce=g(ke),ze=g(Ce),Ve=y(Ce,4),ot=g(Ve),Rt=y(Ve,4),Bt=g(Rt),jt=y(Rt,2);{var rt=Be=>{var We=Dy(),gt=y(He(We),2),Pt=g(gt);ae(ln=>K(Pt,`${ln??""} used`),[()=>h(v(u).totalBytes)]),T(Be,We)};le(jt,Be=>{v(u).totalBytes&&Be(rt)})}ae(()=>{K(ze,`${v(u).emailCount??""} emails`),K(ot,`${v(u).classCount??""} classifications`),K(Bt,`${v(u).contactCount??""} contacts`)}),T(z,ke)};le(we,z=>{v(u)&&z(Te)})}var ye=y(we,2);{var de=z=>{var ke=qy(),Ce=y(g(ke),2);St(Ce,21,r,Ft,(ze,Ve)=>{var ot=vr(),Rt=He(ot);{var Bt=rt=>{var Be=jy(),We=g(Be),gt=y(We);gt.__click=()=>C(i,null);var Pt=y(gt,2);Pt.__click=()=>k(v(Ve)),ae(ln=>{K(We,`Delete ${ln??""}? `),Pt.disabled=v(o)},[()=>E(v(Ve))]),T(rt,Be)},jt=rt=>{var Be=Ny();Be.__click=()=>C(i,`group:${v(Ve)}`);var We=g(Be);ae(gt=>{Be.disabled=v(o),K(We,`${gt??""} â`)},[()=>E(v(Ve))]),T(rt,Be)};le(Rt,rt=>{v(i)===`group:${v(Ve)}`?rt(Bt):rt(jt,!1)})}T(ze,ot)}),T(z,ke)};le(ye,z=>{r().length>0&&z(de)})}var _e=y(ye,2),ve=y(g(_e),2),ce=g(ve);{var V=z=>{var ke=By(),Ce=y(g(ke),2);Ce.__click=()=>C(i,null);var ze=y(Ce,2);ze.__click=b,ae(()=>ze.disabled=v(o)),T(z,ke)},Q=z=>{var ke=zy();ke.__click=()=>C(i,"classifications"),ae(()=>ke.disabled=v(o)),T(z,ke)};le(ce,z=>{v(i)==="classifications"?z(V):z(Q,!1)})}var X=y(ce,2);{var ue=z=>{var ke=Fy(),Ce=y(g(ke),2);Ce.__click=()=>C(i,null);var ze=y(Ce,2);ze.__click=x,ae(()=>ze.disabled=v(o)),T(z,ke)},ie=z=>{var ke=Ky();ke.__click=()=>C(i,"emails"),ae(()=>ke.disabled=v(o)),T(z,ke)};le(X,z=>{v(i)==="emails"?z(ue):z(ie,!1)})}var oe=y(X,2);{var se=z=>{var ke=Uy(),Ce=y(g(ke),2);Ce.__click=()=>C(i,null);var ze=y(Ce,2);ze.__click=A,ae(()=>ze.disabled=v(o)),T(z,ke)},re=z=>{var ke=Gy();ke.__click=()=>C(i,"contacts"),ae(()=>ke.disabled=v(o)),T(z,ke)};le(oe,z=>{v(i)==="contacts"?z(se):z(re,!1)})}var G=y(_e,2),H=g(G);{var ee=z=>{var ke=Wy(),Ce=y(g(ke),2);Ce.__click=()=>C(i,null);var ze=y(Ce,2);ze.__click=N,ae(()=>ze.disabled=v(o)),T(z,ke)},me=z=>{var ke=Hy();ke.__click=()=>C(i,"nuke"),ae(()=>ke.disabled=v(o)),T(z,ke)};le(H,z=>{v(i)==="nuke"?z(ee):z(me,!1)})}var De=y(G,2);{var Ne=z=>{var ke=Vy();T(z,ke)};le(De,z=>{v(o)&&z(Ne)})}T(F,fe)};le(Y,F=>{v(a)&&F(ne)})}ae(()=>R=Tt($,0,"chev svelte-s2dwjj",null,R,{open:v(a)})),T(t,J),mt()}Ct(["click"]);var Zy=O('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),Jy=O('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),$y=O('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),eb=O('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <!> <!></div>');function tb(t,e){ht(e,!0);let r=Oe(e,"groups",19,()=>({})),a=Oe(e,"groupOrder",19,()=>[]),i=Oe(e,"counts",19,()=>({})),o=Oe(e,"stats",3,null),u=Oe(e,"expandedGroup",3,null),d=Oe(e,"isScanning",3,!1),h=Oe(e,"scanProgress",3,null),p=Oe(e,"scanCount",15,20),_=Oe(e,"error",3,null),b=Me(!1),k=dt(()=>{for(const ne of a()){const F=r()[ne];if((F==null?void 0:F.length)>0)return F[0]}return null});var x=eb(),A=g(x);uy(A,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return d()},get scanProgress(){return h()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>C(b,!0),get scanCount(){return p()},set scanCount(ne){p(ne)}});var N=y(A,2);My(N,{get sampleEmail(){return v(k)},get open(){return v(b)},set open(ne){C(b,ne,!0)}});var E=y(N,2);{var J=ne=>{var F=Zy(),fe=g(F),we=g(fe),Te=y(fe,2);Te.__click=function(...ye){var de;(de=e.ondismisserror)==null||de.apply(this,ye)},ae(()=>K(we,_())),T(ne,F)};le(E,ne=>{_()&&ne(J)})}var he=y(E,2);{var $=ne=>{var F=Jy(),fe=He(F);St(fe,20,a,de=>de,(de,_e)=>{{let ve=dt(()=>Ro(_e)),ce=dt(()=>{var X;return((X=r()[_e])==null?void 0:X.length)||0}),V=dt(()=>r()[_e]||[]),Q=dt(()=>u()===_e);Cy(de,{get action(){return _e},get color(){return v(ve)},get count(){return v(ce)},get items(){return v(V)},get expanded(){return v(Q)},ontoggle:()=>e.ontogglegroup(_e),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(_e)})}});var we=y(fe,2),Te=g(we),ye=g(Te);ae(()=>K(ye,`${i().total??""} emails classified into ${a().length??""} groups`)),T(ne,F)},R=ne=>{var F=$y();T(ne,F)};le(he,ne=>{i().total>0?ne($):d()||ne(R,1)})}var Y=y(he,2);Xy(Y,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),T(t,x),mt()}Ct(["click"]);var nb=O('<div class="actions-page svelte-3tch4q"><!></div>');function rb(t,e){ht(e,!0);const r=Du();let a=Me(qt(r.status)),i=Me(""),o=Me(qt({})),u=Me(qt([])),d=Me(qt({total:0})),h=Me(null),p=Me(null),_=Me(!1),b=Me(null),k=Me(3),x=Me(null),A=Me(null);const N="me-ai-scan-history";function E(){try{const ve=localStorage.getItem(N);if(ve)return JSON.parse(ve)}catch{}return null}function J(ve){if(!(!ve||ve.phase!=="done"))try{const ce={timestamp:Date.now(),classified:ve.classified||0,errors:ve.errors||0,total:ve.total||0,results:ve.results||[],totals:ve.totals||{},summary:ve.summary||{}};localStorage.setItem(N,JSON.stringify(ce))}catch{}}Xt(()=>{const ve=r.onMessage(V=>{if(V.status==="ready"){C(a,"ready");const Q=ur.find(ie=>ie.id===r.modelId),X=Xn.find(ie=>ie.name===r.modelId),ue=Q||X;C(i,(ue==null?void 0:ue.name)||(ue==null?void 0:ue.displayName)||r.modelId||"",!0)}V.status==="loading"&&C(a,"loading")});if(C(a,r.status,!0),r.modelId){const V=ur.find(ue=>ue.id===r.modelId),Q=Xn.find(ue=>ue.name===r.modelId),X=V||Q;C(i,(X==null?void 0:X.name)||(X==null?void 0:X.displayName)||r.modelId||"",!0)}const ce=E();return ce&&C(b,{phase:"done",...ce},!0),he(),()=>ve()});async function he(){try{const ve=await ap();C(o,ve.groups,!0),C(u,ve.order,!0),C(d,await sp(),!0),C(h,await Co(),!0)}catch(ve){C(x,`Failed to load data: ${ve.message}`)}}async function $(){await Y(!1)}async function R(){await Y(!0)}async function Y(ve){if(v(_)||!r.isReady)return;C(x,null),C(_,!0),C(b,null);const ce=new AbortController;C(A,ce,!0);try{await Hu(r,{count:v(k),force:ve,signal:ce.signal,onProgress:V=>{C(b,{...V},!0),V.phase==="done"&&J(V)}}),await he()}catch(V){ce.signal.aborted||C(x,`Scan failed: ${V.message}`)}finally{C(_,!1),C(A,null)}}function ne(){var ve;(ve=v(A))==null||ve.abort()}async function F(ve){await vi(ve,"acted"),await he()}async function fe(ve){await vi(ve,"dismissed"),await he()}async function we(ve){await Vu(ve),await he()}async function Te(ve){await tl(ve),await he()}function ye(ve){C(p,v(p)===ve?null:ve,!0)}var de=nb(),_e=g(de);tb(_e,{get engineStatus(){return v(a)},get modelName(){return v(i)},get groups(){return v(o)},get groupOrder(){return v(u)},get counts(){return v(d)},get stats(){return v(h)},get expandedGroup(){return v(p)},get isScanning(){return v(_)},get scanProgress(){return v(b)},get error(){return v(x)},onscan:$,onrescan:R,ontogglegroup:ye,onmarkacted:F,ondismiss:fe,onremove:we,oncleargroup:Te,ondismisserror:()=>C(x,null),onstop:ne,onrefresh:he,oncloseprogress:()=>{C(b,null),localStorage.removeItem(N)},get scanCount(){return v(k)},set scanCount(ve){C(k,ve,!0)}}),T(t,de),mt()}var ab=O('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function sb(t,e){ht(e,!0);function r(){const F=location.hash;return F==="#dashboard"?"dashboard":F==="#actions"?"actions":"chat"}let a=Me(qt(r()));Xt(()=>{function F(){C(a,r(),!0)}return window.addEventListener("hashchange",F),()=>window.removeEventListener("hashchange",F)});var i=ab(),o=g(i),u=y(g(o),2),d=g(u);let h;var p=y(d,2);let _;var b=y(p,2);let k;var x=y(o,2),A=g(x);let N;var E=g(A);tm(E,{});var J=y(A,2);let he;var $=g(J);rb($,{});var R=y(J,2);let Y;var ne=g(R);L_(ne,{}),ae(()=>{h=Tt(d,1,"svelte-1n46o8q",null,h,{active:v(a)==="chat"}),_=Tt(p,1,"svelte-1n46o8q",null,_,{active:v(a)==="actions"}),k=Tt(b,1,"svelte-1n46o8q",null,k,{active:v(a)==="dashboard"}),N=hn(A,"",N,{display:v(a)==="chat"?"flex":"none"}),he=hn(J,"",he,{display:v(a)==="actions"?"flex":"none"}),Y=hn(R,"",Y,{display:v(a)==="dashboard"?"flex":"none"})}),T(t,i),mt()}rv(sb,{target:document.getElementById("app")});
