var hv=Object.defineProperty;var lc=t=>{throw TypeError(t)};var mv=(t,e,n)=>e in t?hv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var kt=(t,e,n)=>mv(t,typeof e!="symbol"?e+"":e,n),ho=(t,e,n)=>e.has(t)||lc("Cannot "+n);var _e=(t,e,n)=>(ho(t,e,"read from private field"),n?n.call(t):e.get(t)),xt=(t,e,n)=>e.has(t)?lc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),_t=(t,e,n,a)=>(ho(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),An=(t,e,n)=>(ho(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Oo=!1;var rl=Array.isArray,gv=Array.prototype.indexOf,Ja=Array.prototype.includes,Ri=Array.from,_v=Object.defineProperty,Ga=Object.getOwnPropertyDescriptor,yv=Object.getOwnPropertyDescriptors,bv=Object.prototype,wv=Array.prototype,ru=Object.getPrototypeOf,cc=Object.isExtensible;const kv=()=>{};function xv(t){for(var e=0;e<t.length;e++)t[e]()}function au(){var t,e,n=new Promise((a,s)=>{t=a,e=s});return{promise:n,resolve:t,reject:e}}const xn=2,Rs=4,Mi=8,su=1<<24,Wr=16,yr=32,Da=64,iu=128,ir=512,_n=1024,Sn=2048,_r=4096,Zn=8192,Kr=16384,zs=32768,$a=65536,uc=1<<17,ou=1<<18,as=1<<19,Sv=1<<20,zr=1<<25,Ca=65536,Ro=1<<21,al=1<<22,na=1<<23,Ta=Symbol("$state"),Ev=Symbol("legacy props"),Tv=Symbol(""),ga=new class extends Error{constructor(){super(...arguments);kt(this,"name","StaleReactionError");kt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Av(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Iv(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Cv(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function Pv(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ov(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Rv(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Mv(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function jv(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Dv(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Lv(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Nv(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function qv(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Bv=1,Fv=2,lu=4,zv=8,Uv=16,Kv=1,Gv=4,Hv=8,Wv=16,cu=1,Vv=2,bn=Symbol(),uu="http://www.w3.org/1999/xhtml";function Yv(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Qv(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function du(t){return t===this.v}function Xv(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function vu(t){return!Xv(t,this.v)}let Zv=!1,Jn=null;function es(t){Jn=t}function Nt(t,e=!1,n){Jn={p:Jn,i:!1,c:null,e:null,s:t,x:null,l:null}}function qt(t){var e=Jn,n=e.e;if(n!==null){e.e=null;for(var a of n)ju(a)}return t!==void 0&&(e.x=t),e.i=!0,Jn=e.p,t??{}}function fu(){return!0}let _a=[];function pu(){var t=_a;_a=[],xv(t)}function ra(t){if(_a.length===0&&!As){var e=_a;queueMicrotask(()=>{e===_a&&pu()})}_a.push(t)}function Jv(){for(;_a.length>0;)pu()}function hu(t){var e=Ut;if(e===null)return St.f|=na,t;if((e.f&zs)===0&&(e.f&Rs)===0)throw t;ts(t,e)}function ts(t,e){for(;e!==null;){if((e.f&iu)!==0){if((e.f&zs)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const $v=-7169;function dn(t,e){t.f=t.f&$v|e}function sl(t){(t.f&ir)!==0||t.deps===null?dn(t,_n):dn(t,_r)}function mu(t){if(t!==null)for(const e of t)(e.f&xn)===0||(e.f&Ca)===0||(e.f^=Ca,mu(e.deps))}function gu(t,e,n){(t.f&Sn)!==0?e.add(t):(t.f&_r)!==0&&n.add(t),mu(t.deps),dn(t,_n)}const ci=new Set;let ht=null,xi=null,wn=null,Un=[],ji=null,Mo=!1,As=!1;var Ha,Wa,ba,Va,Ns,qs,wa,Nr,Ya,Mr,jo,Do,_u;const jl=class jl{constructor(){xt(this,Mr);kt(this,"committed",!1);kt(this,"current",new Map);kt(this,"previous",new Map);xt(this,Ha,new Set);xt(this,Wa,new Set);xt(this,ba,0);xt(this,Va,0);xt(this,Ns,null);xt(this,qs,new Set);xt(this,wa,new Set);xt(this,Nr,new Map);kt(this,"is_fork",!1);xt(this,Ya,!1)}is_deferred(){return this.is_fork||_e(this,Va)>0}skip_effect(e){_e(this,Nr).has(e)||_e(this,Nr).set(e,{d:[],m:[]})}unskip_effect(e){var n=_e(this,Nr).get(e);if(n){_e(this,Nr).delete(e);for(var a of n.d)dn(a,Sn),mr(a);for(a of n.m)dn(a,_r),mr(a)}}process(e){var s;Un=[],this.apply();var n=[],a=[];for(const o of e)An(this,Mr,jo).call(this,o,n,a);if(this.is_deferred()){An(this,Mr,Do).call(this,a),An(this,Mr,Do).call(this,n);for(const[o,u]of _e(this,Nr))ku(o,u)}else{for(const o of _e(this,Ha))o();_e(this,Ha).clear(),_e(this,ba)===0&&An(this,Mr,_u).call(this),xi=this,ht=null,dc(a),dc(n),xi=null,(s=_e(this,Ns))==null||s.resolve()}wn=null}capture(e,n){n!==bn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&na)===0&&(this.current.set(e,e.v),wn==null||wn.set(e,e.v))}activate(){ht=this,this.apply()}deactivate(){ht===this&&(ht=null,wn=null)}flush(){if(this.activate(),Un.length>0){if(yu(),ht!==null&&ht!==this)return}else _e(this,ba)===0&&this.process([]);this.deactivate()}discard(){for(const e of _e(this,Wa))e(this);_e(this,Wa).clear()}increment(e){_t(this,ba,_e(this,ba)+1),e&&_t(this,Va,_e(this,Va)+1)}decrement(e){_t(this,ba,_e(this,ba)-1),e&&_t(this,Va,_e(this,Va)-1),!_e(this,Ya)&&(_t(this,Ya,!0),ra(()=>{_t(this,Ya,!1),this.is_deferred()?Un.length>0&&this.flush():this.revive()}))}revive(){for(const e of _e(this,qs))_e(this,wa).delete(e),dn(e,Sn),mr(e);for(const e of _e(this,wa))dn(e,_r),mr(e);this.flush()}oncommit(e){_e(this,Ha).add(e)}ondiscard(e){_e(this,Wa).add(e)}settled(){return(_e(this,Ns)??_t(this,Ns,au())).promise}static ensure(){if(ht===null){const e=ht=new jl;ci.add(ht),As||ra(()=>{ht===e&&e.flush()})}return ht}apply(){}};Ha=new WeakMap,Wa=new WeakMap,ba=new WeakMap,Va=new WeakMap,Ns=new WeakMap,qs=new WeakMap,wa=new WeakMap,Nr=new WeakMap,Ya=new WeakMap,Mr=new WeakSet,jo=function(e,n,a){e.f^=_n;for(var s=e.first,o=null;s!==null;){var u=s.f,d=(u&(yr|Da))!==0,g=d&&(u&_n)!==0,_=g||(u&Zn)!==0||_e(this,Nr).has(s);if(!_&&s.fn!==null){d?s.f^=_n:o!==null&&(u&(Rs|Mi|su))!==0?o.b.defer_effect(s):(u&Rs)!==0?n.push(s):Ks(s)&&((u&Wr)!==0&&_e(this,wa).add(s),rs(s));var h=s.first;if(h!==null){s=h;continue}}var x=s.parent;for(s=s.next;s===null&&x!==null;)x===o&&(o=null),s=x.next,x=x.parent}},Do=function(e){for(var n=0;n<e.length;n+=1)gu(e[n],_e(this,qs),_e(this,wa))},_u=function(){var s;if(ci.size>1){this.previous.clear();var e=wn,n=!0;for(const o of ci){if(o===this){n=!1;continue}const u=[];for(const[g,_]of this.current){if(o.current.has(g))if(n&&_!==o.current.get(g))o.current.set(g,_);else continue;u.push(g)}if(u.length===0)continue;const d=[...o.current.keys()].filter(g=>!this.current.has(g));if(d.length>0){var a=Un;Un=[];const g=new Set,_=new Map;for(const h of u)bu(h,d,g,_);if(Un.length>0){ht=o,o.apply();for(const h of Un)An(s=o,Mr,jo).call(s,h,[],[]);o.deactivate()}Un=a}}ht=null,wn=e}this.committed=!0,ci.delete(this)};let aa=jl;function ef(t){var e=As;As=!0;try{for(var n;;){if(Jv(),Un.length===0&&(ht==null||ht.flush(),Un.length===0))return ji=null,n;yu()}}finally{As=e}}function yu(){Mo=!0;var t=null;try{for(var e=0;Un.length>0;){var n=aa.ensure();if(e++>1e3){var a,s;tf()}n.process(Un),sa.clear()}}finally{Un=[],Mo=!1,ji=null}}function tf(){try{Mv()}catch(t){ts(t,ji)}}let dr=null;function dc(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Kr|Zn))===0&&Ks(a)&&(dr=new Set,rs(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&qu(a),(dr==null?void 0:dr.size)>0)){sa.clear();for(const s of dr){if((s.f&(Kr|Zn))!==0)continue;const o=[s];let u=s.parent;for(;u!==null;)dr.has(u)&&(dr.delete(u),o.push(u)),u=u.parent;for(let d=o.length-1;d>=0;d--){const g=o[d];(g.f&(Kr|Zn))===0&&rs(g)}}dr.clear()}}dr=null}}function bu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&xn)!==0?bu(s,e,n,a):(o&(al|Wr))!==0&&(o&Sn)===0&&wu(s,e,a)&&(dn(s,Sn),mr(s))}}function wu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const s of t.deps){if(Ja.call(e,s))return!0;if((s.f&xn)!==0&&wu(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function mr(t){for(var e=ji=t;e.parent!==null;){e=e.parent;var n=e.f;if(Mo&&e===Ut&&(n&Wr)!==0&&(n&ou)===0)return;if((n&(Da|yr))!==0){if((n&_n)===0)return;e.f^=_n}}Un.push(e)}function ku(t,e){if(!((t.f&yr)!==0&&(t.f&_n)!==0)){(t.f&Sn)!==0?e.d.push(t):(t.f&_r)!==0&&e.m.push(t),dn(t,_n);for(var n=t.first;n!==null;)ku(n,e),n=n.next}}function nf(t){let e=0,n=Pa(0),a;return()=>{ll()&&(l(n),cl(()=>(e===0&&(a=Gs(()=>t(()=>Is(n)))),e+=1,()=>{ra(()=>{e-=1,e===0&&(a==null||a(),a=void 0,Is(n))})})))}}var rf=$a|as|iu;function af(t,e,n){new sf(t,e,n)}var nr,nl,Er,ka,Tr,rr,Fn,Ar,qr,ea,xa,ta,Qa,Sa,Xa,Za,Br,Pi,yn,of,lf,Lo,gi,_i,No;class sf{constructor(e,n,a){xt(this,yn);kt(this,"parent");kt(this,"is_pending",!1);xt(this,nr);xt(this,nl,null);xt(this,Er);xt(this,ka);xt(this,Tr);xt(this,rr,null);xt(this,Fn,null);xt(this,Ar,null);xt(this,qr,null);xt(this,ea,null);xt(this,xa,0);xt(this,ta,0);xt(this,Qa,!1);xt(this,Sa,!1);xt(this,Xa,new Set);xt(this,Za,new Set);xt(this,Br,null);xt(this,Pi,nf(()=>(_t(this,Br,Pa(_e(this,xa))),()=>{_t(this,Br,null)})));_t(this,nr,e),_t(this,Er,n),_t(this,ka,a),this.parent=Ut.b,this.is_pending=!!_e(this,Er).pending,_t(this,Tr,ul(()=>{Ut.b=this;{var s=An(this,yn,Lo).call(this);try{_t(this,rr,ar(()=>a(s)))}catch(o){this.error(o)}_e(this,ta)>0?An(this,yn,_i).call(this):this.is_pending=!1}return()=>{var o;(o=_e(this,ea))==null||o.remove()}},rf))}defer_effect(e){gu(e,_e(this,Xa),_e(this,Za))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!_e(this,Er).pending}update_pending_count(e){An(this,yn,No).call(this,e),_t(this,xa,_e(this,xa)+e),!(!_e(this,Br)||_e(this,Qa))&&(_t(this,Qa,!0),ra(()=>{_t(this,Qa,!1),_e(this,Br)&&ns(_e(this,Br),_e(this,xa))}))}get_effect_pending(){return _e(this,Pi).call(this),l(_e(this,Br))}error(e){var n=_e(this,Er).onerror;let a=_e(this,Er).failed;if(_e(this,Sa)||!n&&!a)throw e;_e(this,rr)&&(Gn(_e(this,rr)),_t(this,rr,null)),_e(this,Fn)&&(Gn(_e(this,Fn)),_t(this,Fn,null)),_e(this,Ar)&&(Gn(_e(this,Ar)),_t(this,Ar,null));var s=!1,o=!1;const u=()=>{if(s){Qv();return}s=!0,o&&qv(),aa.ensure(),_t(this,xa,0),_e(this,Ar)!==null&&Aa(_e(this,Ar),()=>{_t(this,Ar,null)}),this.is_pending=this.has_pending_snippet(),_t(this,rr,An(this,yn,gi).call(this,()=>(_t(this,Sa,!1),ar(()=>_e(this,ka).call(this,_e(this,nr)))))),_e(this,ta)>0?An(this,yn,_i).call(this):this.is_pending=!1};ra(()=>{try{o=!0,n==null||n(e,u),o=!1}catch(d){ts(d,_e(this,Tr)&&_e(this,Tr).parent)}a&&_t(this,Ar,An(this,yn,gi).call(this,()=>{aa.ensure(),_t(this,Sa,!0);try{return ar(()=>{a(_e(this,nr),()=>e,()=>u)})}catch(d){return ts(d,_e(this,Tr).parent),null}finally{_t(this,Sa,!1)}}))})}}nr=new WeakMap,nl=new WeakMap,Er=new WeakMap,ka=new WeakMap,Tr=new WeakMap,rr=new WeakMap,Fn=new WeakMap,Ar=new WeakMap,qr=new WeakMap,ea=new WeakMap,xa=new WeakMap,ta=new WeakMap,Qa=new WeakMap,Sa=new WeakMap,Xa=new WeakMap,Za=new WeakMap,Br=new WeakMap,Pi=new WeakMap,yn=new WeakSet,of=function(){try{_t(this,rr,ar(()=>_e(this,ka).call(this,_e(this,nr))))}catch(e){this.error(e)}},lf=function(){const e=_e(this,Er).pending;e&&(_t(this,Fn,ar(()=>e(_e(this,nr)))),ra(()=>{var n=An(this,yn,Lo).call(this);_t(this,rr,An(this,yn,gi).call(this,()=>(aa.ensure(),ar(()=>_e(this,ka).call(this,n))))),_e(this,ta)>0?An(this,yn,_i).call(this):(Aa(_e(this,Fn),()=>{_t(this,Fn,null)}),this.is_pending=!1)}))},Lo=function(){var e=_e(this,nr);return this.is_pending&&(_t(this,ea,Gr()),_e(this,nr).before(_e(this,ea)),e=_e(this,ea)),e},gi=function(e){var n=Ut,a=St,s=Jn;Or(_e(this,Tr)),lr(_e(this,Tr)),es(_e(this,Tr).ctx);try{return e()}catch(o){return hu(o),null}finally{Or(n),lr(a),es(s)}},_i=function(){const e=_e(this,Er).pending;_e(this,rr)!==null&&(_t(this,qr,document.createDocumentFragment()),_e(this,qr).append(_e(this,ea)),zu(_e(this,rr),_e(this,qr))),_e(this,Fn)===null&&_t(this,Fn,ar(()=>e(_e(this,nr))))},No=function(e){var n;if(!this.has_pending_snippet()){this.parent&&An(n=this.parent,yn,No).call(n,e);return}if(_t(this,ta,_e(this,ta)+e),_e(this,ta)===0){this.is_pending=!1;for(const a of _e(this,Xa))dn(a,Sn),mr(a);for(const a of _e(this,Za))dn(a,_r),mr(a);_e(this,Xa).clear(),_e(this,Za).clear(),_e(this,Fn)&&Aa(_e(this,Fn),()=>{_t(this,Fn,null)}),_e(this,qr)&&(_e(this,nr).before(_e(this,qr)),_t(this,qr,null))}};function cf(t,e,n,a){const s=Di;var o=t.filter(b=>!b.settled);if(n.length===0&&o.length===0){a(e.map(s));return}var u=ht,d=Ut,g=uf(),_=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(b=>b.promise)):null;function h(b){g();try{a(b)}catch(w){(d.f&Kr)===0&&ts(w,d)}u==null||u.deactivate(),qo()}if(n.length===0){_.then(()=>h(e.map(s)));return}function x(){g(),Promise.all(n.map(b=>df(b))).then(b=>h([...e.map(s),...b])).catch(b=>ts(b,d))}_?_.then(x):x()}function uf(){var t=Ut,e=St,n=Jn,a=ht;return function(o=!0){Or(t),lr(e),es(n),o&&(a==null||a.activate())}}function qo(){Or(null),lr(null),es(null)}function Di(t){var e=xn|Sn,n=St!==null&&(St.f&xn)!==0?St:null;return Ut!==null&&(Ut.f|=as),{ctx:Jn,deps:null,effects:null,equals:du,f:e,fn:t,reactions:null,rv:0,v:bn,wv:0,parent:n??Ut,ac:null}}function df(t,e,n){let a=Ut;a===null&&Iv();var s=a.b,o=void 0,u=Pa(bn),d=!St,g=new Map;return Ef(()=>{var w;var _=au();o=_.promise;try{Promise.resolve(t()).then(_.resolve,_.reject).then(()=>{h===ht&&h.committed&&h.deactivate(),qo()})}catch(I){_.reject(I),qo()}var h=ht;if(d){var x=s.is_rendered();s.update_pending_count(1),h.increment(x),(w=g.get(h))==null||w.reject(ga),g.delete(h),g.set(h,_)}const b=(I,D=void 0)=>{if(h.activate(),D)D!==ga&&(u.f|=na,ns(u,D));else{(u.f&na)!==0&&(u.f^=na),ns(u,I);for(const[O,ie]of g){if(g.delete(O),O===h)break;ie.reject(ga)}}d&&(s.update_pending_count(-1),h.decrement(x))};_.promise.then(b,I=>b(null,I||"unknown"))}),Mu(()=>{for(const _ of g.values())_.reject(ga)}),new Promise(_=>{function h(x){function b(){x===o?_(u):h(o)}x.then(b,b)}h(o)})}function st(t){const e=Di(t);return Uu(e),e}function xu(t){const e=Di(t);return e.equals=vu,e}function vf(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Gn(e[n])}}function ff(t){for(var e=t.parent;e!==null;){if((e.f&xn)===0)return(e.f&Kr)===0?e:null;e=e.parent}return null}function il(t){var e,n=Ut;Or(ff(t));try{t.f&=~Ca,vf(t),e=Wu(t)}finally{Or(n)}return e}function Su(t){var e=il(t);if(!t.equals(e)&&(t.wv=Gu(),(!(ht!=null&&ht.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){dn(t,_n);return}ia||(wn!==null?(ll()||ht!=null&&ht.is_fork)&&wn.set(t,e):sl(t))}function pf(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(ga),a.teardown=kv,a.ac=null,Ms(a,0),dl(a))}function Eu(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&rs(e)}let Bo=new Set;const sa=new Map;let Tu=!1;function Pa(t,e){var n={f:0,v:t,reactions:null,equals:du,rv:0,wv:0};return n}function Pe(t,e){const n=Pa(t);return Uu(n),n}function hf(t,e=!1,n=!0){const a=Pa(t);return e||(a.equals=vu),a}function A(t,e,n=!1){St!==null&&(!gr||(St.f&uc)!==0)&&fu()&&(St.f&(xn|Wr|al|uc))!==0&&(or===null||!Ja.call(or,t))&&Nv();let a=n?Yt(e):e;return ns(t,a)}function ns(t,e){if(!t.equals(e)){var n=t.v;ia?sa.set(t,e):sa.set(t,n),t.v=e;var a=aa.ensure();if(a.capture(t,n),(t.f&xn)!==0){const s=t;(t.f&Sn)!==0&&il(s),sl(s)}t.wv=Gu(),Au(t,Sn),Ut!==null&&(Ut.f&_n)!==0&&(Ut.f&(yr|Da))===0&&(tr===null?Af([t]):tr.push(t)),!a.is_fork&&Bo.size>0&&!Tu&&mf()}return e}function mf(){Tu=!1;for(const t of Bo)(t.f&_n)!==0&&dn(t,_r),Ks(t)&&rs(t);Bo.clear()}function Is(t){A(t,t.v+1)}function Au(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,s=0;s<a;s++){var o=n[s],u=o.f,d=(u&Sn)===0;if(d&&dn(o,e),(u&xn)!==0){var g=o;wn==null||wn.delete(g),(u&Ca)===0&&(u&ir&&(o.f|=Ca),Au(g,_r))}else d&&((u&Wr)!==0&&dr!==null&&dr.add(o),mr(o))}}function Yt(t){if(typeof t!="object"||t===null||Ta in t)return t;const e=ru(t);if(e!==bv&&e!==wv)return t;var n=new Map,a=rl(t),s=Pe(0),o=Ia,u=d=>{if(Ia===o)return d();var g=St,_=Ia;lr(null),mc(o);var h=d();return lr(g),mc(_),h};return a&&n.set("length",Pe(t.length)),new Proxy(t,{defineProperty(d,g,_){(!("value"in _)||_.configurable===!1||_.enumerable===!1||_.writable===!1)&&Dv();var h=n.get(g);return h===void 0?u(()=>{var x=Pe(_.value);return n.set(g,x),x}):A(h,_.value,!0),!0},deleteProperty(d,g){var _=n.get(g);if(_===void 0){if(g in d){const h=u(()=>Pe(bn));n.set(g,h),Is(s)}}else A(_,bn),Is(s);return!0},get(d,g,_){var w;if(g===Ta)return t;var h=n.get(g),x=g in d;if(h===void 0&&(!x||(w=Ga(d,g))!=null&&w.writable)&&(h=u(()=>{var I=Yt(x?d[g]:bn),D=Pe(I);return D}),n.set(g,h)),h!==void 0){var b=l(h);return b===bn?void 0:b}return Reflect.get(d,g,_)},getOwnPropertyDescriptor(d,g){var _=Reflect.getOwnPropertyDescriptor(d,g);if(_&&"value"in _){var h=n.get(g);h&&(_.value=l(h))}else if(_===void 0){var x=n.get(g),b=x==null?void 0:x.v;if(x!==void 0&&b!==bn)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return _},has(d,g){var b;if(g===Ta)return!0;var _=n.get(g),h=_!==void 0&&_.v!==bn||Reflect.has(d,g);if(_!==void 0||Ut!==null&&(!h||(b=Ga(d,g))!=null&&b.writable)){_===void 0&&(_=u(()=>{var w=h?Yt(d[g]):bn,I=Pe(w);return I}),n.set(g,_));var x=l(_);if(x===bn)return!1}return h},set(d,g,_,h){var he;var x=n.get(g),b=g in d;if(a&&g==="length")for(var w=_;w<x.v;w+=1){var I=n.get(w+"");I!==void 0?A(I,bn):w in d&&(I=u(()=>Pe(bn)),n.set(w+"",I))}if(x===void 0)(!b||(he=Ga(d,g))!=null&&he.writable)&&(x=u(()=>Pe(void 0)),A(x,Yt(_)),n.set(g,x));else{b=x.v!==bn;var D=u(()=>Yt(_));A(x,D)}var O=Reflect.getOwnPropertyDescriptor(d,g);if(O!=null&&O.set&&O.set.call(h,_),!b){if(a&&typeof g=="string"){var ie=n.get("length"),de=Number(g);Number.isInteger(de)&&de>=ie.v&&A(ie,de+1)}Is(s)}return!0},ownKeys(d){l(s);var g=Reflect.ownKeys(d).filter(x=>{var b=n.get(x);return b===void 0||b.v!==bn});for(var[_,h]of n)h.v!==bn&&!(_ in d)&&g.push(_);return g},setPrototypeOf(){Lv()}})}function vc(t){try{if(t!==null&&typeof t=="object"&&Ta in t)return t[Ta]}catch{}return t}function gf(t,e){return Object.is(vc(t),vc(e))}var fc,Iu,Cu,Pu;function _f(){if(fc===void 0){fc=window,Iu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Cu=Ga(e,"firstChild").get,Pu=Ga(e,"nextSibling").get,cc(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),cc(n)&&(n.__t=void 0)}}function Gr(t=""){return document.createTextNode(t)}function Xn(t){return Cu.call(t)}function Us(t){return Pu.call(t)}function f(t,e){return Xn(t)}function $e(t,e=!1){{var n=Xn(t);return n instanceof Comment&&n.data===""?Us(n):n}}function m(t,e=1,n=!1){let a=t;for(;e--;)a=Us(a);return a}function yf(t){t.textContent=""}function Ou(){return!1}function bf(t,e,n){return document.createElementNS(uu,t,void 0)}let pc=!1;function wf(){pc||(pc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function ol(t){var e=St,n=Ut;lr(null),Or(null);try{return t()}finally{lr(e),Or(n)}}function Ru(t,e,n,a=n){t.addEventListener(e,()=>ol(n));const s=t.__on_r;s?t.__on_r=()=>{s(),a(!0)}:t.__on_r=()=>a(!0),wf()}function kf(t){Ut===null&&(St===null&&Rv(),Ov()),ia&&Pv()}function xf(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Vr(t,e,n){var a=Ut;a!==null&&(a.f&Zn)!==0&&(t|=Zn);var s={ctx:Jn,deps:null,nodes:null,f:t|Sn|ir,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{rs(s)}catch(d){throw Gn(s),d}else e!==null&&mr(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&as)===0&&(o=o.first,(t&Wr)!==0&&(t&$a)!==0&&o!==null&&(o.f|=$a)),o!==null&&(o.parent=a,a!==null&&xf(o,a),St!==null&&(St.f&xn)!==0&&(t&Da)===0)){var u=St;(u.effects??(u.effects=[])).push(o)}return s}function ll(){return St!==null&&!gr}function Mu(t){const e=Vr(Mi,null,!1);return dn(e,_n),e.teardown=t,e}function Oa(t){kf();var e=Ut.f,n=!St&&(e&yr)!==0&&(e&zs)===0;if(n){var a=Jn;(a.e??(a.e=[])).push(t)}else return ju(t)}function ju(t){return Vr(Rs|Sv,t,!1)}function Sf(t){aa.ensure();const e=Vr(Da|as,t,!0);return(n={})=>new Promise(a=>{n.outro?Aa(e,()=>{Gn(e),a(void 0)}):(Gn(e),a(void 0))})}function Du(t){return Vr(Rs,t,!1)}function Ef(t){return Vr(al|as,t,!0)}function cl(t,e=0){return Vr(Mi|e,t,!0)}function Q(t,e=[],n=[],a=[]){cf(a,e,n,s=>{Vr(Mi,()=>t(...s.map(l)),!0)})}function ul(t,e=0){var n=Vr(Wr|e,t,!0);return n}function ar(t){return Vr(yr|as,t,!0)}function Lu(t){var e=t.teardown;if(e!==null){const n=ia,a=St;hc(!0),lr(null);try{e.call(null)}finally{hc(n),lr(a)}}}function dl(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&ol(()=>{s.abort(ga)});var a=n.next;(n.f&Da)!==0?n.parent=null:Gn(n,e),n=a}}function Tf(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&yr)===0&&Gn(e),e=n}}function Gn(t,e=!0){var n=!1;(e||(t.f&ou)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Nu(t.nodes.start,t.nodes.end),n=!0),dl(t,e&&!n),Ms(t,0),dn(t,Kr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();Lu(t);var s=t.parent;s!==null&&s.first!==null&&qu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Nu(t,e){for(;t!==null;){var n=t===e?null:Us(t);t.remove(),t=n}}function qu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function Aa(t,e,n=!0){var a=[];Bu(t,a,!0);var s=()=>{n&&Gn(t),e&&e()},o=a.length;if(o>0){var u=()=>--o||s();for(var d of a)d.out(u)}else s()}function Bu(t,e,n){if((t.f&Zn)===0){t.f^=Zn;var a=t.nodes&&t.nodes.t;if(a!==null)for(const d of a)(d.is_global||n)&&e.push(d);for(var s=t.first;s!==null;){var o=s.next,u=(s.f&$a)!==0||(s.f&yr)!==0&&(t.f&Wr)!==0;Bu(s,e,u?n:!1),s=o}}}function vl(t){Fu(t,!0)}function Fu(t,e){if((t.f&Zn)!==0){t.f^=Zn,(t.f&_n)===0&&(dn(t,Sn),mr(t));for(var n=t.first;n!==null;){var a=n.next,s=(n.f&$a)!==0||(n.f&yr)!==0;Fu(n,s?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const u of o)(u.is_global||e)&&u.in()}}function zu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var s=n===a?null:Us(n);e.append(n),n=s}}let yi=!1,ia=!1;function hc(t){ia=t}let St=null,gr=!1;function lr(t){St=t}let Ut=null;function Or(t){Ut=t}let or=null;function Uu(t){St!==null&&(or===null?or=[t]:or.push(t))}let Kn=null,Yn=0,tr=null;function Af(t){tr=t}let Ku=1,ya=0,Ia=ya;function mc(t){Ia=t}function Gu(){return++Ku}function Ks(t){var e=t.f;if((e&Sn)!==0)return!0;if(e&xn&&(t.f&=~Ca),(e&_r)!==0){for(var n=t.deps,a=n.length,s=0;s<a;s++){var o=n[s];if(Ks(o)&&Su(o),o.wv>t.wv)return!0}(e&ir)!==0&&wn===null&&dn(t,_n)}return!1}function Hu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(or!==null&&Ja.call(or,t)))for(var s=0;s<a.length;s++){var o=a[s];(o.f&xn)!==0?Hu(o,e,!1):e===o&&(n?dn(o,Sn):(o.f&_n)!==0&&dn(o,_r),mr(o))}}function Wu(t){var D;var e=Kn,n=Yn,a=tr,s=St,o=or,u=Jn,d=gr,g=Ia,_=t.f;Kn=null,Yn=0,tr=null,St=(_&(yr|Da))===0?t:null,or=null,es(t.ctx),gr=!1,Ia=++ya,t.ac!==null&&(ol(()=>{t.ac.abort(ga)}),t.ac=null);try{t.f|=Ro;var h=t.fn,x=h();t.f|=zs;var b=t.deps,w=ht==null?void 0:ht.is_fork;if(Kn!==null){var I;if(w||Ms(t,Yn),b!==null&&Yn>0)for(b.length=Yn+Kn.length,I=0;I<Kn.length;I++)b[Yn+I]=Kn[I];else t.deps=b=Kn;if(ll()&&(t.f&ir)!==0)for(I=Yn;I<b.length;I++)((D=b[I]).reactions??(D.reactions=[])).push(t)}else!w&&b!==null&&Yn<b.length&&(Ms(t,Yn),b.length=Yn);if(fu()&&tr!==null&&!gr&&b!==null&&(t.f&(xn|_r|Sn))===0)for(I=0;I<tr.length;I++)Hu(tr[I],t);if(s!==null&&s!==t){if(ya++,s.deps!==null)for(let O=0;O<n;O+=1)s.deps[O].rv=ya;if(e!==null)for(const O of e)O.rv=ya;tr!==null&&(a===null?a=tr:a.push(...tr))}return(t.f&na)!==0&&(t.f^=na),x}catch(O){return hu(O)}finally{t.f^=Ro,Kn=e,Yn=n,tr=a,St=s,or=o,es(u),gr=d,Ia=g}}function If(t,e){let n=e.reactions;if(n!==null){var a=gv.call(n,t);if(a!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[a]=n[s],n.pop())}}if(n===null&&(e.f&xn)!==0&&(Kn===null||!Ja.call(Kn,e))){var o=e;(o.f&ir)!==0&&(o.f^=ir,o.f&=~Ca),sl(o),pf(o),Ms(o,0)}}function Ms(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)If(t,n[a])}function rs(t){var e=t.f;if((e&Kr)===0){dn(t,_n);var n=Ut,a=yi;Ut=t,yi=!0;try{(e&(Wr|su))!==0?Tf(t):dl(t),Lu(t);var s=Wu(t);t.teardown=typeof s=="function"?s:null,t.wv=Ku;var o;Oo&&Zv&&(t.f&Sn)!==0&&t.deps}finally{yi=a,Ut=n}}}async function Vu(){await Promise.resolve(),ef()}function l(t){var e=t.f,n=(e&xn)!==0;if(St!==null&&!gr){var a=Ut!==null&&(Ut.f&Kr)!==0;if(!a&&(or===null||!Ja.call(or,t))){var s=St.deps;if((St.f&Ro)!==0)t.rv<ya&&(t.rv=ya,Kn===null&&s!==null&&s[Yn]===t?Yn++:Kn===null?Kn=[t]:Kn.push(t));else{(St.deps??(St.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[St]:Ja.call(o,St)||o.push(St)}}}if(ia&&sa.has(t))return sa.get(t);if(n){var u=t;if(ia){var d=u.v;return((u.f&_n)===0&&u.reactions!==null||Qu(u))&&(d=il(u)),sa.set(u,d),d}var g=(u.f&ir)===0&&!gr&&St!==null&&(yi||(St.f&ir)!==0),_=(u.f&zs)===0;Ks(u)&&(g&&(u.f|=ir),Su(u)),g&&!_&&(Eu(u),Yu(u))}if(wn!=null&&wn.has(t))return wn.get(t);if((t.f&na)!==0)throw t.v;return t.v}function Yu(t){if(t.f|=ir,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&xn)!==0&&(e.f&ir)===0&&(Eu(e),Yu(e))}function Qu(t){if(t.v===bn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(sa.has(e)||(e.f&xn)!==0&&Qu(e))return!0;return!1}function Gs(t){var e=gr;try{return gr=!0,t()}finally{gr=e}}const Cf=["touchstart","touchmove"];function Pf(t){return Cf.includes(t)}const Xu=new Set,Fo=new Set;function en(t){for(var e=0;e<t.length;e++)Xu.add(t[e]);for(var n of Fo)n(t)}let gc=null;function _c(t){var O;var e=this,n=e.ownerDocument,a=t.type,s=((O=t.composedPath)==null?void 0:O.call(t))||[],o=s[0]||t.target;gc=t;var u=0,d=gc===t&&t.__root;if(d){var g=s.indexOf(d);if(g!==-1&&(e===document||e===window)){t.__root=e;return}var _=s.indexOf(e);if(_===-1)return;g<=_&&(u=g)}if(o=s[u]||t.target,o!==e){_v(t,"currentTarget",{configurable:!0,get(){return o||n}});var h=St,x=Ut;lr(null),Or(null);try{for(var b,w=[];o!==null;){var I=o.assignedSlot||o.parentNode||o.host||null;try{var D=o["__"+a];D!=null&&(!o.disabled||t.target===o)&&D.call(o,t)}catch(ie){b?w.push(ie):b=ie}if(t.cancelBubble||I===e||I===null)break;o=I}if(b){for(let ie of w)queueMicrotask(()=>{throw ie});throw b}}finally{t.__root=e,delete t.currentTarget,lr(h),Or(x)}}}var eu,tu;const mo=(tu=(eu=globalThis==null?void 0:globalThis.window)==null?void 0:eu.trustedTypes)==null?void 0:tu.createPolicy("svelte-trusted-html",{createHTML:t=>t});function Of(t){return(mo==null?void 0:mo.createHTML(t))??t}function fl(t,e=!1){var n=bf("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?Of(t):t,n.content}function Ra(t,e){var n=Ut;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function T(t,e){var n=(e&cu)!==0,a=(e&Vv)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=fl(o?t:"<!>"+t,!0),n||(s=Xn(s)));var u=a||Iu?document.importNode(s,!0):s.cloneNode(!0);if(n){var d=Xn(u),g=u.lastChild;Ra(d,g)}else Ra(u,u);return u}}function Rf(t,e,n="svg"){var a=!t.startsWith("<!>"),s=(e&cu)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,u;return()=>{if(!u){var d=fl(o,!0),g=Xn(d);if(s)for(u=document.createDocumentFragment();Xn(g);)u.appendChild(Xn(g));else u=Xn(g)}var _=u.cloneNode(!0);if(s){var h=Xn(_),x=_.lastChild;Ra(h,x)}else Ra(_,_);return _}}function pl(t,e){return Rf(t,e,"svg")}function fn(t=""){{var e=Gr(t+"");return Ra(e,e),e}}function Rn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Gr();return t.append(e,n),Ra(e,n),t}function S(t,e){t!==null&&t.before(e)}function C(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Mf(t,e){return jf(t,e)}const ui=new Map;function jf(t,{target:e,anchor:n,props:a={},events:s,context:o,intro:u=!0}){_f();var d=new Set,g=x=>{for(var b=0;b<x.length;b++){var w=x[b];if(!d.has(w)){d.add(w);var I=Pf(w);for(const ie of[e,document]){var D=ui.get(ie);D===void 0&&(D=new Map,ui.set(ie,D));var O=D.get(w);O===void 0?(ie.addEventListener(w,_c,{passive:I}),D.set(w,1)):D.set(w,O+1)}}}};g(Ri(Xu)),Fo.add(g);var _=void 0,h=Sf(()=>{var x=n??e.appendChild(Gr());return af(x,{pending:()=>{}},b=>{Nt({});var w=Jn;o&&(w.c=o),s&&(a.$$events=s),_=t(b,a)||{},qt()}),()=>{var D;for(var b of d)for(const O of[e,document]){var w=ui.get(O),I=w.get(b);--I==0?(O.removeEventListener(b,_c),w.delete(b),w.size===0&&ui.delete(O)):w.set(b,I)}Fo.delete(g),x!==n&&((D=x.parentNode)==null||D.removeChild(x))}});return Df.set(_,h),_}let Df=new WeakMap;var fr,Ir,Qn,Ea,Bs,Fs,Oi;class Lf{constructor(e,n=!0){kt(this,"anchor");xt(this,fr,new Map);xt(this,Ir,new Map);xt(this,Qn,new Map);xt(this,Ea,new Set);xt(this,Bs,!0);xt(this,Fs,()=>{var e=ht;if(_e(this,fr).has(e)){var n=_e(this,fr).get(e),a=_e(this,Ir).get(n);if(a)vl(a),_e(this,Ea).delete(n);else{var s=_e(this,Qn).get(n);s&&(_e(this,Ir).set(n,s.effect),_e(this,Qn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),a=s.effect)}for(const[o,u]of _e(this,fr)){if(_e(this,fr).delete(o),o===e)break;const d=_e(this,Qn).get(u);d&&(Gn(d.effect),_e(this,Qn).delete(u))}for(const[o,u]of _e(this,Ir)){if(o===n||_e(this,Ea).has(o))continue;const d=()=>{if(Array.from(_e(this,fr).values()).includes(o)){var _=document.createDocumentFragment();zu(u,_),_.append(Gr()),_e(this,Qn).set(o,{effect:u,fragment:_})}else Gn(u);_e(this,Ea).delete(o),_e(this,Ir).delete(o)};_e(this,Bs)||!a?(_e(this,Ea).add(o),Aa(u,d,!1)):d()}}});xt(this,Oi,e=>{_e(this,fr).delete(e);const n=Array.from(_e(this,fr).values());for(const[a,s]of _e(this,Qn))n.includes(a)||(Gn(s.effect),_e(this,Qn).delete(a))});this.anchor=e,_t(this,Bs,n)}ensure(e,n){var a=ht,s=Ou();if(n&&!_e(this,Ir).has(e)&&!_e(this,Qn).has(e))if(s){var o=document.createDocumentFragment(),u=Gr();o.append(u),_e(this,Qn).set(e,{effect:ar(()=>n(u)),fragment:o})}else _e(this,Ir).set(e,ar(()=>n(this.anchor)));if(_e(this,fr).set(a,e),s){for(const[d,g]of _e(this,Ir))d===e?a.unskip_effect(g):a.skip_effect(g);for(const[d,g]of _e(this,Qn))d===e?a.unskip_effect(g.effect):a.skip_effect(g.effect);a.oncommit(_e(this,Fs)),a.ondiscard(_e(this,Oi))}else _e(this,Fs).call(this)}}fr=new WeakMap,Ir=new WeakMap,Qn=new WeakMap,Ea=new WeakMap,Bs=new WeakMap,Fs=new WeakMap,Oi=new WeakMap;function Z(t,e,n=!1){var a=new Lf(t),s=n?$a:0;function o(u,d){a.ensure(u,d)}ul(()=>{var u=!1;e((d,g=0)=>{u=!0,o(g,d)}),u||o(!1,null)},s)}function Lt(t,e){return e}function Nf(t,e,n){for(var a=[],s=e.length,o,u=e.length,d=0;d<s;d++){let x=e[d];Aa(x,()=>{if(o){if(o.pending.delete(x),o.done.add(x),o.pending.size===0){var b=t.outrogroups;zo(Ri(o.done)),b.delete(o),b.size===0&&(t.outrogroups=null)}}else u-=1},!1)}if(u===0){var g=a.length===0&&n!==null;if(g){var _=n,h=_.parentNode;yf(h),h.append(_),t.items.clear()}zo(e,!g)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function zo(t,e=!0){for(var n=0;n<t.length;n++)Gn(t[n],e)}var yc;function bt(t,e,n,a,s,o=null){var u=t,d=new Map,g=(e&lu)!==0;if(g){var _=t;u=_.appendChild(Gr())}var h=null,x=xu(()=>{var ie=n();return rl(ie)?ie:ie==null?[]:Ri(ie)}),b,w=!0;function I(){O.fallback=h,qf(O,b,u,e,a),h!==null&&(b.length===0?(h.f&zr)===0?vl(h):(h.f^=zr,Es(h,null,u)):Aa(h,()=>{h=null}))}var D=ul(()=>{b=l(x);for(var ie=b.length,de=new Set,he=ht,V=Ou(),U=0;U<ie;U+=1){var q=b[U],P=a(q,U),le=w?null:d.get(P);le?(le.v&&ns(le.v,q),le.i&&ns(le.i,U),V&&he.unskip_effect(le.e)):(le=Bf(d,w?u:yc??(yc=Gr()),q,P,U,s,e,n),w||(le.e.f|=zr),d.set(P,le)),de.add(P)}if(ie===0&&o&&!h&&(w?h=ar(()=>o(u)):(h=ar(()=>o(yc??(yc=Gr()))),h.f|=zr)),ie>de.size&&Cv(),!w)if(V){for(const[ke,xe]of d)de.has(ke)||he.skip_effect(xe.e);he.oncommit(I),he.ondiscard(()=>{})}else I();l(x)}),O={effect:D,items:d,outrogroups:null,fallback:h};w=!1}function gs(t){for(;t!==null&&(t.f&yr)===0;)t=t.next;return t}function qf(t,e,n,a,s){var xe,we,J,ge,Te,ae,X,me,M;var o=(a&zv)!==0,u=e.length,d=t.items,g=gs(t.effect.first),_,h=null,x,b=[],w=[],I,D,O,ie;if(o)for(ie=0;ie<u;ie+=1)I=e[ie],D=s(I,ie),O=d.get(D).e,(O.f&zr)===0&&((we=(xe=O.nodes)==null?void 0:xe.a)==null||we.measure(),(x??(x=new Set)).add(O));for(ie=0;ie<u;ie+=1){if(I=e[ie],D=s(I,ie),O=d.get(D).e,t.outrogroups!==null)for(const ee of t.outrogroups)ee.pending.delete(O),ee.done.delete(O);if((O.f&zr)!==0)if(O.f^=zr,O===g)Es(O,null,n);else{var de=h?h.next:g;O===t.effect.last&&(t.effect.last=O.prev),O.prev&&(O.prev.next=O.next),O.next&&(O.next.prev=O.prev),Jr(t,h,O),Jr(t,O,de),Es(O,de,n),h=O,b=[],w=[],g=gs(h.next);continue}if((O.f&Zn)!==0&&(vl(O),o&&((ge=(J=O.nodes)==null?void 0:J.a)==null||ge.unfix(),(x??(x=new Set)).delete(O))),O!==g){if(_!==void 0&&_.has(O)){if(b.length<w.length){var he=w[0],V;h=he.prev;var U=b[0],q=b[b.length-1];for(V=0;V<b.length;V+=1)Es(b[V],he,n);for(V=0;V<w.length;V+=1)_.delete(w[V]);Jr(t,U.prev,q.next),Jr(t,h,U),Jr(t,q,he),g=he,h=q,ie-=1,b=[],w=[]}else _.delete(O),Es(O,g,n),Jr(t,O.prev,O.next),Jr(t,O,h===null?t.effect.first:h.next),Jr(t,h,O),h=O;continue}for(b=[],w=[];g!==null&&g!==O;)(_??(_=new Set)).add(g),w.push(g),g=gs(g.next);if(g===null)continue}(O.f&zr)===0&&b.push(O),h=O,g=gs(O.next)}if(t.outrogroups!==null){for(const ee of t.outrogroups)ee.pending.size===0&&(zo(Ri(ee.done)),(Te=t.outrogroups)==null||Te.delete(ee));t.outrogroups.size===0&&(t.outrogroups=null)}if(g!==null||_!==void 0){var P=[];if(_!==void 0)for(O of _)(O.f&Zn)===0&&P.push(O);for(;g!==null;)(g.f&Zn)===0&&g!==t.fallback&&P.push(g),g=gs(g.next);var le=P.length;if(le>0){var ke=(a&lu)!==0&&u===0?n:null;if(o){for(ie=0;ie<le;ie+=1)(X=(ae=P[ie].nodes)==null?void 0:ae.a)==null||X.measure();for(ie=0;ie<le;ie+=1)(M=(me=P[ie].nodes)==null?void 0:me.a)==null||M.fix()}Nf(t,P,ke)}}o&&ra(()=>{var ee,fe;if(x!==void 0)for(O of x)(fe=(ee=O.nodes)==null?void 0:ee.a)==null||fe.apply()})}function Bf(t,e,n,a,s,o,u,d){var g=(u&Bv)!==0?(u&Uv)===0?hf(n,!1,!1):Pa(n):null,_=(u&Fv)!==0?Pa(s):null;return{v:g,i:_,e:ar(()=>(o(e,g??n,_??s,d),()=>{t.delete(a)}))}}function Es(t,e,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,o=e&&(e.f&zr)===0?e.nodes.start:n;a!==null;){var u=Us(a);if(o.before(a),a===s)return;a=u}}function Jr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Ff(t,e,n=!1,a=!1,s=!1){var o=t,u="";Q(()=>{var d=Ut;if(u!==(u=e()??"")&&(d.nodes!==null&&(Nu(d.nodes.start,d.nodes.end),d.nodes=null),u!=="")){var g=u+"";n?g=`<svg>${g}</svg>`:a&&(g=`<math>${g}</math>`);var _=fl(g);if((n||a)&&(_=Xn(_)),Ra(Xn(_),_.lastChild),n||a)for(;Xn(_);)o.before(Xn(_));else o.before(_)}})}const bc=[...` 	
\r\fÂ \v\uFEFF`];function zf(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var s in n)if(n[s])a=a?a+" "+s:s;else if(a.length)for(var o=s.length,u=0;(u=a.indexOf(s,u))>=0;){var d=u+o;(u===0||bc.includes(a[u-1]))&&(d===a.length||bc.includes(a[d]))?a=(u===0?"":a.substring(0,u))+a.substring(d+1):u=d}}return a===""?null:a}function wc(t,e=!1){var n=e?" !important;":";",a="";for(var s in t){var o=t[s];o!=null&&o!==""&&(a+=" "+s+": "+o+n)}return a}function go(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Uf(t,e){if(e){var n="",a,s;if(Array.isArray(e)?(a=e[0],s=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,u=0,d=!1,g=[];a&&g.push(...Object.keys(a).map(go)),s&&g.push(...Object.keys(s).map(go));var _=0,h=-1;const D=t.length;for(var x=0;x<D;x++){var b=t[x];if(d?b==="/"&&t[x-1]==="*"&&(d=!1):o?o===b&&(o=!1):b==="/"&&t[x+1]==="*"?d=!0:b==='"'||b==="'"?o=b:b==="("?u++:b===")"&&u--,!d&&o===!1&&u===0){if(b===":"&&h===-1)h=x;else if(b===";"||x===D-1){if(h!==-1){var w=go(t.substring(_,h).trim());if(!g.includes(w)){b!==";"&&x++;var I=t.substring(_,x).trim();n+=" "+I+";"}}_=x+1,h=-1}}}}return a&&(n+=wc(a)),s&&(n+=wc(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Bt(t,e,n,a,s,o){var u=t.__className;if(u!==n||u===void 0){var d=zf(n,a,o);d==null?t.removeAttribute("class"):e?t.className=d:t.setAttribute("class",d),t.__className=n}else if(o&&s!==o)for(var g in o){var _=!!o[g];(s==null||_!==!!s[g])&&t.classList.toggle(g,_)}return o}function _o(t,e={},n,a){for(var s in n){var o=n[s];e[s]!==o&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,o,a))}}function vn(t,e,n,a){var s=t.__style;if(s!==e){var o=Uf(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(_o(t,n==null?void 0:n[0],a[0]),_o(t,n==null?void 0:n[1],a[1],"important")):_o(t,n,a));return a}function Zu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!rl(e))return Yv();for(var a of t.options)a.selected=e.includes(Cs(a));return}for(a of t.options){var s=Cs(a);if(gf(s,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Kf(t){var e=new MutationObserver(()=>{Zu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Mu(()=>{e.disconnect()})}function Hs(t,e,n=e){var a=new WeakSet,s=!0;Ru(t,"change",o=>{var u=o?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(u),Cs);else{var g=t.querySelector(u)??t.querySelector("option:not([disabled])");d=g&&Cs(g)}n(d),ht!==null&&a.add(ht)}),Du(()=>{var o=e();if(t===document.activeElement){var u=xi??ht;if(a.has(u))return}if(Zu(t,o,s),s&&o===void 0){var d=t.querySelector(":checked");d!==null&&(o=Cs(d),n(o))}t.__value=o,s=!1}),Kf(t)}function Cs(t){return"__value"in t?t.__value:t.value}const Gf=Symbol("is custom element"),Hf=Symbol("is html");function sr(t,e,n,a){var s=Wf(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[Tv]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Vf(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Wf(t){return t.__attributes??(t.__attributes={[Gf]:t.nodeName.includes("-"),[Hf]:t.namespaceURI===uu})}var kc=new Map;function Vf(t){var e=t.getAttribute("is")||t.nodeName,n=kc.get(e);if(n)return n;kc.set(e,n=[]);for(var a,s=t,o=Element.prototype;o!==s;){a=yv(s);for(var u in a)a[u].set&&n.push(u);s=ru(s)}return n}function Ur(t,e,n=e){var a=new WeakSet;Ru(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=yo(t)?bo(o):o,n(o),ht!==null&&a.add(ht),await Vu(),o!==(o=e())){var u=t.selectionStart,d=t.selectionEnd,g=t.value.length;if(t.value=o??"",d!==null){var _=t.value.length;u===d&&d===g&&_>g?(t.selectionStart=_,t.selectionEnd=_):(t.selectionStart=u,t.selectionEnd=Math.min(d,_))}}}),Gs(e)==null&&t.value&&(n(yo(t)?bo(t.value):t.value),ht!==null&&a.add(ht)),cl(()=>{var s=e();if(t===document.activeElement){var o=xi??ht;if(a.has(o))return}yo(t)&&s===bo(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function yo(t){var e=t.type;return e==="number"||e==="range"}function bo(t){return t===""?null:+t}function xc(t,e){return t===e||(t==null?void 0:t[Ta])===e}function Ju(t={},e,n,a){return Du(()=>{var s,o;return cl(()=>{s=o,o=[],Gs(()=>{t!==n(...o)&&(e(t,...o),s&&xc(n(...s),t)&&e(null,...s))})}),()=>{ra(()=>{o&&xc(n(...o),t)&&e(null,...o)})}}),t}let di=!1;function Yf(t){var e=di;try{return di=!1,[t(),di]}finally{di=e}}function De(t,e,n,a){var de;var s=(n&Hv)!==0,o=(n&Wv)!==0,u=a,d=!0,g=()=>(d&&(d=!1,u=o?Gs(a):a),u),_;if(s){var h=Ta in t||Ev in t;_=((de=Ga(t,e))==null?void 0:de.set)??(h&&e in t?he=>t[e]=he:void 0)}var x,b=!1;s?[x,b]=Yf(()=>t[e]):x=t[e],x===void 0&&a!==void 0&&(x=g(),_&&(jv(),_(x)));var w;if(w=()=>{var he=t[e];return he===void 0?g():(d=!0,he)},(n&Gv)===0)return w;if(_){var I=t.$$legacy;return(function(he,V){return arguments.length>0?((!V||I||b)&&_(V?w():he),he):w()})}var D=!1,O=((n&Kv)!==0?Di:xu)(()=>(D=!1,w()));s&&l(O);var ie=Ut;return(function(he,V){if(arguments.length>0){const U=V?l(O):s?Yt(he):he;return A(O,U),D=!0,u!==void 0&&(u=U),he}return ia&&D||(ie.f&Kr)!==0?O.v:l(O)})}function En(t){Jn===null&&Av(),Oa(()=>{const e=Gs(t);if(typeof e=="function")return e})}const Qf="5";var nu;typeof window<"u"&&((nu=window.__svelte??(window.__svelte={})).v??(nu.v=new Set)).add(Qf);var Xf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var bi={exports:{}},Jf=bi.exports,Sc;function $f(){return Sc||(Sc=1,(function(t,e){((n,a)=>{t.exports=a()})(Jf,function(){var n=function(r,i){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(c,v){c.__proto__=v}:function(c,v){for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&(c[p]=v[p])}))(r,i)},a=function(){return(a=Object.assign||function(r){for(var i,c=1,v=arguments.length;c<v;c++)for(var p in i=arguments[c])Object.prototype.hasOwnProperty.call(i,p)&&(r[p]=i[p]);return r}).apply(this,arguments)};function s(r,i,c){for(var v,p=0,y=i.length;p<y;p++)!v&&p in i||((v=v||Array.prototype.slice.call(i,0,p))[p]=i[p]);return r.concat(v||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Xf,u=Object.keys,d=Array.isArray;function g(r,i){return typeof i=="object"&&u(i).forEach(function(c){r[c]=i[c]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var _=Object.getPrototypeOf,h={}.hasOwnProperty;function x(r,i){return h.call(r,i)}function b(r,i){typeof i=="function"&&(i=i(_(r))),(typeof Reflect>"u"?u:Reflect.ownKeys)(i).forEach(function(c){I(r,c,i[c])})}var w=Object.defineProperty;function I(r,i,c,v){w(r,i,g(c&&x(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},v))}function D(r){return{from:function(i){return r.prototype=Object.create(i.prototype),I(r.prototype,"constructor",r),{extend:b.bind(null,r.prototype)}}}}var O=Object.getOwnPropertyDescriptor,ie=[].slice;function de(r,i,c){return ie.call(r,i,c)}function he(r,i){return i(r)}function V(r){if(!r)throw new Error("Assertion Failed")}function U(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function q(r,i){if(typeof i=="string"&&x(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var c=[],v=0,p=i.length;v<p;++v){var y=q(r,i[v]);c.push(y)}return c}var k,E=i.indexOf(".");return E===-1||(k=r[i.substr(0,E)])==null?void 0:q(k,i.substr(E+1))}function P(r,i,c){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){V(typeof c!="string"&&"length"in c);for(var v=0,p=i.length;v<p;++v)P(r,i[v],c[v])}else{var y,k,E=i.indexOf(".");E!==-1?(y=i.substr(0,E),(E=i.substr(E+1))===""?c===void 0?d(r)&&!isNaN(parseInt(y))?r.splice(y,1):delete r[y]:r[y]=c:P(k=(k=r[y])&&x(r,y)?k:r[y]={},E,c)):c===void 0?d(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=c}}function le(r){var i,c={};for(i in r)x(r,i)&&(c[i]=r[i]);return c}var ke=[].concat;function xe(r){return ke.apply([],r)}var oe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(xe([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),we=new Set(oe.map(function(r){return o[r]})),J=null;function ge(r){return J=new WeakMap,r=(function i(c){if(!c||typeof c!="object")return c;var v=J.get(c);if(v)return v;if(d(c)){v=[],J.set(c,v);for(var p=0,y=c.length;p<y;++p)v.push(i(c[p]))}else if(we.has(c.constructor))v=c;else{var k,E=_(c);for(k in v=E===Object.prototype?{}:Object.create(E),J.set(c,v),c)x(c,k)&&(v[k]=i(c[k]))}return v})(r),J=null,r}var Te={}.toString;function ae(r){return Te.call(r).slice(8,-1)}var X=typeof Symbol<"u"?Symbol.iterator:"@@iterator",me=typeof X=="symbol"?function(r){var i;return r!=null&&(i=r[X])&&i.apply(r)}:function(){return null};function M(r,i){i=r.indexOf(i),0<=i&&r.splice(i,1)}var ee={};function fe(r){var i,c,v,p;if(arguments.length===1){if(d(r))return r.slice();if(this===ee&&typeof r=="string")return[r];if(p=me(r))for(c=[];!(v=p.next()).done;)c.push(v.value);else{if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(c=new Array(i);i--;)c[i]=r[i]}}else for(i=arguments.length,c=new Array(i);i--;)c[i]=arguments[i];return c}var pe=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},oe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(oe),R={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Y(r,i){this.name=r,this.message=i}function re(r,i){return r+". Errors: "+Object.keys(i).map(function(c){return i[c].toString()}).filter(function(c,v,p){return p.indexOf(c)===v}).join(`
`)}function G(r,i,c,v){this.failures=i,this.failedKeys=v,this.successCount=c,this.message=re(r,i)}function ve(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(c){return i[c]}),this.failuresByPos=i,this.message=re(r,this.failures)}D(Y).from(Error).extend({toString:function(){return this.name+": "+this.message}}),D(G).from(Y),D(ve).from(Y);var ye=Ve.reduce(function(r,i){return r[i]=i+"Error",r},{}),ne=Y,K=Ve.reduce(function(r,i){var c=i+"Error";function v(p,y){this.name=c,p?typeof p=="string"?(this.message="".concat(p).concat(y?`
 `+y:""),this.inner=y||null):typeof p=="object"&&(this.message="".concat(p.name," ").concat(p.message),this.inner=p):(this.message=R[i]||c,this.inner=null)}return D(v).from(ne),r[i]=v,r},{}),Se=(K.Syntax=SyntaxError,K.Type=TypeError,K.Range=RangeError,oe.reduce(function(r,i){return r[i+"Error"]=K[i],r},{}));oe=Ve.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=K[i]),r},{});function ce(){}function Oe(r){return r}function qe(r,i){return r==null||r===Oe?i:function(c){return i(r(c))}}function Ke(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function ut(r,i){return r===ce?i:function(){var c=r.apply(this,arguments),v=(c!==void 0&&(arguments[0]=c),this.onsuccess),p=this.onerror,y=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?Ke(v,this.onsuccess):v),p&&(this.onerror=this.onerror?Ke(p,this.onerror):p),y!==void 0?y:c}}function wt(r,i){return r===ce?i:function(){r.apply(this,arguments);var c=this.onsuccess,v=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?Ke(c,this.onsuccess):c),v&&(this.onerror=this.onerror?Ke(v,this.onerror):v)}}function Ze(r,i){return r===ce?i:function(p){var v=r.apply(this,arguments),p=(g(p,v),this.onsuccess),y=this.onerror,k=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return p&&(this.onsuccess=this.onsuccess?Ke(p,this.onsuccess):p),y&&(this.onerror=this.onerror?Ke(y,this.onerror):y),v===void 0?k===void 0?void 0:k:g(v,k)}}function Be(r,i){return r===ce?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Fe(r,i){return r===ce?i:function(){var c=r.apply(this,arguments);if(c&&typeof c.then=="function"){for(var v=this,p=arguments.length,y=new Array(p);p--;)y[p]=arguments[p];return c.then(function(){return i.apply(v,y)})}return i.apply(this,arguments)}}oe.ModifyError=G,oe.DexieError=Y,oe.BulkError=ve;var He=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function it(r){He=r}var lt={},et=100,ct=typeof Promise>"u"?[]:(Ve=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[ct=crypto.subtle.digest("SHA-512",new Uint8Array([0])),_(ct),Ve]:[Ve,_(Ve),Ve]),Ve=ct[0],za=ct[1],za=za&&za.then,ze=Ve&&Ve.constructor,mt=!!ct[2],ot=function(r,i){Wt.push([r,i]),Kt&&(queueMicrotask(tn),Kt=!1)},Ht=!0,Kt=!0,dt=[],Je=[],ft=Oe,at={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ce,pgp:!1,env:{},finalize:ce},Me=at,Wt=[],zt=0,At=[];function Ee(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Me;if(typeof r!="function"){if(r!==lt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&pn(this,this._value)}else this._state=null,this._value=null,++i.ref,(function c(v,p){try{p(function(y){if(v._state===null){if(y===v)throw new TypeError("A promise cannot be resolved with itself.");var k=v._lib&&mn();y&&typeof y.then=="function"?c(v,function(E,B){y instanceof Ee?y._then(E,B):y.then(E,B)}):(v._state=!0,v._value=y,Cn(v)),k&&rt()}},pn.bind(null,v))}catch(y){pn(v,y)}})(this,r)}var Qt={get:function(){var r=Me,i=Et;function c(v,p){var y=this,k=!r.global&&(r!==Me||i!==Et),E=k&&!on(),B=new Ee(function(te,F){hn(y,new Dn(L(v,r,k,E),L(p,r,k,E),te,F,r))});return this._consoleTask&&(B._consoleTask=this._consoleTask),B}return c.prototype=lt,c},set:function(r){I(this,"then",r&&r.prototype===lt?Qt:{get:function(){return r},set:Qt.set})}};function Dn(r,i,c,v,p){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=c,this.reject=v,this.psd=p}function pn(r,i){var c,v;Je.push(i),r._state===null&&(c=r._lib&&mn(),i=ft(i),r._state=!1,r._value=i,v=r,dt.some(function(p){return p._value===v._value})||dt.push(v),Cn(r),c)&&rt()}function Cn(r){var i=r._listeners;r._listeners=[];for(var c=0,v=i.length;c<v;++c)hn(r,i[c]);var p=r._PSD;--p.ref||p.finalize(),zt===0&&(++zt,ot(function(){--zt==0&&tt()},[]))}function hn(r,i){if(r._state===null)r._listeners.push(i);else{var c=r._state?i.onFulfilled:i.onRejected;if(c===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++zt,ot(Pt,[c,r,i])}}function Pt(r,i,c){try{var v,p=i._value;!i._state&&Je.length&&(Je=[]),v=He&&i._consoleTask?i._consoleTask.run(function(){return r(p)}):r(p),i._state||Je.indexOf(p)!==-1||(y=>{for(var k=dt.length;k;)if(dt[--k]._value===y._value)return dt.splice(k,1)})(i),c.resolve(v)}catch(y){c.reject(y)}finally{--zt==0&&tt(),--c.psd.ref||c.psd.finalize()}}function tn(){Ye(at,function(){mn()&&rt()})}function mn(){var r=Ht;return Kt=Ht=!1,r}function rt(){var r,i,c;do for(;0<Wt.length;)for(r=Wt,Wt=[],c=r.length,i=0;i<c;++i){var v=r[i];v[0].apply(null,v[1])}while(0<Wt.length);Kt=Ht=!0}function tt(){for(var r=dt,i=(dt=[],r.forEach(function(v){v._PSD.onunhandled.call(null,v._value,v)}),At.slice(0)),c=i.length;c;)i[--c]()}function Ot(r){return new Ee(lt,!1,r)}function Xe(r,i){var c=Me;return function(){var v=mn(),p=Me;try{return Nn(c,!0),r.apply(this,arguments)}catch(y){i&&i(y)}finally{Nn(p,!1),v&&rt()}}}b(Ee.prototype,{then:Qt,_then:function(r,i){hn(this,new Dn(null,null,r,i,Me))},catch:function(r){var i,c;return arguments.length===1?this.then(null,r):(i=r,c=arguments[1],typeof i=="function"?this.then(null,function(v){return(v instanceof i?c:Ot)(v)}):this.then(null,function(v){return(v&&v.name===i?c:Ot)(v)}))},finally:function(r){return this.then(function(i){return Ee.resolve(r()).then(function(){return i})},function(i){return Ee.resolve(r()).then(function(){return Ot(i)})})},timeout:function(r,i){var c=this;return r<1/0?new Ee(function(v,p){var y=setTimeout(function(){return p(new K.Timeout(i))},r);c.then(v,p).finally(clearTimeout.bind(null,y))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(Ee.prototype,Symbol.toStringTag,"Dexie.Promise"),at.env=Na(),b(Ee,{all:function(){var r=fe.apply(null,arguments).map(Ln);return new Ee(function(i,c){r.length===0&&i([]);var v=r.length;r.forEach(function(p,y){return Ee.resolve(p).then(function(k){r[y]=k,--v||i(r)},c)})})},resolve:function(r){return r instanceof Ee?r:r&&typeof r.then=="function"?new Ee(function(i,c){r.then(i,c)}):new Ee(lt,!0,r)},reject:Ot,race:function(){var r=fe.apply(null,arguments).map(Ln);return new Ee(function(i,c){r.map(function(v){return Ee.resolve(v).then(i,c)})})},PSD:{get:function(){return Me},set:function(r){return Me=r}},totalEchoes:{get:function(){return Et}},newPSD:sn,usePSD:Ye,scheduler:{get:function(){return ot},set:function(r){ot=r}},rejectionMapper:{get:function(){return ft},set:function(r){ft=r}},follow:function(r,i){return new Ee(function(c,v){return sn(function(p,y){var k=Me;k.unhandleds=[],k.onunhandled=y,k.finalize=Ke(function(){var E,B=this;E=function(){B.unhandleds.length===0?p():y(B.unhandleds[0])},At.push(function te(){E(),At.splice(At.indexOf(te),1)}),++zt,ot(function(){--zt==0&&tt()},[])},k.finalize),r()},i,c,v)})}}),ze&&(ze.allSettled&&I(Ee,"allSettled",function(){var r=fe.apply(null,arguments).map(Ln);return new Ee(function(i){r.length===0&&i([]);var c=r.length,v=new Array(c);r.forEach(function(p,y){return Ee.resolve(p).then(function(k){return v[y]={status:"fulfilled",value:k}},function(k){return v[y]={status:"rejected",reason:k}}).then(function(){return--c||i(v)})})})}),ze.any&&typeof AggregateError<"u"&&I(Ee,"any",function(){var r=fe.apply(null,arguments).map(Ln);return new Ee(function(i,c){r.length===0&&c(new AggregateError([]));var v=r.length,p=new Array(v);r.forEach(function(y,k){return Ee.resolve(y).then(function(E){return i(E)},function(E){p[k]=E,--v||c(new AggregateError(p))})})})}),ze.withResolvers)&&(Ee.withResolvers=ze.withResolvers);var vt={awaits:0,echoes:0,id:0},Gt=0,Jt=[],an=0,Et=0,Vt=0;function sn(r,k,c,v){var p=Me,y=Object.create(p),k=(y.parent=p,y.ref=0,y.global=!1,y.id=++Vt,at.env,y.env=mt?{Promise:Ee,PromiseProp:{value:Ee,configurable:!0,writable:!0},all:Ee.all,race:Ee.race,allSettled:Ee.allSettled,any:Ee.any,resolve:Ee.resolve,reject:Ee.reject}:{},k&&g(y,k),++p.ref,y.finalize=function(){--this.parent.ref||this.parent.finalize()},Ye(y,r,c,v));return y.ref===0&&y.finalize(),k}function Rt(){return vt.id||(vt.id=++Gt),++vt.awaits,vt.echoes+=et,vt.id}function on(){return!!vt.awaits&&(--vt.awaits==0&&(vt.id=0),vt.echoes=vt.awaits*et,!0)}function Ln(r){return vt.echoes&&r&&r.constructor===ze?(Rt(),r.then(function(i){return on(),i},function(i){return on(),je(i)})):r}function br(){var r=Jt[Jt.length-1];Jt.pop(),Nn(r,!1)}function Nn(r,i){var c,v,p=Me;(i?!vt.echoes||an++&&r===Me:!an||--an&&r===Me)||queueMicrotask(i?(function(y){++Et,vt.echoes&&--vt.echoes!=0||(vt.echoes=vt.awaits=vt.id=0),Jt.push(Me),Nn(y,!0)}).bind(null,r):br),r!==Me&&(Me=r,p===at&&(at.env=Na()),mt)&&(c=at.env.Promise,v=r.env,p.global||r.global)&&(Object.defineProperty(o,"Promise",v.PromiseProp),c.all=v.all,c.race=v.race,c.resolve=v.resolve,c.reject=v.reject,v.allSettled&&(c.allSettled=v.allSettled),v.any)&&(c.any=v.any)}function Na(){var r=o.Promise;return mt?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ye(r,i,c,v,p){var y=Me;try{return Nn(r,!0),i(c,v,p)}finally{Nn(y,!1)}}function L(r,i,c,v){return typeof r!="function"?r:function(){var p=Me;c&&Rt(),Nn(i,!0);try{return r.apply(this,arguments)}finally{Nn(p,!1),v&&queueMicrotask(on)}}}function Ce(r){Promise===ze&&vt.echoes===0?an===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+za).indexOf("[native code]")===-1&&(Rt=on=ce);var je=Ee.reject,Mt="ï¿¿",Xt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",nn="String expected.",cn=[],qn="__dbnames",wr="readonly",la="readwrite";function $t(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var os={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ca(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=ge(i))[r],i}}function Dl(){throw K.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Tt(r,i){try{var c=Ll(r),v=Ll(i);if(c!==v)return c==="Array"?1:v==="Array"?-1:c==="binary"?1:v==="binary"?-1:c==="string"?1:v==="string"?-1:c==="Date"?1:v!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":for(var p=Nl(r),y=Nl(i),k=p.length,E=y.length,B=k<E?k:E,te=0;te<B;++te)if(p[te]!==y[te])return p[te]<y[te]?-1:1;return k===E?0:k<E?-1:1;case"Array":for(var F=r,j=i,H=F.length,W=j.length,z=H<W?H:W,N=0;N<z;++N){var se=Tt(F[N],j[N]);if(se!==0)return se}return H===W?0:H<W?-1:1}}catch{}return NaN}function Ll(r){var i=typeof r;return i=="object"&&(ArrayBuffer.isView(r)||(i=ae(r))==="ArrayBuffer")?"binary":i}function Nl(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Ys(r,i,c){var v=r.schema.yProps;return v?(i&&0<c.numFailures&&(i=i.filter(function(p,y){return!c.failures[y]})),Promise.all(v.map(function(p){return p=p.updatesTable,i?r.db.table(p).where("k").anyOf(i).delete():r.db.table(p).clear()})).then(function(){return c})):c}ql.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var c=i.add;if(d(c))return s(s([],d(r)?r:[],!0),c).sort();if(typeof c=="number")return(Number(r)||0)+c;if(typeof c=="bigint")try{return BigInt(r)+c}catch{return BigInt(0)+c}throw new TypeError("Invalid term ".concat(c))}if(i.remove!==void 0){var v=i.remove;if(d(v))return d(r)?r.filter(function(p){return!v.includes(p)}).sort():[];if(typeof v=="number")return Number(r)-v;if(typeof v=="bigint")try{return BigInt(r)-v}catch{return BigInt(0)-v}throw new TypeError("Invalid subtrahend ".concat(v))}return c=(c=i.replacePrefix)==null?void 0:c[0],c&&typeof r=="string"&&r.startsWith(c)?i.replacePrefix[1]+r.substring(c.length):r};var ls=ql;function ql(r){this["@@propmod"]=r}function Bl(r,i){for(var c=u(i),v=c.length,p=!1,y=0;y<v;++y){var k=c[y],E=i[k],B=q(r,k);E instanceof ls?(P(r,k,E.execute(B)),p=!0):B!==E&&(P(r,k,E),p=!0)}return p}Zt.prototype._trans=function(r,i,c){var v=this._tx||Me.trans,p=this.name,y=He&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function k(te,F,j){if(j.schema[p])return i(j.idbtrans,j);throw new K.NotFound("Table "+p+" not part of transaction")}var E=mn();try{var B=v&&v.db._novip===this.db._novip?v===Me.trans?v._promise(r,k,c):sn(function(){return v._promise(r,k,c)},{trans:v,transless:Me.transless||Me}):(function te(F,j,H,W){if(F.idbdb&&(F._state.openComplete||Me.letThrough||F._vip)){var z=F._createTransaction(j,H,F._dbSchema);try{z.create(),F._state.PR1398_maxLoop=3}catch(N){return N.name===ye.InvalidState&&F.isOpen()&&0<--F._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),F.close({disableAutoOpen:!1}),F.open().then(function(){return te(F,j,H,W)})):je(N)}return z._promise(j,function(N,se){return sn(function(){return Me.trans=z,W(N,se,z)})}).then(function(N){if(j==="readwrite")try{z.idbtrans.commit()}catch{}return j==="readonly"?N:z._completion.then(function(){return N})})}if(F._state.openComplete)return je(new K.DatabaseClosed(F._state.dbOpenError));if(!F._state.isBeingOpened){if(!F._state.autoOpen)return je(new K.DatabaseClosed);F.open().catch(ce)}return F._state.dbReadyPromise.then(function(){return te(F,j,H,W)})})(this.db,r,[this.name],k);return y&&(B._consoleTask=y,B=B.catch(function(te){return console.trace(te),je(te)})),B}finally{E&&rt()}},Zt.prototype.get=function(r,i){var c=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?je(new K.Type("Invalid argument to Table.get()")):this._trans("readonly",function(v){return c.core.get({trans:v,key:r}).then(function(p){return c.hook.reading.fire(p)})}).then(i)},Zt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(d(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=u(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(E){if(E.compound&&i.every(function(te){return 0<=E.keyPath.indexOf(te)})){for(var B=0;B<i.length;++B)if(i.indexOf(E.keyPath[B])===-1)return!1;return!0}return!1}).sort(function(E,B){return E.keyPath.length-B.keyPath.length})[0];if(c&&this.db._maxKey!==Mt)return k=c.keyPath.slice(0,i.length),this.where(k).equals(k.map(function(E){return r[E]}));!c&&He&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var v=this.schema.idxByName;function p(E,B){return Tt(E,B)===0}var k=i.reduce(function(F,B){var te=F[0],F=F[1],j=v[B],H=r[B];return[te||j,te||!j?$t(F,j&&j.multi?function(W){return W=q(W,B),d(W)&&W.some(function(z){return p(H,z)})}:function(W){return p(H,q(W,B))}):F]},[null,null]),y=k[0],k=k[1];return y?this.where(y.name).equals(r[y.keyPath]).filter(k):c?this.filter(k):this.where(i).equals("")},Zt.prototype.filter=function(r){return this.toCollection().and(r)},Zt.prototype.count=function(r){return this.toCollection().count(r)},Zt.prototype.offset=function(r){return this.toCollection().offset(r)},Zt.prototype.limit=function(r){return this.toCollection().limit(r)},Zt.prototype.each=function(r){return this.toCollection().each(r)},Zt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Zt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Zt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,d(r)?"[".concat(r.join("+"),"]"):r))},Zt.prototype.reverse=function(){return this.toCollection().reverse()},Zt.prototype.mapToClass=function(r){for(var i=this.db,c=this.name,v=((this.schema.mappedClass=r).prototype instanceof Dl&&(r=(k=>{var E=F,B=k;if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function te(){this.constructor=E}function F(){return k!==null&&k.apply(this,arguments)||this}return n(E,B),E.prototype=B===null?Object.create(B):(te.prototype=B.prototype,new te),Object.defineProperty(F.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),F.prototype.table=function(){return c},F})(r)),new Set),p=r.prototype;p;p=_(p))Object.getOwnPropertyNames(p).forEach(function(k){return v.add(k)});function y(k){if(!k)return k;var E,B=Object.create(r.prototype);for(E in k)if(!v.has(E))try{B[E]=k[E]}catch{}return B}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=y,this.hook("reading",y),r},Zt.prototype.defineClass=function(){return this.mapToClass(function(r){g(this,r)})},Zt.prototype.add=function(r,i){var c=this,v=this.schema.primKey,p=v.auto,y=v.keyPath,k=r;return y&&p&&(k=ca(y)(r)),this._trans("readwrite",function(E){return c.core.mutate({trans:E,type:"add",keys:i!=null?[i]:null,values:[k]})}).then(function(E){return E.numFailures?Ee.reject(E.failures[0]):E.lastResult}).then(function(E){if(y)try{P(r,y,E)}catch{}return E})},Zt.prototype.upsert=function(r,i){var c=this,v=this.schema.primKey.keyPath;return this._trans("readwrite",function(p){return c.core.get({trans:p,key:r}).then(function(y){var k=y??{};return Bl(k,i),v&&P(k,v,r),c.core.mutate({trans:p,type:"put",values:[k],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[i]}}).then(function(E){return E.numFailures?Ee.reject(E.failures[0]):!!y})})})},Zt.prototype.update=function(r,i){return typeof r!="object"||d(r)?this.where(":id").equals(r).modify(i):(r=q(r,this.schema.primKey.keyPath))===void 0?je(new K.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i)},Zt.prototype.put=function(r,i){var c=this,v=this.schema.primKey,p=v.auto,y=v.keyPath,k=r;return y&&p&&(k=ca(y)(r)),this._trans("readwrite",function(E){return c.core.mutate({trans:E,type:"put",values:[k],keys:i!=null?[i]:null})}).then(function(E){return E.numFailures?Ee.reject(E.failures[0]):E.lastResult}).then(function(E){if(y)try{P(r,y,E)}catch{}return E})},Zt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(c){return i.core.mutate({trans:c,type:"delete",keys:[r]}).then(function(v){return Ys(i,[r],v)}).then(function(v){return v.numFailures?Ee.reject(v.failures[0]):void 0})})},Zt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:os}).then(function(c){return Ys(r,null,c)})}).then(function(i){return i.numFailures?Ee.reject(i.failures[0]):void 0})},Zt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(c){return i.core.getMany({keys:r,trans:c}).then(function(v){return v.map(function(p){return i.hook.reading.fire(p)})})})},Zt.prototype.bulkAdd=function(r,i,c){var v=this,p=Array.isArray(i)?i:void 0,y=(c=c||(p?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(k){var E=v.schema.primKey,te=E.auto,E=E.keyPath;if(E&&p)throw new K.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(p&&p.length!==r.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var B=r.length,te=E&&te?r.map(ca(E)):r;return v.core.mutate({trans:k,type:"add",keys:p,values:te,wantResults:y}).then(function(F){var j=F.numFailures,H=F.failures;if(j===0)return y?F.results:F.lastResult;throw new ve("".concat(v.name,".bulkAdd(): ").concat(j," of ").concat(B," operations failed"),H)})})},Zt.prototype.bulkPut=function(r,i,c){var v=this,p=Array.isArray(i)?i:void 0,y=(c=c||(p?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(k){var E=v.schema.primKey,te=E.auto,E=E.keyPath;if(E&&p)throw new K.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(p&&p.length!==r.length)throw new K.InvalidArgument("Arguments objects and keys must have the same length");var B=r.length,te=E&&te?r.map(ca(E)):r;return v.core.mutate({trans:k,type:"put",keys:p,values:te,wantResults:y}).then(function(F){var j=F.numFailures,H=F.failures;if(j===0)return y?F.results:F.lastResult;throw new ve("".concat(v.name,".bulkPut(): ").concat(j," of ").concat(B," operations failed"),H)})})},Zt.prototype.bulkUpdate=function(r){var i=this,c=this.core,v=r.map(function(k){return k.key}),p=r.map(function(k){return k.changes}),y=[];return this._trans("readwrite",function(k){return c.getMany({trans:k,keys:v,cache:"clone"}).then(function(E){var B=[],te=[],F=(r.forEach(function(j,H){var W=j.key,z=j.changes,N=E[H];if(N){for(var se=0,ue=Object.keys(z);se<ue.length;se++){var $=ue[se],be=z[$];if($===i.schema.primKey.keyPath){if(Tt(be,W)!==0)throw new K.Constraint("Cannot update primary key in bulkUpdate()")}else P(N,$,be)}y.push(H),B.push(W),te.push(N)}}),B.length);return c.mutate({trans:k,type:"put",keys:B,values:te,updates:{keys:v,changeSpecs:p}}).then(function(j){var H=j.numFailures,W=j.failures;if(H===0)return F;for(var z=0,N=Object.keys(W);z<N.length;z++){var se,ue=N[z],$=y[Number(ue)];$!=null&&(se=W[ue],delete W[ue],W[$]=se)}throw new ve("".concat(i.name,".bulkUpdate(): ").concat(H," of ").concat(F," operations failed"),W)})})})},Zt.prototype.bulkDelete=function(r){var i=this,c=r.length;return this._trans("readwrite",function(v){return i.core.mutate({trans:v,type:"delete",keys:r}).then(function(p){return Ys(i,r,p)})}).then(function(v){var p=v.numFailures,y=v.failures;if(p===0)return v.lastResult;throw new ve("".concat(i.name,".bulkDelete(): ").concat(p," of ").concat(c," operations failed"),y)})};var Fl=Zt;function Zt(){}function cs(r){function i(k,E){if(E){for(var B=arguments.length,te=new Array(B-1);--B;)te[B-1]=arguments[B];return c[k].subscribe.apply(null,te),r}if(typeof k=="string")return c[k]}var c={};i.addEventType=y;for(var v=1,p=arguments.length;v<p;++v)y(arguments[v]);return i;function y(k,E,B){var te,F;if(typeof k!="object")return E=E||Be,F={subscribers:[],fire:B=B||ce,subscribe:function(j){F.subscribers.indexOf(j)===-1&&(F.subscribers.push(j),F.fire=E(F.fire,j))},unsubscribe:function(j){F.subscribers=F.subscribers.filter(function(H){return H!==j}),F.fire=F.subscribers.reduce(E,B)}},c[k]=i[k]=F;u(te=k).forEach(function(j){var H=te[j];if(d(H))y(j,te[j][0],te[j][1]);else{if(H!=="asap")throw new K.InvalidArgument("Invalid event config");var W=y(j,Oe,function(){for(var z=arguments.length,N=new Array(z);z--;)N[z]=arguments[z];W.subscribers.forEach(function(se){U(function(){se.apply(null,N)})})})}})}}function us(r,i){return D(i).from({prototype:r}),i}function qa(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function Gi(r,i){r.filter=$t(r.filter,i)}function Hi(r,i,c){var v=r.replayFilter;r.replayFilter=v?function(){return $t(v(),i())}:i,r.justLimit=c&&!v}function Qs(r,i){if(r.isPrimKey)return i.primaryKey;var c=i.getIndexByKeyPath(r.index);if(c)return c;throw new K.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed")}function zl(r,i,c){var v=Qs(r,i.schema);return i.openCursor({trans:c,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:v,range:r.range}})}function Xs(r,i,c,v){var p,y,k=r.replayFilter?$t(r.filter,r.replayFilter()):r.filter;return r.or?(p={},y=function(E,B,te){var F,j;k&&!k(B,te,function(H){return B.stop(H)},function(H){return B.fail(H)})||((j=""+(F=B.primaryKey))=="[object ArrayBuffer]"&&(j=""+new Uint8Array(F)),x(p,j))||(p[j]=!0,i(E,B,te))},Promise.all([r.or._iterate(y,c),Ul(zl(r,v,c),r.algorithm,y,!r.keysOnly&&r.valueMapper)])):Ul(zl(r,v,c),$t(r.algorithm,k),i,!r.keysOnly&&r.valueMapper)}function Ul(r,i,c,v){var p=Xe(v?function(y,k,E){return c(v(y),k,E)}:c);return r.then(function(y){if(y)return y.start(function(){var k=function(){return y.continue()};i&&!i(y,function(E){return k=E},function(E){y.stop(E),k=ce},function(E){y.fail(E),k=ce})||p(y.value,y,function(E){return k=E}),k()})})}jt.prototype._read=function(r,i){var c=this._ctx;return c.error?c.table._trans(null,je.bind(null,c.error)):c.table._trans("readonly",r).then(i)},jt.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,je.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},jt.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=$t(i.algorithm,r)},jt.prototype._iterate=function(r,i){return Xs(this._ctx,r,i,this._ctx.table.core)},jt.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return r&&g(c,r),i._ctx=c,i},jt.prototype.raw=function(){return this._ctx.valueMapper=null,this},jt.prototype.each=function(r){var i=this._ctx;return this._read(function(c){return Xs(i,r,c,i.table.core)})},jt.prototype.count=function(r){var i=this;return this._read(function(c){var v,p=i._ctx,y=p.table.core;return qa(p,!0)?y.count({trans:c,query:{index:Qs(p,y.schema),range:p.range}}).then(function(k){return Math.min(k,p.limit)}):(v=0,Xs(p,function(){return++v,!1},c,y).then(function(){return v}))}).then(r)},jt.prototype.sortBy=function(r,i){var c=r.split(".").reverse(),v=c[0],p=c.length-1;function y(B,te){return te?y(B[c[te]],te-1):B[v]}var k=this._ctx.dir==="next"?1:-1;function E(B,te){return Tt(y(B,p),y(te,p))*k}return this.toArray(function(B){return B.sort(E)}).then(i)},jt.prototype.toArray=function(r){var i=this;return this._read(function(c){var v,p,y,k=i._ctx;return k.dir==="next"&&qa(k,!0)&&0<k.limit?(v=k.valueMapper,p=Qs(k,k.table.core.schema),k.table.core.query({trans:c,limit:k.limit,values:!0,query:{index:p,range:k.range}}).then(function(E){return E=E.result,v?E.map(v):E})):(y=[],Xs(k,function(E){return y.push(E)},c,k.table.core).then(function(){return y}))},r)},jt.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,qa(i)?Hi(i,function(){var c=r;return function(v,p){return c===0||(c===1?--c:p(function(){v.advance(c),c=0}),!1)}}):Hi(i,function(){var c=r;return function(){return--c<0}})),this},jt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),Hi(this._ctx,function(){var i=r;return function(c,v,p){return--i<=0&&v(p),0<=i}},!0),this},jt.prototype.until=function(r,i){return Gi(this._ctx,function(c,v,p){return!r(c.value)||(v(p),i)}),this},jt.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},jt.prototype.last=function(r){return this.reverse().first(r)},jt.prototype.filter=function(r){var i;return Gi(this._ctx,function(c){return r(c.value)}),(i=this._ctx).isMatch=$t(i.isMatch,r),this},jt.prototype.and=function(r){return this.filter(r)},jt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},jt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},jt.prototype.desc=function(){return this.reverse()},jt.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,v){r(v.key,v)})},jt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},jt.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,v){r(v.primaryKey,v)})},jt.prototype.keys=function(r){var i=this._ctx,c=(i.keysOnly=!i.isMatch,[]);return this.each(function(v,p){c.push(p.key)}).then(function(){return c}).then(r)},jt.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&qa(i,!0)&&0<i.limit)return this._read(function(v){var p=Qs(i,i.table.core.schema);return i.table.core.query({trans:v,values:!1,limit:i.limit,query:{index:p,range:i.range}})}).then(function(v){return v.result}).then(r);i.keysOnly=!i.isMatch;var c=[];return this.each(function(v,p){c.push(p.primaryKey)}).then(function(){return c}).then(r)},jt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},jt.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},jt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},jt.prototype.distinct=function(){var r,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(r={},Gi(this._ctx,function(v){var v=v.primaryKey.toString(),p=x(r,v);return r[v]=!0,!p})),this},jt.prototype.modify=function(r){var i=this,c=this._ctx;return this._write(function(v){function p(N,se){var ue=se.failures;H+=N-se.numFailures;for(var $=0,be=u(ue);$<be.length;$++){var Ae=be[$];j.push(ue[Ae])}}var y=typeof r=="function"?r:function(N){return Bl(N,r)},k=c.table.core,F=k.schema.primaryKey,E=F.outbound,B=F.extractKey,te=200,F=i.db._options.modifyChunkSize,j=(F&&(te=typeof F=="object"?F[k.name]||F["*"]||200:F),[]),H=0,W=[],z=r===Kl;return i.clone().primaryKeys().then(function(N){function se($){var be=Math.min(te,N.length-$),Ae=N.slice($,$+be);return(z?Promise.resolve([]):k.getMany({trans:v,keys:Ae,cache:"immutable"})).then(function(Le){var Ne=[],Ie=[],Ge=E?[]:null,Ue=z?Ae:[];if(!z)for(var Re=0;Re<be;++Re){var We=Le[Re],It={value:ge(We),primKey:N[$+Re]};y.call(It,It.value,It)!==!1&&(It.value==null?Ue.push(N[$+Re]):E||Tt(B(We),B(It.value))===0?(Ie.push(It.value),E&&Ge.push(N[$+Re])):(Ue.push(N[$+Re]),Ne.push(It.value)))}return Promise.resolve(0<Ne.length&&k.mutate({trans:v,type:"add",values:Ne}).then(function(Dt){for(var nt in Dt.failures)Ue.splice(parseInt(nt),1);p(Ne.length,Dt)})).then(function(){return(0<Ie.length||ue&&typeof r=="object")&&k.mutate({trans:v,type:"put",keys:Ge,values:Ie,criteria:ue,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<$}).then(function(Dt){return p(Ie.length,Dt)})}).then(function(){return(0<Ue.length||ue&&z)&&k.mutate({trans:v,type:"delete",keys:Ue,criteria:ue,isAdditionalChunk:0<$}).then(function(Dt){return Ys(c.table,Ue,Dt)}).then(function(Dt){return p(Ue.length,Dt)})}).then(function(){return N.length>$+be&&se($+te)})})}var ue=qa(c)&&c.limit===1/0&&(typeof r!="function"||z)&&{index:c.index,range:c.range};return se(0).then(function(){if(0<j.length)throw new G("Error modifying one or more objects",j,H,W);return N.length})})})},jt.prototype.delete=function(){var r=this._ctx,i=r.range;return!qa(r)||r.table.schema.yProps||!r.isPrimKey&&i.type!==3?this.modify(Kl):this._write(function(c){var v=r.table.core.schema.primaryKey,p=i;return r.table.core.count({trans:c,query:{index:v,range:p}}).then(function(y){return r.table.core.mutate({trans:c,type:"deleteRange",range:p}).then(function(B){var E=B.failures,B=B.numFailures;if(B)throw new G("Could not delete some values",Object.keys(E).map(function(te){return E[te]}),y-B);return y-B})})})};var Qd=jt;function jt(){}var Kl=function(r,i){return i.value=null};function Xd(r,i){return r<i?-1:r===i?0:1}function Zd(r,i){return i<r?-1:r===i?0:1}function Wn(r,i,c){return r=r instanceof Hl?new r.Collection(r):r,r._ctx.error=new(c||TypeError)(i),r}function Ba(r){return new r.Collection(r,function(){return Gl("")}).limit(0)}function Zs(W,i,c,v){var p,y,k,E,B,te,F,j=c.length;if(!c.every(function(N){return typeof N=="string"}))return Wn(W,nn);function H(N){p=N==="next"?function(ue){return ue.toUpperCase()}:function(ue){return ue.toLowerCase()},y=N==="next"?function(ue){return ue.toLowerCase()}:function(ue){return ue.toUpperCase()},k=N==="next"?Xd:Zd;var se=c.map(function(ue){return{lower:y(ue),upper:p(ue)}}).sort(function(ue,$){return k(ue.lower,$.lower)});E=se.map(function(ue){return ue.upper}),B=se.map(function(ue){return ue.lower}),F=(te=N)==="next"?"":v}H("next");var W=new W.Collection(W,function(){return Qr(E[0],B[j-1]+v)}),z=(W._ondirectionchange=function(N){H(N)},0);return W._addAlgorithm(function(N,se,ue){var $=N.key;if(typeof $=="string"){var be=y($);if(i(be,B,z))return!0;for(var Ae=null,Le=z;Le<j;++Le){var Ne=((Ie,Ge,Ue,Re,We,It)=>{for(var Dt=Math.min(Ie.length,Re.length),nt=-1,gt=0;gt<Dt;++gt){var rn=Ge[gt];if(rn!==Re[gt])return We(Ie[gt],Ue[gt])<0?Ie.substr(0,gt)+Ue[gt]+Ue.substr(gt+1):We(Ie[gt],Re[gt])<0?Ie.substr(0,gt)+Re[gt]+Ue.substr(gt+1):0<=nt?Ie.substr(0,nt)+Ge[nt]+Ue.substr(nt+1):null;We(Ie[gt],rn)<0&&(nt=gt)}return Dt<Re.length&&It==="next"?Ie+Ue.substr(Ie.length):Dt<Ie.length&&It==="prev"?Ie.substr(0,Ue.length):nt<0?null:Ie.substr(0,nt)+Re[nt]+Ue.substr(nt+1)})($,be,E[Le],B[Le],k,te);Ne===null&&Ae===null?z=Le+1:(Ae===null||0<k(Ae,Ne))&&(Ae=Ne)}se(Ae!==null?function(){N.continue(Ae+F)}:ue)}return!1}),W}function Qr(r,i,c,v){return{type:2,lower:r,upper:i,lowerOpen:c,upperOpen:v}}function Gl(r){return{type:1,lower:r,upper:r}}Object.defineProperty(gn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),gn.prototype.between=function(r,i,c,v){c=c!==!1,v=v===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(c||v)&&(!c||!v)?Ba(this):new this.Collection(this,function(){return Qr(r,i,!c,!v)})}catch{return Wn(this,Xt)}},gn.prototype.equals=function(r){return r==null?Wn(this,Xt):new this.Collection(this,function(){return Gl(r)})},gn.prototype.above=function(r){return r==null?Wn(this,Xt):new this.Collection(this,function(){return Qr(r,void 0,!0)})},gn.prototype.aboveOrEqual=function(r){return r==null?Wn(this,Xt):new this.Collection(this,function(){return Qr(r,void 0,!1)})},gn.prototype.below=function(r){return r==null?Wn(this,Xt):new this.Collection(this,function(){return Qr(void 0,r,!1,!0)})},gn.prototype.belowOrEqual=function(r){return r==null?Wn(this,Xt):new this.Collection(this,function(){return Qr(void 0,r)})},gn.prototype.startsWith=function(r){return typeof r!="string"?Wn(this,nn):this.between(r,r+Mt,!0,!0)},gn.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Zs(this,function(i,c){return i.indexOf(c[0])===0},[r],Mt)},gn.prototype.equalsIgnoreCase=function(r){return Zs(this,function(i,c){return i===c[0]},[r],"")},gn.prototype.anyOfIgnoreCase=function(){var r=fe.apply(ee,arguments);return r.length===0?Ba(this):Zs(this,function(i,c){return c.indexOf(i)!==-1},r,"")},gn.prototype.startsWithAnyOfIgnoreCase=function(){var r=fe.apply(ee,arguments);return r.length===0?Ba(this):Zs(this,function(i,c){return c.some(function(v){return i.indexOf(v)===0})},r,Mt)},gn.prototype.anyOf=function(){var r,i,c=this,v=fe.apply(ee,arguments),p=this._cmp;try{v.sort(p)}catch{return Wn(this,Xt)}return v.length===0?Ba(this):((r=new this.Collection(this,function(){return Qr(v[0],v[v.length-1])}))._ondirectionchange=function(y){p=y==="next"?c._ascending:c._descending,v.sort(p)},i=0,r._addAlgorithm(function(y,k,E){for(var B=y.key;0<p(B,v[i]);)if(++i===v.length)return k(E),!1;return p(B,v[i])===0||(k(function(){y.continue(v[i])}),!1)}),r)},gn.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},gn.prototype.noneOf=function(){var r=fe.apply(ee,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return Wn(this,Xt)}var i=r.reduce(function(c,v){return c?c.concat([[c[c.length-1][1],v]]):[[-1/0,v]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},gn.prototype.inAnyRange=function(r,ue){var c=this,v=this._cmp,p=this._ascending,y=this._descending,k=this._min,E=this._max;if(r.length===0)return Ba(this);if(!r.every(function($){return $[0]!==void 0&&$[1]!==void 0&&p($[0],$[1])<=0}))return Wn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",K.InvalidArgument);var B=!ue||ue.includeLowers!==!1,te=ue&&ue.includeUppers===!0,F,j=p;function H($,be){return j($[0],be[0])}try{(F=r.reduce(function($,be){for(var Ae=0,Le=$.length;Ae<Le;++Ae){var Ne=$[Ae];if(v(be[0],Ne[1])<0&&0<v(be[1],Ne[0])){Ne[0]=k(Ne[0],be[0]),Ne[1]=E(Ne[1],be[1]);break}}return Ae===Le&&$.push(be),$},[])).sort(H)}catch{return Wn(this,Xt)}var W=0,z=te?function($){return 0<p($,F[W][1])}:function($){return 0<=p($,F[W][1])},N=B?function($){return 0<y($,F[W][0])}:function($){return 0<=y($,F[W][0])},se=z,ue=new this.Collection(this,function(){return Qr(F[0][0],F[F.length-1][1],!B,!te)});return ue._ondirectionchange=function($){j=$==="next"?(se=z,p):(se=N,y),F.sort(H)},ue._addAlgorithm(function($,be,Ae){for(var Le,Ne=$.key;se(Ne);)if(++W===F.length)return be(Ae),!1;return!z(Le=Ne)&&!N(Le)||(c._cmp(Ne,F[W][1])===0||c._cmp(Ne,F[W][0])===0||be(function(){j===p?$.continue(F[W][0]):$.continue(F[W][1])}),!1)}),ue},gn.prototype.startsWithAnyOf=function(){var r=fe.apply(ee,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Ba(this):this.inAnyRange(r.map(function(i){return[i,i+Mt]})):Wn(this,"startsWithAnyOf() only works with strings")};var Hl=gn;function gn(){}function kr(r){return Xe(function(i){return ds(i),r(i.target.error),!1})}function ds(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var vs="storagemutated",Wi="x-storagemutated-1",Xr=cs(null,vs),Jd=(xr.prototype._lock=function(){return V(!Me.global),++this._reculock,this._reculock!==1||Me.global||(Me.lockOwnerFor=this),this},xr.prototype._unlock=function(){if(V(!Me.global),--this._reculock==0)for(Me.global||(Me.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ye(r[1],r[0])}catch{}}return this},xr.prototype._locked=function(){return this._reculock&&Me.lockOwnerFor!==this},xr.prototype.create=function(r){var i=this;if(this.mode){var c=this.db.idbdb,v=this.db._state.dbOpenError;if(V(!this.idbtrans),!r&&!c)switch(v&&v.name){case"DatabaseClosedError":throw new K.DatabaseClosed(v);case"MissingAPIError":throw new K.MissingAPI(v.message,v);default:throw new K.OpenFailed(v)}if(!this.active)throw new K.TransactionInactive;V(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Xe(function(p){ds(p),i._reject(r.error)}),r.onabort=Xe(function(p){ds(p),i.active&&i._reject(new K.Abort(r.error)),i.active=!1,i.on("abort").fire(p)}),r.oncomplete=Xe(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&Xr.storagemutated.fire(r.mutatedParts)})}return this},xr.prototype._promise=function(r,i,c){var v,p=this;return r==="readwrite"&&this.mode!=="readwrite"?je(new K.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ee(function(y,k){p._blockedFuncs.push([function(){p._promise(r,i,c).then(y,k)},Me])}):c?sn(function(){var y=new Ee(function(k,E){p._lock();var B=i(k,E,p);B&&B.then&&B.then(k,E)});return y.finally(function(){return p._unlock()}),y._lib=!0,y}):((v=new Ee(function(y,k){var E=i(y,k,p);E&&E.then&&E.then(y,k)}))._lib=!0,v):je(new K.TransactionInactive)},xr.prototype._root=function(){return this.parent?this.parent._root():this},xr.prototype.waitFor=function(r){var i,c=this._root(),v=Ee.resolve(r),p=(c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return v}):(c._waitingFor=v,c._waitingQueue=[],i=c.idbtrans.objectStore(c.storeNames[0]),(function y(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(i.get(-1/0).onsuccess=y)})()),c._waitingFor);return new Ee(function(y,k){v.then(function(E){return c._waitingQueue.push(Xe(y.bind(null,E)))},function(E){return c._waitingQueue.push(Xe(k.bind(null,E)))}).finally(function(){c._waitingFor===p&&(c._waitingFor=null)})})},xr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new K.Abort))},xr.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(x(i,r))return i[r];var c=this.schema[r];if(c)return(c=new this.db.Table(r,c,this)).core=this.db.core.table(r),i[r]=c;throw new K.NotFound("Table "+r+" not part of transaction")},xr);function xr(){}function Vi(r,i,c,v,p,y,k,E){return{name:r,keyPath:i,unique:c,multi:v,auto:p,compound:y,src:(c&&!k?"&":"")+(v?"*":"")+(p?"++":"")+Wl(i),type:E}}function Wl(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Yi(r,i,c){return{name:r,primKey:i,indexes:c,mappedClass:null,idxByName:(v=function(p){return[p.name,p]},c.reduce(function(p,y,k){return y=v(y,k),y&&(p[y[0]]=y[1]),p},{}))};var v}var fs=function(r){try{return r.only([[]]),fs=function(){return[[]]},[[]]}catch{return fs=function(){return Mt},Mt}};function Qi(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(c){return c[i]}:function(c){return q(c,i)}:function(c){return q(c,r)};var i}function Vl(r){return[].slice.call(r)}var $d=0;function ps(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function ev(r,i,B){function v(z){if(z.type===3)return null;if(z.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var j=z.lower,H=z.upper,W=z.lowerOpen,z=z.upperOpen;return j===void 0?H===void 0?null:i.upperBound(H,!!z):H===void 0?i.lowerBound(j,!!W):i.bound(j,H,!!W,!!z)}function p(F){var j,H=F.name;return{name:H,schema:F,mutate:function(W){var z=W.trans,N=W.type,se=W.keys,ue=W.values,$=W.range;return new Promise(function(be,Ae){be=Xe(be);var Le=z.objectStore(H),Ne=Le.keyPath==null,Ie=N==="put"||N==="add";if(!Ie&&N!=="delete"&&N!=="deleteRange")throw new Error("Invalid operation type: "+N);var Ge,Ue=(se||ue||{length:1}).length;if(se&&ue&&se.length!==ue.length)throw new Error("Given keys array must have same length as given values array.");if(Ue===0)return be({numFailures:0,failures:{},results:[],lastResult:void 0});function Re(ln){++Dt,ds(ln)}var We=[],It=[],Dt=0;if(N==="deleteRange"){if($.type===4)return be({numFailures:Dt,failures:It,results:[],lastResult:void 0});$.type===3?We.push(Ge=Le.clear()):We.push(Ge=Le.delete(v($)))}else{var Ne=Ie?Ne?[ue,se]:[ue,null]:[se,null],nt=Ne[0],gt=Ne[1];if(Ie)for(var rn=0;rn<Ue;++rn)We.push(Ge=gt&&gt[rn]!==void 0?Le[N](nt[rn],gt[rn]):Le[N](nt[rn])),Ge.onerror=Re;else for(rn=0;rn<Ue;++rn)We.push(Ge=Le[N](nt[rn])),Ge.onerror=Re}function er(ln){ln=ln.target.result,We.forEach(function(va,po){return va.error!=null&&(It[po]=va.error)}),be({numFailures:Dt,failures:It,results:N==="delete"?se:We.map(function(va){return va.result}),lastResult:ln})}Ge.onerror=function(ln){Re(ln),er(ln)},Ge.onsuccess=er})},getMany:function(W){var z=W.trans,N=W.keys;return new Promise(function(se,ue){se=Xe(se);for(var $,be=z.objectStore(H),Ae=N.length,Le=new Array(Ae),Ne=0,Ie=0,Ge=function(We){We=We.target,Le[We._pos]=We.result,++Ie===Ne&&se(Le)},Ue=kr(ue),Re=0;Re<Ae;++Re)N[Re]!=null&&(($=be.get(N[Re]))._pos=Re,$.onsuccess=Ge,$.onerror=Ue,++Ne);Ne===0&&se(Le)})},get:function(W){var z=W.trans,N=W.key;return new Promise(function(se,ue){se=Xe(se);var $=z.objectStore(H).get(N);$.onsuccess=function(be){return se(be.target.result)},$.onerror=kr(ue)})},query:(j=E,function(W){return new Promise(function(z,N){z=Xe(z);var se,ue,$,Ie=W.trans,be=W.values,Ae=W.limit,Ne=W.query,Le=Ae===1/0?void 0:Ae,Ge=Ne.index,Ne=Ne.range,Ie=Ie.objectStore(H),Ie=Ge.isPrimaryKey?Ie:Ie.index(Ge.name),Ge=v(Ne);if(Ae===0)return z({result:[]});j?((Ne=be?Ie.getAll(Ge,Le):Ie.getAllKeys(Ge,Le)).onsuccess=function(Ue){return z({result:Ue.target.result})},Ne.onerror=kr(N)):(se=0,ue=!be&&"openKeyCursor"in Ie?Ie.openKeyCursor(Ge):Ie.openCursor(Ge),$=[],ue.onsuccess=function(Ue){var Re=ue.result;return!Re||($.push(be?Re.value:Re.primaryKey),++se===Ae)?z({result:$}):void Re.continue()},ue.onerror=kr(N))})}),openCursor:function(W){var z=W.trans,N=W.values,se=W.query,ue=W.reverse,$=W.unique;return new Promise(function(be,Ae){be=Xe(be);var Ie=se.index,Le=se.range,Ne=z.objectStore(H),Ne=Ie.isPrimaryKey?Ne:Ne.index(Ie.name),Ie=ue?$?"prevunique":"prev":$?"nextunique":"next",Ge=!N&&"openKeyCursor"in Ne?Ne.openKeyCursor(v(Le),Ie):Ne.openCursor(v(Le),Ie);Ge.onerror=kr(Ae),Ge.onsuccess=Xe(function(Ue){var Re,We,It,Dt,nt=Ge.result;nt?(nt.___id=++$d,nt.done=!1,Re=nt.continue.bind(nt),We=(We=nt.continuePrimaryKey)&&We.bind(nt),It=nt.advance.bind(nt),Dt=function(){throw new Error("Cursor not stopped")},nt.trans=z,nt.stop=nt.continue=nt.continuePrimaryKey=nt.advance=function(){throw new Error("Cursor not started")},nt.fail=Xe(Ae),nt.next=function(){var gt=this,rn=1;return this.start(function(){return rn--?gt.continue():gt.stop()}).then(function(){return gt})},nt.start=function(gt){function rn(){if(Ge.result)try{gt()}catch(ln){nt.fail(ln)}else nt.done=!0,nt.start=function(){throw new Error("Cursor behind last entry")},nt.stop()}var er=new Promise(function(ln,va){ln=Xe(ln),Ge.onerror=kr(va),nt.fail=va,nt.stop=function(po){nt.stop=nt.continue=nt.continuePrimaryKey=nt.advance=Dt,ln(po)}});return Ge.onsuccess=Xe(function(ln){Ge.onsuccess=rn,rn()}),nt.continue=Re,nt.continuePrimaryKey=We,nt.advance=It,rn(),er},be(nt)):be(null)},Ae)})},count:function(W){var z=W.query,N=W.trans,se=z.index,ue=z.range;return new Promise(function($,be){var Ae=N.objectStore(H),Ae=se.isPrimaryKey?Ae:Ae.index(se.name),Le=v(ue),Le=Le?Ae.count(Le):Ae.count();Le.onsuccess=Xe(function(Ne){return $(Ne.target.result)}),Le.onerror=kr(be)})}}}y=B,k=Vl((B=r).objectStoreNames);var y,B={schema:{name:B.name,tables:k.map(function(F){return y.objectStore(F)}).map(function(F){var j=F.keyPath,H=F.autoIncrement,z=d(j),W={},z={name:F.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:j==null,compound:z,keyPath:j,autoIncrement:H,unique:!0,extractKey:Qi(j)},indexes:Vl(F.indexNames).map(function(N){return F.index(N)}).map(function($){var be=$.name,se=$.unique,ue=$.multiEntry,$=$.keyPath,be={name:be,compound:d($),keyPath:$,unique:se,multiEntry:ue,extractKey:Qi($)};return W[ps($)]=be}),getIndexByKeyPath:function(N){return W[ps(N)]}};return W[":id"]=z.primaryKey,j!=null&&(W[ps(j)]=z.primaryKey),z})},hasGetAll:0<k.length&&"getAll"in y.objectStore(k[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},k=B.schema,E=B.hasGetAll,B=k.tables.map(p),te={};return B.forEach(function(F){return te[F.name]=F}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(F){if(te[F])return te[F];throw new Error("Table '".concat(F,"' not found"))},MIN_KEY:-1/0,MAX_KEY:fs(i),schema:k}}function tv(r,i,c,v){return c=c.IDBKeyRange,i=ev(i,c,v),{dbcore:r.dbcore.reduce(function(p,y){return y=y.create,a(a({},p),y(p))},i)}}function Js(r,i){var c=i.db,c=tv(r._middlewares,c,r._deps,i);r.core=c.dbcore,r.tables.forEach(function(v){var p=v.name;r.core.schema.tables.some(function(y){return y.name===p})&&(v.core=r.core.table(p),r[p]instanceof r.Table)&&(r[p].core=v.core)})}function $s(r,i,c,v){c.forEach(function(p){var y=v[p];i.forEach(function(k){var E=(function B(te,F){return O(te,F)||(te=_(te))&&B(te,F)})(k,p);(!E||"value"in E&&E.value===void 0)&&(k===r.Transaction.prototype||k instanceof r.Transaction?I(k,p,{get:function(){return this.table(p)},set:function(B){w(this,p,{value:B,writable:!0,configurable:!0,enumerable:!0})}}):k[p]=new r.Table(p,y))})})}function Xi(r,i){i.forEach(function(c){for(var v in c)c[v]instanceof r.Table&&delete c[v]})}function nv(r,i){return r._cfg.version-i._cfg.version}function rv(r,i,c,v){var p=r._dbSchema,y=(c.objectStoreNames.contains("$meta")&&!p.$meta&&(p.$meta=Yi("$meta",Ql("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,p)),k=(y.create(c),y._completion.catch(v),y._reject.bind(y)),E=Me.transless||Me;sn(function(){if(Me.trans=y,Me.transless=E,i!==0)return Js(r,c),te=i,((B=y).storeNames.includes("$meta")?B.table("$meta").get("version").then(function(F){return F??te}):Ee.resolve(te)).then(function(se){var j=r,H=se,W=y,z=c,N=[],se=j._versions,ue=j._dbSchema=ti(0,j.idbdb,z);return(se=se.filter(function($){return $._cfg.version>=H})).length===0?Ee.resolve():(se.forEach(function($){N.push(function(){var be,Ae,Le,Ne=ue,Ie=$._cfg.dbschema,Ge=(ni(j,Ne,z),ni(j,Ie,z),ue=j._dbSchema=Ie,Zi(Ne,Ie)),Ue=(Ge.add.forEach(function(Re){Ji(z,Re[0],Re[1].primKey,Re[1].indexes)}),Ge.change.forEach(function(Re){if(Re.recreate)throw new K.Upgrade("Not yet support for changing primary key");var We=z.objectStore(Re.name);Re.add.forEach(function(It){return ei(We,It)}),Re.change.forEach(function(It){We.deleteIndex(It.name),ei(We,It)}),Re.del.forEach(function(It){return We.deleteIndex(It)})}),$._cfg.contentUpgrade);if(Ue&&$._cfg.version>H)return Js(j,z),W._memoizedTables={},be=le(Ie),Ge.del.forEach(function(Re){be[Re]=Ne[Re]}),Xi(j,[j.Transaction.prototype]),$s(j,[j.Transaction.prototype],u(be),be),W.schema=be,(Ae=pe(Ue))&&Rt(),Ie=Ee.follow(function(){var Re;(Le=Ue(W))&&Ae&&(Re=on.bind(null,null),Le.then(Re,Re))}),Le&&typeof Le.then=="function"?Ee.resolve(Le):Ie.then(function(){return Le})}),N.push(function(be){var Ae,Le,Ne=$._cfg.dbschema;Ae=Ne,Le=be,[].slice.call(Le.db.objectStoreNames).forEach(function(Ie){return Ae[Ie]==null&&Le.db.deleteObjectStore(Ie)}),Xi(j,[j.Transaction.prototype]),$s(j,[j.Transaction.prototype],j._storeNames,j._dbSchema),W.schema=j._dbSchema}),N.push(function(be){j.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(j.idbdb.version/10)===$._cfg.version?(j.idbdb.deleteObjectStore("$meta"),delete j._dbSchema.$meta,j._storeNames=j._storeNames.filter(function(Ae){return Ae!=="$meta"})):be.objectStore("$meta").put($._cfg.version,"version"))})}),(function $(){return N.length?Ee.resolve(N.shift()(W.idbtrans)).then($):Ee.resolve()})().then(function(){Yl(ue,z)}))}).catch(k);var B,te;u(p).forEach(function(F){Ji(c,F,p[F].primKey,p[F].indexes)}),Js(r,c),Ee.follow(function(){return r.on.populate.fire(y)}).catch(k)})}function av(r,i){Yl(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var c=ti(0,r.idbdb,i);ni(r,r._dbSchema,i);for(var v=0,p=Zi(c,r._dbSchema).change;v<p.length;v++){var y=(k=>{if(k.change.length||k.recreate)return console.warn("Unable to patch indexes of table ".concat(k.name," because it has changes on the type of index or primary key.")),{value:void 0};var E=i.objectStore(k.name);k.add.forEach(function(B){He&&console.debug("Dexie upgrade patch: Creating missing index ".concat(k.name,".").concat(B.src)),ei(E,B)})})(p[v]);if(typeof y=="object")return y.value}}function Zi(r,i){var c,v={del:[],add:[],change:[]};for(c in r)i[c]||v.del.push(c);for(c in i){var p=r[c],y=i[c];if(p){var k={name:c,def:y,recreate:!1,del:[],add:[],change:[]};if(""+(p.primKey.keyPath||"")!=""+(y.primKey.keyPath||"")||p.primKey.auto!==y.primKey.auto)k.recreate=!0,v.change.push(k);else{var E=p.idxByName,B=y.idxByName,te=void 0;for(te in E)B[te]||k.del.push(te);for(te in B){var F=E[te],j=B[te];F?F.src!==j.src&&k.change.push(j):k.add.push(j)}(0<k.del.length||0<k.add.length||0<k.change.length)&&v.change.push(k)}}else v.add.push([c,y])}return v}function Ji(r,i,c,v){var p=r.db.createObjectStore(i,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});v.forEach(function(y){return ei(p,y)})}function Yl(r,i){u(r).forEach(function(c){i.db.objectStoreNames.contains(c)||(He&&console.debug("Dexie: Creating missing table",c),Ji(i,c,r[c].primKey,r[c].indexes))})}function ei(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function ti(r,i,c){var v={};return de(i.objectStoreNames,0).forEach(function(p){for(var y=c.objectStore(p),k=Vi(Wl(te=y.keyPath),te||"",!0,!1,!!y.autoIncrement,te&&typeof te!="string",!0),E=[],B=0;B<y.indexNames.length;++B){var F=y.index(y.indexNames[B]),te=F.keyPath,F=Vi(F.name,te,!!F.unique,!!F.multiEntry,!1,te&&typeof te!="string",!1);E.push(F)}v[p]=Yi(p,k,E)}),v}function ni(r,i,c){for(var v=c.db.objectStoreNames,p=0;p<v.length;++p){var y=v[p],k=c.objectStore(y);r._hasGetAll="getAll"in k;for(var E=0;E<k.indexNames.length;++E){var B,te=k.indexNames[E],F=k.index(te).keyPath,F=typeof F=="string"?F:"["+de(F).join("+")+"]";i[y]&&(B=i[y].idxByName[F])&&(B.name=te,delete i[y].idxByName[F],i[y].idxByName[te]=B)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Ql(r){return r.split(",").map(function(i,c){var p=i.split(":"),v=(v=p[1])==null?void 0:v.trim(),p=(i=p[0].trim()).replace(/([&*]|\+\+)/g,""),y=/^\[/.test(p)?p.match(/^\[(.*)\]$/)[1].split("+"):p;return Vi(p,y||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),d(y),c===0,v)})}Fa.prototype._createTableSchema=Yi,Fa.prototype._parseIndexSyntax=Ql,Fa.prototype._parseStoresSpec=function(r,i){var c=this;u(r).forEach(function(v){if(r[v]!==null){var p=c._parseIndexSyntax(r[v]),y=p.shift();if(!y)throw new K.Schema("Invalid schema for table "+v+": "+r[v]);if(y.unique=!0,y.multi)throw new K.Schema("Primary key cannot be multiEntry*");p.forEach(function(k){if(k.auto)throw new K.Schema("Only primary key can be marked as autoIncrement (++)");if(!k.keyPath)throw new K.Schema("Index must have a name and cannot be an empty string")}),y=c._createTableSchema(v,y,p),i[v]=y}})},Fa.prototype.stores=function(c){var i=this.db,c=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,c):c,i._versions),v={},p={};return c.forEach(function(y){g(v,y._cfg.storesSource),p=y._cfg.dbschema={},y._parseStoresSpec(v,p)}),i._dbSchema=p,Xi(i,[i._allTables,i,i.Transaction.prototype]),$s(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],u(p),p),i._storeNames=u(p),this},Fa.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Fe(this._cfg.contentUpgrade||ce,r),this};var sv=Fa;function Fa(){}function $i(r,i){var c=r._dbNamesDB;return c||(c=r._dbNamesDB=new jr(qn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function eo(r){return r&&typeof r.databases=="function"}function to(r){return sn(function(){return Me.letThrough=!0,r()})}function no(r){return!("from"in r)}var Tn=function(r,i){var c;if(!this)return c=new Tn,r&&"d"in r&&g(c,r),c;g(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function hs(r,i,c){var v=Tt(i,c);if(!isNaN(v)){if(0<v)throw RangeError();if(no(r))return g(r,{from:i,to:c,d:1});var v=r.l,p=r.r;if(Tt(c,r.from)<0)return v?hs(v,i,c):r.l={from:i,to:c,d:1,l:null,r:null},Zl(r);if(0<Tt(i,r.to))return p?hs(p,i,c):r.r={from:i,to:c,d:1,l:null,r:null},Zl(r);Tt(i,r.from)<0&&(r.from=i,r.l=null,r.d=p?p.d+1:1),0<Tt(c,r.to)&&(r.to=c,r.r=null,r.d=r.l?r.l.d+1:1),i=!r.r,v&&!r.l&&ms(r,v),p&&i&&ms(r,p)}}function ms(r,i){no(i)||(function c(v,p){var y=p.from,k=p.l,E=p.r;hs(v,y,p.to),k&&c(v,k),E&&c(v,E)})(r,i)}function Xl(r,i){var c=ri(i),v=c.next();if(!v.done)for(var p=v.value,y=ri(r),k=y.next(p.from),E=k.value;!v.done&&!k.done;){if(Tt(E.from,p.to)<=0&&0<=Tt(E.to,p.from))return!0;Tt(p.from,E.from)<0?p=(v=c.next(E.from)).value:E=(k=y.next(p.from)).value}return!1}function ri(r){var i=no(r)?null:{s:0,n:r};return{next:function(c){for(var v=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,v)for(;i.n.l&&Tt(c,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!v||Tt(c,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Zl(r){var i,c,v,p=(((p=r.r)==null?void 0:p.d)||0)-(((p=r.l)==null?void 0:p.d)||0),p=1<p?"r":p<-1?"l":"";p&&(i=p=="r"?"l":"r",c=a({},r),v=r[p],r.from=v.from,r.to=v.to,r[p]=v[p],c[p]=v[i],(r[i]=c).d=Jl(c)),r.d=Jl(r)}function Jl(c){var i=c.r,c=c.l;return(i?c?Math.max(i.d,c.d):i.d:c?c.d:0)+1}function ai(r,i){return u(i).forEach(function(c){r[c]?ms(r[c],i[c]):r[c]=(function v(p){var y,k,E={};for(y in p)x(p,y)&&(k=p[y],E[y]=!k||typeof k!="object"||we.has(k.constructor)?k:v(k));return E})(i[c])}),r}function ro(r,i){return r.all||i.all||Object.keys(r).some(function(c){return i[c]&&Xl(i[c],r[c])})}b(Tn.prototype,((Ve={add:function(r){return ms(this,r),this},addKey:function(r){return hs(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(c){return hs(i,c,c)}),this},hasKey:function(r){var i=ri(this).next(r).value;return i&&Tt(i.from,r)<=0&&0<=Tt(i.to,r)}})[X]=function(){return ri(this)},Ve));var ua={},ao={},so=!1;function si(r){ai(ao,r),so||(so=!0,setTimeout(function(){so=!1,io(ao,!(ao={}))},0))}function io(r,i){i===void 0&&(i=!1);var c=new Set;if(r.all)for(var v=0,p=Object.values(ua);v<p.length;v++)$l(E=p[v],r,c,i);else for(var y in r){var k,E,y=/^idb\:\/\/(.*)\/(.*)\//.exec(y);y&&(k=y[1],y=y[2],E=ua["idb://".concat(k,"/").concat(y)])&&$l(E,r,c,i)}c.forEach(function(B){return B()})}function $l(r,i,c,v){for(var p=[],y=0,k=Object.entries(r.queries.query);y<k.length;y++){for(var E=k[y],B=E[0],te=[],F=0,j=E[1];F<j.length;F++){var H=j[F];ro(i,H.obsSet)?H.subscribers.forEach(function(se){return c.add(se)}):v&&te.push(H)}v&&p.push([B,te])}if(v)for(var W=0,z=p;W<z.length;W++){var N=z[W],B=N[0],te=N[1];r.queries.query[B]=te}}function iv(r){var i=r._state,c=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?je(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var v=i.openCanceller,p=Math.round(10*r.verno),y=!1;function k(){if(i.openCanceller!==v)throw new K.DatabaseClosed("db.open() was cancelled")}function E(){return new Ee(function(H,W){if(k(),!c)throw new K.MissingAPI;var z=r.name,N=i.autoSchema||!p?c.open(z):c.open(z,p);if(!N)throw new K.MissingAPI;N.onerror=kr(W),N.onblocked=Xe(r._fireOnBlocked),N.onupgradeneeded=Xe(function(se){var ue;F=N.transaction,i.autoSchema&&!r._options.allowEmptyDB?(N.onerror=ds,F.abort(),N.result.close(),(ue=c.deleteDatabase(z)).onsuccess=ue.onerror=Xe(function(){W(new K.NoSuchDatabase("Database ".concat(z," doesnt exist")))})):(F.onerror=kr(W),ue=se.oldVersion>Math.pow(2,62)?0:se.oldVersion,j=ue<1,r.idbdb=N.result,y&&av(r,F),rv(r,ue/10,F,W))},W),N.onsuccess=Xe(function(){F=null;var se,ue,$,be,Ae,Le,Ne=r.idbdb=N.result,Ie=de(Ne.objectStoreNames);if(0<Ie.length)try{var Ge=Ne.transaction((Ae=Ie).length===1?Ae[0]:Ae,"readonly");if(i.autoSchema)Le=Ne,be=Ge,($=r).verno=Le.version/10,be=$._dbSchema=ti(0,Le,be),$._storeNames=de(Le.objectStoreNames,0),$s($,[$._allTables],u(be),be);else if(ni(r,r._dbSchema,Ge),ue=Ge,((ue=Zi(ti(0,(se=r).idbdb,ue),se._dbSchema)).add.length||ue.change.some(function(Ue){return Ue.add.length||Ue.change.length}))&&!y)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ne.close(),p=Ne.version+1,y=!0,H(E());Js(r,Ge)}catch{}cn.push(r),Ne.onversionchange=Xe(function(Ue){i.vcFired=!0,r.on("versionchange").fire(Ue)}),Ne.onclose=Xe(function(){r.close({disableAutoOpen:!1})}),j&&(Ie=r._deps,Ae=z,eo(Le=Ie.indexedDB)||Ae===qn||$i(Le,Ie.IDBKeyRange).put({name:Ae}).catch(ce)),H()},W)}).catch(function(H){switch(H==null?void 0:H.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),E();break;case"VersionError":if(0<p)return p=0,E()}return Ee.reject(H)})}var B,te=i.dbReadyResolve,F=null,j=!1;return Ee.race([v,(typeof navigator>"u"?Ee.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(H){function W(){return indexedDB.databases().finally(H)}B=setInterval(W,100),W()}).finally(function(){return clearInterval(B)}):Promise.resolve()).then(E)]).then(function(){return k(),i.onReadyBeingFired=[],Ee.resolve(to(function(){return r.on.ready.fire(r.vip)})).then(function H(){var W;if(0<i.onReadyBeingFired.length)return W=i.onReadyBeingFired.reduce(Fe,ce),i.onReadyBeingFired=[],Ee.resolve(to(function(){return W(r.vip)})).then(H)})}).finally(function(){i.openCanceller===v&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(H){i.dbOpenError=H;try{F&&F.abort()}catch{}return v===i.openCanceller&&r._close(),je(H)}).finally(function(){i.openComplete=!0,te()}).then(function(){var H;return j&&(H={},r.tables.forEach(function(W){W.schema.indexes.forEach(function(z){z.name&&(H["idb://".concat(r.name,"/").concat(W.name,"/").concat(z.name)]=new Tn(-1/0,[[[]]]))}),H["idb://".concat(r.name,"/").concat(W.name,"/")]=H["idb://".concat(r.name,"/").concat(W.name,"/:dels")]=new Tn(-1/0,[[[]]])}),Xr(vs).fire(H),io(H,!0)),r})}function oo(r){function i(y){return r.next(y)}var c=p(i),v=p(function(y){return r.throw(y)});function p(y){return function(E){var E=y(E),B=E.value;return E.done?B:B&&typeof B.then=="function"?B.then(c,v):d(B)?Promise.all(B).then(c,v):c(B)}}return p(i)()}function ii(r,i,c){for(var v=d(r)?r.slice():[r],p=0;p<c;++p)v.push(i);return v}var ov={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(v){var c=r.table(v),v=c.schema,p={},y=[];function k(H,W,z){var $=ps(H),N=p[$]=p[$]||[],se=H==null?0:typeof H=="string"?1:H.length,ue=0<W,$=a(a({},z),{name:ue?"".concat($,"(virtual-from:").concat(z.name,")"):z.name,lowLevelIndex:z,isVirtual:ue,keyTail:W,keyLength:se,extractKey:Qi(H),unique:!ue&&z.unique});return N.push($),$.isPrimaryKey||y.push($),1<se&&k(se===2?H[0]:H.slice(0,se-1),W+1,z),N.sort(function(be,Ae){return be.keyTail-Ae.keyTail}),$}var E=k(v.primaryKey.keyPath,0,v.primaryKey);p[":id"]=[E];for(var B=0,te=v.indexes;B<te.length;B++){var F=te[B];k(F.keyPath,0,F)}function j(H){var W,z=H.query.index;return z.isVirtual?a(a({},H),{query:{index:z.lowLevelIndex,range:(W=H.query.range,z=z.keyTail,{type:W.type===1?2:W.type,lower:ii(W.lower,W.lowerOpen?r.MAX_KEY:r.MIN_KEY,z),lowerOpen:!0,upper:ii(W.upper,W.upperOpen?r.MIN_KEY:r.MAX_KEY,z),upperOpen:!0})}}):H}return a(a({},c),{schema:a(a({},v),{primaryKey:E,indexes:y,getIndexByKeyPath:function(H){return(H=p[ps(H)])&&H[0]}}),count:function(H){return c.count(j(H))},query:function(H){return c.query(j(H))},openCursor:function(H){var W=H.query.index,z=W.keyTail,N=W.keyLength;return W.isVirtual?c.openCursor(j(H)).then(function(ue){return ue&&se(ue)}):c.openCursor(H);function se(ue){return Object.create(ue,{continue:{value:function($){$!=null?ue.continue(ii($,H.reverse?r.MAX_KEY:r.MIN_KEY,z)):H.unique?ue.continue(ue.key.slice(0,N).concat(H.reverse?r.MIN_KEY:r.MAX_KEY,z)):ue.continue()}},continuePrimaryKey:{value:function($,be){ue.continuePrimaryKey(ii($,r.MAX_KEY,z),be)}},primaryKey:{get:function(){return ue.primaryKey}},key:{get:function(){var $=ue.key;return N===1?$[0]:$.slice(0,N)}},value:{get:function(){return ue.value}}})}}})}})}};function lo(r,i,c,v){return c=c||{},v=v||"",u(r).forEach(function(p){var y,k,E;x(i,p)?(y=r[p],k=i[p],typeof y=="object"&&typeof k=="object"&&y&&k?(E=ae(y))!==ae(k)?c[v+p]=i[p]:E==="Object"?lo(y,k,c,v+p+"."):y!==k&&(c[v+p]=i[p]):y!==k&&(c[v+p]=i[p])):c[v+p]=void 0}),u(i).forEach(function(p){x(r,p)||(c[v+p]=i[p])}),c}function co(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var lv={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(i){var c=r.table(i),v=c.schema.primaryKey;return a(a({},c),{mutate:function(p){var y=Me.trans,k=y.table(i).hook,E=k.deleting,B=k.creating,te=k.updating;switch(p.type){case"add":if(B.fire===ce)break;return y._promise("readwrite",function(){return F(p)},!0);case"put":if(B.fire===ce&&te.fire===ce)break;return y._promise("readwrite",function(){return F(p)},!0);case"delete":if(E.fire===ce)break;return y._promise("readwrite",function(){return F(p)},!0);case"deleteRange":if(E.fire===ce)break;return y._promise("readwrite",function(){return(function j(H,W,z){return c.query({trans:H,values:!1,query:{index:v,range:W},limit:z}).then(function(N){var se=N.result;return F({type:"delete",keys:se,trans:H}).then(function(ue){return 0<ue.numFailures?Promise.reject(ue.failures[0]):se.length<z?{failures:[],numFailures:0,lastResult:void 0}:j(H,a(a({},W),{lower:se[se.length-1],lowerOpen:!0}),z)})})})(p.trans,p.range,1e4)},!0)}return c.mutate(p);function F(j){var H,W,z,N=Me.trans,se=j.keys||co(v,j);if(se)return(j=j.type==="add"||j.type==="put"?a(a({},j),{keys:se}):a({},j)).type!=="delete"&&(j.values=s([],j.values)),j.keys&&(j.keys=s([],j.keys)),H=c,z=se,((W=j).type==="add"?Promise.resolve([]):H.getMany({trans:W.trans,keys:z,cache:"immutable"})).then(function(ue){var $=se.map(function(be,Ae){var Le,Ne,Ie,Ge=ue[Ae],Ue={onerror:null,onsuccess:null};return j.type==="delete"?E.fire.call(Ue,be,Ge,N):j.type==="add"||Ge===void 0?(Le=B.fire.call(Ue,be,j.values[Ae],N),be==null&&Le!=null&&(j.keys[Ae]=be=Le,v.outbound||P(j.values[Ae],v.keyPath,be))):(Le=lo(Ge,j.values[Ae]),(Ne=te.fire.call(Ue,Le,be,Ge,N))&&(Ie=j.values[Ae],Object.keys(Ne).forEach(function(Re){x(Ie,Re)?Ie[Re]=Ne[Re]:P(Ie,Re,Ne[Re])}))),Ue});return c.mutate(j).then(function(be){for(var Ae=be.failures,Le=be.results,Ne=be.numFailures,be=be.lastResult,Ie=0;Ie<se.length;++Ie){var Ge=(Le||se)[Ie],Ue=$[Ie];Ge==null?Ue.onerror&&Ue.onerror(Ae[Ie]):Ue.onsuccess&&Ue.onsuccess(j.type==="put"&&ue[Ie]?j.values[Ie]:Ge)}return{failures:Ae,results:Le,numFailures:Ne,lastResult:be}}).catch(function(be){return $.forEach(function(Ae){return Ae.onerror&&Ae.onerror(be)}),Promise.reject(be)})});throw new Error("Keys missing")}}})}})}};function ec(r,i,c){try{if(!i||i.keys.length<r.length)return null;for(var v=[],p=0,y=0;p<i.keys.length&&y<r.length;++p)Tt(i.keys[p],r[y])===0&&(v.push(c?ge(i.values[p]):i.values[p]),++y);return v.length===r.length?v:null}catch{return null}}var cv={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var c=r.table(i);return a(a({},c),{getMany:function(v){var p;return v.cache?(p=ec(v.keys,v.trans._cache,v.cache==="clone"))?Ee.resolve(p):c.getMany(v).then(function(y){return v.trans._cache={keys:v.keys,values:v.cache==="clone"?ge(y):y},y}):c.getMany(v)},mutate:function(v){return v.type!=="add"&&(v.trans._cache=null),c.mutate(v)}})}}}};function tc(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function nc(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var uv={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,c=new Tn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(v,p,y){if(Me.subscr&&p!=="readonly")throw new K.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Me.querier));return r.transaction(v,p,y)},table:function(v){function p(se){var N,se=se.query;return[N=se.index,new Tn((N=(se=se.range).lower)!=null?N:r.MIN_KEY,(N=se.upper)!=null?N:r.MAX_KEY)]}var y=r.table(v),k=y.schema,E=k.primaryKey,B=k.indexes,te=E.extractKey,F=E.outbound,j=E.autoIncrement&&B.filter(function(z){return z.compound&&z.keyPath.includes(E.keyPath)}),H=a(a({},y),{mutate:function(z){function N(We){return We="idb://".concat(i,"/").concat(v,"/").concat(We),Ae[We]||(Ae[We]=new Tn)}var se,ue,$,be=z.trans,Ae=z.mutatedParts||(z.mutatedParts={}),Le=N(""),Ne=N(":dels"),Ie=z.type,Ue=z.type==="deleteRange"?[z.range]:z.type==="delete"?[z.keys]:z.values.length<50?[co(E,z).filter(function(We){return We}),z.values]:[],Ge=Ue[0],Ue=Ue[1],Re=z.trans._cache;return d(Ge)?(Le.addKeys(Ge),(Ie=Ie==="delete"||Ge.length===Ue.length?ec(Ge,Re):null)||Ne.addKeys(Ge),(Ie||Ue)&&(se=N,ue=Ie,$=Ue,k.indexes.forEach(function(We){var It=se(We.name||"");function Dt(gt){return gt!=null?We.extractKey(gt):null}function nt(gt){We.multiEntry&&d(gt)?gt.forEach(function(rn){return It.addKey(rn)}):It.addKey(gt)}(ue||$).forEach(function(gt,ln){var er=ue&&Dt(ue[ln]),ln=$&&Dt($[ln]);Tt(er,ln)!==0&&(er!=null&&nt(er),ln!=null)&&nt(ln)})}))):Ge?(Ue={from:(Re=Ge.lower)!=null?Re:r.MIN_KEY,to:(Ie=Ge.upper)!=null?Ie:r.MAX_KEY},Ne.add(Ue),Le.add(Ue)):(Le.add(c),Ne.add(c),k.indexes.forEach(function(We){return N(We.name).add(c)})),y.mutate(z).then(function(We){return!Ge||z.type!=="add"&&z.type!=="put"||(Le.addKeys(We.results),j&&j.forEach(function(It){for(var Dt=z.values.map(function(er){return It.extractKey(er)}),nt=It.keyPath.findIndex(function(er){return er===E.keyPath}),gt=0,rn=We.results.length;gt<rn;++gt)Dt[gt][nt]=We.results[gt];N(It.name).addKeys(Dt)})),be.mutatedParts=ai(be.mutatedParts||{},Ae),We})}}),W={get:function(z){return[E,new Tn(z.key)]},getMany:function(z){return[E,new Tn().addKeys(z.keys)]},count:p,query:p,openCursor:p};return u(W).forEach(function(z){H[z]=function(N){var se=Me.subscr,ue=!!se,$=tc(Me,y)&&nc(z,N)?N.obsSet={}:se;if(ue){var be,se=function(Ue){return Ue="idb://".concat(i,"/").concat(v,"/").concat(Ue),$[Ue]||($[Ue]=new Tn)},Ae=se(""),Le=se(":dels"),ue=W[z](N),Ne=ue[0],ue=ue[1];if((z==="query"&&Ne.isPrimaryKey&&!N.values?Le:se(Ne.name||"")).add(ue),!Ne.isPrimaryKey){if(z!=="count")return be=z==="query"&&F&&N.values&&y.query(a(a({},N),{values:!1})),y[z].apply(this,arguments).then(function(Ue){if(z==="query"){if(F&&N.values)return be.then(function(Dt){return Dt=Dt.result,Ae.addKeys(Dt),Ue});var Re=N.values?Ue.result.map(te):Ue.result;(N.values?Ae:Le).addKeys(Re)}else{var We,It;if(z==="openCursor")return It=N.values,(We=Ue)&&Object.create(We,{key:{get:function(){return Le.addKey(We.primaryKey),We.key}},primaryKey:{get:function(){var Dt=We.primaryKey;return Le.addKey(Dt),Dt}},value:{get:function(){return It&&Ae.addKey(We.primaryKey),We.value}}})}return Ue});Le.add(c)}}return y[z].apply(this,arguments)}}),H}})}};function rc(r,i,c){var v;return c.numFailures===0?i:i.type==="deleteRange"||(v=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,c.numFailures===v)?null:(v=a({},i),d(v.keys)&&(v.keys=v.keys.filter(function(p,y){return!(y in c.failures)})),"values"in v&&d(v.values)&&(v.values=v.values.filter(function(p,y){return!(y in c.failures)})),v)}function uo(r,i){return c=r,((v=i).lower===void 0||(v.lowerOpen?0<Tt(c,v.lower):0<=Tt(c,v.lower)))&&(c=r,(v=i).upper===void 0||(v.upperOpen?Tt(c,v.upper)<0:Tt(c,v.upper)<=0));var c,v}function ac(r,i,c,v,p,y){var k,E,B,te,F,j;return!c||c.length===0||(k=i.query.index,E=k.multiEntry,B=i.query.range,te=v.schema.primaryKey.extractKey,F=k.extractKey,j=(k.lowLevelIndex||k).extractKey,(v=c.reduce(function(H,W){var z=H,N=[];if(W.type==="add"||W.type==="put")for(var se=new Tn,ue=W.values.length-1;0<=ue;--ue){var $,be=W.values[ue],Ae=te(be);!se.hasKey(Ae)&&($=F(be),E&&d($)?$.some(function(Ue){return uo(Ue,B)}):uo($,B))&&(se.addKey(Ae),N.push(be))}switch(W.type){case"add":var Le=new Tn().addKeys(i.values?H.map(function(Re){return te(Re)}):H),z=H.concat(i.values?N.filter(function(Re){return Re=te(Re),!Le.hasKey(Re)&&(Le.addKey(Re),!0)}):N.map(function(Re){return te(Re)}).filter(function(Re){return!Le.hasKey(Re)&&(Le.addKey(Re),!0)}));break;case"put":var Ne=new Tn().addKeys(W.values.map(function(Re){return te(Re)}));z=H.filter(function(Re){return!Ne.hasKey(i.values?te(Re):Re)}).concat(i.values?N:N.map(function(Re){return te(Re)}));break;case"delete":var Ie=new Tn().addKeys(W.keys);z=H.filter(function(Re){return!Ie.hasKey(i.values?te(Re):Re)});break;case"deleteRange":var Ge=W.range;z=H.filter(function(Re){return!uo(te(Re),Ge)})}return z},r))===r)?r:(v.sort(function(H,W){return Tt(j(H),j(W))||Tt(te(H),te(W))}),i.limit&&i.limit<1/0&&(v.length>i.limit?v.length=i.limit:r.length===i.limit&&v.length<i.limit&&(p.dirty=!0)),y?Object.freeze(v):v)}function sc(r,i){return Tt(r.lower,i.lower)===0&&Tt(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function dv(r,i){return((c,v,p,y)=>{if(c===void 0)return v!==void 0?-1:0;if(v===void 0)return 1;if((c=Tt(c,v))===0){if(p&&y)return 0;if(p)return 1;if(y)return-1}return c})(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=((c,v,p,y)=>{if(c===void 0)return v!==void 0?1:0;if(v===void 0)return-1;if((c=Tt(c,v))===0){if(p&&y)return 0;if(p)return-1;if(y)return 1}return c})(r.upper,i.upper,r.upperOpen,i.upperOpen)}function vv(r,i,c,v){r.subscribers.add(c),v.addEventListener("abort",function(){var p,y;r.subscribers.delete(c),r.subscribers.size===0&&(p=r,y=i,setTimeout(function(){p.subscribers.size===0&&M(y,p)},3e3))})}var fv={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return a(a({},r),{transaction:function(c,v,p){var y,k,E=r.transaction(c,v,p);return v==="readwrite"&&(p=(y=new AbortController).signal,E.addEventListener("abort",(k=function(B){return function(){if(y.abort(),v==="readwrite"){for(var te=new Set,F=0,j=c;F<j.length;F++){var H=j[F],W=ua["idb://".concat(i,"/").concat(H)];if(W){var z=r.table(H),N=W.optimisticOps.filter(function(We){return We.trans===E});if(E._explicit&&B&&E.mutatedParts)for(var se=0,ue=Object.values(W.queries.query);se<ue.length;se++)for(var $=0,be=(Ne=ue[se]).slice();$<be.length;$++)ro((Ie=be[$]).obsSet,E.mutatedParts)&&(M(Ne,Ie),Ie.subscribers.forEach(function(We){return te.add(We)}));else if(0<N.length){W.optimisticOps=W.optimisticOps.filter(function(We){return We.trans!==E});for(var Ae=0,Le=Object.values(W.queries.query);Ae<Le.length;Ae++)for(var Ne,Ie,Ge,Ue=0,Re=(Ne=Le[Ae]).slice();Ue<Re.length;Ue++)(Ie=Re[Ue]).res!=null&&E.mutatedParts&&(B&&!Ie.dirty?(Ge=Object.isFrozen(Ie.res),Ge=ac(Ie.res,Ie.req,N,z,Ie,Ge),Ie.dirty?(M(Ne,Ie),Ie.subscribers.forEach(function(We){return te.add(We)})):Ge!==Ie.res&&(Ie.res=Ge,Ie.promise=Ee.resolve({result:Ge}))):(Ie.dirty&&M(Ne,Ie),Ie.subscribers.forEach(function(We){return te.add(We)})))}}}te.forEach(function(We){return We()})}}})(!1),{signal:p}),E.addEventListener("error",k(!1),{signal:p}),E.addEventListener("complete",k(!0),{signal:p})),E},table:function(c){var v=r.table(c),p=v.schema.primaryKey;return a(a({},v),{mutate:function(y){var k,E=Me.trans;return!p.outbound&&E.db._options.cache!=="disabled"&&!E.explicit&&E.idbtrans.mode==="readwrite"&&(k=ua["idb://".concat(i,"/").concat(c)])?(E=v.mutate(y),y.type!=="add"&&y.type!=="put"||!(50<=y.values.length||co(p,y).some(function(B){return B==null}))?(k.optimisticOps.push(y),y.mutatedParts&&si(y.mutatedParts),E.then(function(B){0<B.numFailures&&(M(k.optimisticOps,y),(B=rc(0,y,B))&&k.optimisticOps.push(B),y.mutatedParts)&&si(y.mutatedParts)}),E.catch(function(){M(k.optimisticOps,y),y.mutatedParts&&si(y.mutatedParts)})):E.then(function(B){var te=rc(0,a(a({},y),{values:y.values.map(function(F,j){var H;return B.failures[j]?F:(P(H=(H=p.keyPath)!=null&&H.includes(".")?ge(F):a({},F),p.keyPath,B.results[j]),H)})}),B);k.optimisticOps.push(te),queueMicrotask(function(){return y.mutatedParts&&si(y.mutatedParts)})}),E):v.mutate(y)},query:function(y){var k,E,B,te,F,j,H;return tc(Me,v)&&nc("query",y)?(k=((B=Me.trans)==null?void 0:B.db._options.cache)==="immutable",E=(B=Me).requery,B=B.signal,j=((W,z,N,se)=>{var ue=ua["idb://".concat(W,"/").concat(z)];if(!ue)return[];if(!(W=ue.queries[N]))return[null,!1,ue,null];var $=W[(se.query?se.query.index.name:null)||""];if(!$)return[null,!1,ue,null];switch(N){case"query":var be=$.find(function(Ae){return Ae.req.limit===se.limit&&Ae.req.values===se.values&&sc(Ae.req.query.range,se.query.range)});return be?[be,!0,ue,$]:[$.find(function(Ae){return("limit"in Ae.req?Ae.req.limit:1/0)>=se.limit&&(!se.values||Ae.req.values)&&dv(Ae.req.query.range,se.query.range)}),!1,ue,$];case"count":return be=$.find(function(Ae){return sc(Ae.req.query.range,se.query.range)}),[be,!!be,ue,$]}})(i,c,"query",y),H=j[0],te=j[2],F=j[3],H&&j[1]?H.obsSet=y.obsSet:(j=v.query(y).then(function(W){var z=W.result;if(H&&(H.res=z),k){for(var N=0,se=z.length;N<se;++N)Object.freeze(z[N]);Object.freeze(z)}else W.result=ge(z);return W}).catch(function(W){return F&&H&&M(F,H),Promise.reject(W)}),H={obsSet:y.obsSet,promise:j,subscribers:new Set,type:"query",req:y,dirty:!1},F?F.push(H):(F=[H],(te=te||(ua["idb://".concat(i,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[y.query.index.name||""]=F)),vv(H,F,E,B),H.promise.then(function(W){return{result:ac(W.result,y,te==null?void 0:te.optimisticOps,v,H,k)}})):v.query(y)}})}})}};function oi(r,i){return new Proxy(r,{get:function(c,v,p){return v==="db"?i:Reflect.get(c,v,p)}})}un.prototype.version=function(r){if(isNaN(r)||r<.1)throw new K.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new K.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,c=i.filter(function(v){return v._cfg.version===r})[0];return c||(c=new this.Version(r),i.push(c),i.sort(nv),c.stores({}),this._state.autoSchema=!1),c},un.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||Me.letThrough||this._vip)?r():new Ee(function(c,v){if(i._state.openComplete)return v(new K.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void v(new K.DatabaseClosed);i.open().catch(ce)}i._state.dbReadyPromise.then(c,v)}).then(r)},un.prototype.use=function(p){var i=p.stack,c=p.create,v=p.level,p=p.name,y=(p&&this.unuse({stack:i,name:p}),this._middlewares[i]||(this._middlewares[i]=[]));return y.push({stack:i,create:c,level:v??10,name:p}),y.sort(function(k,E){return k.level-E.level}),this},un.prototype.unuse=function(r){var i=r.stack,c=r.name,v=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(p){return v?p.create!==v:!!c&&p.name!==c})),this},un.prototype.open=function(){var r=this;return Ye(at,function(){return iv(r)})},un.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,i=cn.indexOf(this);if(0<=i&&cn.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Ee(function(c){r.dbReadyResolve=c}),r.openCanceller=new Ee(function(c,v){r.cancelOpen=v}))},un.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,c=this._state;i?(c.isBeingOpened&&c.cancelOpen(new K.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new K.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},un.prototype.delete=function(r){var i=this,c=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),v=this._state;return new Ee(function(p,y){function k(){i.close(r);var E=i._deps.indexedDB.deleteDatabase(i.name);E.onsuccess=Xe(function(){var B,te,F;B=i._deps,te=i.name,eo(F=B.indexedDB)||te===qn||$i(F,B.IDBKeyRange).delete(te).catch(ce),p()}),E.onerror=kr(y),E.onblocked=i._fireOnBlocked}if(c)throw new K.InvalidArgument("Invalid closeOptions argument to db.delete()");v.isBeingOpened?v.dbReadyPromise.then(k):k()})},un.prototype.backendDB=function(){return this.idbdb},un.prototype.isOpen=function(){return this.idbdb!==null},un.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},un.prototype.hasFailed=function(){return this._state.dbOpenError!==null},un.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(un.prototype,"tables",{get:function(){var r=this;return u(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),un.prototype.transaction=function(){var r=(function(i,c,v){var p=arguments.length;if(p<2)throw new K.InvalidArgument("Too few arguments");for(var y=new Array(p-1);--p;)y[p-1]=arguments[p];return v=y.pop(),[i,xe(y),v]}).apply(this,arguments);return this._transaction.apply(this,r)},un.prototype._transaction=function(r,i,c){var v,p,y=this,k=Me.trans,E=(k&&k.db===this&&r.indexOf("!")===-1||(k=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(p=i.map(function(te){if(te=te instanceof y.Table?te.name:te,typeof te!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return te}),r=="r"||r===wr)v=wr;else{if(r!="rw"&&r!=la)throw new K.InvalidArgument("Invalid transaction mode: "+r);v=la}if(k){if(k.mode===wr&&v===la){if(!E)throw new K.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&p.forEach(function(te){if(k&&k.storeNames.indexOf(te)===-1){if(!E)throw new K.SubTransaction("Table "+te+" not included in parent transaction.");k=null}}),E&&k&&!k.active&&(k=null)}}catch(te){return k?k._promise(null,function(F,j){j(te)}):je(te)}var B=(function te(F,j,H,W,z){return Ee.resolve().then(function(){var $=Me.transless||Me,N=F._createTransaction(j,H,F._dbSchema,W),$=(N.explicit=!0,{trans:N,transless:$});if(W)N.idbtrans=W.idbtrans;else try{N.create(),N.idbtrans._explicit=!0,F._state.PR1398_maxLoop=3}catch(be){return be.name===ye.InvalidState&&F.isOpen()&&0<--F._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),F.close({disableAutoOpen:!1}),F.open().then(function(){return te(F,j,H,null,z)})):je(be)}var se,ue=pe(z),$=(ue&&Rt(),Ee.follow(function(){var be;(se=z.call(N,N))&&(ue?(be=on.bind(null,null),se.then(be,be)):typeof se.next=="function"&&typeof se.throw=="function"&&(se=oo(se)))},$));return(se&&typeof se.then=="function"?Ee.resolve(se).then(function(be){return N.active?be:je(new K.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):$.then(function(){return se})).then(function(be){return W&&N._resolve(),N._completion.then(function(){return be})}).catch(function(be){return N._reject(be),je(be)})})}).bind(null,this,v,p,k,c);return k?k._promise(v,B,"lock"):Me.trans?Ye(Me.transless,function(){return y._whenReady(B)}):this._whenReady(B)},un.prototype.table=function(r){if(x(this._allTables,r))return this._allTables[r];throw new K.InvalidTable("Table ".concat(r," does not exist"))};var jr=un;function un(r,i){var c,v,p,y,k,E=this,B=(this._middlewares={},this.verno=0,un.dependencies),B=(this._options=i=a({addons:un.addons,autoOpen:!0,indexedDB:B.indexedDB,IDBKeyRange:B.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),te=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ce,dbReadyPromise:null,cancelOpen:ce,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),F=(te.dbReadyPromise=new Ee(function(j){te.dbReadyResolve=j}),te.openCanceller=new Ee(function(j,H){te.cancelOpen=H}),this._state=te,this.name=r,this.on=cs(this,"populate","blocked","versionchange","close",{ready:[Fe,ce]}),this.once=function(j,H){var W=function(){for(var z=[],N=0;N<arguments.length;N++)z[N]=arguments[N];E.on(j).unsubscribe(W),H.apply(E,z)};return E.on(j,W)},this.on.ready.subscribe=he(this.on.ready.subscribe,function(j){return function(H,W){un.vip(function(){var z,N=E._state;N.openComplete?(N.dbOpenError||Ee.resolve().then(H),W&&j(H)):N.onReadyBeingFired?(N.onReadyBeingFired.push(H),W&&j(H)):(j(H),z=E,W||j(function se(){z.on.ready.unsubscribe(H),z.on.ready.unsubscribe(se)}))})}}),this.Collection=(c=this,us(Qd.prototype,function(se,N){this.db=c;var W=os,z=null;if(N)try{W=N()}catch($){z=$}var N=se._ctx,se=N.table,ue=se.hook.reading.fire;this._ctx={table:se,index:N.index,isPrimKey:!N.index||se.schema.primKey.keyPath&&N.index===se.schema.primKey.name,range:W,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:z,or:N.or,valueMapper:ue!==Oe?ue:null}})),this.Table=(v=this,us(Fl.prototype,function(j,H,W){this.db=v,this._tx=W,this.name=j,this.schema=H,this.hook=v._allTables[j]?v._allTables[j].hook:cs(null,{creating:[ut,ce],reading:[qe,Oe],updating:[Ze,ce],deleting:[wt,ce]})})),this.Transaction=(p=this,us(Jd.prototype,function(j,H,W,z,N){var se=this;j!=="readonly"&&H.forEach(function(ue){ue=(ue=W[ue])==null?void 0:ue.yProps,ue&&(H=H.concat(ue.map(function($){return $.updatesTable})))}),this.db=p,this.mode=j,this.storeNames=H,this.schema=W,this.chromeTransactionDurability=z,this.idbtrans=null,this.on=cs(this,"complete","error","abort"),this.parent=N||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ee(function(ue,$){se._resolve=ue,se._reject=$}),this._completion.then(function(){se.active=!1,se.on.complete.fire()},function(ue){var $=se.active;return se.active=!1,se.on.error.fire(ue),se.parent?se.parent._reject(ue):$&&se.idbtrans&&se.idbtrans.abort(),je(ue)})})),this.Version=(y=this,us(sv.prototype,function(j){this.db=y,this._cfg={version:j,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,us(Hl.prototype,function(j,H,W){if(this.db=k,this._ctx={table:j,index:H===":id"?null:H,or:W},this._cmp=this._ascending=Tt,this._descending=function(z,N){return Tt(N,z)},this._max=function(z,N){return 0<Tt(z,N)?z:N},this._min=function(z,N){return Tt(z,N)<0?z:N},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new K.MissingAPI})),this.on("versionchange",function(j){0<j.newVersion?console.warn("Another connection wants to upgrade database '".concat(E.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(E.name,"'. Closing db now to resume the delete request.")),E.close({disableAutoOpen:!1})}),this.on("blocked",function(j){!j.newVersion||j.newVersion<j.oldVersion?console.warn("Dexie.delete('".concat(E.name,"') was blocked")):console.warn("Upgrade '".concat(E.name,"' blocked by other connection holding version ").concat(j.oldVersion/10))}),this._maxKey=fs(i.IDBKeyRange),this._createTransaction=function(j,H,W,z){return new E.Transaction(j,H,W,E._options.chromeTransactionDurability,z)},this._fireOnBlocked=function(j){E.on("blocked").fire(j),cn.filter(function(H){return H.name===E.name&&H!==E&&!H._state.vcFired}).map(function(H){return H.on("versionchange").fire(j)})},this.use(cv),this.use(fv),this.use(uv),this.use(ov),this.use(lv),new Proxy(this,{get:function(j,H,W){var z;return H==="_vip"||(H==="table"?function(N){return oi(E.table(N),F)}:(z=Reflect.get(j,H,W))instanceof Fl?oi(z,F):H==="tables"?z.map(function(N){return oi(N,F)}):H==="_createTransaction"?function(){return oi(z.apply(this,arguments),F)}:z)}}));this.vip=F,B.forEach(function(j){return j(E)})}var li,za=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",pv=(vo.prototype.subscribe=function(r,i,c){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:c})},vo.prototype[za]=function(){return this},vo);function vo(r){this._subscribe=r}try{li={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{li={indexedDB:null,IDBKeyRange:null}}function ic(r){var i,c=!1,v=new pv(function(p){var y=pe(r),k,E=!1,B={},te={},F={get closed(){return E},unsubscribe:function(){E||(E=!0,k&&k.abort(),j&&Xr.storagemutated.unsubscribe(W))}},j=(p.start&&p.start(F),!1),H=function(){return Ce(z)},W=function(N){ai(B,N),ro(te,B)&&H()},z=function(){var N,se,ue;!E&&li.indexedDB&&(B={},N={},k&&k.abort(),k=new AbortController,ue=($=>{var be=mn();try{y&&Rt();var Ae=sn(r,$);return Ae=y?Ae.finally(on):Ae}finally{be&&rt()}})(se={subscr:N,signal:k.signal,requery:H,querier:r,trans:null}),Promise.resolve(ue).then(function($){c=!0,i=$,E||se.signal.aborted||(B={},(be=>{for(var Ae in be)if(x(be,Ae))return;return 1})(te=N)||j||(Xr(vs,W),j=!0),Ce(function(){return!E&&p.next&&p.next($)}))},function($){c=!1,["DatabaseClosedError","AbortError"].includes($==null?void 0:$.name)||E||Ce(function(){E||p.error&&p.error($)})}))};return setTimeout(H,0),F});return v.hasValue=function(){return c},v.getValue=function(){return i},v}var da=jr;function fo(r){var i=Zr;try{Zr=!0,Xr.storagemutated.fire(r),io(r,!0)}finally{Zr=i}}b(da,a(a({},oe),{delete:function(r){return new da(r,{addons:[]}).delete()},exists:function(r){return new da(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=da.dependencies,c=i.indexedDB,i=i.IDBKeyRange,(eo(c)?Promise.resolve(c.databases()).then(function(v){return v.map(function(p){return p.name}).filter(function(p){return p!==qn})}):$i(c,i).toCollection().primaryKeys()).then(r)}catch{return je(new K.MissingAPI)}var i,c},defineClass:function(){return function(r){g(this,r)}},ignoreTransaction:function(r){return Me.trans?Ye(Me.transless,r):r()},vip:to,async:function(r){return function(){try{var i=oo(r.apply(this,arguments));return i&&typeof i.then=="function"?i:Ee.resolve(i)}catch(c){return je(c)}}},spawn:function(r,i,c){try{var v=oo(r.apply(c,i||[]));return v&&typeof v.then=="function"?v:Ee.resolve(v)}catch(p){return je(p)}},currentTransaction:{get:function(){return Me.trans||null}},waitFor:function(r,i){return r=Ee.resolve(typeof r=="function"?da.ignoreTransaction(r):r).timeout(i||6e4),Me.trans?Me.trans.waitFor(r):r},Promise:Ee,debug:{get:function(){return He},set:function(r){it(r)}},derive:D,extend:g,props:b,override:he,Events:cs,on:Xr,liveQuery:ic,extendObservabilitySet:ai,getByKeyPath:q,setByKeyPath:P,delByKeyPath:function(r,i){typeof i=="string"?P(r,i,void 0):"length"in i&&[].map.call(i,function(c){P(r,c,void 0)})},shallowClone:le,deepClone:ge,getObjectDiff:lo,cmp:Tt,asap:U,minKey:-1/0,addons:[],connections:cn,errnames:ye,dependencies:li,cache:ua,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,c){return r+i/Math.pow(10,2*c)})})),da.maxKey=fs(da.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Xr(vs,function(r){Zr||(r=new CustomEvent(Wi,{detail:r}),Zr=!0,dispatchEvent(r),Zr=!1)}),addEventListener(Wi,function(r){r=r.detail,Zr||fo(r)}));var Ua,Zr=!1,oc=function(){};return typeof BroadcastChannel<"u"&&((oc=function(){(Ua=new BroadcastChannel(Wi)).onmessage=function(r){return r.data&&fo(r.data)}})(),typeof Ua.unref=="function"&&Ua.unref(),Xr(vs,function(r){Zr||Ua.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!jr.disableBfCache&&r.persisted){He&&console.debug("Dexie: handling persisted pagehide"),Ua!=null&&Ua.close();for(var i=0,c=cn;i<c.length;i++)c[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!jr.disableBfCache&&r.persisted&&(He&&console.debug("Dexie: handling persisted pageshow"),oc(),fo({all:new Tn(-1/0,[[]])}))})),Ee.rejectionMapper=function(r,i){return!r||r instanceof Y||r instanceof TypeError||r instanceof SyntaxError||!r.name||!Se[r.name]?r:(i=new Se[r.name](i||r.message,r),"stack"in r&&I(i,"stack",{get:function(){return this.inner.stack}}),i)},it(He),a(jr,Object.freeze({__proto__:null,Dexie:jr,Entity:Dl,PropModification:ls,RangeSet:Tn,add:function(r){return new ls({add:r})},cmp:Tt,default:jr,liveQuery:ic,mergeRanges:ms,rangesOverlap:Xl,remove:function(r){return new ls({remove:r})},replacePrefix:function(r,i){return new ls({replacePrefix:[r,i]})}}),{default:jr}),jr})})(bi)),bi.exports}var ep=$f();const Uo=Zf(ep),Ec=Symbol.for("Dexie"),In=globalThis[Ec]||(globalThis[Ec]=Uo);if(Uo.semVer!==In.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Uo.semVer} and ${In.semVer}`);const{liveQuery:vw,mergeRanges:fw,rangesOverlap:pw,RangeSet:hw,cmp:mw,Entity:gw,PropModification:_w,replacePrefix:yw,add:bw,remove:ww,DexieYProvider:kw}=In,Qe=new In("me-ai-store");Qe.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Qe.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Qe.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Qe.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});Qe.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});Qe.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function hl(t,e){return`${t}:${e}`}const tp=Object.freeze(Object.defineProperty({__proto__:null,db:Qe,makeItemId:hl},Symbol.toStringTag,{value:"Module"}));async function js(t,e=null){try{const n=await Qe.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Ds(t,e){try{await Qe.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function ml(t){try{await Qe.settings.delete(t)}catch{}}async function np(t){const e=await Qe.settings.bulkGet(t);return Object.fromEntries(t.map((n,a)=>{var s;return[n,((s=e[a])==null?void 0:s.value)??null]}))}const Yr=Object.freeze(Object.defineProperty({__proto__:null,getSetting:js,getSettings:np,removeSetting:ml,setSetting:Ds},Symbol.toStringTag,{value:"Module"})),Cr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function gl(t){return Cr.find(e=>e.id===t)}const rp=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Cr,getModelInfo:gl},Symbol.toStringTag,{value:"Module"})),Pr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function $u(){return Pr.filter(t=>t.recommended)}function _l(t){return Pr.find(e=>e.name===t||e.name.startsWith(t+":"))}const ap=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Pr,getOllamaModelInfo:_l,getRecommendedOllamaModels:$u},Symbol.toStringTag,{value:"Module"}));let zn=null,Fr="idle",wi=null,pa=new Set;function vi(){return zn||(zn=new Worker(new URL(""+new URL("worker-CB9TH5z_.js",import.meta.url).href,import.meta.url),{type:"module"}),zn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Fr="loading"),e.status==="ready"&&(Fr="ready"),e.status==="start"&&(Fr="generating"),(e.status==="complete"||e.status==="error")&&(Fr=wi?"ready":"idle");for(const n of pa)try{n(e)}catch{}})),zn}function wo(){return{check(){vi().postMessage({type:"check"})},loadModel(t){wi=t,Fr="loading",vi().postMessage({type:"load",modelId:t})},generate(t,e){vi().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,d=0,g=0;const _=x=>{switch(x.status){case"start":g=x.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=x.output,u=x.tps??u,d=x.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":h(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":h(),s(new Error(x.data));break}},h=()=>{pa.delete(_)};pa.add(_),vi().postMessage({type:"generate",data:t,options:e})})},interrupt(){zn==null||zn.postMessage({type:"interrupt"})},reset(){zn==null||zn.postMessage({type:"reset"})},onMessage(t){return pa.add(t),()=>pa.delete(t)},offMessage(t){pa.delete(t)},get status(){return Fr},get isReady(){return Fr==="ready"},get isGenerating(){return Fr==="generating"},get modelId(){return wi},terminate(){zn==null||zn.terminate(),zn=null,Fr="idle",wi=null,pa.clear()}}}const sp="modulepreload",ip=function(t,e){return new URL(t,e).href},Tc={},Hn=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let u=function(h){return Promise.all(h.map(x=>Promise.resolve(x).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};const d=document.getElementsByTagName("link"),g=document.querySelector("meta[property=csp-nonce]"),_=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));s=u(n.map(h=>{if(h=ip(h,a),h in Tc)return;Tc[h]=!0;const x=h.endsWith(".css"),b=x?'[rel="stylesheet"]':"";if(!!a)for(let D=d.length-1;D>=0;D--){const O=d[D];if(O.href===h&&(!x||O.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${b}`))return;const I=document.createElement("link");if(I.rel=x?"stylesheet":sp,x||(I.as="script"),I.crossOrigin="",I.href=h,_&&I.setAttribute("nonce",_),document.head.appendChild(I),x)return new Promise((D,O)=>{I.addEventListener("load",D),I.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return s.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},Ac="http://localhost:11434",op="https://me-ai.metaelon.space";function ed(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?Ac:op}catch{return Ac}}function Ws(){return ed()}async function lp(){const{getSetting:t}=await Hn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Yr);return{getSetting:e}},void 0,import.meta.url);return await t("ollamaUrl")||ed()}async function cp(t){const{setSetting:e}=await Hn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Yr);return{setSetting:n}},void 0,import.meta.url);await e("ollamaUrl",t)}async function Ko(t=Ws()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function up(t=Ws()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function dp(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:s}={},o=()=>{},u=Ws()){var I;const d={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};s!==void 0?d.keep_alive=s:d.keep_alive="10m";const g=new AbortController,_=setTimeout(()=>g.abort(),3e5),h=await fetch(`${u}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:g.signal});if(clearTimeout(_),!h.ok){const D=await h.text();throw new Error(`Ollama API error: ${D}`)}const x=h.body.getReader(),b=new TextDecoder;let w="";try{for(;;){const{done:D,value:O}=await x.read();if(D)break;const de=b.decode(O).split(`
`).filter(Boolean);for(const he of de)try{const V=JSON.parse(he);if((I=V.message)!=null&&I.content&&(w+=V.message.content,o({content:V.message.content,done:!1,total_duration:V.total_duration,eval_count:V.eval_count,eval_duration:V.eval_duration})),V.done){o({content:"",done:!0,total_duration:V.total_duration,eval_count:V.eval_count,eval_duration:V.eval_duration});break}}catch{}}}finally{x.releaseLock()}return w}let Vn="idle",Ka=null,ha=new Set;function ur(t){for(const e of ha)try{e(t)}catch{}}function vp(){return{async check(){Vn="loading",ur({status:"loading",data:"Testing Ollama connection..."});const t=await Ko();t.connected?(Vn="idle",ur({status:"ready",data:{type:"ollama",version:t.version,url:Ws()}})):(Vn="idle",ur({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ka=t,Vn="loading",ur({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Ko();if(!e.connected){Vn="idle",Ka=null,ur({status:"error",data:`Ollama not available: ${e.error}`});return}Vn="ready",ur({status:"ready"})},async generate(t,e={}){if(!Ka){ur({status:"error",data:"No Ollama model selected"});return}Vn="generating",ur({status:"start",inputTokens:0});let n=0,a=performance.now();try{await dp(Ka,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},s=>{if(s.content){n++;const o=performance.now()-a,u=o>0?n/o*1e3:0;ur({status:"update",output:s.content,tps:Math.round(u*10)/10,numTokens:n})}s.done&&(Vn="ready",ur({status:"complete",tps:s.eval_duration?Math.round(s.eval_count/(s.eval_duration/1e9)*10)/10:null,numTokens:s.eval_count||n}))})}catch(s){Vn="ready",ur({status:"error",data:s.message})}},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,d=0,g=0;const _=x=>{switch(x.status){case"start":g=x.inputTokens||0;break;case"update":if(o+=x.output,u=x.tps??u,d=x.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":h(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":h(),s(new Error(x.data));break}},h=()=>{ha.delete(_)};ha.add(_),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return ha.add(t),()=>ha.delete(t)},offMessage(t){ha.delete(t)},get status(){return Vn},get isReady(){return Vn==="ready"},get isGenerating(){return Vn==="generating"},get modelId(){return Ka},get backend(){return"ollama"},terminate(){Vn="idle",Ka=null,ha.clear()}}}let fa=null,pt=null,ko=new Set;function fp(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function td(){return{loadModel(t){const e=fp(t);if(fa!==e){pt&&pt.terminate(),fa=e,pt=e==="webgpu"?wo():vp();for(const n of ko)pt.onMessage(n)}pt.loadModel(t)},check(){pt||(pt=wo(),fa="webgpu"),pt.check()},generate(t,e){if(!pt)throw new Error("No engine loaded. Call loadModel() first.");return pt.generate(t,e)},generateFull(t,e,n){return pt?pt.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){pt==null||pt.interrupt()},reset(){pt==null||pt.reset()},onMessage(t){return pt||(pt=wo(),fa="webgpu"),ko.add(t),pt.onMessage(t)},offMessage(t){ko.delete(t),pt==null||pt.offMessage(t)},get status(){return(pt==null?void 0:pt.status)||"idle"},get isReady(){return(pt==null?void 0:pt.isReady)||!1},get isGenerating(){return(pt==null?void 0:pt.isGenerating)||!1},get modelId(){return(pt==null?void 0:pt.modelId)||null},get backend(){return fa},getModelInfo(){const t=this.modelId;return t?fa==="webgpu"?gl(t):_l(t):null},terminate(){pt==null||pt.terminate(),pt=null,fa=null}}}function Go(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function xo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),s=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return s.toFixed(o)+" "+n[a]}function pp(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function hp(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Li(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const mp="https://gmail.googleapis.com/gmail/v1/users/me";class yl extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function gp(t){return{Authorization:`Bearer ${t}`}}async function Ni(t,e){var a,s,o,u;const n=await fetch(`${mp}${e}`,{headers:gp(t)});if(!n.ok){const d=await n.json().catch(()=>({})),g=((a=d.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,_=((u=(o=(s=d.error)==null?void 0:s.errors)==null?void 0:o[0])==null?void 0:u.reason)||void 0;throw new yl(g,n.status,_)}return n.json()}function nd(t){return Ni(t,"/profile")}function rd(t,{maxResults:e=20,pageToken:n,q:a}={}){const s=new URLSearchParams;return s.set("maxResults",String(e)),n&&s.set("pageToken",n),a&&s.set("q",a),Ni(t,`/messages?${s}`)}function ad(t,e,n="full"){return Ni(t,`/messages/${e}?format=${n}`)}function _p(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const s=new URLSearchParams;return s.set("startHistoryId",e),s.set("maxResults",String(a)),s.append("historyTypes","messageAdded"),s.append("historyTypes","messageDeleted"),n&&s.set("pageToken",n),Ni(t,`/history?${s}`)}function $r(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),s=n.find(u=>u.name.toLowerCase()===a);return(s==null?void 0:s.value)||""}function Ps(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),s=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(s)}function yp(t){var o,u,d;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Ps(e.body.data);const n=e.parts||[],a=Si(n,"text/plain");if((u=a==null?void 0:a.body)!=null&&u.data)return Ps(a.body.data);const s=Si(n,"text/html");if((d=s==null?void 0:s.body)!=null&&d.data){const g=Ps(s.body.data);return wp(g)}return"(no body)"}function bp(t){var s,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((s=e.body)!=null&&s.data))return Ps(e.body.data);const n=e.parts||[],a=Si(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Ps(a.body.data):null}function Si(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=Si(n.parts,e);if(a)return a}}return null}function wp(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function bl(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function sd(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function id(t){return sd(t).charAt(0).toUpperCase()}function kp(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${s}`}catch{return"email"}}function xp(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function od(t,e){return`${kp(t.date)}_${xp(t.subject)}.${e}`}function ld(t){const e={};for(const a of t){const s=a.action||"UNKNOWN";e[s]||(e[s]=[]),e[s].push(a)}for(const a of Object.keys(e))e[a].sort((s,o)=>(o.date||0)-(s.date||0));const n=Object.keys(e).sort((a,s)=>e[s].length-e[a].length);return{groups:e,order:n}}async function Sp(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:s}=await cd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`Date range: ${o} to ${u}.`)}return n.join(" ")}async function Ep(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:s}=await cd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${u}`)}return n.join(`
`)}async function Tp(t=10){const e=await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(ud).join(`

---

`)}async function Ap(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),s=(await Qe.items.where("sourceType").equals("gmail").toArray()).map(o=>{var d,g,_,h,x;let u=0;return(d=o.subject)!=null&&d.toLowerCase().includes(n)&&(u+=3),(g=o.from)!=null&&g.toLowerCase().includes(n)&&(u+=2),(_=o.to)!=null&&_.toLowerCase().includes(n)&&(u+=2),(h=o.snippet)!=null&&h.toLowerCase().includes(n)&&(u+=1),(x=o.body)!=null&&x.toLowerCase().includes(n)&&(u+=1),{item:o,score:u}}).filter(({score:o})=>o>0).sort((o,u)=>u.score-o.score).slice(0,e);return s.length===0?`No results found for "${t}".`:s.map(({item:o})=>ud(o)).join(`

---

`)}async function Ic(){const t=await Qe.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=ld(t);return{groups:e,order:n,total:t.length}}async function Ip({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),u=await Qe.items.where("sourceType").equals("gmail").filter(d=>{var g,_,h,x;return((g=d.subject)==null?void 0:g.toLowerCase().includes(o))||((_=d.from)==null?void 0:_.toLowerCase().includes(o))||((h=d.to)==null?void 0:h.toLowerCase().includes(o))||((x=d.snippet)==null?void 0:x.toLowerCase().includes(o))}).toArray();return u.sort((d,g)=>(g.date||0)-(d.date||0)),{items:u.slice(n,n+e),total:u.length}}const a=await Qe.items.where("sourceType").equals("gmail").count();return{items:await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function cd(){const t=await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).first(),e=await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).last();return{oldest:t,newest:e}}function ud(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=hp(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function Cp(){const t=await Sp();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function Pp(t){const e=[],n=await Ep();if(e.push(n),t){const a=await Ap(t,5);e.push("","## Relevant Emails",a)}else{const a=await Tp(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const Hr={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},wl="INFO",dd="me-ai-events",vd="me-ai-event-groups";async function ss(){const{getSetting:t}=await Hn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Yr);return{getSetting:e}},void 0,import.meta.url);return await t(dd)||{}}async function qi(t){const{setSetting:e}=await Hn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Yr);return{setSetting:n}},void 0,import.meta.url);await e(dd,t)}async function Bi(){const{getSetting:t}=await Hn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Yr);return{getSetting:e}},void 0,import.meta.url);return await t(vd)||{}}async function fd(t){const{setSetting:e}=await Hn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Yr);return{setSetting:n}},void 0,import.meta.url);await e(vd,t)}async function Op(){try{const{db:t}=await Hn(async()=>{const{db:a}=await Promise.resolve().then(()=>tp);return{db:a}},void 0,import.meta.url),e=await t.emailClassifications.toArray();return[...new Set(e.map(a=>a.action).filter(Boolean))].sort()}catch{return[]}}async function Rp(){const t=await ss(),e=await Op();return[...new Set([...Object.keys(t),...e])].sort()}async function Ei(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"";return(await Bi())[e]||wl}async function Mp(t,e){const n=t.toUpperCase();if(!Hr[e])throw new Error(`Unknown group: ${e}`);const a=await Bi();a[n]=e,await fd(a)}async function jp(){return Bi()}async function pd(t){const e=await Ei(t),n=Hr[e]||Hr[wl];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function Rr(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"";return(await ss())[e]||[]}const So=Rr;async function Dp(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await ss();e in n||(n[e]=[],await qi(n))}async function Lp(t,e,n){const a=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!a)return;const s=await ss(),o=await Bi();if(!(a in o)){const u=Hr[e]?e:wl;o[a]=u,await fd(o)}if(!(a in s)){const{pluginRegistry:u}=await Hn(async()=>{const{pluginRegistry:h}=await Promise.resolve().then(()=>Jp);return{pluginRegistry:h}},void 0,import.meta.url),d=u.getAvailableActions("gmail"),g=Object.fromEntries(d.map(h=>[h.actionId,h])),_=(n||[]).filter(h=>g[h]).map(h=>({id:h,pluginId:"gmail",commandId:h,name:g[h].name,description:g[h].description}));s[a]=_,await qi(s)}}async function Np(t){const e=t.toUpperCase(),n=await ss();delete n[e],await qi(n)}async function Fi(t,e){const n=t.toUpperCase(),a=await ss();a[n]=e,await qi(a)}const qp=Fi;async function Bp(t,e){const n=await Rr(t);await Fi(t,[...n,e])}const Cc=Bp;async function Fp(t,e){const n=await Rr(t);await Fi(t,n.filter(a=>a.id!==e))}const zp=Fp;async function Up(t,e,n){const a=await Rr(t);await Fi(t,a.map(s=>s.id===e?{...s,...n}:s))}const Kp=Up;async function Gp(t,e){var s;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((s=e.body)==null?void 0:s.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=await Rr(t.action);return{event:n,commands:a}}async function Hp(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:a,commands:s}=await Gp(n.classification,n.email);return{event:a,commands:s}})),content:""}}async function Wp(t){const e=await Promise.all(t.order.map(async a=>{const s=t.groups[a]||[],o=await Rr(a),u=await Ei(a),d=s.map(g=>({emailId:g.emailId,subject:g.subject||"(no subject)",from:g.from||"",date:g.date,summary:g.summary||"",reason:g.reason||"",tags:g.tags||[],status:g.status||"pending"}));return{eventType:a,group:u,emails:d,commands:o}})),n=e.reduce((a,s)=>a+s.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class Vp{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var s,o,u;const a=this.handlers.get(e);if(!a)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(s=n.onProgress)==null||s.call(n,{phase:"executing",actionId:e,actionName:a.name});const d=await a.execute(n);return(o=n.onProgress)==null||o.call(n,{phase:"completed",actionId:e,actionName:a.name,result:d}),d}catch(d){const g={success:!1,error:d,message:d.message||"Unknown error"};return(u=n.onProgress)==null||u.call(n,{phase:"failed",actionId:e,actionName:a.name,error:d.message}),g}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const Yp="https://gmail.googleapis.com/gmail/v1/users/me",Dr={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Bn(t,e,n,a=null){var u;const s={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};a&&(s.body=JSON.stringify(a));const o=await fetch(`${Yp}${n}`,s);if(!o.ok){const g=((u=(await o.json().catch(()=>({}))).error)==null?void 0:u.message)||`Gmail API error: ${o.status}`;throw new Error(g)}return o.status===204?{success:!0}:o.json()}class Qp extends Vp{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}extractMessageId(e){const n=e.event.data.emailId||e.event.data.id;return n?n.startsWith("gmail:")?n.substring(6):n:null}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Dr.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Dr.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Dr.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Dr.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Dr.SPAM],removeLabelIds:[Dr.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Dr.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=this.extractMessageId(e),a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[a]}),{success:!0,message:`Applied label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=this.extractMessageId(e),a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[a]}),{success:!0,message:`Removed label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Dr.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Bn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Dr.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,a=[],s=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Bn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:a,removeLabelIds:s}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Bn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const Xp=new Qp;let Zp=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(Xp)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const a=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,s=a.pluginId||this.resolvePluginId(n.event.source),o=a.commandId||a.id,u=this.getPlugin(s);return u?u.canExecute(o)?u.execute(o,n):{success:!1,message:`Command "${o}" not found in plugin "${u.serviceName}". Available: ${u.getHandlers().map(d=>d.actionId).join(", ")}`,error:new Error(`Command not supported: ${o}`)}:{success:!1,message:`Plugin "${s}" not found. Is it registered?`,error:new Error(`Plugin not found: ${s}`)}}async executePipeline(e,n){var g,_;const a=[];let s=!0;for(const h of e){(g=n.onProgress)==null||g.call(n,{phase:"action_start",actionId:h.id,actionName:h.name,pluginId:h.pluginId,commandId:h.commandId});const x=await this.executeAction(h,n);a.push({actionId:h.id,actionName:h.name,pluginId:h.pluginId,commandId:h.commandId,...x}),x.success||(s=!1),(_=n.onProgress)==null||_.call(n,{phase:"action_complete",actionId:h.id,actionName:h.name,result:x})}const u=a.filter(h=>!h.success).map(h=>{var x;return`${h.pluginId}Â·${h.commandId}: ${h.message||((x=h.error)==null?void 0:x.message)||"Unknown error"}`}).join("; "),d=a.filter(h=>h.success).map(h=>`${h.pluginId}Â·${h.commandId}`).join(", ");return{success:s,results:a,message:s?`Successfully executed: ${d}`:`Pipeline failed: ${u}`}}async executePipelineBatch(e,n,a){var d,g;const s=[];for(let _=0;_<n.length;_++){const h=n[_];(d=a.onProgress)==null||d.call(a,{phase:"batch_event_start",eventIndex:_,totalEvents:n.length,event:h});const x={...a,event:h},b=await this.executePipeline(e,x);s.push({event:h,...b}),(g=a.onProgress)==null||g.call(a,{phase:"batch_event_complete",eventIndex:_,totalEvents:n.length,event:h,result:b})}const o=s.filter(_=>_.success).length,u=s.filter(_=>!_.success).length;return{success:u===0,results:s,total:n.length,successful:o,failed:u,message:`Processed ${n.length} event(s): ${o} successful, ${u} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),a=this.getPlugin(n);return a?a.getHandlers():[]}getRequiredScopes(e,n){const a=this.resolvePluginId(n),s=this.getPlugin(a);return s?s.getRequiredScopes(e):[]}};const is=new Zp,Jp=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:is},Symbol.toStringTag,{value:"Module"})),$p=20,eh={maxTokens:512};function hd(t){const e=[],n=[];for(const o of t)if(o.actions.length){e.push(`${o.pluginName} plugin:`);for(const u of o.actions)e.push(`  ${u.actionId.padEnd(22)} â ${u.name}: ${u.description}`),n.push(u.actionId)}const a=e.length?e.join(`
`):"  (no actions available)",s=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${a}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${s})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function md(){return is.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const gd=hd(md());async function _d(t,{count:e=$p,force:n=!1,onProgress:a=()=>{},signal:s}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,u=0;if(n)o=await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).reverse().limit(e).toArray();else{const q=new Set(await Qe.emailClassifications.toCollection().primaryKeys());u=0,o=[],await Qe.items.where("[sourceType+date]").between(["gmail",In.minKey],["gmail",In.maxKey]).reverse().until(()=>o.length>=e).each(P=>{q.has(P.id)?u++:o.push(P)})}if(o.length===0){const q=n?"No emails to scan.":`All emails already classified (${u} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:q,classified:0}),{scanned:0,classified:0,skipped:u,errors:0}}const d=Date.now(),g=performance.now();let _=0,h=0,x=0,b=0;const w=[],I=md(),D=hd(I),O=new Set(I.flatMap(q=>q.actions.map(P=>P.actionId))),ie=t.modelId,de=gl(ie)||_l(ie);if(!de)throw new Error(`Unknown model: ${ie}`);if(!de.recommendedForEmailProcessing&&o.length>0){const{MODELS:q}=await Hn(async()=>{const{MODELS:xe}=await Promise.resolve().then(()=>rp);return{MODELS:xe}},void 0,import.meta.url),{OLLAMA_MODELS:P}=await Hn(async()=>{const{OLLAMA_MODELS:xe}=await Promise.resolve().then(()=>ap);return{OLLAMA_MODELS:xe}},void 0,import.meta.url),le=[...q.filter(xe=>xe.recommendedForEmailProcessing).map(xe=>xe.name),...P.filter(xe=>xe.recommendedForEmailProcessing).map(xe=>xe.displayName)],ke=de.displayName||de.name;console.warn(`â ï¸ Current model (${ke}) is not optimized for email processing. For best results with long emails, use: ${le.join(", ")}. Some emails may fail due to memory limits.`)}for(let q=0;q<o.length&&!(s!=null&&s.aborted);q++){const P=o[q],le=wd(P),ke=[{role:"system",content:D},{role:"user",content:le}];a({phase:"scanning",current:q+1,total:o.length,classified:_,errors:h,results:w,email:{subject:P.subject,from:P.from,date:P.date},prompt:{system:gd,user:le},systemPromptLength:D.length,live:null,lastResult:null,totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}});const xe=performance.now();try{const{text:we,tps:J,numTokens:ge,inputTokens:Te}=await t.generateFull(ke,{maxTokens:512,enableThinking:!1,temperature:0},me=>{a({phase:"generating",current:q+1,total:o.length,classified:_,errors:h,results:w,email:{subject:P.subject,from:P.from,date:P.date},live:{tps:me.tps,numTokens:me.numTokens},streamingText:me.text||"",totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}})});x+=ge,b+=Te;const ae=nh(we,O),X=performance.now()-xe;if(ae){await Qe.emailClassifications.put({emailId:P.id,action:ae.action,group:ae.group,reason:ae.reason,summary:ae.summary,tags:ae.tags,subject:P.subject||"(no subject)",from:P.from||"",date:P.date,scannedAt:d,status:"pending"}),await Lp(ae.action,ae.group,ae.suggestedActions),_++;const me={success:!0,email:{subject:P.subject,from:P.from,date:P.date},classification:ae,rawResponse:we,stats:{tps:J,numTokens:ge,inputTokens:Te,elapsed:X},promptSize:le.length};w.push(me),a({phase:"classified",current:q+1,total:o.length,classified:_,errors:h,results:w,email:{subject:P.subject,from:P.from,date:P.date},result:ae,rawResponse:we,emailStats:{tps:J,numTokens:ge,inputTokens:Te,elapsed:X},totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}})}}catch(we){console.error(`Triage email ${q+1} failed:`,we),h++;const J=we.message||String(we),ge=J.length>200?J.slice(0,200)+"...":J;w.push({success:!1,email:{subject:P.subject,from:P.from,date:P.date},error:ge,promptSize:le.length})}}const he=performance.now()-g,V=w.length>0?Math.round(w.reduce((q,P)=>q+P.promptSize,0)/w.length):0,U=w.filter(q=>{var P;return q.success&&((P=q.stats)==null?void 0:P.tps)}).length>0?Math.round(w.filter(q=>q.success).reduce((q,P)=>{var le;return q+(((le=P.stats)==null?void 0:le.tps)||0)},0)/w.filter(q=>{var P;return q.success&&((P=q.stats)==null?void 0:P.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:_,errors:h,results:w,summary:{avgPromptSize:V,avgTps:U,systemPromptSize:D.length,processed:o.length,skipped:u,modelName:de.displayName||de.name,modelContextWindow:de.contextWindow,modelMaxEmailTokens:de.maxEmailTokens},totals:{outputTokens:x,inputTokens:b,elapsed:he}}),{scanned:o.length,classified:_,skipped:u,errors:h}}async function yd(){const t=await Qe.emailClassifications.toArray();return ld(t)}async function th(){const t=await Qe.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function Ti(t,e){await Qe.emailClassifications.update(t,{status:e})}async function Pc(){await Qe.emailClassifications.clear()}async function kl(t){await Qe.emailClassifications.where("action").equals(t).delete()}async function bd(t){await Qe.emailClassifications.delete(t)}async function Ho(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function wd(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function nh(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const a=n.indexOf("{"),s=n.lastIndexOf("}");if(a===-1||s===-1||s<=a)return console.warn("Triage: no JSON object found in response"),null;const o=n.indexOf("[");if(o!==-1&&o<a)return console.warn("Triage: expected JSON object, got array"),null;const u=n.slice(a,s+1);try{const d=JSON.parse(u);if(!d||typeof d!="object"||Array.isArray(d))return null;const g=rh(d.action);if(!g)return console.warn("Triage: missing or invalid action field"),null;const h=["NOISE","INFO","CRITICAL"].includes(d.group)?d.group:"INFO";let x=[];Array.isArray(d.suggestedActions)&&(x=d.suggestedActions.filter(w=>typeof w!="string"||!w.trim()?!1:e?e.has(w.trim()):!0).map(w=>w.trim()).slice(0,5)),x.length===0&&Array.isArray(d.suggestedActions)&&d.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",d.suggestedActions);let b=[];return Array.isArray(d.tags)&&(b=d.tags.filter(w=>typeof w=="string"&&w.trim()).map(w=>w.trim().toLowerCase()).slice(0,10)),{action:g,group:h,suggestedActions:x,reason:String(d.reason||"").slice(0,300),summary:String(d.summary||"").slice(0,500),tags:b}}catch(d){return console.warn("Triage: failed to parse JSON response:",d.message),null}}function rh(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Wo(t){return`hsl(${Li(t)}, 55%, 55%)`}function ah(t){return`hsl(${Li(t)}, 40%, 35%)`}var sh=T('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),ih=T('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function oh(t,e){Nt(e,!0);let n=De(e,"backend",15,"webgpu"),a=De(e,"isWebGPUAvailable",3,!0);var s=ih(),o=m(f(s),2),u=f(o);let d;u.__click=()=>n("webgpu");var g=m(u,2);let _;g.__click=()=>n("ollama");var h=m(o,2);{var x=b=>{var w=sh();S(b,w)};Z(h,b=>{!a()&&n()==="webgpu"&&b(x)})}Q(()=>{d=Bt(u,1,"backend-btn svelte-1n2kfl0",null,d,{active:n()==="webgpu"}),u.disabled=!a(),_=Bt(g,1,"backend-btn svelte-1n2kfl0",null,_,{active:n()==="ollama"})}),S(t,s),qt()}en(["click"]);const lh=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Oc(...t){lh&&console.log("[debug]",...t)}function $n(t){return Oc(`[MOUNT] ${t}`),()=>Oc(`[DESTROY] ${t}`)}var ch=T("<option> </option>"),uh=T('<p class="model-description svelte-1p89qnn"> </p>'),dh=T('<span class="current-badge svelte-1p89qnn">Current</span>'),vh=T('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),fh=T('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),ph=T('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),hh=T('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),mh=T('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),gh=T('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),_h=T('<p class="error svelte-1p89qnn"> </p>'),yh=T('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function bh(t,e){Nt(e,!0);let n=De(e,"selectedModel",15),a=De(e,"gpuInfo",3,null),s=De(e,"error",3,null);En(()=>$n("ModelSelector"));var o=yh(),u=f(o),d=m(f(u),2),g=m(f(d),2);bt(g,21,()=>Cr,Lt,(V,U)=>{var q=ch(),P=f(q),le={};Q(()=>{C(P,`${l(U).name??""} â ${l(U).size??""}`),le!==(le=l(U).id)&&(q.value=(q.__value=l(U).id)??"")}),S(V,q)});var _=m(g,2);{var h=V=>{const U=st(()=>Cr.find(ke=>ke.id===n()));var q=Rn(),P=$e(q);{var le=ke=>{var xe=uh(),we=f(xe);Q(()=>C(we,l(U).description)),S(ke,xe)};Z(P,ke=>{l(U)&&ke(le)})}S(V,q)};Z(_,V=>{n()&&V(h)})}var x=m(d,2),b=m(f(x),2),w=f(b),I=m(f(w));bt(I,21,()=>Cr,Lt,(V,U)=>{var q=hh();let P;var le=f(q),ke=f(le),xe=m(ke);{var we=oe=>{var R=dh();S(oe,R)};Z(xe,oe=>{l(U).id===n()&&oe(we)})}var J=m(le),ge=f(J),Te=f(ge),ae=m(J),X=f(ae),me=m(ae),M=f(me);{var ee=oe=>{var R=vh();S(oe,R)},fe=oe=>{var R=fh();S(oe,R)},pe=oe=>{var R=ph();S(oe,R)};Z(M,oe=>{l(U).recommendedForEmailProcessing?oe(ee):l(U).maxEmailTokens>=6e3?oe(fe,1):oe(pe,!1)})}Q((oe,R)=>{P=Bt(q,1,"svelte-1p89qnn",null,P,{selected:l(U).id===n()}),C(ke,`${l(U).name??""} `),C(Te,`${oe??""}k`),C(X,`~${R??""}k`)},[()=>(l(U).contextWindow/1024).toFixed(0),()=>(l(U).maxEmailTokens/1e3).toFixed(0)]),S(V,q)});var D=m(x,2);{var O=V=>{var U=gh(),q=m(f(U),2),P=f(q),le=m(f(P)),ke=f(le),xe=m(P,2),we=m(f(xe)),J=f(we),ge=m(xe,2);{var Te=ae=>{var X=mh(),me=m(f(X)),M=f(me);Q(ee=>C(M,ee),[()=>Go(a().limits.maxBufferSize)]),S(ae,X)};Z(ge,ae=>{var X;(X=a().limits)!=null&&X.maxBufferSize&&ae(Te)})}Q(()=>{C(ke,a().vendor),C(J,a().architecture)}),S(V,U)};Z(D,V=>{a()&&V(O)})}var ie=m(D,2);{var de=V=>{var U=_h(),q=f(U);Q(()=>C(q,s())),S(V,U)};Z(ie,V=>{s()&&V(de)})}var he=m(ie,2);he.__click=function(...V){var U;(U=e.onload)==null||U.apply(this,V)},Q(()=>he.disabled=s()),Hs(g,n),S(t,o),qt()}en(["click"]);var wh=T('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),kh=T('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),xh=T('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),Sh=T("<div><!></div>"),Eh=T("<option> <!></option>"),Th=T("<option> <!></option>"),Ah=T('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Ih=T('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Ch=T('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Ph=T('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Oh=T('<span class="current-badge svelte-1bvvk8o">Current</span>'),Rh=T('<span class="installed-badge svelte-1bvvk8o">â</span>'),Mh=T('<span class="rec-badge svelte-1bvvk8o">â</span>'),jh=T('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),Dh=T('<p class="error svelte-1bvvk8o"> </p>'),Lh=T('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function Nh(t,e){Nt(e,!0);let n=De(e,"selectedModel",15),a=De(e,"error",15);const s=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let o=Pe(Yt(Ws())),u=Pe(!1),d=Pe(null),g=Pe(Yt([])),_=Pe(!1);Oa(()=>{lp().then(Y=>{A(o,Y,!0),h()})});async function h(){A(u,!0),A(d,null);const Y=await Ko(l(o));A(d,Y,!0),A(u,!1),Y.connected&&x()}async function x(){A(_,!0);try{const Y=await up(l(o));A(g,Y.map(re=>re.name),!0)}catch(Y){console.error("Failed to load Ollama models:",Y),A(g,[],!0)}A(_,!1)}function b(){cp(l(o)),h()}function w(){if(!n()){a("Please select a model");return}e.onload()}function I(Y){return l(g).length?l(g).includes(Y):!1}const D=$u();var O=Lh(),ie=f(O),de=f(ie),he=m(f(de)),V=f(he),U=m(de,2),q=f(U);q.__change=b;var P=m(q,2);P.__click=h;var le=f(P),ke=m(U,2);{var xe=Y=>{var re=Sh();let G;var ve=f(re);{var ye=K=>{var Se=wh(),ce=m($e(Se),2),Oe=f(ce);Q(()=>C(Oe,`Connected â¢ v${l(d).version??""}`)),S(K,Se)},ne=K=>{var Se=xh(),ce=m($e(Se),2),Oe=f(ce),qe=f(Oe),Ke=m(Oe,2);{var ut=wt=>{var Ze=kh(),Be=m(f(Ze),2),Fe=f(Be),He=m(f(Fe));He.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var it=m(Fe,2),lt=m(f(it));lt.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,S(wt,Ze)};Z(Ke,wt=>{l(d).corsError&&wt(ut)})}Q(()=>C(qe,`Disconnected: ${l(d).error??""}`)),S(K,Se)};Z(ve,K=>{l(d).connected?K(ye):K(ne,!1)})}Q(()=>G=Bt(re,1,"connection-status svelte-1bvvk8o",null,G,{connected:l(d).connected})),S(Y,re)};Z(ke,Y=>{l(d)&&Y(xe)})}var we=m(ie,2),J=m(f(we),2),ge=f(J);bt(ge,21,()=>D,Lt,(Y,re)=>{var G=Eh(),ve=f(G),ye=m(ve);{var ne=ce=>{var Oe=fn("â");S(ce,Oe)},K=st(()=>I(l(re).name));Z(ye,ce=>{l(K)&&ce(ne)})}var Se={};Q(ce=>{C(ve,`${l(re).displayName??""} (${l(re).params??""}) - ${ce??""}k context `),Se!==(Se=l(re).name)&&(G.value=(G.__value=l(re).name)??"")},[()=>(l(re).contextWindow/1024).toFixed(0)]),S(Y,G)});var Te=m(ge);bt(Te,21,()=>Pr.filter(Y=>!Y.recommended),Lt,(Y,re)=>{var G=Th(),ve=f(G),ye=m(ve);{var ne=ce=>{var Oe=fn("â");S(ce,Oe)},K=st(()=>I(l(re).name));Z(ye,ce=>{l(K)&&ce(ne)})}var Se={};Q(ce=>{C(ve,`${l(re).displayName??""} (${l(re).params??""}) - ${ce??""}k context `),Se!==(Se=l(re).name)&&(G.value=(G.__value=l(re).name)??"")},[()=>(l(re).contextWindow/1024).toFixed(0)]),S(Y,G)});var ae=m(J,2);{var X=Y=>{const re=st(()=>Pr.find(ne=>ne.name===n()));var G=Rn(),ve=$e(G);{var ye=ne=>{var K=Ph(),Se=f(K),ce=f(Se),Oe=m(Se,2),qe=f(Oe),Ke=f(qe),ut=m(qe,4),wt=f(ut),Ze=m(ut,2);{var Be=et=>{var ct=Ah(),Ve=m($e(ct),2),ze=f(Ve);Q(mt=>C(ze,mt),[()=>l(re).tags.join(", ")]),S(et,ct)};Z(Ze,et=>{var ct;(ct=l(re).tags)!=null&&ct.length&&et(Be)})}var Fe=m(Oe,2);{var He=et=>{var ct=Ih(),Ve=m(f(ct),2),ze=f(Ve);Q(()=>C(ze,`ollama pull ${n()??""}`)),S(et,ct)},it=st(()=>!I(n())),lt=et=>{var ct=Ch();S(et,ct)};Z(Fe,et=>{l(it)?et(He):et(lt,!1)})}Q(et=>{C(ce,l(re).description),C(Ke,`${et??""}k context`),C(wt,`${l(re).params??""} params`)},[()=>(l(re).contextWindow/1024).toFixed(0)]),S(ne,K)};Z(ve,ne=>{l(re)&&ne(ye)})}S(Y,G)};Z(ae,Y=>{n()&&Y(X)})}var me=m(we,2),M=m(f(me),2),ee=f(M),fe=m(f(ee));bt(fe,21,()=>Pr,Lt,(Y,re)=>{var G=jh();let ve;var ye=f(G),ne=f(ye),K=m(ne);{var Se=et=>{var ct=Oh();S(et,ct)};Z(K,et=>{l(re).name===n()&&et(Se)})}var ce=m(K,2);{var Oe=et=>{var ct=Rh();S(et,ct)},qe=st(()=>I(l(re).name));Z(ce,et=>{l(qe)&&et(Oe)})}var Ke=m(ye),ut=f(Ke),wt=f(ut),Ze=m(Ke),Be=f(Ze),Fe=m(Ze),He=f(Fe);{var it=et=>{var ct=Mh();S(et,ct)};Z(He,et=>{l(re).recommended&&et(it)})}var lt=m(He);Q((et,ct,Ve)=>{ve=Bt(G,1,"svelte-1bvvk8o",null,ve,et),C(ne,`${l(re).displayName??""} `),C(wt,`${ct??""}k`),C(Be,l(re).params),C(lt,` ${Ve??""}`)},[()=>({selected:l(re).name===n(),installed:I(l(re).name)}),()=>(l(re).contextWindow/1024).toFixed(0),()=>l(re).tags.slice(0,2).join(", ")]),S(Y,G)});var pe=m(me,2);{var oe=Y=>{var re=Dh(),G=f(re);Q(()=>C(G,a())),S(Y,re)};Z(pe,Y=>{a()&&Y(oe)})}var R=m(pe,2);R.__click=w,Q(()=>{var Y;C(V,s?"ð¥ local":"âï¸ remote"),sr(q,"placeholder",s?"http://localhost:11434":"https://me-ai.metaelon.space"),P.disabled=l(u),C(le,l(u)?"Testing...":"Test"),R.disabled=!((Y=l(d))!=null&&Y.connected)||a()}),Ur(q,()=>l(o),Y=>A(o,Y)),Hs(J,n),S(t,O),qt()}en(["change","click"]);var qh=T('<span class="progress-percent svelte-r5fnze"> </span>'),Bh=T('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),Fh=T('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),zh=T('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),Uh=T('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),Kh=T('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),Gh=T('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function Hh(t,e){Nt(e,!0);let n=De(e,"message",3,""),a=De(e,"items",19,()=>[]);En(()=>$n("LoadingProgress"));var s=Gh(),o=f(s),u=f(o),d=m(o,2);bt(d,17,a,Lt,(g,_)=>{const h=st(()=>l(_).total?pp(l(_).loaded||0,l(_).total):null);var x=Kh(),b=f(x),w=f(b),I=f(w),D=m(w,2);{var O=V=>{var U=qh(),q=f(U);Q(P=>C(q,`${P??""}%`),[()=>l(h).toFixed(1)]),S(V,U)};Z(D,V=>{l(h)!==null&&V(O)})}var ie=m(b,2);{var de=V=>{var U=Bh(),q=$e(U),P=f(q),le=m(q,2),ke=f(le),xe=f(ke),we=m(ke,4),J=f(we),ge=m(we,2),Te=f(ge);Q((ae,X,me,M,ee)=>{vn(P,`width: ${ae??""}%`),C(xe,X),C(J,me),C(Te,`(${M??""} / ${ee??""} B)`)},[()=>Math.max(l(_).progress??0,.5).toFixed(1),()=>xo(l(_).loaded||0),()=>xo(l(_).total),()=>(l(_).loaded||0).toLocaleString(),()=>l(_).total.toLocaleString()]),S(V,U)},he=V=>{var U=Uh(),q=m($e(U),2),P=f(q);{var le=xe=>{var we=Fh(),J=$e(we),ge=f(J),Te=m(J,2),ae=f(Te);Q((X,me)=>{C(ge,X),C(ae,`(${me??""} B)`)},[()=>xo(l(_).loaded),()=>l(_).loaded.toLocaleString()]),S(xe,we)},ke=xe=>{var we=zh();S(xe,we)};Z(P,xe=>{l(_).loaded?xe(le):xe(ke,!1)})}S(V,U)};Z(ie,V=>{l(_).total?V(de):V(he,!1)})}Q(()=>{sr(w,"title",l(_).file),C(I,l(_).file)}),S(g,x)}),Q(()=>C(u,n())),S(t,s),qt()}var Wh=T('<span class="thinking-tokens svelte-11gjw00"> </span>'),Vh=T('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Yh=T('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Qh=T('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Xh=T('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),Zh=T('<span class="cursor svelte-11gjw00">|</span>'),Jh=T(" <!>",1),$h=T('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),em=T('<div class="content svelte-11gjw00"> </div>'),tm=T('<div><div class="role svelte-11gjw00"> </div> <!></div>');function nm(t,e){Nt(e,!0);let n=De(e,"isLast",3,!1),a=De(e,"isRunning",3,!1),s=De(e,"generationPhase",3,null),o=De(e,"numTokens",3,null);En(()=>$n(`MessageBubble[${e.msg.role}]`));var u=tm(),d=f(u),g=f(d),_=m(d,2);{var h=b=>{var w=$h(),I=$e(w);{var D=P=>{var le=Vh(),ke=m(f(le),4);{var xe=we=>{var J=Wh(),ge=f(J);Q(()=>C(ge,`${o()??""} tokens`)),S(we,J)};Z(ke,we=>{o()&&we(xe)})}S(P,le)},O=P=>{var le=Yh();S(P,le)};Z(I,P=>{a()&&n()&&s()==="thinking"?P(D):a()&&n()&&s()==="preparing"&&P(O,1)})}var ie=m(I,2);{var de=P=>{var le=Qh(),ke=f(le),xe=m(f(ke),2),we=f(xe),J=m(ke,2),ge=f(J);Q(Te=>{C(we,`${Te??""} words`),C(ge,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),S(P,le)};Z(ie,P=>{e.msg.thinking&&P(de)})}var he=m(ie,2),V=f(he);{var U=P=>{var le=Xh();S(P,le)},q=P=>{var le=Jh(),ke=$e(le,!0),xe=m(ke);{var we=J=>{var ge=Zh();S(J,ge)};Z(xe,J=>{a()&&n()&&J(we)})}Q(()=>C(ke,e.msg.content)),S(P,le)};Z(V,P=>{a()&&n()&&!e.msg.content&&s()!=="thinking"?P(U):P(q,!1)})}S(b,w)},x=b=>{var w=em(),I=f(w);Q(()=>C(I,e.msg.content)),S(b,w)};Z(_,b=>{e.msg.role==="assistant"?b(h):b(x,!1)})}Q(()=>{Bt(u,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),C(g,e.msg.role==="user"?"You":"AI")}),S(t,u),qt()}var rm=T('<span class="cmd-icon svelte-1m7x4wq"> </span>'),am=T('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),sm=T('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Rc(t,e){Nt(e,!0);var n=sm(),a=$e(n);a.__click=()=>{var w;return(w=e.onexecute)==null?void 0:w.call(e,e.command.id)};var s=f(a);{var o=w=>{var I=rm(),D=f(I);Q(()=>C(D,e.command.icon)),S(w,I)};Z(s,w=>{e.command.icon&&w(o)})}var u=m(s,2),d=f(u),g=f(d),_=m(d,2),h=f(_),x=m(a,2);{var b=w=>{var I=am(),D=f(I),O=f(D);Q(()=>C(O,e.command.body)),S(w,I)};Z(x,w=>{e.command.body&&w(b)})}Q(()=>{C(g,e.command.name),C(h,e.command.description)}),S(t,n),qt()}en(["click"]);const Mc="https://accounts.google.com/gsi/client",im="https://www.googleapis.com/auth/gmail.modify",xl="me-ai:oauth-token",Sl=300*1e3;let Ls=null,Os=null,oa=0;async function kd(t,e){oa=Date.now()+e*1e3;const{setSetting:n}=await Hn(async()=>{const{setSetting:a}=await Promise.resolve().then(()=>Yr);return{setSetting:a}},void 0,import.meta.url);await n(xl,{access_token:t,expires_at:oa})}async function Vo(){oa=0;const{removeSetting:t}=await Hn(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>Yr);return{removeSetting:e}},void 0,import.meta.url);await t(xl)}async function zi(){try{const{getSetting:t}=await Hn(async()=>{const{getSetting:s}=await Promise.resolve().then(()=>Yr);return{getSetting:s}},void 0,import.meta.url),e=await t(xl);if(!e)return null;const{access_token:n,expires_at:a}=e;return!n||Date.now()>a-Sl?(await Vo(),null):(oa=a,{access_token:n})}catch{return await Vo(),null}}function om(){return oa>0&&Date.now()<oa-Sl}function lm(){return oa<=0?0:Math.max(0,oa-Sl-Date.now())}function jc(){return new Promise((t,e)=>{if(!Ls){e(new Error("Google Auth not initialized."));return}Os=async n=>{n.error?e(new Error(n.error_description||n.error)):(await kd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ls.requestAccessToken({prompt:""})})}function cm(){return new Promise((t,e)=>{var s,o;if((o=(s=window.google)==null?void 0:s.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${Mc}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=Mc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function Dc(t){await cm(),Ls=google.accounts.oauth2.initTokenClient({client_id:t,scope:im,callback:e=>{Os&&(Os(e),Os=null)}})}function um(){return new Promise((t,e)=>{if(!Ls){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Os=async n=>{n.error?e(new Error(n.error_description||n.error)):(await kd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ls.requestAccessToken()})}async function dm(t){return await Vo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function xd(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const a=await pd(t.type);if(e==null||e({phase:"policy_check",group:a.group,policy:a}),a.requiresApproval&&!n){const _=await Rr(t.type);return{success:!1,requiresApproval:!0,group:a.group,actions:_,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await zi();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const o=s.access_token,u=await Rr(t.type);if(!u||u.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:u,actionCount:u.length});const d={accessToken:o,event:t,onProgress:e},g=await is.executePipeline(u,d);return e==null||e({phase:"done",result:g}),g}catch(a){return e==null||e({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error"}}}async function Sd(t,e,n,a=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const s=await pd(t);if(s.requiresApproval&&!a){const x=await Rr(t);return{success:!1,requiresApproval:!0,group:s.group,actions:x,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const o=await zi();if(!(o!=null&&o.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const u=o.access_token,d=await Rr(t);if(!d||d.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:d,actionCount:d.length});const g=e.map(x=>({type:t,source:"gmail",data:x})),_={accessToken:u,onProgress:n},h=await is.executePipelineBatch(d,g,_);return n==null||n({phase:"done",result:h}),h}catch(s){return n==null||n({phase:"error",error:s.message}),{success:!1,error:s,message:s.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function Ed(t){return is.getAvailableActions(t)}async function Yo(){const t=await zi();return!!(t!=null&&t.access_token)}const vm=Object.freeze(Object.defineProperty({__proto__:null,EVENT_GROUPS:Hr,executePipeline:xd,executePipelineBatch:Sd,getAvailableActions:Ed,isAuthenticated:Yo},Symbol.toStringTag,{value:"Module"}));var fm=T('<div class="event-subject svelte-1w66m1k"> </div>'),pm=T('<span class="sep svelte-1w66m1k">Â·</span> ',1),hm=T('<div class="event-summary svelte-1w66m1k"> </div>'),mm=T('<span class="tag svelte-1w66m1k"> </span>'),gm=T('<div class="event-tags svelte-1w66m1k"></div>'),_m=T('<div class="event-reason svelte-1w66m1k"> </div>'),ym=T('<div class="commands svelte-1w66m1k"></div>'),bm=T('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),wm=T('<span class="event-subject-inline svelte-1w66m1k"> </span>'),km=T('<span class="sep svelte-1w66m1k">Â·</span> ',1),xm=T('<div class="event-summary svelte-1w66m1k"> </div>'),Sm=T('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),Em=T('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),Tm=T('<span class="group-tier-chip svelte-1w66m1k"> </span>'),Am=T("<button><!></button>"),Im=T("<span> </span>"),Cm=T('<span class="approval-action-desc svelte-1w66m1k"> </span>'),Pm=T("<li><!> <strong> </strong> <!></li>"),Om=T('<ul class="approval-actions svelte-1w66m1k"></ul>'),Rm=T(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),Mm=T("<div> </div>"),jm=T('<span class="email-from svelte-1w66m1k"> </span>'),Dm=T('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),Lm=T('<div class="email-summary svelte-1w66m1k"> </div>'),Nm=T('<span class="tag svelte-1w66m1k"> </span>'),qm=T('<div class="email-tags svelte-1w66m1k"></div>'),Bm=T("<button><!></button>"),Fm=T('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),zm=T('<span class="step-icon svelte-1w66m1k"> </span>'),Um=T('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),Km=T('<div class="pipeline-steps svelte-1w66m1k"></div>'),Gm=T('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Actions page</div>'),Hm=T("<div> </div>"),Wm=T('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),Vm=T('<div class="group-emails svelte-1w66m1k"></div>'),Ym=T('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),Qm=T('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function Xm(t,e){Nt(e,!0);let n=Pe(Yt({})),a=Yt({}),s=Pe(Yt({}));function o(U){if(!U)return"â";const q=U.replace(/<.*>/,"").trim();return q.length>40?q.slice(0,38)+"â¦":q}function u(U){if(!U)return"";try{return new Date(U).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function d(U,q){var P;(P=e.oncommand)==null||P.call(e,{event:U,commandId:q})}async function g(U,q,P=!1){if(!await Yo()){alert("Please sign in to Gmail first (Dashboard page)");return}const le=`single_${q}`;a[le]={running:!0,progress:null,result:null};try{const ke=await xd(U,xe=>{a[le]={...a[le],progress:xe}},P);if(ke.requiresApproval){a[le]={running:!1,progress:null,result:null},l(s)[le]={event:U,emailId:q,actions:ke.actions,group:ke.group,isBatch:!1};return}a[le]={running:!1,progress:null,result:ke}}catch(ke){a[le]={running:!1,progress:null,result:{success:!1,message:ke.message}}}}async function _(U,q,P=!1){if(!await Yo()){alert("Please sign in to Gmail first (Dashboard page)");return}const le=`batch_${U}`;a[le]={running:!0,progress:null,result:null};try{const ke=await Sd(U,q,xe=>{a[le]={...a[le],progress:xe}},P);if(ke.requiresApproval){a[le]={running:!1,progress:null,result:null},l(s)[le]={eventType:U,emails:q,actions:ke.actions,group:ke.group,isBatch:!0};return}a[le]={running:!1,progress:null,result:ke}}catch(ke){a[le]={running:!1,progress:null,result:{success:!1,message:ke.message}}}}async function h(U){const q=l(s)[U];q&&(delete l(s)[U],A(s,{...l(s)},!0),q.isBatch?await _(q.eventType,q.emails,!0):await g(q.event,q.emailId,!0))}function x(U){delete l(s)[U],A(s,{...l(s)},!0)}function b(U){A(n,{...l(n),[U]:!l(n)[U]},!0)}function w(U){return U.split("_").map(q=>q.charAt(0)+q.slice(1).toLowerCase()).join(" ")}function I(U){return`hsl(${Li(U)}, 55%, 55%)`}function D(U){return a[U]}var O=Rn(),ie=$e(O);{var de=U=>{var q=bm(),P=f(q),le=f(P),ke=f(le),xe=f(ke),we=m(ke,2),J=f(we),ge=m(le,2);{var Te=ye=>{var ne=fm(),K=f(ne);Q(()=>C(K,e.msg.event.data.subject)),S(ye,ne)};Z(ge,ye=>{var ne;(ne=e.msg.event.data)!=null&&ne.subject&&ye(Te)})}var ae=m(ge,2),X=f(ae);{var me=ye=>{var ne=fn();Q(K=>C(ne,K),[()=>o(e.msg.event.data.from)]),S(ye,ne)};Z(X,ye=>{var ne;(ne=e.msg.event.data)!=null&&ne.from&&ye(me)})}var M=m(X,2);{var ee=ye=>{var ne=pm(),K=m($e(ne),1,!0);Q(Se=>C(K,Se),[()=>u(e.msg.event.data.date)]),S(ye,ne)};Z(M,ye=>{var ne;(ne=e.msg.event.data)!=null&&ne.date&&ye(ee)})}var fe=m(ae,2);{var pe=ye=>{var ne=hm(),K=f(ne);Q(()=>C(K,e.msg.event.metadata.summary)),S(ye,ne)};Z(fe,ye=>{var ne;(ne=e.msg.event.metadata)!=null&&ne.summary&&ye(pe)})}var oe=m(fe,2);{var R=ye=>{var ne=gm();bt(ne,21,()=>e.msg.event.metadata.tags,Lt,(K,Se)=>{var ce=mm(),Oe=f(ce);Q(()=>C(Oe,l(Se))),S(K,ce)}),S(ye,ne)};Z(oe,ye=>{var ne,K;(K=(ne=e.msg.event.metadata)==null?void 0:ne.tags)!=null&&K.length&&ye(R)})}var Y=m(oe,2);{var re=ye=>{var ne=_m(),K=f(ne);Q(()=>C(K,e.msg.event.metadata.reason)),S(ye,ne)};Z(Y,ye=>{var ne;(ne=e.msg.event.metadata)!=null&&ne.reason&&ye(re)})}var G=m(P,2);{var ve=ye=>{var ne=ym();bt(ne,21,()=>e.msg.commands,Lt,(K,Se)=>{Rc(K,{get command(){return l(Se)},onexecute:ce=>d(e.msg.event,ce)})}),S(ye,ne)};Z(G,ye=>{var ne;(ne=e.msg.commands)!=null&&ne.length&&ye(ve)})}Q(()=>{C(xe,e.msg.event.type),C(J,e.msg.event.source)}),S(U,q)},he=U=>{var q=Em(),P=f(q),le=f(P),ke=f(le),xe=m(P,2);bt(xe,17,()=>e.msg.items,Lt,(we,J)=>{var ge=Sm(),Te=f(ge),ae=f(Te),X=f(ae),me=f(X),M=m(X,2);{var ee=ye=>{var ne=wm(),K=f(ne);Q(()=>C(K,l(J).event.data.subject)),S(ye,ne)};Z(M,ye=>{var ne;(ne=l(J).event.data)!=null&&ne.subject&&ye(ee)})}var fe=m(ae,2),pe=f(fe);{var oe=ye=>{var ne=fn();Q(K=>C(ne,K),[()=>o(l(J).event.data.from)]),S(ye,ne)};Z(pe,ye=>{var ne;(ne=l(J).event.data)!=null&&ne.from&&ye(oe)})}var R=m(pe,2);{var Y=ye=>{var ne=km(),K=m($e(ne),1,!0);Q(Se=>C(K,Se),[()=>u(l(J).event.data.date)]),S(ye,ne)};Z(R,ye=>{var ne;(ne=l(J).event.data)!=null&&ne.date&&ye(Y)})}var re=m(fe,2);{var G=ye=>{var ne=xm(),K=f(ne);Q(()=>C(K,l(J).event.metadata.summary)),S(ye,ne)};Z(re,ye=>{var ne;(ne=l(J).event.metadata)!=null&&ne.summary&&ye(G)})}var ve=m(Te,2);bt(ve,21,()=>l(J).commands,Lt,(ye,ne)=>{Rc(ye,{get command(){return l(ne)},onexecute:K=>d(l(J).event,K)})}),Q(()=>C(me,l(J).event.type)),S(we,ge)}),Q(()=>C(ke,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),S(U,q)},V=U=>{var q=Qm(),P=f(q),le=m(f(P),2),ke=f(le),xe=m(P,2);bt(xe,17,()=>e.msg.groups,Lt,(we,J)=>{const ge=st(()=>l(n)[l(J).eventType]??!0),Te=st(()=>`batch_${l(J).eventType}`),ae=st(()=>D(l(Te))),X=st(()=>l(s)[l(Te)]),me=st(()=>l(J).group?Hr[l(J).group]:null);var M=Ym(),ee=f(M),fe=f(ee);fe.__click=()=>b(l(J).eventType);var pe=f(fe);let oe;var R=f(pe),Y=m(pe,2);{var re=Ze=>{var Be=Tm();let Fe;var He=f(Be);Q(()=>{sr(Be,"title",l(me).description),Fe=vn(Be,"",Fe,{color:l(me).color}),C(He,l(me).label)}),S(Ze,Be)};Z(Y,Ze=>{l(me)&&Ze(re)})}var G=m(Y,2),ve=f(G),ye=m(G,4);let ne;var K=m(fe,2);{var Se=Ze=>{var Be=Am();let Fe;Be.__click=Ve=>{Ve.stopPropagation(),_(l(J).eventType,l(J).emails)};var He=f(Be);{var it=Ve=>{var ze=fn("â³ Running...");S(Ve,ze)},lt=Ve=>{var ze=fn();Q(()=>C(ze,l(ae).result.success?`â Done (${l(ae).result.successful}/${l(ae).result.total})`:"â Failed")),S(Ve,ze)},et=Ve=>{var ze=fn();Q(()=>C(ze,`ð Review & Execute (${l(J).emails.length??""})`)),S(Ve,ze)},ct=Ve=>{var ze=fn();Q(()=>C(ze,`â¶ Execute All (${l(J).emails.length??""})`)),S(Ve,ze)};Z(He,Ve=>{var ze,mt,ot;(ze=l(ae))!=null&&ze.running?Ve(it):(mt=l(ae))!=null&&mt.result?Ve(lt,1):(ot=l(me))!=null&&ot.requiresApproval?Ve(et,2):Ve(ct,!1)})}Q(()=>{var Ve,ze;Fe=Bt(Be,1,"execute-all-btn svelte-1w66m1k",null,Fe,{critical:(Ve=l(me))==null?void 0:Ve.requiresApproval}),Be.disabled=(ze=l(ae))==null?void 0:ze.running}),S(Ze,Be)};Z(K,Ze=>{l(X)||Ze(Se)})}var ce=m(ee,2);{var Oe=Ze=>{var Be=Rm(),Fe=m(f(Be),2),He=m(f(Fe)),it=f(He),lt=m(Fe,2);{var et=mt=>{var ot=Om();bt(ot,21,()=>l(X).actions,Lt,(Ht,Kt)=>{var dt=Pm(),Je=f(dt);{var ft=At=>{var Ee=Im(),Qt=f(Ee);Q(()=>C(Qt,l(Kt).icon)),S(At,Ee)};Z(Je,At=>{l(Kt).icon&&At(ft)})}var at=m(Je,2),Me=f(at),Wt=m(at,2);{var zt=At=>{var Ee=Cm(),Qt=f(Ee);Q(()=>C(Qt,`â ${l(Kt).description??""}`)),S(At,Ee)};Z(Wt,At=>{l(Kt).description&&At(zt)})}Q(()=>C(Me,l(Kt).name)),S(Ht,dt)}),S(mt,ot)};Z(lt,mt=>{var ot;(ot=l(X).actions)!=null&&ot.length&&mt(et)})}var ct=m(lt,2),Ve=f(ct);Ve.__click=()=>h(l(Te));var ze=m(Ve,2);ze.__click=()=>x(l(Te)),Q(()=>C(it,`${l(J).emails.length??""} email${l(J).emails.length===1?"":"s"}`)),S(Ze,Be)};Z(ce,Ze=>{l(X)&&Ze(Oe)})}var qe=m(ce,2);{var Ke=Ze=>{var Be=Mm();let Fe;var He=f(Be);Q(()=>{Fe=Bt(Be,1,"batch-result svelte-1w66m1k",null,Fe,{success:l(ae).result.success,error:!l(ae).result.success}),C(He,l(ae).result.message)}),S(Ze,Be)};Z(qe,Ze=>{var Be;(Be=l(ae))!=null&&Be.result&&!l(X)&&Ze(Ke)})}var ut=m(qe,2);{var wt=Ze=>{var Be=Vm();bt(Be,21,()=>l(J).emails,Lt,(Fe,He)=>{const it=st(()=>`single_${l(He).emailId}`),lt=st(()=>D(l(it))),et=st(()=>l(s)[l(it)]);var ct=Wm(),Ve=f(ct),ze=f(Ve),mt=f(ze),ot=m(ze,2),Ht=f(ot);{var Kt=rt=>{var tt=jm(),Ot=f(tt);Q(Xe=>C(Ot,Xe),[()=>o(l(He).from)]),S(rt,tt)};Z(Ht,rt=>{l(He).from&&rt(Kt)})}var dt=m(Ht,2);{var Je=rt=>{var tt=Dm(),Ot=m($e(tt)),Xe=f(Ot);Q(vt=>C(Xe,vt),[()=>u(l(He).date)]),S(rt,tt)};Z(dt,rt=>{l(He).date&&rt(Je)})}var ft=m(ot,2);{var at=rt=>{var tt=Lm(),Ot=f(tt);Q(()=>C(Ot,l(He).summary)),S(rt,tt)};Z(ft,rt=>{l(He).summary&&rt(at)})}var Me=m(ft,2);{var Wt=rt=>{var tt=qm();bt(tt,21,()=>l(He).tags,Lt,(Ot,Xe)=>{var vt=Nm(),Gt=f(vt);Q(()=>C(Gt,l(Xe))),S(Ot,vt)}),S(rt,tt)};Z(Me,rt=>{var tt;(tt=l(He).tags)!=null&&tt.length&&rt(Wt)})}var zt=m(Ve,2),At=f(zt),Ee=m(f(At),2);{var Qt=rt=>{var tt=Bm();let Ot;tt.__click=()=>g({type:l(J).eventType,source:"gmail",data:l(He)},l(He).emailId);var Xe=f(tt);{var vt=Et=>{var Vt=fn("â³ Running...");S(Et,Vt)},Gt=Et=>{var Vt=fn();Q(()=>C(Vt,l(lt).result.success?"â Done":"â Failed")),S(Et,Vt)},Jt=Et=>{var Vt=fn("ð Review");S(Et,Vt)},an=Et=>{var Vt=fn("â¶ Execute");S(Et,Vt)};Z(Xe,Et=>{var Vt,sn,Rt;(Vt=l(lt))!=null&&Vt.running?Et(vt):(sn=l(lt))!=null&&sn.result?Et(Gt,1):(Rt=l(me))!=null&&Rt.requiresApproval?Et(Jt,2):Et(an,!1)})}Q(()=>{var Et,Vt;Ot=Bt(tt,1,"execute-btn svelte-1w66m1k",null,Ot,{critical:(Et=l(me))==null?void 0:Et.requiresApproval}),tt.disabled=(Vt=l(lt))==null?void 0:Vt.running}),S(rt,tt)};Z(Ee,rt=>{l(et)||rt(Qt)})}var Dn=m(At,2);{var pn=rt=>{var tt=Fm(),Ot=m(f(tt),4),Xe=f(Ot);Xe.__click=()=>h(l(it));var vt=m(Xe,2);vt.__click=()=>x(l(it)),S(rt,tt)};Z(Dn,rt=>{l(et)&&rt(pn)})}var Cn=m(Dn,2);{var hn=rt=>{var tt=Km();bt(tt,21,()=>l(J).commands,Lt,(Ot,Xe,vt)=>{var Gt=Um(),Jt=f(Gt);Jt.textContent=vt+1;var an=m(Jt,2),Et=f(an);{var Vt=br=>{var Nn=zm(),Na=f(Nn);Q(()=>C(Na,l(Xe).icon)),S(br,Nn)};Z(Et,br=>{l(Xe).icon&&br(Vt)})}var sn=m(Et,2),Rt=f(sn),on=m(sn,2),Ln=f(on);Q(()=>{C(Rt,l(Xe).name),C(Ln,l(Xe).description)}),S(Ot,Gt)}),S(rt,tt)},Pt=rt=>{var tt=Gm();S(rt,tt)};Z(Cn,rt=>{var tt;(tt=l(J).commands)!=null&&tt.length?rt(hn):rt(Pt,!1)})}var tn=m(Cn,2);{var mn=rt=>{var tt=Hm();let Ot;var Xe=f(tt);Q(()=>{Ot=Bt(tt,1,"execution-result svelte-1w66m1k",null,Ot,{success:l(lt).result.success,error:!l(lt).result.success}),C(Xe,l(lt).result.message)}),S(rt,tt)};Z(tn,rt=>{var tt;(tt=l(lt))!=null&&tt.result&&rt(mn)})}Q(()=>C(mt,l(He).subject)),S(Fe,ct)}),S(Ze,Be)};Z(ut,Ze=>{l(ge)&&Ze(wt)})}Q((Ze,Be)=>{oe=vn(pe,"",oe,Ze),C(R,Be),C(ve,l(J).emails.length),ne=Bt(ye,0,"chevron svelte-1w66m1k",null,ne,{open:l(ge)})},[()=>({background:I(l(J).eventType)}),()=>w(l(J).eventType)]),S(we,M)}),Q(()=>C(ke,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),S(U,q)};Z(ie,U=>{e.msg.type==="event"?U(de):e.msg.type==="event-batch"?U(he,1):e.msg.type==="events-grouped"&&U(V,2)})}S(t,O),qt()}en(["click"]);var Zm=T('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Jm=T('<span class="edate svelte-mt5nvh"> </span>'),$m=T('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),eg=T('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),tg=T('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),ng=T('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),rg=T('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function ag(t,e){Nt(e,!0);let n=De(e,"pendingData",3,null),a=Pe(null),s=Pe(null);function o(w){A(a,l(a)===w?null:w,!0),A(s,null)}function u(w){return w.split("_").map(I=>I.charAt(0)+I.slice(1).toLowerCase()).join(" ")}function d(w){if(!w)return"";try{return new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function g(w){if(!w)return"";const I=w.replace(/<.*>/,"").trim();return I.length>24?I.slice(0,22)+"â¦":I}var _={toggleGroup:o},h=Rn(),x=$e(h);{var b=w=>{var I=rg(),D=f(I),O=f(D),ie=m(D,2);bt(ie,20,()=>n().order,V=>V,(V,U)=>{const q=st(()=>n().groups[U]),P=st(()=>Wo(U)),le=st(()=>l(a)===U);var ke=Zm();let xe;ke.__click=()=>o(U);let we;var J=f(ke);let ge;var Te=m(J),ae=m(Te),X=f(ae);Q(me=>{xe=Bt(ke,1,"chip svelte-mt5nvh",null,xe,{active:l(le)}),we=vn(ke,"",we,{"--c":l(P)}),ge=vn(J,"",ge,{background:l(P)}),C(Te,` ${me??""} `),C(X,l(q).length)},[()=>u(U)]),S(V,ke)});var de=m(ie,2);{var he=V=>{const U=st(()=>n().groups[l(a)]),q=st(()=>Wo(l(a)));var P=ng(),le=f(P);let ke;var xe=f(le);xe.__click=()=>{A(a,null),A(s,null)};var we=m(xe,2),J=f(we),ge=m(we,2),Te=f(ge),ae=m(le,2);bt(ae,21,()=>l(U),fe=>fe.emailId,(fe,pe)=>{var oe=$m(),R=f(oe);R.__click=()=>{var Oe;return(Oe=e.onaskai)==null?void 0:Oe.call(e,`Tell me about the email "${l(pe).subject}" from ${l(pe).from}`)};var Y=f(R),re=f(Y),G=m(Y,2),ve=f(G),ye=m(ve);{var ne=Oe=>{var qe=Jm(),Ke=f(qe);Q(ut=>C(Ke,ut),[()=>d(l(pe).date)]),S(Oe,qe)};Z(ye,Oe=>{l(pe).date&&Oe(ne)})}var K=m(R,2),Se=f(K);Se.__click=()=>{var Oe;return(Oe=e.onmarkacted)==null?void 0:Oe.call(e,l(pe).emailId)};var ce=m(Se,2);ce.__click=()=>{var Oe;return(Oe=e.ondismiss)==null?void 0:Oe.call(e,l(pe).emailId)},Q(Oe=>{C(re,l(pe).subject),C(ve,Oe)},[()=>g(l(pe).from)]),S(fe,oe)});var X=m(ae,2),me=f(X);{var M=fe=>{var pe=eg(),oe=$e(pe);oe.__click=()=>l(U).forEach(Y=>{var re;return(re=e.onmarkacted)==null?void 0:re.call(e,Y.emailId)});var R=m(oe,2);R.__click=()=>A(s,l(a),!0),S(fe,pe)},ee=fe=>{var pe=tg(),oe=$e(pe),R=f(oe),Y=m(oe,2);Y.__click=()=>A(s,null);var re=m(Y,2);re.__click=()=>{var G;(G=e.oncleargroup)==null||G.call(e,l(a)),A(s,null),A(a,null)},Q(()=>C(R,`Remove ${l(U).length??""}?`)),S(fe,pe)};Z(me,fe=>{l(s)!==l(a)?fe(M):fe(ee,!1)})}Q(fe=>{ke=vn(le,"",ke,{"border-color":l(q)}),C(J,fe),C(Te,l(U).length)},[()=>u(l(a))]),S(V,P)};Z(de,V=>{l(a)&&n().groups[l(a)]&&V(he)})}Q(()=>C(O,`${n().total??""} item${n().total!==1?"s":""} need attention`)),S(w,I)};Z(x,w=>{n()&&n().total>0&&w(b)})}return S(t,h),qt(_)}en(["click"]);var sg=T('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),ig=T('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),og=T('<div class="strip svelte-1ed7zw1"><!></div>');function lg(t,e){let n=De(e,"hasScanData",3,!1),a=De(e,"engineReady",3,!1),s=De(e,"isScanning",3,!1),o=st(()=>a()&&!n()&&!s()),u=st(()=>l(o)||s());var d=Rn(),g=$e(d);{var _=h=>{var x=og(),b=f(x);{var w=D=>{var O=sg();S(D,O)},I=D=>{var O=ig();O.__click=function(...ie){var de;(de=e.onscan)==null||de.apply(this,ie)},S(D,O)};Z(b,D=>{s()?D(w):l(o)&&D(I,1)})}S(h,x)};Z(g,h=>{l(u)&&h(_)})}S(t,d)}en(["click"]);var cg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),ug=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),dg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),vg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),fg=T('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),pg=T('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),hg=T('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function mg(t,e){Nt(e,!0),En(()=>$n("GpuPanel"));var n=hg(),a=f(n),s=m(f(a),2),o=m(f(s),2),u=f(o),d=m(s,2),g=m(f(d),2),_=f(g),h=m(d,2);{var x=V=>{var U=cg(),q=m(f(U),2),P=f(q);Q(()=>C(P,e.gpuInfo.device)),S(V,U)};Z(h,V=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&V(x)})}var b=m(h,2);{var w=V=>{var U=ug(),q=m(f(U),2),P=f(q);Q(le=>C(P,le),[()=>Go(e.gpuInfo.limits.maxBufferSize)]),S(V,U)};Z(b,V=>{var U;(U=e.gpuInfo.limits)!=null&&U.maxBufferSize&&V(w)})}var I=m(b,2);{var D=V=>{var U=dg(),q=m(f(U),2),P=f(q);Q(()=>C(P,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),S(V,U)};Z(I,V=>{var U;(U=e.gpuInfo.limits)!=null&&U.maxComputeInvocationsPerWorkgroup&&V(D)})}var O=m(I,2);{var ie=V=>{var U=vg(),q=m(f(U),2),P=f(q);Q(le=>C(P,le),[()=>Go(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),S(V,U)};Z(O,V=>{var U;(U=e.gpuInfo.limits)!=null&&U.maxComputeWorkgroupStorageSize&&V(ie)})}var de=m(O,2);{var he=V=>{var U=pg(),q=f(U),P=f(q),le=m(q,2);bt(le,21,()=>e.gpuInfo.features,Lt,(ke,xe)=>{var we=fg(),J=f(we);Q(()=>C(J,l(xe))),S(ke,we)}),Q(()=>C(P,`Features (${e.gpuInfo.features.length??""})`)),S(V,U)};Z(de,V=>{var U;(U=e.gpuInfo.features)!=null&&U.length&&V(he)})}Q(()=>{C(u,e.gpuInfo.vendor),C(_,e.gpuInfo.architecture)}),S(t,n),qt()}var gg=T('<button class="gpu-badge svelte-1ktw27c"> </button>'),_g=T('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),yg=T('<span class="stats svelte-1ktw27c"> </span>'),bg=T('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),wg=T('<span class="stats preparing svelte-1ktw27c"> </span>'),kg=T('<span class="stats svelte-1ktw27c"> </span>'),xg=T('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Sg=T('<button class="btn svelte-1ktw27c">Stop</button>'),Eg=T('<button class="btn primary svelte-1ktw27c">Send</button>'),Tg=T('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Ag(t,e){Nt(e,!0),En(()=>$n("ChatView"));let n=De(e,"messages",19,()=>[]),a=De(e,"pendingData",3,null),s=De(e,"hasScanData",3,!1),o=De(e,"engineReady",3,!1),u=De(e,"isScanning",3,!1),d=De(e,"isRunning",3,!1),g=De(e,"tps",3,null),_=De(e,"numTokens",3,null),h=De(e,"generationPhase",3,null),x=De(e,"gpuInfo",3,null),b=De(e,"backend",3,"webgpu"),w=De(e,"chatContainer",15),I=Pe(""),D=Pe(!1);function O(G){G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),ie())}function ie(){const G=l(I).trim();!G||d()||(A(I,""),e.onsend(G))}function de(G){G&&!d()&&e.onsend(G)}var he=Tg(),V=f(he),U=f(V);{var q=G=>{var ve=gg();ve.__click=()=>A(D,!l(D));var ye=f(ve);Q(()=>C(ye,`WebGPU ${l(D)?"â²":"â¼"}`)),S(G,ve)},P=G=>{var ve=_g();S(G,ve)};Z(U,G=>{x()?G(q):b()==="ollama"&&G(P,1)})}var le=m(U,2);{var ke=G=>{var ve=yg(),ye=f(ve);Q((ne,K)=>C(ye,`${_()??""} tokens in ${ne??""}s
        (${K??""} tok/s)`),[()=>(_()/g()).toFixed(1),()=>g().toFixed(1)]),S(G,ve)},xe=G=>{var ve=bg();S(G,ve)},we=G=>{var ve=wg(),ye=f(ve);Q(ne=>C(ye,`thinking... ${ne??""}`),[()=>g()?`${g().toFixed(0)} tok/s`:""]),S(G,ve)},J=G=>{var ve=kg(),ye=f(ve);Q(ne=>C(ye,`${ne??""} tok/s`),[()=>g().toFixed(1)]),S(G,ve)};Z(le,G=>{g()&&!d()?G(ke):d()&&h()==="preparing"?G(xe,1):d()&&h()==="thinking"?G(we,2):g()&&d()&&G(J,3)})}var ge=m(le,4);ge.__click=function(...G){var ve;(ve=e.onreset)==null||ve.apply(this,G)};var Te=m(V,2);{var ae=G=>{mg(G,{get gpuInfo(){return x()}})};Z(Te,G=>{l(D)&&x()&&G(ae)})}var X=m(Te,2),me=f(X);{var M=G=>{var ve=xg();S(G,ve)};Z(me,G=>{n().length===0&&!(a()&&a().total>0)&&G(M)})}var ee=m(me,2);bt(ee,17,n,Lt,(G,ve,ye)=>{var ne=Rn(),K=$e(ne);{var Se=qe=>{ag(qe,{get pendingData(){return l(ve).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:de})},ce=qe=>{Xm(qe,{get msg(){return l(ve)},get oncommand(){return e.oncommand}})},Oe=qe=>{{let Ke=st(()=>ye===n().length-1);nm(qe,{get msg(){return l(ve)},get isLast(){return l(Ke)},get isRunning(){return d()},get generationPhase(){return h()},get numTokens(){return _()}})}};Z(K,qe=>{l(ve).type==="dashboard"?qe(Se):l(ve).type==="event"||l(ve).type==="event-batch"||l(ve).type==="events-grouped"?qe(ce,1):qe(Oe,!1)})}S(G,ne)}),Ju(X,G=>w(G),()=>w());var fe=m(X,2);lg(fe,{get hasScanData(){return s()},get engineReady(){return o()},get isScanning(){return u()},get onscan(){return e.onscan}});var pe=m(fe,2),oe=f(pe);oe.__keydown=O;var R=m(oe,2);{var Y=G=>{var ve=Sg();ve.__click=function(...ye){var ne;(ne=e.onstop)==null||ne.apply(this,ye)},S(G,ve)},re=G=>{var ve=Eg();ve.__click=ie,Q(ye=>ve.disabled=ye,[()=>!l(I).trim()]),S(G,ve)};Z(R,G=>{d()?G(Y):G(re,!1)})}Q(()=>{ge.disabled=d(),oe.disabled=d()}),Ur(oe,()=>l(I),G=>A(I,G)),S(t,he),qt()}en(["click","keydown"]);var Ig=T('<div class="container center svelte-1bi93vx"><!> <!></div>');function Cg(t,e){Nt(e,!0);const n=!!navigator.gpu,a=td();let s=Pe("webgpu"),o=Pe(Yt(Cr[0].id)),u=Pe(null),d=Pe(null),g=Pe(""),_=Pe(Yt([])),h=Pe(Yt([])),x=Pe(!1),b=Pe(null),w=Pe(null),I=Pe(null),D=Pe(null),O=Pe(null),ie=Pe(null),de=Pe(!1),he=Pe(!1),V=!1;En(async()=>{const[R,Y]=await Promise.all([js("aiBackend"),js("selectedModel")]);R&&A(s,R,!0),Y&&A(o,Y,!0),a.check(),a.isReady&&U();const re=a.onMessage(G=>{switch(G.status){case"webgpu-info":A(D,G.data,!0);break;case"loading":A(u,"loading"),A(g,G.data,!0);break;case"initiate":A(_,[...l(_),G],!0);break;case"progress":A(_,l(_).map(ve=>ve.file===G.file?{...ve,...G}:ve),!0);break;case"done":A(_,l(_).filter(ve=>ve.file!==G.file),!0);break;case"ready":A(u,"ready"),U();break;case"start":if(!l(x))break;A(O,G.phase||"preparing",!0),A(h,[...l(h),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!l(x))break;A(O,G.phase,!0);break;case"thinking":{if(!l(x))break;A(b,G.tps,!0),A(w,G.numTokens,!0);const ve=l(h)[l(h).length-1];A(h,[...l(h).slice(0,-1),{...ve,thinking:(ve.thinking||"")+G.content}],!0),ge();break}case"thinking-done":{if(!l(x))break;A(b,G.tps,!0),A(w,G.numTokens,!0);const ve=l(h)[l(h).length-1];A(h,[...l(h).slice(0,-1),{...ve,thinking:G.content}],!0);break}case"update":{if(!l(x))break;A(b,G.tps,!0),A(w,G.numTokens,!0);const ve=l(h)[l(h).length-1];A(h,[...l(h).slice(0,-1),{...ve,content:ve.content+G.output}],!0),ge();break}case"complete":if(!l(x))break;G.tps!==void 0&&A(b,G.tps,!0),G.numTokens!==void 0&&A(w,G.numTokens,!0),A(x,!1),A(O,null),q();break;case"error":A(d,G.data,!0),l(u)==="loading"&&A(u,null),l(x)&&(A(x,!1),A(O,null));break}});return()=>re()});async function U(){if(!(V||l(h).length>0))try{const R=await Ic();A(ie,R,!0),R&&(V=!0,A(h,[{role:"assistant",type:"dashboard",pendingData:R}],!0),ge());const Y=await Ho();A(de,Y.classified>0)}catch{}}async function q(){try{const R=await Ic();A(ie,R,!0);const Y=l(h).findIndex(G=>G.type==="dashboard");Y!==-1&&(R&&R.total>0?A(h,l(h).map((G,ve)=>ve===Y?{...G,pendingData:R}:G),!0):A(h,l(h).filter((G,ve)=>ve!==Y),!0));const re=await Ho();A(de,re.classified>0)}catch{}}async function P(R){await Ti(R,"acted"),await q()}async function le(R){await Ti(R,"dismissed"),await q()}async function ke(R){await bd(R),await q()}async function xe(R){await kl(R),await q()}async function we(){if(l(he)||!a.isReady)return;A(he,!0);let R=null;try{if(await _d(a,{count:20,onProgress:Y=>{var re;Y.phase==="done"&&((re=Y.results)==null?void 0:re.length)>0&&(R=Y.results)}}),await q(),(R==null?void 0:R.length)>0){const Y=await Hp(R);A(h,[...l(h),Y],!0),ge()}l(ie)&&!l(h).some(Y=>Y.type==="dashboard")&&(A(h,[{role:"assistant",type:"dashboard",pendingData:l(ie)},...l(h)],!0),ge())}catch(Y){console.error("Scan failed:",Y)}finally{A(he,!1)}}function J({event:R,commandId:Y}){var re,G;`${Y}${R.type}${((re=R.data)==null?void 0:re.subject)||"unknown"}`,A(h,[...l(h),{role:"assistant",content:`Command: ${Y}

This command is not yet implemented. In the future, "${Y}" will be executed on the ${R.source} event "${((G=R.data)==null?void 0:G.subject)||""}".`}],!0),ge()}function ge(){Vu().then(()=>{l(I)&&(l(I).scrollTop=l(I).scrollHeight)})}async function Te(){A(u,"loading"),await Ds("selectedModel",l(o)),await Ds("aiBackend",l(s)),l(s)==="ollama"&&A(D,null),a.loadModel(l(o))}Oa(()=>{l(s)==="webgpu"&&!Cr.find(R=>R.id===l(o))?A(o,Cr[0].id,!0):l(s)==="ollama"&&!Pr.find(R=>R.name===l(o))&&A(o,Pr[0].name,!0)});async function ae(R){if(!R||l(x))return;if(R.trim().toLowerCase()==="/events"){A(h,[...l(h),{role:"user",content:R}],!0);try{const G=await yd();if(!G.order.length)A(h,[...l(h),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const ve=await Wp(G);A(h,[...l(h),ve],!0)}}catch(G){A(h,[...l(h),{role:"assistant",content:`Failed to load events: ${G.message}`}],!0)}ge();return}A(h,[...l(h),{role:"user",content:R}],!0),A(b,null),A(x,!0);let Y=[];try{const ve=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(R)?await Pp(R):await Cp();ve&&(Y=[{role:"system",content:ve}])}catch{}const re=l(h).filter(G=>G.type!=="dashboard"&&G.type!=="events-grouped"&&G.type!=="event-batch"&&G.type!=="event").map(G=>({role:G.role,content:G.content}));a.generate([...Y,...re]),ge()}function X(){a.interrupt()}function me(){a.reset(),A(h,[],!0),A(b,null),A(w,null),V=!1,U()}var M=Rn(),ee=$e(M);{var fe=R=>{var Y=Ig(),re=f(Y);oh(re,{get isWebGPUAvailable(){return n},get backend(){return l(s)},set backend(ne){A(s,ne,!0)}});var G=m(re,2);{var ve=ne=>{bh(ne,{get gpuInfo(){return l(D)},get error(){return l(d)},onload:Te,get selectedModel(){return l(o)},set selectedModel(K){A(o,K,!0)}})},ye=ne=>{Nh(ne,{onload:Te,get selectedModel(){return l(o)},set selectedModel(K){A(o,K,!0)},get error(){return l(d)},set error(K){A(d,K,!0)}})};Z(G,ne=>{l(s)==="webgpu"?ne(ve):l(s)==="ollama"&&ne(ye,1)})}S(R,Y)},pe=R=>{Hh(R,{get message(){return l(g)},get items(){return l(_)}})},oe=R=>{Ag(R,{get messages(){return l(h)},get pendingData(){return l(ie)},get hasScanData(){return l(de)},get engineReady(){return a.isReady},get isScanning(){return l(he)},get isRunning(){return l(x)},get tps(){return l(b)},get numTokens(){return l(w)},get generationPhase(){return l(O)},get gpuInfo(){return l(D)},get backend(){return l(s)},onsend:ae,onstop:X,onreset:me,onmarkacted:P,ondismiss:le,onremove:ke,oncleargroup:xe,onscan:we,oncommand:J,get chatContainer(){return l(I)},set chatContainer(Y){A(I,Y,!0)}})};Z(ee,R=>{l(u)===null?R(fe):l(u)==="loading"?R(pe,1):R(oe,!1)})}S(t,M),qt()}const kn="gmail",Lc=8,Td=50,Ad=100;async function Pg(t,{limit:e=Td,onProgress:n=()=>{},signal:a}={}){var u;const s=await Qe.syncState.get(kn);if(s!=null&&s.historyId)try{return await Dg(t,s,n,a)}catch(d){if(d instanceof yl&&(d.status===404||d.code==="notFound")||((u=d.message)==null?void 0:u.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Qe.syncState.delete(kn);else throw d}return await Mg(t,e===0?1/0:e,n,a)}async function Og(t,{limit:e=Td,onProgress:n=()=>{},signal:a}={}){const s=await Qe.syncState.get(kn);return s!=null&&s.oldestPageToken?await jg(t,s,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function Rg(){const t=await Qe.syncState.get(kn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Id(){await Qe.transaction("rw",[Qe.items,Qe.syncState],async()=>{await Qe.items.where("sourceType").equals(kn).delete(),await Qe.syncState.delete(kn)})}async function Mg(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Ma(a);const s=await nd(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(s.messagesTotal||e,e)});const o=[];let u,d=null;for(;o.length<e;){Ma(a);const x=e-o.length,b=await rd(t,{maxResults:Math.min(Ad,x),pageToken:u}),w=(b.messages||[]).map(I=>I.id);if(o.push(...w),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(s.messagesTotal||e,e)}),u=b.nextPageToken,!u||w.length===0)break}if(d=u||null,o.length===0)return await Qe.syncState.put({sourceType:kn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:g,errors:_}=await Cd(t,o,n,a),h=await Qe.items.where("sourceType").equals(kn).count();return await Qe.syncState.put({sourceType:kn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:h,oldestPageToken:d}),n({phase:"done",message:`Synced ${g} messages`,current:g,total:g}),{added:g,deleted:0,errors:_}}async function jg(t,e,n,a,s){a({phase:"listing",message:"Loading more messages...",current:0}),Ma(s);const o=[];let u=e.oldestPageToken,d=null;for(;o.length<n;){Ma(s);const x=n-o.length,b=await rd(t,{maxResults:Math.min(Ad,x),pageToken:u}),w=(b.messages||[]).map(I=>I.id);if(o.push(...w),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),u=b.nextPageToken,!u||w.length===0)break}if(d=u||null,o.length===0)return await Qe.syncState.update(kn,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:g,errors:_}=await Cd(t,o,a,s),h=await Qe.items.where("sourceType").equals(kn).count();return await Qe.syncState.update(kn,{totalItems:h,lastSyncAt:Date.now(),oldestPageToken:d}),a({phase:"done",message:d?`Downloaded ${g} more (more available)`:`Downloaded ${g} more (all synced)`,current:h,total:h}),{added:g,errors:_}}async function Dg(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Ma(a);let s=0,o=0,u=0,d,g=e.historyId;do{Ma(a);const h=await _p(t,{startHistoryId:e.historyId,pageToken:d});if(g=h.historyId||g,d=h.nextPageToken,!!h.history){for(const x of h.history){if(x.messagesAdded){const b=x.messagesAdded.map(I=>I.message.id),w=[...new Set(b.filter(I=>I))];if(w.length>0){const I=await Promise.allSettled(w.map(O=>ad(t,O))),D=[];for(const O of I)O.status==="fulfilled"?D.push(Pd(O.value)):u++;D.length>0&&(await Qe.items.bulkPut(D),await Od(D),s+=D.length)}}if(x.messagesDeleted){const b=x.messagesDeleted.map(w=>hl(kn,w.message.id)).filter(w=>w);b.length>0&&(await Qe.items.bulkDelete(b),o+=b.length)}}n({phase:"syncing",message:`Changes: +${s} -${o}`,current:s+o})}}while(d);const _=await Qe.items.where("sourceType").equals(kn).count();return await Qe.syncState.put({sourceType:kn,historyId:g,lastSyncAt:Date.now(),totalItems:_,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:s===0&&o===0?"Already up to date":`Synced: +${s} -${o}`,current:_,total:_}),{added:s,deleted:o,errors:u}}async function Cd(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let s=0,o=0;for(let u=0;u<e.length;u+=Lc){Ma(a);const d=e.slice(u,u+Lc),g=await Promise.allSettled(d.map(h=>ad(t,h))),_=[];for(const h of g)h.status==="fulfilled"?_.push(Pd(h.value)):o++;_.length>0&&(await Qe.items.bulkPut(_),await Od(_)),s+=_.length,n({phase:"downloading",message:`Downloaded ${s} of ${e.length} messages`,current:s,total:e.length})}return{added:s,errors:o}}function Pd(t){const e=$r(t,"From"),n=$r(t,"To"),a=$r(t,"Cc"),s=$r(t,"Subject")||"(no subject)",o=$r(t,"Date"),u=$r(t,"Message-ID"),d=$r(t,"In-Reply-To"),g=$r(t,"References");let _;try{_=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{_=Date.now()}return{id:hl(kn,t.id),sourceType:kn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:s,snippet:t.snippet||"",body:yp(t),htmlBody:bp(t),date:_,labels:t.labelIds||[],messageId:u,inReplyTo:d,references:g,raw:t,syncedAt:Date.now()}}async function Od(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const s=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of s){const u=Lg(o);u&&!e.has(u.email)&&e.set(u.email,{...u,date:n.date})}}for(const[n,{name:a,date:s}]of e)try{const o=await Qe.contacts.where("email").equals(n).first();if(o){const u={};a&&!o.name&&(u.name=a),s>(o.lastSeen||0)&&(u.lastSeen=s),Object.keys(u).length>0&&await Qe.contacts.update(o.id,u)}else await Qe.contacts.add({email:n,name:a||"",firstSeen:s,lastSeen:s})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function Lg(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),s=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:s}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Ma(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var Ng=T(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),qg=T(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),Bg=T(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function Fg(t,e){Nt(e,!0);let n=De(e,"clientIdInput",15),a=De(e,"defaultClientId",3,"");En(()=>$n("SetupGuide"));let s=Pe(null);async function o(I){try{await navigator.clipboard.writeText(I),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}catch{const D=document.createElement("input");D.value=I,document.body.appendChild(D),D.select(),document.execCommand("copy"),document.body.removeChild(D),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}}const u="http://localhost:5173",d="https://cypherkitty.github.io",g="https://cypherkitty.github.io/me-ai/";var _=Bg(),h=f(_),x=m(f(h),4);{var b=I=>{var D=Ng(),O=$e(D),ie=m(f(O),2);ie.__click=()=>{n(a()),e.onsave()};var de=m(O,2),he=m(f(de),2),V=f(he),U=m(f(V),6),q=m(f(U),2),P=m(f(q),2),le=m(f(P),2),ke=f(le);ke.__click=()=>o(u);var xe=f(ke);xe.textContent="http://localhost:5173";var we=m(xe,2),J=f(we),ge=m(ke,2);ge.__click=()=>o(d);var Te=f(ge);Te.textContent="https://cypherkitty.github.io";var ae=m(Te,2),X=f(ae),me=m(P,2),M=m(f(me),2),ee=f(M);ee.__click=()=>o(u);var fe=f(ee);fe.textContent="http://localhost:5173";var pe=m(fe,2),oe=f(pe),R=m(ee,2);R.__click=()=>o(d);var Y=f(R);Y.textContent="https://cypherkitty.github.io";var re=m(Y,2),G=f(re),ve=m(R,2);ve.__click=()=>o(g);var ye=f(ve);ye.textContent="https://cypherkitty.github.io/me-ai/";var ne=m(ye,2),K=f(ne),Se=m(V,2),ce=f(Se);ce.__keydown=qe=>qe.key==="Enter"&&e.onsave();var Oe=m(ce,2);Oe.__click=function(...qe){var Ke;(Ke=e.onsave)==null||Ke.apply(this,qe)},Q(qe=>{C(J,l(s)===u?"â":"â§"),C(X,l(s)===d?"â":"â§"),C(oe,l(s)===u?"â":"â§"),C(G,l(s)===d?"â":"â§"),C(K,l(s)===g?"â":"â§"),Oe.disabled=qe},[()=>!n().trim()]),Ur(ce,n),S(I,D)},w=I=>{var D=qg(),O=$e(D),ie=m(f(O),6),de=m(f(ie),2),he=m(f(de),2),V=m(f(he),2),U=f(V);U.__click=()=>o(u);var q=f(U);q.textContent="http://localhost:5173";var P=m(q,2),le=f(P),ke=m(U,2);ke.__click=()=>o(d);var xe=f(ke);xe.textContent="https://cypherkitty.github.io";var we=m(xe,2),J=f(we),ge=m(he,2),Te=m(f(ge),2),ae=f(Te);ae.__click=()=>o(u);var X=f(ae);X.textContent="http://localhost:5173";var me=m(X,2),M=f(me),ee=m(ae,2);ee.__click=()=>o(d);var fe=f(ee);fe.textContent="https://cypherkitty.github.io";var pe=m(fe,2),oe=f(pe),R=m(ee,2);R.__click=()=>o(g);var Y=f(R);Y.textContent="https://cypherkitty.github.io/me-ai/";var re=m(Y,2),G=f(re),ve=m(O,2),ye=f(ve);ye.__keydown=K=>K.key==="Enter"&&e.onsave();var ne=m(ye,2);ne.__click=function(...K){var Se;(Se=e.onsave)==null||Se.apply(this,K)},Q(K=>{C(le,l(s)===u?"â":"â§"),C(J,l(s)===d?"â":"â§"),C(M,l(s)===u?"â":"â§"),C(oe,l(s)===d?"â":"â§"),C(G,l(s)===g?"â":"â§"),ne.disabled=K},[()=>!n().trim()]),Ur(ye,n),S(I,D)};Z(x,I=>{a()?I(b):I(w,!1)})}S(t,_),qt()}en(["click","keydown"]);function zg(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof yl?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const s=n.match(/project\s+(\d+)/),o=s==null?void 0:s[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var Ug=T('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),Kg=T('<div class="error-card-title svelte-14buhqq"> </div>'),Gg=T('<p class="error-card-fix svelte-14buhqq"> </p>'),Hg=T('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),Wg=T('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),Vg=T('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function Rd(t,e){Nt(e,!0);let n=De(e,"ondismiss",3,null),a=De(e,"onsignout",3,null),s=st(()=>zg(e.error));En(()=>$n("ErrorCard"));var o=Vg(),u=f(o);{var d=ie=>{var de=Ug(),he=f(de),V=f(he),U=m(he,2);U.__click=function(...q){var P;(P=n())==null||P.apply(this,q)},Q(()=>C(V,l(s).title)),S(ie,de)},g=ie=>{var de=Kg(),he=f(de);Q(()=>C(he,l(s).title)),S(ie,de)};Z(u,ie=>{n()?ie(d):ie(g,!1)})}var _=m(u,2),h=f(_),x=m(_,2);{var b=ie=>{var de=Gg(),he=f(de);Q(()=>C(he,l(s).fix)),S(ie,de)};Z(x,ie=>{l(s).fix&&ie(b)})}var w=m(x,2);{var I=ie=>{var de=Hg(),he=f(de);Q(()=>{sr(de,"href",l(s).link.url),C(he,`${l(s).link.label??""} â`)}),S(ie,de)};Z(w,ie=>{l(s).link&&ie(I)})}var D=m(w,2);{var O=ie=>{var de=Wg();de.__click=function(...he){var V;(V=a())==null||V.apply(this,he)},S(ie,de)};Z(D,ie=>{l(s).action==="signout"&&a()&&ie(O)})}Q(()=>C(h,l(s).description)),S(t,o),qt()}en(["click"]);var Yg=T('<span class="spinner svelte-nyqevv"></span> Signing in...',1),Qg=pl('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),Xg=T('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),Zg=T('<span class="client-id-value svelte-nyqevv"> </span>'),Jg=T(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function $g(t,e){Nt(e,!0);let n=De(e,"isDefaultClientId",3,!1),a=De(e,"error",3,null),s=De(e,"loadingAuth",3,!1);En(()=>$n("AuthCard"));var o=Jg(),u=f(o),d=m(f(u),4);{var g=de=>{Rd(de,{get error(){return a()},get onsignout(){return e.onsignout}})};Z(d,de=>{a()&&de(g)})}var _=m(d,2);_.__click=function(...de){var he;(he=e.onsignin)==null||he.apply(this,de)};var h=f(_);{var x=de=>{var he=Yg();S(de,he)},b=de=>{var he=Qg();S(de,he)};Z(h,de=>{s()?de(x):de(b,!1)})}var w=m(_,4),I=m(f(w),2);{var D=de=>{var he=Xg();S(de,he)},O=de=>{var he=Zg(),V=f(he);Q(U=>C(V,`${U??""}...`),[()=>e.clientId.slice(0,20)]),S(de,he)};Z(I,de=>{n()?de(D):de(O,!1)})}var ie=m(I,2);ie.__click=function(...de){var he;(he=e.onclear)==null||he.apply(this,de)},Q(()=>_.disabled=s()),S(t,o),qt()}en(["click"]);var e_=T('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),t_=T('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),n_=T('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function r_(t,e){Nt(e,!0);let n=De(e,"profile",3,null),a=De(e,"loadingProfile",3,!1);En(()=>$n("ProfileCard"));var s=n_(),o=f(s),u=f(o),d=m(o,2),g=f(d);{var _=b=>{var w=e_();S(b,w)},h=b=>{var w=t_(),I=$e(w),D=f(I),O=m(I,2),ie=f(O);Q((de,he)=>{C(D,n().emailAddress),C(ie,`${de??""} messages
        Â· ${he??""} threads`)},[()=>{var de;return((de=n().messagesTotal)==null?void 0:de.toLocaleString())||"?"},()=>{var de;return((de=n().threadsTotal)==null?void 0:de.toLocaleString())||"?"}]),S(b,w)};Z(g,b=>{a()?b(_):n()&&b(h,1)})}var x=m(d,2);x.__click=function(...b){var w;(w=e.onsignout)==null||w.apply(this,b)},Q(b=>C(u,b),[()=>n()?id(n().emailAddress):"?"]),S(t,s),qt()}en(["click"]);var a_=T('<span class="spinner svelte-1ds3j4k"></span>'),s_=pl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),i_=T('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),o_=T('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),l_=T('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),c_=T('<option class="svelte-1ds3j4k"> </option>'),u_=T('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),d_=T('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),v_=T('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),f_=T('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),p_=T('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),h_=T('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function m_(t,e){Nt(e,!0),En(()=>$n("SyncStatus"));let n=De(e,"syncStatus",3,null),a=De(e,"syncProgress",3,null),s=De(e,"isSyncing",3,!1),o=Pe(!1),u=Pe(50);const d=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function g(M){if(!M)return"never";const ee=Math.floor((Date.now()-M)/1e3);if(ee<60)return"just now";const fe=Math.floor(ee/60);if(fe<60)return`${fe}m ago`;const pe=Math.floor(fe/60);return pe<24?`${pe}h ago`:`${Math.floor(pe/24)}d ago`}function _(){var M,ee;return!((M=a())!=null&&M.total)||!((ee=a())!=null&&ee.current)?0:Math.round(a().current/a().total*100)}var h=h_(),x=f(h),b=f(x),w=f(b);{var I=M=>{var ee=a_();S(M,ee)},D=M=>{var ee=s_();S(M,ee)};Z(w,M=>{s()?M(I):M(D,!1)})}var O=m(b,2),ie=m(f(O),2);{var de=M=>{var ee=i_(),fe=f(ee),pe=m(fe);{var oe=Y=>{var re=fn("Â· more available");S(Y,re)},R=Y=>{var re=fn("Â· all synced");S(Y,re)};Z(pe,Y=>{n().hasMore?Y(oe):Y(R,!1)})}Q((Y,re)=>C(fe,`${Y??""} emails stored
          Â· synced ${re??""} `),[()=>n().totalItems.toLocaleString(),()=>g(n().lastSyncAt)]),S(M,ee)},he=M=>{var ee=o_();S(M,ee)};Z(ie,M=>{var ee;(ee=n())!=null&&ee.synced?M(de):M(he,!1)})}var V=m(O,2),U=f(V);{var q=M=>{var ee=l_();ee.__click=()=>A(o,!l(o)),S(M,ee)};Z(U,M=>{var ee;(ee=n())!=null&&ee.synced&&!s()&&M(q)})}var P=m(x,2),le=f(P),ke=m(f(le),2);bt(ke,21,()=>d,Lt,(M,ee)=>{var fe=c_(),pe=f(fe),oe={};Q(()=>{C(pe,l(ee).label),oe!==(oe=l(ee).value)&&(fe.value=(fe.__value=l(ee).value)??"")}),S(M,fe)});var xe=m(le,2),we=f(xe);{var J=M=>{var ee=d_(),fe=$e(ee);fe.__click=()=>e.onsync(l(u));var pe=f(fe),oe=m(fe,2);{var R=Y=>{var re=u_();re.__click=()=>e.onsyncmore(l(u));var G=f(re);Q(()=>{re.disabled=s(),C(G,s()?"Loading...":"Sync More")}),S(Y,re)};Z(oe,Y=>{n().hasMore&&Y(R)})}Q(()=>{fe.disabled=s(),C(pe,s()?"Syncing...":"Sync New")}),S(M,ee)},ge=M=>{var ee=v_();ee.__click=()=>e.onsync(l(u));var fe=f(ee);Q(()=>{ee.disabled=s(),C(fe,s()?"Syncing...":"Download Emails")}),S(M,ee)};Z(we,M=>{var ee;(ee=n())!=null&&ee.synced?M(J):M(ge,!1)})}var Te=m(P,2);{var ae=M=>{var ee=f_(),fe=f(ee),pe=f(fe);let oe,R;var Y=m(fe,2),re=f(Y);Q(G=>{oe=Bt(pe,1,"progress-fill svelte-1ds3j4k",null,oe,{indeterminate:!a().total}),R=vn(pe,"",R,G),C(re,a().message||"Syncing...")},[()=>({width:`${_()??""}%`})]),S(M,ee)};Z(Te,M=>{s()&&a()&&M(ae)})}var X=m(Te,2);{var me=M=>{var ee=p_(),fe=m(f(ee),2),pe=f(fe);pe.__click=()=>A(o,!1);var oe=m(pe,2);oe.__click=()=>{e.onclear(),A(o,!1)},S(M,ee)};Z(X,M=>{l(o)&&M(me)})}Q(()=>ke.disabled=s()),Hs(ke,()=>l(u),M=>A(u,M)),S(t,h),qt()}en(["click"]);var g_=T('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),__=T('<div class="message-list svelte-y2uamw"></div>');function y_(t,e){Nt(e,!0);let n=De(e,"messages",19,()=>[]);En(()=>$n("MessageList"));var a=__();bt(a,21,n,Lt,(s,o)=>{var u=g_();u.__click=()=>e.onselect(l(o));var d=f(u),g=f(d),_=m(d,2),h=f(_),x=f(h),b=f(x),w=m(x,2),I=f(w),D=m(h,2),O=f(D),ie=m(D,2),de=f(ie);Q((he,V,U)=>{C(g,he),C(b,V),C(I,U),C(O,l(o).subject),C(de,l(o).snippet)},[()=>id(l(o).from),()=>sd(l(o).from),()=>bl(l(o).date)]),S(s,u)}),S(t,a),qt()}en(["click"]);function El(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var La=El();function Md(t){La=t}var ma={exec:()=>null};function Ct(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(s,o)=>{let u=typeof o=="string"?o:o.source;return u=u.replace(On.caret,"$1"),n=n.replace(s,u),a},getRegex:()=>new RegExp(n,e)};return a}var b_=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),On={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},w_=/^(?:[ \t]*(?:\n|$))+/,k_=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,x_=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Vs=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,S_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Tl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,jd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Dd=Ct(jd).replace(/bull/g,Tl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),E_=Ct(jd).replace(/bull/g,Tl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Al=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,T_=/^[^\n]+/,Il=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,A_=Ct(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Il).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),I_=Ct(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Tl).getRegex(),Ui="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Cl=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,C_=Ct("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Cl).replace("tag",Ui).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ld=Ct(Al).replace("hr",Vs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex(),P_=Ct(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ld).getRegex(),Pl={blockquote:P_,code:k_,def:A_,fences:x_,heading:S_,hr:Vs,html:C_,lheading:Dd,list:I_,newline:w_,paragraph:Ld,table:ma,text:T_},Nc=Ct("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Vs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex(),O_={...Pl,lheading:E_,table:Nc,paragraph:Ct(Al).replace("hr",Vs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Nc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex()},R_={...Pl,html:Ct(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Cl).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ma,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ct(Al).replace("hr",Vs).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Dd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},M_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,j_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Nd=/^( {2,}|\\)\n(?!\s*$)/,D_=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ki=/[\p{P}\p{S}]/u,Ol=/[\s\p{P}\p{S}]/u,qd=/[^\s\p{P}\p{S}]/u,L_=Ct(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ol).getRegex(),Bd=/(?!~)[\p{P}\p{S}]/u,N_=/(?!~)[\s\p{P}\p{S}]/u,q_=/(?:[^\s\p{P}\p{S}]|~)/u,Fd=/(?![*_])[\p{P}\p{S}]/u,B_=/(?![*_])[\s\p{P}\p{S}]/u,F_=/(?:[^\s\p{P}\p{S}]|[*_])/u,z_=Ct(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",b_?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),zd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,U_=Ct(zd,"u").replace(/punct/g,Ki).getRegex(),K_=Ct(zd,"u").replace(/punct/g,Bd).getRegex(),Ud="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",G_=Ct(Ud,"gu").replace(/notPunctSpace/g,qd).replace(/punctSpace/g,Ol).replace(/punct/g,Ki).getRegex(),H_=Ct(Ud,"gu").replace(/notPunctSpace/g,q_).replace(/punctSpace/g,N_).replace(/punct/g,Bd).getRegex(),W_=Ct("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,qd).replace(/punctSpace/g,Ol).replace(/punct/g,Ki).getRegex(),V_=Ct(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Fd).getRegex(),Y_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",Q_=Ct(Y_,"gu").replace(/notPunctSpace/g,F_).replace(/punctSpace/g,B_).replace(/punct/g,Fd).getRegex(),X_=Ct(/\\(punct)/,"gu").replace(/punct/g,Ki).getRegex(),Z_=Ct(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),J_=Ct(Cl).replace("(?:-->|$)","-->").getRegex(),$_=Ct("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",J_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ai=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,ey=Ct(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ai).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Kd=Ct(/^!?\[(label)\]\[(ref)\]/).replace("label",Ai).replace("ref",Il).getRegex(),Gd=Ct(/^!?\[(ref)\](?:\[\])?/).replace("ref",Il).getRegex(),ty=Ct("reflink|nolink(?!\\()","g").replace("reflink",Kd).replace("nolink",Gd).getRegex(),qc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Rl={_backpedal:ma,anyPunctuation:X_,autolink:Z_,blockSkip:z_,br:Nd,code:j_,del:ma,delLDelim:ma,delRDelim:ma,emStrongLDelim:U_,emStrongRDelimAst:G_,emStrongRDelimUnd:W_,escape:M_,link:ey,nolink:Gd,punctuation:L_,reflink:Kd,reflinkSearch:ty,tag:$_,text:D_,url:ma},ny={...Rl,link:Ct(/^!?\[(label)\]\((.*?)\)/).replace("label",Ai).getRegex(),reflink:Ct(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ai).getRegex()},Qo={...Rl,emStrongRDelimAst:H_,emStrongLDelim:K_,delLDelim:V_,delRDelim:Q_,url:Ct(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",qc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Ct(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",qc).getRegex()},ry={...Qo,br:Ct(Nd).replace("{2,}","*").getRegex(),text:Ct(Qo.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},fi={normal:Pl,gfm:O_,pedantic:R_},_s={normal:Rl,gfm:Qo,breaks:ry,pedantic:ny},ay={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Bc=t=>ay[t];function Lr(t,e){if(e){if(On.escapeTest.test(t))return t.replace(On.escapeReplace,Bc)}else if(On.escapeTestNoEncode.test(t))return t.replace(On.escapeReplaceNoEncode,Bc);return t}function Fc(t){try{t=encodeURI(t).replace(On.percentDecode,"%")}catch{return null}return t}function zc(t,e){var o;let n=t.replace(On.findPipe,(u,d,g)=>{let _=!1,h=d;for(;--h>=0&&g[h]==="\\";)_=!_;return _?"|":" |"}),a=n.split(On.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace(On.slashPipe,"|");return a}function ys(t,e,n){let a=t.length;if(a===0)return"";let s=0;for(;s<a&&t.charAt(a-s-1)===e;)s++;return t.slice(0,a-s)}function sy(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function iy(t,e=0){let n=e,a="";for(let s of t)if(s==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=s,n++;return a}function Uc(t,e,n,a,s){let o=e.href,u=e.title||null,d=t[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let g={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:u,text:d,tokens:a.inlineTokens(d)};return a.state.inLink=!1,g}function oy(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let s=a[1];return e.split(`
`).map(o=>{let u=o.match(n.other.beginningSpace);if(u===null)return o;let[d]=u;return d.length>=s.length?o.slice(s.length):o}).join(`
`)}var Ii=class{constructor(t){kt(this,"options");kt(this,"rules");kt(this,"lexer");this.options=t||La}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:ys(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=oy(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=ys(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ys(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=ys(e[0],`
`).split(`
`),a="",s="",o=[];for(;n.length>0;){let u=!1,d=[],g;for(g=0;g<n.length;g++)if(this.rules.other.blockquoteStart.test(n[g]))d.push(n[g]),u=!0;else if(!u)d.push(n[g]);else break;n=n.slice(g);let _=d.join(`
`),h=_.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${_}`:_,s=s?`${s}
${h}`:h;let x=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,o,!0),this.lexer.state.top=x,n.length===0)break;let b=o.at(-1);if((b==null?void 0:b.type)==="code")break;if((b==null?void 0:b.type)==="blockquote"){let w=b,I=w.raw+`
`+n.join(`
`),D=this.blockquote(I);o[o.length-1]=D,a=a.substring(0,a.length-w.raw.length)+D.raw,s=s.substring(0,s.length-w.text.length)+D.text;break}else if((b==null?void 0:b.type)==="list"){let w=b,I=w.raw+`
`+n.join(`
`),D=this.list(I);o[o.length-1]=D,a=a.substring(0,a.length-b.raw.length)+D.raw,s=s.substring(0,s.length-w.raw.length)+D.raw,n=I.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:s}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim(),o=s.length>1,u={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let d=this.rules.other.listItemRegex(s),g=!1;for(;t;){let h=!1,x="",b="";if(!(e=d.exec(t))||this.rules.block.hr.test(t))break;x=e[0],t=t.substring(x.length);let w=iy(e[2].split(`
`,1)[0],e[1].length),I=t.split(`
`,1)[0],D=!w.trim(),O=0;if(this.options.pedantic?(O=2,b=w.trimStart()):D?O=e[1].length+1:(O=w.search(this.rules.other.nonSpaceChar),O=O>4?1:O,b=w.slice(O),O+=e[1].length),D&&this.rules.other.blankLine.test(I)&&(x+=I+`
`,t=t.substring(I.length+1),h=!0),!h){let ie=this.rules.other.nextBulletRegex(O),de=this.rules.other.hrRegex(O),he=this.rules.other.fencesBeginRegex(O),V=this.rules.other.headingBeginRegex(O),U=this.rules.other.htmlBeginRegex(O),q=this.rules.other.blockquoteBeginRegex(O);for(;t;){let P=t.split(`
`,1)[0],le;if(I=P,this.options.pedantic?(I=I.replace(this.rules.other.listReplaceNesting,"  "),le=I):le=I.replace(this.rules.other.tabCharGlobal,"    "),he.test(I)||V.test(I)||U.test(I)||q.test(I)||ie.test(I)||de.test(I))break;if(le.search(this.rules.other.nonSpaceChar)>=O||!I.trim())b+=`
`+le.slice(O);else{if(D||w.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||he.test(w)||V.test(w)||de.test(w))break;b+=`
`+I}D=!I.trim(),x+=P+`
`,t=t.substring(P.length+1),w=le.slice(O)}}u.loose||(g?u.loose=!0:this.rules.other.doubleBlankLine.test(x)&&(g=!0)),u.items.push({type:"list_item",raw:x,task:!!this.options.gfm&&this.rules.other.listIsTask.test(b),loose:!1,text:b,tokens:[]}),u.raw+=x}let _=u.items.at(-1);if(_)_.raw=_.raw.trimEnd(),_.text=_.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let h of u.items){if(this.lexer.state.top=!1,h.tokens=this.lexer.blockTokens(h.text,[]),h.task){if(h.text=h.text.replace(this.rules.other.listReplaceTask,""),((n=h.tokens[0])==null?void 0:n.type)==="text"||((a=h.tokens[0])==null?void 0:a.type)==="paragraph"){h.tokens[0].raw=h.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),h.tokens[0].text=h.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let b=this.lexer.inlineQueue.length-1;b>=0;b--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[b].src)){this.lexer.inlineQueue[b].src=this.lexer.inlineQueue[b].src.replace(this.rules.other.listReplaceTask,"");break}}let x=this.rules.other.listTaskCheckbox.exec(h.raw);if(x){let b={type:"checkbox",raw:x[0]+" ",checked:x[0]!=="[ ]"};h.checked=b.checked,u.loose?h.tokens[0]&&["paragraph","text"].includes(h.tokens[0].type)&&"tokens"in h.tokens[0]&&h.tokens[0].tokens?(h.tokens[0].raw=b.raw+h.tokens[0].raw,h.tokens[0].text=b.raw+h.tokens[0].text,h.tokens[0].tokens.unshift(b)):h.tokens.unshift({type:"paragraph",raw:b.raw,text:b.raw,tokens:[b]}):h.tokens.unshift(b)}}if(!u.loose){let x=h.tokens.filter(w=>w.type==="space"),b=x.length>0&&x.some(w=>this.rules.other.anyLine.test(w.raw));u.loose=b}}if(u.loose)for(let h of u.items){h.loose=!0;for(let x of h.tokens)x.type==="text"&&(x.type="paragraph")}return u}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:s}}}table(t){var u;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=zc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let d of a)this.rules.other.tableAlignRight.test(d)?o.align.push("right"):this.rules.other.tableAlignCenter.test(d)?o.align.push("center"):this.rules.other.tableAlignLeft.test(d)?o.align.push("left"):o.align.push(null);for(let d=0;d<n.length;d++)o.header.push({text:n[d],tokens:this.lexer.inline(n[d]),header:!0,align:o.align[d]});for(let d of s)o.rows.push(zc(d,o.header.length).map((g,_)=>({text:g,tokens:this.lexer.inline(g),header:!1,align:o.align[_]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=ys(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=sy(e[2],"()");if(o===-2)return;if(o>-1){let u=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],s=o[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),Uc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[a.toLowerCase()];if(!s){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Uc(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,d=s,g=0,_=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(_.lastIndex=0,e=e.slice(-1*t.length+s);(a=_.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(u=[...o].length,a[3]||a[4]){d+=u;continue}else if((a[5]||a[6])&&s%3&&!((s+u)%3)){g+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d+g);let h=[...a[0]][0].length,x=t.slice(0,s+a.index+h+u);if(Math.min(s,u)%2){let w=x.slice(1,-1);return{type:"em",raw:x,text:w,tokens:this.lexer.inlineTokens(w)}}let b=x.slice(2,-2);return{type:"strong",raw:x,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,d=s,g=this.rules.inline.delRDelim;for(g.lastIndex=0,e=e.slice(-1*t.length+s);(a=g.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(u=[...o].length,u!==s))continue;if(a[3]||a[4]){d+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d);let _=[...a[0]][0].length,h=t.slice(0,s+a.index+_+u),x=h.slice(s,-s);return{type:"del",raw:h,text:x,tokens:this.lexer.inlineTokens(x)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,s;if(e[2]==="@")a=e[0],s="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:a,href:s,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},pr=class Xo{constructor(e){kt(this,"tokens");kt(this,"options");kt(this,"state");kt(this,"inlineQueue");kt(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||La,this.options.tokenizer=this.options.tokenizer||new Ii,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:On,block:fi.normal,inline:_s.normal};this.options.pedantic?(n.block=fi.pedantic,n.inline=_s.pedantic):this.options.gfm&&(n.block=fi.gfm,this.options.breaks?n.inline=_s.breaks:n.inline=_s.gfm),this.tokenizer.rules=n}static get rules(){return{block:fi,inline:_s}}static lex(e,n){return new Xo(n).lex(e)}static lexInline(e,n){return new Xo(n).inlineTokens(e)}lex(e){e=e.replace(On.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var s,o,u;for(this.options.pedantic&&(e=e.replace(On.tabCharGlobal,"    ").replace(On.spaceLine,""));e;){let d;if((o=(s=this.options.extensions)==null?void 0:s.block)!=null&&o.some(_=>(d=_.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.space(e)){e=e.substring(d.raw.length);let _=n.at(-1);d.raw.length===1&&_!==void 0?_.raw+=`
`:n.push(d);continue}if(d=this.tokenizer.code(e)){e=e.substring(d.raw.length);let _=n.at(-1);(_==null?void 0:_.type)==="paragraph"||(_==null?void 0:_.type)==="text"?(_.raw+=(_.raw.endsWith(`
`)?"":`
`)+d.raw,_.text+=`
`+d.text,this.inlineQueue.at(-1).src=_.text):n.push(d);continue}if(d=this.tokenizer.fences(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.heading(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.hr(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.blockquote(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.list(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.html(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.def(e)){e=e.substring(d.raw.length);let _=n.at(-1);(_==null?void 0:_.type)==="paragraph"||(_==null?void 0:_.type)==="text"?(_.raw+=(_.raw.endsWith(`
`)?"":`
`)+d.raw,_.text+=`
`+d.raw,this.inlineQueue.at(-1).src=_.text):this.tokens.links[d.tag]||(this.tokens.links[d.tag]={href:d.href,title:d.title},n.push(d));continue}if(d=this.tokenizer.table(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.lheading(e)){e=e.substring(d.raw.length),n.push(d);continue}let g=e;if((u=this.options.extensions)!=null&&u.startBlock){let _=1/0,h=e.slice(1),x;this.options.extensions.startBlock.forEach(b=>{x=b.call({lexer:this},h),typeof x=="number"&&x>=0&&(_=Math.min(_,x))}),_<1/0&&_>=0&&(g=e.substring(0,_+1))}if(this.state.top&&(d=this.tokenizer.paragraph(g))){let _=n.at(-1);a&&(_==null?void 0:_.type)==="paragraph"?(_.raw+=(_.raw.endsWith(`
`)?"":`
`)+d.raw,_.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=_.text):n.push(d),a=g.length!==e.length,e=e.substring(d.raw.length);continue}if(d=this.tokenizer.text(e)){e=e.substring(d.raw.length);let _=n.at(-1);(_==null?void 0:_.type)==="text"?(_.raw+=(_.raw.endsWith(`
`)?"":`
`)+d.raw,_.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=_.text):n.push(d);continue}if(e){let _="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(_);break}else throw new Error(_)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var g,_,h,x,b;let a=e,s=null;if(this.tokens.links){let w=Object.keys(this.tokens.links);if(w.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)w.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=s[2]?s[2].length:0,a=a.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((_=(g=this.options.hooks)==null?void 0:g.emStrongMask)==null?void 0:_.call({lexer:this},a))??a;let u=!1,d="";for(;e;){u||(d=""),u=!1;let w;if((x=(h=this.options.extensions)==null?void 0:h.inline)!=null&&x.some(D=>(w=D.call({lexer:this},e,n))?(e=e.substring(w.raw.length),n.push(w),!0):!1))continue;if(w=this.tokenizer.escape(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.tag(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.link(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(w.raw.length);let D=n.at(-1);w.type==="text"&&(D==null?void 0:D.type)==="text"?(D.raw+=w.raw,D.text+=w.text):n.push(w);continue}if(w=this.tokenizer.emStrong(e,a,d)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.codespan(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.br(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.del(e,a,d)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.autolink(e)){e=e.substring(w.raw.length),n.push(w);continue}if(!this.state.inLink&&(w=this.tokenizer.url(e))){e=e.substring(w.raw.length),n.push(w);continue}let I=e;if((b=this.options.extensions)!=null&&b.startInline){let D=1/0,O=e.slice(1),ie;this.options.extensions.startInline.forEach(de=>{ie=de.call({lexer:this},O),typeof ie=="number"&&ie>=0&&(D=Math.min(D,ie))}),D<1/0&&D>=0&&(I=e.substring(0,D+1))}if(w=this.tokenizer.inlineText(I)){e=e.substring(w.raw.length),w.raw.slice(-1)!=="_"&&(d=w.raw.slice(-1)),u=!0;let D=n.at(-1);(D==null?void 0:D.type)==="text"?(D.raw+=w.raw,D.text+=w.text):n.push(w);continue}if(e){let D="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(D);break}else throw new Error(D)}}return n}},Ci=class{constructor(t){kt(this,"options");kt(this,"parser");this.options=t||La}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(On.notSpaceStart))==null?void 0:o[0],s=t.replace(On.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Lr(a)+'">'+(n?s:Lr(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:Lr(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let u=0;u<t.items.length;u++){let d=t.items[u];a+=this.listitem(d)}let s=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+s+o+`>
`+a+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let a="";for(let s=0;s<t.rows.length;s++){let o=t.rows[s];n="";for(let u=0;u<o.length;u++)n+=this.tablecell(o[u]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Lr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),s=Fc(t);if(s===null)return a;t=s;let o='<a href="'+t+'"';return e&&(o+=' title="'+Lr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=Fc(t);if(s===null)return Lr(n);t=s;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Lr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Lr(t.text)}},Ml=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},hr=class Zo{constructor(e){kt(this,"options");kt(this,"renderer");kt(this,"textRenderer");this.options=e||La,this.options.renderer=this.options.renderer||new Ci,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Ml}static parse(e,n){return new Zo(n).parse(e)}static parseInline(e,n){return new Zo(n).parseInline(e)}parse(e){var a,s;let n="";for(let o=0;o<e.length;o++){let u=e[o];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[u.type]){let g=u,_=this.options.extensions.renderers[g.type].call({parser:this},g);if(_!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(g.type)){n+=_||"";continue}}let d=u;switch(d.type){case"space":{n+=this.renderer.space(d);break}case"hr":{n+=this.renderer.hr(d);break}case"heading":{n+=this.renderer.heading(d);break}case"code":{n+=this.renderer.code(d);break}case"table":{n+=this.renderer.table(d);break}case"blockquote":{n+=this.renderer.blockquote(d);break}case"list":{n+=this.renderer.list(d);break}case"checkbox":{n+=this.renderer.checkbox(d);break}case"html":{n+=this.renderer.html(d);break}case"def":{n+=this.renderer.def(d);break}case"paragraph":{n+=this.renderer.paragraph(d);break}case"text":{n+=this.renderer.text(d);break}default:{let g='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return n}parseInline(e,n=this.renderer){var s,o;let a="";for(let u=0;u<e.length;u++){let d=e[u];if((o=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&o[d.type]){let _=this.options.extensions.renderers[d.type].call({parser:this},d);if(_!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){a+=_||"";continue}}let g=d;switch(g.type){case"escape":{a+=n.text(g);break}case"html":{a+=n.html(g);break}case"link":{a+=n.link(g);break}case"image":{a+=n.image(g);break}case"checkbox":{a+=n.checkbox(g);break}case"strong":{a+=n.strong(g);break}case"em":{a+=n.em(g);break}case"codespan":{a+=n.codespan(g);break}case"br":{a+=n.br(g);break}case"del":{a+=n.del(g);break}case"text":{a+=n.text(g);break}default:{let _='Token with "'+g.type+'" type was not found.';if(this.options.silent)return console.error(_),"";throw new Error(_)}}}return a}},mi,Ts=(mi=class{constructor(t){kt(this,"options");kt(this,"block");this.options=t||La}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?pr.lex:pr.lexInline}provideParser(){return this.block?hr.parse:hr.parseInline}},kt(mi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),kt(mi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),mi),ly=class{constructor(...t){kt(this,"defaults",El());kt(this,"options",this.setOptions);kt(this,"parse",this.parseMarkdown(!0));kt(this,"parseInline",this.parseMarkdown(!1));kt(this,"Parser",hr);kt(this,"Renderer",Ci);kt(this,"TextRenderer",Ml);kt(this,"Lexer",pr);kt(this,"Tokenizer",Ii);kt(this,"Hooks",Ts);this.use(...t)}walkTokens(t,e){var a,s;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let u=o;for(let d of u.header)n=n.concat(this.walkTokens(d.tokens,e));for(let d of u.rows)for(let g of d)n=n.concat(this.walkTokens(g.tokens,e));break}case"list":{let u=o;n=n.concat(this.walkTokens(u.items,e));break}default:{let u=o;(s=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&s[u.type]?this.defaults.extensions.childTokens[u.type].forEach(d=>{let g=u[d].flat(1/0);n=n.concat(this.walkTokens(g,e))}):u.tokens&&(n=n.concat(this.walkTokens(u.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=e.renderers[s.name];o?e.renderers[s.name]=function(...u){let d=s.renderer.apply(this,u);return d===!1&&(d=o.apply(this,u)),d}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),a.extensions=e),n.renderer){let s=this.defaults.renderer||new Ci(this.defaults);for(let o in n.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let u=o,d=n.renderer[u],g=s[u];s[u]=(..._)=>{let h=d.apply(s,_);return h===!1&&(h=g.apply(s,_)),h||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Ii(this.defaults);for(let o in n.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let u=o,d=n.tokenizer[u],g=s[u];s[u]=(..._)=>{let h=d.apply(s,_);return h===!1&&(h=g.apply(s,_)),h}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new Ts;for(let o in n.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let u=o,d=n.hooks[u],g=s[u];Ts.passThroughHooks.has(o)?s[u]=_=>{if(this.defaults.async&&Ts.passThroughHooksRespectAsync.has(o))return(async()=>{let x=await d.call(s,_);return g.call(s,x)})();let h=d.call(s,_);return g.call(s,h)}:s[u]=(..._)=>{if(this.defaults.async)return(async()=>{let x=await d.apply(s,_);return x===!1&&(x=await g.apply(s,_)),x})();let h=d.apply(s,_);return h===!1&&(h=g.apply(s,_)),h}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(u){let d=[];return d.push(o.call(this,u)),s&&(d=d.concat(s.call(this,u))),d}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return pr.lex(t,e??this.defaults)}parser(t,e){return hr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},s={...this.defaults,...a},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let u=s.hooks?await s.hooks.preprocess(e):e,d=await(s.hooks?await s.hooks.provideLexer():t?pr.lex:pr.lexInline)(u,s),g=s.hooks?await s.hooks.processAllTokens(d):d;s.walkTokens&&await Promise.all(this.walkTokens(g,s.walkTokens));let _=await(s.hooks?await s.hooks.provideParser():t?hr.parse:hr.parseInline)(g,s);return s.hooks?await s.hooks.postprocess(_):_})().catch(o);try{s.hooks&&(e=s.hooks.preprocess(e));let u=(s.hooks?s.hooks.provideLexer():t?pr.lex:pr.lexInline)(e,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let d=(s.hooks?s.hooks.provideParser():t?hr.parse:hr.parseInline)(u,s);return s.hooks&&(d=s.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Lr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},ja=new ly;function Ft(t,e){return ja.parse(t,e)}Ft.options=Ft.setOptions=function(t){return ja.setOptions(t),Ft.defaults=ja.defaults,Md(Ft.defaults),Ft};Ft.getDefaults=El;Ft.defaults=La;Ft.use=function(...t){return ja.use(...t),Ft.defaults=ja.defaults,Md(Ft.defaults),Ft};Ft.walkTokens=function(t,e){return ja.walkTokens(t,e)};Ft.parseInline=ja.parseInline;Ft.Parser=hr;Ft.parser=hr.parse;Ft.Renderer=Ci;Ft.TextRenderer=Ml;Ft.Lexer=pr;Ft.lexer=pr.lex;Ft.Tokenizer=Ii;Ft.Hooks=Ts;Ft.parse=Ft;Ft.options;Ft.setOptions;Ft.use;Ft.walkTokens;Ft.parseInline;hr.parse;pr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Hd,setPrototypeOf:Kc,isFrozen:cy,getPrototypeOf:uy,getOwnPropertyDescriptor:dy}=Object;let{freeze:Mn,seal:cr,create:Jo}=Object,{apply:$o,construct:el}=typeof Reflect<"u"&&Reflect;Mn||(Mn=function(e){return e});cr||(cr=function(e){return e});$o||($o=function(e,n){for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return e.apply(n,s)});el||(el=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return new e(...a)});const pi=jn(Array.prototype.forEach),vy=jn(Array.prototype.lastIndexOf),Gc=jn(Array.prototype.pop),bs=jn(Array.prototype.push),fy=jn(Array.prototype.splice),ki=jn(String.prototype.toLowerCase),Eo=jn(String.prototype.toString),To=jn(String.prototype.match),ws=jn(String.prototype.replace),py=jn(String.prototype.indexOf),hy=jn(String.prototype.trim),vr=jn(Object.prototype.hasOwnProperty),Pn=jn(RegExp.prototype.test),ks=my(TypeError);function jn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return $o(t,e,a)}}function my(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return el(t,n)}}function yt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ki;Kc&&Kc(t,null);let a=e.length;for(;a--;){let s=e[a];if(typeof s=="string"){const o=n(s);o!==s&&(cy(e)||(e[a]=o),s=o)}t[s]=!0}return t}function gy(t){for(let e=0;e<t.length;e++)vr(t,e)||(t[e]=null);return t}function Sr(t){const e=Jo(null);for(const[n,a]of Hd(t))vr(t,n)&&(Array.isArray(a)?e[n]=gy(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=Sr(a):e[n]=a);return e}function xs(t,e){for(;t!==null;){const a=dy(t,e);if(a){if(a.get)return jn(a.get);if(typeof a.value=="function")return jn(a.value)}t=uy(t)}function n(){return null}return n}const Hc=Mn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ao=Mn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Io=Mn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),_y=Mn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Co=Mn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),yy=Mn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Wc=Mn(["#text"]),Vc=Mn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Po=Mn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yc=Mn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),hi=Mn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),by=cr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),wy=cr(/<%[\w\W]*|[\w\W]*%>/gm),ky=cr(/\$\{[\w\W]*/gm),xy=cr(/^data-[\-\w.\u00B7-\uFFFF]+$/),Sy=cr(/^aria-[\-\w]+$/),Wd=cr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ey=cr(/^(?:\w+script|data):/i),Ty=cr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Vd=cr(/^html$/i),Ay=cr(/^[a-z][.\w]*(-[.\w]+)+$/i);var Qc=Object.freeze({__proto__:null,ARIA_ATTR:Sy,ATTR_WHITESPACE:Ty,CUSTOM_ELEMENT:Ay,DATA_ATTR:xy,DOCTYPE_NAME:Vd,ERB_EXPR:wy,IS_ALLOWED_URI:Wd,IS_SCRIPT_OR_DATA:Ey,MUSTACHE_EXPR:by,TMPLIT_EXPR:ky});const Ss={element:1,text:3,progressingInstruction:7,comment:8,document:9},Iy=function(){return typeof window>"u"?null:window},Cy=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(a=n.getAttribute(s));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Xc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Yd(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Iy();const e=Ye=>Yd(Ye);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Ss.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,s=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:d,Element:g,NodeFilter:_,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:x,DOMParser:b,trustedTypes:w}=t,I=g.prototype,D=xs(I,"cloneNode"),O=xs(I,"remove"),ie=xs(I,"nextSibling"),de=xs(I,"childNodes"),he=xs(I,"parentNode");if(typeof u=="function"){const Ye=n.createElement("template");Ye.content&&Ye.content.ownerDocument&&(n=Ye.content.ownerDocument)}let V,U="";const{implementation:q,createNodeIterator:P,createDocumentFragment:le,getElementsByTagName:ke}=n,{importNode:xe}=a;let we=Xc();e.isSupported=typeof Hd=="function"&&typeof he=="function"&&q&&q.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:J,ERB_EXPR:ge,TMPLIT_EXPR:Te,DATA_ATTR:ae,ARIA_ATTR:X,IS_SCRIPT_OR_DATA:me,ATTR_WHITESPACE:M,CUSTOM_ELEMENT:ee}=Qc;let{IS_ALLOWED_URI:fe}=Qc,pe=null;const oe=yt({},[...Hc,...Ao,...Io,...Co,...Wc]);let R=null;const Y=yt({},[...Vc,...Po,...Yc,...hi]);let re=Object.seal(Jo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),G=null,ve=null;const ye=Object.seal(Jo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let ne=!0,K=!0,Se=!1,ce=!0,Oe=!1,qe=!0,Ke=!1,ut=!1,wt=!1,Ze=!1,Be=!1,Fe=!1,He=!0,it=!1;const lt="user-content-";let et=!0,ct=!1,Ve={},ze=null;const mt=yt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ot=null;const Ht=yt({},["audio","video","img","source","image","track"]);let Kt=null;const dt=yt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Je="http://www.w3.org/1998/Math/MathML",ft="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let Me=at,Wt=!1,zt=null;const At=yt({},[Je,ft,at],Eo);let Ee=yt({},["mi","mo","mn","ms","mtext"]),Qt=yt({},["annotation-xml"]);const Dn=yt({},["title","style","font","a","script"]);let pn=null;const Cn=["application/xhtml+xml","text/html"],hn="text/html";let Pt=null,tn=null;const mn=n.createElement("form"),rt=function(L){return L instanceof RegExp||L instanceof Function},tt=function(){let L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(tn&&tn===L)){if((!L||typeof L!="object")&&(L={}),L=Sr(L),pn=Cn.indexOf(L.PARSER_MEDIA_TYPE)===-1?hn:L.PARSER_MEDIA_TYPE,Pt=pn==="application/xhtml+xml"?Eo:ki,pe=vr(L,"ALLOWED_TAGS")?yt({},L.ALLOWED_TAGS,Pt):oe,R=vr(L,"ALLOWED_ATTR")?yt({},L.ALLOWED_ATTR,Pt):Y,zt=vr(L,"ALLOWED_NAMESPACES")?yt({},L.ALLOWED_NAMESPACES,Eo):At,Kt=vr(L,"ADD_URI_SAFE_ATTR")?yt(Sr(dt),L.ADD_URI_SAFE_ATTR,Pt):dt,ot=vr(L,"ADD_DATA_URI_TAGS")?yt(Sr(Ht),L.ADD_DATA_URI_TAGS,Pt):Ht,ze=vr(L,"FORBID_CONTENTS")?yt({},L.FORBID_CONTENTS,Pt):mt,G=vr(L,"FORBID_TAGS")?yt({},L.FORBID_TAGS,Pt):Sr({}),ve=vr(L,"FORBID_ATTR")?yt({},L.FORBID_ATTR,Pt):Sr({}),Ve=vr(L,"USE_PROFILES")?L.USE_PROFILES:!1,ne=L.ALLOW_ARIA_ATTR!==!1,K=L.ALLOW_DATA_ATTR!==!1,Se=L.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=L.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Oe=L.SAFE_FOR_TEMPLATES||!1,qe=L.SAFE_FOR_XML!==!1,Ke=L.WHOLE_DOCUMENT||!1,Ze=L.RETURN_DOM||!1,Be=L.RETURN_DOM_FRAGMENT||!1,Fe=L.RETURN_TRUSTED_TYPE||!1,wt=L.FORCE_BODY||!1,He=L.SANITIZE_DOM!==!1,it=L.SANITIZE_NAMED_PROPS||!1,et=L.KEEP_CONTENT!==!1,ct=L.IN_PLACE||!1,fe=L.ALLOWED_URI_REGEXP||Wd,Me=L.NAMESPACE||at,Ee=L.MATHML_TEXT_INTEGRATION_POINTS||Ee,Qt=L.HTML_INTEGRATION_POINTS||Qt,re=L.CUSTOM_ELEMENT_HANDLING||{},L.CUSTOM_ELEMENT_HANDLING&&rt(L.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(re.tagNameCheck=L.CUSTOM_ELEMENT_HANDLING.tagNameCheck),L.CUSTOM_ELEMENT_HANDLING&&rt(L.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(re.attributeNameCheck=L.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),L.CUSTOM_ELEMENT_HANDLING&&typeof L.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(re.allowCustomizedBuiltInElements=L.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Oe&&(K=!1),Be&&(Ze=!0),Ve&&(pe=yt({},Wc),R=[],Ve.html===!0&&(yt(pe,Hc),yt(R,Vc)),Ve.svg===!0&&(yt(pe,Ao),yt(R,Po),yt(R,hi)),Ve.svgFilters===!0&&(yt(pe,Io),yt(R,Po),yt(R,hi)),Ve.mathMl===!0&&(yt(pe,Co),yt(R,Yc),yt(R,hi))),L.ADD_TAGS&&(typeof L.ADD_TAGS=="function"?ye.tagCheck=L.ADD_TAGS:(pe===oe&&(pe=Sr(pe)),yt(pe,L.ADD_TAGS,Pt))),L.ADD_ATTR&&(typeof L.ADD_ATTR=="function"?ye.attributeCheck=L.ADD_ATTR:(R===Y&&(R=Sr(R)),yt(R,L.ADD_ATTR,Pt))),L.ADD_URI_SAFE_ATTR&&yt(Kt,L.ADD_URI_SAFE_ATTR,Pt),L.FORBID_CONTENTS&&(ze===mt&&(ze=Sr(ze)),yt(ze,L.FORBID_CONTENTS,Pt)),L.ADD_FORBID_CONTENTS&&(ze===mt&&(ze=Sr(ze)),yt(ze,L.ADD_FORBID_CONTENTS,Pt)),et&&(pe["#text"]=!0),Ke&&yt(pe,["html","head","body"]),pe.table&&(yt(pe,["tbody"]),delete G.tbody),L.TRUSTED_TYPES_POLICY){if(typeof L.TRUSTED_TYPES_POLICY.createHTML!="function")throw ks('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof L.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ks('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');V=L.TRUSTED_TYPES_POLICY,U=V.createHTML("")}else V===void 0&&(V=Cy(w,s)),V!==null&&typeof U=="string"&&(U=V.createHTML(""));Mn&&Mn(L),tn=L}},Ot=yt({},[...Ao,...Io,..._y]),Xe=yt({},[...Co,...yy]),vt=function(L){let Ce=he(L);(!Ce||!Ce.tagName)&&(Ce={namespaceURI:Me,tagName:"template"});const je=ki(L.tagName),Mt=ki(Ce.tagName);return zt[L.namespaceURI]?L.namespaceURI===ft?Ce.namespaceURI===at?je==="svg":Ce.namespaceURI===Je?je==="svg"&&(Mt==="annotation-xml"||Ee[Mt]):!!Ot[je]:L.namespaceURI===Je?Ce.namespaceURI===at?je==="math":Ce.namespaceURI===ft?je==="math"&&Qt[Mt]:!!Xe[je]:L.namespaceURI===at?Ce.namespaceURI===ft&&!Qt[Mt]||Ce.namespaceURI===Je&&!Ee[Mt]?!1:!Xe[je]&&(Dn[je]||!Ot[je]):!!(pn==="application/xhtml+xml"&&zt[L.namespaceURI]):!1},Gt=function(L){bs(e.removed,{element:L});try{he(L).removeChild(L)}catch{O(L)}},Jt=function(L,Ce){try{bs(e.removed,{attribute:Ce.getAttributeNode(L),from:Ce})}catch{bs(e.removed,{attribute:null,from:Ce})}if(Ce.removeAttribute(L),L==="is")if(Ze||Be)try{Gt(Ce)}catch{}else try{Ce.setAttribute(L,"")}catch{}},an=function(L){let Ce=null,je=null;if(wt)L="<remove></remove>"+L;else{const nn=To(L,/^[\r\n\t ]+/);je=nn&&nn[0]}pn==="application/xhtml+xml"&&Me===at&&(L='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+L+"</body></html>");const Mt=V?V.createHTML(L):L;if(Me===at)try{Ce=new b().parseFromString(Mt,pn)}catch{}if(!Ce||!Ce.documentElement){Ce=q.createDocument(Me,"template",null);try{Ce.documentElement.innerHTML=Wt?U:Mt}catch{}}const Xt=Ce.body||Ce.documentElement;return L&&je&&Xt.insertBefore(n.createTextNode(je),Xt.childNodes[0]||null),Me===at?ke.call(Ce,Ke?"html":"body")[0]:Ke?Ce.documentElement:Xt},Et=function(L){return P.call(L.ownerDocument||L,L,_.SHOW_ELEMENT|_.SHOW_COMMENT|_.SHOW_TEXT|_.SHOW_PROCESSING_INSTRUCTION|_.SHOW_CDATA_SECTION,null)},Vt=function(L){return L instanceof x&&(typeof L.nodeName!="string"||typeof L.textContent!="string"||typeof L.removeChild!="function"||!(L.attributes instanceof h)||typeof L.removeAttribute!="function"||typeof L.setAttribute!="function"||typeof L.namespaceURI!="string"||typeof L.insertBefore!="function"||typeof L.hasChildNodes!="function")},sn=function(L){return typeof d=="function"&&L instanceof d};function Rt(Ye,L,Ce){pi(Ye,je=>{je.call(e,L,Ce,tn)})}const on=function(L){let Ce=null;if(Rt(we.beforeSanitizeElements,L,null),Vt(L))return Gt(L),!0;const je=Pt(L.nodeName);if(Rt(we.uponSanitizeElement,L,{tagName:je,allowedTags:pe}),qe&&L.hasChildNodes()&&!sn(L.firstElementChild)&&Pn(/<[/\w!]/g,L.innerHTML)&&Pn(/<[/\w!]/g,L.textContent)||L.nodeType===Ss.progressingInstruction||qe&&L.nodeType===Ss.comment&&Pn(/<[/\w]/g,L.data))return Gt(L),!0;if(!(ye.tagCheck instanceof Function&&ye.tagCheck(je))&&(!pe[je]||G[je])){if(!G[je]&&br(je)&&(re.tagNameCheck instanceof RegExp&&Pn(re.tagNameCheck,je)||re.tagNameCheck instanceof Function&&re.tagNameCheck(je)))return!1;if(et&&!ze[je]){const Mt=he(L)||L.parentNode,Xt=de(L)||L.childNodes;if(Xt&&Mt){const nn=Xt.length;for(let cn=nn-1;cn>=0;--cn){const qn=D(Xt[cn],!0);qn.__removalCount=(L.__removalCount||0)+1,Mt.insertBefore(qn,ie(L))}}}return Gt(L),!0}return L instanceof g&&!vt(L)||(je==="noscript"||je==="noembed"||je==="noframes")&&Pn(/<\/no(script|embed|frames)/i,L.innerHTML)?(Gt(L),!0):(Oe&&L.nodeType===Ss.text&&(Ce=L.textContent,pi([J,ge,Te],Mt=>{Ce=ws(Ce,Mt," ")}),L.textContent!==Ce&&(bs(e.removed,{element:L.cloneNode()}),L.textContent=Ce)),Rt(we.afterSanitizeElements,L,null),!1)},Ln=function(L,Ce,je){if(He&&(Ce==="id"||Ce==="name")&&(je in n||je in mn))return!1;if(!(K&&!ve[Ce]&&Pn(ae,Ce))){if(!(ne&&Pn(X,Ce))){if(!(ye.attributeCheck instanceof Function&&ye.attributeCheck(Ce,L))){if(!R[Ce]||ve[Ce]){if(!(br(L)&&(re.tagNameCheck instanceof RegExp&&Pn(re.tagNameCheck,L)||re.tagNameCheck instanceof Function&&re.tagNameCheck(L))&&(re.attributeNameCheck instanceof RegExp&&Pn(re.attributeNameCheck,Ce)||re.attributeNameCheck instanceof Function&&re.attributeNameCheck(Ce,L))||Ce==="is"&&re.allowCustomizedBuiltInElements&&(re.tagNameCheck instanceof RegExp&&Pn(re.tagNameCheck,je)||re.tagNameCheck instanceof Function&&re.tagNameCheck(je))))return!1}else if(!Kt[Ce]){if(!Pn(fe,ws(je,M,""))){if(!((Ce==="src"||Ce==="xlink:href"||Ce==="href")&&L!=="script"&&py(je,"data:")===0&&ot[L])){if(!(Se&&!Pn(me,ws(je,M,"")))){if(je)return!1}}}}}}}return!0},br=function(L){return L!=="annotation-xml"&&To(L,ee)},Nn=function(L){Rt(we.beforeSanitizeAttributes,L,null);const{attributes:Ce}=L;if(!Ce||Vt(L))return;const je={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:R,forceKeepAttr:void 0};let Mt=Ce.length;for(;Mt--;){const Xt=Ce[Mt],{name:nn,namespaceURI:cn,value:qn}=Xt,wr=Pt(nn),la=qn;let $t=nn==="value"?la:hy(la);if(je.attrName=wr,je.attrValue=$t,je.keepAttr=!0,je.forceKeepAttr=void 0,Rt(we.uponSanitizeAttribute,L,je),$t=je.attrValue,it&&(wr==="id"||wr==="name")&&(Jt(nn,L),$t=lt+$t),qe&&Pn(/((--!?|])>)|<\/(style|title|textarea)/i,$t)){Jt(nn,L);continue}if(wr==="attributename"&&To($t,"href")){Jt(nn,L);continue}if(je.forceKeepAttr)continue;if(!je.keepAttr){Jt(nn,L);continue}if(!ce&&Pn(/\/>/i,$t)){Jt(nn,L);continue}Oe&&pi([J,ge,Te],ca=>{$t=ws($t,ca," ")});const os=Pt(L.nodeName);if(!Ln(os,wr,$t)){Jt(nn,L);continue}if(V&&typeof w=="object"&&typeof w.getAttributeType=="function"&&!cn)switch(w.getAttributeType(os,wr)){case"TrustedHTML":{$t=V.createHTML($t);break}case"TrustedScriptURL":{$t=V.createScriptURL($t);break}}if($t!==la)try{cn?L.setAttributeNS(cn,nn,$t):L.setAttribute(nn,$t),Vt(L)?Gt(L):Gc(e.removed)}catch{Jt(nn,L)}}Rt(we.afterSanitizeAttributes,L,null)},Na=function Ye(L){let Ce=null;const je=Et(L);for(Rt(we.beforeSanitizeShadowDOM,L,null);Ce=je.nextNode();)Rt(we.uponSanitizeShadowNode,Ce,null),on(Ce),Nn(Ce),Ce.content instanceof o&&Ye(Ce.content);Rt(we.afterSanitizeShadowDOM,L,null)};return e.sanitize=function(Ye){let L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ce=null,je=null,Mt=null,Xt=null;if(Wt=!Ye,Wt&&(Ye="<!-->"),typeof Ye!="string"&&!sn(Ye))if(typeof Ye.toString=="function"){if(Ye=Ye.toString(),typeof Ye!="string")throw ks("dirty is not a string, aborting")}else throw ks("toString is not a function");if(!e.isSupported)return Ye;if(ut||tt(L),e.removed=[],typeof Ye=="string"&&(ct=!1),ct){if(Ye.nodeName){const qn=Pt(Ye.nodeName);if(!pe[qn]||G[qn])throw ks("root node is forbidden and cannot be sanitized in-place")}}else if(Ye instanceof d)Ce=an("<!---->"),je=Ce.ownerDocument.importNode(Ye,!0),je.nodeType===Ss.element&&je.nodeName==="BODY"||je.nodeName==="HTML"?Ce=je:Ce.appendChild(je);else{if(!Ze&&!Oe&&!Ke&&Ye.indexOf("<")===-1)return V&&Fe?V.createHTML(Ye):Ye;if(Ce=an(Ye),!Ce)return Ze?null:Fe?U:""}Ce&&wt&&Gt(Ce.firstChild);const nn=Et(ct?Ye:Ce);for(;Mt=nn.nextNode();)on(Mt),Nn(Mt),Mt.content instanceof o&&Na(Mt.content);if(ct)return Ye;if(Ze){if(Be)for(Xt=le.call(Ce.ownerDocument);Ce.firstChild;)Xt.appendChild(Ce.firstChild);else Xt=Ce;return(R.shadowroot||R.shadowrootmode)&&(Xt=xe.call(a,Xt,!0)),Xt}let cn=Ke?Ce.outerHTML:Ce.innerHTML;return Ke&&pe["!doctype"]&&Ce.ownerDocument&&Ce.ownerDocument.doctype&&Ce.ownerDocument.doctype.name&&Pn(Vd,Ce.ownerDocument.doctype.name)&&(cn="<!DOCTYPE "+Ce.ownerDocument.doctype.name+`>
`+cn),Oe&&pi([J,ge,Te],qn=>{cn=ws(cn,qn," ")}),V&&Fe?V.createHTML(cn):cn},e.setConfig=function(){let Ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};tt(Ye),ut=!0},e.clearConfig=function(){tn=null,ut=!1},e.isValidAttribute=function(Ye,L,Ce){tn||tt({});const je=Pt(Ye),Mt=Pt(L);return Ln(je,Mt,Ce)},e.addHook=function(Ye,L){typeof L=="function"&&bs(we[Ye],L)},e.removeHook=function(Ye,L){if(L!==void 0){const Ce=vy(we[Ye],L);return Ce===-1?void 0:fy(we[Ye],Ce,1)[0]}return Gc(we[Ye])},e.removeHooks=function(Ye){we[Ye]=[]},e.removeAllHooks=function(){we=Xc()},e}var Py=Yd();function Oy(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Zc(t.from)} |`),e.push(`| **To** | ${Zc(t.to)} |`),e.push(`| **Date** | ${bl(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?Ry(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Zc(t){return(t||"").replace(/\|/g,"\\|")}function Ry(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return tl(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function My(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const s=e.toLowerCase();return s.includes("spacer")||s.includes("transparent")||s.includes("transp.gif")||s.includes("/track")&&s.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(s)?!0:s.includes("mail.google.com/mail/u/")&&s.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(s)||s.endsWith(".gif")&&s.includes("1x1"))}function tl(t){var s;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",u=t.getAttribute("alt")||"";return My(t,o)?"":`![${u}](${o})`}const n=Array.from(t.childNodes).map(tl).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((s=t.parentElement)==null?void 0:s.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(u=>tl(u).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),u=(o.match(/\|/g)||[]).length-1,d="| "+Array(Math.max(u,1)).fill("---").join(" | ")+" |";return`${o}${d}
`}return n}function jy(t){return od(t,"md")}function Jc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function Dy(t){return t.raw||null}function Ly(t){const e=Dy(t);return e?JSON.stringify(e,null,2):"null"}function Ny(t){return od(t,"json")}var qy=T('<button title="View as Markdown">.md</button>'),By=T('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),Fy=T('<pre class="md-raw svelte-1b0rzpb"> </pre>'),zy=T('<div class="md-preview svelte-1b0rzpb"><!></div>'),Uy=T('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),Ky=T('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),Gy=T('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),Hy=T('<pre class="message-text svelte-1b0rzpb"> </pre>'),Wy=T('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),Vy=T('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),Yy=T('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function Qy(t,e){Nt(e,!0);let n=De(e,"loading",3,!1);En(()=>$n("MessageModal"));const a=new Ft.Renderer;a.link=({href:J,title:ge,text:Te})=>{const ae=ge?` title="${ge}"`:"";return`<a href="${J}"${ae} target="_blank" rel="noopener">${Te}</a>`},Ft.setOptions({breaks:!0,gfm:!0,renderer:a});let s=Pe("email"),o=st(()=>e.message.body?Oy(e.message):""),u=st(()=>Ly(e.message)),d=Pe("raw");function g(J){A(s,l(s)===J?"email":J,!0),J==="markdown"&&A(d,"raw")}function _(){Jc(l(o),jy(e.message))}function h(){Jc(l(u),Ny(e.message),"application/json;charset=utf-8")}function x(J){const ge=Ft.parse(J);return Py.sanitize(ge,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let b=Pe(null);Oa(()=>{var J;if(l(b)&&e.message.htmlBody&&!n()&&l(s)==="email"){const ge=l(b).contentDocument||((J=l(b).contentWindow)==null?void 0:J.document);ge&&(ge.open(),ge.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),ge.close())}});var w=Yy();w.__click=function(...J){var ge;(ge=e.onclose)==null||ge.apply(this,J)};var I=f(w);I.__click=J=>J.stopPropagation();var D=f(I),O=f(D),ie=f(O),de=m(O,2),he=f(de);let V;he.__click=()=>g("json");var U=m(he,2);{var q=J=>{var ge=qy();let Te;ge.__click=()=>g("markdown"),Q(()=>Te=Bt(ge,1,"action-btn svelte-1b0rzpb",null,Te,{active:l(s)==="markdown"})),S(J,ge)};Z(U,J=>{e.message.body&&J(q)})}var P=m(U,2);P.__click=function(...J){var ge;(ge=e.onclose)==null||ge.apply(this,J)};var le=m(D,2);{var ke=J=>{var ge=By(),Te=$e(ge),ae=m(f(Te),2);ae.__click=h;var X=m(Te,2),me=f(X),M=f(me);Q(()=>C(M,l(u))),S(J,ge)},xe=J=>{var ge=Uy(),Te=$e(ge),ae=f(Te),X=f(ae);let me;X.__click=()=>A(d,"raw");var M=m(X,2);let ee;M.__click=()=>A(d,"preview");var fe=m(ae,2);fe.__click=_;var pe=m(Te,2),oe=f(pe);{var R=re=>{var G=Fy(),ve=f(G);Q(()=>C(ve,l(o))),S(re,G)},Y=re=>{var G=zy(),ve=f(G);Ff(ve,()=>x(l(o))),S(re,G)};Z(oe,re=>{l(d)==="raw"?re(R):re(Y,!1)})}Q(()=>{me=Bt(X,1,"md-tab svelte-1b0rzpb",null,me,{active:l(d)==="raw"}),ee=Bt(M,1,"md-tab svelte-1b0rzpb",null,ee,{active:l(d)==="preview"})}),S(J,ge)},we=J=>{var ge=Vy(),Te=$e(ge),ae=f(Te),X=m(f(ae),2),me=f(X),M=m(ae,2),ee=m(f(M),2),fe=f(ee),pe=m(M,2),oe=m(f(pe),2),R=f(oe),Y=m(Te,2),re=f(Y);{var G=K=>{var Se=Ky();S(K,Se)},ve=K=>{var Se=Gy();Ju(Se,ce=>A(b,ce),()=>l(b)),S(K,Se)},ye=K=>{var Se=Hy(),ce=f(Se);Q(()=>C(ce,e.message.body)),S(K,Se)},ne=K=>{var Se=Wy();S(K,Se)};Z(re,K=>{n()?K(G):e.message.htmlBody?K(ve,1):e.message.body?K(ye,2):K(ne,!1)})}Q(K=>{C(me,e.message.from),C(fe,e.message.to),C(R,K)},[()=>bl(e.message.date)]),S(J,ge)};Z(le,J=>{l(s)==="json"?J(ke):l(s)==="markdown"?J(xe,1):J(we,!1)})}Q(()=>{C(ie,e.message.subject),V=Bt(he,1,"action-btn svelte-1b0rzpb",null,V,{active:l(s)==="json"})}),S(t,w),qt()}en(["click"]);var Xy=T('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),Zy=T('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),Jy=T('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),$y=T("<p> </p>"),eb=T('<p>No emails in local storage. Click "Sync New" to download.</p>'),tb=T('<div class="empty-state svelte-6ts5xm"><!></div>'),nb=T('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),rb=T('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function ab(t,e){Nt(e,!0),En(()=>$n("DashboardView"));let n=De(e,"error",3,null),a=De(e,"profile",3,null),s=De(e,"loadingProfile",3,!1),o=De(e,"emailMessages",19,()=>[]),u=De(e,"totalLocalMessages",3,0),d=De(e,"hasMoreLocal",3,!1),g=De(e,"loadingMessages",3,!1),_=De(e,"selectedMessage",3,null),h=De(e,"syncStatus",3,null),x=De(e,"syncProgress",3,null),b=De(e,"isSyncing",3,!1),w=De(e,"searchQuery",15);var I=rb(),D=$e(I),O=f(D);{var ie=ae=>{Rd(ae,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};Z(O,ae=>{n()&&ae(ie)})}var de=m(O,2);r_(de,{get profile(){return a()},get loadingProfile(){return s()},get onsignout(){return e.onsignout}});var he=m(de,2);m_(he,{get syncStatus(){return h()},get syncProgress(){return x()},get isSyncing(){return b()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var V=m(he,2),U=f(V);U.__keydown=ae=>ae.key==="Enter"&&e.onsearch();var q=m(U,2);q.__click=function(...ae){var X;(X=e.onsearch)==null||X.apply(this,ae)};var P=f(q),le=m(V,2);{var ke=ae=>{var X=Zy(),me=$e(X),M=f(me),ee=f(M),fe=m(me,2);y_(fe,{get messages(){return o()},get onselect(){return e.onviewmessage}});var pe=m(fe,2);{var oe=R=>{var Y=Xy(),re=f(Y);re.__click=function(...ve){var ye;(ye=e.onloadmore)==null||ye.apply(this,ve)};var G=f(re);Q(()=>{re.disabled=g(),C(G,g()?"Loading...":"Load More")}),S(R,Y)};Z(pe,R=>{d()&&R(oe)})}Q(R=>C(ee,`Showing ${o().length??""} of ${R??""}
        ${w()?" matching":""} emails`),[()=>u().toLocaleString()]),S(ae,X)},xe=ae=>{var X=Jy();S(ae,X)},we=ae=>{var X=tb(),me=f(X);{var M=fe=>{var pe=$y(),oe=f(pe);Q(()=>C(oe,`No emails match "${w()??""}".`)),S(fe,pe)},ee=fe=>{var pe=eb();S(fe,pe)};Z(me,fe=>{w()?fe(M):fe(ee,!1)})}S(ae,X)},J=ae=>{var X=nb();S(ae,X)};Z(le,ae=>{var X;o().length>0?ae(ke):g()?ae(xe,1):(X=h())!=null&&X.synced?ae(we,2):ae(J,!1)})}var ge=m(D,2);{var Te=ae=>{Qy(ae,{get message(){return _()},loading:!1,get onclose(){return e.onclosedetail}})};Z(ge,ae=>{_()&&ae(Te)})}Q(()=>{q.disabled=g(),C(P,g()?"Searching...":"Search")}),Ur(U,w),S(t,I),qt()}en(["keydown","click"]);var sb=T('<div class="dashboard svelte-1q5o2lv"><!></div>');function ib(t,e){Nt(e,!0);function n(ce){ce.key==="Escape"&&l(b)&&oe()}let a=null;En(async()=>{if(window.addEventListener("keydown",n),!l(d)){const ce=await js("googleClientId");A(d,ce||u,!0),A(g,ce||u,!0)}return()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}});function s(){a&&clearTimeout(a);const ce=lm();if(ce<=0)return;const Oe=Math.max(0,ce-120*1e3);a=setTimeout(async()=>{try{const qe=await jc();A(h,qe.access_token,!0),s()}catch{A(h,null),A(x,null),A(V,"Session expired. Please sign in again.")}},Oe)}async function o(){if(om())return l(h);try{const ce=await jc();return A(h,ce.access_token,!0),s(),l(h)}catch{return A(h,null),A(x,null),A(V,"Session expired. Please sign in again."),null}}const u="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let d=Pe(Yt(u)),g=Pe(Yt(u)),_=Pe(!1),h=Pe(null),x=Pe(null),b=Pe(null),w=Pe(""),I=Pe(Yt([])),D=Pe(0),O=Pe(0),ie=Pe(!1),de=Pe(!1),he=Pe(!1),V=Pe(null),U=Pe(null),q=Pe(null),P=Pe(!1);const le=50;Oa(()=>{l(h)&&(R(),M())});let ke=st(()=>!l(d)),xe=st(()=>l(d)===u),we=st(()=>!!l(h)),J=st(()=>l(I).length<l(D));Oa(()=>{l(d)&&!l(_)&&Dc(l(d)).then(async()=>{if(A(_,!0),!l(h)){const ce=await zi();ce&&(A(h,ce.access_token,!0),s(),me())}}).catch(ce=>{A(V,`Auth init failed: ${ce.message}`)})});async function ge(){const ce=l(g).trim();ce&&(await Ds("googleClientId",ce),A(d,ce,!0),A(V,null))}async function Te(){await ml("googleClientId"),A(d,""),A(g,u),A(_,!1),A(h,null),A(x,null),A(I,[],!0),A(D,0)}async function ae(){A(V,null),A(de,!0);try{l(_)||(await Dc(l(d)),A(_,!0));const ce=await um();A(h,ce.access_token,!0),s(),await me()}catch(ce){A(V,ce.message,!0)}finally{A(de,!1)}}async function X(){if(a&&clearTimeout(a),l(h))try{await dm(l(h))}catch{}A(h,null),A(x,null),A(I,[],!0),A(D,0),A(b,null),A(V,null)}async function me(){A(he,!0);try{const ce=await nd(l(h));if(!l(h))return;A(x,ce,!0)}catch(ce){if(!l(h))return;A(V,`Profile fetch failed: ${ce.message}`)}finally{A(he,!1)}}async function M(ce=!1){A(ie,!0);try{const Oe=ce?l(O):0,qe=await Ip({query:l(w)||void 0,limit:le,offset:Oe});ce?A(I,[...l(I),...qe.items],!0):A(I,qe.items,!0),A(D,qe.total,!0),A(O,l(I).length,!0)}catch(Oe){A(V,`Failed to load messages: ${Oe.message}`)}finally{A(ie,!1)}}function ee(){A(O,0),M(!1)}function fe(){M(!0)}function pe(ce){A(b,ce,!0)}function oe(){A(b,null)}async function R(){try{A(U,await Rg(),!0)}catch{}}async function Y(ce){if(l(P)||!l(h))return;const Oe=await o();if(!Oe)return;A(V,null),A(P,!0),A(q,null);const qe=new AbortController;try{await Pg(Oe,{limit:ce,onProgress:Ke=>{A(q,{...Ke},!0)},signal:qe.signal}),await R(),await M(!1)}catch(Ke){if(Ke.name!=="AbortError"){if(!l(h))return;A(V,`Sync failed: ${Ke.message}`)}}finally{A(P,!1)}}async function re(ce){if(l(P)||!l(h))return;const Oe=await o();if(!Oe)return;A(V,null),A(P,!0),A(q,null);const qe=new AbortController;try{await Og(Oe,{limit:ce,onProgress:Ke=>{A(q,{...Ke},!0)},signal:qe.signal}),await R(),await M(!1)}catch(Ke){if(Ke.name!=="AbortError"){if(!l(h))return;A(V,`Sync more failed: ${Ke.message}`)}}finally{A(P,!1)}}async function G(){try{await Id(),await R(),A(I,[],!0),A(D,0),A(O,0)}catch(ce){A(V,`Failed to clear data: ${ce.message}`)}}var ve=sb(),ye=f(ve);{var ne=ce=>{Fg(ce,{onsave:ge,defaultClientId:u,get clientIdInput(){return l(g)},set clientIdInput(Oe){A(g,Oe,!0)}})},K=ce=>{$g(ce,{get clientId(){return l(d)},get isDefaultClientId(){return l(xe)},get error(){return l(V)},get loadingAuth(){return l(de)},onsignin:ae,onclear:Te,onsignout:X})},Se=ce=>{ab(ce,{get error(){return l(V)},get profile(){return l(x)},get loadingProfile(){return l(he)},get emailMessages(){return l(I)},get totalLocalMessages(){return l(D)},get hasMoreLocal(){return l(J)},get loadingMessages(){return l(ie)},get selectedMessage(){return l(b)},get syncStatus(){return l(U)},get syncProgress(){return l(q)},get isSyncing(){return l(P)},onsignout:X,onsearch:ee,onloadmore:fe,onviewmessage:pe,onclosedetail:oe,ondismisserror:()=>A(V,null),onsync:Y,onsyncmore:re,oncleardata:G,get searchQuery(){return l(w)},set searchQuery(Oe){A(w,Oe,!0)}})};Z(ye,ce=>{l(ke)?ce(ne):l(we)?ce(Se,!1):ce(K,1)})}S(t,ve),qt()}var ob=T('<span class="err svelte-t1ig66"> </span>'),lb=T('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),cb=T('<span class="stream-stats svelte-t1ig66"> </span>'),ub=T('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),db=T('<span class="ei-group svelte-t1ig66"> </span>'),vb=T('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),fb=T('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),pb=T('<span class="sep svelte-t1ig66">Â·</span> ',1),hb=T('<div class="ei-summary svelte-t1ig66"> </div>'),mb=T('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),gb=T('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),_b=T("<!> <!> <!>",1),yb=T('<div class="ei-error svelte-t1ig66"> </div>'),bb=T('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),wb=T('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),kb=T('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),xb=T('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Sb=T(' <span class="sep svelte-t1ig66">Â·</span>',1),Eb=T('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Tb=T('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Ab=T('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),Ib=T('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function Cb(t,e){Nt(e,!0);let n=De(e,"progress",3,null);function a(b){return!b||b<0?"â":b<1e3?`${Math.round(b)}ms`:`${(b/1e3).toFixed(1)}s`}function s(b){return b?b>=1e3?`${(b/1e3).toFixed(1)}k`:String(b):"0"}function o(b){if(!b)return"â";const w=b.replace(/<.*>/,"").trim();return w.length>30?w.slice(0,28)+"â¦":w}function u(b){if(!b)return"";try{return new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let d=st(()=>{var b;return(b=n())!=null&&b.total?Math.round(n().current/n().total*100):0}),g=st(()=>{var b;return((b=n())==null?void 0:b.phase)==="done"});var _=Rn(),h=$e(_);{var x=b=>{var w=Ib(),I=f(w),D=f(I),O=f(D);{var ie=oe=>{var R=fn();Q(()=>C(R,`Scan complete â ${(n().classified||0)??""} classified`)),S(oe,R)},de=oe=>{var R=fn("Loading emailsâ¦");S(oe,R)},he=oe=>{var R=fn();Q(()=>C(R,`Processing ${n().current??0??""} / ${n().total??0??""}`)),S(oe,R)};Z(O,oe=>{l(g)?oe(ie):n().phase==="loading"?oe(de,1):oe(he,!1)})}var V=m(D,2),U=f(V),q=m(I,2),P=f(q);let le,ke;var xe=m(q,2);{var we=oe=>{var R=lb(),Y=f(R),re=m(Y);{var G=ne=>{var K=ob(),Se=f(K);Q(()=>C(Se,`Â· ${n().errors??""} errors`)),S(ne,K)};Z(re,ne=>{n().errors&&ne(G)})}var ve=m(re,3),ye=m(ve,2);Q((ne,K,Se)=>{C(Y,`${(n().classified||0)??""} classified `),C(ve,` ${ne??""} in + ${K??""} out `),C(ye,` ${Se??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),S(oe,R)};Z(xe,oe=>{n().totals&&!l(g)&&oe(we)})}var J=m(xe,2);{var ge=oe=>{var R=ub(),Y=f(R),re=f(Y),G=f(re),ve=m(re,2);{var ye=Se=>{var ce=cb(),Oe=f(ce);Q(qe=>C(Oe,`${qe??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),S(Se,ce)};Z(ve,Se=>{var ce;(ce=n().live)!=null&&ce.tps&&Se(ye)})}var ne=m(Y,2),K=f(ne);Q(()=>{C(G,n().email.subject||"(no subject)"),C(K,n().streamingText||"Waiting for modelâ¦")}),S(oe,R)};Z(J,oe=>{!l(g)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&oe(ge)})}var Te=m(J,2);{var ae=oe=>{var R=wb(),Y=f(R),re=m(f(Y),2),G=f(re),ve=m(Y,2);bt(ve,17,()=>n().results,Lt,(ye,ne,K)=>{var Se=bb();let ce;var Oe=f(Se),qe=f(Oe);qe.textContent=`${K+1}.`;var Ke=m(qe,2),ut=f(Ke),wt=m(Ke,2);{var Ze=ze=>{var mt=vb(),ot=$e(mt),Ht=f(ot),Kt=m(ot,2);{var dt=Je=>{const ft=st(()=>Hr[l(ne).classification.group]);var at=Rn(),Me=$e(at);{var Wt=zt=>{var At=db();let Ee;var Qt=f(At);Q(()=>{sr(At,"title",l(ft).description),Ee=vn(At,"",Ee,{color:l(ft).color}),C(Qt,l(ft).label)}),S(zt,At)};Z(Me,zt=>{l(ft)&&zt(Wt)})}S(Je,at)};Z(Kt,Je=>{l(ne).classification.group&&Je(dt)})}Q(()=>C(Ht,l(ne).classification.action)),S(ze,mt)},Be=ze=>{var mt=fb();S(ze,mt)};Z(wt,ze=>{l(ne).success?ze(Ze):ze(Be,!1)})}var Fe=m(Oe,2),He=f(Fe),it=m(He);{var lt=ze=>{var mt=pb(),ot=m($e(mt),1,!0);Q(Ht=>C(ot,Ht),[()=>u(l(ne).email.date)]),S(ze,mt)};Z(it,ze=>{l(ne).email.date&&ze(lt)})}var et=m(Fe,2);{var ct=ze=>{var mt=_b(),ot=$e(mt);{var Ht=at=>{var Me=hb(),Wt=f(Me);Q(()=>C(Wt,l(ne).classification.summary)),S(at,Me)};Z(ot,at=>{l(ne).classification.summary&&at(Ht)})}var Kt=m(ot,2);{var dt=at=>{var Me=mb(),Wt=f(Me),zt=m(Wt,2),At=m(zt,2);Q((Ee,Qt)=>{C(Wt,`${Ee??""} `),C(zt,` ${(l(ne).stats.inputTokens||0)??""} in + ${(l(ne).stats.numTokens||0)??""} out `),C(At,` ${Qt??""}`)},[()=>l(ne).stats.tps?`${l(ne).stats.tps.toFixed(0)} tok/s`:"â",()=>a(l(ne).stats.elapsed)]),S(at,Me)};Z(Kt,at=>{l(ne).stats&&at(dt)})}var Je=m(Kt,2);{var ft=at=>{var Me=gb(),Wt=m(f(Me),2),zt=f(Wt);Q(()=>C(zt,l(ne).rawResponse)),S(at,Me)};Z(Je,at=>{l(ne).rawResponse&&at(ft)})}S(ze,mt)},Ve=ze=>{var mt=yb(),ot=f(mt);Q(()=>C(ot,l(ne).error)),S(ze,mt)};Z(et,ze=>{l(ne).success?ze(ct):ze(Ve,!1)})}Q(ze=>{ce=Bt(Se,1,"email-item svelte-t1ig66",null,ce,{failed:!l(ne).success}),C(ut,l(ne).email.subject||"(no subject)"),C(He,ze)},[()=>o(l(ne).email.from)]),S(ye,Se)}),Q(()=>C(G,n().results.length)),S(oe,R)};Z(Te,oe=>{var R;((R=n().results)==null?void 0:R.length)>0&&oe(ae)})}var X=m(Te,2);{var me=oe=>{var R=Eb(),Y=f(R),re=f(Y),G=f(re),ve=m(re,4),ye=f(ve),ne=m(ve,2);{var K=Be=>{var Fe=kb(),He=m($e(Fe)),it=f(He);Q(()=>C(it,`${n().errors??""} errors`)),S(Be,Fe)};Z(ne,Be=>{n().errors>0&&Be(K)})}var Se=m(ne,2);{var ce=Be=>{var Fe=xb(),He=m($e(Fe)),it=f(He);Q(()=>C(it,`${n().summary.skipped??""} skipped`)),S(Be,Fe)};Z(Se,Be=>{var Fe;(Fe=n().summary)!=null&&Fe.skipped&&Be(ce)})}var Oe=m(Y,2),qe=f(Oe);{var Ke=Be=>{var Fe=Sb(),He=$e(Fe);Q(()=>C(He,`Avg ${n().summary.avgTps??""} tok/s`)),S(Be,Fe)};Z(qe,Be=>{var Fe;(Fe=n().summary)!=null&&Fe.avgTps&&Be(Ke)})}var ut=m(qe),wt=m(ut,2),Ze=m(wt,2);Q((Be,Fe,He)=>{var it,lt;C(G,`${(((it=n().summary)==null?void 0:it.processed)||n().total||0)??""} processed`),C(ye,`${(n().classified||0)??""} classified`),C(ut,` ${Be??""} in + ${Fe??""} out `),C(wt,` ${He??""} `),C(Ze,` Model: ${(((lt=n().summary)==null?void 0:lt.modelName)||"Unknown")??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),S(oe,R)};Z(X,oe=>{l(g)&&n().totals&&oe(me)})}var M=m(X,2),ee=f(M);{var fe=oe=>{var R=Tb(),Y=$e(R);Y.__click=function(...G){var ve;(ve=e.oninspect)==null||ve.apply(this,G)};var re=m(Y,2);re.__click=function(...G){var ve;(ve=e.onclose)==null||ve.apply(this,G)},S(oe,R)},pe=oe=>{var R=Ab(),Y=$e(R);Y.__click=function(...G){var ve;(ve=e.oninspect)==null||ve.apply(this,G)};var re=m(Y,2);re.__click=function(...G){var ve;(ve=e.onstop)==null||ve.apply(this,G)},S(oe,R)};Z(ee,oe=>{l(g)?oe(fe):oe(pe,!1)})}Q(()=>{C(U,`${l(d)??""}%`),le=Bt(P,1,"bar-fill svelte-t1ig66",null,le,{done:l(g)}),ke=vn(P,"",ke,{width:`${l(d)??""}%`})}),S(b,w)};Z(h,b=>{n()&&b(x)})}S(t,_),qt()}en(["click"]);var Pb=T('<span class="spinner svelte-ois7em"></span>'),Ob=pl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),Rb=T('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),Mb=T("<option> </option>"),jb=T('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),Db=T('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function Lb(t,e){Nt(e,!0);let n=De(e,"engineStatus",3,"idle"),a=De(e,"modelName",3,""),s=De(e,"isScanning",3,!1),o=De(e,"scanProgress",3,null),u=De(e,"scanCount",15,20),d=De(e,"stats",3,null);const g=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function _(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function h(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function x(){return n()==="ready"&&!s()}let b=st(()=>{var R;return s()&&((R=o())==null?void 0:R.phase)!=="done"});var w=Db(),I=f(w),D=f(I),O=f(D);{var ie=R=>{var Y=Pb();S(R,Y)},de=R=>{var Y=Ob();S(R,Y)};Z(O,R=>{l(b)?R(ie):R(de,!1)})}var he=m(D,2),V=f(he),U=m(f(V),2);U.__click=function(...R){var Y;(Y=e.oninspect)==null||Y.apply(this,R)};var q=m(V,2),P=f(q);let le;var ke=m(P),xe=m(I,2);{var we=R=>{var Y=Rb(),re=f(Y),G=f(re),ve=m(re,4),ye=f(ve),ne=m(ve,4),K=f(ne);Q(()=>{C(G,`${d().totalEmails??""} emails in storage`),C(ye,`${d().classified??""} classified`),C(K,`${d().unclassified??""} new`)}),S(R,Y)};Z(xe,R=>{d()&&R(we)})}var J=m(xe,2),ge=f(J),Te=m(f(ge),2);bt(Te,21,()=>g,Lt,(R,Y)=>{var re=Mb(),G=f(re),ve={};Q(()=>{C(G,l(Y).label),ve!==(ve=l(Y).value)&&(re.value=(re.__value=l(Y).value)??"")}),S(R,re)});var ae=m(ge,2),X=f(ae);X.__click=function(...R){var Y;(Y=e.onscan)==null||Y.apply(this,R)};var me=f(X),M=m(X,2);M.__click=function(...R){var Y;(Y=e.onrescan)==null||Y.apply(this,R)};var ee=m(J,2);{var fe=R=>{var Y=jb();S(R,Y)};Z(ee,R=>{n()!=="ready"&&n()!=="loading"&&R(fe)})}var pe=m(ee,2);{var oe=R=>{Cb(R,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};Z(pe,R=>{var Y;(s()||((Y=o())==null?void 0:Y.phase)==="done")&&R(oe)})}Q((R,Y,re,G)=>{le=vn(P,"",le,R),C(ke,` ${Y??""}`),Te.disabled=s(),X.disabled=re,C(me,l(b)?"Scanning...":s()?"Finalizing...":"Scan New"),M.disabled=G},[()=>({background:h()}),_,()=>!x(),()=>!x()]),Hs(Te,u),S(t,w),qt()}en(["click"]);var Nb=T('<span class="row-date svelte-1czytqk"> </span>'),qb=T('<span class="tag svelte-1czytqk"> </span>'),Bb=T('<span class="row-tags svelte-1czytqk"></span>'),Fb=T('<span class="row-reason svelte-1czytqk"> </span>'),zb=T('<button class="icon-btn exec-btn svelte-1czytqk" title="Execute actions"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>'),Ub=T('<!> <button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),Kb=T('<span class="status-label svelte-1czytqk"> </span>'),Gb=T('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),Hb=T('<p class="summary-reason svelte-1czytqk"> </p>'),Wb=T('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),Vb=T('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function $c(t,e){Nt(e,!0);let n=De(e,"actionColor",3,"#666"),a=De(e,"dimmed",3,!1);function s(ae){if(!ae)return"";try{return new Date(ae).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=st(()=>e.item.status==="pending"),u=Pe(!1);var d=Vb(),g=$e(d);let _;var h=f(g);h.__click=()=>A(u,!l(u));let x;var b=f(h),w=f(b),I=m(b,2),D=f(I),O=f(D),ie=m(D,2);{var de=ae=>{var X=Nb(),me=f(X);Q(M=>C(me,M),[()=>s(e.item.date)]),S(ae,X)};Z(ie,ae=>{e.item.date&&ae(de)})}var he=m(I,2);{var V=ae=>{var X=Bb();bt(X,21,()=>e.item.tags,Lt,(me,M)=>{var ee=qb();let fe;var pe=f(ee);Q(oe=>{fe=vn(ee,"",fe,oe),C(pe,l(M))},[()=>({background:ah(l(M))})]),S(me,ee)}),S(ae,X)};Z(he,ae=>{e.item.tags&&e.item.tags.length>0&&ae(V)})}var U=m(he,2);{var q=ae=>{var X=Fb(),me=f(X);Q(()=>C(me,e.item.reason)),S(ae,X)};Z(U,ae=>{e.item.reason&&!l(u)&&ae(q)})}var P=m(h,2),le=f(P);{var ke=ae=>{var X=Ub(),me=$e(X);{var M=pe=>{var oe=zb();oe.__click=R=>{R.stopPropagation(),e.onexecute(e.item)},S(pe,oe)};Z(me,pe=>{e.onexecute&&pe(M)})}var ee=m(me,2);ee.__click=pe=>{pe.stopPropagation(),e.onmarkacted(e.item.emailId)};var fe=m(ee,2);fe.__click=pe=>{pe.stopPropagation(),e.ondismiss(e.item.emailId)},S(ae,X)},xe=ae=>{var X=Kb(),me=f(X);Q(()=>C(me,e.item.status)),S(ae,X)};Z(le,ae=>{l(o)?ae(ke):ae(xe,!1)})}var we=m(le,2);{var J=ae=>{var X=Gb();X.__click=me=>{me.stopPropagation(),e.onremove(e.item.emailId)},S(ae,X)};Z(we,ae=>{e.onremove&&ae(J)})}var ge=m(g,2);{var Te=ae=>{var X=Wb();let me;var M=f(X),ee=f(M),fe=m(M,2);{var pe=oe=>{var R=Hb(),Y=f(R);Q(()=>C(Y,e.item.reason)),S(oe,R)};Z(fe,oe=>{e.item.reason&&oe(pe)})}Q(()=>{me=vn(X,"",me,{"border-left-color":n()}),C(ee,e.item.summary)}),S(ae,X)};Z(ge,ae=>{l(u)&&e.item.summary&&ae(Te)})}Q(()=>{_=Bt(g,1,"email-row svelte-1czytqk",null,_,{dimmed:a()}),x=vn(h,"",x,{"border-left-color":n()}),C(w,e.item.subject),C(O,e.item.from)}),S(t,d),qt()}en(["click"]);var Yb=T('<span class="group-acted svelte-tl1unp"> </span>'),Qb=T('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),Xb=T('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),Zb=T('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),Jb=T('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),$b=T('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),e1=T('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function t1(t,e){Nt(e,!0);let n=De(e,"color",3,"#888");De(e,"count",3,0);let a=De(e,"items",19,()=>[]),s=De(e,"expanded",3,!1),o=st(()=>a().filter(q=>q.status==="pending")),u=st(()=>a().filter(q=>q.status!=="pending")),d=Pe(!1);function g(q){return q.split("_").map(P=>P.charAt(0)+P.slice(1).toLowerCase()).join(" ")}var _=e1(),h=f(_);h.__click=function(...q){var P;(P=e.ontoggle)==null||P.apply(this,q)};var x=f(h);let b;var w=f(x),I=m(x,2),D=f(I),O=m(I,2);{var ie=q=>{var P=Yb(),le=f(P);Q(()=>C(le,`${l(u).length??""} handled`)),S(q,P)};Z(O,q=>{l(u).length>0&&q(ie)})}var de=m(O,4);let he;var V=m(h,2);{var U=q=>{var P=$b(),le=f(P);{var ke=me=>{var M=Qb();S(me,M)};Z(le,me=>{l(o).length===0&&l(u).length===0&&me(ke)})}var xe=m(le,2);bt(xe,17,()=>l(o),me=>me.emailId,(me,M)=>{$c(me,{get item(){return l(M)},get actionColor(){return n()},get onexecute(){return e.onexecute},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var we=m(xe,2);{var J=me=>{var M=Xb(),ee=f(M),fe=f(ee),pe=m(ee,2);bt(pe,17,()=>l(u),oe=>oe.emailId,(oe,R)=>{$c(oe,{get item(){return l(R)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),Q(()=>C(fe,`${l(u).length??""} handled`)),S(me,M)};Z(we,me=>{l(u).length>0&&me(J)})}var ge=m(we,2),Te=f(ge);{var ae=me=>{var M=Zb();M.__click=()=>A(d,!0),S(me,M)},X=me=>{var M=Jb(),ee=f(M),fe=m(ee);fe.__click=()=>A(d,!1);var pe=m(fe,2);pe.__click=()=>{e.oncleargroup(),A(d,!1)},Q(()=>C(ee,`Clear ${a().length??""} items? `)),S(me,M)};Z(Te,me=>{l(d)?me(X,!1):me(ae)})}S(q,P)};Z(V,q=>{s()&&q(U)})}Q(q=>{b=vn(x,"",b,{background:n()}),C(w,q),C(D,l(o).length),he=Bt(de,0,"chevron svelte-tl1unp",null,he,{open:s()})},[()=>g(e.action)]),S(t,_),qt()}en(["click"]);var n1=T(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),r1=T(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),a1=T(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),s1=T('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function i1(t,e){Nt(e,!0);let n=De(e,"open",15,!1),a=De(e,"sampleEmail",3,null),s=Pe("system");function o(){return a()?wd(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function u(){n(!1)}function d(x){x.target===x.currentTarget&&u()}var g=Rn(),_=$e(g);{var h=x=>{var b=s1();b.__click=d,b.__keydown=J=>J.key==="Escape"&&u();var w=f(b),I=f(w),D=m(f(I),2);D.__click=u;var O=m(I,2),ie=f(O);let de;ie.__click=()=>A(s,"system");var he=m(ie,2);let V;he.__click=()=>A(s,"email");var U=m(he,2);let q;U.__click=()=>A(s,"config");var P=m(O,2),le=f(P);{var ke=J=>{var ge=n1(),Te=m($e(ge),2),ae=f(Te);Q(()=>C(ae,gd)),S(J,ge)},xe=J=>{var ge=r1(),Te=m($e(ge),2),ae=m(f(Te),2);ae.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var X=m(Te,2),me=m(f(X),2),M=f(me);Q(ee=>C(M,ee),[o]),S(J,ge)},we=J=>{var ge=a1(),Te=m($e(ge),2),ae=f(Te),X=m(f(ae),2),me=f(X),M=m(ae,2),ee=m(f(M),2),fe=f(ee),pe=m(M,2),oe=m(f(pe),2),R=f(oe),Y=m(Te,4);Y.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,Q(()=>{C(me,eh.maxTokens),C(fe,"false"),C(R,"false")}),S(J,ge)};Z(le,J=>{l(s)==="system"?J(ke):l(s)==="email"?J(xe,1):l(s)==="config"&&J(we,2)})}Q(()=>{de=Bt(ie,1,"tab svelte-10pcy9j",null,de,{active:l(s)==="system"}),V=Bt(he,1,"tab svelte-10pcy9j",null,V,{active:l(s)==="email"}),q=Bt(U,1,"tab svelte-10pcy9j",null,q,{active:l(s)==="config"})}),S(x,b)};Z(_,x=>{n()&&x(h)})}S(t,g),qt()}en(["click","keydown"]);var o1=T('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),l1=T('<span class="type-group-chip svelte-d25j4l"> </span>'),c1=T('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),u1=T("<button> </button>"),d1=T('<span class="picker-tile-added svelte-d25j4l">â added</span>'),v1=T('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),f1=T('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span> <span class="picker-hint svelte-d25j4l">Click to add to pipeline</span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),p1=T('<div class="action-picker svelte-d25j4l"><!> <div class="picker-custom-row svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">+ Create Custom Action</button> <span class="picker-hint svelte-d25j4l" style="margin-left: 0.5rem;">Create a new action and link it to any plugin command</span></div></div>'),h1=T("<option> </option>"),m1=T("<optgroup></optgroup>"),g1=T('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-row svelte-d25j4l"><select class="plugin-select svelte-d25j4l"><option>-- Select Plugin Command --</option><!></select></div> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),_1=T('<span class="cmd-icon svelte-d25j4l"> </span>'),y1=T('<span class="cmd-binding svelte-d25j4l"> <span class="cmd-binding-sep svelte-d25j4l">Â·</span> </span>'),b1=T('<span class="cmd-binding unbound svelte-d25j4l" title="No plugin bound â will attempt to resolve from event source">unbound</span>'),w1=T('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><div class="cmd-name-row svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <!></div> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),k1=T('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),x1=T('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),S1=T('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),E1=T('<p class="svelte-d25j4l">Select an event type on the left to view and edit its action pipeline.</p>'),T1=T('<div class="no-selection svelte-d25j4l"><!></div>'),A1=T('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function I1(t,e){Nt(e,!0);let n=De(e,"open",15,!1),a=Pe(Yt([])),s=Pe(Yt({})),o=Pe(Yt({})),u=Pe(null),d=Pe(!1),g=Pe("INFO"),_=Pe(Yt([])),h=Pe(null),x=Pe(!1),b=Pe(""),w=Pe(!1);const I=[{pluginId:"gmail",pluginName:"Gmail",actions:Ed("gmail")}],D={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function O(){A(a,await Rp(),!0);const M={};await Promise.all(l(a).map(async ee=>{M[ee]=(await So(ee)).length})),A(s,M,!0),A(o,await jp(),!0),l(u)&&(A(_,(await So(l(u))).map(ee=>({...ee})),!0),A(d,await hasUserOverride(l(u)),!0),A(g,await Ei(l(u)),!0))}Oa(()=>{n()&&O()});async function ie(M){A(u,M,!0),A(_,(await So(M)).map(ee=>({...ee})),!0),A(d,await hasUserOverride(M),!0),A(g,await Ei(M),!0),A(h,null),A(w,!1)}async function de(M){l(u)&&(await Mp(l(u),M),A(g,M,!0))}function he(M){return M.split("_").map(ee=>ee.charAt(0)+ee.slice(1).toLowerCase()).join(" ")}function V(M){return`hsl(${Li(M)}, 55%, 55%)`}async function U(){const M=l(b).trim();if(!M)return;await Dp(M),A(b,""),A(x,!1),await O();const ee=M.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await ie(ee)}async function q(){l(u)&&(await Np(l(u)),A(u,null),A(_,[],!0),A(d,!1),await O())}async function P(M,ee){await Cc(l(u),{id:M.actionId,pluginId:ee,commandId:M.actionId,name:M.name,description:M.description,icon:D[M.actionId]||void 0}),await O()}function le(M){return l(_).some(ee=>ee.id===M)}async function ke(M){await zp(l(u),M),await O()}function xe(M){A(h,{...M,pluginCommandKey:M.pluginId&&M.commandId?`${M.pluginId}:${M.commandId}`:""},!0)}async function we(){l(h)&&(await Kp(l(u),l(h).id,{name:l(h).name,description:l(h).description,icon:l(h).icon,pluginId:l(h).pluginId,commandId:l(h).commandId}),A(h,null),await O())}function J(){A(h,null)}async function ge(){const M=`custom_${Date.now()}`;await Cc(l(u),{id:M,pluginId:"",commandId:"",name:"New Custom Action",description:"",icon:"â¡"}),await O();const ee=l(_).find(fe=>fe.id===M);ee&&xe(ee)}async function Te(M,ee){const fe=[...l(_)],pe=M+ee;pe<0||pe>=fe.length||([fe[M],fe[pe]]=[fe[pe],fe[M]],await qp(l(u),fe),await O())}var ae=Rn(),X=$e(ae);{var me=M=>{var ee=A1(),fe=f(ee),pe=f(fe),oe=m(f(pe),4);oe.__click=()=>n(!1);var R=m(pe,2),Y=f(R),re=f(Y),G=m(f(re),2);G.__click=()=>A(x,!l(x));var ve=m(re,2);{var ye=qe=>{var Ke=o1(),ut=f(Ke);ut.__keydown=Ze=>Ze.key==="Enter"&&U();var wt=m(ut,2);wt.__click=U,Ur(ut,()=>l(b),Ze=>A(b,Ze)),S(qe,Ke)};Z(ve,qe=>{l(x)&&qe(ye)})}var ne=m(ve,2);bt(ne,21,()=>l(a),Lt,(qe,Ke)=>{var ut=c1();let wt;ut.__click=()=>ie(l(Ke));var Ze=f(ut);let Be;var Fe=m(Ze,2),He=f(Fe),it=m(Fe,4);{var lt=Ve=>{const ze=st(()=>Hr[l(o)[l(Ke)]]);var mt=Rn(),ot=$e(mt);{var Ht=Kt=>{var dt=l1();let Je;var ft=f(dt);Q(()=>{sr(dt,"title",l(ze).description),Je=vn(dt,"",Je,{color:l(ze).color}),C(ft,l(ze).label)}),S(Kt,dt)};Z(ot,Kt=>{l(ze)&&Kt(Ht)})}S(Ve,mt)};Z(it,Ve=>{l(o)[l(Ke)]&&Ve(lt)})}var et=m(it,2),ct=f(et);Q((Ve,ze)=>{wt=Bt(ut,1,"type-item svelte-d25j4l",null,wt,{selected:l(u)===l(Ke)}),Be=vn(Ze,"",Be,Ve),C(He,ze),C(ct,l(s)[l(Ke)]??0)},[()=>({background:V(l(Ke))}),()=>he(l(Ke))]),S(qe,ut)});var K=m(Y,2),Se=f(K);{var ce=qe=>{var Ke=x1(),ut=$e(Ke),wt=f(ut);let Ze;var Be=f(wt),Fe=m(wt,2),He=f(Fe),it=m(Fe,6);bt(it,21,()=>Object.values(Hr),Lt,(dt,Je)=>{var ft=u1();let at;ft.__click=()=>de(l(Je).id);let Me;var Wt=f(ft);Q(()=>{at=Bt(ft,1,"group-chip svelte-d25j4l",null,at,{active:l(g)===l(Je).id}),sr(ft,"title",l(Je).description),Me=vn(ft,"",Me,{"--grp-color":l(Je).color}),C(Wt,l(Je).label)}),S(dt,ft)});var lt=m(it,2);lt.__click=q;var et=m(lt,2);et.__click=()=>{A(w,!l(w)),A(h,null)};var ct=f(et),Ve=m(ut,2);{var ze=dt=>{var Je=p1(),ft=f(Je);bt(ft,17,()=>I,Lt,(Wt,zt)=>{var At=f1(),Ee=f(At),Qt=f(Ee),Dn=f(Qt),pn=m(Ee,2);bt(pn,21,()=>l(zt).actions,Lt,(Cn,hn)=>{const Pt=st(()=>le(l(hn).actionId));var tn=v1();let mn;tn.__click=()=>P(l(hn),l(zt).pluginId);var rt=f(tn),tt=f(rt),Ot=m(rt,2),Xe=f(Ot),vt=m(Ot,2);{var Gt=Jt=>{var an=d1();S(Jt,an)};Z(vt,Jt=>{l(Pt)&&Jt(Gt)})}Q(()=>{mn=Bt(tn,1,"picker-tile svelte-d25j4l",null,mn,{added:l(Pt)}),sr(tn,"title",l(hn).description),C(tt,D[l(hn).actionId]??"Â·"),C(Xe,l(hn).name)}),S(Cn,tn)}),Q(()=>C(Dn,l(zt).pluginName)),S(Wt,At)});var at=m(ft,2),Me=f(at);Me.__click=ge,S(dt,Je)};Z(Ve,dt=>{l(w)&&dt(ze)})}var mt=m(Ve,2),ot=f(mt);bt(ot,19,()=>l(_),dt=>dt.id,(dt,Je,ft)=>{var at=Rn(),Me=$e(at);{var Wt=At=>{var Ee=g1(),Qt=f(Ee),Dn=f(Qt),pn=m(Dn,2),Cn=m(Qt,2),hn=m(Cn,2),Pt=f(hn);Pt.__change=Xe=>{if(Xe.target.value){const[vt,Gt]=Xe.target.value.split(":");l(h).pluginId=vt,l(h).commandId=Gt}else l(h).pluginId="",l(h).commandId=""};var tn=f(Pt);tn.value=tn.__value="";var mn=m(tn);bt(mn,17,()=>I,Lt,(Xe,vt)=>{var Gt=m1();bt(Gt,21,()=>l(vt).actions,Lt,(Jt,an)=>{var Et=h1(),Vt=f(Et),sn={};Q(()=>{C(Vt,`${l(an).name??""} (${l(an).actionId??""})`),sn!==(sn=`${l(vt).pluginId??""}:${l(an).actionId??""}`)&&(Et.value=Et.__value=`${l(vt).pluginId??""}:${l(an).actionId??""}`)}),S(Jt,Et)}),Q(()=>sr(Gt,"label",l(vt).pluginName)),S(Xe,Gt)});var rt=m(hn,2),tt=f(rt);tt.__click=we;var Ot=m(tt,2);Ot.__click=J,Ur(Dn,()=>l(h).icon,Xe=>l(h).icon=Xe),Ur(pn,()=>l(h).name,Xe=>l(h).name=Xe),Ur(Cn,()=>l(h).description,Xe=>l(h).description=Xe),Hs(Pt,()=>l(h).pluginCommandKey,Xe=>l(h).pluginCommandKey=Xe),S(At,Ee)},zt=At=>{var Ee=w1(),Qt=f(Ee),Dn=f(Qt),pn=m(Qt,2),Cn=f(pn);{var hn=Rt=>{var on=_1(),Ln=f(on);Q(()=>C(Ln,l(Je).icon)),S(Rt,on)};Z(Cn,Rt=>{l(Je).icon&&Rt(hn)})}var Pt=m(Cn,2),tn=f(Pt),mn=f(tn),rt=f(mn),tt=m(mn,2);{var Ot=Rt=>{var on=y1(),Ln=f(on),br=m(Ln,2,!0);Q(()=>{sr(on,"title",`Calls ${l(Je).pluginId??""} plugin â ${l(Je).commandId??""}`),C(Ln,l(Je).pluginId),C(br,l(Je).commandId)}),S(Rt,on)},Xe=Rt=>{var on=b1();S(Rt,on)};Z(tt,Rt=>{l(Je).pluginId&&l(Je).commandId?Rt(Ot):Rt(Xe,!1)})}var vt=m(tn,2),Gt=f(vt),Jt=m(pn,2),an=f(Jt);an.__click=()=>Te(l(ft),-1);var Et=m(an,2);Et.__click=()=>Te(l(ft),1);var Vt=m(Et,2);Vt.__click=()=>xe(l(Je));var sn=m(Vt,2);sn.__click=()=>ke(l(Je).id),Q(()=>{C(Dn,l(ft)+1),C(rt,l(Je).name),C(Gt,l(Je).description),an.disabled=l(ft)===0,Et.disabled=l(ft)===l(_).length-1}),S(At,Ee)};Z(Me,At=>{var Ee;((Ee=l(h))==null?void 0:Ee.id)===l(Je).id?At(Wt):At(zt,!1)})}S(dt,at)});var Ht=m(ot,2);{var Kt=dt=>{var Je=k1();S(dt,Je)};Z(Ht,dt=>{l(_).length===0&&dt(Kt)})}Q((dt,Je)=>{Ze=vn(wt,"",Ze,dt),C(Be,Je),C(He,`${l(_).length??""} action${l(_).length===1?"":"s"}`),C(ct,l(w)?"Cancel":"+ Add Action")},[()=>({background:V(l(u))}),()=>he(l(u))]),S(qe,Ke)},Oe=qe=>{var Ke=T1(),ut=f(Ke);{var wt=Be=>{var Fe=S1();S(Be,Fe)},Ze=Be=>{var Fe=E1();S(Be,Fe)};Z(ut,Be=>{l(a).length===0?Be(wt):Be(Ze,!1)})}S(qe,Ke)};Z(Se,qe=>{l(u)?qe(ce):qe(Oe,!1)})}S(M,ee)};Z(X,M=>{n()&&M(me)})}S(t,ae),qt()}en(["click","keydown","change"]);var C1=T('<span class="scope-chip svelte-1e15788"> </span>'),P1=T('<div class="scopes-list svelte-1e15788"></div>'),O1=T('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),R1=T('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),M1=T('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),j1=T('<div class="empty svelte-1e15788">No plugins registered.</div>'),D1=T('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function L1(t,e){Nt(e,!0);let n=De(e,"open",15,!1);const a=st(()=>n()?is.getAllPlugins().map(b=>({id:b.pluginId,name:b.serviceName,actions:b.getHandlers().map(w=>({id:w.actionId,name:w.name,description:w.description,scopes:w.requiredScopes||[]}))})):[]),s={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},o=st(()=>l(a).reduce((b,w)=>b+w.actions.length,0));let u=Pe(Yt(new Set));function d(b){const w=new Set(l(u));w.has(b)?w.delete(b):w.add(b),A(u,w,!0)}function g(b){return b.replace(/^https?:\/\/[^/]+\/auth\//,"")}var _=Rn(),h=$e(_);{var x=b=>{var w=D1();w.__keydown=we=>we.key==="Escape"&&n(!1);var I=f(w),D=f(I),O=f(D),ie=m(f(O),2),de=m(f(ie),2),he=f(de),V=m(O,2);V.__click=()=>n(!1);var U=m(D,2),q=f(U);bt(q,17,()=>l(a),Lt,(we,J)=>{var ge=M1(),Te=f(ge),ae=f(Te),X=f(ae),me=f(X),M=m(X,2),ee=f(M),fe=m(ae,2),pe=f(fe),oe=m(Te,2);bt(oe,21,()=>l(J).actions,Lt,(R,Y)=>{const re=st(()=>`${l(J).id}:${l(Y).id}`),G=st(()=>l(u).has(l(re)));var ve=R1(),ye=f(ve),ne=f(ye),K=m(ye,2),Se=f(K),ce=f(Se),Oe=f(ce),qe=m(ce,2),Ke=f(qe),ut=m(Se,2),wt=f(ut),Ze=m(ut,2);{var Be=Fe=>{var He=O1(),it=f(He);it.__click=()=>d(l(re));var lt=f(it);{var et=ot=>{var Ht=fn("â¾");S(ot,Ht)},ct=ot=>{var Ht=fn("â¸");S(ot,Ht)};Z(lt,ot=>{l(G)?ot(et):ot(ct,!1)})}var Ve=m(lt),ze=m(it,2);{var mt=ot=>{var Ht=P1();bt(Ht,21,()=>l(Y).scopes,Lt,(Kt,dt)=>{var Je=C1(),ft=f(Je);Q(at=>{sr(Je,"title",l(dt)),C(ft,at)},[()=>g(l(dt))]),S(Kt,Je)}),S(ot,Ht)};Z(ze,ot=>{l(G)&&ot(mt)})}Q(()=>C(Ve,` ${l(Y).scopes.length??""} scope${l(Y).scopes.length===1?"":"s"}`)),S(Fe,He)};Z(Ze,Fe=>{l(Y).scopes.length&&Fe(Be)})}Q(()=>{sr(ye,"title",l(Y).id),C(ne,s[l(Y).id]??"Â·"),C(Oe,l(Y).name),C(Ke,l(Y).id),C(wt,l(Y).description)}),S(R,ve)}),Q(()=>{C(me,l(J).name),C(ee,l(J).id),C(pe,`${l(J).actions.length??""} action${l(J).actions.length===1?"":"s"}`)}),S(we,ge)});var P=m(q,2);{var le=we=>{var J=j1();S(we,J)};Z(P,we=>{l(a).length===0&&we(le)})}var ke=m(U,2),xe=m(f(ke),2);xe.__click=()=>n(!1),Q(()=>C(he,`${l(a).length??""} plugin${l(a).length===1?"":"s"} Â· ${l(o)??""} actions available`)),S(b,w)};Z(h,b=>{n()&&b(x)})}S(t,_),qt()}en(["keydown","click"]);var N1=T('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),q1=T('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),B1=T('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),F1=T('<button class="chip svelte-s2dwjj"> </button>'),z1=T('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),U1=T('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),K1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),G1=T('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),H1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),W1=T('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),V1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),Y1=T('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),Q1=T('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),X1=T('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),Z1=T('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),J1=T('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function $1(t,e){Nt(e,!0);let n=De(e,"groupOrder",19,()=>[]),a=Pe(!1),s=Pe(null),o=Pe(!1),u=Pe(null);async function d(){var we;const[P,le,ke]=await Promise.all([Qe.items.where("sourceType").equals("gmail").count(),Qe.emailClassifications.count(),Qe.contacts.count()]);let xe=0;try{const J=await((we=navigator.storage)==null?void 0:we.estimate());xe=(J==null?void 0:J.usage)??0}catch{}A(u,{emailCount:P,classCount:le,contactCount:ke,totalBytes:xe},!0)}function g(P){return P?P<1024?`${P} B`:P<1024*1024?`${(P/1024).toFixed(1)} KB`:`${(P/(1024*1024)).toFixed(1)} MB`:"â"}function _(){A(a,!l(a)),l(a)&&d()}async function h(P){var le;A(o,!0),A(s,null);try{await P(),await d(),(le=e.onrefresh)==null||le.call(e)}finally{A(o,!1)}}async function x(){await h(()=>Pc())}async function b(P){await h(()=>kl(P))}async function w(){await h(async()=>{await Id(),await Pc()})}async function I(){await h(()=>Qe.contacts.clear())}async function D(){await h(async()=>{await Qe.delete(),window.location.reload()})}function O(P){return P.split("_").map(le=>le.charAt(0)+le.slice(1).toLowerCase()).join(" ")}var ie=J1(),de=f(ie);de.__click=_;var he=m(f(de),2);let V;var U=m(de,2);{var q=P=>{var le=Z1(),ke=f(le);{var xe=K=>{var Se=q1(),ce=f(Se),Oe=f(ce),qe=m(ce,4),Ke=f(qe),ut=m(qe,4),wt=f(ut),Ze=m(ut,2);{var Be=Fe=>{var He=N1(),it=m($e(He),2),lt=f(it);Q(et=>C(lt,`${et??""} used`),[()=>g(l(u).totalBytes)]),S(Fe,He)};Z(Ze,Fe=>{l(u).totalBytes&&Fe(Be)})}Q(()=>{C(Oe,`${l(u).emailCount??""} emails`),C(Ke,`${l(u).classCount??""} classifications`),C(wt,`${l(u).contactCount??""} contacts`)}),S(K,Se)};Z(ke,K=>{l(u)&&K(xe)})}var we=m(ke,2);{var J=K=>{var Se=z1(),ce=m(f(Se),2);bt(ce,21,n,Lt,(Oe,qe)=>{var Ke=Rn(),ut=$e(Ke);{var wt=Be=>{var Fe=B1(),He=f(Fe),it=m(He);it.__click=()=>A(s,null);var lt=m(it,2);lt.__click=()=>b(l(qe)),Q(et=>{C(He,`Delete ${et??""}? `),lt.disabled=l(o)},[()=>O(l(qe))]),S(Be,Fe)},Ze=Be=>{var Fe=F1();Fe.__click=()=>A(s,`group:${l(qe)}`);var He=f(Fe);Q(it=>{Fe.disabled=l(o),C(He,`${it??""} â`)},[()=>O(l(qe))]),S(Be,Fe)};Z(ut,Be=>{l(s)===`group:${l(qe)}`?Be(wt):Be(Ze,!1)})}S(Oe,Ke)}),S(K,Se)};Z(we,K=>{n().length>0&&K(J)})}var ge=m(we,2),Te=m(f(ge),2),ae=f(Te);{var X=K=>{var Se=U1(),ce=m(f(Se),2);ce.__click=()=>A(s,null);var Oe=m(ce,2);Oe.__click=x,Q(()=>Oe.disabled=l(o)),S(K,Se)},me=K=>{var Se=K1();Se.__click=()=>A(s,"classifications"),Q(()=>Se.disabled=l(o)),S(K,Se)};Z(ae,K=>{l(s)==="classifications"?K(X):K(me,!1)})}var M=m(ae,2);{var ee=K=>{var Se=G1(),ce=m(f(Se),2);ce.__click=()=>A(s,null);var Oe=m(ce,2);Oe.__click=w,Q(()=>Oe.disabled=l(o)),S(K,Se)},fe=K=>{var Se=H1();Se.__click=()=>A(s,"emails"),Q(()=>Se.disabled=l(o)),S(K,Se)};Z(M,K=>{l(s)==="emails"?K(ee):K(fe,!1)})}var pe=m(M,2);{var oe=K=>{var Se=W1(),ce=m(f(Se),2);ce.__click=()=>A(s,null);var Oe=m(ce,2);Oe.__click=I,Q(()=>Oe.disabled=l(o)),S(K,Se)},R=K=>{var Se=V1();Se.__click=()=>A(s,"contacts"),Q(()=>Se.disabled=l(o)),S(K,Se)};Z(pe,K=>{l(s)==="contacts"?K(oe):K(R,!1)})}var Y=m(ge,2),re=f(Y);{var G=K=>{var Se=Y1(),ce=m(f(Se),2);ce.__click=()=>A(s,null);var Oe=m(ce,2);Oe.__click=D,Q(()=>Oe.disabled=l(o)),S(K,Se)},ve=K=>{var Se=Q1();Se.__click=()=>A(s,"nuke"),Q(()=>Se.disabled=l(o)),S(K,Se)};Z(re,K=>{l(s)==="nuke"?K(G):K(ve,!1)})}var ye=m(Y,2);{var ne=K=>{var Se=X1();S(K,Se)};Z(ye,K=>{l(o)&&K(ne)})}S(P,le)};Z(U,P=>{l(a)&&P(q)})}Q(()=>V=Bt(he,0,"chev svelte-s2dwjj",null,V,{open:l(a)})),S(t,ie),qt()}en(["click"]);var ew=T('<div class="error-card svelte-aym646"><span> </span> <button class="error-dismiss svelte-aym646">â</button></div>'),tw=T('<div class="success-card svelte-aym646"><span> </span> <button class="success-dismiss svelte-aym646">â</button></div>'),nw=T('<div class="groups-list svelte-aym646"></div> <div class="actions-footer svelte-aym646"><span class="footer-stat svelte-aym646"> </span></div>',1),rw=T('<div class="empty-state svelte-aym646"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-aym646">No emails classified yet</h3> <p class="svelte-aym646">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),aw=T('<div class="actions-container svelte-aym646"><!> <!> <!> <!> <div class="toolbar svelte-aym646"><button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!> <!></div>');function sw(t,e){Nt(e,!0);let n=De(e,"groups",19,()=>({})),a=De(e,"groupOrder",19,()=>[]),s=De(e,"counts",19,()=>({})),o=De(e,"stats",3,null),u=De(e,"expandedGroup",3,null),d=De(e,"isScanning",3,!1),g=De(e,"scanProgress",3,null),_=De(e,"scanCount",15,20),h=De(e,"error",3,null),x=De(e,"successMsg",3,null),b=Pe(!1),w=Pe(!1),I=Pe(!1),D=st(()=>{for(const X of a()){const me=n()[X];if((me==null?void 0:me.length)>0)return me[0]}return null});var O=aw(),ie=f(O);Lb(ie,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return d()},get scanProgress(){return g()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>A(b,!0),get scanCount(){return _()},set scanCount(X){_(X)}});var de=m(ie,2);i1(de,{get sampleEmail(){return l(D)},get open(){return l(b)},set open(X){A(b,X,!0)}});var he=m(de,2);I1(he,{get open(){return l(w)},set open(X){A(w,X,!0)}});var V=m(he,2);L1(V,{get open(){return l(I)},set open(X){A(I,X,!0)}});var U=m(V,2),q=f(U);q.__click=()=>A(I,!0);var P=m(q,2);P.__click=()=>A(w,!0);var le=m(U,2);{var ke=X=>{var me=ew(),M=f(me),ee=f(M),fe=m(M,2);fe.__click=function(...pe){var oe;(oe=e.ondismisserror)==null||oe.apply(this,pe)},Q(()=>C(ee,h())),S(X,me)};Z(le,X=>{h()&&X(ke)})}var xe=m(le,2);{var we=X=>{var me=tw(),M=f(me),ee=f(M),fe=m(M,2);fe.__click=function(...pe){var oe;(oe=e.ondismisssuccess)==null||oe.apply(this,pe)},Q(()=>C(ee,x())),S(X,me)};Z(xe,X=>{x()&&X(we)})}var J=m(xe,2);{var ge=X=>{var me=nw(),M=$e(me);bt(M,20,a,oe=>oe,(oe,R)=>{{let Y=st(()=>Wo(R)),re=st(()=>{var ye;return((ye=n()[R])==null?void 0:ye.length)||0}),G=st(()=>n()[R]||[]),ve=st(()=>u()===R);t1(oe,{get action(){return R},get color(){return l(Y)},get count(){return l(re)},get items(){return l(G)},get expanded(){return l(ve)},ontoggle:()=>e.ontogglegroup(R),onexecute:ye=>e.onexecute(R,ye),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(R)})}});var ee=m(M,2),fe=f(ee),pe=f(fe);Q(()=>C(pe,`${s().total??""} emails classified into ${a().length??""} groups`)),S(X,me)},Te=X=>{var me=rw();S(X,me)};Z(J,X=>{s().total>0?X(ge):d()||X(Te,1)})}var ae=m(J,2);$1(ae,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),S(t,O),qt()}en(["click"]);var iw=T('<div class="control-board-page svelte-v2lwbo"><!></div>');function ow(t,e){Nt(e,!0);const n=td();let a=Pe(Yt(n.status)),s=Pe(""),o=Pe(Yt({})),u=Pe(Yt([])),d=Pe(Yt({total:0})),g=Pe(null),_=Pe(null),h=Pe(!1),x=Pe(null),b=Pe(3),w=Pe(null),I=Pe(null),D=Pe(null);const O="me-ai-scan-history";async function ie(){return await js(O)}async function de(X){!X||X.phase!=="done"||await Ds(O,{timestamp:Date.now(),classified:X.classified||0,errors:X.errors||0,total:X.total||0,totals:X.totals||{},summary:X.summary||{}})}En(async()=>{const X=n.onMessage(M=>{if(M.status==="ready"){A(a,"ready");const ee=Cr.find(oe=>oe.id===n.modelId),fe=Pr.find(oe=>oe.name===n.modelId),pe=ee||fe;A(s,(pe==null?void 0:pe.name)||(pe==null?void 0:pe.displayName)||n.modelId||"",!0)}M.status==="loading"&&A(a,"loading")});if(A(a,n.status,!0),n.modelId){const M=Cr.find(pe=>pe.id===n.modelId),ee=Pr.find(pe=>pe.name===n.modelId),fe=M||ee;A(s,(fe==null?void 0:fe.name)||(fe==null?void 0:fe.displayName)||n.modelId||"",!0)}const me=await ie();return me&&A(x,{phase:"done",...me},!0),he(),()=>X()});async function he(){try{const X=await yd();A(o,X.groups,!0),A(u,X.order,!0),A(d,await th(),!0),A(g,await Ho(),!0)}catch(X){A(w,`Failed to load data: ${X.message}`)}}async function V(){await q(!1)}async function U(){await q(!0)}async function q(X){if(l(h)||!n.isReady)return;A(w,null),A(I,null),A(h,!0),A(x,null);const me=new AbortController;A(D,me,!0);try{await _d(n,{count:l(b),force:X,signal:me.signal,onProgress:M=>{A(x,{...M},!0),M.phase==="done"&&de(M)}}),await he()}catch(M){me.signal.aborted||A(w,`Scan failed: ${M.message}`)}finally{A(h,!1),A(D,null)}}function P(){var X;(X=l(D))==null||X.abort()}async function le(X){await Ti(X,"acted"),await he()}async function ke(X,me){const{executePipeline:M,isAuthenticated:ee}=await Hn(async()=>{const{executePipeline:fe,isAuthenticated:pe}=await Promise.resolve().then(()=>vm);return{executePipeline:fe,isAuthenticated:pe}},void 0,import.meta.url);if(!await ee()){alert("Please sign in to Gmail first (Dashboard page)");return}try{const pe=await M({type:X,source:"gmail",data:me},oe=>{console.log("Pipeline progress:",oe)},!0);pe.success?(A(I,pe.message,!0),A(w,null),await le(me.emailId)):(A(w,`Execution failed: ${pe.message}`),A(I,null))}catch(fe){A(w,`Execution error: ${fe.message}`),A(I,null)}}async function xe(X){await Ti(X,"dismissed"),await he()}async function we(X){await bd(X),await he()}async function J(X){await kl(X),await he()}function ge(X){A(_,l(_)===X?null:X,!0)}var Te=iw(),ae=f(Te);sw(ae,{get engineStatus(){return l(a)},get modelName(){return l(s)},get groups(){return l(o)},get groupOrder(){return l(u)},get counts(){return l(d)},get stats(){return l(g)},get expandedGroup(){return l(_)},get isScanning(){return l(h)},get scanProgress(){return l(x)},get error(){return l(w)},get successMsg(){return l(I)},onscan:V,onrescan:U,ontogglegroup:ge,onexecute:ke,onmarkacted:le,ondismiss:xe,onremove:we,oncleargroup:J,ondismisserror:()=>A(w,null),ondismisssuccess:()=>A(I,null),onstop:P,onrefresh:he,oncloseprogress:async()=>{A(x,null),await ml(O)},get scanCount(){return l(b)},set scanCount(X){A(b,X,!0)}}),S(t,Te),qt()}var lw=T('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#control">Control Board</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function cw(t,e){Nt(e,!0);function n(){const P=location.hash;return P==="#dashboard"?"dashboard":P==="#control"?"control":"chat"}let a=Pe(Yt(n()));En(()=>{function P(){A(a,n(),!0)}return window.addEventListener("hashchange",P),()=>window.removeEventListener("hashchange",P)});var s=lw(),o=f(s),u=m(f(o),2),d=f(u);let g;var _=m(d,2);let h;var x=m(_,2);let b;var w=m(o,2),I=f(w);let D;var O=f(I);Cg(O,{});var ie=m(I,2);let de;var he=f(ie);ow(he,{});var V=m(ie,2);let U;var q=f(V);ib(q,{}),Q(()=>{g=Bt(d,1,"svelte-1n46o8q",null,g,{active:l(a)==="chat"}),h=Bt(_,1,"svelte-1n46o8q",null,h,{active:l(a)==="control"}),b=Bt(x,1,"svelte-1n46o8q",null,b,{active:l(a)==="dashboard"}),D=vn(I,"",D,{display:l(a)==="chat"?"flex":"none"}),de=vn(ie,"",de,{display:l(a)==="control"?"flex":"none"}),U=vn(V,"",U,{display:l(a)==="dashboard"?"flex":"none"})}),S(t,s),qt()}Mf(cw,{target:document.getElementById("app")});
