---
name: manage-actions
description: Guides the agent on how to manage, create, or update the dynamically generated action pipelines (n8n-like architecture) for me-ai.
---

# Manage Actions (n8n-like Architecture)

When working on features related to events, actions, and pipelines in `me-ai`, you must follow the dynamically generated n8n-like architecture.

## Core Concept
The application operates exactly like **n8n.io** but tailored for email and local event streams:
1. **Trigger / Extraction**: The LLM analyzes an incoming event (e.g. an email) and dynamically extracts the `eventType`, execution `group`, and a list of `suggestedActions`.
2. **Action Pipeline (Workflow)**: Each `eventType` maps to an ordered list of `actions` (a pipeline).
3. **Execution**: Each action explicitly binds to a plugin command (e.g., `gmail` plugin executing the `trash` command).

## UI/UX Rules
- **No hardcoded pipelines**: Pipelines must be dynamically generated by the LLM on first encounter or created manually by the user via the UI.
- **Control Board**: The user interface allows users to review the dynamically extracted events, groups, and actions.
- **Action Pipeline Editor**: This is the visual workflow editor. Users can:
  - Create new custom actions.
  - Link an action to any available plugin command explicitly (via `pluginId` and `commandId`).
  - Reorder, modify, or delete actions in the flow.

## Adding a New Action / Plugin Command
If the user asks to add a new supported action (e.g., "Add an action to reply to emails"):
1. **Update the Plugin**: Add the new action handler to the corresponding plugin file (e.g., `src/lib/plugins/gmail-plugin.js`), ensuring you define `actionId`, `name`, `description`, `requiredScopes`, and the `execute` function.
2. **Update the System Prompt**: The `triage.js` module dynamically reads from the `pluginRegistry` to build the LLM system prompt. You rarely need to hardcode action IDs into the prompt anymore, but ensure the plugin's description is extremely clear so the LLM knows when to suggest it.
3. **UI Integration**: The Action Pipeline Editor automatically picks up new plugin commands from the `pluginRegistry`. No hardcoded UI changes are usually necessary unless adding custom icons to `ACTION_ICONS` in `ActionEditor.svelte`.

## Key Files
- `src/lib/events.js`: Manages the storage and retrieval of the dynamic action pipelines.
- `src/lib/triage.js`: The LLM prompt generation and extraction logic (the "Trigger").
- `src/lib/plugins/plugin-registry.js`: Routes the dynamic action to the actual executable code.
- `src/components/actions/ActionEditor.svelte`: The visual n8n-like workflow editor.
