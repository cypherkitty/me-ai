var af=Object.defineProperty;var nc=t=>{throw TypeError(t)};var sf=(t,e,n)=>e in t?af(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ot=(t,e,n)=>sf(t,typeof e!="symbol"?e+"":e,n),uo=(t,e,n)=>e.has(t)||nc("Cannot "+n);var ge=(t,e,n)=>(uo(t,e,"read from private field"),n?n.call(t):e.get(t)),lt=(t,e,n)=>e.has(t)?nc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),at=(t,e,n,a)=>(uo(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),pn=(t,e,n)=>(uo(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const To=!1;var Zo=Array.isArray,of=Array.prototype.indexOf,Va=Array.prototype.includes,Ri=Array.from,lf=Object.defineProperty,Ba=Object.getOwnPropertyDescriptor,cf=Object.getOwnPropertyDescriptors,uf=Object.prototype,df=Array.prototype,Zc=Object.getPrototypeOf,rc=Object.isExtensible;const ff=()=>{};function vf(t){for(var e=0;e<t.length;e++)t[e]()}function Jc(){var t,e,n=new Promise((a,s)=>{t=a,e=s});return{promise:n,resolve:t,reject:e}}const cn=2,Cs=4,Oi=8,$c=1<<24,qr=16,vr=32,Ia=64,eu=128,Xn=512,tn=1024,un=2048,fr=4096,Ln=8192,Lr=16384,Ns=32768,Ya=65536,ac=1<<17,tu=1<<18,$a=1<<19,pf=1<<20,jr=1<<25,xa=65536,Ao=1<<21,Jo=1<<22,Vr=1<<23,ba=Symbol("$state"),hf=Symbol("legacy props"),mf=Symbol(""),da=new class extends Error{constructor(){super(...arguments);ot(this,"name","StaleReactionError");ot(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function gf(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function _f(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function yf(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function bf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function wf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function kf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function xf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Sf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ef(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Tf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Af(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Cf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const If=1,Rf=2,nu=4,Of=8,Pf=16,Mf=1,Df=4,jf=8,Lf=16,ru=1,Nf=2,an=Symbol(),au="http://www.w3.org/1999/xhtml";function qf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Bf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function su(t){return t===this.v}function Ff(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function iu(t){return!Ff(t,this.v)}let zf=!1,Nn=null;function Qa(t){Nn=t}function xt(t,e=!1,n){Nn={p:Nn,i:!1,c:null,e:null,s:t,x:null,l:null}}function St(t){var e=Nn,n=e.e;if(n!==null){e.e=null;for(var a of n)Cu(a)}return t!==void 0&&(e.x=t),e.i=!0,Nn=e.p,t??{}}function ou(){return!0}let fa=[];function lu(){var t=fa;fa=[],vf(t)}function Yr(t){if(fa.length===0&&!xs){var e=fa;queueMicrotask(()=>{e===fa&&lu()})}fa.push(t)}function Uf(){for(;fa.length>0;)lu()}function cu(t){var e=At;if(e===null)return ut.f|=Vr,t;if((e.f&Ns)===0&&(e.f&Cs)===0)throw t;Xa(t,e)}function Xa(t,e){for(;e!==null;){if((e.f&eu)!==0){if((e.f&Ns)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Kf=-7169;function Qt(t,e){t.f=t.f&Kf|e}function $o(t){(t.f&Xn)!==0||t.deps===null?Qt(t,tn):Qt(t,fr)}function uu(t){if(t!==null)for(const e of t)(e.f&cn)===0||(e.f&xa)===0||(e.f^=xa,uu(e.deps))}function du(t,e,n){(t.f&un)!==0?e.add(t):(t.f&fr)!==0&&n.add(t),uu(t.deps),Qt(t,tn)}const li=new Set;let nt=null,ki=null,sn=null,An=[],Pi=null,Co=!1,xs=!1;var Fa,za,pa,Ua,Ms,Ds,ha,Or,Ka,Ar,Io,Ro,fu;const Cl=class Cl{constructor(){lt(this,Ar);ot(this,"committed",!1);ot(this,"current",new Map);ot(this,"previous",new Map);lt(this,Fa,new Set);lt(this,za,new Set);lt(this,pa,0);lt(this,Ua,0);lt(this,Ms,null);lt(this,Ds,new Set);lt(this,ha,new Set);lt(this,Or,new Map);ot(this,"is_fork",!1);lt(this,Ka,!1)}is_deferred(){return this.is_fork||ge(this,Ua)>0}skip_effect(e){ge(this,Or).has(e)||ge(this,Or).set(e,{d:[],m:[]})}unskip_effect(e){var n=ge(this,Or).get(e);if(n){ge(this,Or).delete(e);for(var a of n.d)Qt(a,un),ur(a);for(a of n.m)Qt(a,fr),ur(a)}}process(e){var s;An=[],this.apply();var n=[],a=[];for(const o of e)pn(this,Ar,Io).call(this,o,n,a);if(this.is_deferred()){pn(this,Ar,Ro).call(this,a),pn(this,Ar,Ro).call(this,n);for(const[o,c]of ge(this,Or))mu(o,c)}else{for(const o of ge(this,Fa))o();ge(this,Fa).clear(),ge(this,pa)===0&&pn(this,Ar,fu).call(this),ki=this,nt=null,sc(a),sc(n),ki=null,(s=ge(this,Ms))==null||s.resolve()}sn=null}capture(e,n){n!==an&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Vr)===0&&(this.current.set(e,e.v),sn==null||sn.set(e,e.v))}activate(){nt=this,this.apply()}deactivate(){nt===this&&(nt=null,sn=null)}flush(){if(this.activate(),An.length>0){if(vu(),nt!==null&&nt!==this)return}else ge(this,pa)===0&&this.process([]);this.deactivate()}discard(){for(const e of ge(this,za))e(this);ge(this,za).clear()}increment(e){at(this,pa,ge(this,pa)+1),e&&at(this,Ua,ge(this,Ua)+1)}decrement(e){at(this,pa,ge(this,pa)-1),e&&at(this,Ua,ge(this,Ua)-1),!ge(this,Ka)&&(at(this,Ka,!0),Yr(()=>{at(this,Ka,!1),this.is_deferred()?An.length>0&&this.flush():this.revive()}))}revive(){for(const e of ge(this,Ds))ge(this,ha).delete(e),Qt(e,un),ur(e);for(const e of ge(this,ha))Qt(e,fr),ur(e);this.flush()}oncommit(e){ge(this,Fa).add(e)}ondiscard(e){ge(this,za).add(e)}settled(){return(ge(this,Ms)??at(this,Ms,Jc())).promise}static ensure(){if(nt===null){const e=nt=new Cl;li.add(nt),xs||Yr(()=>{nt===e&&e.flush()})}return nt}apply(){}};Fa=new WeakMap,za=new WeakMap,pa=new WeakMap,Ua=new WeakMap,Ms=new WeakMap,Ds=new WeakMap,ha=new WeakMap,Or=new WeakMap,Ka=new WeakMap,Ar=new WeakSet,Io=function(e,n,a){e.f^=tn;for(var s=e.first,o=null;s!==null;){var c=s.f,d=(c&(vr|Ia))!==0,h=d&&(c&tn)!==0,m=h||(c&Ln)!==0||ge(this,Or).has(s);if(!m&&s.fn!==null){d?s.f^=tn:o!==null&&(c&(Cs|Oi|$c))!==0?o.b.defer_effect(s):(c&Cs)!==0?n.push(s):Bs(s)&&((c&qr)!==0&&ge(this,ha).add(s),Ja(s));var y=s.first;if(y!==null){s=y;continue}}var k=s.parent;for(s=s.next;s===null&&k!==null;)k===o&&(o=null),s=k.next,k=k.parent}},Ro=function(e){for(var n=0;n<e.length;n+=1)du(e[n],ge(this,Ds),ge(this,ha))},fu=function(){var s;if(li.size>1){this.previous.clear();var e=sn,n=!0;for(const o of li){if(o===this){n=!1;continue}const c=[];for(const[h,m]of this.current){if(o.current.has(h))if(n&&m!==o.current.get(h))o.current.set(h,m);else continue;c.push(h)}if(c.length===0)continue;const d=[...o.current.keys()].filter(h=>!this.current.has(h));if(d.length>0){var a=An;An=[];const h=new Set,m=new Map;for(const y of c)pu(y,d,h,m);if(An.length>0){nt=o,o.apply();for(const y of An)pn(s=o,Ar,Io).call(s,y,[],[]);o.deactivate()}An=a}}nt=null,sn=e}this.committed=!0,li.delete(this)};let Qr=Cl;function Gf(t){var e=xs;xs=!0;try{for(var n;;){if(Uf(),An.length===0&&(nt==null||nt.flush(),An.length===0))return Pi=null,n;vu()}}finally{xs=e}}function vu(){Co=!0;var t=null;try{for(var e=0;An.length>0;){var n=Qr.ensure();if(e++>1e3){var a,s;Wf()}n.process(An),Xr.clear()}}finally{An=[],Co=!1,Pi=null}}function Wf(){try{xf()}catch(t){Xa(t,Pi)}}let sr=null;function sc(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Lr|Ln))===0&&Bs(a)&&(sr=new Set,Ja(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&Pu(a),(sr==null?void 0:sr.size)>0)){Xr.clear();for(const s of sr){if((s.f&(Lr|Ln))!==0)continue;const o=[s];let c=s.parent;for(;c!==null;)sr.has(c)&&(sr.delete(c),o.push(c)),c=c.parent;for(let d=o.length-1;d>=0;d--){const h=o[d];(h.f&(Lr|Ln))===0&&Ja(h)}}sr.clear()}}sr=null}}function pu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&cn)!==0?pu(s,e,n,a):(o&(Jo|qr))!==0&&(o&un)===0&&hu(s,e,a)&&(Qt(s,un),ur(s))}}function hu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const s of t.deps){if(Va.call(e,s))return!0;if((s.f&cn)!==0&&hu(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function ur(t){for(var e=Pi=t;e.parent!==null;){e=e.parent;var n=e.f;if(Co&&e===At&&(n&qr)!==0&&(n&tu)===0)return;if((n&(Ia|vr))!==0){if((n&tn)===0)return;e.f^=tn}}An.push(e)}function mu(t,e){if(!((t.f&vr)!==0&&(t.f&tn)!==0)){(t.f&un)!==0?e.d.push(t):(t.f&fr)!==0&&e.m.push(t),Qt(t,tn);for(var n=t.first;n!==null;)mu(n,e),n=n.next}}function Hf(t){let e=0,n=Sa(0),a;return()=>{nl()&&(u(n),rl(()=>(e===0&&(a=Fs(()=>t(()=>Ss(n)))),e+=1,()=>{Yr(()=>{e-=1,e===0&&(a==null||a(),a=void 0,Ss(n))})})))}}var Vf=Ya|$a|eu;function Yf(t,e,n){new Qf(t,e,n)}var Hn,Xo,yr,ma,br,Vn,En,wr,Pr,Wr,ga,Hr,Ga,_a,Wa,Ha,Mr,Ci,nn,Xf,Zf,Oo,mi,gi,Po;class Qf{constructor(e,n,a){lt(this,nn);ot(this,"parent");ot(this,"is_pending",!1);lt(this,Hn);lt(this,Xo,null);lt(this,yr);lt(this,ma);lt(this,br);lt(this,Vn,null);lt(this,En,null);lt(this,wr,null);lt(this,Pr,null);lt(this,Wr,null);lt(this,ga,0);lt(this,Hr,0);lt(this,Ga,!1);lt(this,_a,!1);lt(this,Wa,new Set);lt(this,Ha,new Set);lt(this,Mr,null);lt(this,Ci,Hf(()=>(at(this,Mr,Sa(ge(this,ga))),()=>{at(this,Mr,null)})));at(this,Hn,e),at(this,yr,n),at(this,ma,a),this.parent=At.b,this.is_pending=!!ge(this,yr).pending,at(this,br,al(()=>{At.b=this;{var s=pn(this,nn,Oo).call(this);try{at(this,Vn,Yn(()=>a(s)))}catch(o){this.error(o)}ge(this,Hr)>0?pn(this,nn,gi).call(this):this.is_pending=!1}return()=>{var o;(o=ge(this,Wr))==null||o.remove()}},Vf))}defer_effect(e){du(e,ge(this,Wa),ge(this,Ha))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!ge(this,yr).pending}update_pending_count(e){pn(this,nn,Po).call(this,e),at(this,ga,ge(this,ga)+e),!(!ge(this,Mr)||ge(this,Ga))&&(at(this,Ga,!0),Yr(()=>{at(this,Ga,!1),ge(this,Mr)&&Za(ge(this,Mr),ge(this,ga))}))}get_effect_pending(){return ge(this,Ci).call(this),u(ge(this,Mr))}error(e){var n=ge(this,yr).onerror;let a=ge(this,yr).failed;if(ge(this,_a)||!n&&!a)throw e;ge(this,Vn)&&(In(ge(this,Vn)),at(this,Vn,null)),ge(this,En)&&(In(ge(this,En)),at(this,En,null)),ge(this,wr)&&(In(ge(this,wr)),at(this,wr,null));var s=!1,o=!1;const c=()=>{if(s){Bf();return}s=!0,o&&Cf(),Qr.ensure(),at(this,ga,0),ge(this,wr)!==null&&wa(ge(this,wr),()=>{at(this,wr,null)}),this.is_pending=this.has_pending_snippet(),at(this,Vn,pn(this,nn,mi).call(this,()=>(at(this,_a,!1),Yn(()=>ge(this,ma).call(this,ge(this,Hn)))))),ge(this,Hr)>0?pn(this,nn,gi).call(this):this.is_pending=!1};Yr(()=>{try{o=!0,n==null||n(e,c),o=!1}catch(d){Xa(d,ge(this,br)&&ge(this,br).parent)}a&&at(this,wr,pn(this,nn,mi).call(this,()=>{Qr.ensure(),at(this,_a,!0);try{return Yn(()=>{a(ge(this,Hn),()=>e,()=>c)})}catch(d){return Xa(d,ge(this,br).parent),null}finally{at(this,_a,!1)}}))})}}Hn=new WeakMap,Xo=new WeakMap,yr=new WeakMap,ma=new WeakMap,br=new WeakMap,Vn=new WeakMap,En=new WeakMap,wr=new WeakMap,Pr=new WeakMap,Wr=new WeakMap,ga=new WeakMap,Hr=new WeakMap,Ga=new WeakMap,_a=new WeakMap,Wa=new WeakMap,Ha=new WeakMap,Mr=new WeakMap,Ci=new WeakMap,nn=new WeakSet,Xf=function(){try{at(this,Vn,Yn(()=>ge(this,ma).call(this,ge(this,Hn))))}catch(e){this.error(e)}},Zf=function(){const e=ge(this,yr).pending;e&&(at(this,En,Yn(()=>e(ge(this,Hn)))),Yr(()=>{var n=pn(this,nn,Oo).call(this);at(this,Vn,pn(this,nn,mi).call(this,()=>(Qr.ensure(),Yn(()=>ge(this,ma).call(this,n))))),ge(this,Hr)>0?pn(this,nn,gi).call(this):(wa(ge(this,En),()=>{at(this,En,null)}),this.is_pending=!1)}))},Oo=function(){var e=ge(this,Hn);return this.is_pending&&(at(this,Wr,Nr()),ge(this,Hn).before(ge(this,Wr)),e=ge(this,Wr)),e},mi=function(e){var n=At,a=ut,s=Nn;Er(ge(this,br)),Jn(ge(this,br)),Qa(ge(this,br).ctx);try{return e()}catch(o){return cu(o),null}finally{Er(n),Jn(a),Qa(s)}},gi=function(){const e=ge(this,yr).pending;ge(this,Vn)!==null&&(at(this,Pr,document.createDocumentFragment()),ge(this,Pr).append(ge(this,Wr)),ju(ge(this,Vn),ge(this,Pr))),ge(this,En)===null&&at(this,En,Yn(()=>e(ge(this,Hn))))},Po=function(e){var n;if(!this.has_pending_snippet()){this.parent&&pn(n=this.parent,nn,Po).call(n,e);return}if(at(this,Hr,ge(this,Hr)+e),ge(this,Hr)===0){this.is_pending=!1;for(const a of ge(this,Wa))Qt(a,un),ur(a);for(const a of ge(this,Ha))Qt(a,fr),ur(a);ge(this,Wa).clear(),ge(this,Ha).clear(),ge(this,En)&&wa(ge(this,En),()=>{at(this,En,null)}),ge(this,Pr)&&(ge(this,Hn).before(ge(this,Pr)),at(this,Pr,null))}};function Jf(t,e,n,a){const s=Mi;var o=t.filter(b=>!b.settled);if(n.length===0&&o.length===0){a(e.map(s));return}var c=nt,d=At,h=$f(),m=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(b=>b.promise)):null;function y(b){h();try{a(b)}catch(x){(d.f&Lr)===0&&Xa(x,d)}c==null||c.deactivate(),Mo()}if(n.length===0){m.then(()=>y(e.map(s)));return}function k(){h(),Promise.all(n.map(b=>ev(b))).then(b=>y([...e.map(s),...b])).catch(b=>Xa(b,d))}m?m.then(k):k()}function $f(){var t=At,e=ut,n=Nn,a=nt;return function(o=!0){Er(t),Jn(e),Qa(n),o&&(a==null||a.activate())}}function Mo(){Er(null),Jn(null),Qa(null)}function Mi(t){var e=cn|un,n=ut!==null&&(ut.f&cn)!==0?ut:null;return At!==null&&(At.f|=$a),{ctx:Nn,deps:null,effects:null,equals:su,f:e,fn:t,reactions:null,rv:0,v:an,wv:0,parent:n??At,ac:null}}function ev(t,e,n){let a=At;a===null&&_f();var s=a.b,o=void 0,c=Sa(an),d=!ut,h=new Map;return pv(()=>{var x;var m=Jc();o=m.promise;try{Promise.resolve(t()).then(m.resolve,m.reject).then(()=>{y===nt&&y.committed&&y.deactivate(),Mo()})}catch(R){m.reject(R),Mo()}var y=nt;if(d){var k=s.is_rendered();s.update_pending_count(1),y.increment(k),(x=h.get(y))==null||x.reject(da),h.delete(y),h.set(y,m)}const b=(R,D=void 0)=>{if(y.activate(),D)D!==da&&(c.f|=Vr,Za(c,D));else{(c.f&Vr)!==0&&(c.f^=Vr),Za(c,R);for(const[F,ae]of h){if(h.delete(F),F===y)break;ae.reject(da)}}d&&(s.update_pending_count(-1),y.decrement(k))};m.promise.then(b,R=>b(null,R||"unknown"))}),Au(()=>{for(const m of h.values())m.reject(da)}),new Promise(m=>{function y(k){function b(){k===o?m(c):y(o)}k.then(b,b)}y(o)})}function ct(t){const e=Mi(t);return Lu(e),e}function gu(t){const e=Mi(t);return e.equals=iu,e}function tv(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)In(e[n])}}function nv(t){for(var e=t.parent;e!==null;){if((e.f&cn)===0)return(e.f&Lr)===0?e:null;e=e.parent}return null}function el(t){var e,n=At;Er(nv(t));try{t.f&=~xa,tv(t),e=Fu(t)}finally{Er(n)}return e}function _u(t){var e=el(t);if(!t.equals(e)&&(t.wv=qu(),(!(nt!=null&&nt.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Qt(t,tn);return}Zr||(sn!==null?(nl()||nt!=null&&nt.is_fork)&&sn.set(t,e):$o(t))}function rv(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(da),a.teardown=ff,a.ac=null,Is(a,0),sl(a))}function yu(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Ja(e)}let Do=new Set;const Xr=new Map;let bu=!1;function Sa(t,e){var n={f:0,v:t,reactions:null,equals:su,rv:0,wv:0};return n}function Pe(t,e){const n=Sa(t);return Lu(n),n}function av(t,e=!1,n=!0){const a=Sa(t);return e||(a.equals=iu),a}function C(t,e,n=!1){ut!==null&&(!dr||(ut.f&ac)!==0)&&ou()&&(ut.f&(cn|qr|Jo|ac))!==0&&(Zn===null||!Va.call(Zn,t))&&Af();let a=n?Nt(e):e;return Za(t,a)}function Za(t,e){if(!t.equals(e)){var n=t.v;Zr?Xr.set(t,e):Xr.set(t,n),t.v=e;var a=Qr.ensure();if(a.capture(t,n),(t.f&cn)!==0){const s=t;(t.f&un)!==0&&el(s),$o(s)}t.wv=qu(),wu(t,un),At!==null&&(At.f&tn)!==0&&(At.f&(vr|Ia))===0&&(Wn===null?mv([t]):Wn.push(t)),!a.is_fork&&Do.size>0&&!bu&&sv()}return e}function sv(){bu=!1;for(const t of Do)(t.f&tn)!==0&&Qt(t,fr),Bs(t)&&Ja(t);Do.clear()}function Ss(t){C(t,t.v+1)}function wu(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,s=0;s<a;s++){var o=n[s],c=o.f,d=(c&un)===0;if(d&&Qt(o,e),(c&cn)!==0){var h=o;sn==null||sn.delete(h),(c&xa)===0&&(c&Xn&&(o.f|=xa),wu(h,fr))}else d&&((c&qr)!==0&&sr!==null&&sr.add(o),ur(o))}}function Nt(t){if(typeof t!="object"||t===null||ba in t)return t;const e=Zc(t);if(e!==uf&&e!==df)return t;var n=new Map,a=Zo(t),s=Pe(0),o=ka,c=d=>{if(ka===o)return d();var h=ut,m=ka;Jn(null),uc(o);var y=d();return Jn(h),uc(m),y};return a&&n.set("length",Pe(t.length)),new Proxy(t,{defineProperty(d,h,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ef();var y=n.get(h);return y===void 0?c(()=>{var k=Pe(m.value);return n.set(h,k),k}):C(y,m.value,!0),!0},deleteProperty(d,h){var m=n.get(h);if(m===void 0){if(h in d){const y=c(()=>Pe(an));n.set(h,y),Ss(s)}}else C(m,an),Ss(s);return!0},get(d,h,m){var x;if(h===ba)return t;var y=n.get(h),k=h in d;if(y===void 0&&(!k||(x=Ba(d,h))!=null&&x.writable)&&(y=c(()=>{var R=Nt(k?d[h]:an),D=Pe(R);return D}),n.set(h,y)),y!==void 0){var b=u(y);return b===an?void 0:b}return Reflect.get(d,h,m)},getOwnPropertyDescriptor(d,h){var m=Reflect.getOwnPropertyDescriptor(d,h);if(m&&"value"in m){var y=n.get(h);y&&(m.value=u(y))}else if(m===void 0){var k=n.get(h),b=k==null?void 0:k.v;if(k!==void 0&&b!==an)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return m},has(d,h){var b;if(h===ba)return!0;var m=n.get(h),y=m!==void 0&&m.v!==an||Reflect.has(d,h);if(m!==void 0||At!==null&&(!y||(b=Ba(d,h))!=null&&b.writable)){m===void 0&&(m=c(()=>{var x=y?Nt(d[h]):an,R=Pe(x);return R}),n.set(h,m));var k=u(m);if(k===an)return!1}return y},set(d,h,m,y){var V;var k=n.get(h),b=h in d;if(a&&h==="length")for(var x=m;x<k.v;x+=1){var R=n.get(x+"");R!==void 0?C(R,an):x in d&&(R=c(()=>Pe(an)),n.set(x+"",R))}if(k===void 0)(!b||(V=Ba(d,h))!=null&&V.writable)&&(k=c(()=>Pe(void 0)),C(k,Nt(m)),n.set(h,k));else{b=k.v!==an;var D=c(()=>Nt(m));C(k,D)}var F=Reflect.getOwnPropertyDescriptor(d,h);if(F!=null&&F.set&&F.set.call(y,m),!b){if(a&&typeof h=="string"){var ae=n.get("length"),Q=Number(h);Number.isInteger(Q)&&Q>=ae.v&&C(ae,Q+1)}Ss(s)}return!0},ownKeys(d){u(s);var h=Reflect.ownKeys(d).filter(k=>{var b=n.get(k);return b===void 0||b.v!==an});for(var[m,y]of n)y.v!==an&&!(m in d)&&h.push(m);return h},setPrototypeOf(){Tf()}})}function ic(t){try{if(t!==null&&typeof t=="object"&&ba in t)return t[ba]}catch{}return t}function iv(t,e){return Object.is(ic(t),ic(e))}var oc,ku,xu,Su;function ov(){if(oc===void 0){oc=window,ku=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;xu=Ba(e,"firstChild").get,Su=Ba(e,"nextSibling").get,rc(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),rc(n)&&(n.__t=void 0)}}function Nr(t=""){return document.createTextNode(t)}function jn(t){return xu.call(t)}function qs(t){return Su.call(t)}function p(t,e){return jn(t)}function Qe(t,e=!1){{var n=jn(t);return n instanceof Comment&&n.data===""?qs(n):n}}function g(t,e=1,n=!1){let a=t;for(;e--;)a=qs(a);return a}function lv(t){t.textContent=""}function Eu(){return!1}function cv(t,e,n){return document.createElementNS(au,t,void 0)}let lc=!1;function uv(){lc||(lc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function tl(t){var e=ut,n=At;Jn(null),Er(null);try{return t()}finally{Jn(e),Er(n)}}function Tu(t,e,n,a=n){t.addEventListener(e,()=>tl(n));const s=t.__on_r;s?t.__on_r=()=>{s(),a(!0)}:t.__on_r=()=>a(!0),uv()}function dv(t){At===null&&(ut===null&&kf(),wf()),Zr&&bf()}function fv(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Br(t,e,n){var a=At;a!==null&&(a.f&Ln)!==0&&(t|=Ln);var s={ctx:Nn,deps:null,nodes:null,f:t|un|Xn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Ja(s)}catch(d){throw In(s),d}else e!==null&&ur(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&$a)===0&&(o=o.first,(t&qr)!==0&&(t&Ya)!==0&&o!==null&&(o.f|=Ya)),o!==null&&(o.parent=a,a!==null&&fv(o,a),ut!==null&&(ut.f&cn)!==0&&(t&Ia)===0)){var c=ut;(c.effects??(c.effects=[])).push(o)}return s}function nl(){return ut!==null&&!dr}function Au(t){const e=Br(Oi,null,!1);return Qt(e,tn),e.teardown=t,e}function Ea(t){dv();var e=At.f,n=!ut&&(e&vr)!==0&&(e&Ns)===0;if(n){var a=Nn;(a.e??(a.e=[])).push(t)}else return Cu(t)}function Cu(t){return Br(Cs|pf,t,!1)}function vv(t){Qr.ensure();const e=Br(Ia|$a,t,!0);return(n={})=>new Promise(a=>{n.outro?wa(e,()=>{In(e),a(void 0)}):(In(e),a(void 0))})}function Iu(t){return Br(Cs,t,!1)}function pv(t){return Br(Jo|$a,t,!0)}function rl(t,e=0){return Br(Oi|e,t,!0)}function ee(t,e=[],n=[],a=[]){Jf(a,e,n,s=>{Br(Oi,()=>t(...s.map(u)),!0)})}function al(t,e=0){var n=Br(qr|e,t,!0);return n}function Yn(t){return Br(vr|$a,t,!0)}function Ru(t){var e=t.teardown;if(e!==null){const n=Zr,a=ut;cc(!0),Jn(null);try{e.call(null)}finally{cc(n),Jn(a)}}}function sl(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&tl(()=>{s.abort(da)});var a=n.next;(n.f&Ia)!==0?n.parent=null:In(n,e),n=a}}function hv(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&vr)===0&&In(e),e=n}}function In(t,e=!0){var n=!1;(e||(t.f&tu)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Ou(t.nodes.start,t.nodes.end),n=!0),sl(t,e&&!n),Is(t,0),Qt(t,Lr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();Ru(t);var s=t.parent;s!==null&&s.first!==null&&Pu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Ou(t,e){for(;t!==null;){var n=t===e?null:qs(t);t.remove(),t=n}}function Pu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function wa(t,e,n=!0){var a=[];Mu(t,a,!0);var s=()=>{n&&In(t),e&&e()},o=a.length;if(o>0){var c=()=>--o||s();for(var d of a)d.out(c)}else s()}function Mu(t,e,n){if((t.f&Ln)===0){t.f^=Ln;var a=t.nodes&&t.nodes.t;if(a!==null)for(const d of a)(d.is_global||n)&&e.push(d);for(var s=t.first;s!==null;){var o=s.next,c=(s.f&Ya)!==0||(s.f&vr)!==0&&(t.f&qr)!==0;Mu(s,e,c?n:!1),s=o}}}function il(t){Du(t,!0)}function Du(t,e){if((t.f&Ln)!==0){t.f^=Ln,(t.f&tn)===0&&(Qt(t,un),ur(t));for(var n=t.first;n!==null;){var a=n.next,s=(n.f&Ya)!==0||(n.f&vr)!==0;Du(n,s?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const c of o)(c.is_global||e)&&c.in()}}function ju(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var s=n===a?null:qs(n);e.append(n),n=s}}let _i=!1,Zr=!1;function cc(t){Zr=t}let ut=null,dr=!1;function Jn(t){ut=t}let At=null;function Er(t){At=t}let Zn=null;function Lu(t){ut!==null&&(Zn===null?Zn=[t]:Zn.push(t))}let Cn=null,Mn=0,Wn=null;function mv(t){Wn=t}let Nu=1,va=0,ka=va;function uc(t){ka=t}function qu(){return++Nu}function Bs(t){var e=t.f;if((e&un)!==0)return!0;if(e&cn&&(t.f&=~xa),(e&fr)!==0){for(var n=t.deps,a=n.length,s=0;s<a;s++){var o=n[s];if(Bs(o)&&_u(o),o.wv>t.wv)return!0}(e&Xn)!==0&&sn===null&&Qt(t,tn)}return!1}function Bu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(Zn!==null&&Va.call(Zn,t)))for(var s=0;s<a.length;s++){var o=a[s];(o.f&cn)!==0?Bu(o,e,!1):e===o&&(n?Qt(o,un):(o.f&tn)!==0&&Qt(o,fr),ur(o))}}function Fu(t){var D;var e=Cn,n=Mn,a=Wn,s=ut,o=Zn,c=Nn,d=dr,h=ka,m=t.f;Cn=null,Mn=0,Wn=null,ut=(m&(vr|Ia))===0?t:null,Zn=null,Qa(t.ctx),dr=!1,ka=++va,t.ac!==null&&(tl(()=>{t.ac.abort(da)}),t.ac=null);try{t.f|=Ao;var y=t.fn,k=y();t.f|=Ns;var b=t.deps,x=nt==null?void 0:nt.is_fork;if(Cn!==null){var R;if(x||Is(t,Mn),b!==null&&Mn>0)for(b.length=Mn+Cn.length,R=0;R<Cn.length;R++)b[Mn+R]=Cn[R];else t.deps=b=Cn;if(nl()&&(t.f&Xn)!==0)for(R=Mn;R<b.length;R++)((D=b[R]).reactions??(D.reactions=[])).push(t)}else!x&&b!==null&&Mn<b.length&&(Is(t,Mn),b.length=Mn);if(ou()&&Wn!==null&&!dr&&b!==null&&(t.f&(cn|fr|un))===0)for(R=0;R<Wn.length;R++)Bu(Wn[R],t);if(s!==null&&s!==t){if(va++,s.deps!==null)for(let F=0;F<n;F+=1)s.deps[F].rv=va;if(e!==null)for(const F of e)F.rv=va;Wn!==null&&(a===null?a=Wn:a.push(...Wn))}return(t.f&Vr)!==0&&(t.f^=Vr),k}catch(F){return cu(F)}finally{t.f^=Ao,Cn=e,Mn=n,Wn=a,ut=s,Zn=o,Qa(c),dr=d,ka=h}}function gv(t,e){let n=e.reactions;if(n!==null){var a=of.call(n,t);if(a!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[a]=n[s],n.pop())}}if(n===null&&(e.f&cn)!==0&&(Cn===null||!Va.call(Cn,e))){var o=e;(o.f&Xn)!==0&&(o.f^=Xn,o.f&=~xa),$o(o),rv(o),Is(o,0)}}function Is(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)gv(t,n[a])}function Ja(t){var e=t.f;if((e&Lr)===0){Qt(t,tn);var n=At,a=_i;At=t,_i=!0;try{(e&(qr|$c))!==0?hv(t):sl(t),Ru(t);var s=Fu(t);t.teardown=typeof s=="function"?s:null,t.wv=Nu;var o;To&&zf&&(t.f&un)!==0&&t.deps}finally{_i=a,At=n}}}async function zu(){await Promise.resolve(),Gf()}function u(t){var e=t.f,n=(e&cn)!==0;if(ut!==null&&!dr){var a=At!==null&&(At.f&Lr)!==0;if(!a&&(Zn===null||!Va.call(Zn,t))){var s=ut.deps;if((ut.f&Ao)!==0)t.rv<va&&(t.rv=va,Cn===null&&s!==null&&s[Mn]===t?Mn++:Cn===null?Cn=[t]:Cn.push(t));else{(ut.deps??(ut.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[ut]:Va.call(o,ut)||o.push(ut)}}}if(Zr&&Xr.has(t))return Xr.get(t);if(n){var c=t;if(Zr){var d=c.v;return((c.f&tn)===0&&c.reactions!==null||Ku(c))&&(d=el(c)),Xr.set(c,d),d}var h=(c.f&Xn)===0&&!dr&&ut!==null&&(_i||(ut.f&Xn)!==0),m=(c.f&Ns)===0;Bs(c)&&(h&&(c.f|=Xn),_u(c)),h&&!m&&(yu(c),Uu(c))}if(sn!=null&&sn.has(t))return sn.get(t);if((t.f&Vr)!==0)throw t.v;return t.v}function Uu(t){if(t.f|=Xn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&cn)!==0&&(e.f&Xn)===0&&(yu(e),Uu(e))}function Ku(t){if(t.v===an)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Xr.has(e)||(e.f&cn)!==0&&Ku(e))return!0;return!1}function Fs(t){var e=dr;try{return dr=!0,t()}finally{dr=e}}const _v=["touchstart","touchmove"];function yv(t){return _v.includes(t)}const Gu=new Set,jo=new Set;function qt(t){for(var e=0;e<t.length;e++)Gu.add(t[e]);for(var n of jo)n(t)}let dc=null;function fc(t){var F;var e=this,n=e.ownerDocument,a=t.type,s=((F=t.composedPath)==null?void 0:F.call(t))||[],o=s[0]||t.target;dc=t;var c=0,d=dc===t&&t.__root;if(d){var h=s.indexOf(d);if(h!==-1&&(e===document||e===window)){t.__root=e;return}var m=s.indexOf(e);if(m===-1)return;h<=m&&(c=h)}if(o=s[c]||t.target,o!==e){lf(t,"currentTarget",{configurable:!0,get(){return o||n}});var y=ut,k=At;Jn(null),Er(null);try{for(var b,x=[];o!==null;){var R=o.assignedSlot||o.parentNode||o.host||null;try{var D=o["__"+a];D!=null&&(!o.disabled||t.target===o)&&D.call(o,t)}catch(ae){b?x.push(ae):b=ae}if(t.cancelBubble||R===e||R===null)break;o=R}if(b){for(let ae of x)queueMicrotask(()=>{throw ae});throw b}}finally{t.__root=e,delete t.currentTarget,Jn(y),Er(k)}}}var Yc,Qc;const fo=(Qc=(Yc=globalThis==null?void 0:globalThis.window)==null?void 0:Yc.trustedTypes)==null?void 0:Qc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function bv(t){return(fo==null?void 0:fo.createHTML(t))??t}function ol(t,e=!1){var n=cv("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?bv(t):t,n.content}function Ta(t,e){var n=At;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function I(t,e){var n=(e&ru)!==0,a=(e&Nf)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=ol(o?t:"<!>"+t,!0),n||(s=jn(s)));var c=a||ku?document.importNode(s,!0):s.cloneNode(!0);if(n){var d=jn(c),h=c.lastChild;Ta(d,h)}else Ta(c,c);return c}}function wv(t,e,n="svg"){var a=!t.startsWith("<!>"),s=(e&ru)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,c;return()=>{if(!c){var d=ol(o,!0),h=jn(d);if(s)for(c=document.createDocumentFragment();jn(h);)c.appendChild(jn(h));else c=jn(h)}var m=c.cloneNode(!0);if(s){var y=jn(m),k=m.lastChild;Ta(y,k)}else Ta(m,m);return m}}function ll(t,e){return wv(t,e,"svg")}function _n(t=""){{var e=Nr(t+"");return Ta(e,e),e}}function $n(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Nr();return t.append(e,n),Ta(e,n),t}function T(t,e){t!==null&&t.before(e)}function P(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function kv(t,e){return xv(t,e)}const ci=new Map;function xv(t,{target:e,anchor:n,props:a={},events:s,context:o,intro:c=!0}){ov();var d=new Set,h=k=>{for(var b=0;b<k.length;b++){var x=k[b];if(!d.has(x)){d.add(x);var R=yv(x);for(const ae of[e,document]){var D=ci.get(ae);D===void 0&&(D=new Map,ci.set(ae,D));var F=D.get(x);F===void 0?(ae.addEventListener(x,fc,{passive:R}),D.set(x,1)):D.set(x,F+1)}}}};h(Ri(Gu)),jo.add(h);var m=void 0,y=vv(()=>{var k=n??e.appendChild(Nr());return Yf(k,{pending:()=>{}},b=>{xt({});var x=Nn;o&&(x.c=o),s&&(a.$$events=s),m=t(b,a)||{},St()}),()=>{var D;for(var b of d)for(const F of[e,document]){var x=ci.get(F),R=x.get(b);--R==0?(F.removeEventListener(b,fc),x.delete(b),x.size===0&&ci.delete(F)):x.set(b,R)}jo.delete(h),k!==n&&((D=k.parentNode)==null||D.removeChild(k))}});return Sv.set(m,y),m}let Sv=new WeakMap;var or,kr,Dn,ya,js,Ls,Ii;class Ev{constructor(e,n=!0){ot(this,"anchor");lt(this,or,new Map);lt(this,kr,new Map);lt(this,Dn,new Map);lt(this,ya,new Set);lt(this,js,!0);lt(this,Ls,()=>{var e=nt;if(ge(this,or).has(e)){var n=ge(this,or).get(e),a=ge(this,kr).get(n);if(a)il(a),ge(this,ya).delete(n);else{var s=ge(this,Dn).get(n);s&&(ge(this,kr).set(n,s.effect),ge(this,Dn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),a=s.effect)}for(const[o,c]of ge(this,or)){if(ge(this,or).delete(o),o===e)break;const d=ge(this,Dn).get(c);d&&(In(d.effect),ge(this,Dn).delete(c))}for(const[o,c]of ge(this,kr)){if(o===n||ge(this,ya).has(o))continue;const d=()=>{if(Array.from(ge(this,or).values()).includes(o)){var m=document.createDocumentFragment();ju(c,m),m.append(Nr()),ge(this,Dn).set(o,{effect:c,fragment:m})}else In(c);ge(this,ya).delete(o),ge(this,kr).delete(o)};ge(this,js)||!a?(ge(this,ya).add(o),wa(c,d,!1)):d()}}});lt(this,Ii,e=>{ge(this,or).delete(e);const n=Array.from(ge(this,or).values());for(const[a,s]of ge(this,Dn))n.includes(a)||(In(s.effect),ge(this,Dn).delete(a))});this.anchor=e,at(this,js,n)}ensure(e,n){var a=nt,s=Eu();if(n&&!ge(this,kr).has(e)&&!ge(this,Dn).has(e))if(s){var o=document.createDocumentFragment(),c=Nr();o.append(c),ge(this,Dn).set(e,{effect:Yn(()=>n(c)),fragment:o})}else ge(this,kr).set(e,Yn(()=>n(this.anchor)));if(ge(this,or).set(a,e),s){for(const[d,h]of ge(this,kr))d===e?a.unskip_effect(h):a.skip_effect(h);for(const[d,h]of ge(this,Dn))d===e?a.unskip_effect(h.effect):a.skip_effect(h.effect);a.oncommit(ge(this,Ls)),a.ondiscard(ge(this,Ii))}else ge(this,Ls).call(this)}}or=new WeakMap,kr=new WeakMap,Dn=new WeakMap,ya=new WeakMap,js=new WeakMap,Ls=new WeakMap,Ii=new WeakMap;function ne(t,e,n=!1){var a=new Ev(t),s=n?Ya:0;function o(c,d){a.ensure(c,d)}al(()=>{var c=!1;e((d,h=0)=>{c=!0,o(h,d)}),c||o(!1,null)},s)}function Kt(t,e){return e}function Tv(t,e,n){for(var a=[],s=e.length,o,c=e.length,d=0;d<s;d++){let k=e[d];wa(k,()=>{if(o){if(o.pending.delete(k),o.done.add(k),o.pending.size===0){var b=t.outrogroups;Lo(Ri(o.done)),b.delete(o),b.size===0&&(t.outrogroups=null)}}else c-=1},!1)}if(c===0){var h=a.length===0&&n!==null;if(h){var m=n,y=m.parentNode;lv(y),y.append(m),t.items.clear()}Lo(e,!h)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Lo(t,e=!0){for(var n=0;n<t.length;n++)In(t[n],e)}var vc;function Ct(t,e,n,a,s,o=null){var c=t,d=new Map,h=(e&nu)!==0;if(h){var m=t;c=m.appendChild(Nr())}var y=null,k=gu(()=>{var ae=n();return Zo(ae)?ae:ae==null?[]:Ri(ae)}),b,x=!0;function R(){F.fallback=y,Av(F,b,c,e,a),y!==null&&(b.length===0?(y.f&jr)===0?il(y):(y.f^=jr,bs(y,null,c)):wa(y,()=>{y=null}))}var D=al(()=>{b=u(k);for(var ae=b.length,Q=new Set,V=nt,A=Eu(),W=0;W<ae;W+=1){var re=b[W],G=a(re,W),me=x?null:d.get(G);me?(me.v&&Za(me.v,re),me.i&&Za(me.i,W),A&&V.unskip_effect(me.e)):(me=Cv(d,x?c:vc??(vc=Nr()),re,G,W,s,e,n),x||(me.e.f|=jr),d.set(G,me)),Q.add(G)}if(ae===0&&o&&!y&&(x?y=Yn(()=>o(c)):(y=Yn(()=>o(vc??(vc=Nr()))),y.f|=jr)),ae>Q.size&&yf(),!x)if(A){for(const[be,le]of d)Q.has(be)||V.skip_effect(le.e);V.oncommit(R),V.ondiscard(()=>{})}else R();u(k)}),F={effect:D,items:d,outrogroups:null,fallback:y};x=!1}function fs(t){for(;t!==null&&(t.f&vr)===0;)t=t.next;return t}function Av(t,e,n,a,s){var le,de,ie,ve,he,ce,pe,xe,oe;var o=(a&Of)!==0,c=e.length,d=t.items,h=fs(t.effect.first),m,y=null,k,b=[],x=[],R,D,F,ae;if(o)for(ae=0;ae<c;ae+=1)R=e[ae],D=s(R,ae),F=d.get(D).e,(F.f&jr)===0&&((de=(le=F.nodes)==null?void 0:le.a)==null||de.measure(),(k??(k=new Set)).add(F));for(ae=0;ae<c;ae+=1){if(R=e[ae],D=s(R,ae),F=d.get(D).e,t.outrogroups!==null)for(const ue of t.outrogroups)ue.pending.delete(F),ue.done.delete(F);if((F.f&jr)!==0)if(F.f^=jr,F===h)bs(F,null,n);else{var Q=y?y.next:h;F===t.effect.last&&(t.effect.last=F.prev),F.prev&&(F.prev.next=F.next),F.next&&(F.next.prev=F.prev),Kr(t,y,F),Kr(t,F,Q),bs(F,Q,n),y=F,b=[],x=[],h=fs(y.next);continue}if((F.f&Ln)!==0&&(il(F),o&&((ve=(ie=F.nodes)==null?void 0:ie.a)==null||ve.unfix(),(k??(k=new Set)).delete(F))),F!==h){if(m!==void 0&&m.has(F)){if(b.length<x.length){var V=x[0],A;y=V.prev;var W=b[0],re=b[b.length-1];for(A=0;A<b.length;A+=1)bs(b[A],V,n);for(A=0;A<x.length;A+=1)m.delete(x[A]);Kr(t,W.prev,re.next),Kr(t,y,W),Kr(t,re,V),h=V,y=re,ae-=1,b=[],x=[]}else m.delete(F),bs(F,h,n),Kr(t,F.prev,F.next),Kr(t,F,y===null?t.effect.first:y.next),Kr(t,y,F),y=F;continue}for(b=[],x=[];h!==null&&h!==F;)(m??(m=new Set)).add(h),x.push(h),h=fs(h.next);if(h===null)continue}(F.f&jr)===0&&b.push(F),y=F,h=fs(F.next)}if(t.outrogroups!==null){for(const ue of t.outrogroups)ue.pending.size===0&&(Lo(Ri(ue.done)),(he=t.outrogroups)==null||he.delete(ue));t.outrogroups.size===0&&(t.outrogroups=null)}if(h!==null||m!==void 0){var G=[];if(m!==void 0)for(F of m)(F.f&Ln)===0&&G.push(F);for(;h!==null;)(h.f&Ln)===0&&h!==t.fallback&&G.push(h),h=fs(h.next);var me=G.length;if(me>0){var be=(a&nu)!==0&&c===0?n:null;if(o){for(ae=0;ae<me;ae+=1)(pe=(ce=G[ae].nodes)==null?void 0:ce.a)==null||pe.measure();for(ae=0;ae<me;ae+=1)(oe=(xe=G[ae].nodes)==null?void 0:xe.a)==null||oe.fix()}Tv(t,G,be)}}o&&Yr(()=>{var ue,ke;if(k!==void 0)for(F of k)(ke=(ue=F.nodes)==null?void 0:ue.a)==null||ke.apply()})}function Cv(t,e,n,a,s,o,c,d){var h=(c&If)!==0?(c&Pf)===0?av(n,!1,!1):Sa(n):null,m=(c&Rf)!==0?Sa(s):null;return{v:h,i:m,e:Yn(()=>(o(e,h??n,m??s,d),()=>{t.delete(a)}))}}function bs(t,e,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,o=e&&(e.f&jr)===0?e.nodes.start:n;a!==null;){var c=qs(a);if(o.before(a),a===s)return;a=c}}function Kr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Iv(t,e,n=!1,a=!1,s=!1){var o=t,c="";ee(()=>{var d=At;if(c!==(c=e()??"")&&(d.nodes!==null&&(Ou(d.nodes.start,d.nodes.end),d.nodes=null),c!=="")){var h=c+"";n?h=`<svg>${h}</svg>`:a&&(h=`<math>${h}</math>`);var m=ol(h);if((n||a)&&(m=jn(m)),Ta(jn(m),m.lastChild),n||a)for(;jn(m);)o.before(jn(m));else o.before(m)}})}const pc=[...` 	
\r\fÂ \v\uFEFF`];function Rv(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var s in n)if(n[s])a=a?a+" "+s:s;else if(a.length)for(var o=s.length,c=0;(c=a.indexOf(s,c))>=0;){var d=c+o;(c===0||pc.includes(a[c-1]))&&(d===a.length||pc.includes(a[d]))?a=(c===0?"":a.substring(0,c))+a.substring(d+1):c=d}}return a===""?null:a}function hc(t,e=!1){var n=e?" !important;":";",a="";for(var s in t){var o=t[s];o!=null&&o!==""&&(a+=" "+s+": "+o+n)}return a}function vo(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ov(t,e){if(e){var n="",a,s;if(Array.isArray(e)?(a=e[0],s=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,c=0,d=!1,h=[];a&&h.push(...Object.keys(a).map(vo)),s&&h.push(...Object.keys(s).map(vo));var m=0,y=-1;const D=t.length;for(var k=0;k<D;k++){var b=t[k];if(d?b==="/"&&t[k-1]==="*"&&(d=!1):o?o===b&&(o=!1):b==="/"&&t[k+1]==="*"?d=!0:b==='"'||b==="'"?o=b:b==="("?c++:b===")"&&c--,!d&&o===!1&&c===0){if(b===":"&&y===-1)y=k;else if(b===";"||k===D-1){if(y!==-1){var x=vo(t.substring(m,y).trim());if(!h.includes(x)){b!==";"&&k++;var R=t.substring(m,k).trim();n+=" "+R+";"}}m=k+1,y=-1}}}}return a&&(n+=hc(a)),s&&(n+=hc(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Pt(t,e,n,a,s,o){var c=t.__className;if(c!==n||c===void 0){var d=Rv(n,a,o);d==null?t.removeAttribute("class"):e?t.className=d:t.setAttribute("class",d),t.__className=n}else if(o&&s!==o)for(var h in o){var m=!!o[h];(s==null||m!==!!s[h])&&t.classList.toggle(h,m)}return o}function po(t,e={},n,a){for(var s in n){var o=n[s];e[s]!==o&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,o,a))}}function on(t,e,n,a){var s=t.__style;if(s!==e){var o=Ov(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(po(t,n==null?void 0:n[0],a[0]),po(t,n==null?void 0:n[1],a[1],"important")):po(t,n,a));return a}function Wu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Zo(e))return qf();for(var a of t.options)a.selected=e.includes(Es(a));return}for(a of t.options){var s=Es(a);if(iv(s,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Pv(t){var e=new MutationObserver(()=>{Wu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Au(()=>{e.disconnect()})}function Di(t,e,n=e){var a=new WeakSet,s=!0;Tu(t,"change",o=>{var c=o?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(c),Es);else{var h=t.querySelector(c)??t.querySelector("option:not([disabled])");d=h&&Es(h)}n(d),nt!==null&&a.add(nt)}),Iu(()=>{var o=e();if(t===document.activeElement){var c=ki??nt;if(a.has(c))return}if(Wu(t,o,s),s&&o===void 0){var d=t.querySelector(":checked");d!==null&&(o=Es(d),n(o))}t.__value=o,s=!1}),Pv(t)}function Es(t){return"__value"in t?t.__value:t.value}const Mv=Symbol("is custom element"),Dv=Symbol("is html");function cl(t,e,n,a){var s=jv(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[mf]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Lv(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function jv(t){return t.__attributes??(t.__attributes={[Mv]:t.nodeName.includes("-"),[Dv]:t.namespaceURI===au})}var mc=new Map;function Lv(t){var e=t.getAttribute("is")||t.nodeName,n=mc.get(e);if(n)return n;mc.set(e,n=[]);for(var a,s=t,o=Element.prototype;o!==s;){a=cf(s);for(var c in a)a[c].set&&n.push(c);s=Zc(s)}return n}function Qn(t,e,n=e){var a=new WeakSet;Tu(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=ho(t)?mo(o):o,n(o),nt!==null&&a.add(nt),await zu(),o!==(o=e())){var c=t.selectionStart,d=t.selectionEnd,h=t.value.length;if(t.value=o??"",d!==null){var m=t.value.length;c===d&&d===h&&m>h?(t.selectionStart=m,t.selectionEnd=m):(t.selectionStart=c,t.selectionEnd=Math.min(d,m))}}}),Fs(e)==null&&t.value&&(n(ho(t)?mo(t.value):t.value),nt!==null&&a.add(nt)),rl(()=>{var s=e();if(t===document.activeElement){var o=ki??nt;if(a.has(o))return}ho(t)&&s===mo(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function ho(t){var e=t.type;return e==="number"||e==="range"}function mo(t){return t===""?null:+t}function gc(t,e){return t===e||(t==null?void 0:t[ba])===e}function Hu(t={},e,n,a){return Iu(()=>{var s,o;return rl(()=>{s=o,o=[],Fs(()=>{t!==n(...o)&&(e(t,...o),s&&gc(n(...s),t)&&e(null,...s))})}),()=>{Yr(()=>{o&&gc(n(...o),t)&&e(null,...o)})}}),t}let ui=!1;function Nv(t){var e=ui;try{return ui=!1,[t(),ui]}finally{ui=e}}function Ne(t,e,n,a){var Q;var s=(n&jf)!==0,o=(n&Lf)!==0,c=a,d=!0,h=()=>(d&&(d=!1,c=o?Fs(a):a),c),m;if(s){var y=ba in t||hf in t;m=((Q=Ba(t,e))==null?void 0:Q.set)??(y&&e in t?V=>t[e]=V:void 0)}var k,b=!1;s?[k,b]=Nv(()=>t[e]):k=t[e],k===void 0&&a!==void 0&&(k=h(),m&&(Sf(),m(k)));var x;if(x=()=>{var V=t[e];return V===void 0?h():(d=!0,V)},(n&Df)===0)return x;if(m){var R=t.$$legacy;return(function(V,A){return arguments.length>0?((!A||R||b)&&m(A?x():V),V):x()})}var D=!1,F=((n&Mf)!==0?Mi:gu)(()=>(D=!1,x()));s&&u(F);var ae=At;return(function(V,A){if(arguments.length>0){const W=A?u(F):s?Nt(V):V;return C(F,W),D=!0,c!==void 0&&(c=W),V}return Zr&&D||(ae.f&Lr)!==0?F.v:u(F)})}function dn(t){Nn===null&&gf(),Ea(()=>{const e=Fs(t);if(typeof e=="function")return e})}const qv="5";var Xc;typeof window<"u"&&((Xc=window.__svelte??(window.__svelte={})).v??(Xc.v=new Set)).add(qv);var Bv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yi={exports:{}},zv=yi.exports,_c;function Uv(){return _c||(_c=1,(function(t,e){((n,a)=>{t.exports=a()})(zv,function(){var n=function(r,i){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,f){l.__proto__=f}:function(l,f){for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(l[v]=f[v])}))(r,i)},a=function(){return(a=Object.assign||function(r){for(var i,l=1,f=arguments.length;l<f;l++)for(var v in i=arguments[l])Object.prototype.hasOwnProperty.call(i,v)&&(r[v]=i[v]);return r}).apply(this,arguments)};function s(r,i,l){for(var f,v=0,_=i.length;v<_;v++)!f&&v in i||((f=f||Array.prototype.slice.call(i,0,v))[v]=i[v]);return r.concat(f||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Bv,c=Object.keys,d=Array.isArray;function h(r,i){return typeof i=="object"&&c(i).forEach(function(l){r[l]=i[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var m=Object.getPrototypeOf,y={}.hasOwnProperty;function k(r,i){return y.call(r,i)}function b(r,i){typeof i=="function"&&(i=i(m(r))),(typeof Reflect>"u"?c:Reflect.ownKeys)(i).forEach(function(l){R(r,l,i[l])})}var x=Object.defineProperty;function R(r,i,l,f){x(r,i,h(l&&k(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},f))}function D(r){return{from:function(i){return r.prototype=Object.create(i.prototype),R(r.prototype,"constructor",r),{extend:b.bind(null,r.prototype)}}}}var F=Object.getOwnPropertyDescriptor,ae=[].slice;function Q(r,i,l){return ae.call(r,i,l)}function V(r,i){return i(r)}function A(r){if(!r)throw new Error("Assertion Failed")}function W(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function re(r,i){if(typeof i=="string"&&k(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var l=[],f=0,v=i.length;f<v;++f){var _=re(r,i[f]);l.push(_)}return l}var w,S=i.indexOf(".");return S===-1||(w=r[i.substr(0,S)])==null?void 0:re(w,i.substr(S+1))}function G(r,i,l){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){A(typeof l!="string"&&"length"in l);for(var f=0,v=i.length;f<v;++f)G(r,i[f],l[f])}else{var _,w,S=i.indexOf(".");S!==-1?(_=i.substr(0,S),(S=i.substr(S+1))===""?l===void 0?d(r)&&!isNaN(parseInt(_))?r.splice(_,1):delete r[_]:r[_]=l:G(w=(w=r[_])&&k(r,_)?w:r[_]={},S,l)):l===void 0?d(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=l}}function me(r){var i,l={};for(i in r)k(r,i)&&(l[i]=r[i]);return l}var be=[].concat;function le(r){return be.apply([],r)}var fe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(le([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),de=new Set(fe.map(function(r){return o[r]})),ie=null;function ve(r){return ie=new WeakMap,r=(function i(l){if(!l||typeof l!="object")return l;var f=ie.get(l);if(f)return f;if(d(l)){f=[],ie.set(l,f);for(var v=0,_=l.length;v<_;++v)f.push(i(l[v]))}else if(de.has(l.constructor))f=l;else{var w,S=m(l);for(w in f=S===Object.prototype?{}:Object.create(S),ie.set(l,f),l)k(l,w)&&(f[w]=i(l[w]))}return f})(r),ie=null,r}var he={}.toString;function ce(r){return he.call(r).slice(8,-1)}var pe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",xe=typeof pe=="symbol"?function(r){var i;return r!=null&&(i=r[pe])&&i.apply(r)}:function(){return null};function oe(r,i){i=r.indexOf(i),0<=i&&r.splice(i,1)}var ue={};function ke(r){var i,l,f,v;if(arguments.length===1){if(d(r))return r.slice();if(this===ue&&typeof r=="string")return[r];if(v=xe(r))for(l=[];!(f=v.next()).done;)l.push(f.value);else{if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(l=new Array(i);i--;)l[i]=r[i]}}else for(i=arguments.length,l=new Array(i);i--;)l[i]=arguments[i];return l}var Se=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Xe=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fe),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function X(r,i){this.name=r,this.message=i}function z(r,i){return r+". Errors: "+Object.keys(i).map(function(l){return i[l].toString()}).filter(function(l,f,v){return v.indexOf(l)===f}).join(`
`)}function E(r,i,l,f){this.failures=i,this.failedKeys=f,this.successCount=l,this.message=z(r,i)}function Y(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(l){return i[l]}),this.failuresByPos=i,this.message=z(r,this.failures)}D(X).from(Error).extend({toString:function(){return this.name+": "+this.message}}),D(E).from(X),D(Y).from(X);var Oe=Xe.reduce(function(r,i){return r[i]=i+"Error",r},{}),Ee=X,H=Xe.reduce(function(r,i){var l=i+"Error";function f(v,_){this.name=l,v?typeof v=="string"?(this.message="".concat(v).concat(_?`
 `+_:""),this.inner=_||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=j[i]||l,this.inner=null)}return D(f).from(Ee),r[i]=f,r},{}),we=(H.Syntax=SyntaxError,H.Type=TypeError,H.Range=RangeError,fe.reduce(function(r,i){return r[i+"Error"]=H[i],r},{}));fe=Xe.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=H[i]),r},{});function J(){}function Te(r){return r}function qe(r,i){return r==null||r===Te?i:function(l){return i(r(l))}}function Ke(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function yt(r,i){return r===J?i:function(){var l=r.apply(this,arguments),f=(l!==void 0&&(arguments[0]=l),this.onsuccess),v=this.onerror,_=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return f&&(this.onsuccess=this.onsuccess?Ke(f,this.onsuccess):f),v&&(this.onerror=this.onerror?Ke(v,this.onerror):v),_!==void 0?_:l}}function Et(r,i){return r===J?i:function(){r.apply(this,arguments);var l=this.onsuccess,f=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?Ke(l,this.onsuccess):l),f&&(this.onerror=this.onerror?Ke(f,this.onerror):f)}}function bt(r,i){return r===J?i:function(v){var f=r.apply(this,arguments),v=(h(v,f),this.onsuccess),_=this.onerror,w=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?Ke(v,this.onsuccess):v),_&&(this.onerror=this.onerror?Ke(_,this.onerror):_),f===void 0?w===void 0?void 0:w:h(f,w)}}function et(r,i){return r===J?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Ve(r,i){return r===J?i:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var f=this,v=arguments.length,_=new Array(v);v--;)_[v]=arguments[v];return l.then(function(){return i.apply(f,_)})}return i.apply(this,arguments)}}fe.ModifyError=E,fe.DexieError=X,fe.BulkError=Y;var Je=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ht(r){Je=r}var Rt={},$e=100,We=typeof Promise>"u"?[]:(Xe=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[We=crypto.subtle.digest("SHA-512",new Uint8Array([0])),m(We),Xe]:[Xe,m(Xe),Xe]),Xe=We[0],ja=We[1],ja=ja&&ja.then,He=Xe&&Xe.constructor,wt=!!We[2],Bt=function(r,i){Lt.push([r,i]),Xt&&(queueMicrotask(kn),Xt=!1)},Jt=!0,Xt=!0,Ft=[],It=[],$t=Te,it={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:J,pgp:!1,env:{},finalize:J},De=it,Lt=[],Gt=0,Ze=[];function _e(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=De;if(typeof r!="function"){if(r!==Rt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Zt(this,this._value)}else this._state=null,this._value=null,++i.ref,(function l(f,v){try{v(function(_){if(f._state===null){if(_===f)throw new TypeError("A promise cannot be resolved with itself.");var w=f._lib&&Fn();_&&typeof _.then=="function"?l(f,function(S,N){_ instanceof _e?_._then(S,N):_.then(S,N)}):(f._state=!0,f._value=_,pr(f)),w&&mn()}},Zt.bind(null,f))}catch(_){Zt(f,_)}})(this,r)}var ft={get:function(){var r=De,i=ea;function l(f,v){var _=this,w=!r.global&&(r!==De||i!==ea),S=w&&!nr(),N=new _e(function($,q){Bn(_,new rn(M(f,r,w,S),M(v,r,w,S),$,q,r))});return this._consoleTask&&(N._consoleTask=this._consoleTask),N}return l.prototype=Rt,l},set:function(r){R(this,"then",r&&r.prototype===Rt?ft:{get:function(){return r},set:ft.set})}};function rn(r,i,l,f,v){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=l,this.reject=f,this.psd=v}function Zt(r,i){var l,f;It.push(i),r._state===null&&(l=r._lib&&Fn(),i=$t(i),r._state=!1,r._value=i,f=r,Ft.some(function(v){return v._value===f._value})||Ft.push(f),pr(r),l)&&mn()}function pr(r){var i=r._listeners;r._listeners=[];for(var l=0,f=i.length;l<f;++l)Bn(r,i[l]);var v=r._PSD;--v.ref||v.finalize(),Gt===0&&(++Gt,Bt(function(){--Gt==0&&zn()},[]))}function Bn(r,i){if(r._state===null)r._listeners.push(i);else{var l=r._state?i.onFulfilled:i.onRejected;if(l===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++Gt,Bt(Ot,[l,r,i])}}function Ot(r,i,l){try{var f,v=i._value;!i._state&&It.length&&(It=[]),f=Je&&i._consoleTask?i._consoleTask.run(function(){return r(v)}):r(v),i._state||It.indexOf(v)!==-1||(_=>{for(var w=Ft.length;w;)if(Ft[--w]._value===_._value)return Ft.splice(w,1)})(i),l.resolve(f)}catch(_){l.reject(_)}finally{--Gt==0&&zn(),--l.psd.ref||l.psd.finalize()}}function kn(){Ue(it,function(){Fn()&&mn()})}function Fn(){var r=Jt;return Xt=Jt=!1,r}function mn(){var r,i,l;do for(;0<Lt.length;)for(r=Lt,Lt=[],l=r.length,i=0;i<l;++i){var f=r[i];f[0].apply(null,f[1])}while(0<Lt.length);Xt=Jt=!0}function zn(){for(var r=Ft,i=(Ft=[],r.forEach(function(f){f._PSD.onunhandled.call(null,f._value,f)}),Ze.slice(0)),l=i.length;l;)i[--l]()}function Rn(r){return new _e(Rt,!1,r)}function Tt(r,i){var l=De;return function(){var f=Fn(),v=De;try{return rr(l,!0),r.apply(this,arguments)}catch(_){i&&i(_)}finally{rr(v,!1),f&&mn()}}}b(_e.prototype,{then:ft,_then:function(r,i){Bn(this,new rn(null,null,r,i,De))},catch:function(r){var i,l;return arguments.length===1?this.then(null,r):(i=r,l=arguments[1],typeof i=="function"?this.then(null,function(f){return(f instanceof i?l:Rn)(f)}):this.then(null,function(f){return(f&&f.name===i?l:Rn)(f)}))},finally:function(r){return this.then(function(i){return _e.resolve(r()).then(function(){return i})},function(i){return _e.resolve(r()).then(function(){return Rn(i)})})},timeout:function(r,i){var l=this;return r<1/0?new _e(function(f,v){var _=setTimeout(function(){return v(new H.Timeout(i))},r);l.then(f,v).finally(clearTimeout.bind(null,_))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&R(_e.prototype,Symbol.toStringTag,"Dexie.Promise"),it.env=Hs(),b(_e,{all:function(){var r=ke.apply(null,arguments).map(ta);return new _e(function(i,l){r.length===0&&i([]);var f=r.length;r.forEach(function(v,_){return _e.resolve(v).then(function(w){r[_]=w,--f||i(r)},l)})})},resolve:function(r){return r instanceof _e?r:r&&typeof r.then=="function"?new _e(function(i,l){r.then(i,l)}):new _e(Rt,!0,r)},reject:Rn,race:function(){var r=ke.apply(null,arguments).map(ta);return new _e(function(i,l){r.map(function(f){return _e.resolve(f).then(i,l)})})},PSD:{get:function(){return De},set:function(r){return De=r}},totalEchoes:{get:function(){return ea}},newPSD:tr,usePSD:Ue,scheduler:{get:function(){return Bt},set:function(r){Bt=r}},rejectionMapper:{get:function(){return $t},set:function(r){$t=r}},follow:function(r,i){return new _e(function(l,f){return tr(function(v,_){var w=De;w.unhandleds=[],w.onunhandled=_,w.finalize=Ke(function(){var S,N=this;S=function(){N.unhandleds.length===0?v():_(N.unhandleds[0])},Ze.push(function $(){S(),Ze.splice(Ze.indexOf($),1)}),++Gt,Bt(function(){--Gt==0&&zn()},[])},w.finalize),r()},i,l,f)})}}),He&&(He.allSettled&&R(_e,"allSettled",function(){var r=ke.apply(null,arguments).map(ta);return new _e(function(i){r.length===0&&i([]);var l=r.length,f=new Array(l);r.forEach(function(v,_){return _e.resolve(v).then(function(w){return f[_]={status:"fulfilled",value:w}},function(w){return f[_]={status:"rejected",reason:w}}).then(function(){return--l||i(f)})})})}),He.any&&typeof AggregateError<"u"&&R(_e,"any",function(){var r=ke.apply(null,arguments).map(ta);return new _e(function(i,l){r.length===0&&l(new AggregateError([]));var f=r.length,v=new Array(f);r.forEach(function(_,w){return _e.resolve(_).then(function(S){return i(S)},function(S){v[w]=S,--f||l(new AggregateError(v))})})})}),He.withResolvers)&&(_e.withResolvers=He.withResolvers);var Wt={awaits:0,echoes:0,id:0},Un=0,Kn=[],$r=0,ea=0,ts=0;function tr(r,w,l,f){var v=De,_=Object.create(v),w=(_.parent=v,_.ref=0,_.global=!1,_.id=++ts,it.env,_.env=wt?{Promise:_e,PromiseProp:{value:_e,configurable:!0,writable:!0},all:_e.all,race:_e.race,allSettled:_e.allSettled,any:_e.any,resolve:_e.resolve,reject:_e.reject}:{},w&&h(_,w),++v.ref,_.finalize=function(){--this.parent.ref||this.parent.finalize()},Ue(_,r,l,f));return _.ref===0&&_.finalize(),w}function fn(){return Wt.id||(Wt.id=++Un),++Wt.awaits,Wt.echoes+=$e,Wt.id}function nr(){return!!Wt.awaits&&(--Wt.awaits==0&&(Wt.id=0),Wt.echoes=Wt.awaits*$e,!0)}function ta(r){return Wt.echoes&&r&&r.constructor===He?(fn(),r.then(function(i){return nr(),i},function(i){return nr(),Me(i)})):r}function Ws(){var r=Kn[Kn.length-1];Kn.pop(),rr(r,!1)}function rr(r,i){var l,f,v=De;(i?!Wt.echoes||$r++&&r===De:!$r||--$r&&r===De)||queueMicrotask(i?(function(_){++ea,Wt.echoes&&--Wt.echoes!=0||(Wt.echoes=Wt.awaits=Wt.id=0),Kn.push(De),rr(_,!0)}).bind(null,r):Ws),r!==De&&(De=r,v===it&&(it.env=Hs()),wt)&&(l=it.env.Promise,f=r.env,v.global||r.global)&&(Object.defineProperty(o,"Promise",f.PromiseProp),l.all=f.all,l.race=f.race,l.resolve=f.resolve,l.reject=f.reject,f.allSettled&&(l.allSettled=f.allSettled),f.any)&&(l.any=f.any)}function Hs(){var r=o.Promise;return wt?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ue(r,i,l,f,v){var _=De;try{return rr(r,!0),i(l,f,v)}finally{rr(_,!1)}}function M(r,i,l,f){return typeof r!="function"?r:function(){var v=De;l&&fn(),rr(i,!0);try{return r.apply(this,arguments)}finally{rr(v,!1),f&&queueMicrotask(nr)}}}function Ie(r){Promise===He&&Wt.echoes===0?$r===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+ja).indexOf("[native code]")===-1&&(fn=nr=J);var Me=_e.reject,mt="ï¿¿",Mt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",zt="String expected.",Vt=[],xn="__dbnames",hr="readonly",na="readwrite";function jt(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var ns={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ra(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=ve(i))[r],i}}function Il(){throw H.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function dt(r,i){try{var l=Rl(r),f=Rl(i);if(l!==f)return l==="Array"?1:f==="Array"?-1:l==="binary"?1:f==="binary"?-1:l==="string"?1:f==="string"?-1:l==="Date"?1:f!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":for(var v=Ol(r),_=Ol(i),w=v.length,S=_.length,N=w<S?w:S,$=0;$<N;++$)if(v[$]!==_[$])return v[$]<_[$]?-1:1;return w===S?0:w<S?-1:1;case"Array":for(var q=r,O=i,U=q.length,K=O.length,B=U<K?U:K,L=0;L<B;++L){var te=dt(q[L],O[L]);if(te!==0)return te}return U===K?0:U<K?-1:1}}catch{}return NaN}function Rl(r){var i=typeof r;return i=="object"&&(ArrayBuffer.isView(r)||(i=ce(r))==="ArrayBuffer")?"binary":i}function Ol(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Vs(r,i,l){var f=r.schema.yProps;return f?(i&&0<l.numFailures&&(i=i.filter(function(v,_){return!l.failures[_]})),Promise.all(f.map(function(v){return v=v.updatesTable,i?r.db.table(v).where("k").anyOf(i).delete():r.db.table(v).clear()})).then(function(){return l})):l}Pl.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var l=i.add;if(d(l))return s(s([],d(r)?r:[],!0),l).sort();if(typeof l=="number")return(Number(r)||0)+l;if(typeof l=="bigint")try{return BigInt(r)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(i.remove!==void 0){var f=i.remove;if(d(f))return d(r)?r.filter(function(v){return!f.includes(v)}).sort():[];if(typeof f=="number")return Number(r)-f;if(typeof f=="bigint")try{return BigInt(r)-f}catch{return BigInt(0)-f}throw new TypeError("Invalid subtrahend ".concat(f))}return l=(l=i.replacePrefix)==null?void 0:l[0],l&&typeof r=="string"&&r.startsWith(l)?i.replacePrefix[1]+r.substring(l.length):r};var rs=Pl;function Pl(r){this["@@propmod"]=r}function Ml(r,i){for(var l=c(i),f=l.length,v=!1,_=0;_<f;++_){var w=l[_],S=i[w],N=re(r,w);S instanceof rs?(G(r,w,S.execute(N)),v=!0):N!==S&&(G(r,w,S),v=!0)}return v}Dt.prototype._trans=function(r,i,l){var f=this._tx||De.trans,v=this.name,_=Je&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function w($,q,O){if(O.schema[v])return i(O.idbtrans,O);throw new H.NotFound("Table "+v+" not part of transaction")}var S=Fn();try{var N=f&&f.db._novip===this.db._novip?f===De.trans?f._promise(r,w,l):tr(function(){return f._promise(r,w,l)},{trans:f,transless:De.transless||De}):(function $(q,O,U,K){if(q.idbdb&&(q._state.openComplete||De.letThrough||q._vip)){var B=q._createTransaction(O,U,q._dbSchema);try{B.create(),q._state.PR1398_maxLoop=3}catch(L){return L.name===Oe.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return $(q,O,U,K)})):Me(L)}return B._promise(O,function(L,te){return tr(function(){return De.trans=B,K(L,te,B)})}).then(function(L){if(O==="readwrite")try{B.idbtrans.commit()}catch{}return O==="readonly"?L:B._completion.then(function(){return L})})}if(q._state.openComplete)return Me(new H.DatabaseClosed(q._state.dbOpenError));if(!q._state.isBeingOpened){if(!q._state.autoOpen)return Me(new H.DatabaseClosed);q.open().catch(J)}return q._state.dbReadyPromise.then(function(){return $(q,O,U,K)})})(this.db,r,[this.name],w);return _&&(N._consoleTask=_,N=N.catch(function($){return console.trace($),Me($)})),N}finally{S&&mn()}},Dt.prototype.get=function(r,i){var l=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?Me(new H.Type("Invalid argument to Table.get()")):this._trans("readonly",function(f){return l.core.get({trans:f,key:r}).then(function(v){return l.hook.reading.fire(v)})}).then(i)},Dt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(d(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=c(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&i.every(function($){return 0<=S.keyPath.indexOf($)})){for(var N=0;N<i.length;++N)if(i.indexOf(S.keyPath[N])===-1)return!1;return!0}return!1}).sort(function(S,N){return S.keyPath.length-N.keyPath.length})[0];if(l&&this.db._maxKey!==mt)return w=l.keyPath.slice(0,i.length),this.where(w).equals(w.map(function(S){return r[S]}));!l&&Je&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var f=this.schema.idxByName;function v(S,N){return dt(S,N)===0}var w=i.reduce(function(q,N){var $=q[0],q=q[1],O=f[N],U=r[N];return[$||O,$||!O?jt(q,O&&O.multi?function(K){return K=re(K,N),d(K)&&K.some(function(B){return v(U,B)})}:function(K){return v(U,re(K,N))}):q]},[null,null]),_=w[0],w=w[1];return _?this.where(_.name).equals(r[_.keyPath]).filter(w):l?this.filter(w):this.where(i).equals("")},Dt.prototype.filter=function(r){return this.toCollection().and(r)},Dt.prototype.count=function(r){return this.toCollection().count(r)},Dt.prototype.offset=function(r){return this.toCollection().offset(r)},Dt.prototype.limit=function(r){return this.toCollection().limit(r)},Dt.prototype.each=function(r){return this.toCollection().each(r)},Dt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Dt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Dt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,d(r)?"[".concat(r.join("+"),"]"):r))},Dt.prototype.reverse=function(){return this.toCollection().reverse()},Dt.prototype.mapToClass=function(r){for(var i=this.db,l=this.name,f=((this.schema.mappedClass=r).prototype instanceof Il&&(r=(w=>{var S=q,N=w;if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function $(){this.constructor=S}function q(){return w!==null&&w.apply(this,arguments)||this}return n(S,N),S.prototype=N===null?Object.create(N):($.prototype=N.prototype,new $),Object.defineProperty(q.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),q.prototype.table=function(){return l},q})(r)),new Set),v=r.prototype;v;v=m(v))Object.getOwnPropertyNames(v).forEach(function(w){return f.add(w)});function _(w){if(!w)return w;var S,N=Object.create(r.prototype);for(S in w)if(!f.has(S))try{N[S]=w[S]}catch{}return N}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=_,this.hook("reading",_),r},Dt.prototype.defineClass=function(){return this.mapToClass(function(r){h(this,r)})},Dt.prototype.add=function(r,i){var l=this,f=this.schema.primKey,v=f.auto,_=f.keyPath,w=r;return _&&v&&(w=ra(_)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:i!=null?[i]:null,values:[w]})}).then(function(S){return S.numFailures?_e.reject(S.failures[0]):S.lastResult}).then(function(S){if(_)try{G(r,_,S)}catch{}return S})},Dt.prototype.upsert=function(r,i){var l=this,f=this.schema.primKey.keyPath;return this._trans("readwrite",function(v){return l.core.get({trans:v,key:r}).then(function(_){var w=_??{};return Ml(w,i),f&&G(w,f,r),l.core.mutate({trans:v,type:"put",values:[w],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[i]}}).then(function(S){return S.numFailures?_e.reject(S.failures[0]):!!_})})})},Dt.prototype.update=function(r,i){return typeof r!="object"||d(r)?this.where(":id").equals(r).modify(i):(r=re(r,this.schema.primKey.keyPath))===void 0?Me(new H.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i)},Dt.prototype.put=function(r,i){var l=this,f=this.schema.primKey,v=f.auto,_=f.keyPath,w=r;return _&&v&&(w=ra(_)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[w],keys:i!=null?[i]:null})}).then(function(S){return S.numFailures?_e.reject(S.failures[0]):S.lastResult}).then(function(S){if(_)try{G(r,_,S)}catch{}return S})},Dt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:[r]}).then(function(f){return Vs(i,[r],f)}).then(function(f){return f.numFailures?_e.reject(f.failures[0]):void 0})})},Dt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:ns}).then(function(l){return Vs(r,null,l)})}).then(function(i){return i.numFailures?_e.reject(i.failures[0]):void 0})},Dt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(l){return i.core.getMany({keys:r,trans:l}).then(function(f){return f.map(function(v){return i.hook.reading.fire(v)})})})},Dt.prototype.bulkAdd=function(r,i,l){var f=this,v=Array.isArray(i)?i:void 0,_=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=f.schema.primKey,$=S.auto,S=S.keyPath;if(S&&v)throw new H.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,$=S&&$?r.map(ra(S)):r;return f.core.mutate({trans:w,type:"add",keys:v,values:$,wantResults:_}).then(function(q){var O=q.numFailures,U=q.failures;if(O===0)return _?q.results:q.lastResult;throw new Y("".concat(f.name,".bulkAdd(): ").concat(O," of ").concat(N," operations failed"),U)})})},Dt.prototype.bulkPut=function(r,i,l){var f=this,v=Array.isArray(i)?i:void 0,_=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=f.schema.primKey,$=S.auto,S=S.keyPath;if(S&&v)throw new H.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,$=S&&$?r.map(ra(S)):r;return f.core.mutate({trans:w,type:"put",keys:v,values:$,wantResults:_}).then(function(q){var O=q.numFailures,U=q.failures;if(O===0)return _?q.results:q.lastResult;throw new Y("".concat(f.name,".bulkPut(): ").concat(O," of ").concat(N," operations failed"),U)})})},Dt.prototype.bulkUpdate=function(r){var i=this,l=this.core,f=r.map(function(w){return w.key}),v=r.map(function(w){return w.changes}),_=[];return this._trans("readwrite",function(w){return l.getMany({trans:w,keys:f,cache:"clone"}).then(function(S){var N=[],$=[],q=(r.forEach(function(O,U){var K=O.key,B=O.changes,L=S[U];if(L){for(var te=0,se=Object.keys(B);te<se.length;te++){var Z=se[te],ye=B[Z];if(Z===i.schema.primKey.keyPath){if(dt(ye,K)!==0)throw new H.Constraint("Cannot update primary key in bulkUpdate()")}else G(L,Z,ye)}_.push(U),N.push(K),$.push(L)}}),N.length);return l.mutate({trans:w,type:"put",keys:N,values:$,updates:{keys:f,changeSpecs:v}}).then(function(O){var U=O.numFailures,K=O.failures;if(U===0)return q;for(var B=0,L=Object.keys(K);B<L.length;B++){var te,se=L[B],Z=_[Number(se)];Z!=null&&(te=K[se],delete K[se],K[Z]=te)}throw new Y("".concat(i.name,".bulkUpdate(): ").concat(U," of ").concat(q," operations failed"),K)})})})},Dt.prototype.bulkDelete=function(r){var i=this,l=r.length;return this._trans("readwrite",function(f){return i.core.mutate({trans:f,type:"delete",keys:r}).then(function(v){return Vs(i,r,v)})}).then(function(f){var v=f.numFailures,_=f.failures;if(v===0)return f.lastResult;throw new Y("".concat(i.name,".bulkDelete(): ").concat(v," of ").concat(l," operations failed"),_)})};var Dl=Dt;function Dt(){}function as(r){function i(w,S){if(S){for(var N=arguments.length,$=new Array(N-1);--N;)$[N-1]=arguments[N];return l[w].subscribe.apply(null,$),r}if(typeof w=="string")return l[w]}var l={};i.addEventType=_;for(var f=1,v=arguments.length;f<v;++f)_(arguments[f]);return i;function _(w,S,N){var $,q;if(typeof w!="object")return S=S||et,q={subscribers:[],fire:N=N||J,subscribe:function(O){q.subscribers.indexOf(O)===-1&&(q.subscribers.push(O),q.fire=S(q.fire,O))},unsubscribe:function(O){q.subscribers=q.subscribers.filter(function(U){return U!==O}),q.fire=q.subscribers.reduce(S,N)}},l[w]=i[w]=q;c($=w).forEach(function(O){var U=$[O];if(d(U))_(O,$[O][0],$[O][1]);else{if(U!=="asap")throw new H.InvalidArgument("Invalid event config");var K=_(O,Te,function(){for(var B=arguments.length,L=new Array(B);B--;)L[B]=arguments[B];K.subscribers.forEach(function(te){W(function(){te.apply(null,L)})})})}})}}function ss(r,i){return D(i).from({prototype:r}),i}function Pa(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function Fi(r,i){r.filter=jt(r.filter,i)}function zi(r,i,l){var f=r.replayFilter;r.replayFilter=f?function(){return jt(f(),i())}:i,r.justLimit=l&&!f}function Ys(r,i){if(r.isPrimKey)return i.primaryKey;var l=i.getIndexByKeyPath(r.index);if(l)return l;throw new H.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed")}function jl(r,i,l){var f=Ys(r,i.schema);return i.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:f,range:r.range}})}function Qs(r,i,l,f){var v,_,w=r.replayFilter?jt(r.filter,r.replayFilter()):r.filter;return r.or?(v={},_=function(S,N,$){var q,O;w&&!w(N,$,function(U){return N.stop(U)},function(U){return N.fail(U)})||((O=""+(q=N.primaryKey))=="[object ArrayBuffer]"&&(O=""+new Uint8Array(q)),k(v,O))||(v[O]=!0,i(S,N,$))},Promise.all([r.or._iterate(_,l),Ll(jl(r,f,l),r.algorithm,_,!r.keysOnly&&r.valueMapper)])):Ll(jl(r,f,l),jt(r.algorithm,w),i,!r.keysOnly&&r.valueMapper)}function Ll(r,i,l,f){var v=Tt(f?function(_,w,S){return l(f(_),w,S)}:l);return r.then(function(_){if(_)return _.start(function(){var w=function(){return _.continue()};i&&!i(_,function(S){return w=S},function(S){_.stop(S),w=J},function(S){_.fail(S),w=J})||v(_.value,_,function(S){return w=S}),w()})})}gt.prototype._read=function(r,i){var l=this._ctx;return l.error?l.table._trans(null,Me.bind(null,l.error)):l.table._trans("readonly",r).then(i)},gt.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,Me.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},gt.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=jt(i.algorithm,r)},gt.prototype._iterate=function(r,i){return Qs(this._ctx,r,i,this._ctx.table.core)},gt.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&h(l,r),i._ctx=l,i},gt.prototype.raw=function(){return this._ctx.valueMapper=null,this},gt.prototype.each=function(r){var i=this._ctx;return this._read(function(l){return Qs(i,r,l,i.table.core)})},gt.prototype.count=function(r){var i=this;return this._read(function(l){var f,v=i._ctx,_=v.table.core;return Pa(v,!0)?_.count({trans:l,query:{index:Ys(v,_.schema),range:v.range}}).then(function(w){return Math.min(w,v.limit)}):(f=0,Qs(v,function(){return++f,!1},l,_).then(function(){return f}))}).then(r)},gt.prototype.sortBy=function(r,i){var l=r.split(".").reverse(),f=l[0],v=l.length-1;function _(N,$){return $?_(N[l[$]],$-1):N[f]}var w=this._ctx.dir==="next"?1:-1;function S(N,$){return dt(_(N,v),_($,v))*w}return this.toArray(function(N){return N.sort(S)}).then(i)},gt.prototype.toArray=function(r){var i=this;return this._read(function(l){var f,v,_,w=i._ctx;return w.dir==="next"&&Pa(w,!0)&&0<w.limit?(f=w.valueMapper,v=Ys(w,w.table.core.schema),w.table.core.query({trans:l,limit:w.limit,values:!0,query:{index:v,range:w.range}}).then(function(S){return S=S.result,f?S.map(f):S})):(_=[],Qs(w,function(S){return _.push(S)},l,w.table.core).then(function(){return _}))},r)},gt.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,Pa(i)?zi(i,function(){var l=r;return function(f,v){return l===0||(l===1?--l:v(function(){f.advance(l),l=0}),!1)}}):zi(i,function(){var l=r;return function(){return--l<0}})),this},gt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),zi(this._ctx,function(){var i=r;return function(l,f,v){return--i<=0&&f(v),0<=i}},!0),this},gt.prototype.until=function(r,i){return Fi(this._ctx,function(l,f,v){return!r(l.value)||(f(v),i)}),this},gt.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},gt.prototype.last=function(r){return this.reverse().first(r)},gt.prototype.filter=function(r){var i;return Fi(this._ctx,function(l){return r(l.value)}),(i=this._ctx).isMatch=jt(i.isMatch,r),this},gt.prototype.and=function(r){return this.filter(r)},gt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},gt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},gt.prototype.desc=function(){return this.reverse()},gt.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,f){r(f.key,f)})},gt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},gt.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,f){r(f.primaryKey,f)})},gt.prototype.keys=function(r){var i=this._ctx,l=(i.keysOnly=!i.isMatch,[]);return this.each(function(f,v){l.push(v.key)}).then(function(){return l}).then(r)},gt.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&Pa(i,!0)&&0<i.limit)return this._read(function(f){var v=Ys(i,i.table.core.schema);return i.table.core.query({trans:f,values:!1,limit:i.limit,query:{index:v,range:i.range}})}).then(function(f){return f.result}).then(r);i.keysOnly=!i.isMatch;var l=[];return this.each(function(f,v){l.push(v.primaryKey)}).then(function(){return l}).then(r)},gt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},gt.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},gt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},gt.prototype.distinct=function(){var r,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(r={},Fi(this._ctx,function(f){var f=f.primaryKey.toString(),v=k(r,f);return r[f]=!0,!v})),this},gt.prototype.modify=function(r){var i=this,l=this._ctx;return this._write(function(f){function v(L,te){var se=te.failures;U+=L-te.numFailures;for(var Z=0,ye=c(se);Z<ye.length;Z++){var Ae=ye[Z];O.push(se[Ae])}}var _=typeof r=="function"?r:function(L){return Ml(L,r)},w=l.table.core,q=w.schema.primaryKey,S=q.outbound,N=q.extractKey,$=200,q=i.db._options.modifyChunkSize,O=(q&&($=typeof q=="object"?q[w.name]||q["*"]||200:q),[]),U=0,K=[],B=r===Nl;return i.clone().primaryKeys().then(function(L){function te(Z){var ye=Math.min($,L.length-Z),Ae=L.slice(Z,Z+ye);return(B?Promise.resolve([]):w.getMany({trans:f,keys:Ae,cache:"immutable"})).then(function(je){var Le=[],Ce=[],Fe=S?[]:null,Be=B?Ae:[];if(!B)for(var Re=0;Re<ye;++Re){var ze=je[Re],vt={value:ve(ze),primKey:L[Z+Re]};_.call(vt,vt.value,vt)!==!1&&(vt.value==null?Be.push(L[Z+Re]):S||dt(N(ze),N(vt.value))===0?(Ce.push(vt.value),S&&Fe.push(L[Z+Re])):(Be.push(L[Z+Re]),Le.push(vt.value)))}return Promise.resolve(0<Le.length&&w.mutate({trans:f,type:"add",values:Le}).then(function(_t){for(var Ye in _t.failures)Be.splice(parseInt(Ye),1);v(Le.length,_t)})).then(function(){return(0<Ce.length||se&&typeof r=="object")&&w.mutate({trans:f,type:"put",keys:Fe,values:Ce,criteria:se,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<Z}).then(function(_t){return v(Ce.length,_t)})}).then(function(){return(0<Be.length||se&&B)&&w.mutate({trans:f,type:"delete",keys:Be,criteria:se,isAdditionalChunk:0<Z}).then(function(_t){return Vs(l.table,Be,_t)}).then(function(_t){return v(Be.length,_t)})}).then(function(){return L.length>Z+ye&&te(Z+$)})})}var se=Pa(l)&&l.limit===1/0&&(typeof r!="function"||B)&&{index:l.index,range:l.range};return te(0).then(function(){if(0<O.length)throw new E("Error modifying one or more objects",O,U,K);return L.length})})})},gt.prototype.delete=function(){var r=this._ctx,i=r.range;return!Pa(r)||r.table.schema.yProps||!r.isPrimKey&&i.type!==3?this.modify(Nl):this._write(function(l){var f=r.table.core.schema.primaryKey,v=i;return r.table.core.count({trans:l,query:{index:f,range:v}}).then(function(_){return r.table.core.mutate({trans:l,type:"deleteRange",range:v}).then(function(N){var S=N.failures,N=N.numFailures;if(N)throw new E("Could not delete some values",Object.keys(S).map(function($){return S[$]}),_-N);return _-N})})})};var qd=gt;function gt(){}var Nl=function(r,i){return i.value=null};function Bd(r,i){return r<i?-1:r===i?0:1}function Fd(r,i){return i<r?-1:r===i?0:1}function On(r,i,l){return r=r instanceof Bl?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(i),r}function Ma(r){return new r.Collection(r,function(){return ql("")}).limit(0)}function Xs(K,i,l,f){var v,_,w,S,N,$,q,O=l.length;if(!l.every(function(L){return typeof L=="string"}))return On(K,zt);function U(L){v=L==="next"?function(se){return se.toUpperCase()}:function(se){return se.toLowerCase()},_=L==="next"?function(se){return se.toLowerCase()}:function(se){return se.toUpperCase()},w=L==="next"?Bd:Fd;var te=l.map(function(se){return{lower:_(se),upper:v(se)}}).sort(function(se,Z){return w(se.lower,Z.lower)});S=te.map(function(se){return se.upper}),N=te.map(function(se){return se.lower}),q=($=L)==="next"?"":f}U("next");var K=new K.Collection(K,function(){return Fr(S[0],N[O-1]+f)}),B=(K._ondirectionchange=function(L){U(L)},0);return K._addAlgorithm(function(L,te,se){var Z=L.key;if(typeof Z=="string"){var ye=_(Z);if(i(ye,N,B))return!0;for(var Ae=null,je=B;je<O;++je){var Le=((Ce,Fe,Be,Re,ze,vt)=>{for(var _t=Math.min(Ce.length,Re.length),Ye=-1,rt=0;rt<_t;++rt){var Ut=Fe[rt];if(Ut!==Re[rt])return ze(Ce[rt],Be[rt])<0?Ce.substr(0,rt)+Be[rt]+Be.substr(rt+1):ze(Ce[rt],Re[rt])<0?Ce.substr(0,rt)+Re[rt]+Be.substr(rt+1):0<=Ye?Ce.substr(0,Ye)+Fe[Ye]+Be.substr(Ye+1):null;ze(Ce[rt],Ut)<0&&(Ye=rt)}return _t<Re.length&&vt==="next"?Ce+Be.substr(Ce.length):_t<Ce.length&&vt==="prev"?Ce.substr(0,Be.length):Ye<0?null:Ce.substr(0,Ye)+Re[Ye]+Be.substr(Ye+1)})(Z,ye,S[je],N[je],w,$);Le===null&&Ae===null?B=je+1:(Ae===null||0<w(Ae,Le))&&(Ae=Le)}te(Ae!==null?function(){L.continue(Ae+q)}:se)}return!1}),K}function Fr(r,i,l,f){return{type:2,lower:r,upper:i,lowerOpen:l,upperOpen:f}}function ql(r){return{type:1,lower:r,upper:r}}Object.defineProperty(en.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),en.prototype.between=function(r,i,l,f){l=l!==!1,f=f===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(l||f)&&(!l||!f)?Ma(this):new this.Collection(this,function(){return Fr(r,i,!l,!f)})}catch{return On(this,Mt)}},en.prototype.equals=function(r){return r==null?On(this,Mt):new this.Collection(this,function(){return ql(r)})},en.prototype.above=function(r){return r==null?On(this,Mt):new this.Collection(this,function(){return Fr(r,void 0,!0)})},en.prototype.aboveOrEqual=function(r){return r==null?On(this,Mt):new this.Collection(this,function(){return Fr(r,void 0,!1)})},en.prototype.below=function(r){return r==null?On(this,Mt):new this.Collection(this,function(){return Fr(void 0,r,!1,!0)})},en.prototype.belowOrEqual=function(r){return r==null?On(this,Mt):new this.Collection(this,function(){return Fr(void 0,r)})},en.prototype.startsWith=function(r){return typeof r!="string"?On(this,zt):this.between(r,r+mt,!0,!0)},en.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Xs(this,function(i,l){return i.indexOf(l[0])===0},[r],mt)},en.prototype.equalsIgnoreCase=function(r){return Xs(this,function(i,l){return i===l[0]},[r],"")},en.prototype.anyOfIgnoreCase=function(){var r=ke.apply(ue,arguments);return r.length===0?Ma(this):Xs(this,function(i,l){return l.indexOf(i)!==-1},r,"")},en.prototype.startsWithAnyOfIgnoreCase=function(){var r=ke.apply(ue,arguments);return r.length===0?Ma(this):Xs(this,function(i,l){return l.some(function(f){return i.indexOf(f)===0})},r,mt)},en.prototype.anyOf=function(){var r,i,l=this,f=ke.apply(ue,arguments),v=this._cmp;try{f.sort(v)}catch{return On(this,Mt)}return f.length===0?Ma(this):((r=new this.Collection(this,function(){return Fr(f[0],f[f.length-1])}))._ondirectionchange=function(_){v=_==="next"?l._ascending:l._descending,f.sort(v)},i=0,r._addAlgorithm(function(_,w,S){for(var N=_.key;0<v(N,f[i]);)if(++i===f.length)return w(S),!1;return v(N,f[i])===0||(w(function(){_.continue(f[i])}),!1)}),r)},en.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},en.prototype.noneOf=function(){var r=ke.apply(ue,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return On(this,Mt)}var i=r.reduce(function(l,f){return l?l.concat([[l[l.length-1][1],f]]):[[-1/0,f]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},en.prototype.inAnyRange=function(r,se){var l=this,f=this._cmp,v=this._ascending,_=this._descending,w=this._min,S=this._max;if(r.length===0)return Ma(this);if(!r.every(function(Z){return Z[0]!==void 0&&Z[1]!==void 0&&v(Z[0],Z[1])<=0}))return On(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",H.InvalidArgument);var N=!se||se.includeLowers!==!1,$=se&&se.includeUppers===!0,q,O=v;function U(Z,ye){return O(Z[0],ye[0])}try{(q=r.reduce(function(Z,ye){for(var Ae=0,je=Z.length;Ae<je;++Ae){var Le=Z[Ae];if(f(ye[0],Le[1])<0&&0<f(ye[1],Le[0])){Le[0]=w(Le[0],ye[0]),Le[1]=S(Le[1],ye[1]);break}}return Ae===je&&Z.push(ye),Z},[])).sort(U)}catch{return On(this,Mt)}var K=0,B=$?function(Z){return 0<v(Z,q[K][1])}:function(Z){return 0<=v(Z,q[K][1])},L=N?function(Z){return 0<_(Z,q[K][0])}:function(Z){return 0<=_(Z,q[K][0])},te=B,se=new this.Collection(this,function(){return Fr(q[0][0],q[q.length-1][1],!N,!$)});return se._ondirectionchange=function(Z){O=Z==="next"?(te=B,v):(te=L,_),q.sort(U)},se._addAlgorithm(function(Z,ye,Ae){for(var je,Le=Z.key;te(Le);)if(++K===q.length)return ye(Ae),!1;return!B(je=Le)&&!L(je)||(l._cmp(Le,q[K][1])===0||l._cmp(Le,q[K][0])===0||ye(function(){O===v?Z.continue(q[K][0]):Z.continue(q[K][1])}),!1)}),se},en.prototype.startsWithAnyOf=function(){var r=ke.apply(ue,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Ma(this):this.inAnyRange(r.map(function(i){return[i,i+mt]})):On(this,"startsWithAnyOf() only works with strings")};var Bl=en;function en(){}function mr(r){return Tt(function(i){return is(i),r(i.target.error),!1})}function is(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var os="storagemutated",Ui="x-storagemutated-1",zr=as(null,os),zd=(gr.prototype._lock=function(){return A(!De.global),++this._reculock,this._reculock!==1||De.global||(De.lockOwnerFor=this),this},gr.prototype._unlock=function(){if(A(!De.global),--this._reculock==0)for(De.global||(De.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ue(r[1],r[0])}catch{}}return this},gr.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},gr.prototype.create=function(r){var i=this;if(this.mode){var l=this.db.idbdb,f=this.db._state.dbOpenError;if(A(!this.idbtrans),!r&&!l)switch(f&&f.name){case"DatabaseClosedError":throw new H.DatabaseClosed(f);case"MissingAPIError":throw new H.MissingAPI(f.message,f);default:throw new H.OpenFailed(f)}if(!this.active)throw new H.TransactionInactive;A(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Tt(function(v){is(v),i._reject(r.error)}),r.onabort=Tt(function(v){is(v),i.active&&i._reject(new H.Abort(r.error)),i.active=!1,i.on("abort").fire(v)}),r.oncomplete=Tt(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&zr.storagemutated.fire(r.mutatedParts)})}return this},gr.prototype._promise=function(r,i,l){var f,v=this;return r==="readwrite"&&this.mode!=="readwrite"?Me(new H.ReadOnly("Transaction is readonly")):this.active?this._locked()?new _e(function(_,w){v._blockedFuncs.push([function(){v._promise(r,i,l).then(_,w)},De])}):l?tr(function(){var _=new _e(function(w,S){v._lock();var N=i(w,S,v);N&&N.then&&N.then(w,S)});return _.finally(function(){return v._unlock()}),_._lib=!0,_}):((f=new _e(function(_,w){var S=i(_,w,v);S&&S.then&&S.then(_,w)}))._lib=!0,f):Me(new H.TransactionInactive)},gr.prototype._root=function(){return this.parent?this.parent._root():this},gr.prototype.waitFor=function(r){var i,l=this._root(),f=_e.resolve(r),v=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return f}):(l._waitingFor=f,l._waitingQueue=[],i=l.idbtrans.objectStore(l.storeNames[0]),(function _(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(i.get(-1/0).onsuccess=_)})()),l._waitingFor);return new _e(function(_,w){f.then(function(S){return l._waitingQueue.push(Tt(_.bind(null,S)))},function(S){return l._waitingQueue.push(Tt(w.bind(null,S)))}).finally(function(){l._waitingFor===v&&(l._waitingFor=null)})})},gr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new H.Abort))},gr.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(k(i,r))return i[r];var l=this.schema[r];if(l)return(l=new this.db.Table(r,l,this)).core=this.db.core.table(r),i[r]=l;throw new H.NotFound("Table "+r+" not part of transaction")},gr);function gr(){}function Ki(r,i,l,f,v,_,w,S){return{name:r,keyPath:i,unique:l,multi:f,auto:v,compound:_,src:(l&&!w?"&":"")+(f?"*":"")+(v?"++":"")+Fl(i),type:S}}function Fl(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Gi(r,i,l){return{name:r,primKey:i,indexes:l,mappedClass:null,idxByName:(f=function(v){return[v.name,v]},l.reduce(function(v,_,w){return _=f(_,w),_&&(v[_[0]]=_[1]),v},{}))};var f}var ls=function(r){try{return r.only([[]]),ls=function(){return[[]]},[[]]}catch{return ls=function(){return mt},mt}};function Wi(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(l){return l[i]}:function(l){return re(l,i)}:function(l){return re(l,r)};var i}function zl(r){return[].slice.call(r)}var Ud=0;function cs(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Kd(r,i,N){function f(B){if(B.type===3)return null;if(B.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var O=B.lower,U=B.upper,K=B.lowerOpen,B=B.upperOpen;return O===void 0?U===void 0?null:i.upperBound(U,!!B):U===void 0?i.lowerBound(O,!!K):i.bound(O,U,!!K,!!B)}function v(q){var O,U=q.name;return{name:U,schema:q,mutate:function(K){var B=K.trans,L=K.type,te=K.keys,se=K.values,Z=K.range;return new Promise(function(ye,Ae){ye=Tt(ye);var je=B.objectStore(U),Le=je.keyPath==null,Ce=L==="put"||L==="add";if(!Ce&&L!=="delete"&&L!=="deleteRange")throw new Error("Invalid operation type: "+L);var Fe,Be=(te||se||{length:1}).length;if(te&&se&&te.length!==se.length)throw new Error("Given keys array must have same length as given values array.");if(Be===0)return ye({numFailures:0,failures:{},results:[],lastResult:void 0});function Re(Ht){++_t,is(Ht)}var ze=[],vt=[],_t=0;if(L==="deleteRange"){if(Z.type===4)return ye({numFailures:_t,failures:vt,results:[],lastResult:void 0});Z.type===3?ze.push(Fe=je.clear()):ze.push(Fe=je.delete(f(Z)))}else{var Le=Ce?Le?[se,te]:[se,null]:[te,null],Ye=Le[0],rt=Le[1];if(Ce)for(var Ut=0;Ut<Be;++Ut)ze.push(Fe=rt&&rt[Ut]!==void 0?je[L](Ye[Ut],rt[Ut]):je[L](Ye[Ut])),Fe.onerror=Re;else for(Ut=0;Ut<Be;++Ut)ze.push(Fe=je[L](Ye[Ut])),Fe.onerror=Re}function Gn(Ht){Ht=Ht.target.result,ze.forEach(function(ia,co){return ia.error!=null&&(vt[co]=ia.error)}),ye({numFailures:_t,failures:vt,results:L==="delete"?te:ze.map(function(ia){return ia.result}),lastResult:Ht})}Fe.onerror=function(Ht){Re(Ht),Gn(Ht)},Fe.onsuccess=Gn})},getMany:function(K){var B=K.trans,L=K.keys;return new Promise(function(te,se){te=Tt(te);for(var Z,ye=B.objectStore(U),Ae=L.length,je=new Array(Ae),Le=0,Ce=0,Fe=function(ze){ze=ze.target,je[ze._pos]=ze.result,++Ce===Le&&te(je)},Be=mr(se),Re=0;Re<Ae;++Re)L[Re]!=null&&((Z=ye.get(L[Re]))._pos=Re,Z.onsuccess=Fe,Z.onerror=Be,++Le);Le===0&&te(je)})},get:function(K){var B=K.trans,L=K.key;return new Promise(function(te,se){te=Tt(te);var Z=B.objectStore(U).get(L);Z.onsuccess=function(ye){return te(ye.target.result)},Z.onerror=mr(se)})},query:(O=S,function(K){return new Promise(function(B,L){B=Tt(B);var te,se,Z,Ce=K.trans,ye=K.values,Ae=K.limit,Le=K.query,je=Ae===1/0?void 0:Ae,Fe=Le.index,Le=Le.range,Ce=Ce.objectStore(U),Ce=Fe.isPrimaryKey?Ce:Ce.index(Fe.name),Fe=f(Le);if(Ae===0)return B({result:[]});O?((Le=ye?Ce.getAll(Fe,je):Ce.getAllKeys(Fe,je)).onsuccess=function(Be){return B({result:Be.target.result})},Le.onerror=mr(L)):(te=0,se=!ye&&"openKeyCursor"in Ce?Ce.openKeyCursor(Fe):Ce.openCursor(Fe),Z=[],se.onsuccess=function(Be){var Re=se.result;return!Re||(Z.push(ye?Re.value:Re.primaryKey),++te===Ae)?B({result:Z}):void Re.continue()},se.onerror=mr(L))})}),openCursor:function(K){var B=K.trans,L=K.values,te=K.query,se=K.reverse,Z=K.unique;return new Promise(function(ye,Ae){ye=Tt(ye);var Ce=te.index,je=te.range,Le=B.objectStore(U),Le=Ce.isPrimaryKey?Le:Le.index(Ce.name),Ce=se?Z?"prevunique":"prev":Z?"nextunique":"next",Fe=!L&&"openKeyCursor"in Le?Le.openKeyCursor(f(je),Ce):Le.openCursor(f(je),Ce);Fe.onerror=mr(Ae),Fe.onsuccess=Tt(function(Be){var Re,ze,vt,_t,Ye=Fe.result;Ye?(Ye.___id=++Ud,Ye.done=!1,Re=Ye.continue.bind(Ye),ze=(ze=Ye.continuePrimaryKey)&&ze.bind(Ye),vt=Ye.advance.bind(Ye),_t=function(){throw new Error("Cursor not stopped")},Ye.trans=B,Ye.stop=Ye.continue=Ye.continuePrimaryKey=Ye.advance=function(){throw new Error("Cursor not started")},Ye.fail=Tt(Ae),Ye.next=function(){var rt=this,Ut=1;return this.start(function(){return Ut--?rt.continue():rt.stop()}).then(function(){return rt})},Ye.start=function(rt){function Ut(){if(Fe.result)try{rt()}catch(Ht){Ye.fail(Ht)}else Ye.done=!0,Ye.start=function(){throw new Error("Cursor behind last entry")},Ye.stop()}var Gn=new Promise(function(Ht,ia){Ht=Tt(Ht),Fe.onerror=mr(ia),Ye.fail=ia,Ye.stop=function(co){Ye.stop=Ye.continue=Ye.continuePrimaryKey=Ye.advance=_t,Ht(co)}});return Fe.onsuccess=Tt(function(Ht){Fe.onsuccess=Ut,Ut()}),Ye.continue=Re,Ye.continuePrimaryKey=ze,Ye.advance=vt,Ut(),Gn},ye(Ye)):ye(null)},Ae)})},count:function(K){var B=K.query,L=K.trans,te=B.index,se=B.range;return new Promise(function(Z,ye){var Ae=L.objectStore(U),Ae=te.isPrimaryKey?Ae:Ae.index(te.name),je=f(se),je=je?Ae.count(je):Ae.count();je.onsuccess=Tt(function(Le){return Z(Le.target.result)}),je.onerror=mr(ye)})}}}_=N,w=zl((N=r).objectStoreNames);var _,N={schema:{name:N.name,tables:w.map(function(q){return _.objectStore(q)}).map(function(q){var O=q.keyPath,U=q.autoIncrement,B=d(O),K={},B={name:q.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O==null,compound:B,keyPath:O,autoIncrement:U,unique:!0,extractKey:Wi(O)},indexes:zl(q.indexNames).map(function(L){return q.index(L)}).map(function(Z){var ye=Z.name,te=Z.unique,se=Z.multiEntry,Z=Z.keyPath,ye={name:ye,compound:d(Z),keyPath:Z,unique:te,multiEntry:se,extractKey:Wi(Z)};return K[cs(Z)]=ye}),getIndexByKeyPath:function(L){return K[cs(L)]}};return K[":id"]=B.primaryKey,O!=null&&(K[cs(O)]=B.primaryKey),B})},hasGetAll:0<w.length&&"getAll"in _.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},w=N.schema,S=N.hasGetAll,N=w.tables.map(v),$={};return N.forEach(function(q){return $[q.name]=q}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(q){if($[q])return $[q];throw new Error("Table '".concat(q,"' not found"))},MIN_KEY:-1/0,MAX_KEY:ls(i),schema:w}}function Gd(r,i,l,f){return l=l.IDBKeyRange,i=Kd(i,l,f),{dbcore:r.dbcore.reduce(function(v,_){return _=_.create,a(a({},v),_(v))},i)}}function Zs(r,i){var l=i.db,l=Gd(r._middlewares,l,r._deps,i);r.core=l.dbcore,r.tables.forEach(function(f){var v=f.name;r.core.schema.tables.some(function(_){return _.name===v})&&(f.core=r.core.table(v),r[v]instanceof r.Table)&&(r[v].core=f.core)})}function Js(r,i,l,f){l.forEach(function(v){var _=f[v];i.forEach(function(w){var S=(function N($,q){return F($,q)||($=m($))&&N($,q)})(w,v);(!S||"value"in S&&S.value===void 0)&&(w===r.Transaction.prototype||w instanceof r.Transaction?R(w,v,{get:function(){return this.table(v)},set:function(N){x(this,v,{value:N,writable:!0,configurable:!0,enumerable:!0})}}):w[v]=new r.Table(v,_))})})}function Hi(r,i){i.forEach(function(l){for(var f in l)l[f]instanceof r.Table&&delete l[f]})}function Wd(r,i){return r._cfg.version-i._cfg.version}function Hd(r,i,l,f){var v=r._dbSchema,_=(l.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=Gi("$meta",Kl("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,v)),w=(_.create(l),_._completion.catch(f),_._reject.bind(_)),S=De.transless||De;tr(function(){if(De.trans=_,De.transless=S,i!==0)return Zs(r,l),$=i,((N=_).storeNames.includes("$meta")?N.table("$meta").get("version").then(function(q){return q??$}):_e.resolve($)).then(function(te){var O=r,U=te,K=_,B=l,L=[],te=O._versions,se=O._dbSchema=ei(0,O.idbdb,B);return(te=te.filter(function(Z){return Z._cfg.version>=U})).length===0?_e.resolve():(te.forEach(function(Z){L.push(function(){var ye,Ae,je,Le=se,Ce=Z._cfg.dbschema,Fe=(ti(O,Le,B),ti(O,Ce,B),se=O._dbSchema=Ce,Vi(Le,Ce)),Be=(Fe.add.forEach(function(Re){Yi(B,Re[0],Re[1].primKey,Re[1].indexes)}),Fe.change.forEach(function(Re){if(Re.recreate)throw new H.Upgrade("Not yet support for changing primary key");var ze=B.objectStore(Re.name);Re.add.forEach(function(vt){return $s(ze,vt)}),Re.change.forEach(function(vt){ze.deleteIndex(vt.name),$s(ze,vt)}),Re.del.forEach(function(vt){return ze.deleteIndex(vt)})}),Z._cfg.contentUpgrade);if(Be&&Z._cfg.version>U)return Zs(O,B),K._memoizedTables={},ye=me(Ce),Fe.del.forEach(function(Re){ye[Re]=Le[Re]}),Hi(O,[O.Transaction.prototype]),Js(O,[O.Transaction.prototype],c(ye),ye),K.schema=ye,(Ae=Se(Be))&&fn(),Ce=_e.follow(function(){var Re;(je=Be(K))&&Ae&&(Re=nr.bind(null,null),je.then(Re,Re))}),je&&typeof je.then=="function"?_e.resolve(je):Ce.then(function(){return je})}),L.push(function(ye){var Ae,je,Le=Z._cfg.dbschema;Ae=Le,je=ye,[].slice.call(je.db.objectStoreNames).forEach(function(Ce){return Ae[Ce]==null&&je.db.deleteObjectStore(Ce)}),Hi(O,[O.Transaction.prototype]),Js(O,[O.Transaction.prototype],O._storeNames,O._dbSchema),K.schema=O._dbSchema}),L.push(function(ye){O.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(O.idbdb.version/10)===Z._cfg.version?(O.idbdb.deleteObjectStore("$meta"),delete O._dbSchema.$meta,O._storeNames=O._storeNames.filter(function(Ae){return Ae!=="$meta"})):ye.objectStore("$meta").put(Z._cfg.version,"version"))})}),(function Z(){return L.length?_e.resolve(L.shift()(K.idbtrans)).then(Z):_e.resolve()})().then(function(){Ul(se,B)}))}).catch(w);var N,$;c(v).forEach(function(q){Yi(l,q,v[q].primKey,v[q].indexes)}),Zs(r,l),_e.follow(function(){return r.on.populate.fire(_)}).catch(w)})}function Vd(r,i){Ul(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var l=ei(0,r.idbdb,i);ti(r,r._dbSchema,i);for(var f=0,v=Vi(l,r._dbSchema).change;f<v.length;f++){var _=(w=>{if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=i.objectStore(w.name);w.add.forEach(function(N){Je&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(N.src)),$s(S,N)})})(v[f]);if(typeof _=="object")return _.value}}function Vi(r,i){var l,f={del:[],add:[],change:[]};for(l in r)i[l]||f.del.push(l);for(l in i){var v=r[l],_=i[l];if(v){var w={name:l,def:_,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(_.primKey.keyPath||"")||v.primKey.auto!==_.primKey.auto)w.recreate=!0,f.change.push(w);else{var S=v.idxByName,N=_.idxByName,$=void 0;for($ in S)N[$]||w.del.push($);for($ in N){var q=S[$],O=N[$];q?q.src!==O.src&&w.change.push(O):w.add.push(O)}(0<w.del.length||0<w.add.length||0<w.change.length)&&f.change.push(w)}}else f.add.push([l,_])}return f}function Yi(r,i,l,f){var v=r.db.createObjectStore(i,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});f.forEach(function(_){return $s(v,_)})}function Ul(r,i){c(r).forEach(function(l){i.db.objectStoreNames.contains(l)||(Je&&console.debug("Dexie: Creating missing table",l),Yi(i,l,r[l].primKey,r[l].indexes))})}function $s(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function ei(r,i,l){var f={};return Q(i.objectStoreNames,0).forEach(function(v){for(var _=l.objectStore(v),w=Ki(Fl($=_.keyPath),$||"",!0,!1,!!_.autoIncrement,$&&typeof $!="string",!0),S=[],N=0;N<_.indexNames.length;++N){var q=_.index(_.indexNames[N]),$=q.keyPath,q=Ki(q.name,$,!!q.unique,!!q.multiEntry,!1,$&&typeof $!="string",!1);S.push(q)}f[v]=Gi(v,w,S)}),f}function ti(r,i,l){for(var f=l.db.objectStoreNames,v=0;v<f.length;++v){var _=f[v],w=l.objectStore(_);r._hasGetAll="getAll"in w;for(var S=0;S<w.indexNames.length;++S){var N,$=w.indexNames[S],q=w.index($).keyPath,q=typeof q=="string"?q:"["+Q(q).join("+")+"]";i[_]&&(N=i[_].idxByName[q])&&(N.name=$,delete i[_].idxByName[q],i[_].idxByName[$]=N)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Kl(r){return r.split(",").map(function(i,l){var v=i.split(":"),f=(f=v[1])==null?void 0:f.trim(),v=(i=v[0].trim()).replace(/([&*]|\+\+)/g,""),_=/^\[/.test(v)?v.match(/^\[(.*)\]$/)[1].split("+"):v;return Ki(v,_||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),d(_),l===0,f)})}Da.prototype._createTableSchema=Gi,Da.prototype._parseIndexSyntax=Kl,Da.prototype._parseStoresSpec=function(r,i){var l=this;c(r).forEach(function(f){if(r[f]!==null){var v=l._parseIndexSyntax(r[f]),_=v.shift();if(!_)throw new H.Schema("Invalid schema for table "+f+": "+r[f]);if(_.unique=!0,_.multi)throw new H.Schema("Primary key cannot be multiEntry*");v.forEach(function(w){if(w.auto)throw new H.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new H.Schema("Index must have a name and cannot be an empty string")}),_=l._createTableSchema(f,_,v),i[f]=_}})},Da.prototype.stores=function(l){var i=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,l):l,i._versions),f={},v={};return l.forEach(function(_){h(f,_._cfg.storesSource),v=_._cfg.dbschema={},_._parseStoresSpec(f,v)}),i._dbSchema=v,Hi(i,[i._allTables,i,i.Transaction.prototype]),Js(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],c(v),v),i._storeNames=c(v),this},Da.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Ve(this._cfg.contentUpgrade||J,r),this};var Yd=Da;function Da(){}function Qi(r,i){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new Cr(xn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Xi(r){return r&&typeof r.databases=="function"}function Zi(r){return tr(function(){return De.letThrough=!0,r()})}function Ji(r){return!("from"in r)}var vn=function(r,i){var l;if(!this)return l=new vn,r&&"d"in r&&h(l,r),l;h(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function us(r,i,l){var f=dt(i,l);if(!isNaN(f)){if(0<f)throw RangeError();if(Ji(r))return h(r,{from:i,to:l,d:1});var f=r.l,v=r.r;if(dt(l,r.from)<0)return f?us(f,i,l):r.l={from:i,to:l,d:1,l:null,r:null},Wl(r);if(0<dt(i,r.to))return v?us(v,i,l):r.r={from:i,to:l,d:1,l:null,r:null},Wl(r);dt(i,r.from)<0&&(r.from=i,r.l=null,r.d=v?v.d+1:1),0<dt(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),i=!r.r,f&&!r.l&&ds(r,f),v&&i&&ds(r,v)}}function ds(r,i){Ji(i)||(function l(f,v){var _=v.from,w=v.l,S=v.r;us(f,_,v.to),w&&l(f,w),S&&l(f,S)})(r,i)}function Gl(r,i){var l=ni(i),f=l.next();if(!f.done)for(var v=f.value,_=ni(r),w=_.next(v.from),S=w.value;!f.done&&!w.done;){if(dt(S.from,v.to)<=0&&0<=dt(S.to,v.from))return!0;dt(v.from,S.from)<0?v=(f=l.next(S.from)).value:S=(w=_.next(v.from)).value}return!1}function ni(r){var i=Ji(r)?null:{s:0,n:r};return{next:function(l){for(var f=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,f)for(;i.n.l&&dt(l,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!f||dt(l,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Wl(r){var i,l,f,v=(((v=r.r)==null?void 0:v.d)||0)-(((v=r.l)==null?void 0:v.d)||0),v=1<v?"r":v<-1?"l":"";v&&(i=v=="r"?"l":"r",l=a({},r),f=r[v],r.from=f.from,r.to=f.to,r[v]=f[v],l[v]=f[i],(r[i]=l).d=Hl(l)),r.d=Hl(r)}function Hl(l){var i=l.r,l=l.l;return(i?l?Math.max(i.d,l.d):i.d:l?l.d:0)+1}function ri(r,i){return c(i).forEach(function(l){r[l]?ds(r[l],i[l]):r[l]=(function f(v){var _,w,S={};for(_ in v)k(v,_)&&(w=v[_],S[_]=!w||typeof w!="object"||de.has(w.constructor)?w:f(w));return S})(i[l])}),r}function $i(r,i){return r.all||i.all||Object.keys(r).some(function(l){return i[l]&&Gl(i[l],r[l])})}b(vn.prototype,((Xe={add:function(r){return ds(this,r),this},addKey:function(r){return us(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(l){return us(i,l,l)}),this},hasKey:function(r){var i=ni(this).next(r).value;return i&&dt(i.from,r)<=0&&0<=dt(i.to,r)}})[pe]=function(){return ni(this)},Xe));var aa={},eo={},to=!1;function ai(r){ri(eo,r),to||(to=!0,setTimeout(function(){to=!1,no(eo,!(eo={}))},0))}function no(r,i){i===void 0&&(i=!1);var l=new Set;if(r.all)for(var f=0,v=Object.values(aa);f<v.length;f++)Vl(S=v[f],r,l,i);else for(var _ in r){var w,S,_=/^idb\:\/\/(.*)\/(.*)\//.exec(_);_&&(w=_[1],_=_[2],S=aa["idb://".concat(w,"/").concat(_)])&&Vl(S,r,l,i)}l.forEach(function(N){return N()})}function Vl(r,i,l,f){for(var v=[],_=0,w=Object.entries(r.queries.query);_<w.length;_++){for(var S=w[_],N=S[0],$=[],q=0,O=S[1];q<O.length;q++){var U=O[q];$i(i,U.obsSet)?U.subscribers.forEach(function(te){return l.add(te)}):f&&$.push(U)}f&&v.push([N,$])}if(f)for(var K=0,B=v;K<B.length;K++){var L=B[K],N=L[0],$=L[1];r.queries.query[N]=$}}function Qd(r){var i=r._state,l=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Me(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var f=i.openCanceller,v=Math.round(10*r.verno),_=!1;function w(){if(i.openCanceller!==f)throw new H.DatabaseClosed("db.open() was cancelled")}function S(){return new _e(function(U,K){if(w(),!l)throw new H.MissingAPI;var B=r.name,L=i.autoSchema||!v?l.open(B):l.open(B,v);if(!L)throw new H.MissingAPI;L.onerror=mr(K),L.onblocked=Tt(r._fireOnBlocked),L.onupgradeneeded=Tt(function(te){var se;q=L.transaction,i.autoSchema&&!r._options.allowEmptyDB?(L.onerror=is,q.abort(),L.result.close(),(se=l.deleteDatabase(B)).onsuccess=se.onerror=Tt(function(){K(new H.NoSuchDatabase("Database ".concat(B," doesnt exist")))})):(q.onerror=mr(K),se=te.oldVersion>Math.pow(2,62)?0:te.oldVersion,O=se<1,r.idbdb=L.result,_&&Vd(r,q),Hd(r,se/10,q,K))},K),L.onsuccess=Tt(function(){q=null;var te,se,Z,ye,Ae,je,Le=r.idbdb=L.result,Ce=Q(Le.objectStoreNames);if(0<Ce.length)try{var Fe=Le.transaction((Ae=Ce).length===1?Ae[0]:Ae,"readonly");if(i.autoSchema)je=Le,ye=Fe,(Z=r).verno=je.version/10,ye=Z._dbSchema=ei(0,je,ye),Z._storeNames=Q(je.objectStoreNames,0),Js(Z,[Z._allTables],c(ye),ye);else if(ti(r,r._dbSchema,Fe),se=Fe,((se=Vi(ei(0,(te=r).idbdb,se),te._dbSchema)).add.length||se.change.some(function(Be){return Be.add.length||Be.change.length}))&&!_)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Le.close(),v=Le.version+1,_=!0,U(S());Zs(r,Fe)}catch{}Vt.push(r),Le.onversionchange=Tt(function(Be){i.vcFired=!0,r.on("versionchange").fire(Be)}),Le.onclose=Tt(function(){r.close({disableAutoOpen:!1})}),O&&(Ce=r._deps,Ae=B,Xi(je=Ce.indexedDB)||Ae===xn||Qi(je,Ce.IDBKeyRange).put({name:Ae}).catch(J)),U()},K)}).catch(function(U){switch(U==null?void 0:U.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<v)return v=0,S()}return _e.reject(U)})}var N,$=i.dbReadyResolve,q=null,O=!1;return _e.race([f,(typeof navigator>"u"?_e.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(U){function K(){return indexedDB.databases().finally(U)}N=setInterval(K,100),K()}).finally(function(){return clearInterval(N)}):Promise.resolve()).then(S)]).then(function(){return w(),i.onReadyBeingFired=[],_e.resolve(Zi(function(){return r.on.ready.fire(r.vip)})).then(function U(){var K;if(0<i.onReadyBeingFired.length)return K=i.onReadyBeingFired.reduce(Ve,J),i.onReadyBeingFired=[],_e.resolve(Zi(function(){return K(r.vip)})).then(U)})}).finally(function(){i.openCanceller===f&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(U){i.dbOpenError=U;try{q&&q.abort()}catch{}return f===i.openCanceller&&r._close(),Me(U)}).finally(function(){i.openComplete=!0,$()}).then(function(){var U;return O&&(U={},r.tables.forEach(function(K){K.schema.indexes.forEach(function(B){B.name&&(U["idb://".concat(r.name,"/").concat(K.name,"/").concat(B.name)]=new vn(-1/0,[[[]]]))}),U["idb://".concat(r.name,"/").concat(K.name,"/")]=U["idb://".concat(r.name,"/").concat(K.name,"/:dels")]=new vn(-1/0,[[[]]])}),zr(os).fire(U),no(U,!0)),r})}function ro(r){function i(_){return r.next(_)}var l=v(i),f=v(function(_){return r.throw(_)});function v(_){return function(S){var S=_(S),N=S.value;return S.done?N:N&&typeof N.then=="function"?N.then(l,f):d(N)?Promise.all(N).then(l,f):l(N)}}return v(i)()}function si(r,i,l){for(var f=d(r)?r.slice():[r],v=0;v<l;++v)f.push(i);return f}var Xd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(f){var l=r.table(f),f=l.schema,v={},_=[];function w(U,K,B){var Z=cs(U),L=v[Z]=v[Z]||[],te=U==null?0:typeof U=="string"?1:U.length,se=0<K,Z=a(a({},B),{name:se?"".concat(Z,"(virtual-from:").concat(B.name,")"):B.name,lowLevelIndex:B,isVirtual:se,keyTail:K,keyLength:te,extractKey:Wi(U),unique:!se&&B.unique});return L.push(Z),Z.isPrimaryKey||_.push(Z),1<te&&w(te===2?U[0]:U.slice(0,te-1),K+1,B),L.sort(function(ye,Ae){return ye.keyTail-Ae.keyTail}),Z}var S=w(f.primaryKey.keyPath,0,f.primaryKey);v[":id"]=[S];for(var N=0,$=f.indexes;N<$.length;N++){var q=$[N];w(q.keyPath,0,q)}function O(U){var K,B=U.query.index;return B.isVirtual?a(a({},U),{query:{index:B.lowLevelIndex,range:(K=U.query.range,B=B.keyTail,{type:K.type===1?2:K.type,lower:si(K.lower,K.lowerOpen?r.MAX_KEY:r.MIN_KEY,B),lowerOpen:!0,upper:si(K.upper,K.upperOpen?r.MIN_KEY:r.MAX_KEY,B),upperOpen:!0})}}):U}return a(a({},l),{schema:a(a({},f),{primaryKey:S,indexes:_,getIndexByKeyPath:function(U){return(U=v[cs(U)])&&U[0]}}),count:function(U){return l.count(O(U))},query:function(U){return l.query(O(U))},openCursor:function(U){var K=U.query.index,B=K.keyTail,L=K.keyLength;return K.isVirtual?l.openCursor(O(U)).then(function(se){return se&&te(se)}):l.openCursor(U);function te(se){return Object.create(se,{continue:{value:function(Z){Z!=null?se.continue(si(Z,U.reverse?r.MAX_KEY:r.MIN_KEY,B)):U.unique?se.continue(se.key.slice(0,L).concat(U.reverse?r.MIN_KEY:r.MAX_KEY,B)):se.continue()}},continuePrimaryKey:{value:function(Z,ye){se.continuePrimaryKey(si(Z,r.MAX_KEY,B),ye)}},primaryKey:{get:function(){return se.primaryKey}},key:{get:function(){var Z=se.key;return L===1?Z[0]:Z.slice(0,L)}},value:{get:function(){return se.value}}})}}})}})}};function ao(r,i,l,f){return l=l||{},f=f||"",c(r).forEach(function(v){var _,w,S;k(i,v)?(_=r[v],w=i[v],typeof _=="object"&&typeof w=="object"&&_&&w?(S=ce(_))!==ce(w)?l[f+v]=i[v]:S==="Object"?ao(_,w,l,f+v+"."):_!==w&&(l[f+v]=i[v]):_!==w&&(l[f+v]=i[v])):l[f+v]=void 0}),c(i).forEach(function(v){k(r,v)||(l[f+v]=i[v])}),l}function so(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var Zd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(i){var l=r.table(i),f=l.schema.primaryKey;return a(a({},l),{mutate:function(v){var _=De.trans,w=_.table(i).hook,S=w.deleting,N=w.creating,$=w.updating;switch(v.type){case"add":if(N.fire===J)break;return _._promise("readwrite",function(){return q(v)},!0);case"put":if(N.fire===J&&$.fire===J)break;return _._promise("readwrite",function(){return q(v)},!0);case"delete":if(S.fire===J)break;return _._promise("readwrite",function(){return q(v)},!0);case"deleteRange":if(S.fire===J)break;return _._promise("readwrite",function(){return(function O(U,K,B){return l.query({trans:U,values:!1,query:{index:f,range:K},limit:B}).then(function(L){var te=L.result;return q({type:"delete",keys:te,trans:U}).then(function(se){return 0<se.numFailures?Promise.reject(se.failures[0]):te.length<B?{failures:[],numFailures:0,lastResult:void 0}:O(U,a(a({},K),{lower:te[te.length-1],lowerOpen:!0}),B)})})})(v.trans,v.range,1e4)},!0)}return l.mutate(v);function q(O){var U,K,B,L=De.trans,te=O.keys||so(f,O);if(te)return(O=O.type==="add"||O.type==="put"?a(a({},O),{keys:te}):a({},O)).type!=="delete"&&(O.values=s([],O.values)),O.keys&&(O.keys=s([],O.keys)),U=l,B=te,((K=O).type==="add"?Promise.resolve([]):U.getMany({trans:K.trans,keys:B,cache:"immutable"})).then(function(se){var Z=te.map(function(ye,Ae){var je,Le,Ce,Fe=se[Ae],Be={onerror:null,onsuccess:null};return O.type==="delete"?S.fire.call(Be,ye,Fe,L):O.type==="add"||Fe===void 0?(je=N.fire.call(Be,ye,O.values[Ae],L),ye==null&&je!=null&&(O.keys[Ae]=ye=je,f.outbound||G(O.values[Ae],f.keyPath,ye))):(je=ao(Fe,O.values[Ae]),(Le=$.fire.call(Be,je,ye,Fe,L))&&(Ce=O.values[Ae],Object.keys(Le).forEach(function(Re){k(Ce,Re)?Ce[Re]=Le[Re]:G(Ce,Re,Le[Re])}))),Be});return l.mutate(O).then(function(ye){for(var Ae=ye.failures,je=ye.results,Le=ye.numFailures,ye=ye.lastResult,Ce=0;Ce<te.length;++Ce){var Fe=(je||te)[Ce],Be=Z[Ce];Fe==null?Be.onerror&&Be.onerror(Ae[Ce]):Be.onsuccess&&Be.onsuccess(O.type==="put"&&se[Ce]?O.values[Ce]:Fe)}return{failures:Ae,results:je,numFailures:Le,lastResult:ye}}).catch(function(ye){return Z.forEach(function(Ae){return Ae.onerror&&Ae.onerror(ye)}),Promise.reject(ye)})});throw new Error("Keys missing")}}})}})}};function Yl(r,i,l){try{if(!i||i.keys.length<r.length)return null;for(var f=[],v=0,_=0;v<i.keys.length&&_<r.length;++v)dt(i.keys[v],r[_])===0&&(f.push(l?ve(i.values[v]):i.values[v]),++_);return f.length===r.length?f:null}catch{return null}}var Jd={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var l=r.table(i);return a(a({},l),{getMany:function(f){var v;return f.cache?(v=Yl(f.keys,f.trans._cache,f.cache==="clone"))?_e.resolve(v):l.getMany(f).then(function(_){return f.trans._cache={keys:f.keys,values:f.cache==="clone"?ve(_):_},_}):l.getMany(f)},mutate:function(f){return f.type!=="add"&&(f.trans._cache=null),l.mutate(f)}})}}}};function Ql(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Xl(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var $d={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,l=new vn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(f,v,_){if(De.subscr&&v!=="readonly")throw new H.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(De.querier));return r.transaction(f,v,_)},table:function(f){function v(te){var L,te=te.query;return[L=te.index,new vn((L=(te=te.range).lower)!=null?L:r.MIN_KEY,(L=te.upper)!=null?L:r.MAX_KEY)]}var _=r.table(f),w=_.schema,S=w.primaryKey,N=w.indexes,$=S.extractKey,q=S.outbound,O=S.autoIncrement&&N.filter(function(B){return B.compound&&B.keyPath.includes(S.keyPath)}),U=a(a({},_),{mutate:function(B){function L(ze){return ze="idb://".concat(i,"/").concat(f,"/").concat(ze),Ae[ze]||(Ae[ze]=new vn)}var te,se,Z,ye=B.trans,Ae=B.mutatedParts||(B.mutatedParts={}),je=L(""),Le=L(":dels"),Ce=B.type,Be=B.type==="deleteRange"?[B.range]:B.type==="delete"?[B.keys]:B.values.length<50?[so(S,B).filter(function(ze){return ze}),B.values]:[],Fe=Be[0],Be=Be[1],Re=B.trans._cache;return d(Fe)?(je.addKeys(Fe),(Ce=Ce==="delete"||Fe.length===Be.length?Yl(Fe,Re):null)||Le.addKeys(Fe),(Ce||Be)&&(te=L,se=Ce,Z=Be,w.indexes.forEach(function(ze){var vt=te(ze.name||"");function _t(rt){return rt!=null?ze.extractKey(rt):null}function Ye(rt){ze.multiEntry&&d(rt)?rt.forEach(function(Ut){return vt.addKey(Ut)}):vt.addKey(rt)}(se||Z).forEach(function(rt,Ht){var Gn=se&&_t(se[Ht]),Ht=Z&&_t(Z[Ht]);dt(Gn,Ht)!==0&&(Gn!=null&&Ye(Gn),Ht!=null)&&Ye(Ht)})}))):Fe?(Be={from:(Re=Fe.lower)!=null?Re:r.MIN_KEY,to:(Ce=Fe.upper)!=null?Ce:r.MAX_KEY},Le.add(Be),je.add(Be)):(je.add(l),Le.add(l),w.indexes.forEach(function(ze){return L(ze.name).add(l)})),_.mutate(B).then(function(ze){return!Fe||B.type!=="add"&&B.type!=="put"||(je.addKeys(ze.results),O&&O.forEach(function(vt){for(var _t=B.values.map(function(Gn){return vt.extractKey(Gn)}),Ye=vt.keyPath.findIndex(function(Gn){return Gn===S.keyPath}),rt=0,Ut=ze.results.length;rt<Ut;++rt)_t[rt][Ye]=ze.results[rt];L(vt.name).addKeys(_t)})),ye.mutatedParts=ri(ye.mutatedParts||{},Ae),ze})}}),K={get:function(B){return[S,new vn(B.key)]},getMany:function(B){return[S,new vn().addKeys(B.keys)]},count:v,query:v,openCursor:v};return c(K).forEach(function(B){U[B]=function(L){var te=De.subscr,se=!!te,Z=Ql(De,_)&&Xl(B,L)?L.obsSet={}:te;if(se){var ye,te=function(Be){return Be="idb://".concat(i,"/").concat(f,"/").concat(Be),Z[Be]||(Z[Be]=new vn)},Ae=te(""),je=te(":dels"),se=K[B](L),Le=se[0],se=se[1];if((B==="query"&&Le.isPrimaryKey&&!L.values?je:te(Le.name||"")).add(se),!Le.isPrimaryKey){if(B!=="count")return ye=B==="query"&&q&&L.values&&_.query(a(a({},L),{values:!1})),_[B].apply(this,arguments).then(function(Be){if(B==="query"){if(q&&L.values)return ye.then(function(_t){return _t=_t.result,Ae.addKeys(_t),Be});var Re=L.values?Be.result.map($):Be.result;(L.values?Ae:je).addKeys(Re)}else{var ze,vt;if(B==="openCursor")return vt=L.values,(ze=Be)&&Object.create(ze,{key:{get:function(){return je.addKey(ze.primaryKey),ze.key}},primaryKey:{get:function(){var _t=ze.primaryKey;return je.addKey(_t),_t}},value:{get:function(){return vt&&Ae.addKey(ze.primaryKey),ze.value}}})}return Be});je.add(l)}}return _[B].apply(this,arguments)}}),U}})}};function Zl(r,i,l){var f;return l.numFailures===0?i:i.type==="deleteRange"||(f=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,l.numFailures===f)?null:(f=a({},i),d(f.keys)&&(f.keys=f.keys.filter(function(v,_){return!(_ in l.failures)})),"values"in f&&d(f.values)&&(f.values=f.values.filter(function(v,_){return!(_ in l.failures)})),f)}function io(r,i){return l=r,((f=i).lower===void 0||(f.lowerOpen?0<dt(l,f.lower):0<=dt(l,f.lower)))&&(l=r,(f=i).upper===void 0||(f.upperOpen?dt(l,f.upper)<0:dt(l,f.upper)<=0));var l,f}function Jl(r,i,l,f,v,_){var w,S,N,$,q,O;return!l||l.length===0||(w=i.query.index,S=w.multiEntry,N=i.query.range,$=f.schema.primaryKey.extractKey,q=w.extractKey,O=(w.lowLevelIndex||w).extractKey,(f=l.reduce(function(U,K){var B=U,L=[];if(K.type==="add"||K.type==="put")for(var te=new vn,se=K.values.length-1;0<=se;--se){var Z,ye=K.values[se],Ae=$(ye);!te.hasKey(Ae)&&(Z=q(ye),S&&d(Z)?Z.some(function(Be){return io(Be,N)}):io(Z,N))&&(te.addKey(Ae),L.push(ye))}switch(K.type){case"add":var je=new vn().addKeys(i.values?U.map(function(Re){return $(Re)}):U),B=U.concat(i.values?L.filter(function(Re){return Re=$(Re),!je.hasKey(Re)&&(je.addKey(Re),!0)}):L.map(function(Re){return $(Re)}).filter(function(Re){return!je.hasKey(Re)&&(je.addKey(Re),!0)}));break;case"put":var Le=new vn().addKeys(K.values.map(function(Re){return $(Re)}));B=U.filter(function(Re){return!Le.hasKey(i.values?$(Re):Re)}).concat(i.values?L:L.map(function(Re){return $(Re)}));break;case"delete":var Ce=new vn().addKeys(K.keys);B=U.filter(function(Re){return!Ce.hasKey(i.values?$(Re):Re)});break;case"deleteRange":var Fe=K.range;B=U.filter(function(Re){return!io($(Re),Fe)})}return B},r))===r)?r:(f.sort(function(U,K){return dt(O(U),O(K))||dt($(U),$(K))}),i.limit&&i.limit<1/0&&(f.length>i.limit?f.length=i.limit:r.length===i.limit&&f.length<i.limit&&(v.dirty=!0)),_?Object.freeze(f):f)}function $l(r,i){return dt(r.lower,i.lower)===0&&dt(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function ef(r,i){return((l,f,v,_)=>{if(l===void 0)return f!==void 0?-1:0;if(f===void 0)return 1;if((l=dt(l,f))===0){if(v&&_)return 0;if(v)return 1;if(_)return-1}return l})(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=((l,f,v,_)=>{if(l===void 0)return f!==void 0?1:0;if(f===void 0)return-1;if((l=dt(l,f))===0){if(v&&_)return 0;if(v)return-1;if(_)return 1}return l})(r.upper,i.upper,r.upperOpen,i.upperOpen)}function tf(r,i,l,f){r.subscribers.add(l),f.addEventListener("abort",function(){var v,_;r.subscribers.delete(l),r.subscribers.size===0&&(v=r,_=i,setTimeout(function(){v.subscribers.size===0&&oe(_,v)},3e3))})}var nf={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return a(a({},r),{transaction:function(l,f,v){var _,w,S=r.transaction(l,f,v);return f==="readwrite"&&(v=(_=new AbortController).signal,S.addEventListener("abort",(w=function(N){return function(){if(_.abort(),f==="readwrite"){for(var $=new Set,q=0,O=l;q<O.length;q++){var U=O[q],K=aa["idb://".concat(i,"/").concat(U)];if(K){var B=r.table(U),L=K.optimisticOps.filter(function(ze){return ze.trans===S});if(S._explicit&&N&&S.mutatedParts)for(var te=0,se=Object.values(K.queries.query);te<se.length;te++)for(var Z=0,ye=(Le=se[te]).slice();Z<ye.length;Z++)$i((Ce=ye[Z]).obsSet,S.mutatedParts)&&(oe(Le,Ce),Ce.subscribers.forEach(function(ze){return $.add(ze)}));else if(0<L.length){K.optimisticOps=K.optimisticOps.filter(function(ze){return ze.trans!==S});for(var Ae=0,je=Object.values(K.queries.query);Ae<je.length;Ae++)for(var Le,Ce,Fe,Be=0,Re=(Le=je[Ae]).slice();Be<Re.length;Be++)(Ce=Re[Be]).res!=null&&S.mutatedParts&&(N&&!Ce.dirty?(Fe=Object.isFrozen(Ce.res),Fe=Jl(Ce.res,Ce.req,L,B,Ce,Fe),Ce.dirty?(oe(Le,Ce),Ce.subscribers.forEach(function(ze){return $.add(ze)})):Fe!==Ce.res&&(Ce.res=Fe,Ce.promise=_e.resolve({result:Fe}))):(Ce.dirty&&oe(Le,Ce),Ce.subscribers.forEach(function(ze){return $.add(ze)})))}}}$.forEach(function(ze){return ze()})}}})(!1),{signal:v}),S.addEventListener("error",w(!1),{signal:v}),S.addEventListener("complete",w(!0),{signal:v})),S},table:function(l){var f=r.table(l),v=f.schema.primaryKey;return a(a({},f),{mutate:function(_){var w,S=De.trans;return!v.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(w=aa["idb://".concat(i,"/").concat(l)])?(S=f.mutate(_),_.type!=="add"&&_.type!=="put"||!(50<=_.values.length||so(v,_).some(function(N){return N==null}))?(w.optimisticOps.push(_),_.mutatedParts&&ai(_.mutatedParts),S.then(function(N){0<N.numFailures&&(oe(w.optimisticOps,_),(N=Zl(0,_,N))&&w.optimisticOps.push(N),_.mutatedParts)&&ai(_.mutatedParts)}),S.catch(function(){oe(w.optimisticOps,_),_.mutatedParts&&ai(_.mutatedParts)})):S.then(function(N){var $=Zl(0,a(a({},_),{values:_.values.map(function(q,O){var U;return N.failures[O]?q:(G(U=(U=v.keyPath)!=null&&U.includes(".")?ve(q):a({},q),v.keyPath,N.results[O]),U)})}),N);w.optimisticOps.push($),queueMicrotask(function(){return _.mutatedParts&&ai(_.mutatedParts)})}),S):f.mutate(_)},query:function(_){var w,S,N,$,q,O,U;return Ql(De,f)&&Xl("query",_)?(w=((N=De.trans)==null?void 0:N.db._options.cache)==="immutable",S=(N=De).requery,N=N.signal,O=((K,B,L,te)=>{var se=aa["idb://".concat(K,"/").concat(B)];if(!se)return[];if(!(K=se.queries[L]))return[null,!1,se,null];var Z=K[(te.query?te.query.index.name:null)||""];if(!Z)return[null,!1,se,null];switch(L){case"query":var ye=Z.find(function(Ae){return Ae.req.limit===te.limit&&Ae.req.values===te.values&&$l(Ae.req.query.range,te.query.range)});return ye?[ye,!0,se,Z]:[Z.find(function(Ae){return("limit"in Ae.req?Ae.req.limit:1/0)>=te.limit&&(!te.values||Ae.req.values)&&ef(Ae.req.query.range,te.query.range)}),!1,se,Z];case"count":return ye=Z.find(function(Ae){return $l(Ae.req.query.range,te.query.range)}),[ye,!!ye,se,Z]}})(i,l,"query",_),U=O[0],$=O[2],q=O[3],U&&O[1]?U.obsSet=_.obsSet:(O=f.query(_).then(function(K){var B=K.result;if(U&&(U.res=B),w){for(var L=0,te=B.length;L<te;++L)Object.freeze(B[L]);Object.freeze(B)}else K.result=ve(B);return K}).catch(function(K){return q&&U&&oe(q,U),Promise.reject(K)}),U={obsSet:_.obsSet,promise:O,subscribers:new Set,type:"query",req:_,dirty:!1},q?q.push(U):(q=[U],($=$||(aa["idb://".concat(i,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[_.query.index.name||""]=q)),tf(U,q,S,N),U.promise.then(function(K){return{result:Jl(K.result,_,$==null?void 0:$.optimisticOps,f,U,w)}})):f.query(_)}})}})}};function ii(r,i){return new Proxy(r,{get:function(l,f,v){return f==="db"?i:Reflect.get(l,f,v)}})}Yt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new H.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new H.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,l=i.filter(function(f){return f._cfg.version===r})[0];return l||(l=new this.Version(r),i.push(l),i.sort(Wd),l.stores({}),this._state.autoSchema=!1),l},Yt.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?r():new _e(function(l,f){if(i._state.openComplete)return f(new H.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void f(new H.DatabaseClosed);i.open().catch(J)}i._state.dbReadyPromise.then(l,f)}).then(r)},Yt.prototype.use=function(v){var i=v.stack,l=v.create,f=v.level,v=v.name,_=(v&&this.unuse({stack:i,name:v}),this._middlewares[i]||(this._middlewares[i]=[]));return _.push({stack:i,create:l,level:f??10,name:v}),_.sort(function(w,S){return w.level-S.level}),this},Yt.prototype.unuse=function(r){var i=r.stack,l=r.name,f=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(v){return f?v.create!==f:!!l&&v.name!==l})),this},Yt.prototype.open=function(){var r=this;return Ue(it,function(){return Qd(r)})},Yt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,i=Vt.indexOf(this);if(0<=i&&Vt.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new _e(function(l){r.dbReadyResolve=l}),r.openCanceller=new _e(function(l,f){r.cancelOpen=f}))},Yt.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,l=this._state;i?(l.isBeingOpened&&l.cancelOpen(new H.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new H.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Yt.prototype.delete=function(r){var i=this,l=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),f=this._state;return new _e(function(v,_){function w(){i.close(r);var S=i._deps.indexedDB.deleteDatabase(i.name);S.onsuccess=Tt(function(){var N,$,q;N=i._deps,$=i.name,Xi(q=N.indexedDB)||$===xn||Qi(q,N.IDBKeyRange).delete($).catch(J),v()}),S.onerror=mr(_),S.onblocked=i._fireOnBlocked}if(l)throw new H.InvalidArgument("Invalid closeOptions argument to db.delete()");f.isBeingOpened?f.dbReadyPromise.then(w):w()})},Yt.prototype.backendDB=function(){return this.idbdb},Yt.prototype.isOpen=function(){return this.idbdb!==null},Yt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Yt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Yt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Yt.prototype,"tables",{get:function(){var r=this;return c(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),Yt.prototype.transaction=function(){var r=(function(i,l,f){var v=arguments.length;if(v<2)throw new H.InvalidArgument("Too few arguments");for(var _=new Array(v-1);--v;)_[v-1]=arguments[v];return f=_.pop(),[i,le(_),f]}).apply(this,arguments);return this._transaction.apply(this,r)},Yt.prototype._transaction=function(r,i,l){var f,v,_=this,w=De.trans,S=(w&&w.db===this&&r.indexOf("!")===-1||(w=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(v=i.map(function($){if($=$ instanceof _.Table?$.name:$,typeof $!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return $}),r=="r"||r===hr)f=hr;else{if(r!="rw"&&r!=na)throw new H.InvalidArgument("Invalid transaction mode: "+r);f=na}if(w){if(w.mode===hr&&f===na){if(!S)throw new H.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&v.forEach(function($){if(w&&w.storeNames.indexOf($)===-1){if(!S)throw new H.SubTransaction("Table "+$+" not included in parent transaction.");w=null}}),S&&w&&!w.active&&(w=null)}}catch($){return w?w._promise(null,function(q,O){O($)}):Me($)}var N=(function $(q,O,U,K,B){return _e.resolve().then(function(){var Z=De.transless||De,L=q._createTransaction(O,U,q._dbSchema,K),Z=(L.explicit=!0,{trans:L,transless:Z});if(K)L.idbtrans=K.idbtrans;else try{L.create(),L.idbtrans._explicit=!0,q._state.PR1398_maxLoop=3}catch(ye){return ye.name===Oe.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return $(q,O,U,null,B)})):Me(ye)}var te,se=Se(B),Z=(se&&fn(),_e.follow(function(){var ye;(te=B.call(L,L))&&(se?(ye=nr.bind(null,null),te.then(ye,ye)):typeof te.next=="function"&&typeof te.throw=="function"&&(te=ro(te)))},Z));return(te&&typeof te.then=="function"?_e.resolve(te).then(function(ye){return L.active?ye:Me(new H.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Z.then(function(){return te})).then(function(ye){return K&&L._resolve(),L._completion.then(function(){return ye})}).catch(function(ye){return L._reject(ye),Me(ye)})})}).bind(null,this,f,v,w,l);return w?w._promise(f,N,"lock"):De.trans?Ue(De.transless,function(){return _._whenReady(N)}):this._whenReady(N)},Yt.prototype.table=function(r){if(k(this._allTables,r))return this._allTables[r];throw new H.InvalidTable("Table ".concat(r," does not exist"))};var Cr=Yt;function Yt(r,i){var l,f,v,_,w,S=this,N=(this._middlewares={},this.verno=0,Yt.dependencies),N=(this._options=i=a({addons:Yt.addons,autoOpen:!0,indexedDB:N.indexedDB,IDBKeyRange:N.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),$=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:J,dbReadyPromise:null,cancelOpen:J,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),q=($.dbReadyPromise=new _e(function(O){$.dbReadyResolve=O}),$.openCanceller=new _e(function(O,U){$.cancelOpen=U}),this._state=$,this.name=r,this.on=as(this,"populate","blocked","versionchange","close",{ready:[Ve,J]}),this.once=function(O,U){var K=function(){for(var B=[],L=0;L<arguments.length;L++)B[L]=arguments[L];S.on(O).unsubscribe(K),U.apply(S,B)};return S.on(O,K)},this.on.ready.subscribe=V(this.on.ready.subscribe,function(O){return function(U,K){Yt.vip(function(){var B,L=S._state;L.openComplete?(L.dbOpenError||_e.resolve().then(U),K&&O(U)):L.onReadyBeingFired?(L.onReadyBeingFired.push(U),K&&O(U)):(O(U),B=S,K||O(function te(){B.on.ready.unsubscribe(U),B.on.ready.unsubscribe(te)}))})}}),this.Collection=(l=this,ss(qd.prototype,function(te,L){this.db=l;var K=ns,B=null;if(L)try{K=L()}catch(Z){B=Z}var L=te._ctx,te=L.table,se=te.hook.reading.fire;this._ctx={table:te,index:L.index,isPrimKey:!L.index||te.schema.primKey.keyPath&&L.index===te.schema.primKey.name,range:K,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:B,or:L.or,valueMapper:se!==Te?se:null}})),this.Table=(f=this,ss(Dl.prototype,function(O,U,K){this.db=f,this._tx=K,this.name=O,this.schema=U,this.hook=f._allTables[O]?f._allTables[O].hook:as(null,{creating:[yt,J],reading:[qe,Te],updating:[bt,J],deleting:[Et,J]})})),this.Transaction=(v=this,ss(zd.prototype,function(O,U,K,B,L){var te=this;O!=="readonly"&&U.forEach(function(se){se=(se=K[se])==null?void 0:se.yProps,se&&(U=U.concat(se.map(function(Z){return Z.updatesTable})))}),this.db=v,this.mode=O,this.storeNames=U,this.schema=K,this.chromeTransactionDurability=B,this.idbtrans=null,this.on=as(this,"complete","error","abort"),this.parent=L||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new _e(function(se,Z){te._resolve=se,te._reject=Z}),this._completion.then(function(){te.active=!1,te.on.complete.fire()},function(se){var Z=te.active;return te.active=!1,te.on.error.fire(se),te.parent?te.parent._reject(se):Z&&te.idbtrans&&te.idbtrans.abort(),Me(se)})})),this.Version=(_=this,ss(Yd.prototype,function(O){this.db=_,this._cfg={version:O,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(w=this,ss(Bl.prototype,function(O,U,K){if(this.db=w,this._ctx={table:O,index:U===":id"?null:U,or:K},this._cmp=this._ascending=dt,this._descending=function(B,L){return dt(L,B)},this._max=function(B,L){return 0<dt(B,L)?B:L},this._min=function(B,L){return dt(B,L)<0?B:L},this._IDBKeyRange=w._deps.IDBKeyRange,!this._IDBKeyRange)throw new H.MissingAPI})),this.on("versionchange",function(O){0<O.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(O){!O.newVersion||O.newVersion<O.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(O.oldVersion/10))}),this._maxKey=ls(i.IDBKeyRange),this._createTransaction=function(O,U,K,B){return new S.Transaction(O,U,K,S._options.chromeTransactionDurability,B)},this._fireOnBlocked=function(O){S.on("blocked").fire(O),Vt.filter(function(U){return U.name===S.name&&U!==S&&!U._state.vcFired}).map(function(U){return U.on("versionchange").fire(O)})},this.use(Jd),this.use(nf),this.use($d),this.use(Xd),this.use(Zd),new Proxy(this,{get:function(O,U,K){var B;return U==="_vip"||(U==="table"?function(L){return ii(S.table(L),q)}:(B=Reflect.get(O,U,K))instanceof Dl?ii(B,q):U==="tables"?B.map(function(L){return ii(L,q)}):U==="_createTransaction"?function(){return ii(B.apply(this,arguments),q)}:B)}}));this.vip=q,N.forEach(function(O){return O(S)})}var oi,ja=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",rf=(oo.prototype.subscribe=function(r,i,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:l})},oo.prototype[ja]=function(){return this},oo);function oo(r){this._subscribe=r}try{oi={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{oi={indexedDB:null,IDBKeyRange:null}}function ec(r){var i,l=!1,f=new rf(function(v){var _=Se(r),w,S=!1,N={},$={},q={get closed(){return S},unsubscribe:function(){S||(S=!0,w&&w.abort(),O&&zr.storagemutated.unsubscribe(K))}},O=(v.start&&v.start(q),!1),U=function(){return Ie(B)},K=function(L){ri(N,L),$i($,N)&&U()},B=function(){var L,te,se;!S&&oi.indexedDB&&(N={},L={},w&&w.abort(),w=new AbortController,se=(Z=>{var ye=Fn();try{_&&fn();var Ae=tr(r,Z);return Ae=_?Ae.finally(nr):Ae}finally{ye&&mn()}})(te={subscr:L,signal:w.signal,requery:U,querier:r,trans:null}),Promise.resolve(se).then(function(Z){l=!0,i=Z,S||te.signal.aborted||(N={},(ye=>{for(var Ae in ye)if(k(ye,Ae))return;return 1})($=L)||O||(zr(os,K),O=!0),Ie(function(){return!S&&v.next&&v.next(Z)}))},function(Z){l=!1,["DatabaseClosedError","AbortError"].includes(Z==null?void 0:Z.name)||S||Ie(function(){S||v.error&&v.error(Z)})}))};return setTimeout(U,0),q});return f.hasValue=function(){return l},f.getValue=function(){return i},f}var sa=Cr;function lo(r){var i=Ur;try{Ur=!0,zr.storagemutated.fire(r),no(r,!0)}finally{Ur=i}}b(sa,a(a({},fe),{delete:function(r){return new sa(r,{addons:[]}).delete()},exists:function(r){return new sa(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=sa.dependencies,l=i.indexedDB,i=i.IDBKeyRange,(Xi(l)?Promise.resolve(l.databases()).then(function(f){return f.map(function(v){return v.name}).filter(function(v){return v!==xn})}):Qi(l,i).toCollection().primaryKeys()).then(r)}catch{return Me(new H.MissingAPI)}var i,l},defineClass:function(){return function(r){h(this,r)}},ignoreTransaction:function(r){return De.trans?Ue(De.transless,r):r()},vip:Zi,async:function(r){return function(){try{var i=ro(r.apply(this,arguments));return i&&typeof i.then=="function"?i:_e.resolve(i)}catch(l){return Me(l)}}},spawn:function(r,i,l){try{var f=ro(r.apply(l,i||[]));return f&&typeof f.then=="function"?f:_e.resolve(f)}catch(v){return Me(v)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(r,i){return r=_e.resolve(typeof r=="function"?sa.ignoreTransaction(r):r).timeout(i||6e4),De.trans?De.trans.waitFor(r):r},Promise:_e,debug:{get:function(){return Je},set:function(r){ht(r)}},derive:D,extend:h,props:b,override:V,Events:as,on:zr,liveQuery:ec,extendObservabilitySet:ri,getByKeyPath:re,setByKeyPath:G,delByKeyPath:function(r,i){typeof i=="string"?G(r,i,void 0):"length"in i&&[].map.call(i,function(l){G(r,l,void 0)})},shallowClone:me,deepClone:ve,getObjectDiff:ao,cmp:dt,asap:W,minKey:-1/0,addons:[],connections:Vt,errnames:Oe,dependencies:oi,cache:aa,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,l){return r+i/Math.pow(10,2*l)})})),sa.maxKey=ls(sa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(zr(os,function(r){Ur||(r=new CustomEvent(Ui,{detail:r}),Ur=!0,dispatchEvent(r),Ur=!1)}),addEventListener(Ui,function(r){r=r.detail,Ur||lo(r)}));var La,Ur=!1,tc=function(){};return typeof BroadcastChannel<"u"&&((tc=function(){(La=new BroadcastChannel(Ui)).onmessage=function(r){return r.data&&lo(r.data)}})(),typeof La.unref=="function"&&La.unref(),zr(os,function(r){Ur||La.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Cr.disableBfCache&&r.persisted){Je&&console.debug("Dexie: handling persisted pagehide"),La!=null&&La.close();for(var i=0,l=Vt;i<l.length;i++)l[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Cr.disableBfCache&&r.persisted&&(Je&&console.debug("Dexie: handling persisted pageshow"),tc(),lo({all:new vn(-1/0,[[]])}))})),_e.rejectionMapper=function(r,i){return!r||r instanceof X||r instanceof TypeError||r instanceof SyntaxError||!r.name||!we[r.name]?r:(i=new we[r.name](i||r.message,r),"stack"in r&&R(i,"stack",{get:function(){return this.inner.stack}}),i)},ht(Je),a(Cr,Object.freeze({__proto__:null,Dexie:Cr,Entity:Il,PropModification:rs,RangeSet:vn,add:function(r){return new rs({add:r})},cmp:dt,default:Cr,liveQuery:ec,mergeRanges:ds,rangesOverlap:Gl,remove:function(r){return new rs({remove:r})},replacePrefix:function(r,i){return new rs({replacePrefix:[r,i]})}}),{default:Cr}),Cr})})(yi)),yi.exports}var Kv=Uv();const No=Fv(Kv),yc=Symbol.for("Dexie"),hn=globalThis[yc]||(globalThis[yc]=No);if(No.semVer!==hn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${No.semVer} and ${hn.semVer}`);const{liveQuery:S1,mergeRanges:E1,rangesOverlap:T1,RangeSet:A1,cmp:C1,Entity:I1,PropModification:R1,replacePrefix:O1,add:P1,remove:M1,DexieYProvider:D1}=hn,Ge=new hn("me-ai-store");Ge.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Ge.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Ge.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Ge.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});Ge.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});function ul(t,e){return`${t}:${e}`}const Gv=Object.freeze(Object.defineProperty({__proto__:null,db:Ge,makeItemId:ul},Symbol.toStringTag,{value:"Module"}));async function Rs(t,e=null){try{const n=await Ge.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Os(t,e){try{await Ge.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function dl(t){try{await Ge.settings.delete(t)}catch{}}async function Wv(t){const e=await Ge.settings.bulkGet(t);return Object.fromEntries(t.map((n,a)=>{var s;return[n,((s=e[a])==null?void 0:s.value)??null]}))}const Ra=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Rs,getSettings:Wv,removeSetting:dl,setSetting:Os},Symbol.toStringTag,{value:"Module"})),xr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function fl(t){return xr.find(e=>e.id===t)}const Hv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:xr,getModelInfo:fl},Symbol.toStringTag,{value:"Module"})),Sr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Vu(){return Sr.filter(t=>t.recommended)}function vl(t){return Sr.find(e=>e.name===t||e.name.startsWith(t+":"))}const Vv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Sr,getOllamaModelInfo:vl,getRecommendedOllamaModels:Vu},Symbol.toStringTag,{value:"Module"}));let Tn=null,Dr="idle",bi=null,la=new Set;function di(){return Tn||(Tn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Tn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Dr="loading"),e.status==="ready"&&(Dr="ready"),e.status==="start"&&(Dr="generating"),(e.status==="complete"||e.status==="error")&&(Dr=bi?"ready":"idle");for(const n of la)try{n(e)}catch{}})),Tn}function go(){return{check(){di().postMessage({type:"check"})},loadModel(t){bi=t,Dr="loading",di().postMessage({type:"load",modelId:t})},generate(t,e){di().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,s)=>{let o="",c=null,d=0,h=0;const m=k=>{switch(k.status){case"start":h=k.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=k.output,c=k.tps??c,d=k.numTokens??d,n)try{n({tps:c,numTokens:d,text:o})}catch{}break;case"complete":y(),a({text:o,tps:c,numTokens:d,inputTokens:h});break;case"error":y(),s(new Error(k.data));break}},y=()=>{la.delete(m)};la.add(m),di().postMessage({type:"generate",data:t,options:e})})},interrupt(){Tn==null||Tn.postMessage({type:"interrupt"})},reset(){Tn==null||Tn.postMessage({type:"reset"})},onMessage(t){return la.add(t),()=>la.delete(t)},offMessage(t){la.delete(t)},get status(){return Dr},get isReady(){return Dr==="ready"},get isGenerating(){return Dr==="generating"},get modelId(){return bi},terminate(){Tn==null||Tn.terminate(),Tn=null,Dr="idle",bi=null,la.clear()}}}const Yv="modulepreload",Qv=function(t){return"/me-ai/"+t},bc={},Tr=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let c=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=c(n.map(m=>{if(m=Qv(m),m in bc)return;bc[m]=!0;const y=m.endsWith(".css"),k=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${k}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":Yv,y||(b.as="script"),b.crossOrigin="",b.href=m,h&&b.setAttribute("nonce",h),document.head.appendChild(b),y)return new Promise((x,R)=>{b.addEventListener("load",x),b.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return s.then(c=>{for(const d of c||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},wc="http://localhost:11434",Xv="https://me-ai.metaelon.space";function Yu(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?wc:Xv}catch{return wc}}function zs(){return Yu()}async function Zv(){const{getSetting:t}=await Tr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Ra);return{getSetting:e}},void 0);return await t("ollamaUrl")||Yu()}async function Jv(t){const{setSetting:e}=await Tr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Ra);return{setSetting:n}},void 0);await e("ollamaUrl",t)}async function qo(t=zs()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function $v(t=zs()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function ep(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:s}={},o=()=>{},c=zs()){var R;const d={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};s!==void 0?d.keep_alive=s:d.keep_alive="10m";const h=new AbortController,m=setTimeout(()=>h.abort(),3e5),y=await fetch(`${c}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:h.signal});if(clearTimeout(m),!y.ok){const D=await y.text();throw new Error(`Ollama API error: ${D}`)}const k=y.body.getReader(),b=new TextDecoder;let x="";try{for(;;){const{done:D,value:F}=await k.read();if(D)break;const Q=b.decode(F).split(`
`).filter(Boolean);for(const V of Q)try{const A=JSON.parse(V);if((R=A.message)!=null&&R.content&&(x+=A.message.content,o({content:A.message.content,done:!1,total_duration:A.total_duration,eval_count:A.eval_count,eval_duration:A.eval_duration})),A.done){o({content:"",done:!0,total_duration:A.total_duration,eval_count:A.eval_count,eval_duration:A.eval_duration});break}}catch{}}}finally{k.releaseLock()}return x}let Pn="idle",Na=null,ca=new Set;function ar(t){for(const e of ca)try{e(t)}catch{}}function tp(){return{async check(){Pn="loading",ar({status:"loading",data:"Testing Ollama connection..."});const t=await qo();t.connected?(Pn="idle",ar({status:"ready",data:{type:"ollama",version:t.version,url:zs()}})):(Pn="idle",ar({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Na=t,Pn="loading",ar({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await qo();if(!e.connected){Pn="idle",Na=null,ar({status:"error",data:`Ollama not available: ${e.error}`});return}Pn="ready",ar({status:"ready"})},async generate(t,e={}){if(!Na){ar({status:"error",data:"No Ollama model selected"});return}Pn="generating",ar({status:"start",inputTokens:0});let n=0,a=performance.now();try{await ep(Na,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},s=>{if(s.content){n++;const o=performance.now()-a,c=o>0?n/o*1e3:0;ar({status:"update",output:s.content,tps:Math.round(c*10)/10,numTokens:n})}s.done&&(Pn="ready",ar({status:"complete",tps:s.eval_duration?Math.round(s.eval_count/(s.eval_duration/1e9)*10)/10:null,numTokens:s.eval_count||n}))})}catch(s){Pn="ready",ar({status:"error",data:s.message})}},generateFull(t,e,n){return new Promise((a,s)=>{let o="",c=null,d=0,h=0;const m=k=>{switch(k.status){case"start":h=k.inputTokens||0;break;case"update":if(o+=k.output,c=k.tps??c,d=k.numTokens??d,n)try{n({tps:c,numTokens:d,text:o})}catch{}break;case"complete":y(),a({text:o,tps:c,numTokens:d,inputTokens:h});break;case"error":y(),s(new Error(k.data));break}},y=()=>{ca.delete(m)};ca.add(m),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return ca.add(t),()=>ca.delete(t)},offMessage(t){ca.delete(t)},get status(){return Pn},get isReady(){return Pn==="ready"},get isGenerating(){return Pn==="generating"},get modelId(){return Na},get backend(){return"ollama"},terminate(){Pn="idle",Na=null,ca.clear()}}}let oa=null,tt=null,_o=new Set;function np(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function Qu(){return{loadModel(t){const e=np(t);if(oa!==e){tt&&tt.terminate(),oa=e,tt=e==="webgpu"?go():tp();for(const n of _o)tt.onMessage(n)}tt.loadModel(t)},check(){tt||(tt=go(),oa="webgpu"),tt.check()},generate(t,e){if(!tt)throw new Error("No engine loaded. Call loadModel() first.");return tt.generate(t,e)},generateFull(t,e,n){return tt?tt.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){tt==null||tt.interrupt()},reset(){tt==null||tt.reset()},onMessage(t){return tt||(tt=go(),oa="webgpu"),_o.add(t),tt.onMessage(t)},offMessage(t){_o.delete(t),tt==null||tt.offMessage(t)},get status(){return(tt==null?void 0:tt.status)||"idle"},get isReady(){return(tt==null?void 0:tt.isReady)||!1},get isGenerating(){return(tt==null?void 0:tt.isGenerating)||!1},get modelId(){return(tt==null?void 0:tt.modelId)||null},get backend(){return oa},getModelInfo(){const t=this.modelId;return t?oa==="webgpu"?fl(t):vl(t):null},terminate(){tt==null||tt.terminate(),tt=null,oa=null}}}function Bo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function yo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),s=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return s.toFixed(o)+" "+n[a]}function rp(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function ap(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function ji(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const sp="https://gmail.googleapis.com/gmail/v1/users/me";class pl extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function ip(t){return{Authorization:`Bearer ${t}`}}async function Li(t,e){var a,s,o,c;const n=await fetch(`${sp}${e}`,{headers:ip(t)});if(!n.ok){const d=await n.json().catch(()=>({})),h=((a=d.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,m=((c=(o=(s=d.error)==null?void 0:s.errors)==null?void 0:o[0])==null?void 0:c.reason)||void 0;throw new pl(h,n.status,m)}return n.json()}function Xu(t){return Li(t,"/profile")}function Zu(t,{maxResults:e=20,pageToken:n,q:a}={}){const s=new URLSearchParams;return s.set("maxResults",String(e)),n&&s.set("pageToken",n),a&&s.set("q",a),Li(t,`/messages?${s}`)}function Ju(t,e,n="full"){return Li(t,`/messages/${e}?format=${n}`)}function op(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const s=new URLSearchParams;return s.set("startHistoryId",e),s.set("maxResults",String(a)),s.append("historyTypes","messageAdded"),s.append("historyTypes","messageDeleted"),n&&s.set("pageToken",n),Li(t,`/history?${s}`)}function Gr(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),s=n.find(c=>c.name.toLowerCase()===a);return(s==null?void 0:s.value)||""}function Ts(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),s=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(s)}function lp(t){var o,c,d;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Ts(e.body.data);const n=e.parts||[],a=xi(n,"text/plain");if((c=a==null?void 0:a.body)!=null&&c.data)return Ts(a.body.data);const s=xi(n,"text/html");if((d=s==null?void 0:s.body)!=null&&d.data){const h=Ts(s.body.data);return up(h)}return"(no body)"}function cp(t){var s,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((s=e.body)!=null&&s.data))return Ts(e.body.data);const n=e.parts||[],a=xi(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Ts(a.body.data):null}function xi(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=xi(n.parts,e);if(a)return a}}return null}function up(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function hl(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function $u(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function ed(t){return $u(t).charAt(0).toUpperCase()}function dp(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${s}`}catch{return"email"}}function fp(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function td(t,e){return`${dp(t.date)}_${fp(t.subject)}.${e}`}function nd(t){const e={};for(const a of t){const s=a.action||"UNKNOWN";e[s]||(e[s]=[]),e[s].push(a)}for(const a of Object.keys(e))e[a].sort((s,o)=>(o.date||0)-(s.date||0));const n=Object.keys(e).sort((a,s)=>e[s].length-e[a].length);return{groups:e,order:n}}async function vp(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:s}=await rd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),c=new Date(s.date).toLocaleDateString();n.push(`Date range: ${o} to ${c}.`)}return n.join(" ")}async function pp(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:s}=await rd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),c=new Date(s.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${c}`)}return n.join(`
`)}async function hp(t=10){const e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(ad).join(`

---

`)}async function mp(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),s=(await Ge.items.where("sourceType").equals("gmail").toArray()).map(o=>{var d,h,m,y,k;let c=0;return(d=o.subject)!=null&&d.toLowerCase().includes(n)&&(c+=3),(h=o.from)!=null&&h.toLowerCase().includes(n)&&(c+=2),(m=o.to)!=null&&m.toLowerCase().includes(n)&&(c+=2),(y=o.snippet)!=null&&y.toLowerCase().includes(n)&&(c+=1),(k=o.body)!=null&&k.toLowerCase().includes(n)&&(c+=1),{item:o,score:c}}).filter(({score:o})=>o>0).sort((o,c)=>c.score-o.score).slice(0,e);return s.length===0?`No results found for "${t}".`:s.map(({item:o})=>ad(o)).join(`

---

`)}async function kc(){const t=await Ge.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=nd(t);return{groups:e,order:n,total:t.length}}async function gp({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),c=await Ge.items.where("sourceType").equals("gmail").filter(d=>{var h,m,y,k;return((h=d.subject)==null?void 0:h.toLowerCase().includes(o))||((m=d.from)==null?void 0:m.toLowerCase().includes(o))||((y=d.to)==null?void 0:y.toLowerCase().includes(o))||((k=d.snippet)==null?void 0:k.toLowerCase().includes(o))}).toArray();return c.sort((d,h)=>(h.date||0)-(d.date||0)),{items:c.slice(n,n+e),total:c.length}}const a=await Ge.items.where("sourceType").equals("gmail").count();return{items:await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function rd(){const t=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).first(),e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).last();return{oldest:t,newest:e}}function ad(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=ap(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function _p(){const t=await vp();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function yp(t){const e=[],n=await pp();if(e.push(n),t){const a=await mp(t,5);e.push("","## Relevant Emails",a)}else{const a=await hp(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const sd="me-ai-action-pipelines",id={REPLY:[{id:"star",name:"Star",description:"Mark as important for follow-up",icon:"â­"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],FOLLOW_UP:[{id:"star",name:"Star",description:"Mark for follow-up",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],DELETE:[{id:"trash",name:"Move to Trash",description:"Move email to trash",icon:"ðï¸"}],ARCHIVE:[{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],READ_LATER:[{id:"star",name:"Star",description:"Mark for reading later",icon:"â­"},{id:"mark_unread",name:"Keep Unread",description:"Keep as unread reminder",icon:"ð§"}],REVIEW:[{id:"mark_read",name:"Mark as Read",description:"Mark as reviewed",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}],PAY_BILL:[{id:"star",name:"Star",description:"Mark for payment",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],TRACK_DELIVERY:[{id:"star",name:"Star",description:"Track delivery",icon:"â­"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],SCHEDULE_MEETING:[{id:"star",name:"Star",description:"Mark for scheduling",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],UNSUBSCRIBE:[{id:"mark_spam",name:"Mark as Spam",description:"Move to spam folder",icon:"ð«"}],SAVE_RECEIPT:[{id:"star",name:"Star",description:"Star for records",icon:"â­"},{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],ACKNOWLEDGE:[{id:"mark_read",name:"Mark as Read",description:"Mark as acknowledged",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}],NO_ACTION:[{id:"archive",name:"Archive",description:"Archive without action",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],IGNORE:[{id:"mark_spam",name:"Mark as Spam",description:"Mark as spam and remove",icon:"ð«"}]},od=[{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}];async function Us(){const{getSetting:t}=await Tr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Ra);return{getSetting:e}},void 0);return await t(sd)||{}}async function ld(t){const{setSetting:e}=await Tr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Ra);return{setSetting:n}},void 0);await e(sd,t)}async function es(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=await Us();return n[e]?n[e]:id[e]||od}const qa=es;async function bp(){const t=await Us();return[...new Set([...Object.keys(id),...Object.keys(t)])]}async function wp(){try{const{db:t}=await Tr(async()=>{const{db:a}=await Promise.resolve().then(()=>Gv);return{db:a}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(a=>a.action).filter(Boolean))].sort()}catch{return[]}}async function kp(){const t=bp(),e=await wp();return[...new Set([...t,...e])].sort()}async function Ks(t,e){const n=t.toUpperCase(),a=await Us();a[n]=e,await ld(a)}const xp=Ks;async function Sp(t,e){const n=await es(t);await Ks(t,[...n,e])}const Ep=Sp;async function Tp(t,e){const n=await es(t);await Ks(t,n.filter(a=>a.id!==e))}const Ap=Tp;async function Cp(t,e,n){const a=await es(t);await Ks(t,a.map(s=>s.id===e?{...s,...n}:s))}const Ip=Cp;async function Rp(t,e){const n=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");n&&await Ks(n,[...od])}async function Op(t){const e=t.toUpperCase(),n=await Us();delete n[e],await ld(n)}async function Pp(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=await Us();return e in n}async function Mp(t){await Op(t)}async function Dp(t,e){var s;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((s=e.body)==null?void 0:s.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=await qa(t.action);return{event:n,commands:a}}async function jp(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:a,commands:s}=await Dp(n.classification,n.email);return{event:a,commands:s}})),content:""}}async function Lp(t){const e=await Promise.all(t.order.map(async a=>{const s=t.groups[a]||[],o=await qa(a),c=s.map(d=>({emailId:d.emailId,subject:d.subject||"(no subject)",from:d.from||"",date:d.date,summary:d.summary||"",reason:d.reason||"",tags:d.tags||[],status:d.status||"pending"}));return{eventType:a,emails:c,commands:o}})),n=e.reduce((a,s)=>a+s.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}const Np=20,qp={maxTokens:512},ws=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function cd(t,{count:e=Np,force:n=!1,onProgress:a=()=>{},signal:s}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,c=0;if(n)o=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(e).toArray();else{const V=new Set(await Ge.emailClassifications.toCollection().primaryKeys());c=0,o=[],await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().until(()=>o.length>=e).each(A=>{V.has(A.id)?c++:o.push(A)})}if(o.length===0){const V=n?"No emails to scan.":`All emails already classified (${c} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:V,classified:0}),{scanned:0,classified:0,skipped:c,errors:0}}const d=Date.now(),h=performance.now();let m=0,y=0,k=0,b=0;const x=[],R=t.modelId,D=fl(R)||vl(R);if(!D)throw new Error(`Unknown model: ${R}`);if(!D.recommendedForEmailProcessing&&o.length>0){const{MODELS:V}=await Tr(async()=>{const{MODELS:G}=await Promise.resolve().then(()=>Hv);return{MODELS:G}},void 0),{OLLAMA_MODELS:A}=await Tr(async()=>{const{OLLAMA_MODELS:G}=await Promise.resolve().then(()=>Vv);return{OLLAMA_MODELS:G}},void 0),W=[...V.filter(G=>G.recommendedForEmailProcessing).map(G=>G.name),...A.filter(G=>G.recommendedForEmailProcessing).map(G=>G.displayName)],re=D.displayName||D.name;console.warn(`â ï¸ Current model (${re}) is not optimized for email processing. For best results with long emails, use: ${W.join(", ")}. Some emails may fail due to memory limits.`)}for(let V=0;V<o.length&&!(s!=null&&s.aborted);V++){const A=o[V],W=fd(A),re=[{role:"system",content:ws},{role:"user",content:W}];a({phase:"scanning",current:V+1,total:o.length,classified:m,errors:y,results:x,email:{subject:A.subject,from:A.from,date:A.date},prompt:{system:ws,user:W},systemPromptLength:ws.length,live:null,lastResult:null,totals:{outputTokens:k,inputTokens:b,elapsed:performance.now()-h}});const G=performance.now();try{const{text:me,tps:be,numTokens:le,inputTokens:de}=await t.generateFull(re,{maxTokens:512,enableThinking:!1,temperature:0},he=>{a({phase:"generating",current:V+1,total:o.length,classified:m,errors:y,results:x,email:{subject:A.subject,from:A.from,date:A.date},live:{tps:he.tps,numTokens:he.numTokens},streamingText:he.text||"",totals:{outputTokens:k,inputTokens:b,elapsed:performance.now()-h}})});k+=le,b+=de;const ie=Fp(me),ve=performance.now()-G;if(ie){await Ge.emailClassifications.put({emailId:A.id,action:ie.action,reason:ie.reason,summary:ie.summary,tags:ie.tags,subject:A.subject||"(no subject)",from:A.from||"",date:A.date,scannedAt:d,status:"pending"}),m++;const he={success:!0,email:{subject:A.subject,from:A.from,date:A.date},classification:ie,rawResponse:me,stats:{tps:be,numTokens:le,inputTokens:de,elapsed:ve},promptSize:W.length};x.push(he),a({phase:"classified",current:V+1,total:o.length,classified:m,errors:y,results:x,email:{subject:A.subject,from:A.from,date:A.date},result:ie,rawResponse:me,emailStats:{tps:be,numTokens:le,inputTokens:de,elapsed:ve},totals:{outputTokens:k,inputTokens:b,elapsed:performance.now()-h}})}}catch(me){console.error(`Triage email ${V+1} failed:`,me),y++;const be=me.message||String(me),le=be.length>200?be.slice(0,200)+"...":be;x.push({success:!1,email:{subject:A.subject,from:A.from,date:A.date},error:le,promptSize:W.length})}}const F=performance.now()-h,ae=x.length>0?Math.round(x.reduce((V,A)=>V+A.promptSize,0)/x.length):0,Q=x.filter(V=>{var A;return V.success&&((A=V.stats)==null?void 0:A.tps)}).length>0?Math.round(x.filter(V=>V.success).reduce((V,A)=>{var W;return V+(((W=A.stats)==null?void 0:W.tps)||0)},0)/x.filter(V=>{var A;return V.success&&((A=V.stats)==null?void 0:A.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:m,errors:y,results:x,summary:{avgPromptSize:ae,avgTps:Q,systemPromptSize:ws.length,processed:o.length,skipped:c,modelName:D.displayName||D.name,modelContextWindow:D.contextWindow,modelMaxEmailTokens:D.maxEmailTokens},totals:{outputTokens:k,inputTokens:b,elapsed:F}}),{scanned:o.length,classified:m,skipped:c,errors:y}}async function ud(){const t=await Ge.emailClassifications.toArray();return nd(t)}async function Bp(){const t=await Ge.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function Si(t,e){await Ge.emailClassifications.update(t,{status:e})}async function xc(){await Ge.emailClassifications.clear()}async function ml(t){await Ge.emailClassifications.where("action").equals(t).delete()}async function dd(t){await Ge.emailClassifications.delete(t)}async function Fo(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function fd(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function Fp(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const n=e.indexOf("{"),a=e.lastIndexOf("}");if(n===-1||a===-1||a<=n)return console.warn("Triage: no JSON object found in response"),null;const s=e.indexOf("[");if(s!==-1&&s<n)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(n,a+1);try{const c=JSON.parse(o);if(!c||typeof c!="object"||Array.isArray(c))return null;const d=zp(c.action);if(!d)return console.warn("Triage: missing or invalid action field"),null;let h=[];return Array.isArray(c.tags)&&(h=c.tags.filter(m=>typeof m=="string"&&m.trim()).map(m=>m.trim().toLowerCase()).slice(0,10)),{action:d,reason:String(c.reason||"").slice(0,300),summary:String(c.summary||"").slice(0,500),tags:h}}catch(c){return console.warn("Triage: failed to parse JSON response:",c.message),null}}function zp(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function zo(t){return`hsl(${ji(t)}, 55%, 55%)`}function Up(t){return`hsl(${ji(t)}, 40%, 35%)`}var Kp=I('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Gp=I('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function Wp(t,e){xt(e,!0);let n=Ne(e,"backend",15,"webgpu"),a=Ne(e,"isWebGPUAvailable",3,!0);var s=Gp(),o=g(p(s),2),c=p(o);let d;c.__click=()=>n("webgpu");var h=g(c,2);let m;h.__click=()=>n("ollama");var y=g(o,2);{var k=b=>{var x=Kp();T(b,x)};ne(y,b=>{!a()&&n()==="webgpu"&&b(k)})}ee(()=>{d=Pt(c,1,"backend-btn svelte-1n2kfl0",null,d,{active:n()==="webgpu"}),c.disabled=!a(),m=Pt(h,1,"backend-btn svelte-1n2kfl0",null,m,{active:n()==="ollama"})}),T(t,s),St()}qt(["click"]);const Hp=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Sc(...t){Hp&&console.log("[debug]",...t)}function qn(t){return Sc(`[MOUNT] ${t}`),()=>Sc(`[DESTROY] ${t}`)}var Vp=I("<option> </option>"),Yp=I('<p class="model-description svelte-1p89qnn"> </p>'),Qp=I('<span class="current-badge svelte-1p89qnn">Current</span>'),Xp=I('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Zp=I('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Jp=I('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),$p=I('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),eh=I('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),th=I('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),nh=I('<p class="error svelte-1p89qnn"> </p>'),rh=I('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function ah(t,e){xt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"gpuInfo",3,null),s=Ne(e,"error",3,null);dn(()=>qn("ModelSelector"));var o=rh(),c=p(o),d=g(p(c),2),h=g(p(d),2);Ct(h,21,()=>xr,Kt,(A,W)=>{var re=Vp(),G=p(re),me={};ee(()=>{P(G,`${u(W).name??""} â ${u(W).size??""}`),me!==(me=u(W).id)&&(re.value=(re.__value=u(W).id)??"")}),T(A,re)});var m=g(h,2);{var y=A=>{const W=ct(()=>xr.find(be=>be.id===n()));var re=$n(),G=Qe(re);{var me=be=>{var le=Yp(),de=p(le);ee(()=>P(de,u(W).description)),T(be,le)};ne(G,be=>{u(W)&&be(me)})}T(A,re)};ne(m,A=>{n()&&A(y)})}var k=g(d,2),b=g(p(k),2),x=p(b),R=g(p(x));Ct(R,21,()=>xr,Kt,(A,W)=>{var re=$p();let G;var me=p(re),be=p(me),le=g(be);{var de=fe=>{var j=Qp();T(fe,j)};ne(le,fe=>{u(W).id===n()&&fe(de)})}var ie=g(me),ve=p(ie),he=p(ve),ce=g(ie),pe=p(ce),xe=g(ce),oe=p(xe);{var ue=fe=>{var j=Xp();T(fe,j)},ke=fe=>{var j=Zp();T(fe,j)},Se=fe=>{var j=Jp();T(fe,j)};ne(oe,fe=>{u(W).recommendedForEmailProcessing?fe(ue):u(W).maxEmailTokens>=6e3?fe(ke,1):fe(Se,!1)})}ee((fe,j)=>{G=Pt(re,1,"svelte-1p89qnn",null,G,{selected:u(W).id===n()}),P(be,`${u(W).name??""} `),P(he,`${fe??""}k`),P(pe,`~${j??""}k`)},[()=>(u(W).contextWindow/1024).toFixed(0),()=>(u(W).maxEmailTokens/1e3).toFixed(0)]),T(A,re)});var D=g(k,2);{var F=A=>{var W=th(),re=g(p(W),2),G=p(re),me=g(p(G)),be=p(me),le=g(G,2),de=g(p(le)),ie=p(de),ve=g(le,2);{var he=ce=>{var pe=eh(),xe=g(p(pe)),oe=p(xe);ee(ue=>P(oe,ue),[()=>Bo(a().limits.maxBufferSize)]),T(ce,pe)};ne(ve,ce=>{var pe;(pe=a().limits)!=null&&pe.maxBufferSize&&ce(he)})}ee(()=>{P(be,a().vendor),P(ie,a().architecture)}),T(A,W)};ne(D,A=>{a()&&A(F)})}var ae=g(D,2);{var Q=A=>{var W=nh(),re=p(W);ee(()=>P(re,s())),T(A,W)};ne(ae,A=>{s()&&A(Q)})}var V=g(ae,2);V.__click=function(...A){var W;(W=e.onload)==null||W.apply(this,A)},ee(()=>V.disabled=s()),Di(h,n),T(t,o),St()}qt(["click"]);var sh=I('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),ih=I('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),oh=I('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),lh=I("<div><!></div>"),ch=I("<option> <!></option>"),uh=I("<option> <!></option>"),dh=I('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),fh=I('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),vh=I('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),ph=I('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),hh=I('<span class="current-badge svelte-1bvvk8o">Current</span>'),mh=I('<span class="installed-badge svelte-1bvvk8o">â</span>'),gh=I('<span class="rec-badge svelte-1bvvk8o">â</span>'),_h=I('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),yh=I('<p class="error svelte-1bvvk8o"> </p>'),bh=I('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function wh(t,e){xt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"error",15);const s=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let o=Pe(Nt(zs())),c=Pe(!1),d=Pe(null),h=Pe(Nt([])),m=Pe(!1);Ea(()=>{Zv().then(X=>{C(o,X,!0),y()})});async function y(){C(c,!0),C(d,null);const X=await qo(u(o));C(d,X,!0),C(c,!1),X.connected&&k()}async function k(){C(m,!0);try{const X=await $v(u(o));C(h,X.map(z=>z.name),!0)}catch(X){console.error("Failed to load Ollama models:",X),C(h,[],!0)}C(m,!1)}function b(){Jv(u(o)),y()}function x(){if(!n()){a("Please select a model");return}e.onload()}function R(X){return u(h).length?u(h).includes(X):!1}const D=Vu();var F=bh(),ae=p(F),Q=p(ae),V=g(p(Q)),A=p(V),W=g(Q,2),re=p(W);re.__change=b;var G=g(re,2);G.__click=y;var me=p(G),be=g(W,2);{var le=X=>{var z=lh();let E;var Y=p(z);{var Oe=H=>{var we=sh(),J=g(Qe(we),2),Te=p(J);ee(()=>P(Te,`Connected â¢ v${u(d).version??""}`)),T(H,we)},Ee=H=>{var we=oh(),J=g(Qe(we),2),Te=p(J),qe=p(Te),Ke=g(Te,2);{var yt=Et=>{var bt=ih(),et=g(p(bt),2),Ve=p(et),Je=g(p(Ve));Je.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var ht=g(Ve,2),Rt=g(p(ht));Rt.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,T(Et,bt)};ne(Ke,Et=>{u(d).corsError&&Et(yt)})}ee(()=>P(qe,`Disconnected: ${u(d).error??""}`)),T(H,we)};ne(Y,H=>{u(d).connected?H(Oe):H(Ee,!1)})}ee(()=>E=Pt(z,1,"connection-status svelte-1bvvk8o",null,E,{connected:u(d).connected})),T(X,z)};ne(be,X=>{u(d)&&X(le)})}var de=g(ae,2),ie=g(p(de),2),ve=p(ie);Ct(ve,21,()=>D,Kt,(X,z)=>{var E=ch(),Y=p(E),Oe=g(Y);{var Ee=J=>{var Te=_n("â");T(J,Te)},H=ct(()=>R(u(z).name));ne(Oe,J=>{u(H)&&J(Ee)})}var we={};ee(J=>{P(Y,`${u(z).displayName??""} (${u(z).params??""}) - ${J??""}k context `),we!==(we=u(z).name)&&(E.value=(E.__value=u(z).name)??"")},[()=>(u(z).contextWindow/1024).toFixed(0)]),T(X,E)});var he=g(ve);Ct(he,21,()=>Sr.filter(X=>!X.recommended),Kt,(X,z)=>{var E=uh(),Y=p(E),Oe=g(Y);{var Ee=J=>{var Te=_n("â");T(J,Te)},H=ct(()=>R(u(z).name));ne(Oe,J=>{u(H)&&J(Ee)})}var we={};ee(J=>{P(Y,`${u(z).displayName??""} (${u(z).params??""}) - ${J??""}k context `),we!==(we=u(z).name)&&(E.value=(E.__value=u(z).name)??"")},[()=>(u(z).contextWindow/1024).toFixed(0)]),T(X,E)});var ce=g(ie,2);{var pe=X=>{const z=ct(()=>Sr.find(Ee=>Ee.name===n()));var E=$n(),Y=Qe(E);{var Oe=Ee=>{var H=ph(),we=p(H),J=p(we),Te=g(we,2),qe=p(Te),Ke=p(qe),yt=g(qe,4),Et=p(yt),bt=g(yt,2);{var et=$e=>{var We=dh(),Xe=g(Qe(We),2),He=p(Xe);ee(wt=>P(He,wt),[()=>u(z).tags.join(", ")]),T($e,We)};ne(bt,$e=>{var We;(We=u(z).tags)!=null&&We.length&&$e(et)})}var Ve=g(Te,2);{var Je=$e=>{var We=fh(),Xe=g(p(We),2),He=p(Xe);ee(()=>P(He,`ollama pull ${n()??""}`)),T($e,We)},ht=ct(()=>!R(n())),Rt=$e=>{var We=vh();T($e,We)};ne(Ve,$e=>{u(ht)?$e(Je):$e(Rt,!1)})}ee($e=>{P(J,u(z).description),P(Ke,`${$e??""}k context`),P(Et,`${u(z).params??""} params`)},[()=>(u(z).contextWindow/1024).toFixed(0)]),T(Ee,H)};ne(Y,Ee=>{u(z)&&Ee(Oe)})}T(X,E)};ne(ce,X=>{n()&&X(pe)})}var xe=g(de,2),oe=g(p(xe),2),ue=p(oe),ke=g(p(ue));Ct(ke,21,()=>Sr,Kt,(X,z)=>{var E=_h();let Y;var Oe=p(E),Ee=p(Oe),H=g(Ee);{var we=$e=>{var We=hh();T($e,We)};ne(H,$e=>{u(z).name===n()&&$e(we)})}var J=g(H,2);{var Te=$e=>{var We=mh();T($e,We)},qe=ct(()=>R(u(z).name));ne(J,$e=>{u(qe)&&$e(Te)})}var Ke=g(Oe),yt=p(Ke),Et=p(yt),bt=g(Ke),et=p(bt),Ve=g(bt),Je=p(Ve);{var ht=$e=>{var We=gh();T($e,We)};ne(Je,$e=>{u(z).recommended&&$e(ht)})}var Rt=g(Je);ee(($e,We,Xe)=>{Y=Pt(E,1,"svelte-1bvvk8o",null,Y,$e),P(Ee,`${u(z).displayName??""} `),P(Et,`${We??""}k`),P(et,u(z).params),P(Rt,` ${Xe??""}`)},[()=>({selected:u(z).name===n(),installed:R(u(z).name)}),()=>(u(z).contextWindow/1024).toFixed(0),()=>u(z).tags.slice(0,2).join(", ")]),T(X,E)});var Se=g(xe,2);{var fe=X=>{var z=yh(),E=p(z);ee(()=>P(E,a())),T(X,z)};ne(Se,X=>{a()&&X(fe)})}var j=g(Se,2);j.__click=x,ee(()=>{var X;P(A,s?"ð¥ local":"âï¸ remote"),cl(re,"placeholder",s?"http://localhost:11434":"https://me-ai.metaelon.space"),G.disabled=u(c),P(me,u(c)?"Testing...":"Test"),j.disabled=!((X=u(d))!=null&&X.connected)||a()}),Qn(re,()=>u(o),X=>C(o,X)),Di(ie,n),T(t,F),St()}qt(["change","click"]);var kh=I('<span class="progress-percent svelte-r5fnze"> </span>'),xh=I('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),Sh=I('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),Eh=I('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),Th=I('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),Ah=I('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),Ch=I('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function Ih(t,e){xt(e,!0);let n=Ne(e,"message",3,""),a=Ne(e,"items",19,()=>[]);dn(()=>qn("LoadingProgress"));var s=Ch(),o=p(s),c=p(o),d=g(o,2);Ct(d,17,a,Kt,(h,m)=>{const y=ct(()=>u(m).total?rp(u(m).loaded||0,u(m).total):null);var k=Ah(),b=p(k),x=p(b),R=p(x),D=g(x,2);{var F=A=>{var W=kh(),re=p(W);ee(G=>P(re,`${G??""}%`),[()=>u(y).toFixed(1)]),T(A,W)};ne(D,A=>{u(y)!==null&&A(F)})}var ae=g(b,2);{var Q=A=>{var W=xh(),re=Qe(W),G=p(re),me=g(re,2),be=p(me),le=p(be),de=g(be,4),ie=p(de),ve=g(de,2),he=p(ve);ee((ce,pe,xe,oe,ue)=>{on(G,`width: ${ce??""}%`),P(le,pe),P(ie,xe),P(he,`(${oe??""} / ${ue??""} B)`)},[()=>Math.max(u(m).progress??0,.5).toFixed(1),()=>yo(u(m).loaded||0),()=>yo(u(m).total),()=>(u(m).loaded||0).toLocaleString(),()=>u(m).total.toLocaleString()]),T(A,W)},V=A=>{var W=Th(),re=g(Qe(W),2),G=p(re);{var me=le=>{var de=Sh(),ie=Qe(de),ve=p(ie),he=g(ie,2),ce=p(he);ee((pe,xe)=>{P(ve,pe),P(ce,`(${xe??""} B)`)},[()=>yo(u(m).loaded),()=>u(m).loaded.toLocaleString()]),T(le,de)},be=le=>{var de=Eh();T(le,de)};ne(G,le=>{u(m).loaded?le(me):le(be,!1)})}T(A,W)};ne(ae,A=>{u(m).total?A(Q):A(V,!1)})}ee(()=>{cl(x,"title",u(m).file),P(R,u(m).file)}),T(h,k)}),ee(()=>P(c,n())),T(t,s),St()}var Rh=I('<span class="thinking-tokens svelte-11gjw00"> </span>'),Oh=I('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Ph=I('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Mh=I('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Dh=I('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),jh=I('<span class="cursor svelte-11gjw00">|</span>'),Lh=I(" <!>",1),Nh=I('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),qh=I('<div class="content svelte-11gjw00"> </div>'),Bh=I('<div><div class="role svelte-11gjw00"> </div> <!></div>');function Fh(t,e){xt(e,!0);let n=Ne(e,"isLast",3,!1),a=Ne(e,"isRunning",3,!1),s=Ne(e,"generationPhase",3,null),o=Ne(e,"numTokens",3,null);dn(()=>qn(`MessageBubble[${e.msg.role}]`));var c=Bh(),d=p(c),h=p(d),m=g(d,2);{var y=b=>{var x=Nh(),R=Qe(x);{var D=G=>{var me=Oh(),be=g(p(me),4);{var le=de=>{var ie=Rh(),ve=p(ie);ee(()=>P(ve,`${o()??""} tokens`)),T(de,ie)};ne(be,de=>{o()&&de(le)})}T(G,me)},F=G=>{var me=Ph();T(G,me)};ne(R,G=>{a()&&n()&&s()==="thinking"?G(D):a()&&n()&&s()==="preparing"&&G(F,1)})}var ae=g(R,2);{var Q=G=>{var me=Mh(),be=p(me),le=g(p(be),2),de=p(le),ie=g(be,2),ve=p(ie);ee(he=>{P(de,`${he??""} words`),P(ve,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),T(G,me)};ne(ae,G=>{e.msg.thinking&&G(Q)})}var V=g(ae,2),A=p(V);{var W=G=>{var me=Dh();T(G,me)},re=G=>{var me=Lh(),be=Qe(me,!0),le=g(be);{var de=ie=>{var ve=jh();T(ie,ve)};ne(le,ie=>{a()&&n()&&ie(de)})}ee(()=>P(be,e.msg.content)),T(G,me)};ne(A,G=>{a()&&n()&&!e.msg.content&&s()!=="thinking"?G(W):G(re,!1)})}T(b,x)},k=b=>{var x=qh(),R=p(x);ee(()=>P(R,e.msg.content)),T(b,x)};ne(m,b=>{e.msg.role==="assistant"?b(y):b(k,!1)})}ee(()=>{Pt(c,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),P(h,e.msg.role==="user"?"You":"AI")}),T(t,c),St()}var zh=I('<span class="cmd-icon svelte-1m7x4wq"> </span>'),Uh=I('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),Kh=I('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Ec(t,e){xt(e,!0);var n=Kh(),a=Qe(n);a.__click=()=>{var x;return(x=e.onexecute)==null?void 0:x.call(e,e.command.id)};var s=p(a);{var o=x=>{var R=zh(),D=p(R);ee(()=>P(D,e.command.icon)),T(x,R)};ne(s,x=>{e.command.icon&&x(o)})}var c=g(s,2),d=p(c),h=p(d),m=g(d,2),y=p(m),k=g(a,2);{var b=x=>{var R=Uh(),D=p(R),F=p(D);ee(()=>P(F,e.command.body)),T(x,R)};ne(k,x=>{e.command.body&&x(b)})}ee(()=>{P(h,e.command.name),P(y,e.command.description)}),T(t,n),St()}qt(["click"]);class Gh{constructor(e,n){this.workerId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var s,o,c;const a=this.handlers.get(e);if(!a)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} worker`};try{(s=n.onProgress)==null||s.call(n,{phase:"executing",actionId:e,actionName:a.name});const d=await a.execute(n);return(o=n.onProgress)==null||o.call(n,{phase:"completed",actionId:e,actionName:a.name,result:d}),d}catch(d){const h={success:!1,error:d,message:d.message||"Unknown error"};return(c=n.onProgress)==null||c.call(n,{phase:"failed",actionId:e,actionName:a.name,error:d.message}),h}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const Wh="https://gmail.googleapis.com/gmail/v1/users/me",Ir={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Sn(t,e,n,a=null){var c;const s={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};a&&(s.body=JSON.stringify(a));const o=await fetch(`${Wh}${n}`,s);if(!o.ok){const h=((c=(await o.json().catch(()=>({}))).error)==null?void 0:c.message)||`Gmail API error: ${o.status}`;throw new Error(h)}return o.status===204?{success:!0}:o.json()}class Hh extends Gh{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.SPAM],removeLabelIds:[Ir.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[a]}),{success:!0,message:`Applied label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[a]}),{success:!0,message:`Removed label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,a=[],s=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Sn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:a,removeLabelIds:s}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Sn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const Vh=new Hh;class Yh{constructor(){this.workers=new Map,this.registerDefaultWorkers()}registerDefaultWorkers(){this.registerWorker(Vh)}registerWorker(e){this.workers.set(e.workerId,e)}getWorker(e){return this.workers.get(e)}getAllWorkers(){return Array.from(this.workers.values())}async executeAction(e,n){const a=this.resolveWorkerId(n.event.source),s=this.getWorker(a);return s?s.canExecute(e)?s.execute(e,n):{success:!1,message:`Action "${e}" not supported by ${s.serviceName}`,error:new Error(`Action not supported: ${e}`)}:{success:!1,message:`No worker found for source: ${n.event.source}`,error:new Error(`Worker not found: ${a}`)}}async executePipeline(e,n){var o,c;const a=[];let s=!0;for(const d of e){(o=n.onProgress)==null||o.call(n,{phase:"action_start",actionId:d.id,actionName:d.name});const h=await this.executeAction(d.id,n);a.push({actionId:d.id,actionName:d.name,...h}),h.success||(s=!1),(c=n.onProgress)==null||c.call(n,{phase:"action_complete",actionId:d.id,actionName:d.name,result:h})}return{success:s,results:a,message:s?`All ${a.length} actions completed successfully`:`Pipeline completed with ${a.filter(d=>!d.success).length} failure(s)`}}async executePipelineBatch(e,n,a){var c,d;const s=[];for(let h=0;h<n.length;h++){const m=n[h];(c=a.onProgress)==null||c.call(a,{phase:"batch_event_start",eventIndex:h,totalEvents:n.length,event:m});const y={...a,event:m},k=await this.executePipeline(e,y);s.push({event:m,...k}),(d=a.onProgress)==null||d.call(a,{phase:"batch_event_complete",eventIndex:h,totalEvents:n.length,event:m,result:k})}return{success:s.every(h=>h.success),results:s,total:n.length,successful:s.filter(h=>h.success).length,failed:s.filter(h=>!h.success).length,message:`Processed ${n.length} event(s): ${s.filter(h=>h.success).length} successful, ${s.filter(h=>!h.success).length} failed`}}resolveWorkerId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolveWorkerId(e),a=this.getWorker(n);return a?a.getHandlers():[]}getRequiredScopes(e,n){const a=this.resolveWorkerId(n),s=this.getWorker(a);return s?s.getRequiredScopes(e):[]}}const vd=new Yh,Tc="https://accounts.google.com/gsi/client",Qh="https://www.googleapis.com/auth/gmail.readonly",gl="me-ai:oauth-token",_l=300*1e3;let Ps=null,As=null,Jr=0;async function pd(t,e){Jr=Date.now()+e*1e3;const{setSetting:n}=await Tr(async()=>{const{setSetting:a}=await Promise.resolve().then(()=>Ra);return{setSetting:a}},void 0);await n(gl,{access_token:t,expires_at:Jr})}async function Uo(){Jr=0;const{removeSetting:t}=await Tr(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>Ra);return{removeSetting:e}},void 0);await t(gl)}async function Ni(){try{const{getSetting:t}=await Tr(async()=>{const{getSetting:s}=await Promise.resolve().then(()=>Ra);return{getSetting:s}},void 0),e=await t(gl);if(!e)return null;const{access_token:n,expires_at:a}=e;return!n||Date.now()>a-_l?(await Uo(),null):(Jr=a,{access_token:n})}catch{return await Uo(),null}}function Xh(){return Jr>0&&Date.now()<Jr-_l}function Zh(){return Jr<=0?0:Math.max(0,Jr-_l-Date.now())}function Ac(){return new Promise((t,e)=>{if(!Ps){e(new Error("Google Auth not initialized."));return}As=async n=>{n.error?e(new Error(n.error_description||n.error)):(await pd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ps.requestAccessToken({prompt:""})})}function Jh(){return new Promise((t,e)=>{var s,o;if((o=(s=window.google)==null?void 0:s.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${Tc}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=Tc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function Cc(t){await Jh(),Ps=google.accounts.oauth2.initTokenClient({client_id:t,scope:Qh,callback:e=>{As&&(As(e),As=null)}})}function $h(){return new Promise((t,e)=>{if(!Ps){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}As=async n=>{n.error?e(new Error(n.error_description||n.error)):(await pd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ps.requestAccessToken()})}async function em(t){return await Uo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function tm(t,e){try{e==null||e({phase:"starting",event:t});const n=Ni();if(!(n!=null&&n.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const a=n.access_token,s=await es(t.type);if(!s||s.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:s,actionCount:s.length});const o={accessToken:a,event:t,onProgress:e},c=await vd.executePipeline(s,o);return e==null||e({phase:"done",result:c}),c}catch(n){const a={success:!1,error:n,message:n.message||"Unknown error"};return e==null||e({phase:"error",error:n.message}),a}}async function nm(t,e,n){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=Ni();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,o=await es(t);if(!o||o.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:o,actionCount:o.length});const c=e.map(m=>({type:t,source:"gmail",data:m})),d={accessToken:s,onProgress:n},h=await vd.executePipelineBatch(o,c,d);return n==null||n({phase:"done",result:h}),h}catch(a){const s={success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length};return n==null||n({phase:"error",error:a.message}),s}}function Ic(){var t;return!!((t=Ni())!=null&&t.access_token)}var rm=I('<div class="event-subject svelte-1w66m1k"> </div>'),am=I('<span class="sep svelte-1w66m1k">Â·</span> ',1),sm=I('<div class="event-summary svelte-1w66m1k"> </div>'),im=I('<span class="tag svelte-1w66m1k"> </span>'),om=I('<div class="event-tags svelte-1w66m1k"></div>'),lm=I('<div class="event-reason svelte-1w66m1k"> </div>'),cm=I('<div class="commands svelte-1w66m1k"></div>'),um=I('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),dm=I('<span class="event-subject-inline svelte-1w66m1k"> </span>'),fm=I('<span class="sep svelte-1w66m1k">Â·</span> ',1),vm=I('<div class="event-summary svelte-1w66m1k"> </div>'),pm=I('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),hm=I('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),mm=I("<div> </div>"),gm=I('<span class="email-from svelte-1w66m1k"> </span>'),_m=I('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),ym=I('<div class="email-summary svelte-1w66m1k"> </div>'),bm=I('<span class="tag svelte-1w66m1k"> </span>'),wm=I('<div class="email-tags svelte-1w66m1k"></div>'),km=I('<span class="step-icon svelte-1w66m1k"> </span>'),xm=I('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),Sm=I("<div> </div>"),Em=I('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <button class="execute-btn svelte-1w66m1k"><!></button></div> <div class="pipeline-steps svelte-1w66m1k"></div> <!></div></div>'),Tm=I('<div class="group-emails svelte-1w66m1k"></div>'),Am=I('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <button class="execute-all-btn svelte-1w66m1k"><!></button></div> <!> <!></div>'),Cm=I('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function Im(t,e){xt(e,!0);let n=Pe(Nt({})),a=Nt({});function s(Q){if(!Q)return"â";const V=Q.replace(/<.*>/,"").trim();return V.length>40?V.slice(0,38)+"â¦":V}function o(Q){if(!Q)return"";try{return new Date(Q).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function c(Q,V){var A;(A=e.oncommand)==null||A.call(e,{event:Q,commandId:V})}async function d(Q,V){if(!Ic()){alert("Please sign in to Gmail first (Dashboard page)");return}const A=`single_${V}`;a[A]={running:!0,progress:null,result:null};try{const W=await tm(Q,re=>{a[A]={...a[A],progress:re}});a[A]={running:!1,progress:null,result:W}}catch(W){a[A]={running:!1,progress:null,result:{success:!1,message:W.message}}}}async function h(Q,V){if(!Ic()){alert("Please sign in to Gmail first (Dashboard page)");return}const A=`batch_${Q}`;a[A]={running:!0,progress:null,result:null};try{const W=await nm(Q,V,re=>{a[A]={...a[A],progress:re}});a[A]={running:!1,progress:null,result:W}}catch(W){a[A]={running:!1,progress:null,result:{success:!1,message:W.message}}}}function m(Q){C(n,{...u(n),[Q]:!u(n)[Q]},!0)}function y(Q){return Q.split("_").map(V=>V.charAt(0)+V.slice(1).toLowerCase()).join(" ")}function k(Q){return`hsl(${ji(Q)}, 55%, 55%)`}function b(Q){return a[Q]}var x=$n(),R=Qe(x);{var D=Q=>{var V=um(),A=p(V),W=p(A),re=p(W),G=p(re),me=g(re,2),be=p(me),le=g(W,2);{var de=z=>{var E=rm(),Y=p(E);ee(()=>P(Y,e.msg.event.data.subject)),T(z,E)};ne(le,z=>{var E;(E=e.msg.event.data)!=null&&E.subject&&z(de)})}var ie=g(le,2),ve=p(ie);{var he=z=>{var E=_n();ee(Y=>P(E,Y),[()=>s(e.msg.event.data.from)]),T(z,E)};ne(ve,z=>{var E;(E=e.msg.event.data)!=null&&E.from&&z(he)})}var ce=g(ve,2);{var pe=z=>{var E=am(),Y=g(Qe(E),1,!0);ee(Oe=>P(Y,Oe),[()=>o(e.msg.event.data.date)]),T(z,E)};ne(ce,z=>{var E;(E=e.msg.event.data)!=null&&E.date&&z(pe)})}var xe=g(ie,2);{var oe=z=>{var E=sm(),Y=p(E);ee(()=>P(Y,e.msg.event.metadata.summary)),T(z,E)};ne(xe,z=>{var E;(E=e.msg.event.metadata)!=null&&E.summary&&z(oe)})}var ue=g(xe,2);{var ke=z=>{var E=om();Ct(E,21,()=>e.msg.event.metadata.tags,Kt,(Y,Oe)=>{var Ee=im(),H=p(Ee);ee(()=>P(H,u(Oe))),T(Y,Ee)}),T(z,E)};ne(ue,z=>{var E,Y;(Y=(E=e.msg.event.metadata)==null?void 0:E.tags)!=null&&Y.length&&z(ke)})}var Se=g(ue,2);{var fe=z=>{var E=lm(),Y=p(E);ee(()=>P(Y,e.msg.event.metadata.reason)),T(z,E)};ne(Se,z=>{var E;(E=e.msg.event.metadata)!=null&&E.reason&&z(fe)})}var j=g(A,2);{var X=z=>{var E=cm();Ct(E,21,()=>e.msg.commands,Kt,(Y,Oe)=>{Ec(Y,{get command(){return u(Oe)},onexecute:Ee=>c(e.msg.event,Ee)})}),T(z,E)};ne(j,z=>{var E;(E=e.msg.commands)!=null&&E.length&&z(X)})}ee(()=>{P(G,e.msg.event.type),P(be,e.msg.event.source)}),T(Q,V)},F=Q=>{var V=hm(),A=p(V),W=p(A),re=p(W),G=g(A,2);Ct(G,17,()=>e.msg.items,Kt,(me,be)=>{var le=pm(),de=p(le),ie=p(de),ve=p(ie),he=p(ve),ce=g(ve,2);{var pe=z=>{var E=dm(),Y=p(E);ee(()=>P(Y,u(be).event.data.subject)),T(z,E)};ne(ce,z=>{var E;(E=u(be).event.data)!=null&&E.subject&&z(pe)})}var xe=g(ie,2),oe=p(xe);{var ue=z=>{var E=_n();ee(Y=>P(E,Y),[()=>s(u(be).event.data.from)]),T(z,E)};ne(oe,z=>{var E;(E=u(be).event.data)!=null&&E.from&&z(ue)})}var ke=g(oe,2);{var Se=z=>{var E=fm(),Y=g(Qe(E),1,!0);ee(Oe=>P(Y,Oe),[()=>o(u(be).event.data.date)]),T(z,E)};ne(ke,z=>{var E;(E=u(be).event.data)!=null&&E.date&&z(Se)})}var fe=g(xe,2);{var j=z=>{var E=vm(),Y=p(E);ee(()=>P(Y,u(be).event.metadata.summary)),T(z,E)};ne(fe,z=>{var E;(E=u(be).event.metadata)!=null&&E.summary&&z(j)})}var X=g(de,2);Ct(X,21,()=>u(be).commands,Kt,(z,E)=>{Ec(z,{get command(){return u(E)},onexecute:Y=>c(u(be).event,Y)})}),ee(()=>P(he,u(be).event.type)),T(me,le)}),ee(()=>P(re,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),T(Q,V)},ae=Q=>{var V=Cm(),A=p(V),W=g(p(A),2),re=p(W),G=g(A,2);Ct(G,17,()=>e.msg.groups,Kt,(me,be)=>{const le=ct(()=>u(n)[u(be).eventType]??!0),de=ct(()=>b(`batch_${u(be).eventType}`));var ie=Am(),ve=p(ie),he=p(ve);he.__click=()=>m(u(be).eventType);var ce=p(he);let pe;var xe=p(ce),oe=g(ce,2),ue=p(oe),ke=g(oe,4);let Se;var fe=g(he,2);fe.__click=we=>{we.stopPropagation(),h(u(be).eventType,u(be).emails)};var j=p(fe);{var X=we=>{var J=_n("â³ Running...");T(we,J)},z=we=>{var J=_n();ee(()=>P(J,u(de).result.success?`â Done (${u(de).result.successful}/${u(de).result.total})`:`â Failed (${u(de).result.failed}/${u(de).result.total})`)),T(we,J)},E=we=>{var J=_n();ee(()=>P(J,`â¶ Execute All (${u(be).emails.length??""})`)),T(we,J)};ne(j,we=>{var J,Te;(J=u(de))!=null&&J.running?we(X):(Te=u(de))!=null&&Te.result?we(z,1):we(E,!1)})}var Y=g(ve,2);{var Oe=we=>{var J=mm();let Te;var qe=p(J);ee(()=>{Te=Pt(J,1,"batch-result svelte-1w66m1k",null,Te,{success:u(de).result.success,error:!u(de).result.success}),P(qe,u(de).result.message)}),T(we,J)};ne(Y,we=>{var J;(J=u(de))!=null&&J.result&&we(Oe)})}var Ee=g(Y,2);{var H=we=>{var J=Tm();Ct(J,21,()=>u(be).emails,Kt,(Te,qe)=>{const Ke=ct(()=>b(`single_${u(qe).emailId}`));var yt=Em(),Et=p(yt),bt=p(Et),et=p(bt),Ve=g(bt,2),Je=p(Ve);{var ht=Ze=>{var _e=gm(),ft=p(_e);ee(rn=>P(ft,rn),[()=>s(u(qe).from)]),T(Ze,_e)};ne(Je,Ze=>{u(qe).from&&Ze(ht)})}var Rt=g(Je,2);{var $e=Ze=>{var _e=_m(),ft=g(Qe(_e)),rn=p(ft);ee(Zt=>P(rn,Zt),[()=>o(u(qe).date)]),T(Ze,_e)};ne(Rt,Ze=>{u(qe).date&&Ze($e)})}var We=g(Ve,2);{var Xe=Ze=>{var _e=ym(),ft=p(_e);ee(()=>P(ft,u(qe).summary)),T(Ze,_e)};ne(We,Ze=>{u(qe).summary&&Ze(Xe)})}var He=g(We,2);{var wt=Ze=>{var _e=wm();Ct(_e,21,()=>u(qe).tags,Kt,(ft,rn)=>{var Zt=bm(),pr=p(Zt);ee(()=>P(pr,u(rn))),T(ft,Zt)}),T(Ze,_e)};ne(He,Ze=>{var _e;(_e=u(qe).tags)!=null&&_e.length&&Ze(wt)})}var Bt=g(Et,2),Jt=p(Bt),Xt=g(p(Jt),2);Xt.__click=()=>d({type:u(be).eventType,source:"gmail",data:u(qe)},u(qe).emailId);var Ft=p(Xt);{var It=Ze=>{var _e=_n("â³ Running...");T(Ze,_e)},$t=Ze=>{var _e=_n();ee(()=>P(_e,u(Ke).result.success?"â Done":"â Failed")),T(Ze,_e)},it=Ze=>{var _e=_n("â¶ Execute");T(Ze,_e)};ne(Ft,Ze=>{var _e,ft;(_e=u(Ke))!=null&&_e.running?Ze(It):(ft=u(Ke))!=null&&ft.result?Ze($t,1):Ze(it,!1)})}var De=g(Jt,2);Ct(De,21,()=>u(be).commands,Kt,(Ze,_e,ft)=>{var rn=xm(),Zt=p(rn);Zt.textContent=ft+1;var pr=g(Zt,2),Bn=p(pr);{var Ot=Rn=>{var Tt=km(),Wt=p(Tt);ee(()=>P(Wt,u(_e).icon)),T(Rn,Tt)};ne(Bn,Rn=>{u(_e).icon&&Rn(Ot)})}var kn=g(Bn,2),Fn=p(kn),mn=g(kn,2),zn=p(mn);ee(()=>{P(Fn,u(_e).name),P(zn,u(_e).description)}),T(Ze,rn)});var Lt=g(De,2);{var Gt=Ze=>{var _e=Sm();let ft;var rn=p(_e);ee(()=>{ft=Pt(_e,1,"execution-result svelte-1w66m1k",null,ft,{success:u(Ke).result.success,error:!u(Ke).result.success}),P(rn,u(Ke).result.message)}),T(Ze,_e)};ne(Lt,Ze=>{var _e;(_e=u(Ke))!=null&&_e.result&&Ze(Gt)})}ee(()=>{var Ze;P(et,u(qe).subject),Xt.disabled=(Ze=u(Ke))==null?void 0:Ze.running}),T(Te,yt)}),T(we,J)};ne(Ee,we=>{u(le)&&we(H)})}ee((we,J)=>{var Te;pe=on(ce,"",pe,we),P(xe,J),P(ue,u(be).emails.length),Se=Pt(ke,0,"chevron svelte-1w66m1k",null,Se,{open:u(le)}),fe.disabled=(Te=u(de))==null?void 0:Te.running},[()=>({background:k(u(be).eventType)}),()=>y(u(be).eventType)]),T(me,ie)}),ee(()=>P(re,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} group${e.msg.groups.length===1?"":"s"}`)),T(Q,V)};ne(R,Q=>{e.msg.type==="event"?Q(D):e.msg.type==="event-batch"?Q(F,1):e.msg.type==="events-grouped"&&Q(ae,2)})}T(t,x),St()}qt(["click"]);var Rm=I('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Om=I('<span class="edate svelte-mt5nvh"> </span>'),Pm=I('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Mm=I('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Dm=I('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),jm=I('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Lm=I('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Nm(t,e){xt(e,!0);let n=Ne(e,"pendingData",3,null),a=Pe(null),s=Pe(null);function o(x){C(a,u(a)===x?null:x,!0),C(s,null)}function c(x){return x.split("_").map(R=>R.charAt(0)+R.slice(1).toLowerCase()).join(" ")}function d(x){if(!x)return"";try{return new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function h(x){if(!x)return"";const R=x.replace(/<.*>/,"").trim();return R.length>24?R.slice(0,22)+"â¦":R}var m={toggleGroup:o},y=$n(),k=Qe(y);{var b=x=>{var R=Lm(),D=p(R),F=p(D),ae=g(D,2);Ct(ae,20,()=>n().order,A=>A,(A,W)=>{const re=ct(()=>n().groups[W]),G=ct(()=>zo(W)),me=ct(()=>u(a)===W);var be=Rm();let le;be.__click=()=>o(W);let de;var ie=p(be);let ve;var he=g(ie),ce=g(he),pe=p(ce);ee(xe=>{le=Pt(be,1,"chip svelte-mt5nvh",null,le,{active:u(me)}),de=on(be,"",de,{"--c":u(G)}),ve=on(ie,"",ve,{background:u(G)}),P(he,` ${xe??""} `),P(pe,u(re).length)},[()=>c(W)]),T(A,be)});var Q=g(ae,2);{var V=A=>{const W=ct(()=>n().groups[u(a)]),re=ct(()=>zo(u(a)));var G=jm(),me=p(G);let be;var le=p(me);le.__click=()=>{C(a,null),C(s,null)};var de=g(le,2),ie=p(de),ve=g(de,2),he=p(ve),ce=g(me,2);Ct(ce,21,()=>u(W),ke=>ke.emailId,(ke,Se)=>{var fe=Pm(),j=p(fe);j.__click=()=>{var Te;return(Te=e.onaskai)==null?void 0:Te.call(e,`Tell me about the email "${u(Se).subject}" from ${u(Se).from}`)};var X=p(j),z=p(X),E=g(X,2),Y=p(E),Oe=g(Y);{var Ee=Te=>{var qe=Om(),Ke=p(qe);ee(yt=>P(Ke,yt),[()=>d(u(Se).date)]),T(Te,qe)};ne(Oe,Te=>{u(Se).date&&Te(Ee)})}var H=g(j,2),we=p(H);we.__click=()=>{var Te;return(Te=e.onmarkacted)==null?void 0:Te.call(e,u(Se).emailId)};var J=g(we,2);J.__click=()=>{var Te;return(Te=e.ondismiss)==null?void 0:Te.call(e,u(Se).emailId)},ee(Te=>{P(z,u(Se).subject),P(Y,Te)},[()=>h(u(Se).from)]),T(ke,fe)});var pe=g(ce,2),xe=p(pe);{var oe=ke=>{var Se=Mm(),fe=Qe(Se);fe.__click=()=>u(W).forEach(X=>{var z;return(z=e.onmarkacted)==null?void 0:z.call(e,X.emailId)});var j=g(fe,2);j.__click=()=>C(s,u(a),!0),T(ke,Se)},ue=ke=>{var Se=Dm(),fe=Qe(Se),j=p(fe),X=g(fe,2);X.__click=()=>C(s,null);var z=g(X,2);z.__click=()=>{var E;(E=e.oncleargroup)==null||E.call(e,u(a)),C(s,null),C(a,null)},ee(()=>P(j,`Remove ${u(W).length??""}?`)),T(ke,Se)};ne(xe,ke=>{u(s)!==u(a)?ke(oe):ke(ue,!1)})}ee(ke=>{be=on(me,"",be,{"border-color":u(re)}),P(ie,ke),P(he,u(W).length)},[()=>c(u(a))]),T(A,G)};ne(Q,A=>{u(a)&&n().groups[u(a)]&&A(V)})}ee(()=>P(F,`${n().total??""} item${n().total!==1?"s":""} need attention`)),T(x,R)};ne(k,x=>{n()&&n().total>0&&x(b)})}return T(t,y),St(m)}qt(["click"]);var qm=I('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Bm=I('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Fm=I('<div class="strip svelte-1ed7zw1"><!></div>');function zm(t,e){let n=Ne(e,"hasScanData",3,!1),a=Ne(e,"engineReady",3,!1),s=Ne(e,"isScanning",3,!1),o=ct(()=>a()&&!n()&&!s()),c=ct(()=>u(o)||s());var d=$n(),h=Qe(d);{var m=y=>{var k=Fm(),b=p(k);{var x=D=>{var F=qm();T(D,F)},R=D=>{var F=Bm();F.__click=function(...ae){var Q;(Q=e.onscan)==null||Q.apply(this,ae)},T(D,F)};ne(b,D=>{s()?D(x):u(o)&&D(R,1)})}T(y,k)};ne(h,y=>{u(c)&&y(m)})}T(t,d)}qt(["click"]);var Um=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Km=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Gm=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Wm=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Hm=I('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),Vm=I('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),Ym=I('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Qm(t,e){xt(e,!0),dn(()=>qn("GpuPanel"));var n=Ym(),a=p(n),s=g(p(a),2),o=g(p(s),2),c=p(o),d=g(s,2),h=g(p(d),2),m=p(h),y=g(d,2);{var k=A=>{var W=Um(),re=g(p(W),2),G=p(re);ee(()=>P(G,e.gpuInfo.device)),T(A,W)};ne(y,A=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&A(k)})}var b=g(y,2);{var x=A=>{var W=Km(),re=g(p(W),2),G=p(re);ee(me=>P(G,me),[()=>Bo(e.gpuInfo.limits.maxBufferSize)]),T(A,W)};ne(b,A=>{var W;(W=e.gpuInfo.limits)!=null&&W.maxBufferSize&&A(x)})}var R=g(b,2);{var D=A=>{var W=Gm(),re=g(p(W),2),G=p(re);ee(()=>P(G,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),T(A,W)};ne(R,A=>{var W;(W=e.gpuInfo.limits)!=null&&W.maxComputeInvocationsPerWorkgroup&&A(D)})}var F=g(R,2);{var ae=A=>{var W=Wm(),re=g(p(W),2),G=p(re);ee(me=>P(G,me),[()=>Bo(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),T(A,W)};ne(F,A=>{var W;(W=e.gpuInfo.limits)!=null&&W.maxComputeWorkgroupStorageSize&&A(ae)})}var Q=g(F,2);{var V=A=>{var W=Vm(),re=p(W),G=p(re),me=g(re,2);Ct(me,21,()=>e.gpuInfo.features,Kt,(be,le)=>{var de=Hm(),ie=p(de);ee(()=>P(ie,u(le))),T(be,de)}),ee(()=>P(G,`Features (${e.gpuInfo.features.length??""})`)),T(A,W)};ne(Q,A=>{var W;(W=e.gpuInfo.features)!=null&&W.length&&A(V)})}ee(()=>{P(c,e.gpuInfo.vendor),P(m,e.gpuInfo.architecture)}),T(t,n),St()}var Xm=I('<button class="gpu-badge svelte-1ktw27c"> </button>'),Zm=I('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Jm=I('<span class="stats svelte-1ktw27c"> </span>'),$m=I('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),eg=I('<span class="stats preparing svelte-1ktw27c"> </span>'),tg=I('<span class="stats svelte-1ktw27c"> </span>'),ng=I('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),rg=I('<button class="btn svelte-1ktw27c">Stop</button>'),ag=I('<button class="btn primary svelte-1ktw27c">Send</button>'),sg=I('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function ig(t,e){xt(e,!0),dn(()=>qn("ChatView"));let n=Ne(e,"messages",19,()=>[]),a=Ne(e,"pendingData",3,null),s=Ne(e,"hasScanData",3,!1),o=Ne(e,"engineReady",3,!1),c=Ne(e,"isScanning",3,!1),d=Ne(e,"isRunning",3,!1),h=Ne(e,"tps",3,null),m=Ne(e,"numTokens",3,null),y=Ne(e,"generationPhase",3,null),k=Ne(e,"gpuInfo",3,null),b=Ne(e,"backend",3,"webgpu"),x=Ne(e,"chatContainer",15),R=Pe(""),D=Pe(!1);function F(E){E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),ae())}function ae(){const E=u(R).trim();!E||d()||(C(R,""),e.onsend(E))}function Q(E){E&&!d()&&e.onsend(E)}var V=sg(),A=p(V),W=p(A);{var re=E=>{var Y=Xm();Y.__click=()=>C(D,!u(D));var Oe=p(Y);ee(()=>P(Oe,`WebGPU ${u(D)?"â²":"â¼"}`)),T(E,Y)},G=E=>{var Y=Zm();T(E,Y)};ne(W,E=>{k()?E(re):b()==="ollama"&&E(G,1)})}var me=g(W,2);{var be=E=>{var Y=Jm(),Oe=p(Y);ee((Ee,H)=>P(Oe,`${m()??""} tokens in ${Ee??""}s
        (${H??""} tok/s)`),[()=>(m()/h()).toFixed(1),()=>h().toFixed(1)]),T(E,Y)},le=E=>{var Y=$m();T(E,Y)},de=E=>{var Y=eg(),Oe=p(Y);ee(Ee=>P(Oe,`thinking... ${Ee??""}`),[()=>h()?`${h().toFixed(0)} tok/s`:""]),T(E,Y)},ie=E=>{var Y=tg(),Oe=p(Y);ee(Ee=>P(Oe,`${Ee??""} tok/s`),[()=>h().toFixed(1)]),T(E,Y)};ne(me,E=>{h()&&!d()?E(be):d()&&y()==="preparing"?E(le,1):d()&&y()==="thinking"?E(de,2):h()&&d()&&E(ie,3)})}var ve=g(me,4);ve.__click=function(...E){var Y;(Y=e.onreset)==null||Y.apply(this,E)};var he=g(A,2);{var ce=E=>{Qm(E,{get gpuInfo(){return k()}})};ne(he,E=>{u(D)&&k()&&E(ce)})}var pe=g(he,2),xe=p(pe);{var oe=E=>{var Y=ng();T(E,Y)};ne(xe,E=>{n().length===0&&!(a()&&a().total>0)&&E(oe)})}var ue=g(xe,2);Ct(ue,17,n,Kt,(E,Y,Oe)=>{var Ee=$n(),H=Qe(Ee);{var we=qe=>{Nm(qe,{get pendingData(){return u(Y).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:Q})},J=qe=>{Im(qe,{get msg(){return u(Y)},get oncommand(){return e.oncommand}})},Te=qe=>{{let Ke=ct(()=>Oe===n().length-1);Fh(qe,{get msg(){return u(Y)},get isLast(){return u(Ke)},get isRunning(){return d()},get generationPhase(){return y()},get numTokens(){return m()}})}};ne(H,qe=>{u(Y).type==="dashboard"?qe(we):u(Y).type==="event"||u(Y).type==="event-batch"||u(Y).type==="events-grouped"?qe(J,1):qe(Te,!1)})}T(E,Ee)}),Hu(pe,E=>x(E),()=>x());var ke=g(pe,2);zm(ke,{get hasScanData(){return s()},get engineReady(){return o()},get isScanning(){return c()},get onscan(){return e.onscan}});var Se=g(ke,2),fe=p(Se);fe.__keydown=F;var j=g(fe,2);{var X=E=>{var Y=rg();Y.__click=function(...Oe){var Ee;(Ee=e.onstop)==null||Ee.apply(this,Oe)},T(E,Y)},z=E=>{var Y=ag();Y.__click=ae,ee(Oe=>Y.disabled=Oe,[()=>!u(R).trim()]),T(E,Y)};ne(j,E=>{d()?E(X):E(z,!1)})}ee(()=>{ve.disabled=d(),fe.disabled=d()}),Qn(fe,()=>u(R),E=>C(R,E)),T(t,V),St()}qt(["click","keydown"]);var og=I('<div class="container center svelte-1bi93vx"><!> <!></div>');function lg(t,e){xt(e,!0);const n=!!navigator.gpu,a=Qu();let s=Pe("webgpu"),o=Pe(Nt(xr[0].id)),c=Pe(null),d=Pe(null),h=Pe(""),m=Pe(Nt([])),y=Pe(Nt([])),k=Pe(!1),b=Pe(null),x=Pe(null),R=Pe(null),D=Pe(null),F=Pe(null),ae=Pe(null),Q=Pe(!1),V=Pe(!1),A=!1;dn(async()=>{const[j,X]=await Promise.all([Rs("aiBackend"),Rs("selectedModel")]);j&&C(s,j,!0),X&&C(o,X,!0),a.check(),a.isReady&&W();const z=a.onMessage(E=>{switch(E.status){case"webgpu-info":C(D,E.data,!0);break;case"loading":C(c,"loading"),C(h,E.data,!0);break;case"initiate":C(m,[...u(m),E],!0);break;case"progress":C(m,u(m).map(Y=>Y.file===E.file?{...Y,...E}:Y),!0);break;case"done":C(m,u(m).filter(Y=>Y.file!==E.file),!0);break;case"ready":C(c,"ready"),W();break;case"start":if(!u(k))break;C(F,E.phase||"preparing",!0),C(y,[...u(y),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!u(k))break;C(F,E.phase,!0);break;case"thinking":{if(!u(k))break;C(b,E.tps,!0),C(x,E.numTokens,!0);const Y=u(y)[u(y).length-1];C(y,[...u(y).slice(0,-1),{...Y,thinking:(Y.thinking||"")+E.content}],!0),ve();break}case"thinking-done":{if(!u(k))break;C(b,E.tps,!0),C(x,E.numTokens,!0);const Y=u(y)[u(y).length-1];C(y,[...u(y).slice(0,-1),{...Y,thinking:E.content}],!0);break}case"update":{if(!u(k))break;C(b,E.tps,!0),C(x,E.numTokens,!0);const Y=u(y)[u(y).length-1];C(y,[...u(y).slice(0,-1),{...Y,content:Y.content+E.output}],!0),ve();break}case"complete":if(!u(k))break;E.tps!==void 0&&C(b,E.tps,!0),E.numTokens!==void 0&&C(x,E.numTokens,!0),C(k,!1),C(F,null),re();break;case"error":C(d,E.data,!0),u(c)==="loading"&&C(c,null),u(k)&&(C(k,!1),C(F,null));break}});return()=>z()});async function W(){if(!(A||u(y).length>0))try{const j=await kc();C(ae,j,!0),j&&(A=!0,C(y,[{role:"assistant",type:"dashboard",pendingData:j}],!0),ve());const X=await Fo();C(Q,X.classified>0)}catch{}}async function re(){try{const j=await kc();C(ae,j,!0);const X=u(y).findIndex(E=>E.type==="dashboard");X!==-1&&(j&&j.total>0?C(y,u(y).map((E,Y)=>Y===X?{...E,pendingData:j}:E),!0):C(y,u(y).filter((E,Y)=>Y!==X),!0));const z=await Fo();C(Q,z.classified>0)}catch{}}async function G(j){await Si(j,"acted"),await re()}async function me(j){await Si(j,"dismissed"),await re()}async function be(j){await dd(j),await re()}async function le(j){await ml(j),await re()}async function de(){if(u(V)||!a.isReady)return;C(V,!0);let j=null;try{if(await cd(a,{count:20,onProgress:X=>{var z;X.phase==="done"&&((z=X.results)==null?void 0:z.length)>0&&(j=X.results)}}),await re(),(j==null?void 0:j.length)>0){const X=jp(j);C(y,[...u(y),X],!0),ve()}u(ae)&&!u(y).some(X=>X.type==="dashboard")&&(C(y,[{role:"assistant",type:"dashboard",pendingData:u(ae)},...u(y)],!0),ve())}catch(X){console.error("Scan failed:",X)}finally{C(V,!1)}}function ie({event:j,commandId:X}){var z,E;`${X}${j.type}${((z=j.data)==null?void 0:z.subject)||"unknown"}`,C(y,[...u(y),{role:"assistant",content:`Command: ${X}

This command is not yet implemented. In the future, "${X}" will be executed on the ${j.source} event "${((E=j.data)==null?void 0:E.subject)||""}".`}],!0),ve()}function ve(){zu().then(()=>{u(R)&&(u(R).scrollTop=u(R).scrollHeight)})}async function he(){C(c,"loading"),await Os("selectedModel",u(o)),await Os("aiBackend",u(s)),u(s)==="ollama"&&C(D,null),a.loadModel(u(o))}Ea(()=>{u(s)==="webgpu"&&!xr.find(j=>j.id===u(o))?C(o,xr[0].id,!0):u(s)==="ollama"&&!Sr.find(j=>j.name===u(o))&&C(o,Sr[0].name,!0)});async function ce(j){if(!j||u(k))return;if(j.trim().toLowerCase()==="/events"){C(y,[...u(y),{role:"user",content:j}],!0);try{const E=await ud();if(!E.order.length)C(y,[...u(y),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const Y=Lp(E);C(y,[...u(y),Y],!0)}}catch(E){C(y,[...u(y),{role:"assistant",content:`Failed to load events: ${E.message}`}],!0)}ve();return}C(y,[...u(y),{role:"user",content:j}],!0),C(b,null),C(k,!0);let X=[];try{const Y=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(j)?await yp(j):await _p();Y&&(X=[{role:"system",content:Y}])}catch{}const z=u(y).filter(E=>E.type!=="dashboard"&&E.type!=="events-grouped"&&E.type!=="event-batch"&&E.type!=="event").map(E=>({role:E.role,content:E.content}));a.generate([...X,...z]),ve()}function pe(){a.interrupt()}function xe(){a.reset(),C(y,[],!0),C(b,null),C(x,null),A=!1,W()}var oe=$n(),ue=Qe(oe);{var ke=j=>{var X=og(),z=p(X);Wp(z,{get isWebGPUAvailable(){return n},get backend(){return u(s)},set backend(Ee){C(s,Ee,!0)}});var E=g(z,2);{var Y=Ee=>{ah(Ee,{get gpuInfo(){return u(D)},get error(){return u(d)},onload:he,get selectedModel(){return u(o)},set selectedModel(H){C(o,H,!0)}})},Oe=Ee=>{wh(Ee,{onload:he,get selectedModel(){return u(o)},set selectedModel(H){C(o,H,!0)},get error(){return u(d)},set error(H){C(d,H,!0)}})};ne(E,Ee=>{u(s)==="webgpu"?Ee(Y):u(s)==="ollama"&&Ee(Oe,1)})}T(j,X)},Se=j=>{Ih(j,{get message(){return u(h)},get items(){return u(m)}})},fe=j=>{ig(j,{get messages(){return u(y)},get pendingData(){return u(ae)},get hasScanData(){return u(Q)},get engineReady(){return a.isReady},get isScanning(){return u(V)},get isRunning(){return u(k)},get tps(){return u(b)},get numTokens(){return u(x)},get generationPhase(){return u(F)},get gpuInfo(){return u(D)},get backend(){return u(s)},onsend:ce,onstop:pe,onreset:xe,onmarkacted:G,ondismiss:me,onremove:be,oncleargroup:le,onscan:de,oncommand:ie,get chatContainer(){return u(R)},set chatContainer(X){C(R,X,!0)}})};ne(ue,j=>{u(c)===null?j(ke):u(c)==="loading"?j(Se,1):j(fe,!1)})}T(t,oe),St()}const ln="gmail",Rc=8,hd=50,md=100;async function cg(t,{limit:e=hd,onProgress:n=()=>{},signal:a}={}){var c;const s=await Ge.syncState.get(ln);if(s!=null&&s.historyId)try{return await pg(t,s,n,a)}catch(d){if(d instanceof pl&&(d.status===404||d.code==="notFound")||((c=d.message)==null?void 0:c.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Ge.syncState.delete(ln);else throw d}return await fg(t,e===0?1/0:e,n,a)}async function ug(t,{limit:e=hd,onProgress:n=()=>{},signal:a}={}){const s=await Ge.syncState.get(ln);return s!=null&&s.oldestPageToken?await vg(t,s,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function dg(){const t=await Ge.syncState.get(ln);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function gd(){await Ge.transaction("rw",[Ge.items,Ge.syncState],async()=>{await Ge.items.where("sourceType").equals(ln).delete(),await Ge.syncState.delete(ln)})}async function fg(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Aa(a);const s=await Xu(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(s.messagesTotal||e,e)});const o=[];let c,d=null;for(;o.length<e;){Aa(a);const k=e-o.length,b=await Zu(t,{maxResults:Math.min(md,k),pageToken:c}),x=(b.messages||[]).map(R=>R.id);if(o.push(...x),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(s.messagesTotal||e,e)}),c=b.nextPageToken,!c||x.length===0)break}if(d=c||null,o.length===0)return await Ge.syncState.put({sourceType:ln,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:h,errors:m}=await _d(t,o,n,a),y=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:y,oldestPageToken:d}),n({phase:"done",message:`Synced ${h} messages`,current:h,total:h}),{added:h,deleted:0,errors:m}}async function vg(t,e,n,a,s){a({phase:"listing",message:"Loading more messages...",current:0}),Aa(s);const o=[];let c=e.oldestPageToken,d=null;for(;o.length<n;){Aa(s);const k=n-o.length,b=await Zu(t,{maxResults:Math.min(md,k),pageToken:c}),x=(b.messages||[]).map(R=>R.id);if(o.push(...x),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),c=b.nextPageToken,!c||x.length===0)break}if(d=c||null,o.length===0)return await Ge.syncState.update(ln,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:h,errors:m}=await _d(t,o,a,s),y=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.update(ln,{totalItems:y,lastSyncAt:Date.now(),oldestPageToken:d}),a({phase:"done",message:d?`Downloaded ${h} more (more available)`:`Downloaded ${h} more (all synced)`,current:y,total:y}),{added:h,errors:m}}async function pg(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Aa(a);let s=0,o=0,c=0,d,h=e.historyId;do{Aa(a);const y=await op(t,{startHistoryId:e.historyId,pageToken:d});if(h=y.historyId||h,d=y.nextPageToken,!!y.history){for(const k of y.history){if(k.messagesAdded){const b=k.messagesAdded.map(R=>R.message.id),x=[...new Set(b.filter(R=>R))];if(x.length>0){const R=await Promise.allSettled(x.map(F=>Ju(t,F))),D=[];for(const F of R)F.status==="fulfilled"?D.push(yd(F.value)):c++;D.length>0&&(await Ge.items.bulkPut(D),await bd(D),s+=D.length)}}if(k.messagesDeleted){const b=k.messagesDeleted.map(x=>ul(ln,x.message.id)).filter(x=>x);b.length>0&&(await Ge.items.bulkDelete(b),o+=b.length)}}n({phase:"syncing",message:`Changes: +${s} -${o}`,current:s+o})}}while(d);const m=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:h,lastSyncAt:Date.now(),totalItems:m,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:s===0&&o===0?"Already up to date":`Synced: +${s} -${o}`,current:m,total:m}),{added:s,deleted:o,errors:c}}async function _d(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let s=0,o=0;for(let c=0;c<e.length;c+=Rc){Aa(a);const d=e.slice(c,c+Rc),h=await Promise.allSettled(d.map(y=>Ju(t,y))),m=[];for(const y of h)y.status==="fulfilled"?m.push(yd(y.value)):o++;m.length>0&&(await Ge.items.bulkPut(m),await bd(m)),s+=m.length,n({phase:"downloading",message:`Downloaded ${s} of ${e.length} messages`,current:s,total:e.length})}return{added:s,errors:o}}function yd(t){const e=Gr(t,"From"),n=Gr(t,"To"),a=Gr(t,"Cc"),s=Gr(t,"Subject")||"(no subject)",o=Gr(t,"Date"),c=Gr(t,"Message-ID"),d=Gr(t,"In-Reply-To"),h=Gr(t,"References");let m;try{m=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{m=Date.now()}return{id:ul(ln,t.id),sourceType:ln,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:s,snippet:t.snippet||"",body:lp(t),htmlBody:cp(t),date:m,labels:t.labelIds||[],messageId:c,inReplyTo:d,references:h,raw:t,syncedAt:Date.now()}}async function bd(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const s=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of s){const c=hg(o);c&&!e.has(c.email)&&e.set(c.email,{...c,date:n.date})}}for(const[n,{name:a,date:s}]of e)try{const o=await Ge.contacts.where("email").equals(n).first();if(o){const c={};a&&!o.name&&(c.name=a),s>(o.lastSeen||0)&&(c.lastSeen=s),Object.keys(c).length>0&&await Ge.contacts.update(o.id,c)}else await Ge.contacts.add({email:n,name:a||"",firstSeen:s,lastSeen:s})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function hg(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),s=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:s}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Aa(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var mg=I(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),gg=I(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),_g=I(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function yg(t,e){xt(e,!0);let n=Ne(e,"clientIdInput",15),a=Ne(e,"defaultClientId",3,"");dn(()=>qn("SetupGuide"));let s=Pe(null);async function o(R){try{await navigator.clipboard.writeText(R),C(s,R,!0),setTimeout(()=>{C(s,null)},1500)}catch{const D=document.createElement("input");D.value=R,document.body.appendChild(D),D.select(),document.execCommand("copy"),document.body.removeChild(D),C(s,R,!0),setTimeout(()=>{C(s,null)},1500)}}const c="http://localhost:5173",d="https://cypherkitty.github.io",h="https://cypherkitty.github.io/me-ai/";var m=_g(),y=p(m),k=g(p(y),4);{var b=R=>{var D=mg(),F=Qe(D),ae=g(p(F),2);ae.__click=()=>{n(a()),e.onsave()};var Q=g(F,2),V=g(p(Q),2),A=p(V),W=g(p(A),6),re=g(p(W),2),G=g(p(re),2),me=g(p(G),2),be=p(me);be.__click=()=>o(c);var le=p(be);le.textContent="http://localhost:5173";var de=g(le,2),ie=p(de),ve=g(be,2);ve.__click=()=>o(d);var he=p(ve);he.textContent="https://cypherkitty.github.io";var ce=g(he,2),pe=p(ce),xe=g(G,2),oe=g(p(xe),2),ue=p(oe);ue.__click=()=>o(c);var ke=p(ue);ke.textContent="http://localhost:5173";var Se=g(ke,2),fe=p(Se),j=g(ue,2);j.__click=()=>o(d);var X=p(j);X.textContent="https://cypherkitty.github.io";var z=g(X,2),E=p(z),Y=g(j,2);Y.__click=()=>o(h);var Oe=p(Y);Oe.textContent="https://cypherkitty.github.io/me-ai/";var Ee=g(Oe,2),H=p(Ee),we=g(A,2),J=p(we);J.__keydown=qe=>qe.key==="Enter"&&e.onsave();var Te=g(J,2);Te.__click=function(...qe){var Ke;(Ke=e.onsave)==null||Ke.apply(this,qe)},ee(qe=>{P(ie,u(s)===c?"â":"â§"),P(pe,u(s)===d?"â":"â§"),P(fe,u(s)===c?"â":"â§"),P(E,u(s)===d?"â":"â§"),P(H,u(s)===h?"â":"â§"),Te.disabled=qe},[()=>!n().trim()]),Qn(J,n),T(R,D)},x=R=>{var D=gg(),F=Qe(D),ae=g(p(F),6),Q=g(p(ae),2),V=g(p(Q),2),A=g(p(V),2),W=p(A);W.__click=()=>o(c);var re=p(W);re.textContent="http://localhost:5173";var G=g(re,2),me=p(G),be=g(W,2);be.__click=()=>o(d);var le=p(be);le.textContent="https://cypherkitty.github.io";var de=g(le,2),ie=p(de),ve=g(V,2),he=g(p(ve),2),ce=p(he);ce.__click=()=>o(c);var pe=p(ce);pe.textContent="http://localhost:5173";var xe=g(pe,2),oe=p(xe),ue=g(ce,2);ue.__click=()=>o(d);var ke=p(ue);ke.textContent="https://cypherkitty.github.io";var Se=g(ke,2),fe=p(Se),j=g(ue,2);j.__click=()=>o(h);var X=p(j);X.textContent="https://cypherkitty.github.io/me-ai/";var z=g(X,2),E=p(z),Y=g(F,2),Oe=p(Y);Oe.__keydown=H=>H.key==="Enter"&&e.onsave();var Ee=g(Oe,2);Ee.__click=function(...H){var we;(we=e.onsave)==null||we.apply(this,H)},ee(H=>{P(me,u(s)===c?"â":"â§"),P(ie,u(s)===d?"â":"â§"),P(oe,u(s)===c?"â":"â§"),P(fe,u(s)===d?"â":"â§"),P(E,u(s)===h?"â":"â§"),Ee.disabled=H},[()=>!n().trim()]),Qn(Oe,n),T(R,D)};ne(k,R=>{a()?R(b):R(x,!1)})}T(t,m),St()}qt(["click","keydown"]);function bg(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof pl?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const s=n.match(/project\s+(\d+)/),o=s==null?void 0:s[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var wg=I('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),kg=I('<div class="error-card-title svelte-14buhqq"> </div>'),xg=I('<p class="error-card-fix svelte-14buhqq"> </p>'),Sg=I('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),Eg=I('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),Tg=I('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function wd(t,e){xt(e,!0);let n=Ne(e,"ondismiss",3,null),a=Ne(e,"onsignout",3,null),s=ct(()=>bg(e.error));dn(()=>qn("ErrorCard"));var o=Tg(),c=p(o);{var d=ae=>{var Q=wg(),V=p(Q),A=p(V),W=g(V,2);W.__click=function(...re){var G;(G=n())==null||G.apply(this,re)},ee(()=>P(A,u(s).title)),T(ae,Q)},h=ae=>{var Q=kg(),V=p(Q);ee(()=>P(V,u(s).title)),T(ae,Q)};ne(c,ae=>{n()?ae(d):ae(h,!1)})}var m=g(c,2),y=p(m),k=g(m,2);{var b=ae=>{var Q=xg(),V=p(Q);ee(()=>P(V,u(s).fix)),T(ae,Q)};ne(k,ae=>{u(s).fix&&ae(b)})}var x=g(k,2);{var R=ae=>{var Q=Sg(),V=p(Q);ee(()=>{cl(Q,"href",u(s).link.url),P(V,`${u(s).link.label??""} â`)}),T(ae,Q)};ne(x,ae=>{u(s).link&&ae(R)})}var D=g(x,2);{var F=ae=>{var Q=Eg();Q.__click=function(...V){var A;(A=a())==null||A.apply(this,V)},T(ae,Q)};ne(D,ae=>{u(s).action==="signout"&&a()&&ae(F)})}ee(()=>P(y,u(s).description)),T(t,o),St()}qt(["click"]);var Ag=I('<span class="spinner svelte-nyqevv"></span> Signing in...',1),Cg=ll('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),Ig=I('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),Rg=I('<span class="client-id-value svelte-nyqevv"> </span>'),Og=I(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function Pg(t,e){xt(e,!0);let n=Ne(e,"isDefaultClientId",3,!1),a=Ne(e,"error",3,null),s=Ne(e,"loadingAuth",3,!1);dn(()=>qn("AuthCard"));var o=Og(),c=p(o),d=g(p(c),4);{var h=Q=>{wd(Q,{get error(){return a()},get onsignout(){return e.onsignout}})};ne(d,Q=>{a()&&Q(h)})}var m=g(d,2);m.__click=function(...Q){var V;(V=e.onsignin)==null||V.apply(this,Q)};var y=p(m);{var k=Q=>{var V=Ag();T(Q,V)},b=Q=>{var V=Cg();T(Q,V)};ne(y,Q=>{s()?Q(k):Q(b,!1)})}var x=g(m,4),R=g(p(x),2);{var D=Q=>{var V=Ig();T(Q,V)},F=Q=>{var V=Rg(),A=p(V);ee(W=>P(A,`${W??""}...`),[()=>e.clientId.slice(0,20)]),T(Q,V)};ne(R,Q=>{n()?Q(D):Q(F,!1)})}var ae=g(R,2);ae.__click=function(...Q){var V;(V=e.onclear)==null||V.apply(this,Q)},ee(()=>m.disabled=s()),T(t,o),St()}qt(["click"]);var Mg=I('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),Dg=I('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),jg=I('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function Lg(t,e){xt(e,!0);let n=Ne(e,"profile",3,null),a=Ne(e,"loadingProfile",3,!1);dn(()=>qn("ProfileCard"));var s=jg(),o=p(s),c=p(o),d=g(o,2),h=p(d);{var m=b=>{var x=Mg();T(b,x)},y=b=>{var x=Dg(),R=Qe(x),D=p(R),F=g(R,2),ae=p(F);ee((Q,V)=>{P(D,n().emailAddress),P(ae,`${Q??""} messages
        Â· ${V??""} threads`)},[()=>{var Q;return((Q=n().messagesTotal)==null?void 0:Q.toLocaleString())||"?"},()=>{var Q;return((Q=n().threadsTotal)==null?void 0:Q.toLocaleString())||"?"}]),T(b,x)};ne(h,b=>{a()?b(m):n()&&b(y,1)})}var k=g(d,2);k.__click=function(...b){var x;(x=e.onsignout)==null||x.apply(this,b)},ee(b=>P(c,b),[()=>n()?ed(n().emailAddress):"?"]),T(t,s),St()}qt(["click"]);var Ng=I('<span class="spinner svelte-1ds3j4k"></span>'),qg=ll('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),Bg=I('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),Fg=I('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),zg=I('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),Ug=I('<option class="svelte-1ds3j4k"> </option>'),Kg=I('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Gg=I('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),Wg=I('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Hg=I('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),Vg=I('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),Yg=I('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function Qg(t,e){xt(e,!0),dn(()=>qn("SyncStatus"));let n=Ne(e,"syncStatus",3,null),a=Ne(e,"syncProgress",3,null),s=Ne(e,"isSyncing",3,!1),o=Pe(!1),c=Pe(50);const d=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function h(oe){if(!oe)return"never";const ue=Math.floor((Date.now()-oe)/1e3);if(ue<60)return"just now";const ke=Math.floor(ue/60);if(ke<60)return`${ke}m ago`;const Se=Math.floor(ke/60);return Se<24?`${Se}h ago`:`${Math.floor(Se/24)}d ago`}function m(){var oe,ue;return!((oe=a())!=null&&oe.total)||!((ue=a())!=null&&ue.current)?0:Math.round(a().current/a().total*100)}var y=Yg(),k=p(y),b=p(k),x=p(b);{var R=oe=>{var ue=Ng();T(oe,ue)},D=oe=>{var ue=qg();T(oe,ue)};ne(x,oe=>{s()?oe(R):oe(D,!1)})}var F=g(b,2),ae=g(p(F),2);{var Q=oe=>{var ue=Bg(),ke=p(ue),Se=g(ke);{var fe=X=>{var z=_n("Â· more available");T(X,z)},j=X=>{var z=_n("Â· all synced");T(X,z)};ne(Se,X=>{n().hasMore?X(fe):X(j,!1)})}ee((X,z)=>P(ke,`${X??""} emails stored
          Â· synced ${z??""} `),[()=>n().totalItems.toLocaleString(),()=>h(n().lastSyncAt)]),T(oe,ue)},V=oe=>{var ue=Fg();T(oe,ue)};ne(ae,oe=>{var ue;(ue=n())!=null&&ue.synced?oe(Q):oe(V,!1)})}var A=g(F,2),W=p(A);{var re=oe=>{var ue=zg();ue.__click=()=>C(o,!u(o)),T(oe,ue)};ne(W,oe=>{var ue;(ue=n())!=null&&ue.synced&&!s()&&oe(re)})}var G=g(k,2),me=p(G),be=g(p(me),2);Ct(be,21,()=>d,Kt,(oe,ue)=>{var ke=Ug(),Se=p(ke),fe={};ee(()=>{P(Se,u(ue).label),fe!==(fe=u(ue).value)&&(ke.value=(ke.__value=u(ue).value)??"")}),T(oe,ke)});var le=g(me,2),de=p(le);{var ie=oe=>{var ue=Gg(),ke=Qe(ue);ke.__click=()=>e.onsync(u(c));var Se=p(ke),fe=g(ke,2);{var j=X=>{var z=Kg();z.__click=()=>e.onsyncmore(u(c));var E=p(z);ee(()=>{z.disabled=s(),P(E,s()?"Loading...":"Sync More")}),T(X,z)};ne(fe,X=>{n().hasMore&&X(j)})}ee(()=>{ke.disabled=s(),P(Se,s()?"Syncing...":"Sync New")}),T(oe,ue)},ve=oe=>{var ue=Wg();ue.__click=()=>e.onsync(u(c));var ke=p(ue);ee(()=>{ue.disabled=s(),P(ke,s()?"Syncing...":"Download Emails")}),T(oe,ue)};ne(de,oe=>{var ue;(ue=n())!=null&&ue.synced?oe(ie):oe(ve,!1)})}var he=g(G,2);{var ce=oe=>{var ue=Hg(),ke=p(ue),Se=p(ke);let fe,j;var X=g(ke,2),z=p(X);ee(E=>{fe=Pt(Se,1,"progress-fill svelte-1ds3j4k",null,fe,{indeterminate:!a().total}),j=on(Se,"",j,E),P(z,a().message||"Syncing...")},[()=>({width:`${m()??""}%`})]),T(oe,ue)};ne(he,oe=>{s()&&a()&&oe(ce)})}var pe=g(he,2);{var xe=oe=>{var ue=Vg(),ke=g(p(ue),2),Se=p(ke);Se.__click=()=>C(o,!1);var fe=g(Se,2);fe.__click=()=>{e.onclear(),C(o,!1)},T(oe,ue)};ne(pe,oe=>{u(o)&&oe(xe)})}ee(()=>be.disabled=s()),Di(be,()=>u(c),oe=>C(c,oe)),T(t,y),St()}qt(["click"]);var Xg=I('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Zg=I('<div class="message-list svelte-y2uamw"></div>');function Jg(t,e){xt(e,!0);let n=Ne(e,"messages",19,()=>[]);dn(()=>qn("MessageList"));var a=Zg();Ct(a,21,n,Kt,(s,o)=>{var c=Xg();c.__click=()=>e.onselect(u(o));var d=p(c),h=p(d),m=g(d,2),y=p(m),k=p(y),b=p(k),x=g(k,2),R=p(x),D=g(y,2),F=p(D),ae=g(D,2),Q=p(ae);ee((V,A,W)=>{P(h,V),P(b,A),P(R,W),P(F,u(o).subject),P(Q,u(o).snippet)},[()=>ed(u(o).from),()=>$u(u(o).from),()=>hl(u(o).date)]),T(s,c)}),T(t,a),St()}qt(["click"]);function yl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Oa=yl();function kd(t){Oa=t}var ua={exec:()=>null};function pt(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(s,o)=>{let c=typeof o=="string"?o:o.source;return c=c.replace(yn.caret,"$1"),n=n.replace(s,c),a},getRegex:()=>new RegExp(n,e)};return a}var $g=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),yn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},e_=/^(?:[ \t]*(?:\n|$))+/,t_=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,n_=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Gs=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,r_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,bl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,xd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Sd=pt(xd).replace(/bull/g,bl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),a_=pt(xd).replace(/bull/g,bl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),wl=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,s_=/^[^\n]+/,kl=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,i_=pt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",kl).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),o_=pt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,bl).getRegex(),qi="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xl=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,l_=pt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",xl).replace("tag",qi).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ed=pt(wl).replace("hr",Gs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qi).getRegex(),c_=pt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ed).getRegex(),Sl={blockquote:c_,code:t_,def:i_,fences:n_,heading:r_,hr:Gs,html:l_,lheading:Sd,list:o_,newline:e_,paragraph:Ed,table:ua,text:s_},Oc=pt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Gs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qi).getRegex(),u_={...Sl,lheading:a_,table:Oc,paragraph:pt(wl).replace("hr",Gs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Oc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qi).getRegex()},d_={...Sl,html:pt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",xl).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ua,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:pt(wl).replace("hr",Gs).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Sd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},f_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,v_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Td=/^( {2,}|\\)\n(?!\s*$)/,p_=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Bi=/[\p{P}\p{S}]/u,El=/[\s\p{P}\p{S}]/u,Ad=/[^\s\p{P}\p{S}]/u,h_=pt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,El).getRegex(),Cd=/(?!~)[\p{P}\p{S}]/u,m_=/(?!~)[\s\p{P}\p{S}]/u,g_=/(?:[^\s\p{P}\p{S}]|~)/u,Id=/(?![*_])[\p{P}\p{S}]/u,__=/(?![*_])[\s\p{P}\p{S}]/u,y_=/(?:[^\s\p{P}\p{S}]|[*_])/u,b_=pt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",$g?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Rd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,w_=pt(Rd,"u").replace(/punct/g,Bi).getRegex(),k_=pt(Rd,"u").replace(/punct/g,Cd).getRegex(),Od="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",x_=pt(Od,"gu").replace(/notPunctSpace/g,Ad).replace(/punctSpace/g,El).replace(/punct/g,Bi).getRegex(),S_=pt(Od,"gu").replace(/notPunctSpace/g,g_).replace(/punctSpace/g,m_).replace(/punct/g,Cd).getRegex(),E_=pt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ad).replace(/punctSpace/g,El).replace(/punct/g,Bi).getRegex(),T_=pt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Id).getRegex(),A_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",C_=pt(A_,"gu").replace(/notPunctSpace/g,y_).replace(/punctSpace/g,__).replace(/punct/g,Id).getRegex(),I_=pt(/\\(punct)/,"gu").replace(/punct/g,Bi).getRegex(),R_=pt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),O_=pt(xl).replace("(?:-->|$)","-->").getRegex(),P_=pt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",O_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ei=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,M_=pt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ei).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Pd=pt(/^!?\[(label)\]\[(ref)\]/).replace("label",Ei).replace("ref",kl).getRegex(),Md=pt(/^!?\[(ref)\](?:\[\])?/).replace("ref",kl).getRegex(),D_=pt("reflink|nolink(?!\\()","g").replace("reflink",Pd).replace("nolink",Md).getRegex(),Pc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Tl={_backpedal:ua,anyPunctuation:I_,autolink:R_,blockSkip:b_,br:Td,code:v_,del:ua,delLDelim:ua,delRDelim:ua,emStrongLDelim:w_,emStrongRDelimAst:x_,emStrongRDelimUnd:E_,escape:f_,link:M_,nolink:Md,punctuation:h_,reflink:Pd,reflinkSearch:D_,tag:P_,text:p_,url:ua},j_={...Tl,link:pt(/^!?\[(label)\]\((.*?)\)/).replace("label",Ei).getRegex(),reflink:pt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ei).getRegex()},Ko={...Tl,emStrongRDelimAst:S_,emStrongLDelim:k_,delLDelim:T_,delRDelim:C_,url:pt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Pc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:pt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Pc).getRegex()},L_={...Ko,br:pt(Td).replace("{2,}","*").getRegex(),text:pt(Ko.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},fi={normal:Sl,gfm:u_,pedantic:d_},vs={normal:Tl,gfm:Ko,breaks:L_,pedantic:j_},N_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Mc=t=>N_[t];function Rr(t,e){if(e){if(yn.escapeTest.test(t))return t.replace(yn.escapeReplace,Mc)}else if(yn.escapeTestNoEncode.test(t))return t.replace(yn.escapeReplaceNoEncode,Mc);return t}function Dc(t){try{t=encodeURI(t).replace(yn.percentDecode,"%")}catch{return null}return t}function jc(t,e){var o;let n=t.replace(yn.findPipe,(c,d,h)=>{let m=!1,y=d;for(;--y>=0&&h[y]==="\\";)m=!m;return m?"|":" |"}),a=n.split(yn.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace(yn.slashPipe,"|");return a}function ps(t,e,n){let a=t.length;if(a===0)return"";let s=0;for(;s<a&&t.charAt(a-s-1)===e;)s++;return t.slice(0,a-s)}function q_(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function B_(t,e=0){let n=e,a="";for(let s of t)if(s==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=s,n++;return a}function Lc(t,e,n,a,s){let o=e.href,c=e.title||null,d=t[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let h={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:c,text:d,tokens:a.inlineTokens(d)};return a.state.inLink=!1,h}function F_(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let s=a[1];return e.split(`
`).map(o=>{let c=o.match(n.other.beginningSpace);if(c===null)return o;let[d]=c;return d.length>=s.length?o.slice(s.length):o}).join(`
`)}var Ti=class{constructor(t){ot(this,"options");ot(this,"rules");ot(this,"lexer");this.options=t||Oa}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:ps(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=F_(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=ps(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ps(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=ps(e[0],`
`).split(`
`),a="",s="",o=[];for(;n.length>0;){let c=!1,d=[],h;for(h=0;h<n.length;h++)if(this.rules.other.blockquoteStart.test(n[h]))d.push(n[h]),c=!0;else if(!c)d.push(n[h]);else break;n=n.slice(h);let m=d.join(`
`),y=m.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${m}`:m,s=s?`${s}
${y}`:y;let k=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,o,!0),this.lexer.state.top=k,n.length===0)break;let b=o.at(-1);if((b==null?void 0:b.type)==="code")break;if((b==null?void 0:b.type)==="blockquote"){let x=b,R=x.raw+`
`+n.join(`
`),D=this.blockquote(R);o[o.length-1]=D,a=a.substring(0,a.length-x.raw.length)+D.raw,s=s.substring(0,s.length-x.text.length)+D.text;break}else if((b==null?void 0:b.type)==="list"){let x=b,R=x.raw+`
`+n.join(`
`),D=this.list(R);o[o.length-1]=D,a=a.substring(0,a.length-b.raw.length)+D.raw,s=s.substring(0,s.length-x.raw.length)+D.raw,n=R.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:s}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim(),o=s.length>1,c={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let d=this.rules.other.listItemRegex(s),h=!1;for(;t;){let y=!1,k="",b="";if(!(e=d.exec(t))||this.rules.block.hr.test(t))break;k=e[0],t=t.substring(k.length);let x=B_(e[2].split(`
`,1)[0],e[1].length),R=t.split(`
`,1)[0],D=!x.trim(),F=0;if(this.options.pedantic?(F=2,b=x.trimStart()):D?F=e[1].length+1:(F=x.search(this.rules.other.nonSpaceChar),F=F>4?1:F,b=x.slice(F),F+=e[1].length),D&&this.rules.other.blankLine.test(R)&&(k+=R+`
`,t=t.substring(R.length+1),y=!0),!y){let ae=this.rules.other.nextBulletRegex(F),Q=this.rules.other.hrRegex(F),V=this.rules.other.fencesBeginRegex(F),A=this.rules.other.headingBeginRegex(F),W=this.rules.other.htmlBeginRegex(F),re=this.rules.other.blockquoteBeginRegex(F);for(;t;){let G=t.split(`
`,1)[0],me;if(R=G,this.options.pedantic?(R=R.replace(this.rules.other.listReplaceNesting,"  "),me=R):me=R.replace(this.rules.other.tabCharGlobal,"    "),V.test(R)||A.test(R)||W.test(R)||re.test(R)||ae.test(R)||Q.test(R))break;if(me.search(this.rules.other.nonSpaceChar)>=F||!R.trim())b+=`
`+me.slice(F);else{if(D||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||V.test(x)||A.test(x)||Q.test(x))break;b+=`
`+R}D=!R.trim(),k+=G+`
`,t=t.substring(G.length+1),x=me.slice(F)}}c.loose||(h?c.loose=!0:this.rules.other.doubleBlankLine.test(k)&&(h=!0)),c.items.push({type:"list_item",raw:k,task:!!this.options.gfm&&this.rules.other.listIsTask.test(b),loose:!1,text:b,tokens:[]}),c.raw+=k}let m=c.items.at(-1);if(m)m.raw=m.raw.trimEnd(),m.text=m.text.trimEnd();else return;c.raw=c.raw.trimEnd();for(let y of c.items){if(this.lexer.state.top=!1,y.tokens=this.lexer.blockTokens(y.text,[]),y.task){if(y.text=y.text.replace(this.rules.other.listReplaceTask,""),((n=y.tokens[0])==null?void 0:n.type)==="text"||((a=y.tokens[0])==null?void 0:a.type)==="paragraph"){y.tokens[0].raw=y.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),y.tokens[0].text=y.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let b=this.lexer.inlineQueue.length-1;b>=0;b--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[b].src)){this.lexer.inlineQueue[b].src=this.lexer.inlineQueue[b].src.replace(this.rules.other.listReplaceTask,"");break}}let k=this.rules.other.listTaskCheckbox.exec(y.raw);if(k){let b={type:"checkbox",raw:k[0]+" ",checked:k[0]!=="[ ]"};y.checked=b.checked,c.loose?y.tokens[0]&&["paragraph","text"].includes(y.tokens[0].type)&&"tokens"in y.tokens[0]&&y.tokens[0].tokens?(y.tokens[0].raw=b.raw+y.tokens[0].raw,y.tokens[0].text=b.raw+y.tokens[0].text,y.tokens[0].tokens.unshift(b)):y.tokens.unshift({type:"paragraph",raw:b.raw,text:b.raw,tokens:[b]}):y.tokens.unshift(b)}}if(!c.loose){let k=y.tokens.filter(x=>x.type==="space"),b=k.length>0&&k.some(x=>this.rules.other.anyLine.test(x.raw));c.loose=b}}if(c.loose)for(let y of c.items){y.loose=!0;for(let k of y.tokens)k.type==="text"&&(k.type="paragraph")}return c}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:s}}}table(t){var c;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=jc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(c=e[3])!=null&&c.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let d of a)this.rules.other.tableAlignRight.test(d)?o.align.push("right"):this.rules.other.tableAlignCenter.test(d)?o.align.push("center"):this.rules.other.tableAlignLeft.test(d)?o.align.push("left"):o.align.push(null);for(let d=0;d<n.length;d++)o.header.push({text:n[d],tokens:this.lexer.inline(n[d]),header:!0,align:o.align[d]});for(let d of s)o.rows.push(jc(d,o.header.length).map((h,m)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:o.align[m]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=ps(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=q_(e[2],"()");if(o===-2)return;if(o>-1){let c=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,c).trim(),e[3]=""}}let a=e[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],s=o[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),Lc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[a.toLowerCase()];if(!s){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Lc(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,c,d=s,h=0,m=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(m.lastIndex=0,e=e.slice(-1*t.length+s);(a=m.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(c=[...o].length,a[3]||a[4]){d+=c;continue}else if((a[5]||a[6])&&s%3&&!((s+c)%3)){h+=c;continue}if(d-=c,d>0)continue;c=Math.min(c,c+d+h);let y=[...a[0]][0].length,k=t.slice(0,s+a.index+y+c);if(Math.min(s,c)%2){let x=k.slice(1,-1);return{type:"em",raw:k,text:x,tokens:this.lexer.inlineTokens(x)}}let b=k.slice(2,-2);return{type:"strong",raw:k,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,c,d=s,h=this.rules.inline.delRDelim;for(h.lastIndex=0,e=e.slice(-1*t.length+s);(a=h.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(c=[...o].length,c!==s))continue;if(a[3]||a[4]){d+=c;continue}if(d-=c,d>0)continue;c=Math.min(c,c+d);let m=[...a[0]][0].length,y=t.slice(0,s+a.index+m+c),k=y.slice(s,-s);return{type:"del",raw:y,text:k,tokens:this.lexer.inlineTokens(k)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,s;if(e[2]==="@")a=e[0],s="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:a,href:s,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},lr=class Go{constructor(e){ot(this,"tokens");ot(this,"options");ot(this,"state");ot(this,"inlineQueue");ot(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Oa,this.options.tokenizer=this.options.tokenizer||new Ti,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:yn,block:fi.normal,inline:vs.normal};this.options.pedantic?(n.block=fi.pedantic,n.inline=vs.pedantic):this.options.gfm&&(n.block=fi.gfm,this.options.breaks?n.inline=vs.breaks:n.inline=vs.gfm),this.tokenizer.rules=n}static get rules(){return{block:fi,inline:vs}}static lex(e,n){return new Go(n).lex(e)}static lexInline(e,n){return new Go(n).inlineTokens(e)}lex(e){e=e.replace(yn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var s,o,c;for(this.options.pedantic&&(e=e.replace(yn.tabCharGlobal,"    ").replace(yn.spaceLine,""));e;){let d;if((o=(s=this.options.extensions)==null?void 0:s.block)!=null&&o.some(m=>(d=m.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.space(e)){e=e.substring(d.raw.length);let m=n.at(-1);d.raw.length===1&&m!==void 0?m.raw+=`
`:n.push(d);continue}if(d=this.tokenizer.code(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.at(-1).src=m.text):n.push(d);continue}if(d=this.tokenizer.fences(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.heading(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.hr(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.blockquote(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.list(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.html(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.def(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.raw,this.inlineQueue.at(-1).src=m.text):this.tokens.links[d.tag]||(this.tokens.links[d.tag]={href:d.href,title:d.title},n.push(d));continue}if(d=this.tokenizer.table(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.lheading(e)){e=e.substring(d.raw.length),n.push(d);continue}let h=e;if((c=this.options.extensions)!=null&&c.startBlock){let m=1/0,y=e.slice(1),k;this.options.extensions.startBlock.forEach(b=>{k=b.call({lexer:this},y),typeof k=="number"&&k>=0&&(m=Math.min(m,k))}),m<1/0&&m>=0&&(h=e.substring(0,m+1))}if(this.state.top&&(d=this.tokenizer.paragraph(h))){let m=n.at(-1);a&&(m==null?void 0:m.type)==="paragraph"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(d),a=h.length!==e.length,e=e.substring(d.raw.length);continue}if(d=this.tokenizer.text(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(d);continue}if(e){let m="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var h,m,y,k,b;let a=e,s=null;if(this.tokens.links){let x=Object.keys(this.tokens.links);if(x.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)x.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=s[2]?s[2].length:0,a=a.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((m=(h=this.options.hooks)==null?void 0:h.emStrongMask)==null?void 0:m.call({lexer:this},a))??a;let c=!1,d="";for(;e;){c||(d=""),c=!1;let x;if((k=(y=this.options.extensions)==null?void 0:y.inline)!=null&&k.some(D=>(x=D.call({lexer:this},e,n))?(e=e.substring(x.raw.length),n.push(x),!0):!1))continue;if(x=this.tokenizer.escape(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.tag(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.link(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(x.raw.length);let D=n.at(-1);x.type==="text"&&(D==null?void 0:D.type)==="text"?(D.raw+=x.raw,D.text+=x.text):n.push(x);continue}if(x=this.tokenizer.emStrong(e,a,d)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.codespan(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.br(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.del(e,a,d)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.autolink(e)){e=e.substring(x.raw.length),n.push(x);continue}if(!this.state.inLink&&(x=this.tokenizer.url(e))){e=e.substring(x.raw.length),n.push(x);continue}let R=e;if((b=this.options.extensions)!=null&&b.startInline){let D=1/0,F=e.slice(1),ae;this.options.extensions.startInline.forEach(Q=>{ae=Q.call({lexer:this},F),typeof ae=="number"&&ae>=0&&(D=Math.min(D,ae))}),D<1/0&&D>=0&&(R=e.substring(0,D+1))}if(x=this.tokenizer.inlineText(R)){e=e.substring(x.raw.length),x.raw.slice(-1)!=="_"&&(d=x.raw.slice(-1)),c=!0;let D=n.at(-1);(D==null?void 0:D.type)==="text"?(D.raw+=x.raw,D.text+=x.text):n.push(x);continue}if(e){let D="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(D);break}else throw new Error(D)}}return n}},Ai=class{constructor(t){ot(this,"options");ot(this,"parser");this.options=t||Oa}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(yn.notSpaceStart))==null?void 0:o[0],s=t.replace(yn.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Rr(a)+'">'+(n?s:Rr(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:Rr(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let c=0;c<t.items.length;c++){let d=t.items[c];a+=this.listitem(d)}let s=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+s+o+`>
`+a+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let a="";for(let s=0;s<t.rows.length;s++){let o=t.rows[s];n="";for(let c=0;c<o.length;c++)n+=this.tablecell(o[c]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Rr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),s=Dc(t);if(s===null)return a;t=s;let o='<a href="'+t+'"';return e&&(o+=' title="'+Rr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=Dc(t);if(s===null)return Rr(n);t=s;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Rr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Rr(t.text)}},Al=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},cr=class Wo{constructor(e){ot(this,"options");ot(this,"renderer");ot(this,"textRenderer");this.options=e||Oa,this.options.renderer=this.options.renderer||new Ai,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Al}static parse(e,n){return new Wo(n).parse(e)}static parseInline(e,n){return new Wo(n).parseInline(e)}parse(e){var a,s;let n="";for(let o=0;o<e.length;o++){let c=e[o];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[c.type]){let h=c,m=this.options.extensions.renderers[h.type].call({parser:this},h);if(m!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(h.type)){n+=m||"";continue}}let d=c;switch(d.type){case"space":{n+=this.renderer.space(d);break}case"hr":{n+=this.renderer.hr(d);break}case"heading":{n+=this.renderer.heading(d);break}case"code":{n+=this.renderer.code(d);break}case"table":{n+=this.renderer.table(d);break}case"blockquote":{n+=this.renderer.blockquote(d);break}case"list":{n+=this.renderer.list(d);break}case"checkbox":{n+=this.renderer.checkbox(d);break}case"html":{n+=this.renderer.html(d);break}case"def":{n+=this.renderer.def(d);break}case"paragraph":{n+=this.renderer.paragraph(d);break}case"text":{n+=this.renderer.text(d);break}default:{let h='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return n}parseInline(e,n=this.renderer){var s,o;let a="";for(let c=0;c<e.length;c++){let d=e[c];if((o=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&o[d.type]){let m=this.options.extensions.renderers[d.type].call({parser:this},d);if(m!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){a+=m||"";continue}}let h=d;switch(h.type){case"escape":{a+=n.text(h);break}case"html":{a+=n.html(h);break}case"link":{a+=n.link(h);break}case"image":{a+=n.image(h);break}case"checkbox":{a+=n.checkbox(h);break}case"strong":{a+=n.strong(h);break}case"em":{a+=n.em(h);break}case"codespan":{a+=n.codespan(h);break}case"br":{a+=n.br(h);break}case"del":{a+=n.del(h);break}case"text":{a+=n.text(h);break}default:{let m='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return a}},hi,ks=(hi=class{constructor(t){ot(this,"options");ot(this,"block");this.options=t||Oa}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?lr.lex:lr.lexInline}provideParser(){return this.block?cr.parse:cr.parseInline}},ot(hi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ot(hi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),hi),z_=class{constructor(...t){ot(this,"defaults",yl());ot(this,"options",this.setOptions);ot(this,"parse",this.parseMarkdown(!0));ot(this,"parseInline",this.parseMarkdown(!1));ot(this,"Parser",cr);ot(this,"Renderer",Ai);ot(this,"TextRenderer",Al);ot(this,"Lexer",lr);ot(this,"Tokenizer",Ti);ot(this,"Hooks",ks);this.use(...t)}walkTokens(t,e){var a,s;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let c=o;for(let d of c.header)n=n.concat(this.walkTokens(d.tokens,e));for(let d of c.rows)for(let h of d)n=n.concat(this.walkTokens(h.tokens,e));break}case"list":{let c=o;n=n.concat(this.walkTokens(c.items,e));break}default:{let c=o;(s=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&s[c.type]?this.defaults.extensions.childTokens[c.type].forEach(d=>{let h=c[d].flat(1/0);n=n.concat(this.walkTokens(h,e))}):c.tokens&&(n=n.concat(this.walkTokens(c.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=e.renderers[s.name];o?e.renderers[s.name]=function(...c){let d=s.renderer.apply(this,c);return d===!1&&(d=o.apply(this,c)),d}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),a.extensions=e),n.renderer){let s=this.defaults.renderer||new Ai(this.defaults);for(let o in n.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let c=o,d=n.renderer[c],h=s[c];s[c]=(...m)=>{let y=d.apply(s,m);return y===!1&&(y=h.apply(s,m)),y||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Ti(this.defaults);for(let o in n.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let c=o,d=n.tokenizer[c],h=s[c];s[c]=(...m)=>{let y=d.apply(s,m);return y===!1&&(y=h.apply(s,m)),y}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new ks;for(let o in n.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let c=o,d=n.hooks[c],h=s[c];ks.passThroughHooks.has(o)?s[c]=m=>{if(this.defaults.async&&ks.passThroughHooksRespectAsync.has(o))return(async()=>{let k=await d.call(s,m);return h.call(s,k)})();let y=d.call(s,m);return h.call(s,y)}:s[c]=(...m)=>{if(this.defaults.async)return(async()=>{let k=await d.apply(s,m);return k===!1&&(k=await h.apply(s,m)),k})();let y=d.apply(s,m);return y===!1&&(y=h.apply(s,m)),y}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(c){let d=[];return d.push(o.call(this,c)),s&&(d=d.concat(s.call(this,c))),d}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return lr.lex(t,e??this.defaults)}parser(t,e){return cr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},s={...this.defaults,...a},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let c=s.hooks?await s.hooks.preprocess(e):e,d=await(s.hooks?await s.hooks.provideLexer():t?lr.lex:lr.lexInline)(c,s),h=s.hooks?await s.hooks.processAllTokens(d):d;s.walkTokens&&await Promise.all(this.walkTokens(h,s.walkTokens));let m=await(s.hooks?await s.hooks.provideParser():t?cr.parse:cr.parseInline)(h,s);return s.hooks?await s.hooks.postprocess(m):m})().catch(o);try{s.hooks&&(e=s.hooks.preprocess(e));let c=(s.hooks?s.hooks.provideLexer():t?lr.lex:lr.lexInline)(e,s);s.hooks&&(c=s.hooks.processAllTokens(c)),s.walkTokens&&this.walkTokens(c,s.walkTokens);let d=(s.hooks?s.hooks.provideParser():t?cr.parse:cr.parseInline)(c,s);return s.hooks&&(d=s.hooks.postprocess(d)),d}catch(c){return o(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Rr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},Ca=new z_;function kt(t,e){return Ca.parse(t,e)}kt.options=kt.setOptions=function(t){return Ca.setOptions(t),kt.defaults=Ca.defaults,kd(kt.defaults),kt};kt.getDefaults=yl;kt.defaults=Oa;kt.use=function(...t){return Ca.use(...t),kt.defaults=Ca.defaults,kd(kt.defaults),kt};kt.walkTokens=function(t,e){return Ca.walkTokens(t,e)};kt.parseInline=Ca.parseInline;kt.Parser=cr;kt.parser=cr.parse;kt.Renderer=Ai;kt.TextRenderer=Al;kt.Lexer=lr;kt.lexer=lr.lex;kt.Tokenizer=Ti;kt.Hooks=ks;kt.parse=kt;kt.options;kt.setOptions;kt.use;kt.walkTokens;kt.parseInline;cr.parse;lr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Dd,setPrototypeOf:Nc,isFrozen:U_,getPrototypeOf:K_,getOwnPropertyDescriptor:G_}=Object;let{freeze:bn,seal:er,create:Ho}=Object,{apply:Vo,construct:Yo}=typeof Reflect<"u"&&Reflect;bn||(bn=function(e){return e});er||(er=function(e){return e});Vo||(Vo=function(e,n){for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return e.apply(n,s)});Yo||(Yo=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return new e(...a)});const vi=wn(Array.prototype.forEach),W_=wn(Array.prototype.lastIndexOf),qc=wn(Array.prototype.pop),hs=wn(Array.prototype.push),H_=wn(Array.prototype.splice),wi=wn(String.prototype.toLowerCase),bo=wn(String.prototype.toString),wo=wn(String.prototype.match),ms=wn(String.prototype.replace),V_=wn(String.prototype.indexOf),Y_=wn(String.prototype.trim),ir=wn(Object.prototype.hasOwnProperty),gn=wn(RegExp.prototype.test),gs=Q_(TypeError);function wn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return Vo(t,e,a)}}function Q_(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Yo(t,n)}}function st(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wi;Nc&&Nc(t,null);let a=e.length;for(;a--;){let s=e[a];if(typeof s=="string"){const o=n(s);o!==s&&(U_(e)||(e[a]=o),s=o)}t[s]=!0}return t}function X_(t){for(let e=0;e<t.length;e++)ir(t,e)||(t[e]=null);return t}function _r(t){const e=Ho(null);for(const[n,a]of Dd(t))ir(t,n)&&(Array.isArray(a)?e[n]=X_(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=_r(a):e[n]=a);return e}function _s(t,e){for(;t!==null;){const a=G_(t,e);if(a){if(a.get)return wn(a.get);if(typeof a.value=="function")return wn(a.value)}t=K_(t)}function n(){return null}return n}const Bc=bn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ko=bn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xo=bn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Z_=bn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),So=bn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),J_=bn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Fc=bn(["#text"]),zc=bn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Eo=bn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Uc=bn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),pi=bn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),$_=er(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ey=er(/<%[\w\W]*|[\w\W]*%>/gm),ty=er(/\$\{[\w\W]*/gm),ny=er(/^data-[\-\w.\u00B7-\uFFFF]+$/),ry=er(/^aria-[\-\w]+$/),jd=er(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ay=er(/^(?:\w+script|data):/i),sy=er(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ld=er(/^html$/i),iy=er(/^[a-z][.\w]*(-[.\w]+)+$/i);var Kc=Object.freeze({__proto__:null,ARIA_ATTR:ry,ATTR_WHITESPACE:sy,CUSTOM_ELEMENT:iy,DATA_ATTR:ny,DOCTYPE_NAME:Ld,ERB_EXPR:ey,IS_ALLOWED_URI:jd,IS_SCRIPT_OR_DATA:ay,MUSTACHE_EXPR:$_,TMPLIT_EXPR:ty});const ys={element:1,text:3,progressingInstruction:7,comment:8,document:9},oy=function(){return typeof window>"u"?null:window},ly=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(a=n.getAttribute(s));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Gc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Nd(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oy();const e=Ue=>Nd(Ue);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==ys.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,s=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:c,Node:d,Element:h,NodeFilter:m,NamedNodeMap:y=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:k,DOMParser:b,trustedTypes:x}=t,R=h.prototype,D=_s(R,"cloneNode"),F=_s(R,"remove"),ae=_s(R,"nextSibling"),Q=_s(R,"childNodes"),V=_s(R,"parentNode");if(typeof c=="function"){const Ue=n.createElement("template");Ue.content&&Ue.content.ownerDocument&&(n=Ue.content.ownerDocument)}let A,W="";const{implementation:re,createNodeIterator:G,createDocumentFragment:me,getElementsByTagName:be}=n,{importNode:le}=a;let de=Gc();e.isSupported=typeof Dd=="function"&&typeof V=="function"&&re&&re.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ie,ERB_EXPR:ve,TMPLIT_EXPR:he,DATA_ATTR:ce,ARIA_ATTR:pe,IS_SCRIPT_OR_DATA:xe,ATTR_WHITESPACE:oe,CUSTOM_ELEMENT:ue}=Kc;let{IS_ALLOWED_URI:ke}=Kc,Se=null;const fe=st({},[...Bc,...ko,...xo,...So,...Fc]);let j=null;const X=st({},[...zc,...Eo,...Uc,...pi]);let z=Object.seal(Ho(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),E=null,Y=null;const Oe=Object.seal(Ho(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ee=!0,H=!0,we=!1,J=!0,Te=!1,qe=!0,Ke=!1,yt=!1,Et=!1,bt=!1,et=!1,Ve=!1,Je=!0,ht=!1;const Rt="user-content-";let $e=!0,We=!1,Xe={},He=null;const wt=st({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Bt=null;const Jt=st({},["audio","video","img","source","image","track"]);let Xt=null;const Ft=st({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),It="http://www.w3.org/1998/Math/MathML",$t="http://www.w3.org/2000/svg",it="http://www.w3.org/1999/xhtml";let De=it,Lt=!1,Gt=null;const Ze=st({},[It,$t,it],bo);let _e=st({},["mi","mo","mn","ms","mtext"]),ft=st({},["annotation-xml"]);const rn=st({},["title","style","font","a","script"]);let Zt=null;const pr=["application/xhtml+xml","text/html"],Bn="text/html";let Ot=null,kn=null;const Fn=n.createElement("form"),mn=function(M){return M instanceof RegExp||M instanceof Function},zn=function(){let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(kn&&kn===M)){if((!M||typeof M!="object")&&(M={}),M=_r(M),Zt=pr.indexOf(M.PARSER_MEDIA_TYPE)===-1?Bn:M.PARSER_MEDIA_TYPE,Ot=Zt==="application/xhtml+xml"?bo:wi,Se=ir(M,"ALLOWED_TAGS")?st({},M.ALLOWED_TAGS,Ot):fe,j=ir(M,"ALLOWED_ATTR")?st({},M.ALLOWED_ATTR,Ot):X,Gt=ir(M,"ALLOWED_NAMESPACES")?st({},M.ALLOWED_NAMESPACES,bo):Ze,Xt=ir(M,"ADD_URI_SAFE_ATTR")?st(_r(Ft),M.ADD_URI_SAFE_ATTR,Ot):Ft,Bt=ir(M,"ADD_DATA_URI_TAGS")?st(_r(Jt),M.ADD_DATA_URI_TAGS,Ot):Jt,He=ir(M,"FORBID_CONTENTS")?st({},M.FORBID_CONTENTS,Ot):wt,E=ir(M,"FORBID_TAGS")?st({},M.FORBID_TAGS,Ot):_r({}),Y=ir(M,"FORBID_ATTR")?st({},M.FORBID_ATTR,Ot):_r({}),Xe=ir(M,"USE_PROFILES")?M.USE_PROFILES:!1,Ee=M.ALLOW_ARIA_ATTR!==!1,H=M.ALLOW_DATA_ATTR!==!1,we=M.ALLOW_UNKNOWN_PROTOCOLS||!1,J=M.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=M.SAFE_FOR_TEMPLATES||!1,qe=M.SAFE_FOR_XML!==!1,Ke=M.WHOLE_DOCUMENT||!1,bt=M.RETURN_DOM||!1,et=M.RETURN_DOM_FRAGMENT||!1,Ve=M.RETURN_TRUSTED_TYPE||!1,Et=M.FORCE_BODY||!1,Je=M.SANITIZE_DOM!==!1,ht=M.SANITIZE_NAMED_PROPS||!1,$e=M.KEEP_CONTENT!==!1,We=M.IN_PLACE||!1,ke=M.ALLOWED_URI_REGEXP||jd,De=M.NAMESPACE||it,_e=M.MATHML_TEXT_INTEGRATION_POINTS||_e,ft=M.HTML_INTEGRATION_POINTS||ft,z=M.CUSTOM_ELEMENT_HANDLING||{},M.CUSTOM_ELEMENT_HANDLING&&mn(M.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(z.tagNameCheck=M.CUSTOM_ELEMENT_HANDLING.tagNameCheck),M.CUSTOM_ELEMENT_HANDLING&&mn(M.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(z.attributeNameCheck=M.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),M.CUSTOM_ELEMENT_HANDLING&&typeof M.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(z.allowCustomizedBuiltInElements=M.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(H=!1),et&&(bt=!0),Xe&&(Se=st({},Fc),j=[],Xe.html===!0&&(st(Se,Bc),st(j,zc)),Xe.svg===!0&&(st(Se,ko),st(j,Eo),st(j,pi)),Xe.svgFilters===!0&&(st(Se,xo),st(j,Eo),st(j,pi)),Xe.mathMl===!0&&(st(Se,So),st(j,Uc),st(j,pi))),M.ADD_TAGS&&(typeof M.ADD_TAGS=="function"?Oe.tagCheck=M.ADD_TAGS:(Se===fe&&(Se=_r(Se)),st(Se,M.ADD_TAGS,Ot))),M.ADD_ATTR&&(typeof M.ADD_ATTR=="function"?Oe.attributeCheck=M.ADD_ATTR:(j===X&&(j=_r(j)),st(j,M.ADD_ATTR,Ot))),M.ADD_URI_SAFE_ATTR&&st(Xt,M.ADD_URI_SAFE_ATTR,Ot),M.FORBID_CONTENTS&&(He===wt&&(He=_r(He)),st(He,M.FORBID_CONTENTS,Ot)),M.ADD_FORBID_CONTENTS&&(He===wt&&(He=_r(He)),st(He,M.ADD_FORBID_CONTENTS,Ot)),$e&&(Se["#text"]=!0),Ke&&st(Se,["html","head","body"]),Se.table&&(st(Se,["tbody"]),delete E.tbody),M.TRUSTED_TYPES_POLICY){if(typeof M.TRUSTED_TYPES_POLICY.createHTML!="function")throw gs('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof M.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw gs('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');A=M.TRUSTED_TYPES_POLICY,W=A.createHTML("")}else A===void 0&&(A=ly(x,s)),A!==null&&typeof W=="string"&&(W=A.createHTML(""));bn&&bn(M),kn=M}},Rn=st({},[...ko,...xo,...Z_]),Tt=st({},[...So,...J_]),Wt=function(M){let Ie=V(M);(!Ie||!Ie.tagName)&&(Ie={namespaceURI:De,tagName:"template"});const Me=wi(M.tagName),mt=wi(Ie.tagName);return Gt[M.namespaceURI]?M.namespaceURI===$t?Ie.namespaceURI===it?Me==="svg":Ie.namespaceURI===It?Me==="svg"&&(mt==="annotation-xml"||_e[mt]):!!Rn[Me]:M.namespaceURI===It?Ie.namespaceURI===it?Me==="math":Ie.namespaceURI===$t?Me==="math"&&ft[mt]:!!Tt[Me]:M.namespaceURI===it?Ie.namespaceURI===$t&&!ft[mt]||Ie.namespaceURI===It&&!_e[mt]?!1:!Tt[Me]&&(rn[Me]||!Rn[Me]):!!(Zt==="application/xhtml+xml"&&Gt[M.namespaceURI]):!1},Un=function(M){hs(e.removed,{element:M});try{V(M).removeChild(M)}catch{F(M)}},Kn=function(M,Ie){try{hs(e.removed,{attribute:Ie.getAttributeNode(M),from:Ie})}catch{hs(e.removed,{attribute:null,from:Ie})}if(Ie.removeAttribute(M),M==="is")if(bt||et)try{Un(Ie)}catch{}else try{Ie.setAttribute(M,"")}catch{}},$r=function(M){let Ie=null,Me=null;if(Et)M="<remove></remove>"+M;else{const zt=wo(M,/^[\r\n\t ]+/);Me=zt&&zt[0]}Zt==="application/xhtml+xml"&&De===it&&(M='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+M+"</body></html>");const mt=A?A.createHTML(M):M;if(De===it)try{Ie=new b().parseFromString(mt,Zt)}catch{}if(!Ie||!Ie.documentElement){Ie=re.createDocument(De,"template",null);try{Ie.documentElement.innerHTML=Lt?W:mt}catch{}}const Mt=Ie.body||Ie.documentElement;return M&&Me&&Mt.insertBefore(n.createTextNode(Me),Mt.childNodes[0]||null),De===it?be.call(Ie,Ke?"html":"body")[0]:Ke?Ie.documentElement:Mt},ea=function(M){return G.call(M.ownerDocument||M,M,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},ts=function(M){return M instanceof k&&(typeof M.nodeName!="string"||typeof M.textContent!="string"||typeof M.removeChild!="function"||!(M.attributes instanceof y)||typeof M.removeAttribute!="function"||typeof M.setAttribute!="function"||typeof M.namespaceURI!="string"||typeof M.insertBefore!="function"||typeof M.hasChildNodes!="function")},tr=function(M){return typeof d=="function"&&M instanceof d};function fn(Ue,M,Ie){vi(Ue,Me=>{Me.call(e,M,Ie,kn)})}const nr=function(M){let Ie=null;if(fn(de.beforeSanitizeElements,M,null),ts(M))return Un(M),!0;const Me=Ot(M.nodeName);if(fn(de.uponSanitizeElement,M,{tagName:Me,allowedTags:Se}),qe&&M.hasChildNodes()&&!tr(M.firstElementChild)&&gn(/<[/\w!]/g,M.innerHTML)&&gn(/<[/\w!]/g,M.textContent)||M.nodeType===ys.progressingInstruction||qe&&M.nodeType===ys.comment&&gn(/<[/\w]/g,M.data))return Un(M),!0;if(!(Oe.tagCheck instanceof Function&&Oe.tagCheck(Me))&&(!Se[Me]||E[Me])){if(!E[Me]&&Ws(Me)&&(z.tagNameCheck instanceof RegExp&&gn(z.tagNameCheck,Me)||z.tagNameCheck instanceof Function&&z.tagNameCheck(Me)))return!1;if($e&&!He[Me]){const mt=V(M)||M.parentNode,Mt=Q(M)||M.childNodes;if(Mt&&mt){const zt=Mt.length;for(let Vt=zt-1;Vt>=0;--Vt){const xn=D(Mt[Vt],!0);xn.__removalCount=(M.__removalCount||0)+1,mt.insertBefore(xn,ae(M))}}}return Un(M),!0}return M instanceof h&&!Wt(M)||(Me==="noscript"||Me==="noembed"||Me==="noframes")&&gn(/<\/no(script|embed|frames)/i,M.innerHTML)?(Un(M),!0):(Te&&M.nodeType===ys.text&&(Ie=M.textContent,vi([ie,ve,he],mt=>{Ie=ms(Ie,mt," ")}),M.textContent!==Ie&&(hs(e.removed,{element:M.cloneNode()}),M.textContent=Ie)),fn(de.afterSanitizeElements,M,null),!1)},ta=function(M,Ie,Me){if(Je&&(Ie==="id"||Ie==="name")&&(Me in n||Me in Fn))return!1;if(!(H&&!Y[Ie]&&gn(ce,Ie))){if(!(Ee&&gn(pe,Ie))){if(!(Oe.attributeCheck instanceof Function&&Oe.attributeCheck(Ie,M))){if(!j[Ie]||Y[Ie]){if(!(Ws(M)&&(z.tagNameCheck instanceof RegExp&&gn(z.tagNameCheck,M)||z.tagNameCheck instanceof Function&&z.tagNameCheck(M))&&(z.attributeNameCheck instanceof RegExp&&gn(z.attributeNameCheck,Ie)||z.attributeNameCheck instanceof Function&&z.attributeNameCheck(Ie,M))||Ie==="is"&&z.allowCustomizedBuiltInElements&&(z.tagNameCheck instanceof RegExp&&gn(z.tagNameCheck,Me)||z.tagNameCheck instanceof Function&&z.tagNameCheck(Me))))return!1}else if(!Xt[Ie]){if(!gn(ke,ms(Me,oe,""))){if(!((Ie==="src"||Ie==="xlink:href"||Ie==="href")&&M!=="script"&&V_(Me,"data:")===0&&Bt[M])){if(!(we&&!gn(xe,ms(Me,oe,"")))){if(Me)return!1}}}}}}}return!0},Ws=function(M){return M!=="annotation-xml"&&wo(M,ue)},rr=function(M){fn(de.beforeSanitizeAttributes,M,null);const{attributes:Ie}=M;if(!Ie||ts(M))return;const Me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:j,forceKeepAttr:void 0};let mt=Ie.length;for(;mt--;){const Mt=Ie[mt],{name:zt,namespaceURI:Vt,value:xn}=Mt,hr=Ot(zt),na=xn;let jt=zt==="value"?na:Y_(na);if(Me.attrName=hr,Me.attrValue=jt,Me.keepAttr=!0,Me.forceKeepAttr=void 0,fn(de.uponSanitizeAttribute,M,Me),jt=Me.attrValue,ht&&(hr==="id"||hr==="name")&&(Kn(zt,M),jt=Rt+jt),qe&&gn(/((--!?|])>)|<\/(style|title|textarea)/i,jt)){Kn(zt,M);continue}if(hr==="attributename"&&wo(jt,"href")){Kn(zt,M);continue}if(Me.forceKeepAttr)continue;if(!Me.keepAttr){Kn(zt,M);continue}if(!J&&gn(/\/>/i,jt)){Kn(zt,M);continue}Te&&vi([ie,ve,he],ra=>{jt=ms(jt,ra," ")});const ns=Ot(M.nodeName);if(!ta(ns,hr,jt)){Kn(zt,M);continue}if(A&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Vt)switch(x.getAttributeType(ns,hr)){case"TrustedHTML":{jt=A.createHTML(jt);break}case"TrustedScriptURL":{jt=A.createScriptURL(jt);break}}if(jt!==na)try{Vt?M.setAttributeNS(Vt,zt,jt):M.setAttribute(zt,jt),ts(M)?Un(M):qc(e.removed)}catch{Kn(zt,M)}}fn(de.afterSanitizeAttributes,M,null)},Hs=function Ue(M){let Ie=null;const Me=ea(M);for(fn(de.beforeSanitizeShadowDOM,M,null);Ie=Me.nextNode();)fn(de.uponSanitizeShadowNode,Ie,null),nr(Ie),rr(Ie),Ie.content instanceof o&&Ue(Ie.content);fn(de.afterSanitizeShadowDOM,M,null)};return e.sanitize=function(Ue){let M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie=null,Me=null,mt=null,Mt=null;if(Lt=!Ue,Lt&&(Ue="<!-->"),typeof Ue!="string"&&!tr(Ue))if(typeof Ue.toString=="function"){if(Ue=Ue.toString(),typeof Ue!="string")throw gs("dirty is not a string, aborting")}else throw gs("toString is not a function");if(!e.isSupported)return Ue;if(yt||zn(M),e.removed=[],typeof Ue=="string"&&(We=!1),We){if(Ue.nodeName){const xn=Ot(Ue.nodeName);if(!Se[xn]||E[xn])throw gs("root node is forbidden and cannot be sanitized in-place")}}else if(Ue instanceof d)Ie=$r("<!---->"),Me=Ie.ownerDocument.importNode(Ue,!0),Me.nodeType===ys.element&&Me.nodeName==="BODY"||Me.nodeName==="HTML"?Ie=Me:Ie.appendChild(Me);else{if(!bt&&!Te&&!Ke&&Ue.indexOf("<")===-1)return A&&Ve?A.createHTML(Ue):Ue;if(Ie=$r(Ue),!Ie)return bt?null:Ve?W:""}Ie&&Et&&Un(Ie.firstChild);const zt=ea(We?Ue:Ie);for(;mt=zt.nextNode();)nr(mt),rr(mt),mt.content instanceof o&&Hs(mt.content);if(We)return Ue;if(bt){if(et)for(Mt=me.call(Ie.ownerDocument);Ie.firstChild;)Mt.appendChild(Ie.firstChild);else Mt=Ie;return(j.shadowroot||j.shadowrootmode)&&(Mt=le.call(a,Mt,!0)),Mt}let Vt=Ke?Ie.outerHTML:Ie.innerHTML;return Ke&&Se["!doctype"]&&Ie.ownerDocument&&Ie.ownerDocument.doctype&&Ie.ownerDocument.doctype.name&&gn(Ld,Ie.ownerDocument.doctype.name)&&(Vt="<!DOCTYPE "+Ie.ownerDocument.doctype.name+`>
`+Vt),Te&&vi([ie,ve,he],xn=>{Vt=ms(Vt,xn," ")}),A&&Ve?A.createHTML(Vt):Vt},e.setConfig=function(){let Ue=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};zn(Ue),yt=!0},e.clearConfig=function(){kn=null,yt=!1},e.isValidAttribute=function(Ue,M,Ie){kn||zn({});const Me=Ot(Ue),mt=Ot(M);return ta(Me,mt,Ie)},e.addHook=function(Ue,M){typeof M=="function"&&hs(de[Ue],M)},e.removeHook=function(Ue,M){if(M!==void 0){const Ie=W_(de[Ue],M);return Ie===-1?void 0:H_(de[Ue],Ie,1)[0]}return qc(de[Ue])},e.removeHooks=function(Ue){de[Ue]=[]},e.removeAllHooks=function(){de=Gc()},e}var cy=Nd();function uy(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Wc(t.from)} |`),e.push(`| **To** | ${Wc(t.to)} |`),e.push(`| **Date** | ${hl(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?dy(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Wc(t){return(t||"").replace(/\|/g,"\\|")}function dy(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Qo(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function fy(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const s=e.toLowerCase();return s.includes("spacer")||s.includes("transparent")||s.includes("transp.gif")||s.includes("/track")&&s.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(s)?!0:s.includes("mail.google.com/mail/u/")&&s.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(s)||s.endsWith(".gif")&&s.includes("1x1"))}function Qo(t){var s;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",c=t.getAttribute("alt")||"";return fy(t,o)?"":`![${c}](${o})`}const n=Array.from(t.childNodes).map(Qo).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((s=t.parentElement)==null?void 0:s.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(c=>Qo(c).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),c=(o.match(/\|/g)||[]).length-1,d="| "+Array(Math.max(c,1)).fill("---").join(" | ")+" |";return`${o}${d}
`}return n}function vy(t){return td(t,"md")}function Hc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function py(t){return t.raw||null}function hy(t){const e=py(t);return e?JSON.stringify(e,null,2):"null"}function my(t){return td(t,"json")}var gy=I('<button title="View as Markdown">.md</button>'),_y=I('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),yy=I('<pre class="md-raw svelte-1b0rzpb"> </pre>'),by=I('<div class="md-preview svelte-1b0rzpb"><!></div>'),wy=I('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),ky=I('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),xy=I('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),Sy=I('<pre class="message-text svelte-1b0rzpb"> </pre>'),Ey=I('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),Ty=I('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),Ay=I('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function Cy(t,e){xt(e,!0);let n=Ne(e,"loading",3,!1);dn(()=>qn("MessageModal"));const a=new kt.Renderer;a.link=({href:ie,title:ve,text:he})=>{const ce=ve?` title="${ve}"`:"";return`<a href="${ie}"${ce} target="_blank" rel="noopener">${he}</a>`},kt.setOptions({breaks:!0,gfm:!0,renderer:a});let s=Pe("email"),o=ct(()=>e.message.body?uy(e.message):""),c=ct(()=>hy(e.message)),d=Pe("raw");function h(ie){C(s,u(s)===ie?"email":ie,!0),ie==="markdown"&&C(d,"raw")}function m(){Hc(u(o),vy(e.message))}function y(){Hc(u(c),my(e.message),"application/json;charset=utf-8")}function k(ie){const ve=kt.parse(ie);return cy.sanitize(ve,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let b=Pe(null);Ea(()=>{var ie;if(u(b)&&e.message.htmlBody&&!n()&&u(s)==="email"){const ve=u(b).contentDocument||((ie=u(b).contentWindow)==null?void 0:ie.document);ve&&(ve.open(),ve.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),ve.close())}});var x=Ay();x.__click=function(...ie){var ve;(ve=e.onclose)==null||ve.apply(this,ie)};var R=p(x);R.__click=ie=>ie.stopPropagation();var D=p(R),F=p(D),ae=p(F),Q=g(F,2),V=p(Q);let A;V.__click=()=>h("json");var W=g(V,2);{var re=ie=>{var ve=gy();let he;ve.__click=()=>h("markdown"),ee(()=>he=Pt(ve,1,"action-btn svelte-1b0rzpb",null,he,{active:u(s)==="markdown"})),T(ie,ve)};ne(W,ie=>{e.message.body&&ie(re)})}var G=g(W,2);G.__click=function(...ie){var ve;(ve=e.onclose)==null||ve.apply(this,ie)};var me=g(D,2);{var be=ie=>{var ve=_y(),he=Qe(ve),ce=g(p(he),2);ce.__click=y;var pe=g(he,2),xe=p(pe),oe=p(xe);ee(()=>P(oe,u(c))),T(ie,ve)},le=ie=>{var ve=wy(),he=Qe(ve),ce=p(he),pe=p(ce);let xe;pe.__click=()=>C(d,"raw");var oe=g(pe,2);let ue;oe.__click=()=>C(d,"preview");var ke=g(ce,2);ke.__click=m;var Se=g(he,2),fe=p(Se);{var j=z=>{var E=yy(),Y=p(E);ee(()=>P(Y,u(o))),T(z,E)},X=z=>{var E=by(),Y=p(E);Iv(Y,()=>k(u(o))),T(z,E)};ne(fe,z=>{u(d)==="raw"?z(j):z(X,!1)})}ee(()=>{xe=Pt(pe,1,"md-tab svelte-1b0rzpb",null,xe,{active:u(d)==="raw"}),ue=Pt(oe,1,"md-tab svelte-1b0rzpb",null,ue,{active:u(d)==="preview"})}),T(ie,ve)},de=ie=>{var ve=Ty(),he=Qe(ve),ce=p(he),pe=g(p(ce),2),xe=p(pe),oe=g(ce,2),ue=g(p(oe),2),ke=p(ue),Se=g(oe,2),fe=g(p(Se),2),j=p(fe),X=g(he,2),z=p(X);{var E=H=>{var we=ky();T(H,we)},Y=H=>{var we=xy();Hu(we,J=>C(b,J),()=>u(b)),T(H,we)},Oe=H=>{var we=Sy(),J=p(we);ee(()=>P(J,e.message.body)),T(H,we)},Ee=H=>{var we=Ey();T(H,we)};ne(z,H=>{n()?H(E):e.message.htmlBody?H(Y,1):e.message.body?H(Oe,2):H(Ee,!1)})}ee(H=>{P(xe,e.message.from),P(ke,e.message.to),P(j,H)},[()=>hl(e.message.date)]),T(ie,ve)};ne(me,ie=>{u(s)==="json"?ie(be):u(s)==="markdown"?ie(le,1):ie(de,!1)})}ee(()=>{P(ae,e.message.subject),A=Pt(V,1,"action-btn svelte-1b0rzpb",null,A,{active:u(s)==="json"})}),T(t,x),St()}qt(["click"]);var Iy=I('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),Ry=I('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),Oy=I('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),Py=I("<p> </p>"),My=I('<p>No emails in local storage. Click "Sync New" to download.</p>'),Dy=I('<div class="empty-state svelte-6ts5xm"><!></div>'),jy=I('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Ly=I('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Ny(t,e){xt(e,!0),dn(()=>qn("DashboardView"));let n=Ne(e,"error",3,null),a=Ne(e,"profile",3,null),s=Ne(e,"loadingProfile",3,!1),o=Ne(e,"emailMessages",19,()=>[]),c=Ne(e,"totalLocalMessages",3,0),d=Ne(e,"hasMoreLocal",3,!1),h=Ne(e,"loadingMessages",3,!1),m=Ne(e,"selectedMessage",3,null),y=Ne(e,"syncStatus",3,null),k=Ne(e,"syncProgress",3,null),b=Ne(e,"isSyncing",3,!1),x=Ne(e,"searchQuery",15);var R=Ly(),D=Qe(R),F=p(D);{var ae=ce=>{wd(ce,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};ne(F,ce=>{n()&&ce(ae)})}var Q=g(F,2);Lg(Q,{get profile(){return a()},get loadingProfile(){return s()},get onsignout(){return e.onsignout}});var V=g(Q,2);Qg(V,{get syncStatus(){return y()},get syncProgress(){return k()},get isSyncing(){return b()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var A=g(V,2),W=p(A);W.__keydown=ce=>ce.key==="Enter"&&e.onsearch();var re=g(W,2);re.__click=function(...ce){var pe;(pe=e.onsearch)==null||pe.apply(this,ce)};var G=p(re),me=g(A,2);{var be=ce=>{var pe=Ry(),xe=Qe(pe),oe=p(xe),ue=p(oe),ke=g(xe,2);Jg(ke,{get messages(){return o()},get onselect(){return e.onviewmessage}});var Se=g(ke,2);{var fe=j=>{var X=Iy(),z=p(X);z.__click=function(...Y){var Oe;(Oe=e.onloadmore)==null||Oe.apply(this,Y)};var E=p(z);ee(()=>{z.disabled=h(),P(E,h()?"Loading...":"Load More")}),T(j,X)};ne(Se,j=>{d()&&j(fe)})}ee(j=>P(ue,`Showing ${o().length??""} of ${j??""}
        ${x()?" matching":""} emails`),[()=>c().toLocaleString()]),T(ce,pe)},le=ce=>{var pe=Oy();T(ce,pe)},de=ce=>{var pe=Dy(),xe=p(pe);{var oe=ke=>{var Se=Py(),fe=p(Se);ee(()=>P(fe,`No emails match "${x()??""}".`)),T(ke,Se)},ue=ke=>{var Se=My();T(ke,Se)};ne(xe,ke=>{x()?ke(oe):ke(ue,!1)})}T(ce,pe)},ie=ce=>{var pe=jy();T(ce,pe)};ne(me,ce=>{var pe;o().length>0?ce(be):h()?ce(le,1):(pe=y())!=null&&pe.synced?ce(de,2):ce(ie,!1)})}var ve=g(D,2);{var he=ce=>{Cy(ce,{get message(){return m()},loading:!1,get onclose(){return e.onclosedetail}})};ne(ve,ce=>{m()&&ce(he)})}ee(()=>{re.disabled=h(),P(G,h()?"Searching...":"Search")}),Qn(W,x),T(t,R),St()}qt(["keydown","click"]);var qy=I('<div class="dashboard svelte-1q5o2lv"><!></div>');function By(t,e){xt(e,!0);function n(J){J.key==="Escape"&&u(b)&&fe()}let a=null;dn(async()=>{if(window.addEventListener("keydown",n),!u(d)){const J=await Rs("googleClientId");C(d,J||c,!0),C(h,J||c,!0)}return()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}});function s(){a&&clearTimeout(a);const J=Zh();if(J<=0)return;const Te=Math.max(0,J-120*1e3);a=setTimeout(async()=>{try{const qe=await Ac();C(y,qe.access_token,!0),s()}catch{C(y,null),C(k,null),C(A,"Session expired. Please sign in again.")}},Te)}async function o(){if(Xh())return u(y);try{const J=await Ac();return C(y,J.access_token,!0),s(),u(y)}catch{return C(y,null),C(k,null),C(A,"Session expired. Please sign in again."),null}}const c="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let d=Pe(Nt(c)),h=Pe(Nt(c)),m=Pe(!1),y=Pe(null),k=Pe(null),b=Pe(null),x=Pe(""),R=Pe(Nt([])),D=Pe(0),F=Pe(0),ae=Pe(!1),Q=Pe(!1),V=Pe(!1),A=Pe(null),W=Pe(null),re=Pe(null),G=Pe(!1);const me=50;Ea(()=>{u(y)&&(j(),oe())});let be=ct(()=>!u(d)),le=ct(()=>u(d)===c),de=ct(()=>!!u(y)),ie=ct(()=>u(R).length<u(D));Ea(()=>{u(d)&&!u(m)&&Cc(u(d)).then(async()=>{if(C(m,!0),!u(y)){const J=await Ni();J&&(C(y,J.access_token,!0),s(),xe())}}).catch(J=>{C(A,`Auth init failed: ${J.message}`)})});async function ve(){const J=u(h).trim();J&&(await Os("googleClientId",J),C(d,J,!0),C(A,null))}async function he(){await dl("googleClientId"),C(d,""),C(h,c),C(m,!1),C(y,null),C(k,null),C(R,[],!0),C(D,0)}async function ce(){C(A,null),C(Q,!0);try{u(m)||(await Cc(u(d)),C(m,!0));const J=await $h();C(y,J.access_token,!0),s(),await xe()}catch(J){C(A,J.message,!0)}finally{C(Q,!1)}}async function pe(){if(a&&clearTimeout(a),u(y))try{await em(u(y))}catch{}C(y,null),C(k,null),C(R,[],!0),C(D,0),C(b,null),C(A,null)}async function xe(){C(V,!0);try{const J=await Xu(u(y));if(!u(y))return;C(k,J,!0)}catch(J){if(!u(y))return;C(A,`Profile fetch failed: ${J.message}`)}finally{C(V,!1)}}async function oe(J=!1){C(ae,!0);try{const Te=J?u(F):0,qe=await gp({query:u(x)||void 0,limit:me,offset:Te});J?C(R,[...u(R),...qe.items],!0):C(R,qe.items,!0),C(D,qe.total,!0),C(F,u(R).length,!0)}catch(Te){C(A,`Failed to load messages: ${Te.message}`)}finally{C(ae,!1)}}function ue(){C(F,0),oe(!1)}function ke(){oe(!0)}function Se(J){C(b,J,!0)}function fe(){C(b,null)}async function j(){try{C(W,await dg(),!0)}catch{}}async function X(J){if(u(G)||!u(y))return;const Te=await o();if(!Te)return;C(A,null),C(G,!0),C(re,null);const qe=new AbortController;try{await cg(Te,{limit:J,onProgress:Ke=>{C(re,{...Ke},!0)},signal:qe.signal}),await j(),await oe(!1)}catch(Ke){if(Ke.name!=="AbortError"){if(!u(y))return;C(A,`Sync failed: ${Ke.message}`)}}finally{C(G,!1)}}async function z(J){if(u(G)||!u(y))return;const Te=await o();if(!Te)return;C(A,null),C(G,!0),C(re,null);const qe=new AbortController;try{await ug(Te,{limit:J,onProgress:Ke=>{C(re,{...Ke},!0)},signal:qe.signal}),await j(),await oe(!1)}catch(Ke){if(Ke.name!=="AbortError"){if(!u(y))return;C(A,`Sync more failed: ${Ke.message}`)}}finally{C(G,!1)}}async function E(){try{await gd(),await j(),C(R,[],!0),C(D,0),C(F,0)}catch(J){C(A,`Failed to clear data: ${J.message}`)}}var Y=qy(),Oe=p(Y);{var Ee=J=>{yg(J,{onsave:ve,defaultClientId:c,get clientIdInput(){return u(h)},set clientIdInput(Te){C(h,Te,!0)}})},H=J=>{Pg(J,{get clientId(){return u(d)},get isDefaultClientId(){return u(le)},get error(){return u(A)},get loadingAuth(){return u(Q)},onsignin:ce,onclear:he,onsignout:pe})},we=J=>{Ny(J,{get error(){return u(A)},get profile(){return u(k)},get loadingProfile(){return u(V)},get emailMessages(){return u(R)},get totalLocalMessages(){return u(D)},get hasMoreLocal(){return u(ie)},get loadingMessages(){return u(ae)},get selectedMessage(){return u(b)},get syncStatus(){return u(W)},get syncProgress(){return u(re)},get isSyncing(){return u(G)},onsignout:pe,onsearch:ue,onloadmore:ke,onviewmessage:Se,onclosedetail:fe,ondismisserror:()=>C(A,null),onsync:X,onsyncmore:z,oncleardata:E,get searchQuery(){return u(x)},set searchQuery(Te){C(x,Te,!0)}})};ne(Oe,J=>{u(be)?J(Ee):u(de)?J(we,!1):J(H,1)})}T(t,Y),St()}var Fy=I('<span class="err svelte-t1ig66"> </span>'),zy=I('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Uy=I('<span class="stream-stats svelte-t1ig66"> </span>'),Ky=I('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),Gy=I('<span class="ei-action svelte-t1ig66"> </span>'),Wy=I('<span class="ei-action err svelte-t1ig66">ERROR</span>'),Hy=I('<span class="sep svelte-t1ig66">Â·</span> ',1),Vy=I('<div class="ei-summary svelte-t1ig66"> </div>'),Yy=I('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Qy=I('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Xy=I("<!> <!> <!>",1),Zy=I('<div class="ei-error svelte-t1ig66"> </div>'),Jy=I('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),$y=I('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),eb=I('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),tb=I('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),nb=I(' <span class="sep svelte-t1ig66">Â·</span>',1),rb=I('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),ab=I('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),sb=I('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),ib=I('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function ob(t,e){xt(e,!0);let n=Ne(e,"progress",3,null);function a(b){return!b||b<0?"â":b<1e3?`${Math.round(b)}ms`:`${(b/1e3).toFixed(1)}s`}function s(b){return b?b>=1e3?`${(b/1e3).toFixed(1)}k`:String(b):"0"}function o(b){if(!b)return"â";const x=b.replace(/<.*>/,"").trim();return x.length>30?x.slice(0,28)+"â¦":x}function c(b){if(!b)return"";try{return new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let d=ct(()=>{var b;return(b=n())!=null&&b.total?Math.round(n().current/n().total*100):0}),h=ct(()=>{var b;return((b=n())==null?void 0:b.phase)==="done"});var m=$n(),y=Qe(m);{var k=b=>{var x=ib(),R=p(x),D=p(R),F=p(D);{var ae=fe=>{var j=_n();ee(()=>P(j,`Scan complete â ${(n().classified||0)??""} classified`)),T(fe,j)},Q=fe=>{var j=_n("Loading emailsâ¦");T(fe,j)},V=fe=>{var j=_n();ee(()=>P(j,`Processing ${n().current??0??""} / ${n().total??0??""}`)),T(fe,j)};ne(F,fe=>{u(h)?fe(ae):n().phase==="loading"?fe(Q,1):fe(V,!1)})}var A=g(D,2),W=p(A),re=g(R,2),G=p(re);let me,be;var le=g(re,2);{var de=fe=>{var j=zy(),X=p(j),z=g(X);{var E=Ee=>{var H=Fy(),we=p(H);ee(()=>P(we,`Â· ${n().errors??""} errors`)),T(Ee,H)};ne(z,Ee=>{n().errors&&Ee(E)})}var Y=g(z,3),Oe=g(Y,2);ee((Ee,H,we)=>{P(X,`${(n().classified||0)??""} classified `),P(Y,` ${Ee??""} in + ${H??""} out `),P(Oe,` ${we??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),T(fe,j)};ne(le,fe=>{n().totals&&!u(h)&&fe(de)})}var ie=g(le,2);{var ve=fe=>{var j=Ky(),X=p(j),z=p(X),E=p(z),Y=g(z,2);{var Oe=we=>{var J=Uy(),Te=p(J);ee(qe=>P(Te,`${qe??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),T(we,J)};ne(Y,we=>{var J;(J=n().live)!=null&&J.tps&&we(Oe)})}var Ee=g(X,2),H=p(Ee);ee(()=>{P(E,n().email.subject||"(no subject)"),P(H,n().streamingText||"Waiting for modelâ¦")}),T(fe,j)};ne(ie,fe=>{!u(h)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&fe(ve)})}var he=g(ie,2);{var ce=fe=>{var j=$y(),X=p(j),z=g(p(X),2),E=p(z),Y=g(X,2);Ct(Y,17,()=>n().results,Kt,(Oe,Ee,H)=>{var we=Jy();let J;var Te=p(we),qe=p(Te);qe.textContent=`${H+1}.`;var Ke=g(qe,2),yt=p(Ke),Et=g(Ke,2);{var bt=He=>{var wt=Gy(),Bt=p(wt);ee(()=>P(Bt,u(Ee).classification.action)),T(He,wt)},et=He=>{var wt=Wy();T(He,wt)};ne(Et,He=>{u(Ee).success?He(bt):He(et,!1)})}var Ve=g(Te,2),Je=p(Ve),ht=g(Je);{var Rt=He=>{var wt=Hy(),Bt=g(Qe(wt),1,!0);ee(Jt=>P(Bt,Jt),[()=>c(u(Ee).email.date)]),T(He,wt)};ne(ht,He=>{u(Ee).email.date&&He(Rt)})}var $e=g(Ve,2);{var We=He=>{var wt=Xy(),Bt=Qe(wt);{var Jt=it=>{var De=Vy(),Lt=p(De);ee(()=>P(Lt,u(Ee).classification.summary)),T(it,De)};ne(Bt,it=>{u(Ee).classification.summary&&it(Jt)})}var Xt=g(Bt,2);{var Ft=it=>{var De=Yy(),Lt=p(De),Gt=g(Lt,2),Ze=g(Gt,2);ee((_e,ft)=>{P(Lt,`${_e??""} `),P(Gt,` ${(u(Ee).stats.inputTokens||0)??""} in + ${(u(Ee).stats.numTokens||0)??""} out `),P(Ze,` ${ft??""}`)},[()=>u(Ee).stats.tps?`${u(Ee).stats.tps.toFixed(0)} tok/s`:"â",()=>a(u(Ee).stats.elapsed)]),T(it,De)};ne(Xt,it=>{u(Ee).stats&&it(Ft)})}var It=g(Xt,2);{var $t=it=>{var De=Qy(),Lt=g(p(De),2),Gt=p(Lt);ee(()=>P(Gt,u(Ee).rawResponse)),T(it,De)};ne(It,it=>{u(Ee).rawResponse&&it($t)})}T(He,wt)},Xe=He=>{var wt=Zy(),Bt=p(wt);ee(()=>P(Bt,u(Ee).error)),T(He,wt)};ne($e,He=>{u(Ee).success?He(We):He(Xe,!1)})}ee(He=>{J=Pt(we,1,"email-item svelte-t1ig66",null,J,{failed:!u(Ee).success}),P(yt,u(Ee).email.subject||"(no subject)"),P(Je,He)},[()=>o(u(Ee).email.from)]),T(Oe,we)}),ee(()=>P(E,n().results.length)),T(fe,j)};ne(he,fe=>{var j;((j=n().results)==null?void 0:j.length)>0&&fe(ce)})}var pe=g(he,2);{var xe=fe=>{var j=rb(),X=p(j),z=p(X),E=p(z),Y=g(z,4),Oe=p(Y),Ee=g(Y,2);{var H=et=>{var Ve=eb(),Je=g(Qe(Ve)),ht=p(Je);ee(()=>P(ht,`${n().errors??""} errors`)),T(et,Ve)};ne(Ee,et=>{n().errors>0&&et(H)})}var we=g(Ee,2);{var J=et=>{var Ve=tb(),Je=g(Qe(Ve)),ht=p(Je);ee(()=>P(ht,`${n().summary.skipped??""} skipped`)),T(et,Ve)};ne(we,et=>{var Ve;(Ve=n().summary)!=null&&Ve.skipped&&et(J)})}var Te=g(X,2),qe=p(Te);{var Ke=et=>{var Ve=nb(),Je=Qe(Ve);ee(()=>P(Je,`Avg ${n().summary.avgTps??""} tok/s`)),T(et,Ve)};ne(qe,et=>{var Ve;(Ve=n().summary)!=null&&Ve.avgTps&&et(Ke)})}var yt=g(qe),Et=g(yt,2),bt=g(Et,2);ee((et,Ve,Je)=>{var ht,Rt;P(E,`${(((ht=n().summary)==null?void 0:ht.processed)||n().total||0)??""} processed`),P(Oe,`${(n().classified||0)??""} classified`),P(yt,` ${et??""} in + ${Ve??""} out `),P(Et,` ${Je??""} `),P(bt,` Model: ${(((Rt=n().summary)==null?void 0:Rt.modelName)||"Unknown")??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),T(fe,j)};ne(pe,fe=>{u(h)&&n().totals&&fe(xe)})}var oe=g(pe,2),ue=p(oe);{var ke=fe=>{var j=ab(),X=Qe(j);X.__click=function(...E){var Y;(Y=e.oninspect)==null||Y.apply(this,E)};var z=g(X,2);z.__click=function(...E){var Y;(Y=e.onclose)==null||Y.apply(this,E)},T(fe,j)},Se=fe=>{var j=sb(),X=Qe(j);X.__click=function(...E){var Y;(Y=e.oninspect)==null||Y.apply(this,E)};var z=g(X,2);z.__click=function(...E){var Y;(Y=e.onstop)==null||Y.apply(this,E)},T(fe,j)};ne(ue,fe=>{u(h)?fe(ke):fe(Se,!1)})}ee(()=>{P(W,`${u(d)??""}%`),me=Pt(G,1,"bar-fill svelte-t1ig66",null,me,{done:u(h)}),be=on(G,"",be,{width:`${u(d)??""}%`})}),T(b,x)};ne(y,b=>{n()&&b(k)})}T(t,m),St()}qt(["click"]);var lb=I('<span class="spinner svelte-ois7em"></span>'),cb=ll('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),ub=I('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),db=I("<option> </option>"),fb=I('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),vb=I('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function pb(t,e){xt(e,!0);let n=Ne(e,"engineStatus",3,"idle"),a=Ne(e,"modelName",3,""),s=Ne(e,"isScanning",3,!1),o=Ne(e,"scanProgress",3,null),c=Ne(e,"scanCount",15,20),d=Ne(e,"stats",3,null);const h=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function m(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function y(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function k(){return n()==="ready"&&!s()}let b=ct(()=>{var j;return s()&&((j=o())==null?void 0:j.phase)!=="done"});var x=vb(),R=p(x),D=p(R),F=p(D);{var ae=j=>{var X=lb();T(j,X)},Q=j=>{var X=cb();T(j,X)};ne(F,j=>{u(b)?j(ae):j(Q,!1)})}var V=g(D,2),A=p(V),W=g(p(A),2);W.__click=function(...j){var X;(X=e.oninspect)==null||X.apply(this,j)};var re=g(A,2),G=p(re);let me;var be=g(G),le=g(R,2);{var de=j=>{var X=ub(),z=p(X),E=p(z),Y=g(z,4),Oe=p(Y),Ee=g(Y,4),H=p(Ee);ee(()=>{P(E,`${d().totalEmails??""} emails in storage`),P(Oe,`${d().classified??""} classified`),P(H,`${d().unclassified??""} new`)}),T(j,X)};ne(le,j=>{d()&&j(de)})}var ie=g(le,2),ve=p(ie),he=g(p(ve),2);Ct(he,21,()=>h,Kt,(j,X)=>{var z=db(),E=p(z),Y={};ee(()=>{P(E,u(X).label),Y!==(Y=u(X).value)&&(z.value=(z.__value=u(X).value)??"")}),T(j,z)});var ce=g(ve,2),pe=p(ce);pe.__click=function(...j){var X;(X=e.onscan)==null||X.apply(this,j)};var xe=p(pe),oe=g(pe,2);oe.__click=function(...j){var X;(X=e.onrescan)==null||X.apply(this,j)};var ue=g(ie,2);{var ke=j=>{var X=fb();T(j,X)};ne(ue,j=>{n()!=="ready"&&n()!=="loading"&&j(ke)})}var Se=g(ue,2);{var fe=j=>{ob(j,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};ne(Se,j=>{var X;(s()||((X=o())==null?void 0:X.phase)==="done")&&j(fe)})}ee((j,X,z,E)=>{me=on(G,"",me,j),P(be,` ${X??""}`),he.disabled=s(),pe.disabled=z,P(xe,u(b)?"Scanning...":s()?"Finalizing...":"Scan New"),oe.disabled=E},[()=>({background:y()}),m,()=>!k(),()=>!k()]),Di(he,c),T(t,x),St()}qt(["click"]);var hb=I('<span class="row-date svelte-1czytqk"> </span>'),mb=I('<span class="tag svelte-1czytqk"> </span>'),gb=I('<span class="row-tags svelte-1czytqk"></span>'),_b=I('<span class="row-reason svelte-1czytqk"> </span>'),yb=I('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),bb=I('<span class="status-label svelte-1czytqk"> </span>'),wb=I('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),kb=I('<p class="summary-reason svelte-1czytqk"> </p>'),xb=I('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),Sb=I('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function Vc(t,e){xt(e,!0);let n=Ne(e,"actionColor",3,"#666"),a=Ne(e,"dimmed",3,!1);function s(ce){if(!ce)return"";try{return new Date(ce).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=ct(()=>e.item.status==="pending"),c=Pe(!1);var d=Sb(),h=Qe(d);let m;var y=p(h);y.__click=()=>C(c,!u(c));let k;var b=p(y),x=p(b),R=g(b,2),D=p(R),F=p(D),ae=g(D,2);{var Q=ce=>{var pe=hb(),xe=p(pe);ee(oe=>P(xe,oe),[()=>s(e.item.date)]),T(ce,pe)};ne(ae,ce=>{e.item.date&&ce(Q)})}var V=g(R,2);{var A=ce=>{var pe=gb();Ct(pe,21,()=>e.item.tags,Kt,(xe,oe)=>{var ue=mb();let ke;var Se=p(ue);ee(fe=>{ke=on(ue,"",ke,fe),P(Se,u(oe))},[()=>({background:Up(u(oe))})]),T(xe,ue)}),T(ce,pe)};ne(V,ce=>{e.item.tags&&e.item.tags.length>0&&ce(A)})}var W=g(V,2);{var re=ce=>{var pe=_b(),xe=p(pe);ee(()=>P(xe,e.item.reason)),T(ce,pe)};ne(W,ce=>{e.item.reason&&!u(c)&&ce(re)})}var G=g(y,2),me=p(G);{var be=ce=>{var pe=yb(),xe=Qe(pe);xe.__click=()=>e.onmarkacted(e.item.emailId);var oe=g(xe,2);oe.__click=()=>e.ondismiss(e.item.emailId),T(ce,pe)},le=ce=>{var pe=bb(),xe=p(pe);ee(()=>P(xe,e.item.status)),T(ce,pe)};ne(me,ce=>{u(o)?ce(be):ce(le,!1)})}var de=g(me,2);{var ie=ce=>{var pe=wb();pe.__click=()=>e.onremove(e.item.emailId),T(ce,pe)};ne(de,ce=>{e.onremove&&ce(ie)})}var ve=g(h,2);{var he=ce=>{var pe=xb();let xe;var oe=p(pe),ue=p(oe),ke=g(oe,2);{var Se=fe=>{var j=kb(),X=p(j);ee(()=>P(X,e.item.reason)),T(fe,j)};ne(ke,fe=>{e.item.reason&&fe(Se)})}ee(()=>{xe=on(pe,"",xe,{"border-left-color":n()}),P(ue,e.item.summary)}),T(ce,pe)};ne(ve,ce=>{u(c)&&e.item.summary&&ce(he)})}ee(()=>{m=Pt(h,1,"email-row svelte-1czytqk",null,m,{dimmed:a()}),k=on(y,"",k,{"border-left-color":n()}),P(x,e.item.subject),P(F,e.item.from)}),T(t,d),St()}qt(["click"]);var Eb=I('<span class="group-acted svelte-tl1unp"> </span>'),Tb=I('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),Ab=I('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),Cb=I('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),Ib=I('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),Rb=I('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),Ob=I('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Pb(t,e){xt(e,!0);let n=Ne(e,"color",3,"#888");Ne(e,"count",3,0);let a=Ne(e,"items",19,()=>[]),s=Ne(e,"expanded",3,!1),o=ct(()=>a().filter(re=>re.status==="pending")),c=ct(()=>a().filter(re=>re.status!=="pending")),d=Pe(!1);function h(re){return re.split("_").map(G=>G.charAt(0)+G.slice(1).toLowerCase()).join(" ")}var m=Ob(),y=p(m);y.__click=function(...re){var G;(G=e.ontoggle)==null||G.apply(this,re)};var k=p(y);let b;var x=p(k),R=g(k,2),D=p(R),F=g(R,2);{var ae=re=>{var G=Eb(),me=p(G);ee(()=>P(me,`${u(c).length??""} handled`)),T(re,G)};ne(F,re=>{u(c).length>0&&re(ae)})}var Q=g(F,4);let V;var A=g(y,2);{var W=re=>{var G=Rb(),me=p(G);{var be=xe=>{var oe=Tb();T(xe,oe)};ne(me,xe=>{u(o).length===0&&u(c).length===0&&xe(be)})}var le=g(me,2);Ct(le,17,()=>u(o),xe=>xe.emailId,(xe,oe)=>{Vc(xe,{get item(){return u(oe)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var de=g(le,2);{var ie=xe=>{var oe=Ab(),ue=p(oe),ke=p(ue),Se=g(ue,2);Ct(Se,17,()=>u(c),fe=>fe.emailId,(fe,j)=>{Vc(fe,{get item(){return u(j)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),ee(()=>P(ke,`${u(c).length??""} handled`)),T(xe,oe)};ne(de,xe=>{u(c).length>0&&xe(ie)})}var ve=g(de,2),he=p(ve);{var ce=xe=>{var oe=Cb();oe.__click=()=>C(d,!0),T(xe,oe)},pe=xe=>{var oe=Ib(),ue=p(oe),ke=g(ue);ke.__click=()=>C(d,!1);var Se=g(ke,2);Se.__click=()=>{e.oncleargroup(),C(d,!1)},ee(()=>P(ue,`Clear ${a().length??""} items? `)),T(xe,oe)};ne(he,xe=>{u(d)?xe(pe,!1):xe(ce)})}T(re,G)};ne(A,re=>{s()&&re(W)})}ee(re=>{b=on(k,"",b,{background:n()}),P(x,re),P(D,u(o).length),V=Pt(Q,0,"chevron svelte-tl1unp",null,V,{open:s()})},[()=>h(e.action)]),T(t,m),St()}qt(["click"]);var Mb=I(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),Db=I(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),jb=I(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),Lb=I('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function Nb(t,e){xt(e,!0);let n=Ne(e,"open",15,!1),a=Ne(e,"sampleEmail",3,null),s=Pe("system");function o(){return a()?fd(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function c(){n(!1)}function d(k){k.target===k.currentTarget&&c()}var h=$n(),m=Qe(h);{var y=k=>{var b=Lb();b.__click=d,b.__keydown=ie=>ie.key==="Escape"&&c();var x=p(b),R=p(x),D=g(p(R),2);D.__click=c;var F=g(R,2),ae=p(F);let Q;ae.__click=()=>C(s,"system");var V=g(ae,2);let A;V.__click=()=>C(s,"email");var W=g(V,2);let re;W.__click=()=>C(s,"config");var G=g(F,2),me=p(G);{var be=ie=>{var ve=Mb(),he=g(Qe(ve),2),ce=p(he);ee(()=>P(ce,ws)),T(ie,ve)},le=ie=>{var ve=Db(),he=g(Qe(ve),2),ce=g(p(he),2);ce.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var pe=g(he,2),xe=g(p(pe),2),oe=p(xe);ee(ue=>P(oe,ue),[o]),T(ie,ve)},de=ie=>{var ve=jb(),he=g(Qe(ve),2),ce=p(he),pe=g(p(ce),2),xe=p(pe),oe=g(ce,2),ue=g(p(oe),2),ke=p(ue),Se=g(oe,2),fe=g(p(Se),2),j=p(fe),X=g(he,4);X.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,ee(()=>{P(xe,qp.maxTokens),P(ke,"false"),P(j,"false")}),T(ie,ve)};ne(me,ie=>{u(s)==="system"?ie(be):u(s)==="email"?ie(le,1):u(s)==="config"&&ie(de,2)})}ee(()=>{Q=Pt(ae,1,"tab svelte-10pcy9j",null,Q,{active:u(s)==="system"}),A=Pt(V,1,"tab svelte-10pcy9j",null,A,{active:u(s)==="email"}),re=Pt(W,1,"tab svelte-10pcy9j",null,re,{active:u(s)==="config"})}),T(k,b)};ne(m,k=>{n()&&k(y)})}T(t,h),St()}qt(["click","keydown"]);var qb=I('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),Bb=I('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="type-count svelte-d25j4l"> </span></button>'),Fb=I('<button class="text-btn svelte-d25j4l">Reset to defaults</button>'),zb=I('<div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" placeholder="Icon (emoji)" class="icon-input svelte-d25j4l"/> <input type="text" placeholder="Action name" class="name-input svelte-d25j4l"/></div> <input type="text" placeholder="Description" class="desc-input svelte-d25j4l"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Add Action</button></div></div>'),Ub=I('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),Kb=I('<span class="cmd-icon svelte-d25j4l"> </span>'),Gb=I('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),Wb=I('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),Hb=I('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <!> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),Vb=I('<div class="no-selection svelte-d25j4l"><p class="svelte-d25j4l">Select an event type on the left to view and edit its commands.</p></div>'),Yb=I('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function Qb(t,e){xt(e,!0);let n=Ne(e,"open",15,!1),a=Pe(Nt([])),s=Pe(null),o=Pe(Nt([])),c=Pe(null),d=Pe(!1),h=Pe(""),m=Pe(!1),y=Pe(Nt({name:"",description:"",icon:""}));async function k(){C(a,await kp(),!0),u(s)&&C(o,(await qa(u(s))).map(le=>({...le})),!0)}Ea(()=>{n()&&k()});async function b(le){C(s,le,!0),C(o,(await qa(le)).map(de=>({...de})),!0),C(c,null),C(m,!1)}function x(le){return le.split("_").map(de=>de.charAt(0)+de.slice(1).toLowerCase()).join(" ")}function R(le){return`hsl(${ji(le)}, 55%, 55%)`}async function D(){const le=u(h).trim();if(!le)return;await Rp(le),C(h,""),C(d,!1),await k();const de=le.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await b(de)}async function F(){u(s)&&(await Mp(u(s)),await k(),C(o,(await qa(u(s))).map(le=>({...le})),!0))}async function ae(){if(!u(y).name.trim())return;const le=u(y).name.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");await Ep(u(s),{id:le,name:u(y).name.trim(),description:u(y).description.trim(),icon:u(y).icon.trim()||void 0}),C(y,{name:"",description:"",icon:""},!0),C(m,!1),await k()}async function Q(le){await Ap(u(s),le),await k()}function V(le){C(c,{...le},!0)}async function A(){u(c)&&(await Ip(u(s),u(c).id,{name:u(c).name,description:u(c).description,icon:u(c).icon}),C(c,null),await k())}function W(){C(c,null)}async function re(le,de){const ie=[...u(o)],ve=le+de;ve<0||ve>=ie.length||([ie[le],ie[ve]]=[ie[ve],ie[le]],await xp(u(s),ie),await k())}var G=$n(),me=Qe(G);{var be=le=>{var de=Yb(),ie=p(de),ve=p(ie),he=g(p(ve),4);he.__click=()=>n(!1);var ce=g(ve,2),pe=p(ce),xe=p(pe),oe=g(p(xe),2);oe.__click=()=>C(d,!u(d));var ue=g(xe,2);{var ke=E=>{var Y=qb(),Oe=p(Y);Oe.__keydown=H=>H.key==="Enter"&&D();var Ee=g(Oe,2);Ee.__click=D,Qn(Oe,()=>u(h),H=>C(h,H)),T(E,Y)};ne(ue,E=>{u(d)&&E(ke)})}var Se=g(ue,2);Ct(Se,21,()=>u(a),Kt,(E,Y)=>{var Oe=Bb();let Ee;Oe.__click=()=>b(u(Y));var H=p(Oe);let we;var J=g(H,2),Te=p(J),qe=g(J,2),Ke=p(qe);ee((yt,Et,bt)=>{Ee=Pt(Oe,1,"type-item svelte-d25j4l",null,Ee,{selected:u(s)===u(Y)}),we=on(H,"",we,yt),P(Te,Et),P(Ke,bt)},[()=>({background:R(u(Y))}),()=>x(u(Y)),()=>qa(u(Y)).length]),T(E,Oe)});var fe=g(pe,2),j=p(fe);{var X=E=>{var Y=Hb(),Oe=Qe(Y),Ee=p(Oe);let H;var we=p(Ee),J=g(Ee,2),Te=p(J),qe=g(J,6);{var Ke=We=>{var Xe=Fb();Xe.__click=F,T(We,Xe)},yt=ct(()=>Pp(u(s)));ne(qe,We=>{u(yt)&&We(Ke)})}var Et=g(qe,2);Et.__click=()=>{C(m,!u(m)),C(c,null)};var bt=p(Et),et=g(Oe,2);{var Ve=We=>{var Xe=zb(),He=p(Xe),wt=p(He),Bt=g(wt,2),Jt=g(He,2),Xt=g(Jt,2),Ft=p(Xt);Ft.__click=ae,Qn(wt,()=>u(y).icon,It=>u(y).icon=It),Qn(Bt,()=>u(y).name,It=>u(y).name=It),Qn(Jt,()=>u(y).description,It=>u(y).description=It),T(We,Xe)};ne(et,We=>{u(m)&&We(Ve)})}var Je=g(et,2),ht=p(Je);Ct(ht,19,()=>u(o),We=>We.id,(We,Xe,He)=>{var wt=$n(),Bt=Qe(wt);{var Jt=Ft=>{var It=Ub(),$t=p(It),it=p($t),De=g(it,2),Lt=g($t,2),Gt=g(Lt,2),Ze=p(Gt);Ze.__click=A;var _e=g(Ze,2);_e.__click=W,Qn(it,()=>u(c).icon,ft=>u(c).icon=ft),Qn(De,()=>u(c).name,ft=>u(c).name=ft),Qn(Lt,()=>u(c).description,ft=>u(c).description=ft),T(Ft,It)},Xt=Ft=>{var It=Gb(),$t=p(It),it=p($t),De=g($t,2),Lt=p(De);{var Gt=mn=>{var zn=Kb(),Rn=p(zn);ee(()=>P(Rn,u(Xe).icon)),T(mn,zn)};ne(Lt,mn=>{u(Xe).icon&&mn(Gt)})}var Ze=g(Lt,2),_e=p(Ze),ft=p(_e),rn=g(_e,2),Zt=p(rn),pr=g(De,2),Bn=p(pr);Bn.__click=()=>re(u(He),-1);var Ot=g(Bn,2);Ot.__click=()=>re(u(He),1);var kn=g(Ot,2);kn.__click=()=>V(u(Xe));var Fn=g(kn,2);Fn.__click=()=>Q(u(Xe).id),ee(()=>{P(it,u(He)+1),P(ft,u(Xe).name),P(Zt,u(Xe).description),Bn.disabled=u(He)===0,Ot.disabled=u(He)===u(o).length-1}),T(Ft,It)};ne(Bt,Ft=>{var It;((It=u(c))==null?void 0:It.id)===u(Xe).id?Ft(Jt):Ft(Xt,!1)})}T(We,wt)});var Rt=g(ht,2);{var $e=We=>{var Xe=Wb();T(We,Xe)};ne(Rt,We=>{u(o).length===0&&We($e)})}ee((We,Xe)=>{H=on(Ee,"",H,We),P(we,Xe),P(Te,`${u(o).length??""} action${u(o).length===1?"":"s"}`),P(bt,u(m)?"Cancel":"+ Add Action")},[()=>({background:R(u(s))}),()=>x(u(s))]),T(E,Y)},z=E=>{var Y=Vb();T(E,Y)};ne(j,E=>{u(s)?E(X):E(z,!1)})}T(le,de)};ne(me,le=>{n()&&le(be)})}T(t,G),St()}qt(["click","keydown"]);var Xb=I('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Zb=I('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),Jb=I('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),$b=I('<button class="chip svelte-s2dwjj"> </button>'),e1=I('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),t1=I('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),n1=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),r1=I('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),a1=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),s1=I('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),i1=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),o1=I('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),l1=I('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),c1=I('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),u1=I('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),d1=I('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function f1(t,e){xt(e,!0);let n=Ne(e,"groupOrder",19,()=>[]),a=Pe(!1),s=Pe(null),o=Pe(!1),c=Pe(null);async function d(){var de;const[G,me,be]=await Promise.all([Ge.items.where("sourceType").equals("gmail").count(),Ge.emailClassifications.count(),Ge.contacts.count()]);let le=0;try{const ie=await((de=navigator.storage)==null?void 0:de.estimate());le=(ie==null?void 0:ie.usage)??0}catch{}C(c,{emailCount:G,classCount:me,contactCount:be,totalBytes:le},!0)}function h(G){return G?G<1024?`${G} B`:G<1024*1024?`${(G/1024).toFixed(1)} KB`:`${(G/(1024*1024)).toFixed(1)} MB`:"â"}function m(){C(a,!u(a)),u(a)&&d()}async function y(G){var me;C(o,!0),C(s,null);try{await G(),await d(),(me=e.onrefresh)==null||me.call(e)}finally{C(o,!1)}}async function k(){await y(()=>xc())}async function b(G){await y(()=>ml(G))}async function x(){await y(async()=>{await gd(),await xc()})}async function R(){await y(()=>Ge.contacts.clear())}async function D(){await y(async()=>{await Ge.delete(),window.location.reload()})}function F(G){return G.split("_").map(me=>me.charAt(0)+me.slice(1).toLowerCase()).join(" ")}var ae=d1(),Q=p(ae);Q.__click=m;var V=g(p(Q),2);let A;var W=g(Q,2);{var re=G=>{var me=u1(),be=p(me);{var le=H=>{var we=Zb(),J=p(we),Te=p(J),qe=g(J,4),Ke=p(qe),yt=g(qe,4),Et=p(yt),bt=g(yt,2);{var et=Ve=>{var Je=Xb(),ht=g(Qe(Je),2),Rt=p(ht);ee($e=>P(Rt,`${$e??""} used`),[()=>h(u(c).totalBytes)]),T(Ve,Je)};ne(bt,Ve=>{u(c).totalBytes&&Ve(et)})}ee(()=>{P(Te,`${u(c).emailCount??""} emails`),P(Ke,`${u(c).classCount??""} classifications`),P(Et,`${u(c).contactCount??""} contacts`)}),T(H,we)};ne(be,H=>{u(c)&&H(le)})}var de=g(be,2);{var ie=H=>{var we=e1(),J=g(p(we),2);Ct(J,21,n,Kt,(Te,qe)=>{var Ke=$n(),yt=Qe(Ke);{var Et=et=>{var Ve=Jb(),Je=p(Ve),ht=g(Je);ht.__click=()=>C(s,null);var Rt=g(ht,2);Rt.__click=()=>b(u(qe)),ee($e=>{P(Je,`Delete ${$e??""}? `),Rt.disabled=u(o)},[()=>F(u(qe))]),T(et,Ve)},bt=et=>{var Ve=$b();Ve.__click=()=>C(s,`group:${u(qe)}`);var Je=p(Ve);ee(ht=>{Ve.disabled=u(o),P(Je,`${ht??""} â`)},[()=>F(u(qe))]),T(et,Ve)};ne(yt,et=>{u(s)===`group:${u(qe)}`?et(Et):et(bt,!1)})}T(Te,Ke)}),T(H,we)};ne(de,H=>{n().length>0&&H(ie)})}var ve=g(de,2),he=g(p(ve),2),ce=p(he);{var pe=H=>{var we=t1(),J=g(p(we),2);J.__click=()=>C(s,null);var Te=g(J,2);Te.__click=k,ee(()=>Te.disabled=u(o)),T(H,we)},xe=H=>{var we=n1();we.__click=()=>C(s,"classifications"),ee(()=>we.disabled=u(o)),T(H,we)};ne(ce,H=>{u(s)==="classifications"?H(pe):H(xe,!1)})}var oe=g(ce,2);{var ue=H=>{var we=r1(),J=g(p(we),2);J.__click=()=>C(s,null);var Te=g(J,2);Te.__click=x,ee(()=>Te.disabled=u(o)),T(H,we)},ke=H=>{var we=a1();we.__click=()=>C(s,"emails"),ee(()=>we.disabled=u(o)),T(H,we)};ne(oe,H=>{u(s)==="emails"?H(ue):H(ke,!1)})}var Se=g(oe,2);{var fe=H=>{var we=s1(),J=g(p(we),2);J.__click=()=>C(s,null);var Te=g(J,2);Te.__click=R,ee(()=>Te.disabled=u(o)),T(H,we)},j=H=>{var we=i1();we.__click=()=>C(s,"contacts"),ee(()=>we.disabled=u(o)),T(H,we)};ne(Se,H=>{u(s)==="contacts"?H(fe):H(j,!1)})}var X=g(ve,2),z=p(X);{var E=H=>{var we=o1(),J=g(p(we),2);J.__click=()=>C(s,null);var Te=g(J,2);Te.__click=D,ee(()=>Te.disabled=u(o)),T(H,we)},Y=H=>{var we=l1();we.__click=()=>C(s,"nuke"),ee(()=>we.disabled=u(o)),T(H,we)};ne(z,H=>{u(s)==="nuke"?H(E):H(Y,!1)})}var Oe=g(X,2);{var Ee=H=>{var we=c1();T(H,we)};ne(Oe,H=>{u(o)&&H(Ee)})}T(G,me)};ne(W,G=>{u(a)&&G(re)})}ee(()=>A=Pt(V,0,"chev svelte-s2dwjj",null,A,{open:u(a)})),T(t,ae),St()}qt(["click"]);var v1=I('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),p1=I('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),h1=I('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),m1=I('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <div class="toolbar svelte-12gkq0i"><button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!></div>');function g1(t,e){xt(e,!0);let n=Ne(e,"groups",19,()=>({})),a=Ne(e,"groupOrder",19,()=>[]),s=Ne(e,"counts",19,()=>({})),o=Ne(e,"stats",3,null),c=Ne(e,"expandedGroup",3,null),d=Ne(e,"isScanning",3,!1),h=Ne(e,"scanProgress",3,null),m=Ne(e,"scanCount",15,20),y=Ne(e,"error",3,null),k=Pe(!1),b=Pe(!1),x=ct(()=>{for(const le of a()){const de=n()[le];if((de==null?void 0:de.length)>0)return de[0]}return null});var R=m1(),D=p(R);pb(D,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return d()},get scanProgress(){return h()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>C(k,!0),get scanCount(){return m()},set scanCount(le){m(le)}});var F=g(D,2);Nb(F,{get sampleEmail(){return u(x)},get open(){return u(k)},set open(le){C(k,le,!0)}});var ae=g(F,2);Qb(ae,{get open(){return u(b)},set open(le){C(b,le,!0)}});var Q=g(ae,2),V=p(Q);V.__click=()=>C(b,!0);var A=g(Q,2);{var W=le=>{var de=v1(),ie=p(de),ve=p(ie),he=g(ie,2);he.__click=function(...ce){var pe;(pe=e.ondismisserror)==null||pe.apply(this,ce)},ee(()=>P(ve,y())),T(le,de)};ne(A,le=>{y()&&le(W)})}var re=g(A,2);{var G=le=>{var de=p1(),ie=Qe(de);Ct(ie,20,a,pe=>pe,(pe,xe)=>{{let oe=ct(()=>zo(xe)),ue=ct(()=>{var fe;return((fe=n()[xe])==null?void 0:fe.length)||0}),ke=ct(()=>n()[xe]||[]),Se=ct(()=>c()===xe);Pb(pe,{get action(){return xe},get color(){return u(oe)},get count(){return u(ue)},get items(){return u(ke)},get expanded(){return u(Se)},ontoggle:()=>e.ontogglegroup(xe),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(xe)})}});var ve=g(ie,2),he=p(ve),ce=p(he);ee(()=>P(ce,`${s().total??""} emails classified into ${a().length??""} groups`)),T(le,de)},me=le=>{var de=h1();T(le,de)};ne(re,le=>{s().total>0?le(G):d()||le(me,1)})}var be=g(re,2);f1(be,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),T(t,R),St()}qt(["click"]);var _1=I('<div class="actions-page svelte-3tch4q"><!></div>');function y1(t,e){xt(e,!0);const n=Qu();let a=Pe(Nt(n.status)),s=Pe(""),o=Pe(Nt({})),c=Pe(Nt([])),d=Pe(Nt({total:0})),h=Pe(null),m=Pe(null),y=Pe(!1),k=Pe(null),b=Pe(3),x=Pe(null),R=Pe(null);const D="me-ai-scan-history";async function F(){return Rs(D)}async function ae(he){!he||he.phase!=="done"||await Os(D,{timestamp:Date.now(),classified:he.classified||0,errors:he.errors||0,total:he.total||0,totals:he.totals||{},summary:he.summary||{}})}dn(async()=>{const he=n.onMessage(pe=>{if(pe.status==="ready"){C(a,"ready");const xe=xr.find(ke=>ke.id===n.modelId),oe=Sr.find(ke=>ke.name===n.modelId),ue=xe||oe;C(s,(ue==null?void 0:ue.name)||(ue==null?void 0:ue.displayName)||n.modelId||"",!0)}pe.status==="loading"&&C(a,"loading")});if(C(a,n.status,!0),n.modelId){const pe=xr.find(ue=>ue.id===n.modelId),xe=Sr.find(ue=>ue.name===n.modelId),oe=pe||xe;C(s,(oe==null?void 0:oe.name)||(oe==null?void 0:oe.displayName)||n.modelId||"",!0)}const ce=await F();return ce&&C(k,{phase:"done",...ce},!0),Q(),()=>he()});async function Q(){try{const he=await ud();C(o,he.groups,!0),C(c,he.order,!0),C(d,await Bp(),!0),C(h,await Fo(),!0)}catch(he){C(x,`Failed to load data: ${he.message}`)}}async function V(){await W(!1)}async function A(){await W(!0)}async function W(he){if(u(y)||!n.isReady)return;C(x,null),C(y,!0),C(k,null);const ce=new AbortController;C(R,ce,!0);try{await cd(n,{count:u(b),force:he,signal:ce.signal,onProgress:pe=>{C(k,{...pe},!0),pe.phase==="done"&&ae(pe)}}),await Q()}catch(pe){ce.signal.aborted||C(x,`Scan failed: ${pe.message}`)}finally{C(y,!1),C(R,null)}}function re(){var he;(he=u(R))==null||he.abort()}async function G(he){await Si(he,"acted"),await Q()}async function me(he){await Si(he,"dismissed"),await Q()}async function be(he){await dd(he),await Q()}async function le(he){await ml(he),await Q()}function de(he){C(m,u(m)===he?null:he,!0)}var ie=_1(),ve=p(ie);g1(ve,{get engineStatus(){return u(a)},get modelName(){return u(s)},get groups(){return u(o)},get groupOrder(){return u(c)},get counts(){return u(d)},get stats(){return u(h)},get expandedGroup(){return u(m)},get isScanning(){return u(y)},get scanProgress(){return u(k)},get error(){return u(x)},onscan:V,onrescan:A,ontogglegroup:de,onmarkacted:G,ondismiss:me,onremove:be,oncleargroup:le,ondismisserror:()=>C(x,null),onstop:re,onrefresh:Q,oncloseprogress:()=>{C(k,null),dl(D)},get scanCount(){return u(b)},set scanCount(he){C(b,he,!0)}}),T(t,ie),St()}var b1=I('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function w1(t,e){xt(e,!0);function n(){const G=location.hash;return G==="#dashboard"?"dashboard":G==="#actions"?"actions":"chat"}let a=Pe(Nt(n()));dn(()=>{function G(){C(a,n(),!0)}return window.addEventListener("hashchange",G),()=>window.removeEventListener("hashchange",G)});var s=b1(),o=p(s),c=g(p(o),2),d=p(c);let h;var m=g(d,2);let y;var k=g(m,2);let b;var x=g(o,2),R=p(x);let D;var F=p(R);lg(F,{});var ae=g(R,2);let Q;var V=p(ae);y1(V,{});var A=g(ae,2);let W;var re=p(A);By(re,{}),ee(()=>{h=Pt(d,1,"svelte-1n46o8q",null,h,{active:u(a)==="chat"}),y=Pt(m,1,"svelte-1n46o8q",null,y,{active:u(a)==="actions"}),b=Pt(k,1,"svelte-1n46o8q",null,b,{active:u(a)==="dashboard"}),D=on(R,"",D,{display:u(a)==="chat"?"flex":"none"}),Q=on(ae,"",Q,{display:u(a)==="actions"?"flex":"none"}),W=on(A,"",W,{display:u(a)==="dashboard"?"flex":"none"})}),T(t,s),St()}kv(w1,{target:document.getElementById("app")});
