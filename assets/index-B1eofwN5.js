var Pm=Object.defineProperty;var xf=t=>{throw TypeError(t)};var Mm=(t,e,n)=>e in t?Pm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ht=(t,e,n)=>Mm(t,typeof e!="symbol"?e+"":e,n),Mc=(t,e,n)=>e.has(t)||xf("Cannot "+n);var F=(t,e,n)=>(Mc(t,e,"read from private field"),n?n.call(t):e.get(t)),Ie=(t,e,n)=>e.has(t)?xf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),St=(t,e,n,r)=>(Mc(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),An=(t,e,n)=>(Mc(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const au=!1;var jl=Array.isArray,Om=Array.prototype.indexOf,Ys=Array.prototype.includes,ql=Array.from,Nm=Object.defineProperty,Ma=Object.getOwnPropertyDescriptor,th=Object.getOwnPropertyDescriptors,nh=Object.prototype,Dm=Array.prototype,Bl=Object.getPrototypeOf,kf=Object.isExtensible;function _i(t){return typeof t=="function"}const _s=()=>{};function Rm(t){return t()}function su(t){for(var e=0;e<t.length;e++)t[e]()}function rh(){var t,e,n=new Promise((r,a)=>{t=r,e=a});return{promise:n,resolve:t,reject:e}}function jn(t,e,n=!1){return t===void 0?n?e():e:t}function so(t,e){if(Array.isArray(t))return t;if(e===void 0||!(Symbol.iterator in t))return Array.from(t);const n=[];for(const r of t)if(n.push(r),n.length===e)break;return n}const In=2,Bi=4,io=8,Yu=1<<24,_a=16,Rr=32,qa=64,ah=128,hr=512,bn=1024,Pn=2048,Nr=4096,or=8192,pa=16384,oo=32768,Ra=65536,Sf=1<<17,sh=1<<18,bs=1<<19,ih=1<<20,da=1<<25,us=65536,iu=1<<21,Xu=1<<22,Oa=1<<23,Wr=Symbol("$state"),oh=Symbol("legacy props"),Lm=Symbol(""),Qa=new class extends Error{constructor(){super(...arguments);ht(this,"name","StaleReactionError");ht(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};var Qv;const lh=((Qv=globalThis.document)==null?void 0:Qv.contentType.includes("xml"))??!1;function Zu(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function zm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function jm(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function qm(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Bm(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Fm(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Km(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Hm(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Vm(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Um(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Gm(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Wm(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Ym=1,Xm=2,ch=4,Zm=8,Qm=16,Jm=1,$m=2,ey=4,ty=8,ny=16,uh=1,ry=2,_n=Symbol(),dh="http://www.w3.org/1999/xhtml",ay="@attach";function sy(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function iy(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function fh(t){return t===this.v}function vh(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function hh(t){return!vh(t,this.v)}let si=!1,oy=!1;function ly(){si=!0}const cy=[];function ph(t,e=!1,n=!1){return el(t,new Map,"",cy,null,n)}function el(t,e,n,r,a=null,s=!1){if(typeof t=="object"&&t!==null){var i=e.get(t);if(i!==void 0)return i;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(jl(t)){var l=Array(t.length);e.set(t,l),a!==null&&e.set(a,l);for(var d=0;d<t.length;d+=1){var f=t[d];d in t&&(l[d]=el(f,e,n,r,null,s))}return l}if(Bl(t)===nh){l={},e.set(t,l),a!==null&&e.set(a,l);for(var v in t)l[v]=el(t[v],e,n,r,null,s);return l}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return el(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let tn=null;function Xs(t){tn=t}function Qu(t){return Ju().get(t)}function gh(t,e){return Ju().set(t,e),e}function uy(t){return Ju().has(t)}function at(t,e=!1,n){tn={p:tn,i:!1,c:null,e:null,s:t,x:null,l:si&&!e?{s:null,u:null,$:[]}:null}}function st(t){var e=tn,n=e.e;if(n!==null){e.e=null;for(var r of n)jh(r)}return t!==void 0&&(e.x=t),e.i=!0,tn=e.p,t??{}}function lo(){return!si||tn!==null&&tn.l===null}function Ju(t){return tn===null&&Zu(),tn.c??(tn.c=new Map(dy(tn)||void 0))}function dy(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let Ja=[];function mh(){var t=Ja;Ja=[],su(t)}function Yr(t){if(Ja.length===0&&!Di){var e=Ja;queueMicrotask(()=>{e===Ja&&mh()})}Ja.push(t)}function fy(){for(;Ja.length>0;)mh()}function yh(t){var e=Gt;if(e===null)return Lt.f|=Oa,t;if((e.f&oo)===0&&(e.f&Bi)===0)throw t;Zs(t,e)}function Zs(t,e){for(;e!==null;){if((e.f&ah)!==0){if((e.f&oo)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const vy=-7169;function gn(t,e){t.f=t.f&vy|e}function $u(t){(t.f&hr)!==0||t.deps===null?gn(t,bn):gn(t,Nr)}function _h(t){if(t!==null)for(const e of t)(e.f&In)===0||(e.f&us)===0||(e.f^=us,_h(e.deps))}function bh(t,e,n){(t.f&Pn)!==0?e.add(t):(t.f&Nr)!==0&&n.add(t),_h(t.deps),gn(t,bn)}const qo=new Set;let It=null,vl=null,Tn=null,Xn=[],Fl=null,ou=!1,Di=!1;var Bs,Fs,ts,Ks,Ji,$i,ns,ia,Hs,ea,lu,cu,wh;const Wd=class Wd{constructor(){Ie(this,ea);ht(this,"committed",!1);ht(this,"current",new Map);ht(this,"previous",new Map);Ie(this,Bs,new Set);Ie(this,Fs,new Set);Ie(this,ts,0);Ie(this,Ks,0);Ie(this,Ji,null);Ie(this,$i,new Set);Ie(this,ns,new Set);Ie(this,ia,new Map);ht(this,"is_fork",!1);Ie(this,Hs,!1)}is_deferred(){return this.is_fork||F(this,Ks)>0}skip_effect(e){F(this,ia).has(e)||F(this,ia).set(e,{d:[],m:[]})}unskip_effect(e){var n=F(this,ia).get(e);if(n){F(this,ia).delete(e);for(var r of n.d)gn(r,Pn),Pr(r);for(r of n.m)gn(r,Nr),Pr(r)}}process(e){var a;Xn=[],this.apply();var n=[],r=[];for(const s of e)An(this,ea,lu).call(this,s,n,r);if(this.is_deferred()){An(this,ea,cu).call(this,r),An(this,ea,cu).call(this,n);for(const[s,i]of F(this,ia))Eh(s,i)}else{for(const s of F(this,Bs))s();F(this,Bs).clear(),F(this,ts)===0&&An(this,ea,wh).call(this),vl=this,It=null,Ef(r),Ef(n),vl=null,(a=F(this,Ji))==null||a.resolve()}Tn=null}capture(e,n){n!==_n&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Oa)===0&&(this.current.set(e,e.v),Tn==null||Tn.set(e,e.v))}activate(){It=this,this.apply()}deactivate(){It===this&&(It=null,Tn=null)}flush(){if(this.activate(),Xn.length>0){if(xh(),It!==null&&It!==this)return}else F(this,ts)===0&&this.process([]);this.deactivate()}discard(){for(const e of F(this,Fs))e(this);F(this,Fs).clear()}increment(e){St(this,ts,F(this,ts)+1),e&&St(this,Ks,F(this,Ks)+1)}decrement(e){St(this,ts,F(this,ts)-1),e&&St(this,Ks,F(this,Ks)-1),!F(this,Hs)&&(St(this,Hs,!0),Yr(()=>{St(this,Hs,!1),this.is_deferred()?Xn.length>0&&this.flush():this.revive()}))}revive(){for(const e of F(this,$i))F(this,ns).delete(e),gn(e,Pn),Pr(e);for(const e of F(this,ns))gn(e,Nr),Pr(e);this.flush()}oncommit(e){F(this,Bs).add(e)}ondiscard(e){F(this,Fs).add(e)}settled(){return(F(this,Ji)??St(this,Ji,rh())).promise}static ensure(){if(It===null){const e=It=new Wd;qo.add(It),Di||Yr(()=>{It===e&&e.flush()})}return It}apply(){}};Bs=new WeakMap,Fs=new WeakMap,ts=new WeakMap,Ks=new WeakMap,Ji=new WeakMap,$i=new WeakMap,ns=new WeakMap,ia=new WeakMap,Hs=new WeakMap,ea=new WeakSet,lu=function(e,n,r){e.f^=bn;for(var a=e.first,s=null;a!==null;){var i=a.f,l=(i&(Rr|qa))!==0,d=l&&(i&bn)!==0,f=d||(i&or)!==0||F(this,ia).has(a);if(!f&&a.fn!==null){l?a.f^=bn:s!==null&&(i&(Bi|io|Yu))!==0?s.b.defer_effect(a):(i&Bi)!==0?n.push(a):vo(a)&&((i&_a)!==0&&F(this,ns).add(a),Js(a));var v=a.first;if(v!==null){a=v;continue}}var p=a.parent;for(a=a.next;a===null&&p!==null;)p===s&&(s=null),a=p.next,p=p.parent}},cu=function(e){for(var n=0;n<e.length;n+=1)bh(e[n],F(this,$i),F(this,ns))},wh=function(){var a;if(qo.size>1){this.previous.clear();var e=Tn,n=!0;for(const s of qo){if(s===this){n=!1;continue}const i=[];for(const[d,f]of this.current){if(s.current.has(d))if(n&&f!==s.current.get(d))s.current.set(d,f);else continue;i.push(d)}if(i.length===0)continue;const l=[...s.current.keys()].filter(d=>!this.current.has(d));if(l.length>0){var r=Xn;Xn=[];const d=new Set,f=new Map;for(const v of i)kh(v,l,d,f);if(Xn.length>0){It=s,s.apply();for(const v of Xn)An(a=s,ea,lu).call(a,v,[],[]);s.deactivate()}Xn=r}}It=null,Tn=e}this.committed=!0,qo.delete(this)};let ga=Wd;function hy(t){var e=Di;Di=!0;try{for(var n;;){if(fy(),Xn.length===0&&(It==null||It.flush(),Xn.length===0))return Fl=null,n;xh()}}finally{Di=e}}function xh(){ou=!0;var t=null;try{for(var e=0;Xn.length>0;){var n=ga.ensure();if(e++>1e3){var r,a;py()}n.process(Xn),Na.clear()}}finally{Xn=[],ou=!1,Fl=null}}function py(){try{Km()}catch(t){Zs(t,Fl)}}let kr=null;function Ef(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(pa|or))===0&&vo(r)&&(kr=new Set,Js(r),r.deps===null&&r.first===null&&r.nodes===null&&r.teardown===null&&r.ac===null&&Vh(r),(kr==null?void 0:kr.size)>0)){Na.clear();for(const a of kr){if((a.f&(pa|or))!==0)continue;const s=[a];let i=a.parent;for(;i!==null;)kr.has(i)&&(kr.delete(i),s.push(i)),i=i.parent;for(let l=s.length-1;l>=0;l--){const d=s[l];(d.f&(pa|or))===0&&Js(d)}}kr.clear()}}kr=null}}function kh(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const a of t.reactions){const s=a.f;(s&In)!==0?kh(a,e,n,r):(s&(Xu|_a))!==0&&(s&Pn)===0&&Sh(a,e,r)&&(gn(a,Pn),Pr(a))}}function Sh(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const a of t.deps){if(Ys.call(e,a))return!0;if((a.f&In)!==0&&Sh(a,e,n))return n.set(a,!0),!0}return n.set(t,!1),!1}function Pr(t){for(var e=Fl=t;e.parent!==null;){e=e.parent;var n=e.f;if(ou&&e===Gt&&(n&_a)!==0&&(n&sh)===0)return;if((n&(qa|Rr))!==0){if((n&bn)===0)return;e.f^=bn}}Xn.push(e)}function Eh(t,e){if(!((t.f&Rr)!==0&&(t.f&bn)!==0)){(t.f&Pn)!==0?e.d.push(t):(t.f&Nr)!==0&&e.m.push(t),gn(t,bn);for(var n=t.first;n!==null;)Eh(n,e),n=n.next}}function Ah(t){let e=0,n=ds(0),r;return()=>{nd()&&(o(n),Hl(()=>(e===0&&(r=Jn(()=>t(()=>Ri(n)))),e+=1,()=>{Yr(()=>{e-=1,e===0&&(r==null||r(),r=void 0,Ri(n))})})))}}var gy=Ra|bs|ah;function my(t,e,n){new yy(t,e,n)}var fr,Wu,Kr,rs,Hr,vr,Gn,Vr,oa,Ca,as,Ia,Vs,ss,Us,Gs,la,Dl,xn,_y,by,uu,tl,nl,du;class yy{constructor(e,n,r){Ie(this,xn);ht(this,"parent");ht(this,"is_pending",!1);Ie(this,fr);Ie(this,Wu,null);Ie(this,Kr);Ie(this,rs);Ie(this,Hr);Ie(this,vr,null);Ie(this,Gn,null);Ie(this,Vr,null);Ie(this,oa,null);Ie(this,Ca,null);Ie(this,as,0);Ie(this,Ia,0);Ie(this,Vs,!1);Ie(this,ss,!1);Ie(this,Us,new Set);Ie(this,Gs,new Set);Ie(this,la,null);Ie(this,Dl,Ah(()=>(St(this,la,ds(F(this,as))),()=>{St(this,la,null)})));St(this,fr,e),St(this,Kr,n),St(this,rs,r),this.parent=Gt.b,this.is_pending=!!F(this,Kr).pending,St(this,Hr,fo(()=>{Gt.b=this;{var a=An(this,xn,uu).call(this);try{St(this,vr,Qn(()=>r(a)))}catch(s){this.error(s)}F(this,Ia)>0?An(this,xn,nl).call(this):this.is_pending=!1}return()=>{var s;(s=F(this,Ca))==null||s.remove()}},gy))}defer_effect(e){bh(e,F(this,Us),F(this,Gs))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!F(this,Kr).pending}update_pending_count(e){An(this,xn,du).call(this,e),St(this,as,F(this,as)+e),!(!F(this,la)||F(this,Vs))&&(St(this,Vs,!0),Yr(()=>{St(this,Vs,!1),F(this,la)&&Qs(F(this,la),F(this,as))}))}get_effect_pending(){return F(this,Dl).call(this),o(F(this,la))}error(e){var n=F(this,Kr).onerror;let r=F(this,Kr).failed;if(F(this,ss)||!n&&!r)throw e;F(this,vr)&&(wn(F(this,vr)),St(this,vr,null)),F(this,Gn)&&(wn(F(this,Gn)),St(this,Gn,null)),F(this,Vr)&&(wn(F(this,Vr)),St(this,Vr,null));var a=!1,s=!1;const i=()=>{if(a){iy();return}a=!0,s&&Wm(),ga.ensure(),St(this,as,0),F(this,Vr)!==null&&os(F(this,Vr),()=>{St(this,Vr,null)}),this.is_pending=this.has_pending_snippet(),St(this,vr,An(this,xn,tl).call(this,()=>(St(this,ss,!1),Qn(()=>F(this,rs).call(this,F(this,fr)))))),F(this,Ia)>0?An(this,xn,nl).call(this):this.is_pending=!1};Yr(()=>{try{s=!0,n==null||n(e,i),s=!1}catch(l){Zs(l,F(this,Hr)&&F(this,Hr).parent)}r&&St(this,Vr,An(this,xn,tl).call(this,()=>{ga.ensure(),St(this,ss,!0);try{return Qn(()=>{r(F(this,fr),()=>e,()=>i)})}catch(l){return Zs(l,F(this,Hr).parent),null}finally{St(this,ss,!1)}}))})}}fr=new WeakMap,Wu=new WeakMap,Kr=new WeakMap,rs=new WeakMap,Hr=new WeakMap,vr=new WeakMap,Gn=new WeakMap,Vr=new WeakMap,oa=new WeakMap,Ca=new WeakMap,as=new WeakMap,Ia=new WeakMap,Vs=new WeakMap,ss=new WeakMap,Us=new WeakMap,Gs=new WeakMap,la=new WeakMap,Dl=new WeakMap,xn=new WeakSet,_y=function(){try{St(this,vr,Qn(()=>F(this,rs).call(this,F(this,fr))))}catch(e){this.error(e)}},by=function(){const e=F(this,Kr).pending;e&&(St(this,Gn,Qn(()=>e(F(this,fr)))),Yr(()=>{var n=An(this,xn,uu).call(this);St(this,vr,An(this,xn,tl).call(this,()=>(ga.ensure(),Qn(()=>F(this,rs).call(this,n))))),F(this,Ia)>0?An(this,xn,nl).call(this):(os(F(this,Gn),()=>{St(this,Gn,null)}),this.is_pending=!1)}))},uu=function(){var e=F(this,fr);return this.is_pending&&(St(this,Ca,ma()),F(this,fr).before(F(this,Ca)),e=F(this,Ca)),e},tl=function(e){var n=Gt,r=Lt,a=tn;Jr(F(this,Hr)),mr(F(this,Hr)),Xs(F(this,Hr).ctx);try{return e()}catch(s){return yh(s),null}finally{Jr(n),mr(r),Xs(a)}},nl=function(){const e=F(this,Kr).pending;F(this,vr)!==null&&(St(this,oa,document.createDocumentFragment()),F(this,oa).append(F(this,Ca)),Wh(F(this,vr),F(this,oa))),F(this,Gn)===null&&St(this,Gn,Qn(()=>e(F(this,fr))))},du=function(e){var n;if(!this.has_pending_snippet()){this.parent&&An(n=this.parent,xn,du).call(n,e);return}if(St(this,Ia,F(this,Ia)+e),F(this,Ia)===0){this.is_pending=!1;for(const r of F(this,Us))gn(r,Pn),Pr(r);for(const r of F(this,Gs))gn(r,Nr),Pr(r);F(this,Us).clear(),F(this,Gs).clear(),F(this,Gn)&&os(F(this,Gn),()=>{St(this,Gn,null)}),F(this,oa)&&(F(this,fr).before(F(this,oa)),St(this,oa,null))}};function Th(t,e,n,r){const a=lo()?co:ed;var s=t.filter(h=>!h.settled);if(n.length===0&&s.length===0){r(e.map(a));return}var i=It,l=Gt,d=wy(),f=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(h=>h.promise)):null;function v(h){d();try{r(h)}catch(y){(l.f&pa)===0&&Zs(y,l)}i==null||i.deactivate(),fu()}if(n.length===0){f.then(()=>v(e.map(a)));return}function p(){d(),Promise.all(n.map(h=>xy(h))).then(h=>v([...e.map(a),...h])).catch(h=>Zs(h,l))}f?f.then(p):p()}function wy(){var t=Gt,e=Lt,n=tn,r=It;return function(s=!0){Jr(t),mr(e),Xs(n),s&&(r==null||r.activate())}}function fu(){Jr(null),mr(null),Xs(null)}function co(t){var e=In|Pn,n=Lt!==null&&(Lt.f&In)!==0?Lt:null;return Gt!==null&&(Gt.f|=bs),{ctx:tn,deps:null,effects:null,equals:fh,f:e,fn:t,reactions:null,rv:0,v:_n,wv:0,parent:n??Gt,ac:null}}function xy(t,e,n){let r=Gt;r===null&&zm();var a=r.b,s=void 0,i=ds(_n),l=!Lt,d=new Map;return Ly(()=>{var y;var f=rh();s=f.promise;try{Promise.resolve(t()).then(f.resolve,f.reject).then(()=>{v===It&&v.committed&&v.deactivate(),fu()})}catch(x){f.reject(x),fu()}var v=It;if(l){var p=a.is_rendered();a.update_pending_count(1),v.increment(p),(y=d.get(v))==null||y.reject(Qa),d.delete(v),d.set(v,f)}const h=(x,S=void 0)=>{if(v.activate(),S)S!==Qa&&(i.f|=Oa,Qs(i,S));else{(i.f&Oa)!==0&&(i.f^=Oa),Qs(i,x);for(const[A,D]of d){if(d.delete(A),A===v)break;D.reject(Qa)}}l&&(a.update_pending_count(-1),v.decrement(p))};f.promise.then(h,x=>h(null,x||"unknown"))}),rd(()=>{for(const f of d.values())f.reject(Qa)}),new Promise(f=>{function v(p){function h(){p===s?f(i):v(s)}p.then(h,h)}v(s)})}function Q(t){const e=co(t);return Yh(e),e}function ed(t){const e=co(t);return e.equals=hh,e}function ky(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)wn(e[n])}}function Sy(t){for(var e=t.parent;e!==null;){if((e.f&In)===0)return(e.f&pa)===0?e:null;e=e.parent}return null}function td(t){var e,n=Gt;Jr(Sy(t));try{t.f&=~us,ky(t),e=Jh(t)}finally{Jr(n)}return e}function Ch(t){var e=td(t);if(!t.equals(e)&&(t.wv=Zh(),(!(It!=null&&It.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){gn(t,bn);return}La||(Tn!==null?(nd()||It!=null&&It.is_fork)&&Tn.set(t,e):$u(t))}function Ey(t){var e,n;if(t.effects!==null)for(const r of t.effects)(r.teardown||r.ac)&&((e=r.teardown)==null||e.call(r),(n=r.ac)==null||n.abort(Qa),r.teardown=_s,r.ac=null,Fi(r,0),ad(r))}function Ih(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Js(e)}let vu=new Set;const Na=new Map;let Ph=!1;function ds(t,e){var n={f:0,v:t,reactions:null,equals:fh,rv:0,wv:0};return n}function Pe(t,e){const n=ds(t);return Yh(n),n}function Ay(t,e=!1,n=!0){var a;const r=ds(t);return e||(r.equals=hh),si&&n&&tn!==null&&tn.l!==null&&((a=tn.l).s??(a.s=[])).push(r),r}function P(t,e,n=!1){Lt!==null&&(!Mr||(Lt.f&Sf)!==0)&&lo()&&(Lt.f&(In|_a|Xu|Sf))!==0&&(pr===null||!Ys.call(pr,t))&&Gm();let r=n?Xt(e):e;return Qs(t,r)}function Qs(t,e){if(!t.equals(e)){var n=t.v;La?Na.set(t,e):Na.set(t,n),t.v=e;var r=ga.ensure();if(r.capture(t,n),(t.f&In)!==0){const a=t;(t.f&Pn)!==0&&td(a),$u(a)}t.wv=Zh(),Mh(t,Pn),lo()&&Gt!==null&&(Gt.f&bn)!==0&&(Gt.f&(Rr|qa))===0&&(dr===null?jy([t]):dr.push(t)),!r.is_fork&&vu.size>0&&!Ph&&Ty()}return e}function Ty(){Ph=!1;for(const t of vu)(t.f&bn)!==0&&gn(t,Nr),vo(t)&&Js(t);vu.clear()}function Ri(t){P(t,t.v+1)}function Mh(t,e){var n=t.reactions;if(n!==null)for(var r=lo(),a=n.length,s=0;s<a;s++){var i=n[s],l=i.f;if(!(!r&&i===Gt)){var d=(l&Pn)===0;if(d&&gn(i,e),(l&In)!==0){var f=i;Tn==null||Tn.delete(f),(l&us)===0&&(l&hr&&(i.f|=us),Mh(f,Nr))}else d&&((l&_a)!==0&&kr!==null&&kr.add(i),Pr(i))}}}function Xt(t){if(typeof t!="object"||t===null||Wr in t)return t;const e=Bl(t);if(e!==nh&&e!==Dm)return t;var n=new Map,r=jl(t),a=Pe(0),s=ls,i=l=>{if(ls===s)return l();var d=Lt,f=ls;mr(null),If(s);var v=l();return mr(d),If(f),v};return r&&n.set("length",Pe(t.length)),new Proxy(t,{defineProperty(l,d,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Vm();var v=n.get(d);return v===void 0?i(()=>{var p=Pe(f.value);return n.set(d,p),p}):P(v,f.value,!0),!0},deleteProperty(l,d){var f=n.get(d);if(f===void 0){if(d in l){const v=i(()=>Pe(_n));n.set(d,v),Ri(a)}}else P(f,_n),Ri(a);return!0},get(l,d,f){var y;if(d===Wr)return t;var v=n.get(d),p=d in l;if(v===void 0&&(!p||(y=Ma(l,d))!=null&&y.writable)&&(v=i(()=>{var x=Xt(p?l[d]:_n),S=Pe(x);return S}),n.set(d,v)),v!==void 0){var h=o(v);return h===_n?void 0:h}return Reflect.get(l,d,f)},getOwnPropertyDescriptor(l,d){var f=Reflect.getOwnPropertyDescriptor(l,d);if(f&&"value"in f){var v=n.get(d);v&&(f.value=o(v))}else if(f===void 0){var p=n.get(d),h=p==null?void 0:p.v;if(p!==void 0&&h!==_n)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return f},has(l,d){var h;if(d===Wr)return!0;var f=n.get(d),v=f!==void 0&&f.v!==_n||Reflect.has(l,d);if(f!==void 0||Gt!==null&&(!v||(h=Ma(l,d))!=null&&h.writable)){f===void 0&&(f=i(()=>{var y=v?Xt(l[d]):_n,x=Pe(y);return x}),n.set(d,f));var p=o(f);if(p===_n)return!1}return v},set(l,d,f,v){var W;var p=n.get(d),h=d in l;if(r&&d==="length")for(var y=f;y<p.v;y+=1){var x=n.get(y+"");x!==void 0?P(x,_n):y in l&&(x=i(()=>Pe(_n)),n.set(y+"",x))}if(p===void 0)(!h||(W=Ma(l,d))!=null&&W.writable)&&(p=i(()=>Pe(void 0)),P(p,Xt(f)),n.set(d,p));else{h=p.v!==_n;var S=i(()=>Xt(f));P(p,S)}var A=Reflect.getOwnPropertyDescriptor(l,d);if(A!=null&&A.set&&A.set.call(v,f),!h){if(r&&typeof d=="string"){var D=n.get("length"),L=Number(d);Number.isInteger(L)&&L>=D.v&&P(D,L+1)}Ri(a)}return!0},ownKeys(l){o(a);var d=Reflect.ownKeys(l).filter(p=>{var h=n.get(p);return h===void 0||h.v!==_n});for(var[f,v]of n)v.v!==_n&&!(f in l)&&d.push(f);return d},setPrototypeOf(){Um()}})}function Af(t){try{if(t!==null&&typeof t=="object"&&Wr in t)return t[Wr]}catch{}return t}function Cy(t,e){return Object.is(Af(t),Af(e))}var Un,Oh,Nh,Dh;function Iy(){if(Un===void 0){Un=window,Oh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Nh=Ma(e,"firstChild").get,Dh=Ma(e,"nextSibling").get,kf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),kf(n)&&(n.__t=void 0)}}function ma(t=""){return document.createTextNode(t)}function ir(t){return Nh.call(t)}function uo(t){return Dh.call(t)}function _(t,e){return ir(t)}function Xe(t,e=!1){{var n=ir(t);return n instanceof Comment&&n.data===""?uo(n):n}}function b(t,e=1,n=!1){let r=t;for(;e--;)r=uo(r);return r}function Py(t){t.textContent=""}function Rh(){return!1}function My(t,e,n){return document.createElementNS(dh,t,void 0)}function Oy(t,e){if(e){const n=document.body;t.autofocus=!0,Yr(()=>{document.activeElement===n&&t.focus()})}}let Tf=!1;function Ny(){Tf||(Tf=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Kl(t){var e=Lt,n=Gt;mr(null),Jr(null);try{return t()}finally{mr(e),Jr(n)}}function Lh(t,e,n,r=n){t.addEventListener(e,()=>Kl(n));const a=t.__on_r;a?t.__on_r=()=>{a(),r(!0)}:t.__on_r=()=>r(!0),Ny()}function zh(t){Gt===null&&(Lt===null&&Fm(),Bm()),La&&qm()}function Dy(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function _r(t,e,n){var r=Gt;r!==null&&(r.f&or)!==0&&(t|=or);var a={ctx:tn,deps:null,nodes:null,f:t|Pn|hr,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Js(a)}catch(l){throw wn(a),l}else e!==null&&Pr(a);var s=a;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&bs)===0&&(s=s.first,(t&_a)!==0&&(t&Ra)!==0&&s!==null&&(s.f|=Ra)),s!==null&&(s.parent=r,r!==null&&Dy(s,r),Lt!==null&&(Lt.f&In)!==0&&(t&qa)===0)){var i=Lt;(i.effects??(i.effects=[])).push(s)}return a}function nd(){return Lt!==null&&!Mr}function rd(t){const e=_r(io,null,!1);return gn(e,bn),e.teardown=t,e}function kn(t){zh();var e=Gt.f,n=!Lt&&(e&Rr)!==0&&(e&oo)===0;if(n){var r=tn;(r.e??(r.e=[])).push(t)}else return jh(t)}function jh(t){return _r(Bi|ih,t,!1)}function qh(t){return zh(),_r(io|ih,t,!0)}function Bh(t){ga.ensure();const e=_r(qa|bs,t,!0);return()=>{wn(e)}}function Ry(t){ga.ensure();const e=_r(qa|bs,t,!0);return(n={})=>new Promise(r=>{n.outro?os(e,()=>{wn(e),r(void 0)}):(wn(e),r(void 0))})}function ii(t){return _r(Bi,t,!1)}function Ly(t){return _r(Xu|bs,t,!0)}function Hl(t,e=0){return _r(io|e,t,!0)}function ie(t,e=[],n=[],r=[]){Th(r,e,n,a=>{_r(io,()=>t(...a.map(o)),!0)})}function fo(t,e=0){var n=_r(_a|e,t,!0);return n}function Fh(t,e=0){var n=_r(Yu|e,t,!0);return n}function Qn(t){return _r(Rr|bs,t,!0)}function Kh(t){var e=t.teardown;if(e!==null){const n=La,r=Lt;Cf(!0),mr(null);try{e.call(null)}finally{Cf(n),mr(r)}}}function ad(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const a=n.ac;a!==null&&Kl(()=>{a.abort(Qa)});var r=n.next;(n.f&qa)!==0?n.parent=null:wn(n,e),n=r}}function zy(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Rr)===0&&wn(e),e=n}}function wn(t,e=!0){var n=!1;(e||(t.f&sh)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Hh(t.nodes.start,t.nodes.end),n=!0),ad(t,e&&!n),Fi(t,0),gn(t,pa);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Kh(t);var a=t.parent;a!==null&&a.first!==null&&Vh(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Hh(t,e){for(;t!==null;){var n=t===e?null:uo(t);t.remove(),t=n}}function Vh(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function os(t,e,n=!0){var r=[];Uh(t,r,!0);var a=()=>{n&&wn(t),e&&e()},s=r.length;if(s>0){var i=()=>--s||a();for(var l of r)l.out(i)}else a()}function Uh(t,e,n){if((t.f&or)===0){t.f^=or;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||n)&&e.push(l);for(var a=t.first;a!==null;){var s=a.next,i=(a.f&Ra)!==0||(a.f&Rr)!==0&&(t.f&_a)!==0;Uh(a,e,i?n:!1),a=s}}}function sd(t){Gh(t,!0)}function Gh(t,e){if((t.f&or)!==0){t.f^=or,(t.f&bn)===0&&(gn(t,Pn),Pr(t));for(var n=t.first;n!==null;){var r=n.next,a=(n.f&Ra)!==0||(n.f&Rr)!==0;Gh(n,a?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)(i.is_global||e)&&i.in()}}function Wh(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var a=n===r?null:uo(n);e.append(n),n=a}}let rl=!1,La=!1;function Cf(t){La=t}let Lt=null,Mr=!1;function mr(t){Lt=t}let Gt=null;function Jr(t){Gt=t}let pr=null;function Yh(t){Lt!==null&&(pr===null?pr=[t]:pr.push(t))}let Zn=null,ar=0,dr=null;function jy(t){dr=t}let Xh=1,$a=0,ls=$a;function If(t){ls=t}function Zh(){return++Xh}function vo(t){var e=t.f;if((e&Pn)!==0)return!0;if(e&In&&(t.f&=~us),(e&Nr)!==0){for(var n=t.deps,r=n.length,a=0;a<r;a++){var s=n[a];if(vo(s)&&Ch(s),s.wv>t.wv)return!0}(e&hr)!==0&&Tn===null&&gn(t,bn)}return!1}function Qh(t,e,n=!0){var r=t.reactions;if(r!==null&&!(pr!==null&&Ys.call(pr,t)))for(var a=0;a<r.length;a++){var s=r[a];(s.f&In)!==0?Qh(s,e,!1):e===s&&(n?gn(s,Pn):(s.f&bn)!==0&&gn(s,Nr),Pr(s))}}function Jh(t){var S;var e=Zn,n=ar,r=dr,a=Lt,s=pr,i=tn,l=Mr,d=ls,f=t.f;Zn=null,ar=0,dr=null,Lt=(f&(Rr|qa))===0?t:null,pr=null,Xs(t.ctx),Mr=!1,ls=++$a,t.ac!==null&&(Kl(()=>{t.ac.abort(Qa)}),t.ac=null);try{t.f|=iu;var v=t.fn,p=v();t.f|=oo;var h=t.deps,y=It==null?void 0:It.is_fork;if(Zn!==null){var x;if(y||Fi(t,ar),h!==null&&ar>0)for(h.length=ar+Zn.length,x=0;x<Zn.length;x++)h[ar+x]=Zn[x];else t.deps=h=Zn;if(nd()&&(t.f&hr)!==0)for(x=ar;x<h.length;x++)((S=h[x]).reactions??(S.reactions=[])).push(t)}else!y&&h!==null&&ar<h.length&&(Fi(t,ar),h.length=ar);if(lo()&&dr!==null&&!Mr&&h!==null&&(t.f&(In|Nr|Pn))===0)for(x=0;x<dr.length;x++)Qh(dr[x],t);if(a!==null&&a!==t){if($a++,a.deps!==null)for(let A=0;A<n;A+=1)a.deps[A].rv=$a;if(e!==null)for(const A of e)A.rv=$a;dr!==null&&(r===null?r=dr:r.push(...dr))}return(t.f&Oa)!==0&&(t.f^=Oa),p}catch(A){return yh(A)}finally{t.f^=iu,Zn=e,ar=n,dr=r,Lt=a,pr=s,Xs(i),Mr=l,ls=d}}function qy(t,e){let n=e.reactions;if(n!==null){var r=Om.call(n,t);if(r!==-1){var a=n.length-1;a===0?n=e.reactions=null:(n[r]=n[a],n.pop())}}if(n===null&&(e.f&In)!==0&&(Zn===null||!Ys.call(Zn,e))){var s=e;(s.f&hr)!==0&&(s.f^=hr,s.f&=~us),$u(s),Ey(s),Fi(s,0)}}function Fi(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)qy(t,n[r])}function Js(t){var e=t.f;if((e&pa)===0){gn(t,bn);var n=Gt,r=rl;Gt=t,rl=!0;try{(e&(_a|Yu))!==0?zy(t):ad(t),Kh(t);var a=Jh(t);t.teardown=typeof a=="function"?a:null,t.wv=Xh;var s;au&&oy&&(t.f&Pn)!==0&&t.deps}finally{rl=r,Gt=n}}}async function $h(){await Promise.resolve(),hy()}function o(t){var e=t.f,n=(e&In)!==0;if(Lt!==null&&!Mr){var r=Gt!==null&&(Gt.f&pa)!==0;if(!r&&(pr===null||!Ys.call(pr,t))){var a=Lt.deps;if((Lt.f&iu)!==0)t.rv<$a&&(t.rv=$a,Zn===null&&a!==null&&a[ar]===t?ar++:Zn===null?Zn=[t]:Zn.push(t));else{(Lt.deps??(Lt.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[Lt]:Ys.call(s,Lt)||s.push(Lt)}}}if(La&&Na.has(t))return Na.get(t);if(n){var i=t;if(La){var l=i.v;return((i.f&bn)===0&&i.reactions!==null||tp(i))&&(l=td(i)),Na.set(i,l),l}var d=(i.f&hr)===0&&!Mr&&Lt!==null&&(rl||(Lt.f&hr)!==0),f=(i.f&oo)===0;vo(i)&&(d&&(i.f|=hr),Ch(i)),d&&!f&&(Ih(i),ep(i))}if(Tn!=null&&Tn.has(t))return Tn.get(t);if((t.f&Oa)!==0)throw t.v;return t.v}function ep(t){if(t.f|=hr,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&In)!==0&&(e.f&hr)===0&&(Ih(e),ep(e))}function tp(t){if(t.v===_n)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Na.has(e)||(e.f&In)!==0&&tp(e))return!0;return!1}function Jn(t){var e=Mr;try{return Mr=!0,t()}finally{Mr=e}}function By(t,e){var n={};for(var r in t)e.includes(r)||(n[r]=t[r]);for(var a of Object.getOwnPropertySymbols(t))Object.propertyIsEnumerable.call(t,a)&&!e.includes(a)&&(n[a]=t[a]);return n}function np(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Wr in t)hu(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Wr in n&&hu(n)}}}function hu(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{hu(t[r],e)}catch{}const n=Bl(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=th(n);for(let a in r){const s=r[a].get;if(s)try{s.call(t)}catch{}}}}}function Fy(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const Ky=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Hy(t){return Ky.includes(t)}const Vy={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Uy(t){return t=t.toLowerCase(),Vy[t]??t}const Gy=["touchstart","touchmove"];function Wy(t){return Gy.includes(t)}const rp=new Set,pu=new Set;function id(t,e,n,r={}){function a(s){if(r.capture||mu.call(e,s),!s.cancelBubble)return Kl(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Yr(()=>{e.addEventListener(t,a,r)}):e.addEventListener(t,a,r),a}function gu(t,e,n,r={}){var a=id(e,t,n,r);return()=>{t.removeEventListener(e,a,r)}}function hl(t,e,n,r,a){var s={capture:r,passive:a},i=id(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&rd(()=>{e.removeEventListener(t,i,s)})}function Zt(t){for(var e=0;e<t.length;e++)rp.add(t[e]);for(var n of pu)n(t)}let Pf=null;function mu(t){var A;var e=this,n=e.ownerDocument,r=t.type,a=((A=t.composedPath)==null?void 0:A.call(t))||[],s=a[0]||t.target;Pf=t;var i=0,l=Pf===t&&t.__root;if(l){var d=a.indexOf(l);if(d!==-1&&(e===document||e===window)){t.__root=e;return}var f=a.indexOf(e);if(f===-1)return;d<=f&&(i=d)}if(s=a[i]||t.target,s!==e){Nm(t,"currentTarget",{configurable:!0,get(){return s||n}});var v=Lt,p=Gt;mr(null),Jr(null);try{for(var h,y=[];s!==null;){var x=s.assignedSlot||s.parentNode||s.host||null;try{var S=s["__"+r];S!=null&&(!s.disabled||t.target===s)&&S.call(s,t)}catch(D){h?y.push(D):h=D}if(t.cancelBubble||x===e||x===null)break;s=x}if(h){for(let D of y)queueMicrotask(()=>{throw D});throw h}}finally{t.__root=e,delete t.currentTarget,mr(v),Jr(p)}}}var Jv,$v;const Oc=($v=(Jv=globalThis==null?void 0:globalThis.window)==null?void 0:Jv.trustedTypes)==null?void 0:$v.createPolicy("svelte-trusted-html",{createHTML:t=>t});function Yy(t){return(Oc==null?void 0:Oc.createHTML(t))??t}function od(t,e=!1){var n=My("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?Yy(t):t,n.content}function fs(t,e){var n=Gt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function q(t,e){var n=(e&uh)!==0,r=(e&ry)!==0,a,s=!t.startsWith("<!>");return()=>{a===void 0&&(a=od(s?t:"<!>"+t,!0),n||(a=ir(a)));var i=r||Oh?document.importNode(a,!0):a.cloneNode(!0);if(n){var l=ir(i),d=i.lastChild;fs(l,d)}else fs(i,i);return i}}function Xy(t,e,n="svg"){var r=!t.startsWith("<!>"),a=(e&uh)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,i;return()=>{if(!i){var l=od(s,!0),d=ir(l);if(a)for(i=document.createDocumentFragment();ir(d);)i.appendChild(ir(d));else i=ir(d)}var f=i.cloneNode(!0);if(a){var v=ir(f),p=f.lastChild;fs(v,p)}else fs(f,f);return f}}function mn(t,e){return Xy(t,e,"svg")}function on(t=""){{var e=ma(t+"");return fs(e,e),e}}function sn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=ma();return t.append(e,n),fs(e,n),t}function T(t,e){t!==null&&t.before(e)}function ee(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Zy(t,e){return Qy(t,e)}const Bo=new Map;function Qy(t,{target:e,anchor:n,props:r={},events:a,context:s,intro:i=!0}){Iy();var l=new Set,d=p=>{for(var h=0;h<p.length;h++){var y=p[h];if(!l.has(y)){l.add(y);var x=Wy(y);for(const D of[e,document]){var S=Bo.get(D);S===void 0&&(S=new Map,Bo.set(D,S));var A=S.get(y);A===void 0?(D.addEventListener(y,mu,{passive:x}),S.set(y,1)):S.set(y,A+1)}}}};d(ql(rp)),pu.add(d);var f=void 0,v=Ry(()=>{var p=n??e.appendChild(ma());return my(p,{pending:()=>{}},h=>{at({});var y=tn;s&&(y.c=s),a&&(r.$$events=a),f=t(h,r)||{},st()}),()=>{var S;for(var h of l)for(const A of[e,document]){var y=Bo.get(A),x=y.get(h);--x==0?(A.removeEventListener(h,mu),y.delete(h),y.size===0&&Bo.delete(A)):y.set(h,x)}pu.delete(d),p!==n&&((S=p.parentNode)==null||S.removeChild(p))}});return Jy.set(f,v),f}let Jy=new WeakMap;var Er,Ur,sr,is,eo,to,Rl;class ld{constructor(e,n=!0){ht(this,"anchor");Ie(this,Er,new Map);Ie(this,Ur,new Map);Ie(this,sr,new Map);Ie(this,is,new Set);Ie(this,eo,!0);Ie(this,to,()=>{var e=It;if(F(this,Er).has(e)){var n=F(this,Er).get(e),r=F(this,Ur).get(n);if(r)sd(r),F(this,is).delete(n);else{var a=F(this,sr).get(n);a&&(F(this,Ur).set(n,a.effect),F(this,sr).delete(n),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),r=a.effect)}for(const[s,i]of F(this,Er)){if(F(this,Er).delete(s),s===e)break;const l=F(this,sr).get(i);l&&(wn(l.effect),F(this,sr).delete(i))}for(const[s,i]of F(this,Ur)){if(s===n||F(this,is).has(s))continue;const l=()=>{if(Array.from(F(this,Er).values()).includes(s)){var f=document.createDocumentFragment();Wh(i,f),f.append(ma()),F(this,sr).set(s,{effect:i,fragment:f})}else wn(i);F(this,is).delete(s),F(this,Ur).delete(s)};F(this,eo)||!r?(F(this,is).add(s),os(i,l,!1)):l()}}});Ie(this,Rl,e=>{F(this,Er).delete(e);const n=Array.from(F(this,Er).values());for(const[r,a]of F(this,sr))n.includes(r)||(wn(a.effect),F(this,sr).delete(r))});this.anchor=e,St(this,eo,n)}ensure(e,n){var r=It,a=Rh();if(n&&!F(this,Ur).has(e)&&!F(this,sr).has(e))if(a){var s=document.createDocumentFragment(),i=ma();s.append(i),F(this,sr).set(e,{effect:Qn(()=>n(i)),fragment:s})}else F(this,Ur).set(e,Qn(()=>n(this.anchor)));if(F(this,Er).set(r,e),a){for(const[l,d]of F(this,Ur))l===e?r.unskip_effect(d):r.skip_effect(d);for(const[l,d]of F(this,sr))l===e?r.unskip_effect(d.effect):r.skip_effect(d.effect);r.oncommit(F(this,to)),r.ondiscard(F(this,Rl))}else F(this,to).call(this)}}Er=new WeakMap,Ur=new WeakMap,sr=new WeakMap,is=new WeakMap,eo=new WeakMap,to=new WeakMap,Rl=new WeakMap;function pe(t,e,n=!1){var r=new ld(t),a=n?Ra:0;function s(i,l){r.ensure(i,l)}fo(()=>{var i=!1;e((l,d=0)=>{i=!0,s(d,l)}),i||s(!1,null)},a)}function Yt(t,e){return e}function $y(t,e,n){for(var r=[],a=e.length,s,i=e.length,l=0;l<a;l++){let p=e[l];os(p,()=>{if(s){if(s.pending.delete(p),s.done.add(p),s.pending.size===0){var h=t.outrogroups;yu(ql(s.done)),h.delete(s),h.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var d=r.length===0&&n!==null;if(d){var f=n,v=f.parentNode;Py(v),v.append(f),t.items.clear()}yu(e,!d)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function yu(t,e=!0){for(var n=0;n<t.length;n++)wn(t[n],e)}var Mf;function Nt(t,e,n,r,a,s=null){var i=t,l=new Map,d=(e&ch)!==0;if(d){var f=t;i=f.appendChild(ma())}var v=null,p=ed(()=>{var D=n();return jl(D)?D:D==null?[]:ql(D)}),h,y=!0;function x(){A.fallback=v,e_(A,h,i,e,r),v!==null&&(h.length===0?(v.f&da)===0?sd(v):(v.f^=da,Pi(v,null,i)):os(v,()=>{v=null}))}var S=fo(()=>{h=o(p);for(var D=h.length,L=new Set,W=It,k=Rh(),H=0;H<D;H+=1){var B=h[H],O=r(B,H),J=y?null:l.get(O);J?(J.v&&Qs(J.v,B),J.i&&Qs(J.i,H),k&&W.unskip_effect(J.e)):(J=t_(l,y?i:Mf??(Mf=ma()),B,O,H,a,e,n),y||(J.e.f|=da),l.set(O,J)),L.add(O)}if(D===0&&s&&!v&&(y?v=Qn(()=>s(i)):(v=Qn(()=>s(Mf??(Mf=ma()))),v.f|=da)),D>L.size&&jm(),!y)if(k){for(const[le,ke]of l)L.has(le)||W.skip_effect(ke.e);W.oncommit(x),W.ondiscard(()=>{})}else x();o(p)}),A={effect:S,items:l,outrogroups:null,fallback:v};y=!1}function bi(t){for(;t!==null&&(t.f&Rr)===0;)t=t.next;return t}function e_(t,e,n,r,a){var ke,j,M,z,C,N,I,$,Y;var s=(r&Zm)!==0,i=e.length,l=t.items,d=bi(t.effect.first),f,v=null,p,h=[],y=[],x,S,A,D;if(s)for(D=0;D<i;D+=1)x=e[D],S=a(x,D),A=l.get(S).e,(A.f&da)===0&&((j=(ke=A.nodes)==null?void 0:ke.a)==null||j.measure(),(p??(p=new Set)).add(A));for(D=0;D<i;D+=1){if(x=e[D],S=a(x,D),A=l.get(S).e,t.outrogroups!==null)for(const X of t.outrogroups)X.pending.delete(A),X.done.delete(A);if((A.f&da)!==0)if(A.f^=da,A===d)Pi(A,null,n);else{var L=v?v.next:d;A===t.effect.last&&(t.effect.last=A.prev),A.prev&&(A.prev.next=A.next),A.next&&(A.next.prev=A.prev),Sa(t,v,A),Sa(t,A,L),Pi(A,L,n),v=A,h=[],y=[],d=bi(v.next);continue}if((A.f&or)!==0&&(sd(A),s&&((z=(M=A.nodes)==null?void 0:M.a)==null||z.unfix(),(p??(p=new Set)).delete(A))),A!==d){if(f!==void 0&&f.has(A)){if(h.length<y.length){var W=y[0],k;v=W.prev;var H=h[0],B=h[h.length-1];for(k=0;k<h.length;k+=1)Pi(h[k],W,n);for(k=0;k<y.length;k+=1)f.delete(y[k]);Sa(t,H.prev,B.next),Sa(t,v,H),Sa(t,B,W),d=W,v=B,D-=1,h=[],y=[]}else f.delete(A),Pi(A,d,n),Sa(t,A.prev,A.next),Sa(t,A,v===null?t.effect.first:v.next),Sa(t,v,A),v=A;continue}for(h=[],y=[];d!==null&&d!==A;)(f??(f=new Set)).add(d),y.push(d),d=bi(d.next);if(d===null)continue}(A.f&da)===0&&h.push(A),v=A,d=bi(A.next)}if(t.outrogroups!==null){for(const X of t.outrogroups)X.pending.size===0&&(yu(ql(X.done)),(C=t.outrogroups)==null||C.delete(X));t.outrogroups.size===0&&(t.outrogroups=null)}if(d!==null||f!==void 0){var O=[];if(f!==void 0)for(A of f)(A.f&or)===0&&O.push(A);for(;d!==null;)(d.f&or)===0&&d!==t.fallback&&O.push(d),d=bi(d.next);var J=O.length;if(J>0){var le=(r&ch)!==0&&i===0?n:null;if(s){for(D=0;D<J;D+=1)(I=(N=O[D].nodes)==null?void 0:N.a)==null||I.measure();for(D=0;D<J;D+=1)(Y=($=O[D].nodes)==null?void 0:$.a)==null||Y.fix()}$y(t,O,le)}}s&&Yr(()=>{var X,V;if(p!==void 0)for(A of p)(V=(X=A.nodes)==null?void 0:X.a)==null||V.apply()})}function t_(t,e,n,r,a,s,i,l){var d=(i&Ym)!==0?(i&Qm)===0?Ay(n,!1,!1):ds(n):null,f=(i&Xm)!==0?ds(a):null;return{v:d,i:f,e:Qn(()=>(s(e,d??n,f??a,l),()=>{t.delete(r)}))}}function Pi(t,e,n){if(t.nodes)for(var r=t.nodes.start,a=t.nodes.end,s=e&&(e.f&da)===0?e.nodes.start:n;r!==null;){var i=uo(r);if(s.before(r),r===a)return;r=i}}function Sa(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function n_(t,e,n=!1,r=!1,a=!1){var s=t,i="";ie(()=>{var l=Gt;if(i!==(i=e()??"")&&(l.nodes!==null&&(Hh(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var d=i+"";n?d=`<svg>${d}</svg>`:r&&(d=`<math>${d}</math>`);var f=od(d);if((n||r)&&(f=ir(f)),fs(ir(f),f.lastChild),n||r)for(;ir(f);)s.before(ir(f));else s.before(f)}})}function gr(t,e,...n){var r=new ld(t);fo(()=>{const a=e()??null;r.ensure(a,a&&(s=>a(s,...n)))},Ra)}function cd(t,e,n){var r=new ld(t);fo(()=>{var a=e()??null;r.ensure(a,a&&(s=>n(s,a)))},Ra)}function Wn(t,e,n){ii(()=>{var r=Jn(()=>e(t,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var a=!1,s={};Hl(()=>{var i=n();np(i),a&&vh(s,i)&&(s=i,r.update(i))}),a=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function r_(t,e){var n=void 0,r;Fh(()=>{n!==(n=e())&&(r&&(wn(r),r=null),n&&(r=Qn(()=>{ii(()=>n(t))})))})}function ap(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=ap(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function a_(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=ap(t))&&(r&&(r+=" "),r+=e);return r}function ws(t){return typeof t=="object"?a_(t):t??""}const Of=[...` 	
\r\fÂ \v\uFEFF`];function s_(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var a in n)if(n[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,i=0;(i=r.indexOf(a,i))>=0;){var l=i+s;(i===0||Of.includes(r[i-1]))&&(l===r.length||Of.includes(r[l]))?r=(i===0?"":r.substring(0,i))+r.substring(l+1):i=l}}return r===""?null:r}function Nf(t,e=!1){var n=e?" !important;":";",r="";for(var a in t){var s=t[a];s!=null&&s!==""&&(r+=" "+a+": "+s+n)}return r}function Nc(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function i_(t,e){if(e){var n="",r,a;if(Array.isArray(e)?(r=e[0],a=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,i=0,l=!1,d=[];r&&d.push(...Object.keys(r).map(Nc)),a&&d.push(...Object.keys(a).map(Nc));var f=0,v=-1;const S=t.length;for(var p=0;p<S;p++){var h=t[p];if(l?h==="/"&&t[p-1]==="*"&&(l=!1):s?s===h&&(s=!1):h==="/"&&t[p+1]==="*"?l=!0:h==='"'||h==="'"?s=h:h==="("?i++:h===")"&&i--,!l&&s===!1&&i===0){if(h===":"&&v===-1)v=p;else if(h===";"||p===S-1){if(v!==-1){var y=Nc(t.substring(f,v).trim());if(!d.includes(y)){h!==";"&&p++;var x=t.substring(f,p).trim();n+=" "+x+";"}}f=p+1,v=-1}}}}return r&&(n+=Nf(r)),a&&(n+=Nf(a,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Tt(t,e,n,r,a,s){var i=t.__className;if(i!==n||i===void 0){var l=s_(n,r,s);l==null?t.removeAttribute("class"):e?t.className=l:t.setAttribute("class",l),t.__className=n}else if(s&&a!==s)for(var d in s){var f=!!s[d];(a==null||f!==!!a[d])&&t.classList.toggle(d,f)}return s}function Dc(t,e={},n,r){for(var a in n){var s=n[a];e[a]!==s&&(n[a]==null?t.style.removeProperty(a):t.style.setProperty(a,s,r))}}function Dt(t,e,n,r){var a=t.__style;if(a!==e){var s=i_(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Dc(t,n==null?void 0:n[0],r[0]),Dc(t,n==null?void 0:n[1],r[1],"important")):Dc(t,n,r));return r}function pl(t,e,n=!1){if(t.multiple){if(e==null)return;if(!jl(e))return sy();for(var r of t.options)r.selected=e.includes(Li(r));return}for(r of t.options){var a=Li(r);if(Cy(a,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function sp(t){var e=new MutationObserver(()=>{pl(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),rd(()=>{e.disconnect()})}function ho(t,e,n=e){var r=new WeakSet,a=!0;Lh(t,"change",s=>{var i=s?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(i),Li);else{var d=t.querySelector(i)??t.querySelector("option:not([disabled])");l=d&&Li(d)}n(l),It!==null&&r.add(It)}),ii(()=>{var s=e();if(t===document.activeElement){var i=vl??It;if(r.has(i))return}if(pl(t,s,a),a&&s===void 0){var l=t.querySelector(":checked");l!==null&&(s=Li(l),n(s))}t.__value=s,a=!1}),sp(t)}function Li(t){return"__value"in t?t.__value:t.value}const Aa=Symbol("class"),ca=Symbol("style"),ip=Symbol("is custom element"),op=Symbol("is html"),o_=lh?"option":"OPTION",l_=lh?"select":"SELECT";function c_(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function xt(t,e,n,r){var a=lp(t);a[e]!==(a[e]=n)&&(e==="loading"&&(t[Lm]=n),n==null?t.removeAttribute(e):typeof n!="string"&&cp(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function u_(t,e,n,r,a=!1,s=!1){var i=lp(t),l=i[ip],d=!i[op],f=e||{},v=t.nodeName===o_;for(var p in e)p in n||(n[p]=null);n.class?n.class=ws(n.class):(r||n[Aa])&&(n.class=null),n[ca]&&(n.style??(n.style=null));var h=cp(t);for(const W in n){let k=n[W];if(v&&W==="value"&&k==null){t.value=t.__value="",f[W]=k;continue}if(W==="class"){var y=t.namespaceURI==="http://www.w3.org/1999/xhtml";Tt(t,y,k,r,e==null?void 0:e[Aa],n[Aa]),f[W]=k,f[Aa]=n[Aa];continue}if(W==="style"){Dt(t,k,e==null?void 0:e[ca],n[ca]),f[W]=k,f[ca]=n[ca];continue}var x=f[W];if(!(k===x&&!(k===void 0&&t.hasAttribute(W)))){f[W]=k;var S=W[0]+W[1];if(S!=="$$")if(S==="on"){const H={},B="$$"+W;let O=W.slice(2);var A=Hy(O);if(Fy(O)&&(O=O.slice(0,-7),H.capture=!0),!A&&x){if(k!=null)continue;t.removeEventListener(O,f[B],H),f[B]=null}if(k!=null)if(A)t[`__${O}`]=k,Zt([O]);else{let J=function(le){f[W].call(this,le)};f[B]=id(O,t,J,H)}else A&&(t[`__${O}`]=void 0)}else if(W==="style")xt(t,W,k);else if(W==="autofocus")Oy(t,!!k);else if(!l&&(W==="__value"||W==="value"&&k!=null))t.value=t.__value=k;else if(W==="selected"&&v)c_(t,k);else{var D=W;d||(D=Uy(D));var L=D==="defaultValue"||D==="defaultChecked";if(k==null&&!l&&!L)if(i[W]=null,D==="value"||D==="checked"){let H=t;const B=e===void 0;if(D==="value"){let O=H.defaultValue;H.removeAttribute(D),H.defaultValue=O,H.value=H.__value=B?O:null}else{let O=H.defaultChecked;H.removeAttribute(D),H.defaultChecked=O,H.checked=B?O:!1}}else t.removeAttribute(W);else L||h.includes(D)&&(l||typeof k!="string")?(t[D]=k,D in i&&(i[D]=_n)):typeof k!="function"&&xt(t,D,k)}}}return f}function Ba(t,e,n=[],r=[],a=[],s,i=!1,l=!1){Th(a,n,r,d=>{var f=void 0,v={},p=t.nodeName===l_,h=!1;if(Fh(()=>{var x=e(...d.map(o)),S=u_(t,f,x,s,i,l);h&&p&&"value"in x&&pl(t,x.value);for(let D of Object.getOwnPropertySymbols(v))x[D]||wn(v[D]);for(let D of Object.getOwnPropertySymbols(x)){var A=x[D];D.description===ay&&(!f||A!==f[D])&&(v[D]&&wn(v[D]),v[D]=Qn(()=>r_(t,()=>A))),S[D]=A}f=S}),p){var y=t;ii(()=>{pl(y,f.value,!0),sp(y)})}h=!0})}function lp(t){return t.__attributes??(t.__attributes={[ip]:t.nodeName.includes("-"),[op]:t.namespaceURI===dh})}var Df=new Map;function cp(t){var e=t.getAttribute("is")||t.nodeName,n=Df.get(e);if(n)return n;Df.set(e,n=[]);for(var r,a=t,s=Element.prototype;s!==a;){r=th(a);for(var i in r)r[i].set&&n.push(i);a=Bl(a)}return n}function fa(t,e,n=e){var r=new WeakSet;Lh(t,"input",async a=>{var s=a?t.defaultValue:t.value;if(s=Rc(t)?Lc(s):s,n(s),It!==null&&r.add(It),await $h(),s!==(s=e())){var i=t.selectionStart,l=t.selectionEnd,d=t.value.length;if(t.value=s??"",l!==null){var f=t.value.length;i===l&&l===d&&f>d?(t.selectionStart=f,t.selectionEnd=f):(t.selectionStart=i,t.selectionEnd=Math.min(l,f))}}}),Jn(e)==null&&t.value&&(n(Rc(t)?Lc(t.value):t.value),It!==null&&r.add(It)),Hl(()=>{var a=e();if(t===document.activeElement){var s=vl??It;if(r.has(s))return}Rc(t)&&a===Lc(t.value)||t.type==="date"&&!a&&!t.value||a!==t.value&&(t.value=a??"")})}function Rc(t){var e=t.type;return e==="number"||e==="range"}function Lc(t){return t===""?null:+t}var Pa,Ws,no,Ll,up;const zl=class zl{constructor(e){Ie(this,Ll);Ie(this,Pa,new WeakMap);Ie(this,Ws);Ie(this,no);St(this,no,e)}observe(e,n){var r=F(this,Pa).get(e)||new Set;return r.add(n),F(this,Pa).set(e,r),An(this,Ll,up).call(this).observe(e,F(this,no)),()=>{var a=F(this,Pa).get(e);a.delete(n),a.size===0&&(F(this,Pa).delete(e),F(this,Ws).unobserve(e))}}};Pa=new WeakMap,Ws=new WeakMap,no=new WeakMap,Ll=new WeakSet,up=function(){return F(this,Ws)??St(this,Ws,new ResizeObserver(e=>{for(var n of e){zl.entries.set(n.target,n);for(var r of F(this,Pa).get(n.target)||[])r(n)}}))},ht(zl,"entries",new WeakMap);let _u=zl;var d_=new _u({box:"border-box"});function Rf(t,e,n){var r=d_.observe(t,()=>n(t[e]));ii(()=>(Jn(()=>n(t[e])),r))}function Lf(t,e){return t===e||(t==null?void 0:t[Wr])===e}function xs(t={},e,n,r){return ii(()=>{var a,s;return Hl(()=>{a=s,s=[],Jn(()=>{t!==n(...s)&&(e(t,...s),a&&Lf(n(...a),t)&&e(null,...a))})}),()=>{Yr(()=>{s&&Lf(n(...s),t)&&e(null,...s)})}}),t}function f_(t=!1){const e=tn,n=e.l.u;if(!n)return;let r=()=>np(e.s);if(t){let a=0,s={};const i=co(()=>{let l=!1;const d=e.s;for(const f in d)d[f]!==s[f]&&(s[f]=d[f],l=!0);return l&&a++,a});r=()=>o(i)}n.b.length&&qh(()=>{zf(e,r),su(n.b)}),kn(()=>{const a=Jn(()=>n.m.map(Rm));return()=>{for(const s of a)typeof s=="function"&&s()}}),n.a.length&&kn(()=>{zf(e,r),su(n.a)})}function zf(t,e){if(t.l.s)for(const n of t.l.s)o(n);e()}let Fo=!1;function v_(t){var e=Fo;try{return Fo=!1,[t(),Fo]}finally{Fo=e}}const h_={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function ks(t,e,n){return new Proxy({props:t,exclude:e},h_)}const p_={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(_i(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let a=t.props[r];_i(a)&&(a=a());const s=Ma(a,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(_i(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const a=Ma(r,e);return a&&!a.configurable&&(a.configurable=!0),a}}},has(t,e){if(e===Wr||e===oh)return!1;for(let n of t.props)if(_i(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(_i(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function Ds(...t){return new Proxy({props:t},p_)}function Ee(t,e,n,r){var W;var a=!si||(n&$m)!==0,s=(n&ty)!==0,i=(n&ny)!==0,l=r,d=!0,f=()=>(d&&(d=!1,l=i?Jn(r):r),l),v;if(s){var p=Wr in t||oh in t;v=((W=Ma(t,e))==null?void 0:W.set)??(p&&e in t?k=>t[e]=k:void 0)}var h,y=!1;s?[h,y]=v_(()=>t[e]):h=t[e],h===void 0&&r!==void 0&&(h=f(),v&&(a&&Hm(),v(h)));var x;if(a?x=()=>{var k=t[e];return k===void 0?f():(d=!0,k)}:x=()=>{var k=t[e];return k!==void 0&&(l=void 0),k===void 0?l:k},a&&(n&ey)===0)return x;if(v){var S=t.$$legacy;return(function(k,H){return arguments.length>0?((!a||!H||S||y)&&v(H?x():k),k):x()})}var A=!1,D=((n&Jm)!==0?co:ed)(()=>(A=!1,x()));s&&o(D);var L=Gt;return(function(k,H){if(arguments.length>0){const B=H?o(D):a&&s?Xt(k):k;return P(D,B),A=!0,l!==void 0&&(l=B),k}return La&&A||(L.f&pa)!==0?D.v:o(D)})}function Sn(t){tn===null&&Zu(),si&&tn.l!==null?g_(tn).m.push(t):kn(()=>{const e=Jn(t);if(typeof e=="function")return e})}function ud(t){tn===null&&Zu(),Sn(()=>()=>Jn(t))}function g_(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const m_="5";var eh;typeof window<"u"&&((eh=window.__svelte??(window.__svelte={})).v??(eh.v=new Set)).add(m_);var y_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function __(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var al={exports:{}},b_=al.exports,jf;function w_(){return jf||(jf=1,(function(t,e){((n,r)=>{t.exports=r()})(b_,function(){var n=function(c,u){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(g,m){g.__proto__=m}:function(g,m){for(var w in m)Object.prototype.hasOwnProperty.call(m,w)&&(g[w]=m[w])}))(c,u)},r=function(){return(r=Object.assign||function(c){for(var u,g=1,m=arguments.length;g<m;g++)for(var w in u=arguments[g])Object.prototype.hasOwnProperty.call(u,w)&&(c[w]=u[w]);return c}).apply(this,arguments)};function a(c,u,g){for(var m,w=0,E=u.length;w<E;w++)!m&&w in u||((m=m||Array.prototype.slice.call(u,0,w))[w]=u[w]);return c.concat(m||Array.prototype.slice.call(u))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:y_,i=Object.keys,l=Array.isArray;function d(c,u){return typeof u=="object"&&i(u).forEach(function(g){c[g]=u[g]}),c}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var f=Object.getPrototypeOf,v={}.hasOwnProperty;function p(c,u){return v.call(c,u)}function h(c,u){typeof u=="function"&&(u=u(f(c))),(typeof Reflect>"u"?i:Reflect.ownKeys)(u).forEach(function(g){x(c,g,u[g])})}var y=Object.defineProperty;function x(c,u,g,m){y(c,u,d(g&&p(g,"get")&&typeof g.get=="function"?{get:g.get,set:g.set,configurable:!0}:{value:g,configurable:!0,writable:!0},m))}function S(c){return{from:function(u){return c.prototype=Object.create(u.prototype),x(c.prototype,"constructor",c),{extend:h.bind(null,c.prototype)}}}}var A=Object.getOwnPropertyDescriptor,D=[].slice;function L(c,u,g){return D.call(c,u,g)}function W(c,u){return u(c)}function k(c){if(!c)throw new Error("Assertion Failed")}function H(c){s.setImmediate?setImmediate(c):setTimeout(c,0)}function B(c,u){if(typeof u=="string"&&p(c,u))return c[u];if(!u)return c;if(typeof u!="string"){for(var g=[],m=0,w=u.length;m<w;++m){var E=B(c,u[m]);g.push(E)}return g}var R,U=u.indexOf(".");return U===-1||(R=c[u.substr(0,U)])==null?void 0:B(R,u.substr(U+1))}function O(c,u,g){if(c&&u!==void 0&&!("isFrozen"in Object&&Object.isFrozen(c)))if(typeof u!="string"&&"length"in u){k(typeof g!="string"&&"length"in g);for(var m=0,w=u.length;m<w;++m)O(c,u[m],g[m])}else{var E,R,U=u.indexOf(".");U!==-1?(E=u.substr(0,U),(U=u.substr(U+1))===""?g===void 0?l(c)&&!isNaN(parseInt(E))?c.splice(E,1):delete c[E]:c[E]=g:O(R=(R=c[E])&&p(c,E)?R:c[E]={},U,g)):g===void 0?l(c)&&!isNaN(parseInt(u))?c.splice(u,1):delete c[u]:c[u]=g}}function J(c){var u,g={};for(u in c)p(c,u)&&(g[u]=c[u]);return g}var le=[].concat;function ke(c){return le.apply([],c)}var re="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(c){return["Int","Uint","Float"].map(function(u){return u+c+"Array"})}))).filter(function(c){return s[c]}),j=new Set(re.map(function(c){return s[c]})),M=null;function z(c){return M=new WeakMap,c=(function u(g){if(!g||typeof g!="object")return g;var m=M.get(g);if(m)return m;if(l(g)){m=[],M.set(g,m);for(var w=0,E=g.length;w<E;++w)m.push(u(g[w]))}else if(j.has(g.constructor))m=g;else{var R,U=f(g);for(R in m=U===Object.prototype?{}:Object.create(U),M.set(g,m),g)p(g,R)&&(m[R]=u(g[R]))}return m})(c),M=null,c}var C={}.toString;function N(c){return C.call(c).slice(8,-1)}var I=typeof Symbol<"u"?Symbol.iterator:"@@iterator",$=typeof I=="symbol"?function(c){var u;return c!=null&&(u=c[I])&&u.apply(c)}:function(){return null};function Y(c,u){u=c.indexOf(u),0<=u&&c.splice(u,1)}var X={};function V(c){var u,g,m,w;if(arguments.length===1){if(l(c))return c.slice();if(this===X&&typeof c=="string")return[c];if(w=$(c))for(g=[];!(m=w.next()).done;)g.push(m.value);else{if(c==null)return[c];if(typeof(u=c.length)!="number")return[c];for(g=new Array(u);u--;)g[u]=c[u]}}else for(u=arguments.length,g=new Array(u);u--;)g[u]=arguments[u];return g}var te=typeof Symbol<"u"?function(c){return c[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},re=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],tt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(re),G={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function K(c,u){this.name=c,this.message=u}function ae(c,u){return c+". Errors: "+Object.keys(u).map(function(g){return u[g].toString()}).filter(function(g,m,w){return w.indexOf(g)===m}).join(`
`)}function Z(c,u,g,m){this.failures=u,this.failedKeys=m,this.successCount=g,this.message=ae(c,u)}function ne(c,u){this.name="BulkError",this.failures=Object.keys(u).map(function(g){return u[g]}),this.failuresByPos=u,this.message=ae(c,this.failures)}S(K).from(Error).extend({toString:function(){return this.name+": "+this.message}}),S(Z).from(K),S(ne).from(K);var he=tt.reduce(function(c,u){return c[u]=u+"Error",c},{}),_e=K,se=tt.reduce(function(c,u){var g=u+"Error";function m(w,E){this.name=g,w?typeof w=="string"?(this.message="".concat(w).concat(E?`
 `+E:""),this.inner=E||null):typeof w=="object"&&(this.message="".concat(w.name," ").concat(w.message),this.inner=w):(this.message=G[u]||g,this.inner=null)}return S(m).from(_e),c[u]=m,c},{}),Te=(se.Syntax=SyntaxError,se.Type=TypeError,se.Range=RangeError,re.reduce(function(c,u){return c[u+"Error"]=se[u],c},{}));re=tt.reduce(function(c,u){return["Syntax","Type","Range"].indexOf(u)===-1&&(c[u+"Error"]=se[u]),c},{});function be(){}function Me(c){return c}function Ve(c,u){return c==null||c===Me?u:function(g){return u(c(g))}}function Je(c,u){return function(){c.apply(this,arguments),u.apply(this,arguments)}}function ut(c,u){return c===be?u:function(){var g=c.apply(this,arguments),m=(g!==void 0&&(arguments[0]=g),this.onsuccess),w=this.onerror,E=(this.onsuccess=null,this.onerror=null,u.apply(this,arguments));return m&&(this.onsuccess=this.onsuccess?Je(m,this.onsuccess):m),w&&(this.onerror=this.onerror?Je(w,this.onerror):w),E!==void 0?E:g}}function Fe(c,u){return c===be?u:function(){c.apply(this,arguments);var g=this.onsuccess,m=this.onerror;this.onsuccess=this.onerror=null,u.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?Je(g,this.onsuccess):g),m&&(this.onerror=this.onerror?Je(m,this.onerror):m)}}function Oe(c,u){return c===be?u:function(w){var m=c.apply(this,arguments),w=(d(w,m),this.onsuccess),E=this.onerror,R=(this.onsuccess=null,this.onerror=null,u.apply(this,arguments));return w&&(this.onsuccess=this.onsuccess?Je(w,this.onsuccess):w),E&&(this.onerror=this.onerror?Je(E,this.onerror):E),m===void 0?R===void 0?void 0:R:d(m,R)}}function je(c,u){return c===be?u:function(){return u.apply(this,arguments)!==!1&&c.apply(this,arguments)}}function Ne(c,u){return c===be?u:function(){var g=c.apply(this,arguments);if(g&&typeof g.then=="function"){for(var m=this,w=arguments.length,E=new Array(w);w--;)E[w]=arguments[w];return g.then(function(){return u.apply(m,E)})}return u.apply(this,arguments)}}re.ModifyError=Z,re.DexieError=K,re.BulkError=ne;var Be=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ke(c){Be=c}var $e={},Ze=100,Ue=typeof Promise>"u"?[]:(tt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Ue=crypto.subtle.digest("SHA-512",new Uint8Array([0])),f(Ue),tt]:[tt,f(tt),tt]),tt=Ue[0],Ps=Ue[1],Ps=Ps&&Ps.then,nt=tt&&tt.constructor,ft=!!Ue[2],mt=function(c,u){Rt.push([c,u]),kt&&(queueMicrotask(Mn),kt=!1)},vt=!0,kt=!0,bt=[],pt=[],yt=Me,dt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:be,pgp:!1,env:{},finalize:be},Le=dt,Rt=[],Et=0,Vt=[];function De(c){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var u=this._PSD=Le;if(typeof c!="function"){if(c!==$e)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&ye(this,this._value)}else this._state=null,this._value=null,++u.ref,(function g(m,w){try{w(function(E){if(m._state===null){if(E===m)throw new TypeError("A promise cannot be resolved with itself.");var R=m._lib&&it();E&&typeof E.then=="function"?g(m,function(U,de){E instanceof De?E._then(U,de):E.then(U,de)}):(m._state=!0,m._value=E,ln(m)),R&&ct()}},ye.bind(null,m))}catch(E){ye(m,E)}})(this,c)}var Qt={get:function(){var c=Le,u=en;function g(m,w){var E=this,R=!c.global&&(c!==Le||u!==en),U=R&&!br(),de=new De(function(xe,fe){En(E,new Kn(ce(m,c,R,U),ce(w,c,R,U),xe,fe,c))});return this._consoleTask&&(de._consoleTask=this._consoleTask),de}return g.prototype=$e,g},set:function(c){x(this,"then",c&&c.prototype===$e?Qt:{get:function(){return c},set:Qt.set})}};function Kn(c,u,g,m,w){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof u=="function"?u:null,this.resolve=g,this.reject=m,this.psd=w}function ye(c,u){var g,m;pt.push(u),c._state===null&&(g=c._lib&&it(),u=yt(u),c._state=!1,c._value=u,m=c,bt.some(function(w){return w._value===m._value})||bt.push(m),ln(c),g)&&ct()}function ln(c){var u=c._listeners;c._listeners=[];for(var g=0,m=u.length;g<m;++g)En(c,u[g]);var w=c._PSD;--w.ref||w.finalize(),Et===0&&(++Et,mt(function(){--Et==0&&Pt()},[]))}function En(c,u){if(c._state===null)c._listeners.push(u);else{var g=c._state?u.onFulfilled:u.onRejected;if(g===null)return(c._state?u.resolve:u.reject)(c._value);++u.psd.ref,++Et,mt(At,[g,c,u])}}function At(c,u,g){try{var m,w=u._value;!u._state&&pt.length&&(pt=[]),m=Be&&u._consoleTask?u._consoleTask.run(function(){return c(w)}):c(w),u._state||pt.indexOf(w)!==-1||(E=>{for(var R=bt.length;R;)if(bt[--R]._value===E._value)return bt.splice(R,1)})(u),g.resolve(m)}catch(E){g.reject(E)}finally{--Et==0&&Pt(),--g.psd.ref||g.psd.finalize()}}function Mn(){ot(dt,function(){it()&&ct()})}function it(){var c=vt;return kt=vt=!1,c}function ct(){var c,u,g;do for(;0<Rt.length;)for(c=Rt,Rt=[],g=c.length,u=0;u<g;++u){var m=c[u];m[0].apply(null,m[1])}while(0<Rt.length);kt=vt=!0}function Pt(){for(var c=bt,u=(bt=[],c.forEach(function(m){m._PSD.onunhandled.call(null,m._value,m)}),Vt.slice(0)),g=u.length;g;)u[--g]()}function $t(c){return new De($e,!1,c)}function _t(c,u){var g=Le;return function(){var m=it(),w=Le;try{return wr(g,!0),c.apply(this,arguments)}catch(E){u&&u(E)}finally{wr(w,!1),m&&ct()}}}h(De.prototype,{then:Qt,_then:function(c,u){En(this,new Kn(null,null,c,u,Le))},catch:function(c){var u,g;return arguments.length===1?this.then(null,c):(u=c,g=arguments[1],typeof u=="function"?this.then(null,function(m){return(m instanceof u?g:$t)(m)}):this.then(null,function(m){return(m&&m.name===u?g:$t)(m)}))},finally:function(c){return this.then(function(u){return De.resolve(c()).then(function(){return u})},function(u){return De.resolve(c()).then(function(){return $t(u)})})},timeout:function(c,u){var g=this;return c<1/0?new De(function(m,w){var E=setTimeout(function(){return w(new se.Timeout(u))},c);g.then(m,w).finally(clearTimeout.bind(null,E))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&x(De.prototype,Symbol.toStringTag,"Dexie.Promise"),dt.env=ko(),h(De,{all:function(){var c=V.apply(null,arguments).map(Fa);return new De(function(u,g){c.length===0&&u([]);var m=c.length;c.forEach(function(w,E){return De.resolve(w).then(function(R){c[E]=R,--m||u(c)},g)})})},resolve:function(c){return c instanceof De?c:c&&typeof c.then=="function"?new De(function(u,g){c.then(u,g)}):new De($e,!0,c)},reject:$t,race:function(){var c=V.apply(null,arguments).map(Fa);return new De(function(u,g){c.map(function(m){return De.resolve(m).then(u,g)})})},PSD:{get:function(){return Le},set:function(c){return Le=c}},totalEchoes:{get:function(){return en}},newPSD:On,usePSD:ot,scheduler:{get:function(){return mt},set:function(c){mt=c}},rejectionMapper:{get:function(){return yt},set:function(c){yt=c}},follow:function(c,u){return new De(function(g,m){return On(function(w,E){var R=Le;R.unhandleds=[],R.onunhandled=E,R.finalize=Je(function(){var U,de=this;U=function(){de.unhandleds.length===0?w():E(de.unhandleds[0])},Vt.push(function xe(){U(),Vt.splice(Vt.indexOf(xe),1)}),++Et,mt(function(){--Et==0&&Pt()},[])},R.finalize),c()},u,g,m)})}}),nt&&(nt.allSettled&&x(De,"allSettled",function(){var c=V.apply(null,arguments).map(Fa);return new De(function(u){c.length===0&&u([]);var g=c.length,m=new Array(g);c.forEach(function(w,E){return De.resolve(w).then(function(R){return m[E]={status:"fulfilled",value:R}},function(R){return m[E]={status:"rejected",reason:R}}).then(function(){return--g||u(m)})})})}),nt.any&&typeof AggregateError<"u"&&x(De,"any",function(){var c=V.apply(null,arguments).map(Fa);return new De(function(u,g){c.length===0&&g(new AggregateError([]));var m=c.length,w=new Array(m);c.forEach(function(E,R){return De.resolve(E).then(function(U){return u(U)},function(U){w[R]=U,--m||g(new AggregateError(w))})})})}),nt.withResolvers)&&(De.withResolvers=nt.withResolvers);var zt={awaits:0,echoes:0,id:0},fn=0,cn=[],Jt=0,en=0,Ln=0;function On(c,R,g,m){var w=Le,E=Object.create(w),R=(E.parent=w,E.ref=0,E.global=!1,E.id=++Ln,dt.env,E.env=ft?{Promise:De,PromiseProp:{value:De,configurable:!0,writable:!0},all:De.all,race:De.race,allSettled:De.allSettled,any:De.any,resolve:De.resolve,reject:De.reject}:{},R&&d(E,R),++w.ref,E.finalize=function(){--this.parent.ref||this.parent.finalize()},ot(E,c,g,m));return E.ref===0&&E.finalize(),R}function Nn(){return zt.id||(zt.id=++fn),++zt.awaits,zt.echoes+=Ze,zt.id}function br(){return!!zt.awaits&&(--zt.awaits==0&&(zt.id=0),zt.echoes=zt.awaits*Ze,!0)}function Fa(c){return zt.echoes&&c&&c.constructor===nt?(Nn(),c.then(function(u){return br(),u},function(u){return br(),Ge(u)})):c}function xo(){var c=cn[cn.length-1];cn.pop(),wr(c,!1)}function wr(c,u){var g,m,w=Le;(u?!zt.echoes||Jt++&&c===Le:!Jt||--Jt&&c===Le)||queueMicrotask(u?(function(E){++en,zt.echoes&&--zt.echoes!=0||(zt.echoes=zt.awaits=zt.id=0),cn.push(Le),wr(E,!0)}).bind(null,c):xo),c!==Le&&(Le=c,w===dt&&(dt.env=ko()),ft)&&(g=dt.env.Promise,m=c.env,w.global||c.global)&&(Object.defineProperty(s,"Promise",m.PromiseProp),g.all=m.all,g.race=m.race,g.resolve=m.resolve,g.reject=m.reject,m.allSettled&&(g.allSettled=m.allSettled),m.any)&&(g.any=m.any)}function ko(){var c=s.Promise;return ft?{Promise:c,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:c.all,race:c.race,allSettled:c.allSettled,any:c.any,resolve:c.resolve,reject:c.reject}:{}}function ot(c,u,g,m,w){var E=Le;try{return wr(c,!0),u(g,m,w)}finally{wr(E,!1)}}function ce(c,u,g,m){return typeof c!="function"?c:function(){var w=Le;g&&Nn(),wr(u,!0);try{return c.apply(this,arguments)}finally{wr(w,!1),m&&queueMicrotask(br)}}}function qe(c){Promise===nt&&zt.echoes===0?Jt===0?c():enqueueNativeMicroTask(c):setTimeout(c,0)}(""+Ps).indexOf("[native code]")===-1&&(Nn=br=be);var Ge=De.reject,Ft="ï¿¿",nn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",un="String expected.",hn=[],Hn="__dbnames",zr="readonly",Ka="readwrite";function an(c,u){return c?u?function(){return c.apply(this,arguments)&&u.apply(this,arguments)}:c:u}var ci={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ha(c){return typeof c!="string"||/\./.test(c)?function(u){return u}:function(u){return u[c]===void 0&&c in u&&delete(u=z(u))[c],u}}function Yd(){throw se.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function jt(c,u){try{var g=Xd(c),m=Xd(u);if(g!==m)return g==="Array"?1:m==="Array"?-1:g==="binary"?1:m==="binary"?-1:g==="string"?1:m==="string"?-1:g==="Date"?1:m!=="Date"?NaN:-1;switch(g){case"number":case"Date":case"string":return u<c?1:c<u?-1:0;case"binary":for(var w=Zd(c),E=Zd(u),R=w.length,U=E.length,de=R<U?R:U,xe=0;xe<de;++xe)if(w[xe]!==E[xe])return w[xe]<E[xe]?-1:1;return R===U?0:R<U?-1:1;case"Array":for(var fe=c,oe=u,ge=fe.length,me=oe.length,ve=ge<me?ge:me,ue=0;ue<ve;++ue){var Se=jt(fe[ue],oe[ue]);if(Se!==0)return Se}return ge===me?0:ge<me?-1:1}}catch{}return NaN}function Xd(c){var u=typeof c;return u=="object"&&(ArrayBuffer.isView(c)||(u=N(c))==="ArrayBuffer")?"binary":u}function Zd(c){return c instanceof Uint8Array?c:ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c)}function So(c,u,g){var m=c.schema.yProps;return m?(u&&0<g.numFailures&&(u=u.filter(function(w,E){return!g.failures[E]})),Promise.all(m.map(function(w){return w=w.updatesTable,u?c.db.table(w).where("k").anyOf(u).delete():c.db.table(w).clear()})).then(function(){return g})):g}Qd.prototype.execute=function(c){var u=this["@@propmod"];if(u.add!==void 0){var g=u.add;if(l(g))return a(a([],l(c)?c:[],!0),g).sort();if(typeof g=="number")return(Number(c)||0)+g;if(typeof g=="bigint")try{return BigInt(c)+g}catch{return BigInt(0)+g}throw new TypeError("Invalid term ".concat(g))}if(u.remove!==void 0){var m=u.remove;if(l(m))return l(c)?c.filter(function(w){return!m.includes(w)}).sort():[];if(typeof m=="number")return Number(c)-m;if(typeof m=="bigint")try{return BigInt(c)-m}catch{return BigInt(0)-m}throw new TypeError("Invalid subtrahend ".concat(m))}return g=(g=u.replacePrefix)==null?void 0:g[0],g&&typeof c=="string"&&c.startsWith(g)?u.replacePrefix[1]+c.substring(g.length):c};var ui=Qd;function Qd(c){this["@@propmod"]=c}function Jd(c,u){for(var g=i(u),m=g.length,w=!1,E=0;E<m;++E){var R=g[E],U=u[R],de=B(c,R);U instanceof ui?(O(c,R,U.execute(de)),w=!0):de!==U&&(O(c,R,U),w=!0)}return w}rn.prototype._trans=function(c,u,g){var m=this._tx||Le.trans,w=this.name,E=Be&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(c==="readonly"?"read":"write"," ").concat(this.name));function R(xe,fe,oe){if(oe.schema[w])return u(oe.idbtrans,oe);throw new se.NotFound("Table "+w+" not part of transaction")}var U=it();try{var de=m&&m.db._novip===this.db._novip?m===Le.trans?m._promise(c,R,g):On(function(){return m._promise(c,R,g)},{trans:m,transless:Le.transless||Le}):(function xe(fe,oe,ge,me){if(fe.idbdb&&(fe._state.openComplete||Le.letThrough||fe._vip)){var ve=fe._createTransaction(oe,ge,fe._dbSchema);try{ve.create(),fe._state.PR1398_maxLoop=3}catch(ue){return ue.name===he.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,oe,ge,me)})):Ge(ue)}return ve._promise(oe,function(ue,Se){return On(function(){return Le.trans=ve,me(ue,Se,ve)})}).then(function(ue){if(oe==="readwrite")try{ve.idbtrans.commit()}catch{}return oe==="readonly"?ue:ve._completion.then(function(){return ue})})}if(fe._state.openComplete)return Ge(new se.DatabaseClosed(fe._state.dbOpenError));if(!fe._state.isBeingOpened){if(!fe._state.autoOpen)return Ge(new se.DatabaseClosed);fe.open().catch(be)}return fe._state.dbReadyPromise.then(function(){return xe(fe,oe,ge,me)})})(this.db,c,[this.name],R);return E&&(de._consoleTask=E,de=de.catch(function(xe){return console.trace(xe),Ge(xe)})),de}finally{U&&ct()}},rn.prototype.get=function(c,u){var g=this;return c&&c.constructor===Object?this.where(c).first(u):c==null?Ge(new se.Type("Invalid argument to Table.get()")):this._trans("readonly",function(m){return g.core.get({trans:m,key:c}).then(function(w){return g.hook.reading.fire(w)})}).then(u)},rn.prototype.where=function(c){if(typeof c=="string")return new this.db.WhereClause(this,c);if(l(c))return new this.db.WhereClause(this,"[".concat(c.join("+"),"]"));var u=i(c);if(u.length===1)return this.where(u[0]).equals(c[u[0]]);var g=this.schema.indexes.concat(this.schema.primKey).filter(function(U){if(U.compound&&u.every(function(xe){return 0<=U.keyPath.indexOf(xe)})){for(var de=0;de<u.length;++de)if(u.indexOf(U.keyPath[de])===-1)return!1;return!0}return!1}).sort(function(U,de){return U.keyPath.length-de.keyPath.length})[0];if(g&&this.db._maxKey!==Ft)return R=g.keyPath.slice(0,u.length),this.where(R).equals(R.map(function(U){return c[U]}));!g&&Be&&console.warn("The query ".concat(JSON.stringify(c)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(u.join("+"),"]"));var m=this.schema.idxByName;function w(U,de){return jt(U,de)===0}var R=u.reduce(function(fe,de){var xe=fe[0],fe=fe[1],oe=m[de],ge=c[de];return[xe||oe,xe||!oe?an(fe,oe&&oe.multi?function(me){return me=B(me,de),l(me)&&me.some(function(ve){return w(ge,ve)})}:function(me){return w(ge,B(me,de))}):fe]},[null,null]),E=R[0],R=R[1];return E?this.where(E.name).equals(c[E.keyPath]).filter(R):g?this.filter(R):this.where(u).equals("")},rn.prototype.filter=function(c){return this.toCollection().and(c)},rn.prototype.count=function(c){return this.toCollection().count(c)},rn.prototype.offset=function(c){return this.toCollection().offset(c)},rn.prototype.limit=function(c){return this.toCollection().limit(c)},rn.prototype.each=function(c){return this.toCollection().each(c)},rn.prototype.toArray=function(c){return this.toCollection().toArray(c)},rn.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},rn.prototype.orderBy=function(c){return new this.db.Collection(new this.db.WhereClause(this,l(c)?"[".concat(c.join("+"),"]"):c))},rn.prototype.reverse=function(){return this.toCollection().reverse()},rn.prototype.mapToClass=function(c){for(var u=this.db,g=this.name,m=((this.schema.mappedClass=c).prototype instanceof Yd&&(c=(R=>{var U=fe,de=R;if(typeof de!="function"&&de!==null)throw new TypeError("Class extends value "+String(de)+" is not a constructor or null");function xe(){this.constructor=U}function fe(){return R!==null&&R.apply(this,arguments)||this}return n(U,de),U.prototype=de===null?Object.create(de):(xe.prototype=de.prototype,new xe),Object.defineProperty(fe.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),fe.prototype.table=function(){return g},fe})(c)),new Set),w=c.prototype;w;w=f(w))Object.getOwnPropertyNames(w).forEach(function(R){return m.add(R)});function E(R){if(!R)return R;var U,de=Object.create(c.prototype);for(U in R)if(!m.has(U))try{de[U]=R[U]}catch{}return de}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=E,this.hook("reading",E),c},rn.prototype.defineClass=function(){return this.mapToClass(function(c){d(this,c)})},rn.prototype.add=function(c,u){var g=this,m=this.schema.primKey,w=m.auto,E=m.keyPath,R=c;return E&&w&&(R=Ha(E)(c)),this._trans("readwrite",function(U){return g.core.mutate({trans:U,type:"add",keys:u!=null?[u]:null,values:[R]})}).then(function(U){return U.numFailures?De.reject(U.failures[0]):U.lastResult}).then(function(U){if(E)try{O(c,E,U)}catch{}return U})},rn.prototype.upsert=function(c,u){var g=this,m=this.schema.primKey.keyPath;return this._trans("readwrite",function(w){return g.core.get({trans:w,key:c}).then(function(E){var R=E??{};return Jd(R,u),m&&O(R,m,c),g.core.mutate({trans:w,type:"put",values:[R],keys:[c],upsert:!0,updates:{keys:[c],changeSpecs:[u]}}).then(function(U){return U.numFailures?De.reject(U.failures[0]):!!E})})})},rn.prototype.update=function(c,u){return typeof c!="object"||l(c)?this.where(":id").equals(c).modify(u):(c=B(c,this.schema.primKey.keyPath))===void 0?Ge(new se.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(u)},rn.prototype.put=function(c,u){var g=this,m=this.schema.primKey,w=m.auto,E=m.keyPath,R=c;return E&&w&&(R=Ha(E)(c)),this._trans("readwrite",function(U){return g.core.mutate({trans:U,type:"put",values:[R],keys:u!=null?[u]:null})}).then(function(U){return U.numFailures?De.reject(U.failures[0]):U.lastResult}).then(function(U){if(E)try{O(c,E,U)}catch{}return U})},rn.prototype.delete=function(c){var u=this;return this._trans("readwrite",function(g){return u.core.mutate({trans:g,type:"delete",keys:[c]}).then(function(m){return So(u,[c],m)}).then(function(m){return m.numFailures?De.reject(m.failures[0]):void 0})})},rn.prototype.clear=function(){var c=this;return this._trans("readwrite",function(u){return c.core.mutate({trans:u,type:"deleteRange",range:ci}).then(function(g){return So(c,null,g)})}).then(function(u){return u.numFailures?De.reject(u.failures[0]):void 0})},rn.prototype.bulkGet=function(c){var u=this;return this._trans("readonly",function(g){return u.core.getMany({keys:c,trans:g}).then(function(m){return m.map(function(w){return u.hook.reading.fire(w)})})})},rn.prototype.bulkAdd=function(c,u,g){var m=this,w=Array.isArray(u)?u:void 0,E=(g=g||(w?void 0:u))?g.allKeys:void 0;return this._trans("readwrite",function(R){var U=m.schema.primKey,xe=U.auto,U=U.keyPath;if(U&&w)throw new se.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(w&&w.length!==c.length)throw new se.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=U&&xe?c.map(Ha(U)):c;return m.core.mutate({trans:R,type:"add",keys:w,values:xe,wantResults:E}).then(function(fe){var oe=fe.numFailures,ge=fe.failures;if(oe===0)return E?fe.results:fe.lastResult;throw new ne("".concat(m.name,".bulkAdd(): ").concat(oe," of ").concat(de," operations failed"),ge)})})},rn.prototype.bulkPut=function(c,u,g){var m=this,w=Array.isArray(u)?u:void 0,E=(g=g||(w?void 0:u))?g.allKeys:void 0;return this._trans("readwrite",function(R){var U=m.schema.primKey,xe=U.auto,U=U.keyPath;if(U&&w)throw new se.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(w&&w.length!==c.length)throw new se.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=U&&xe?c.map(Ha(U)):c;return m.core.mutate({trans:R,type:"put",keys:w,values:xe,wantResults:E}).then(function(fe){var oe=fe.numFailures,ge=fe.failures;if(oe===0)return E?fe.results:fe.lastResult;throw new ne("".concat(m.name,".bulkPut(): ").concat(oe," of ").concat(de," operations failed"),ge)})})},rn.prototype.bulkUpdate=function(c){var u=this,g=this.core,m=c.map(function(R){return R.key}),w=c.map(function(R){return R.changes}),E=[];return this._trans("readwrite",function(R){return g.getMany({trans:R,keys:m,cache:"clone"}).then(function(U){var de=[],xe=[],fe=(c.forEach(function(oe,ge){var me=oe.key,ve=oe.changes,ue=U[ge];if(ue){for(var Se=0,Ae=Object.keys(ve);Se<Ae.length;Se++){var we=Ae[Se],Ce=ve[we];if(we===u.schema.primKey.keyPath){if(jt(Ce,me)!==0)throw new se.Constraint("Cannot update primary key in bulkUpdate()")}else O(ue,we,Ce)}E.push(ge),de.push(me),xe.push(ue)}}),de.length);return g.mutate({trans:R,type:"put",keys:de,values:xe,updates:{keys:m,changeSpecs:w}}).then(function(oe){var ge=oe.numFailures,me=oe.failures;if(ge===0)return fe;for(var ve=0,ue=Object.keys(me);ve<ue.length;ve++){var Se,Ae=ue[ve],we=E[Number(Ae)];we!=null&&(Se=me[Ae],delete me[Ae],me[we]=Se)}throw new ne("".concat(u.name,".bulkUpdate(): ").concat(ge," of ").concat(fe," operations failed"),me)})})})},rn.prototype.bulkDelete=function(c){var u=this,g=c.length;return this._trans("readwrite",function(m){return u.core.mutate({trans:m,type:"delete",keys:c}).then(function(w){return So(u,c,w)})}).then(function(m){var w=m.numFailures,E=m.failures;if(w===0)return m.lastResult;throw new ne("".concat(u.name,".bulkDelete(): ").concat(w," of ").concat(g," operations failed"),E)})};var $d=rn;function rn(){}function di(c){function u(R,U){if(U){for(var de=arguments.length,xe=new Array(de-1);--de;)xe[de-1]=arguments[de];return g[R].subscribe.apply(null,xe),c}if(typeof R=="string")return g[R]}var g={};u.addEventType=E;for(var m=1,w=arguments.length;m<w;++m)E(arguments[m]);return u;function E(R,U,de){var xe,fe;if(typeof R!="object")return U=U||je,fe={subscribers:[],fire:de=de||be,subscribe:function(oe){fe.subscribers.indexOf(oe)===-1&&(fe.subscribers.push(oe),fe.fire=U(fe.fire,oe))},unsubscribe:function(oe){fe.subscribers=fe.subscribers.filter(function(ge){return ge!==oe}),fe.fire=fe.subscribers.reduce(U,de)}},g[R]=u[R]=fe;i(xe=R).forEach(function(oe){var ge=xe[oe];if(l(ge))E(oe,xe[oe][0],xe[oe][1]);else{if(ge!=="asap")throw new se.InvalidArgument("Invalid event config");var me=E(oe,Me,function(){for(var ve=arguments.length,ue=new Array(ve);ve--;)ue[ve]=arguments[ve];me.subscribers.forEach(function(Se){H(function(){Se.apply(null,ue)})})})}})}}function fi(c,u){return S(u).from({prototype:c}),u}function Ts(c,u){return!(c.filter||c.algorithm||c.or)&&(u?c.justLimit:!c.replayFilter)}function oc(c,u){c.filter=an(c.filter,u)}function lc(c,u,g){var m=c.replayFilter;c.replayFilter=m?function(){return an(m(),u())}:u,c.justLimit=g&&!m}function Eo(c,u){if(c.isPrimKey)return u.primaryKey;var g=u.getIndexByKeyPath(c.index);if(g)return g;throw new se.Schema("KeyPath "+c.index+" on object store "+u.name+" is not indexed")}function ef(c,u,g){var m=Eo(c,u.schema);return u.openCursor({trans:g,values:!c.keysOnly,reverse:c.dir==="prev",unique:!!c.unique,query:{index:m,range:c.range}})}function Ao(c,u,g,m){var w,E,R=c.replayFilter?an(c.filter,c.replayFilter()):c.filter;return c.or?(w={},E=function(U,de,xe){var fe,oe;R&&!R(de,xe,function(ge){return de.stop(ge)},function(ge){return de.fail(ge)})||((oe=""+(fe=de.primaryKey))=="[object ArrayBuffer]"&&(oe=""+new Uint8Array(fe)),p(w,oe))||(w[oe]=!0,u(U,de,xe))},Promise.all([c.or._iterate(E,g),tf(ef(c,m,g),c.algorithm,E,!c.keysOnly&&c.valueMapper)])):tf(ef(c,m,g),an(c.algorithm,R),u,!c.keysOnly&&c.valueMapper)}function tf(c,u,g,m){var w=_t(m?function(E,R,U){return g(m(E),R,U)}:g);return c.then(function(E){if(E)return E.start(function(){var R=function(){return E.continue()};u&&!u(E,function(U){return R=U},function(U){E.stop(U),R=be},function(U){E.fail(U),R=be})||w(E.value,E,function(U){return R=U}),R()})})}Kt.prototype._read=function(c,u){var g=this._ctx;return g.error?g.table._trans(null,Ge.bind(null,g.error)):g.table._trans("readonly",c).then(u)},Kt.prototype._write=function(c){var u=this._ctx;return u.error?u.table._trans(null,Ge.bind(null,u.error)):u.table._trans("readwrite",c,"locked")},Kt.prototype._addAlgorithm=function(c){var u=this._ctx;u.algorithm=an(u.algorithm,c)},Kt.prototype._iterate=function(c,u){return Ao(this._ctx,c,u,this._ctx.table.core)},Kt.prototype.clone=function(c){var u=Object.create(this.constructor.prototype),g=Object.create(this._ctx);return c&&d(g,c),u._ctx=g,u},Kt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Kt.prototype.each=function(c){var u=this._ctx;return this._read(function(g){return Ao(u,c,g,u.table.core)})},Kt.prototype.count=function(c){var u=this;return this._read(function(g){var m,w=u._ctx,E=w.table.core;return Ts(w,!0)?E.count({trans:g,query:{index:Eo(w,E.schema),range:w.range}}).then(function(R){return Math.min(R,w.limit)}):(m=0,Ao(w,function(){return++m,!1},g,E).then(function(){return m}))}).then(c)},Kt.prototype.sortBy=function(c,u){var g=c.split(".").reverse(),m=g[0],w=g.length-1;function E(de,xe){return xe?E(de[g[xe]],xe-1):de[m]}var R=this._ctx.dir==="next"?1:-1;function U(de,xe){return jt(E(de,w),E(xe,w))*R}return this.toArray(function(de){return de.sort(U)}).then(u)},Kt.prototype.toArray=function(c){var u=this;return this._read(function(g){var m,w,E,R=u._ctx;return R.dir==="next"&&Ts(R,!0)&&0<R.limit?(m=R.valueMapper,w=Eo(R,R.table.core.schema),R.table.core.query({trans:g,limit:R.limit,values:!0,query:{index:w,range:R.range}}).then(function(U){return U=U.result,m?U.map(m):U})):(E=[],Ao(R,function(U){return E.push(U)},g,R.table.core).then(function(){return E}))},c)},Kt.prototype.offset=function(c){var u=this._ctx;return c<=0||(u.offset+=c,Ts(u)?lc(u,function(){var g=c;return function(m,w){return g===0||(g===1?--g:w(function(){m.advance(g),g=0}),!1)}}):lc(u,function(){var g=c;return function(){return--g<0}})),this},Kt.prototype.limit=function(c){return this._ctx.limit=Math.min(this._ctx.limit,c),lc(this._ctx,function(){var u=c;return function(g,m,w){return--u<=0&&m(w),0<=u}},!0),this},Kt.prototype.until=function(c,u){return oc(this._ctx,function(g,m,w){return!c(g.value)||(m(w),u)}),this},Kt.prototype.first=function(c){return this.limit(1).toArray(function(u){return u[0]}).then(c)},Kt.prototype.last=function(c){return this.reverse().first(c)},Kt.prototype.filter=function(c){var u;return oc(this._ctx,function(g){return c(g.value)}),(u=this._ctx).isMatch=an(u.isMatch,c),this},Kt.prototype.and=function(c){return this.filter(c)},Kt.prototype.or=function(c){return new this.db.WhereClause(this._ctx.table,c,this)},Kt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Kt.prototype.desc=function(){return this.reverse()},Kt.prototype.eachKey=function(c){var u=this._ctx;return u.keysOnly=!u.isMatch,this.each(function(g,m){c(m.key,m)})},Kt.prototype.eachUniqueKey=function(c){return this._ctx.unique="unique",this.eachKey(c)},Kt.prototype.eachPrimaryKey=function(c){var u=this._ctx;return u.keysOnly=!u.isMatch,this.each(function(g,m){c(m.primaryKey,m)})},Kt.prototype.keys=function(c){var u=this._ctx,g=(u.keysOnly=!u.isMatch,[]);return this.each(function(m,w){g.push(w.key)}).then(function(){return g}).then(c)},Kt.prototype.primaryKeys=function(c){var u=this._ctx;if(u.dir==="next"&&Ts(u,!0)&&0<u.limit)return this._read(function(m){var w=Eo(u,u.table.core.schema);return u.table.core.query({trans:m,values:!1,limit:u.limit,query:{index:w,range:u.range}})}).then(function(m){return m.result}).then(c);u.keysOnly=!u.isMatch;var g=[];return this.each(function(m,w){g.push(w.primaryKey)}).then(function(){return g}).then(c)},Kt.prototype.uniqueKeys=function(c){return this._ctx.unique="unique",this.keys(c)},Kt.prototype.firstKey=function(c){return this.limit(1).keys(function(u){return u[0]}).then(c)},Kt.prototype.lastKey=function(c){return this.reverse().firstKey(c)},Kt.prototype.distinct=function(){var c,u=this._ctx,u=u.index&&u.table.schema.idxByName[u.index];return u&&u.multi&&(c={},oc(this._ctx,function(m){var m=m.primaryKey.toString(),w=p(c,m);return c[m]=!0,!w})),this},Kt.prototype.modify=function(c){var u=this,g=this._ctx;return this._write(function(m){function w(ue,Se){var Ae=Se.failures;ge+=ue-Se.numFailures;for(var we=0,Ce=i(Ae);we<Ce.length;we++){var Re=Ce[we];oe.push(Ae[Re])}}var E=typeof c=="function"?c:function(ue){return Jd(ue,c)},R=g.table.core,fe=R.schema.primaryKey,U=fe.outbound,de=fe.extractKey,xe=200,fe=u.db._options.modifyChunkSize,oe=(fe&&(xe=typeof fe=="object"?fe[R.name]||fe["*"]||200:fe),[]),ge=0,me=[],ve=c===nf;return u.clone().primaryKeys().then(function(ue){function Se(we){var Ce=Math.min(xe,ue.length-we),Re=ue.slice(we,we+Ce);return(ve?Promise.resolve([]):R.getMany({trans:m,keys:Re,cache:"immutable"})).then(function(We){var Ye=[],ze=[],et=U?[]:null,Qe=ve?Re:[];if(!ve)for(var He=0;He<Ce;++He){var rt=We[He],qt={value:z(rt),primKey:ue[we+He]};E.call(qt,qt.value,qt)!==!1&&(qt.value==null?Qe.push(ue[we+He]):U||jt(de(rt),de(qt.value))===0?(ze.push(qt.value),U&&et.push(ue[we+He])):(Qe.push(ue[we+He]),Ye.push(qt.value)))}return Promise.resolve(0<Ye.length&&R.mutate({trans:m,type:"add",values:Ye}).then(function(Ht){for(var gt in Ht.failures)Qe.splice(parseInt(gt),1);w(Ye.length,Ht)})).then(function(){return(0<ze.length||Ae&&typeof c=="object")&&R.mutate({trans:m,type:"put",keys:et,values:ze,criteria:Ae,changeSpec:typeof c!="function"&&c,isAdditionalChunk:0<we}).then(function(Ht){return w(ze.length,Ht)})}).then(function(){return(0<Qe.length||Ae&&ve)&&R.mutate({trans:m,type:"delete",keys:Qe,criteria:Ae,isAdditionalChunk:0<we}).then(function(Ht){return So(g.table,Qe,Ht)}).then(function(Ht){return w(Qe.length,Ht)})}).then(function(){return ue.length>we+Ce&&Se(we+xe)})})}var Ae=Ts(g)&&g.limit===1/0&&(typeof c!="function"||ve)&&{index:g.index,range:g.range};return Se(0).then(function(){if(0<oe.length)throw new Z("Error modifying one or more objects",oe,ge,me);return ue.length})})})},Kt.prototype.delete=function(){var c=this._ctx,u=c.range;return!Ts(c)||c.table.schema.yProps||!c.isPrimKey&&u.type!==3?this.modify(nf):this._write(function(g){var m=c.table.core.schema.primaryKey,w=u;return c.table.core.count({trans:g,query:{index:m,range:w}}).then(function(E){return c.table.core.mutate({trans:g,type:"deleteRange",range:w}).then(function(de){var U=de.failures,de=de.numFailures;if(de)throw new Z("Could not delete some values",Object.keys(U).map(function(xe){return U[xe]}),E-de);return E-de})})})};var um=Kt;function Kt(){}var nf=function(c,u){return u.value=null};function dm(c,u){return c<u?-1:c===u?0:1}function fm(c,u){return u<c?-1:c===u?0:1}function nr(c,u,g){return c=c instanceof af?new c.Collection(c):c,c._ctx.error=new(g||TypeError)(u),c}function Cs(c){return new c.Collection(c,function(){return rf("")}).limit(0)}function To(me,u,g,m){var w,E,R,U,de,xe,fe,oe=g.length;if(!g.every(function(ue){return typeof ue=="string"}))return nr(me,un);function ge(ue){w=ue==="next"?function(Ae){return Ae.toUpperCase()}:function(Ae){return Ae.toLowerCase()},E=ue==="next"?function(Ae){return Ae.toLowerCase()}:function(Ae){return Ae.toUpperCase()},R=ue==="next"?dm:fm;var Se=g.map(function(Ae){return{lower:E(Ae),upper:w(Ae)}}).sort(function(Ae,we){return R(Ae.lower,we.lower)});U=Se.map(function(Ae){return Ae.upper}),de=Se.map(function(Ae){return Ae.lower}),fe=(xe=ue)==="next"?"":m}ge("next");var me=new me.Collection(me,function(){return wa(U[0],de[oe-1]+m)}),ve=(me._ondirectionchange=function(ue){ge(ue)},0);return me._addAlgorithm(function(ue,Se,Ae){var we=ue.key;if(typeof we=="string"){var Ce=E(we);if(u(Ce,de,ve))return!0;for(var Re=null,We=ve;We<oe;++We){var Ye=((ze,et,Qe,He,rt,qt)=>{for(var Ht=Math.min(ze.length,He.length),gt=-1,Mt=0;Mt<Ht;++Mt){var dn=et[Mt];if(dn!==He[Mt])return rt(ze[Mt],Qe[Mt])<0?ze.substr(0,Mt)+Qe[Mt]+Qe.substr(Mt+1):rt(ze[Mt],He[Mt])<0?ze.substr(0,Mt)+He[Mt]+Qe.substr(Mt+1):0<=gt?ze.substr(0,gt)+et[gt]+Qe.substr(gt+1):null;rt(ze[Mt],dn)<0&&(gt=Mt)}return Ht<He.length&&qt==="next"?ze+Qe.substr(ze.length):Ht<ze.length&&qt==="prev"?ze.substr(0,Qe.length):gt<0?null:ze.substr(0,gt)+He[gt]+Qe.substr(gt+1)})(we,Ce,U[We],de[We],R,xe);Ye===null&&Re===null?ve=We+1:(Re===null||0<R(Re,Ye))&&(Re=Ye)}Se(Re!==null?function(){ue.continue(Re+fe)}:Ae)}return!1}),me}function wa(c,u,g,m){return{type:2,lower:c,upper:u,lowerOpen:g,upperOpen:m}}function rf(c){return{type:1,lower:c,upper:c}}Object.defineProperty(yn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),yn.prototype.between=function(c,u,g,m){g=g!==!1,m=m===!0;try{return 0<this._cmp(c,u)||this._cmp(c,u)===0&&(g||m)&&(!g||!m)?Cs(this):new this.Collection(this,function(){return wa(c,u,!g,!m)})}catch{return nr(this,nn)}},yn.prototype.equals=function(c){return c==null?nr(this,nn):new this.Collection(this,function(){return rf(c)})},yn.prototype.above=function(c){return c==null?nr(this,nn):new this.Collection(this,function(){return wa(c,void 0,!0)})},yn.prototype.aboveOrEqual=function(c){return c==null?nr(this,nn):new this.Collection(this,function(){return wa(c,void 0,!1)})},yn.prototype.below=function(c){return c==null?nr(this,nn):new this.Collection(this,function(){return wa(void 0,c,!1,!0)})},yn.prototype.belowOrEqual=function(c){return c==null?nr(this,nn):new this.Collection(this,function(){return wa(void 0,c)})},yn.prototype.startsWith=function(c){return typeof c!="string"?nr(this,un):this.between(c,c+Ft,!0,!0)},yn.prototype.startsWithIgnoreCase=function(c){return c===""?this.startsWith(c):To(this,function(u,g){return u.indexOf(g[0])===0},[c],Ft)},yn.prototype.equalsIgnoreCase=function(c){return To(this,function(u,g){return u===g[0]},[c],"")},yn.prototype.anyOfIgnoreCase=function(){var c=V.apply(X,arguments);return c.length===0?Cs(this):To(this,function(u,g){return g.indexOf(u)!==-1},c,"")},yn.prototype.startsWithAnyOfIgnoreCase=function(){var c=V.apply(X,arguments);return c.length===0?Cs(this):To(this,function(u,g){return g.some(function(m){return u.indexOf(m)===0})},c,Ft)},yn.prototype.anyOf=function(){var c,u,g=this,m=V.apply(X,arguments),w=this._cmp;try{m.sort(w)}catch{return nr(this,nn)}return m.length===0?Cs(this):((c=new this.Collection(this,function(){return wa(m[0],m[m.length-1])}))._ondirectionchange=function(E){w=E==="next"?g._ascending:g._descending,m.sort(w)},u=0,c._addAlgorithm(function(E,R,U){for(var de=E.key;0<w(de,m[u]);)if(++u===m.length)return R(U),!1;return w(de,m[u])===0||(R(function(){E.continue(m[u])}),!1)}),c)},yn.prototype.notEqual=function(c){return this.inAnyRange([[-1/0,c],[c,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},yn.prototype.noneOf=function(){var c=V.apply(X,arguments);if(c.length===0)return new this.Collection(this);try{c.sort(this._ascending)}catch{return nr(this,nn)}var u=c.reduce(function(g,m){return g?g.concat([[g[g.length-1][1],m]]):[[-1/0,m]]},null);return u.push([c[c.length-1],this.db._maxKey]),this.inAnyRange(u,{includeLowers:!1,includeUppers:!1})},yn.prototype.inAnyRange=function(c,Ae){var g=this,m=this._cmp,w=this._ascending,E=this._descending,R=this._min,U=this._max;if(c.length===0)return Cs(this);if(!c.every(function(we){return we[0]!==void 0&&we[1]!==void 0&&w(we[0],we[1])<=0}))return nr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",se.InvalidArgument);var de=!Ae||Ae.includeLowers!==!1,xe=Ae&&Ae.includeUppers===!0,fe,oe=w;function ge(we,Ce){return oe(we[0],Ce[0])}try{(fe=c.reduce(function(we,Ce){for(var Re=0,We=we.length;Re<We;++Re){var Ye=we[Re];if(m(Ce[0],Ye[1])<0&&0<m(Ce[1],Ye[0])){Ye[0]=R(Ye[0],Ce[0]),Ye[1]=U(Ye[1],Ce[1]);break}}return Re===We&&we.push(Ce),we},[])).sort(ge)}catch{return nr(this,nn)}var me=0,ve=xe?function(we){return 0<w(we,fe[me][1])}:function(we){return 0<=w(we,fe[me][1])},ue=de?function(we){return 0<E(we,fe[me][0])}:function(we){return 0<=E(we,fe[me][0])},Se=ve,Ae=new this.Collection(this,function(){return wa(fe[0][0],fe[fe.length-1][1],!de,!xe)});return Ae._ondirectionchange=function(we){oe=we==="next"?(Se=ve,w):(Se=ue,E),fe.sort(ge)},Ae._addAlgorithm(function(we,Ce,Re){for(var We,Ye=we.key;Se(Ye);)if(++me===fe.length)return Ce(Re),!1;return!ve(We=Ye)&&!ue(We)||(g._cmp(Ye,fe[me][1])===0||g._cmp(Ye,fe[me][0])===0||Ce(function(){oe===w?we.continue(fe[me][0]):we.continue(fe[me][1])}),!1)}),Ae},yn.prototype.startsWithAnyOf=function(){var c=V.apply(X,arguments);return c.every(function(u){return typeof u=="string"})?c.length===0?Cs(this):this.inAnyRange(c.map(function(u){return[u,u+Ft]})):nr(this,"startsWithAnyOf() only works with strings")};var af=yn;function yn(){}function jr(c){return _t(function(u){return vi(u),c(u.target.error),!1})}function vi(c){c.stopPropagation&&c.stopPropagation(),c.preventDefault&&c.preventDefault()}var hi="storagemutated",cc="x-storagemutated-1",xa=di(null,hi),vm=(qr.prototype._lock=function(){return k(!Le.global),++this._reculock,this._reculock!==1||Le.global||(Le.lockOwnerFor=this),this},qr.prototype._unlock=function(){if(k(!Le.global),--this._reculock==0)for(Le.global||(Le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var c=this._blockedFuncs.shift();try{ot(c[1],c[0])}catch{}}return this},qr.prototype._locked=function(){return this._reculock&&Le.lockOwnerFor!==this},qr.prototype.create=function(c){var u=this;if(this.mode){var g=this.db.idbdb,m=this.db._state.dbOpenError;if(k(!this.idbtrans),!c&&!g)switch(m&&m.name){case"DatabaseClosedError":throw new se.DatabaseClosed(m);case"MissingAPIError":throw new se.MissingAPI(m.message,m);default:throw new se.OpenFailed(m)}if(!this.active)throw new se.TransactionInactive;k(this._completion._state===null),(c=this.idbtrans=c||(this.db.core||g).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=_t(function(w){vi(w),u._reject(c.error)}),c.onabort=_t(function(w){vi(w),u.active&&u._reject(new se.Abort(c.error)),u.active=!1,u.on("abort").fire(w)}),c.oncomplete=_t(function(){u.active=!1,u._resolve(),"mutatedParts"in c&&xa.storagemutated.fire(c.mutatedParts)})}return this},qr.prototype._promise=function(c,u,g){var m,w=this;return c==="readwrite"&&this.mode!=="readwrite"?Ge(new se.ReadOnly("Transaction is readonly")):this.active?this._locked()?new De(function(E,R){w._blockedFuncs.push([function(){w._promise(c,u,g).then(E,R)},Le])}):g?On(function(){var E=new De(function(R,U){w._lock();var de=u(R,U,w);de&&de.then&&de.then(R,U)});return E.finally(function(){return w._unlock()}),E._lib=!0,E}):((m=new De(function(E,R){var U=u(E,R,w);U&&U.then&&U.then(E,R)}))._lib=!0,m):Ge(new se.TransactionInactive)},qr.prototype._root=function(){return this.parent?this.parent._root():this},qr.prototype.waitFor=function(c){var u,g=this._root(),m=De.resolve(c),w=(g._waitingFor?g._waitingFor=g._waitingFor.then(function(){return m}):(g._waitingFor=m,g._waitingQueue=[],u=g.idbtrans.objectStore(g.storeNames[0]),(function E(){for(++g._spinCount;g._waitingQueue.length;)g._waitingQueue.shift()();g._waitingFor&&(u.get(-1/0).onsuccess=E)})()),g._waitingFor);return new De(function(E,R){m.then(function(U){return g._waitingQueue.push(_t(E.bind(null,U)))},function(U){return g._waitingQueue.push(_t(R.bind(null,U)))}).finally(function(){g._waitingFor===w&&(g._waitingFor=null)})})},qr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new se.Abort))},qr.prototype.table=function(c){var u=this._memoizedTables||(this._memoizedTables={});if(p(u,c))return u[c];var g=this.schema[c];if(g)return(g=new this.db.Table(c,g,this)).core=this.db.core.table(c),u[c]=g;throw new se.NotFound("Table "+c+" not part of transaction")},qr);function qr(){}function uc(c,u,g,m,w,E,R,U){return{name:c,keyPath:u,unique:g,multi:m,auto:w,compound:E,src:(g&&!R?"&":"")+(m?"*":"")+(w?"++":"")+sf(u),type:U}}function sf(c){return typeof c=="string"?c:c?"["+[].join.call(c,"+")+"]":""}function dc(c,u,g){return{name:c,primKey:u,indexes:g,mappedClass:null,idxByName:(m=function(w){return[w.name,w]},g.reduce(function(w,E,R){return E=m(E,R),E&&(w[E[0]]=E[1]),w},{}))};var m}var pi=function(c){try{return c.only([[]]),pi=function(){return[[]]},[[]]}catch{return pi=function(){return Ft},Ft}};function fc(c){return c==null?function(){}:typeof c=="string"?(u=c).split(".").length===1?function(g){return g[u]}:function(g){return B(g,u)}:function(g){return B(g,c)};var u}function of(c){return[].slice.call(c)}var hm=0;function gi(c){return c==null?":id":typeof c=="string"?c:"[".concat(c.join("+"),"]")}function pm(c,u,de){function m(ve){if(ve.type===3)return null;if(ve.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var oe=ve.lower,ge=ve.upper,me=ve.lowerOpen,ve=ve.upperOpen;return oe===void 0?ge===void 0?null:u.upperBound(ge,!!ve):ge===void 0?u.lowerBound(oe,!!me):u.bound(oe,ge,!!me,!!ve)}function w(fe){var oe,ge=fe.name;return{name:ge,schema:fe,mutate:function(me){var ve=me.trans,ue=me.type,Se=me.keys,Ae=me.values,we=me.range;return new Promise(function(Ce,Re){Ce=_t(Ce);var We=ve.objectStore(ge),Ye=We.keyPath==null,ze=ue==="put"||ue==="add";if(!ze&&ue!=="delete"&&ue!=="deleteRange")throw new Error("Invalid operation type: "+ue);var et,Qe=(Se||Ae||{length:1}).length;if(Se&&Ae&&Se.length!==Ae.length)throw new Error("Given keys array must have same length as given values array.");if(Qe===0)return Ce({numFailures:0,failures:{},results:[],lastResult:void 0});function He(vn){++Ht,vi(vn)}var rt=[],qt=[],Ht=0;if(ue==="deleteRange"){if(we.type===4)return Ce({numFailures:Ht,failures:qt,results:[],lastResult:void 0});we.type===3?rt.push(et=We.clear()):rt.push(et=We.delete(m(we)))}else{var Ye=ze?Ye?[Ae,Se]:[Ae,null]:[Se,null],gt=Ye[0],Mt=Ye[1];if(ze)for(var dn=0;dn<Qe;++dn)rt.push(et=Mt&&Mt[dn]!==void 0?We[ue](gt[dn],Mt[dn]):We[ue](gt[dn])),et.onerror=He;else for(dn=0;dn<Qe;++dn)rt.push(et=We[ue](gt[dn])),et.onerror=He}function ur(vn){vn=vn.target.result,rt.forEach(function(Ga,Pc){return Ga.error!=null&&(qt[Pc]=Ga.error)}),Ce({numFailures:Ht,failures:qt,results:ue==="delete"?Se:rt.map(function(Ga){return Ga.result}),lastResult:vn})}et.onerror=function(vn){He(vn),ur(vn)},et.onsuccess=ur})},getMany:function(me){var ve=me.trans,ue=me.keys;return new Promise(function(Se,Ae){Se=_t(Se);for(var we,Ce=ve.objectStore(ge),Re=ue.length,We=new Array(Re),Ye=0,ze=0,et=function(rt){rt=rt.target,We[rt._pos]=rt.result,++ze===Ye&&Se(We)},Qe=jr(Ae),He=0;He<Re;++He)ue[He]!=null&&((we=Ce.get(ue[He]))._pos=He,we.onsuccess=et,we.onerror=Qe,++Ye);Ye===0&&Se(We)})},get:function(me){var ve=me.trans,ue=me.key;return new Promise(function(Se,Ae){Se=_t(Se);var we=ve.objectStore(ge).get(ue);we.onsuccess=function(Ce){return Se(Ce.target.result)},we.onerror=jr(Ae)})},query:(oe=U,function(me){return new Promise(function(ve,ue){ve=_t(ve);var Se,Ae,we,ze=me.trans,Ce=me.values,Re=me.limit,Ye=me.query,We=Re===1/0?void 0:Re,et=Ye.index,Ye=Ye.range,ze=ze.objectStore(ge),ze=et.isPrimaryKey?ze:ze.index(et.name),et=m(Ye);if(Re===0)return ve({result:[]});oe?((Ye=Ce?ze.getAll(et,We):ze.getAllKeys(et,We)).onsuccess=function(Qe){return ve({result:Qe.target.result})},Ye.onerror=jr(ue)):(Se=0,Ae=!Ce&&"openKeyCursor"in ze?ze.openKeyCursor(et):ze.openCursor(et),we=[],Ae.onsuccess=function(Qe){var He=Ae.result;return!He||(we.push(Ce?He.value:He.primaryKey),++Se===Re)?ve({result:we}):void He.continue()},Ae.onerror=jr(ue))})}),openCursor:function(me){var ve=me.trans,ue=me.values,Se=me.query,Ae=me.reverse,we=me.unique;return new Promise(function(Ce,Re){Ce=_t(Ce);var ze=Se.index,We=Se.range,Ye=ve.objectStore(ge),Ye=ze.isPrimaryKey?Ye:Ye.index(ze.name),ze=Ae?we?"prevunique":"prev":we?"nextunique":"next",et=!ue&&"openKeyCursor"in Ye?Ye.openKeyCursor(m(We),ze):Ye.openCursor(m(We),ze);et.onerror=jr(Re),et.onsuccess=_t(function(Qe){var He,rt,qt,Ht,gt=et.result;gt?(gt.___id=++hm,gt.done=!1,He=gt.continue.bind(gt),rt=(rt=gt.continuePrimaryKey)&&rt.bind(gt),qt=gt.advance.bind(gt),Ht=function(){throw new Error("Cursor not stopped")},gt.trans=ve,gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=function(){throw new Error("Cursor not started")},gt.fail=_t(Re),gt.next=function(){var Mt=this,dn=1;return this.start(function(){return dn--?Mt.continue():Mt.stop()}).then(function(){return Mt})},gt.start=function(Mt){function dn(){if(et.result)try{Mt()}catch(vn){gt.fail(vn)}else gt.done=!0,gt.start=function(){throw new Error("Cursor behind last entry")},gt.stop()}var ur=new Promise(function(vn,Ga){vn=_t(vn),et.onerror=jr(Ga),gt.fail=Ga,gt.stop=function(Pc){gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=Ht,vn(Pc)}});return et.onsuccess=_t(function(vn){et.onsuccess=dn,dn()}),gt.continue=He,gt.continuePrimaryKey=rt,gt.advance=qt,dn(),ur},Ce(gt)):Ce(null)},Re)})},count:function(me){var ve=me.query,ue=me.trans,Se=ve.index,Ae=ve.range;return new Promise(function(we,Ce){var Re=ue.objectStore(ge),Re=Se.isPrimaryKey?Re:Re.index(Se.name),We=m(Ae),We=We?Re.count(We):Re.count();We.onsuccess=_t(function(Ye){return we(Ye.target.result)}),We.onerror=jr(Ce)})}}}E=de,R=of((de=c).objectStoreNames);var E,de={schema:{name:de.name,tables:R.map(function(fe){return E.objectStore(fe)}).map(function(fe){var oe=fe.keyPath,ge=fe.autoIncrement,ve=l(oe),me={},ve={name:fe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:oe==null,compound:ve,keyPath:oe,autoIncrement:ge,unique:!0,extractKey:fc(oe)},indexes:of(fe.indexNames).map(function(ue){return fe.index(ue)}).map(function(we){var Ce=we.name,Se=we.unique,Ae=we.multiEntry,we=we.keyPath,Ce={name:Ce,compound:l(we),keyPath:we,unique:Se,multiEntry:Ae,extractKey:fc(we)};return me[gi(we)]=Ce}),getIndexByKeyPath:function(ue){return me[gi(ue)]}};return me[":id"]=ve.primaryKey,oe!=null&&(me[gi(oe)]=ve.primaryKey),ve})},hasGetAll:0<R.length&&"getAll"in E.objectStore(R[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},R=de.schema,U=de.hasGetAll,de=R.tables.map(w),xe={};return de.forEach(function(fe){return xe[fe.name]=fe}),{stack:"dbcore",transaction:c.transaction.bind(c),table:function(fe){if(xe[fe])return xe[fe];throw new Error("Table '".concat(fe,"' not found"))},MIN_KEY:-1/0,MAX_KEY:pi(u),schema:R}}function gm(c,u,g,m){return g=g.IDBKeyRange,u=pm(u,g,m),{dbcore:c.dbcore.reduce(function(w,E){return E=E.create,r(r({},w),E(w))},u)}}function Co(c,u){var g=u.db,g=gm(c._middlewares,g,c._deps,u);c.core=g.dbcore,c.tables.forEach(function(m){var w=m.name;c.core.schema.tables.some(function(E){return E.name===w})&&(m.core=c.core.table(w),c[w]instanceof c.Table)&&(c[w].core=m.core)})}function Io(c,u,g,m){g.forEach(function(w){var E=m[w];u.forEach(function(R){var U=(function de(xe,fe){return A(xe,fe)||(xe=f(xe))&&de(xe,fe)})(R,w);(!U||"value"in U&&U.value===void 0)&&(R===c.Transaction.prototype||R instanceof c.Transaction?x(R,w,{get:function(){return this.table(w)},set:function(de){y(this,w,{value:de,writable:!0,configurable:!0,enumerable:!0})}}):R[w]=new c.Table(w,E))})})}function vc(c,u){u.forEach(function(g){for(var m in g)g[m]instanceof c.Table&&delete g[m]})}function mm(c,u){return c._cfg.version-u._cfg.version}function ym(c,u,g,m){var w=c._dbSchema,E=(g.objectStoreNames.contains("$meta")&&!w.$meta&&(w.$meta=dc("$meta",cf("")[0],[]),c._storeNames.push("$meta")),c._createTransaction("readwrite",c._storeNames,w)),R=(E.create(g),E._completion.catch(m),E._reject.bind(E)),U=Le.transless||Le;On(function(){if(Le.trans=E,Le.transless=U,u!==0)return Co(c,g),xe=u,((de=E).storeNames.includes("$meta")?de.table("$meta").get("version").then(function(fe){return fe??xe}):De.resolve(xe)).then(function(Se){var oe=c,ge=Se,me=E,ve=g,ue=[],Se=oe._versions,Ae=oe._dbSchema=Mo(0,oe.idbdb,ve);return(Se=Se.filter(function(we){return we._cfg.version>=ge})).length===0?De.resolve():(Se.forEach(function(we){ue.push(function(){var Ce,Re,We,Ye=Ae,ze=we._cfg.dbschema,et=(Oo(oe,Ye,ve),Oo(oe,ze,ve),Ae=oe._dbSchema=ze,hc(Ye,ze)),Qe=(et.add.forEach(function(He){pc(ve,He[0],He[1].primKey,He[1].indexes)}),et.change.forEach(function(He){if(He.recreate)throw new se.Upgrade("Not yet support for changing primary key");var rt=ve.objectStore(He.name);He.add.forEach(function(qt){return Po(rt,qt)}),He.change.forEach(function(qt){rt.deleteIndex(qt.name),Po(rt,qt)}),He.del.forEach(function(qt){return rt.deleteIndex(qt)})}),we._cfg.contentUpgrade);if(Qe&&we._cfg.version>ge)return Co(oe,ve),me._memoizedTables={},Ce=J(ze),et.del.forEach(function(He){Ce[He]=Ye[He]}),vc(oe,[oe.Transaction.prototype]),Io(oe,[oe.Transaction.prototype],i(Ce),Ce),me.schema=Ce,(Re=te(Qe))&&Nn(),ze=De.follow(function(){var He;(We=Qe(me))&&Re&&(He=br.bind(null,null),We.then(He,He))}),We&&typeof We.then=="function"?De.resolve(We):ze.then(function(){return We})}),ue.push(function(Ce){var Re,We,Ye=we._cfg.dbschema;Re=Ye,We=Ce,[].slice.call(We.db.objectStoreNames).forEach(function(ze){return Re[ze]==null&&We.db.deleteObjectStore(ze)}),vc(oe,[oe.Transaction.prototype]),Io(oe,[oe.Transaction.prototype],oe._storeNames,oe._dbSchema),me.schema=oe._dbSchema}),ue.push(function(Ce){oe.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(oe.idbdb.version/10)===we._cfg.version?(oe.idbdb.deleteObjectStore("$meta"),delete oe._dbSchema.$meta,oe._storeNames=oe._storeNames.filter(function(Re){return Re!=="$meta"})):Ce.objectStore("$meta").put(we._cfg.version,"version"))})}),(function we(){return ue.length?De.resolve(ue.shift()(me.idbtrans)).then(we):De.resolve()})().then(function(){lf(Ae,ve)}))}).catch(R);var de,xe;i(w).forEach(function(fe){pc(g,fe,w[fe].primKey,w[fe].indexes)}),Co(c,g),De.follow(function(){return c.on.populate.fire(E)}).catch(R)})}function _m(c,u){lf(c._dbSchema,u),u.db.version%10!=0||u.objectStoreNames.contains("$meta")||u.db.createObjectStore("$meta").add(Math.ceil(u.db.version/10-1),"version");var g=Mo(0,c.idbdb,u);Oo(c,c._dbSchema,u);for(var m=0,w=hc(g,c._dbSchema).change;m<w.length;m++){var E=(R=>{if(R.change.length||R.recreate)return console.warn("Unable to patch indexes of table ".concat(R.name," because it has changes on the type of index or primary key.")),{value:void 0};var U=u.objectStore(R.name);R.add.forEach(function(de){Be&&console.debug("Dexie upgrade patch: Creating missing index ".concat(R.name,".").concat(de.src)),Po(U,de)})})(w[m]);if(typeof E=="object")return E.value}}function hc(c,u){var g,m={del:[],add:[],change:[]};for(g in c)u[g]||m.del.push(g);for(g in u){var w=c[g],E=u[g];if(w){var R={name:g,def:E,recreate:!1,del:[],add:[],change:[]};if(""+(w.primKey.keyPath||"")!=""+(E.primKey.keyPath||"")||w.primKey.auto!==E.primKey.auto)R.recreate=!0,m.change.push(R);else{var U=w.idxByName,de=E.idxByName,xe=void 0;for(xe in U)de[xe]||R.del.push(xe);for(xe in de){var fe=U[xe],oe=de[xe];fe?fe.src!==oe.src&&R.change.push(oe):R.add.push(oe)}(0<R.del.length||0<R.add.length||0<R.change.length)&&m.change.push(R)}}else m.add.push([g,E])}return m}function pc(c,u,g,m){var w=c.db.createObjectStore(u,g.keyPath?{keyPath:g.keyPath,autoIncrement:g.auto}:{autoIncrement:g.auto});m.forEach(function(E){return Po(w,E)})}function lf(c,u){i(c).forEach(function(g){u.db.objectStoreNames.contains(g)||(Be&&console.debug("Dexie: Creating missing table",g),pc(u,g,c[g].primKey,c[g].indexes))})}function Po(c,u){c.createIndex(u.name,u.keyPath,{unique:u.unique,multiEntry:u.multi})}function Mo(c,u,g){var m={};return L(u.objectStoreNames,0).forEach(function(w){for(var E=g.objectStore(w),R=uc(sf(xe=E.keyPath),xe||"",!0,!1,!!E.autoIncrement,xe&&typeof xe!="string",!0),U=[],de=0;de<E.indexNames.length;++de){var fe=E.index(E.indexNames[de]),xe=fe.keyPath,fe=uc(fe.name,xe,!!fe.unique,!!fe.multiEntry,!1,xe&&typeof xe!="string",!1);U.push(fe)}m[w]=dc(w,R,U)}),m}function Oo(c,u,g){for(var m=g.db.objectStoreNames,w=0;w<m.length;++w){var E=m[w],R=g.objectStore(E);c._hasGetAll="getAll"in R;for(var U=0;U<R.indexNames.length;++U){var de,xe=R.indexNames[U],fe=R.index(xe).keyPath,fe=typeof fe=="string"?fe:"["+L(fe).join("+")+"]";u[E]&&(de=u[E].idxByName[fe])&&(de.name=xe,delete u[E].idxByName[fe],u[E].idxByName[xe]=de)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(c._hasGetAll=!1)}function cf(c){return c.split(",").map(function(u,g){var w=u.split(":"),m=(m=w[1])==null?void 0:m.trim(),w=(u=w[0].trim()).replace(/([&*]|\+\+)/g,""),E=/^\[/.test(w)?w.match(/^\[(.*)\]$/)[1].split("+"):w;return uc(w,E||null,/\&/.test(u),/\*/.test(u),/\+\+/.test(u),l(E),g===0,m)})}Is.prototype._createTableSchema=dc,Is.prototype._parseIndexSyntax=cf,Is.prototype._parseStoresSpec=function(c,u){var g=this;i(c).forEach(function(m){if(c[m]!==null){var w=g._parseIndexSyntax(c[m]),E=w.shift();if(!E)throw new se.Schema("Invalid schema for table "+m+": "+c[m]);if(E.unique=!0,E.multi)throw new se.Schema("Primary key cannot be multiEntry*");w.forEach(function(R){if(R.auto)throw new se.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new se.Schema("Index must have a name and cannot be an empty string")}),E=g._createTableSchema(m,E,w),u[m]=E}})},Is.prototype.stores=function(g){var u=this.db,g=(this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,g):g,u._versions),m={},w={};return g.forEach(function(E){d(m,E._cfg.storesSource),w=E._cfg.dbschema={},E._parseStoresSpec(m,w)}),u._dbSchema=w,vc(u,[u._allTables,u,u.Transaction.prototype]),Io(u,[u._allTables,u,u.Transaction.prototype,this._cfg.tables],i(w),w),u._storeNames=i(w),this},Is.prototype.upgrade=function(c){return this._cfg.contentUpgrade=Ne(this._cfg.contentUpgrade||be,c),this};var bm=Is;function Is(){}function gc(c,u){var g=c._dbNamesDB;return g||(g=c._dbNamesDB=new na(Hn,{addons:[],indexedDB:c,IDBKeyRange:u})).version(1).stores({dbnames:"name"}),g.table("dbnames")}function mc(c){return c&&typeof c.databases=="function"}function yc(c){return On(function(){return Le.letThrough=!0,c()})}function _c(c){return!("from"in c)}var Dn=function(c,u){var g;if(!this)return g=new Dn,c&&"d"in c&&d(g,c),g;d(this,arguments.length?{d:1,from:c,to:1<arguments.length?u:c}:{d:0})};function mi(c,u,g){var m=jt(u,g);if(!isNaN(m)){if(0<m)throw RangeError();if(_c(c))return d(c,{from:u,to:g,d:1});var m=c.l,w=c.r;if(jt(g,c.from)<0)return m?mi(m,u,g):c.l={from:u,to:g,d:1,l:null,r:null},df(c);if(0<jt(u,c.to))return w?mi(w,u,g):c.r={from:u,to:g,d:1,l:null,r:null},df(c);jt(u,c.from)<0&&(c.from=u,c.l=null,c.d=w?w.d+1:1),0<jt(g,c.to)&&(c.to=g,c.r=null,c.d=c.l?c.l.d+1:1),u=!c.r,m&&!c.l&&yi(c,m),w&&u&&yi(c,w)}}function yi(c,u){_c(u)||(function g(m,w){var E=w.from,R=w.l,U=w.r;mi(m,E,w.to),R&&g(m,R),U&&g(m,U)})(c,u)}function uf(c,u){var g=No(u),m=g.next();if(!m.done)for(var w=m.value,E=No(c),R=E.next(w.from),U=R.value;!m.done&&!R.done;){if(jt(U.from,w.to)<=0&&0<=jt(U.to,w.from))return!0;jt(w.from,U.from)<0?w=(m=g.next(U.from)).value:U=(R=E.next(w.from)).value}return!1}function No(c){var u=_c(c)?null:{s:0,n:c};return{next:function(g){for(var m=0<arguments.length;u;)switch(u.s){case 0:if(u.s=1,m)for(;u.n.l&&jt(g,u.n.from)<0;)u={up:u,n:u.n.l,s:1};else for(;u.n.l;)u={up:u,n:u.n.l,s:1};case 1:if(u.s=2,!m||jt(g,u.n.to)<=0)return{value:u.n,done:!1};case 2:if(u.n.r){u.s=3,u={up:u,n:u.n.r,s:0};continue}case 3:u=u.up}return{done:!0}}}}function df(c){var u,g,m,w=(((w=c.r)==null?void 0:w.d)||0)-(((w=c.l)==null?void 0:w.d)||0),w=1<w?"r":w<-1?"l":"";w&&(u=w=="r"?"l":"r",g=r({},c),m=c[w],c.from=m.from,c.to=m.to,c[w]=m[w],g[w]=m[u],(c[u]=g).d=ff(g)),c.d=ff(c)}function ff(g){var u=g.r,g=g.l;return(u?g?Math.max(u.d,g.d):u.d:g?g.d:0)+1}function Do(c,u){return i(u).forEach(function(g){c[g]?yi(c[g],u[g]):c[g]=(function m(w){var E,R,U={};for(E in w)p(w,E)&&(R=w[E],U[E]=!R||typeof R!="object"||j.has(R.constructor)?R:m(R));return U})(u[g])}),c}function bc(c,u){return c.all||u.all||Object.keys(c).some(function(g){return u[g]&&uf(u[g],c[g])})}h(Dn.prototype,((tt={add:function(c){return yi(this,c),this},addKey:function(c){return mi(this,c,c),this},addKeys:function(c){var u=this;return c.forEach(function(g){return mi(u,g,g)}),this},hasKey:function(c){var u=No(this).next(c).value;return u&&jt(u.from,c)<=0&&0<=jt(u.to,c)}})[I]=function(){return No(this)},tt));var Va={},wc={},xc=!1;function Ro(c){Do(wc,c),xc||(xc=!0,setTimeout(function(){xc=!1,kc(wc,!(wc={}))},0))}function kc(c,u){u===void 0&&(u=!1);var g=new Set;if(c.all)for(var m=0,w=Object.values(Va);m<w.length;m++)vf(U=w[m],c,g,u);else for(var E in c){var R,U,E=/^idb\:\/\/(.*)\/(.*)\//.exec(E);E&&(R=E[1],E=E[2],U=Va["idb://".concat(R,"/").concat(E)])&&vf(U,c,g,u)}g.forEach(function(de){return de()})}function vf(c,u,g,m){for(var w=[],E=0,R=Object.entries(c.queries.query);E<R.length;E++){for(var U=R[E],de=U[0],xe=[],fe=0,oe=U[1];fe<oe.length;fe++){var ge=oe[fe];bc(u,ge.obsSet)?ge.subscribers.forEach(function(Se){return g.add(Se)}):m&&xe.push(ge)}m&&w.push([de,xe])}if(m)for(var me=0,ve=w;me<ve.length;me++){var ue=ve[me],de=ue[0],xe=ue[1];c.queries.query[de]=xe}}function wm(c){var u=c._state,g=c._deps.indexedDB;if(u.isBeingOpened||c.idbdb)return u.dbReadyPromise.then(function(){return u.dbOpenError?Ge(u.dbOpenError):c});u.isBeingOpened=!0,u.dbOpenError=null,u.openComplete=!1;var m=u.openCanceller,w=Math.round(10*c.verno),E=!1;function R(){if(u.openCanceller!==m)throw new se.DatabaseClosed("db.open() was cancelled")}function U(){return new De(function(ge,me){if(R(),!g)throw new se.MissingAPI;var ve=c.name,ue=u.autoSchema||!w?g.open(ve):g.open(ve,w);if(!ue)throw new se.MissingAPI;ue.onerror=jr(me),ue.onblocked=_t(c._fireOnBlocked),ue.onupgradeneeded=_t(function(Se){var Ae;fe=ue.transaction,u.autoSchema&&!c._options.allowEmptyDB?(ue.onerror=vi,fe.abort(),ue.result.close(),(Ae=g.deleteDatabase(ve)).onsuccess=Ae.onerror=_t(function(){me(new se.NoSuchDatabase("Database ".concat(ve," doesnt exist")))})):(fe.onerror=jr(me),Ae=Se.oldVersion>Math.pow(2,62)?0:Se.oldVersion,oe=Ae<1,c.idbdb=ue.result,E&&_m(c,fe),ym(c,Ae/10,fe,me))},me),ue.onsuccess=_t(function(){fe=null;var Se,Ae,we,Ce,Re,We,Ye=c.idbdb=ue.result,ze=L(Ye.objectStoreNames);if(0<ze.length)try{var et=Ye.transaction((Re=ze).length===1?Re[0]:Re,"readonly");if(u.autoSchema)We=Ye,Ce=et,(we=c).verno=We.version/10,Ce=we._dbSchema=Mo(0,We,Ce),we._storeNames=L(We.objectStoreNames,0),Io(we,[we._allTables],i(Ce),Ce);else if(Oo(c,c._dbSchema,et),Ae=et,((Ae=hc(Mo(0,(Se=c).idbdb,Ae),Se._dbSchema)).add.length||Ae.change.some(function(Qe){return Qe.add.length||Qe.change.length}))&&!E)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ye.close(),w=Ye.version+1,E=!0,ge(U());Co(c,et)}catch{}hn.push(c),Ye.onversionchange=_t(function(Qe){u.vcFired=!0,c.on("versionchange").fire(Qe)}),Ye.onclose=_t(function(){c.close({disableAutoOpen:!1})}),oe&&(ze=c._deps,Re=ve,mc(We=ze.indexedDB)||Re===Hn||gc(We,ze.IDBKeyRange).put({name:Re}).catch(be)),ge()},me)}).catch(function(ge){switch(ge==null?void 0:ge.name){case"UnknownError":if(0<u.PR1398_maxLoop)return u.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),U();break;case"VersionError":if(0<w)return w=0,U()}return De.reject(ge)})}var de,xe=u.dbReadyResolve,fe=null,oe=!1;return De.race([m,(typeof navigator>"u"?De.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ge){function me(){return indexedDB.databases().finally(ge)}de=setInterval(me,100),me()}).finally(function(){return clearInterval(de)}):Promise.resolve()).then(U)]).then(function(){return R(),u.onReadyBeingFired=[],De.resolve(yc(function(){return c.on.ready.fire(c.vip)})).then(function ge(){var me;if(0<u.onReadyBeingFired.length)return me=u.onReadyBeingFired.reduce(Ne,be),u.onReadyBeingFired=[],De.resolve(yc(function(){return me(c.vip)})).then(ge)})}).finally(function(){u.openCanceller===m&&(u.onReadyBeingFired=null,u.isBeingOpened=!1)}).catch(function(ge){u.dbOpenError=ge;try{fe&&fe.abort()}catch{}return m===u.openCanceller&&c._close(),Ge(ge)}).finally(function(){u.openComplete=!0,xe()}).then(function(){var ge;return oe&&(ge={},c.tables.forEach(function(me){me.schema.indexes.forEach(function(ve){ve.name&&(ge["idb://".concat(c.name,"/").concat(me.name,"/").concat(ve.name)]=new Dn(-1/0,[[[]]]))}),ge["idb://".concat(c.name,"/").concat(me.name,"/")]=ge["idb://".concat(c.name,"/").concat(me.name,"/:dels")]=new Dn(-1/0,[[[]]])}),xa(hi).fire(ge),kc(ge,!0)),c})}function Sc(c){function u(E){return c.next(E)}var g=w(u),m=w(function(E){return c.throw(E)});function w(E){return function(U){var U=E(U),de=U.value;return U.done?de:de&&typeof de.then=="function"?de.then(g,m):l(de)?Promise.all(de).then(g,m):g(de)}}return w(u)()}function Lo(c,u,g){for(var m=l(c)?c.slice():[c],w=0;w<g;++w)m.push(u);return m}var xm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(c){return r(r({},c),{table:function(m){var g=c.table(m),m=g.schema,w={},E=[];function R(ge,me,ve){var we=gi(ge),ue=w[we]=w[we]||[],Se=ge==null?0:typeof ge=="string"?1:ge.length,Ae=0<me,we=r(r({},ve),{name:Ae?"".concat(we,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Ae,keyTail:me,keyLength:Se,extractKey:fc(ge),unique:!Ae&&ve.unique});return ue.push(we),we.isPrimaryKey||E.push(we),1<Se&&R(Se===2?ge[0]:ge.slice(0,Se-1),me+1,ve),ue.sort(function(Ce,Re){return Ce.keyTail-Re.keyTail}),we}var U=R(m.primaryKey.keyPath,0,m.primaryKey);w[":id"]=[U];for(var de=0,xe=m.indexes;de<xe.length;de++){var fe=xe[de];R(fe.keyPath,0,fe)}function oe(ge){var me,ve=ge.query.index;return ve.isVirtual?r(r({},ge),{query:{index:ve.lowLevelIndex,range:(me=ge.query.range,ve=ve.keyTail,{type:me.type===1?2:me.type,lower:Lo(me.lower,me.lowerOpen?c.MAX_KEY:c.MIN_KEY,ve),lowerOpen:!0,upper:Lo(me.upper,me.upperOpen?c.MIN_KEY:c.MAX_KEY,ve),upperOpen:!0})}}):ge}return r(r({},g),{schema:r(r({},m),{primaryKey:U,indexes:E,getIndexByKeyPath:function(ge){return(ge=w[gi(ge)])&&ge[0]}}),count:function(ge){return g.count(oe(ge))},query:function(ge){return g.query(oe(ge))},openCursor:function(ge){var me=ge.query.index,ve=me.keyTail,ue=me.keyLength;return me.isVirtual?g.openCursor(oe(ge)).then(function(Ae){return Ae&&Se(Ae)}):g.openCursor(ge);function Se(Ae){return Object.create(Ae,{continue:{value:function(we){we!=null?Ae.continue(Lo(we,ge.reverse?c.MAX_KEY:c.MIN_KEY,ve)):ge.unique?Ae.continue(Ae.key.slice(0,ue).concat(ge.reverse?c.MIN_KEY:c.MAX_KEY,ve)):Ae.continue()}},continuePrimaryKey:{value:function(we,Ce){Ae.continuePrimaryKey(Lo(we,c.MAX_KEY,ve),Ce)}},primaryKey:{get:function(){return Ae.primaryKey}},key:{get:function(){var we=Ae.key;return ue===1?we[0]:we.slice(0,ue)}},value:{get:function(){return Ae.value}}})}}})}})}};function Ec(c,u,g,m){return g=g||{},m=m||"",i(c).forEach(function(w){var E,R,U;p(u,w)?(E=c[w],R=u[w],typeof E=="object"&&typeof R=="object"&&E&&R?(U=N(E))!==N(R)?g[m+w]=u[w]:U==="Object"?Ec(E,R,g,m+w+"."):E!==R&&(g[m+w]=u[w]):E!==R&&(g[m+w]=u[w])):g[m+w]=void 0}),i(u).forEach(function(w){p(c,w)||(g[m+w]=u[w])}),g}function Ac(c,u){return u.type==="delete"?u.keys:u.keys||u.values.map(c.extractKey)}var km={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(c){return r(r({},c),{table:function(u){var g=c.table(u),m=g.schema.primaryKey;return r(r({},g),{mutate:function(w){var E=Le.trans,R=E.table(u).hook,U=R.deleting,de=R.creating,xe=R.updating;switch(w.type){case"add":if(de.fire===be)break;return E._promise("readwrite",function(){return fe(w)},!0);case"put":if(de.fire===be&&xe.fire===be)break;return E._promise("readwrite",function(){return fe(w)},!0);case"delete":if(U.fire===be)break;return E._promise("readwrite",function(){return fe(w)},!0);case"deleteRange":if(U.fire===be)break;return E._promise("readwrite",function(){return(function oe(ge,me,ve){return g.query({trans:ge,values:!1,query:{index:m,range:me},limit:ve}).then(function(ue){var Se=ue.result;return fe({type:"delete",keys:Se,trans:ge}).then(function(Ae){return 0<Ae.numFailures?Promise.reject(Ae.failures[0]):Se.length<ve?{failures:[],numFailures:0,lastResult:void 0}:oe(ge,r(r({},me),{lower:Se[Se.length-1],lowerOpen:!0}),ve)})})})(w.trans,w.range,1e4)},!0)}return g.mutate(w);function fe(oe){var ge,me,ve,ue=Le.trans,Se=oe.keys||Ac(m,oe);if(Se)return(oe=oe.type==="add"||oe.type==="put"?r(r({},oe),{keys:Se}):r({},oe)).type!=="delete"&&(oe.values=a([],oe.values)),oe.keys&&(oe.keys=a([],oe.keys)),ge=g,ve=Se,((me=oe).type==="add"?Promise.resolve([]):ge.getMany({trans:me.trans,keys:ve,cache:"immutable"})).then(function(Ae){var we=Se.map(function(Ce,Re){var We,Ye,ze,et=Ae[Re],Qe={onerror:null,onsuccess:null};return oe.type==="delete"?U.fire.call(Qe,Ce,et,ue):oe.type==="add"||et===void 0?(We=de.fire.call(Qe,Ce,oe.values[Re],ue),Ce==null&&We!=null&&(oe.keys[Re]=Ce=We,m.outbound||O(oe.values[Re],m.keyPath,Ce))):(We=Ec(et,oe.values[Re]),(Ye=xe.fire.call(Qe,We,Ce,et,ue))&&(ze=oe.values[Re],Object.keys(Ye).forEach(function(He){p(ze,He)?ze[He]=Ye[He]:O(ze,He,Ye[He])}))),Qe});return g.mutate(oe).then(function(Ce){for(var Re=Ce.failures,We=Ce.results,Ye=Ce.numFailures,Ce=Ce.lastResult,ze=0;ze<Se.length;++ze){var et=(We||Se)[ze],Qe=we[ze];et==null?Qe.onerror&&Qe.onerror(Re[ze]):Qe.onsuccess&&Qe.onsuccess(oe.type==="put"&&Ae[ze]?oe.values[ze]:et)}return{failures:Re,results:We,numFailures:Ye,lastResult:Ce}}).catch(function(Ce){return we.forEach(function(Re){return Re.onerror&&Re.onerror(Ce)}),Promise.reject(Ce)})});throw new Error("Keys missing")}}})}})}};function hf(c,u,g){try{if(!u||u.keys.length<c.length)return null;for(var m=[],w=0,E=0;w<u.keys.length&&E<c.length;++w)jt(u.keys[w],c[E])===0&&(m.push(g?z(u.values[w]):u.values[w]),++E);return m.length===c.length?m:null}catch{return null}}var Sm={stack:"dbcore",level:-1,create:function(c){return{table:function(u){var g=c.table(u);return r(r({},g),{getMany:function(m){var w;return m.cache?(w=hf(m.keys,m.trans._cache,m.cache==="clone"))?De.resolve(w):g.getMany(m).then(function(E){return m.trans._cache={keys:m.keys,values:m.cache==="clone"?z(E):E},E}):g.getMany(m)},mutate:function(m){return m.type!=="add"&&(m.trans._cache=null),g.mutate(m)}})}}}};function pf(c,u){return c.trans.mode==="readonly"&&!!c.subscr&&!c.trans.explicit&&c.trans.db._options.cache!=="disabled"&&!u.schema.primaryKey.outbound}function gf(c,u){switch(c){case"query":return u.values&&!u.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Em={stack:"dbcore",level:0,name:"Observability",create:function(c){var u=c.schema.name,g=new Dn(c.MIN_KEY,c.MAX_KEY);return r(r({},c),{transaction:function(m,w,E){if(Le.subscr&&w!=="readonly")throw new se.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Le.querier));return c.transaction(m,w,E)},table:function(m){function w(Se){var ue,Se=Se.query;return[ue=Se.index,new Dn((ue=(Se=Se.range).lower)!=null?ue:c.MIN_KEY,(ue=Se.upper)!=null?ue:c.MAX_KEY)]}var E=c.table(m),R=E.schema,U=R.primaryKey,de=R.indexes,xe=U.extractKey,fe=U.outbound,oe=U.autoIncrement&&de.filter(function(ve){return ve.compound&&ve.keyPath.includes(U.keyPath)}),ge=r(r({},E),{mutate:function(ve){function ue(rt){return rt="idb://".concat(u,"/").concat(m,"/").concat(rt),Re[rt]||(Re[rt]=new Dn)}var Se,Ae,we,Ce=ve.trans,Re=ve.mutatedParts||(ve.mutatedParts={}),We=ue(""),Ye=ue(":dels"),ze=ve.type,Qe=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[Ac(U,ve).filter(function(rt){return rt}),ve.values]:[],et=Qe[0],Qe=Qe[1],He=ve.trans._cache;return l(et)?(We.addKeys(et),(ze=ze==="delete"||et.length===Qe.length?hf(et,He):null)||Ye.addKeys(et),(ze||Qe)&&(Se=ue,Ae=ze,we=Qe,R.indexes.forEach(function(rt){var qt=Se(rt.name||"");function Ht(Mt){return Mt!=null?rt.extractKey(Mt):null}function gt(Mt){rt.multiEntry&&l(Mt)?Mt.forEach(function(dn){return qt.addKey(dn)}):qt.addKey(Mt)}(Ae||we).forEach(function(Mt,vn){var ur=Ae&&Ht(Ae[vn]),vn=we&&Ht(we[vn]);jt(ur,vn)!==0&&(ur!=null&&gt(ur),vn!=null)&&gt(vn)})}))):et?(Qe={from:(He=et.lower)!=null?He:c.MIN_KEY,to:(ze=et.upper)!=null?ze:c.MAX_KEY},Ye.add(Qe),We.add(Qe)):(We.add(g),Ye.add(g),R.indexes.forEach(function(rt){return ue(rt.name).add(g)})),E.mutate(ve).then(function(rt){return!et||ve.type!=="add"&&ve.type!=="put"||(We.addKeys(rt.results),oe&&oe.forEach(function(qt){for(var Ht=ve.values.map(function(ur){return qt.extractKey(ur)}),gt=qt.keyPath.findIndex(function(ur){return ur===U.keyPath}),Mt=0,dn=rt.results.length;Mt<dn;++Mt)Ht[Mt][gt]=rt.results[Mt];ue(qt.name).addKeys(Ht)})),Ce.mutatedParts=Do(Ce.mutatedParts||{},Re),rt})}}),me={get:function(ve){return[U,new Dn(ve.key)]},getMany:function(ve){return[U,new Dn().addKeys(ve.keys)]},count:w,query:w,openCursor:w};return i(me).forEach(function(ve){ge[ve]=function(ue){var Se=Le.subscr,Ae=!!Se,we=pf(Le,E)&&gf(ve,ue)?ue.obsSet={}:Se;if(Ae){var Ce,Se=function(Qe){return Qe="idb://".concat(u,"/").concat(m,"/").concat(Qe),we[Qe]||(we[Qe]=new Dn)},Re=Se(""),We=Se(":dels"),Ae=me[ve](ue),Ye=Ae[0],Ae=Ae[1];if((ve==="query"&&Ye.isPrimaryKey&&!ue.values?We:Se(Ye.name||"")).add(Ae),!Ye.isPrimaryKey){if(ve!=="count")return Ce=ve==="query"&&fe&&ue.values&&E.query(r(r({},ue),{values:!1})),E[ve].apply(this,arguments).then(function(Qe){if(ve==="query"){if(fe&&ue.values)return Ce.then(function(Ht){return Ht=Ht.result,Re.addKeys(Ht),Qe});var He=ue.values?Qe.result.map(xe):Qe.result;(ue.values?Re:We).addKeys(He)}else{var rt,qt;if(ve==="openCursor")return qt=ue.values,(rt=Qe)&&Object.create(rt,{key:{get:function(){return We.addKey(rt.primaryKey),rt.key}},primaryKey:{get:function(){var Ht=rt.primaryKey;return We.addKey(Ht),Ht}},value:{get:function(){return qt&&Re.addKey(rt.primaryKey),rt.value}}})}return Qe});We.add(g)}}return E[ve].apply(this,arguments)}}),ge}})}};function mf(c,u,g){var m;return g.numFailures===0?u:u.type==="deleteRange"||(m=u.keys?u.keys.length:"values"in u&&u.values?u.values.length:1,g.numFailures===m)?null:(m=r({},u),l(m.keys)&&(m.keys=m.keys.filter(function(w,E){return!(E in g.failures)})),"values"in m&&l(m.values)&&(m.values=m.values.filter(function(w,E){return!(E in g.failures)})),m)}function Tc(c,u){return g=c,((m=u).lower===void 0||(m.lowerOpen?0<jt(g,m.lower):0<=jt(g,m.lower)))&&(g=c,(m=u).upper===void 0||(m.upperOpen?jt(g,m.upper)<0:jt(g,m.upper)<=0));var g,m}function yf(c,u,g,m,w,E){var R,U,de,xe,fe,oe;return!g||g.length===0||(R=u.query.index,U=R.multiEntry,de=u.query.range,xe=m.schema.primaryKey.extractKey,fe=R.extractKey,oe=(R.lowLevelIndex||R).extractKey,(m=g.reduce(function(ge,me){var ve=ge,ue=[];if(me.type==="add"||me.type==="put")for(var Se=new Dn,Ae=me.values.length-1;0<=Ae;--Ae){var we,Ce=me.values[Ae],Re=xe(Ce);!Se.hasKey(Re)&&(we=fe(Ce),U&&l(we)?we.some(function(Qe){return Tc(Qe,de)}):Tc(we,de))&&(Se.addKey(Re),ue.push(Ce))}switch(me.type){case"add":var We=new Dn().addKeys(u.values?ge.map(function(He){return xe(He)}):ge),ve=ge.concat(u.values?ue.filter(function(He){return He=xe(He),!We.hasKey(He)&&(We.addKey(He),!0)}):ue.map(function(He){return xe(He)}).filter(function(He){return!We.hasKey(He)&&(We.addKey(He),!0)}));break;case"put":var Ye=new Dn().addKeys(me.values.map(function(He){return xe(He)}));ve=ge.filter(function(He){return!Ye.hasKey(u.values?xe(He):He)}).concat(u.values?ue:ue.map(function(He){return xe(He)}));break;case"delete":var ze=new Dn().addKeys(me.keys);ve=ge.filter(function(He){return!ze.hasKey(u.values?xe(He):He)});break;case"deleteRange":var et=me.range;ve=ge.filter(function(He){return!Tc(xe(He),et)})}return ve},c))===c)?c:(m.sort(function(ge,me){return jt(oe(ge),oe(me))||jt(xe(ge),xe(me))}),u.limit&&u.limit<1/0&&(m.length>u.limit?m.length=u.limit:c.length===u.limit&&m.length<u.limit&&(w.dirty=!0)),E?Object.freeze(m):m)}function _f(c,u){return jt(c.lower,u.lower)===0&&jt(c.upper,u.upper)===0&&!!c.lowerOpen==!!u.lowerOpen&&!!c.upperOpen==!!u.upperOpen}function Am(c,u){return((g,m,w,E)=>{if(g===void 0)return m!==void 0?-1:0;if(m===void 0)return 1;if((g=jt(g,m))===0){if(w&&E)return 0;if(w)return 1;if(E)return-1}return g})(c.lower,u.lower,c.lowerOpen,u.lowerOpen)<=0&&0<=((g,m,w,E)=>{if(g===void 0)return m!==void 0?1:0;if(m===void 0)return-1;if((g=jt(g,m))===0){if(w&&E)return 0;if(w)return-1;if(E)return 1}return g})(c.upper,u.upper,c.upperOpen,u.upperOpen)}function Tm(c,u,g,m){c.subscribers.add(g),m.addEventListener("abort",function(){var w,E;c.subscribers.delete(g),c.subscribers.size===0&&(w=c,E=u,setTimeout(function(){w.subscribers.size===0&&Y(E,w)},3e3))})}var Cm={stack:"dbcore",level:0,name:"Cache",create:function(c){var u=c.schema.name;return r(r({},c),{transaction:function(g,m,w){var E,R,U=c.transaction(g,m,w);return m==="readwrite"&&(w=(E=new AbortController).signal,U.addEventListener("abort",(R=function(de){return function(){if(E.abort(),m==="readwrite"){for(var xe=new Set,fe=0,oe=g;fe<oe.length;fe++){var ge=oe[fe],me=Va["idb://".concat(u,"/").concat(ge)];if(me){var ve=c.table(ge),ue=me.optimisticOps.filter(function(rt){return rt.trans===U});if(U._explicit&&de&&U.mutatedParts)for(var Se=0,Ae=Object.values(me.queries.query);Se<Ae.length;Se++)for(var we=0,Ce=(Ye=Ae[Se]).slice();we<Ce.length;we++)bc((ze=Ce[we]).obsSet,U.mutatedParts)&&(Y(Ye,ze),ze.subscribers.forEach(function(rt){return xe.add(rt)}));else if(0<ue.length){me.optimisticOps=me.optimisticOps.filter(function(rt){return rt.trans!==U});for(var Re=0,We=Object.values(me.queries.query);Re<We.length;Re++)for(var Ye,ze,et,Qe=0,He=(Ye=We[Re]).slice();Qe<He.length;Qe++)(ze=He[Qe]).res!=null&&U.mutatedParts&&(de&&!ze.dirty?(et=Object.isFrozen(ze.res),et=yf(ze.res,ze.req,ue,ve,ze,et),ze.dirty?(Y(Ye,ze),ze.subscribers.forEach(function(rt){return xe.add(rt)})):et!==ze.res&&(ze.res=et,ze.promise=De.resolve({result:et}))):(ze.dirty&&Y(Ye,ze),ze.subscribers.forEach(function(rt){return xe.add(rt)})))}}}xe.forEach(function(rt){return rt()})}}})(!1),{signal:w}),U.addEventListener("error",R(!1),{signal:w}),U.addEventListener("complete",R(!0),{signal:w})),U},table:function(g){var m=c.table(g),w=m.schema.primaryKey;return r(r({},m),{mutate:function(E){var R,U=Le.trans;return!w.outbound&&U.db._options.cache!=="disabled"&&!U.explicit&&U.idbtrans.mode==="readwrite"&&(R=Va["idb://".concat(u,"/").concat(g)])?(U=m.mutate(E),E.type!=="add"&&E.type!=="put"||!(50<=E.values.length||Ac(w,E).some(function(de){return de==null}))?(R.optimisticOps.push(E),E.mutatedParts&&Ro(E.mutatedParts),U.then(function(de){0<de.numFailures&&(Y(R.optimisticOps,E),(de=mf(0,E,de))&&R.optimisticOps.push(de),E.mutatedParts)&&Ro(E.mutatedParts)}),U.catch(function(){Y(R.optimisticOps,E),E.mutatedParts&&Ro(E.mutatedParts)})):U.then(function(de){var xe=mf(0,r(r({},E),{values:E.values.map(function(fe,oe){var ge;return de.failures[oe]?fe:(O(ge=(ge=w.keyPath)!=null&&ge.includes(".")?z(fe):r({},fe),w.keyPath,de.results[oe]),ge)})}),de);R.optimisticOps.push(xe),queueMicrotask(function(){return E.mutatedParts&&Ro(E.mutatedParts)})}),U):m.mutate(E)},query:function(E){var R,U,de,xe,fe,oe,ge;return pf(Le,m)&&gf("query",E)?(R=((de=Le.trans)==null?void 0:de.db._options.cache)==="immutable",U=(de=Le).requery,de=de.signal,oe=((me,ve,ue,Se)=>{var Ae=Va["idb://".concat(me,"/").concat(ve)];if(!Ae)return[];if(!(me=Ae.queries[ue]))return[null,!1,Ae,null];var we=me[(Se.query?Se.query.index.name:null)||""];if(!we)return[null,!1,Ae,null];switch(ue){case"query":var Ce=we.find(function(Re){return Re.req.limit===Se.limit&&Re.req.values===Se.values&&_f(Re.req.query.range,Se.query.range)});return Ce?[Ce,!0,Ae,we]:[we.find(function(Re){return("limit"in Re.req?Re.req.limit:1/0)>=Se.limit&&(!Se.values||Re.req.values)&&Am(Re.req.query.range,Se.query.range)}),!1,Ae,we];case"count":return Ce=we.find(function(Re){return _f(Re.req.query.range,Se.query.range)}),[Ce,!!Ce,Ae,we]}})(u,g,"query",E),ge=oe[0],xe=oe[2],fe=oe[3],ge&&oe[1]?ge.obsSet=E.obsSet:(oe=m.query(E).then(function(me){var ve=me.result;if(ge&&(ge.res=ve),R){for(var ue=0,Se=ve.length;ue<Se;++ue)Object.freeze(ve[ue]);Object.freeze(ve)}else me.result=z(ve);return me}).catch(function(me){return fe&&ge&&Y(fe,ge),Promise.reject(me)}),ge={obsSet:E.obsSet,promise:oe,subscribers:new Set,type:"query",req:E,dirty:!1},fe?fe.push(ge):(fe=[ge],(xe=xe||(Va["idb://".concat(u,"/").concat(g)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[E.query.index.name||""]=fe)),Tm(ge,fe,U,de),ge.promise.then(function(me){return{result:yf(me.result,E,xe==null?void 0:xe.optimisticOps,m,ge,R)}})):m.query(E)}})}})}};function zo(c,u){return new Proxy(c,{get:function(g,m,w){return m==="db"?u:Reflect.get(g,m,w)}})}pn.prototype.version=function(c){if(isNaN(c)||c<.1)throw new se.Type("Given version is not a positive number");if(c=Math.round(10*c)/10,this.idbdb||this._state.isBeingOpened)throw new se.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,c);var u=this._versions,g=u.filter(function(m){return m._cfg.version===c})[0];return g||(g=new this.Version(c),u.push(g),u.sort(mm),g.stores({}),this._state.autoSchema=!1),g},pn.prototype._whenReady=function(c){var u=this;return this.idbdb&&(this._state.openComplete||Le.letThrough||this._vip)?c():new De(function(g,m){if(u._state.openComplete)return m(new se.DatabaseClosed(u._state.dbOpenError));if(!u._state.isBeingOpened){if(!u._state.autoOpen)return void m(new se.DatabaseClosed);u.open().catch(be)}u._state.dbReadyPromise.then(g,m)}).then(c)},pn.prototype.use=function(w){var u=w.stack,g=w.create,m=w.level,w=w.name,E=(w&&this.unuse({stack:u,name:w}),this._middlewares[u]||(this._middlewares[u]=[]));return E.push({stack:u,create:g,level:m??10,name:w}),E.sort(function(R,U){return R.level-U.level}),this},pn.prototype.unuse=function(c){var u=c.stack,g=c.name,m=c.create;return u&&this._middlewares[u]&&(this._middlewares[u]=this._middlewares[u].filter(function(w){return m?w.create!==m:!!g&&w.name!==g})),this},pn.prototype.open=function(){var c=this;return ot(dt,function(){return wm(c)})},pn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var c=this._state,u=hn.indexOf(this);if(0<=u&&hn.splice(u,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}c.isBeingOpened||(c.dbReadyPromise=new De(function(g){c.dbReadyResolve=g}),c.openCanceller=new De(function(g,m){c.cancelOpen=m}))},pn.prototype.close=function(u){var u=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,g=this._state;u?(g.isBeingOpened&&g.cancelOpen(new se.DatabaseClosed),this._close(),g.autoOpen=!1,g.dbOpenError=new se.DatabaseClosed):(this._close(),g.autoOpen=this._options.autoOpen||g.isBeingOpened,g.openComplete=!1,g.dbOpenError=null)},pn.prototype.delete=function(c){var u=this,g=(c===void 0&&(c={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),m=this._state;return new De(function(w,E){function R(){u.close(c);var U=u._deps.indexedDB.deleteDatabase(u.name);U.onsuccess=_t(function(){var de,xe,fe;de=u._deps,xe=u.name,mc(fe=de.indexedDB)||xe===Hn||gc(fe,de.IDBKeyRange).delete(xe).catch(be),w()}),U.onerror=jr(E),U.onblocked=u._fireOnBlocked}if(g)throw new se.InvalidArgument("Invalid closeOptions argument to db.delete()");m.isBeingOpened?m.dbReadyPromise.then(R):R()})},pn.prototype.backendDB=function(){return this.idbdb},pn.prototype.isOpen=function(){return this.idbdb!==null},pn.prototype.hasBeenClosed=function(){var c=this._state.dbOpenError;return c&&c.name==="DatabaseClosed"},pn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pn.prototype,"tables",{get:function(){var c=this;return i(this._allTables).map(function(u){return c._allTables[u]})},enumerable:!1,configurable:!0}),pn.prototype.transaction=function(){var c=(function(u,g,m){var w=arguments.length;if(w<2)throw new se.InvalidArgument("Too few arguments");for(var E=new Array(w-1);--w;)E[w-1]=arguments[w];return m=E.pop(),[u,ke(E),m]}).apply(this,arguments);return this._transaction.apply(this,c)},pn.prototype._transaction=function(c,u,g){var m,w,E=this,R=Le.trans,U=(R&&R.db===this&&c.indexOf("!")===-1||(R=null),c.indexOf("?")!==-1);c=c.replace("!","").replace("?","");try{if(w=u.map(function(xe){if(xe=xe instanceof E.Table?xe.name:xe,typeof xe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xe}),c=="r"||c===zr)m=zr;else{if(c!="rw"&&c!=Ka)throw new se.InvalidArgument("Invalid transaction mode: "+c);m=Ka}if(R){if(R.mode===zr&&m===Ka){if(!U)throw new se.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");R=null}R&&w.forEach(function(xe){if(R&&R.storeNames.indexOf(xe)===-1){if(!U)throw new se.SubTransaction("Table "+xe+" not included in parent transaction.");R=null}}),U&&R&&!R.active&&(R=null)}}catch(xe){return R?R._promise(null,function(fe,oe){oe(xe)}):Ge(xe)}var de=(function xe(fe,oe,ge,me,ve){return De.resolve().then(function(){var we=Le.transless||Le,ue=fe._createTransaction(oe,ge,fe._dbSchema,me),we=(ue.explicit=!0,{trans:ue,transless:we});if(me)ue.idbtrans=me.idbtrans;else try{ue.create(),ue.idbtrans._explicit=!0,fe._state.PR1398_maxLoop=3}catch(Ce){return Ce.name===he.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,oe,ge,null,ve)})):Ge(Ce)}var Se,Ae=te(ve),we=(Ae&&Nn(),De.follow(function(){var Ce;(Se=ve.call(ue,ue))&&(Ae?(Ce=br.bind(null,null),Se.then(Ce,Ce)):typeof Se.next=="function"&&typeof Se.throw=="function"&&(Se=Sc(Se)))},we));return(Se&&typeof Se.then=="function"?De.resolve(Se).then(function(Ce){return ue.active?Ce:Ge(new se.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):we.then(function(){return Se})).then(function(Ce){return me&&ue._resolve(),ue._completion.then(function(){return Ce})}).catch(function(Ce){return ue._reject(Ce),Ge(Ce)})})}).bind(null,this,m,w,R,g);return R?R._promise(m,de,"lock"):Le.trans?ot(Le.transless,function(){return E._whenReady(de)}):this._whenReady(de)},pn.prototype.table=function(c){if(p(this._allTables,c))return this._allTables[c];throw new se.InvalidTable("Table ".concat(c," does not exist"))};var na=pn;function pn(c,u){var g,m,w,E,R,U=this,de=(this._middlewares={},this.verno=0,pn.dependencies),de=(this._options=u=r({addons:pn.addons,autoOpen:!0,indexedDB:de.indexedDB,IDBKeyRange:de.IDBKeyRange,cache:"cloned"},u),this._deps={indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange},u.addons),xe=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:be,dbReadyPromise:null,cancelOpen:be,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:u.autoOpen}),fe=(xe.dbReadyPromise=new De(function(oe){xe.dbReadyResolve=oe}),xe.openCanceller=new De(function(oe,ge){xe.cancelOpen=ge}),this._state=xe,this.name=c,this.on=di(this,"populate","blocked","versionchange","close",{ready:[Ne,be]}),this.once=function(oe,ge){var me=function(){for(var ve=[],ue=0;ue<arguments.length;ue++)ve[ue]=arguments[ue];U.on(oe).unsubscribe(me),ge.apply(U,ve)};return U.on(oe,me)},this.on.ready.subscribe=W(this.on.ready.subscribe,function(oe){return function(ge,me){pn.vip(function(){var ve,ue=U._state;ue.openComplete?(ue.dbOpenError||De.resolve().then(ge),me&&oe(ge)):ue.onReadyBeingFired?(ue.onReadyBeingFired.push(ge),me&&oe(ge)):(oe(ge),ve=U,me||oe(function Se(){ve.on.ready.unsubscribe(ge),ve.on.ready.unsubscribe(Se)}))})}}),this.Collection=(g=this,fi(um.prototype,function(Se,ue){this.db=g;var me=ci,ve=null;if(ue)try{me=ue()}catch(we){ve=we}var ue=Se._ctx,Se=ue.table,Ae=Se.hook.reading.fire;this._ctx={table:Se,index:ue.index,isPrimKey:!ue.index||Se.schema.primKey.keyPath&&ue.index===Se.schema.primKey.name,range:me,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ve,or:ue.or,valueMapper:Ae!==Me?Ae:null}})),this.Table=(m=this,fi($d.prototype,function(oe,ge,me){this.db=m,this._tx=me,this.name=oe,this.schema=ge,this.hook=m._allTables[oe]?m._allTables[oe].hook:di(null,{creating:[ut,be],reading:[Ve,Me],updating:[Oe,be],deleting:[Fe,be]})})),this.Transaction=(w=this,fi(vm.prototype,function(oe,ge,me,ve,ue){var Se=this;oe!=="readonly"&&ge.forEach(function(Ae){Ae=(Ae=me[Ae])==null?void 0:Ae.yProps,Ae&&(ge=ge.concat(Ae.map(function(we){return we.updatesTable})))}),this.db=w,this.mode=oe,this.storeNames=ge,this.schema=me,this.chromeTransactionDurability=ve,this.idbtrans=null,this.on=di(this,"complete","error","abort"),this.parent=ue||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new De(function(Ae,we){Se._resolve=Ae,Se._reject=we}),this._completion.then(function(){Se.active=!1,Se.on.complete.fire()},function(Ae){var we=Se.active;return Se.active=!1,Se.on.error.fire(Ae),Se.parent?Se.parent._reject(Ae):we&&Se.idbtrans&&Se.idbtrans.abort(),Ge(Ae)})})),this.Version=(E=this,fi(bm.prototype,function(oe){this.db=E,this._cfg={version:oe,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,fi(af.prototype,function(oe,ge,me){if(this.db=R,this._ctx={table:oe,index:ge===":id"?null:ge,or:me},this._cmp=this._ascending=jt,this._descending=function(ve,ue){return jt(ue,ve)},this._max=function(ve,ue){return 0<jt(ve,ue)?ve:ue},this._min=function(ve,ue){return jt(ve,ue)<0?ve:ue},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new se.MissingAPI})),this.on("versionchange",function(oe){0<oe.newVersion?console.warn("Another connection wants to upgrade database '".concat(U.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(U.name,"'. Closing db now to resume the delete request.")),U.close({disableAutoOpen:!1})}),this.on("blocked",function(oe){!oe.newVersion||oe.newVersion<oe.oldVersion?console.warn("Dexie.delete('".concat(U.name,"') was blocked")):console.warn("Upgrade '".concat(U.name,"' blocked by other connection holding version ").concat(oe.oldVersion/10))}),this._maxKey=pi(u.IDBKeyRange),this._createTransaction=function(oe,ge,me,ve){return new U.Transaction(oe,ge,me,U._options.chromeTransactionDurability,ve)},this._fireOnBlocked=function(oe){U.on("blocked").fire(oe),hn.filter(function(ge){return ge.name===U.name&&ge!==U&&!ge._state.vcFired}).map(function(ge){return ge.on("versionchange").fire(oe)})},this.use(Sm),this.use(Cm),this.use(Em),this.use(xm),this.use(km),new Proxy(this,{get:function(oe,ge,me){var ve;return ge==="_vip"||(ge==="table"?function(ue){return zo(U.table(ue),fe)}:(ve=Reflect.get(oe,ge,me))instanceof $d?zo(ve,fe):ge==="tables"?ve.map(function(ue){return zo(ue,fe)}):ge==="_createTransaction"?function(){return zo(ve.apply(this,arguments),fe)}:ve)}}));this.vip=fe,de.forEach(function(oe){return oe(U)})}var jo,Ps=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Im=(Cc.prototype.subscribe=function(c,u,g){return this._subscribe(c&&typeof c!="function"?c:{next:c,error:u,complete:g})},Cc.prototype[Ps]=function(){return this},Cc);function Cc(c){this._subscribe=c}try{jo={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{jo={indexedDB:null,IDBKeyRange:null}}function bf(c){var u,g=!1,m=new Im(function(w){var E=te(c),R,U=!1,de={},xe={},fe={get closed(){return U},unsubscribe:function(){U||(U=!0,R&&R.abort(),oe&&xa.storagemutated.unsubscribe(me))}},oe=(w.start&&w.start(fe),!1),ge=function(){return qe(ve)},me=function(ue){Do(de,ue),bc(xe,de)&&ge()},ve=function(){var ue,Se,Ae;!U&&jo.indexedDB&&(de={},ue={},R&&R.abort(),R=new AbortController,Ae=(we=>{var Ce=it();try{E&&Nn();var Re=On(c,we);return Re=E?Re.finally(br):Re}finally{Ce&&ct()}})(Se={subscr:ue,signal:R.signal,requery:ge,querier:c,trans:null}),Promise.resolve(Ae).then(function(we){g=!0,u=we,U||Se.signal.aborted||(de={},(Ce=>{for(var Re in Ce)if(p(Ce,Re))return;return 1})(xe=ue)||oe||(xa(hi,me),oe=!0),qe(function(){return!U&&w.next&&w.next(we)}))},function(we){g=!1,["DatabaseClosedError","AbortError"].includes(we==null?void 0:we.name)||U||qe(function(){U||w.error&&w.error(we)})}))};return setTimeout(ge,0),fe});return m.hasValue=function(){return g},m.getValue=function(){return u},m}var Ua=na;function Ic(c){var u=ka;try{ka=!0,xa.storagemutated.fire(c),kc(c,!0)}finally{ka=u}}h(Ua,r(r({},re),{delete:function(c){return new Ua(c,{addons:[]}).delete()},exists:function(c){return new Ua(c,{addons:[]}).open().then(function(u){return u.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(c){try{return u=Ua.dependencies,g=u.indexedDB,u=u.IDBKeyRange,(mc(g)?Promise.resolve(g.databases()).then(function(m){return m.map(function(w){return w.name}).filter(function(w){return w!==Hn})}):gc(g,u).toCollection().primaryKeys()).then(c)}catch{return Ge(new se.MissingAPI)}var u,g},defineClass:function(){return function(c){d(this,c)}},ignoreTransaction:function(c){return Le.trans?ot(Le.transless,c):c()},vip:yc,async:function(c){return function(){try{var u=Sc(c.apply(this,arguments));return u&&typeof u.then=="function"?u:De.resolve(u)}catch(g){return Ge(g)}}},spawn:function(c,u,g){try{var m=Sc(c.apply(g,u||[]));return m&&typeof m.then=="function"?m:De.resolve(m)}catch(w){return Ge(w)}},currentTransaction:{get:function(){return Le.trans||null}},waitFor:function(c,u){return c=De.resolve(typeof c=="function"?Ua.ignoreTransaction(c):c).timeout(u||6e4),Le.trans?Le.trans.waitFor(c):c},Promise:De,debug:{get:function(){return Be},set:function(c){Ke(c)}},derive:S,extend:d,props:h,override:W,Events:di,on:xa,liveQuery:bf,extendObservabilitySet:Do,getByKeyPath:B,setByKeyPath:O,delByKeyPath:function(c,u){typeof u=="string"?O(c,u,void 0):"length"in u&&[].map.call(u,function(g){O(c,g,void 0)})},shallowClone:J,deepClone:z,getObjectDiff:Ec,cmp:jt,asap:H,minKey:-1/0,addons:[],connections:hn,errnames:he,dependencies:jo,cache:Va,semVer:"4.3.0",version:"4.3.0".split(".").map(function(c){return parseInt(c)}).reduce(function(c,u,g){return c+u/Math.pow(10,2*g)})})),Ua.maxKey=pi(Ua.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(xa(hi,function(c){ka||(c=new CustomEvent(cc,{detail:c}),ka=!0,dispatchEvent(c),ka=!1)}),addEventListener(cc,function(c){c=c.detail,ka||Ic(c)}));var Ms,ka=!1,wf=function(){};return typeof BroadcastChannel<"u"&&((wf=function(){(Ms=new BroadcastChannel(cc)).onmessage=function(c){return c.data&&Ic(c.data)}})(),typeof Ms.unref=="function"&&Ms.unref(),xa(hi,function(c){ka||Ms.postMessage(c)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(c){if(!na.disableBfCache&&c.persisted){Be&&console.debug("Dexie: handling persisted pagehide"),Ms!=null&&Ms.close();for(var u=0,g=hn;u<g.length;u++)g[u].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(c){!na.disableBfCache&&c.persisted&&(Be&&console.debug("Dexie: handling persisted pageshow"),wf(),Ic({all:new Dn(-1/0,[[]])}))})),De.rejectionMapper=function(c,u){return!c||c instanceof K||c instanceof TypeError||c instanceof SyntaxError||!c.name||!Te[c.name]?c:(u=new Te[c.name](u||c.message,c),"stack"in c&&x(u,"stack",{get:function(){return this.inner.stack}}),u)},Ke(Be),r(na,Object.freeze({__proto__:null,Dexie:na,Entity:Yd,PropModification:ui,RangeSet:Dn,add:function(c){return new ui({add:c})},cmp:jt,default:na,liveQuery:bf,mergeRanges:yi,rangesOverlap:uf,remove:function(c){return new ui({remove:c})},replacePrefix:function(c,u){return new ui({replacePrefix:[c,u]})}}),{default:na}),na})})(al)),al.exports}var x_=w_();const bu=__(x_),qf=Symbol.for("Dexie"),Rn=globalThis[qf]||(globalThis[qf]=bu);if(bu.semVer!==Rn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${bu.semVer} and ${Rn.semVer}`);const{liveQuery:o3,mergeRanges:l3,rangesOverlap:c3,RangeSet:u3,cmp:d3,Entity:f3,PropModification:v3,replacePrefix:h3,add:p3,remove:g3,DexieYProvider:m3}=Rn,lt=new Rn("me-ai-store");lt.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});lt.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});lt.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});lt.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});lt.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});lt.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function dd(t,e){return`${t}:${e}`}const k_=Object.freeze(Object.defineProperty({__proto__:null,db:lt,makeItemId:dd},Symbol.toStringTag,{value:"Module"}));async function Ki(t,e=null){try{const n=await lt.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Hi(t,e){try{await lt.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function fd(t){try{await lt.settings.delete(t)}catch{}}async function S_(t){const e=await lt.settings.bulkGet(t);return Object.fromEntries(t.map((n,r)=>{var a;return[n,((a=e[r])==null?void 0:a.value)??null]}))}const ba=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Ki,getSettings:S_,removeSetting:fd,setSetting:Hi},Symbol.toStringTag,{value:"Module"})),Xr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function vd(t){return Xr.find(e=>e.id===t)}const E_=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Xr,getModelInfo:vd},Symbol.toStringTag,{value:"Module"})),Zr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function dp(){return Zr.filter(t=>t.recommended)}function hd(t){return Zr.find(e=>e.name===t||e.name.startsWith(t+":"))}const A_=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Zr,getOllamaModelInfo:hd,getRecommendedOllamaModels:dp},Symbol.toStringTag,{value:"Module"}));let Yn=null,ua="idle",sl=null,Ya=new Set;function Ko(){return Yn||(Yn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Yn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(ua="loading"),e.status==="ready"&&(ua="ready"),e.status==="start"&&(ua="generating"),(e.status==="complete"||e.status==="error")&&(ua=sl?"ready":"idle");for(const n of Ya)try{n(e)}catch{}})),Yn}function zc(){return{check(){Ko().postMessage({type:"check"})},loadModel(t){sl=t,ua="loading",Ko().postMessage({type:"load",modelId:t})},generate(t,e){Ko().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,d=0;const f=p=>{switch(p.status){case"start":d=p.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:d});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Ya.delete(f)};Ya.add(f),Ko().postMessage({type:"generate",data:t,options:e})})},interrupt(){Yn==null||Yn.postMessage({type:"interrupt"})},reset(){Yn==null||Yn.postMessage({type:"reset"})},onMessage(t){return Ya.add(t),()=>Ya.delete(t)},offMessage(t){Ya.delete(t)},get status(){return ua},get isReady(){return ua==="ready"},get isGenerating(){return ua==="generating"},get modelId(){return sl},terminate(){Yn==null||Yn.terminate(),Yn=null,ua="idle",sl=null,Ya.clear()}}}const T_="modulepreload",C_=function(t){return"/me-ai/"+t},Bf={},er=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(f){return Promise.all(f.map(v=>Promise.resolve(v).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=i(n.map(f=>{if(f=C_(f),f in Bf)return;Bf[f]=!0;const v=f.endsWith(".css"),p=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${p}`))return;const h=document.createElement("link");if(h.rel=v?"stylesheet":T_,v||(h.as="script"),h.crossOrigin="",h.href=f,d&&h.setAttribute("nonce",d),document.head.appendChild(h),v)return new Promise((y,x)=>{h.addEventListener("load",y),h.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${f}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},Ff="http://localhost:11434",I_="https://me-ai.metaelon.space";function fp(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?Ff:I_}catch{return Ff}}function po(){return fp()}async function P_(){const{getSetting:t}=await er(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>ba);return{getSetting:e}},void 0);return await t("ollamaUrl")||fp()}async function M_(t){const{setSetting:e}=await er(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>ba);return{setSetting:n}},void 0);await e("ollamaUrl",t)}async function wu(t=po()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function O_(t=po()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function N_(t,e,{temperature:n=.7,maxTokens:r=4096,keepAlive:a}={},s=()=>{},i=po()){var x;const l={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:r}};a!==void 0?l.keep_alive=a:l.keep_alive="10m";const d=new AbortController,f=setTimeout(()=>d.abort(),3e5),v=await fetch(`${i}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),signal:d.signal});if(clearTimeout(f),!v.ok){const S=await v.text();throw new Error(`Ollama API error: ${S}`)}const p=v.body.getReader(),h=new TextDecoder;let y="";try{for(;;){const{done:S,value:A}=await p.read();if(S)break;const L=h.decode(A).split(`
`).filter(Boolean);for(const W of L)try{const k=JSON.parse(W);if((x=k.message)!=null&&x.content&&(y+=k.message.content,s({content:k.message.content,done:!1,total_duration:k.total_duration,eval_count:k.eval_count,eval_duration:k.eval_duration})),k.done){s({content:"",done:!0,total_duration:k.total_duration,eval_count:k.eval_count,eval_duration:k.eval_duration});break}}catch{}}}finally{p.releaseLock()}return y}let rr="idle",Os=null,Xa=new Set;function xr(t){for(const e of Xa)try{e(t)}catch{}}function D_(){return{async check(){rr="loading",xr({status:"loading",data:"Testing Ollama connection..."});const t=await wu();t.connected?(rr="idle",xr({status:"ready",data:{type:"ollama",version:t.version,url:po()}})):(rr="idle",xr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Os=t,rr="loading",xr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await wu();if(!e.connected){rr="idle",Os=null,xr({status:"error",data:`Ollama not available: ${e.error}`});return}rr="ready",xr({status:"ready"})},async generate(t,e={}){if(!Os){xr({status:"error",data:"No Ollama model selected"});return}rr="generating",xr({status:"start",inputTokens:0});let n=0,r=performance.now();try{await N_(Os,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},a=>{if(a.content){n++;const s=performance.now()-r,i=s>0?n/s*1e3:0;xr({status:"update",output:a.content,tps:Math.round(i*10)/10,numTokens:n})}a.done&&(rr="ready",xr({status:"complete",tps:a.eval_duration?Math.round(a.eval_count/(a.eval_duration/1e9)*10)/10:null,numTokens:a.eval_count||n}))})}catch(a){rr="ready",xr({status:"error",data:a.message})}},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,d=0;const f=p=>{switch(p.status){case"start":d=p.inputTokens||0;break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:d});break;case"error":v(),a(new Error(p.data));break}},v=()=>{Xa.delete(f)};Xa.add(f),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return Xa.add(t),()=>Xa.delete(t)},offMessage(t){Xa.delete(t)},get status(){return rr},get isReady(){return rr==="ready"},get isGenerating(){return rr==="generating"},get modelId(){return Os},get backend(){return"ollama"},terminate(){rr="idle",Os=null,Xa.clear()}}}let Wa=null,Ct=null,jc=new Set;function R_(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function vp(){return{loadModel(t){const e=R_(t);if(Wa!==e){Ct&&Ct.terminate(),Wa=e,Ct=e==="webgpu"?zc():D_();for(const n of jc)Ct.onMessage(n)}Ct.loadModel(t)},check(){Ct||(Ct=zc(),Wa="webgpu"),Ct.check()},generate(t,e){if(!Ct)throw new Error("No engine loaded. Call loadModel() first.");return Ct.generate(t,e)},generateFull(t,e,n){return Ct?Ct.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Ct==null||Ct.interrupt()},reset(){Ct==null||Ct.reset()},onMessage(t){return Ct||(Ct=zc(),Wa="webgpu"),jc.add(t),Ct.onMessage(t)},offMessage(t){jc.delete(t),Ct==null||Ct.offMessage(t)},get status(){return(Ct==null?void 0:Ct.status)||"idle"},get isReady(){return(Ct==null?void 0:Ct.isReady)||!1},get isGenerating(){return(Ct==null?void 0:Ct.isGenerating)||!1},get modelId(){return(Ct==null?void 0:Ct.modelId)||null},get backend(){return Wa},getModelInfo(){const t=this.modelId;return t?Wa==="webgpu"?vd(t):hd(t):null},terminate(){Ct==null||Ct.terminate(),Ct=null,Wa=null}}}function xu(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,r)).toFixed(1)+" "+n[r]}function qc(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e)),a=t/Math.pow(e,r),s=r>=2?2:r>=1?1:0;return a.toFixed(s)+" "+n[r]}function L_(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function z_(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Vl(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const j_="https://gmail.googleapis.com/gmail/v1/users/me";class pd extends Error{constructor(e,n,r){super(e),this.name="GmailApiError",this.status=n,this.code=r||null}}function q_(t){return{Authorization:`Bearer ${t}`}}async function Ul(t,e){var r,a,s,i;const n=await fetch(`${j_}${e}`,{headers:q_(t)});if(!n.ok){const l=await n.json().catch(()=>({})),d=((r=l.error)==null?void 0:r.message)||`Gmail API error: ${n.status}`,f=((i=(s=(a=l.error)==null?void 0:a.errors)==null?void 0:s[0])==null?void 0:i.reason)||void 0;throw new pd(d,n.status,f)}return n.json()}function hp(t){return Ul(t,"/profile")}function pp(t,{maxResults:e=20,pageToken:n,q:r}={}){const a=new URLSearchParams;return a.set("maxResults",String(e)),n&&a.set("pageToken",n),r&&a.set("q",r),Ul(t,`/messages?${a}`)}function gp(t,e,n="full"){return Ul(t,`/messages/${e}?format=${n}`)}function B_(t,{startHistoryId:e,pageToken:n,maxResults:r=500}={}){const a=new URLSearchParams;return a.set("startHistoryId",e),a.set("maxResults",String(r)),a.append("historyTypes","messageAdded"),a.append("historyTypes","messageDeleted"),n&&a.set("pageToken",n),Ul(t,`/history?${a}`)}function Ea(t,e){var s;const n=((s=t==null?void 0:t.payload)==null?void 0:s.headers)||[],r=e.toLowerCase(),a=n.find(i=>i.name.toLowerCase()===r);return(a==null?void 0:a.value)||""}function zi(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const r=atob(e),a=Uint8Array.from(r,s=>s.charCodeAt(0));return new TextDecoder().decode(a)}function F_(t){var s,i,l;const e=t==null?void 0:t.payload;if(!e)return"";if((s=e.body)!=null&&s.data)return zi(e.body.data);const n=e.parts||[],r=gl(n,"text/plain");if((i=r==null?void 0:r.body)!=null&&i.data)return zi(r.body.data);const a=gl(n,"text/html");if((l=a==null?void 0:a.body)!=null&&l.data){const d=zi(a.body.data);return H_(d)}return"(no body)"}function K_(t){var a,s;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((a=e.body)!=null&&a.data))return zi(e.body.data);const n=e.parts||[],r=gl(n,"text/html");return(s=r==null?void 0:r.body)!=null&&s.data?zi(r.body.data):null}function gl(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const r=gl(n.parts,e);if(r)return r}}return null}function H_(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function gd(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function mp(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function yp(t){return mp(t).charAt(0).toUpperCase()}function V_(t){try{const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}catch{return"email"}}function U_(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function _p(t,e){return`${V_(t.date)}_${U_(t.subject)}.${e}`}function bp(t){const e={};for(const r of t){const a=r.action||"UNKNOWN";e[a]||(e[a]=[]),e[a].push(r)}for(const r of Object.keys(e))e[r].sort((a,s)=>(s.date||0)-(a.date||0));const n=Object.keys(e).sort((r,a)=>e[a].length-e[r].length);return{groups:e,order:n}}async function G_(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:r,newest:a}=await wp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`Date range: ${s} to ${i}.`)}return n.join(" ")}async function W_(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:r,newest:a}=await wp();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`- **Date range:** ${s} â ${i}`)}return n.join(`
`)}async function Y_(t=10){const e=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(xp).join(`

---

`)}async function X_(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),a=(await lt.items.where("sourceType").equals("gmail").toArray()).map(s=>{var l,d,f,v,p;let i=0;return(l=s.subject)!=null&&l.toLowerCase().includes(n)&&(i+=3),(d=s.from)!=null&&d.toLowerCase().includes(n)&&(i+=2),(f=s.to)!=null&&f.toLowerCase().includes(n)&&(i+=2),(v=s.snippet)!=null&&v.toLowerCase().includes(n)&&(i+=1),(p=s.body)!=null&&p.toLowerCase().includes(n)&&(i+=1),{item:s,score:i}}).filter(({score:s})=>s>0).sort((s,i)=>i.score-s.score).slice(0,e);return a.length===0?`No results found for "${t}".`:a.map(({item:s})=>xp(s)).join(`

---

`)}async function Kf(){const t=await lt.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=bp(t);return{groups:e,order:n,total:t.length}}async function Z_({query:t,limit:e=50,offset:n=0}={}){if(t){const s=t.toLowerCase(),i=await lt.items.where("sourceType").equals("gmail").filter(l=>{var d,f,v,p;return((d=l.subject)==null?void 0:d.toLowerCase().includes(s))||((f=l.from)==null?void 0:f.toLowerCase().includes(s))||((v=l.to)==null?void 0:v.toLowerCase().includes(s))||((p=l.snippet)==null?void 0:p.toLowerCase().includes(s))}).toArray();return i.sort((l,d)=>(d.date||0)-(l.date||0)),{items:i.slice(n,n+e),total:i.length}}const r=await lt.items.where("sourceType").equals("gmail").count();return{items:await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().offset(n).limit(e).toArray(),total:r}}async function wp(){const t=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).first(),e=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).last();return{oldest:t,newest:e}}function xp(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=z_(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function Q_(){const t=await G_();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function J_(t){const e=[],n=await W_();if(e.push(n),t){const r=await X_(t,5);e.push("","## Relevant Emails",r)}else{const r=await Y_(5);e.push("","## Recent Emails",r)}return e.join(`
`)}const tr={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},md="INFO",kp="me-ai-events",Sp="me-ai-event-groups";async function oi(){const{getSetting:t}=await er(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>ba);return{getSetting:e}},void 0);return await t(kp)||{}}async function Gl(t){const{setSetting:e}=await er(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>ba);return{setSetting:n}},void 0);await e(kp,t)}async function Wl(){const{getSetting:t}=await er(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>ba);return{getSetting:e}},void 0);return await t(Sp)||{}}async function Ep(t){const{setSetting:e}=await er(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>ba);return{setSetting:n}},void 0);await e(Sp,t)}async function $_(){try{const{db:t}=await er(async()=>{const{db:r}=await Promise.resolve().then(()=>k_);return{db:r}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(r=>r.action).filter(Boolean))].sort()}catch{return[]}}async function eb(){const t=await oi(),e=await $_();return[...new Set([...Object.keys(t),...e])].sort()}async function Vi(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await Wl())[e]||md}async function tb(t,e){const n=t.toUpperCase();if(!tr[e])throw new Error(`Unknown group: ${e}`);const r=await Wl();r[n]=e,await Ep(r)}async function nb(){return Wl()}async function Ap(t){const e=await Vi(t),n=tr[e]||tr[md];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function Dr(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await oi())[e]||[]}const Bc=Dr;async function rb(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await oi();e in n||(n[e]=[],await Gl(n))}async function ab(t,e,n){const r=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!r)return;const a=await oi(),s=await Wl();if(!(r in s)){const i=tr[e]?e:md;s[r]=i,await Ep(s)}if(!(r in a)){const{pluginRegistry:i}=await er(async()=>{const{pluginRegistry:v}=await Promise.resolve().then(()=>_b);return{pluginRegistry:v}},void 0),l=i.getAvailableActions("gmail"),d=Object.fromEntries(l.map(v=>[v.actionId,v])),f=(n||[]).filter(v=>d[v]).map(v=>({id:v,pluginId:"gmail",commandId:v,name:d[v].name,description:d[v].description}));a[r]=f,await Gl(a)}}async function sb(t){const e=t.toUpperCase(),n=await oi();delete n[e],await Gl(n)}async function yd(t,e){const n=t.toUpperCase(),r=await oi();r[n]=e,await Gl(r)}async function ib(t,e){const n=await Dr(t);await yd(t,[...n,e])}const Hf=ib;async function ob(t,e){const n=await Dr(t);await yd(t,n.filter(r=>r.id!==e))}const lb=ob;async function cb(t,e,n){const r=await Dr(t);await yd(t,r.map(a=>a.id===e?{...a,...n}:a))}const ub=cb;async function db(t,e){var a;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((a=e.body)==null?void 0:a.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},r=await Dr(t.action);return{event:n,commands:r}}async function fb(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:r,commands:a}=await db(n.classification,n.email);return{event:r,commands:a}})),content:""}}async function vb(t){const e=await Promise.all(t.order.map(async r=>{const a=t.groups[r]||[],s=await Dr(r),i=await Vi(r),l=a.map(d=>({emailId:d.emailId,subject:d.subject||"(no subject)",from:d.from||"",date:d.date,summary:d.summary||"",reason:d.reason||"",tags:d.tags||[],status:d.status||"pending"}));return{eventType:r,group:i,emails:l,commands:s}})),n=e.reduce((r,a)=>r+a.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class hb{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var a,s,i;const r=this.handlers.get(e);if(!r)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(a=n.onProgress)==null||a.call(n,{phase:"executing",actionId:e,actionName:r.name});const l=await r.execute(n);return(s=n.onProgress)==null||s.call(n,{phase:"completed",actionId:e,actionName:r.name,result:l}),l}catch(l){const d={success:!1,error:l,message:l.message||"Unknown error"};return(i=n.onProgress)==null||i.call(n,{phase:"failed",actionId:e,actionName:r.name,error:l.message}),d}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const pb="https://gmail.googleapis.com/gmail/v1/users/me",ra={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Vn(t,e,n,r=null){var i;const a={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};r&&(a.body=JSON.stringify(r));const s=await fetch(`${pb}${n}`,a);if(!s.ok){const d=((i=(await s.json().catch(()=>({}))).error)==null?void 0:i.message)||`Gmail API error: ${s.status}`;throw new Error(d)}return s.status===204?{success:!0}:s.json()}class gb extends hb{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}extractMessageId(e){const n=e.event.data.emailId||e.event.data.id;return n?n.startsWith("gmail:")?n.substring(6):n:null}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[ra.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[ra.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[ra.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[ra.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[ra.SPAM],removeLabelIds:[ra.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[ra.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[r]}),{success:!0,message:`Applied label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[r]}),{success:!0,message:`Removed label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[ra.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[ra.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,r=[],a=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Vn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:r,removeLabelIds:a}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Vn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const mb=new gb;let yb=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(mb)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const r=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,a=r.pluginId||this.resolvePluginId(n.event.source),s=r.commandId||r.id,i=this.getPlugin(a);return i?i.canExecute(s)?i.execute(s,n):{success:!1,message:`Command "${s}" not found in plugin "${i.serviceName}". Available: ${i.getHandlers().map(l=>l.actionId).join(", ")}`,error:new Error(`Command not supported: ${s}`)}:{success:!1,message:`Plugin "${a}" not found. Is it registered?`,error:new Error(`Plugin not found: ${a}`)}}async executePipeline(e,n){var d,f;const r=[];let a=!0;for(const v of e){(d=n.onProgress)==null||d.call(n,{phase:"action_start",actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId});const p=await this.executeAction(v,n);r.push({actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId,...p}),p.success||(a=!1),(f=n.onProgress)==null||f.call(n,{phase:"action_complete",actionId:v.id,actionName:v.name,result:p})}const i=r.filter(v=>!v.success).map(v=>{var p;return`${v.pluginId}Â·${v.commandId}: ${v.message||((p=v.error)==null?void 0:p.message)||"Unknown error"}`}).join("; "),l=r.filter(v=>v.success).map(v=>`${v.pluginId}Â·${v.commandId}`).join(", ");return{success:a,results:r,message:a?`Successfully executed: ${l}`:`Pipeline failed: ${i}`}}async executePipelineBatch(e,n,r){var l,d;const a=[];for(let f=0;f<n.length;f++){const v=n[f];(l=r.onProgress)==null||l.call(r,{phase:"batch_event_start",eventIndex:f,totalEvents:n.length,event:v});const p={...r,event:v},h=await this.executePipeline(e,p);a.push({event:v,...h}),(d=r.onProgress)==null||d.call(r,{phase:"batch_event_complete",eventIndex:f,totalEvents:n.length,event:v,result:h})}const s=a.filter(f=>f.success).length,i=a.filter(f=>!f.success).length;return{success:i===0,results:a,total:n.length,successful:s,failed:i,message:`Processed ${n.length} event(s): ${s} successful, ${i} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),r=this.getPlugin(n);return r?r.getHandlers():[]}getRequiredScopes(e,n){const r=this.resolvePluginId(n),a=this.getPlugin(r);return a?a.getRequiredScopes(e):[]}};const li=new yb,_b=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:li},Symbol.toStringTag,{value:"Module"})),bb=20,wb={maxTokens:512};function Tp(t){const e=[],n=[];for(const s of t)if(s.actions.length){e.push(`${s.pluginName} plugin:`);for(const i of s.actions)e.push(`  ${i.actionId.padEnd(22)} â ${i.name}: ${i.description}`),n.push(i.actionId)}const r=e.length?e.join(`
`):"  (no actions available)",a=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${r}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${a})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function Cp(){return li.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const Ip=Tp(Cp());async function Pp(t,{count:e=bb,force:n=!1,onProgress:r=()=>{},signal:a}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");r({phase:"loading",message:"Loading recent emails..."});let s,i=0;if(n)s=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().limit(e).toArray();else{const B=new Set(await lt.emailClassifications.toCollection().primaryKeys());i=0,s=[],await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().until(()=>s.length>=e).each(O=>{B.has(O.id)?i++:s.push(O)})}if(s.length===0){const B=n?"No emails to scan.":`All emails already classified (${i} total). Use "Rescan All" to reclassify.`;return r({phase:"done",message:B,classified:0}),{scanned:0,classified:0,skipped:i,errors:0}}const l=Date.now(),d=performance.now();let f=0,v=0,p=0,h=0;const y=[],x=Cp(),S=Tp(x),A=new Set(x.flatMap(B=>B.actions.map(O=>O.actionId))),D=t.modelId,L=vd(D)||hd(D);if(!L)throw new Error(`Unknown model: ${D}`);if(!L.recommendedForEmailProcessing&&s.length>0){const{MODELS:B}=await er(async()=>{const{MODELS:ke}=await Promise.resolve().then(()=>E_);return{MODELS:ke}},void 0),{OLLAMA_MODELS:O}=await er(async()=>{const{OLLAMA_MODELS:ke}=await Promise.resolve().then(()=>A_);return{OLLAMA_MODELS:ke}},void 0),J=[...B.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.name),...O.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.displayName)],le=L.displayName||L.name;console.warn(`â ï¸ Current model (${le}) is not optimized for email processing. For best results with long emails, use: ${J.join(", ")}. Some emails may fail due to memory limits.`)}for(let B=0;B<s.length&&!(a!=null&&a.aborted);B++){const O=s[B],J=Np(O),le=[{role:"system",content:S},{role:"user",content:J}];r({phase:"scanning",current:B+1,total:s.length,classified:f,errors:v,results:y,email:{subject:O.subject,from:O.from,date:O.date},prompt:{system:Ip,user:J},systemPromptLength:S.length,live:null,lastResult:null,totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-d}});const ke=performance.now();try{const{text:j,tps:M,numTokens:z,inputTokens:C}=await t.generateFull(le,{maxTokens:512,enableThinking:!1,temperature:0},$=>{r({phase:"generating",current:B+1,total:s.length,classified:f,errors:v,results:y,email:{subject:O.subject,from:O.from,date:O.date},live:{tps:$.tps,numTokens:$.numTokens},streamingText:$.text||"",totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-d}})});p+=z,h+=C;const N=kb(j,A),I=performance.now()-ke;if(N){await lt.emailClassifications.put({emailId:O.id,action:N.action,group:N.group,reason:N.reason,summary:N.summary,tags:N.tags,subject:O.subject||"(no subject)",from:O.from||"",date:O.date,scannedAt:l,status:"pending"}),await ab(N.action,N.group,N.suggestedActions),f++;const $={success:!0,email:{subject:O.subject,from:O.from,date:O.date},classification:N,rawResponse:j,stats:{tps:M,numTokens:z,inputTokens:C,elapsed:I},promptSize:J.length};y.push($),r({phase:"classified",current:B+1,total:s.length,classified:f,errors:v,results:y,email:{subject:O.subject,from:O.from,date:O.date},result:N,rawResponse:j,emailStats:{tps:M,numTokens:z,inputTokens:C,elapsed:I},totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-d}})}}catch(j){console.error(`Triage email ${B+1} failed:`,j),v++;const M=j.message||String(j),z=M.length>200?M.slice(0,200)+"...":M;y.push({success:!1,email:{subject:O.subject,from:O.from,date:O.date},error:z,promptSize:J.length})}}const W=performance.now()-d,k=y.length>0?Math.round(y.reduce((B,O)=>B+O.promptSize,0)/y.length):0,H=y.filter(B=>{var O;return B.success&&((O=B.stats)==null?void 0:O.tps)}).length>0?Math.round(y.filter(B=>B.success).reduce((B,O)=>{var J;return B+(((J=O.stats)==null?void 0:J.tps)||0)},0)/y.filter(B=>{var O;return B.success&&((O=B.stats)==null?void 0:O.tps)}).length):null;return r({phase:"done",current:s.length,total:s.length,classified:f,errors:v,results:y,summary:{avgPromptSize:k,avgTps:H,systemPromptSize:S.length,processed:s.length,skipped:i,modelName:L.displayName||L.name,modelContextWindow:L.contextWindow,modelMaxEmailTokens:L.maxEmailTokens},totals:{outputTokens:p,inputTokens:h,elapsed:W}}),{scanned:s.length,classified:f,skipped:i,errors:v}}async function Mp(){const t=await lt.emailClassifications.toArray();return bp(t)}async function xb(){const t=await lt.emailClassifications.toArray(),e={total:t.length};for(const n of t){const r=n.action||"UNKNOWN";e[r]=(e[r]||0)+1}return e}async function ml(t,e){await lt.emailClassifications.update(t,{status:e})}async function Vf(){await lt.emailClassifications.clear()}async function _d(t){await lt.emailClassifications.where("action").equals(t).delete()}async function Op(t){await lt.emailClassifications.delete(t)}async function ku(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Np(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function kb(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const r=n.indexOf("{"),a=n.lastIndexOf("}");if(r===-1||a===-1||a<=r)return console.warn("Triage: no JSON object found in response"),null;const s=n.indexOf("[");if(s!==-1&&s<r)return console.warn("Triage: expected JSON object, got array"),null;const i=n.slice(r,a+1);try{const l=JSON.parse(i);if(!l||typeof l!="object"||Array.isArray(l))return null;const d=Sb(l.action);if(!d)return console.warn("Triage: missing or invalid action field"),null;const v=["NOISE","INFO","CRITICAL"].includes(l.group)?l.group:"INFO";let p=[];Array.isArray(l.suggestedActions)&&(p=l.suggestedActions.filter(y=>typeof y!="string"||!y.trim()?!1:e?e.has(y.trim()):!0).map(y=>y.trim()).slice(0,5)),p.length===0&&Array.isArray(l.suggestedActions)&&l.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",l.suggestedActions);let h=[];return Array.isArray(l.tags)&&(h=l.tags.filter(y=>typeof y=="string"&&y.trim()).map(y=>y.trim().toLowerCase()).slice(0,10)),{action:d,group:v,suggestedActions:p,reason:String(l.reason||"").slice(0,300),summary:String(l.summary||"").slice(0,500),tags:h}}catch(l){return console.warn("Triage: failed to parse JSON response:",l.message),null}}function Sb(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Su(t){return`hsl(${Vl(t)}, 55%, 55%)`}function Eb(t){return`hsl(${Vl(t)}, 40%, 35%)`}var Ab=q('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Tb=q('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function Cb(t,e){at(e,!0);let n=Ee(e,"backend",15,"webgpu"),r=Ee(e,"isWebGPUAvailable",3,!0);var a=Tb(),s=b(_(a),2),i=_(s);let l;i.__click=()=>n("webgpu");var d=b(i,2);let f;d.__click=()=>n("ollama");var v=b(s,2);{var p=h=>{var y=Ab();T(h,y)};pe(v,h=>{!r()&&n()==="webgpu"&&h(p)})}ie(()=>{l=Tt(i,1,"backend-btn svelte-1n2kfl0",null,l,{active:n()==="webgpu"}),i.disabled=!r(),f=Tt(d,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="ollama"})}),T(t,a),st()}Zt(["click"]);const Ib=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Uf(...t){Ib&&console.log("[debug]",...t)}function cr(t){return Uf(`[MOUNT] ${t}`),()=>Uf(`[DESTROY] ${t}`)}var Pb=q("<option> </option>"),Mb=q('<p class="model-description svelte-1p89qnn"> </p>'),Ob=q('<span class="current-badge svelte-1p89qnn">Current</span>'),Nb=q('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Db=q('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Rb=q('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),Lb=q('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),zb=q('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),jb=q('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),qb=q('<p class="error svelte-1p89qnn"> </p>'),Bb=q('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Fb(t,e){at(e,!0);let n=Ee(e,"selectedModel",15),r=Ee(e,"gpuInfo",3,null),a=Ee(e,"error",3,null);Sn(()=>cr("ModelSelector"));var s=Bb(),i=_(s),l=b(_(i),2),d=b(_(l),2);Nt(d,21,()=>Xr,Yt,(k,H)=>{var B=Pb(),O=_(B),J={};ie(()=>{ee(O,`${o(H).name??""} â ${o(H).size??""}`),J!==(J=o(H).id)&&(B.value=(B.__value=o(H).id)??"")}),T(k,B)});var f=b(d,2);{var v=k=>{const H=Q(()=>Xr.find(le=>le.id===n()));var B=sn(),O=Xe(B);{var J=le=>{var ke=Mb(),j=_(ke);ie(()=>ee(j,o(H).description)),T(le,ke)};pe(O,le=>{o(H)&&le(J)})}T(k,B)};pe(f,k=>{n()&&k(v)})}var p=b(l,2),h=b(_(p),2),y=_(h),x=b(_(y));Nt(x,21,()=>Xr,Yt,(k,H)=>{var B=Lb();let O;var J=_(B),le=_(J),ke=b(le);{var j=re=>{var G=Ob();T(re,G)};pe(ke,re=>{o(H).id===n()&&re(j)})}var M=b(J),z=_(M),C=_(z),N=b(M),I=_(N),$=b(N),Y=_($);{var X=re=>{var G=Nb();T(re,G)},V=re=>{var G=Db();T(re,G)},te=re=>{var G=Rb();T(re,G)};pe(Y,re=>{o(H).recommendedForEmailProcessing?re(X):o(H).maxEmailTokens>=6e3?re(V,1):re(te,!1)})}ie((re,G)=>{O=Tt(B,1,"svelte-1p89qnn",null,O,{selected:o(H).id===n()}),ee(le,`${o(H).name??""} `),ee(C,`${re??""}k`),ee(I,`~${G??""}k`)},[()=>(o(H).contextWindow/1024).toFixed(0),()=>(o(H).maxEmailTokens/1e3).toFixed(0)]),T(k,B)});var S=b(p,2);{var A=k=>{var H=jb(),B=b(_(H),2),O=_(B),J=b(_(O)),le=_(J),ke=b(O,2),j=b(_(ke)),M=_(j),z=b(ke,2);{var C=N=>{var I=zb(),$=b(_(I)),Y=_($);ie(X=>ee(Y,X),[()=>xu(r().limits.maxBufferSize)]),T(N,I)};pe(z,N=>{var I;(I=r().limits)!=null&&I.maxBufferSize&&N(C)})}ie(()=>{ee(le,r().vendor),ee(M,r().architecture)}),T(k,H)};pe(S,k=>{r()&&k(A)})}var D=b(S,2);{var L=k=>{var H=qb(),B=_(H);ie(()=>ee(B,a())),T(k,H)};pe(D,k=>{a()&&k(L)})}var W=b(D,2);W.__click=function(...k){var H;(H=e.onload)==null||H.apply(this,k)},ie(()=>W.disabled=a()),ho(d,n),T(t,s),st()}Zt(["click"]);var Kb=q('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),Hb=q('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),Vb=q('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),Ub=q("<div><!></div>"),Gb=q("<option> <!></option>"),Wb=q("<option> <!></option>"),Yb=q('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Xb=q('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Zb=q('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Qb=q('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Jb=q('<span class="current-badge svelte-1bvvk8o">Current</span>'),$b=q('<span class="installed-badge svelte-1bvvk8o">â</span>'),e0=q('<span class="rec-badge svelte-1bvvk8o">â</span>'),t0=q('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),n0=q('<p class="error svelte-1bvvk8o"> </p>'),r0=q('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function a0(t,e){at(e,!0);let n=Ee(e,"selectedModel",15),r=Ee(e,"error",15);const a=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let s=Pe(Xt(po())),i=Pe(!1),l=Pe(null),d=Pe(Xt([])),f=Pe(!1);kn(()=>{P_().then(K=>{P(s,K,!0),v()})});async function v(){P(i,!0),P(l,null);const K=await wu(o(s));P(l,K,!0),P(i,!1),K.connected&&p()}async function p(){P(f,!0);try{const K=await O_(o(s));P(d,K.map(ae=>ae.name),!0)}catch(K){console.error("Failed to load Ollama models:",K),P(d,[],!0)}P(f,!1)}function h(){M_(o(s)),v()}function y(){if(!n()){r("Please select a model");return}e.onload()}function x(K){return o(d).length?o(d).includes(K):!1}const S=dp();var A=r0(),D=_(A),L=_(D),W=b(_(L)),k=_(W),H=b(L,2),B=_(H);B.__change=h;var O=b(B,2);O.__click=v;var J=_(O),le=b(H,2);{var ke=K=>{var ae=Ub();let Z;var ne=_(ae);{var he=se=>{var Te=Kb(),be=b(Xe(Te),2),Me=_(be);ie(()=>ee(Me,`Connected â¢ v${o(l).version??""}`)),T(se,Te)},_e=se=>{var Te=Vb(),be=b(Xe(Te),2),Me=_(be),Ve=_(Me),Je=b(Me,2);{var ut=Fe=>{var Oe=Hb(),je=b(_(Oe),2),Ne=_(je),Be=b(_(Ne));Be.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var Ke=b(Ne,2),$e=b(_(Ke));$e.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,T(Fe,Oe)};pe(Je,Fe=>{o(l).corsError&&Fe(ut)})}ie(()=>ee(Ve,`Disconnected: ${o(l).error??""}`)),T(se,Te)};pe(ne,se=>{o(l).connected?se(he):se(_e,!1)})}ie(()=>Z=Tt(ae,1,"connection-status svelte-1bvvk8o",null,Z,{connected:o(l).connected})),T(K,ae)};pe(le,K=>{o(l)&&K(ke)})}var j=b(D,2),M=b(_(j),2),z=_(M);Nt(z,21,()=>S,Yt,(K,ae)=>{var Z=Gb(),ne=_(Z),he=b(ne);{var _e=be=>{var Me=on("â");T(be,Me)},se=Q(()=>x(o(ae).name));pe(he,be=>{o(se)&&be(_e)})}var Te={};ie(be=>{ee(ne,`${o(ae).displayName??""} (${o(ae).params??""}) - ${be??""}k context `),Te!==(Te=o(ae).name)&&(Z.value=(Z.__value=o(ae).name)??"")},[()=>(o(ae).contextWindow/1024).toFixed(0)]),T(K,Z)});var C=b(z);Nt(C,21,()=>Zr.filter(K=>!K.recommended),Yt,(K,ae)=>{var Z=Wb(),ne=_(Z),he=b(ne);{var _e=be=>{var Me=on("â");T(be,Me)},se=Q(()=>x(o(ae).name));pe(he,be=>{o(se)&&be(_e)})}var Te={};ie(be=>{ee(ne,`${o(ae).displayName??""} (${o(ae).params??""}) - ${be??""}k context `),Te!==(Te=o(ae).name)&&(Z.value=(Z.__value=o(ae).name)??"")},[()=>(o(ae).contextWindow/1024).toFixed(0)]),T(K,Z)});var N=b(M,2);{var I=K=>{const ae=Q(()=>Zr.find(_e=>_e.name===n()));var Z=sn(),ne=Xe(Z);{var he=_e=>{var se=Qb(),Te=_(se),be=_(Te),Me=b(Te,2),Ve=_(Me),Je=_(Ve),ut=b(Ve,4),Fe=_(ut),Oe=b(ut,2);{var je=Ze=>{var Ue=Yb(),tt=b(Xe(Ue),2),nt=_(tt);ie(ft=>ee(nt,ft),[()=>o(ae).tags.join(", ")]),T(Ze,Ue)};pe(Oe,Ze=>{var Ue;(Ue=o(ae).tags)!=null&&Ue.length&&Ze(je)})}var Ne=b(Me,2);{var Be=Ze=>{var Ue=Xb(),tt=b(_(Ue),2),nt=_(tt);ie(()=>ee(nt,`ollama pull ${n()??""}`)),T(Ze,Ue)},Ke=Q(()=>!x(n())),$e=Ze=>{var Ue=Zb();T(Ze,Ue)};pe(Ne,Ze=>{o(Ke)?Ze(Be):Ze($e,!1)})}ie(Ze=>{ee(be,o(ae).description),ee(Je,`${Ze??""}k context`),ee(Fe,`${o(ae).params??""} params`)},[()=>(o(ae).contextWindow/1024).toFixed(0)]),T(_e,se)};pe(ne,_e=>{o(ae)&&_e(he)})}T(K,Z)};pe(N,K=>{n()&&K(I)})}var $=b(j,2),Y=b(_($),2),X=_(Y),V=b(_(X));Nt(V,21,()=>Zr,Yt,(K,ae)=>{var Z=t0();let ne;var he=_(Z),_e=_(he),se=b(_e);{var Te=Ze=>{var Ue=Jb();T(Ze,Ue)};pe(se,Ze=>{o(ae).name===n()&&Ze(Te)})}var be=b(se,2);{var Me=Ze=>{var Ue=$b();T(Ze,Ue)},Ve=Q(()=>x(o(ae).name));pe(be,Ze=>{o(Ve)&&Ze(Me)})}var Je=b(he),ut=_(Je),Fe=_(ut),Oe=b(Je),je=_(Oe),Ne=b(Oe),Be=_(Ne);{var Ke=Ze=>{var Ue=e0();T(Ze,Ue)};pe(Be,Ze=>{o(ae).recommended&&Ze(Ke)})}var $e=b(Be);ie((Ze,Ue,tt)=>{ne=Tt(Z,1,"svelte-1bvvk8o",null,ne,Ze),ee(_e,`${o(ae).displayName??""} `),ee(Fe,`${Ue??""}k`),ee(je,o(ae).params),ee($e,` ${tt??""}`)},[()=>({selected:o(ae).name===n(),installed:x(o(ae).name)}),()=>(o(ae).contextWindow/1024).toFixed(0),()=>o(ae).tags.slice(0,2).join(", ")]),T(K,Z)});var te=b($,2);{var re=K=>{var ae=n0(),Z=_(ae);ie(()=>ee(Z,r())),T(K,ae)};pe(te,K=>{r()&&K(re)})}var G=b(te,2);G.__click=y,ie(()=>{var K;ee(k,a?"ð¥ local":"âï¸ remote"),xt(B,"placeholder",a?"http://localhost:11434":"https://me-ai.metaelon.space"),O.disabled=o(i),ee(J,o(i)?"Testing...":"Test"),G.disabled=!((K=o(l))!=null&&K.connected)||r()}),fa(B,()=>o(s),K=>P(s,K)),ho(M,n),T(t,A),st()}Zt(["change","click"]);var s0=q('<span class="progress-percent svelte-r5fnze"> </span>'),i0=q('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),o0=q('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),l0=q('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),c0=q('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),u0=q('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),d0=q('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function f0(t,e){at(e,!0);let n=Ee(e,"message",3,""),r=Ee(e,"items",19,()=>[]);Sn(()=>cr("LoadingProgress"));var a=d0(),s=_(a),i=_(s),l=b(s,2);Nt(l,17,r,Yt,(d,f)=>{const v=Q(()=>o(f).total?L_(o(f).loaded||0,o(f).total):null);var p=u0(),h=_(p),y=_(h),x=_(y),S=b(y,2);{var A=k=>{var H=s0(),B=_(H);ie(O=>ee(B,`${O??""}%`),[()=>o(v).toFixed(1)]),T(k,H)};pe(S,k=>{o(v)!==null&&k(A)})}var D=b(h,2);{var L=k=>{var H=i0(),B=Xe(H),O=_(B),J=b(B,2),le=_(J),ke=_(le),j=b(le,4),M=_(j),z=b(j,2),C=_(z);ie((N,I,$,Y,X)=>{Dt(O,`width: ${N??""}%`),ee(ke,I),ee(M,$),ee(C,`(${Y??""} / ${X??""} B)`)},[()=>Math.max(o(f).progress??0,.5).toFixed(1),()=>qc(o(f).loaded||0),()=>qc(o(f).total),()=>(o(f).loaded||0).toLocaleString(),()=>o(f).total.toLocaleString()]),T(k,H)},W=k=>{var H=c0(),B=b(Xe(H),2),O=_(B);{var J=ke=>{var j=o0(),M=Xe(j),z=_(M),C=b(M,2),N=_(C);ie((I,$)=>{ee(z,I),ee(N,`(${$??""} B)`)},[()=>qc(o(f).loaded),()=>o(f).loaded.toLocaleString()]),T(ke,j)},le=ke=>{var j=l0();T(ke,j)};pe(O,ke=>{o(f).loaded?ke(J):ke(le,!1)})}T(k,H)};pe(D,k=>{o(f).total?k(L):k(W,!1)})}ie(()=>{xt(y,"title",o(f).file),ee(x,o(f).file)}),T(d,p)}),ie(()=>ee(i,n())),T(t,a),st()}var v0=q('<span class="thinking-tokens svelte-11gjw00"> </span>'),h0=q('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),p0=q('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),g0=q('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),m0=q('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),y0=q('<span class="cursor svelte-11gjw00">|</span>'),_0=q(" <!>",1),b0=q('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),w0=q('<div class="content svelte-11gjw00"> </div>'),x0=q('<div><div class="role svelte-11gjw00"> </div> <!></div>');function k0(t,e){at(e,!0);let n=Ee(e,"isLast",3,!1),r=Ee(e,"isRunning",3,!1),a=Ee(e,"generationPhase",3,null),s=Ee(e,"numTokens",3,null);Sn(()=>cr(`MessageBubble[${e.msg.role}]`));var i=x0(),l=_(i),d=_(l),f=b(l,2);{var v=h=>{var y=b0(),x=Xe(y);{var S=O=>{var J=h0(),le=b(_(J),4);{var ke=j=>{var M=v0(),z=_(M);ie(()=>ee(z,`${s()??""} tokens`)),T(j,M)};pe(le,j=>{s()&&j(ke)})}T(O,J)},A=O=>{var J=p0();T(O,J)};pe(x,O=>{r()&&n()&&a()==="thinking"?O(S):r()&&n()&&a()==="preparing"&&O(A,1)})}var D=b(x,2);{var L=O=>{var J=g0(),le=_(J),ke=b(_(le),2),j=_(ke),M=b(le,2),z=_(M);ie(C=>{ee(j,`${C??""} words`),ee(z,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),T(O,J)};pe(D,O=>{e.msg.thinking&&O(L)})}var W=b(D,2),k=_(W);{var H=O=>{var J=m0();T(O,J)},B=O=>{var J=_0(),le=Xe(J,!0),ke=b(le);{var j=M=>{var z=y0();T(M,z)};pe(ke,M=>{r()&&n()&&M(j)})}ie(()=>ee(le,e.msg.content)),T(O,J)};pe(k,O=>{r()&&n()&&!e.msg.content&&a()!=="thinking"?O(H):O(B,!1)})}T(h,y)},p=h=>{var y=w0(),x=_(y);ie(()=>ee(x,e.msg.content)),T(h,y)};pe(f,h=>{e.msg.role==="assistant"?h(v):h(p,!1)})}ie(()=>{Tt(i,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),ee(d,e.msg.role==="user"?"You":"AI")}),T(t,i),st()}Zt(["click"]);var S0=q('<div class="group svelte-1fa8qqq"> </div>'),E0=q('<div class="binding svelte-1fa8qqq"> </div>'),A0=q('<div class="binding unbound svelte-1fa8qqq">unbound</div>'),T0=q('<div class="connector svelte-1fa8qqq"><div class="line svelte-1fa8qqq"></div> <div class="arrow svelte-1fa8qqq">â¶</div></div> <div class="node action-node svelte-1fa8qqq"><div class="node-header action-header svelte-1fa8qqq"><span class="icon"> </span> </div> <div class="node-body svelte-1fa8qqq"><div class="desc svelte-1fa8qqq"> </div> <!></div></div>',1),C0=q('<div class="pipeline-graph svelte-1fa8qqq"><div class="node trigger-node svelte-1fa8qqq"><div class="node-header svelte-1fa8qqq"><span class="icon">â¡</span> Trigger</div> <div class="node-body svelte-1fa8qqq"><div class="label svelte-1fa8qqq"> </div> <!></div></div> <!></div>');function il(t,e){at(e,!0);let n=Ee(e,"commands",19,()=>[]);Ee(e,"executionState",3,null);let r=Q(()=>e.group?tr[e.group]:tr.INFO);var a=C0(),s=_(a);let i;var l=_(s);let d;var f=b(l,2),v=_(f),p=_(v),h=b(v,2);{var y=S=>{var A=S0();let D;var L=_(A);ie(()=>{D=Dt(A,"",D,{color:o(r).color}),ee(L,o(r).label)}),T(S,A)};pe(h,S=>{o(r)&&S(y)})}var x=b(s,2);Nt(x,17,n,Yt,(S,A)=>{var D=T0(),L=b(Xe(D),2),W=_(L),k=_(W),H=_(k),B=b(k),O=b(W,2),J=_(O),le=_(J),ke=b(J,2);{var j=z=>{var C=E0(),N=_(C);ie(()=>ee(N,`${o(A).pluginId??""}Â·${o(A).commandId??""}`)),T(z,C)},M=z=>{var C=A0();T(z,C)};pe(ke,z=>{o(A).pluginId&&o(A).commandId?z(j):z(M,!1)})}ie(()=>{ee(H,o(A).icon||"âï¸"),ee(B,` ${o(A).name??""}`),xt(J,"title",o(A).description),ee(le,o(A).description)}),T(S,D)}),ie(()=>{var S,A;i=Dt(s,"",i,{"border-color":(S=o(r))==null?void 0:S.color}),d=Dt(l,"",d,{background:(A=o(r))==null?void 0:A.color}),ee(p,e.eventType)}),T(t,a),st()}const Gf="https://accounts.google.com/gsi/client",I0="https://www.googleapis.com/auth/gmail.modify",bd="me-ai:oauth-token",wd=300*1e3;let Ui=null,ji=null,za=0;async function Dp(t,e){za=Date.now()+e*1e3;const{setSetting:n}=await er(async()=>{const{setSetting:r}=await Promise.resolve().then(()=>ba);return{setSetting:r}},void 0);await n(bd,{access_token:t,expires_at:za})}async function Eu(){za=0;const{removeSetting:t}=await er(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>ba);return{removeSetting:e}},void 0);await t(bd)}async function Yl(){try{const{getSetting:t}=await er(async()=>{const{getSetting:a}=await Promise.resolve().then(()=>ba);return{getSetting:a}},void 0),e=await t(bd);if(!e)return null;const{access_token:n,expires_at:r}=e;return!n||Date.now()>r-wd?(await Eu(),null):(za=r,{access_token:n})}catch{return await Eu(),null}}function P0(){return za>0&&Date.now()<za-wd}function M0(){return za<=0?0:Math.max(0,za-wd-Date.now())}function Wf(){return new Promise((t,e)=>{if(!Ui){e(new Error("Google Auth not initialized."));return}ji=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Dp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ui.requestAccessToken({prompt:""})})}function O0(){return new Promise((t,e)=>{var a,s;if((s=(a=window.google)==null?void 0:a.accounts)!=null&&s.oauth2){t();return}const n=document.querySelector(`script[src="${Gf}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const r=document.createElement("script");r.src=Gf,r.async=!0,r.defer=!0,r.onload=()=>t(),r.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async function Yf(t){await O0(),Ui=google.accounts.oauth2.initTokenClient({client_id:t,scope:I0,callback:e=>{ji&&(ji(e),ji=null)}})}function N0(){return new Promise((t,e)=>{if(!Ui){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}ji=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Dp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ui.requestAccessToken()})}async function D0(t){return await Eu(),new Promise(e=>{var n,r;(r=(n=window.google)==null?void 0:n.accounts)!=null&&r.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function Rp(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const r=await Ap(t.type);if(e==null||e({phase:"policy_check",group:r.group,policy:r}),r.requiresApproval&&!n){const f=await Dr(t.type);return{success:!1,requiresApproval:!0,group:r.group,actions:f,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const a=await Yl();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,i=await Dr(t.type);if(!i||i.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:i,actionCount:i.length});const l={accessToken:s,event:t,onProgress:e},d=await li.executePipeline(i,l);return e==null||e({phase:"done",result:d}),d}catch(r){return e==null||e({phase:"error",error:r.message}),{success:!1,error:r,message:r.message||"Unknown error"}}}async function Lp(t,e,n,r=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=await Ap(t);if(a.requiresApproval&&!r){const p=await Dr(t);return{success:!1,requiresApproval:!0,group:a.group,actions:p,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await Yl();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const i=s.access_token,l=await Dr(t);if(!l||l.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:l,actionCount:l.length});const d=e.map(p=>({type:t,source:"gmail",data:p})),f={accessToken:i,onProgress:n},v=await li.executePipelineBatch(l,d,f);return n==null||n({phase:"done",result:v}),v}catch(a){return n==null||n({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function zp(t){return li.getAvailableActions(t)}async function Au(){const t=await Yl();return!!(t!=null&&t.access_token)}const R0=Object.freeze(Object.defineProperty({__proto__:null,EVENT_GROUPS:tr,executePipeline:Rp,executePipelineBatch:Lp,getAvailableActions:zp,isAuthenticated:Au},Symbol.toStringTag,{value:"Module"}));var L0=q('<div class="event-subject svelte-1w66m1k"> </div>'),z0=q('<span class="sep svelte-1w66m1k">Â·</span> ',1),j0=q('<div class="event-summary svelte-1w66m1k"> </div>'),q0=q('<span class="tag svelte-1w66m1k"> </span>'),B0=q('<div class="event-tags svelte-1w66m1k"></div>'),F0=q('<div class="event-reason svelte-1w66m1k"> </div>'),K0=q("<button><!></button>"),H0=q('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),V0=q("<div> </div>"),U0=q('<div class="pipeline-header svelte-1w66m1k" style="margin-top: 0.5rem;"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div> <!>',1),G0=q('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),W0=q('<span class="event-subject-inline svelte-1w66m1k"> </span>'),Y0=q('<span class="sep svelte-1w66m1k">Â·</span> ',1),X0=q('<div class="event-summary svelte-1w66m1k"> </div>'),Z0=q('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div></div>'),Q0=q('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),J0=q('<span class="group-tier-chip svelte-1w66m1k"> </span>'),$0=q("<button><!></button>"),ew=q("<span> </span>"),tw=q('<span class="approval-action-desc svelte-1w66m1k"> </span>'),nw=q("<li><!> <strong> </strong> <!></li>"),rw=q('<ul class="approval-actions svelte-1w66m1k"></ul>'),aw=q(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),sw=q("<div> </div>"),iw=q('<span class="email-from svelte-1w66m1k"> </span>'),ow=q('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),lw=q('<div class="email-summary svelte-1w66m1k"> </div>'),cw=q('<span class="tag svelte-1w66m1k"> </span>'),uw=q('<div class="email-tags svelte-1w66m1k"></div>'),dw=q("<button><!></button>"),fw=q('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),vw=q('<div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div>'),hw=q('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Control Board</div>'),pw=q("<div> </div>"),gw=q('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),mw=q('<div class="group-emails svelte-1w66m1k"></div>'),yw=q('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),_w=q('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function bw(t,e){at(e,!0);let n=Pe(Xt({})),r=Xt({}),a=Pe(Xt({}));function s(k){if(!k)return"â";const H=k.replace(/<.*>/,"").trim();return H.length>40?H.slice(0,38)+"â¦":H}function i(k){if(!k)return"";try{return new Date(k).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}async function l(k,H,B=!1){if(!await Au()){alert("Please sign in to Gmail first (Dashboard page)");return}const O=`single_${H}`;r[O]={running:!0,progress:null,result:null};try{const J=await Rp(k,le=>{r[O]={...r[O],progress:le}},B);if(J.requiresApproval){r[O]={running:!1,progress:null,result:null},o(a)[O]={event:k,emailId:H,actions:J.actions,group:J.group,isBatch:!1};return}r[O]={running:!1,progress:null,result:J}}catch(J){r[O]={running:!1,progress:null,result:{success:!1,message:J.message}}}}async function d(k,H,B=!1){if(!await Au()){alert("Please sign in to Gmail first (Dashboard page)");return}const O=`batch_${k}`;r[O]={running:!0,progress:null,result:null};try{const J=await Lp(k,H,le=>{r[O]={...r[O],progress:le}},B);if(J.requiresApproval){r[O]={running:!1,progress:null,result:null},o(a)[O]={eventType:k,emails:H,actions:J.actions,group:J.group,isBatch:!0};return}r[O]={running:!1,progress:null,result:J}}catch(J){r[O]={running:!1,progress:null,result:{success:!1,message:J.message}}}}async function f(k){const H=o(a)[k];H&&(delete o(a)[k],P(a,{...o(a)},!0),H.isBatch?await d(H.eventType,H.emails,!0):await l(H.event,H.emailId,!0))}function v(k){delete o(a)[k],P(a,{...o(a)},!0)}function p(k){P(n,{...o(n),[k]:!o(n)[k]},!0)}function h(k){return k.split("_").map(H=>H.charAt(0)+H.slice(1).toLowerCase()).join(" ")}function y(k){return`hsl(${Vl(k)}, 55%, 55%)`}function x(k){return r[k]}var S=sn(),A=Xe(S);{var D=k=>{var H=G0(),B=_(H),O=_(B),J=_(O),le=_(J),ke=b(J,2),j=_(ke),M=b(O,2);{var z=ne=>{var he=L0(),_e=_(he);ie(()=>ee(_e,e.msg.event.data.subject)),T(ne,he)};pe(M,ne=>{var he;(he=e.msg.event.data)!=null&&he.subject&&ne(z)})}var C=b(M,2),N=_(C);{var I=ne=>{var he=on();ie(_e=>ee(he,_e),[()=>s(e.msg.event.data.from)]),T(ne,he)};pe(N,ne=>{var he;(he=e.msg.event.data)!=null&&he.from&&ne(I)})}var $=b(N,2);{var Y=ne=>{var he=z0(),_e=b(Xe(he),1,!0);ie(se=>ee(_e,se),[()=>i(e.msg.event.data.date)]),T(ne,he)};pe($,ne=>{var he;(he=e.msg.event.data)!=null&&he.date&&ne(Y)})}var X=b(C,2);{var V=ne=>{var he=j0(),_e=_(he);ie(()=>ee(_e,e.msg.event.metadata.summary)),T(ne,he)};pe(X,ne=>{var he;(he=e.msg.event.metadata)!=null&&he.summary&&ne(V)})}var te=b(X,2);{var re=ne=>{var he=B0();Nt(he,21,()=>e.msg.event.metadata.tags,Yt,(_e,se)=>{var Te=q0(),be=_(Te);ie(()=>ee(be,o(se))),T(_e,Te)}),T(ne,he)};pe(te,ne=>{var he,_e;(_e=(he=e.msg.event.metadata)==null?void 0:he.tags)!=null&&_e.length&&ne(re)})}var G=b(te,2);{var K=ne=>{var he=F0(),_e=_(he);ie(()=>ee(_e,e.msg.event.metadata.reason)),T(ne,he)};pe(G,ne=>{var he;(he=e.msg.event.metadata)!=null&&he.reason&&ne(K)})}var ae=b(B,2);{var Z=ne=>{const he=Q(()=>`single_${e.msg.event.data.emailId||Date.now()}`),_e=Q(()=>x(o(he))),se=Q(()=>o(a)[o(he)]),Te=Q(()=>{var Ke;return(Ke=e.msg.event.metadata)!=null&&Ke.group?tr[e.msg.event.metadata.group]:null});var be=U0(),Me=Xe(be),Ve=b(_(Me),2);{var Je=Ke=>{var $e=K0();let Ze;$e.__click=()=>l(e.msg.event,e.msg.event.data.emailId);var Ue=_($e);{var tt=vt=>{var kt=on("â³ Running...");T(vt,kt)},nt=vt=>{var kt=on();ie(()=>ee(kt,o(_e).result.success?"â Done":"â Failed")),T(vt,kt)},ft=vt=>{var kt=on("ð Review");T(vt,kt)},mt=vt=>{var kt=on("â¶ Execute");T(vt,kt)};pe(Ue,vt=>{var kt,bt,pt;(kt=o(_e))!=null&&kt.running?vt(tt):(bt=o(_e))!=null&&bt.result?vt(nt,1):(pt=o(Te))!=null&&pt.requiresApproval?vt(ft,2):vt(mt,!1)})}ie(()=>{var vt,kt;Ze=Tt($e,1,"execute-btn svelte-1w66m1k",null,Ze,{critical:(vt=o(Te))==null?void 0:vt.requiresApproval}),$e.disabled=(kt=o(_e))==null?void 0:kt.running}),T(Ke,$e)};pe(Ve,Ke=>{o(se)||Ke(Je)})}var ut=b(Me,2);{var Fe=Ke=>{var $e=H0(),Ze=b(_($e),4),Ue=_(Ze);Ue.__click=()=>f(o(he));var tt=b(Ue,2);tt.__click=()=>v(o(he)),T(Ke,$e)};pe(ut,Ke=>{o(se)&&Ke(Fe)})}var Oe=b(ut,2),je=_(Oe);{let Ke=Q(()=>{var $e;return($e=e.msg.event.metadata)==null?void 0:$e.group});il(je,{get eventType(){return e.msg.event.type},get group(){return o(Ke)},get commands(){return e.msg.commands}})}var Ne=b(Oe,2);{var Be=Ke=>{var $e=V0();let Ze;var Ue=_($e);ie(()=>{Ze=Tt($e,1,"execution-result svelte-1w66m1k",null,Ze,{success:o(_e).result.success,error:!o(_e).result.success}),ee(Ue,o(_e).result.message)}),T(Ke,$e)};pe(Ne,Ke=>{var $e;($e=o(_e))!=null&&$e.result&&Ke(Be)})}T(ne,be)};pe(ae,ne=>{var he;(he=e.msg.commands)!=null&&he.length&&ne(Z)})}ie(()=>{ee(le,e.msg.event.type),ee(j,e.msg.event.source)}),T(k,H)},L=k=>{var H=Q0(),B=_(H),O=_(B),J=_(O),le=b(B,2);Nt(le,17,()=>e.msg.items,Yt,(ke,j)=>{var M=Z0(),z=_(M),C=_(z),N=_(C),I=_(N),$=b(N,2);{var Y=he=>{var _e=W0(),se=_(_e);ie(()=>ee(se,o(j).event.data.subject)),T(he,_e)};pe($,he=>{var _e;(_e=o(j).event.data)!=null&&_e.subject&&he(Y)})}var X=b(C,2),V=_(X);{var te=he=>{var _e=on();ie(se=>ee(_e,se),[()=>s(o(j).event.data.from)]),T(he,_e)};pe(V,he=>{var _e;(_e=o(j).event.data)!=null&&_e.from&&he(te)})}var re=b(V,2);{var G=he=>{var _e=Y0(),se=b(Xe(_e),1,!0);ie(Te=>ee(se,Te),[()=>i(o(j).event.data.date)]),T(he,_e)};pe(re,he=>{var _e;(_e=o(j).event.data)!=null&&_e.date&&he(G)})}var K=b(X,2);{var ae=he=>{var _e=X0(),se=_(_e);ie(()=>ee(se,o(j).event.metadata.summary)),T(he,_e)};pe(K,he=>{var _e;(_e=o(j).event.metadata)!=null&&_e.summary&&he(ae)})}var Z=b(z,2),ne=_(Z);{let he=Q(()=>{var _e;return(_e=o(j).event.metadata)==null?void 0:_e.group});il(ne,{get eventType(){return o(j).event.type},get group(){return o(he)},get commands(){return o(j).commands}})}ie(()=>ee(I,o(j).event.type)),T(ke,M)}),ie(()=>ee(J,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),T(k,H)},W=k=>{var H=_w(),B=_(H),O=b(_(B),2),J=_(O),le=b(B,2);Nt(le,17,()=>e.msg.groups,Yt,(ke,j)=>{const M=Q(()=>o(n)[o(j).eventType]??!0),z=Q(()=>`batch_${o(j).eventType}`),C=Q(()=>x(o(z))),N=Q(()=>o(a)[o(z)]),I=Q(()=>o(j).group?tr[o(j).group]:null);var $=yw(),Y=_($),X=_(Y);X.__click=()=>p(o(j).eventType);var V=_(X);let te;var re=_(V),G=b(V,2);{var K=Fe=>{var Oe=J0();let je;var Ne=_(Oe);ie(()=>{xt(Oe,"title",o(I).description),je=Dt(Oe,"",je,{color:o(I).color}),ee(Ne,o(I).label)}),T(Fe,Oe)};pe(G,Fe=>{o(I)&&Fe(K)})}var ae=b(G,2),Z=_(ae),ne=b(ae,4);let he;var _e=b(X,2);{var se=Fe=>{var Oe=$0();let je;Oe.__click=Ue=>{Ue.stopPropagation(),d(o(j).eventType,o(j).emails)};var Ne=_(Oe);{var Be=Ue=>{var tt=on("â³ Running...");T(Ue,tt)},Ke=Ue=>{var tt=on();ie(()=>ee(tt,o(C).result.success?`â Done (${o(C).result.successful}/${o(C).result.total})`:"â Failed")),T(Ue,tt)},$e=Ue=>{var tt=on();ie(()=>ee(tt,`ð Review & Execute (${o(j).emails.length??""})`)),T(Ue,tt)},Ze=Ue=>{var tt=on();ie(()=>ee(tt,`â¶ Execute All (${o(j).emails.length??""})`)),T(Ue,tt)};pe(Ne,Ue=>{var tt,nt,ft;(tt=o(C))!=null&&tt.running?Ue(Be):(nt=o(C))!=null&&nt.result?Ue(Ke,1):(ft=o(I))!=null&&ft.requiresApproval?Ue($e,2):Ue(Ze,!1)})}ie(()=>{var Ue,tt;je=Tt(Oe,1,"execute-all-btn svelte-1w66m1k",null,je,{critical:(Ue=o(I))==null?void 0:Ue.requiresApproval}),Oe.disabled=(tt=o(C))==null?void 0:tt.running}),T(Fe,Oe)};pe(_e,Fe=>{o(N)||Fe(se)})}var Te=b(Y,2);{var be=Fe=>{var Oe=aw(),je=b(_(Oe),2),Ne=b(_(je)),Be=_(Ne),Ke=b(je,2);{var $e=nt=>{var ft=rw();Nt(ft,21,()=>o(N).actions,Yt,(mt,vt)=>{var kt=nw(),bt=_(kt);{var pt=Et=>{var Vt=ew(),De=_(Vt);ie(()=>ee(De,o(vt).icon)),T(Et,Vt)};pe(bt,Et=>{o(vt).icon&&Et(pt)})}var yt=b(bt,2),dt=_(yt),Le=b(yt,2);{var Rt=Et=>{var Vt=tw(),De=_(Vt);ie(()=>ee(De,`â ${o(vt).description??""}`)),T(Et,Vt)};pe(Le,Et=>{o(vt).description&&Et(Rt)})}ie(()=>ee(dt,o(vt).name)),T(mt,kt)}),T(nt,ft)};pe(Ke,nt=>{var ft;(ft=o(N).actions)!=null&&ft.length&&nt($e)})}var Ze=b(Ke,2),Ue=_(Ze);Ue.__click=()=>f(o(z));var tt=b(Ue,2);tt.__click=()=>v(o(z)),ie(()=>ee(Be,`${o(j).emails.length??""} email${o(j).emails.length===1?"":"s"}`)),T(Fe,Oe)};pe(Te,Fe=>{o(N)&&Fe(be)})}var Me=b(Te,2);{var Ve=Fe=>{var Oe=sw();let je;var Ne=_(Oe);ie(()=>{je=Tt(Oe,1,"batch-result svelte-1w66m1k",null,je,{success:o(C).result.success,error:!o(C).result.success}),ee(Ne,o(C).result.message)}),T(Fe,Oe)};pe(Me,Fe=>{var Oe;(Oe=o(C))!=null&&Oe.result&&!o(N)&&Fe(Ve)})}var Je=b(Me,2);{var ut=Fe=>{var Oe=mw();Nt(Oe,21,()=>o(j).emails,Yt,(je,Ne)=>{const Be=Q(()=>`single_${o(Ne).emailId}`),Ke=Q(()=>x(o(Be))),$e=Q(()=>o(a)[o(Be)]);var Ze=gw(),Ue=_(Ze),tt=_(Ue),nt=_(tt),ft=b(tt,2),mt=_(ft);{var vt=it=>{var ct=iw(),Pt=_(ct);ie($t=>ee(Pt,$t),[()=>s(o(Ne).from)]),T(it,ct)};pe(mt,it=>{o(Ne).from&&it(vt)})}var kt=b(mt,2);{var bt=it=>{var ct=ow(),Pt=b(Xe(ct)),$t=_(Pt);ie(_t=>ee($t,_t),[()=>i(o(Ne).date)]),T(it,ct)};pe(kt,it=>{o(Ne).date&&it(bt)})}var pt=b(ft,2);{var yt=it=>{var ct=lw(),Pt=_(ct);ie(()=>ee(Pt,o(Ne).summary)),T(it,ct)};pe(pt,it=>{o(Ne).summary&&it(yt)})}var dt=b(pt,2);{var Le=it=>{var ct=uw();Nt(ct,21,()=>o(Ne).tags,Yt,(Pt,$t)=>{var _t=cw(),zt=_(_t);ie(()=>ee(zt,o($t))),T(Pt,_t)}),T(it,ct)};pe(dt,it=>{var ct;(ct=o(Ne).tags)!=null&&ct.length&&it(Le)})}var Rt=b(Ue,2),Et=_(Rt),Vt=b(_(Et),2);{var De=it=>{var ct=dw();let Pt;ct.__click=()=>l({type:o(j).eventType,source:"gmail",data:o(Ne)},o(Ne).emailId);var $t=_(ct);{var _t=Jt=>{var en=on("â³ Running...");T(Jt,en)},zt=Jt=>{var en=on();ie(()=>ee(en,o(Ke).result.success?"â Done":"â Failed")),T(Jt,en)},fn=Jt=>{var en=on("ð Review");T(Jt,en)},cn=Jt=>{var en=on("â¶ Execute");T(Jt,en)};pe($t,Jt=>{var en,Ln,On;(en=o(Ke))!=null&&en.running?Jt(_t):(Ln=o(Ke))!=null&&Ln.result?Jt(zt,1):(On=o(I))!=null&&On.requiresApproval?Jt(fn,2):Jt(cn,!1)})}ie(()=>{var Jt,en;Pt=Tt(ct,1,"execute-btn svelte-1w66m1k",null,Pt,{critical:(Jt=o(I))==null?void 0:Jt.requiresApproval}),ct.disabled=(en=o(Ke))==null?void 0:en.running}),T(it,ct)};pe(Vt,it=>{o($e)||it(De)})}var Qt=b(Et,2);{var Kn=it=>{var ct=fw(),Pt=b(_(ct),4),$t=_(Pt);$t.__click=()=>f(o(Be));var _t=b($t,2);_t.__click=()=>v(o(Be)),T(it,ct)};pe(Qt,it=>{o($e)&&it(Kn)})}var ye=b(Qt,2);{var ln=it=>{var ct=vw(),Pt=_(ct);il(Pt,{get eventType(){return o(j).eventType},get group(){return o(j).group},get commands(){return o(j).commands}}),T(it,ct)},En=it=>{var ct=hw();T(it,ct)};pe(ye,it=>{var ct;(ct=o(j).commands)!=null&&ct.length?it(ln):it(En,!1)})}var At=b(ye,2);{var Mn=it=>{var ct=pw();let Pt;var $t=_(ct);ie(()=>{Pt=Tt(ct,1,"execution-result svelte-1w66m1k",null,Pt,{success:o(Ke).result.success,error:!o(Ke).result.success}),ee($t,o(Ke).result.message)}),T(it,ct)};pe(At,it=>{var ct;(ct=o(Ke))!=null&&ct.result&&it(Mn)})}ie(()=>ee(nt,o(Ne).subject)),T(je,Ze)}),T(Fe,Oe)};pe(Je,Fe=>{o(M)&&Fe(ut)})}ie((Fe,Oe)=>{te=Dt(V,"",te,Fe),ee(re,Oe),ee(Z,o(j).emails.length),he=Tt(ne,0,"chevron svelte-1w66m1k",null,he,{open:o(M)})},[()=>({background:y(o(j).eventType)}),()=>h(o(j).eventType)]),T(ke,$)}),ie(()=>ee(J,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),T(k,H)};pe(A,k=>{e.msg.type==="event"?k(D):e.msg.type==="event-batch"?k(L,1):e.msg.type==="events-grouped"&&k(W,2)})}T(t,S),st()}Zt(["click"]);var ww=q('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),xw=q('<span class="edate svelte-mt5nvh"> </span>'),kw=q('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Sw=q('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Ew=q('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),Aw=q('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="pipeline-preview" style="margin-bottom: 0.5rem; background: #111; padding: 0.2rem 0.5rem; border-radius: 8px; border: 1px solid #1a1a1a;"><!></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Tw=q('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Cw(t,e){at(e,!0);let n=Ee(e,"pendingData",3,null),r=Pe(null),a=Pe(null),s=Pe(Xt([])),i=Pe(null);function l(S){P(r,o(r)===S?null:S,!0),P(a,null)}kn(()=>{o(r)?(Dr(o(r)).then(S=>P(s,S,!0)),Vi(o(r)).then(S=>P(i,S,!0))):(P(s,[],!0),P(i,null))});function d(S){return S.split("_").map(A=>A.charAt(0)+A.slice(1).toLowerCase()).join(" ")}function f(S){if(!S)return"";try{return new Date(S).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function v(S){if(!S)return"";const A=S.replace(/<.*>/,"").trim();return A.length>24?A.slice(0,22)+"â¦":A}var p={toggleGroup:l},h=sn(),y=Xe(h);{var x=S=>{var A=Tw(),D=_(A),L=_(D),W=b(D,2);Nt(W,20,()=>n().order,B=>B,(B,O)=>{const J=Q(()=>n().groups[O]),le=Q(()=>Su(O)),ke=Q(()=>o(r)===O);var j=ww();let M;j.__click=()=>l(O);let z;var C=_(j);let N;var I=b(C),$=b(I),Y=_($);ie(X=>{M=Tt(j,1,"chip svelte-mt5nvh",null,M,{active:o(ke)}),z=Dt(j,"",z,{"--c":o(le)}),N=Dt(C,"",N,{background:o(le)}),ee(I,` ${X??""} `),ee(Y,o(J).length)},[()=>d(O)]),T(B,j)});var k=b(W,2);{var H=B=>{const O=Q(()=>n().groups[o(r)]),J=Q(()=>Su(o(r)));var le=Aw(),ke=_(le);let j;var M=_(ke);M.__click=()=>{P(r,null),P(a,null)};var z=b(M,2),C=_(z),N=b(z,2),I=_(N),$=b(ke,2),Y=_($);il(Y,{get eventType(){return o(r)},get group(){return o(i)},get commands(){return o(s)}});var X=b($,2);Nt(X,21,()=>o(O),K=>K.emailId,(K,ae)=>{var Z=kw(),ne=_(Z);ne.__click=()=>{var Fe;return(Fe=e.onaskai)==null?void 0:Fe.call(e,`Tell me about the email "${o(ae).subject}" from ${o(ae).from}`)};var he=_(ne),_e=_(he),se=b(he,2),Te=_(se),be=b(Te);{var Me=Fe=>{var Oe=xw(),je=_(Oe);ie(Ne=>ee(je,Ne),[()=>f(o(ae).date)]),T(Fe,Oe)};pe(be,Fe=>{o(ae).date&&Fe(Me)})}var Ve=b(ne,2),Je=_(Ve);Je.__click=()=>{var Fe;return(Fe=e.onmarkacted)==null?void 0:Fe.call(e,o(ae).emailId)};var ut=b(Je,2);ut.__click=()=>{var Fe;return(Fe=e.ondismiss)==null?void 0:Fe.call(e,o(ae).emailId)},ie(Fe=>{ee(_e,o(ae).subject),ee(Te,Fe)},[()=>v(o(ae).from)]),T(K,Z)});var V=b(X,2),te=_(V);{var re=K=>{var ae=Sw(),Z=Xe(ae);Z.__click=()=>o(O).forEach(he=>{var _e;return(_e=e.onmarkacted)==null?void 0:_e.call(e,he.emailId)});var ne=b(Z,2);ne.__click=()=>P(a,o(r),!0),T(K,ae)},G=K=>{var ae=Ew(),Z=Xe(ae),ne=_(Z),he=b(Z,2);he.__click=()=>P(a,null);var _e=b(he,2);_e.__click=()=>{var se;(se=e.oncleargroup)==null||se.call(e,o(r)),P(a,null),P(r,null)},ie(()=>ee(ne,`Remove ${o(O).length??""}?`)),T(K,ae)};pe(te,K=>{o(a)!==o(r)?K(re):K(G,!1)})}ie(K=>{j=Dt(ke,"",j,{"border-color":o(J)}),ee(C,K),ee(I,o(O).length)},[()=>d(o(r))]),T(B,le)};pe(k,B=>{o(r)&&n().groups[o(r)]&&B(H)})}ie(()=>ee(L,`${n().total??""} item${n().total!==1?"s":""} need attention`)),T(S,A)};pe(y,S=>{n()&&n().total>0&&S(x)})}return T(t,h),st(p)}Zt(["click"]);var Iw=q('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Pw=q('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Mw=q('<div class="strip svelte-1ed7zw1"><!></div>');function Ow(t,e){let n=Ee(e,"hasScanData",3,!1),r=Ee(e,"engineReady",3,!1),a=Ee(e,"isScanning",3,!1),s=Q(()=>r()&&!n()&&!a()),i=Q(()=>o(s)||a());var l=sn(),d=Xe(l);{var f=v=>{var p=Mw(),h=_(p);{var y=S=>{var A=Iw();T(S,A)},x=S=>{var A=Pw();A.__click=function(...D){var L;(L=e.onscan)==null||L.apply(this,D)},T(S,A)};pe(h,S=>{a()?S(y):o(s)&&S(x,1)})}T(v,p)};pe(d,v=>{o(i)&&v(f)})}T(t,l)}Zt(["click"]);var Nw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Dw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Rw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Lw=q('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),zw=q('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),jw=q('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),qw=q('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Bw(t,e){at(e,!0),Sn(()=>cr("GpuPanel"));var n=qw(),r=_(n),a=b(_(r),2),s=b(_(a),2),i=_(s),l=b(a,2),d=b(_(l),2),f=_(d),v=b(l,2);{var p=k=>{var H=Nw(),B=b(_(H),2),O=_(B);ie(()=>ee(O,e.gpuInfo.device)),T(k,H)};pe(v,k=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&k(p)})}var h=b(v,2);{var y=k=>{var H=Dw(),B=b(_(H),2),O=_(B);ie(J=>ee(O,J),[()=>xu(e.gpuInfo.limits.maxBufferSize)]),T(k,H)};pe(h,k=>{var H;(H=e.gpuInfo.limits)!=null&&H.maxBufferSize&&k(y)})}var x=b(h,2);{var S=k=>{var H=Rw(),B=b(_(H),2),O=_(B);ie(()=>ee(O,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),T(k,H)};pe(x,k=>{var H;(H=e.gpuInfo.limits)!=null&&H.maxComputeInvocationsPerWorkgroup&&k(S)})}var A=b(x,2);{var D=k=>{var H=Lw(),B=b(_(H),2),O=_(B);ie(J=>ee(O,J),[()=>xu(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),T(k,H)};pe(A,k=>{var H;(H=e.gpuInfo.limits)!=null&&H.maxComputeWorkgroupStorageSize&&k(D)})}var L=b(A,2);{var W=k=>{var H=jw(),B=_(H),O=_(B),J=b(B,2);Nt(J,21,()=>e.gpuInfo.features,Yt,(le,ke)=>{var j=zw(),M=_(j);ie(()=>ee(M,o(ke))),T(le,j)}),ie(()=>ee(O,`Features (${e.gpuInfo.features.length??""})`)),T(k,H)};pe(L,k=>{var H;(H=e.gpuInfo.features)!=null&&H.length&&k(W)})}ie(()=>{ee(i,e.gpuInfo.vendor),ee(f,e.gpuInfo.architecture)}),T(t,n),st()}var Fw=q('<button class="gpu-badge svelte-1ktw27c"> </button>'),Kw=q('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Hw=q('<span class="stats svelte-1ktw27c"> </span>'),Vw=q('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Uw=q('<span class="stats preparing svelte-1ktw27c"> </span>'),Gw=q('<span class="stats svelte-1ktw27c"> </span>'),Ww=q('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Yw=q('<button class="btn svelte-1ktw27c">Stop</button>'),Xw=q('<button class="btn primary svelte-1ktw27c">Send</button>'),Zw=q('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Qw(t,e){at(e,!0),Sn(()=>cr("ChatView"));let n=Ee(e,"messages",19,()=>[]),r=Ee(e,"pendingData",3,null),a=Ee(e,"hasScanData",3,!1),s=Ee(e,"engineReady",3,!1),i=Ee(e,"isScanning",3,!1),l=Ee(e,"isRunning",3,!1),d=Ee(e,"tps",3,null),f=Ee(e,"numTokens",3,null),v=Ee(e,"generationPhase",3,null),p=Ee(e,"gpuInfo",3,null),h=Ee(e,"backend",3,"webgpu"),y=Ee(e,"chatContainer",15),x=Pe(""),S=Pe(!1);function A(Z){Z.key==="Enter"&&!Z.shiftKey&&(Z.preventDefault(),D())}function D(){const Z=o(x).trim();!Z||l()||(P(x,""),e.onsend(Z))}function L(Z){Z&&!l()&&e.onsend(Z)}var W=Zw(),k=_(W),H=_(k);{var B=Z=>{var ne=Fw();ne.__click=()=>P(S,!o(S));var he=_(ne);ie(()=>ee(he,`WebGPU ${o(S)?"â²":"â¼"}`)),T(Z,ne)},O=Z=>{var ne=Kw();T(Z,ne)};pe(H,Z=>{p()?Z(B):h()==="ollama"&&Z(O,1)})}var J=b(H,2);{var le=Z=>{var ne=Hw(),he=_(ne);ie((_e,se)=>ee(he,`${f()??""} tokens in ${_e??""}s
        (${se??""} tok/s)`),[()=>(f()/d()).toFixed(1),()=>d().toFixed(1)]),T(Z,ne)},ke=Z=>{var ne=Vw();T(Z,ne)},j=Z=>{var ne=Uw(),he=_(ne);ie(_e=>ee(he,`thinking... ${_e??""}`),[()=>d()?`${d().toFixed(0)} tok/s`:""]),T(Z,ne)},M=Z=>{var ne=Gw(),he=_(ne);ie(_e=>ee(he,`${_e??""} tok/s`),[()=>d().toFixed(1)]),T(Z,ne)};pe(J,Z=>{d()&&!l()?Z(le):l()&&v()==="preparing"?Z(ke,1):l()&&v()==="thinking"?Z(j,2):d()&&l()&&Z(M,3)})}var z=b(J,4);z.__click=function(...Z){var ne;(ne=e.onreset)==null||ne.apply(this,Z)};var C=b(k,2);{var N=Z=>{Bw(Z,{get gpuInfo(){return p()}})};pe(C,Z=>{o(S)&&p()&&Z(N)})}var I=b(C,2),$=_(I);{var Y=Z=>{var ne=Ww();T(Z,ne)};pe($,Z=>{n().length===0&&!(r()&&r().total>0)&&Z(Y)})}var X=b($,2);Nt(X,17,n,Yt,(Z,ne,he)=>{var _e=sn(),se=Xe(_e);{var Te=Ve=>{Cw(Ve,{get pendingData(){return o(ne).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:L})},be=Ve=>{bw(Ve,{get msg(){return o(ne)},get oncommand(){return e.oncommand}})},Me=Ve=>{{let Je=Q(()=>he===n().length-1);k0(Ve,{get msg(){return o(ne)},get isLast(){return o(Je)},get isRunning(){return l()},get generationPhase(){return v()},get numTokens(){return f()}})}};pe(se,Ve=>{o(ne).type==="dashboard"?Ve(Te):o(ne).type==="event"||o(ne).type==="event-batch"||o(ne).type==="events-grouped"?Ve(be,1):Ve(Me,!1)})}T(Z,_e)}),xs(I,Z=>y(Z),()=>y());var V=b(I,2);Ow(V,{get hasScanData(){return a()},get engineReady(){return s()},get isScanning(){return i()},get onscan(){return e.onscan}});var te=b(V,2),re=_(te);re.__keydown=A;var G=b(re,2);{var K=Z=>{var ne=Yw();ne.__click=function(...he){var _e;(_e=e.onstop)==null||_e.apply(this,he)},T(Z,ne)},ae=Z=>{var ne=Xw();ne.__click=D,ie(he=>ne.disabled=he,[()=>!o(x).trim()]),T(Z,ne)};pe(G,Z=>{l()?Z(K):Z(ae,!1)})}ie(()=>{z.disabled=l(),re.disabled=l()}),fa(re,()=>o(x),Z=>P(x,Z)),T(t,W),st()}Zt(["click","keydown"]);var Jw=q('<div class="container center svelte-1bi93vx"><!> <!></div>');function $w(t,e){at(e,!0);const n=!!navigator.gpu,r=vp();let a=Pe("webgpu"),s=Pe(Xt(Xr[0].id)),i=Pe(null),l=Pe(null),d=Pe(""),f=Pe(Xt([])),v=Pe(Xt([])),p=Pe(!1),h=Pe(null),y=Pe(null),x=Pe(null),S=Pe(null),A=Pe(null),D=Pe(null),L=Pe(!1),W=Pe(!1),k=!1;Sn(async()=>{const[G,K]=await Promise.all([Ki("aiBackend"),Ki("selectedModel")]);G&&P(a,G,!0),K&&P(s,K,!0),r.check(),r.isReady&&H();const ae=r.onMessage(Z=>{switch(Z.status){case"webgpu-info":P(S,Z.data,!0);break;case"loading":P(i,"loading"),P(d,Z.data,!0);break;case"initiate":P(f,[...o(f),Z],!0);break;case"progress":P(f,o(f).map(ne=>ne.file===Z.file?{...ne,...Z}:ne),!0);break;case"done":P(f,o(f).filter(ne=>ne.file!==Z.file),!0);break;case"ready":P(i,"ready"),H();break;case"start":if(!o(p))break;P(A,Z.phase||"preparing",!0),P(v,[...o(v),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!o(p))break;P(A,Z.phase,!0);break;case"thinking":{if(!o(p))break;P(h,Z.tps,!0),P(y,Z.numTokens,!0);const ne=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...ne,thinking:(ne.thinking||"")+Z.content}],!0),z();break}case"thinking-done":{if(!o(p))break;P(h,Z.tps,!0),P(y,Z.numTokens,!0);const ne=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...ne,thinking:Z.content}],!0);break}case"update":{if(!o(p))break;P(h,Z.tps,!0),P(y,Z.numTokens,!0);const ne=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...ne,content:ne.content+Z.output}],!0),z();break}case"complete":if(!o(p))break;Z.tps!==void 0&&P(h,Z.tps,!0),Z.numTokens!==void 0&&P(y,Z.numTokens,!0),P(p,!1),P(A,null),B();break;case"error":P(l,Z.data,!0),o(i)==="loading"&&P(i,null),o(p)&&(P(p,!1),P(A,null));break}});return()=>ae()});async function H(){if(!(k||o(v).length>0))try{const G=await Kf();P(D,G,!0),G&&(k=!0,P(v,[{role:"assistant",type:"dashboard",pendingData:G}],!0),z());const K=await ku();P(L,K.classified>0)}catch{}}async function B(){try{const G=await Kf();P(D,G,!0);const K=o(v).findIndex(Z=>Z.type==="dashboard");K!==-1&&(G&&G.total>0?P(v,o(v).map((Z,ne)=>ne===K?{...Z,pendingData:G}:Z),!0):P(v,o(v).filter((Z,ne)=>ne!==K),!0));const ae=await ku();P(L,ae.classified>0)}catch{}}async function O(G){await ml(G,"acted"),await B()}async function J(G){await ml(G,"dismissed"),await B()}async function le(G){await Op(G),await B()}async function ke(G){await _d(G),await B()}async function j(){if(o(W)||!r.isReady)return;P(W,!0);let G=null;try{if(await Pp(r,{count:20,onProgress:K=>{var ae;K.phase==="done"&&((ae=K.results)==null?void 0:ae.length)>0&&(G=K.results)}}),await B(),(G==null?void 0:G.length)>0){const K=await fb(G);P(v,[...o(v),K],!0),z()}o(D)&&!o(v).some(K=>K.type==="dashboard")&&(P(v,[{role:"assistant",type:"dashboard",pendingData:o(D)},...o(v)],!0),z())}catch(K){console.error("Scan failed:",K)}finally{P(W,!1)}}function M({event:G,commandId:K}){var ae,Z;`${K}${G.type}${((ae=G.data)==null?void 0:ae.subject)||"unknown"}`,P(v,[...o(v),{role:"assistant",content:`Command: ${K}

This command is not yet implemented. In the future, "${K}" will be executed on the ${G.source} event "${((Z=G.data)==null?void 0:Z.subject)||""}".`}],!0),z()}function z(){$h().then(()=>{o(x)&&(o(x).scrollTop=o(x).scrollHeight)})}async function C(){P(i,"loading"),await Hi("selectedModel",o(s)),await Hi("aiBackend",o(a)),o(a)==="ollama"&&P(S,null),r.loadModel(o(s))}kn(()=>{o(a)==="webgpu"&&!Xr.find(G=>G.id===o(s))?P(s,Xr[0].id,!0):o(a)==="ollama"&&!Zr.find(G=>G.name===o(s))&&P(s,Zr[0].name,!0)});async function N(G){if(!G||o(p))return;if(G.trim().toLowerCase()==="/events"){P(v,[...o(v),{role:"user",content:G}],!0);try{const Z=await Mp();if(!Z.order.length)P(v,[...o(v),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const ne=await vb(Z);P(v,[...o(v),ne],!0)}}catch(Z){P(v,[...o(v),{role:"assistant",content:`Failed to load events: ${Z.message}`}],!0)}z();return}P(v,[...o(v),{role:"user",content:G}],!0),P(h,null),P(p,!0);let K=[];try{const ne=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(G)?await J_(G):await Q_();ne&&(K=[{role:"system",content:ne}])}catch{}const ae=o(v).filter(Z=>Z.type!=="dashboard"&&Z.type!=="events-grouped"&&Z.type!=="event-batch"&&Z.type!=="event").map(Z=>({role:Z.role,content:Z.content}));r.generate([...K,...ae]),z()}function I(){r.interrupt()}function $(){r.reset(),P(v,[],!0),P(h,null),P(y,null),k=!1,H()}var Y=sn(),X=Xe(Y);{var V=G=>{var K=Jw(),ae=_(K);Cb(ae,{get isWebGPUAvailable(){return n},get backend(){return o(a)},set backend(_e){P(a,_e,!0)}});var Z=b(ae,2);{var ne=_e=>{Fb(_e,{get gpuInfo(){return o(S)},get error(){return o(l)},onload:C,get selectedModel(){return o(s)},set selectedModel(se){P(s,se,!0)}})},he=_e=>{a0(_e,{onload:C,get selectedModel(){return o(s)},set selectedModel(se){P(s,se,!0)},get error(){return o(l)},set error(se){P(l,se,!0)}})};pe(Z,_e=>{o(a)==="webgpu"?_e(ne):o(a)==="ollama"&&_e(he,1)})}T(G,K)},te=G=>{f0(G,{get message(){return o(d)},get items(){return o(f)}})},re=G=>{Qw(G,{get messages(){return o(v)},get pendingData(){return o(D)},get hasScanData(){return o(L)},get engineReady(){return r.isReady},get isScanning(){return o(W)},get isRunning(){return o(p)},get tps(){return o(h)},get numTokens(){return o(y)},get generationPhase(){return o(A)},get gpuInfo(){return o(S)},get backend(){return o(a)},onsend:N,onstop:I,onreset:$,onmarkacted:O,ondismiss:J,onremove:le,oncleargroup:ke,onscan:j,oncommand:M,get chatContainer(){return o(x)},set chatContainer(K){P(x,K,!0)}})};pe(X,G=>{o(i)===null?G(V):o(i)==="loading"?G(te,1):G(re,!1)})}T(t,Y),st()}const Cn="gmail",Xf=8,jp=50,qp=100;async function e1(t,{limit:e=jp,onProgress:n=()=>{},signal:r}={}){var i;const a=await lt.syncState.get(Cn);if(a!=null&&a.historyId)try{return await s1(t,a,n,r)}catch(l){if(l instanceof pd&&(l.status===404||l.code==="notFound")||((i=l.message)==null?void 0:i.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await lt.syncState.delete(Cn);else throw l}return await r1(t,e===0?1/0:e,n,r)}async function t1(t,{limit:e=jp,onProgress:n=()=>{},signal:r}={}){const a=await lt.syncState.get(Cn);return a!=null&&a.oldestPageToken?await a1(t,a,e===0?1/0:e,n,r):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function n1(){const t=await lt.syncState.get(Cn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Bp(){await lt.transaction("rw",[lt.items,lt.syncState],async()=>{await lt.items.where("sourceType").equals(Cn).delete(),await lt.syncState.delete(Cn)})}async function r1(t,e,n,r){n({phase:"counting",message:"Getting mailbox info..."}),vs(r);const a=await hp(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(a.messagesTotal||e,e)});const s=[];let i,l=null;for(;s.length<e;){vs(r);const p=e-s.length,h=await pp(t,{maxResults:Math.min(qp,p),pageToken:i}),y=(h.messages||[]).map(x=>x.id);if(s.push(...y),n({phase:"listing",message:`Listed ${s.length} messages...`,current:s.length,total:Math.min(a.messagesTotal||e,e)}),i=h.nextPageToken,!i||y.length===0)break}if(l=i||null,s.length===0)return await lt.syncState.put({sourceType:Cn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:d,errors:f}=await Fp(t,s,n,r),v=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.put({sourceType:Cn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:v,oldestPageToken:l}),n({phase:"done",message:`Synced ${d} messages`,current:d,total:d}),{added:d,deleted:0,errors:f}}async function a1(t,e,n,r,a){r({phase:"listing",message:"Loading more messages...",current:0}),vs(a);const s=[];let i=e.oldestPageToken,l=null;for(;s.length<n;){vs(a);const p=n-s.length,h=await pp(t,{maxResults:Math.min(qp,p),pageToken:i}),y=(h.messages||[]).map(x=>x.id);if(s.push(...y),r({phase:"listing",message:`Listed ${s.length} more messages...`,current:s.length}),i=h.nextPageToken,!i||y.length===0)break}if(l=i||null,s.length===0)return await lt.syncState.update(Cn,{oldestPageToken:null,lastSyncAt:Date.now()}),r({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:d,errors:f}=await Fp(t,s,r,a),v=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.update(Cn,{totalItems:v,lastSyncAt:Date.now(),oldestPageToken:l}),r({phase:"done",message:l?`Downloaded ${d} more (more available)`:`Downloaded ${d} more (all synced)`,current:v,total:v}),{added:d,errors:f}}async function s1(t,e,n,r){n({phase:"syncing",message:"Checking for changes..."}),vs(r);let a=0,s=0,i=0,l,d=e.historyId;do{vs(r);const v=await B_(t,{startHistoryId:e.historyId,pageToken:l});if(d=v.historyId||d,l=v.nextPageToken,!!v.history){for(const p of v.history){if(p.messagesAdded){const h=p.messagesAdded.map(x=>x.message.id),y=[...new Set(h.filter(x=>x))];if(y.length>0){const x=await Promise.allSettled(y.map(A=>gp(t,A))),S=[];for(const A of x)A.status==="fulfilled"?S.push(Kp(A.value)):i++;S.length>0&&(await lt.items.bulkPut(S),await Hp(S),a+=S.length)}}if(p.messagesDeleted){const h=p.messagesDeleted.map(y=>dd(Cn,y.message.id)).filter(y=>y);h.length>0&&(await lt.items.bulkDelete(h),s+=h.length)}}n({phase:"syncing",message:`Changes: +${a} -${s}`,current:a+s})}}while(l);const f=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.put({sourceType:Cn,historyId:d,lastSyncAt:Date.now(),totalItems:f,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:a===0&&s===0?"Already up to date":`Synced: +${a} -${s}`,current:f,total:f}),{added:a,deleted:s,errors:i}}async function Fp(t,e,n,r){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let a=0,s=0;for(let i=0;i<e.length;i+=Xf){vs(r);const l=e.slice(i,i+Xf),d=await Promise.allSettled(l.map(v=>gp(t,v))),f=[];for(const v of d)v.status==="fulfilled"?f.push(Kp(v.value)):s++;f.length>0&&(await lt.items.bulkPut(f),await Hp(f)),a+=f.length,n({phase:"downloading",message:`Downloaded ${a} of ${e.length} messages`,current:a,total:e.length})}return{added:a,errors:s}}function Kp(t){const e=Ea(t,"From"),n=Ea(t,"To"),r=Ea(t,"Cc"),a=Ea(t,"Subject")||"(no subject)",s=Ea(t,"Date"),i=Ea(t,"Message-ID"),l=Ea(t,"In-Reply-To"),d=Ea(t,"References");let f;try{f=s?new Date(s).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{f=Date.now()}return{id:dd(Cn,t.id),sourceType:Cn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:r,subject:a,snippet:t.snippet||"",body:F_(t),htmlBody:K_(t),date:f,labels:t.labelIds||[],messageId:i,inReplyTo:l,references:d,raw:t,syncedAt:Date.now()}}async function Hp(t){const e=new Map;for(const n of t)for(const r of[n.from,n.to,n.cc]){if(!r)continue;const a=r.split(",").map(s=>s.trim()).filter(Boolean);for(const s of a){const i=i1(s);i&&!e.has(i.email)&&e.set(i.email,{...i,date:n.date})}}for(const[n,{name:r,date:a}]of e)try{const s=await lt.contacts.where("email").equals(n).first();if(s){const i={};r&&!s.name&&(i.name=r),a>(s.lastSeen||0)&&(i.lastSeen=a),Object.keys(i).length>0&&await lt.contacts.update(s.id,i)}else await lt.contacts.add({email:n,name:r||"",firstSeen:a,lastSeen:a})}catch(s){(s==null?void 0:s.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(s==null?void 0:s.message)||s)}}function i1(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const r=e[1].toLowerCase().trim(),a=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:r,name:a}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function vs(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var o1=q(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),l1=q(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),c1=q(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function u1(t,e){at(e,!0);let n=Ee(e,"clientIdInput",15),r=Ee(e,"defaultClientId",3,"");Sn(()=>cr("SetupGuide"));let a=Pe(null);async function s(x){try{await navigator.clipboard.writeText(x),P(a,x,!0),setTimeout(()=>{P(a,null)},1500)}catch{const S=document.createElement("input");S.value=x,document.body.appendChild(S),S.select(),document.execCommand("copy"),document.body.removeChild(S),P(a,x,!0),setTimeout(()=>{P(a,null)},1500)}}const i="http://localhost:5173",l="https://cypherkitty.github.io",d="https://cypherkitty.github.io/me-ai/";var f=c1(),v=_(f),p=b(_(v),4);{var h=x=>{var S=o1(),A=Xe(S),D=b(_(A),2);D.__click=()=>{n(r()),e.onsave()};var L=b(A,2),W=b(_(L),2),k=_(W),H=b(_(k),6),B=b(_(H),2),O=b(_(B),2),J=b(_(O),2),le=_(J);le.__click=()=>s(i);var ke=_(le);ke.textContent="http://localhost:5173";var j=b(ke,2),M=_(j),z=b(le,2);z.__click=()=>s(l);var C=_(z);C.textContent="https://cypherkitty.github.io";var N=b(C,2),I=_(N),$=b(O,2),Y=b(_($),2),X=_(Y);X.__click=()=>s(i);var V=_(X);V.textContent="http://localhost:5173";var te=b(V,2),re=_(te),G=b(X,2);G.__click=()=>s(l);var K=_(G);K.textContent="https://cypherkitty.github.io";var ae=b(K,2),Z=_(ae),ne=b(G,2);ne.__click=()=>s(d);var he=_(ne);he.textContent="https://cypherkitty.github.io/me-ai/";var _e=b(he,2),se=_(_e),Te=b(k,2),be=_(Te);be.__keydown=Ve=>Ve.key==="Enter"&&e.onsave();var Me=b(be,2);Me.__click=function(...Ve){var Je;(Je=e.onsave)==null||Je.apply(this,Ve)},ie(Ve=>{ee(M,o(a)===i?"â":"â§"),ee(I,o(a)===l?"â":"â§"),ee(re,o(a)===i?"â":"â§"),ee(Z,o(a)===l?"â":"â§"),ee(se,o(a)===d?"â":"â§"),Me.disabled=Ve},[()=>!n().trim()]),fa(be,n),T(x,S)},y=x=>{var S=l1(),A=Xe(S),D=b(_(A),6),L=b(_(D),2),W=b(_(L),2),k=b(_(W),2),H=_(k);H.__click=()=>s(i);var B=_(H);B.textContent="http://localhost:5173";var O=b(B,2),J=_(O),le=b(H,2);le.__click=()=>s(l);var ke=_(le);ke.textContent="https://cypherkitty.github.io";var j=b(ke,2),M=_(j),z=b(W,2),C=b(_(z),2),N=_(C);N.__click=()=>s(i);var I=_(N);I.textContent="http://localhost:5173";var $=b(I,2),Y=_($),X=b(N,2);X.__click=()=>s(l);var V=_(X);V.textContent="https://cypherkitty.github.io";var te=b(V,2),re=_(te),G=b(X,2);G.__click=()=>s(d);var K=_(G);K.textContent="https://cypherkitty.github.io/me-ai/";var ae=b(K,2),Z=_(ae),ne=b(A,2),he=_(ne);he.__keydown=se=>se.key==="Enter"&&e.onsave();var _e=b(he,2);_e.__click=function(...se){var Te;(Te=e.onsave)==null||Te.apply(this,se)},ie(se=>{ee(J,o(a)===i?"â":"â§"),ee(M,o(a)===l?"â":"â§"),ee(Y,o(a)===i?"â":"â§"),ee(re,o(a)===l?"â":"â§"),ee(Z,o(a)===d?"â":"â§"),_e.disabled=se},[()=>!n().trim()]),fa(he,n),T(x,S)};pe(p,x=>{r()?x(h):x(y,!1)})}T(t,f),st()}Zt(["click","keydown"]);function d1(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),r=e instanceof pd?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const a=n.match(/project\s+(\d+)/),s=a==null?void 0:a[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:s?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${s}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return r===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:r===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:r===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var f1=q('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),v1=q('<div class="error-card-title svelte-14buhqq"> </div>'),h1=q('<p class="error-card-fix svelte-14buhqq"> </p>'),p1=q('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),g1=q('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),m1=q('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function Vp(t,e){at(e,!0);let n=Ee(e,"ondismiss",3,null),r=Ee(e,"onsignout",3,null),a=Q(()=>d1(e.error));Sn(()=>cr("ErrorCard"));var s=m1(),i=_(s);{var l=D=>{var L=f1(),W=_(L),k=_(W),H=b(W,2);H.__click=function(...B){var O;(O=n())==null||O.apply(this,B)},ie(()=>ee(k,o(a).title)),T(D,L)},d=D=>{var L=v1(),W=_(L);ie(()=>ee(W,o(a).title)),T(D,L)};pe(i,D=>{n()?D(l):D(d,!1)})}var f=b(i,2),v=_(f),p=b(f,2);{var h=D=>{var L=h1(),W=_(L);ie(()=>ee(W,o(a).fix)),T(D,L)};pe(p,D=>{o(a).fix&&D(h)})}var y=b(p,2);{var x=D=>{var L=p1(),W=_(L);ie(()=>{xt(L,"href",o(a).link.url),ee(W,`${o(a).link.label??""} â`)}),T(D,L)};pe(y,D=>{o(a).link&&D(x)})}var S=b(y,2);{var A=D=>{var L=g1();L.__click=function(...W){var k;(k=r())==null||k.apply(this,W)},T(D,L)};pe(S,D=>{o(a).action==="signout"&&r()&&D(A)})}ie(()=>ee(v,o(a).description)),T(t,s),st()}Zt(["click"]);var y1=q('<span class="spinner svelte-nyqevv"></span> Signing in...',1),_1=mn('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),b1=q('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),w1=q('<span class="client-id-value svelte-nyqevv"> </span>'),x1=q(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function k1(t,e){at(e,!0);let n=Ee(e,"isDefaultClientId",3,!1),r=Ee(e,"error",3,null),a=Ee(e,"loadingAuth",3,!1);Sn(()=>cr("AuthCard"));var s=x1(),i=_(s),l=b(_(i),4);{var d=L=>{Vp(L,{get error(){return r()},get onsignout(){return e.onsignout}})};pe(l,L=>{r()&&L(d)})}var f=b(l,2);f.__click=function(...L){var W;(W=e.onsignin)==null||W.apply(this,L)};var v=_(f);{var p=L=>{var W=y1();T(L,W)},h=L=>{var W=_1();T(L,W)};pe(v,L=>{a()?L(p):L(h,!1)})}var y=b(f,4),x=b(_(y),2);{var S=L=>{var W=b1();T(L,W)},A=L=>{var W=w1(),k=_(W);ie(H=>ee(k,`${H??""}...`),[()=>e.clientId.slice(0,20)]),T(L,W)};pe(x,L=>{n()?L(S):L(A,!1)})}var D=b(x,2);D.__click=function(...L){var W;(W=e.onclear)==null||W.apply(this,L)},ie(()=>f.disabled=a()),T(t,s),st()}Zt(["click"]);var S1=q('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),E1=q('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),A1=q('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function T1(t,e){at(e,!0);let n=Ee(e,"profile",3,null),r=Ee(e,"loadingProfile",3,!1);Sn(()=>cr("ProfileCard"));var a=A1(),s=_(a),i=_(s),l=b(s,2),d=_(l);{var f=h=>{var y=S1();T(h,y)},v=h=>{var y=E1(),x=Xe(y),S=_(x),A=b(x,2),D=_(A);ie((L,W)=>{ee(S,n().emailAddress),ee(D,`${L??""} messages
        Â· ${W??""} threads`)},[()=>{var L;return((L=n().messagesTotal)==null?void 0:L.toLocaleString())||"?"},()=>{var L;return((L=n().threadsTotal)==null?void 0:L.toLocaleString())||"?"}]),T(h,y)};pe(d,h=>{r()?h(f):n()&&h(v,1)})}var p=b(l,2);p.__click=function(...h){var y;(y=e.onsignout)==null||y.apply(this,h)},ie(h=>ee(i,h),[()=>n()?yp(n().emailAddress):"?"]),T(t,a),st()}Zt(["click"]);var C1=q('<span class="spinner svelte-1ds3j4k"></span>'),I1=mn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),P1=q('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),M1=q('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),O1=q('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),N1=q('<option class="svelte-1ds3j4k"> </option>'),D1=q('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),R1=q('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),L1=q('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),z1=q('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),j1=q('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),q1=q('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function B1(t,e){at(e,!0),Sn(()=>cr("SyncStatus"));let n=Ee(e,"syncStatus",3,null),r=Ee(e,"syncProgress",3,null),a=Ee(e,"isSyncing",3,!1),s=Pe(!1),i=Pe(50);const l=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function d(Y){if(!Y)return"never";const X=Math.floor((Date.now()-Y)/1e3);if(X<60)return"just now";const V=Math.floor(X/60);if(V<60)return`${V}m ago`;const te=Math.floor(V/60);return te<24?`${te}h ago`:`${Math.floor(te/24)}d ago`}function f(){var Y,X;return!((Y=r())!=null&&Y.total)||!((X=r())!=null&&X.current)?0:Math.round(r().current/r().total*100)}var v=q1(),p=_(v),h=_(p),y=_(h);{var x=Y=>{var X=C1();T(Y,X)},S=Y=>{var X=I1();T(Y,X)};pe(y,Y=>{a()?Y(x):Y(S,!1)})}var A=b(h,2),D=b(_(A),2);{var L=Y=>{var X=P1(),V=_(X),te=b(V);{var re=K=>{var ae=on("Â· more available");T(K,ae)},G=K=>{var ae=on("Â· all synced");T(K,ae)};pe(te,K=>{n().hasMore?K(re):K(G,!1)})}ie((K,ae)=>ee(V,`${K??""} emails stored
          Â· synced ${ae??""} `),[()=>n().totalItems.toLocaleString(),()=>d(n().lastSyncAt)]),T(Y,X)},W=Y=>{var X=M1();T(Y,X)};pe(D,Y=>{var X;(X=n())!=null&&X.synced?Y(L):Y(W,!1)})}var k=b(A,2),H=_(k);{var B=Y=>{var X=O1();X.__click=()=>P(s,!o(s)),T(Y,X)};pe(H,Y=>{var X;(X=n())!=null&&X.synced&&!a()&&Y(B)})}var O=b(p,2),J=_(O),le=b(_(J),2);Nt(le,21,()=>l,Yt,(Y,X)=>{var V=N1(),te=_(V),re={};ie(()=>{ee(te,o(X).label),re!==(re=o(X).value)&&(V.value=(V.__value=o(X).value)??"")}),T(Y,V)});var ke=b(J,2),j=_(ke);{var M=Y=>{var X=R1(),V=Xe(X);V.__click=()=>e.onsync(o(i));var te=_(V),re=b(V,2);{var G=K=>{var ae=D1();ae.__click=()=>e.onsyncmore(o(i));var Z=_(ae);ie(()=>{ae.disabled=a(),ee(Z,a()?"Loading...":"Sync More")}),T(K,ae)};pe(re,K=>{n().hasMore&&K(G)})}ie(()=>{V.disabled=a(),ee(te,a()?"Syncing...":"Sync New")}),T(Y,X)},z=Y=>{var X=L1();X.__click=()=>e.onsync(o(i));var V=_(X);ie(()=>{X.disabled=a(),ee(V,a()?"Syncing...":"Download Emails")}),T(Y,X)};pe(j,Y=>{var X;(X=n())!=null&&X.synced?Y(M):Y(z,!1)})}var C=b(O,2);{var N=Y=>{var X=z1(),V=_(X),te=_(V);let re,G;var K=b(V,2),ae=_(K);ie(Z=>{re=Tt(te,1,"progress-fill svelte-1ds3j4k",null,re,{indeterminate:!r().total}),G=Dt(te,"",G,Z),ee(ae,r().message||"Syncing...")},[()=>({width:`${f()??""}%`})]),T(Y,X)};pe(C,Y=>{a()&&r()&&Y(N)})}var I=b(C,2);{var $=Y=>{var X=j1(),V=b(_(X),2),te=_(V);te.__click=()=>P(s,!1);var re=b(te,2);re.__click=()=>{e.onclear(),P(s,!1)},T(Y,X)};pe(I,Y=>{o(s)&&Y($)})}ie(()=>le.disabled=a()),ho(le,()=>o(i),Y=>P(i,Y)),T(t,v),st()}Zt(["click"]);var F1=q('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),K1=q('<div class="message-list svelte-y2uamw"></div>');function H1(t,e){at(e,!0);let n=Ee(e,"messages",19,()=>[]);Sn(()=>cr("MessageList"));var r=K1();Nt(r,21,n,Yt,(a,s)=>{var i=F1();i.__click=()=>e.onselect(o(s));var l=_(i),d=_(l),f=b(l,2),v=_(f),p=_(v),h=_(p),y=b(p,2),x=_(y),S=b(v,2),A=_(S),D=b(S,2),L=_(D);ie((W,k,H)=>{ee(d,W),ee(h,k),ee(x,H),ee(A,o(s).subject),ee(L,o(s).snippet)},[()=>yp(o(s).from),()=>mp(o(s).from),()=>gd(o(s).date)]),T(a,i)}),T(t,r),st()}Zt(["click"]);function xd(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ss=xd();function Up(t){Ss=t}var Za={exec:()=>null};function Bt(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(a,s)=>{let i=typeof s=="string"?s:s.source;return i=i.replace(qn.caret,"$1"),n=n.replace(a,i),r},getRegex:()=>new RegExp(n,e)};return r}var V1=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),qn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},U1=/^(?:[ \t]*(?:\n|$))+/,G1=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,W1=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,go=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Y1=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,kd=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,Gp=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Wp=Bt(Gp).replace(/bull/g,kd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),X1=Bt(Gp).replace(/bull/g,kd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Sd=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Z1=/^[^\n]+/,Ed=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Q1=Bt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ed).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),J1=Bt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,kd).getRegex(),Xl="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ad=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,$1=Bt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ad).replace("tag",Xl).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Yp=Bt(Sd).replace("hr",go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xl).getRegex(),ex=Bt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Yp).getRegex(),Td={blockquote:ex,code:G1,def:Q1,fences:W1,heading:Y1,hr:go,html:$1,lheading:Wp,list:J1,newline:U1,paragraph:Yp,table:Za,text:Z1},Zf=Bt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xl).getRegex(),tx={...Td,lheading:X1,table:Zf,paragraph:Bt(Sd).replace("hr",go).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Zf).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Xl).getRegex()},nx={...Td,html:Bt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ad).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Za,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Bt(Sd).replace("hr",go).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Wp).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},rx=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ax=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Xp=/^( {2,}|\\)\n(?!\s*$)/,sx=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Zl=/[\p{P}\p{S}]/u,Cd=/[\s\p{P}\p{S}]/u,Zp=/[^\s\p{P}\p{S}]/u,ix=Bt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Cd).getRegex(),Qp=/(?!~)[\p{P}\p{S}]/u,ox=/(?!~)[\s\p{P}\p{S}]/u,lx=/(?:[^\s\p{P}\p{S}]|~)/u,Jp=/(?![*_])[\p{P}\p{S}]/u,cx=/(?![*_])[\s\p{P}\p{S}]/u,ux=/(?:[^\s\p{P}\p{S}]|[*_])/u,dx=Bt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",V1?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),$p=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,fx=Bt($p,"u").replace(/punct/g,Zl).getRegex(),vx=Bt($p,"u").replace(/punct/g,Qp).getRegex(),eg="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",hx=Bt(eg,"gu").replace(/notPunctSpace/g,Zp).replace(/punctSpace/g,Cd).replace(/punct/g,Zl).getRegex(),px=Bt(eg,"gu").replace(/notPunctSpace/g,lx).replace(/punctSpace/g,ox).replace(/punct/g,Qp).getRegex(),gx=Bt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Zp).replace(/punctSpace/g,Cd).replace(/punct/g,Zl).getRegex(),mx=Bt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Jp).getRegex(),yx="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",_x=Bt(yx,"gu").replace(/notPunctSpace/g,ux).replace(/punctSpace/g,cx).replace(/punct/g,Jp).getRegex(),bx=Bt(/\\(punct)/,"gu").replace(/punct/g,Zl).getRegex(),wx=Bt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),xx=Bt(Ad).replace("(?:-->|$)","-->").getRegex(),kx=Bt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",xx).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),yl=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Sx=Bt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",yl).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),tg=Bt(/^!?\[(label)\]\[(ref)\]/).replace("label",yl).replace("ref",Ed).getRegex(),ng=Bt(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ed).getRegex(),Ex=Bt("reflink|nolink(?!\\()","g").replace("reflink",tg).replace("nolink",ng).getRegex(),Qf=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Id={_backpedal:Za,anyPunctuation:bx,autolink:wx,blockSkip:dx,br:Xp,code:ax,del:Za,delLDelim:Za,delRDelim:Za,emStrongLDelim:fx,emStrongRDelimAst:hx,emStrongRDelimUnd:gx,escape:rx,link:Sx,nolink:ng,punctuation:ix,reflink:tg,reflinkSearch:Ex,tag:kx,text:sx,url:Za},Ax={...Id,link:Bt(/^!?\[(label)\]\((.*?)\)/).replace("label",yl).getRegex(),reflink:Bt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",yl).getRegex()},Tu={...Id,emStrongRDelimAst:px,emStrongLDelim:vx,delLDelim:mx,delRDelim:_x,url:Bt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Qf).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Bt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Qf).getRegex()},Tx={...Tu,br:Bt(Xp).replace("{2,}","*").getRegex(),text:Bt(Tu.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ho={normal:Td,gfm:tx,pedantic:nx},wi={normal:Id,gfm:Tu,breaks:Tx,pedantic:Ax},Cx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Jf=t=>Cx[t];function sa(t,e){if(e){if(qn.escapeTest.test(t))return t.replace(qn.escapeReplace,Jf)}else if(qn.escapeTestNoEncode.test(t))return t.replace(qn.escapeReplaceNoEncode,Jf);return t}function $f(t){try{t=encodeURI(t).replace(qn.percentDecode,"%")}catch{return null}return t}function ev(t,e){var s;let n=t.replace(qn.findPipe,(i,l,d)=>{let f=!1,v=l;for(;--v>=0&&d[v]==="\\";)f=!f;return f?"|":" |"}),r=n.split(qn.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((s=r.at(-1))!=null&&s.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(qn.slashPipe,"|");return r}function xi(t,e,n){let r=t.length;if(r===0)return"";let a=0;for(;a<r&&t.charAt(r-a-1)===e;)a++;return t.slice(0,r-a)}function Ix(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function Px(t,e=0){let n=e,r="";for(let a of t)if(a==="	"){let s=4-n%4;r+=" ".repeat(s),n+=s}else r+=a,n++;return r}function tv(t,e,n,r,a){let s=e.href,i=e.title||null,l=t[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let d={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:i,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,d}function Mx(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let a=r[1];return e.split(`
`).map(s=>{let i=s.match(n.other.beginningSpace);if(i===null)return s;let[l]=i;return l.length>=a.length?s.slice(a.length):s}).join(`
`)}var _l=class{constructor(t){ht(this,"options");ht(this,"rules");ht(this,"lexer");this.options=t||Ss}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:xi(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=Mx(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=xi(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:xi(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=xi(e[0],`
`).split(`
`),r="",a="",s=[];for(;n.length>0;){let i=!1,l=[],d;for(d=0;d<n.length;d++)if(this.rules.other.blockquoteStart.test(n[d]))l.push(n[d]),i=!0;else if(!i)l.push(n[d]);else break;n=n.slice(d);let f=l.join(`
`),v=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${f}`:f,a=a?`${a}
${v}`:v;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(v,s,!0),this.lexer.state.top=p,n.length===0)break;let h=s.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){let y=h,x=y.raw+`
`+n.join(`
`),S=this.blockquote(x);s[s.length-1]=S,r=r.substring(0,r.length-y.raw.length)+S.raw,a=a.substring(0,a.length-y.text.length)+S.text;break}else if((h==null?void 0:h.type)==="list"){let y=h,x=y.raw+`
`+n.join(`
`),S=this.list(x);s[s.length-1]=S,r=r.substring(0,r.length-h.raw.length)+S.raw,a=a.substring(0,a.length-y.raw.length)+S.raw,n=x.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:a}}}list(t){var n,r;let e=this.rules.block.list.exec(t);if(e){let a=e[1].trim(),s=a.length>1,i={type:"list",raw:"",ordered:s,start:s?+a.slice(0,-1):"",loose:!1,items:[]};a=s?`\\d{1,9}\\${a.slice(-1)}`:`\\${a}`,this.options.pedantic&&(a=s?a:"[*+-]");let l=this.rules.other.listItemRegex(a),d=!1;for(;t;){let v=!1,p="",h="";if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;p=e[0],t=t.substring(p.length);let y=Px(e[2].split(`
`,1)[0],e[1].length),x=t.split(`
`,1)[0],S=!y.trim(),A=0;if(this.options.pedantic?(A=2,h=y.trimStart()):S?A=e[1].length+1:(A=y.search(this.rules.other.nonSpaceChar),A=A>4?1:A,h=y.slice(A),A+=e[1].length),S&&this.rules.other.blankLine.test(x)&&(p+=x+`
`,t=t.substring(x.length+1),v=!0),!v){let D=this.rules.other.nextBulletRegex(A),L=this.rules.other.hrRegex(A),W=this.rules.other.fencesBeginRegex(A),k=this.rules.other.headingBeginRegex(A),H=this.rules.other.htmlBeginRegex(A),B=this.rules.other.blockquoteBeginRegex(A);for(;t;){let O=t.split(`
`,1)[0],J;if(x=O,this.options.pedantic?(x=x.replace(this.rules.other.listReplaceNesting,"  "),J=x):J=x.replace(this.rules.other.tabCharGlobal,"    "),W.test(x)||k.test(x)||H.test(x)||B.test(x)||D.test(x)||L.test(x))break;if(J.search(this.rules.other.nonSpaceChar)>=A||!x.trim())h+=`
`+J.slice(A);else{if(S||y.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||W.test(y)||k.test(y)||L.test(y))break;h+=`
`+x}S=!x.trim(),p+=O+`
`,t=t.substring(O.length+1),y=J.slice(A)}}i.loose||(d?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(d=!0)),i.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(h),loose:!1,text:h,tokens:[]}),i.raw+=p}let f=i.items.at(-1);if(f)f.raw=f.raw.trimEnd(),f.text=f.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let v of i.items){if(this.lexer.state.top=!1,v.tokens=this.lexer.blockTokens(v.text,[]),v.task){if(v.text=v.text.replace(this.rules.other.listReplaceTask,""),((n=v.tokens[0])==null?void 0:n.type)==="text"||((r=v.tokens[0])==null?void 0:r.type)==="paragraph"){v.tokens[0].raw=v.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),v.tokens[0].text=v.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let h=this.lexer.inlineQueue.length-1;h>=0;h--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[h].src)){this.lexer.inlineQueue[h].src=this.lexer.inlineQueue[h].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(v.raw);if(p){let h={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};v.checked=h.checked,i.loose?v.tokens[0]&&["paragraph","text"].includes(v.tokens[0].type)&&"tokens"in v.tokens[0]&&v.tokens[0].tokens?(v.tokens[0].raw=h.raw+v.tokens[0].raw,v.tokens[0].text=h.raw+v.tokens[0].text,v.tokens[0].tokens.unshift(h)):v.tokens.unshift({type:"paragraph",raw:h.raw,text:h.raw,tokens:[h]}):v.tokens.unshift(h)}}if(!i.loose){let p=v.tokens.filter(y=>y.type==="space"),h=p.length>0&&p.some(y=>this.rules.other.anyLine.test(y.raw));i.loose=h}}if(i.loose)for(let v of i.items){v.loose=!0;for(let p of v.tokens)p.type==="text"&&(p.type="paragraph")}return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:a}}}table(t){var i;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=ev(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(i=e[3])!=null&&i.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let l of r)this.rules.other.tableAlignRight.test(l)?s.align.push("right"):this.rules.other.tableAlignCenter.test(l)?s.align.push("center"):this.rules.other.tableAlignLeft.test(l)?s.align.push("left"):s.align.push(null);for(let l=0;l<n.length;l++)s.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:s.align[l]});for(let l of a)s.rows.push(ev(l,s.header.length).map((d,f)=>({text:d,tokens:this.lexer.inline(d),header:!1,align:s.align[f]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=xi(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Ix(e[2],"()");if(s===-2)return;if(s>-1){let i=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,i).trim(),e[3]=""}}let r=e[2],a="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],a=s[3])}else a=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),tv(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[r.toLowerCase()];if(!a){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return tv(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,d=0,f=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,e=e.slice(-1*t.length+a);(r=f.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(i=[...s].length,r[3]||r[4]){l+=i;continue}else if((r[5]||r[6])&&a%3&&!((a+i)%3)){d+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l+d);let v=[...r[0]][0].length,p=t.slice(0,a+r.index+v+i);if(Math.min(a,i)%2){let y=p.slice(1,-1);return{type:"em",raw:p,text:y,tokens:this.lexer.inlineTokens(y)}}let h=p.slice(2,-2);return{type:"strong",raw:p,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let r=this.rules.inline.delLDelim.exec(t);if(r&&(!r[1]||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,d=this.rules.inline.delRDelim;for(d.lastIndex=0,e=e.slice(-1*t.length+a);(r=d.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s||(i=[...s].length,i!==a))continue;if(r[3]||r[4]){l+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l);let f=[...r[0]][0].length,v=t.slice(0,a+r.index+f+i),p=v.slice(a,-a);return{type:"del",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,a;if(e[2]==="@")r=e[0],a="mailto:"+r;else{let s;do s=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(s!==e[0]);r=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Ar=class Cu{constructor(e){ht(this,"tokens");ht(this,"options");ht(this,"state");ht(this,"inlineQueue");ht(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ss,this.options.tokenizer=this.options.tokenizer||new _l,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:qn,block:Ho.normal,inline:wi.normal};this.options.pedantic?(n.block=Ho.pedantic,n.inline=wi.pedantic):this.options.gfm&&(n.block=Ho.gfm,this.options.breaks?n.inline=wi.breaks:n.inline=wi.gfm),this.tokenizer.rules=n}static get rules(){return{block:Ho,inline:wi}}static lex(e,n){return new Cu(n).lex(e)}static lexInline(e,n){return new Cu(n).inlineTokens(e)}lex(e){e=e.replace(qn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var a,s,i;for(this.options.pedantic&&(e=e.replace(qn.tabCharGlobal,"    ").replace(qn.spaceLine,""));e;){let l;if((s=(a=this.options.extensions)==null?void 0:a.block)!=null&&s.some(f=>(l=f.call({lexer:this},e,n))?(e=e.substring(l.raw.length),n.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);let f=n.at(-1);l.raw.length===1&&f!==void 0?f.raw+=`
`:n.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.at(-1).src=f.text):n.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.raw,this.inlineQueue.at(-1).src=f.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title},n.push(l));continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),n.push(l);continue}let d=e;if((i=this.options.extensions)!=null&&i.startBlock){let f=1/0,v=e.slice(1),p;this.options.extensions.startBlock.forEach(h=>{p=h.call({lexer:this},v),typeof p=="number"&&p>=0&&(f=Math.min(f,p))}),f<1/0&&f>=0&&(d=e.substring(0,f+1))}if(this.state.top&&(l=this.tokenizer.paragraph(d))){let f=n.at(-1);r&&(f==null?void 0:f.type)==="paragraph"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(l),r=d.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);let f=n.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=(f.raw.endsWith(`
`)?"":`
`)+l.raw,f.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):n.push(l);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var d,f,v,p,h;let r=e,a=null;if(this.tokens.links){let y=Object.keys(this.tokens.links);if(y.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)y.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=a[2]?a[2].length:0,r=r.slice(0,a.index+s)+"["+"a".repeat(a[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((f=(d=this.options.hooks)==null?void 0:d.emStrongMask)==null?void 0:f.call({lexer:this},r))??r;let i=!1,l="";for(;e;){i||(l=""),i=!1;let y;if((p=(v=this.options.extensions)==null?void 0:v.inline)!=null&&p.some(S=>(y=S.call({lexer:this},e,n))?(e=e.substring(y.raw.length),n.push(y),!0):!1))continue;if(y=this.tokenizer.escape(e)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.tag(e)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.link(e)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(y.raw.length);let S=n.at(-1);y.type==="text"&&(S==null?void 0:S.type)==="text"?(S.raw+=y.raw,S.text+=y.text):n.push(y);continue}if(y=this.tokenizer.emStrong(e,r,l)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.codespan(e)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.br(e)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.del(e,r,l)){e=e.substring(y.raw.length),n.push(y);continue}if(y=this.tokenizer.autolink(e)){e=e.substring(y.raw.length),n.push(y);continue}if(!this.state.inLink&&(y=this.tokenizer.url(e))){e=e.substring(y.raw.length),n.push(y);continue}let x=e;if((h=this.options.extensions)!=null&&h.startInline){let S=1/0,A=e.slice(1),D;this.options.extensions.startInline.forEach(L=>{D=L.call({lexer:this},A),typeof D=="number"&&D>=0&&(S=Math.min(S,D))}),S<1/0&&S>=0&&(x=e.substring(0,S+1))}if(y=this.tokenizer.inlineText(x)){e=e.substring(y.raw.length),y.raw.slice(-1)!=="_"&&(l=y.raw.slice(-1)),i=!0;let S=n.at(-1);(S==null?void 0:S.type)==="text"?(S.raw+=y.raw,S.text+=y.text):n.push(y);continue}if(e){let S="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(S);break}else throw new Error(S)}}return n}},bl=class{constructor(t){ht(this,"options");ht(this,"parser");this.options=t||Ss}space(t){return""}code({text:t,lang:e,escaped:n}){var s;let r=(s=(e||"").match(qn.notSpaceStart))==null?void 0:s[0],a=t.replace(qn.endingNewline,"")+`
`;return r?'<pre><code class="language-'+sa(r)+'">'+(n?a:sa(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:sa(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let i=0;i<t.items.length;i++){let l=t.items[i];r+=this.listitem(l)}let a=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+a+s+`>
`+r+"</"+a+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let r="";for(let a=0;a<t.rows.length;a++){let s=t.rows[a];n="";for(let i=0;i<s.length;i++)n+=this.tablecell(s[i]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${sa(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),a=$f(t);if(a===null)return r;t=a;let s='<a href="'+t+'"';return e&&(s+=' title="'+sa(e)+'"'),s+=">"+r+"</a>",s}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=$f(t);if(a===null)return sa(n);t=a;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${sa(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:sa(t.text)}},Pd=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Tr=class Iu{constructor(e){ht(this,"options");ht(this,"renderer");ht(this,"textRenderer");this.options=e||Ss,this.options.renderer=this.options.renderer||new bl,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Pd}static parse(e,n){return new Iu(n).parse(e)}static parseInline(e,n){return new Iu(n).parseInline(e)}parse(e){var r,a;let n="";for(let s=0;s<e.length;s++){let i=e[s];if((a=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&a[i.type]){let d=i,f=this.options.extensions.renderers[d.type].call({parser:this},d);if(f!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(d.type)){n+=f||"";continue}}let l=i;switch(l.type){case"space":{n+=this.renderer.space(l);break}case"hr":{n+=this.renderer.hr(l);break}case"heading":{n+=this.renderer.heading(l);break}case"code":{n+=this.renderer.code(l);break}case"table":{n+=this.renderer.table(l);break}case"blockquote":{n+=this.renderer.blockquote(l);break}case"list":{n+=this.renderer.list(l);break}case"checkbox":{n+=this.renderer.checkbox(l);break}case"html":{n+=this.renderer.html(l);break}case"def":{n+=this.renderer.def(l);break}case"paragraph":{n+=this.renderer.paragraph(l);break}case"text":{n+=this.renderer.text(l);break}default:{let d='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return n}parseInline(e,n=this.renderer){var a,s;let r="";for(let i=0;i<e.length;i++){let l=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[l.type]){let f=this.options.extensions.renderers[l.type].call({parser:this},l);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){r+=f||"";continue}}let d=l;switch(d.type){case"escape":{r+=n.text(d);break}case"html":{r+=n.html(d);break}case"link":{r+=n.link(d);break}case"image":{r+=n.image(d);break}case"checkbox":{r+=n.checkbox(d);break}case"strong":{r+=n.strong(d);break}case"em":{r+=n.em(d);break}case"codespan":{r+=n.codespan(d);break}case"br":{r+=n.br(d);break}case"del":{r+=n.del(d);break}case"text":{r+=n.text(d);break}default:{let f='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return r}},$o,Mi=($o=class{constructor(t){ht(this,"options");ht(this,"block");this.options=t||Ss}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Ar.lex:Ar.lexInline}provideParser(){return this.block?Tr.parse:Tr.parseInline}},ht($o,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ht($o,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),$o),Ox=class{constructor(...t){ht(this,"defaults",xd());ht(this,"options",this.setOptions);ht(this,"parse",this.parseMarkdown(!0));ht(this,"parseInline",this.parseMarkdown(!1));ht(this,"Parser",Tr);ht(this,"Renderer",bl);ht(this,"TextRenderer",Pd);ht(this,"Lexer",Ar);ht(this,"Tokenizer",_l);ht(this,"Hooks",Mi);this.use(...t)}walkTokens(t,e){var r,a;let n=[];for(let s of t)switch(n=n.concat(e.call(this,s)),s.type){case"table":{let i=s;for(let l of i.header)n=n.concat(this.walkTokens(l.tokens,e));for(let l of i.rows)for(let d of l)n=n.concat(this.walkTokens(d.tokens,e));break}case"list":{let i=s;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=s;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[i.type]?this.defaults.extensions.childTokens[i.type].forEach(l=>{let d=i[l].flat(1/0);n=n.concat(this.walkTokens(d,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let s=e.renderers[a.name];s?e.renderers[a.name]=function(...i){let l=a.renderer.apply(this,i);return l===!1&&(l=s.apply(this,i)),l}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[a.level];s?s.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),r.extensions=e),n.renderer){let a=this.defaults.renderer||new bl(this.defaults);for(let s in n.renderer){if(!(s in a))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let i=s,l=n.renderer[i],d=a[i];a[i]=(...f)=>{let v=l.apply(a,f);return v===!1&&(v=d.apply(a,f)),v||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new _l(this.defaults);for(let s in n.tokenizer){if(!(s in a))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let i=s,l=n.tokenizer[i],d=a[i];a[i]=(...f)=>{let v=l.apply(a,f);return v===!1&&(v=d.apply(a,f)),v}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Mi;for(let s in n.hooks){if(!(s in a))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let i=s,l=n.hooks[i],d=a[i];Mi.passThroughHooks.has(s)?a[i]=f=>{if(this.defaults.async&&Mi.passThroughHooksRespectAsync.has(s))return(async()=>{let p=await l.call(a,f);return d.call(a,p)})();let v=l.call(a,f);return d.call(a,v)}:a[i]=(...f)=>{if(this.defaults.async)return(async()=>{let p=await l.apply(a,f);return p===!1&&(p=await d.apply(a,f)),p})();let v=l.apply(a,f);return v===!1&&(v=d.apply(a,f)),v}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(i){let l=[];return l.push(s.call(this,i)),a&&(l=l.concat(a.call(this,i))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Ar.lex(t,e??this.defaults)}parser(t,e){return Tr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},a={...this.defaults,...r},s=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let i=a.hooks?await a.hooks.preprocess(e):e,l=await(a.hooks?await a.hooks.provideLexer():t?Ar.lex:Ar.lexInline)(i,a),d=a.hooks?await a.hooks.processAllTokens(l):l;a.walkTokens&&await Promise.all(this.walkTokens(d,a.walkTokens));let f=await(a.hooks?await a.hooks.provideParser():t?Tr.parse:Tr.parseInline)(d,a);return a.hooks?await a.hooks.postprocess(f):f})().catch(s);try{a.hooks&&(e=a.hooks.preprocess(e));let i=(a.hooks?a.hooks.provideLexer():t?Ar.lex:Ar.lexInline)(e,a);a.hooks&&(i=a.hooks.processAllTokens(i)),a.walkTokens&&this.walkTokens(i,a.walkTokens);let l=(a.hooks?a.hooks.provideParser():t?Tr.parse:Tr.parseInline)(i,a);return a.hooks&&(l=a.hooks.postprocess(l)),l}catch(i){return s(i)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+sa(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},hs=new Ox;function Ut(t,e){return hs.parse(t,e)}Ut.options=Ut.setOptions=function(t){return hs.setOptions(t),Ut.defaults=hs.defaults,Up(Ut.defaults),Ut};Ut.getDefaults=xd;Ut.defaults=Ss;Ut.use=function(...t){return hs.use(...t),Ut.defaults=hs.defaults,Up(Ut.defaults),Ut};Ut.walkTokens=function(t,e){return hs.walkTokens(t,e)};Ut.parseInline=hs.parseInline;Ut.Parser=Tr;Ut.parser=Tr.parse;Ut.Renderer=bl;Ut.TextRenderer=Pd;Ut.Lexer=Ar;Ut.lexer=Ar.lex;Ut.Tokenizer=_l;Ut.Hooks=Mi;Ut.parse=Ut;Ut.options;Ut.setOptions;Ut.use;Ut.walkTokens;Ut.parseInline;Tr.parse;Ar.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:rg,setPrototypeOf:nv,isFrozen:Nx,getPrototypeOf:Dx,getOwnPropertyDescriptor:Rx}=Object;let{freeze:Bn,seal:yr,create:Pu}=Object,{apply:Mu,construct:Ou}=typeof Reflect<"u"&&Reflect;Bn||(Bn=function(e){return e});yr||(yr=function(e){return e});Mu||(Mu=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return e.apply(n,a)});Ou||(Ou=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const Vo=Fn(Array.prototype.forEach),Lx=Fn(Array.prototype.lastIndexOf),rv=Fn(Array.prototype.pop),ki=Fn(Array.prototype.push),zx=Fn(Array.prototype.splice),ol=Fn(String.prototype.toLowerCase),Fc=Fn(String.prototype.toString),Kc=Fn(String.prototype.match),Si=Fn(String.prototype.replace),jx=Fn(String.prototype.indexOf),qx=Fn(String.prototype.trim),Sr=Fn(Object.prototype.hasOwnProperty),zn=Fn(RegExp.prototype.test),Ei=Bx(TypeError);function Fn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Mu(t,e,r)}}function Bx(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Ou(t,n)}}function Ot(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ol;nv&&nv(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const s=n(a);s!==a&&(Nx(e)||(e[r]=s),a=s)}t[a]=!0}return t}function Fx(t){for(let e=0;e<t.length;e++)Sr(t,e)||(t[e]=null);return t}function Br(t){const e=Pu(null);for(const[n,r]of rg(t))Sr(t,n)&&(Array.isArray(r)?e[n]=Fx(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=Br(r):e[n]=r);return e}function Ai(t,e){for(;t!==null;){const r=Rx(t,e);if(r){if(r.get)return Fn(r.get);if(typeof r.value=="function")return Fn(r.value)}t=Dx(t)}function n(){return null}return n}const av=Bn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Hc=Bn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Vc=Bn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Kx=Bn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Uc=Bn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Hx=Bn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),sv=Bn(["#text"]),iv=Bn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Gc=Bn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ov=Bn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Uo=Bn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Vx=yr(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ux=yr(/<%[\w\W]*|[\w\W]*%>/gm),Gx=yr(/\$\{[\w\W]*/gm),Wx=yr(/^data-[\-\w.\u00B7-\uFFFF]+$/),Yx=yr(/^aria-[\-\w]+$/),ag=yr(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Xx=yr(/^(?:\w+script|data):/i),Zx=yr(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),sg=yr(/^html$/i),Qx=yr(/^[a-z][.\w]*(-[.\w]+)+$/i);var lv=Object.freeze({__proto__:null,ARIA_ATTR:Yx,ATTR_WHITESPACE:Zx,CUSTOM_ELEMENT:Qx,DATA_ATTR:Wx,DOCTYPE_NAME:sg,ERB_EXPR:Ux,IS_ALLOWED_URI:ag,IS_SCRIPT_OR_DATA:Xx,MUSTACHE_EXPR:Vx,TMPLIT_EXPR:Gx});const Ti={element:1,text:3,progressingInstruction:7,comment:8,document:9},Jx=function(){return typeof window>"u"?null:window},$x=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},cv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jx();const e=ot=>ig(ot);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Ti.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:l,Element:d,NodeFilter:f,NamedNodeMap:v=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:h,trustedTypes:y}=t,x=d.prototype,S=Ai(x,"cloneNode"),A=Ai(x,"remove"),D=Ai(x,"nextSibling"),L=Ai(x,"childNodes"),W=Ai(x,"parentNode");if(typeof i=="function"){const ot=n.createElement("template");ot.content&&ot.content.ownerDocument&&(n=ot.content.ownerDocument)}let k,H="";const{implementation:B,createNodeIterator:O,createDocumentFragment:J,getElementsByTagName:le}=n,{importNode:ke}=r;let j=cv();e.isSupported=typeof rg=="function"&&typeof W=="function"&&B&&B.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:M,ERB_EXPR:z,TMPLIT_EXPR:C,DATA_ATTR:N,ARIA_ATTR:I,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:Y,CUSTOM_ELEMENT:X}=lv;let{IS_ALLOWED_URI:V}=lv,te=null;const re=Ot({},[...av,...Hc,...Vc,...Uc,...sv]);let G=null;const K=Ot({},[...iv,...Gc,...ov,...Uo]);let ae=Object.seal(Pu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,ne=null;const he=Object.seal(Pu(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let _e=!0,se=!0,Te=!1,be=!0,Me=!1,Ve=!0,Je=!1,ut=!1,Fe=!1,Oe=!1,je=!1,Ne=!1,Be=!0,Ke=!1;const $e="user-content-";let Ze=!0,Ue=!1,tt={},nt=null;const ft=Ot({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let mt=null;const vt=Ot({},["audio","video","img","source","image","track"]);let kt=null;const bt=Ot({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pt="http://www.w3.org/1998/Math/MathML",yt="http://www.w3.org/2000/svg",dt="http://www.w3.org/1999/xhtml";let Le=dt,Rt=!1,Et=null;const Vt=Ot({},[pt,yt,dt],Fc);let De=Ot({},["mi","mo","mn","ms","mtext"]),Qt=Ot({},["annotation-xml"]);const Kn=Ot({},["title","style","font","a","script"]);let ye=null;const ln=["application/xhtml+xml","text/html"],En="text/html";let At=null,Mn=null;const it=n.createElement("form"),ct=function(ce){return ce instanceof RegExp||ce instanceof Function},Pt=function(){let ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Mn&&Mn===ce)){if((!ce||typeof ce!="object")&&(ce={}),ce=Br(ce),ye=ln.indexOf(ce.PARSER_MEDIA_TYPE)===-1?En:ce.PARSER_MEDIA_TYPE,At=ye==="application/xhtml+xml"?Fc:ol,te=Sr(ce,"ALLOWED_TAGS")?Ot({},ce.ALLOWED_TAGS,At):re,G=Sr(ce,"ALLOWED_ATTR")?Ot({},ce.ALLOWED_ATTR,At):K,Et=Sr(ce,"ALLOWED_NAMESPACES")?Ot({},ce.ALLOWED_NAMESPACES,Fc):Vt,kt=Sr(ce,"ADD_URI_SAFE_ATTR")?Ot(Br(bt),ce.ADD_URI_SAFE_ATTR,At):bt,mt=Sr(ce,"ADD_DATA_URI_TAGS")?Ot(Br(vt),ce.ADD_DATA_URI_TAGS,At):vt,nt=Sr(ce,"FORBID_CONTENTS")?Ot({},ce.FORBID_CONTENTS,At):ft,Z=Sr(ce,"FORBID_TAGS")?Ot({},ce.FORBID_TAGS,At):Br({}),ne=Sr(ce,"FORBID_ATTR")?Ot({},ce.FORBID_ATTR,At):Br({}),tt=Sr(ce,"USE_PROFILES")?ce.USE_PROFILES:!1,_e=ce.ALLOW_ARIA_ATTR!==!1,se=ce.ALLOW_DATA_ATTR!==!1,Te=ce.ALLOW_UNKNOWN_PROTOCOLS||!1,be=ce.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Me=ce.SAFE_FOR_TEMPLATES||!1,Ve=ce.SAFE_FOR_XML!==!1,Je=ce.WHOLE_DOCUMENT||!1,Oe=ce.RETURN_DOM||!1,je=ce.RETURN_DOM_FRAGMENT||!1,Ne=ce.RETURN_TRUSTED_TYPE||!1,Fe=ce.FORCE_BODY||!1,Be=ce.SANITIZE_DOM!==!1,Ke=ce.SANITIZE_NAMED_PROPS||!1,Ze=ce.KEEP_CONTENT!==!1,Ue=ce.IN_PLACE||!1,V=ce.ALLOWED_URI_REGEXP||ag,Le=ce.NAMESPACE||dt,De=ce.MATHML_TEXT_INTEGRATION_POINTS||De,Qt=ce.HTML_INTEGRATION_POINTS||Qt,ae=ce.CUSTOM_ELEMENT_HANDLING||{},ce.CUSTOM_ELEMENT_HANDLING&&ct(ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ae.tagNameCheck=ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&ct(ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ae.attributeNameCheck=ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&typeof ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ae.allowCustomizedBuiltInElements=ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Me&&(se=!1),je&&(Oe=!0),tt&&(te=Ot({},sv),G=[],tt.html===!0&&(Ot(te,av),Ot(G,iv)),tt.svg===!0&&(Ot(te,Hc),Ot(G,Gc),Ot(G,Uo)),tt.svgFilters===!0&&(Ot(te,Vc),Ot(G,Gc),Ot(G,Uo)),tt.mathMl===!0&&(Ot(te,Uc),Ot(G,ov),Ot(G,Uo))),ce.ADD_TAGS&&(typeof ce.ADD_TAGS=="function"?he.tagCheck=ce.ADD_TAGS:(te===re&&(te=Br(te)),Ot(te,ce.ADD_TAGS,At))),ce.ADD_ATTR&&(typeof ce.ADD_ATTR=="function"?he.attributeCheck=ce.ADD_ATTR:(G===K&&(G=Br(G)),Ot(G,ce.ADD_ATTR,At))),ce.ADD_URI_SAFE_ATTR&&Ot(kt,ce.ADD_URI_SAFE_ATTR,At),ce.FORBID_CONTENTS&&(nt===ft&&(nt=Br(nt)),Ot(nt,ce.FORBID_CONTENTS,At)),ce.ADD_FORBID_CONTENTS&&(nt===ft&&(nt=Br(nt)),Ot(nt,ce.ADD_FORBID_CONTENTS,At)),Ze&&(te["#text"]=!0),Je&&Ot(te,["html","head","body"]),te.table&&(Ot(te,["tbody"]),delete Z.tbody),ce.TRUSTED_TYPES_POLICY){if(typeof ce.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ei('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ce.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ei('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');k=ce.TRUSTED_TYPES_POLICY,H=k.createHTML("")}else k===void 0&&(k=$x(y,a)),k!==null&&typeof H=="string"&&(H=k.createHTML(""));Bn&&Bn(ce),Mn=ce}},$t=Ot({},[...Hc,...Vc,...Kx]),_t=Ot({},[...Uc,...Hx]),zt=function(ce){let qe=W(ce);(!qe||!qe.tagName)&&(qe={namespaceURI:Le,tagName:"template"});const Ge=ol(ce.tagName),Ft=ol(qe.tagName);return Et[ce.namespaceURI]?ce.namespaceURI===yt?qe.namespaceURI===dt?Ge==="svg":qe.namespaceURI===pt?Ge==="svg"&&(Ft==="annotation-xml"||De[Ft]):!!$t[Ge]:ce.namespaceURI===pt?qe.namespaceURI===dt?Ge==="math":qe.namespaceURI===yt?Ge==="math"&&Qt[Ft]:!!_t[Ge]:ce.namespaceURI===dt?qe.namespaceURI===yt&&!Qt[Ft]||qe.namespaceURI===pt&&!De[Ft]?!1:!_t[Ge]&&(Kn[Ge]||!$t[Ge]):!!(ye==="application/xhtml+xml"&&Et[ce.namespaceURI]):!1},fn=function(ce){ki(e.removed,{element:ce});try{W(ce).removeChild(ce)}catch{A(ce)}},cn=function(ce,qe){try{ki(e.removed,{attribute:qe.getAttributeNode(ce),from:qe})}catch{ki(e.removed,{attribute:null,from:qe})}if(qe.removeAttribute(ce),ce==="is")if(Oe||je)try{fn(qe)}catch{}else try{qe.setAttribute(ce,"")}catch{}},Jt=function(ce){let qe=null,Ge=null;if(Fe)ce="<remove></remove>"+ce;else{const un=Kc(ce,/^[\r\n\t ]+/);Ge=un&&un[0]}ye==="application/xhtml+xml"&&Le===dt&&(ce='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ce+"</body></html>");const Ft=k?k.createHTML(ce):ce;if(Le===dt)try{qe=new h().parseFromString(Ft,ye)}catch{}if(!qe||!qe.documentElement){qe=B.createDocument(Le,"template",null);try{qe.documentElement.innerHTML=Rt?H:Ft}catch{}}const nn=qe.body||qe.documentElement;return ce&&Ge&&nn.insertBefore(n.createTextNode(Ge),nn.childNodes[0]||null),Le===dt?le.call(qe,Je?"html":"body")[0]:Je?qe.documentElement:nn},en=function(ce){return O.call(ce.ownerDocument||ce,ce,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},Ln=function(ce){return ce instanceof p&&(typeof ce.nodeName!="string"||typeof ce.textContent!="string"||typeof ce.removeChild!="function"||!(ce.attributes instanceof v)||typeof ce.removeAttribute!="function"||typeof ce.setAttribute!="function"||typeof ce.namespaceURI!="string"||typeof ce.insertBefore!="function"||typeof ce.hasChildNodes!="function")},On=function(ce){return typeof l=="function"&&ce instanceof l};function Nn(ot,ce,qe){Vo(ot,Ge=>{Ge.call(e,ce,qe,Mn)})}const br=function(ce){let qe=null;if(Nn(j.beforeSanitizeElements,ce,null),Ln(ce))return fn(ce),!0;const Ge=At(ce.nodeName);if(Nn(j.uponSanitizeElement,ce,{tagName:Ge,allowedTags:te}),Ve&&ce.hasChildNodes()&&!On(ce.firstElementChild)&&zn(/<[/\w!]/g,ce.innerHTML)&&zn(/<[/\w!]/g,ce.textContent)||ce.nodeType===Ti.progressingInstruction||Ve&&ce.nodeType===Ti.comment&&zn(/<[/\w]/g,ce.data))return fn(ce),!0;if(!(he.tagCheck instanceof Function&&he.tagCheck(Ge))&&(!te[Ge]||Z[Ge])){if(!Z[Ge]&&xo(Ge)&&(ae.tagNameCheck instanceof RegExp&&zn(ae.tagNameCheck,Ge)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(Ge)))return!1;if(Ze&&!nt[Ge]){const Ft=W(ce)||ce.parentNode,nn=L(ce)||ce.childNodes;if(nn&&Ft){const un=nn.length;for(let hn=un-1;hn>=0;--hn){const Hn=S(nn[hn],!0);Hn.__removalCount=(ce.__removalCount||0)+1,Ft.insertBefore(Hn,D(ce))}}}return fn(ce),!0}return ce instanceof d&&!zt(ce)||(Ge==="noscript"||Ge==="noembed"||Ge==="noframes")&&zn(/<\/no(script|embed|frames)/i,ce.innerHTML)?(fn(ce),!0):(Me&&ce.nodeType===Ti.text&&(qe=ce.textContent,Vo([M,z,C],Ft=>{qe=Si(qe,Ft," ")}),ce.textContent!==qe&&(ki(e.removed,{element:ce.cloneNode()}),ce.textContent=qe)),Nn(j.afterSanitizeElements,ce,null),!1)},Fa=function(ce,qe,Ge){if(Be&&(qe==="id"||qe==="name")&&(Ge in n||Ge in it))return!1;if(!(se&&!ne[qe]&&zn(N,qe))){if(!(_e&&zn(I,qe))){if(!(he.attributeCheck instanceof Function&&he.attributeCheck(qe,ce))){if(!G[qe]||ne[qe]){if(!(xo(ce)&&(ae.tagNameCheck instanceof RegExp&&zn(ae.tagNameCheck,ce)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(ce))&&(ae.attributeNameCheck instanceof RegExp&&zn(ae.attributeNameCheck,qe)||ae.attributeNameCheck instanceof Function&&ae.attributeNameCheck(qe,ce))||qe==="is"&&ae.allowCustomizedBuiltInElements&&(ae.tagNameCheck instanceof RegExp&&zn(ae.tagNameCheck,Ge)||ae.tagNameCheck instanceof Function&&ae.tagNameCheck(Ge))))return!1}else if(!kt[qe]){if(!zn(V,Si(Ge,Y,""))){if(!((qe==="src"||qe==="xlink:href"||qe==="href")&&ce!=="script"&&jx(Ge,"data:")===0&&mt[ce])){if(!(Te&&!zn($,Si(Ge,Y,"")))){if(Ge)return!1}}}}}}}return!0},xo=function(ce){return ce!=="annotation-xml"&&Kc(ce,X)},wr=function(ce){Nn(j.beforeSanitizeAttributes,ce,null);const{attributes:qe}=ce;if(!qe||Ln(ce))return;const Ge={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:G,forceKeepAttr:void 0};let Ft=qe.length;for(;Ft--;){const nn=qe[Ft],{name:un,namespaceURI:hn,value:Hn}=nn,zr=At(un),Ka=Hn;let an=un==="value"?Ka:qx(Ka);if(Ge.attrName=zr,Ge.attrValue=an,Ge.keepAttr=!0,Ge.forceKeepAttr=void 0,Nn(j.uponSanitizeAttribute,ce,Ge),an=Ge.attrValue,Ke&&(zr==="id"||zr==="name")&&(cn(un,ce),an=$e+an),Ve&&zn(/((--!?|])>)|<\/(style|title|textarea)/i,an)){cn(un,ce);continue}if(zr==="attributename"&&Kc(an,"href")){cn(un,ce);continue}if(Ge.forceKeepAttr)continue;if(!Ge.keepAttr){cn(un,ce);continue}if(!be&&zn(/\/>/i,an)){cn(un,ce);continue}Me&&Vo([M,z,C],Ha=>{an=Si(an,Ha," ")});const ci=At(ce.nodeName);if(!Fa(ci,zr,an)){cn(un,ce);continue}if(k&&typeof y=="object"&&typeof y.getAttributeType=="function"&&!hn)switch(y.getAttributeType(ci,zr)){case"TrustedHTML":{an=k.createHTML(an);break}case"TrustedScriptURL":{an=k.createScriptURL(an);break}}if(an!==Ka)try{hn?ce.setAttributeNS(hn,un,an):ce.setAttribute(un,an),Ln(ce)?fn(ce):rv(e.removed)}catch{cn(un,ce)}}Nn(j.afterSanitizeAttributes,ce,null)},ko=function ot(ce){let qe=null;const Ge=en(ce);for(Nn(j.beforeSanitizeShadowDOM,ce,null);qe=Ge.nextNode();)Nn(j.uponSanitizeShadowNode,qe,null),br(qe),wr(qe),qe.content instanceof s&&ot(qe.content);Nn(j.afterSanitizeShadowDOM,ce,null)};return e.sanitize=function(ot){let ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},qe=null,Ge=null,Ft=null,nn=null;if(Rt=!ot,Rt&&(ot="<!-->"),typeof ot!="string"&&!On(ot))if(typeof ot.toString=="function"){if(ot=ot.toString(),typeof ot!="string")throw Ei("dirty is not a string, aborting")}else throw Ei("toString is not a function");if(!e.isSupported)return ot;if(ut||Pt(ce),e.removed=[],typeof ot=="string"&&(Ue=!1),Ue){if(ot.nodeName){const Hn=At(ot.nodeName);if(!te[Hn]||Z[Hn])throw Ei("root node is forbidden and cannot be sanitized in-place")}}else if(ot instanceof l)qe=Jt("<!---->"),Ge=qe.ownerDocument.importNode(ot,!0),Ge.nodeType===Ti.element&&Ge.nodeName==="BODY"||Ge.nodeName==="HTML"?qe=Ge:qe.appendChild(Ge);else{if(!Oe&&!Me&&!Je&&ot.indexOf("<")===-1)return k&&Ne?k.createHTML(ot):ot;if(qe=Jt(ot),!qe)return Oe?null:Ne?H:""}qe&&Fe&&fn(qe.firstChild);const un=en(Ue?ot:qe);for(;Ft=un.nextNode();)br(Ft),wr(Ft),Ft.content instanceof s&&ko(Ft.content);if(Ue)return ot;if(Oe){if(je)for(nn=J.call(qe.ownerDocument);qe.firstChild;)nn.appendChild(qe.firstChild);else nn=qe;return(G.shadowroot||G.shadowrootmode)&&(nn=ke.call(r,nn,!0)),nn}let hn=Je?qe.outerHTML:qe.innerHTML;return Je&&te["!doctype"]&&qe.ownerDocument&&qe.ownerDocument.doctype&&qe.ownerDocument.doctype.name&&zn(sg,qe.ownerDocument.doctype.name)&&(hn="<!DOCTYPE "+qe.ownerDocument.doctype.name+`>
`+hn),Me&&Vo([M,z,C],Hn=>{hn=Si(hn,Hn," ")}),k&&Ne?k.createHTML(hn):hn},e.setConfig=function(){let ot=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Pt(ot),ut=!0},e.clearConfig=function(){Mn=null,ut=!1},e.isValidAttribute=function(ot,ce,qe){Mn||Pt({});const Ge=At(ot),Ft=At(ce);return Fa(Ge,Ft,qe)},e.addHook=function(ot,ce){typeof ce=="function"&&ki(j[ot],ce)},e.removeHook=function(ot,ce){if(ce!==void 0){const qe=Lx(j[ot],ce);return qe===-1?void 0:zx(j[ot],qe,1)[0]}return rv(j[ot])},e.removeHooks=function(ot){j[ot]=[]},e.removeAllHooks=function(){j=cv()},e}var ek=ig();function tk(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${uv(t.from)} |`),e.push(`| **To** | ${uv(t.to)} |`),e.push(`| **Date** | ${gd(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?nk(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function uv(t){return(t||"").replace(/\|/g,"\\|")}function nk(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Nu(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function rk(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),r=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||r>0&&r<=3)return!0;const a=e.toLowerCase();return a.includes("spacer")||a.includes("transparent")||a.includes("transp.gif")||a.includes("/track")&&a.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(a)?!0:a.includes("mail.google.com/mail/u/")&&a.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(a)||a.endsWith(".gif")&&a.includes("1x1"))}function Nu(t){var a;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const s=t.getAttribute("src")||"",i=t.getAttribute("alt")||"";return rk(t,s)?"":`![${i}](${s})`}const n=Array.from(t.childNodes).map(Nu).join(""),r=n.trim();if(!r&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${r}

`;if(e==="blockquote")return`

> ${r.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const s=Number(e[1]);return`

${"#".repeat(s)} ${r}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((a=t.parentElement)==null?void 0:a.tagName.toLowerCase())==="ol"?"1.":"-"} ${r}
`;if(e==="a"){const s=t.getAttribute("href")||"";return!s||s.startsWith("mailto:")?r:r===s?s:`[${r}](${s})`}if(e==="strong"||e==="b")return`**${r}**`;if(e==="em"||e==="i")return`*${r}*`;if(e==="code")return`\`${r}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(i=>Nu(i).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const s=n.trim(),i=(s.match(/\|/g)||[]).length-1,l="| "+Array(Math.max(i,1)).fill("---").join(" | ")+" |";return`${s}${l}
`}return n}function ak(t){return _p(t,"md")}function dv(t,e,n="text/markdown;charset=utf-8"){const r=new Blob([t],{type:n}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function sk(t){return t.raw||null}function ik(t){const e=sk(t);return e?JSON.stringify(e,null,2):"null"}function ok(t){return _p(t,"json")}var lk=q('<button title="View as Markdown">.md</button>'),ck=q('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),uk=q('<pre class="md-raw svelte-1b0rzpb"> </pre>'),dk=q('<div class="md-preview svelte-1b0rzpb"><!></div>'),fk=q('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),vk=q('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),hk=q('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),pk=q('<pre class="message-text svelte-1b0rzpb"> </pre>'),gk=q('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),mk=q('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),yk=q('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function _k(t,e){at(e,!0);let n=Ee(e,"loading",3,!1);Sn(()=>cr("MessageModal"));const r=new Ut.Renderer;r.link=({href:M,title:z,text:C})=>{const N=z?` title="${z}"`:"";return`<a href="${M}"${N} target="_blank" rel="noopener">${C}</a>`},Ut.setOptions({breaks:!0,gfm:!0,renderer:r});let a=Pe("email"),s=Q(()=>e.message.body?tk(e.message):""),i=Q(()=>ik(e.message)),l=Pe("raw");function d(M){P(a,o(a)===M?"email":M,!0),M==="markdown"&&P(l,"raw")}function f(){dv(o(s),ak(e.message))}function v(){dv(o(i),ok(e.message),"application/json;charset=utf-8")}function p(M){const z=Ut.parse(M);return ek.sanitize(z,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let h=Pe(null);kn(()=>{var M;if(o(h)&&e.message.htmlBody&&!n()&&o(a)==="email"){const z=o(h).contentDocument||((M=o(h).contentWindow)==null?void 0:M.document);z&&(z.open(),z.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),z.close())}});var y=yk();y.__click=function(...M){var z;(z=e.onclose)==null||z.apply(this,M)};var x=_(y);x.__click=M=>M.stopPropagation();var S=_(x),A=_(S),D=_(A),L=b(A,2),W=_(L);let k;W.__click=()=>d("json");var H=b(W,2);{var B=M=>{var z=lk();let C;z.__click=()=>d("markdown"),ie(()=>C=Tt(z,1,"action-btn svelte-1b0rzpb",null,C,{active:o(a)==="markdown"})),T(M,z)};pe(H,M=>{e.message.body&&M(B)})}var O=b(H,2);O.__click=function(...M){var z;(z=e.onclose)==null||z.apply(this,M)};var J=b(S,2);{var le=M=>{var z=ck(),C=Xe(z),N=b(_(C),2);N.__click=v;var I=b(C,2),$=_(I),Y=_($);ie(()=>ee(Y,o(i))),T(M,z)},ke=M=>{var z=fk(),C=Xe(z),N=_(C),I=_(N);let $;I.__click=()=>P(l,"raw");var Y=b(I,2);let X;Y.__click=()=>P(l,"preview");var V=b(N,2);V.__click=f;var te=b(C,2),re=_(te);{var G=ae=>{var Z=uk(),ne=_(Z);ie(()=>ee(ne,o(s))),T(ae,Z)},K=ae=>{var Z=dk(),ne=_(Z);n_(ne,()=>p(o(s))),T(ae,Z)};pe(re,ae=>{o(l)==="raw"?ae(G):ae(K,!1)})}ie(()=>{$=Tt(I,1,"md-tab svelte-1b0rzpb",null,$,{active:o(l)==="raw"}),X=Tt(Y,1,"md-tab svelte-1b0rzpb",null,X,{active:o(l)==="preview"})}),T(M,z)},j=M=>{var z=mk(),C=Xe(z),N=_(C),I=b(_(N),2),$=_(I),Y=b(N,2),X=b(_(Y),2),V=_(X),te=b(Y,2),re=b(_(te),2),G=_(re),K=b(C,2),ae=_(K);{var Z=se=>{var Te=vk();T(se,Te)},ne=se=>{var Te=hk();xs(Te,be=>P(h,be),()=>o(h)),T(se,Te)},he=se=>{var Te=pk(),be=_(Te);ie(()=>ee(be,e.message.body)),T(se,Te)},_e=se=>{var Te=gk();T(se,Te)};pe(ae,se=>{n()?se(Z):e.message.htmlBody?se(ne,1):e.message.body?se(he,2):se(_e,!1)})}ie(se=>{ee($,e.message.from),ee(V,e.message.to),ee(G,se)},[()=>gd(e.message.date)]),T(M,z)};pe(J,M=>{o(a)==="json"?M(le):o(a)==="markdown"?M(ke,1):M(j,!1)})}ie(()=>{ee(D,e.message.subject),k=Tt(W,1,"action-btn svelte-1b0rzpb",null,k,{active:o(a)==="json"})}),T(t,y),st()}Zt(["click"]);var bk=q('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),wk=q('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),xk=q('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),kk=q("<p> </p>"),Sk=q('<p>No emails in local storage. Click "Sync New" to download.</p>'),Ek=q('<div class="empty-state svelte-6ts5xm"><!></div>'),Ak=q('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Tk=q('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Ck(t,e){at(e,!0),Sn(()=>cr("DashboardView"));let n=Ee(e,"error",3,null),r=Ee(e,"profile",3,null),a=Ee(e,"loadingProfile",3,!1),s=Ee(e,"emailMessages",19,()=>[]),i=Ee(e,"totalLocalMessages",3,0),l=Ee(e,"hasMoreLocal",3,!1),d=Ee(e,"loadingMessages",3,!1),f=Ee(e,"selectedMessage",3,null),v=Ee(e,"syncStatus",3,null),p=Ee(e,"syncProgress",3,null),h=Ee(e,"isSyncing",3,!1),y=Ee(e,"searchQuery",15);var x=Tk(),S=Xe(x),A=_(S);{var D=N=>{Vp(N,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};pe(A,N=>{n()&&N(D)})}var L=b(A,2);T1(L,{get profile(){return r()},get loadingProfile(){return a()},get onsignout(){return e.onsignout}});var W=b(L,2);B1(W,{get syncStatus(){return v()},get syncProgress(){return p()},get isSyncing(){return h()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var k=b(W,2),H=_(k);H.__keydown=N=>N.key==="Enter"&&e.onsearch();var B=b(H,2);B.__click=function(...N){var I;(I=e.onsearch)==null||I.apply(this,N)};var O=_(B),J=b(k,2);{var le=N=>{var I=wk(),$=Xe(I),Y=_($),X=_(Y),V=b($,2);H1(V,{get messages(){return s()},get onselect(){return e.onviewmessage}});var te=b(V,2);{var re=G=>{var K=bk(),ae=_(K);ae.__click=function(...ne){var he;(he=e.onloadmore)==null||he.apply(this,ne)};var Z=_(ae);ie(()=>{ae.disabled=d(),ee(Z,d()?"Loading...":"Load More")}),T(G,K)};pe(te,G=>{l()&&G(re)})}ie(G=>ee(X,`Showing ${s().length??""} of ${G??""}
        ${y()?" matching":""} emails`),[()=>i().toLocaleString()]),T(N,I)},ke=N=>{var I=xk();T(N,I)},j=N=>{var I=Ek(),$=_(I);{var Y=V=>{var te=kk(),re=_(te);ie(()=>ee(re,`No emails match "${y()??""}".`)),T(V,te)},X=V=>{var te=Sk();T(V,te)};pe($,V=>{y()?V(Y):V(X,!1)})}T(N,I)},M=N=>{var I=Ak();T(N,I)};pe(J,N=>{var I;s().length>0?N(le):d()?N(ke,1):(I=v())!=null&&I.synced?N(j,2):N(M,!1)})}var z=b(S,2);{var C=N=>{_k(N,{get message(){return f()},loading:!1,get onclose(){return e.onclosedetail}})};pe(z,N=>{f()&&N(C)})}ie(()=>{B.disabled=d(),ee(O,d()?"Searching...":"Search")}),fa(H,y),T(t,x),st()}Zt(["keydown","click"]);var Ik=q('<div class="dashboard svelte-1q5o2lv"><!></div>');function Pk(t,e){at(e,!0);function n(be){be.key==="Escape"&&o(h)&&re()}let r=null;Sn(async()=>{if(window.addEventListener("keydown",n),!o(l)){const be=await Ki("googleClientId");P(l,be||i,!0),P(d,be||i,!0)}return()=>{window.removeEventListener("keydown",n),r&&clearTimeout(r)}});function a(){r&&clearTimeout(r);const be=M0();if(be<=0)return;const Me=Math.max(0,be-120*1e3);r=setTimeout(async()=>{try{const Ve=await Wf();P(v,Ve.access_token,!0),a()}catch{P(v,null),P(p,null),P(k,"Session expired. Please sign in again.")}},Me)}async function s(){if(P0())return o(v);try{const be=await Wf();return P(v,be.access_token,!0),a(),o(v)}catch{return P(v,null),P(p,null),P(k,"Session expired. Please sign in again."),null}}const i="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let l=Pe(Xt(i)),d=Pe(Xt(i)),f=Pe(!1),v=Pe(null),p=Pe(null),h=Pe(null),y=Pe(""),x=Pe(Xt([])),S=Pe(0),A=Pe(0),D=Pe(!1),L=Pe(!1),W=Pe(!1),k=Pe(null),H=Pe(null),B=Pe(null),O=Pe(!1);const J=50;kn(()=>{o(v)&&(G(),Y())});let le=Q(()=>!o(l)),ke=Q(()=>o(l)===i),j=Q(()=>!!o(v)),M=Q(()=>o(x).length<o(S));kn(()=>{o(l)&&!o(f)&&Yf(o(l)).then(async()=>{if(P(f,!0),!o(v)){const be=await Yl();be&&(P(v,be.access_token,!0),a(),$())}}).catch(be=>{P(k,`Auth init failed: ${be.message}`)})});async function z(){const be=o(d).trim();be&&(await Hi("googleClientId",be),P(l,be,!0),P(k,null))}async function C(){await fd("googleClientId"),P(l,""),P(d,i),P(f,!1),P(v,null),P(p,null),P(x,[],!0),P(S,0)}async function N(){P(k,null),P(L,!0);try{o(f)||(await Yf(o(l)),P(f,!0));const be=await N0();P(v,be.access_token,!0),a(),await $()}catch(be){P(k,be.message,!0)}finally{P(L,!1)}}async function I(){if(r&&clearTimeout(r),o(v))try{await D0(o(v))}catch{}P(v,null),P(p,null),P(x,[],!0),P(S,0),P(h,null),P(k,null)}async function $(){P(W,!0);try{const be=await hp(o(v));if(!o(v))return;P(p,be,!0)}catch(be){if(!o(v))return;P(k,`Profile fetch failed: ${be.message}`)}finally{P(W,!1)}}async function Y(be=!1){P(D,!0);try{const Me=be?o(A):0,Ve=await Z_({query:o(y)||void 0,limit:J,offset:Me});be?P(x,[...o(x),...Ve.items],!0):P(x,Ve.items,!0),P(S,Ve.total,!0),P(A,o(x).length,!0)}catch(Me){P(k,`Failed to load messages: ${Me.message}`)}finally{P(D,!1)}}function X(){P(A,0),Y(!1)}function V(){Y(!0)}function te(be){P(h,be,!0)}function re(){P(h,null)}async function G(){try{P(H,await n1(),!0)}catch{}}async function K(be){if(o(O)||!o(v))return;const Me=await s();if(!Me)return;P(k,null),P(O,!0),P(B,null);const Ve=new AbortController;try{await e1(Me,{limit:be,onProgress:Je=>{P(B,{...Je},!0)},signal:Ve.signal}),await G(),await Y(!1)}catch(Je){if(Je.name!=="AbortError"){if(!o(v))return;P(k,`Sync failed: ${Je.message}`)}}finally{P(O,!1)}}async function ae(be){if(o(O)||!o(v))return;const Me=await s();if(!Me)return;P(k,null),P(O,!0),P(B,null);const Ve=new AbortController;try{await t1(Me,{limit:be,onProgress:Je=>{P(B,{...Je},!0)},signal:Ve.signal}),await G(),await Y(!1)}catch(Je){if(Je.name!=="AbortError"){if(!o(v))return;P(k,`Sync more failed: ${Je.message}`)}}finally{P(O,!1)}}async function Z(){try{await Bp(),await G(),P(x,[],!0),P(S,0),P(A,0)}catch(be){P(k,`Failed to clear data: ${be.message}`)}}var ne=Ik(),he=_(ne);{var _e=be=>{u1(be,{onsave:z,defaultClientId:i,get clientIdInput(){return o(d)},set clientIdInput(Me){P(d,Me,!0)}})},se=be=>{k1(be,{get clientId(){return o(l)},get isDefaultClientId(){return o(ke)},get error(){return o(k)},get loadingAuth(){return o(L)},onsignin:N,onclear:C,onsignout:I})},Te=be=>{Ck(be,{get error(){return o(k)},get profile(){return o(p)},get loadingProfile(){return o(W)},get emailMessages(){return o(x)},get totalLocalMessages(){return o(S)},get hasMoreLocal(){return o(M)},get loadingMessages(){return o(D)},get selectedMessage(){return o(h)},get syncStatus(){return o(H)},get syncProgress(){return o(B)},get isSyncing(){return o(O)},onsignout:I,onsearch:X,onloadmore:V,onviewmessage:te,onclosedetail:re,ondismisserror:()=>P(k,null),onsync:K,onsyncmore:ae,oncleardata:Z,get searchQuery(){return o(y)},set searchQuery(Me){P(y,Me,!0)}})};pe(he,be=>{o(le)?be(_e):o(j)?be(Te,!1):be(se,1)})}T(t,ne),st()}var Mk=q('<span class="err svelte-t1ig66"> </span>'),Ok=q('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Nk=q('<span class="stream-stats svelte-t1ig66"> </span>'),Dk=q('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),Rk=q('<span class="ei-group svelte-t1ig66"> </span>'),Lk=q('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),zk=q('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),jk=q('<span class="sep svelte-t1ig66">Â·</span> ',1),qk=q('<div class="ei-summary svelte-t1ig66"> </div>'),Bk=q('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Fk=q('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Kk=q("<!> <!> <!>",1),Hk=q('<div class="ei-error svelte-t1ig66"> </div>'),Vk=q('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Uk=q('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Gk=q('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Wk=q('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Yk=q(' <span class="sep svelte-t1ig66">Â·</span>',1),Xk=q('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Zk=q('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Qk=q('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),Jk=q('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function $k(t,e){at(e,!0);let n=Ee(e,"progress",3,null);function r(h){return!h||h<0?"â":h<1e3?`${Math.round(h)}ms`:`${(h/1e3).toFixed(1)}s`}function a(h){return h?h>=1e3?`${(h/1e3).toFixed(1)}k`:String(h):"0"}function s(h){if(!h)return"â";const y=h.replace(/<.*>/,"").trim();return y.length>30?y.slice(0,28)+"â¦":y}function i(h){if(!h)return"";try{return new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let l=Q(()=>{var h;return(h=n())!=null&&h.total?Math.round(n().current/n().total*100):0}),d=Q(()=>{var h;return((h=n())==null?void 0:h.phase)==="done"});var f=sn(),v=Xe(f);{var p=h=>{var y=Jk(),x=_(y),S=_(x),A=_(S);{var D=re=>{var G=on();ie(()=>ee(G,`Scan complete â ${(n().classified||0)??""} classified`)),T(re,G)},L=re=>{var G=on("Loading emailsâ¦");T(re,G)},W=re=>{var G=on();ie(()=>ee(G,`Processing ${n().current??0??""} / ${n().total??0??""}`)),T(re,G)};pe(A,re=>{o(d)?re(D):n().phase==="loading"?re(L,1):re(W,!1)})}var k=b(S,2),H=_(k),B=b(x,2),O=_(B);let J,le;var ke=b(B,2);{var j=re=>{var G=Ok(),K=_(G),ae=b(K);{var Z=_e=>{var se=Mk(),Te=_(se);ie(()=>ee(Te,`Â· ${n().errors??""} errors`)),T(_e,se)};pe(ae,_e=>{n().errors&&_e(Z)})}var ne=b(ae,3),he=b(ne,2);ie((_e,se,Te)=>{ee(K,`${(n().classified||0)??""} classified `),ee(ne,` ${_e??""} in + ${se??""} out `),ee(he,` ${Te??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),T(re,G)};pe(ke,re=>{n().totals&&!o(d)&&re(j)})}var M=b(ke,2);{var z=re=>{var G=Dk(),K=_(G),ae=_(K),Z=_(ae),ne=b(ae,2);{var he=Te=>{var be=Nk(),Me=_(be);ie(Ve=>ee(Me,`${Ve??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),T(Te,be)};pe(ne,Te=>{var be;(be=n().live)!=null&&be.tps&&Te(he)})}var _e=b(K,2),se=_(_e);ie(()=>{ee(Z,n().email.subject||"(no subject)"),ee(se,n().streamingText||"Waiting for modelâ¦")}),T(re,G)};pe(M,re=>{!o(d)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&re(z)})}var C=b(M,2);{var N=re=>{var G=Uk(),K=_(G),ae=b(_(K),2),Z=_(ae),ne=b(K,2);Nt(ne,17,()=>n().results,Yt,(he,_e,se)=>{var Te=Vk();let be;var Me=_(Te),Ve=_(Me);Ve.textContent=`${se+1}.`;var Je=b(Ve,2),ut=_(Je),Fe=b(Je,2);{var Oe=nt=>{var ft=Lk(),mt=Xe(ft),vt=_(mt),kt=b(mt,2);{var bt=pt=>{const yt=Q(()=>tr[o(_e).classification.group]);var dt=sn(),Le=Xe(dt);{var Rt=Et=>{var Vt=Rk();let De;var Qt=_(Vt);ie(()=>{xt(Vt,"title",o(yt).description),De=Dt(Vt,"",De,{color:o(yt).color}),ee(Qt,o(yt).label)}),T(Et,Vt)};pe(Le,Et=>{o(yt)&&Et(Rt)})}T(pt,dt)};pe(kt,pt=>{o(_e).classification.group&&pt(bt)})}ie(()=>ee(vt,o(_e).classification.action)),T(nt,ft)},je=nt=>{var ft=zk();T(nt,ft)};pe(Fe,nt=>{o(_e).success?nt(Oe):nt(je,!1)})}var Ne=b(Me,2),Be=_(Ne),Ke=b(Be);{var $e=nt=>{var ft=jk(),mt=b(Xe(ft),1,!0);ie(vt=>ee(mt,vt),[()=>i(o(_e).email.date)]),T(nt,ft)};pe(Ke,nt=>{o(_e).email.date&&nt($e)})}var Ze=b(Ne,2);{var Ue=nt=>{var ft=Kk(),mt=Xe(ft);{var vt=dt=>{var Le=qk(),Rt=_(Le);ie(()=>ee(Rt,o(_e).classification.summary)),T(dt,Le)};pe(mt,dt=>{o(_e).classification.summary&&dt(vt)})}var kt=b(mt,2);{var bt=dt=>{var Le=Bk(),Rt=_(Le),Et=b(Rt,2),Vt=b(Et,2);ie((De,Qt)=>{ee(Rt,`${De??""} `),ee(Et,` ${(o(_e).stats.inputTokens||0)??""} in + ${(o(_e).stats.numTokens||0)??""} out `),ee(Vt,` ${Qt??""}`)},[()=>o(_e).stats.tps?`${o(_e).stats.tps.toFixed(0)} tok/s`:"â",()=>r(o(_e).stats.elapsed)]),T(dt,Le)};pe(kt,dt=>{o(_e).stats&&dt(bt)})}var pt=b(kt,2);{var yt=dt=>{var Le=Fk(),Rt=b(_(Le),2),Et=_(Rt);ie(()=>ee(Et,o(_e).rawResponse)),T(dt,Le)};pe(pt,dt=>{o(_e).rawResponse&&dt(yt)})}T(nt,ft)},tt=nt=>{var ft=Hk(),mt=_(ft);ie(()=>ee(mt,o(_e).error)),T(nt,ft)};pe(Ze,nt=>{o(_e).success?nt(Ue):nt(tt,!1)})}ie(nt=>{be=Tt(Te,1,"email-item svelte-t1ig66",null,be,{failed:!o(_e).success}),ee(ut,o(_e).email.subject||"(no subject)"),ee(Be,nt)},[()=>s(o(_e).email.from)]),T(he,Te)}),ie(()=>ee(Z,n().results.length)),T(re,G)};pe(C,re=>{var G;((G=n().results)==null?void 0:G.length)>0&&re(N)})}var I=b(C,2);{var $=re=>{var G=Xk(),K=_(G),ae=_(K),Z=_(ae),ne=b(ae,4),he=_(ne),_e=b(ne,2);{var se=je=>{var Ne=Gk(),Be=b(Xe(Ne)),Ke=_(Be);ie(()=>ee(Ke,`${n().errors??""} errors`)),T(je,Ne)};pe(_e,je=>{n().errors>0&&je(se)})}var Te=b(_e,2);{var be=je=>{var Ne=Wk(),Be=b(Xe(Ne)),Ke=_(Be);ie(()=>ee(Ke,`${n().summary.skipped??""} skipped`)),T(je,Ne)};pe(Te,je=>{var Ne;(Ne=n().summary)!=null&&Ne.skipped&&je(be)})}var Me=b(K,2),Ve=_(Me);{var Je=je=>{var Ne=Yk(),Be=Xe(Ne);ie(()=>ee(Be,`Avg ${n().summary.avgTps??""} tok/s`)),T(je,Ne)};pe(Ve,je=>{var Ne;(Ne=n().summary)!=null&&Ne.avgTps&&je(Je)})}var ut=b(Ve),Fe=b(ut,2),Oe=b(Fe,2);ie((je,Ne,Be)=>{var Ke,$e;ee(Z,`${(((Ke=n().summary)==null?void 0:Ke.processed)||n().total||0)??""} processed`),ee(he,`${(n().classified||0)??""} classified`),ee(ut,` ${je??""} in + ${Ne??""} out `),ee(Fe,` ${Be??""} `),ee(Oe,` Model: ${((($e=n().summary)==null?void 0:$e.modelName)||"Unknown")??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),T(re,G)};pe(I,re=>{o(d)&&n().totals&&re($)})}var Y=b(I,2),X=_(Y);{var V=re=>{var G=Zk(),K=Xe(G);K.__click=function(...Z){var ne;(ne=e.oninspect)==null||ne.apply(this,Z)};var ae=b(K,2);ae.__click=function(...Z){var ne;(ne=e.onclose)==null||ne.apply(this,Z)},T(re,G)},te=re=>{var G=Qk(),K=Xe(G);K.__click=function(...Z){var ne;(ne=e.oninspect)==null||ne.apply(this,Z)};var ae=b(K,2);ae.__click=function(...Z){var ne;(ne=e.onstop)==null||ne.apply(this,Z)},T(re,G)};pe(X,re=>{o(d)?re(V):re(te,!1)})}ie(()=>{ee(H,`${o(l)??""}%`),J=Tt(O,1,"bar-fill svelte-t1ig66",null,J,{done:o(d)}),le=Dt(O,"",le,{width:`${o(l)??""}%`})}),T(h,y)};pe(v,h=>{n()&&h(p)})}T(t,f),st()}Zt(["click"]);var e2=q('<span class="spinner svelte-ois7em"></span>'),t2=mn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),n2=q('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),r2=q("<option> </option>"),a2=q('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),s2=q('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function i2(t,e){at(e,!0);let n=Ee(e,"engineStatus",3,"idle"),r=Ee(e,"modelName",3,""),a=Ee(e,"isScanning",3,!1),s=Ee(e,"scanProgress",3,null),i=Ee(e,"scanCount",15,20),l=Ee(e,"stats",3,null);const d=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function f(){return n()==="ready"?`${r()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function v(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function p(){return n()==="ready"&&!a()}let h=Q(()=>{var G;return a()&&((G=s())==null?void 0:G.phase)!=="done"});var y=s2(),x=_(y),S=_(x),A=_(S);{var D=G=>{var K=e2();T(G,K)},L=G=>{var K=t2();T(G,K)};pe(A,G=>{o(h)?G(D):G(L,!1)})}var W=b(S,2),k=_(W),H=b(_(k),2);H.__click=function(...G){var K;(K=e.oninspect)==null||K.apply(this,G)};var B=b(k,2),O=_(B);let J;var le=b(O),ke=b(x,2);{var j=G=>{var K=n2(),ae=_(K),Z=_(ae),ne=b(ae,4),he=_(ne),_e=b(ne,4),se=_(_e);ie(()=>{ee(Z,`${l().totalEmails??""} emails in storage`),ee(he,`${l().classified??""} classified`),ee(se,`${l().unclassified??""} new`)}),T(G,K)};pe(ke,G=>{l()&&G(j)})}var M=b(ke,2),z=_(M),C=b(_(z),2);Nt(C,21,()=>d,Yt,(G,K)=>{var ae=r2(),Z=_(ae),ne={};ie(()=>{ee(Z,o(K).label),ne!==(ne=o(K).value)&&(ae.value=(ae.__value=o(K).value)??"")}),T(G,ae)});var N=b(z,2),I=_(N);I.__click=function(...G){var K;(K=e.onscan)==null||K.apply(this,G)};var $=_(I),Y=b(I,2);Y.__click=function(...G){var K;(K=e.onrescan)==null||K.apply(this,G)};var X=b(M,2);{var V=G=>{var K=a2();T(G,K)};pe(X,G=>{n()!=="ready"&&n()!=="loading"&&G(V)})}var te=b(X,2);{var re=G=>{$k(G,{get progress(){return s()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};pe(te,G=>{var K;(a()||((K=s())==null?void 0:K.phase)==="done")&&G(re)})}ie((G,K,ae,Z)=>{J=Dt(O,"",J,G),ee(le,` ${K??""}`),C.disabled=a(),I.disabled=ae,ee($,o(h)?"Scanning...":a()?"Finalizing...":"Scan New"),Y.disabled=Z},[()=>({background:v()}),f,()=>!p(),()=>!p()]),ho(C,i),T(t,y),st()}Zt(["click"]);var o2=q('<span class="row-date svelte-1czytqk"> </span>'),l2=q('<span class="tag svelte-1czytqk"> </span>'),c2=q('<span class="row-tags svelte-1czytqk"></span>'),u2=q('<span class="row-reason svelte-1czytqk"> </span>'),d2=q('<button class="icon-btn exec-btn svelte-1czytqk" title="Execute actions"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>'),f2=q('<!> <button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),v2=q('<span class="status-label svelte-1czytqk"> </span>'),h2=q('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),p2=q('<p class="summary-reason svelte-1czytqk"> </p>'),g2=q('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),m2=q('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function fv(t,e){at(e,!0);let n=Ee(e,"actionColor",3,"#666"),r=Ee(e,"dimmed",3,!1);function a(N){if(!N)return"";try{return new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let s=Q(()=>e.item.status==="pending"),i=Pe(!1);var l=m2(),d=Xe(l);let f;var v=_(d);v.__click=()=>P(i,!o(i));let p;var h=_(v),y=_(h),x=b(h,2),S=_(x),A=_(S),D=b(S,2);{var L=N=>{var I=o2(),$=_(I);ie(Y=>ee($,Y),[()=>a(e.item.date)]),T(N,I)};pe(D,N=>{e.item.date&&N(L)})}var W=b(x,2);{var k=N=>{var I=c2();Nt(I,21,()=>e.item.tags,Yt,($,Y)=>{var X=l2();let V;var te=_(X);ie(re=>{V=Dt(X,"",V,re),ee(te,o(Y))},[()=>({background:Eb(o(Y))})]),T($,X)}),T(N,I)};pe(W,N=>{e.item.tags&&e.item.tags.length>0&&N(k)})}var H=b(W,2);{var B=N=>{var I=u2(),$=_(I);ie(()=>ee($,e.item.reason)),T(N,I)};pe(H,N=>{e.item.reason&&!o(i)&&N(B)})}var O=b(v,2),J=_(O);{var le=N=>{var I=f2(),$=Xe(I);{var Y=te=>{var re=d2();re.__click=G=>{G.stopPropagation(),e.onexecute(e.item)},T(te,re)};pe($,te=>{e.onexecute&&te(Y)})}var X=b($,2);X.__click=te=>{te.stopPropagation(),e.onmarkacted(e.item.emailId)};var V=b(X,2);V.__click=te=>{te.stopPropagation(),e.ondismiss(e.item.emailId)},T(N,I)},ke=N=>{var I=v2(),$=_(I);ie(()=>ee($,e.item.status)),T(N,I)};pe(J,N=>{o(s)?N(le):N(ke,!1)})}var j=b(J,2);{var M=N=>{var I=h2();I.__click=$=>{$.stopPropagation(),e.onremove(e.item.emailId)},T(N,I)};pe(j,N=>{e.onremove&&N(M)})}var z=b(d,2);{var C=N=>{var I=g2();let $;var Y=_(I),X=_(Y),V=b(Y,2);{var te=re=>{var G=p2(),K=_(G);ie(()=>ee(K,e.item.reason)),T(re,G)};pe(V,re=>{e.item.reason&&re(te)})}ie(()=>{$=Dt(I,"",$,{"border-left-color":n()}),ee(X,e.item.summary)}),T(N,I)};pe(z,N=>{o(i)&&e.item.summary&&N(C)})}ie(()=>{f=Tt(d,1,"email-row svelte-1czytqk",null,f,{dimmed:r()}),p=Dt(v,"",p,{"border-left-color":n()}),ee(y,e.item.subject),ee(A,e.item.from)}),T(t,l),st()}Zt(["click"]);var y2=q('<span class="group-acted svelte-tl1unp"> </span>'),_2=q('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),b2=q('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),w2=q('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),x2=q('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),k2=q('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),S2=q('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function E2(t,e){at(e,!0);let n=Ee(e,"color",3,"#888");Ee(e,"count",3,0);let r=Ee(e,"items",19,()=>[]),a=Ee(e,"expanded",3,!1),s=Q(()=>r().filter(B=>B.status==="pending")),i=Q(()=>r().filter(B=>B.status!=="pending")),l=Pe(!1);function d(B){return B.split("_").map(O=>O.charAt(0)+O.slice(1).toLowerCase()).join(" ")}var f=S2(),v=_(f);v.__click=function(...B){var O;(O=e.ontoggle)==null||O.apply(this,B)};var p=_(v);let h;var y=_(p),x=b(p,2),S=_(x),A=b(x,2);{var D=B=>{var O=y2(),J=_(O);ie(()=>ee(J,`${o(i).length??""} handled`)),T(B,O)};pe(A,B=>{o(i).length>0&&B(D)})}var L=b(A,4);let W;var k=b(v,2);{var H=B=>{var O=k2(),J=_(O);{var le=$=>{var Y=_2();T($,Y)};pe(J,$=>{o(s).length===0&&o(i).length===0&&$(le)})}var ke=b(J,2);Nt(ke,17,()=>o(s),$=>$.emailId,($,Y)=>{fv($,{get item(){return o(Y)},get actionColor(){return n()},get onexecute(){return e.onexecute},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var j=b(ke,2);{var M=$=>{var Y=b2(),X=_(Y),V=_(X),te=b(X,2);Nt(te,17,()=>o(i),re=>re.emailId,(re,G)=>{fv(re,{get item(){return o(G)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),ie(()=>ee(V,`${o(i).length??""} handled`)),T($,Y)};pe(j,$=>{o(i).length>0&&$(M)})}var z=b(j,2),C=_(z);{var N=$=>{var Y=w2();Y.__click=()=>P(l,!0),T($,Y)},I=$=>{var Y=x2(),X=_(Y),V=b(X);V.__click=()=>P(l,!1);var te=b(V,2);te.__click=()=>{e.oncleargroup(),P(l,!1)},ie(()=>ee(X,`Clear ${r().length??""} items? `)),T($,Y)};pe(C,$=>{o(l)?$(I,!1):$(N)})}T(B,O)};pe(k,B=>{a()&&B(H)})}ie(B=>{h=Dt(p,"",h,{background:n()}),ee(y,B),ee(S,o(s).length),W=Tt(L,0,"chevron svelte-tl1unp",null,W,{open:a()})},[()=>d(e.action)]),T(t,f),st()}Zt(["click"]);var A2=q(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),T2=q(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),C2=q(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),I2=q('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function P2(t,e){at(e,!0);let n=Ee(e,"open",15,!1),r=Ee(e,"sampleEmail",3,null),a=Pe("system");function s(){return r()?Np(r()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function i(){n(!1)}function l(p){p.target===p.currentTarget&&i()}var d=sn(),f=Xe(d);{var v=p=>{var h=I2();h.__click=l,h.__keydown=M=>M.key==="Escape"&&i();var y=_(h),x=_(y),S=b(_(x),2);S.__click=i;var A=b(x,2),D=_(A);let L;D.__click=()=>P(a,"system");var W=b(D,2);let k;W.__click=()=>P(a,"email");var H=b(W,2);let B;H.__click=()=>P(a,"config");var O=b(A,2),J=_(O);{var le=M=>{var z=A2(),C=b(Xe(z),2),N=_(C);ie(()=>ee(N,Ip)),T(M,z)},ke=M=>{var z=T2(),C=b(Xe(z),2),N=b(_(C),2);N.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var I=b(C,2),$=b(_(I),2),Y=_($);ie(X=>ee(Y,X),[s]),T(M,z)},j=M=>{var z=C2(),C=b(Xe(z),2),N=_(C),I=b(_(N),2),$=_(I),Y=b(N,2),X=b(_(Y),2),V=_(X),te=b(Y,2),re=b(_(te),2),G=_(re),K=b(C,4);K.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,ie(()=>{ee($,wb.maxTokens),ee(V,"false"),ee(G,"false")}),T(M,z)};pe(J,M=>{o(a)==="system"?M(le):o(a)==="email"?M(ke,1):o(a)==="config"&&M(j,2)})}ie(()=>{L=Tt(D,1,"tab svelte-10pcy9j",null,L,{active:o(a)==="system"}),k=Tt(W,1,"tab svelte-10pcy9j",null,k,{active:o(a)==="email"}),B=Tt(H,1,"tab svelte-10pcy9j",null,B,{active:o(a)==="config"})}),T(p,h)};pe(f,p=>{n()&&p(v)})}T(t,d),st()}Zt(["click","keydown"]);var M2={value:()=>{}};function Ql(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new ll(n)}function ll(t){this._=t}function O2(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}ll.prototype=Ql.prototype={constructor:ll,on:function(t,e){var n=this._,r=O2(t+"",n),a,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((a=(t=r[s]).type)&&(a=N2(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<i;)if(a=(t=r[s]).type)n[a]=vv(n[a],t.name,e);else if(e==null)for(a in n)n[a]=vv(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ll(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,s;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,a=s.length;r<a;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,s=r.length;a<s;++a)r[a].value.apply(e,n)}};function N2(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function vv(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=M2,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Du="http://www.w3.org/1999/xhtml";const hv={svg:"http://www.w3.org/2000/svg",xhtml:Du,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Jl(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),hv.hasOwnProperty(e)?{space:hv[e],local:t}:t}function D2(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Du&&e.documentElement.namespaceURI===Du?e.createElement(t):e.createElementNS(n,t)}}function R2(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function og(t){var e=Jl(t);return(e.local?R2:D2)(e)}function L2(){}function Md(t){return t==null?L2:function(){return this.querySelector(t)}}function z2(t){typeof t!="function"&&(t=Md(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=new Array(i),d,f,v=0;v<i;++v)(d=s[v])&&(f=t.call(d,d.__data__,v,s))&&("__data__"in d&&(f.__data__=d.__data__),l[v]=f);return new lr(r,this._parents)}function j2(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function q2(){return[]}function lg(t){return t==null?q2:function(){return this.querySelectorAll(t)}}function B2(t){return function(){return j2(t.apply(this,arguments))}}function F2(t){typeof t=="function"?t=B2(t):t=lg(t);for(var e=this._groups,n=e.length,r=[],a=[],s=0;s<n;++s)for(var i=e[s],l=i.length,d,f=0;f<l;++f)(d=i[f])&&(r.push(t.call(d,d.__data__,f,i)),a.push(d));return new lr(r,a)}function cg(t){return function(){return this.matches(t)}}function ug(t){return function(e){return e.matches(t)}}var K2=Array.prototype.find;function H2(t){return function(){return K2.call(this.children,t)}}function V2(){return this.firstElementChild}function U2(t){return this.select(t==null?V2:H2(typeof t=="function"?t:ug(t)))}var G2=Array.prototype.filter;function W2(){return Array.from(this.children)}function Y2(t){return function(){return G2.call(this.children,t)}}function X2(t){return this.selectAll(t==null?W2:Y2(typeof t=="function"?t:ug(t)))}function Z2(t){typeof t!="function"&&(t=cg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],d,f=0;f<i;++f)(d=s[f])&&t.call(d,d.__data__,f,s)&&l.push(d);return new lr(r,this._parents)}function dg(t){return new Array(t.length)}function Q2(){return new lr(this._enter||this._groups.map(dg),this._parents)}function wl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}wl.prototype={constructor:wl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function J2(t){return function(){return t}}function $2(t,e,n,r,a,s){for(var i=0,l,d=e.length,f=s.length;i<f;++i)(l=e[i])?(l.__data__=s[i],r[i]=l):n[i]=new wl(t,s[i]);for(;i<d;++i)(l=e[i])&&(a[i]=l)}function eS(t,e,n,r,a,s,i){var l,d,f=new Map,v=e.length,p=s.length,h=new Array(v),y;for(l=0;l<v;++l)(d=e[l])&&(h[l]=y=i.call(d,d.__data__,l,e)+"",f.has(y)?a[l]=d:f.set(y,d));for(l=0;l<p;++l)y=i.call(t,s[l],l,s)+"",(d=f.get(y))?(r[l]=d,d.__data__=s[l],f.delete(y)):n[l]=new wl(t,s[l]);for(l=0;l<v;++l)(d=e[l])&&f.get(h[l])===d&&(a[l]=d)}function tS(t){return t.__data__}function nS(t,e){if(!arguments.length)return Array.from(this,tS);var n=e?eS:$2,r=this._parents,a=this._groups;typeof t!="function"&&(t=J2(t));for(var s=a.length,i=new Array(s),l=new Array(s),d=new Array(s),f=0;f<s;++f){var v=r[f],p=a[f],h=p.length,y=rS(t.call(v,v&&v.__data__,f,r)),x=y.length,S=l[f]=new Array(x),A=i[f]=new Array(x),D=d[f]=new Array(h);n(v,p,S,A,D,y,e);for(var L=0,W=0,k,H;L<x;++L)if(k=S[L]){for(L>=W&&(W=L+1);!(H=A[W])&&++W<x;);k._next=H||null}}return i=new lr(i,r),i._enter=l,i._exit=d,i}function rS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function aS(){return new lr(this._exit||this._groups.map(dg),this._parents)}function sS(t,e,n){var r=this.enter(),a=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?s.remove():n(s),r&&a?r.merge(a).order():a}function iS(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,s=r.length,i=Math.min(a,s),l=new Array(a),d=0;d<i;++d)for(var f=n[d],v=r[d],p=f.length,h=l[d]=new Array(p),y,x=0;x<p;++x)(y=f[x]||v[x])&&(h[x]=y);for(;d<a;++d)l[d]=n[d];return new lr(l,this._parents)}function oS(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,s=r[a],i;--a>=0;)(i=r[a])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function lS(t){t||(t=cS);function e(p,h){return p&&h?t(p.__data__,h.__data__):!p-!h}for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s){for(var i=n[s],l=i.length,d=a[s]=new Array(l),f,v=0;v<l;++v)(f=i[v])&&(d[v]=f);d.sort(e)}return new lr(a,this._parents).order()}function cS(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function uS(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function dS(){return Array.from(this)}function fS(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length;a<s;++a){var i=r[a];if(i)return i}return null}function vS(){let t=0;for(const e of this)++t;return t}function hS(){return!this.node()}function pS(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],s=0,i=a.length,l;s<i;++s)(l=a[s])&&t.call(l,l.__data__,s,a);return this}function gS(t){return function(){this.removeAttribute(t)}}function mS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function yS(t,e){return function(){this.setAttribute(t,e)}}function _S(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function bS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function wS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function xS(t,e){var n=Jl(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?mS:gS:typeof e=="function"?n.local?wS:bS:n.local?_S:yS)(n,e))}function fg(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function kS(t){return function(){this.style.removeProperty(t)}}function SS(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ES(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function AS(t,e,n){return arguments.length>1?this.each((e==null?kS:typeof e=="function"?ES:SS)(t,e,n??"")):$s(this.node(),t)}function $s(t,e){return t.style.getPropertyValue(e)||fg(t).getComputedStyle(t,null).getPropertyValue(e)}function TS(t){return function(){delete this[t]}}function CS(t,e){return function(){this[t]=e}}function IS(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function PS(t,e){return arguments.length>1?this.each((e==null?TS:typeof e=="function"?IS:CS)(t,e)):this.node()[t]}function vg(t){return t.trim().split(/^|\s+/)}function Od(t){return t.classList||new hg(t)}function hg(t){this._node=t,this._names=vg(t.getAttribute("class")||"")}hg.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function pg(t,e){for(var n=Od(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function gg(t,e){for(var n=Od(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function MS(t){return function(){pg(this,t)}}function OS(t){return function(){gg(this,t)}}function NS(t,e){return function(){(e.apply(this,arguments)?pg:gg)(this,t)}}function DS(t,e){var n=vg(t+"");if(arguments.length<2){for(var r=Od(this.node()),a=-1,s=n.length;++a<s;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?NS:e?MS:OS)(n,e))}function RS(){this.textContent=""}function LS(t){return function(){this.textContent=t}}function zS(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function jS(t){return arguments.length?this.each(t==null?RS:(typeof t=="function"?zS:LS)(t)):this.node().textContent}function qS(){this.innerHTML=""}function BS(t){return function(){this.innerHTML=t}}function FS(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function KS(t){return arguments.length?this.each(t==null?qS:(typeof t=="function"?FS:BS)(t)):this.node().innerHTML}function HS(){this.nextSibling&&this.parentNode.appendChild(this)}function VS(){return this.each(HS)}function US(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function GS(){return this.each(US)}function WS(t){var e=typeof t=="function"?t:og(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function YS(){return null}function XS(t,e){var n=typeof t=="function"?t:og(t),r=e==null?YS:typeof e=="function"?e:Md(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ZS(){var t=this.parentNode;t&&t.removeChild(this)}function QS(){return this.each(ZS)}function JS(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function $S(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function eE(t){return this.select(t?$S:JS)}function tE(t){return arguments.length?this.property("__data__",t):this.node().__data__}function nE(t){return function(e){t.call(this,e,this.__data__)}}function rE(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function aE(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,s;n<a;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function sE(t,e,n){return function(){var r=this.__on,a,s=nE(e);if(r){for(var i=0,l=r.length;i<l;++i)if((a=r[i]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=s,a.options=n),a.value=e;return}}this.addEventListener(t.type,s,n),a={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(a):this.__on=[a]}}function iE(t,e,n){var r=rE(t+""),a,s=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var d=0,f=l.length,v;d<f;++d)for(a=0,v=l[d];a<s;++a)if((i=r[a]).type===v.type&&i.name===v.name)return v.value}return}for(l=e?sE:aE,a=0;a<s;++a)this.each(l(r[a],e,n));return this}function mg(t,e,n){var r=fg(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function oE(t,e){return function(){return mg(this,t,e)}}function lE(t,e){return function(){return mg(this,t,e.apply(this,arguments))}}function cE(t,e){return this.each((typeof e=="function"?lE:oE)(t,e))}function*uE(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length,i;a<s;++a)(i=r[a])&&(yield i)}var yg=[null];function lr(t,e){this._groups=t,this._parents=e}function mo(){return new lr([[document.documentElement]],yg)}function dE(){return this}lr.prototype=mo.prototype={constructor:lr,select:z2,selectAll:F2,selectChild:U2,selectChildren:X2,filter:Z2,data:nS,enter:Q2,exit:aS,join:sS,merge:iS,selection:dE,order:oS,sort:lS,call:uS,nodes:dS,node:fS,size:vS,empty:hS,each:pS,attr:xS,style:AS,property:PS,classed:DS,text:jS,html:KS,raise:VS,lower:GS,append:WS,insert:XS,remove:QS,clone:eE,datum:tE,on:iE,dispatch:cE,[Symbol.iterator]:uE};function Cr(t){return typeof t=="string"?new lr([[document.querySelector(t)]],[document.documentElement]):new lr([[t]],yg)}function fE(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Fr(t,e){if(t=fE(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const vE={passive:!1},Gi={capture:!0,passive:!1};function Wc(t){t.stopImmediatePropagation()}function Ls(t){t.preventDefault(),t.stopImmediatePropagation()}function _g(t){var e=t.document.documentElement,n=Cr(t).on("dragstart.drag",Ls,Gi);"onselectstart"in e?n.on("selectstart.drag",Ls,Gi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function bg(t,e){var n=t.document.documentElement,r=Cr(t).on("dragstart.drag",null);e&&(r.on("click.drag",Ls,Gi),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Go=t=>()=>t;function Ru(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:s,x:i,y:l,dx:d,dy:f,dispatch:v}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:v}})}Ru.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function hE(t){return!t.ctrlKey&&!t.button}function pE(){return this.parentNode}function gE(t,e){return e??{x:t.x,y:t.y}}function mE(){return navigator.maxTouchPoints||"ontouchstart"in this}function yE(){var t=hE,e=pE,n=gE,r=mE,a={},s=Ql("start","drag","end"),i=0,l,d,f,v,p=0;function h(k){k.on("mousedown.drag",y).filter(r).on("touchstart.drag",A).on("touchmove.drag",D,vE).on("touchend.drag touchcancel.drag",L).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(k,H){if(!(v||!t.call(this,k,H))){var B=W(this,e.call(this,k,H),k,H,"mouse");B&&(Cr(k.view).on("mousemove.drag",x,Gi).on("mouseup.drag",S,Gi),_g(k.view),Wc(k),f=!1,l=k.clientX,d=k.clientY,B("start",k))}}function x(k){if(Ls(k),!f){var H=k.clientX-l,B=k.clientY-d;f=H*H+B*B>p}a.mouse("drag",k)}function S(k){Cr(k.view).on("mousemove.drag mouseup.drag",null),bg(k.view,f),Ls(k),a.mouse("end",k)}function A(k,H){if(t.call(this,k,H)){var B=k.changedTouches,O=e.call(this,k,H),J=B.length,le,ke;for(le=0;le<J;++le)(ke=W(this,O,k,H,B[le].identifier,B[le]))&&(Wc(k),ke("start",k,B[le]))}}function D(k){var H=k.changedTouches,B=H.length,O,J;for(O=0;O<B;++O)(J=a[H[O].identifier])&&(Ls(k),J("drag",k,H[O]))}function L(k){var H=k.changedTouches,B=H.length,O,J;for(v&&clearTimeout(v),v=setTimeout(function(){v=null},500),O=0;O<B;++O)(J=a[H[O].identifier])&&(Wc(k),J("end",k,H[O]))}function W(k,H,B,O,J,le){var ke=s.copy(),j=Fr(le||B,H),M,z,C;if((C=n.call(k,new Ru("beforestart",{sourceEvent:B,target:h,identifier:J,active:i,x:j[0],y:j[1],dx:0,dy:0,dispatch:ke}),O))!=null)return M=C.x-j[0]||0,z=C.y-j[1]||0,function N(I,$,Y){var X=j,V;switch(I){case"start":a[J]=N,V=i++;break;case"end":delete a[J],--i;case"drag":j=Fr(Y||$,H),V=i;break}ke.call(I,k,new Ru(I,{sourceEvent:$,subject:C,target:h,identifier:J,active:V,x:j[0]+M,y:j[1]+z,dx:j[0]-X[0],dy:j[1]-X[1],dispatch:ke}),O)}}return h.filter=function(k){return arguments.length?(t=typeof k=="function"?k:Go(!!k),h):t},h.container=function(k){return arguments.length?(e=typeof k=="function"?k:Go(k),h):e},h.subject=function(k){return arguments.length?(n=typeof k=="function"?k:Go(k),h):n},h.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:Go(!!k),h):r},h.on=function(){var k=s.on.apply(s,arguments);return k===s?h:k},h.clickDistance=function(k){return arguments.length?(p=(k=+k)*k,h):Math.sqrt(p)},h}function Nd(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function wg(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function yo(){}var Wi=.7,xl=1/Wi,zs="\\s*([+-]?\\d+)\\s*",Yi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_E=/^#([0-9a-f]{3,8})$/,bE=new RegExp(`^rgb\\(${zs},${zs},${zs}\\)$`),wE=new RegExp(`^rgb\\(${Qr},${Qr},${Qr}\\)$`),xE=new RegExp(`^rgba\\(${zs},${zs},${zs},${Yi}\\)$`),kE=new RegExp(`^rgba\\(${Qr},${Qr},${Qr},${Yi}\\)$`),SE=new RegExp(`^hsl\\(${Yi},${Qr},${Qr}\\)$`),EE=new RegExp(`^hsla\\(${Yi},${Qr},${Qr},${Yi}\\)$`),pv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Nd(yo,ps,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:gv,formatHex:gv,formatHex8:AE,formatHsl:TE,formatRgb:mv,toString:mv});function gv(){return this.rgb().formatHex()}function AE(){return this.rgb().formatHex8()}function TE(){return xg(this).formatHsl()}function mv(){return this.rgb().formatRgb()}function ps(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=_E.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?yv(e):n===3?new $n(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Wo(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Wo(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=bE.exec(t))?new $n(e[1],e[2],e[3],1):(e=wE.exec(t))?new $n(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=xE.exec(t))?Wo(e[1],e[2],e[3],e[4]):(e=kE.exec(t))?Wo(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=SE.exec(t))?wv(e[1],e[2]/100,e[3]/100,1):(e=EE.exec(t))?wv(e[1],e[2]/100,e[3]/100,e[4]):pv.hasOwnProperty(t)?yv(pv[t]):t==="transparent"?new $n(NaN,NaN,NaN,0):null}function yv(t){return new $n(t>>16&255,t>>8&255,t&255,1)}function Wo(t,e,n,r){return r<=0&&(t=e=n=NaN),new $n(t,e,n,r)}function CE(t){return t instanceof yo||(t=ps(t)),t?(t=t.rgb(),new $n(t.r,t.g,t.b,t.opacity)):new $n}function Lu(t,e,n,r){return arguments.length===1?CE(t):new $n(t,e,n,r??1)}function $n(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Nd($n,Lu,wg(yo,{brighter(t){return t=t==null?xl:Math.pow(xl,t),new $n(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Wi:Math.pow(Wi,t),new $n(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new $n(cs(this.r),cs(this.g),cs(this.b),kl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_v,formatHex:_v,formatHex8:IE,formatRgb:bv,toString:bv}));function _v(){return`#${es(this.r)}${es(this.g)}${es(this.b)}`}function IE(){return`#${es(this.r)}${es(this.g)}${es(this.b)}${es((isNaN(this.opacity)?1:this.opacity)*255)}`}function bv(){const t=kl(this.opacity);return`${t===1?"rgb(":"rgba("}${cs(this.r)}, ${cs(this.g)}, ${cs(this.b)}${t===1?")":`, ${t})`}`}function kl(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cs(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function es(t){return t=cs(t),(t<16?"0":"")+t.toString(16)}function wv(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ir(t,e,n,r)}function xg(t){if(t instanceof Ir)return new Ir(t.h,t.s,t.l,t.opacity);if(t instanceof yo||(t=ps(t)),!t)return new Ir;if(t instanceof Ir)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,l=s-a,d=(s+a)/2;return l?(e===s?i=(n-r)/l+(n<r)*6:n===s?i=(r-e)/l+2:i=(e-n)/l+4,l/=d<.5?s+a:2-s-a,i*=60):l=d>0&&d<1?0:i,new Ir(i,l,d,t.opacity)}function PE(t,e,n,r){return arguments.length===1?xg(t):new Ir(t,e,n,r??1)}function Ir(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Nd(Ir,PE,wg(yo,{brighter(t){return t=t==null?xl:Math.pow(xl,t),new Ir(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Wi:Math.pow(Wi,t),new Ir(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new $n(Yc(t>=240?t-240:t+120,a,r),Yc(t,a,r),Yc(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new Ir(xv(this.h),Yo(this.s),Yo(this.l),kl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=kl(this.opacity);return`${t===1?"hsl(":"hsla("}${xv(this.h)}, ${Yo(this.s)*100}%, ${Yo(this.l)*100}%${t===1?")":`, ${t})`}`}}));function xv(t){return t=(t||0)%360,t<0?t+360:t}function Yo(t){return Math.max(0,Math.min(1,t||0))}function Yc(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Dd=t=>()=>t;function ME(t,e){return function(n){return t+n*e}}function OE(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function NE(t){return(t=+t)==1?kg:function(e,n){return n-e?OE(e,n,t):Dd(isNaN(e)?n:e)}}function kg(t,e){var n=e-t;return n?ME(t,n):Dd(isNaN(t)?e:t)}const Sl=(function t(e){var n=NE(e);function r(a,s){var i=n((a=Lu(a)).r,(s=Lu(s)).r),l=n(a.g,s.g),d=n(a.b,s.b),f=kg(a.opacity,s.opacity);return function(v){return a.r=i(v),a.g=l(v),a.b=d(v),a.opacity=f(v),a+""}}return r.gamma=t,r})(1);function DE(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function RE(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function LE(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=qi(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(l){for(i=0;i<r;++i)s[i]=a[i](l);return s}}function zE(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Gr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function jE(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=qi(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var zu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Xc=new RegExp(zu.source,"g");function qE(t){return function(){return t}}function BE(t){return function(e){return t(e)+""}}function Sg(t,e){var n=zu.lastIndex=Xc.lastIndex=0,r,a,s,i=-1,l=[],d=[];for(t=t+"",e=e+"";(r=zu.exec(t))&&(a=Xc.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),l[i]?l[i]+=s:l[++i]=s),(r=r[0])===(a=a[0])?l[i]?l[i]+=a:l[++i]=a:(l[++i]=null,d.push({i,x:Gr(r,a)})),n=Xc.lastIndex;return n<e.length&&(s=e.slice(n),l[i]?l[i]+=s:l[++i]=s),l.length<2?d[0]?BE(d[0].x):qE(e):(e=d.length,function(f){for(var v=0,p;v<e;++v)l[(p=d[v]).i]=p.x(f);return l.join("")})}function qi(t,e){var n=typeof e,r;return e==null||n==="boolean"?Dd(e):(n==="number"?Gr:n==="string"?(r=ps(e))?(e=r,Sl):Sg:e instanceof ps?Sl:e instanceof Date?zE:RE(e)?DE:Array.isArray(e)?LE:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?jE:Gr)(t,e)}var kv=180/Math.PI,ju={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Eg(t,e,n,r,a,s){var i,l,d;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(d=t*n+e*r)&&(n-=t*d,r-=e*d),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,d/=l),t*r<e*n&&(t=-t,e=-e,d=-d,i=-i),{translateX:a,translateY:s,rotate:Math.atan2(e,t)*kv,skewX:Math.atan(d)*kv,scaleX:i,scaleY:l}}var Xo;function FE(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ju:Eg(e.a,e.b,e.c,e.d,e.e,e.f)}function KE(t){return t==null||(Xo||(Xo=document.createElementNS("http://www.w3.org/2000/svg","g")),Xo.setAttribute("transform",t),!(t=Xo.transform.baseVal.consolidate()))?ju:(t=t.matrix,Eg(t.a,t.b,t.c,t.d,t.e,t.f))}function Ag(t,e,n,r){function a(f){return f.length?f.pop()+" ":""}function s(f,v,p,h,y,x){if(f!==p||v!==h){var S=y.push("translate(",null,e,null,n);x.push({i:S-4,x:Gr(f,p)},{i:S-2,x:Gr(v,h)})}else(p||h)&&y.push("translate("+p+e+h+n)}function i(f,v,p,h){f!==v?(f-v>180?v+=360:v-f>180&&(f+=360),h.push({i:p.push(a(p)+"rotate(",null,r)-2,x:Gr(f,v)})):v&&p.push(a(p)+"rotate("+v+r)}function l(f,v,p,h){f!==v?h.push({i:p.push(a(p)+"skewX(",null,r)-2,x:Gr(f,v)}):v&&p.push(a(p)+"skewX("+v+r)}function d(f,v,p,h,y,x){if(f!==p||v!==h){var S=y.push(a(y)+"scale(",null,",",null,")");x.push({i:S-4,x:Gr(f,p)},{i:S-2,x:Gr(v,h)})}else(p!==1||h!==1)&&y.push(a(y)+"scale("+p+","+h+")")}return function(f,v){var p=[],h=[];return f=t(f),v=t(v),s(f.translateX,f.translateY,v.translateX,v.translateY,p,h),i(f.rotate,v.rotate,p,h),l(f.skewX,v.skewX,p,h),d(f.scaleX,f.scaleY,v.scaleX,v.scaleY,p,h),f=v=null,function(y){for(var x=-1,S=h.length,A;++x<S;)p[(A=h[x]).i]=A.x(y);return p.join("")}}}var HE=Ag(FE,"px, ","px)","deg)"),VE=Ag(KE,", ",")",")"),UE=1e-12;function Sv(t){return((t=Math.exp(t))+1/t)/2}function GE(t){return((t=Math.exp(t))-1/t)/2}function WE(t){return((t=Math.exp(2*t))-1)/(t+1)}const cl=(function t(e,n,r){function a(s,i){var l=s[0],d=s[1],f=s[2],v=i[0],p=i[1],h=i[2],y=v-l,x=p-d,S=y*y+x*x,A,D;if(S<UE)D=Math.log(h/f)/e,A=function(O){return[l+O*y,d+O*x,f*Math.exp(e*O*D)]};else{var L=Math.sqrt(S),W=(h*h-f*f+r*S)/(2*f*n*L),k=(h*h-f*f-r*S)/(2*h*n*L),H=Math.log(Math.sqrt(W*W+1)-W),B=Math.log(Math.sqrt(k*k+1)-k);D=(B-H)/e,A=function(O){var J=O*D,le=Sv(H),ke=f/(n*L)*(le*WE(e*J+H)-GE(H));return[l+ke*y,d+ke*x,f*le/Sv(e*J+H)]}}return A.duration=D*1e3*e/Math.SQRT2,A}return a.rho=function(s){var i=Math.max(.001,+s),l=i*i,d=l*l;return t(i,l,d)},a})(Math.SQRT2,2,4);var ei=0,Oi=0,Ci=0,Tg=1e3,El,Ni,Al=0,gs=0,$l=0,Xi=typeof performance=="object"&&performance.now?performance:Date,Cg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Rd(){return gs||(Cg(YE),gs=Xi.now()+$l)}function YE(){gs=0}function Tl(){this._call=this._time=this._next=null}Tl.prototype=Ig.prototype={constructor:Tl,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Rd():+n)+(e==null?0:+e),!this._next&&Ni!==this&&(Ni?Ni._next=this:El=this,Ni=this),this._call=t,this._time=n,qu()},stop:function(){this._call&&(this._call=null,this._time=1/0,qu())}};function Ig(t,e,n){var r=new Tl;return r.restart(t,e,n),r}function XE(){Rd(),++ei;for(var t=El,e;t;)(e=gs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ei}function Ev(){gs=(Al=Xi.now())+$l,ei=Oi=0;try{XE()}finally{ei=0,QE(),gs=0}}function ZE(){var t=Xi.now(),e=t-Al;e>Tg&&($l-=e,Al=t)}function QE(){for(var t,e=El,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:El=n);Ni=t,qu(r)}function qu(t){if(!ei){Oi&&(Oi=clearTimeout(Oi));var e=t-gs;e>24?(t<1/0&&(Oi=setTimeout(Ev,t-Xi.now()-$l)),Ci&&(Ci=clearInterval(Ci))):(Ci||(Al=Xi.now(),Ci=setInterval(ZE,Tg)),ei=1,Cg(Ev))}}function Av(t,e,n){var r=new Tl;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var JE=Ql("start","end","cancel","interrupt"),$E=[],Pg=0,Tv=1,Bu=2,ul=3,Cv=4,Fu=5,dl=6;function ec(t,e,n,r,a,s){var i=t.__transition;if(!i)t.__transition={};else if(n in i)return;eA(t,n,{name:e,index:r,group:a,on:JE,tween:$E,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Pg})}function Ld(t,e){var n=Lr(t,e);if(n.state>Pg)throw new Error("too late; already scheduled");return n}function ta(t,e){var n=Lr(t,e);if(n.state>ul)throw new Error("too late; already running");return n}function Lr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function eA(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Ig(s,0,n.time);function s(f){n.state=Tv,n.timer.restart(i,n.delay,n.time),n.delay<=f&&i(f-n.delay)}function i(f){var v,p,h,y;if(n.state!==Tv)return d();for(v in r)if(y=r[v],y.name===n.name){if(y.state===ul)return Av(i);y.state===Cv?(y.state=dl,y.timer.stop(),y.on.call("interrupt",t,t.__data__,y.index,y.group),delete r[v]):+v<e&&(y.state=dl,y.timer.stop(),y.on.call("cancel",t,t.__data__,y.index,y.group),delete r[v])}if(Av(function(){n.state===ul&&(n.state=Cv,n.timer.restart(l,n.delay,n.time),l(f))}),n.state=Bu,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Bu){for(n.state=ul,a=new Array(h=n.tween.length),v=0,p=-1;v<h;++v)(y=n.tween[v].value.call(t,t.__data__,n.index,n.group))&&(a[++p]=y);a.length=p+1}}function l(f){for(var v=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(d),n.state=Fu,1),p=-1,h=a.length;++p<h;)a[p].call(t,v);n.state===Fu&&(n.on.call("end",t,t.__data__,n.index,n.group),d())}function d(){n.state=dl,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function fl(t,e){var n=t.__transition,r,a,s=!0,i;if(n){e=e==null?null:e+"";for(i in n){if((r=n[i]).name!==e){s=!1;continue}a=r.state>Bu&&r.state<Fu,r.state=dl,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[i]}s&&delete t.__transition}}function tA(t){return this.each(function(){fl(this,t)})}function nA(t,e){var n,r;return function(){var a=ta(this,t),s=a.tween;if(s!==n){r=n=s;for(var i=0,l=r.length;i<l;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}a.tween=r}}function rA(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var s=ta(this,t),i=s.tween;if(i!==r){a=(r=i).slice();for(var l={name:e,value:n},d=0,f=a.length;d<f;++d)if(a[d].name===e){a[d]=l;break}d===f&&a.push(l)}s.tween=a}}function aA(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Lr(this.node(),n).tween,a=0,s=r.length,i;a<s;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((e==null?nA:rA)(n,t,e))}function zd(t,e,n){var r=t._id;return t.each(function(){var a=ta(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return Lr(a,r).value[e]}}function Mg(t,e){var n;return(typeof e=="number"?Gr:e instanceof ps?Sl:(n=ps(e))?(e=n,Sl):Sg)(t,e)}function sA(t){return function(){this.removeAttribute(t)}}function iA(t){return function(){this.removeAttributeNS(t.space,t.local)}}function oA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttribute(t);return i===a?null:i===r?s:s=e(r=i,n)}}function lA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttributeNS(t.space,t.local);return i===a?null:i===r?s:s=e(r=i,n)}}function cA(t,e,n){var r,a,s;return function(){var i,l=n(this),d;return l==null?void this.removeAttribute(t):(i=this.getAttribute(t),d=l+"",i===d?null:i===r&&d===a?s:(a=d,s=e(r=i,l)))}}function uA(t,e,n){var r,a,s;return function(){var i,l=n(this),d;return l==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),d=l+"",i===d?null:i===r&&d===a?s:(a=d,s=e(r=i,l)))}}function dA(t,e){var n=Jl(t),r=n==="transform"?VE:Mg;return this.attrTween(t,typeof e=="function"?(n.local?uA:cA)(n,r,zd(this,"attr."+t,e)):e==null?(n.local?iA:sA)(n):(n.local?lA:oA)(n,r,e))}function fA(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function vA(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function hA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&vA(t,s)),n}return a._value=e,a}function pA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&fA(t,s)),n}return a._value=e,a}function gA(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Jl(t);return this.tween(n,(r.local?hA:pA)(r,e))}function mA(t,e){return function(){Ld(this,t).delay=+e.apply(this,arguments)}}function yA(t,e){return e=+e,function(){Ld(this,t).delay=e}}function _A(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?mA:yA)(e,t)):Lr(this.node(),e).delay}function bA(t,e){return function(){ta(this,t).duration=+e.apply(this,arguments)}}function wA(t,e){return e=+e,function(){ta(this,t).duration=e}}function xA(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?bA:wA)(e,t)):Lr(this.node(),e).duration}function kA(t,e){if(typeof e!="function")throw new Error;return function(){ta(this,t).ease=e}}function SA(t){var e=this._id;return arguments.length?this.each(kA(e,t)):Lr(this.node(),e).ease}function EA(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ta(this,t).ease=n}}function AA(t){if(typeof t!="function")throw new Error;return this.each(EA(this._id,t))}function TA(t){typeof t!="function"&&(t=cg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],d,f=0;f<i;++f)(d=s[f])&&t.call(d,d.__data__,f,s)&&l.push(d);return new ya(r,this._parents,this._name,this._id)}function CA(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,s=Math.min(r,a),i=new Array(r),l=0;l<s;++l)for(var d=e[l],f=n[l],v=d.length,p=i[l]=new Array(v),h,y=0;y<v;++y)(h=d[y]||f[y])&&(p[y]=h);for(;l<r;++l)i[l]=e[l];return new ya(i,this._parents,this._name,this._id)}function IA(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function PA(t,e,n){var r,a,s=IA(e)?Ld:ta;return function(){var i=s(this,t),l=i.on;l!==r&&(a=(r=l).copy()).on(e,n),i.on=a}}function MA(t,e){var n=this._id;return arguments.length<2?Lr(this.node(),n).on.on(t):this.each(PA(n,t,e))}function OA(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function NA(){return this.on("end.remove",OA(this._id))}function DA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Md(t));for(var r=this._groups,a=r.length,s=new Array(a),i=0;i<a;++i)for(var l=r[i],d=l.length,f=s[i]=new Array(d),v,p,h=0;h<d;++h)(v=l[h])&&(p=t.call(v,v.__data__,h,l))&&("__data__"in v&&(p.__data__=v.__data__),f[h]=p,ec(f[h],e,n,h,f,Lr(v,n)));return new ya(s,this._parents,e,n)}function RA(t){var e=this._name,n=this._id;typeof t!="function"&&(t=lg(t));for(var r=this._groups,a=r.length,s=[],i=[],l=0;l<a;++l)for(var d=r[l],f=d.length,v,p=0;p<f;++p)if(v=d[p]){for(var h=t.call(v,v.__data__,p,d),y,x=Lr(v,n),S=0,A=h.length;S<A;++S)(y=h[S])&&ec(y,e,n,S,h,x);s.push(h),i.push(v)}return new ya(s,i,e,n)}var LA=mo.prototype.constructor;function zA(){return new LA(this._groups,this._parents)}function jA(t,e){var n,r,a;return function(){var s=$s(this,t),i=(this.style.removeProperty(t),$s(this,t));return s===i?null:s===n&&i===r?a:a=e(n=s,r=i)}}function Og(t){return function(){this.style.removeProperty(t)}}function qA(t,e,n){var r,a=n+"",s;return function(){var i=$s(this,t);return i===a?null:i===r?s:s=e(r=i,n)}}function BA(t,e,n){var r,a,s;return function(){var i=$s(this,t),l=n(this),d=l+"";return l==null&&(d=l=(this.style.removeProperty(t),$s(this,t))),i===d?null:i===r&&d===a?s:(a=d,s=e(r=i,l))}}function FA(t,e){var n,r,a,s="style."+e,i="end."+s,l;return function(){var d=ta(this,t),f=d.on,v=d.value[s]==null?l||(l=Og(e)):void 0;(f!==n||a!==v)&&(r=(n=f).copy()).on(i,a=v),d.on=r}}function KA(t,e,n){var r=(t+="")=="transform"?HE:Mg;return e==null?this.styleTween(t,jA(t,r)).on("end.style."+t,Og(t)):typeof e=="function"?this.styleTween(t,BA(t,r,zd(this,"style."+t,e))).each(FA(this._id,t)):this.styleTween(t,qA(t,r,e),n).on("end.style."+t,null)}function HA(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function VA(t,e,n){var r,a;function s(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&HA(t,i,n)),r}return s._value=e,s}function UA(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,VA(t,e,n??""))}function GA(t){return function(){this.textContent=t}}function WA(t){return function(){var e=t(this);this.textContent=e??""}}function YA(t){return this.tween("text",typeof t=="function"?WA(zd(this,"text",t)):GA(t==null?"":t+""))}function XA(t){return function(e){this.textContent=t.call(this,e)}}function ZA(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&XA(a)),e}return r._value=t,r}function QA(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,ZA(t))}function JA(){for(var t=this._name,e=this._id,n=Ng(),r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,d,f=0;f<l;++f)if(d=i[f]){var v=Lr(d,e);ec(d,t,n,f,i,{time:v.time+v.delay+v.duration,delay:0,duration:v.duration,ease:v.ease})}return new ya(r,this._parents,t,n)}function $A(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(s,i){var l={value:i},d={value:function(){--a===0&&s()}};n.each(function(){var f=ta(this,r),v=f.on;v!==t&&(e=(t=v).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(d)),f.on=e}),a===0&&s()})}var eT=0;function ya(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Ng(){return++eT}var aa=mo.prototype;ya.prototype={constructor:ya,select:DA,selectAll:RA,selectChild:aa.selectChild,selectChildren:aa.selectChildren,filter:TA,merge:CA,selection:zA,transition:JA,call:aa.call,nodes:aa.nodes,node:aa.node,size:aa.size,empty:aa.empty,each:aa.each,on:MA,attr:dA,attrTween:gA,style:KA,styleTween:UA,text:YA,textTween:QA,remove:NA,tween:aA,delay:_A,duration:xA,ease:SA,easeVarying:AA,end:$A,[Symbol.iterator]:aa[Symbol.iterator]};function tT(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var nT={time:null,delay:0,duration:250,ease:tT};function rT(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function aT(t){var e,n;t instanceof ya?(e=t._id,t=t._name):(e=Ng(),(n=nT).time=Rd(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,d,f=0;f<l;++f)(d=i[f])&&ec(d,t,e,f,i,n||rT(d,e));return new ya(r,this._parents,t,e)}mo.prototype.interrupt=tA;mo.prototype.transition=aT;const Zo=t=>()=>t;function sT(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function va(t,e,n){this.k=t,this.x=e,this.y=n}va.prototype={constructor:va,scale:function(t){return t===1?this:new va(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new va(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var tc=new va(1,0,0);Dg.prototype=va.prototype;function Dg(t){for(;!t.__zoom;)if(!(t=t.parentNode))return tc;return t.__zoom}function Zc(t){t.stopImmediatePropagation()}function Ii(t){t.preventDefault(),t.stopImmediatePropagation()}function iT(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function oT(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Iv(){return this.__zoom||tc}function lT(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function cT(){return navigator.maxTouchPoints||"ontouchstart"in this}function uT(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],i=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function dT(){var t=iT,e=oT,n=uT,r=lT,a=cT,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,d=cl,f=Ql("start","zoom","end"),v,p,h,y=500,x=150,S=0,A=10;function D(C){C.property("__zoom",Iv).on("wheel.zoom",J,{passive:!1}).on("mousedown.zoom",le).on("dblclick.zoom",ke).filter(a).on("touchstart.zoom",j).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}D.transform=function(C,N,I,$){var Y=C.selection?C.selection():C;Y.property("__zoom",Iv),C!==Y?H(C,N,I,$):Y.interrupt().each(function(){B(this,arguments).event($).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},D.scaleBy=function(C,N,I,$){D.scaleTo(C,function(){var Y=this.__zoom.k,X=typeof N=="function"?N.apply(this,arguments):N;return Y*X},I,$)},D.scaleTo=function(C,N,I,$){D.transform(C,function(){var Y=e.apply(this,arguments),X=this.__zoom,V=I==null?k(Y):typeof I=="function"?I.apply(this,arguments):I,te=X.invert(V),re=typeof N=="function"?N.apply(this,arguments):N;return n(W(L(X,re),V,te),Y,i)},I,$)},D.translateBy=function(C,N,I,$){D.transform(C,function(){return n(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof I=="function"?I.apply(this,arguments):I),e.apply(this,arguments),i)},null,$)},D.translateTo=function(C,N,I,$,Y){D.transform(C,function(){var X=e.apply(this,arguments),V=this.__zoom,te=$==null?k(X):typeof $=="function"?$.apply(this,arguments):$;return n(tc.translate(te[0],te[1]).scale(V.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof I=="function"?-I.apply(this,arguments):-I),X,i)},$,Y)};function L(C,N){return N=Math.max(s[0],Math.min(s[1],N)),N===C.k?C:new va(N,C.x,C.y)}function W(C,N,I){var $=N[0]-I[0]*C.k,Y=N[1]-I[1]*C.k;return $===C.x&&Y===C.y?C:new va(C.k,$,Y)}function k(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function H(C,N,I,$){C.on("start.zoom",function(){B(this,arguments).event($).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event($).end()}).tween("zoom",function(){var Y=this,X=arguments,V=B(Y,X).event($),te=e.apply(Y,X),re=I==null?k(te):typeof I=="function"?I.apply(Y,X):I,G=Math.max(te[1][0]-te[0][0],te[1][1]-te[0][1]),K=Y.__zoom,ae=typeof N=="function"?N.apply(Y,X):N,Z=d(K.invert(re).concat(G/K.k),ae.invert(re).concat(G/ae.k));return function(ne){if(ne===1)ne=ae;else{var he=Z(ne),_e=G/he[2];ne=new va(_e,re[0]-he[0]*_e,re[1]-he[1]*_e)}V.zoom(null,ne)}})}function B(C,N,I){return!I&&C.__zooming||new O(C,N)}function O(C,N){this.that=C,this.args=N,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,N),this.taps=0}O.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,N){return this.mouse&&C!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var N=Cr(this.that).datum();f.call(C,this.that,new sT(C,{sourceEvent:this.sourceEvent,target:D,transform:this.that.__zoom,dispatch:f}),N)}};function J(C,...N){if(!t.apply(this,arguments))return;var I=B(this,N).event(C),$=this.__zoom,Y=Math.max(s[0],Math.min(s[1],$.k*Math.pow(2,r.apply(this,arguments)))),X=Fr(C);if(I.wheel)(I.mouse[0][0]!==X[0]||I.mouse[0][1]!==X[1])&&(I.mouse[1]=$.invert(I.mouse[0]=X)),clearTimeout(I.wheel);else{if($.k===Y)return;I.mouse=[X,$.invert(X)],fl(this),I.start()}Ii(C),I.wheel=setTimeout(V,x),I.zoom("mouse",n(W(L($,Y),I.mouse[0],I.mouse[1]),I.extent,i));function V(){I.wheel=null,I.end()}}function le(C,...N){if(h||!t.apply(this,arguments))return;var I=C.currentTarget,$=B(this,N,!0).event(C),Y=Cr(C.view).on("mousemove.zoom",re,!0).on("mouseup.zoom",G,!0),X=Fr(C,I),V=C.clientX,te=C.clientY;_g(C.view),Zc(C),$.mouse=[X,this.__zoom.invert(X)],fl(this),$.start();function re(K){if(Ii(K),!$.moved){var ae=K.clientX-V,Z=K.clientY-te;$.moved=ae*ae+Z*Z>S}$.event(K).zoom("mouse",n(W($.that.__zoom,$.mouse[0]=Fr(K,I),$.mouse[1]),$.extent,i))}function G(K){Y.on("mousemove.zoom mouseup.zoom",null),bg(K.view,$.moved),Ii(K),$.event(K).end()}}function ke(C,...N){if(t.apply(this,arguments)){var I=this.__zoom,$=Fr(C.changedTouches?C.changedTouches[0]:C,this),Y=I.invert($),X=I.k*(C.shiftKey?.5:2),V=n(W(L(I,X),$,Y),e.apply(this,N),i);Ii(C),l>0?Cr(this).transition().duration(l).call(H,V,$,C):Cr(this).call(D.transform,V,$,C)}}function j(C,...N){if(t.apply(this,arguments)){var I=C.touches,$=I.length,Y=B(this,N,C.changedTouches.length===$).event(C),X,V,te,re;for(Zc(C),V=0;V<$;++V)te=I[V],re=Fr(te,this),re=[re,this.__zoom.invert(re),te.identifier],Y.touch0?!Y.touch1&&Y.touch0[2]!==re[2]&&(Y.touch1=re,Y.taps=0):(Y.touch0=re,X=!0,Y.taps=1+!!v);v&&(v=clearTimeout(v)),X&&(Y.taps<2&&(p=re[0],v=setTimeout(function(){v=null},y)),fl(this),Y.start())}}function M(C,...N){if(this.__zooming){var I=B(this,N).event(C),$=C.changedTouches,Y=$.length,X,V,te,re;for(Ii(C),X=0;X<Y;++X)V=$[X],te=Fr(V,this),I.touch0&&I.touch0[2]===V.identifier?I.touch0[0]=te:I.touch1&&I.touch1[2]===V.identifier&&(I.touch1[0]=te);if(V=I.that.__zoom,I.touch1){var G=I.touch0[0],K=I.touch0[1],ae=I.touch1[0],Z=I.touch1[1],ne=(ne=ae[0]-G[0])*ne+(ne=ae[1]-G[1])*ne,he=(he=Z[0]-K[0])*he+(he=Z[1]-K[1])*he;V=L(V,Math.sqrt(ne/he)),te=[(G[0]+ae[0])/2,(G[1]+ae[1])/2],re=[(K[0]+Z[0])/2,(K[1]+Z[1])/2]}else if(I.touch0)te=I.touch0[0],re=I.touch0[1];else return;I.zoom("touch",n(W(V,te,re),I.extent,i))}}function z(C,...N){if(this.__zooming){var I=B(this,N).event(C),$=C.changedTouches,Y=$.length,X,V;for(Zc(C),h&&clearTimeout(h),h=setTimeout(function(){h=null},y),X=0;X<Y;++X)V=$[X],I.touch0&&I.touch0[2]===V.identifier?delete I.touch0:I.touch1&&I.touch1[2]===V.identifier&&delete I.touch1;if(I.touch1&&!I.touch0&&(I.touch0=I.touch1,delete I.touch1),I.touch0)I.touch0[1]=this.__zoom.invert(I.touch0[0]);else if(I.end(),I.taps===2&&(V=Fr(V,this),Math.hypot(p[0]-V[0],p[1]-V[1])<A)){var te=Cr(this).on("dblclick.zoom");te&&te.apply(this,arguments)}}}return D.wheelDelta=function(C){return arguments.length?(r=typeof C=="function"?C:Zo(+C),D):r},D.filter=function(C){return arguments.length?(t=typeof C=="function"?C:Zo(!!C),D):t},D.touchable=function(C){return arguments.length?(a=typeof C=="function"?C:Zo(!!C),D):a},D.extent=function(C){return arguments.length?(e=typeof C=="function"?C:Zo([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),D):e},D.scaleExtent=function(C){return arguments.length?(s[0]=+C[0],s[1]=+C[1],D):[s[0],s[1]]},D.translateExtent=function(C){return arguments.length?(i[0][0]=+C[0][0],i[1][0]=+C[1][0],i[0][1]=+C[0][1],i[1][1]=+C[1][1],D):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},D.constrain=function(C){return arguments.length?(n=C,D):n},D.duration=function(C){return arguments.length?(l=+C,D):l},D.interpolate=function(C){return arguments.length?(d=C,D):d},D.on=function(){var C=f.on.apply(f,arguments);return C===f?D:C},D.clickDistance=function(C){return arguments.length?(S=(C=+C)*C,D):Math.sqrt(S)},D.tapDistance=function(C){return arguments.length?(A=+C,D):A},D}const Zi={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Ku=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Rg=["Enter"," ","Escape"],fT={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ti;(function(t){t.Strict="strict",t.Loose="loose"})(ti||(ti={}));var js;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(js||(js={}));var Cl;(function(t){t.Partial="partial",t.Full="full"})(Cl||(Cl={}));const Hu={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Ta;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(Ta||(Ta={}));var Il;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Il||(Il={}));var wt;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(wt||(wt={}));const Pv={[wt.Left]:wt.Right,[wt.Right]:wt.Left,[wt.Top]:wt.Bottom,[wt.Bottom]:wt.Top};function vT(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function Mv(t,e,n){if(!n)return;const r=[];t.forEach((a,s)=>{e!=null&&e.has(s)||r.push(a)}),r.length&&n(r)}function hT(t){return t===null?null:t?"valid":"invalid"}const Lg=t=>"id"in t&&"source"in t&&"target"in t,pT=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),jd=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),_o=(t,e=[0,0])=>{const{width:n,height:r}=Es(t),a=t.origin??e,s=n*a[0],i=r*a[1];return{x:t.position.x-s,y:t.position.y-i}},gT=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,a)=>{const s=typeof a=="string";let i=!e.nodeLookup&&!s?a:void 0;e.nodeLookup&&(i=s?e.nodeLookup.get(a):jd(a)?a:e.nodeLookup.get(a.id));const l=i?Pl(i,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return rc(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return ac(n)},nc=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(a=>{(e.filter===void 0||e.filter(a))&&(n=rc(n,Pl(a)),r=!0)}),r?ac(n):{x:0,y:0,width:0,height:0}},qd=(t,e,[n,r,a]=[0,0,1],s=!1,i=!1)=>{const l={...wo(e,[n,r,a]),width:e.width/a,height:e.height/a},d=[];for(const f of t.values()){const{measured:v,selectable:p=!0,hidden:h=!1}=f;if(i&&!p||h)continue;const y=v.width??f.width??f.initialWidth??null,x=v.height??f.height??f.initialHeight??null,S=Qi(l,ri(f)),A=(y??0)*(x??0),D=s&&S>0;(!f.internals.handleBounds||D||S>=A||f.dragging)&&d.push(f)}return d},mT=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function yT(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(a=>a.id)):null;return t.forEach(a=>{a.measured.width&&a.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!a.hidden)&&(!r||r.has(a.id))&&n.set(a.id,a)}),n}async function _T({nodes:t,width:e,height:n,panZoom:r,minZoom:a,maxZoom:s},i){if(t.size===0)return Promise.resolve(!0);const l=yT(t,i),d=nc(l),f=Bd(d,e,n,(i==null?void 0:i.minZoom)??a,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await r.setViewport(f,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function zg({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:a,onError:s}){const i=n.get(t),l=i.parentId?n.get(i.parentId):void 0,{x:d,y:f}=l?l.internals.positionAbsolute:{x:0,y:0},v=i.origin??r;let p=i.extent||a;if(i.extent==="parent"&&!i.expandParent)if(!l)s==null||s("005",Zi.error005());else{const y=l.measured.width,x=l.measured.height;y&&x&&(p=[[d,f],[d+y,f+x]])}else l&&ai(i.extent)&&(p=[[i.extent[0][0]+d,i.extent[0][1]+f],[i.extent[1][0]+d,i.extent[1][1]+f]]);const h=ai(p)?ms(e,p,i.measured):e;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",Zi.error015())),{position:{x:h.x-d+(i.measured.width??0)*v[0],y:h.y-f+(i.measured.height??0)*v[1]},positionAbsolute:h}}async function bT({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:a}){const s=new Set(t.map(h=>h.id)),i=[];for(const h of n){if(h.deletable===!1)continue;const y=s.has(h.id),x=!y&&h.parentId&&i.find(S=>S.id===h.parentId);(y||x)&&i.push(h)}const l=new Set(e.map(h=>h.id)),d=r.filter(h=>h.deletable!==!1),v=mT(i,d);for(const h of d)l.has(h.id)&&!v.find(x=>x.id===h.id)&&v.push(h);if(!a)return{edges:v,nodes:i};const p=await a({nodes:i,edges:v});return typeof p=="boolean"?p?{edges:v,nodes:i}:{edges:[],nodes:[]}:p}const ni=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),ms=(t={x:0,y:0},e,n)=>({x:ni(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:ni(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function jg(t,e,n){const{width:r,height:a}=Es(n),{x:s,y:i}=n.internals.positionAbsolute;return ms(t,[[s,i],[s+r,i+a]],e)}const Ov=(t,e,n)=>t<e?ni(Math.abs(t-e),1,e)/e:t>n?-ni(Math.abs(t-n),1,e)/e:0,qg=(t,e,n=15,r=40)=>{const a=Ov(t.x,r,e.width-r)*n,s=Ov(t.y,r,e.height-r)*n;return[a,s]},rc=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Vu=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),ac=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),ri=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=jd(t)?t.internals.positionAbsolute:_o(t,e);return{x:n,y:r,width:((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0,height:((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0}},Pl=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=jd(t)?t.internals.positionAbsolute:_o(t,e);return{x:n,y:r,x2:n+(((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0),y2:r+(((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0)}},wT=(t,e)=>ac(rc(Vu(t),Vu(e))),Qi=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Nv=t=>ha(t.width)&&ha(t.height)&&ha(t.x)&&ha(t.y),ha=t=>!isNaN(t)&&isFinite(t),xT=(t,e)=>{},bo=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),wo=({x:t,y:e},[n,r,a],s=!1,i=[1,1])=>{const l={x:(t-n)/a,y:(e-r)/a};return s?bo(l,i):l},Ml=({x:t,y:e},[n,r,a])=>({x:t*a+n,y:e*a+r});function Ns(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function kT(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=Ns(t,n),a=Ns(t,e);return{top:r,right:a,bottom:r,left:a,x:a*2,y:r*2}}if(typeof t=="object"){const r=Ns(t.top??t.y??0,n),a=Ns(t.bottom??t.y??0,n),s=Ns(t.left??t.x??0,e),i=Ns(t.right??t.x??0,e);return{top:r,right:i,bottom:a,left:s,x:s+i,y:r+a}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function ST(t,e,n,r,a,s){const{x:i,y:l}=Ml(t,[e,n,r]),{x:d,y:f}=Ml({x:t.x+t.width,y:t.y+t.height},[e,n,r]),v=a-d,p=s-f;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(v),bottom:Math.floor(p)}}const Bd=(t,e,n,r,a,s)=>{const i=kT(s,e,n),l=(e-i.x)/t.width,d=(n-i.y)/t.height,f=Math.min(l,d),v=ni(f,r,a),p=t.x+t.width/2,h=t.y+t.height/2,y=e/2-p*v,x=n/2-h*v,S=ST(t,y,x,v,e,n),A={left:Math.min(S.left-i.left,0),top:Math.min(S.top-i.top,0),right:Math.min(S.right-i.right,0),bottom:Math.min(S.bottom-i.bottom,0)};return{x:y-A.left+A.right,y:x-A.top+A.bottom,zoom:v}},Ol=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function ai(t){return t!=null&&t!=="parent"}function Es(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function ET(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function AT(t,e={width:0,height:0},n,r,a){const s={...t},i=r.get(n);if(i){const l=i.origin||a;s.x+=i.internals.positionAbsolute.x-(e.width??0)*l[0],s.y+=i.internals.positionAbsolute.y-(e.height??0)*l[1]}return s}function TT(t){return{...fT,...t||{}}}function Qc(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:a}){const{x:s,y:i}=Or(t),l=wo({x:s-((a==null?void 0:a.left)??0),y:i-((a==null?void 0:a.top)??0)},r),{x:d,y:f}=n?bo(l,e):l;return{xSnapped:d,ySnapped:f,...l}}const Bg=t=>({width:t.offsetWidth,height:t.offsetHeight}),Fg=t=>{var e;return((e=t==null?void 0:t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},CT=["INPUT","SELECT","TEXTAREA"];function Kg(t){var r,a;const e=((a=(r=t.composedPath)==null?void 0:r.call(t))==null?void 0:a[0])||t.target;return(e==null?void 0:e.nodeType)!==1?!1:CT.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const Hg=t=>"clientX"in t,Or=(t,e)=>{var s,i;const n=Hg(t),r=n?t.clientX:(s=t.touches)==null?void 0:s[0].clientX,a=n?t.clientY:(i=t.touches)==null?void 0:i[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:a-((e==null?void 0:e.top)??0)}},Dv=(t,e,n,r,a)=>{const s=e.querySelectorAll(`.${t}`);return!s||!s.length?null:Array.from(s).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:t,nodeId:a,position:i.getAttribute("data-handlepos"),x:(l.left-n.left)/r,y:(l.top-n.top)/r,...Bg(i)}})};function IT({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:s,targetControlX:i,targetControlY:l}){const d=t*.125+a*.375+i*.375+n*.125,f=e*.125+s*.375+l*.375+r*.125,v=Math.abs(d-t),p=Math.abs(f-e);return[d,f,v,p]}function Qo(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function Rv({pos:t,x1:e,y1:n,x2:r,y2:a,c:s}){switch(t){case wt.Left:return[e-Qo(e-r,s),n];case wt.Right:return[e+Qo(r-e,s),n];case wt.Top:return[e,n-Qo(n-a,s)];case wt.Bottom:return[e,n+Qo(a-n,s)]}}function Vg({sourceX:t,sourceY:e,sourcePosition:n=wt.Bottom,targetX:r,targetY:a,targetPosition:s=wt.Top,curvature:i=.25}){const[l,d]=Rv({pos:n,x1:t,y1:e,x2:r,y2:a,c:i}),[f,v]=Rv({pos:s,x1:r,y1:a,x2:t,y2:e,c:i}),[p,h,y,x]=IT({sourceX:t,sourceY:e,targetX:r,targetY:a,sourceControlX:l,sourceControlY:d,targetControlX:f,targetControlY:v});return[`M${t},${e} C${l},${d} ${f},${v} ${r},${a}`,p,h,y,x]}function Ug({sourceX:t,sourceY:e,targetX:n,targetY:r}){const a=Math.abs(n-t)/2,s=n<t?n+a:n-a,i=Math.abs(r-e)/2,l=r<e?r+i:r-i;return[s,l,a,i]}function PT({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:a=!1,zIndexMode:s="basic"}){if(s==="manual")return r;const i=a&&n?r+1e3:r,l=Math.max(t.parentId||a&&t.selected?t.internals.z:0,e.parentId||a&&e.selected?e.internals.z:0);return i+l}function MT({sourceNode:t,targetNode:e,width:n,height:r,transform:a}){const s=rc(Pl(t),Pl(e));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-a[0]/a[2],y:-a[1]/a[2],width:n/a[2],height:r/a[2]};return Qi(i,ac(s))>0}const OT=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,NT=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),DT=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||OT;let a;return Lg(t)?a={...t}:a={...t,id:r(t)},NT(a,e)?e:(a.sourceHandle===null&&delete a.sourceHandle,a.targetHandle===null&&delete a.targetHandle,e.concat(a))};function Gg({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[a,s,i,l]=Ug({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,a,s,i,l]}const Lv={[wt.Left]:{x:-1,y:0},[wt.Right]:{x:1,y:0},[wt.Top]:{x:0,y:-1},[wt.Bottom]:{x:0,y:1}},RT=({source:t,sourcePosition:e=wt.Bottom,target:n})=>e===wt.Left||e===wt.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},zv=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function LT({source:t,sourcePosition:e=wt.Bottom,target:n,targetPosition:r=wt.Top,center:a,offset:s,stepPosition:i}){const l=Lv[e],d=Lv[r],f={x:t.x+l.x*s,y:t.y+l.y*s},v={x:n.x+d.x*s,y:n.y+d.y*s},p=RT({source:f,sourcePosition:e,target:v}),h=p.x!==0?"x":"y",y=p[h];let x=[],S,A;const D={x:0,y:0},L={x:0,y:0},[,,W,k]=Ug({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(l[h]*d[h]===-1){h==="x"?(S=a.x??f.x+(v.x-f.x)*i,A=a.y??(f.y+v.y)/2):(S=a.x??(f.x+v.x)/2,A=a.y??f.y+(v.y-f.y)*i);const B=[{x:S,y:f.y},{x:S,y:v.y}],O=[{x:f.x,y:A},{x:v.x,y:A}];l[h]===y?x=h==="x"?B:O:x=h==="x"?O:B}else{const B=[{x:f.x,y:v.y}],O=[{x:v.x,y:f.y}];if(h==="x"?x=l.x===y?O:B:x=l.y===y?B:O,e===r){const M=Math.abs(t[h]-n[h]);if(M<=s){const z=Math.min(s-1,s-M);l[h]===y?D[h]=(f[h]>t[h]?-1:1)*z:L[h]=(v[h]>n[h]?-1:1)*z}}if(e!==r){const M=h==="x"?"y":"x",z=l[h]===d[M],C=f[M]>v[M],N=f[M]<v[M];(l[h]===1&&(!z&&C||z&&N)||l[h]!==1&&(!z&&N||z&&C))&&(x=h==="x"?B:O)}const J={x:f.x+D.x,y:f.y+D.y},le={x:v.x+L.x,y:v.y+L.y},ke=Math.max(Math.abs(J.x-x[0].x),Math.abs(le.x-x[0].x)),j=Math.max(Math.abs(J.y-x[0].y),Math.abs(le.y-x[0].y));ke>=j?(S=(J.x+le.x)/2,A=x[0].y):(S=x[0].x,A=(J.y+le.y)/2)}return[[t,{x:f.x+D.x,y:f.y+D.y},...x,{x:v.x+L.x,y:v.y+L.y},n],S,A,W,k]}function zT(t,e,n,r){const a=Math.min(zv(t,e)/2,zv(e,n)/2,r),{x:s,y:i}=e;if(t.x===s&&s===n.x||t.y===i&&i===n.y)return`L${s} ${i}`;if(t.y===i){const f=t.x<n.x?-1:1,v=t.y<n.y?1:-1;return`L ${s+a*f},${i}Q ${s},${i} ${s},${i+a*v}`}const l=t.x<n.x?1:-1,d=t.y<n.y?-1:1;return`L ${s},${i+a*d}Q ${s},${i} ${s+a*l},${i}`}function Fd({sourceX:t,sourceY:e,sourcePosition:n=wt.Bottom,targetX:r,targetY:a,targetPosition:s=wt.Top,borderRadius:i=5,centerX:l,centerY:d,offset:f=20,stepPosition:v=.5}){const[p,h,y,x,S]=LT({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:a},targetPosition:s,center:{x:l,y:d},offset:f,stepPosition:v});return[p.reduce((D,L,W)=>{let k="";return W>0&&W<p.length-1?k=zT(p[W-1],L,p[W+1],i):k=`${W===0?"M":"L"}${L.x} ${L.y}`,D+=k,D},""),h,y,x,S]}function jv(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function jT(t){var p;const{sourceNode:e,targetNode:n}=t;if(!jv(e)||!jv(n))return null;const r=e.internals.handleBounds||qv(e.handles),a=n.internals.handleBounds||qv(n.handles),s=Bv((r==null?void 0:r.source)??[],t.sourceHandle),i=Bv(t.connectionMode===ti.Strict?(a==null?void 0:a.target)??[]:((a==null?void 0:a.target)??[]).concat((a==null?void 0:a.source)??[]),t.targetHandle);if(!s||!i)return(p=t.onError)==null||p.call(t,"008",Zi.error008(s?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const l=(s==null?void 0:s.position)||wt.Bottom,d=(i==null?void 0:i.position)||wt.Top,f=ys(e,s,l),v=ys(n,i,d);return{sourceX:f.x,sourceY:f.y,targetX:v.x,targetY:v.y,sourcePosition:l,targetPosition:d}}function qv(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function ys(t,e,n=wt.Left,r=!1){const a=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,s=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:i,height:l}=e??Es(t);if(r)return{x:a+i/2,y:s+l/2};switch((e==null?void 0:e.position)??n){case wt.Top:return{x:a+i/2,y:s};case wt.Right:return{x:a+i,y:s+l/2};case wt.Bottom:return{x:a+i/2,y:s+l};case wt.Left:return{x:a,y:s+l/2}}}function Bv(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function Uu(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function qT(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:a}){const s=new Set;return t.reduce((i,l)=>([l.markerStart||r,l.markerEnd||a].forEach(d=>{if(d&&typeof d=="object"){const f=Uu(d,e);s.has(f)||(i.push({id:f,color:d.color||n,...d}),s.add(f))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const Wg=1e3,BT=10,Kd={nodeOrigin:[0,0],nodeExtent:Ku,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},FT={...Kd,checkEquality:!0};function Hd(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function KT(t,e,n){const r=Hd(Kd,n);for(const a of t.values())if(a.parentId)Ud(a,t,e,r);else{const s=_o(a,r.nodeOrigin),i=ai(a.extent)?a.extent:r.nodeExtent,l=ms(s,i,Es(a));a.internals.positionAbsolute=l}}function HT(t,e){if(!t.handles)return t.measured?e==null?void 0:e.internals.handleBounds:void 0;const n=[],r=[];for(const a of t.handles){const s={id:a.id,width:a.width??1,height:a.height??1,nodeId:t.id,x:a.x,y:a.y,position:a.position,type:a.type};a.type==="source"?n.push(s):a.type==="target"&&r.push(s)}return{source:n,target:r}}function Vd(t){return t==="manual"}function VT(t,e,n,r={}){var f,v;const a=Hd(FT,r),s={i:0},i=new Map(e),l=a!=null&&a.elevateNodesOnSelect&&!Vd(a.zIndexMode)?Wg:0;let d=t.length>0;e.clear(),n.clear();for(const p of t){let h=i.get(p.id);if(a.checkEquality&&p===(h==null?void 0:h.internals.userNode))e.set(p.id,h);else{const y=_o(p,a.nodeOrigin),x=ai(p.extent)?p.extent:a.nodeExtent,S=ms(y,x,Es(p));h={...a.defaults,...p,measured:{width:(f=p.measured)==null?void 0:f.width,height:(v=p.measured)==null?void 0:v.height},internals:{positionAbsolute:S,handleBounds:HT(p,h),z:Yg(p,l,a.zIndexMode),userNode:p}},e.set(p.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(d=!1),p.parentId&&Ud(h,e,n,r,s)}return d}function UT(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function Ud(t,e,n,r,a){const{elevateNodesOnSelect:s,nodeOrigin:i,nodeExtent:l,zIndexMode:d}=Hd(Kd,r),f=t.parentId,v=e.get(f);if(!v){console.warn(`Parent node ${f} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}UT(t,n),a&&!v.parentId&&v.internals.rootParentIndex===void 0&&d==="auto"&&(v.internals.rootParentIndex=++a.i,v.internals.z=v.internals.z+a.i*BT),a&&v.internals.rootParentIndex!==void 0&&(a.i=v.internals.rootParentIndex);const p=s&&!Vd(d)?Wg:0,{x:h,y,z:x}=GT(t,v,i,l,p,d),{positionAbsolute:S}=t.internals,A=h!==S.x||y!==S.y;(A||x!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:A?{x:h,y}:S,z:x}})}function Yg(t,e,n){const r=ha(t.zIndex)?t.zIndex:0;return Vd(n)?r:r+(t.selected?e:0)}function GT(t,e,n,r,a,s){const{x:i,y:l}=e.internals.positionAbsolute,d=Es(t),f=_o(t,n),v=ai(t.extent)?ms(f,t.extent,d):f;let p=ms({x:i+v.x,y:l+v.y},r,d);t.extent==="parent"&&(p=jg(p,d,e));const h=Yg(t,a,s),y=e.internals.z??0;return{x:p.x,y:p.y,z:y>=h?y+1:h}}function WT(t,e,n,r=[0,0]){var i;const a=[],s=new Map;for(const l of t){const d=e.get(l.parentId);if(!d)continue;const f=((i=s.get(l.parentId))==null?void 0:i.expandedRect)??ri(d),v=wT(f,l.rect);s.set(l.parentId,{expandedRect:v,parent:d})}return s.size>0&&s.forEach(({expandedRect:l,parent:d},f)=>{var W;const v=d.internals.positionAbsolute,p=Es(d),h=d.origin??r,y=l.x<v.x?Math.round(Math.abs(v.x-l.x)):0,x=l.y<v.y?Math.round(Math.abs(v.y-l.y)):0,S=Math.max(p.width,Math.round(l.width)),A=Math.max(p.height,Math.round(l.height)),D=(S-p.width)*h[0],L=(A-p.height)*h[1];(y>0||x>0||D||L)&&(a.push({id:f,type:"position",position:{x:d.position.x-y+D,y:d.position.y-x+L}}),(W=n.get(f))==null||W.forEach(k=>{t.some(H=>H.id===k.id)||a.push({id:k.id,type:"position",position:{x:k.position.x+y,y:k.position.y+x}})})),(p.width<l.width||p.height<l.height||y||x)&&a.push({id:f,type:"dimensions",setAttributes:!0,dimensions:{width:S+(y?h[0]*y-D:0),height:A+(x?h[1]*x-L:0)}})}),a}function YT(t,e,n,r,a,s,i){const l=r==null?void 0:r.querySelector(".xyflow__viewport");let d=!1;if(!l)return{changes:[],updatedInternals:d};const f=[],v=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(v.transform),h=[];for(const y of t.values()){const x=e.get(y.id);if(!x)continue;if(x.hidden){e.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),d=!0;continue}const S=Bg(y.nodeElement),A=x.measured.width!==S.width||x.measured.height!==S.height;if(!!(S.width&&S.height&&(A||!x.internals.handleBounds||y.force))){const L=y.nodeElement.getBoundingClientRect(),W=ai(x.extent)?x.extent:s;let{positionAbsolute:k}=x.internals;x.parentId&&x.extent==="parent"?k=jg(k,S,e.get(x.parentId)):W&&(k=ms(k,W,S));const H={...x,measured:S,internals:{...x.internals,positionAbsolute:k,handleBounds:{source:Dv("source",y.nodeElement,L,p,x.id),target:Dv("target",y.nodeElement,L,p,x.id)}}};e.set(x.id,H),x.parentId&&Ud(H,e,n,{nodeOrigin:a,zIndexMode:i}),d=!0,A&&(f.push({id:x.id,type:"dimensions",dimensions:S}),x.expandParent&&x.parentId&&h.push({id:x.id,parentId:x.parentId,rect:ri(H,a)}))}}if(h.length>0){const y=WT(h,e,n,a);f.push(...y)}return{changes:f,updatedInternals:d}}async function XT({delta:t,panZoom:e,transform:n,translateExtent:r,width:a,height:s}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const i=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[a,s]],r),l=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(l)}function Fv(t,e,n,r,a,s){let i=a;const l=r.get(i)||new Map;r.set(i,l.set(n,e)),i=`${a}-${t}`;const d=r.get(i)||new Map;if(r.set(i,d.set(n,e)),s){i=`${a}-${t}-${s}`;const f=r.get(i)||new Map;r.set(i,f.set(n,e))}}function ZT(t,e,n){t.clear(),e.clear();for(const r of n){const{source:a,target:s,sourceHandle:i=null,targetHandle:l=null}=r,d={edgeId:r.id,source:a,target:s,sourceHandle:i,targetHandle:l},f=`${a}-${i}--${s}-${l}`,v=`${s}-${l}--${a}-${i}`;Fv("source",d,v,t,a,i),Fv("target",d,f,t,s,l),e.set(r.id,r)}}function Xg(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:Xg(n,e):!1}function Kv(t,e,n){var a;let r=t;do{if((a=r==null?void 0:r.matches)!=null&&a.call(r,e))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function QT(t,e,n,r){const a=new Map;for(const[s,i]of t)if((i.selected||i.id===r)&&(!i.parentId||!Xg(i,t))&&(i.draggable||e&&typeof i.draggable>"u")){const l=t.get(s);l&&a.set(s,{id:s,position:l.position||{x:0,y:0},distance:{x:n.x-l.internals.positionAbsolute.x,y:n.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return a}function Jc({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var i,l,d;const a=[];for(const[f,v]of e){const p=(i=n.get(f))==null?void 0:i.internals.userNode;p&&a.push({...p,position:v.position,dragging:r})}if(!t)return[a[0],a];const s=(l=n.get(t))==null?void 0:l.internals.userNode;return[s?{...s,position:((d=e.get(t))==null?void 0:d.position)||s.position,dragging:r}:a[0],a]}function JT({dragItems:t,snapGrid:e,x:n,y:r}){const a=t.values().next().value;if(!a)return null;const s={x:n-a.distance.x,y:r-a.distance.y},i=bo(s,e);return{x:i.x-s.x,y:i.y-s.y}}function $T({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:a}){let s={x:null,y:null},i=0,l=new Map,d=!1,f={x:0,y:0},v=null,p=!1,h=null,y=!1,x=!1,S=null;function A({noDragClassName:L,handleSelector:W,domNode:k,isSelectable:H,nodeId:B,nodeClickDistance:O=0}){h=Cr(k);function J({x:M,y:z}){const{nodeLookup:C,nodeExtent:N,snapGrid:I,snapToGrid:$,nodeOrigin:Y,onNodeDrag:X,onSelectionDrag:V,onError:te,updateNodePositions:re}=e();s={x:M,y:z};let G=!1;const K=l.size>1,ae=K&&N?Vu(nc(l)):null,Z=K&&$?JT({dragItems:l,snapGrid:I,x:M,y:z}):null;for(const[ne,he]of l){if(!C.has(ne))continue;let _e={x:M-he.distance.x,y:z-he.distance.y};$&&(_e=Z?{x:Math.round(_e.x+Z.x),y:Math.round(_e.y+Z.y)}:bo(_e,I));let se=null;if(K&&N&&!he.extent&&ae){const{positionAbsolute:Me}=he.internals,Ve=Me.x-ae.x+N[0][0],Je=Me.x+he.measured.width-ae.x2+N[1][0],ut=Me.y-ae.y+N[0][1],Fe=Me.y+he.measured.height-ae.y2+N[1][1];se=[[Ve,ut],[Je,Fe]]}const{position:Te,positionAbsolute:be}=zg({nodeId:ne,nextPosition:_e,nodeLookup:C,nodeExtent:se||N,nodeOrigin:Y,onError:te});G=G||he.position.x!==Te.x||he.position.y!==Te.y,he.position=Te,he.internals.positionAbsolute=be}if(x=x||G,!!G&&(re(l,!0),S&&(r||X||!B&&V))){const[ne,he]=Jc({nodeId:B,dragItems:l,nodeLookup:C});r==null||r(S,l,ne,he),X==null||X(S,ne,he),B||V==null||V(S,he)}}async function le(){if(!v)return;const{transform:M,panBy:z,autoPanSpeed:C,autoPanOnNodeDrag:N}=e();if(!N){d=!1,cancelAnimationFrame(i);return}const[I,$]=qg(f,v,C);(I!==0||$!==0)&&(s.x=(s.x??0)-I/M[2],s.y=(s.y??0)-$/M[2],await z({x:I,y:$})&&J(s)),i=requestAnimationFrame(le)}function ke(M){var K;const{nodeLookup:z,multiSelectionActive:C,nodesDraggable:N,transform:I,snapGrid:$,snapToGrid:Y,selectNodesOnDrag:X,onNodeDragStart:V,onSelectionDragStart:te,unselectNodesAndEdges:re}=e();p=!0,(!X||!H)&&!C&&B&&((K=z.get(B))!=null&&K.selected||re()),H&&X&&B&&(t==null||t(B));const G=Qc(M.sourceEvent,{transform:I,snapGrid:$,snapToGrid:Y,containerBounds:v});if(s=G,l=QT(z,N,G,B),l.size>0&&(n||V||!B&&te)){const[ae,Z]=Jc({nodeId:B,dragItems:l,nodeLookup:z});n==null||n(M.sourceEvent,l,ae,Z),V==null||V(M.sourceEvent,ae,Z),B||te==null||te(M.sourceEvent,Z)}}const j=yE().clickDistance(O).on("start",M=>{const{domNode:z,nodeDragThreshold:C,transform:N,snapGrid:I,snapToGrid:$}=e();v=(z==null?void 0:z.getBoundingClientRect())||null,y=!1,x=!1,S=M.sourceEvent,C===0&&ke(M),s=Qc(M.sourceEvent,{transform:N,snapGrid:I,snapToGrid:$,containerBounds:v}),f=Or(M.sourceEvent,v)}).on("drag",M=>{const{autoPanOnNodeDrag:z,transform:C,snapGrid:N,snapToGrid:I,nodeDragThreshold:$,nodeLookup:Y}=e(),X=Qc(M.sourceEvent,{transform:C,snapGrid:N,snapToGrid:I,containerBounds:v});if(S=M.sourceEvent,(M.sourceEvent.type==="touchmove"&&M.sourceEvent.touches.length>1||B&&!Y.has(B))&&(y=!0),!y){if(!d&&z&&p&&(d=!0,le()),!p){const V=Or(M.sourceEvent,v),te=V.x-f.x,re=V.y-f.y;Math.sqrt(te*te+re*re)>$&&ke(M)}(s.x!==X.xSnapped||s.y!==X.ySnapped)&&l&&p&&(f=Or(M.sourceEvent,v),J(X))}}).on("end",M=>{if(!(!p||y)&&(d=!1,p=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:z,updateNodePositions:C,onNodeDragStop:N,onSelectionDragStop:I}=e();if(x&&(C(l,!1),x=!1),a||N||!B&&I){const[$,Y]=Jc({nodeId:B,dragItems:l,nodeLookup:z,dragging:!1});a==null||a(M.sourceEvent,l,$,Y),N==null||N(M.sourceEvent,$,Y),B||I==null||I(M.sourceEvent,Y)}}}).filter(M=>{const z=M.target;return!M.button&&(!L||!Kv(z,`.${L}`,k))&&(!W||Kv(z,W,k))});h.call(j)}function D(){h==null||h.on(".drag",null)}return{update:A,destroy:D}}function eC(t,e,n){const r=[],a={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const s of e.values())Qi(a,ri(s))>0&&r.push(s);return r}const tC=250;function nC(t,e,n,r){var l,d;let a=[],s=1/0;const i=eC(t,n,e+tC);for(const f of i){const v=[...((l=f.internals.handleBounds)==null?void 0:l.source)??[],...((d=f.internals.handleBounds)==null?void 0:d.target)??[]];for(const p of v){if(r.nodeId===p.nodeId&&r.type===p.type&&r.id===p.id)continue;const{x:h,y}=ys(f,p,p.position,!0),x=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(y-t.y,2));x>e||(x<s?(a=[{...p,x:h,y}],s=x):x===s&&a.push({...p,x:h,y}))}}if(!a.length)return null;if(a.length>1){const f=r.type==="source"?"target":"source";return a.find(v=>v.type===f)??a[0]}return a[0]}function Zg(t,e,n,r,a,s=!1){var f,v,p;const i=r.get(t);if(!i)return null;const l=a==="strict"?(f=i.internals.handleBounds)==null?void 0:f[e]:[...((v=i.internals.handleBounds)==null?void 0:v.source)??[],...((p=i.internals.handleBounds)==null?void 0:p.target)??[]],d=(n?l==null?void 0:l.find(h=>h.id===n):l==null?void 0:l[0])??null;return d&&s?{...d,...ys(i,d,d.position,!0)}:d}function Qg(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function rC(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const Jg=()=>!0;function aC(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:a,edgeUpdaterType:s,isTarget:i,domNode:l,nodeLookup:d,lib:f,autoPanOnConnect:v,flowId:p,panBy:h,cancelConnection:y,onConnectStart:x,onConnect:S,onConnectEnd:A,isValidConnection:D=Jg,onReconnectEnd:L,updateConnection:W,getTransform:k,getFromHandle:H,autoPanSpeed:B,dragThreshold:O=1,handleDomNode:J}){const le=Fg(t.target);let ke=0,j;const{x:M,y:z}=Or(t),C=Qg(s,J),N=l==null?void 0:l.getBoundingClientRect();let I=!1;if(!N||!C)return;const $=Zg(a,C,r,d,e);if(!$)return;let Y=Or(t,N),X=!1,V=null,te=!1,re=null;function G(){if(!v||!N)return;const[Te,be]=qg(Y,N,B);h({x:Te,y:be}),ke=requestAnimationFrame(G)}const K={...$,nodeId:a,type:C,position:$.position},ae=d.get(a);let ne={inProgress:!0,isValid:null,from:ys(ae,K,wt.Left,!0),fromHandle:K,fromPosition:K.position,fromNode:ae,to:Y,toHandle:null,toPosition:Pv[K.position],toNode:null,pointer:Y};function he(){I=!0,W(ne),x==null||x(t,{nodeId:a,handleId:r,handleType:C})}O===0&&he();function _e(Te){if(!I){const{x:Fe,y:Oe}=Or(Te),je=Fe-M,Ne=Oe-z;if(!(je*je+Ne*Ne>O*O))return;he()}if(!H()||!K){se(Te);return}const be=k();Y=Or(Te,N),j=nC(wo(Y,be,!1,[1,1]),n,d,K),X||(G(),X=!0);const Me=$g(Te,{handle:j,connectionMode:e,fromNodeId:a,fromHandleId:r,fromType:i?"target":"source",isValidConnection:D,doc:le,lib:f,flowId:p,nodeLookup:d});re=Me.handleDomNode,V=Me.connection,te=rC(!!j,Me.isValid);const Ve=d.get(a),Je=Ve?ys(Ve,K,wt.Left,!0):ne.from,ut={...ne,from:Je,isValid:te,to:Me.toHandle&&te?Ml({x:Me.toHandle.x,y:Me.toHandle.y},be):Y,toHandle:Me.toHandle,toPosition:te&&Me.toHandle?Me.toHandle.position:Pv[K.position],toNode:Me.toHandle?d.get(Me.toHandle.nodeId):null,pointer:Y};W(ut),ne=ut}function se(Te){if(!("touches"in Te&&Te.touches.length>0)){if(I){(j||re)&&V&&te&&(S==null||S(V));const{inProgress:be,...Me}=ne,Ve={...Me,toPosition:ne.toHandle?ne.toPosition:null};A==null||A(Te,Ve),s&&(L==null||L(Te,Ve))}y(),cancelAnimationFrame(ke),X=!1,te=!1,V=null,re=null,le.removeEventListener("mousemove",_e),le.removeEventListener("mouseup",se),le.removeEventListener("touchmove",_e),le.removeEventListener("touchend",se)}}le.addEventListener("mousemove",_e),le.addEventListener("mouseup",se),le.addEventListener("touchmove",_e),le.addEventListener("touchend",se)}function $g(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:a,fromType:s,doc:i,lib:l,flowId:d,isValidConnection:f=Jg,nodeLookup:v}){const p=s==="target",h=e?i.querySelector(`.${l}-flow__handle[data-id="${d}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:y,y:x}=Or(t),S=i.elementFromPoint(y,x),A=S!=null&&S.classList.contains(`${l}-flow__handle`)?S:h,D={handleDomNode:A,isValid:!1,connection:null,toHandle:null};if(A){const L=Qg(void 0,A),W=A.getAttribute("data-nodeid"),k=A.getAttribute("data-handleid"),H=A.classList.contains("connectable"),B=A.classList.contains("connectableend");if(!W||!L)return D;const O={source:p?W:r,sourceHandle:p?k:a,target:p?r:W,targetHandle:p?a:k};D.connection=O;const le=H&&B&&(n===ti.Strict?p&&L==="source"||!p&&L==="target":W!==r||k!==a);D.isValid=le&&f(O),D.toHandle=Zg(W,L,k,v,n,!0)}return D}const Hv={onPointerDown:aC,isValid:$g},sc=t=>({x:t.x,y:t.y,zoom:t.k}),$c=({x:t,y:e,zoom:n})=>tc.translate(t,e).scale(n),Rs=(t,e)=>t.target.closest(`.${e}`),em=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),sC=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,eu=(t,e=0,n=sC,r=()=>{})=>{const a=typeof e=="number"&&e>0;return a||r(),a?t.transition().duration(e).ease(n).on("end",r):t},tm=t=>{const e=t.ctrlKey&&Ol()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function iC({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:a,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:d,onPanZoomEnd:f}){return v=>{if(Rs(v,e))return v.ctrlKey&&v.preventDefault(),!1;v.preventDefault(),v.stopImmediatePropagation();const p=n.property("__zoom").k||1;if(v.ctrlKey&&i){const A=Fr(v),D=tm(v),L=p*Math.pow(2,D);r.scaleTo(n,L,A,v);return}const h=v.deltaMode===1?20:1;let y=a===js.Vertical?0:v.deltaX*h,x=a===js.Horizontal?0:v.deltaY*h;!Ol()&&v.shiftKey&&a!==js.Vertical&&(y=v.deltaY*h,x=0),r.translateBy(n,-(y/p)*s,-(x/p)*s,{internal:!0});const S=sc(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(d==null||d(v,S),t.panScrollTimeout=setTimeout(()=>{f==null||f(v,S),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,l==null||l(v,S))}}function oC({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,a){const s=r.type==="wheel",i=!e&&s&&!r.ctrlKey,l=Rs(r,t);if(r.ctrlKey&&s&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),n.call(this,r,a)}}function lC({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var s,i,l;if((s=r.sourceEvent)!=null&&s.internal)return;const a=sc(r.transform);t.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=a,((l=r.sourceEvent)==null?void 0:l.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,a))}}function cC({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:a}){return s=>{var i,l;t.usedRightMouseButton=!!(n&&em(e,t.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||r([s.transform.x,s.transform.y,s.transform.k]),a&&!((l=s.sourceEvent)!=null&&l.internal)&&(a==null||a(s.sourceEvent,sc(s.transform)))}}function uC({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:a,onPaneContextMenu:s}){return i=>{var l;if(!((l=i.sourceEvent)!=null&&l.internal)&&(t.isZoomingOrPanning=!1,s&&em(e,t.mouseButton??0)&&!t.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),t.usedRightMouseButton=!1,r(!1),a)){const d=sc(i.transform);t.prevViewport=d,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{a==null||a(i.sourceEvent,d)},n?150:0)}}}function dC({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:a,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:l,noPanClassName:d,lib:f,connectionInProgress:v}){return p=>{var A;const h=t||e,y=n&&p.ctrlKey,x=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(Rs(p,`${f}-flow__node`)||Rs(p,`${f}-flow__edge`)))return!0;if(!r&&!h&&!a&&!s&&!n||i||v&&!x||Rs(p,l)&&x||Rs(p,d)&&(!x||a&&x&&!t)||!n&&p.ctrlKey&&x)return!1;if(!n&&p.type==="touchstart"&&((A=p.touches)==null?void 0:A.length)>1)return p.preventDefault(),!1;if(!h&&!a&&!y&&x||!r&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(r)&&!r.includes(p.button)&&p.type==="mousedown")return!1;const S=Array.isArray(r)&&r.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||x)&&S}}function fC({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:a,onPanZoom:s,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:d}){const f={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},v=t.getBoundingClientRect(),p=dT().scaleExtent([e,n]).translateExtent(r),h=Cr(t).call(p);L({x:a.x,y:a.y,zoom:ni(a.zoom,e,n)},[[0,0],[v.width,v.height]],r);const y=h.on("wheel.zoom"),x=h.on("dblclick.zoom");p.wheelDelta(tm);function S(j,M){return h?new Promise(z=>{p==null||p.interpolate((M==null?void 0:M.interpolate)==="linear"?qi:cl).transform(eu(h,M==null?void 0:M.duration,M==null?void 0:M.ease,()=>z(!0)),j)}):Promise.resolve(!1)}function A({noWheelClassName:j,noPanClassName:M,onPaneContextMenu:z,userSelectionActive:C,panOnScroll:N,panOnDrag:I,panOnScrollMode:$,panOnScrollSpeed:Y,preventScrolling:X,zoomOnPinch:V,zoomOnScroll:te,zoomOnDoubleClick:re,zoomActivationKeyPressed:G,lib:K,onTransformChange:ae,connectionInProgress:Z,paneClickDistance:ne,selectionOnDrag:he}){C&&!f.isZoomingOrPanning&&D();const _e=N&&!G&&!C;p.clickDistance(he?1/0:!ha(ne)||ne<0?0:ne);const se=_e?iC({zoomPanValues:f,noWheelClassName:j,d3Selection:h,d3Zoom:p,panOnScrollMode:$,panOnScrollSpeed:Y,zoomOnPinch:V,onPanZoomStart:i,onPanZoom:s,onPanZoomEnd:l}):oC({noWheelClassName:j,preventScrolling:X,d3ZoomHandler:y});if(h.on("wheel.zoom",se,{passive:!1}),!C){const be=lC({zoomPanValues:f,onDraggingChange:d,onPanZoomStart:i});p.on("start",be);const Me=cC({zoomPanValues:f,panOnDrag:I,onPaneContextMenu:!!z,onPanZoom:s,onTransformChange:ae});p.on("zoom",Me);const Ve=uC({zoomPanValues:f,panOnDrag:I,panOnScroll:N,onPaneContextMenu:z,onPanZoomEnd:l,onDraggingChange:d});p.on("end",Ve)}const Te=dC({zoomActivationKeyPressed:G,panOnDrag:I,zoomOnScroll:te,panOnScroll:N,zoomOnDoubleClick:re,zoomOnPinch:V,userSelectionActive:C,noPanClassName:M,noWheelClassName:j,lib:K,connectionInProgress:Z});p.filter(Te),re?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function D(){p.on("zoom",null)}async function L(j,M,z){const C=$c(j),N=p==null?void 0:p.constrain()(C,M,z);return N&&await S(N),new Promise(I=>I(N))}async function W(j,M){const z=$c(j);return await S(z,M),new Promise(C=>C(z))}function k(j){if(h){const M=$c(j),z=h.property("__zoom");(z.k!==j.zoom||z.x!==j.x||z.y!==j.y)&&(p==null||p.transform(h,M,null,{sync:!0}))}}function H(){const j=h?Dg(h.node()):{x:0,y:0,k:1};return{x:j.x,y:j.y,zoom:j.k}}function B(j,M){return h?new Promise(z=>{p==null||p.interpolate((M==null?void 0:M.interpolate)==="linear"?qi:cl).scaleTo(eu(h,M==null?void 0:M.duration,M==null?void 0:M.ease,()=>z(!0)),j)}):Promise.resolve(!1)}function O(j,M){return h?new Promise(z=>{p==null||p.interpolate((M==null?void 0:M.interpolate)==="linear"?qi:cl).scaleBy(eu(h,M==null?void 0:M.duration,M==null?void 0:M.ease,()=>z(!0)),j)}):Promise.resolve(!1)}function J(j){p==null||p.scaleExtent(j)}function le(j){p==null||p.translateExtent(j)}function ke(j){const M=!ha(j)||j<0?0:j;p==null||p.clickDistance(M)}return{update:A,destroy:D,setViewport:W,setViewportConstrained:L,getViewport:H,scaleTo:B,scaleBy:O,setScaleExtent:J,setTranslateExtent:le,syncViewport:k,setClickDistance:ke}}var Vv;(function(t){t.Line="line",t.Handle="handle"})(Vv||(Vv={}));function Gd(){const t={};return[e=>{if(e&&!uy(t))throw new Error(e);return Qu(t)},e=>gh(t,e)]}const[vC,hC]=Gd(),[pC,gC]=Gd(),[mC,yC]=Gd();var _C=q("<div><!></div>");function ja(t,e){at(e,!0);let n=Ee(e,"id",3,null),r=Ee(e,"type",3,"source"),a=Ee(e,"position",19,()=>wt.Top),s=Ee(e,"isConnectableStart",3,!0),i=Ee(e,"isConnectableEnd",3,!0),l=ks(e,["$$slots","$$events","$$legacy","id","type","position","style","class","isConnectable","isConnectableStart","isConnectableEnd","isValidConnection","onconnect","ondisconnect","children"]);const d=vC("Handle must be used within a Custom Node component"),f=pC("Handle must be used within a Custom Node component");let v=Q(()=>r()==="target"),p=Q(()=>e.isConnectable!==void 0?e.isConnectable:f.value),h=As(),y=Q(()=>h.ariaLabelConfig),x=null;qh(()=>{if(e.onconnect||e.ondisconnect){h.edges;let M=h.connectionLookup.get(`${d}-${r()}${n()?`-${n()}`:""}`);if(x&&!vT(M,x)){const z=M??new Map;Mv(x,z,e.ondisconnect),Mv(z,x,e.onconnect)}x=new Map(M)}});let S=Q(()=>{if(!h.connection.inProgress)return[!1,!1,!1,!1,null];const{fromHandle:M,toHandle:z,isValid:C}=h.connection,N=M&&M.nodeId===d&&M.type===r()&&M.id===n(),I=z&&z.nodeId===d&&z.type===r()&&z.id===n(),$=h.connectionMode===ti.Strict?(M==null?void 0:M.type)!==r():d!==(M==null?void 0:M.nodeId)||n()!==(M==null?void 0:M.id);return[!0,N,I,$,I&&C]}),A=Q(()=>so(o(S),5)),D=Q(()=>o(A)[0]),L=Q(()=>o(A)[1]),W=Q(()=>o(A)[2]),k=Q(()=>o(A)[3]),H=Q(()=>o(A)[4]);function B(M){var C;const z=h.onbeforeconnect?h.onbeforeconnect(M):M;z&&(h.addEdge(z),(C=h.onconnect)==null||C.call(h,M))}function O(M){const z=Hg(M);M.currentTarget&&(z&&M.button===0||!z)&&Hv.onPointerDown(M,{handleId:n(),nodeId:d,isTarget:o(v),connectionRadius:h.connectionRadius,domNode:h.domNode,nodeLookup:h.nodeLookup,connectionMode:h.connectionMode,lib:"svelte",autoPanOnConnect:h.autoPanOnConnect,autoPanSpeed:h.autoPanSpeed,flowId:h.flowId,isValidConnection:e.isValidConnection||((...C)=>{var N;return((N=h.isValidConnection)==null?void 0:N.call(h,...C))??!0}),updateConnection:h.updateConnection,cancelConnection:h.cancelConnection,panBy:h.panBy,onConnect:B,onConnectStart:h.onconnectstart,onConnectEnd:(...C)=>{var N;return(N=h.onconnectend)==null?void 0:N.call(h,...C)},getTransform:()=>[h.viewport.x,h.viewport.y,h.viewport.zoom],getFromHandle:()=>h.connection.fromHandle,dragThreshold:h.connectionDragThreshold,handleDomNode:M.currentTarget})}function J(M){var re,G;if(!d||!h.clickConnectStartHandle&&!s())return;if(!h.clickConnectStartHandle){(re=h.onclickconnectstart)==null||re.call(h,M,{nodeId:d,handleId:n(),handleType:r()}),h.clickConnectStartHandle={nodeId:d,type:r(),id:n()};return}const z=Fg(M.target),C=e.isValidConnection??h.isValidConnection,{connectionMode:N,clickConnectStartHandle:I,flowId:$,nodeLookup:Y}=h,{connection:X,isValid:V}=Hv.isValid(M,{handle:{nodeId:d,id:n(),type:r()},connectionMode:N,fromNodeId:I.nodeId,fromHandleId:I.id??null,fromType:I.type,isValidConnection:C,flowId:$,doc:z,lib:"svelte",nodeLookup:Y});V&&X&&B(X);const te=structuredClone(ph(h.connection));delete te.inProgress,te.toPosition=te.toHandle?te.toHandle.position:null,(G=h.onclickconnectend)==null||G.call(h,M,te),h.clickConnectStartHandle=null}var le=_C(),ke=()=>{};Ba(le,()=>({"data-handleid":n(),"data-nodeid":d,"data-handlepos":a(),"data-id":`${h.flowId??""}-${d??""}-${n()??"null"??""}-${r()??""}`,class:["svelte-flow__handle",`svelte-flow__handle-${a()}`,h.noDragClass,h.noPanClass,a(),e.class],onmousedown:O,ontouchstart:O,onclick:h.clickConnect?J:void 0,onkeypress:ke,style:e.style,role:"button","aria-label":o(y)["handle.ariaLabel"],tabindex:"-1",...l,[Aa]:{valid:o(H),connectingto:o(W),connectingfrom:o(L),source:!o(v),target:o(v),connectablestart:s(),connectableend:i(),connectable:o(p),connectionindicator:o(p)&&(!o(D)||o(k))&&(o(D)||h.clickConnectStartHandle?i():s())}}));var j=_(le);gr(j,()=>e.children??_s),T(t,le),st()}var bC=q("<!> <!>",1);function nm(t,e){at(e,!0);let n=Ee(e,"targetPosition",19,()=>wt.Top),r=Ee(e,"sourcePosition",19,()=>wt.Bottom);var a=bC(),s=Xe(a);ja(s,{type:"target",get position(){return n()}});var i=b(s),l=b(i);ja(l,{type:"source",get position(){return r()}}),ie(()=>{var d;return ee(i,` ${((d=e.data)==null?void 0:d.label)??""} `)}),T(t,a),st()}var wC=q(" <!>",1);function xC(t,e){at(e,!0);let n=Ee(e,"data",19,()=>({label:"Node"})),r=Ee(e,"sourcePosition",19,()=>wt.Bottom);var a=wC(),s=Xe(a),i=b(s);ja(i,{type:"source",get position(){return r()}}),ie(()=>{var l;return ee(s,`${((l=n())==null?void 0:l.label)??""} `)}),T(t,a),st()}var kC=q(" <!>",1);function SC(t,e){at(e,!0);let n=Ee(e,"data",19,()=>({label:"Node"})),r=Ee(e,"targetPosition",19,()=>wt.Top);var a=kC(),s=Xe(a),i=b(s);ja(i,{type:"target",get position(){return r()}}),ie(()=>{var l;return ee(s,`${((l=n())==null?void 0:l.label)??""} `)}),T(t,a),st()}function EC(t,e){}function tu(t,e,n){if(!n||!e)return;const r=n==="root"?e:e.querySelector(`.svelte-flow__${n}`);r&&r.appendChild(t)}function nu(t,e){const n=Q(As),r=Q(()=>o(n).domNode);let a;return o(r)?tu(t,o(r),e):a=Bh(()=>{kn(()=>{tu(t,o(r),e),a==null||a()})}),{async update(s){tu(t,o(r),s)},destroy(){t.parentNode&&t.parentNode.removeChild(t),a==null||a()}}}function AC(){let t=Pe(typeof window>"u");if(o(t)){const e=Bh(()=>{kn(()=>{P(t,!1),e==null||e()})})}return{get value(){return o(t)}}}const Uv=t=>pT(t),TC=t=>Lg(t);function $r(t){return t===void 0?void 0:`${t}px`}const Nl={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var CC=q("<div><!></div>");function IC(t,e){at(e,!0);let n=Ee(e,"x",3,0),r=Ee(e,"y",3,0),a=Ee(e,"selectEdgeOnClick",3,!1),s=Ee(e,"transparent",3,!1),i=ks(e,["$$slots","$$events","$$legacy","x","y","width","height","selectEdgeOnClick","transparent","class","children"]);const l=As(),d=mC("EdgeLabel must be used within a Custom Edge component");let f=Q(()=>{var y;return(y=l.visible.edges.get(d))==null?void 0:y.zIndex});var v=CC(),p=()=>{a()&&d&&l.handleEdgeSelection(d)};Ba(v,y=>({class:["svelte-flow__edge-label",{transparent:s()},e.class],tabindex:"-1",onclick:p,...i,[ca]:y}),[()=>({display:AC().value?"none":void 0,cursor:a()?"pointer":void 0,transform:`translate(-50%, -50%) translate(${n()??""}px,${r()??""}px)`,"pointer-events":"all",width:$r(e.width),height:$r(e.height),"z-index":o(f)})],void 0,void 0,"svelte-1wg91mu");var h=_(v);gr(h,()=>e.children??_s),Wn(v,(y,x)=>nu==null?void 0:nu(y,x),()=>"edge-labels"),T(t,v),st()}var PC=mn("<path></path>"),MC=mn('<path fill="none"></path><!><!>',1);function ic(t,e){let n=Ee(e,"interactionWidth",3,20),r=ks(e,["$$slots","$$events","$$legacy","id","path","label","labelX","labelY","labelStyle","markerStart","markerEnd","style","interactionWidth","class"]);var a=MC(),s=Xe(a),i=b(s);{var l=v=>{var p=PC();Ba(p,()=>({d:e.path,"stroke-opacity":0,"stroke-width":n(),fill:"none",class:"svelte-flow__edge-interaction",...r})),T(v,p)};pe(i,v=>{n()>0&&v(l)})}var d=b(i);{var f=v=>{IC(v,{get x(){return e.labelX},get y(){return e.labelY},get style(){return e.labelStyle},selectEdgeOnClick:!0,children:(p,h)=>{var y=on();ie(()=>ee(y,e.label)),T(p,y)},$$slots:{default:!0}})};pe(d,v=>{e.label&&v(f)})}ie(()=>{xt(s,"id",e.id),xt(s,"d",e.path),Tt(s,0,ws(["svelte-flow__edge-path",e.class])),xt(s,"marker-start",e.markerStart),xt(s,"marker-end",e.markerEnd),Dt(s,e.style)}),T(t,a)}function rm(t,e){at(e,!0);let n=Q(()=>{var l;return Vg({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,curvature:(l=e.pathOptions)==null?void 0:l.curvature})}),r=Q(()=>so(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);ic(t,{get id(){return e.id},get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function OC(t,e){at(e,!0);let n=Q(()=>Fd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition})),r=Q(()=>so(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);ic(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function NC(t,e){at(e,!0);let n=Q(()=>Gg({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY})),r=Q(()=>so(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);ic(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function DC(t,e){at(e,!0);let n=Q(()=>Fd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,borderRadius:0})),r=Q(()=>so(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);ic(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}var ro,ao;class RC{constructor(e,n){Ie(this,ro);Ie(this,ao);St(this,ro,e),St(this,ao,Ah(n))}get current(){return F(this,ao).call(this),F(this,ro).call(this)}}ro=new WeakMap,ao=new WeakMap;const LC=/\(.+\)/,zC=new Set(["all","print","screen","and","or","not","only"]);class jC extends RC{constructor(e,n){let r=LC.test(e)||e.split(/[\s,]+/).some(s=>zC.has(s.trim()))?e:`(${e})`;const a=window.matchMedia(r);super(()=>a.matches,s=>gu(a,"change",s))}}function qC(t,e,n,r){const a=new Map;return qd(t,{x:0,y:0,width:n,height:r},e,!0).forEach(s=>{a.set(s.id,s)}),a}function Gv(t){const{edges:e,defaultEdgeOptions:n,nodeLookup:r,previousEdges:a,connectionMode:s,onerror:i,onlyRenderVisible:l,elevateEdgesOnSelect:d,zIndexMode:f}=t,v=new Map;for(const p of e){const h=r.get(p.source),y=r.get(p.target);if(!h||!y)continue;if(l){const{visibleNodes:A,transform:D,width:L,height:W}=t;if(MT({sourceNode:h,targetNode:y,width:L,height:W,transform:D}))A.set(h.id,h),A.set(y.id,y);else continue}const x=a.get(p.id);if(x&&p===x.edge&&h==x.sourceNode&&y==x.targetNode){v.set(p.id,x);continue}const S=jT({id:p.id,sourceNode:h,targetNode:y,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:s,onError:i});S&&v.set(p.id,{...n,...p,...S,zIndex:PT({selected:p.selected,zIndex:p.zIndex??n.zIndex,sourceNode:h,targetNode:y,elevateOnSelect:d,zIndexMode:f}),sourceNode:h,targetNode:y,edge:p})}return v}const am={input:xC,output:SC,default:nm,group:EC},sm={straight:NC,smoothstep:OC,default:rm,step:DC};function BC(t,e,n,r,a,s){if(e&&!n&&r&&a){const i=nc(s,{filter:l=>!!((l.width||l.initialWidth)&&(l.height||l.initialHeight))});return Bd(i,r,a,.5,2,.1)}else return n??{x:0,y:0,zoom:1}}function FC(t){var n,r,a,s,i,l,d,f,v,p,h,y,x,S,A,D,L,W,k,H,B,O,J,le,ke,j,M,z,C,N,I,$,Y,X,V,te,re,G,K,ae,Z,ne,he,_e,se,Te,be,Me,Ve,Je,ut,Fe,Oe,je,Ne,Be,Ke,$e,Ze,Ue,tt,nt,ft,mt,vt,kt,bt,pt,yt,dt,Le,Rt,Et,Vt,De,Qt;class e{constructor(){Ie(this,n,Q(()=>t.props.id??"1"));Ie(this,r,Pe(null));Ie(this,a,Pe(null));Ie(this,s,Pe(t.width??0));Ie(this,i,Pe(t.height??0));Ie(this,l,Pe(t.props.zIndexMode??"basic"));Ie(this,d,Q(()=>{var ln;const ye=VT(t.nodes,this.nodeLookup,this.parentLookup,{nodeExtent:this.nodeExtent,nodeOrigin:this.nodeOrigin,elevateNodesOnSelect:t.props.elevateNodesOnSelect??!0,checkEquality:!0,zIndexMode:this.zIndexMode});return this.fitViewQueued&&ye&&((ln=this.fitViewOptions)!=null&&ln.duration?this.resolveFitView():queueMicrotask(()=>{this.resolveFitView()})),ye}));Ie(this,f,Q(()=>this.panZoom!==null));Ie(this,v,Q(()=>(ZT(this.connectionLookup,this.edgeLookup,t.edges),t.edges)));ht(this,"_prevSelectedNodes",[]);ht(this,"_prevSelectedNodeIds",new Set);Ie(this,p,Q(()=>{const ye=this._prevSelectedNodeIds.size,ln=new Set,En=this.nodes.filter(At=>(At.selected&&(ln.add(At.id),this._prevSelectedNodeIds.delete(At.id)),At.selected));return(ye!==ln.size||this._prevSelectedNodeIds.size>0)&&(this._prevSelectedNodes=En),this._prevSelectedNodeIds=ln,this._prevSelectedNodes}));ht(this,"_prevSelectedEdges",[]);ht(this,"_prevSelectedEdgeIds",new Set);Ie(this,h,Q(()=>{const ye=this._prevSelectedEdgeIds.size,ln=new Set,En=this.edges.filter(At=>(At.selected&&(ln.add(At.id),this._prevSelectedEdgeIds.delete(At.id)),At.selected));return(ye!==ln.size||this._prevSelectedEdgeIds.size>0)&&(this._prevSelectedEdges=En),this._prevSelectedEdgeIds=ln,this._prevSelectedEdges}));ht(this,"selectionChangeHandlers",new Map);ht(this,"nodeLookup",new Map);ht(this,"parentLookup",new Map);ht(this,"connectionLookup",new Map);ht(this,"edgeLookup",new Map);ht(this,"_prevVisibleEdges",new Map);Ie(this,y,Q(()=>{const{nodes:ye,_edges:ln,_prevVisibleEdges:En,nodeLookup:At,connectionMode:Mn,onerror:it,onlyRenderVisibleElements:ct,defaultEdgeOptions:Pt,zIndexMode:$t}=this;let _t,zt;const fn={edges:ln,defaultEdgeOptions:Pt,previousEdges:En,nodeLookup:At,connectionMode:Mn,elevateEdgesOnSelect:t.props.elevateEdgesOnSelect??!0,zIndexMode:$t,onerror:it};if(ct){const{viewport:cn,width:Jt,height:en}=this,Ln=[cn.x,cn.y,cn.zoom];_t=qC(At,Ln,Jt,en),zt=Gv({...fn,onlyRenderVisible:!0,visibleNodes:_t,transform:Ln,width:Jt,height:en})}else _t=this.nodeLookup,zt=Gv(fn);return{nodes:_t,edges:zt}}));Ie(this,x,Q(()=>t.props.nodesDraggable??!0));Ie(this,S,Q(()=>t.props.nodesConnectable??!0));Ie(this,A,Q(()=>t.props.elementsSelectable??!0));Ie(this,D,Q(()=>t.props.nodesFocusable??!0));Ie(this,L,Q(()=>t.props.edgesFocusable??!0));Ie(this,W,Q(()=>t.props.disableKeyboardA11y??!1));Ie(this,k,Q(()=>t.props.minZoom??.5));Ie(this,H,Q(()=>t.props.maxZoom??2));Ie(this,B,Q(()=>t.props.nodeOrigin??[0,0]));Ie(this,O,Q(()=>t.props.nodeExtent??Ku));Ie(this,J,Q(()=>t.props.translateExtent??Ku));Ie(this,le,Q(()=>t.props.defaultEdgeOptions??{}));Ie(this,ke,Q(()=>t.props.nodeDragThreshold??1));Ie(this,j,Q(()=>t.props.autoPanOnNodeDrag??!0));Ie(this,M,Q(()=>t.props.autoPanOnConnect??!0));Ie(this,z,Q(()=>t.props.autoPanOnNodeFocus??!0));Ie(this,C,Q(()=>t.props.autoPanSpeed??15));Ie(this,N,Q(()=>t.props.connectionDragThreshold??1));ht(this,"fitViewQueued",t.props.fitView??!1);ht(this,"fitViewOptions",t.props.fitViewOptions);ht(this,"fitViewResolver",null);Ie(this,I,Q(()=>t.props.snapGrid??null));Ie(this,$,Pe(!1));Ie(this,Y,Pe(null));Ie(this,X,Pe(!1));Ie(this,V,Pe(!1));Ie(this,te,Pe(!1));Ie(this,re,Pe(!1));Ie(this,G,Pe(!1));Ie(this,K,Pe(null));Ie(this,ae,Pe(""));Ie(this,Z,Q(()=>t.props.selectionMode??Cl.Partial));Ie(this,ne,Q(()=>({...am,...t.props.nodeTypes})));Ie(this,he,Q(()=>({...sm,...t.props.edgeTypes})));Ie(this,_e,Q(()=>t.props.noPanClass??"nopan"));Ie(this,se,Q(()=>t.props.noDragClass??"nodrag"));Ie(this,Te,Q(()=>t.props.noWheelClass??"nowheel"));Ie(this,be,Q(()=>TT(t.props.ariaLabelConfig)));Ie(this,Me,Pe(BC(this.nodesInitialized,t.props.fitView,t.props.initialViewport,this.width,this.height,this.nodeLookup)));Ie(this,Ve,Pe(Hu));Ie(this,Je,Q(()=>this._connection.inProgress?{...this._connection,to:wo(this._connection.to,[this.viewport.x,this.viewport.y,this.viewport.zoom])}:this._connection));Ie(this,ut,Q(()=>t.props.connectionMode??ti.Strict));Ie(this,Fe,Q(()=>t.props.connectionRadius??20));Ie(this,Oe,Q(()=>t.props.isValidConnection??(()=>!0)));Ie(this,je,Q(()=>t.props.selectNodesOnDrag??!0));Ie(this,Ne,Q(()=>t.props.defaultMarkerColor===void 0?"#b1b1b7":t.props.defaultMarkerColor));Ie(this,Be,Q(()=>qT(t.edges,{defaultColor:this.defaultMarkerColor,id:this.flowId,defaultMarkerStart:this.defaultEdgeOptions.markerStart,defaultMarkerEnd:this.defaultEdgeOptions.markerEnd})));Ie(this,Ke,Q(()=>t.props.onlyRenderVisibleElements??!1));Ie(this,$e,Q(()=>t.props.onflowerror??xT));Ie(this,Ze,Q(()=>t.props.ondelete));Ie(this,Ue,Q(()=>t.props.onbeforedelete));Ie(this,tt,Q(()=>t.props.onbeforeconnect));Ie(this,nt,Q(()=>t.props.onconnect));Ie(this,ft,Q(()=>t.props.onconnectstart));Ie(this,mt,Q(()=>t.props.onconnectend));Ie(this,vt,Q(()=>t.props.onbeforereconnect));Ie(this,kt,Q(()=>t.props.onreconnect));Ie(this,bt,Q(()=>t.props.onreconnectstart));Ie(this,pt,Q(()=>t.props.onreconnectend));Ie(this,yt,Q(()=>t.props.clickConnect??!0));Ie(this,dt,Q(()=>t.props.onclickconnectstart));Ie(this,Le,Q(()=>t.props.onclickconnectend));Ie(this,Rt,Pe(null));Ie(this,Et,Q(()=>t.props.onselectiondrag));Ie(this,Vt,Q(()=>t.props.onselectiondragstart));Ie(this,De,Q(()=>t.props.onselectiondragstop));ht(this,"resolveFitView",async()=>{var ye;this.panZoom&&(await _T({nodes:this.nodeLookup,width:this.width,height:this.height,panZoom:this.panZoom,minZoom:this.minZoom,maxZoom:this.maxZoom},this.fitViewOptions),(ye=this.fitViewResolver)==null||ye.resolve(!0),this.fitViewQueued=!1,this.fitViewOptions=void 0,this.fitViewResolver=null)});ht(this,"_prefersDark",new jC("(prefers-color-scheme: dark)",t.props.colorModeSSR==="dark"));Ie(this,Qt,Q(()=>t.props.colorMode==="system"?this._prefersDark.current?"dark":"light":t.props.colorMode??"light"))}get flowId(){return o(F(this,n))}set flowId(ye){P(F(this,n),ye)}get domNode(){return o(F(this,r))}set domNode(ye){P(F(this,r),ye)}get panZoom(){return o(F(this,a))}set panZoom(ye){P(F(this,a),ye)}get width(){return o(F(this,s))}set width(ye){P(F(this,s),ye)}get height(){return o(F(this,i))}set height(ye){P(F(this,i),ye)}get zIndexMode(){return o(F(this,l))}set zIndexMode(ye){P(F(this,l),ye)}get nodesInitialized(){return o(F(this,d))}set nodesInitialized(ye){P(F(this,d),ye)}get viewportInitialized(){return o(F(this,f))}set viewportInitialized(ye){P(F(this,f),ye)}get _edges(){return o(F(this,v))}set _edges(ye){P(F(this,v),ye)}get nodes(){return this.nodesInitialized,t.nodes}set nodes(ye){t.nodes=ye}get edges(){return this._edges}set edges(ye){t.edges=ye}get selectedNodes(){return o(F(this,p))}set selectedNodes(ye){P(F(this,p),ye)}get selectedEdges(){return o(F(this,h))}set selectedEdges(ye){P(F(this,h),ye)}get visible(){return o(F(this,y))}set visible(ye){P(F(this,y),ye)}get nodesDraggable(){return o(F(this,x))}set nodesDraggable(ye){P(F(this,x),ye)}get nodesConnectable(){return o(F(this,S))}set nodesConnectable(ye){P(F(this,S),ye)}get elementsSelectable(){return o(F(this,A))}set elementsSelectable(ye){P(F(this,A),ye)}get nodesFocusable(){return o(F(this,D))}set nodesFocusable(ye){P(F(this,D),ye)}get edgesFocusable(){return o(F(this,L))}set edgesFocusable(ye){P(F(this,L),ye)}get disableKeyboardA11y(){return o(F(this,W))}set disableKeyboardA11y(ye){P(F(this,W),ye)}get minZoom(){return o(F(this,k))}set minZoom(ye){P(F(this,k),ye)}get maxZoom(){return o(F(this,H))}set maxZoom(ye){P(F(this,H),ye)}get nodeOrigin(){return o(F(this,B))}set nodeOrigin(ye){P(F(this,B),ye)}get nodeExtent(){return o(F(this,O))}set nodeExtent(ye){P(F(this,O),ye)}get translateExtent(){return o(F(this,J))}set translateExtent(ye){P(F(this,J),ye)}get defaultEdgeOptions(){return o(F(this,le))}set defaultEdgeOptions(ye){P(F(this,le),ye)}get nodeDragThreshold(){return o(F(this,ke))}set nodeDragThreshold(ye){P(F(this,ke),ye)}get autoPanOnNodeDrag(){return o(F(this,j))}set autoPanOnNodeDrag(ye){P(F(this,j),ye)}get autoPanOnConnect(){return o(F(this,M))}set autoPanOnConnect(ye){P(F(this,M),ye)}get autoPanOnNodeFocus(){return o(F(this,z))}set autoPanOnNodeFocus(ye){P(F(this,z),ye)}get autoPanSpeed(){return o(F(this,C))}set autoPanSpeed(ye){P(F(this,C),ye)}get connectionDragThreshold(){return o(F(this,N))}set connectionDragThreshold(ye){P(F(this,N),ye)}get snapGrid(){return o(F(this,I))}set snapGrid(ye){P(F(this,I),ye)}get dragging(){return o(F(this,$))}set dragging(ye){P(F(this,$),ye)}get selectionRect(){return o(F(this,Y))}set selectionRect(ye){P(F(this,Y),ye)}get selectionKeyPressed(){return o(F(this,X))}set selectionKeyPressed(ye){P(F(this,X),ye)}get multiselectionKeyPressed(){return o(F(this,V))}set multiselectionKeyPressed(ye){P(F(this,V),ye)}get deleteKeyPressed(){return o(F(this,te))}set deleteKeyPressed(ye){P(F(this,te),ye)}get panActivationKeyPressed(){return o(F(this,re))}set panActivationKeyPressed(ye){P(F(this,re),ye)}get zoomActivationKeyPressed(){return o(F(this,G))}set zoomActivationKeyPressed(ye){P(F(this,G),ye)}get selectionRectMode(){return o(F(this,K))}set selectionRectMode(ye){P(F(this,K),ye)}get ariaLiveMessage(){return o(F(this,ae))}set ariaLiveMessage(ye){P(F(this,ae),ye)}get selectionMode(){return o(F(this,Z))}set selectionMode(ye){P(F(this,Z),ye)}get nodeTypes(){return o(F(this,ne))}set nodeTypes(ye){P(F(this,ne),ye)}get edgeTypes(){return o(F(this,he))}set edgeTypes(ye){P(F(this,he),ye)}get noPanClass(){return o(F(this,_e))}set noPanClass(ye){P(F(this,_e),ye)}get noDragClass(){return o(F(this,se))}set noDragClass(ye){P(F(this,se),ye)}get noWheelClass(){return o(F(this,Te))}set noWheelClass(ye){P(F(this,Te),ye)}get ariaLabelConfig(){return o(F(this,be))}set ariaLabelConfig(ye){P(F(this,be),ye)}get _viewport(){return o(F(this,Me))}set _viewport(ye){P(F(this,Me),ye)}get viewport(){return t.viewport??this._viewport}set viewport(ye){t.viewport&&(t.viewport=ye),this._viewport=ye}get _connection(){return o(F(this,Ve))}set _connection(ye){P(F(this,Ve),ye)}get connection(){return o(F(this,Je))}set connection(ye){P(F(this,Je),ye)}get connectionMode(){return o(F(this,ut))}set connectionMode(ye){P(F(this,ut),ye)}get connectionRadius(){return o(F(this,Fe))}set connectionRadius(ye){P(F(this,Fe),ye)}get isValidConnection(){return o(F(this,Oe))}set isValidConnection(ye){P(F(this,Oe),ye)}get selectNodesOnDrag(){return o(F(this,je))}set selectNodesOnDrag(ye){P(F(this,je),ye)}get defaultMarkerColor(){return o(F(this,Ne))}set defaultMarkerColor(ye){P(F(this,Ne),ye)}get markers(){return o(F(this,Be))}set markers(ye){P(F(this,Be),ye)}get onlyRenderVisibleElements(){return o(F(this,Ke))}set onlyRenderVisibleElements(ye){P(F(this,Ke),ye)}get onerror(){return o(F(this,$e))}set onerror(ye){P(F(this,$e),ye)}get ondelete(){return o(F(this,Ze))}set ondelete(ye){P(F(this,Ze),ye)}get onbeforedelete(){return o(F(this,Ue))}set onbeforedelete(ye){P(F(this,Ue),ye)}get onbeforeconnect(){return o(F(this,tt))}set onbeforeconnect(ye){P(F(this,tt),ye)}get onconnect(){return o(F(this,nt))}set onconnect(ye){P(F(this,nt),ye)}get onconnectstart(){return o(F(this,ft))}set onconnectstart(ye){P(F(this,ft),ye)}get onconnectend(){return o(F(this,mt))}set onconnectend(ye){P(F(this,mt),ye)}get onbeforereconnect(){return o(F(this,vt))}set onbeforereconnect(ye){P(F(this,vt),ye)}get onreconnect(){return o(F(this,kt))}set onreconnect(ye){P(F(this,kt),ye)}get onreconnectstart(){return o(F(this,bt))}set onreconnectstart(ye){P(F(this,bt),ye)}get onreconnectend(){return o(F(this,pt))}set onreconnectend(ye){P(F(this,pt),ye)}get clickConnect(){return o(F(this,yt))}set clickConnect(ye){P(F(this,yt),ye)}get onclickconnectstart(){return o(F(this,dt))}set onclickconnectstart(ye){P(F(this,dt),ye)}get onclickconnectend(){return o(F(this,Le))}set onclickconnectend(ye){P(F(this,Le),ye)}get clickConnectStartHandle(){return o(F(this,Rt))}set clickConnectStartHandle(ye){P(F(this,Rt),ye)}get onselectiondrag(){return o(F(this,Et))}set onselectiondrag(ye){P(F(this,Et),ye)}get onselectiondragstart(){return o(F(this,Vt))}set onselectiondragstart(ye){P(F(this,Vt),ye)}get onselectiondragstop(){return o(F(this,De))}set onselectiondragstop(ye){P(F(this,De),ye)}get colorMode(){return o(F(this,Qt))}set colorMode(ye){P(F(this,Qt),ye)}resetStoreValues(){this.dragging=!1,this.selectionRect=null,this.selectionRectMode=null,this.selectionKeyPressed=!1,this.multiselectionKeyPressed=!1,this.deleteKeyPressed=!1,this.panActivationKeyPressed=!1,this.zoomActivationKeyPressed=!1,this._connection=Hu,this.clickConnectStartHandle=null,this.viewport=t.props.initialViewport??{x:0,y:0,zoom:1},this.ariaLiveMessage=""}}return n=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap,v=new WeakMap,p=new WeakMap,h=new WeakMap,y=new WeakMap,x=new WeakMap,S=new WeakMap,A=new WeakMap,D=new WeakMap,L=new WeakMap,W=new WeakMap,k=new WeakMap,H=new WeakMap,B=new WeakMap,O=new WeakMap,J=new WeakMap,le=new WeakMap,ke=new WeakMap,j=new WeakMap,M=new WeakMap,z=new WeakMap,C=new WeakMap,N=new WeakMap,I=new WeakMap,$=new WeakMap,Y=new WeakMap,X=new WeakMap,V=new WeakMap,te=new WeakMap,re=new WeakMap,G=new WeakMap,K=new WeakMap,ae=new WeakMap,Z=new WeakMap,ne=new WeakMap,he=new WeakMap,_e=new WeakMap,se=new WeakMap,Te=new WeakMap,be=new WeakMap,Me=new WeakMap,Ve=new WeakMap,Je=new WeakMap,ut=new WeakMap,Fe=new WeakMap,Oe=new WeakMap,je=new WeakMap,Ne=new WeakMap,Be=new WeakMap,Ke=new WeakMap,$e=new WeakMap,Ze=new WeakMap,Ue=new WeakMap,tt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,vt=new WeakMap,kt=new WeakMap,bt=new WeakMap,pt=new WeakMap,yt=new WeakMap,dt=new WeakMap,Le=new WeakMap,Rt=new WeakMap,Et=new WeakMap,Vt=new WeakMap,De=new WeakMap,Qt=new WeakMap,new e}function As(){const t=Qu(Gu);if(!t)throw new Error("To call useStore outside of <SvelteFlow /> you need to wrap your component in a <SvelteFlowProvider />");return t.getStore()}const Gu=Symbol();function KC(t){const e=FC(t);function n(j){e.nodeTypes={...am,...j}}function r(j){e.edgeTypes={...sm,...j}}function a(j){e.edges=DT(j,e.edges)}const s=(j,M=!1)=>{e.nodes=e.nodes.map(z=>{if(e.connection.inProgress&&e.connection.fromNode.id===z.id){const N=e.nodeLookup.get(z.id);N&&(e.connection={...e.connection,from:ys(N,e.connection.fromHandle,wt.Left,!0)})}const C=j.get(z.id);return C?{...z,position:C.position,dragging:M}:z})};function i(j){var N,I,$;const{changes:M,updatedInternals:z}=YT(j,e.nodeLookup,e.parentLookup,e.domNode,e.nodeOrigin,e.nodeExtent,e.zIndexMode);if(!z)return;KT(e.nodeLookup,e.parentLookup,{nodeOrigin:e.nodeOrigin,nodeExtent:e.nodeExtent,zIndexMode:e.zIndexMode}),e.fitViewQueued&&e.resolveFitView();const C=new Map;for(const Y of M){const X=(N=e.nodeLookup.get(Y.id))==null?void 0:N.internals.userNode;if(!X)continue;const V={...X};switch(Y.type){case"dimensions":{const te={...V.measured,...Y.dimensions};Y.setAttributes&&(V.width=((I=Y.dimensions)==null?void 0:I.width)??V.width,V.height=(($=Y.dimensions)==null?void 0:$.height)??V.height),V.measured=te;break}case"position":V.position=Y.position??V.position;break}C.set(Y.id,V)}e.nodes=e.nodes.map(Y=>C.get(Y.id)??Y)}function l(j){const M=e.fitViewResolver??Promise.withResolvers();return e.fitViewQueued=!0,e.fitViewOptions=j,e.fitViewResolver=M,e.nodes=[...e.nodes],M.promise}async function d(j,M,z){const C=typeof(z==null?void 0:z.zoom)<"u"?z.zoom:e.maxZoom,N=e.panZoom;return N?(await N.setViewport({x:e.width/2-j*C,y:e.height/2-M*C,zoom:C},{duration:z==null?void 0:z.duration,ease:z==null?void 0:z.ease,interpolate:z==null?void 0:z.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)}function f(j,M){const z=e.panZoom;return z?z.scaleBy(j,M):Promise.resolve(!1)}function v(j){return f(1.2,j)}function p(j){return f(1/1.2,j)}function h(j){const M=e.panZoom;M&&(M.setScaleExtent([j,e.maxZoom]),e.minZoom=j)}function y(j){const M=e.panZoom;M&&(M.setScaleExtent([e.minZoom,j]),e.maxZoom=j)}function x(j){const M=e.panZoom;M&&(M.setTranslateExtent(j),e.translateExtent=j)}function S(j,M=null){let z=!1;const C=j.map(N=>(M?M.has(N.id):!0)&&N.selected?(z=!0,{...N,selected:!1}):N);return[z,C]}function A(j){const M=j!=null&&j.nodes?new Set(j.nodes.map(Y=>Y.id)):null,[z,C]=S(e.nodes,M);z&&(e.nodes=C);const N=j!=null&&j.edges?new Set(j.edges.map(Y=>Y.id)):null,[I,$]=S(e.edges,N);I&&(e.edges=$)}function D(j){const M=e.multiselectionKeyPressed;e.nodes=e.nodes.map(z=>{const C=j.includes(z.id),N=M&&z.selected||C;return!!z.selected!==N?{...z,selected:N}:z}),M||A({nodes:[]})}function L(j){const M=e.multiselectionKeyPressed;e.edges=e.edges.map(z=>{const C=j.includes(z.id),N=M&&z.selected||C;return!!z.selected!==N?{...z,selected:N}:z}),M||A({edges:[]})}function W(j,M,z){const C=e.nodeLookup.get(j);if(!C){console.warn("012",Zi.error012(j));return}e.selectionRect=null,e.selectionRectMode=null,C.selected?(M||C.selected&&e.multiselectionKeyPressed)&&(A({nodes:[C],edges:[]}),requestAnimationFrame(()=>z==null?void 0:z.blur())):D([j])}function k(j){const M=e.edgeLookup.get(j);if(!M){console.warn("012",Zi.error012(j));return}(M.selectable||e.elementsSelectable&&typeof M.selectable>"u")&&(e.selectionRect=null,e.selectionRectMode=null,M.selected?M.selected&&e.multiselectionKeyPressed&&A({nodes:[],edges:[M]}):L([j]))}function H(j,M){const{nodeExtent:z,snapGrid:C,nodeOrigin:N,nodeLookup:I,nodesDraggable:$,onerror:Y}=e,X=new Map,V=(C==null?void 0:C[0])??5,te=(C==null?void 0:C[1])??5,re=j.x*V*M,G=j.y*te*M;for(const K of I.values()){if(!(K.selected&&(K.draggable||$&&typeof K.draggable>"u")))continue;let Z={x:K.internals.positionAbsolute.x+re,y:K.internals.positionAbsolute.y+G};C&&(Z=bo(Z,C));const{position:ne,positionAbsolute:he}=zg({nodeId:K.id,nextPosition:Z,nodeLookup:I,nodeExtent:z,nodeOrigin:N,onError:Y});K.position=ne,K.internals.positionAbsolute=he,X.set(K.id,K)}s(X)}function B(j){return XT({delta:j,panZoom:e.panZoom,transform:[e.viewport.x,e.viewport.y,e.viewport.zoom],translateExtent:e.translateExtent,width:e.width,height:e.height})}const O=j=>{e._connection={...j}};function J(){e._connection=Hu}function le(){e.resetStoreValues(),A()}return Object.assign(e,{setNodeTypes:n,setEdgeTypes:r,addEdge:a,updateNodePositions:s,updateNodeInternals:i,zoomIn:v,zoomOut:p,fitView:l,setCenter:d,setMinZoom:h,setMaxZoom:y,setTranslateExtent:x,unselectNodesAndEdges:A,addSelectedNodes:D,addSelectedEdges:L,handleNodeSelection:W,handleEdgeSelection:k,moveSelectedNodes:H,panBy:B,updateConnection:O,cancelConnection:J,reset:le})}function ru(t,e){const{minZoom:n,maxZoom:r,initialViewport:a,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:l,translateExtent:d,setPanZoomInstance:f,onDraggingChange:v,onTransformChange:p}=e,h=fC({domNode:t,minZoom:n,maxZoom:r,translateExtent:d,viewport:a,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:v}),y=h.getViewport();return(a.x!==y.x||a.y!==y.y||a.zoom!==y.zoom)&&p([y.x,y.y,y.zoom]),f(h),h.update(e),{update(x){h.update(x)}}}var HC=q('<div class="svelte-flow__zoom svelte-flow__container"><!></div>');function VC(t,e){at(e,!0);let n=Ee(e,"store",15),r=Q(()=>n().panActivationKeyPressed||e.panOnDrag),a=Q(()=>n().panActivationKeyPressed||e.panOnScroll);const{viewport:s}=n();let i=!1;kn(()=>{var f;!i&&n().viewportInitialized&&((f=e.oninit)==null||f.call(e),i=!0)});var l=HC(),d=_(l);gr(d,()=>e.children),Wn(l,(f,v)=>ru==null?void 0:ru(f,v),()=>({viewport:n().viewport,minZoom:n().minZoom,maxZoom:n().maxZoom,initialViewport:s,onDraggingChange:f=>{n(n().dragging=f,!0)},setPanZoomInstance:f=>{n(n().panZoom=f,!0)},onPanZoomStart:e.onmovestart,onPanZoom:e.onmove,onPanZoomEnd:e.onmoveend,zoomOnScroll:e.zoomOnScroll,zoomOnDoubleClick:e.zoomOnDoubleClick,zoomOnPinch:e.zoomOnPinch,panOnScroll:o(a),panOnDrag:o(r),panOnScrollSpeed:e.panOnScrollSpeed,panOnScrollMode:e.panOnScrollMode,zoomActivationKeyPressed:n().zoomActivationKeyPressed,preventScrolling:typeof e.preventScrolling=="boolean"?e.preventScrolling:!0,noPanClassName:n().noPanClass,noWheelClassName:n().noWheelClass,userSelectionActive:!!n().selectionRect,translateExtent:n().translateExtent,lib:"svelte",paneClickDistance:e.paneClickDistance,selectionOnDrag:e.selectionOnDrag,onTransformChange:f=>{n(n().viewport={x:f[0],y:f[1],zoom:f[2]},!0)},connectionInProgress:n().connection.inProgress})),T(t,l),st()}function Wv(t,e){return n=>{n.target===e&&(t==null||t(n))}}function Yv(t){return e=>{const n=t.has(e.id);return!!e.selected!==n?{...e,selected:n}:e}}function Xv(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}var UC=q("<div><!></div>");function GC(t,e){at(e,!0);let n=Ee(e,"store",15),r=Ee(e,"panOnDrag",3,!0),a=Ee(e,"paneClickDistance",3,1),s,i=null,l=new Set,d=new Set,f=Q(()=>n().panActivationKeyPressed||r()),v=Q(()=>n().selectionKeyPressed||!!n().selectionRect||e.selectionOnDrag&&o(f)!==!0),p=Q(()=>n().elementsSelectable&&(o(v)||n().selectionRectMode==="user")),h=!1;function y(J){var C,N;if(i=s==null?void 0:s.getBoundingClientRect(),!i)return;const le=J.target===s,ke=!le&&!!J.target.closest(".nokey"),j=e.selectionOnDrag&&le||n().selectionKeyPressed;if(ke||!o(v)||!j||J.button!==0||!J.isPrimary)return;(N=(C=J.target)==null?void 0:C.setPointerCapture)==null||N.call(C,J.pointerId),h=!1;const{x:M,y:z}=Or(J,i);n(n().selectionRect={width:0,height:0,startX:M,startY:z,x:M,y:z},!0),le||(J.stopPropagation(),J.preventDefault())}function x(J){var I;if(!o(v)||!i||!n().selectionRect)return;const le=Or(J,i),{startX:ke=0,startY:j=0}=n().selectionRect;if(!h){const $=n().selectionKeyPressed?0:a();if(Math.hypot(le.x-ke,le.y-j)<=$)return;n().unselectNodesAndEdges(),(I=e.onselectionstart)==null||I.call(e,J)}h=!0;const M={...n().selectionRect,x:le.x<ke?le.x:ke,y:le.y<j?le.y:j,width:Math.abs(le.x-ke),height:Math.abs(le.y-j)},z=l,C=d;l=new Set(qd(n().nodeLookup,M,[n().viewport.x,n().viewport.y,n().viewport.zoom],n().selectionMode===Cl.Partial,!0).map($=>$.id));const N=n().defaultEdgeOptions.selectable??!0;d=new Set;for(const $ of l){const Y=n().connectionLookup.get($);if(Y)for(const{edgeId:X}of Y.values()){const V=n().edgeLookup.get(X);V&&(V.selectable??N)&&d.add(X)}}Xv(z,l)||n(n().nodes=n().nodes.map(Yv(l)),!0),Xv(C,d)||n(n().edges=n().edges.map(Yv(d)),!0),n(n().selectionRectMode="user",!0),n(n().selectionRect=M,!0)}function S(J){var le,ke,j;J.button===0&&((ke=(le=J.target)==null?void 0:le.releasePointerCapture)==null||ke.call(le,J.pointerId),!h&&J.target===s&&(L==null||L(J)),n(n().selectionRect=null,!0),h&&n(n().selectionRectMode=l.size>0?"nodes":null,!0),h&&((j=e.onselectionend)==null||j.call(e,J)))}const A=J=>{var le;if(Array.isArray(o(f))&&o(f).includes(2)){J.preventDefault();return}(le=e.onpanecontextmenu)==null||le.call(e,{event:J})},D=J=>{h&&(J.stopPropagation(),h=!1)};function L(J){var le;if(h||n().connection.inProgress){h=!1;return}(le=e.onpaneclick)==null||le.call(e,{event:J}),n().unselectNodesAndEdges(),n(n().selectionRectMode=null,!0),n(n().selectionRect=null,!0)}var W=UC();let k;var H=Q(()=>o(p)?void 0:Wv(L,s));W.__click=function(...J){var le;(le=o(H))==null||le.apply(this,J)},W.__pointermove=function(...J){var le;(le=o(p)?x:void 0)==null||le.apply(this,J)},W.__pointerup=function(...J){var le;(le=o(p)?S:void 0)==null||le.apply(this,J)};var B=Q(()=>Wv(A,s));W.__contextmenu=function(...J){var le;(le=o(B))==null||le.apply(this,J)};var O=_(W);gr(O,()=>e.children),xs(W,J=>s=J,()=>s),ie(J=>k=Tt(W,1,"svelte-flow__pane svelte-flow__container",null,k,J),[()=>({draggable:r()===!0||Array.isArray(r())&&r().includes(0),dragging:n().dragging,selection:o(v)})]),hl("pointerdown",W,function(...J){var le;(le=o(p)?y:void 0)==null||le.apply(this,J)},!0),hl("click",W,function(...J){var le;(le=o(p)?D:void 0)==null||le.apply(this,J)},!0),T(t,W),st()}Zt(["click","pointermove","pointerup","contextmenu"]);var WC=q('<div class="svelte-flow__viewport xyflow__viewport svelte-flow__container"><!></div>');function YC(t,e){at(e,!0);var n=WC();let r;var a=_(n);gr(a,()=>e.children),ie(()=>r=Dt(n,"",r,{transform:`translate(${e.store.viewport.x??""}px, ${e.store.viewport.y??""}px) scale(${e.store.viewport.zoom??""})`})),T(t,n),st()}function qs(t,e){const{store:n,onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i}=e,l=$T({onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i,getStoreItems:()=>{const{snapGrid:f,viewport:v}=n;return{nodes:n.nodes,nodeLookup:n.nodeLookup,edges:n.edges,nodeExtent:n.nodeExtent,snapGrid:f||[0,0],snapToGrid:!!f,nodeOrigin:n.nodeOrigin,multiSelectionActive:n.multiselectionKeyPressed,domNode:n.domNode,transform:[v.x,v.y,v.zoom],autoPanOnNodeDrag:n.autoPanOnNodeDrag,nodesDraggable:n.nodesDraggable,selectNodesOnDrag:n.selectNodesOnDrag,nodeDragThreshold:n.nodeDragThreshold,unselectNodesAndEdges:n.unselectNodesAndEdges,updateNodePositions:n.updateNodePositions,onSelectionDrag:n.onselectiondrag,onSelectionDragStart:n.onselectiondragstart,onSelectionDragStop:n.onselectiondragstop,panBy:n.panBy}}});function d(f,v){if(v.disabled){l.destroy();return}l.update({domNode:f,noDragClassName:v.noDragClass,handleSelector:v.handleSelector,nodeId:v.nodeId,isSelectable:v.isSelectable,nodeClickDistance:v.nodeClickDistance})}return d(t,e),{update(f){d(t,f)},destroy(){l.destroy()}}}var XC=q('<div aria-live="assertive" aria-atomic="true" class="a11y-live-msg svelte-13pq11u"> </div>'),ZC=q('<div class="a11y-hidden svelte-13pq11u"> </div> <div class="a11y-hidden svelte-13pq11u"> </div> <!>',1);function QC(t,e){at(e,!0);var n=ZC(),r=Xe(n),a=_(r),s=b(r,2),i=_(s),l=b(s,2);{var d=f=>{var v=XC(),p=_(v);ie(()=>{xt(v,"id",`${JC}-${e.store.flowId}`),ee(p,e.store.ariaLiveMessage)}),T(f,v)};pe(l,f=>{e.store.disableKeyboardA11y||f(d)})}ie(()=>{xt(r,"id",`${im}-${e.store.flowId}`),ee(a,e.store.disableKeyboardA11y?e.store.ariaLabelConfig["node.a11yDescription.default"]:e.store.ariaLabelConfig["node.a11yDescription.keyboardDisabled"]),xt(s,"id",`${om}-${e.store.flowId}`),ee(i,e.store.ariaLabelConfig["edge.a11yDescription.default"])}),T(t,n),st()}const im="svelte-flow__node-desc",om="svelte-flow__edge-desc",JC="svelte-flow__aria-live";var $C=q("<div><!></div>");function eI(t,e){at(e,!0);let n=Ee(e,"store",15),r=Q(()=>jn(e.node.data,()=>({}),!0)),a=Q(()=>jn(e.node.selected,!1)),s=Q(()=>e.node.draggable),i=Q(()=>e.node.selectable),l=Q(()=>jn(e.node.deletable,!0)),d=Q(()=>e.node.connectable),f=Q(()=>e.node.focusable),v=Q(()=>jn(e.node.hidden,!1)),p=Q(()=>jn(e.node.dragging,!1)),h=Q(()=>jn(e.node.style,"")),y=Q(()=>e.node.class),x=Q(()=>jn(e.node.type,"default")),S=Q(()=>e.node.parentId),A=Q(()=>e.node.sourcePosition),D=Q(()=>e.node.targetPosition),L=Q(()=>jn(e.node.measured,()=>({width:0,height:0}),!0).width),W=Q(()=>jn(e.node.measured,()=>({width:0,height:0}),!0).height),k=Q(()=>e.node.initialWidth),H=Q(()=>e.node.initialHeight),B=Q(()=>e.node.width),O=Q(()=>e.node.height),J=Q(()=>e.node.dragHandle),le=Q(()=>jn(e.node.internals.z,0)),ke=Q(()=>e.node.internals.positionAbsolute.x),j=Q(()=>e.node.internals.positionAbsolute.y),M=Q(()=>e.node.internals.userNode),{id:z}=e.node,C=Q(()=>o(s)??n().nodesDraggable),N=Q(()=>o(i)??n().elementsSelectable),I=Q(()=>o(d)??n().nodesConnectable),$=Q(()=>ET(e.node)),Y=Q(()=>!!e.node.internals.handleBounds),X=Q(()=>o($)&&o(Y)),V=Q(()=>o(f)??n().nodesFocusable);function te(Oe){return n().parentLookup.has(Oe)}let re=Q(()=>te(z)),G=Pe(null),K=null,ae=o(x),Z=o(A),ne=o(D),he=Q(()=>n().nodeTypes[o(x)]??nm),_e=Q(()=>n().ariaLabelConfig),se={get value(){return o(I)}};hC(z),gC(se);let Te=Q(()=>{const Oe=o(L)===void 0?o(B)??o(k):o(B),je=o(W)===void 0?o(O)??o(H):o(O);if(!(Oe===void 0&&je===void 0&&o(h)===void 0))return`${o(h)};${Oe?`width:${$r(Oe)};`:""}${je?`height:${$r(je)};`:""}`});kn(()=>{(o(x)!==ae||o(A)!==Z||o(D)!==ne)&&o(G)!==null&&requestAnimationFrame(()=>{o(G)!==null&&n().updateNodeInternals(new Map([[z,{id:z,nodeElement:o(G),force:!0}]]))}),ae=o(x),Z=o(A),ne=o(D)}),kn(()=>{e.resizeObserver&&(!o(X)||o(G)!==K)&&(K&&e.resizeObserver.unobserve(K),o(G)&&e.resizeObserver.observe(o(G)),K=o(G))}),ud(()=>{var Oe;K&&((Oe=e.resizeObserver)==null||Oe.unobserve(K))});function be(Oe){var je;o(N)&&(!n().selectNodesOnDrag||!o(C)||n().nodeDragThreshold>0)&&n().handleNodeSelection(z),(je=e.onnodeclick)==null||je.call(e,{node:o(M),event:Oe})}function Me(Oe){if(!(Kg(Oe)||n().disableKeyboardA11y))if(Rg.includes(Oe.key)&&o(N)){const je=Oe.key==="Escape";n().handleNodeSelection(z,je,o(G))}else o(C)&&e.node.selected&&Object.prototype.hasOwnProperty.call(Nl,Oe.key)&&(Oe.preventDefault(),n(n().ariaLiveMessage=o(_e)["node.a11yDescription.ariaLiveMessage"]({direction:Oe.key.replace("Arrow","").toLowerCase(),x:~~e.node.internals.positionAbsolute.x,y:~~e.node.internals.positionAbsolute.y}),!0),n().moveSelectedNodes(Nl[Oe.key],Oe.shiftKey?4:1))}const Ve=()=>{var Ke;if(n().disableKeyboardA11y||!n().autoPanOnNodeFocus||!((Ke=o(G))!=null&&Ke.matches(":focus-visible")))return;const{width:Oe,height:je,viewport:Ne}=n();qd(new Map([[z,e.node]]),{x:0,y:0,width:Oe,height:je},[Ne.x,Ne.y,Ne.zoom],!0).length>0||n().setCenter(e.node.position.x+(e.node.measured.width??0)/2,e.node.position.y+(e.node.measured.height??0)/2,{zoom:Ne.zoom})};var Je=sn(),ut=Xe(Je);{var Fe=Oe=>{var je=$C();Ba(je,()=>({"data-id":z,class:["svelte-flow__node",`svelte-flow__node-${o(x)}`,o(y)],style:o(Te),onclick:be,onpointerenter:e.onnodepointerenter?Be=>e.onnodepointerenter({node:o(M),event:Be}):void 0,onpointerleave:e.onnodepointerleave?Be=>e.onnodepointerleave({node:o(M),event:Be}):void 0,onpointermove:e.onnodepointermove?Be=>e.onnodepointermove({node:o(M),event:Be}):void 0,oncontextmenu:e.onnodecontextmenu?Be=>e.onnodecontextmenu({node:o(M),event:Be}):void 0,onkeydown:o(V)?Me:void 0,onfocus:o(V)?Ve:void 0,tabIndex:o(V)?0:void 0,role:e.node.ariaRole??(o(V)?"group":void 0),"aria-roledescription":"node","aria-describedby":n().disableKeyboardA11y?void 0:`${im}-${n().flowId}`,...e.node.domAttributes,[Aa]:{dragging:o(p),selected:o(a),draggable:o(C),connectable:o(I),selectable:o(N),nopan:o(C),parent:o(re)},[ca]:{"z-index":o(le),transform:`translate(${o(ke)??""}px, ${o(j)??""}px)`,visibility:o($)?"visible":"hidden"}}));var Ne=_(je);cd(Ne,()=>o(he),(Be,Ke)=>{Ke(Be,{get data(){return o(r)},get id(){return z},get selected(){return o(a)},get selectable(){return o(N)},get deletable(){return o(l)},get sourcePosition(){return o(A)},get targetPosition(){return o(D)},get zIndex(){return o(le)},get dragging(){return o(p)},get draggable(){return o(C)},get dragHandle(){return o(J)},get parentId(){return o(S)},get type(){return o(x)},get isConnectable(){return o(I)},get positionAbsoluteX(){return o(ke)},get positionAbsoluteY(){return o(j)},get width(){return o(B)},get height(){return o(O)}})}),Wn(je,(Be,Ke)=>qs==null?void 0:qs(Be,Ke),()=>({nodeId:z,isSelectable:o(N),disabled:!o(C),handleSelector:o(J),noDragClass:n().noDragClass,nodeClickDistance:e.nodeClickDistance,onNodeMouseDown:n().handleNodeSelection,onDrag:(Be,Ke,$e,Ze)=>{var Ue;(Ue=e.onnodedrag)==null||Ue.call(e,{event:Be,targetNode:$e,nodes:Ze})},onDragStart:(Be,Ke,$e,Ze)=>{var Ue;(Ue=e.onnodedragstart)==null||Ue.call(e,{event:Be,targetNode:$e,nodes:Ze})},onDragStop:(Be,Ke,$e,Ze)=>{var Ue;(Ue=e.onnodedragstop)==null||Ue.call(e,{event:Be,targetNode:$e,nodes:Ze})},store:n()})),xs(je,Be=>P(G,Be),()=>o(G)),T(Oe,je)};pe(ut,Oe=>{o(v)||Oe(Fe)})}T(t,Je),st()}var tI=q('<div class="svelte-flow__nodes"></div>');function nI(t,e){at(e,!0);let n=Ee(e,"store",15);const r=typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const i=new Map;s.forEach(l=>{const d=l.target.getAttribute("data-id");i.set(d,{id:d,nodeElement:l.target,force:!0})}),n().updateNodeInternals(i)});ud(()=>{r==null||r.disconnect()});var a=tI();Nt(a,21,()=>n().visible.nodes.values(),s=>s.id,(s,i)=>{eI(s,{get node(){return o(i)},get resizeObserver(){return r},get nodeClickDistance(){return e.nodeClickDistance},get onnodeclick(){return e.onnodeclick},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get onnodecontextmenu(){return e.onnodecontextmenu},get store(){return n()},set store(l){n(l)}})}),T(t,a),st()}var rI=mn('<svg class="svelte-flow__edge-wrapper"><g><!></g></svg>');function aI(t,e){at(e,!0);let n=Q(()=>e.edge.id),r=Q(()=>e.edge.source),a=Q(()=>e.edge.target),s=Q(()=>e.edge.sourceX),i=Q(()=>e.edge.sourceY),l=Q(()=>e.edge.targetX),d=Q(()=>e.edge.targetY),f=Q(()=>e.edge.sourcePosition),v=Q(()=>e.edge.targetPosition),p=Q(()=>jn(e.edge.animated,!1)),h=Q(()=>jn(e.edge.selected,!1)),y=Q(()=>e.edge.label),x=Q(()=>e.edge.labelStyle),S=Q(()=>jn(e.edge.data,()=>({}),!0)),A=Q(()=>e.edge.style),D=Q(()=>e.edge.interactionWidth),L=Q(()=>jn(e.edge.type,"default")),W=Q(()=>e.edge.sourceHandle),k=Q(()=>e.edge.targetHandle),H=Q(()=>e.edge.markerStart),B=Q(()=>e.edge.markerEnd),O=Q(()=>e.edge.selectable),J=Q(()=>e.edge.focusable),le=Q(()=>jn(e.edge.deletable,!0)),ke=Q(()=>e.edge.hidden),j=Q(()=>e.edge.zIndex),M=Q(()=>e.edge.class),z=Q(()=>e.edge.ariaLabel);yC(o(n));let C=null,N=Q(()=>o(O)??e.store.elementsSelectable),I=Q(()=>o(J)??e.store.edgesFocusable),$=Q(()=>e.store.edgeTypes[o(L)]??rm),Y=Q(()=>o(H)?`url('#${Uu(o(H),e.store.flowId)}')`:void 0),X=Q(()=>o(B)?`url('#${Uu(o(B),e.store.flowId)}')`:void 0);function V(Z){var he;const ne=e.store.edgeLookup.get(o(n));ne&&(o(N)&&e.store.handleEdgeSelection(o(n)),(he=e.onedgeclick)==null||he.call(e,{event:Z,edge:ne}))}function te(Z,ne){const he=e.store.edgeLookup.get(o(n));he&&ne({event:Z,edge:he})}function re(Z){if(!e.store.disableKeyboardA11y&&Rg.includes(Z.key)&&o(N)){const{unselectNodesAndEdges:ne,addSelectedEdges:he}=e.store;Z.key==="Escape"?(C==null||C.blur(),ne({edges:[e.edge]})):he([o(n)])}}var G=sn(),K=Xe(G);{var ae=Z=>{var ne=rI();let he;var _e=_(ne);Ba(_e,()=>({class:["svelte-flow__edge",o(M)],"data-id":o(n),onclick:V,oncontextmenu:e.onedgecontextmenu?Te=>{te(Te,e.onedgecontextmenu)}:void 0,onpointerenter:e.onedgepointerenter?Te=>{te(Te,e.onedgepointerenter)}:void 0,onpointerleave:e.onedgepointerleave?Te=>{te(Te,e.onedgepointerleave)}:void 0,"aria-label":o(z)===null?void 0:o(z)?o(z):`Edge from ${o(r)} to ${o(a)}`,"aria-describedby":o(I)?`${om}-${e.store.flowId}`:void 0,role:e.edge.ariaRole??(o(I)?"group":"img"),"aria-roledescription":"edge",onkeydown:o(I)?re:void 0,tabindex:o(I)?0:void 0,...e.edge.domAttributes,[Aa]:{animated:o(p),selected:o(h),selectable:o(N)}}));var se=_(_e);cd(se,()=>o($),(Te,be)=>{be(Te,{get id(){return o(n)},get source(){return o(r)},get target(){return o(a)},get sourceX(){return o(s)},get sourceY(){return o(i)},get targetX(){return o(l)},get targetY(){return o(d)},get sourcePosition(){return o(f)},get targetPosition(){return o(v)},get animated(){return o(p)},get selected(){return o(h)},get label(){return o(y)},get labelStyle(){return o(x)},get data(){return o(S)},get style(){return o(A)},get interactionWidth(){return o(D)},get selectable(){return o(N)},get deletable(){return o(le)},get type(){return o(L)},get sourceHandleId(){return o(W)},get targetHandleId(){return o(k)},get markerStart(){return o(Y)},get markerEnd(){return o(X)}})}),xs(_e,Te=>C=Te,()=>C),ie(()=>he=Dt(ne,"",he,{"z-index":o(j)})),T(Z,ne)};pe(K,Z=>{o(ke)||Z(ae)})}T(t,G),st()}ly();var sI=mn("<defs></defs>");function iI(t,e){at(e,!1);const n=As();f_();var r=sI();Nt(r,5,()=>n.markers,a=>a.id,(a,s)=>{uI(a,Ds(()=>o(s)))}),T(t,r),st()}var oI=mn('<polyline class="arrow" fill="none" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4"></polyline>'),lI=mn('<polyline class="arrowclosed" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4 -5,-4"></polyline>'),cI=mn('<marker class="svelte-flow__arrowhead" viewBox="-10 -10 20 20" refX="0" refY="0"><!></marker>');function uI(t,e){at(e,!0);let n=Ee(e,"width",3,12.5),r=Ee(e,"height",3,12.5),a=Ee(e,"markerUnits",3,"strokeWidth"),s=Ee(e,"orient",3,"auto-start-reverse"),i=Ee(e,"color",3,"none");var l=cI(),d=_(l);{var f=p=>{var h=oI();let y;ie(()=>{xt(h,"stroke-width",e.strokeWidth),y=Dt(h,"",y,{stroke:i()})}),T(p,h)},v=p=>{var h=lI();let y;ie(()=>{xt(h,"stroke-width",e.strokeWidth),y=Dt(h,"",y,{stroke:i(),fill:i()})}),T(p,h)};pe(d,p=>{e.type===Il.Arrow?p(f):e.type===Il.ArrowClosed&&p(v,1)})}ie(()=>{xt(l,"id",e.id),xt(l,"markerWidth",`${n()}`),xt(l,"markerHeight",`${r()}`),xt(l,"markerUnits",a()),xt(l,"orient",s())}),T(t,l),st()}var dI=q('<div class="svelte-flow__edges"><svg class="svelte-flow__marker"><!></svg> <!></div>');function fI(t,e){at(e,!0);let n=Ee(e,"store",15);var r=dI(),a=_(r),s=_(a);iI(s,{});var i=b(a,2);Nt(i,17,()=>n().visible.edges.values(),l=>l.id,(l,d)=>{aI(l,{get edge(){return o(d)},get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return n()},set store(f){n(f)}})}),T(t,r),st()}var vI=q('<div class="svelte-flow__selection svelte-1vr3gfi"></div>');function lm(t,e){at(e,!0);let n=Ee(e,"x",3,0),r=Ee(e,"y",3,0),a=Ee(e,"width",3,0),s=Ee(e,"height",3,0),i=Ee(e,"isVisible",3,!0);var l=sn(),d=Xe(l);{var f=v=>{var p=vI();let h;ie(y=>h=Dt(p,"",h,y),[()=>({width:typeof a()=="string"?a():$r(a()),height:typeof s()=="string"?s():$r(s()),transform:`translate(${n()}px, ${r()}px)`})]),T(v,p)};pe(d,v=>{i()&&v(f)})}T(t,l),st()}var hI=q("<div><!></div>");function pI(t,e){at(e,!0);let n=Pe(void 0);kn(()=>{var p;e.store.disableKeyboardA11y||(p=o(n))==null||p.focus({preventScroll:!0})});let r=Q(()=>{if(e.store.selectionRectMode==="nodes"){e.store.nodes;const p=nc(e.store.nodeLookup,{filter:h=>!!h.selected});if(p.width>0&&p.height>0)return p}return null});function a(p){var y;const h=e.store.nodes.filter(x=>x.selected);(y=e.onselectioncontextmenu)==null||y.call(e,{nodes:h,event:p})}function s(p){var y;const h=e.store.nodes.filter(x=>x.selected);(y=e.onselectionclick)==null||y.call(e,{nodes:h,event:p})}function i(p){Object.prototype.hasOwnProperty.call(Nl,p.key)&&(p.preventDefault(),e.store.moveSelectedNodes(Nl[p.key],p.shiftKey?4:1))}var l=sn(),d=Xe(l);{var f=p=>{var h=hI();h.__contextmenu=a,h.__click=s,h.__keydown=function(...S){var A;(A=e.store.disableKeyboardA11y?void 0:i)==null||A.apply(this,S)};let y;var x=_(h);lm(x,{width:"100%",height:"100%",x:0,y:0}),Wn(h,(S,A)=>qs==null?void 0:qs(S,A),()=>({disabled:!1,store:e.store,onDrag:(S,A,D,L)=>{var W;(W=e.onnodedrag)==null||W.call(e,{event:S,targetNode:null,nodes:L})},onDragStart:(S,A,D,L)=>{var W;(W=e.onnodedragstart)==null||W.call(e,{event:S,targetNode:null,nodes:L})},onDragStop:(S,A,D,L)=>{var W;(W=e.onnodedragstop)==null||W.call(e,{event:S,targetNode:null,nodes:L})}})),xs(h,S=>P(n,S),()=>o(n)),ie(S=>{Tt(h,1,ws(["svelte-flow__selection-wrapper",e.store.noPanClass]),"svelte-sf2y5e"),xt(h,"role",e.store.disableKeyboardA11y?void 0:"button"),xt(h,"tabindex",e.store.disableKeyboardA11y?void 0:-1),y=Dt(h,"",y,S)},[()=>({width:$r(o(r).width),height:$r(o(r).height),transform:`translate(${o(r).x??""}px, ${o(r).y??""}px)`})]),T(p,h)},v=Q(()=>e.store.selectionRectMode==="nodes"&&o(r)&&ha(o(r).x)&&ha(o(r).y));pe(d,p=>{o(v)&&p(f)})}T(t,l),st()}Zt(["contextmenu","click","keydown"]);function gI(t){switch(t){case"ctrl":return 8;case"shift":return 4;case"alt":return 2;case"meta":return 1}}function Wt(t,e){let{enabled:n=!0,trigger:r,type:a="keydown"}=e;function s(l){var v;const d=Array.isArray(r)?r:[r],f=[l.metaKey,l.altKey,l.shiftKey,l.ctrlKey].reduce((p,h,y)=>h?p|1<<y:p,0);for(const p of d){const h={preventDefault:!1,enabled:!0,...p},{modifier:y,key:x,callback:S,preventDefault:A,enabled:D}=h;if(D){if(l.key!==x)continue;if(y===null||y===!1){if(f!==0)continue}else if(y!==void 0&&((v=y==null?void 0:y[0])==null?void 0:v.length)>0){const W=Array.isArray(y)?y:[y];let k=!1;for(const H of W)if((Array.isArray(H)?H:[H]).reduce((O,J)=>O|gI(J),0)===f){k=!0;break}if(!k)continue}A&&l.preventDefault();const L={node:t,trigger:h,originalEvent:l};t.dispatchEvent(new CustomEvent("shortcut",{detail:L})),S==null||S(L)}}}let i;return n&&(i=gu(t,a,s)),{update:l=>{const{enabled:d=!0,type:f="keydown"}=l;n&&(!d||a!==f)?i==null||i():!n&&d&&(i=gu(t,f,s)),n=d,a=f,r=l.trigger},destroy:()=>{i==null||i()}}}function mI(){const t=Q(As),e=s=>{var f,v;const i=Uv(s)?s:o(t).nodeLookup.get(s.id),l=i.parentId?AT(i.position,i.measured,i.parentId,o(t).nodeLookup,o(t).nodeOrigin):i.position,d={...i,position:l,width:((f=i.measured)==null?void 0:f.width)??i.width,height:((v=i.measured)==null?void 0:v.height)??i.height};return ri(d)};function n(s,i,l={replace:!1}){o(t).nodes=Jn(()=>o(t).nodes).map(d=>{if(d.id===s){const f=typeof i=="function"?i(d):i;return l!=null&&l.replace&&Uv(f)?f:{...d,...f}}return d})}function r(s,i,l={replace:!1}){o(t).edges=Jn(()=>o(t).edges).map(d=>{if(d.id===s){const f=typeof i=="function"?i(d):i;return l.replace&&TC(f)?f:{...d,...f}}return d})}const a=s=>o(t).nodeLookup.get(s);return{zoomIn:o(t).zoomIn,zoomOut:o(t).zoomOut,getInternalNode:a,getNode:s=>{var i;return(i=a(s))==null?void 0:i.internals.userNode},getNodes:s=>s===void 0?o(t).nodes:Zv(o(t).nodeLookup,s),getEdge:s=>o(t).edgeLookup.get(s),getEdges:s=>s===void 0?o(t).edges:Zv(o(t).edgeLookup,s),setZoom:(s,i)=>{const l=o(t).panZoom;return l?l.scaleTo(s,{duration:i==null?void 0:i.duration}):Promise.resolve(!1)},getZoom:()=>o(t).viewport.zoom,setViewport:async(s,i)=>{const l=o(t).viewport;return o(t).panZoom?(await o(t).panZoom.setViewport({x:s.x??l.x,y:s.y??l.y,zoom:s.zoom??l.zoom},i),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>ph(o(t).viewport),setCenter:async(s,i,l)=>o(t).setCenter(s,i,l),fitView:s=>o(t).fitView(s),fitBounds:async(s,i)=>{if(!o(t).panZoom)return Promise.resolve(!1);const l=Bd(s,o(t).width,o(t).height,o(t).minZoom,o(t).maxZoom,(i==null?void 0:i.padding)??.1);return await o(t).panZoom.setViewport(l,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)},getIntersectingNodes:(s,i=!0,l)=>{const d=Nv(s),f=d?s:e(s);return f?(l||o(t).nodes).filter(v=>{const p=o(t).nodeLookup.get(v.id);if(!p||!d&&v.id===s.id)return!1;const h=ri(p),y=Qi(h,f);return i&&y>0||y>=h.width*h.height||y>=f.width*f.height}):[]},isNodeIntersecting:(s,i,l=!0)=>{const f=Nv(s)?s:e(s);if(!f)return!1;const v=Qi(f,i);return l&&v>0||v>=i.width*i.height||v>=f.width*f.height},deleteElements:async({nodes:s=[],edges:i=[]})=>{var f,v;const{nodes:l,edges:d}=await bT({nodesToRemove:s,edgesToRemove:i,nodes:o(t).nodes,edges:o(t).edges,onBeforeDelete:o(t).onbeforedelete});return l&&(o(t).nodes=Jn(()=>o(t).nodes).filter(p=>!l.some(({id:h})=>h===p.id))),d&&(o(t).edges=Jn(()=>o(t).edges).filter(p=>!d.some(({id:h})=>h===p.id))),(l.length>0||d.length>0)&&((v=(f=o(t)).ondelete)==null||v.call(f,{nodes:l,edges:d})),{deletedNodes:l,deletedEdges:d}},screenToFlowPosition:(s,i={snapToGrid:!0})=>{if(!o(t).domNode)return s;const l=i.snapToGrid?o(t).snapGrid:!1,{x:d,y:f,zoom:v}=o(t).viewport,{x:p,y:h}=o(t).domNode.getBoundingClientRect(),y={x:s.x-p,y:s.y-h};return wo(y,[d,f,v],l!==null,l||[1,1])},flowToScreenPosition:s=>{if(!o(t).domNode)return s;const{x:i,y:l,zoom:d}=o(t).viewport,{x:f,y:v}=o(t).domNode.getBoundingClientRect(),p=Ml(s,[i,l,d]);return{x:p.x+f,y:p.y+v}},toObject:()=>structuredClone({nodes:[...o(t).nodes],edges:[...o(t).edges],viewport:{...o(t).viewport}}),updateNode:n,updateNodeData:(s,i,l)=>{var v;const d=(v=o(t).nodeLookup.get(s))==null?void 0:v.internals.userNode;if(!d)return;const f=typeof i=="function"?i(d):i;n(s,p=>({...p,data:l!=null&&l.replace?f:{...p.data,...f}}))},updateEdge:r,getNodesBounds:s=>gT(s,{nodeLookup:o(t).nodeLookup,nodeOrigin:o(t).nodeOrigin}),getHandleConnections:({type:s,id:i,nodeId:l})=>{var d;return Array.from(((d=o(t).connectionLookup.get(`${l}-${s}-${i??null}`))==null?void 0:d.values())??[])}}}function Zv(t,e){var r;const n=[];for(const a of e){const s=t.get(a);if(s){const i="internals"in s?(r=s.internals)==null?void 0:r.userNode:s;n.push(i)}}return n}function yI(t,e){at(e,!0);let n=Ee(e,"store",15),r=Ee(e,"selectionKey",3,"Shift"),a=Ee(e,"multiSelectionKey",19,()=>Ol()?"Meta":"Control"),s=Ee(e,"deleteKey",3,"Backspace"),i=Ee(e,"panActivationKey",3," "),l=Ee(e,"zoomActivationKey",19,()=>Ol()?"Meta":"Control"),{deleteElements:d}=mI();function f(S){return S!==null&&typeof S=="object"}function v(S){return f(S)?S.modifier||[]:[]}function p(S){return S==null?"":f(S)?S.key:S}function h(S,A){return(Array.isArray(S)?S:[S]).map(L=>{const W=p(L);return{key:W,modifier:v(L),enabled:W!==null,callback:A}})}function y(){n(n().selectionRect=null,!0),n(n().selectionKeyPressed=!1,!0),n(n().multiselectionKeyPressed=!1,!0),n(n().deleteKeyPressed=!1,!0),n(n().panActivationKeyPressed=!1,!0),n(n().zoomActivationKeyPressed=!1,!0)}function x(){const S=n().nodes.filter(D=>D.selected),A=n().edges.filter(D=>D.selected);d({nodes:S,edges:A})}hl("blur",Un,y),hl("contextmenu",Un,y),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!0,!0)),type:"keydown"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!1,!0)),type:"keyup"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(a(),()=>{n(n().multiselectionKeyPressed=!0,!0)}),type:"keydown"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(a(),()=>n(n().multiselectionKeyPressed=!1,!0)),type:"keyup"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(s(),S=>{!(S.originalEvent.ctrlKey||S.originalEvent.metaKey||S.originalEvent.shiftKey)&&!Kg(S.originalEvent)&&(n(n().deleteKeyPressed=!0,!0),x())}),type:"keydown"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(s(),()=>n(n().deleteKeyPressed=!1,!0)),type:"keyup"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!0,!0)),type:"keydown"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!1,!0)),type:"keyup"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!0,!0)),type:"keydown"})),Wn(Un,(S,A)=>Wt==null?void 0:Wt(S,A),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!1,!0)),type:"keyup"})),st()}var _I=mn('<path fill="none" class="svelte-flow__connection-path"></path>'),bI=mn('<svg class="svelte-flow__connectionline"><g><!></g></svg>');function wI(t,e){at(e,!0);let n=Q(()=>{if(!e.store.connection.inProgress)return"";const i={sourceX:e.store.connection.from.x,sourceY:e.store.connection.from.y,sourcePosition:e.store.connection.fromPosition,targetX:e.store.connection.to.x,targetY:e.store.connection.to.y,targetPosition:e.store.connection.toPosition};switch(e.type){case Ta.Bezier:{const[l]=Vg(i);return l}case Ta.Straight:{const[l]=Gg(i);return l}case Ta.Step:case Ta.SmoothStep:{const[l]=Fd({...i,borderRadius:e.type===Ta.Step?0:void 0});return l}}});var r=sn(),a=Xe(r);{var s=i=>{var l=bI(),d=_(l),f=_(d);{var v=h=>{var y=sn(),x=Xe(y);cd(x,()=>e.LineComponent,(S,A)=>{A(S,{})}),T(h,y)},p=h=>{var y=_I();ie(()=>{xt(y,"d",o(n)),Dt(y,e.style)}),T(h,y)};pe(f,h=>{e.LineComponent?h(v):h(p,!1)})}ie(h=>{xt(l,"width",e.store.width),xt(l,"height",e.store.height),Dt(l,e.containerStyle),Tt(d,0,h)},[()=>ws(["svelte-flow__connection",hT(e.store.connection.isValid)])]),T(i,l)};pe(a,i=>{e.store.connection.inProgress&&i(s)})}T(t,r),st()}var xI=q("<div><!></div>");function cm(t,e){at(e,!0);let n=Ee(e,"position",3,"top-right"),r=ks(e,["$$slots","$$events","$$legacy","position","style","class","children"]),a=Q(()=>`${n()}`.split("-"));var s=xI();Ba(s,l=>({class:l,style:e.style,...r}),[()=>["svelte-flow__panel",e.class,...o(a)]]);var i=_(s);gr(i,()=>e.children??_s),T(t,s),st()}var kI=q('<a href="https://svelteflow.dev" target="_blank" rel="noopener noreferrer" aria-label="Svelte Flow attribution">Svelte Flow</a>');function SI(t,e){at(e,!0);let n=Ee(e,"position",3,"bottom-right");var r=sn(),a=Xe(r);{var s=i=>{cm(i,{get position(){return n()},class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",children:(l,d)=>{var f=kI();T(l,f)},$$slots:{default:!0}})};pe(a,i=>{var l;(l=e.proOptions)!=null&&l.hideAttribution||i(s)})}T(t,r),st()}var EI=q("<div><!></div>");function AI(t,e){at(e,!0);let n=Ee(e,"domNode",15),r=Ee(e,"clientWidth",15),a=Ee(e,"clientHeight",15),s=Q(()=>e.rest.class),i=Q(()=>By(e.rest,["id","class","nodeTypes","edgeTypes","colorMode","isValidConnection","onmove","onmovestart","onmoveend","onflowerror","ondelete","onbeforedelete","onbeforeconnect","onconnect","onconnectstart","onconnectend","onbeforereconnect","onreconnect","onreconnectstart","onreconnectend","onclickconnectstart","onclickconnectend","oninit","onselectionchange","onselectiondragstart","onselectiondrag","onselectiondragstop","onselectionstart","onselectionend","clickConnect","fitView","fitViewOptions","nodeOrigin","nodeDragThreshold","connectionDragThreshold","minZoom","maxZoom","initialViewport","connectionRadius","connectionMode","selectionMode","selectNodesOnDrag","snapGrid","defaultMarkerColor","translateExtent","nodeExtent","onlyRenderVisibleElements","autoPanOnConnect","autoPanOnNodeDrag","colorModeSSR","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","elementsSelectable","nodesFocusable","edgesFocusable","disableKeyboardA11y","noDragClass","noPanClass","noWheelClass","ariaLabelConfig","autoPanSpeed","panOnScrollSpeed","zIndexMode"]));function l(v){v.currentTarget.scrollTo({top:0,left:0,behavior:"auto"}),e.rest.onscroll&&e.rest.onscroll(v)}var d=EI();Ba(d,v=>({class:["svelte-flow","svelte-flow__container",o(s),e.colorMode],"data-testid":"svelte-flow__wrapper",role:"application",onscroll:l,...o(i),[ca]:v}),[()=>({width:$r(e.width),height:$r(e.height)})],void 0,void 0,"svelte-mkap6j");var f=_(d);gr(f,()=>e.children??_s),xs(d,v=>n(v),()=>n()),Rf(d,"clientHeight",a),Rf(d,"clientWidth",r),T(t,d),st()}var TI=q('<div class="svelte-flow__viewport-back svelte-flow__container"></div> <!> <div class="svelte-flow__edge-labels svelte-flow__container"></div> <!> <!> <!> <div class="svelte-flow__viewport-front svelte-flow__container"></div>',1),CI=q("<!> <!>",1),II=q("<!> <!> <!> <!> <!>",1);function PI(t,e){at(e,!0);let n=Ee(e,"paneClickDistance",3,1),r=Ee(e,"nodeClickDistance",3,1),a=Ee(e,"panOnScrollMode",19,()=>js.Free),s=Ee(e,"preventScrolling",3,!0),i=Ee(e,"zoomOnScroll",3,!0),l=Ee(e,"zoomOnDoubleClick",3,!0),d=Ee(e,"zoomOnPinch",3,!0),f=Ee(e,"panOnScroll",3,!1),v=Ee(e,"panOnScrollSpeed",3,.5),p=Ee(e,"panOnDrag",3,!0),h=Ee(e,"selectionOnDrag",3,!1),y=Ee(e,"connectionLineType",19,()=>Ta.Bezier),x=Ee(e,"nodes",31,()=>Xt([])),S=Ee(e,"edges",31,()=>Xt([])),A=Ee(e,"viewport",15,void 0),D=ks(e,["$$slots","$$events","$$legacy","width","height","proOptions","selectionKey","deleteKey","panActivationKey","multiSelectionKey","zoomActivationKey","paneClickDistance","nodeClickDistance","onmovestart","onmoveend","onmove","oninit","onnodeclick","onnodecontextmenu","onnodedrag","onnodedragstart","onnodedragstop","onnodepointerenter","onnodepointermove","onnodepointerleave","onselectionclick","onselectioncontextmenu","onselectionstart","onselectionend","onedgeclick","onedgecontextmenu","onedgepointerenter","onedgepointerleave","onpaneclick","onpanecontextmenu","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnDrag","selectionOnDrag","connectionLineComponent","connectionLineStyle","connectionLineContainerStyle","connectionLineType","attributionPosition","children","nodes","edges","viewport"]),L=KC({props:D,width:e.width,height:e.height,get nodes(){return x()},set nodes(k){x(k)},get edges(){return S()},set edges(k){S(k)},get viewport(){return A()},set viewport(k){A(k)}});const W=Qu(Gu);W&&W.setStore&&W.setStore(L),gh(Gu,{provider:!1,getStore(){return L}}),kn(()=>{var H;const k={nodes:L.selectedNodes,edges:L.selectedEdges};(H=Jn(()=>e.onselectionchange))==null||H(k);for(const B of L.selectionChangeHandlers.values())B(k)}),ud(()=>{L.reset()}),AI(t,{get colorMode(){return L.colorMode},get width(){return e.width},get height(){return e.height},get rest(){return D},get domNode(){return L.domNode},set domNode(k){L.domNode=k},get clientWidth(){return L.width},set clientWidth(k){L.width=k},get clientHeight(){return L.height},set clientHeight(k){L.height=k},children:(k,H)=>{var B=II(),O=Xe(B);yI(O,{get selectionKey(){return e.selectionKey},get deleteKey(){return e.deleteKey},get panActivationKey(){return e.panActivationKey},get multiSelectionKey(){return e.multiSelectionKey},get zoomActivationKey(){return e.zoomActivationKey},get store(){return L},set store(M){L=M}});var J=b(O,2);VC(J,{get panOnScrollMode(){return a()},get preventScrolling(){return s()},get zoomOnScroll(){return i()},get zoomOnDoubleClick(){return l()},get zoomOnPinch(){return d()},get panOnScroll(){return f()},get panOnScrollSpeed(){return v()},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get onmovestart(){return e.onmovestart},get onmove(){return e.onmove},get onmoveend(){return e.onmoveend},get oninit(){return e.oninit},get store(){return L},set store(M){L=M},children:(M,z)=>{GC(M,{get onpaneclick(){return e.onpaneclick},get onpanecontextmenu(){return e.onpanecontextmenu},get onselectionstart(){return e.onselectionstart},get onselectionend(){return e.onselectionend},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get store(){return L},set store(C){L=C},children:(C,N)=>{var I=CI(),$=Xe(I);YC($,{get store(){return L},set store(X){L=X},children:(X,V)=>{var te=TI(),re=b(Xe(te),2);fI(re,{get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return L},set store(Z){L=Z}});var G=b(re,4);wI(G,{get type(){return y()},get LineComponent(){return e.connectionLineComponent},get containerStyle(){return e.connectionLineContainerStyle},get style(){return e.connectionLineStyle},get store(){return L},set store(Z){L=Z}});var K=b(G,2);nI(K,{get nodeClickDistance(){return r()},get onnodeclick(){return e.onnodeclick},get onnodecontextmenu(){return e.onnodecontextmenu},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return L},set store(Z){L=Z}});var ae=b(K,2);pI(ae,{get onselectionclick(){return e.onselectionclick},get onselectioncontextmenu(){return e.onselectioncontextmenu},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return L},set store(Z){L=Z}}),T(X,te)},$$slots:{default:!0}});var Y=b($,2);{let X=Q(()=>!!(L.selectionRect&&L.selectionRectMode==="user")),V=Q(()=>{var K;return(K=L.selectionRect)==null?void 0:K.width}),te=Q(()=>{var K;return(K=L.selectionRect)==null?void 0:K.height}),re=Q(()=>{var K;return(K=L.selectionRect)==null?void 0:K.x}),G=Q(()=>{var K;return(K=L.selectionRect)==null?void 0:K.y});lm(Y,{get isVisible(){return o(X)},get width(){return o(V)},get height(){return o(te)},get x(){return o(re)},get y(){return o(G)}})}T(C,I)},$$slots:{default:!0}})},$$slots:{default:!0}});var le=b(J,2);SI(le,{get proOptions(){return e.proOptions},get position(){return e.attributionPosition}});var ke=b(le,2);QC(ke,{get store(){return L}});var j=b(ke,2);gr(j,()=>e.children??_s),T(k,B)},$$slots:{default:!0}}),st()}var MI=q("<button><!></button>");function Jo(t,e){let n=ks(e,["$$slots","$$events","$$legacy","class","bgColor","bgColorHover","color","colorHover","borderColor","onclick","children"]);var r=MI();Ba(r,()=>({type:"button",onclick:e.onclick,class:["svelte-flow__controls-button",e.class],...n,[ca]:{"--xy-controls-button-background-color-props":e.bgColor,"--xy-controls-button-background-color-hover-props":e.bgColorHover,"--xy-controls-button-color-props":e.color,"--xy-controls-button-color-hover-props":e.colorHover,"--xy-controls-button-border-color-props":e.borderColor}}));var a=_(r);gr(a,()=>e.children??_s),T(t,r)}var OI=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"></path></svg>');function NI(t){var e=OI();T(t,e)}var DI=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 5"><path d="M0 0h32v4.2H0z"></path></svg>');function RI(t){var e=DI();T(t,e)}var LI=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 30"><path d="M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"></path></svg>');function zI(t){var e=LI();T(t,e)}var jI=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"></path></svg>');function qI(t){var e=jI();T(t,e)}var BI=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"></path></svg>');function FI(t){var e=BI();T(t,e)}var KI=q("<!> <!>",1),HI=q("<!> <!> <!> <!> <!> <!>",1);function VI(t,e){at(e,!0);let n=Ee(e,"position",3,"bottom-left"),r=Ee(e,"orientation",3,"vertical"),a=Ee(e,"showZoom",3,!0),s=Ee(e,"showFitView",3,!0),i=Ee(e,"showLock",3,!0),l=ks(e,["$$slots","$$events","$$legacy","position","orientation","showZoom","showFitView","showLock","style","class","buttonBgColor","buttonBgColorHover","buttonColor","buttonColorHover","buttonBorderColor","fitViewOptions","children","before","after"]),d=Q(As);const f={bgColor:e.buttonBgColor,bgColorHover:e.buttonBgColorHover,color:e.buttonColor,colorHover:e.buttonColorHover,borderColor:e.buttonBorderColor};let v=Q(()=>o(d).nodesDraggable||o(d).nodesConnectable||o(d).elementsSelectable),p=Q(()=>o(d).viewport.zoom<=o(d).minZoom),h=Q(()=>o(d).viewport.zoom>=o(d).maxZoom),y=Q(()=>o(d).ariaLabelConfig),x=Q(()=>r()==="horizontal"?"horizontal":"vertical");const S=()=>{o(d).zoomIn()},A=()=>{o(d).zoomOut()},D=()=>{o(d).fitView(e.fitViewOptions)},L=()=>{let W=!o(v);o(d).nodesDraggable=W,o(d).nodesConnectable=W,o(d).elementsSelectable=W};{let W=Q(()=>["svelte-flow__controls",o(x),e.class]);cm(t,Ds({get class(){return o(W)},get position(){return n()},"data-testid":"svelte-flow__controls",get"aria-label"(){return o(y)["controls.ariaLabel"]},get style(){return e.style}},()=>l,{children:(k,H)=>{var B=HI(),O=Xe(B);{var J=X=>{var V=sn(),te=Xe(V);gr(te,()=>e.before),T(X,V)};pe(O,X=>{e.before&&X(J)})}var le=b(O,2);{var ke=X=>{var V=KI(),te=Xe(V);Jo(te,Ds({onclick:S,class:"svelte-flow__controls-zoomin",get title(){return o(y)["controls.zoomIn.ariaLabel"]},get"aria-label"(){return o(y)["controls.zoomIn.ariaLabel"]},get disabled(){return o(h)}},()=>f,{children:(G,K)=>{NI(G)},$$slots:{default:!0}}));var re=b(te,2);Jo(re,Ds({onclick:A,class:"svelte-flow__controls-zoomout",get title(){return o(y)["controls.zoomOut.ariaLabel"]},get"aria-label"(){return o(y)["controls.zoomOut.ariaLabel"]},get disabled(){return o(p)}},()=>f,{children:(G,K)=>{RI(G)},$$slots:{default:!0}})),T(X,V)};pe(le,X=>{a()&&X(ke)})}var j=b(le,2);{var M=X=>{Jo(X,Ds({class:"svelte-flow__controls-fitview",onclick:D,get title(){return o(y)["controls.fitView.ariaLabel"]},get"aria-label"(){return o(y)["controls.fitView.ariaLabel"]}},()=>f,{children:(V,te)=>{zI(V)},$$slots:{default:!0}}))};pe(j,X=>{s()&&X(M)})}var z=b(j,2);{var C=X=>{Jo(X,Ds({class:"svelte-flow__controls-interactive",onclick:L,get title(){return o(y)["controls.interactive.ariaLabel"]},get"aria-label"(){return o(y)["controls.interactive.ariaLabel"]}},()=>f,{children:(V,te)=>{var re=sn(),G=Xe(re);{var K=Z=>{FI(Z)},ae=Z=>{qI(Z)};pe(G,Z=>{o(v)?Z(K):Z(ae,!1)})}T(V,re)},$$slots:{default:!0}}))};pe(z,X=>{i()&&X(C)})}var N=b(z,2);{var I=X=>{var V=sn(),te=Xe(V);gr(te,()=>e.children),T(X,V)};pe(N,X=>{e.children&&X(I)})}var $=b(N,2);{var Y=X=>{var V=sn(),te=Xe(V);gr(te,()=>e.after),T(X,V)};pe($,X=>{e.after&&X(Y)})}T(k,B)},$$slots:{default:!0}}))}st()}var Da;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(Da||(Da={}));var UI=mn("<circle></circle>");function GI(t,e){var n=UI();ie(()=>{xt(n,"cx",e.radius),xt(n,"cy",e.radius),xt(n,"r",e.radius),Tt(n,0,ws(["svelte-flow__background-pattern","dots",e.class]))}),T(t,n)}var WI=mn("<path></path>");function YI(t,e){at(e,!0);var n=WI();ie(()=>{xt(n,"stroke-width",e.lineWidth),xt(n,"d",`M${e.dimensions[0]/2} 0 V${e.dimensions[1]} M0 ${e.dimensions[1]/2} H${e.dimensions[0]}`),Tt(n,0,ws(["svelte-flow__background-pattern",e.variant,e.class]))}),T(t,n),st()}const XI={[Da.Dots]:1,[Da.Lines]:1,[Da.Cross]:6};var ZI=mn('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function QI(t,e){at(e,!0);let n=Ee(e,"variant",19,()=>Da.Dots),r=Ee(e,"gap",3,20),a=Ee(e,"lineWidth",3,1),s=Q(As),i=Q(()=>n()===Da.Dots),l=Q(()=>n()===Da.Cross),d=Q(()=>Array.isArray(r())?r():[r(),r()]),f=Q(()=>`background-pattern-${o(s).flowId}-${e.id??""}`),v=Q(()=>[o(d)[0]*o(s).viewport.zoom||1,o(d)[1]*o(s).viewport.zoom||1]),p=Q(()=>(e.size??XI[n()])*o(s).viewport.zoom),h=Q(()=>o(l)?[o(p),o(p)]:o(v)),y=Q(()=>o(i)?[o(p)/2,o(p)/2]:[o(h)[0]/2,o(h)[1]/2]);var x=ZI();let S;var A=_(x),D=_(A);{var L=H=>{{let B=Q(()=>o(p)/2);GI(H,{get radius(){return o(B)},get class(){return e.patternClass}})}},W=H=>{YI(H,{get dimensions(){return o(h)},get variant(){return n()},get lineWidth(){return a()},get class(){return e.patternClass}})};pe(D,H=>{o(i)?H(L):H(W,!1)})}var k=b(A);ie(()=>{Tt(x,0,ws(["svelte-flow__background","svelte-flow__container",e.class])),S=Dt(x,"",S,{"--xy-background-color-props":e.bgColor,"--xy-background-pattern-color-props":e.patternColor}),xt(A,"id",o(f)),xt(A,"x",o(s).viewport.x%o(v)[0]),xt(A,"y",o(s).viewport.y%o(v)[1]),xt(A,"width",o(v)[0]),xt(A,"height",o(v)[1]),xt(A,"patternTransform",`translate(-${o(y)[0]},-${o(y)[1]})`),xt(k,"fill",`url(#${o(f)})`)}),T(t,x),st()}var JI=q('<div class="trigger-node svelte-a1pdcu"><div class="trigger-header svelte-a1pdcu"><span class="icon">â¡</span> Trigger</div> <div class="trigger-body svelte-a1pdcu"><div class="label svelte-a1pdcu"> </div> <div class="group svelte-a1pdcu"> </div></div> <!></div>');function $I(t,e){at(e,!0);let n=Q(()=>tr[e.data.group]||tr.INFO);var r=JI();let a;var s=_(r);let i;var l=b(s,2),d=_(l),f=_(d),v=b(d,2);let p;var h=_(v),y=b(l,2);ja(y,{type:"source",get position(){return wt.Right}}),ie(()=>{a=Dt(r,"",a,{"border-color":o(n).color}),i=Dt(s,"",i,{background:o(n).color}),ee(f,`Event: ${e.data.label??""}`),p=Dt(v,"",p,{color:o(n).color}),ee(h,o(n).label)}),T(t,r),st()}var eP=q('<div class="binding svelte-1bgwygg"> </div>'),tP=q('<div class="binding unbound svelte-1bgwygg">unbound</div>'),nP=q('<div class="action-node svelte-1bgwygg"><!> <div class="action-header svelte-1bgwygg"><span class="icon svelte-1bgwygg"> </span> </div> <div class="action-body svelte-1bgwygg"><div class="desc svelte-1bgwygg"> </div> <!></div> <div class="action-footer svelte-1bgwygg"><button title="Edit" class="svelte-1bgwygg">âï¸ Edit</button> <button title="Delete" class="danger svelte-1bgwygg">ðï¸</button></div> <!></div>');function rP(t,e){at(e,!0);let n=Q(()=>e.data.cmd);var r=nP(),a=_(r);ja(a,{type:"target",get position(){return wt.Left}});var s=b(a,2),i=_(s),l=_(i),d=b(i),f=b(s,2),v=_(f),p=_(v),h=b(v,2);{var y=W=>{var k=eP(),H=_(k);ie(()=>ee(H,`${o(n).pluginId??""}Â·${o(n).commandId??""}`)),T(W,k)},x=W=>{var k=tP();T(W,k)};pe(h,W=>{o(n).pluginId&&o(n).commandId?W(y):W(x,!1)})}var S=b(f,2),A=_(S);A.__click=function(...W){var k;(k=e.data.onEdit)==null||k.apply(this,W)};var D=b(A,2);D.__click=function(...W){var k;(k=e.data.onDelete)==null||k.apply(this,W)};var L=b(S,2);ja(L,{type:"source",get position(){return wt.Right}}),ie(()=>{ee(l,o(n).icon||"âï¸"),ee(d,` ${o(n).name??""}`),xt(v,"title",o(n).description),ee(p,o(n).description)}),T(t,r),st()}Zt(["click"]);var aP=q('<button class="add-node svelte-w8wqxx" title="Add next action"><!> <div class="plus svelte-w8wqxx">+</div></button>');function sP(t,e){at(e,!0);var n=aP();n.__click=function(...a){var s;(s=e.data.onClick)==null||s.apply(this,a)};var r=_(n);ja(r,{type:"target",get position(){return wt.Left},style:"opacity: 0"}),T(t,n),st()}Zt(["click"]);var iP=q('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),oP=q('<span class="type-group-chip svelte-d25j4l"> </span>'),lP=q('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),cP=q("<button> </button>"),uP=q("<!> <!>",1),dP=q('<span class="picker-tile-added svelte-d25j4l">â added</span>'),fP=q('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),vP=q('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),hP=q('<div class="floating-panel picker-panel svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Add Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="action-picker svelte-d25j4l"><!> <div class="picker-custom-row svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">+ Create Custom Action</button> <span class="picker-hint svelte-d25j4l" style="margin-left: 0.5rem;">Link to any plugin command</span></div></div></div>'),pP=q("<option> </option>"),gP=q("<optgroup></optgroup>"),mP=q('<div class="floating-panel editor-panel-inner svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Edit Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-row svelte-d25j4l"><select class="plugin-select svelte-d25j4l"><option>-- Select Plugin Command --</option><!></select></div> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div></div>'),yP=q('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button></div> <div class="canvas-wrapper svelte-d25j4l"><!> <!> <!></div>',1),_P=q('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),bP=q('<p class="svelte-d25j4l">Select an event type on the left to view and edit its visual graph.</p>'),wP=q('<div class="no-selection svelte-d25j4l"><!></div>'),xP=q('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">n8n-like visual graph editor</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function kP(t,e){at(e,!0);const n={trigger:$I,action:rP,add:sP};let r=Ee(e,"open",15,!1),a=Pe(Xt([])),s=Pe(Xt({})),i=Pe(Xt({})),l=Pe(null),d=Pe("INFO"),f=Pe(Xt([])),v=Pe(null),p=Pe(!1),h=Pe(""),y=Pe(!1),x=Pe([]),S=Pe([]);const A=[{pluginId:"gmail",pluginName:"Gmail",actions:zp("gmail")}],D={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function L(){P(a,await eb(),!0);const V={};await Promise.all(o(a).map(async te=>{V[te]=(await Bc(te)).length})),P(s,V,!0),P(i,await nb(),!0),o(l)&&(P(f,(await Bc(o(l))).map(te=>({...te})),!0),P(d,await Vi(o(l)),!0))}kn(()=>{r()&&L()}),kn(()=>{o(l)?W():(P(x,[]),P(S,[]))});function W(){const V=[],te=[];V.push({id:"trigger",type:"trigger",position:{x:50,y:100},data:{label:o(l),group:o(d)}});let re="trigger",G=300;o(f).forEach((K,ae)=>{V.push({id:K.id,type:"action",position:{x:G,y:100},data:{cmd:K,onEdit:()=>z(K),onDelete:()=>M(K.id)}}),te.push({id:`e-${re}-${K.id}`,source:re,target:K.id,animated:!0,style:"stroke: #666; stroke-width: 2"}),re=K.id,G+=270}),V.push({id:"add-action",type:"add",position:{x:G,y:135},data:{onClick:()=>{P(y,!0),P(v,null)}}}),te.push({id:`e-${re}-add-action`,source:re,target:"add-action",style:"stroke: #444; stroke-width: 2; stroke-dasharray: 4"}),P(x,V),P(S,te)}async function k(V){P(l,V,!0),P(f,(await Bc(V)).map(te=>({...te})),!0),P(d,await Vi(V),!0),P(v,null),P(y,!1)}async function H(V){o(l)&&(await tb(o(l),V),P(d,V,!0),W())}function B(V){return V.split("_").map(te=>te.charAt(0)+te.slice(1).toLowerCase()).join(" ")}function O(V){return`hsl(${Vl(V)}, 55%, 55%)`}async function J(){const V=o(h).trim();if(!V)return;await rb(V),P(h,""),P(p,!1),await L();const te=V.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await k(te)}async function le(){o(l)&&(await sb(o(l)),P(l,null),P(f,[],!0),await L())}async function ke(V,te){await Hf(o(l),{id:V.actionId,pluginId:te,commandId:V.actionId,name:V.name,description:V.description,icon:D[V.actionId]||void 0}),P(y,!1),await L()}function j(V){return o(f).some(te=>te.id===V)}async function M(V){await lb(o(l),V),await L()}function z(V){P(y,!1),P(v,{...V,pluginCommandKey:V.pluginId&&V.commandId?`${V.pluginId}:${V.commandId}`:""},!0)}async function C(){o(v)&&(await ub(o(l),o(v).id,{name:o(v).name,description:o(v).description,icon:o(v).icon,pluginId:o(v).pluginId,commandId:o(v).commandId}),P(v,null),await L())}function N(){P(v,null)}async function I(){const V=`custom_${Date.now()}`;await Hf(o(l),{id:V,pluginId:"",commandId:"",name:"New Custom Action",description:"",icon:"â¡"}),P(y,!1),await L();const te=o(f).find(re=>re.id===V);te&&z(te)}var $=sn(),Y=Xe($);{var X=V=>{var te=xP(),re=_(te),G=_(re),K=b(_(G),4);K.__click=()=>r(!1);var ae=b(G,2),Z=_(ae),ne=_(Z),he=b(_(ne),2);he.__click=()=>P(p,!o(p));var _e=b(ne,2);{var se=ut=>{var Fe=iP(),Oe=_(Fe);Oe.__keydown=Ne=>Ne.key==="Enter"&&J();var je=b(Oe,2);je.__click=J,fa(Oe,()=>o(h),Ne=>P(h,Ne)),T(ut,Fe)};pe(_e,ut=>{o(p)&&ut(se)})}var Te=b(_e,2);Nt(Te,21,()=>o(a),Yt,(ut,Fe)=>{var Oe=lP();let je;Oe.__click=()=>k(o(Fe));var Ne=_(Oe);let Be;var Ke=b(Ne,2),$e=_(Ke),Ze=b(Ke,4);{var Ue=ft=>{const mt=Q(()=>tr[o(i)[o(Fe)]]);var vt=sn(),kt=Xe(vt);{var bt=pt=>{var yt=oP();let dt;var Le=_(yt);ie(()=>{xt(yt,"title",o(mt).description),dt=Dt(yt,"",dt,{color:o(mt).color}),ee(Le,o(mt).label)}),T(pt,yt)};pe(kt,pt=>{o(mt)&&pt(bt)})}T(ft,vt)};pe(Ze,ft=>{o(i)[o(Fe)]&&ft(Ue)})}var tt=b(Ze,2),nt=_(tt);ie((ft,mt)=>{je=Tt(Oe,1,"type-item svelte-d25j4l",null,je,{selected:o(l)===o(Fe)}),Be=Dt(Ne,"",Be,ft),ee($e,mt),ee(nt,o(s)[o(Fe)]??0)},[()=>({background:O(o(Fe))}),()=>B(o(Fe))]),T(ut,Oe)});var be=b(Z,2),Me=_(be);{var Ve=ut=>{var Fe=yP(),Oe=Xe(Fe),je=_(Oe);let Ne;var Be=_(je),Ke=b(je,2),$e=_(Ke),Ze=b(Ke,4);Nt(Ze,21,()=>Object.values(tr),Yt,(bt,pt)=>{var yt=cP();let dt;yt.__click=()=>H(o(pt).id);let Le;var Rt=_(yt);ie(()=>{dt=Tt(yt,1,"group-chip svelte-d25j4l",null,dt,{active:o(d)===o(pt).id}),xt(yt,"title",o(pt).description),Le=Dt(yt,"",Le,{"--grp-color":o(pt).color}),ee(Rt,o(pt).label)}),T(bt,yt)});var Ue=b(Ze,2);Ue.__click=le;var tt=b(Oe,2),nt=_(tt);PI(nt,{get nodes(){return o(x)},get edges(){return o(S)},get nodeTypes(){return n},fitView:!0,fitViewOptions:{padding:.2,minZoom:.8},minZoom:.5,maxZoom:1.5,colorMode:"dark",children:(bt,pt)=>{var yt=uP(),dt=Xe(yt);QI(dt,{bgColor:"#111",patternColor:"#333"});var Le=b(dt,2);VI(Le,{showInteractive:!1}),T(bt,yt)},$$slots:{default:!0}});var ft=b(nt,2);{var mt=bt=>{var pt=hP(),yt=_(pt),dt=b(_(yt),2);dt.__click=()=>P(y,!1);var Le=b(yt,2),Rt=_(Le);Nt(Rt,17,()=>A,Yt,(De,Qt)=>{var Kn=vP(),ye=_(Kn),ln=_(ye),En=_(ln),At=b(ye,2);Nt(At,21,()=>o(Qt).actions,Yt,(Mn,it)=>{const ct=Q(()=>j(o(it).actionId));var Pt=fP();let $t;Pt.__click=()=>ke(o(it),o(Qt).pluginId);var _t=_(Pt),zt=_(_t),fn=b(_t,2),cn=_(fn),Jt=b(fn,2);{var en=Ln=>{var On=dP();T(Ln,On)};pe(Jt,Ln=>{o(ct)&&Ln(en)})}ie(()=>{$t=Tt(Pt,1,"picker-tile svelte-d25j4l",null,$t,{added:o(ct)}),xt(Pt,"title",o(it).description),ee(zt,D[o(it).actionId]??"Â·"),ee(cn,o(it).name)}),T(Mn,Pt)}),ie(()=>ee(En,o(Qt).pluginName)),T(De,Kn)});var Et=b(Rt,2),Vt=_(Et);Vt.__click=I,T(bt,pt)};pe(ft,bt=>{o(y)&&bt(mt)})}var vt=b(ft,2);{var kt=bt=>{var pt=mP(),yt=_(pt),dt=b(_(yt),2);dt.__click=N;var Le=b(yt,2),Rt=_(Le),Et=_(Rt),Vt=b(Et,2),De=b(Rt,2),Qt=b(De,2),Kn=_(Qt);Kn.__change=it=>{if(it.target.value){const[ct,Pt]=it.target.value.split(":");o(v).pluginId=ct,o(v).commandId=Pt}else o(v).pluginId="",o(v).commandId=""};var ye=_(Kn);ye.value=ye.__value="";var ln=b(ye);Nt(ln,17,()=>A,Yt,(it,ct)=>{var Pt=gP();Nt(Pt,21,()=>o(ct).actions,Yt,($t,_t)=>{var zt=pP(),fn=_(zt),cn={};ie(()=>{ee(fn,`${o(_t).name??""} (${o(_t).actionId??""})`),cn!==(cn=`${o(ct).pluginId??""}:${o(_t).actionId??""}`)&&(zt.value=zt.__value=`${o(ct).pluginId??""}:${o(_t).actionId??""}`)}),T($t,zt)}),ie(()=>xt(Pt,"label",o(ct).pluginName)),T(it,Pt)});var En=b(Qt,2),At=_(En);At.__click=C;var Mn=b(At,2);Mn.__click=N,fa(Et,()=>o(v).icon,it=>o(v).icon=it),fa(Vt,()=>o(v).name,it=>o(v).name=it),fa(De,()=>o(v).description,it=>o(v).description=it),ho(Kn,()=>o(v).pluginCommandKey,it=>o(v).pluginCommandKey=it),T(bt,pt)};pe(vt,bt=>{o(v)&&bt(kt)})}ie((bt,pt)=>{Ne=Dt(je,"",Ne,bt),ee(Be,pt),ee($e,`${o(f).length??""} action${o(f).length===1?"":"s"}`)},[()=>({background:O(o(l))}),()=>B(o(l))]),T(ut,Fe)},Je=ut=>{var Fe=wP(),Oe=_(Fe);{var je=Be=>{var Ke=_P();T(Be,Ke)},Ne=Be=>{var Ke=bP();T(Be,Ke)};pe(Oe,Be=>{o(a).length===0?Be(je):Be(Ne,!1)})}T(ut,Fe)};pe(Me,ut=>{o(l)?ut(Ve):ut(Je,!1)})}T(V,te)};pe(Y,V=>{r()&&V(X)})}T(t,$),st()}Zt(["click","keydown","change"]);var SP=q('<span class="scope-chip svelte-1e15788"> </span>'),EP=q('<div class="scopes-list svelte-1e15788"></div>'),AP=q('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),TP=q('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),CP=q('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),IP=q('<div class="empty svelte-1e15788">No plugins registered.</div>'),PP=q('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function MP(t,e){at(e,!0);let n=Ee(e,"open",15,!1);const r=Q(()=>n()?li.getAllPlugins().map(h=>({id:h.pluginId,name:h.serviceName,actions:h.getHandlers().map(y=>({id:y.actionId,name:y.name,description:y.description,scopes:y.requiredScopes||[]}))})):[]),a={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},s=Q(()=>o(r).reduce((h,y)=>h+y.actions.length,0));let i=Pe(Xt(new Set));function l(h){const y=new Set(o(i));y.has(h)?y.delete(h):y.add(h),P(i,y,!0)}function d(h){return h.replace(/^https?:\/\/[^/]+\/auth\//,"")}var f=sn(),v=Xe(f);{var p=h=>{var y=PP();y.__keydown=j=>j.key==="Escape"&&n(!1);var x=_(y),S=_(x),A=_(S),D=b(_(A),2),L=b(_(D),2),W=_(L),k=b(A,2);k.__click=()=>n(!1);var H=b(S,2),B=_(H);Nt(B,17,()=>o(r),Yt,(j,M)=>{var z=CP(),C=_(z),N=_(C),I=_(N),$=_(I),Y=b(I,2),X=_(Y),V=b(N,2),te=_(V),re=b(C,2);Nt(re,21,()=>o(M).actions,Yt,(G,K)=>{const ae=Q(()=>`${o(M).id}:${o(K).id}`),Z=Q(()=>o(i).has(o(ae)));var ne=TP(),he=_(ne),_e=_(he),se=b(he,2),Te=_(se),be=_(Te),Me=_(be),Ve=b(be,2),Je=_(Ve),ut=b(Te,2),Fe=_(ut),Oe=b(ut,2);{var je=Ne=>{var Be=AP(),Ke=_(Be);Ke.__click=()=>l(o(ae));var $e=_(Ke);{var Ze=mt=>{var vt=on("â¾");T(mt,vt)},Ue=mt=>{var vt=on("â¸");T(mt,vt)};pe($e,mt=>{o(Z)?mt(Ze):mt(Ue,!1)})}var tt=b($e),nt=b(Ke,2);{var ft=mt=>{var vt=EP();Nt(vt,21,()=>o(K).scopes,Yt,(kt,bt)=>{var pt=SP(),yt=_(pt);ie(dt=>{xt(pt,"title",o(bt)),ee(yt,dt)},[()=>d(o(bt))]),T(kt,pt)}),T(mt,vt)};pe(nt,mt=>{o(Z)&&mt(ft)})}ie(()=>ee(tt,` ${o(K).scopes.length??""} scope${o(K).scopes.length===1?"":"s"}`)),T(Ne,Be)};pe(Oe,Ne=>{o(K).scopes.length&&Ne(je)})}ie(()=>{xt(he,"title",o(K).id),ee(_e,a[o(K).id]??"Â·"),ee(Me,o(K).name),ee(Je,o(K).id),ee(Fe,o(K).description)}),T(G,ne)}),ie(()=>{ee($,o(M).name),ee(X,o(M).id),ee(te,`${o(M).actions.length??""} action${o(M).actions.length===1?"":"s"}`)}),T(j,z)});var O=b(B,2);{var J=j=>{var M=IP();T(j,M)};pe(O,j=>{o(r).length===0&&j(J)})}var le=b(H,2),ke=b(_(le),2);ke.__click=()=>n(!1),ie(()=>ee(W,`${o(r).length??""} plugin${o(r).length===1?"":"s"} Â· ${o(s)??""} actions available`)),T(h,y)};pe(v,h=>{n()&&h(p)})}T(t,f),st()}Zt(["keydown","click"]);var OP=q('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),NP=q('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),DP=q('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),RP=q('<button class="chip svelte-s2dwjj"> </button>'),LP=q('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),zP=q('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),jP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),qP=q('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),BP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),FP=q('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),KP=q('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),HP=q('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),VP=q('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),UP=q('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),GP=q('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),WP=q('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function YP(t,e){at(e,!0);let n=Ee(e,"groupOrder",19,()=>[]),r=Pe(!1),a=Pe(null),s=Pe(!1),i=Pe(null);async function l(){var j;const[O,J,le]=await Promise.all([lt.items.where("sourceType").equals("gmail").count(),lt.emailClassifications.count(),lt.contacts.count()]);let ke=0;try{const M=await((j=navigator.storage)==null?void 0:j.estimate());ke=(M==null?void 0:M.usage)??0}catch{}P(i,{emailCount:O,classCount:J,contactCount:le,totalBytes:ke},!0)}function d(O){return O?O<1024?`${O} B`:O<1024*1024?`${(O/1024).toFixed(1)} KB`:`${(O/(1024*1024)).toFixed(1)} MB`:"â"}function f(){P(r,!o(r)),o(r)&&l()}async function v(O){var J;P(s,!0),P(a,null);try{await O(),await l(),(J=e.onrefresh)==null||J.call(e)}finally{P(s,!1)}}async function p(){await v(()=>Vf())}async function h(O){await v(()=>_d(O))}async function y(){await v(async()=>{await Bp(),await Vf()})}async function x(){await v(()=>lt.contacts.clear())}async function S(){await v(async()=>{await lt.delete(),window.location.reload()})}function A(O){return O.split("_").map(J=>J.charAt(0)+J.slice(1).toLowerCase()).join(" ")}var D=WP(),L=_(D);L.__click=f;var W=b(_(L),2);let k;var H=b(L,2);{var B=O=>{var J=GP(),le=_(J);{var ke=se=>{var Te=NP(),be=_(Te),Me=_(be),Ve=b(be,4),Je=_(Ve),ut=b(Ve,4),Fe=_(ut),Oe=b(ut,2);{var je=Ne=>{var Be=OP(),Ke=b(Xe(Be),2),$e=_(Ke);ie(Ze=>ee($e,`${Ze??""} used`),[()=>d(o(i).totalBytes)]),T(Ne,Be)};pe(Oe,Ne=>{o(i).totalBytes&&Ne(je)})}ie(()=>{ee(Me,`${o(i).emailCount??""} emails`),ee(Je,`${o(i).classCount??""} classifications`),ee(Fe,`${o(i).contactCount??""} contacts`)}),T(se,Te)};pe(le,se=>{o(i)&&se(ke)})}var j=b(le,2);{var M=se=>{var Te=LP(),be=b(_(Te),2);Nt(be,21,n,Yt,(Me,Ve)=>{var Je=sn(),ut=Xe(Je);{var Fe=je=>{var Ne=DP(),Be=_(Ne),Ke=b(Be);Ke.__click=()=>P(a,null);var $e=b(Ke,2);$e.__click=()=>h(o(Ve)),ie(Ze=>{ee(Be,`Delete ${Ze??""}? `),$e.disabled=o(s)},[()=>A(o(Ve))]),T(je,Ne)},Oe=je=>{var Ne=RP();Ne.__click=()=>P(a,`group:${o(Ve)}`);var Be=_(Ne);ie(Ke=>{Ne.disabled=o(s),ee(Be,`${Ke??""} â`)},[()=>A(o(Ve))]),T(je,Ne)};pe(ut,je=>{o(a)===`group:${o(Ve)}`?je(Fe):je(Oe,!1)})}T(Me,Je)}),T(se,Te)};pe(j,se=>{n().length>0&&se(M)})}var z=b(j,2),C=b(_(z),2),N=_(C);{var I=se=>{var Te=zP(),be=b(_(Te),2);be.__click=()=>P(a,null);var Me=b(be,2);Me.__click=p,ie(()=>Me.disabled=o(s)),T(se,Te)},$=se=>{var Te=jP();Te.__click=()=>P(a,"classifications"),ie(()=>Te.disabled=o(s)),T(se,Te)};pe(N,se=>{o(a)==="classifications"?se(I):se($,!1)})}var Y=b(N,2);{var X=se=>{var Te=qP(),be=b(_(Te),2);be.__click=()=>P(a,null);var Me=b(be,2);Me.__click=y,ie(()=>Me.disabled=o(s)),T(se,Te)},V=se=>{var Te=BP();Te.__click=()=>P(a,"emails"),ie(()=>Te.disabled=o(s)),T(se,Te)};pe(Y,se=>{o(a)==="emails"?se(X):se(V,!1)})}var te=b(Y,2);{var re=se=>{var Te=FP(),be=b(_(Te),2);be.__click=()=>P(a,null);var Me=b(be,2);Me.__click=x,ie(()=>Me.disabled=o(s)),T(se,Te)},G=se=>{var Te=KP();Te.__click=()=>P(a,"contacts"),ie(()=>Te.disabled=o(s)),T(se,Te)};pe(te,se=>{o(a)==="contacts"?se(re):se(G,!1)})}var K=b(z,2),ae=_(K);{var Z=se=>{var Te=HP(),be=b(_(Te),2);be.__click=()=>P(a,null);var Me=b(be,2);Me.__click=S,ie(()=>Me.disabled=o(s)),T(se,Te)},ne=se=>{var Te=VP();Te.__click=()=>P(a,"nuke"),ie(()=>Te.disabled=o(s)),T(se,Te)};pe(ae,se=>{o(a)==="nuke"?se(Z):se(ne,!1)})}var he=b(K,2);{var _e=se=>{var Te=UP();T(se,Te)};pe(he,se=>{o(s)&&se(_e)})}T(O,J)};pe(H,O=>{o(r)&&O(B)})}ie(()=>k=Tt(W,0,"chev svelte-s2dwjj",null,k,{open:o(r)})),T(t,D),st()}Zt(["click"]);var XP=q('<div class="error-card svelte-aym646"><span> </span> <button class="error-dismiss svelte-aym646">â</button></div>'),ZP=q('<div class="success-card svelte-aym646"><span> </span> <button class="success-dismiss svelte-aym646">â</button></div>'),QP=q('<div class="groups-list svelte-aym646"></div> <div class="actions-footer svelte-aym646"><span class="footer-stat svelte-aym646"> </span></div>',1),JP=q('<div class="empty-state svelte-aym646"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-aym646">No emails classified yet</h3> <p class="svelte-aym646">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),$P=q('<div class="actions-container svelte-aym646"><!> <!> <!> <!> <div class="toolbar svelte-aym646"><button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!> <!></div>');function e3(t,e){at(e,!0);let n=Ee(e,"groups",19,()=>({})),r=Ee(e,"groupOrder",19,()=>[]),a=Ee(e,"counts",19,()=>({})),s=Ee(e,"stats",3,null),i=Ee(e,"expandedGroup",3,null),l=Ee(e,"isScanning",3,!1),d=Ee(e,"scanProgress",3,null),f=Ee(e,"scanCount",15,20),v=Ee(e,"error",3,null),p=Ee(e,"successMsg",3,null),h=Pe(!1),y=Pe(!1),x=Pe(!1),S=Q(()=>{for(const I of r()){const $=n()[I];if(($==null?void 0:$.length)>0)return $[0]}return null});var A=$P(),D=_(A);i2(D,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return l()},get scanProgress(){return d()},get stats(){return s()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>P(h,!0),get scanCount(){return f()},set scanCount(I){f(I)}});var L=b(D,2);P2(L,{get sampleEmail(){return o(S)},get open(){return o(h)},set open(I){P(h,I,!0)}});var W=b(L,2);kP(W,{get open(){return o(y)},set open(I){P(y,I,!0)}});var k=b(W,2);MP(k,{get open(){return o(x)},set open(I){P(x,I,!0)}});var H=b(k,2),B=_(H);B.__click=()=>P(x,!0);var O=b(B,2);O.__click=()=>P(y,!0);var J=b(H,2);{var le=I=>{var $=XP(),Y=_($),X=_(Y),V=b(Y,2);V.__click=function(...te){var re;(re=e.ondismisserror)==null||re.apply(this,te)},ie(()=>ee(X,v())),T(I,$)};pe(J,I=>{v()&&I(le)})}var ke=b(J,2);{var j=I=>{var $=ZP(),Y=_($),X=_(Y),V=b(Y,2);V.__click=function(...te){var re;(re=e.ondismisssuccess)==null||re.apply(this,te)},ie(()=>ee(X,p())),T(I,$)};pe(ke,I=>{p()&&I(j)})}var M=b(ke,2);{var z=I=>{var $=QP(),Y=Xe($);Nt(Y,20,r,re=>re,(re,G)=>{{let K=Q(()=>Su(G)),ae=Q(()=>{var he;return((he=n()[G])==null?void 0:he.length)||0}),Z=Q(()=>n()[G]||[]),ne=Q(()=>i()===G);E2(re,{get action(){return G},get color(){return o(K)},get count(){return o(ae)},get items(){return o(Z)},get expanded(){return o(ne)},ontoggle:()=>e.ontogglegroup(G),onexecute:he=>e.onexecute(G,he),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(G)})}});var X=b(Y,2),V=_(X),te=_(V);ie(()=>ee(te,`${a().total??""} emails classified into ${r().length??""} groups`)),T(I,$)},C=I=>{var $=JP();T(I,$)};pe(M,I=>{a().total>0?I(z):l()||I(C,1)})}var N=b(M,2);YP(N,{get groupOrder(){return r()},get onrefresh(){return e.onrefresh}}),T(t,A),st()}Zt(["click"]);var t3=q('<div class="control-board-page svelte-v2lwbo"><!></div>');function n3(t,e){at(e,!0);const n=vp();let r=Pe(Xt(n.status)),a=Pe(""),s=Pe(Xt({})),i=Pe(Xt([])),l=Pe(Xt({total:0})),d=Pe(null),f=Pe(null),v=Pe(!1),p=Pe(null),h=Pe(3),y=Pe(null),x=Pe(null),S=Pe(null);const A="me-ai-scan-history";async function D(){return await Ki(A)}async function L(I){!I||I.phase!=="done"||await Hi(A,{timestamp:Date.now(),classified:I.classified||0,errors:I.errors||0,total:I.total||0,totals:I.totals||{},summary:I.summary||{}})}Sn(async()=>{const I=n.onMessage(Y=>{if(Y.status==="ready"){P(r,"ready");const X=Xr.find(re=>re.id===n.modelId),V=Zr.find(re=>re.name===n.modelId),te=X||V;P(a,(te==null?void 0:te.name)||(te==null?void 0:te.displayName)||n.modelId||"",!0)}Y.status==="loading"&&P(r,"loading")});if(P(r,n.status,!0),n.modelId){const Y=Xr.find(te=>te.id===n.modelId),X=Zr.find(te=>te.name===n.modelId),V=Y||X;P(a,(V==null?void 0:V.name)||(V==null?void 0:V.displayName)||n.modelId||"",!0)}const $=await D();return $&&P(p,{phase:"done",...$},!0),W(),()=>I()});async function W(){try{const I=await Mp();P(s,I.groups,!0),P(i,I.order,!0),P(l,await xb(),!0),P(d,await ku(),!0)}catch(I){P(y,`Failed to load data: ${I.message}`)}}async function k(){await B(!1)}async function H(){await B(!0)}async function B(I){if(o(v)||!n.isReady)return;P(y,null),P(x,null),P(v,!0),P(p,null);const $=new AbortController;P(S,$,!0);try{await Pp(n,{count:o(h),force:I,signal:$.signal,onProgress:Y=>{P(p,{...Y},!0),Y.phase==="done"&&L(Y)}}),await W()}catch(Y){$.signal.aborted||P(y,`Scan failed: ${Y.message}`)}finally{P(v,!1),P(S,null)}}function O(){var I;(I=o(S))==null||I.abort()}async function J(I){await ml(I,"acted"),await W()}async function le(I,$){const{executePipeline:Y,isAuthenticated:X}=await er(async()=>{const{executePipeline:V,isAuthenticated:te}=await Promise.resolve().then(()=>R0);return{executePipeline:V,isAuthenticated:te}},void 0);if(!await X()){alert("Please sign in to Gmail first (Dashboard page)");return}try{const te=await Y({type:I,source:"gmail",data:$},re=>{console.log("Pipeline progress:",re)},!0);te.success?(P(x,te.message,!0),P(y,null),await J($.emailId)):(P(y,`Execution failed: ${te.message}`),P(x,null))}catch(V){P(y,`Execution error: ${V.message}`),P(x,null)}}async function ke(I){await ml(I,"dismissed"),await W()}async function j(I){await Op(I),await W()}async function M(I){await _d(I),await W()}function z(I){P(f,o(f)===I?null:I,!0)}var C=t3(),N=_(C);e3(N,{get engineStatus(){return o(r)},get modelName(){return o(a)},get groups(){return o(s)},get groupOrder(){return o(i)},get counts(){return o(l)},get stats(){return o(d)},get expandedGroup(){return o(f)},get isScanning(){return o(v)},get scanProgress(){return o(p)},get error(){return o(y)},get successMsg(){return o(x)},onscan:k,onrescan:H,ontogglegroup:z,onexecute:le,onmarkacted:J,ondismiss:ke,onremove:j,oncleargroup:M,ondismisserror:()=>P(y,null),ondismisssuccess:()=>P(x,null),onstop:O,onrefresh:W,oncloseprogress:async()=>{P(p,null),await fd(A)},get scanCount(){return o(h)},set scanCount(I){P(h,I,!0)}}),T(t,C),st()}var r3=q('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#control">Control Board</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function a3(t,e){at(e,!0);function n(){const O=location.hash;return O==="#dashboard"?"dashboard":O==="#control"?"control":"chat"}let r=Pe(Xt(n()));Sn(()=>{function O(){P(r,n(),!0)}return window.addEventListener("hashchange",O),()=>window.removeEventListener("hashchange",O)});var a=r3(),s=_(a),i=b(_(s),2),l=_(i);let d;var f=b(l,2);let v;var p=b(f,2);let h;var y=b(s,2),x=_(y);let S;var A=_(x);$w(A,{});var D=b(x,2);let L;var W=_(D);n3(W,{});var k=b(D,2);let H;var B=_(k);Pk(B,{}),ie(()=>{d=Tt(l,1,"svelte-1n46o8q",null,d,{active:o(r)==="chat"}),v=Tt(f,1,"svelte-1n46o8q",null,v,{active:o(r)==="control"}),h=Tt(p,1,"svelte-1n46o8q",null,h,{active:o(r)==="dashboard"}),S=Dt(x,"",S,{display:o(r)==="chat"?"flex":"none"}),L=Dt(D,"",L,{display:o(r)==="control"?"flex":"none"}),H=Dt(k,"",H,{display:o(r)==="dashboard"?"flex":"none"})}),T(t,a),st()}Zy(a3,{target:document.getElementById("app")});
