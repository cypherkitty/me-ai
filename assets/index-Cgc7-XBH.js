var af=Object.defineProperty;var rc=t=>{throw TypeError(t)};var sf=(t,e,n)=>e in t?af(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ct=(t,e,n)=>sf(t,typeof e!="symbol"?e+"":e,n),co=(t,e,n)=>e.has(t)||rc("Cannot "+n);var ge=(t,e,n)=>(co(t,e,"read from private field"),n?n.call(t):e.get(t)),ut=(t,e,n)=>e.has(t)?rc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ot=(t,e,n,a)=>(co(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),pn=(t,e,n)=>(co(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const To=!1;var Zo=Array.isArray,of=Array.prototype.indexOf,Ha=Array.prototype.includes,Ci=Array.from,lf=Object.defineProperty,qa=Object.getOwnPropertyDescriptor,cf=Object.getOwnPropertyDescriptors,uf=Object.prototype,df=Array.prototype,Jc=Object.getPrototypeOf,ac=Object.isExtensible;const ff=()=>{};function vf(t){for(var e=0;e<t.length;e++)t[e]()}function $c(){var t,e,n=new Promise((a,s)=>{t=a,e=s});return{promise:n,resolve:t,reject:e}}const un=2,As=4,Ii=8,eu=1<<24,Nr=16,ur=32,Ia=64,tu=128,Vn=512,en=1024,dn=2048,cr=4096,Ln=8192,Dr=16384,Ls=32768,Va=65536,sc=1<<17,nu=1<<18,Ja=1<<19,pf=1<<20,Mr=1<<25,xa=65536,Ao=1<<21,Jo=1<<22,Vr=1<<23,ba=Symbol("$state"),hf=Symbol("legacy props"),mf=Symbol(""),da=new class extends Error{constructor(){super(...arguments);ct(this,"name","StaleReactionError");ct(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function gf(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function _f(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function yf(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function bf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function wf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function kf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function xf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Sf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ef(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Tf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Af(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Cf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const If=1,Rf=2,ru=4,Of=8,Pf=16,Mf=1,Df=4,jf=8,Lf=16,au=1,Nf=2,sn=Symbol(),su="http://www.w3.org/1999/xhtml";function qf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Bf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function iu(t){return t===this.v}function Ff(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function ou(t){return!Ff(t,this.v)}let zf=!1,Nn=null;function Ya(t){Nn=t}function St(t,e=!1,n){Nn={p:Nn,i:!1,c:null,e:null,s:t,x:null,l:null}}function Et(t){var e=Nn,n=e.e;if(n!==null){e.e=null;for(var a of n)Iu(a)}return t!==void 0&&(e.x=t),e.i=!0,Nn=e.p,t??{}}function lu(){return!0}let fa=[];function cu(){var t=fa;fa=[],vf(t)}function Yr(t){if(fa.length===0&&!ks){var e=fa;queueMicrotask(()=>{e===fa&&cu()})}fa.push(t)}function Uf(){for(;fa.length>0;)cu()}function uu(t){var e=Tt;if(e===null)return ft.f|=Vr,t;if((e.f&Ls)===0&&(e.f&As)===0)throw t;Qa(t,e)}function Qa(t,e){for(;e!==null;){if((e.f&tu)!==0){if((e.f&Ls)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Kf=-7169;function Yt(t,e){t.f=t.f&Kf|e}function $o(t){(t.f&Vn)!==0||t.deps===null?Yt(t,en):Yt(t,cr)}function du(t){if(t!==null)for(const e of t)(e.f&un)===0||(e.f&xa)===0||(e.f^=xa,du(e.deps))}function fu(t,e,n){(t.f&dn)!==0?e.add(t):(t.f&cr)!==0&&n.add(t),du(t.deps),Yt(t,en)}const ii=new Set;let st=null,bi=null,on=null,En=[],Ri=null,Co=!1,ks=!1;var Ba,Fa,pa,za,Ps,Ms,ha,Ir,Ua,Sr,Io,Ro,vu;const Il=class Il{constructor(){ut(this,Sr);ct(this,"committed",!1);ct(this,"current",new Map);ct(this,"previous",new Map);ut(this,Ba,new Set);ut(this,Fa,new Set);ut(this,pa,0);ut(this,za,0);ut(this,Ps,null);ut(this,Ms,new Set);ut(this,ha,new Set);ut(this,Ir,new Map);ct(this,"is_fork",!1);ut(this,Ua,!1)}is_deferred(){return this.is_fork||ge(this,za)>0}skip_effect(e){ge(this,Ir).has(e)||ge(this,Ir).set(e,{d:[],m:[]})}unskip_effect(e){var n=ge(this,Ir).get(e);if(n){ge(this,Ir).delete(e);for(var a of n.d)Yt(a,dn),or(a);for(a of n.m)Yt(a,cr),or(a)}}process(e){var s;En=[],this.apply();var n=[],a=[];for(const o of e)pn(this,Sr,Io).call(this,o,n,a);if(this.is_deferred()){pn(this,Sr,Ro).call(this,a),pn(this,Sr,Ro).call(this,n);for(const[o,u]of ge(this,Ir))gu(o,u)}else{for(const o of ge(this,Ba))o();ge(this,Ba).clear(),ge(this,pa)===0&&pn(this,Sr,vu).call(this),bi=this,st=null,ic(a),ic(n),bi=null,(s=ge(this,Ps))==null||s.resolve()}on=null}capture(e,n){n!==sn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Vr)===0&&(this.current.set(e,e.v),on==null||on.set(e,e.v))}activate(){st=this,this.apply()}deactivate(){st===this&&(st=null,on=null)}flush(){if(this.activate(),En.length>0){if(pu(),st!==null&&st!==this)return}else ge(this,pa)===0&&this.process([]);this.deactivate()}discard(){for(const e of ge(this,Fa))e(this);ge(this,Fa).clear()}increment(e){ot(this,pa,ge(this,pa)+1),e&&ot(this,za,ge(this,za)+1)}decrement(e){ot(this,pa,ge(this,pa)-1),e&&ot(this,za,ge(this,za)-1),!ge(this,Ua)&&(ot(this,Ua,!0),Yr(()=>{ot(this,Ua,!1),this.is_deferred()?En.length>0&&this.flush():this.revive()}))}revive(){for(const e of ge(this,Ms))ge(this,ha).delete(e),Yt(e,dn),or(e);for(const e of ge(this,ha))Yt(e,cr),or(e);this.flush()}oncommit(e){ge(this,Ba).add(e)}ondiscard(e){ge(this,Fa).add(e)}settled(){return(ge(this,Ps)??ot(this,Ps,$c())).promise}static ensure(){if(st===null){const e=st=new Il;ii.add(st),ks||Yr(()=>{st===e&&e.flush()})}return st}apply(){}};Ba=new WeakMap,Fa=new WeakMap,pa=new WeakMap,za=new WeakMap,Ps=new WeakMap,Ms=new WeakMap,ha=new WeakMap,Ir=new WeakMap,Ua=new WeakMap,Sr=new WeakSet,Io=function(e,n,a){e.f^=en;for(var s=e.first,o=null;s!==null;){var u=s.f,f=(u&(ur|Ia))!==0,h=f&&(u&en)!==0,m=h||(u&Ln)!==0||ge(this,Ir).has(s);if(!m&&s.fn!==null){f?s.f^=en:o!==null&&(u&(As|Ii|eu))!==0?o.b.defer_effect(s):(u&As)!==0?n.push(s):qs(s)&&((u&Nr)!==0&&ge(this,ha).add(s),Za(s));var y=s.first;if(y!==null){s=y;continue}}var x=s.parent;for(s=s.next;s===null&&x!==null;)x===o&&(o=null),s=x.next,x=x.parent}},Ro=function(e){for(var n=0;n<e.length;n+=1)fu(e[n],ge(this,Ms),ge(this,ha))},vu=function(){var s;if(ii.size>1){this.previous.clear();var e=on,n=!0;for(const o of ii){if(o===this){n=!1;continue}const u=[];for(const[h,m]of this.current){if(o.current.has(h))if(n&&m!==o.current.get(h))o.current.set(h,m);else continue;u.push(h)}if(u.length===0)continue;const f=[...o.current.keys()].filter(h=>!this.current.has(h));if(f.length>0){var a=En;En=[];const h=new Set,m=new Map;for(const y of u)hu(y,f,h,m);if(En.length>0){st=o,o.apply();for(const y of En)pn(s=o,Sr,Io).call(s,y,[],[]);o.deactivate()}En=a}}st=null,on=e}this.committed=!0,ii.delete(this)};let Qr=Il;function Gf(t){var e=ks;ks=!0;try{for(var n;;){if(Uf(),En.length===0&&(st==null||st.flush(),En.length===0))return Ri=null,n;pu()}}finally{ks=e}}function pu(){Co=!0;var t=null;try{for(var e=0;En.length>0;){var n=Qr.ensure();if(e++>1e3){var a,s;Wf()}n.process(En),Xr.clear()}}finally{En=[],Co=!1,Ri=null}}function Wf(){try{xf()}catch(t){Qa(t,Ri)}}let nr=null;function ic(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Dr|Ln))===0&&qs(a)&&(nr=new Set,Za(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&Mu(a),(nr==null?void 0:nr.size)>0)){Xr.clear();for(const s of nr){if((s.f&(Dr|Ln))!==0)continue;const o=[s];let u=s.parent;for(;u!==null;)nr.has(u)&&(nr.delete(u),o.push(u)),u=u.parent;for(let f=o.length-1;f>=0;f--){const h=o[f];(h.f&(Dr|Ln))===0&&Za(h)}}nr.clear()}}nr=null}}function hu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&un)!==0?hu(s,e,n,a):(o&(Jo|Nr))!==0&&(o&dn)===0&&mu(s,e,a)&&(Yt(s,dn),or(s))}}function mu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const s of t.deps){if(Ha.call(e,s))return!0;if((s.f&un)!==0&&mu(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function or(t){for(var e=Ri=t;e.parent!==null;){e=e.parent;var n=e.f;if(Co&&e===Tt&&(n&Nr)!==0&&(n&nu)===0)return;if((n&(Ia|ur))!==0){if((n&en)===0)return;e.f^=en}}En.push(e)}function gu(t,e){if(!((t.f&ur)!==0&&(t.f&en)!==0)){(t.f&dn)!==0?e.d.push(t):(t.f&cr)!==0&&e.m.push(t),Yt(t,en);for(var n=t.first;n!==null;)gu(n,e),n=n.next}}function Hf(t){let e=0,n=Sa(0),a;return()=>{nl()&&(c(n),rl(()=>(e===0&&(a=Bs(()=>t(()=>xs(n)))),e+=1,()=>{Yr(()=>{e-=1,e===0&&(a==null||a(),a=void 0,xs(n))})})))}}var Vf=Va|Ja|tu;function Yf(t,e,n){new Qf(t,e,n)}var Kn,Xo,gr,ma,_r,Gn,xn,yr,Rr,Wr,ga,Hr,Ka,_a,Ga,Wa,Or,Ti,tn,Xf,Zf,Oo,pi,hi,Po;class Qf{constructor(e,n,a){ut(this,tn);ct(this,"parent");ct(this,"is_pending",!1);ut(this,Kn);ut(this,Xo,null);ut(this,gr);ut(this,ma);ut(this,_r);ut(this,Gn,null);ut(this,xn,null);ut(this,yr,null);ut(this,Rr,null);ut(this,Wr,null);ut(this,ga,0);ut(this,Hr,0);ut(this,Ka,!1);ut(this,_a,!1);ut(this,Ga,new Set);ut(this,Wa,new Set);ut(this,Or,null);ut(this,Ti,Hf(()=>(ot(this,Or,Sa(ge(this,ga))),()=>{ot(this,Or,null)})));ot(this,Kn,e),ot(this,gr,n),ot(this,ma,a),this.parent=Tt.b,this.is_pending=!!ge(this,gr).pending,ot(this,_r,al(()=>{Tt.b=this;{var s=pn(this,tn,Oo).call(this);try{ot(this,Gn,Wn(()=>a(s)))}catch(o){this.error(o)}ge(this,Hr)>0?pn(this,tn,hi).call(this):this.is_pending=!1}return()=>{var o;(o=ge(this,Wr))==null||o.remove()}},Vf))}defer_effect(e){fu(e,ge(this,Ga),ge(this,Wa))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!ge(this,gr).pending}update_pending_count(e){pn(this,tn,Po).call(this,e),ot(this,ga,ge(this,ga)+e),!(!ge(this,Or)||ge(this,Ka))&&(ot(this,Ka,!0),Yr(()=>{ot(this,Ka,!1),ge(this,Or)&&Xa(ge(this,Or),ge(this,ga))}))}get_effect_pending(){return ge(this,Ti).call(this),c(ge(this,Or))}error(e){var n=ge(this,gr).onerror;let a=ge(this,gr).failed;if(ge(this,_a)||!n&&!a)throw e;ge(this,Gn)&&(An(ge(this,Gn)),ot(this,Gn,null)),ge(this,xn)&&(An(ge(this,xn)),ot(this,xn,null)),ge(this,yr)&&(An(ge(this,yr)),ot(this,yr,null));var s=!1,o=!1;const u=()=>{if(s){Bf();return}s=!0,o&&Cf(),Qr.ensure(),ot(this,ga,0),ge(this,yr)!==null&&wa(ge(this,yr),()=>{ot(this,yr,null)}),this.is_pending=this.has_pending_snippet(),ot(this,Gn,pn(this,tn,pi).call(this,()=>(ot(this,_a,!1),Wn(()=>ge(this,ma).call(this,ge(this,Kn)))))),ge(this,Hr)>0?pn(this,tn,hi).call(this):this.is_pending=!1};Yr(()=>{try{o=!0,n==null||n(e,u),o=!1}catch(f){Qa(f,ge(this,_r)&&ge(this,_r).parent)}a&&ot(this,yr,pn(this,tn,pi).call(this,()=>{Qr.ensure(),ot(this,_a,!0);try{return Wn(()=>{a(ge(this,Kn),()=>e,()=>u)})}catch(f){return Qa(f,ge(this,_r).parent),null}finally{ot(this,_a,!1)}}))})}}Kn=new WeakMap,Xo=new WeakMap,gr=new WeakMap,ma=new WeakMap,_r=new WeakMap,Gn=new WeakMap,xn=new WeakMap,yr=new WeakMap,Rr=new WeakMap,Wr=new WeakMap,ga=new WeakMap,Hr=new WeakMap,Ka=new WeakMap,_a=new WeakMap,Ga=new WeakMap,Wa=new WeakMap,Or=new WeakMap,Ti=new WeakMap,tn=new WeakSet,Xf=function(){try{ot(this,Gn,Wn(()=>ge(this,ma).call(this,ge(this,Kn))))}catch(e){this.error(e)}},Zf=function(){const e=ge(this,gr).pending;e&&(ot(this,xn,Wn(()=>e(ge(this,Kn)))),Yr(()=>{var n=pn(this,tn,Oo).call(this);ot(this,Gn,pn(this,tn,pi).call(this,()=>(Qr.ensure(),Wn(()=>ge(this,ma).call(this,n))))),ge(this,Hr)>0?pn(this,tn,hi).call(this):(wa(ge(this,xn),()=>{ot(this,xn,null)}),this.is_pending=!1)}))},Oo=function(){var e=ge(this,Kn);return this.is_pending&&(ot(this,Wr,jr()),ge(this,Kn).before(ge(this,Wr)),e=ge(this,Wr)),e},pi=function(e){var n=Tt,a=ft,s=Nn;xr(ge(this,_r)),Qn(ge(this,_r)),Ya(ge(this,_r).ctx);try{return e()}catch(o){return uu(o),null}finally{xr(n),Qn(a),Ya(s)}},hi=function(){const e=ge(this,gr).pending;ge(this,Gn)!==null&&(ot(this,Rr,document.createDocumentFragment()),ge(this,Rr).append(ge(this,Wr)),Lu(ge(this,Gn),ge(this,Rr))),ge(this,xn)===null&&ot(this,xn,Wn(()=>e(ge(this,Kn))))},Po=function(e){var n;if(!this.has_pending_snippet()){this.parent&&pn(n=this.parent,tn,Po).call(n,e);return}if(ot(this,Hr,ge(this,Hr)+e),ge(this,Hr)===0){this.is_pending=!1;for(const a of ge(this,Ga))Yt(a,dn),or(a);for(const a of ge(this,Wa))Yt(a,cr),or(a);ge(this,Ga).clear(),ge(this,Wa).clear(),ge(this,xn)&&wa(ge(this,xn),()=>{ot(this,xn,null)}),ge(this,Rr)&&(ge(this,Kn).before(ge(this,Rr)),ot(this,Rr,null))}};function Jf(t,e,n,a){const s=Oi;var o=t.filter(b=>!b.settled);if(n.length===0&&o.length===0){a(e.map(s));return}var u=st,f=Tt,h=$f(),m=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(b=>b.promise)):null;function y(b){h();try{a(b)}catch(k){(f.f&Dr)===0&&Qa(k,f)}u==null||u.deactivate(),Mo()}if(n.length===0){m.then(()=>y(e.map(s)));return}function x(){h(),Promise.all(n.map(b=>ev(b))).then(b=>y([...e.map(s),...b])).catch(b=>Qa(b,f))}m?m.then(x):x()}function $f(){var t=Tt,e=ft,n=Nn,a=st;return function(o=!0){xr(t),Qn(e),Ya(n),o&&(a==null||a.activate())}}function Mo(){xr(null),Qn(null),Ya(null)}function Oi(t){var e=un|dn,n=ft!==null&&(ft.f&un)!==0?ft:null;return Tt!==null&&(Tt.f|=Ja),{ctx:Nn,deps:null,effects:null,equals:iu,f:e,fn:t,reactions:null,rv:0,v:sn,wv:0,parent:n??Tt,ac:null}}function ev(t,e,n){let a=Tt;a===null&&_f();var s=a.b,o=void 0,u=Sa(sn),f=!ft,h=new Map;return pv(()=>{var k;var m=$c();o=m.promise;try{Promise.resolve(t()).then(m.resolve,m.reject).then(()=>{y===st&&y.committed&&y.deactivate(),Mo()})}catch(I){m.reject(I),Mo()}var y=st;if(f){var x=s.is_rendered();s.update_pending_count(1),y.increment(x),(k=h.get(y))==null||k.reject(da),h.delete(y),h.set(y,m)}const b=(I,L=void 0)=>{if(y.activate(),L)L!==da&&(u.f|=Vr,Xa(u,L));else{(u.f&Vr)!==0&&(u.f^=Vr),Xa(u,I);for(const[z,ie]of h){if(h.delete(z),z===y)break;ie.reject(da)}}f&&(s.update_pending_count(-1),y.decrement(x))};m.promise.then(b,I=>b(null,I||"unknown"))}),Cu(()=>{for(const m of h.values())m.reject(da)}),new Promise(m=>{function y(x){function b(){x===o?m(u):y(o)}x.then(b,b)}y(o)})}function dt(t){const e=Oi(t);return Nu(e),e}function _u(t){const e=Oi(t);return e.equals=ou,e}function tv(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)An(e[n])}}function nv(t){for(var e=t.parent;e!==null;){if((e.f&un)===0)return(e.f&Dr)===0?e:null;e=e.parent}return null}function el(t){var e,n=Tt;xr(nv(t));try{t.f&=~xa,tv(t),e=zu(t)}finally{xr(n)}return e}function yu(t){var e=el(t);if(!t.equals(e)&&(t.wv=Bu(),(!(st!=null&&st.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Yt(t,en);return}Zr||(on!==null?(nl()||st!=null&&st.is_fork)&&on.set(t,e):$o(t))}function rv(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(da),a.teardown=ff,a.ac=null,Cs(a,0),sl(a))}function bu(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Za(e)}let Do=new Set;const Xr=new Map;let wu=!1;function Sa(t,e){var n={f:0,v:t,reactions:null,equals:iu,rv:0,wv:0};return n}function Re(t,e){const n=Sa(t);return Nu(n),n}function av(t,e=!1,n=!0){const a=Sa(t);return e||(a.equals=ou),a}function A(t,e,n=!1){ft!==null&&(!lr||(ft.f&sc)!==0)&&lu()&&(ft.f&(un|Nr|Jo|sc))!==0&&(Yn===null||!Ha.call(Yn,t))&&Af();let a=n?Pt(e):e;return Xa(t,a)}function Xa(t,e){if(!t.equals(e)){var n=t.v;Zr?Xr.set(t,e):Xr.set(t,n),t.v=e;var a=Qr.ensure();if(a.capture(t,n),(t.f&un)!==0){const s=t;(t.f&dn)!==0&&el(s),$o(s)}t.wv=Bu(),ku(t,dn),Tt!==null&&(Tt.f&en)!==0&&(Tt.f&(ur|Ia))===0&&(Un===null?mv([t]):Un.push(t)),!a.is_fork&&Do.size>0&&!wu&&sv()}return e}function sv(){wu=!1;for(const t of Do)(t.f&en)!==0&&Yt(t,cr),qs(t)&&Za(t);Do.clear()}function xs(t){A(t,t.v+1)}function ku(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,s=0;s<a;s++){var o=n[s],u=o.f,f=(u&dn)===0;if(f&&Yt(o,e),(u&un)!==0){var h=o;on==null||on.delete(h),(u&xa)===0&&(u&Vn&&(o.f|=xa),ku(h,cr))}else f&&((u&Nr)!==0&&nr!==null&&nr.add(o),or(o))}}function Pt(t){if(typeof t!="object"||t===null||ba in t)return t;const e=Jc(t);if(e!==uf&&e!==df)return t;var n=new Map,a=Zo(t),s=Re(0),o=ka,u=f=>{if(ka===o)return f();var h=ft,m=ka;Qn(null),dc(o);var y=f();return Qn(h),dc(m),y};return a&&n.set("length",Re(t.length)),new Proxy(t,{defineProperty(f,h,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ef();var y=n.get(h);return y===void 0?u(()=>{var x=Re(m.value);return n.set(h,x),x}):A(y,m.value,!0),!0},deleteProperty(f,h){var m=n.get(h);if(m===void 0){if(h in f){const y=u(()=>Re(sn));n.set(h,y),xs(s)}}else A(m,sn),xs(s);return!0},get(f,h,m){var k;if(h===ba)return t;var y=n.get(h),x=h in f;if(y===void 0&&(!x||(k=qa(f,h))!=null&&k.writable)&&(y=u(()=>{var I=Pt(x?f[h]:sn),L=Re(I);return L}),n.set(h,y)),y!==void 0){var b=c(y);return b===sn?void 0:b}return Reflect.get(f,h,m)},getOwnPropertyDescriptor(f,h){var m=Reflect.getOwnPropertyDescriptor(f,h);if(m&&"value"in m){var y=n.get(h);y&&(m.value=c(y))}else if(m===void 0){var x=n.get(h),b=x==null?void 0:x.v;if(x!==void 0&&b!==sn)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return m},has(f,h){var b;if(h===ba)return!0;var m=n.get(h),y=m!==void 0&&m.v!==sn||Reflect.has(f,h);if(m!==void 0||Tt!==null&&(!y||(b=qa(f,h))!=null&&b.writable)){m===void 0&&(m=u(()=>{var k=y?Pt(f[h]):sn,I=Re(k);return I}),n.set(h,m));var x=c(m);if(x===sn)return!1}return y},set(f,h,m,y){var ne;var x=n.get(h),b=h in f;if(a&&h==="length")for(var k=m;k<x.v;k+=1){var I=n.get(k+"");I!==void 0?A(I,sn):k in f&&(I=u(()=>Re(sn)),n.set(k+"",I))}if(x===void 0)(!b||(ne=qa(f,h))!=null&&ne.writable)&&(x=u(()=>Re(void 0)),A(x,Pt(m)),n.set(h,x));else{b=x.v!==sn;var L=u(()=>Pt(m));A(x,L)}var z=Reflect.getOwnPropertyDescriptor(f,h);if(z!=null&&z.set&&z.set.call(y,m),!b){if(a&&typeof h=="string"){var ie=n.get("length"),ce=Number(h);Number.isInteger(ce)&&ce>=ie.v&&A(ie,ce+1)}xs(s)}return!0},ownKeys(f){c(s);var h=Reflect.ownKeys(f).filter(x=>{var b=n.get(x);return b===void 0||b.v!==sn});for(var[m,y]of n)y.v!==sn&&!(m in f)&&h.push(m);return h},setPrototypeOf(){Tf()}})}function oc(t){try{if(t!==null&&typeof t=="object"&&ba in t)return t[ba]}catch{}return t}function iv(t,e){return Object.is(oc(t),oc(e))}var lc,xu,Su,Eu;function ov(){if(lc===void 0){lc=window,xu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Su=qa(e,"firstChild").get,Eu=qa(e,"nextSibling").get,ac(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ac(n)&&(n.__t=void 0)}}function jr(t=""){return document.createTextNode(t)}function jn(t){return Su.call(t)}function Ns(t){return Eu.call(t)}function p(t,e){return jn(t)}function $e(t,e=!1){{var n=jn(t);return n instanceof Comment&&n.data===""?Ns(n):n}}function g(t,e=1,n=!1){let a=t;for(;e--;)a=Ns(a);return a}function lv(t){t.textContent=""}function Tu(){return!1}function cv(t,e,n){return document.createElementNS(su,t,void 0)}let cc=!1;function uv(){cc||(cc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function tl(t){var e=ft,n=Tt;Qn(null),xr(null);try{return t()}finally{Qn(e),xr(n)}}function Au(t,e,n,a=n){t.addEventListener(e,()=>tl(n));const s=t.__on_r;s?t.__on_r=()=>{s(),a(!0)}:t.__on_r=()=>a(!0),uv()}function dv(t){Tt===null&&(ft===null&&kf(),wf()),Zr&&bf()}function fv(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function qr(t,e,n){var a=Tt;a!==null&&(a.f&Ln)!==0&&(t|=Ln);var s={ctx:Nn,deps:null,nodes:null,f:t|dn|Vn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Za(s)}catch(f){throw An(s),f}else e!==null&&or(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&Ja)===0&&(o=o.first,(t&Nr)!==0&&(t&Va)!==0&&o!==null&&(o.f|=Va)),o!==null&&(o.parent=a,a!==null&&fv(o,a),ft!==null&&(ft.f&un)!==0&&(t&Ia)===0)){var u=ft;(u.effects??(u.effects=[])).push(o)}return s}function nl(){return ft!==null&&!lr}function Cu(t){const e=qr(Ii,null,!1);return Yt(e,en),e.teardown=t,e}function Ea(t){dv();var e=Tt.f,n=!ft&&(e&ur)!==0&&(e&Ls)===0;if(n){var a=Nn;(a.e??(a.e=[])).push(t)}else return Iu(t)}function Iu(t){return qr(As|pf,t,!1)}function vv(t){Qr.ensure();const e=qr(Ia|Ja,t,!0);return(n={})=>new Promise(a=>{n.outro?wa(e,()=>{An(e),a(void 0)}):(An(e),a(void 0))})}function Ru(t){return qr(As,t,!1)}function pv(t){return qr(Jo|Ja,t,!0)}function rl(t,e=0){return qr(Ii|e,t,!0)}function Q(t,e=[],n=[],a=[]){Jf(a,e,n,s=>{qr(Ii,()=>t(...s.map(c)),!0)})}function al(t,e=0){var n=qr(Nr|e,t,!0);return n}function Wn(t){return qr(ur|Ja,t,!0)}function Ou(t){var e=t.teardown;if(e!==null){const n=Zr,a=ft;uc(!0),Qn(null);try{e.call(null)}finally{uc(n),Qn(a)}}}function sl(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&tl(()=>{s.abort(da)});var a=n.next;(n.f&Ia)!==0?n.parent=null:An(n,e),n=a}}function hv(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&ur)===0&&An(e),e=n}}function An(t,e=!0){var n=!1;(e||(t.f&nu)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Pu(t.nodes.start,t.nodes.end),n=!0),sl(t,e&&!n),Cs(t,0),Yt(t,Dr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();Ou(t);var s=t.parent;s!==null&&s.first!==null&&Mu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Pu(t,e){for(;t!==null;){var n=t===e?null:Ns(t);t.remove(),t=n}}function Mu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function wa(t,e,n=!0){var a=[];Du(t,a,!0);var s=()=>{n&&An(t),e&&e()},o=a.length;if(o>0){var u=()=>--o||s();for(var f of a)f.out(u)}else s()}function Du(t,e,n){if((t.f&Ln)===0){t.f^=Ln;var a=t.nodes&&t.nodes.t;if(a!==null)for(const f of a)(f.is_global||n)&&e.push(f);for(var s=t.first;s!==null;){var o=s.next,u=(s.f&Va)!==0||(s.f&ur)!==0&&(t.f&Nr)!==0;Du(s,e,u?n:!1),s=o}}}function il(t){ju(t,!0)}function ju(t,e){if((t.f&Ln)!==0){t.f^=Ln,(t.f&en)===0&&(Yt(t,dn),or(t));for(var n=t.first;n!==null;){var a=n.next,s=(n.f&Va)!==0||(n.f&ur)!==0;ju(n,s?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const u of o)(u.is_global||e)&&u.in()}}function Lu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var s=n===a?null:Ns(n);e.append(n),n=s}}let mi=!1,Zr=!1;function uc(t){Zr=t}let ft=null,lr=!1;function Qn(t){ft=t}let Tt=null;function xr(t){Tt=t}let Yn=null;function Nu(t){ft!==null&&(Yn===null?Yn=[t]:Yn.push(t))}let Tn=null,Mn=0,Un=null;function mv(t){Un=t}let qu=1,va=0,ka=va;function dc(t){ka=t}function Bu(){return++qu}function qs(t){var e=t.f;if((e&dn)!==0)return!0;if(e&un&&(t.f&=~xa),(e&cr)!==0){for(var n=t.deps,a=n.length,s=0;s<a;s++){var o=n[s];if(qs(o)&&yu(o),o.wv>t.wv)return!0}(e&Vn)!==0&&on===null&&Yt(t,en)}return!1}function Fu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(Yn!==null&&Ha.call(Yn,t)))for(var s=0;s<a.length;s++){var o=a[s];(o.f&un)!==0?Fu(o,e,!1):e===o&&(n?Yt(o,dn):(o.f&en)!==0&&Yt(o,cr),or(o))}}function zu(t){var L;var e=Tn,n=Mn,a=Un,s=ft,o=Yn,u=Nn,f=lr,h=ka,m=t.f;Tn=null,Mn=0,Un=null,ft=(m&(ur|Ia))===0?t:null,Yn=null,Ya(t.ctx),lr=!1,ka=++va,t.ac!==null&&(tl(()=>{t.ac.abort(da)}),t.ac=null);try{t.f|=Ao;var y=t.fn,x=y();t.f|=Ls;var b=t.deps,k=st==null?void 0:st.is_fork;if(Tn!==null){var I;if(k||Cs(t,Mn),b!==null&&Mn>0)for(b.length=Mn+Tn.length,I=0;I<Tn.length;I++)b[Mn+I]=Tn[I];else t.deps=b=Tn;if(nl()&&(t.f&Vn)!==0)for(I=Mn;I<b.length;I++)((L=b[I]).reactions??(L.reactions=[])).push(t)}else!k&&b!==null&&Mn<b.length&&(Cs(t,Mn),b.length=Mn);if(lu()&&Un!==null&&!lr&&b!==null&&(t.f&(un|cr|dn))===0)for(I=0;I<Un.length;I++)Fu(Un[I],t);if(s!==null&&s!==t){if(va++,s.deps!==null)for(let z=0;z<n;z+=1)s.deps[z].rv=va;if(e!==null)for(const z of e)z.rv=va;Un!==null&&(a===null?a=Un:a.push(...Un))}return(t.f&Vr)!==0&&(t.f^=Vr),x}catch(z){return uu(z)}finally{t.f^=Ao,Tn=e,Mn=n,Un=a,ft=s,Yn=o,Ya(u),lr=f,ka=h}}function gv(t,e){let n=e.reactions;if(n!==null){var a=of.call(n,t);if(a!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[a]=n[s],n.pop())}}if(n===null&&(e.f&un)!==0&&(Tn===null||!Ha.call(Tn,e))){var o=e;(o.f&Vn)!==0&&(o.f^=Vn,o.f&=~xa),$o(o),rv(o),Cs(o,0)}}function Cs(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)gv(t,n[a])}function Za(t){var e=t.f;if((e&Dr)===0){Yt(t,en);var n=Tt,a=mi;Tt=t,mi=!0;try{(e&(Nr|eu))!==0?hv(t):sl(t),Ou(t);var s=zu(t);t.teardown=typeof s=="function"?s:null,t.wv=qu;var o;To&&zf&&(t.f&dn)!==0&&t.deps}finally{mi=a,Tt=n}}}async function Uu(){await Promise.resolve(),Gf()}function c(t){var e=t.f,n=(e&un)!==0;if(ft!==null&&!lr){var a=Tt!==null&&(Tt.f&Dr)!==0;if(!a&&(Yn===null||!Ha.call(Yn,t))){var s=ft.deps;if((ft.f&Ao)!==0)t.rv<va&&(t.rv=va,Tn===null&&s!==null&&s[Mn]===t?Mn++:Tn===null?Tn=[t]:Tn.push(t));else{(ft.deps??(ft.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[ft]:Ha.call(o,ft)||o.push(ft)}}}if(Zr&&Xr.has(t))return Xr.get(t);if(n){var u=t;if(Zr){var f=u.v;return((u.f&en)===0&&u.reactions!==null||Gu(u))&&(f=el(u)),Xr.set(u,f),f}var h=(u.f&Vn)===0&&!lr&&ft!==null&&(mi||(ft.f&Vn)!==0),m=(u.f&Ls)===0;qs(u)&&(h&&(u.f|=Vn),yu(u)),h&&!m&&(bu(u),Ku(u))}if(on!=null&&on.has(t))return on.get(t);if((t.f&Vr)!==0)throw t.v;return t.v}function Ku(t){if(t.f|=Vn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&un)!==0&&(e.f&Vn)===0&&(bu(e),Ku(e))}function Gu(t){if(t.v===sn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Xr.has(e)||(e.f&un)!==0&&Gu(e))return!0;return!1}function Bs(t){var e=lr;try{return lr=!0,t()}finally{lr=e}}const _v=["touchstart","touchmove"];function yv(t){return _v.includes(t)}const Wu=new Set,jo=new Set;function Bt(t){for(var e=0;e<t.length;e++)Wu.add(t[e]);for(var n of jo)n(t)}let fc=null;function vc(t){var z;var e=this,n=e.ownerDocument,a=t.type,s=((z=t.composedPath)==null?void 0:z.call(t))||[],o=s[0]||t.target;fc=t;var u=0,f=fc===t&&t.__root;if(f){var h=s.indexOf(f);if(h!==-1&&(e===document||e===window)){t.__root=e;return}var m=s.indexOf(e);if(m===-1)return;h<=m&&(u=h)}if(o=s[u]||t.target,o!==e){lf(t,"currentTarget",{configurable:!0,get(){return o||n}});var y=ft,x=Tt;Qn(null),xr(null);try{for(var b,k=[];o!==null;){var I=o.assignedSlot||o.parentNode||o.host||null;try{var L=o["__"+a];L!=null&&(!o.disabled||t.target===o)&&L.call(o,t)}catch(ie){b?k.push(ie):b=ie}if(t.cancelBubble||I===e||I===null)break;o=I}if(b){for(let ie of k)queueMicrotask(()=>{throw ie});throw b}}finally{t.__root=e,delete t.currentTarget,Qn(y),xr(x)}}}var Qc,Xc;const uo=(Xc=(Qc=globalThis==null?void 0:globalThis.window)==null?void 0:Qc.trustedTypes)==null?void 0:Xc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function bv(t){return(uo==null?void 0:uo.createHTML(t))??t}function ol(t,e=!1){var n=cv("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?bv(t):t,n.content}function Ta(t,e){var n=Tt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function C(t,e){var n=(e&au)!==0,a=(e&Nf)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=ol(o?t:"<!>"+t,!0),n||(s=jn(s)));var u=a||xu?document.importNode(s,!0):s.cloneNode(!0);if(n){var f=jn(u),h=u.lastChild;Ta(f,h)}else Ta(u,u);return u}}function wv(t,e,n="svg"){var a=!t.startsWith("<!>"),s=(e&au)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,u;return()=>{if(!u){var f=ol(o,!0),h=jn(f);if(s)for(u=document.createDocumentFragment();jn(h);)u.appendChild(jn(h));else u=jn(h)}var m=u.cloneNode(!0);if(s){var y=jn(m),x=m.lastChild;Ta(y,x)}else Ta(m,m);return m}}function ll(t,e){return wv(t,e,"svg")}function gn(t=""){{var e=jr(t+"");return Ta(e,e),e}}function Xn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=jr();return t.append(e,n),Ta(e,n),t}function E(t,e){t!==null&&t.before(e)}function j(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function kv(t,e){return xv(t,e)}const oi=new Map;function xv(t,{target:e,anchor:n,props:a={},events:s,context:o,intro:u=!0}){ov();var f=new Set,h=x=>{for(var b=0;b<x.length;b++){var k=x[b];if(!f.has(k)){f.add(k);var I=yv(k);for(const ie of[e,document]){var L=oi.get(ie);L===void 0&&(L=new Map,oi.set(ie,L));var z=L.get(k);z===void 0?(ie.addEventListener(k,vc,{passive:I}),L.set(k,1)):L.set(k,z+1)}}}};h(Ci(Wu)),jo.add(h);var m=void 0,y=vv(()=>{var x=n??e.appendChild(jr());return Yf(x,{pending:()=>{}},b=>{St({});var k=Nn;o&&(k.c=o),s&&(a.$$events=s),m=t(b,a)||{},Et()}),()=>{var L;for(var b of f)for(const z of[e,document]){var k=oi.get(z),I=k.get(b);--I==0?(z.removeEventListener(b,vc),k.delete(b),k.size===0&&oi.delete(z)):k.set(b,I)}jo.delete(h),x!==n&&((L=x.parentNode)==null||L.removeChild(x))}});return Sv.set(m,y),m}let Sv=new WeakMap;var ar,br,Dn,ya,Ds,js,Ai;class Ev{constructor(e,n=!0){ct(this,"anchor");ut(this,ar,new Map);ut(this,br,new Map);ut(this,Dn,new Map);ut(this,ya,new Set);ut(this,Ds,!0);ut(this,js,()=>{var e=st;if(ge(this,ar).has(e)){var n=ge(this,ar).get(e),a=ge(this,br).get(n);if(a)il(a),ge(this,ya).delete(n);else{var s=ge(this,Dn).get(n);s&&(ge(this,br).set(n,s.effect),ge(this,Dn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),a=s.effect)}for(const[o,u]of ge(this,ar)){if(ge(this,ar).delete(o),o===e)break;const f=ge(this,Dn).get(u);f&&(An(f.effect),ge(this,Dn).delete(u))}for(const[o,u]of ge(this,br)){if(o===n||ge(this,ya).has(o))continue;const f=()=>{if(Array.from(ge(this,ar).values()).includes(o)){var m=document.createDocumentFragment();Lu(u,m),m.append(jr()),ge(this,Dn).set(o,{effect:u,fragment:m})}else An(u);ge(this,ya).delete(o),ge(this,br).delete(o)};ge(this,Ds)||!a?(ge(this,ya).add(o),wa(u,f,!1)):f()}}});ut(this,Ai,e=>{ge(this,ar).delete(e);const n=Array.from(ge(this,ar).values());for(const[a,s]of ge(this,Dn))n.includes(a)||(An(s.effect),ge(this,Dn).delete(a))});this.anchor=e,ot(this,Ds,n)}ensure(e,n){var a=st,s=Tu();if(n&&!ge(this,br).has(e)&&!ge(this,Dn).has(e))if(s){var o=document.createDocumentFragment(),u=jr();o.append(u),ge(this,Dn).set(e,{effect:Wn(()=>n(u)),fragment:o})}else ge(this,br).set(e,Wn(()=>n(this.anchor)));if(ge(this,ar).set(a,e),s){for(const[f,h]of ge(this,br))f===e?a.unskip_effect(h):a.skip_effect(h);for(const[f,h]of ge(this,Dn))f===e?a.unskip_effect(h.effect):a.skip_effect(h.effect);a.oncommit(ge(this,js)),a.ondiscard(ge(this,Ai))}else ge(this,js).call(this)}}ar=new WeakMap,br=new WeakMap,Dn=new WeakMap,ya=new WeakMap,Ds=new WeakMap,js=new WeakMap,Ai=new WeakMap;function te(t,e,n=!1){var a=new Ev(t),s=n?Va:0;function o(u,f){a.ensure(u,f)}al(()=>{var u=!1;e((f,h=0)=>{u=!0,o(h,f)}),u||o(!1,null)},s)}function Gt(t,e){return e}function Tv(t,e,n){for(var a=[],s=e.length,o,u=e.length,f=0;f<s;f++){let x=e[f];wa(x,()=>{if(o){if(o.pending.delete(x),o.done.add(x),o.pending.size===0){var b=t.outrogroups;Lo(Ci(o.done)),b.delete(o),b.size===0&&(t.outrogroups=null)}}else u-=1},!1)}if(u===0){var h=a.length===0&&n!==null;if(h){var m=n,y=m.parentNode;lv(y),y.append(m),t.items.clear()}Lo(e,!h)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Lo(t,e=!0){for(var n=0;n<t.length;n++)An(t[n],e)}var pc;function Ct(t,e,n,a,s,o=null){var u=t,f=new Map,h=(e&ru)!==0;if(h){var m=t;u=m.appendChild(jr())}var y=null,x=_u(()=>{var ie=n();return Zo(ie)?ie:ie==null?[]:Ci(ie)}),b,k=!0;function I(){z.fallback=y,Av(z,b,u,e,a),y!==null&&(b.length===0?(y.f&Mr)===0?il(y):(y.f^=Mr,ys(y,null,u)):wa(y,()=>{y=null}))}var L=al(()=>{b=c(x);for(var ie=b.length,ce=new Set,ne=st,R=Tu(),Z=0;Z<ie;Z+=1){var W=b[Z],P=a(W,Z),ue=k?null:f.get(P);ue?(ue.v&&Xa(ue.v,W),ue.i&&Xa(ue.i,Z),R&&ne.unskip_effect(ue.e)):(ue=Cv(f,k?u:pc??(pc=jr()),W,P,Z,s,e,n),k||(ue.e.f|=Mr),f.set(P,ue)),ce.add(P)}if(ie===0&&o&&!y&&(k?y=Wn(()=>o(u)):(y=Wn(()=>o(pc??(pc=jr()))),y.f|=Mr)),ie>ce.size&&yf(),!k)if(R){for(const[ke,ye]of f)ce.has(ke)||ne.skip_effect(ye.e);ne.oncommit(I),ne.ondiscard(()=>{})}else I();c(x)}),z={effect:L,items:f,outrogroups:null,fallback:y};k=!1}function ds(t){for(;t!==null&&(t.f&ur)===0;)t=t.next;return t}function Av(t,e,n,a,s){var ye,be,Y,J,ve,ae,he,xe,le;var o=(a&Of)!==0,u=e.length,f=t.items,h=ds(t.effect.first),m,y=null,x,b=[],k=[],I,L,z,ie;if(o)for(ie=0;ie<u;ie+=1)I=e[ie],L=s(I,ie),z=f.get(L).e,(z.f&Mr)===0&&((be=(ye=z.nodes)==null?void 0:ye.a)==null||be.measure(),(x??(x=new Set)).add(z));for(ie=0;ie<u;ie+=1){if(I=e[ie],L=s(I,ie),z=f.get(L).e,t.outrogroups!==null)for(const fe of t.outrogroups)fe.pending.delete(z),fe.done.delete(z);if((z.f&Mr)!==0)if(z.f^=Mr,z===h)ys(z,null,n);else{var ce=y?y.next:h;z===t.effect.last&&(t.effect.last=z.prev),z.prev&&(z.prev.next=z.next),z.next&&(z.next.prev=z.prev),Kr(t,y,z),Kr(t,z,ce),ys(z,ce,n),y=z,b=[],k=[],h=ds(y.next);continue}if((z.f&Ln)!==0&&(il(z),o&&((J=(Y=z.nodes)==null?void 0:Y.a)==null||J.unfix(),(x??(x=new Set)).delete(z))),z!==h){if(m!==void 0&&m.has(z)){if(b.length<k.length){var ne=k[0],R;y=ne.prev;var Z=b[0],W=b[b.length-1];for(R=0;R<b.length;R+=1)ys(b[R],ne,n);for(R=0;R<k.length;R+=1)m.delete(k[R]);Kr(t,Z.prev,W.next),Kr(t,y,Z),Kr(t,W,ne),h=ne,y=W,ie-=1,b=[],k=[]}else m.delete(z),ys(z,h,n),Kr(t,z.prev,z.next),Kr(t,z,y===null?t.effect.first:y.next),Kr(t,y,z),y=z;continue}for(b=[],k=[];h!==null&&h!==z;)(m??(m=new Set)).add(h),k.push(h),h=ds(h.next);if(h===null)continue}(z.f&Mr)===0&&b.push(z),y=z,h=ds(z.next)}if(t.outrogroups!==null){for(const fe of t.outrogroups)fe.pending.size===0&&(Lo(Ci(fe.done)),(ve=t.outrogroups)==null||ve.delete(fe));t.outrogroups.size===0&&(t.outrogroups=null)}if(h!==null||m!==void 0){var P=[];if(m!==void 0)for(z of m)(z.f&Ln)===0&&P.push(z);for(;h!==null;)(h.f&Ln)===0&&h!==t.fallback&&P.push(h),h=ds(h.next);var ue=P.length;if(ue>0){var ke=(a&ru)!==0&&u===0?n:null;if(o){for(ie=0;ie<ue;ie+=1)(he=(ae=P[ie].nodes)==null?void 0:ae.a)==null||he.measure();for(ie=0;ie<ue;ie+=1)(le=(xe=P[ie].nodes)==null?void 0:xe.a)==null||le.fix()}Tv(t,P,ke)}}o&&Yr(()=>{var fe,we;if(x!==void 0)for(z of x)(we=(fe=z.nodes)==null?void 0:fe.a)==null||we.apply()})}function Cv(t,e,n,a,s,o,u,f){var h=(u&If)!==0?(u&Pf)===0?av(n,!1,!1):Sa(n):null,m=(u&Rf)!==0?Sa(s):null;return{v:h,i:m,e:Wn(()=>(o(e,h??n,m??s,f),()=>{t.delete(a)}))}}function ys(t,e,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,o=e&&(e.f&Mr)===0?e.nodes.start:n;a!==null;){var u=Ns(a);if(o.before(a),a===s)return;a=u}}function Kr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Iv(t,e,n=!1,a=!1,s=!1){var o=t,u="";Q(()=>{var f=Tt;if(u!==(u=e()??"")&&(f.nodes!==null&&(Pu(f.nodes.start,f.nodes.end),f.nodes=null),u!=="")){var h=u+"";n?h=`<svg>${h}</svg>`:a&&(h=`<math>${h}</math>`);var m=ol(h);if((n||a)&&(m=jn(m)),Ta(jn(m),m.lastChild),n||a)for(;jn(m);)o.before(jn(m));else o.before(m)}})}const hc=[...` 	
\r\fÂ \v\uFEFF`];function Rv(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var s in n)if(n[s])a=a?a+" "+s:s;else if(a.length)for(var o=s.length,u=0;(u=a.indexOf(s,u))>=0;){var f=u+o;(u===0||hc.includes(a[u-1]))&&(f===a.length||hc.includes(a[f]))?a=(u===0?"":a.substring(0,u))+a.substring(f+1):u=f}}return a===""?null:a}function mc(t,e=!1){var n=e?" !important;":";",a="";for(var s in t){var o=t[s];o!=null&&o!==""&&(a+=" "+s+": "+o+n)}return a}function fo(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ov(t,e){if(e){var n="",a,s;if(Array.isArray(e)?(a=e[0],s=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,u=0,f=!1,h=[];a&&h.push(...Object.keys(a).map(fo)),s&&h.push(...Object.keys(s).map(fo));var m=0,y=-1;const L=t.length;for(var x=0;x<L;x++){var b=t[x];if(f?b==="/"&&t[x-1]==="*"&&(f=!1):o?o===b&&(o=!1):b==="/"&&t[x+1]==="*"?f=!0:b==='"'||b==="'"?o=b:b==="("?u++:b===")"&&u--,!f&&o===!1&&u===0){if(b===":"&&y===-1)y=x;else if(b===";"||x===L-1){if(y!==-1){var k=fo(t.substring(m,y).trim());if(!h.includes(k)){b!==";"&&x++;var I=t.substring(m,x).trim();n+=" "+I+";"}}m=x+1,y=-1}}}}return a&&(n+=mc(a)),s&&(n+=mc(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Mt(t,e,n,a,s,o){var u=t.__className;if(u!==n||u===void 0){var f=Rv(n,a,o);f==null?t.removeAttribute("class"):e?t.className=f:t.setAttribute("class",f),t.__className=n}else if(o&&s!==o)for(var h in o){var m=!!o[h];(s==null||m!==!!s[h])&&t.classList.toggle(h,m)}return o}function vo(t,e={},n,a){for(var s in n){var o=n[s];e[s]!==o&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,o,a))}}function ln(t,e,n,a){var s=t.__style;if(s!==e){var o=Ov(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(vo(t,n==null?void 0:n[0],a[0]),vo(t,n==null?void 0:n[1],a[1],"important")):vo(t,n,a));return a}function cl(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Zo(e))return qf();for(var a of t.options)a.selected=e.includes(Ss(a));return}for(a of t.options){var s=Ss(a);if(iv(s,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Hu(t){var e=new MutationObserver(()=>{cl(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Cu(()=>{e.disconnect()})}function Pi(t,e,n=e){var a=new WeakSet,s=!0;Au(t,"change",o=>{var u=o?"[selected]":":checked",f;if(t.multiple)f=[].map.call(t.querySelectorAll(u),Ss);else{var h=t.querySelector(u)??t.querySelector("option:not([disabled])");f=h&&Ss(h)}n(f),st!==null&&a.add(st)}),Ru(()=>{var o=e();if(t===document.activeElement){var u=bi??st;if(a.has(u))return}if(cl(t,o,s),s&&o===void 0){var f=t.querySelector(":checked");f!==null&&(o=Ss(f),n(o))}t.__value=o,s=!1}),Hu(t)}function Ss(t){return"__value"in t?t.__value:t.value}const Pv=Symbol("is custom element"),Mv=Symbol("is html");function ul(t,e,n,a){var s=Dv(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[mf]=n),n==null?t.removeAttribute(e):typeof n!="string"&&jv(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Dv(t){return t.__attributes??(t.__attributes={[Pv]:t.nodeName.includes("-"),[Mv]:t.namespaceURI===su})}var gc=new Map;function jv(t){var e=t.getAttribute("is")||t.nodeName,n=gc.get(e);if(n)return n;gc.set(e,n=[]);for(var a,s=t,o=Element.prototype;o!==s;){a=cf(s);for(var u in a)a[u].set&&n.push(u);s=Jc(s)}return n}function Hn(t,e,n=e){var a=new WeakSet;Au(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=po(t)?ho(o):o,n(o),st!==null&&a.add(st),await Uu(),o!==(o=e())){var u=t.selectionStart,f=t.selectionEnd,h=t.value.length;if(t.value=o??"",f!==null){var m=t.value.length;u===f&&f===h&&m>h?(t.selectionStart=m,t.selectionEnd=m):(t.selectionStart=u,t.selectionEnd=Math.min(f,m))}}}),Bs(e)==null&&t.value&&(n(po(t)?ho(t.value):t.value),st!==null&&a.add(st)),rl(()=>{var s=e();if(t===document.activeElement){var o=bi??st;if(a.has(o))return}po(t)&&s===ho(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function po(t){var e=t.type;return e==="number"||e==="range"}function ho(t){return t===""?null:+t}function _c(t,e){return t===e||(t==null?void 0:t[ba])===e}function Vu(t={},e,n,a){return Ru(()=>{var s,o;return rl(()=>{s=o,o=[],Bs(()=>{t!==n(...o)&&(e(t,...o),s&&_c(n(...s),t)&&e(null,...s))})}),()=>{Yr(()=>{o&&_c(n(...o),t)&&e(null,...o)})}}),t}let li=!1;function Lv(t){var e=li;try{return li=!1,[t(),li]}finally{li=e}}function Ne(t,e,n,a){var ce;var s=(n&jf)!==0,o=(n&Lf)!==0,u=a,f=!0,h=()=>(f&&(f=!1,u=o?Bs(a):a),u),m;if(s){var y=ba in t||hf in t;m=((ce=qa(t,e))==null?void 0:ce.set)??(y&&e in t?ne=>t[e]=ne:void 0)}var x,b=!1;s?[x,b]=Lv(()=>t[e]):x=t[e],x===void 0&&a!==void 0&&(x=h(),m&&(Sf(),m(x)));var k;if(k=()=>{var ne=t[e];return ne===void 0?h():(f=!0,ne)},(n&Df)===0)return k;if(m){var I=t.$$legacy;return(function(ne,R){return arguments.length>0?((!R||I||b)&&m(R?k():ne),ne):k()})}var L=!1,z=((n&Mf)!==0?Oi:_u)(()=>(L=!1,k()));s&&c(z);var ie=Tt;return(function(ne,R){if(arguments.length>0){const Z=R?c(z):s?Pt(ne):ne;return A(z,Z),L=!0,u!==void 0&&(u=Z),ne}return Zr&&L||(ie.f&Dr)!==0?z.v:c(z)})}function nn(t){Nn===null&&gf(),Ea(()=>{const e=Bs(t);if(typeof e=="function")return e})}const Nv="5";var Zc;typeof window<"u"&&((Zc=window.__svelte??(window.__svelte={})).v??(Zc.v=new Set)).add(Nv);var qv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gi={exports:{}},Fv=gi.exports,yc;function zv(){return yc||(yc=1,(function(t,e){((n,a)=>{t.exports=a()})(Fv,function(){var n=function(r,i){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,d){l.__proto__=d}:function(l,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(l[v]=d[v])}))(r,i)},a=function(){return(a=Object.assign||function(r){for(var i,l=1,d=arguments.length;l<d;l++)for(var v in i=arguments[l])Object.prototype.hasOwnProperty.call(i,v)&&(r[v]=i[v]);return r}).apply(this,arguments)};function s(r,i,l){for(var d,v=0,_=i.length;v<_;v++)!d&&v in i||((d=d||Array.prototype.slice.call(i,0,v))[v]=i[v]);return r.concat(d||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:qv,u=Object.keys,f=Array.isArray;function h(r,i){return typeof i=="object"&&u(i).forEach(function(l){r[l]=i[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var m=Object.getPrototypeOf,y={}.hasOwnProperty;function x(r,i){return y.call(r,i)}function b(r,i){typeof i=="function"&&(i=i(m(r))),(typeof Reflect>"u"?u:Reflect.ownKeys)(i).forEach(function(l){I(r,l,i[l])})}var k=Object.defineProperty;function I(r,i,l,d){k(r,i,h(l&&x(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},d))}function L(r){return{from:function(i){return r.prototype=Object.create(i.prototype),I(r.prototype,"constructor",r),{extend:b.bind(null,r.prototype)}}}}var z=Object.getOwnPropertyDescriptor,ie=[].slice;function ce(r,i,l){return ie.call(r,i,l)}function ne(r,i){return i(r)}function R(r){if(!r)throw new Error("Assertion Failed")}function Z(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function W(r,i){if(typeof i=="string"&&x(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var l=[],d=0,v=i.length;d<v;++d){var _=W(r,i[d]);l.push(_)}return l}var w,S=i.indexOf(".");return S===-1||(w=r[i.substr(0,S)])==null?void 0:W(w,i.substr(S+1))}function P(r,i,l){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){R(typeof l!="string"&&"length"in l);for(var d=0,v=i.length;d<v;++d)P(r,i[d],l[d])}else{var _,w,S=i.indexOf(".");S!==-1?(_=i.substr(0,S),(S=i.substr(S+1))===""?l===void 0?f(r)&&!isNaN(parseInt(_))?r.splice(_,1):delete r[_]:r[_]=l:P(w=(w=r[_])&&x(r,_)?w:r[_]={},S,l)):l===void 0?f(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=l}}function ue(r){var i,l={};for(i in r)x(r,i)&&(l[i]=r[i]);return l}var ke=[].concat;function ye(r){return ke.apply([],r)}var me="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ye([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),be=new Set(me.map(function(r){return o[r]})),Y=null;function J(r){return Y=new WeakMap,r=(function i(l){if(!l||typeof l!="object")return l;var d=Y.get(l);if(d)return d;if(f(l)){d=[],Y.set(l,d);for(var v=0,_=l.length;v<_;++v)d.push(i(l[v]))}else if(be.has(l.constructor))d=l;else{var w,S=m(l);for(w in d=S===Object.prototype?{}:Object.create(S),Y.set(l,d),l)x(l,w)&&(d[w]=i(l[w]))}return d})(r),Y=null,r}var ve={}.toString;function ae(r){return ve.call(r).slice(8,-1)}var he=typeof Symbol<"u"?Symbol.iterator:"@@iterator",xe=typeof he=="symbol"?function(r){var i;return r!=null&&(i=r[he])&&i.apply(r)}:function(){return null};function le(r,i){i=r.indexOf(i),0<=i&&r.splice(i,1)}var fe={};function we(r){var i,l,d,v;if(arguments.length===1){if(f(r))return r.slice();if(this===fe&&typeof r=="string")return[r];if(v=xe(r))for(l=[];!(d=v.next()).done;)l.push(d.value);else{if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(l=new Array(i);i--;)l[i]=r[i]}}else for(i=arguments.length,l=new Array(i);i--;)l[i]=arguments[i];return l}var Se=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},me=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ze=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(me),D={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function H(r,i){this.name=r,this.message=i}function se(r,i){return r+". Errors: "+Object.keys(i).map(function(l){return i[l].toString()}).filter(function(l,d,v){return v.indexOf(l)===d}).join(`
`)}function G(r,i,l,d){this.failures=i,this.failedKeys=d,this.successCount=l,this.message=se(r,i)}function de(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(l){return i[l]}),this.failuresByPos=i,this.message=se(r,this.failures)}L(H).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(G).from(H),L(de).from(H);var Me=Ze.reduce(function(r,i){return r[i]=i+"Error",r},{}),re=H,T=Ze.reduce(function(r,i){var l=i+"Error";function d(v,_){this.name=l,v?typeof v=="string"?(this.message="".concat(v).concat(_?`
 `+_:""),this.inner=_||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=D[i]||l,this.inner=null)}return L(d).from(re),r[i]=d,r},{}),pe=(T.Syntax=SyntaxError,T.Type=TypeError,T.Range=RangeError,me.reduce(function(r,i){return r[i+"Error"]=T[i],r},{}));me=Ze.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=T[i]),r},{});function $(){}function Ee(r){return r}function qe(r,i){return r==null||r===Ee?i:function(l){return i(r(l))}}function Fe(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function et(r,i){return r===$?i:function(){var l=r.apply(this,arguments),d=(l!==void 0&&(arguments[0]=l),this.onsuccess),v=this.onerror,_=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return d&&(this.onsuccess=this.onsuccess?Fe(d,this.onsuccess):d),v&&(this.onerror=this.onerror?Fe(v,this.onerror):v),_!==void 0?_:l}}function rt(r,i){return r===$?i:function(){r.apply(this,arguments);var l=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?Fe(l,this.onsuccess):l),d&&(this.onerror=this.onerror?Fe(d,this.onerror):d)}}function nt(r,i){return r===$?i:function(v){var d=r.apply(this,arguments),v=(h(v,d),this.onsuccess),_=this.onerror,w=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?Fe(v,this.onsuccess):v),_&&(this.onerror=this.onerror?Fe(_,this.onerror):_),d===void 0?w===void 0?void 0:w:h(d,w)}}function Ve(r,i){return r===$?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Xe(r,i){return r===$?i:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var d=this,v=arguments.length,_=new Array(v);v--;)_[v]=arguments[v];return l.then(function(){return i.apply(d,_)})}return i.apply(this,arguments)}}me.ModifyError=G,me.DexieError=H,me.BulkError=de;var tt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function vt(r){tt=r}var At={},We=100,Ke=typeof Promise>"u"?[]:(Ze=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Ke=crypto.subtle.digest("SHA-512",new Uint8Array([0])),m(Ke),Ze]:[Ze,m(Ze),Ze]),Ze=Ke[0],ja=Ke[1],ja=ja&&ja.then,Ye=Ze&&Ze.constructor,mt=!!Ke[2],Dt=function(r,i){pt.push([r,i]),an&&(queueMicrotask(In),an=!1)},rn=!0,an=!0,Ft=[],It=[],Jt=Ee,Qe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:$,pgp:!1,env:{},finalize:$},Ae=Qe,pt=[],Rt=0,Qt=[];function Oe(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Ae;if(typeof r!="function"){if(r!==At)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Cn(this,this._value)}else this._state=null,this._value=null,++i.ref,(function l(d,v){try{v(function(_){if(d._state===null){if(_===d)throw new TypeError("A promise cannot be resolved with itself.");var w=d._lib&&dr();_&&typeof _.then=="function"?l(d,function(S,q){_ instanceof Oe?_._then(S,q):_.then(S,q)}):(d._state=!0,d._value=_,zt(d)),w&&Rn()}},Cn.bind(null,d))}catch(_){Cn(d,_)}})(this,r)}var Xt={get:function(){var r=Ae,i=ea;function l(d,v){var _=this,w=!r.global&&(r!==Ae||i!==ea),S=w&&!$n(),q=new Oe(function(X,B){jt(_,new Br(M(d,r,w,S),M(v,r,w,S),X,B,r))});return this._consoleTask&&(q._consoleTask=this._consoleTask),q}return l.prototype=At,l},set:function(r){I(this,"then",r&&r.prototype===At?Xt:{get:function(){return r},set:Xt.set})}};function Br(r,i,l,d,v){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=l,this.reject=d,this.psd=v}function Cn(r,i){var l,d;It.push(i),r._state===null&&(l=r._lib&&dr(),i=Jt(i),r._state=!1,r._value=i,d=r,Ft.some(function(v){return v._value===d._value})||Ft.push(d),zt(r),l)&&Rn()}function zt(r){var i=r._listeners;r._listeners=[];for(var l=0,d=i.length;l<d;++l)jt(r,i[l]);var v=r._PSD;--v.ref||v.finalize(),Rt===0&&(++Rt,Dt(function(){--Rt==0&&fr()},[]))}function jt(r,i){if(r._state===null)r._listeners.push(i);else{var l=r._state?i.onFulfilled:i.onRejected;if(l===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++Rt,Dt(kt,[l,r,i])}}function kt(r,i,l){try{var d,v=i._value;!i._state&&It.length&&(It=[]),d=tt&&i._consoleTask?i._consoleTask.run(function(){return r(v)}):r(v),i._state||It.indexOf(v)!==-1||(_=>{for(var w=Ft.length;w;)if(Ft[--w]._value===_._value)return Ft.splice(w,1)})(i),l.resolve(d)}catch(_){l.reject(_)}finally{--Rt==0&&fr(),--l.psd.ref||l.psd.finalize()}}function In(){Ge(Qe,function(){dr()&&Rn()})}function dr(){var r=rn;return an=rn=!1,r}function Rn(){var r,i,l;do for(;0<pt.length;)for(r=pt,pt=[],l=r.length,i=0;i<l;++i){var d=r[i];d[0].apply(null,d[1])}while(0<pt.length);an=rn=!0}function fr(){for(var r=Ft,i=(Ft=[],r.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)}),Qt.slice(0)),l=i.length;l;)i[--l]()}function Er(r){return new Oe(At,!1,r)}function Ot(r,i){var l=Ae;return function(){var d=dr(),v=Ae;try{return er(l,!0),r.apply(this,arguments)}catch(_){i&&i(_)}finally{er(v,!1),d&&Rn()}}}b(Oe.prototype,{then:Xt,_then:function(r,i){jt(this,new Br(null,null,r,i,Ae))},catch:function(r){var i,l;return arguments.length===1?this.then(null,r):(i=r,l=arguments[1],typeof i=="function"?this.then(null,function(d){return(d instanceof i?l:Er)(d)}):this.then(null,function(d){return(d&&d.name===i?l:Er)(d)}))},finally:function(r){return this.then(function(i){return Oe.resolve(r()).then(function(){return i})},function(i){return Oe.resolve(r()).then(function(){return Er(i)})})},timeout:function(r,i){var l=this;return r<1/0?new Oe(function(d,v){var _=setTimeout(function(){return v(new T.Timeout(i))},r);l.then(d,v).finally(clearTimeout.bind(null,_))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(Oe.prototype,Symbol.toStringTag,"Dexie.Promise"),Qe.env=Gs(),b(Oe,{all:function(){var r=we.apply(null,arguments).map(ta);return new Oe(function(i,l){r.length===0&&i([]);var d=r.length;r.forEach(function(v,_){return Oe.resolve(v).then(function(w){r[_]=w,--d||i(r)},l)})})},resolve:function(r){return r instanceof Oe?r:r&&typeof r.then=="function"?new Oe(function(i,l){r.then(i,l)}):new Oe(At,!0,r)},reject:Er,race:function(){var r=we.apply(null,arguments).map(ta);return new Oe(function(i,l){r.map(function(d){return Oe.resolve(d).then(i,l)})})},PSD:{get:function(){return Ae},set:function(r){return Ae=r}},totalEchoes:{get:function(){return ea}},newPSD:Jn,usePSD:Ge,scheduler:{get:function(){return Dt},set:function(r){Dt=r}},rejectionMapper:{get:function(){return Jt},set:function(r){Jt=r}},follow:function(r,i){return new Oe(function(l,d){return Jn(function(v,_){var w=Ae;w.unhandleds=[],w.onunhandled=_,w.finalize=Fe(function(){var S,q=this;S=function(){q.unhandleds.length===0?v():_(q.unhandleds[0])},Qt.push(function X(){S(),Qt.splice(Qt.indexOf(X),1)}),++Rt,Dt(function(){--Rt==0&&fr()},[])},w.finalize),r()},i,l,d)})}}),Ye&&(Ye.allSettled&&I(Oe,"allSettled",function(){var r=we.apply(null,arguments).map(ta);return new Oe(function(i){r.length===0&&i([]);var l=r.length,d=new Array(l);r.forEach(function(v,_){return Oe.resolve(v).then(function(w){return d[_]={status:"fulfilled",value:w}},function(w){return d[_]={status:"rejected",reason:w}}).then(function(){return--l||i(d)})})})}),Ye.any&&typeof AggregateError<"u"&&I(Oe,"any",function(){var r=we.apply(null,arguments).map(ta);return new Oe(function(i,l){r.length===0&&l(new AggregateError([]));var d=r.length,v=new Array(d);r.forEach(function(_,w){return Oe.resolve(_).then(function(S){return i(S)},function(S){v[w]=S,--d||l(new AggregateError(v))})})})}),Ye.withResolvers)&&(Oe.withResolvers=Ye.withResolvers);var Zt={awaits:0,echoes:0,id:0},Bn=0,Fn=[],$r=0,ea=0,es=0;function Jn(r,w,l,d){var v=Ae,_=Object.create(v),w=(_.parent=v,_.ref=0,_.global=!1,_.id=++es,Qe.env,_.env=mt?{Promise:Oe,PromiseProp:{value:Oe,configurable:!0,writable:!0},all:Oe.all,race:Oe.race,allSettled:Oe.allSettled,any:Oe.any,resolve:Oe.resolve,reject:Oe.reject}:{},w&&h(_,w),++v.ref,_.finalize=function(){--this.parent.ref||this.parent.finalize()},Ge(_,r,l,d));return _.ref===0&&_.finalize(),w}function fn(){return Zt.id||(Zt.id=++Bn),++Zt.awaits,Zt.echoes+=We,Zt.id}function $n(){return!!Zt.awaits&&(--Zt.awaits==0&&(Zt.id=0),Zt.echoes=Zt.awaits*We,!0)}function ta(r){return Zt.echoes&&r&&r.constructor===Ye?(fn(),r.then(function(i){return $n(),i},function(i){return $n(),De(i)})):r}function Ks(){var r=Fn[Fn.length-1];Fn.pop(),er(r,!1)}function er(r,i){var l,d,v=Ae;(i?!Zt.echoes||$r++&&r===Ae:!$r||--$r&&r===Ae)||queueMicrotask(i?(function(_){++ea,Zt.echoes&&--Zt.echoes!=0||(Zt.echoes=Zt.awaits=Zt.id=0),Fn.push(Ae),er(_,!0)}).bind(null,r):Ks),r!==Ae&&(Ae=r,v===Qe&&(Qe.env=Gs()),mt)&&(l=Qe.env.Promise,d=r.env,v.global||r.global)&&(Object.defineProperty(o,"Promise",d.PromiseProp),l.all=d.all,l.race=d.race,l.resolve=d.resolve,l.reject=d.reject,d.allSettled&&(l.allSettled=d.allSettled),d.any)&&(l.any=d.any)}function Gs(){var r=o.Promise;return mt?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ge(r,i,l,d,v){var _=Ae;try{return er(r,!0),i(l,d,v)}finally{er(_,!1)}}function M(r,i,l,d){return typeof r!="function"?r:function(){var v=Ae;l&&fn(),er(i,!0);try{return r.apply(this,arguments)}finally{er(v,!1),d&&queueMicrotask($n)}}}function Ie(r){Promise===Ye&&Zt.echoes===0?$r===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+ja).indexOf("[native code]")===-1&&(fn=$n=$);var De=Oe.reject,yt="ï¿¿",Lt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ut="String expected.",Ht=[],wn="__dbnames",vr="readonly",na="readwrite";function qt(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var ts={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ra(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=J(i))[r],i}}function Rl(){throw T.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ht(r,i){try{var l=Ol(r),d=Ol(i);if(l!==d)return l==="Array"?1:d==="Array"?-1:l==="binary"?1:d==="binary"?-1:l==="string"?1:d==="string"?-1:l==="Date"?1:d!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":for(var v=Pl(r),_=Pl(i),w=v.length,S=_.length,q=w<S?w:S,X=0;X<q;++X)if(v[X]!==_[X])return v[X]<_[X]?-1:1;return w===S?0:w<S?-1:1;case"Array":for(var B=r,O=i,U=B.length,K=O.length,F=U<K?U:K,N=0;N<F;++N){var ee=ht(B[N],O[N]);if(ee!==0)return ee}return U===K?0:U<K?-1:1}}catch{}return NaN}function Ol(r){var i=typeof r;return i=="object"&&(ArrayBuffer.isView(r)||(i=ae(r))==="ArrayBuffer")?"binary":i}function Pl(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Ws(r,i,l){var d=r.schema.yProps;return d?(i&&0<l.numFailures&&(i=i.filter(function(v,_){return!l.failures[_]})),Promise.all(d.map(function(v){return v=v.updatesTable,i?r.db.table(v).where("k").anyOf(i).delete():r.db.table(v).clear()})).then(function(){return l})):l}Ml.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var l=i.add;if(f(l))return s(s([],f(r)?r:[],!0),l).sort();if(typeof l=="number")return(Number(r)||0)+l;if(typeof l=="bigint")try{return BigInt(r)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(i.remove!==void 0){var d=i.remove;if(f(d))return f(r)?r.filter(function(v){return!d.includes(v)}).sort():[];if(typeof d=="number")return Number(r)-d;if(typeof d=="bigint")try{return BigInt(r)-d}catch{return BigInt(0)-d}throw new TypeError("Invalid subtrahend ".concat(d))}return l=(l=i.replacePrefix)==null?void 0:l[0],l&&typeof r=="string"&&r.startsWith(l)?i.replacePrefix[1]+r.substring(l.length):r};var ns=Ml;function Ml(r){this["@@propmod"]=r}function Dl(r,i){for(var l=u(i),d=l.length,v=!1,_=0;_<d;++_){var w=l[_],S=i[w],q=W(r,w);S instanceof ns?(P(r,w,S.execute(q)),v=!0):q!==S&&(P(r,w,S),v=!0)}return v}Nt.prototype._trans=function(r,i,l){var d=this._tx||Ae.trans,v=this.name,_=tt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function w(X,B,O){if(O.schema[v])return i(O.idbtrans,O);throw new T.NotFound("Table "+v+" not part of transaction")}var S=dr();try{var q=d&&d.db._novip===this.db._novip?d===Ae.trans?d._promise(r,w,l):Jn(function(){return d._promise(r,w,l)},{trans:d,transless:Ae.transless||Ae}):(function X(B,O,U,K){if(B.idbdb&&(B._state.openComplete||Ae.letThrough||B._vip)){var F=B._createTransaction(O,U,B._dbSchema);try{F.create(),B._state.PR1398_maxLoop=3}catch(N){return N.name===Me.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return X(B,O,U,K)})):De(N)}return F._promise(O,function(N,ee){return Jn(function(){return Ae.trans=F,K(N,ee,F)})}).then(function(N){if(O==="readwrite")try{F.idbtrans.commit()}catch{}return O==="readonly"?N:F._completion.then(function(){return N})})}if(B._state.openComplete)return De(new T.DatabaseClosed(B._state.dbOpenError));if(!B._state.isBeingOpened){if(!B._state.autoOpen)return De(new T.DatabaseClosed);B.open().catch($)}return B._state.dbReadyPromise.then(function(){return X(B,O,U,K)})})(this.db,r,[this.name],w);return _&&(q._consoleTask=_,q=q.catch(function(X){return console.trace(X),De(X)})),q}finally{S&&Rn()}},Nt.prototype.get=function(r,i){var l=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?De(new T.Type("Invalid argument to Table.get()")):this._trans("readonly",function(d){return l.core.get({trans:d,key:r}).then(function(v){return l.hook.reading.fire(v)})}).then(i)},Nt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(f(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=u(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&i.every(function(X){return 0<=S.keyPath.indexOf(X)})){for(var q=0;q<i.length;++q)if(i.indexOf(S.keyPath[q])===-1)return!1;return!0}return!1}).sort(function(S,q){return S.keyPath.length-q.keyPath.length})[0];if(l&&this.db._maxKey!==yt)return w=l.keyPath.slice(0,i.length),this.where(w).equals(w.map(function(S){return r[S]}));!l&&tt&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var d=this.schema.idxByName;function v(S,q){return ht(S,q)===0}var w=i.reduce(function(B,q){var X=B[0],B=B[1],O=d[q],U=r[q];return[X||O,X||!O?qt(B,O&&O.multi?function(K){return K=W(K,q),f(K)&&K.some(function(F){return v(U,F)})}:function(K){return v(U,W(K,q))}):B]},[null,null]),_=w[0],w=w[1];return _?this.where(_.name).equals(r[_.keyPath]).filter(w):l?this.filter(w):this.where(i).equals("")},Nt.prototype.filter=function(r){return this.toCollection().and(r)},Nt.prototype.count=function(r){return this.toCollection().count(r)},Nt.prototype.offset=function(r){return this.toCollection().offset(r)},Nt.prototype.limit=function(r){return this.toCollection().limit(r)},Nt.prototype.each=function(r){return this.toCollection().each(r)},Nt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Nt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Nt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,f(r)?"[".concat(r.join("+"),"]"):r))},Nt.prototype.reverse=function(){return this.toCollection().reverse()},Nt.prototype.mapToClass=function(r){for(var i=this.db,l=this.name,d=((this.schema.mappedClass=r).prototype instanceof Rl&&(r=(w=>{var S=B,q=w;if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function X(){this.constructor=S}function B(){return w!==null&&w.apply(this,arguments)||this}return n(S,q),S.prototype=q===null?Object.create(q):(X.prototype=q.prototype,new X),Object.defineProperty(B.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),B.prototype.table=function(){return l},B})(r)),new Set),v=r.prototype;v;v=m(v))Object.getOwnPropertyNames(v).forEach(function(w){return d.add(w)});function _(w){if(!w)return w;var S,q=Object.create(r.prototype);for(S in w)if(!d.has(S))try{q[S]=w[S]}catch{}return q}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=_,this.hook("reading",_),r},Nt.prototype.defineClass=function(){return this.mapToClass(function(r){h(this,r)})},Nt.prototype.add=function(r,i){var l=this,d=this.schema.primKey,v=d.auto,_=d.keyPath,w=r;return _&&v&&(w=ra(_)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:i!=null?[i]:null,values:[w]})}).then(function(S){return S.numFailures?Oe.reject(S.failures[0]):S.lastResult}).then(function(S){if(_)try{P(r,_,S)}catch{}return S})},Nt.prototype.upsert=function(r,i){var l=this,d=this.schema.primKey.keyPath;return this._trans("readwrite",function(v){return l.core.get({trans:v,key:r}).then(function(_){var w=_??{};return Dl(w,i),d&&P(w,d,r),l.core.mutate({trans:v,type:"put",values:[w],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[i]}}).then(function(S){return S.numFailures?Oe.reject(S.failures[0]):!!_})})})},Nt.prototype.update=function(r,i){return typeof r!="object"||f(r)?this.where(":id").equals(r).modify(i):(r=W(r,this.schema.primKey.keyPath))===void 0?De(new T.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i)},Nt.prototype.put=function(r,i){var l=this,d=this.schema.primKey,v=d.auto,_=d.keyPath,w=r;return _&&v&&(w=ra(_)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[w],keys:i!=null?[i]:null})}).then(function(S){return S.numFailures?Oe.reject(S.failures[0]):S.lastResult}).then(function(S){if(_)try{P(r,_,S)}catch{}return S})},Nt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:[r]}).then(function(d){return Ws(i,[r],d)}).then(function(d){return d.numFailures?Oe.reject(d.failures[0]):void 0})})},Nt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:ts}).then(function(l){return Ws(r,null,l)})}).then(function(i){return i.numFailures?Oe.reject(i.failures[0]):void 0})},Nt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(l){return i.core.getMany({keys:r,trans:l}).then(function(d){return d.map(function(v){return i.hook.reading.fire(v)})})})},Nt.prototype.bulkAdd=function(r,i,l){var d=this,v=Array.isArray(i)?i:void 0,_=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=d.schema.primKey,X=S.auto,S=S.keyPath;if(S&&v)throw new T.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new T.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,X=S&&X?r.map(ra(S)):r;return d.core.mutate({trans:w,type:"add",keys:v,values:X,wantResults:_}).then(function(B){var O=B.numFailures,U=B.failures;if(O===0)return _?B.results:B.lastResult;throw new de("".concat(d.name,".bulkAdd(): ").concat(O," of ").concat(q," operations failed"),U)})})},Nt.prototype.bulkPut=function(r,i,l){var d=this,v=Array.isArray(i)?i:void 0,_=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(w){var S=d.schema.primKey,X=S.auto,S=S.keyPath;if(S&&v)throw new T.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new T.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,X=S&&X?r.map(ra(S)):r;return d.core.mutate({trans:w,type:"put",keys:v,values:X,wantResults:_}).then(function(B){var O=B.numFailures,U=B.failures;if(O===0)return _?B.results:B.lastResult;throw new de("".concat(d.name,".bulkPut(): ").concat(O," of ").concat(q," operations failed"),U)})})},Nt.prototype.bulkUpdate=function(r){var i=this,l=this.core,d=r.map(function(w){return w.key}),v=r.map(function(w){return w.changes}),_=[];return this._trans("readwrite",function(w){return l.getMany({trans:w,keys:d,cache:"clone"}).then(function(S){var q=[],X=[],B=(r.forEach(function(O,U){var K=O.key,F=O.changes,N=S[U];if(N){for(var ee=0,oe=Object.keys(F);ee<oe.length;ee++){var V=oe[ee],_e=F[V];if(V===i.schema.primKey.keyPath){if(ht(_e,K)!==0)throw new T.Constraint("Cannot update primary key in bulkUpdate()")}else P(N,V,_e)}_.push(U),q.push(K),X.push(N)}}),q.length);return l.mutate({trans:w,type:"put",keys:q,values:X,updates:{keys:d,changeSpecs:v}}).then(function(O){var U=O.numFailures,K=O.failures;if(U===0)return B;for(var F=0,N=Object.keys(K);F<N.length;F++){var ee,oe=N[F],V=_[Number(oe)];V!=null&&(ee=K[oe],delete K[oe],K[V]=ee)}throw new de("".concat(i.name,".bulkUpdate(): ").concat(U," of ").concat(B," operations failed"),K)})})})},Nt.prototype.bulkDelete=function(r){var i=this,l=r.length;return this._trans("readwrite",function(d){return i.core.mutate({trans:d,type:"delete",keys:r}).then(function(v){return Ws(i,r,v)})}).then(function(d){var v=d.numFailures,_=d.failures;if(v===0)return d.lastResult;throw new de("".concat(i.name,".bulkDelete(): ").concat(v," of ").concat(l," operations failed"),_)})};var jl=Nt;function Nt(){}function rs(r){function i(w,S){if(S){for(var q=arguments.length,X=new Array(q-1);--q;)X[q-1]=arguments[q];return l[w].subscribe.apply(null,X),r}if(typeof w=="string")return l[w]}var l={};i.addEventType=_;for(var d=1,v=arguments.length;d<v;++d)_(arguments[d]);return i;function _(w,S,q){var X,B;if(typeof w!="object")return S=S||Ve,B={subscribers:[],fire:q=q||$,subscribe:function(O){B.subscribers.indexOf(O)===-1&&(B.subscribers.push(O),B.fire=S(B.fire,O))},unsubscribe:function(O){B.subscribers=B.subscribers.filter(function(U){return U!==O}),B.fire=B.subscribers.reduce(S,q)}},l[w]=i[w]=B;u(X=w).forEach(function(O){var U=X[O];if(f(U))_(O,X[O][0],X[O][1]);else{if(U!=="asap")throw new T.InvalidArgument("Invalid event config");var K=_(O,Ee,function(){for(var F=arguments.length,N=new Array(F);F--;)N[F]=arguments[F];K.subscribers.forEach(function(ee){Z(function(){ee.apply(null,N)})})})}})}}function as(r,i){return L(i).from({prototype:r}),i}function Pa(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function Bi(r,i){r.filter=qt(r.filter,i)}function Fi(r,i,l){var d=r.replayFilter;r.replayFilter=d?function(){return qt(d(),i())}:i,r.justLimit=l&&!d}function Hs(r,i){if(r.isPrimKey)return i.primaryKey;var l=i.getIndexByKeyPath(r.index);if(l)return l;throw new T.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed")}function Ll(r,i,l){var d=Hs(r,i.schema);return i.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:d,range:r.range}})}function Vs(r,i,l,d){var v,_,w=r.replayFilter?qt(r.filter,r.replayFilter()):r.filter;return r.or?(v={},_=function(S,q,X){var B,O;w&&!w(q,X,function(U){return q.stop(U)},function(U){return q.fail(U)})||((O=""+(B=q.primaryKey))=="[object ArrayBuffer]"&&(O=""+new Uint8Array(B)),x(v,O))||(v[O]=!0,i(S,q,X))},Promise.all([r.or._iterate(_,l),Nl(Ll(r,d,l),r.algorithm,_,!r.keysOnly&&r.valueMapper)])):Nl(Ll(r,d,l),qt(r.algorithm,w),i,!r.keysOnly&&r.valueMapper)}function Nl(r,i,l,d){var v=Ot(d?function(_,w,S){return l(d(_),w,S)}:l);return r.then(function(_){if(_)return _.start(function(){var w=function(){return _.continue()};i&&!i(_,function(S){return w=S},function(S){_.stop(S),w=$},function(S){_.fail(S),w=$})||v(_.value,_,function(S){return w=S}),w()})})}bt.prototype._read=function(r,i){var l=this._ctx;return l.error?l.table._trans(null,De.bind(null,l.error)):l.table._trans("readonly",r).then(i)},bt.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,De.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},bt.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=qt(i.algorithm,r)},bt.prototype._iterate=function(r,i){return Vs(this._ctx,r,i,this._ctx.table.core)},bt.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&h(l,r),i._ctx=l,i},bt.prototype.raw=function(){return this._ctx.valueMapper=null,this},bt.prototype.each=function(r){var i=this._ctx;return this._read(function(l){return Vs(i,r,l,i.table.core)})},bt.prototype.count=function(r){var i=this;return this._read(function(l){var d,v=i._ctx,_=v.table.core;return Pa(v,!0)?_.count({trans:l,query:{index:Hs(v,_.schema),range:v.range}}).then(function(w){return Math.min(w,v.limit)}):(d=0,Vs(v,function(){return++d,!1},l,_).then(function(){return d}))}).then(r)},bt.prototype.sortBy=function(r,i){var l=r.split(".").reverse(),d=l[0],v=l.length-1;function _(q,X){return X?_(q[l[X]],X-1):q[d]}var w=this._ctx.dir==="next"?1:-1;function S(q,X){return ht(_(q,v),_(X,v))*w}return this.toArray(function(q){return q.sort(S)}).then(i)},bt.prototype.toArray=function(r){var i=this;return this._read(function(l){var d,v,_,w=i._ctx;return w.dir==="next"&&Pa(w,!0)&&0<w.limit?(d=w.valueMapper,v=Hs(w,w.table.core.schema),w.table.core.query({trans:l,limit:w.limit,values:!0,query:{index:v,range:w.range}}).then(function(S){return S=S.result,d?S.map(d):S})):(_=[],Vs(w,function(S){return _.push(S)},l,w.table.core).then(function(){return _}))},r)},bt.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,Pa(i)?Fi(i,function(){var l=r;return function(d,v){return l===0||(l===1?--l:v(function(){d.advance(l),l=0}),!1)}}):Fi(i,function(){var l=r;return function(){return--l<0}})),this},bt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),Fi(this._ctx,function(){var i=r;return function(l,d,v){return--i<=0&&d(v),0<=i}},!0),this},bt.prototype.until=function(r,i){return Bi(this._ctx,function(l,d,v){return!r(l.value)||(d(v),i)}),this},bt.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},bt.prototype.last=function(r){return this.reverse().first(r)},bt.prototype.filter=function(r){var i;return Bi(this._ctx,function(l){return r(l.value)}),(i=this._ctx).isMatch=qt(i.isMatch,r),this},bt.prototype.and=function(r){return this.filter(r)},bt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},bt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},bt.prototype.desc=function(){return this.reverse()},bt.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.key,d)})},bt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},bt.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.primaryKey,d)})},bt.prototype.keys=function(r){var i=this._ctx,l=(i.keysOnly=!i.isMatch,[]);return this.each(function(d,v){l.push(v.key)}).then(function(){return l}).then(r)},bt.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&Pa(i,!0)&&0<i.limit)return this._read(function(d){var v=Hs(i,i.table.core.schema);return i.table.core.query({trans:d,values:!1,limit:i.limit,query:{index:v,range:i.range}})}).then(function(d){return d.result}).then(r);i.keysOnly=!i.isMatch;var l=[];return this.each(function(d,v){l.push(v.primaryKey)}).then(function(){return l}).then(r)},bt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},bt.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},bt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},bt.prototype.distinct=function(){var r,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(r={},Bi(this._ctx,function(d){var d=d.primaryKey.toString(),v=x(r,d);return r[d]=!0,!v})),this},bt.prototype.modify=function(r){var i=this,l=this._ctx;return this._write(function(d){function v(N,ee){var oe=ee.failures;U+=N-ee.numFailures;for(var V=0,_e=u(oe);V<_e.length;V++){var Te=_e[V];O.push(oe[Te])}}var _=typeof r=="function"?r:function(N){return Dl(N,r)},w=l.table.core,B=w.schema.primaryKey,S=B.outbound,q=B.extractKey,X=200,B=i.db._options.modifyChunkSize,O=(B&&(X=typeof B=="object"?B[w.name]||B["*"]||200:B),[]),U=0,K=[],F=r===ql;return i.clone().primaryKeys().then(function(N){function ee(V){var _e=Math.min(X,N.length-V),Te=N.slice(V,V+_e);return(F?Promise.resolve([]):w.getMany({trans:d,keys:Te,cache:"immutable"})).then(function(je){var Le=[],Ce=[],ze=S?[]:null,Be=F?Te:[];if(!F)for(var Pe=0;Pe<_e;++Pe){var Ue=je[Pe],gt={value:J(Ue),primKey:N[V+Pe]};_.call(gt,gt.value,gt)!==!1&&(gt.value==null?Be.push(N[V+Pe]):S||ht(q(Ue),q(gt.value))===0?(Ce.push(gt.value),S&&ze.push(N[V+Pe])):(Be.push(N[V+Pe]),Le.push(gt.value)))}return Promise.resolve(0<Le.length&&w.mutate({trans:d,type:"add",values:Le}).then(function(wt){for(var Je in wt.failures)Be.splice(parseInt(Je),1);v(Le.length,wt)})).then(function(){return(0<Ce.length||oe&&typeof r=="object")&&w.mutate({trans:d,type:"put",keys:ze,values:Ce,criteria:oe,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<V}).then(function(wt){return v(Ce.length,wt)})}).then(function(){return(0<Be.length||oe&&F)&&w.mutate({trans:d,type:"delete",keys:Be,criteria:oe,isAdditionalChunk:0<V}).then(function(wt){return Ws(l.table,Be,wt)}).then(function(wt){return v(Be.length,wt)})}).then(function(){return N.length>V+_e&&ee(V+X)})})}var oe=Pa(l)&&l.limit===1/0&&(typeof r!="function"||F)&&{index:l.index,range:l.range};return ee(0).then(function(){if(0<O.length)throw new G("Error modifying one or more objects",O,U,K);return N.length})})})},bt.prototype.delete=function(){var r=this._ctx,i=r.range;return!Pa(r)||r.table.schema.yProps||!r.isPrimKey&&i.type!==3?this.modify(ql):this._write(function(l){var d=r.table.core.schema.primaryKey,v=i;return r.table.core.count({trans:l,query:{index:d,range:v}}).then(function(_){return r.table.core.mutate({trans:l,type:"deleteRange",range:v}).then(function(q){var S=q.failures,q=q.numFailures;if(q)throw new G("Could not delete some values",Object.keys(S).map(function(X){return S[X]}),_-q);return _-q})})})};var qd=bt;function bt(){}var ql=function(r,i){return i.value=null};function Bd(r,i){return r<i?-1:r===i?0:1}function Fd(r,i){return i<r?-1:r===i?0:1}function On(r,i,l){return r=r instanceof Fl?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(i),r}function Ma(r){return new r.Collection(r,function(){return Bl("")}).limit(0)}function Ys(K,i,l,d){var v,_,w,S,q,X,B,O=l.length;if(!l.every(function(N){return typeof N=="string"}))return On(K,Ut);function U(N){v=N==="next"?function(oe){return oe.toUpperCase()}:function(oe){return oe.toLowerCase()},_=N==="next"?function(oe){return oe.toLowerCase()}:function(oe){return oe.toUpperCase()},w=N==="next"?Bd:Fd;var ee=l.map(function(oe){return{lower:_(oe),upper:v(oe)}}).sort(function(oe,V){return w(oe.lower,V.lower)});S=ee.map(function(oe){return oe.upper}),q=ee.map(function(oe){return oe.lower}),B=(X=N)==="next"?"":d}U("next");var K=new K.Collection(K,function(){return Fr(S[0],q[O-1]+d)}),F=(K._ondirectionchange=function(N){U(N)},0);return K._addAlgorithm(function(N,ee,oe){var V=N.key;if(typeof V=="string"){var _e=_(V);if(i(_e,q,F))return!0;for(var Te=null,je=F;je<O;++je){var Le=((Ce,ze,Be,Pe,Ue,gt)=>{for(var wt=Math.min(Ce.length,Pe.length),Je=-1,it=0;it<wt;++it){var Kt=ze[it];if(Kt!==Pe[it])return Ue(Ce[it],Be[it])<0?Ce.substr(0,it)+Be[it]+Be.substr(it+1):Ue(Ce[it],Pe[it])<0?Ce.substr(0,it)+Pe[it]+Be.substr(it+1):0<=Je?Ce.substr(0,Je)+ze[Je]+Be.substr(Je+1):null;Ue(Ce[it],Kt)<0&&(Je=it)}return wt<Pe.length&&gt==="next"?Ce+Be.substr(Ce.length):wt<Ce.length&&gt==="prev"?Ce.substr(0,Be.length):Je<0?null:Ce.substr(0,Je)+Pe[Je]+Be.substr(Je+1)})(V,_e,S[je],q[je],w,X);Le===null&&Te===null?F=je+1:(Te===null||0<w(Te,Le))&&(Te=Le)}ee(Te!==null?function(){N.continue(Te+B)}:oe)}return!1}),K}function Fr(r,i,l,d){return{type:2,lower:r,upper:i,lowerOpen:l,upperOpen:d}}function Bl(r){return{type:1,lower:r,upper:r}}Object.defineProperty($t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),$t.prototype.between=function(r,i,l,d){l=l!==!1,d=d===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(l||d)&&(!l||!d)?Ma(this):new this.Collection(this,function(){return Fr(r,i,!l,!d)})}catch{return On(this,Lt)}},$t.prototype.equals=function(r){return r==null?On(this,Lt):new this.Collection(this,function(){return Bl(r)})},$t.prototype.above=function(r){return r==null?On(this,Lt):new this.Collection(this,function(){return Fr(r,void 0,!0)})},$t.prototype.aboveOrEqual=function(r){return r==null?On(this,Lt):new this.Collection(this,function(){return Fr(r,void 0,!1)})},$t.prototype.below=function(r){return r==null?On(this,Lt):new this.Collection(this,function(){return Fr(void 0,r,!1,!0)})},$t.prototype.belowOrEqual=function(r){return r==null?On(this,Lt):new this.Collection(this,function(){return Fr(void 0,r)})},$t.prototype.startsWith=function(r){return typeof r!="string"?On(this,Ut):this.between(r,r+yt,!0,!0)},$t.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Ys(this,function(i,l){return i.indexOf(l[0])===0},[r],yt)},$t.prototype.equalsIgnoreCase=function(r){return Ys(this,function(i,l){return i===l[0]},[r],"")},$t.prototype.anyOfIgnoreCase=function(){var r=we.apply(fe,arguments);return r.length===0?Ma(this):Ys(this,function(i,l){return l.indexOf(i)!==-1},r,"")},$t.prototype.startsWithAnyOfIgnoreCase=function(){var r=we.apply(fe,arguments);return r.length===0?Ma(this):Ys(this,function(i,l){return l.some(function(d){return i.indexOf(d)===0})},r,yt)},$t.prototype.anyOf=function(){var r,i,l=this,d=we.apply(fe,arguments),v=this._cmp;try{d.sort(v)}catch{return On(this,Lt)}return d.length===0?Ma(this):((r=new this.Collection(this,function(){return Fr(d[0],d[d.length-1])}))._ondirectionchange=function(_){v=_==="next"?l._ascending:l._descending,d.sort(v)},i=0,r._addAlgorithm(function(_,w,S){for(var q=_.key;0<v(q,d[i]);)if(++i===d.length)return w(S),!1;return v(q,d[i])===0||(w(function(){_.continue(d[i])}),!1)}),r)},$t.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},$t.prototype.noneOf=function(){var r=we.apply(fe,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return On(this,Lt)}var i=r.reduce(function(l,d){return l?l.concat([[l[l.length-1][1],d]]):[[-1/0,d]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},$t.prototype.inAnyRange=function(r,oe){var l=this,d=this._cmp,v=this._ascending,_=this._descending,w=this._min,S=this._max;if(r.length===0)return Ma(this);if(!r.every(function(V){return V[0]!==void 0&&V[1]!==void 0&&v(V[0],V[1])<=0}))return On(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",T.InvalidArgument);var q=!oe||oe.includeLowers!==!1,X=oe&&oe.includeUppers===!0,B,O=v;function U(V,_e){return O(V[0],_e[0])}try{(B=r.reduce(function(V,_e){for(var Te=0,je=V.length;Te<je;++Te){var Le=V[Te];if(d(_e[0],Le[1])<0&&0<d(_e[1],Le[0])){Le[0]=w(Le[0],_e[0]),Le[1]=S(Le[1],_e[1]);break}}return Te===je&&V.push(_e),V},[])).sort(U)}catch{return On(this,Lt)}var K=0,F=X?function(V){return 0<v(V,B[K][1])}:function(V){return 0<=v(V,B[K][1])},N=q?function(V){return 0<_(V,B[K][0])}:function(V){return 0<=_(V,B[K][0])},ee=F,oe=new this.Collection(this,function(){return Fr(B[0][0],B[B.length-1][1],!q,!X)});return oe._ondirectionchange=function(V){O=V==="next"?(ee=F,v):(ee=N,_),B.sort(U)},oe._addAlgorithm(function(V,_e,Te){for(var je,Le=V.key;ee(Le);)if(++K===B.length)return _e(Te),!1;return!F(je=Le)&&!N(je)||(l._cmp(Le,B[K][1])===0||l._cmp(Le,B[K][0])===0||_e(function(){O===v?V.continue(B[K][0]):V.continue(B[K][1])}),!1)}),oe},$t.prototype.startsWithAnyOf=function(){var r=we.apply(fe,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Ma(this):this.inAnyRange(r.map(function(i){return[i,i+yt]})):On(this,"startsWithAnyOf() only works with strings")};var Fl=$t;function $t(){}function pr(r){return Ot(function(i){return ss(i),r(i.target.error),!1})}function ss(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var is="storagemutated",zi="x-storagemutated-1",zr=rs(null,is),zd=(hr.prototype._lock=function(){return R(!Ae.global),++this._reculock,this._reculock!==1||Ae.global||(Ae.lockOwnerFor=this),this},hr.prototype._unlock=function(){if(R(!Ae.global),--this._reculock==0)for(Ae.global||(Ae.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ge(r[1],r[0])}catch{}}return this},hr.prototype._locked=function(){return this._reculock&&Ae.lockOwnerFor!==this},hr.prototype.create=function(r){var i=this;if(this.mode){var l=this.db.idbdb,d=this.db._state.dbOpenError;if(R(!this.idbtrans),!r&&!l)switch(d&&d.name){case"DatabaseClosedError":throw new T.DatabaseClosed(d);case"MissingAPIError":throw new T.MissingAPI(d.message,d);default:throw new T.OpenFailed(d)}if(!this.active)throw new T.TransactionInactive;R(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ot(function(v){ss(v),i._reject(r.error)}),r.onabort=Ot(function(v){ss(v),i.active&&i._reject(new T.Abort(r.error)),i.active=!1,i.on("abort").fire(v)}),r.oncomplete=Ot(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&zr.storagemutated.fire(r.mutatedParts)})}return this},hr.prototype._promise=function(r,i,l){var d,v=this;return r==="readwrite"&&this.mode!=="readwrite"?De(new T.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Oe(function(_,w){v._blockedFuncs.push([function(){v._promise(r,i,l).then(_,w)},Ae])}):l?Jn(function(){var _=new Oe(function(w,S){v._lock();var q=i(w,S,v);q&&q.then&&q.then(w,S)});return _.finally(function(){return v._unlock()}),_._lib=!0,_}):((d=new Oe(function(_,w){var S=i(_,w,v);S&&S.then&&S.then(_,w)}))._lib=!0,d):De(new T.TransactionInactive)},hr.prototype._root=function(){return this.parent?this.parent._root():this},hr.prototype.waitFor=function(r){var i,l=this._root(),d=Oe.resolve(r),v=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return d}):(l._waitingFor=d,l._waitingQueue=[],i=l.idbtrans.objectStore(l.storeNames[0]),(function _(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(i.get(-1/0).onsuccess=_)})()),l._waitingFor);return new Oe(function(_,w){d.then(function(S){return l._waitingQueue.push(Ot(_.bind(null,S)))},function(S){return l._waitingQueue.push(Ot(w.bind(null,S)))}).finally(function(){l._waitingFor===v&&(l._waitingFor=null)})})},hr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new T.Abort))},hr.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(x(i,r))return i[r];var l=this.schema[r];if(l)return(l=new this.db.Table(r,l,this)).core=this.db.core.table(r),i[r]=l;throw new T.NotFound("Table "+r+" not part of transaction")},hr);function hr(){}function Ui(r,i,l,d,v,_,w,S){return{name:r,keyPath:i,unique:l,multi:d,auto:v,compound:_,src:(l&&!w?"&":"")+(d?"*":"")+(v?"++":"")+zl(i),type:S}}function zl(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Ki(r,i,l){return{name:r,primKey:i,indexes:l,mappedClass:null,idxByName:(d=function(v){return[v.name,v]},l.reduce(function(v,_,w){return _=d(_,w),_&&(v[_[0]]=_[1]),v},{}))};var d}var os=function(r){try{return r.only([[]]),os=function(){return[[]]},[[]]}catch{return os=function(){return yt},yt}};function Gi(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(l){return l[i]}:function(l){return W(l,i)}:function(l){return W(l,r)};var i}function Ul(r){return[].slice.call(r)}var Ud=0;function ls(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Kd(r,i,q){function d(F){if(F.type===3)return null;if(F.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var O=F.lower,U=F.upper,K=F.lowerOpen,F=F.upperOpen;return O===void 0?U===void 0?null:i.upperBound(U,!!F):U===void 0?i.lowerBound(O,!!K):i.bound(O,U,!!K,!!F)}function v(B){var O,U=B.name;return{name:U,schema:B,mutate:function(K){var F=K.trans,N=K.type,ee=K.keys,oe=K.values,V=K.range;return new Promise(function(_e,Te){_e=Ot(_e);var je=F.objectStore(U),Le=je.keyPath==null,Ce=N==="put"||N==="add";if(!Ce&&N!=="delete"&&N!=="deleteRange")throw new Error("Invalid operation type: "+N);var ze,Be=(ee||oe||{length:1}).length;if(ee&&oe&&ee.length!==oe.length)throw new Error("Given keys array must have same length as given values array.");if(Be===0)return _e({numFailures:0,failures:{},results:[],lastResult:void 0});function Pe(Wt){++wt,ss(Wt)}var Ue=[],gt=[],wt=0;if(N==="deleteRange"){if(V.type===4)return _e({numFailures:wt,failures:gt,results:[],lastResult:void 0});V.type===3?Ue.push(ze=je.clear()):Ue.push(ze=je.delete(d(V)))}else{var Le=Ce?Le?[oe,ee]:[oe,null]:[ee,null],Je=Le[0],it=Le[1];if(Ce)for(var Kt=0;Kt<Be;++Kt)Ue.push(ze=it&&it[Kt]!==void 0?je[N](Je[Kt],it[Kt]):je[N](Je[Kt])),ze.onerror=Pe;else for(Kt=0;Kt<Be;++Kt)Ue.push(ze=je[N](Je[Kt])),ze.onerror=Pe}function zn(Wt){Wt=Wt.target.result,Ue.forEach(function(ia,lo){return ia.error!=null&&(gt[lo]=ia.error)}),_e({numFailures:wt,failures:gt,results:N==="delete"?ee:Ue.map(function(ia){return ia.result}),lastResult:Wt})}ze.onerror=function(Wt){Pe(Wt),zn(Wt)},ze.onsuccess=zn})},getMany:function(K){var F=K.trans,N=K.keys;return new Promise(function(ee,oe){ee=Ot(ee);for(var V,_e=F.objectStore(U),Te=N.length,je=new Array(Te),Le=0,Ce=0,ze=function(Ue){Ue=Ue.target,je[Ue._pos]=Ue.result,++Ce===Le&&ee(je)},Be=pr(oe),Pe=0;Pe<Te;++Pe)N[Pe]!=null&&((V=_e.get(N[Pe]))._pos=Pe,V.onsuccess=ze,V.onerror=Be,++Le);Le===0&&ee(je)})},get:function(K){var F=K.trans,N=K.key;return new Promise(function(ee,oe){ee=Ot(ee);var V=F.objectStore(U).get(N);V.onsuccess=function(_e){return ee(_e.target.result)},V.onerror=pr(oe)})},query:(O=S,function(K){return new Promise(function(F,N){F=Ot(F);var ee,oe,V,Ce=K.trans,_e=K.values,Te=K.limit,Le=K.query,je=Te===1/0?void 0:Te,ze=Le.index,Le=Le.range,Ce=Ce.objectStore(U),Ce=ze.isPrimaryKey?Ce:Ce.index(ze.name),ze=d(Le);if(Te===0)return F({result:[]});O?((Le=_e?Ce.getAll(ze,je):Ce.getAllKeys(ze,je)).onsuccess=function(Be){return F({result:Be.target.result})},Le.onerror=pr(N)):(ee=0,oe=!_e&&"openKeyCursor"in Ce?Ce.openKeyCursor(ze):Ce.openCursor(ze),V=[],oe.onsuccess=function(Be){var Pe=oe.result;return!Pe||(V.push(_e?Pe.value:Pe.primaryKey),++ee===Te)?F({result:V}):void Pe.continue()},oe.onerror=pr(N))})}),openCursor:function(K){var F=K.trans,N=K.values,ee=K.query,oe=K.reverse,V=K.unique;return new Promise(function(_e,Te){_e=Ot(_e);var Ce=ee.index,je=ee.range,Le=F.objectStore(U),Le=Ce.isPrimaryKey?Le:Le.index(Ce.name),Ce=oe?V?"prevunique":"prev":V?"nextunique":"next",ze=!N&&"openKeyCursor"in Le?Le.openKeyCursor(d(je),Ce):Le.openCursor(d(je),Ce);ze.onerror=pr(Te),ze.onsuccess=Ot(function(Be){var Pe,Ue,gt,wt,Je=ze.result;Je?(Je.___id=++Ud,Je.done=!1,Pe=Je.continue.bind(Je),Ue=(Ue=Je.continuePrimaryKey)&&Ue.bind(Je),gt=Je.advance.bind(Je),wt=function(){throw new Error("Cursor not stopped")},Je.trans=F,Je.stop=Je.continue=Je.continuePrimaryKey=Je.advance=function(){throw new Error("Cursor not started")},Je.fail=Ot(Te),Je.next=function(){var it=this,Kt=1;return this.start(function(){return Kt--?it.continue():it.stop()}).then(function(){return it})},Je.start=function(it){function Kt(){if(ze.result)try{it()}catch(Wt){Je.fail(Wt)}else Je.done=!0,Je.start=function(){throw new Error("Cursor behind last entry")},Je.stop()}var zn=new Promise(function(Wt,ia){Wt=Ot(Wt),ze.onerror=pr(ia),Je.fail=ia,Je.stop=function(lo){Je.stop=Je.continue=Je.continuePrimaryKey=Je.advance=wt,Wt(lo)}});return ze.onsuccess=Ot(function(Wt){ze.onsuccess=Kt,Kt()}),Je.continue=Pe,Je.continuePrimaryKey=Ue,Je.advance=gt,Kt(),zn},_e(Je)):_e(null)},Te)})},count:function(K){var F=K.query,N=K.trans,ee=F.index,oe=F.range;return new Promise(function(V,_e){var Te=N.objectStore(U),Te=ee.isPrimaryKey?Te:Te.index(ee.name),je=d(oe),je=je?Te.count(je):Te.count();je.onsuccess=Ot(function(Le){return V(Le.target.result)}),je.onerror=pr(_e)})}}}_=q,w=Ul((q=r).objectStoreNames);var _,q={schema:{name:q.name,tables:w.map(function(B){return _.objectStore(B)}).map(function(B){var O=B.keyPath,U=B.autoIncrement,F=f(O),K={},F={name:B.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O==null,compound:F,keyPath:O,autoIncrement:U,unique:!0,extractKey:Gi(O)},indexes:Ul(B.indexNames).map(function(N){return B.index(N)}).map(function(V){var _e=V.name,ee=V.unique,oe=V.multiEntry,V=V.keyPath,_e={name:_e,compound:f(V),keyPath:V,unique:ee,multiEntry:oe,extractKey:Gi(V)};return K[ls(V)]=_e}),getIndexByKeyPath:function(N){return K[ls(N)]}};return K[":id"]=F.primaryKey,O!=null&&(K[ls(O)]=F.primaryKey),F})},hasGetAll:0<w.length&&"getAll"in _.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},w=q.schema,S=q.hasGetAll,q=w.tables.map(v),X={};return q.forEach(function(B){return X[B.name]=B}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(B){if(X[B])return X[B];throw new Error("Table '".concat(B,"' not found"))},MIN_KEY:-1/0,MAX_KEY:os(i),schema:w}}function Gd(r,i,l,d){return l=l.IDBKeyRange,i=Kd(i,l,d),{dbcore:r.dbcore.reduce(function(v,_){return _=_.create,a(a({},v),_(v))},i)}}function Qs(r,i){var l=i.db,l=Gd(r._middlewares,l,r._deps,i);r.core=l.dbcore,r.tables.forEach(function(d){var v=d.name;r.core.schema.tables.some(function(_){return _.name===v})&&(d.core=r.core.table(v),r[v]instanceof r.Table)&&(r[v].core=d.core)})}function Xs(r,i,l,d){l.forEach(function(v){var _=d[v];i.forEach(function(w){var S=(function q(X,B){return z(X,B)||(X=m(X))&&q(X,B)})(w,v);(!S||"value"in S&&S.value===void 0)&&(w===r.Transaction.prototype||w instanceof r.Transaction?I(w,v,{get:function(){return this.table(v)},set:function(q){k(this,v,{value:q,writable:!0,configurable:!0,enumerable:!0})}}):w[v]=new r.Table(v,_))})})}function Wi(r,i){i.forEach(function(l){for(var d in l)l[d]instanceof r.Table&&delete l[d]})}function Wd(r,i){return r._cfg.version-i._cfg.version}function Hd(r,i,l,d){var v=r._dbSchema,_=(l.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=Ki("$meta",Gl("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,v)),w=(_.create(l),_._completion.catch(d),_._reject.bind(_)),S=Ae.transless||Ae;Jn(function(){if(Ae.trans=_,Ae.transless=S,i!==0)return Qs(r,l),X=i,((q=_).storeNames.includes("$meta")?q.table("$meta").get("version").then(function(B){return B??X}):Oe.resolve(X)).then(function(ee){var O=r,U=ee,K=_,F=l,N=[],ee=O._versions,oe=O._dbSchema=Js(0,O.idbdb,F);return(ee=ee.filter(function(V){return V._cfg.version>=U})).length===0?Oe.resolve():(ee.forEach(function(V){N.push(function(){var _e,Te,je,Le=oe,Ce=V._cfg.dbschema,ze=($s(O,Le,F),$s(O,Ce,F),oe=O._dbSchema=Ce,Hi(Le,Ce)),Be=(ze.add.forEach(function(Pe){Vi(F,Pe[0],Pe[1].primKey,Pe[1].indexes)}),ze.change.forEach(function(Pe){if(Pe.recreate)throw new T.Upgrade("Not yet support for changing primary key");var Ue=F.objectStore(Pe.name);Pe.add.forEach(function(gt){return Zs(Ue,gt)}),Pe.change.forEach(function(gt){Ue.deleteIndex(gt.name),Zs(Ue,gt)}),Pe.del.forEach(function(gt){return Ue.deleteIndex(gt)})}),V._cfg.contentUpgrade);if(Be&&V._cfg.version>U)return Qs(O,F),K._memoizedTables={},_e=ue(Ce),ze.del.forEach(function(Pe){_e[Pe]=Le[Pe]}),Wi(O,[O.Transaction.prototype]),Xs(O,[O.Transaction.prototype],u(_e),_e),K.schema=_e,(Te=Se(Be))&&fn(),Ce=Oe.follow(function(){var Pe;(je=Be(K))&&Te&&(Pe=$n.bind(null,null),je.then(Pe,Pe))}),je&&typeof je.then=="function"?Oe.resolve(je):Ce.then(function(){return je})}),N.push(function(_e){var Te,je,Le=V._cfg.dbschema;Te=Le,je=_e,[].slice.call(je.db.objectStoreNames).forEach(function(Ce){return Te[Ce]==null&&je.db.deleteObjectStore(Ce)}),Wi(O,[O.Transaction.prototype]),Xs(O,[O.Transaction.prototype],O._storeNames,O._dbSchema),K.schema=O._dbSchema}),N.push(function(_e){O.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(O.idbdb.version/10)===V._cfg.version?(O.idbdb.deleteObjectStore("$meta"),delete O._dbSchema.$meta,O._storeNames=O._storeNames.filter(function(Te){return Te!=="$meta"})):_e.objectStore("$meta").put(V._cfg.version,"version"))})}),(function V(){return N.length?Oe.resolve(N.shift()(K.idbtrans)).then(V):Oe.resolve()})().then(function(){Kl(oe,F)}))}).catch(w);var q,X;u(v).forEach(function(B){Vi(l,B,v[B].primKey,v[B].indexes)}),Qs(r,l),Oe.follow(function(){return r.on.populate.fire(_)}).catch(w)})}function Vd(r,i){Kl(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var l=Js(0,r.idbdb,i);$s(r,r._dbSchema,i);for(var d=0,v=Hi(l,r._dbSchema).change;d<v.length;d++){var _=(w=>{if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=i.objectStore(w.name);w.add.forEach(function(q){tt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(q.src)),Zs(S,q)})})(v[d]);if(typeof _=="object")return _.value}}function Hi(r,i){var l,d={del:[],add:[],change:[]};for(l in r)i[l]||d.del.push(l);for(l in i){var v=r[l],_=i[l];if(v){var w={name:l,def:_,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(_.primKey.keyPath||"")||v.primKey.auto!==_.primKey.auto)w.recreate=!0,d.change.push(w);else{var S=v.idxByName,q=_.idxByName,X=void 0;for(X in S)q[X]||w.del.push(X);for(X in q){var B=S[X],O=q[X];B?B.src!==O.src&&w.change.push(O):w.add.push(O)}(0<w.del.length||0<w.add.length||0<w.change.length)&&d.change.push(w)}}else d.add.push([l,_])}return d}function Vi(r,i,l,d){var v=r.db.createObjectStore(i,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});d.forEach(function(_){return Zs(v,_)})}function Kl(r,i){u(r).forEach(function(l){i.db.objectStoreNames.contains(l)||(tt&&console.debug("Dexie: Creating missing table",l),Vi(i,l,r[l].primKey,r[l].indexes))})}function Zs(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function Js(r,i,l){var d={};return ce(i.objectStoreNames,0).forEach(function(v){for(var _=l.objectStore(v),w=Ui(zl(X=_.keyPath),X||"",!0,!1,!!_.autoIncrement,X&&typeof X!="string",!0),S=[],q=0;q<_.indexNames.length;++q){var B=_.index(_.indexNames[q]),X=B.keyPath,B=Ui(B.name,X,!!B.unique,!!B.multiEntry,!1,X&&typeof X!="string",!1);S.push(B)}d[v]=Ki(v,w,S)}),d}function $s(r,i,l){for(var d=l.db.objectStoreNames,v=0;v<d.length;++v){var _=d[v],w=l.objectStore(_);r._hasGetAll="getAll"in w;for(var S=0;S<w.indexNames.length;++S){var q,X=w.indexNames[S],B=w.index(X).keyPath,B=typeof B=="string"?B:"["+ce(B).join("+")+"]";i[_]&&(q=i[_].idxByName[B])&&(q.name=X,delete i[_].idxByName[B],i[_].idxByName[X]=q)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Gl(r){return r.split(",").map(function(i,l){var v=i.split(":"),d=(d=v[1])==null?void 0:d.trim(),v=(i=v[0].trim()).replace(/([&*]|\+\+)/g,""),_=/^\[/.test(v)?v.match(/^\[(.*)\]$/)[1].split("+"):v;return Ui(v,_||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),f(_),l===0,d)})}Da.prototype._createTableSchema=Ki,Da.prototype._parseIndexSyntax=Gl,Da.prototype._parseStoresSpec=function(r,i){var l=this;u(r).forEach(function(d){if(r[d]!==null){var v=l._parseIndexSyntax(r[d]),_=v.shift();if(!_)throw new T.Schema("Invalid schema for table "+d+": "+r[d]);if(_.unique=!0,_.multi)throw new T.Schema("Primary key cannot be multiEntry*");v.forEach(function(w){if(w.auto)throw new T.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new T.Schema("Index must have a name and cannot be an empty string")}),_=l._createTableSchema(d,_,v),i[d]=_}})},Da.prototype.stores=function(l){var i=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,l):l,i._versions),d={},v={};return l.forEach(function(_){h(d,_._cfg.storesSource),v=_._cfg.dbschema={},_._parseStoresSpec(d,v)}),i._dbSchema=v,Wi(i,[i._allTables,i,i.Transaction.prototype]),Xs(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],u(v),v),i._storeNames=u(v),this},Da.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Xe(this._cfg.contentUpgrade||$,r),this};var Yd=Da;function Da(){}function Yi(r,i){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new Tr(wn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Qi(r){return r&&typeof r.databases=="function"}function Xi(r){return Jn(function(){return Ae.letThrough=!0,r()})}function Zi(r){return!("from"in r)}var vn=function(r,i){var l;if(!this)return l=new vn,r&&"d"in r&&h(l,r),l;h(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function cs(r,i,l){var d=ht(i,l);if(!isNaN(d)){if(0<d)throw RangeError();if(Zi(r))return h(r,{from:i,to:l,d:1});var d=r.l,v=r.r;if(ht(l,r.from)<0)return d?cs(d,i,l):r.l={from:i,to:l,d:1,l:null,r:null},Hl(r);if(0<ht(i,r.to))return v?cs(v,i,l):r.r={from:i,to:l,d:1,l:null,r:null},Hl(r);ht(i,r.from)<0&&(r.from=i,r.l=null,r.d=v?v.d+1:1),0<ht(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),i=!r.r,d&&!r.l&&us(r,d),v&&i&&us(r,v)}}function us(r,i){Zi(i)||(function l(d,v){var _=v.from,w=v.l,S=v.r;cs(d,_,v.to),w&&l(d,w),S&&l(d,S)})(r,i)}function Wl(r,i){var l=ei(i),d=l.next();if(!d.done)for(var v=d.value,_=ei(r),w=_.next(v.from),S=w.value;!d.done&&!w.done;){if(ht(S.from,v.to)<=0&&0<=ht(S.to,v.from))return!0;ht(v.from,S.from)<0?v=(d=l.next(S.from)).value:S=(w=_.next(v.from)).value}return!1}function ei(r){var i=Zi(r)?null:{s:0,n:r};return{next:function(l){for(var d=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,d)for(;i.n.l&&ht(l,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!d||ht(l,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Hl(r){var i,l,d,v=(((v=r.r)==null?void 0:v.d)||0)-(((v=r.l)==null?void 0:v.d)||0),v=1<v?"r":v<-1?"l":"";v&&(i=v=="r"?"l":"r",l=a({},r),d=r[v],r.from=d.from,r.to=d.to,r[v]=d[v],l[v]=d[i],(r[i]=l).d=Vl(l)),r.d=Vl(r)}function Vl(l){var i=l.r,l=l.l;return(i?l?Math.max(i.d,l.d):i.d:l?l.d:0)+1}function ti(r,i){return u(i).forEach(function(l){r[l]?us(r[l],i[l]):r[l]=(function d(v){var _,w,S={};for(_ in v)x(v,_)&&(w=v[_],S[_]=!w||typeof w!="object"||be.has(w.constructor)?w:d(w));return S})(i[l])}),r}function Ji(r,i){return r.all||i.all||Object.keys(r).some(function(l){return i[l]&&Wl(i[l],r[l])})}b(vn.prototype,((Ze={add:function(r){return us(this,r),this},addKey:function(r){return cs(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(l){return cs(i,l,l)}),this},hasKey:function(r){var i=ei(this).next(r).value;return i&&ht(i.from,r)<=0&&0<=ht(i.to,r)}})[he]=function(){return ei(this)},Ze));var aa={},$i={},eo=!1;function ni(r){ti($i,r),eo||(eo=!0,setTimeout(function(){eo=!1,to($i,!($i={}))},0))}function to(r,i){i===void 0&&(i=!1);var l=new Set;if(r.all)for(var d=0,v=Object.values(aa);d<v.length;d++)Yl(S=v[d],r,l,i);else for(var _ in r){var w,S,_=/^idb\:\/\/(.*)\/(.*)\//.exec(_);_&&(w=_[1],_=_[2],S=aa["idb://".concat(w,"/").concat(_)])&&Yl(S,r,l,i)}l.forEach(function(q){return q()})}function Yl(r,i,l,d){for(var v=[],_=0,w=Object.entries(r.queries.query);_<w.length;_++){for(var S=w[_],q=S[0],X=[],B=0,O=S[1];B<O.length;B++){var U=O[B];Ji(i,U.obsSet)?U.subscribers.forEach(function(ee){return l.add(ee)}):d&&X.push(U)}d&&v.push([q,X])}if(d)for(var K=0,F=v;K<F.length;K++){var N=F[K],q=N[0],X=N[1];r.queries.query[q]=X}}function Qd(r){var i=r._state,l=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?De(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var d=i.openCanceller,v=Math.round(10*r.verno),_=!1;function w(){if(i.openCanceller!==d)throw new T.DatabaseClosed("db.open() was cancelled")}function S(){return new Oe(function(U,K){if(w(),!l)throw new T.MissingAPI;var F=r.name,N=i.autoSchema||!v?l.open(F):l.open(F,v);if(!N)throw new T.MissingAPI;N.onerror=pr(K),N.onblocked=Ot(r._fireOnBlocked),N.onupgradeneeded=Ot(function(ee){var oe;B=N.transaction,i.autoSchema&&!r._options.allowEmptyDB?(N.onerror=ss,B.abort(),N.result.close(),(oe=l.deleteDatabase(F)).onsuccess=oe.onerror=Ot(function(){K(new T.NoSuchDatabase("Database ".concat(F," doesnt exist")))})):(B.onerror=pr(K),oe=ee.oldVersion>Math.pow(2,62)?0:ee.oldVersion,O=oe<1,r.idbdb=N.result,_&&Vd(r,B),Hd(r,oe/10,B,K))},K),N.onsuccess=Ot(function(){B=null;var ee,oe,V,_e,Te,je,Le=r.idbdb=N.result,Ce=ce(Le.objectStoreNames);if(0<Ce.length)try{var ze=Le.transaction((Te=Ce).length===1?Te[0]:Te,"readonly");if(i.autoSchema)je=Le,_e=ze,(V=r).verno=je.version/10,_e=V._dbSchema=Js(0,je,_e),V._storeNames=ce(je.objectStoreNames,0),Xs(V,[V._allTables],u(_e),_e);else if($s(r,r._dbSchema,ze),oe=ze,((oe=Hi(Js(0,(ee=r).idbdb,oe),ee._dbSchema)).add.length||oe.change.some(function(Be){return Be.add.length||Be.change.length}))&&!_)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Le.close(),v=Le.version+1,_=!0,U(S());Qs(r,ze)}catch{}Ht.push(r),Le.onversionchange=Ot(function(Be){i.vcFired=!0,r.on("versionchange").fire(Be)}),Le.onclose=Ot(function(){r.close({disableAutoOpen:!1})}),O&&(Ce=r._deps,Te=F,Qi(je=Ce.indexedDB)||Te===wn||Yi(je,Ce.IDBKeyRange).put({name:Te}).catch($)),U()},K)}).catch(function(U){switch(U==null?void 0:U.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<v)return v=0,S()}return Oe.reject(U)})}var q,X=i.dbReadyResolve,B=null,O=!1;return Oe.race([d,(typeof navigator>"u"?Oe.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(U){function K(){return indexedDB.databases().finally(U)}q=setInterval(K,100),K()}).finally(function(){return clearInterval(q)}):Promise.resolve()).then(S)]).then(function(){return w(),i.onReadyBeingFired=[],Oe.resolve(Xi(function(){return r.on.ready.fire(r.vip)})).then(function U(){var K;if(0<i.onReadyBeingFired.length)return K=i.onReadyBeingFired.reduce(Xe,$),i.onReadyBeingFired=[],Oe.resolve(Xi(function(){return K(r.vip)})).then(U)})}).finally(function(){i.openCanceller===d&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(U){i.dbOpenError=U;try{B&&B.abort()}catch{}return d===i.openCanceller&&r._close(),De(U)}).finally(function(){i.openComplete=!0,X()}).then(function(){var U;return O&&(U={},r.tables.forEach(function(K){K.schema.indexes.forEach(function(F){F.name&&(U["idb://".concat(r.name,"/").concat(K.name,"/").concat(F.name)]=new vn(-1/0,[[[]]]))}),U["idb://".concat(r.name,"/").concat(K.name,"/")]=U["idb://".concat(r.name,"/").concat(K.name,"/:dels")]=new vn(-1/0,[[[]]])}),zr(is).fire(U),to(U,!0)),r})}function no(r){function i(_){return r.next(_)}var l=v(i),d=v(function(_){return r.throw(_)});function v(_){return function(S){var S=_(S),q=S.value;return S.done?q:q&&typeof q.then=="function"?q.then(l,d):f(q)?Promise.all(q).then(l,d):l(q)}}return v(i)()}function ri(r,i,l){for(var d=f(r)?r.slice():[r],v=0;v<l;++v)d.push(i);return d}var Xd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(d){var l=r.table(d),d=l.schema,v={},_=[];function w(U,K,F){var V=ls(U),N=v[V]=v[V]||[],ee=U==null?0:typeof U=="string"?1:U.length,oe=0<K,V=a(a({},F),{name:oe?"".concat(V,"(virtual-from:").concat(F.name,")"):F.name,lowLevelIndex:F,isVirtual:oe,keyTail:K,keyLength:ee,extractKey:Gi(U),unique:!oe&&F.unique});return N.push(V),V.isPrimaryKey||_.push(V),1<ee&&w(ee===2?U[0]:U.slice(0,ee-1),K+1,F),N.sort(function(_e,Te){return _e.keyTail-Te.keyTail}),V}var S=w(d.primaryKey.keyPath,0,d.primaryKey);v[":id"]=[S];for(var q=0,X=d.indexes;q<X.length;q++){var B=X[q];w(B.keyPath,0,B)}function O(U){var K,F=U.query.index;return F.isVirtual?a(a({},U),{query:{index:F.lowLevelIndex,range:(K=U.query.range,F=F.keyTail,{type:K.type===1?2:K.type,lower:ri(K.lower,K.lowerOpen?r.MAX_KEY:r.MIN_KEY,F),lowerOpen:!0,upper:ri(K.upper,K.upperOpen?r.MIN_KEY:r.MAX_KEY,F),upperOpen:!0})}}):U}return a(a({},l),{schema:a(a({},d),{primaryKey:S,indexes:_,getIndexByKeyPath:function(U){return(U=v[ls(U)])&&U[0]}}),count:function(U){return l.count(O(U))},query:function(U){return l.query(O(U))},openCursor:function(U){var K=U.query.index,F=K.keyTail,N=K.keyLength;return K.isVirtual?l.openCursor(O(U)).then(function(oe){return oe&&ee(oe)}):l.openCursor(U);function ee(oe){return Object.create(oe,{continue:{value:function(V){V!=null?oe.continue(ri(V,U.reverse?r.MAX_KEY:r.MIN_KEY,F)):U.unique?oe.continue(oe.key.slice(0,N).concat(U.reverse?r.MIN_KEY:r.MAX_KEY,F)):oe.continue()}},continuePrimaryKey:{value:function(V,_e){oe.continuePrimaryKey(ri(V,r.MAX_KEY,F),_e)}},primaryKey:{get:function(){return oe.primaryKey}},key:{get:function(){var V=oe.key;return N===1?V[0]:V.slice(0,N)}},value:{get:function(){return oe.value}}})}}})}})}};function ro(r,i,l,d){return l=l||{},d=d||"",u(r).forEach(function(v){var _,w,S;x(i,v)?(_=r[v],w=i[v],typeof _=="object"&&typeof w=="object"&&_&&w?(S=ae(_))!==ae(w)?l[d+v]=i[v]:S==="Object"?ro(_,w,l,d+v+"."):_!==w&&(l[d+v]=i[v]):_!==w&&(l[d+v]=i[v])):l[d+v]=void 0}),u(i).forEach(function(v){x(r,v)||(l[d+v]=i[v])}),l}function ao(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var Zd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(i){var l=r.table(i),d=l.schema.primaryKey;return a(a({},l),{mutate:function(v){var _=Ae.trans,w=_.table(i).hook,S=w.deleting,q=w.creating,X=w.updating;switch(v.type){case"add":if(q.fire===$)break;return _._promise("readwrite",function(){return B(v)},!0);case"put":if(q.fire===$&&X.fire===$)break;return _._promise("readwrite",function(){return B(v)},!0);case"delete":if(S.fire===$)break;return _._promise("readwrite",function(){return B(v)},!0);case"deleteRange":if(S.fire===$)break;return _._promise("readwrite",function(){return(function O(U,K,F){return l.query({trans:U,values:!1,query:{index:d,range:K},limit:F}).then(function(N){var ee=N.result;return B({type:"delete",keys:ee,trans:U}).then(function(oe){return 0<oe.numFailures?Promise.reject(oe.failures[0]):ee.length<F?{failures:[],numFailures:0,lastResult:void 0}:O(U,a(a({},K),{lower:ee[ee.length-1],lowerOpen:!0}),F)})})})(v.trans,v.range,1e4)},!0)}return l.mutate(v);function B(O){var U,K,F,N=Ae.trans,ee=O.keys||ao(d,O);if(ee)return(O=O.type==="add"||O.type==="put"?a(a({},O),{keys:ee}):a({},O)).type!=="delete"&&(O.values=s([],O.values)),O.keys&&(O.keys=s([],O.keys)),U=l,F=ee,((K=O).type==="add"?Promise.resolve([]):U.getMany({trans:K.trans,keys:F,cache:"immutable"})).then(function(oe){var V=ee.map(function(_e,Te){var je,Le,Ce,ze=oe[Te],Be={onerror:null,onsuccess:null};return O.type==="delete"?S.fire.call(Be,_e,ze,N):O.type==="add"||ze===void 0?(je=q.fire.call(Be,_e,O.values[Te],N),_e==null&&je!=null&&(O.keys[Te]=_e=je,d.outbound||P(O.values[Te],d.keyPath,_e))):(je=ro(ze,O.values[Te]),(Le=X.fire.call(Be,je,_e,ze,N))&&(Ce=O.values[Te],Object.keys(Le).forEach(function(Pe){x(Ce,Pe)?Ce[Pe]=Le[Pe]:P(Ce,Pe,Le[Pe])}))),Be});return l.mutate(O).then(function(_e){for(var Te=_e.failures,je=_e.results,Le=_e.numFailures,_e=_e.lastResult,Ce=0;Ce<ee.length;++Ce){var ze=(je||ee)[Ce],Be=V[Ce];ze==null?Be.onerror&&Be.onerror(Te[Ce]):Be.onsuccess&&Be.onsuccess(O.type==="put"&&oe[Ce]?O.values[Ce]:ze)}return{failures:Te,results:je,numFailures:Le,lastResult:_e}}).catch(function(_e){return V.forEach(function(Te){return Te.onerror&&Te.onerror(_e)}),Promise.reject(_e)})});throw new Error("Keys missing")}}})}})}};function Ql(r,i,l){try{if(!i||i.keys.length<r.length)return null;for(var d=[],v=0,_=0;v<i.keys.length&&_<r.length;++v)ht(i.keys[v],r[_])===0&&(d.push(l?J(i.values[v]):i.values[v]),++_);return d.length===r.length?d:null}catch{return null}}var Jd={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var l=r.table(i);return a(a({},l),{getMany:function(d){var v;return d.cache?(v=Ql(d.keys,d.trans._cache,d.cache==="clone"))?Oe.resolve(v):l.getMany(d).then(function(_){return d.trans._cache={keys:d.keys,values:d.cache==="clone"?J(_):_},_}):l.getMany(d)},mutate:function(d){return d.type!=="add"&&(d.trans._cache=null),l.mutate(d)}})}}}};function Xl(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Zl(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var $d={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,l=new vn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(d,v,_){if(Ae.subscr&&v!=="readonly")throw new T.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Ae.querier));return r.transaction(d,v,_)},table:function(d){function v(ee){var N,ee=ee.query;return[N=ee.index,new vn((N=(ee=ee.range).lower)!=null?N:r.MIN_KEY,(N=ee.upper)!=null?N:r.MAX_KEY)]}var _=r.table(d),w=_.schema,S=w.primaryKey,q=w.indexes,X=S.extractKey,B=S.outbound,O=S.autoIncrement&&q.filter(function(F){return F.compound&&F.keyPath.includes(S.keyPath)}),U=a(a({},_),{mutate:function(F){function N(Ue){return Ue="idb://".concat(i,"/").concat(d,"/").concat(Ue),Te[Ue]||(Te[Ue]=new vn)}var ee,oe,V,_e=F.trans,Te=F.mutatedParts||(F.mutatedParts={}),je=N(""),Le=N(":dels"),Ce=F.type,Be=F.type==="deleteRange"?[F.range]:F.type==="delete"?[F.keys]:F.values.length<50?[ao(S,F).filter(function(Ue){return Ue}),F.values]:[],ze=Be[0],Be=Be[1],Pe=F.trans._cache;return f(ze)?(je.addKeys(ze),(Ce=Ce==="delete"||ze.length===Be.length?Ql(ze,Pe):null)||Le.addKeys(ze),(Ce||Be)&&(ee=N,oe=Ce,V=Be,w.indexes.forEach(function(Ue){var gt=ee(Ue.name||"");function wt(it){return it!=null?Ue.extractKey(it):null}function Je(it){Ue.multiEntry&&f(it)?it.forEach(function(Kt){return gt.addKey(Kt)}):gt.addKey(it)}(oe||V).forEach(function(it,Wt){var zn=oe&&wt(oe[Wt]),Wt=V&&wt(V[Wt]);ht(zn,Wt)!==0&&(zn!=null&&Je(zn),Wt!=null)&&Je(Wt)})}))):ze?(Be={from:(Pe=ze.lower)!=null?Pe:r.MIN_KEY,to:(Ce=ze.upper)!=null?Ce:r.MAX_KEY},Le.add(Be),je.add(Be)):(je.add(l),Le.add(l),w.indexes.forEach(function(Ue){return N(Ue.name).add(l)})),_.mutate(F).then(function(Ue){return!ze||F.type!=="add"&&F.type!=="put"||(je.addKeys(Ue.results),O&&O.forEach(function(gt){for(var wt=F.values.map(function(zn){return gt.extractKey(zn)}),Je=gt.keyPath.findIndex(function(zn){return zn===S.keyPath}),it=0,Kt=Ue.results.length;it<Kt;++it)wt[it][Je]=Ue.results[it];N(gt.name).addKeys(wt)})),_e.mutatedParts=ti(_e.mutatedParts||{},Te),Ue})}}),K={get:function(F){return[S,new vn(F.key)]},getMany:function(F){return[S,new vn().addKeys(F.keys)]},count:v,query:v,openCursor:v};return u(K).forEach(function(F){U[F]=function(N){var ee=Ae.subscr,oe=!!ee,V=Xl(Ae,_)&&Zl(F,N)?N.obsSet={}:ee;if(oe){var _e,ee=function(Be){return Be="idb://".concat(i,"/").concat(d,"/").concat(Be),V[Be]||(V[Be]=new vn)},Te=ee(""),je=ee(":dels"),oe=K[F](N),Le=oe[0],oe=oe[1];if((F==="query"&&Le.isPrimaryKey&&!N.values?je:ee(Le.name||"")).add(oe),!Le.isPrimaryKey){if(F!=="count")return _e=F==="query"&&B&&N.values&&_.query(a(a({},N),{values:!1})),_[F].apply(this,arguments).then(function(Be){if(F==="query"){if(B&&N.values)return _e.then(function(wt){return wt=wt.result,Te.addKeys(wt),Be});var Pe=N.values?Be.result.map(X):Be.result;(N.values?Te:je).addKeys(Pe)}else{var Ue,gt;if(F==="openCursor")return gt=N.values,(Ue=Be)&&Object.create(Ue,{key:{get:function(){return je.addKey(Ue.primaryKey),Ue.key}},primaryKey:{get:function(){var wt=Ue.primaryKey;return je.addKey(wt),wt}},value:{get:function(){return gt&&Te.addKey(Ue.primaryKey),Ue.value}}})}return Be});je.add(l)}}return _[F].apply(this,arguments)}}),U}})}};function Jl(r,i,l){var d;return l.numFailures===0?i:i.type==="deleteRange"||(d=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,l.numFailures===d)?null:(d=a({},i),f(d.keys)&&(d.keys=d.keys.filter(function(v,_){return!(_ in l.failures)})),"values"in d&&f(d.values)&&(d.values=d.values.filter(function(v,_){return!(_ in l.failures)})),d)}function so(r,i){return l=r,((d=i).lower===void 0||(d.lowerOpen?0<ht(l,d.lower):0<=ht(l,d.lower)))&&(l=r,(d=i).upper===void 0||(d.upperOpen?ht(l,d.upper)<0:ht(l,d.upper)<=0));var l,d}function $l(r,i,l,d,v,_){var w,S,q,X,B,O;return!l||l.length===0||(w=i.query.index,S=w.multiEntry,q=i.query.range,X=d.schema.primaryKey.extractKey,B=w.extractKey,O=(w.lowLevelIndex||w).extractKey,(d=l.reduce(function(U,K){var F=U,N=[];if(K.type==="add"||K.type==="put")for(var ee=new vn,oe=K.values.length-1;0<=oe;--oe){var V,_e=K.values[oe],Te=X(_e);!ee.hasKey(Te)&&(V=B(_e),S&&f(V)?V.some(function(Be){return so(Be,q)}):so(V,q))&&(ee.addKey(Te),N.push(_e))}switch(K.type){case"add":var je=new vn().addKeys(i.values?U.map(function(Pe){return X(Pe)}):U),F=U.concat(i.values?N.filter(function(Pe){return Pe=X(Pe),!je.hasKey(Pe)&&(je.addKey(Pe),!0)}):N.map(function(Pe){return X(Pe)}).filter(function(Pe){return!je.hasKey(Pe)&&(je.addKey(Pe),!0)}));break;case"put":var Le=new vn().addKeys(K.values.map(function(Pe){return X(Pe)}));F=U.filter(function(Pe){return!Le.hasKey(i.values?X(Pe):Pe)}).concat(i.values?N:N.map(function(Pe){return X(Pe)}));break;case"delete":var Ce=new vn().addKeys(K.keys);F=U.filter(function(Pe){return!Ce.hasKey(i.values?X(Pe):Pe)});break;case"deleteRange":var ze=K.range;F=U.filter(function(Pe){return!so(X(Pe),ze)})}return F},r))===r)?r:(d.sort(function(U,K){return ht(O(U),O(K))||ht(X(U),X(K))}),i.limit&&i.limit<1/0&&(d.length>i.limit?d.length=i.limit:r.length===i.limit&&d.length<i.limit&&(v.dirty=!0)),_?Object.freeze(d):d)}function ec(r,i){return ht(r.lower,i.lower)===0&&ht(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function ef(r,i){return((l,d,v,_)=>{if(l===void 0)return d!==void 0?-1:0;if(d===void 0)return 1;if((l=ht(l,d))===0){if(v&&_)return 0;if(v)return 1;if(_)return-1}return l})(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=((l,d,v,_)=>{if(l===void 0)return d!==void 0?1:0;if(d===void 0)return-1;if((l=ht(l,d))===0){if(v&&_)return 0;if(v)return-1;if(_)return 1}return l})(r.upper,i.upper,r.upperOpen,i.upperOpen)}function tf(r,i,l,d){r.subscribers.add(l),d.addEventListener("abort",function(){var v,_;r.subscribers.delete(l),r.subscribers.size===0&&(v=r,_=i,setTimeout(function(){v.subscribers.size===0&&le(_,v)},3e3))})}var nf={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return a(a({},r),{transaction:function(l,d,v){var _,w,S=r.transaction(l,d,v);return d==="readwrite"&&(v=(_=new AbortController).signal,S.addEventListener("abort",(w=function(q){return function(){if(_.abort(),d==="readwrite"){for(var X=new Set,B=0,O=l;B<O.length;B++){var U=O[B],K=aa["idb://".concat(i,"/").concat(U)];if(K){var F=r.table(U),N=K.optimisticOps.filter(function(Ue){return Ue.trans===S});if(S._explicit&&q&&S.mutatedParts)for(var ee=0,oe=Object.values(K.queries.query);ee<oe.length;ee++)for(var V=0,_e=(Le=oe[ee]).slice();V<_e.length;V++)Ji((Ce=_e[V]).obsSet,S.mutatedParts)&&(le(Le,Ce),Ce.subscribers.forEach(function(Ue){return X.add(Ue)}));else if(0<N.length){K.optimisticOps=K.optimisticOps.filter(function(Ue){return Ue.trans!==S});for(var Te=0,je=Object.values(K.queries.query);Te<je.length;Te++)for(var Le,Ce,ze,Be=0,Pe=(Le=je[Te]).slice();Be<Pe.length;Be++)(Ce=Pe[Be]).res!=null&&S.mutatedParts&&(q&&!Ce.dirty?(ze=Object.isFrozen(Ce.res),ze=$l(Ce.res,Ce.req,N,F,Ce,ze),Ce.dirty?(le(Le,Ce),Ce.subscribers.forEach(function(Ue){return X.add(Ue)})):ze!==Ce.res&&(Ce.res=ze,Ce.promise=Oe.resolve({result:ze}))):(Ce.dirty&&le(Le,Ce),Ce.subscribers.forEach(function(Ue){return X.add(Ue)})))}}}X.forEach(function(Ue){return Ue()})}}})(!1),{signal:v}),S.addEventListener("error",w(!1),{signal:v}),S.addEventListener("complete",w(!0),{signal:v})),S},table:function(l){var d=r.table(l),v=d.schema.primaryKey;return a(a({},d),{mutate:function(_){var w,S=Ae.trans;return!v.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(w=aa["idb://".concat(i,"/").concat(l)])?(S=d.mutate(_),_.type!=="add"&&_.type!=="put"||!(50<=_.values.length||ao(v,_).some(function(q){return q==null}))?(w.optimisticOps.push(_),_.mutatedParts&&ni(_.mutatedParts),S.then(function(q){0<q.numFailures&&(le(w.optimisticOps,_),(q=Jl(0,_,q))&&w.optimisticOps.push(q),_.mutatedParts)&&ni(_.mutatedParts)}),S.catch(function(){le(w.optimisticOps,_),_.mutatedParts&&ni(_.mutatedParts)})):S.then(function(q){var X=Jl(0,a(a({},_),{values:_.values.map(function(B,O){var U;return q.failures[O]?B:(P(U=(U=v.keyPath)!=null&&U.includes(".")?J(B):a({},B),v.keyPath,q.results[O]),U)})}),q);w.optimisticOps.push(X),queueMicrotask(function(){return _.mutatedParts&&ni(_.mutatedParts)})}),S):d.mutate(_)},query:function(_){var w,S,q,X,B,O,U;return Xl(Ae,d)&&Zl("query",_)?(w=((q=Ae.trans)==null?void 0:q.db._options.cache)==="immutable",S=(q=Ae).requery,q=q.signal,O=((K,F,N,ee)=>{var oe=aa["idb://".concat(K,"/").concat(F)];if(!oe)return[];if(!(K=oe.queries[N]))return[null,!1,oe,null];var V=K[(ee.query?ee.query.index.name:null)||""];if(!V)return[null,!1,oe,null];switch(N){case"query":var _e=V.find(function(Te){return Te.req.limit===ee.limit&&Te.req.values===ee.values&&ec(Te.req.query.range,ee.query.range)});return _e?[_e,!0,oe,V]:[V.find(function(Te){return("limit"in Te.req?Te.req.limit:1/0)>=ee.limit&&(!ee.values||Te.req.values)&&ef(Te.req.query.range,ee.query.range)}),!1,oe,V];case"count":return _e=V.find(function(Te){return ec(Te.req.query.range,ee.query.range)}),[_e,!!_e,oe,V]}})(i,l,"query",_),U=O[0],X=O[2],B=O[3],U&&O[1]?U.obsSet=_.obsSet:(O=d.query(_).then(function(K){var F=K.result;if(U&&(U.res=F),w){for(var N=0,ee=F.length;N<ee;++N)Object.freeze(F[N]);Object.freeze(F)}else K.result=J(F);return K}).catch(function(K){return B&&U&&le(B,U),Promise.reject(K)}),U={obsSet:_.obsSet,promise:O,subscribers:new Set,type:"query",req:_,dirty:!1},B?B.push(U):(B=[U],(X=X||(aa["idb://".concat(i,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[_.query.index.name||""]=B)),tf(U,B,S,q),U.promise.then(function(K){return{result:$l(K.result,_,X==null?void 0:X.optimisticOps,d,U,w)}})):d.query(_)}})}})}};function ai(r,i){return new Proxy(r,{get:function(l,d,v){return d==="db"?i:Reflect.get(l,d,v)}})}Vt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new T.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new T.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,l=i.filter(function(d){return d._cfg.version===r})[0];return l||(l=new this.Version(r),i.push(l),i.sort(Wd),l.stores({}),this._state.autoSchema=!1),l},Vt.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||Ae.letThrough||this._vip)?r():new Oe(function(l,d){if(i._state.openComplete)return d(new T.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void d(new T.DatabaseClosed);i.open().catch($)}i._state.dbReadyPromise.then(l,d)}).then(r)},Vt.prototype.use=function(v){var i=v.stack,l=v.create,d=v.level,v=v.name,_=(v&&this.unuse({stack:i,name:v}),this._middlewares[i]||(this._middlewares[i]=[]));return _.push({stack:i,create:l,level:d??10,name:v}),_.sort(function(w,S){return w.level-S.level}),this},Vt.prototype.unuse=function(r){var i=r.stack,l=r.name,d=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(v){return d?v.create!==d:!!l&&v.name!==l})),this},Vt.prototype.open=function(){var r=this;return Ge(Qe,function(){return Qd(r)})},Vt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,i=Ht.indexOf(this);if(0<=i&&Ht.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Oe(function(l){r.dbReadyResolve=l}),r.openCanceller=new Oe(function(l,d){r.cancelOpen=d}))},Vt.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,l=this._state;i?(l.isBeingOpened&&l.cancelOpen(new T.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new T.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Vt.prototype.delete=function(r){var i=this,l=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),d=this._state;return new Oe(function(v,_){function w(){i.close(r);var S=i._deps.indexedDB.deleteDatabase(i.name);S.onsuccess=Ot(function(){var q,X,B;q=i._deps,X=i.name,Qi(B=q.indexedDB)||X===wn||Yi(B,q.IDBKeyRange).delete(X).catch($),v()}),S.onerror=pr(_),S.onblocked=i._fireOnBlocked}if(l)throw new T.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(w):w()})},Vt.prototype.backendDB=function(){return this.idbdb},Vt.prototype.isOpen=function(){return this.idbdb!==null},Vt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Vt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Vt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Vt.prototype,"tables",{get:function(){var r=this;return u(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),Vt.prototype.transaction=function(){var r=(function(i,l,d){var v=arguments.length;if(v<2)throw new T.InvalidArgument("Too few arguments");for(var _=new Array(v-1);--v;)_[v-1]=arguments[v];return d=_.pop(),[i,ye(_),d]}).apply(this,arguments);return this._transaction.apply(this,r)},Vt.prototype._transaction=function(r,i,l){var d,v,_=this,w=Ae.trans,S=(w&&w.db===this&&r.indexOf("!")===-1||(w=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(v=i.map(function(X){if(X=X instanceof _.Table?X.name:X,typeof X!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return X}),r=="r"||r===vr)d=vr;else{if(r!="rw"&&r!=na)throw new T.InvalidArgument("Invalid transaction mode: "+r);d=na}if(w){if(w.mode===vr&&d===na){if(!S)throw new T.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&v.forEach(function(X){if(w&&w.storeNames.indexOf(X)===-1){if(!S)throw new T.SubTransaction("Table "+X+" not included in parent transaction.");w=null}}),S&&w&&!w.active&&(w=null)}}catch(X){return w?w._promise(null,function(B,O){O(X)}):De(X)}var q=(function X(B,O,U,K,F){return Oe.resolve().then(function(){var V=Ae.transless||Ae,N=B._createTransaction(O,U,B._dbSchema,K),V=(N.explicit=!0,{trans:N,transless:V});if(K)N.idbtrans=K.idbtrans;else try{N.create(),N.idbtrans._explicit=!0,B._state.PR1398_maxLoop=3}catch(_e){return _e.name===Me.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return X(B,O,U,null,F)})):De(_e)}var ee,oe=Se(F),V=(oe&&fn(),Oe.follow(function(){var _e;(ee=F.call(N,N))&&(oe?(_e=$n.bind(null,null),ee.then(_e,_e)):typeof ee.next=="function"&&typeof ee.throw=="function"&&(ee=no(ee)))},V));return(ee&&typeof ee.then=="function"?Oe.resolve(ee).then(function(_e){return N.active?_e:De(new T.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):V.then(function(){return ee})).then(function(_e){return K&&N._resolve(),N._completion.then(function(){return _e})}).catch(function(_e){return N._reject(_e),De(_e)})})}).bind(null,this,d,v,w,l);return w?w._promise(d,q,"lock"):Ae.trans?Ge(Ae.transless,function(){return _._whenReady(q)}):this._whenReady(q)},Vt.prototype.table=function(r){if(x(this._allTables,r))return this._allTables[r];throw new T.InvalidTable("Table ".concat(r," does not exist"))};var Tr=Vt;function Vt(r,i){var l,d,v,_,w,S=this,q=(this._middlewares={},this.verno=0,Vt.dependencies),q=(this._options=i=a({addons:Vt.addons,autoOpen:!0,indexedDB:q.indexedDB,IDBKeyRange:q.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),X=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:$,dbReadyPromise:null,cancelOpen:$,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),B=(X.dbReadyPromise=new Oe(function(O){X.dbReadyResolve=O}),X.openCanceller=new Oe(function(O,U){X.cancelOpen=U}),this._state=X,this.name=r,this.on=rs(this,"populate","blocked","versionchange","close",{ready:[Xe,$]}),this.once=function(O,U){var K=function(){for(var F=[],N=0;N<arguments.length;N++)F[N]=arguments[N];S.on(O).unsubscribe(K),U.apply(S,F)};return S.on(O,K)},this.on.ready.subscribe=ne(this.on.ready.subscribe,function(O){return function(U,K){Vt.vip(function(){var F,N=S._state;N.openComplete?(N.dbOpenError||Oe.resolve().then(U),K&&O(U)):N.onReadyBeingFired?(N.onReadyBeingFired.push(U),K&&O(U)):(O(U),F=S,K||O(function ee(){F.on.ready.unsubscribe(U),F.on.ready.unsubscribe(ee)}))})}}),this.Collection=(l=this,as(qd.prototype,function(ee,N){this.db=l;var K=ts,F=null;if(N)try{K=N()}catch(V){F=V}var N=ee._ctx,ee=N.table,oe=ee.hook.reading.fire;this._ctx={table:ee,index:N.index,isPrimKey:!N.index||ee.schema.primKey.keyPath&&N.index===ee.schema.primKey.name,range:K,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:F,or:N.or,valueMapper:oe!==Ee?oe:null}})),this.Table=(d=this,as(jl.prototype,function(O,U,K){this.db=d,this._tx=K,this.name=O,this.schema=U,this.hook=d._allTables[O]?d._allTables[O].hook:rs(null,{creating:[et,$],reading:[qe,Ee],updating:[nt,$],deleting:[rt,$]})})),this.Transaction=(v=this,as(zd.prototype,function(O,U,K,F,N){var ee=this;O!=="readonly"&&U.forEach(function(oe){oe=(oe=K[oe])==null?void 0:oe.yProps,oe&&(U=U.concat(oe.map(function(V){return V.updatesTable})))}),this.db=v,this.mode=O,this.storeNames=U,this.schema=K,this.chromeTransactionDurability=F,this.idbtrans=null,this.on=rs(this,"complete","error","abort"),this.parent=N||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Oe(function(oe,V){ee._resolve=oe,ee._reject=V}),this._completion.then(function(){ee.active=!1,ee.on.complete.fire()},function(oe){var V=ee.active;return ee.active=!1,ee.on.error.fire(oe),ee.parent?ee.parent._reject(oe):V&&ee.idbtrans&&ee.idbtrans.abort(),De(oe)})})),this.Version=(_=this,as(Yd.prototype,function(O){this.db=_,this._cfg={version:O,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(w=this,as(Fl.prototype,function(O,U,K){if(this.db=w,this._ctx={table:O,index:U===":id"?null:U,or:K},this._cmp=this._ascending=ht,this._descending=function(F,N){return ht(N,F)},this._max=function(F,N){return 0<ht(F,N)?F:N},this._min=function(F,N){return ht(F,N)<0?F:N},this._IDBKeyRange=w._deps.IDBKeyRange,!this._IDBKeyRange)throw new T.MissingAPI})),this.on("versionchange",function(O){0<O.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(O){!O.newVersion||O.newVersion<O.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(O.oldVersion/10))}),this._maxKey=os(i.IDBKeyRange),this._createTransaction=function(O,U,K,F){return new S.Transaction(O,U,K,S._options.chromeTransactionDurability,F)},this._fireOnBlocked=function(O){S.on("blocked").fire(O),Ht.filter(function(U){return U.name===S.name&&U!==S&&!U._state.vcFired}).map(function(U){return U.on("versionchange").fire(O)})},this.use(Jd),this.use(nf),this.use($d),this.use(Xd),this.use(Zd),new Proxy(this,{get:function(O,U,K){var F;return U==="_vip"||(U==="table"?function(N){return ai(S.table(N),B)}:(F=Reflect.get(O,U,K))instanceof jl?ai(F,B):U==="tables"?F.map(function(N){return ai(N,B)}):U==="_createTransaction"?function(){return ai(F.apply(this,arguments),B)}:F)}}));this.vip=B,q.forEach(function(O){return O(S)})}var si,ja=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",rf=(io.prototype.subscribe=function(r,i,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:l})},io.prototype[ja]=function(){return this},io);function io(r){this._subscribe=r}try{si={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{si={indexedDB:null,IDBKeyRange:null}}function tc(r){var i,l=!1,d=new rf(function(v){var _=Se(r),w,S=!1,q={},X={},B={get closed(){return S},unsubscribe:function(){S||(S=!0,w&&w.abort(),O&&zr.storagemutated.unsubscribe(K))}},O=(v.start&&v.start(B),!1),U=function(){return Ie(F)},K=function(N){ti(q,N),Ji(X,q)&&U()},F=function(){var N,ee,oe;!S&&si.indexedDB&&(q={},N={},w&&w.abort(),w=new AbortController,oe=(V=>{var _e=dr();try{_&&fn();var Te=Jn(r,V);return Te=_?Te.finally($n):Te}finally{_e&&Rn()}})(ee={subscr:N,signal:w.signal,requery:U,querier:r,trans:null}),Promise.resolve(oe).then(function(V){l=!0,i=V,S||ee.signal.aborted||(q={},(_e=>{for(var Te in _e)if(x(_e,Te))return;return 1})(X=N)||O||(zr(is,K),O=!0),Ie(function(){return!S&&v.next&&v.next(V)}))},function(V){l=!1,["DatabaseClosedError","AbortError"].includes(V==null?void 0:V.name)||S||Ie(function(){S||v.error&&v.error(V)})}))};return setTimeout(U,0),B});return d.hasValue=function(){return l},d.getValue=function(){return i},d}var sa=Tr;function oo(r){var i=Ur;try{Ur=!0,zr.storagemutated.fire(r),to(r,!0)}finally{Ur=i}}b(sa,a(a({},me),{delete:function(r){return new sa(r,{addons:[]}).delete()},exists:function(r){return new sa(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=sa.dependencies,l=i.indexedDB,i=i.IDBKeyRange,(Qi(l)?Promise.resolve(l.databases()).then(function(d){return d.map(function(v){return v.name}).filter(function(v){return v!==wn})}):Yi(l,i).toCollection().primaryKeys()).then(r)}catch{return De(new T.MissingAPI)}var i,l},defineClass:function(){return function(r){h(this,r)}},ignoreTransaction:function(r){return Ae.trans?Ge(Ae.transless,r):r()},vip:Xi,async:function(r){return function(){try{var i=no(r.apply(this,arguments));return i&&typeof i.then=="function"?i:Oe.resolve(i)}catch(l){return De(l)}}},spawn:function(r,i,l){try{var d=no(r.apply(l,i||[]));return d&&typeof d.then=="function"?d:Oe.resolve(d)}catch(v){return De(v)}},currentTransaction:{get:function(){return Ae.trans||null}},waitFor:function(r,i){return r=Oe.resolve(typeof r=="function"?sa.ignoreTransaction(r):r).timeout(i||6e4),Ae.trans?Ae.trans.waitFor(r):r},Promise:Oe,debug:{get:function(){return tt},set:function(r){vt(r)}},derive:L,extend:h,props:b,override:ne,Events:rs,on:zr,liveQuery:tc,extendObservabilitySet:ti,getByKeyPath:W,setByKeyPath:P,delByKeyPath:function(r,i){typeof i=="string"?P(r,i,void 0):"length"in i&&[].map.call(i,function(l){P(r,l,void 0)})},shallowClone:ue,deepClone:J,getObjectDiff:ro,cmp:ht,asap:Z,minKey:-1/0,addons:[],connections:Ht,errnames:Me,dependencies:si,cache:aa,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,l){return r+i/Math.pow(10,2*l)})})),sa.maxKey=os(sa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(zr(is,function(r){Ur||(r=new CustomEvent(zi,{detail:r}),Ur=!0,dispatchEvent(r),Ur=!1)}),addEventListener(zi,function(r){r=r.detail,Ur||oo(r)}));var La,Ur=!1,nc=function(){};return typeof BroadcastChannel<"u"&&((nc=function(){(La=new BroadcastChannel(zi)).onmessage=function(r){return r.data&&oo(r.data)}})(),typeof La.unref=="function"&&La.unref(),zr(is,function(r){Ur||La.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Tr.disableBfCache&&r.persisted){tt&&console.debug("Dexie: handling persisted pagehide"),La!=null&&La.close();for(var i=0,l=Ht;i<l.length;i++)l[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Tr.disableBfCache&&r.persisted&&(tt&&console.debug("Dexie: handling persisted pageshow"),nc(),oo({all:new vn(-1/0,[[]])}))})),Oe.rejectionMapper=function(r,i){return!r||r instanceof H||r instanceof TypeError||r instanceof SyntaxError||!r.name||!pe[r.name]?r:(i=new pe[r.name](i||r.message,r),"stack"in r&&I(i,"stack",{get:function(){return this.inner.stack}}),i)},vt(tt),a(Tr,Object.freeze({__proto__:null,Dexie:Tr,Entity:Rl,PropModification:ns,RangeSet:vn,add:function(r){return new ns({add:r})},cmp:ht,default:Tr,liveQuery:tc,mergeRanges:us,rangesOverlap:Wl,remove:function(r){return new ns({remove:r})},replacePrefix:function(r,i){return new ns({replacePrefix:[r,i]})}}),{default:Tr}),Tr})})(gi)),gi.exports}var Uv=zv();const No=Bv(Uv),bc=Symbol.for("Dexie"),hn=globalThis[bc]||(globalThis[bc]=No);if(No.semVer!==hn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${No.semVer} and ${hn.semVer}`);const{liveQuery:k1,mergeRanges:x1,rangesOverlap:S1,RangeSet:E1,cmp:T1,Entity:A1,PropModification:C1,replacePrefix:I1,add:R1,remove:O1,DexieYProvider:P1}=hn,He=new hn("me-ai-store");He.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});He.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});He.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});He.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});He.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});function Yu(t,e){return`${t}:${e}`}async function Is(t,e=null){try{const n=await He.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Rs(t,e){try{await He.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function dl(t){try{await He.settings.delete(t)}catch{}}async function Kv(t){const e=await He.settings.bulkGet(t);return Object.fromEntries(t.map((n,a)=>{var s;return[n,((s=e[a])==null?void 0:s.value)??null]}))}const Ra=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Is,getSettings:Kv,removeSetting:dl,setSetting:Rs},Symbol.toStringTag,{value:"Module"})),wr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function fl(t){return wr.find(e=>e.id===t)}const Gv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:wr,getModelInfo:fl},Symbol.toStringTag,{value:"Module"})),kr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Qu(){return kr.filter(t=>t.recommended)}function vl(t){return kr.find(e=>e.name===t||e.name.startsWith(t+":"))}const Wv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:kr,getOllamaModelInfo:vl,getRecommendedOllamaModels:Qu},Symbol.toStringTag,{value:"Module"}));let Sn=null,Pr="idle",_i=null,la=new Set;function ci(){return Sn||(Sn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Sn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Pr="loading"),e.status==="ready"&&(Pr="ready"),e.status==="start"&&(Pr="generating"),(e.status==="complete"||e.status==="error")&&(Pr=_i?"ready":"idle");for(const n of la)try{n(e)}catch{}})),Sn}function mo(){return{check(){ci().postMessage({type:"check"})},loadModel(t){_i=t,Pr="loading",ci().postMessage({type:"load",modelId:t})},generate(t,e){ci().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,f=0,h=0;const m=x=>{switch(x.status){case"start":h=x.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=x.output,u=x.tps??u,f=x.numTokens??f,n)try{n({tps:u,numTokens:f,text:o})}catch{}break;case"complete":y(),a({text:o,tps:u,numTokens:f,inputTokens:h});break;case"error":y(),s(new Error(x.data));break}},y=()=>{la.delete(m)};la.add(m),ci().postMessage({type:"generate",data:t,options:e})})},interrupt(){Sn==null||Sn.postMessage({type:"interrupt"})},reset(){Sn==null||Sn.postMessage({type:"reset"})},onMessage(t){return la.add(t),()=>la.delete(t)},offMessage(t){la.delete(t)},get status(){return Pr},get isReady(){return Pr==="ready"},get isGenerating(){return Pr==="generating"},get modelId(){return _i},terminate(){Sn==null||Sn.terminate(),Sn=null,Pr="idle",_i=null,la.clear()}}}const Hv="modulepreload",Vv=function(t){return"/me-ai/"+t},wc={},Lr=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let u=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),h=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=u(n.map(m=>{if(m=Vv(m),m in wc)return;wc[m]=!0;const y=m.endsWith(".css"),x=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${x}`))return;const b=document.createElement("link");if(b.rel=y?"stylesheet":Hv,y||(b.as="script"),b.crossOrigin="",b.href=m,h&&b.setAttribute("nonce",h),document.head.appendChild(b),y)return new Promise((k,I)=>{b.addEventListener("load",k),b.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return s.then(u=>{for(const f of u||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},kc="http://localhost:11434",Yv="https://me-ai.metaelon.space";function Xu(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?kc:Yv}catch{return kc}}function Fs(){return Xu()}async function Qv(){const{getSetting:t}=await Lr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Ra);return{getSetting:e}},void 0);return await t("ollamaUrl")||Xu()}async function Xv(t){const{setSetting:e}=await Lr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Ra);return{setSetting:n}},void 0);await e("ollamaUrl",t)}async function qo(t=Fs()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function Zv(t=Fs()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function Jv(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:s}={},o=()=>{},u=Fs()){var I;const f={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};s!==void 0?f.keep_alive=s:f.keep_alive="10m";const h=new AbortController,m=setTimeout(()=>h.abort(),3e5),y=await fetch(`${u}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f),signal:h.signal});if(clearTimeout(m),!y.ok){const L=await y.text();throw new Error(`Ollama API error: ${L}`)}const x=y.body.getReader(),b=new TextDecoder;let k="";try{for(;;){const{done:L,value:z}=await x.read();if(L)break;const ce=b.decode(z).split(`
`).filter(Boolean);for(const ne of ce)try{const R=JSON.parse(ne);if((I=R.message)!=null&&I.content&&(k+=R.message.content,o({content:R.message.content,done:!1,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration})),R.done){o({content:"",done:!0,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration});break}}catch{}}}finally{x.releaseLock()}return k}let Pn="idle",Na=null,ca=new Set;function tr(t){for(const e of ca)try{e(t)}catch{}}function $v(){return{async check(){Pn="loading",tr({status:"loading",data:"Testing Ollama connection..."});const t=await qo();t.connected?(Pn="idle",tr({status:"ready",data:{type:"ollama",version:t.version,url:Fs()}})):(Pn="idle",tr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Na=t,Pn="loading",tr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await qo();if(!e.connected){Pn="idle",Na=null,tr({status:"error",data:`Ollama not available: ${e.error}`});return}Pn="ready",tr({status:"ready"})},async generate(t,e={}){if(!Na){tr({status:"error",data:"No Ollama model selected"});return}Pn="generating",tr({status:"start",inputTokens:0});let n=0,a=performance.now();try{await Jv(Na,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},s=>{if(s.content){n++;const o=performance.now()-a,u=o>0?n/o*1e3:0;tr({status:"update",output:s.content,tps:Math.round(u*10)/10,numTokens:n})}s.done&&(Pn="ready",tr({status:"complete",tps:s.eval_duration?Math.round(s.eval_count/(s.eval_duration/1e9)*10)/10:null,numTokens:s.eval_count||n}))})}catch(s){Pn="ready",tr({status:"error",data:s.message})}},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,f=0,h=0;const m=x=>{switch(x.status){case"start":h=x.inputTokens||0;break;case"update":if(o+=x.output,u=x.tps??u,f=x.numTokens??f,n)try{n({tps:u,numTokens:f,text:o})}catch{}break;case"complete":y(),a({text:o,tps:u,numTokens:f,inputTokens:h});break;case"error":y(),s(new Error(x.data));break}},y=()=>{ca.delete(m)};ca.add(m),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return ca.add(t),()=>ca.delete(t)},offMessage(t){ca.delete(t)},get status(){return Pn},get isReady(){return Pn==="ready"},get isGenerating(){return Pn==="generating"},get modelId(){return Na},get backend(){return"ollama"},terminate(){Pn="idle",Na=null,ca.clear()}}}let oa=null,at=null,go=new Set;function ep(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function Zu(){return{loadModel(t){const e=ep(t);if(oa!==e){at&&at.terminate(),oa=e,at=e==="webgpu"?mo():$v();for(const n of go)at.onMessage(n)}at.loadModel(t)},check(){at||(at=mo(),oa="webgpu"),at.check()},generate(t,e){if(!at)throw new Error("No engine loaded. Call loadModel() first.");return at.generate(t,e)},generateFull(t,e,n){return at?at.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){at==null||at.interrupt()},reset(){at==null||at.reset()},onMessage(t){return at||(at=mo(),oa="webgpu"),go.add(t),at.onMessage(t)},offMessage(t){go.delete(t),at==null||at.offMessage(t)},get status(){return(at==null?void 0:at.status)||"idle"},get isReady(){return(at==null?void 0:at.isReady)||!1},get isGenerating(){return(at==null?void 0:at.isGenerating)||!1},get modelId(){return(at==null?void 0:at.modelId)||null},get backend(){return oa},getModelInfo(){const t=this.modelId;return t?oa==="webgpu"?fl(t):vl(t):null},terminate(){at==null||at.terminate(),at=null,oa=null}}}function Bo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function _o(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),s=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return s.toFixed(o)+" "+n[a]}function tp(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function np(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Mi(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const rp="https://gmail.googleapis.com/gmail/v1/users/me";class pl extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function ap(t){return{Authorization:`Bearer ${t}`}}async function Di(t,e){var a,s,o,u;const n=await fetch(`${rp}${e}`,{headers:ap(t)});if(!n.ok){const f=await n.json().catch(()=>({})),h=((a=f.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,m=((u=(o=(s=f.error)==null?void 0:s.errors)==null?void 0:o[0])==null?void 0:u.reason)||void 0;throw new pl(h,n.status,m)}return n.json()}function Ju(t){return Di(t,"/profile")}function $u(t,{maxResults:e=20,pageToken:n,q:a}={}){const s=new URLSearchParams;return s.set("maxResults",String(e)),n&&s.set("pageToken",n),a&&s.set("q",a),Di(t,`/messages?${s}`)}function ed(t,e,n="full"){return Di(t,`/messages/${e}?format=${n}`)}function sp(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const s=new URLSearchParams;return s.set("startHistoryId",e),s.set("maxResults",String(a)),s.append("historyTypes","messageAdded"),s.append("historyTypes","messageDeleted"),n&&s.set("pageToken",n),Di(t,`/history?${s}`)}function Gr(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),s=n.find(u=>u.name.toLowerCase()===a);return(s==null?void 0:s.value)||""}function Es(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),s=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(s)}function ip(t){var o,u,f;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Es(e.body.data);const n=e.parts||[],a=wi(n,"text/plain");if((u=a==null?void 0:a.body)!=null&&u.data)return Es(a.body.data);const s=wi(n,"text/html");if((f=s==null?void 0:s.body)!=null&&f.data){const h=Es(s.body.data);return lp(h)}return"(no body)"}function op(t){var s,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((s=e.body)!=null&&s.data))return Es(e.body.data);const n=e.parts||[],a=wi(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Es(a.body.data):null}function wi(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=wi(n.parts,e);if(a)return a}}return null}function lp(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function hl(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function td(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function nd(t){return td(t).charAt(0).toUpperCase()}function cp(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${s}`}catch{return"email"}}function up(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function rd(t,e){return`${cp(t.date)}_${up(t.subject)}.${e}`}function ad(t){const e={};for(const a of t){const s=a.action||"UNKNOWN";e[s]||(e[s]=[]),e[s].push(a)}for(const a of Object.keys(e))e[a].sort((s,o)=>(o.date||0)-(s.date||0));const n=Object.keys(e).sort((a,s)=>e[s].length-e[a].length);return{groups:e,order:n}}async function dp(){const t=await He.items.where("sourceType").equals("gmail").count(),e=await He.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:s}=await sd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`Date range: ${o} to ${u}.`)}return n.join(" ")}async function fp(){const t=await He.items.where("sourceType").equals("gmail").count(),e=await He.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:s}=await sd();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${u}`)}return n.join(`
`)}async function vp(t=10){const e=await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(id).join(`

---

`)}async function pp(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),s=(await He.items.where("sourceType").equals("gmail").toArray()).map(o=>{var f,h,m,y,x;let u=0;return(f=o.subject)!=null&&f.toLowerCase().includes(n)&&(u+=3),(h=o.from)!=null&&h.toLowerCase().includes(n)&&(u+=2),(m=o.to)!=null&&m.toLowerCase().includes(n)&&(u+=2),(y=o.snippet)!=null&&y.toLowerCase().includes(n)&&(u+=1),(x=o.body)!=null&&x.toLowerCase().includes(n)&&(u+=1),{item:o,score:u}}).filter(({score:o})=>o>0).sort((o,u)=>u.score-o.score).slice(0,e);return s.length===0?`No results found for "${t}".`:s.map(({item:o})=>id(o)).join(`

---

`)}async function xc(){const t=await He.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=ad(t);return{groups:e,order:n,total:t.length}}async function hp({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),u=await He.items.where("sourceType").equals("gmail").filter(f=>{var h,m,y,x;return((h=f.subject)==null?void 0:h.toLowerCase().includes(o))||((m=f.from)==null?void 0:m.toLowerCase().includes(o))||((y=f.to)==null?void 0:y.toLowerCase().includes(o))||((x=f.snippet)==null?void 0:x.toLowerCase().includes(o))}).toArray();return u.sort((f,h)=>(h.date||0)-(f.date||0)),{items:u.slice(n,n+e),total:u.length}}const a=await He.items.where("sourceType").equals("gmail").count();return{items:await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function sd(){const t=await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).first(),e=await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).last();return{oldest:t,newest:e}}function id(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=np(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function mp(){const t=await dp();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function gp(t){const e=[],n=await fp();if(e.push(n),t){const a=await pp(t,5);e.push("","## Relevant Emails",a)}else{const a=await vp(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const od="me-ai-events";async function zs(){const{getSetting:t}=await Lr(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Ra);return{getSetting:e}},void 0);return await t(od)||{}}async function ml(t){const{setSetting:e}=await Lr(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Ra);return{setSetting:n}},void 0);await e(od,t)}async function ld(){const t=await zs();return Object.keys(t).sort()}async function $a(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"";return(await zs())[e]||[]}const yo=$a;async function _p(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await zs();e in n||(n[e]=[],await ml(n))}async function yp(t){const e=t.toUpperCase(),n=await zs();delete n[e],await ml(n)}async function ji(t,e){const n=t.toUpperCase(),a=await zs();a[n]=e,await ml(a)}const bp=ji;async function wp(t,e){const n=await $a(t);await ji(t,[...n,e])}const kp=wp;async function xp(t,e){const n=await $a(t);await ji(t,n.filter(a=>a.id!==e))}const Sp=xp;async function Ep(t,e,n){const a=await $a(t);await ji(t,a.map(s=>s.id===e?{...s,...n}:s))}const Tp=Ep;async function Ap(t,e){var a;return{event:{type:"",source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((a=e.body)==null?void 0:a.slice(0,200))||""},metadata:{tag:t.action,reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},commands:[]}}async function Cp(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:a,commands:s}=await Ap(n.classification,n.email);return{event:a,commands:s}})),content:""}}async function Ip(t){const e=t.order.map(a=>{const o=(t.groups[a]||[]).map(u=>({emailId:u.emailId,subject:u.subject||"(no subject)",from:u.from||"",date:u.date,summary:u.summary||"",reason:u.reason||"",tags:u.tags||[],status:u.status||"pending"}));return{tag:a,emails:o}}),n=e.reduce((a,s)=>a+s.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}const Rp=20,Op={maxTokens:512},bs=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function cd(t,{count:e=Rp,force:n=!1,onProgress:a=()=>{},signal:s}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,u=0;if(n)o=await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(e).toArray();else{const ne=new Set(await He.emailClassifications.toCollection().primaryKeys());u=0,o=[],await He.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().until(()=>o.length>=e).each(R=>{ne.has(R.id)?u++:o.push(R)})}if(o.length===0){const ne=n?"No emails to scan.":`All emails already classified (${u} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:ne,classified:0}),{scanned:0,classified:0,skipped:u,errors:0}}const f=Date.now(),h=performance.now();let m=0,y=0,x=0,b=0;const k=[],I=t.modelId,L=fl(I)||vl(I);if(!L)throw new Error(`Unknown model: ${I}`);if(!L.recommendedForEmailProcessing&&o.length>0){const{MODELS:ne}=await Lr(async()=>{const{MODELS:P}=await Promise.resolve().then(()=>Gv);return{MODELS:P}},void 0),{OLLAMA_MODELS:R}=await Lr(async()=>{const{OLLAMA_MODELS:P}=await Promise.resolve().then(()=>Wv);return{OLLAMA_MODELS:P}},void 0),Z=[...ne.filter(P=>P.recommendedForEmailProcessing).map(P=>P.name),...R.filter(P=>P.recommendedForEmailProcessing).map(P=>P.displayName)],W=L.displayName||L.name;console.warn(`â ï¸ Current model (${W}) is not optimized for email processing. For best results with long emails, use: ${Z.join(", ")}. Some emails may fail due to memory limits.`)}for(let ne=0;ne<o.length&&!(s!=null&&s.aborted);ne++){const R=o[ne],Z=fd(R),W=[{role:"system",content:bs},{role:"user",content:Z}];a({phase:"scanning",current:ne+1,total:o.length,classified:m,errors:y,results:k,email:{subject:R.subject,from:R.from,date:R.date},prompt:{system:bs,user:Z},systemPromptLength:bs.length,live:null,lastResult:null,totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-h}});const P=performance.now();try{const{text:ue,tps:ke,numTokens:ye,inputTokens:be}=await t.generateFull(W,{maxTokens:512,enableThinking:!1,temperature:0},ve=>{a({phase:"generating",current:ne+1,total:o.length,classified:m,errors:y,results:k,email:{subject:R.subject,from:R.from,date:R.date},live:{tps:ve.tps,numTokens:ve.numTokens},streamingText:ve.text||"",totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-h}})});x+=ye,b+=be;const Y=Mp(ue),J=performance.now()-P;if(Y){await He.emailClassifications.put({emailId:R.id,action:Y.action,reason:Y.reason,summary:Y.summary,tags:Y.tags,subject:R.subject||"(no subject)",from:R.from||"",date:R.date,scannedAt:f,status:"pending"}),m++;const ve={success:!0,email:{subject:R.subject,from:R.from,date:R.date},classification:Y,rawResponse:ue,stats:{tps:ke,numTokens:ye,inputTokens:be,elapsed:J},promptSize:Z.length};k.push(ve),a({phase:"classified",current:ne+1,total:o.length,classified:m,errors:y,results:k,email:{subject:R.subject,from:R.from,date:R.date},result:Y,rawResponse:ue,emailStats:{tps:ke,numTokens:ye,inputTokens:be,elapsed:J},totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-h}})}}catch(ue){console.error(`Triage email ${ne+1} failed:`,ue),y++;const ke=ue.message||String(ue),ye=ke.length>200?ke.slice(0,200)+"...":ke;k.push({success:!1,email:{subject:R.subject,from:R.from,date:R.date},error:ye,promptSize:Z.length})}}const z=performance.now()-h,ie=k.length>0?Math.round(k.reduce((ne,R)=>ne+R.promptSize,0)/k.length):0,ce=k.filter(ne=>{var R;return ne.success&&((R=ne.stats)==null?void 0:R.tps)}).length>0?Math.round(k.filter(ne=>ne.success).reduce((ne,R)=>{var Z;return ne+(((Z=R.stats)==null?void 0:Z.tps)||0)},0)/k.filter(ne=>{var R;return ne.success&&((R=ne.stats)==null?void 0:R.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:m,errors:y,results:k,summary:{avgPromptSize:ie,avgTps:ce,systemPromptSize:bs.length,processed:o.length,skipped:u,modelName:L.displayName||L.name,modelContextWindow:L.contextWindow,modelMaxEmailTokens:L.maxEmailTokens},totals:{outputTokens:x,inputTokens:b,elapsed:z}}),{scanned:o.length,classified:m,skipped:u,errors:y}}async function ud(){const t=await He.emailClassifications.toArray();return ad(t)}async function Pp(){const t=await He.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function ki(t,e){await He.emailClassifications.update(t,{status:e})}async function Sc(){await He.emailClassifications.clear()}async function gl(t){await He.emailClassifications.where("action").equals(t).delete()}async function dd(t){await He.emailClassifications.delete(t)}async function Fo(){const t=await He.items.where("sourceType").equals("gmail").count(),e=await He.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function fd(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function Mp(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const n=e.indexOf("{"),a=e.lastIndexOf("}");if(n===-1||a===-1||a<=n)return console.warn("Triage: no JSON object found in response"),null;const s=e.indexOf("[");if(s!==-1&&s<n)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(n,a+1);try{const u=JSON.parse(o);if(!u||typeof u!="object"||Array.isArray(u))return null;const f=Dp(u.action);if(!f)return console.warn("Triage: missing or invalid action field"),null;let h=[];return Array.isArray(u.tags)&&(h=u.tags.filter(m=>typeof m=="string"&&m.trim()).map(m=>m.trim().toLowerCase()).slice(0,10)),{action:f,reason:String(u.reason||"").slice(0,300),summary:String(u.summary||"").slice(0,500),tags:h}}catch(u){return console.warn("Triage: failed to parse JSON response:",u.message),null}}function Dp(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function zo(t){return`hsl(${Mi(t)}, 55%, 55%)`}function jp(t){return`hsl(${Mi(t)}, 40%, 35%)`}var Lp=C('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Np=C('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function qp(t,e){St(e,!0);let n=Ne(e,"backend",15,"webgpu"),a=Ne(e,"isWebGPUAvailable",3,!0);var s=Np(),o=g(p(s),2),u=p(o);let f;u.__click=()=>n("webgpu");var h=g(u,2);let m;h.__click=()=>n("ollama");var y=g(o,2);{var x=b=>{var k=Lp();E(b,k)};te(y,b=>{!a()&&n()==="webgpu"&&b(x)})}Q(()=>{f=Mt(u,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="webgpu"}),u.disabled=!a(),m=Mt(h,1,"backend-btn svelte-1n2kfl0",null,m,{active:n()==="ollama"})}),E(t,s),Et()}Bt(["click"]);const Bp=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Ec(...t){Bp&&console.log("[debug]",...t)}function qn(t){return Ec(`[MOUNT] ${t}`),()=>Ec(`[DESTROY] ${t}`)}var Fp=C("<option> </option>"),zp=C('<p class="model-description svelte-1p89qnn"> </p>'),Up=C('<span class="current-badge svelte-1p89qnn">Current</span>'),Kp=C('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Gp=C('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Wp=C('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),Hp=C('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),Vp=C('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),Yp=C('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),Qp=C('<p class="error svelte-1p89qnn"> </p>'),Xp=C('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Zp(t,e){St(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"gpuInfo",3,null),s=Ne(e,"error",3,null);nn(()=>qn("ModelSelector"));var o=Xp(),u=p(o),f=g(p(u),2),h=g(p(f),2);Ct(h,21,()=>wr,Gt,(R,Z)=>{var W=Fp(),P=p(W),ue={};Q(()=>{j(P,`${c(Z).name??""} â ${c(Z).size??""}`),ue!==(ue=c(Z).id)&&(W.value=(W.__value=c(Z).id)??"")}),E(R,W)});var m=g(h,2);{var y=R=>{const Z=dt(()=>wr.find(ke=>ke.id===n()));var W=Xn(),P=$e(W);{var ue=ke=>{var ye=zp(),be=p(ye);Q(()=>j(be,c(Z).description)),E(ke,ye)};te(P,ke=>{c(Z)&&ke(ue)})}E(R,W)};te(m,R=>{n()&&R(y)})}var x=g(f,2),b=g(p(x),2),k=p(b),I=g(p(k));Ct(I,21,()=>wr,Gt,(R,Z)=>{var W=Hp();let P;var ue=p(W),ke=p(ue),ye=g(ke);{var be=me=>{var D=Up();E(me,D)};te(ye,me=>{c(Z).id===n()&&me(be)})}var Y=g(ue),J=p(Y),ve=p(J),ae=g(Y),he=p(ae),xe=g(ae),le=p(xe);{var fe=me=>{var D=Kp();E(me,D)},we=me=>{var D=Gp();E(me,D)},Se=me=>{var D=Wp();E(me,D)};te(le,me=>{c(Z).recommendedForEmailProcessing?me(fe):c(Z).maxEmailTokens>=6e3?me(we,1):me(Se,!1)})}Q((me,D)=>{P=Mt(W,1,"svelte-1p89qnn",null,P,{selected:c(Z).id===n()}),j(ke,`${c(Z).name??""} `),j(ve,`${me??""}k`),j(he,`~${D??""}k`)},[()=>(c(Z).contextWindow/1024).toFixed(0),()=>(c(Z).maxEmailTokens/1e3).toFixed(0)]),E(R,W)});var L=g(x,2);{var z=R=>{var Z=Yp(),W=g(p(Z),2),P=p(W),ue=g(p(P)),ke=p(ue),ye=g(P,2),be=g(p(ye)),Y=p(be),J=g(ye,2);{var ve=ae=>{var he=Vp(),xe=g(p(he)),le=p(xe);Q(fe=>j(le,fe),[()=>Bo(a().limits.maxBufferSize)]),E(ae,he)};te(J,ae=>{var he;(he=a().limits)!=null&&he.maxBufferSize&&ae(ve)})}Q(()=>{j(ke,a().vendor),j(Y,a().architecture)}),E(R,Z)};te(L,R=>{a()&&R(z)})}var ie=g(L,2);{var ce=R=>{var Z=Qp(),W=p(Z);Q(()=>j(W,s())),E(R,Z)};te(ie,R=>{s()&&R(ce)})}var ne=g(ie,2);ne.__click=function(...R){var Z;(Z=e.onload)==null||Z.apply(this,R)},Q(()=>ne.disabled=s()),Pi(h,n),E(t,o),Et()}Bt(["click"]);var Jp=C('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),$p=C('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),eh=C('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),th=C("<div><!></div>"),nh=C("<option> <!></option>"),rh=C("<option> <!></option>"),ah=C('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),sh=C('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),ih=C('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),oh=C('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),lh=C('<span class="current-badge svelte-1bvvk8o">Current</span>'),ch=C('<span class="installed-badge svelte-1bvvk8o">â</span>'),uh=C('<span class="rec-badge svelte-1bvvk8o">â</span>'),dh=C('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),fh=C('<p class="error svelte-1bvvk8o"> </p>'),vh=C('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function ph(t,e){St(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"error",15);const s=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let o=Re(Pt(Fs())),u=Re(!1),f=Re(null),h=Re(Pt([])),m=Re(!1);Ea(()=>{Qv().then(H=>{A(o,H,!0),y()})});async function y(){A(u,!0),A(f,null);const H=await qo(c(o));A(f,H,!0),A(u,!1),H.connected&&x()}async function x(){A(m,!0);try{const H=await Zv(c(o));A(h,H.map(se=>se.name),!0)}catch(H){console.error("Failed to load Ollama models:",H),A(h,[],!0)}A(m,!1)}function b(){Xv(c(o)),y()}function k(){if(!n()){a("Please select a model");return}e.onload()}function I(H){return c(h).length?c(h).includes(H):!1}const L=Qu();var z=vh(),ie=p(z),ce=p(ie),ne=g(p(ce)),R=p(ne),Z=g(ce,2),W=p(Z);W.__change=b;var P=g(W,2);P.__click=y;var ue=p(P),ke=g(Z,2);{var ye=H=>{var se=th();let G;var de=p(se);{var Me=T=>{var pe=Jp(),$=g($e(pe),2),Ee=p($);Q(()=>j(Ee,`Connected â¢ v${c(f).version??""}`)),E(T,pe)},re=T=>{var pe=eh(),$=g($e(pe),2),Ee=p($),qe=p(Ee),Fe=g(Ee,2);{var et=rt=>{var nt=$p(),Ve=g(p(nt),2),Xe=p(Ve),tt=g(p(Xe));tt.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var vt=g(Xe,2),At=g(p(vt));At.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,E(rt,nt)};te(Fe,rt=>{c(f).corsError&&rt(et)})}Q(()=>j(qe,`Disconnected: ${c(f).error??""}`)),E(T,pe)};te(de,T=>{c(f).connected?T(Me):T(re,!1)})}Q(()=>G=Mt(se,1,"connection-status svelte-1bvvk8o",null,G,{connected:c(f).connected})),E(H,se)};te(ke,H=>{c(f)&&H(ye)})}var be=g(ie,2),Y=g(p(be),2),J=p(Y);Ct(J,21,()=>L,Gt,(H,se)=>{var G=nh(),de=p(G),Me=g(de);{var re=$=>{var Ee=gn("â");E($,Ee)},T=dt(()=>I(c(se).name));te(Me,$=>{c(T)&&$(re)})}var pe={};Q($=>{j(de,`${c(se).displayName??""} (${c(se).params??""}) - ${$??""}k context `),pe!==(pe=c(se).name)&&(G.value=(G.__value=c(se).name)??"")},[()=>(c(se).contextWindow/1024).toFixed(0)]),E(H,G)});var ve=g(J);Ct(ve,21,()=>kr.filter(H=>!H.recommended),Gt,(H,se)=>{var G=rh(),de=p(G),Me=g(de);{var re=$=>{var Ee=gn("â");E($,Ee)},T=dt(()=>I(c(se).name));te(Me,$=>{c(T)&&$(re)})}var pe={};Q($=>{j(de,`${c(se).displayName??""} (${c(se).params??""}) - ${$??""}k context `),pe!==(pe=c(se).name)&&(G.value=(G.__value=c(se).name)??"")},[()=>(c(se).contextWindow/1024).toFixed(0)]),E(H,G)});var ae=g(Y,2);{var he=H=>{const se=dt(()=>kr.find(re=>re.name===n()));var G=Xn(),de=$e(G);{var Me=re=>{var T=oh(),pe=p(T),$=p(pe),Ee=g(pe,2),qe=p(Ee),Fe=p(qe),et=g(qe,4),rt=p(et),nt=g(et,2);{var Ve=We=>{var Ke=ah(),Ze=g($e(Ke),2),Ye=p(Ze);Q(mt=>j(Ye,mt),[()=>c(se).tags.join(", ")]),E(We,Ke)};te(nt,We=>{var Ke;(Ke=c(se).tags)!=null&&Ke.length&&We(Ve)})}var Xe=g(Ee,2);{var tt=We=>{var Ke=sh(),Ze=g(p(Ke),2),Ye=p(Ze);Q(()=>j(Ye,`ollama pull ${n()??""}`)),E(We,Ke)},vt=dt(()=>!I(n())),At=We=>{var Ke=ih();E(We,Ke)};te(Xe,We=>{c(vt)?We(tt):We(At,!1)})}Q(We=>{j($,c(se).description),j(Fe,`${We??""}k context`),j(rt,`${c(se).params??""} params`)},[()=>(c(se).contextWindow/1024).toFixed(0)]),E(re,T)};te(de,re=>{c(se)&&re(Me)})}E(H,G)};te(ae,H=>{n()&&H(he)})}var xe=g(be,2),le=g(p(xe),2),fe=p(le),we=g(p(fe));Ct(we,21,()=>kr,Gt,(H,se)=>{var G=dh();let de;var Me=p(G),re=p(Me),T=g(re);{var pe=We=>{var Ke=lh();E(We,Ke)};te(T,We=>{c(se).name===n()&&We(pe)})}var $=g(T,2);{var Ee=We=>{var Ke=ch();E(We,Ke)},qe=dt(()=>I(c(se).name));te($,We=>{c(qe)&&We(Ee)})}var Fe=g(Me),et=p(Fe),rt=p(et),nt=g(Fe),Ve=p(nt),Xe=g(nt),tt=p(Xe);{var vt=We=>{var Ke=uh();E(We,Ke)};te(tt,We=>{c(se).recommended&&We(vt)})}var At=g(tt);Q((We,Ke,Ze)=>{de=Mt(G,1,"svelte-1bvvk8o",null,de,We),j(re,`${c(se).displayName??""} `),j(rt,`${Ke??""}k`),j(Ve,c(se).params),j(At,` ${Ze??""}`)},[()=>({selected:c(se).name===n(),installed:I(c(se).name)}),()=>(c(se).contextWindow/1024).toFixed(0),()=>c(se).tags.slice(0,2).join(", ")]),E(H,G)});var Se=g(xe,2);{var me=H=>{var se=fh(),G=p(se);Q(()=>j(G,a())),E(H,se)};te(Se,H=>{a()&&H(me)})}var D=g(Se,2);D.__click=k,Q(()=>{var H;j(R,s?"ð¥ local":"âï¸ remote"),ul(W,"placeholder",s?"http://localhost:11434":"https://me-ai.metaelon.space"),P.disabled=c(u),j(ue,c(u)?"Testing...":"Test"),D.disabled=!((H=c(f))!=null&&H.connected)||a()}),Hn(W,()=>c(o),H=>A(o,H)),Pi(Y,n),E(t,z),Et()}Bt(["change","click"]);var hh=C('<span class="progress-percent svelte-r5fnze"> </span>'),mh=C('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),gh=C('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),_h=C('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),yh=C('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),bh=C('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),wh=C('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function kh(t,e){St(e,!0);let n=Ne(e,"message",3,""),a=Ne(e,"items",19,()=>[]);nn(()=>qn("LoadingProgress"));var s=wh(),o=p(s),u=p(o),f=g(o,2);Ct(f,17,a,Gt,(h,m)=>{const y=dt(()=>c(m).total?tp(c(m).loaded||0,c(m).total):null);var x=bh(),b=p(x),k=p(b),I=p(k),L=g(k,2);{var z=R=>{var Z=hh(),W=p(Z);Q(P=>j(W,`${P??""}%`),[()=>c(y).toFixed(1)]),E(R,Z)};te(L,R=>{c(y)!==null&&R(z)})}var ie=g(b,2);{var ce=R=>{var Z=mh(),W=$e(Z),P=p(W),ue=g(W,2),ke=p(ue),ye=p(ke),be=g(ke,4),Y=p(be),J=g(be,2),ve=p(J);Q((ae,he,xe,le,fe)=>{ln(P,`width: ${ae??""}%`),j(ye,he),j(Y,xe),j(ve,`(${le??""} / ${fe??""} B)`)},[()=>Math.max(c(m).progress??0,.5).toFixed(1),()=>_o(c(m).loaded||0),()=>_o(c(m).total),()=>(c(m).loaded||0).toLocaleString(),()=>c(m).total.toLocaleString()]),E(R,Z)},ne=R=>{var Z=yh(),W=g($e(Z),2),P=p(W);{var ue=ye=>{var be=gh(),Y=$e(be),J=p(Y),ve=g(Y,2),ae=p(ve);Q((he,xe)=>{j(J,he),j(ae,`(${xe??""} B)`)},[()=>_o(c(m).loaded),()=>c(m).loaded.toLocaleString()]),E(ye,be)},ke=ye=>{var be=_h();E(ye,be)};te(P,ye=>{c(m).loaded?ye(ue):ye(ke,!1)})}E(R,Z)};te(ie,R=>{c(m).total?R(ce):R(ne,!1)})}Q(()=>{ul(k,"title",c(m).file),j(I,c(m).file)}),E(h,x)}),Q(()=>j(u,n())),E(t,s),Et()}var xh=C('<span class="thinking-tokens svelte-11gjw00"> </span>'),Sh=C('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Eh=C('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Th=C('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Ah=C('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),Ch=C('<span class="cursor svelte-11gjw00">|</span>'),Ih=C(" <!>",1),Rh=C('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),Oh=C('<div class="content svelte-11gjw00"> </div>'),Ph=C('<div><div class="role svelte-11gjw00"> </div> <!></div>');function Mh(t,e){St(e,!0);let n=Ne(e,"isLast",3,!1),a=Ne(e,"isRunning",3,!1),s=Ne(e,"generationPhase",3,null),o=Ne(e,"numTokens",3,null);nn(()=>qn(`MessageBubble[${e.msg.role}]`));var u=Ph(),f=p(u),h=p(f),m=g(f,2);{var y=b=>{var k=Rh(),I=$e(k);{var L=P=>{var ue=Sh(),ke=g(p(ue),4);{var ye=be=>{var Y=xh(),J=p(Y);Q(()=>j(J,`${o()??""} tokens`)),E(be,Y)};te(ke,be=>{o()&&be(ye)})}E(P,ue)},z=P=>{var ue=Eh();E(P,ue)};te(I,P=>{a()&&n()&&s()==="thinking"?P(L):a()&&n()&&s()==="preparing"&&P(z,1)})}var ie=g(I,2);{var ce=P=>{var ue=Th(),ke=p(ue),ye=g(p(ke),2),be=p(ye),Y=g(ke,2),J=p(Y);Q(ve=>{j(be,`${ve??""} words`),j(J,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),E(P,ue)};te(ie,P=>{e.msg.thinking&&P(ce)})}var ne=g(ie,2),R=p(ne);{var Z=P=>{var ue=Ah();E(P,ue)},W=P=>{var ue=Ih(),ke=$e(ue,!0),ye=g(ke);{var be=Y=>{var J=Ch();E(Y,J)};te(ye,Y=>{a()&&n()&&Y(be)})}Q(()=>j(ke,e.msg.content)),E(P,ue)};te(R,P=>{a()&&n()&&!e.msg.content&&s()!=="thinking"?P(Z):P(W,!1)})}E(b,k)},x=b=>{var k=Oh(),I=p(k);Q(()=>j(I,e.msg.content)),E(b,k)};te(m,b=>{e.msg.role==="assistant"?b(y):b(x,!1)})}Q(()=>{Mt(u,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),j(h,e.msg.role==="user"?"You":"AI")}),E(t,u),Et()}var Dh=C('<span class="cmd-icon svelte-1m7x4wq"> </span>'),jh=C('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),Lh=C('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Tc(t,e){St(e,!0);var n=Lh(),a=$e(n);a.__click=()=>{var k;return(k=e.onexecute)==null?void 0:k.call(e,e.command.id)};var s=p(a);{var o=k=>{var I=Dh(),L=p(I);Q(()=>j(L,e.command.icon)),E(k,I)};te(s,k=>{e.command.icon&&k(o)})}var u=g(s,2),f=p(u),h=p(f),m=g(f,2),y=p(m),x=g(a,2);{var b=k=>{var I=jh(),L=p(I),z=p(L);Q(()=>j(z,e.command.body)),E(k,I)};te(x,k=>{e.command.body&&k(b)})}Q(()=>{j(h,e.command.name),j(y,e.command.description)}),E(t,n),Et()}Bt(["click"]);class Nh{constructor(e,n){this.workerId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var s,o,u;const a=this.handlers.get(e);if(!a)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} worker`};try{(s=n.onProgress)==null||s.call(n,{phase:"executing",actionId:e,actionName:a.name});const f=await a.execute(n);return(o=n.onProgress)==null||o.call(n,{phase:"completed",actionId:e,actionName:a.name,result:f}),f}catch(f){const h={success:!1,error:f,message:f.message||"Unknown error"};return(u=n.onProgress)==null||u.call(n,{phase:"failed",actionId:e,actionName:a.name,error:f.message}),h}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const qh="https://gmail.googleapis.com/gmail/v1/users/me",Ar={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function kn(t,e,n,a=null){var u;const s={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};a&&(s.body=JSON.stringify(a));const o=await fetch(`${qh}${n}`,s);if(!o.ok){const h=((u=(await o.json().catch(()=>({}))).error)==null?void 0:u.message)||`Gmail API error: ${o.status}`;throw new Error(h)}return o.status===204?{success:!0}:o.json()}class Bh extends Nh{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ar.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ar.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ar.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ar.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ar.SPAM],removeLabelIds:[Ar.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ar.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[a]}),{success:!0,message:`Applied label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[a]}),{success:!0,message:`Removed label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ar.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await kn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ar.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,a=[],s=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await kn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:a,removeLabelIds:s}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await kn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const Fh=new Bh;class zh{constructor(){this.workers=new Map,this.registerDefaultWorkers()}registerDefaultWorkers(){this.registerWorker(Fh)}registerWorker(e){this.workers.set(e.workerId,e)}getWorker(e){return this.workers.get(e)}getAllWorkers(){return Array.from(this.workers.values())}async executeAction(e,n){const a=this.resolveWorkerId(n.event.source),s=this.getWorker(a);return s?s.canExecute(e)?s.execute(e,n):{success:!1,message:`Action "${e}" not supported by ${s.serviceName}`,error:new Error(`Action not supported: ${e}`)}:{success:!1,message:`No worker found for source: ${n.event.source}`,error:new Error(`Worker not found: ${a}`)}}async executePipeline(e,n){var o,u;const a=[];let s=!0;for(const f of e){(o=n.onProgress)==null||o.call(n,{phase:"action_start",actionId:f.id,actionName:f.name});const h=await this.executeAction(f.id,n);a.push({actionId:f.id,actionName:f.name,...h}),h.success||(s=!1),(u=n.onProgress)==null||u.call(n,{phase:"action_complete",actionId:f.id,actionName:f.name,result:h})}return{success:s,results:a,message:s?`All ${a.length} actions completed successfully`:`Pipeline completed with ${a.filter(f=>!f.success).length} failure(s)`}}async executePipelineBatch(e,n,a){var u,f;const s=[];for(let h=0;h<n.length;h++){const m=n[h];(u=a.onProgress)==null||u.call(a,{phase:"batch_event_start",eventIndex:h,totalEvents:n.length,event:m});const y={...a,event:m},x=await this.executePipeline(e,y);s.push({event:m,...x}),(f=a.onProgress)==null||f.call(a,{phase:"batch_event_complete",eventIndex:h,totalEvents:n.length,event:m,result:x})}return{success:s.every(h=>h.success),results:s,total:n.length,successful:s.filter(h=>h.success).length,failed:s.filter(h=>!h.success).length,message:`Processed ${n.length} event(s): ${s.filter(h=>h.success).length} successful, ${s.filter(h=>!h.success).length} failed`}}resolveWorkerId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolveWorkerId(e),a=this.getWorker(n);return a?a.getHandlers():[]}getRequiredScopes(e,n){const a=this.resolveWorkerId(n),s=this.getWorker(a);return s?s.getRequiredScopes(e):[]}}const vd=new zh,Ac="https://accounts.google.com/gsi/client",Uh="https://www.googleapis.com/auth/gmail.readonly",_l="me-ai:oauth-token",yl=300*1e3;let Os=null,Ts=null,Jr=0;async function pd(t,e){Jr=Date.now()+e*1e3;const{setSetting:n}=await Lr(async()=>{const{setSetting:a}=await Promise.resolve().then(()=>Ra);return{setSetting:a}},void 0);await n(_l,{access_token:t,expires_at:Jr})}async function Uo(){Jr=0;const{removeSetting:t}=await Lr(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>Ra);return{removeSetting:e}},void 0);await t(_l)}async function Li(){try{const{getSetting:t}=await Lr(async()=>{const{getSetting:s}=await Promise.resolve().then(()=>Ra);return{getSetting:s}},void 0),e=await t(_l);if(!e)return null;const{access_token:n,expires_at:a}=e;return!n||Date.now()>a-yl?(await Uo(),null):(Jr=a,{access_token:n})}catch{return await Uo(),null}}function Kh(){return Jr>0&&Date.now()<Jr-yl}function Gh(){return Jr<=0?0:Math.max(0,Jr-yl-Date.now())}function Cc(){return new Promise((t,e)=>{if(!Os){e(new Error("Google Auth not initialized."));return}Ts=async n=>{n.error?e(new Error(n.error_description||n.error)):(await pd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Os.requestAccessToken({prompt:""})})}function Wh(){return new Promise((t,e)=>{var s,o;if((o=(s=window.google)==null?void 0:s.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${Ac}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=Ac,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function Ic(t){await Wh(),Os=google.accounts.oauth2.initTokenClient({client_id:t,scope:Uh,callback:e=>{Ts&&(Ts(e),Ts=null)}})}function Hh(){return new Promise((t,e)=>{if(!Os){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Ts=async n=>{n.error?e(new Error(n.error_description||n.error)):(await pd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Os.requestAccessToken()})}async function Vh(t){return await Uo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function Yh(t,e){try{e==null||e({phase:"starting",event:t});const n=await Li();if(!(n!=null&&n.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const a=n.access_token,s=await $a(t.type);if(!s||s.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:s,actionCount:s.length});const o={accessToken:a,event:t,onProgress:e},u=await vd.executePipeline(s,o);return e==null||e({phase:"done",result:u}),u}catch(n){const a={success:!1,error:n,message:n.message||"Unknown error"};return e==null||e({phase:"error",error:n.message}),a}}async function Qh(t,e,n){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=await Li();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,o=await $a(t);if(!o||o.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:o,actionCount:o.length});const u=e.map(m=>({type:t,source:"gmail",data:m})),f={accessToken:s,onProgress:n},h=await vd.executePipelineBatch(o,u,f);return n==null||n({phase:"done",result:h}),h}catch(a){const s={success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length};return n==null||n({phase:"error",error:a.message}),s}}async function Rc(){const t=await Li();return!!(t!=null&&t.access_token)}var Xh=C('<span class="event-type svelte-1w66m1k"> </span>'),Zh=C('<div class="event-subject svelte-1w66m1k"> </div>'),Jh=C('<span class="sep svelte-1w66m1k">Â·</span> ',1),$h=C('<div class="event-summary svelte-1w66m1k"> </div>'),em=C('<span class="tag svelte-1w66m1k"> </span>'),tm=C('<div class="event-tags svelte-1w66m1k"></div>'),nm=C('<div class="event-reason svelte-1w66m1k"> </div>'),rm=C('<div class="commands svelte-1w66m1k"></div>'),am=C('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><!> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),sm=C('<span class="event-type svelte-1w66m1k"> </span>'),im=C('<span class="event-subject-inline svelte-1w66m1k"> </span>'),om=C('<span class="sep svelte-1w66m1k">Â·</span> ',1),lm=C('<div class="event-summary svelte-1w66m1k"> </div>'),cm=C('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><!> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),um=C('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),dm=C('<span class="no-events-hint svelte-1w66m1k">No events defined â create one in the Actions page</span>'),fm=C("<option> </option>"),vm=C('<span class="exec-label svelte-1w66m1k">Run event:</span> <select class="event-select svelte-1w66m1k"></select> <button class="execute-all-btn svelte-1w66m1k"><!></button>',1),pm=C("<div> </div>"),hm=C('<span class="email-from svelte-1w66m1k"> </span>'),mm=C('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),gm=C('<div class="email-summary svelte-1w66m1k"> </div>'),_m=C('<span class="tag svelte-1w66m1k"> </span>'),ym=C('<div class="email-tags svelte-1w66m1k"></div>'),bm=C("<span> </span>"),wm=C('<div class="email-exec-row svelte-1w66m1k"><button class="execute-btn svelte-1w66m1k"><!></button> <!></div>'),km=C('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <!></div>'),xm=C('<div class="group-emails svelte-1w66m1k"></div>'),Sm=C('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="tag-label svelte-1w66m1k">Tag</span> <span class="group-badge svelte-1w66m1k"> </span> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button></div> <div class="event-exec-row svelte-1w66m1k"><!></div> <!> <!></div>'),Em=C('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Scanned emails</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function Tm(t,e){St(e,!0);let n=Re(Pt({})),a=Pt({}),s=Re(Pt([])),o=Re(Pt({}));nn(async()=>{A(s,await ld(),!0)});function u(W){if(!W)return"â";const P=W.replace(/<.*>/,"").trim();return P.length>40?P.slice(0,38)+"â¦":P}function f(W){if(!W)return"";try{return new Date(W).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function h(W,P){var ue;(ue=e.oncommand)==null||ue.call(e,{event:W,commandId:P})}function m(W){return c(o)[W]??c(s)[0]??""}function y(W,P){A(o,{...c(o),[W]:P},!0)}async function x(W,P){const ue=m(W);if(!ue){alert("No event selected. Create an event in the Actions page first.");return}if(!await Rc()){alert("Please sign in to Gmail first (Dashboard page)");return}const ke=`single_${P.emailId}`;a[ke]={running:!0,progress:null,result:null};try{const be=await Yh({type:ue,source:"gmail",data:P},Y=>{a[ke]={...a[ke],progress:Y}});a[ke]={running:!1,progress:null,result:be}}catch(ye){a[ke]={running:!1,progress:null,result:{success:!1,message:ye.message}}}}async function b(W,P){const ue=m(W);if(!ue){alert("No event selected. Create an event in the Actions page first.");return}if(!await Rc()){alert("Please sign in to Gmail first (Dashboard page)");return}const ke=`batch_${W}`;a[ke]={running:!0,progress:null,result:null};try{const ye=await Qh(ue,P,be=>{a[ke]={...a[ke],progress:be}});a[ke]={running:!1,progress:null,result:ye}}catch(ye){a[ke]={running:!1,progress:null,result:{success:!1,message:ye.message}}}}function k(W){A(n,{...c(n),[W]:!c(n)[W]},!0)}function I(W){return W.split("_").map(P=>P.charAt(0)+P.slice(1).toLowerCase()).join(" ")}function L(W){return`hsl(${Mi(W)}, 55%, 55%)`}function z(W){return a[W]}var ie=Xn(),ce=$e(ie);{var ne=W=>{var P=am(),ue=p(P),ke=p(ue),ye=p(ke);{var be=re=>{var T=Xh(),pe=p(T);Q(()=>j(pe,e.msg.event.metadata.tag)),E(re,T)};te(ye,re=>{var T;(T=e.msg.event.metadata)!=null&&T.tag&&re(be)})}var Y=g(ye,2),J=p(Y),ve=g(ke,2);{var ae=re=>{var T=Zh(),pe=p(T);Q(()=>j(pe,e.msg.event.data.subject)),E(re,T)};te(ve,re=>{var T;(T=e.msg.event.data)!=null&&T.subject&&re(ae)})}var he=g(ve,2),xe=p(he);{var le=re=>{var T=gn();Q(pe=>j(T,pe),[()=>u(e.msg.event.data.from)]),E(re,T)};te(xe,re=>{var T;(T=e.msg.event.data)!=null&&T.from&&re(le)})}var fe=g(xe,2);{var we=re=>{var T=Jh(),pe=g($e(T),1,!0);Q($=>j(pe,$),[()=>f(e.msg.event.data.date)]),E(re,T)};te(fe,re=>{var T;(T=e.msg.event.data)!=null&&T.date&&re(we)})}var Se=g(he,2);{var me=re=>{var T=$h(),pe=p(T);Q(()=>j(pe,e.msg.event.metadata.summary)),E(re,T)};te(Se,re=>{var T;(T=e.msg.event.metadata)!=null&&T.summary&&re(me)})}var D=g(Se,2);{var H=re=>{var T=tm();Ct(T,21,()=>e.msg.event.metadata.tags,Gt,(pe,$)=>{var Ee=em(),qe=p(Ee);Q(()=>j(qe,c($))),E(pe,Ee)}),E(re,T)};te(D,re=>{var T,pe;(pe=(T=e.msg.event.metadata)==null?void 0:T.tags)!=null&&pe.length&&re(H)})}var se=g(D,2);{var G=re=>{var T=nm(),pe=p(T);Q(()=>j(pe,e.msg.event.metadata.reason)),E(re,T)};te(se,re=>{var T;(T=e.msg.event.metadata)!=null&&T.reason&&re(G)})}var de=g(ue,2);{var Me=re=>{var T=rm();Ct(T,21,()=>e.msg.commands,Gt,(pe,$)=>{Tc(pe,{get command(){return c($)},onexecute:Ee=>h(e.msg.event,Ee)})}),E(re,T)};te(de,re=>{var T;(T=e.msg.commands)!=null&&T.length&&re(Me)})}Q(()=>j(J,e.msg.event.source)),E(W,P)},R=W=>{var P=um(),ue=p(P),ke=p(ue),ye=p(ke),be=g(ue,2);Ct(be,17,()=>e.msg.items,Gt,(Y,J)=>{var ve=cm(),ae=p(ve),he=p(ae),xe=p(he);{var le=re=>{var T=sm(),pe=p(T);Q(()=>j(pe,c(J).event.metadata.tag)),E(re,T)};te(xe,re=>{var T;(T=c(J).event.metadata)!=null&&T.tag&&re(le)})}var fe=g(xe,2);{var we=re=>{var T=im(),pe=p(T);Q(()=>j(pe,c(J).event.data.subject)),E(re,T)};te(fe,re=>{var T;(T=c(J).event.data)!=null&&T.subject&&re(we)})}var Se=g(he,2),me=p(Se);{var D=re=>{var T=gn();Q(pe=>j(T,pe),[()=>u(c(J).event.data.from)]),E(re,T)};te(me,re=>{var T;(T=c(J).event.data)!=null&&T.from&&re(D)})}var H=g(me,2);{var se=re=>{var T=om(),pe=g($e(T),1,!0);Q($=>j(pe,$),[()=>f(c(J).event.data.date)]),E(re,T)};te(H,re=>{var T;(T=c(J).event.data)!=null&&T.date&&re(se)})}var G=g(Se,2);{var de=re=>{var T=lm(),pe=p(T);Q(()=>j(pe,c(J).event.metadata.summary)),E(re,T)};te(G,re=>{var T;(T=c(J).event.metadata)!=null&&T.summary&&re(de)})}var Me=g(ae,2);Ct(Me,21,()=>c(J).commands,Gt,(re,T)=>{Tc(re,{get command(){return c(T)},onexecute:pe=>h(c(J).event,pe)})}),E(Y,ve)}),Q(()=>j(ye,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),E(W,P)},Z=W=>{var P=Em(),ue=p(P),ke=g(p(ue),2),ye=p(ke),be=g(ue,2);Ct(be,17,()=>e.msg.groups,Gt,(Y,J)=>{const ve=dt(()=>c(n)[c(J).tag]??!0),ae=dt(()=>z(`batch_${c(J).tag}`)),he=dt(()=>m(c(J).tag));var xe=Sm(),le=p(xe),fe=p(le);fe.__click=()=>k(c(J).tag);var we=g(p(fe),2);let Se;var me=p(we),D=g(we,2),H=p(D),se=g(D,4);let G;var de=g(le,2),Me=p(de);{var re=Fe=>{var et=dm();E(Fe,et)},T=Fe=>{var et=vm(),rt=g($e(et),2);rt.__change=We=>y(c(J).tag,We.target.value),Ct(rt,21,()=>c(s),Gt,(We,Ke)=>{var Ze=fm(),Ye=p(Ze),mt={};Q(Dt=>{j(Ye,Dt),mt!==(mt=c(Ke))&&(Ze.value=(Ze.__value=c(Ke))??"")},[()=>I(c(Ke))]),E(We,Ze)});var nt;Hu(rt);var Ve=g(rt,2);Ve.__click=()=>b(c(J).tag,c(J).emails);var Xe=p(Ve);{var tt=We=>{var Ke=gn("â³ Running...");E(We,Ke)},vt=We=>{var Ke=gn();Q(()=>j(Ke,c(ae).result.success?`â Done (${c(ae).result.successful}/${c(ae).result.total})`:"â Failed")),E(We,Ke)},At=We=>{var Ke=gn();Q(()=>j(Ke,`â¶ All (${c(J).emails.length??""})`)),E(We,Ke)};te(Xe,We=>{var Ke,Ze;(Ke=c(ae))!=null&&Ke.running?We(tt):(Ze=c(ae))!=null&&Ze.result?We(vt,1):We(At,!1)})}Q(()=>{var We;nt!==(nt=c(he))&&(rt.value=(rt.__value=c(he))??"",cl(rt,c(he))),Ve.disabled=((We=c(ae))==null?void 0:We.running)||!c(he)}),E(Fe,et)};te(Me,Fe=>{c(s).length===0?Fe(re):Fe(T,!1)})}var pe=g(de,2);{var $=Fe=>{var et=pm();let rt;var nt=p(et);Q(()=>{rt=Mt(et,1,"batch-result svelte-1w66m1k",null,rt,{success:c(ae).result.success,error:!c(ae).result.success}),j(nt,c(ae).result.message)}),E(Fe,et)};te(pe,Fe=>{var et;(et=c(ae))!=null&&et.result&&Fe($)})}var Ee=g(pe,2);{var qe=Fe=>{var et=xm();Ct(et,21,()=>c(J).emails,Gt,(rt,nt)=>{const Ve=dt(()=>z(`single_${c(nt).emailId}`));var Xe=km(),tt=p(Xe),vt=p(tt),At=p(vt),We=g(vt,2),Ke=p(We);{var Ze=Qe=>{var Ae=hm(),pt=p(Ae);Q(Rt=>j(pt,Rt),[()=>u(c(nt).from)]),E(Qe,Ae)};te(Ke,Qe=>{c(nt).from&&Qe(Ze)})}var Ye=g(Ke,2);{var mt=Qe=>{var Ae=mm(),pt=g($e(Ae)),Rt=p(pt);Q(Qt=>j(Rt,Qt),[()=>f(c(nt).date)]),E(Qe,Ae)};te(Ye,Qe=>{c(nt).date&&Qe(mt)})}var Dt=g(We,2);{var rn=Qe=>{var Ae=gm(),pt=p(Ae);Q(()=>j(pt,c(nt).summary)),E(Qe,Ae)};te(Dt,Qe=>{c(nt).summary&&Qe(rn)})}var an=g(Dt,2);{var Ft=Qe=>{var Ae=ym();Ct(Ae,21,()=>c(nt).tags,Gt,(pt,Rt)=>{var Qt=_m(),Oe=p(Qt);Q(()=>j(Oe,c(Rt))),E(pt,Qt)}),E(Qe,Ae)};te(an,Qe=>{var Ae;(Ae=c(nt).tags)!=null&&Ae.length&&Qe(Ft)})}var It=g(tt,2);{var Jt=Qe=>{var Ae=wm(),pt=p(Ae);pt.__click=()=>x(c(J).tag,c(nt));var Rt=p(pt);{var Qt=zt=>{var jt=gn("â³ Running...");E(zt,jt)},Oe=zt=>{var jt=gn();Q(()=>j(jt,c(Ve).result.success?"â Done":"â Failed")),E(zt,jt)},Xt=zt=>{var jt=gn("â¶ Execute");E(zt,jt)};te(Rt,zt=>{var jt,kt;(jt=c(Ve))!=null&&jt.running?zt(Qt):(kt=c(Ve))!=null&&kt.result?zt(Oe,1):zt(Xt,!1)})}var Br=g(pt,2);{var Cn=zt=>{var jt=bm();let kt;var In=p(jt);Q(()=>{kt=Mt(jt,1,"exec-result-inline svelte-1w66m1k",null,kt,{success:c(Ve).result.success,error:!c(Ve).result.success}),j(In,c(Ve).result.message)}),E(zt,jt)};te(Br,zt=>{var jt;(jt=c(Ve))!=null&&jt.result&&zt(Cn)})}Q(()=>{var zt;return pt.disabled=((zt=c(Ve))==null?void 0:zt.running)||!c(he)}),E(Qe,Ae)};te(It,Qe=>{c(s).length>0&&Qe(Jt)})}Q(()=>j(At,c(nt).subject)),E(rt,Xe)}),E(Fe,et)};te(Ee,Fe=>{c(ve)&&Fe(qe)})}Q((Fe,et)=>{Se=ln(we,"",Se,Fe),j(me,et),j(H,c(J).emails.length),G=Mt(se,0,"chevron svelte-1w66m1k",null,G,{open:c(ve)})},[()=>({background:L(c(J).tag)}),()=>I(c(J).tag)]),E(Y,xe)}),Q(()=>j(ye,`${e.msg.total??""} email${e.msg.total===1?"":"s"} Â· ${e.msg.groups.length??""} tag${e.msg.groups.length===1?"":"s"}`)),E(W,P)};te(ce,W=>{e.msg.type==="event"?W(ne):e.msg.type==="event-batch"?W(R,1):e.msg.type==="events-grouped"&&W(Z,2)})}E(t,ie),Et()}Bt(["click","change"]);var Am=C('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Cm=C('<span class="edate svelte-mt5nvh"> </span>'),Im=C('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Rm=C('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Om=C('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),Pm=C('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Mm=C('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Dm(t,e){St(e,!0);let n=Ne(e,"pendingData",3,null),a=Re(null),s=Re(null);function o(k){A(a,c(a)===k?null:k,!0),A(s,null)}function u(k){return k.split("_").map(I=>I.charAt(0)+I.slice(1).toLowerCase()).join(" ")}function f(k){if(!k)return"";try{return new Date(k).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function h(k){if(!k)return"";const I=k.replace(/<.*>/,"").trim();return I.length>24?I.slice(0,22)+"â¦":I}var m={toggleGroup:o},y=Xn(),x=$e(y);{var b=k=>{var I=Mm(),L=p(I),z=p(L),ie=g(L,2);Ct(ie,20,()=>n().order,R=>R,(R,Z)=>{const W=dt(()=>n().groups[Z]),P=dt(()=>zo(Z)),ue=dt(()=>c(a)===Z);var ke=Am();let ye;ke.__click=()=>o(Z);let be;var Y=p(ke);let J;var ve=g(Y),ae=g(ve),he=p(ae);Q(xe=>{ye=Mt(ke,1,"chip svelte-mt5nvh",null,ye,{active:c(ue)}),be=ln(ke,"",be,{"--c":c(P)}),J=ln(Y,"",J,{background:c(P)}),j(ve,` ${xe??""} `),j(he,c(W).length)},[()=>u(Z)]),E(R,ke)});var ce=g(ie,2);{var ne=R=>{const Z=dt(()=>n().groups[c(a)]),W=dt(()=>zo(c(a)));var P=Pm(),ue=p(P);let ke;var ye=p(ue);ye.__click=()=>{A(a,null),A(s,null)};var be=g(ye,2),Y=p(be),J=g(be,2),ve=p(J),ae=g(ue,2);Ct(ae,21,()=>c(Z),we=>we.emailId,(we,Se)=>{var me=Im(),D=p(me);D.__click=()=>{var Ee;return(Ee=e.onaskai)==null?void 0:Ee.call(e,`Tell me about the email "${c(Se).subject}" from ${c(Se).from}`)};var H=p(D),se=p(H),G=g(H,2),de=p(G),Me=g(de);{var re=Ee=>{var qe=Cm(),Fe=p(qe);Q(et=>j(Fe,et),[()=>f(c(Se).date)]),E(Ee,qe)};te(Me,Ee=>{c(Se).date&&Ee(re)})}var T=g(D,2),pe=p(T);pe.__click=()=>{var Ee;return(Ee=e.onmarkacted)==null?void 0:Ee.call(e,c(Se).emailId)};var $=g(pe,2);$.__click=()=>{var Ee;return(Ee=e.ondismiss)==null?void 0:Ee.call(e,c(Se).emailId)},Q(Ee=>{j(se,c(Se).subject),j(de,Ee)},[()=>h(c(Se).from)]),E(we,me)});var he=g(ae,2),xe=p(he);{var le=we=>{var Se=Rm(),me=$e(Se);me.__click=()=>c(Z).forEach(H=>{var se;return(se=e.onmarkacted)==null?void 0:se.call(e,H.emailId)});var D=g(me,2);D.__click=()=>A(s,c(a),!0),E(we,Se)},fe=we=>{var Se=Om(),me=$e(Se),D=p(me),H=g(me,2);H.__click=()=>A(s,null);var se=g(H,2);se.__click=()=>{var G;(G=e.oncleargroup)==null||G.call(e,c(a)),A(s,null),A(a,null)},Q(()=>j(D,`Remove ${c(Z).length??""}?`)),E(we,Se)};te(xe,we=>{c(s)!==c(a)?we(le):we(fe,!1)})}Q(we=>{ke=ln(ue,"",ke,{"border-color":c(W)}),j(Y,we),j(ve,c(Z).length)},[()=>u(c(a))]),E(R,P)};te(ce,R=>{c(a)&&n().groups[c(a)]&&R(ne)})}Q(()=>j(z,`${n().total??""} item${n().total!==1?"s":""} need attention`)),E(k,I)};te(x,k=>{n()&&n().total>0&&k(b)})}return E(t,y),Et(m)}Bt(["click"]);var jm=C('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Lm=C('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Nm=C('<div class="strip svelte-1ed7zw1"><!></div>');function qm(t,e){let n=Ne(e,"hasScanData",3,!1),a=Ne(e,"engineReady",3,!1),s=Ne(e,"isScanning",3,!1),o=dt(()=>a()&&!n()&&!s()),u=dt(()=>c(o)||s());var f=Xn(),h=$e(f);{var m=y=>{var x=Nm(),b=p(x);{var k=L=>{var z=jm();E(L,z)},I=L=>{var z=Lm();z.__click=function(...ie){var ce;(ce=e.onscan)==null||ce.apply(this,ie)},E(L,z)};te(b,L=>{s()?L(k):c(o)&&L(I,1)})}E(y,x)};te(h,y=>{c(u)&&y(m)})}E(t,f)}Bt(["click"]);var Bm=C('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Fm=C('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),zm=C('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Um=C('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Km=C('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),Gm=C('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),Wm=C('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Hm(t,e){St(e,!0),nn(()=>qn("GpuPanel"));var n=Wm(),a=p(n),s=g(p(a),2),o=g(p(s),2),u=p(o),f=g(s,2),h=g(p(f),2),m=p(h),y=g(f,2);{var x=R=>{var Z=Bm(),W=g(p(Z),2),P=p(W);Q(()=>j(P,e.gpuInfo.device)),E(R,Z)};te(y,R=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&R(x)})}var b=g(y,2);{var k=R=>{var Z=Fm(),W=g(p(Z),2),P=p(W);Q(ue=>j(P,ue),[()=>Bo(e.gpuInfo.limits.maxBufferSize)]),E(R,Z)};te(b,R=>{var Z;(Z=e.gpuInfo.limits)!=null&&Z.maxBufferSize&&R(k)})}var I=g(b,2);{var L=R=>{var Z=zm(),W=g(p(Z),2),P=p(W);Q(()=>j(P,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),E(R,Z)};te(I,R=>{var Z;(Z=e.gpuInfo.limits)!=null&&Z.maxComputeInvocationsPerWorkgroup&&R(L)})}var z=g(I,2);{var ie=R=>{var Z=Um(),W=g(p(Z),2),P=p(W);Q(ue=>j(P,ue),[()=>Bo(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),E(R,Z)};te(z,R=>{var Z;(Z=e.gpuInfo.limits)!=null&&Z.maxComputeWorkgroupStorageSize&&R(ie)})}var ce=g(z,2);{var ne=R=>{var Z=Gm(),W=p(Z),P=p(W),ue=g(W,2);Ct(ue,21,()=>e.gpuInfo.features,Gt,(ke,ye)=>{var be=Km(),Y=p(be);Q(()=>j(Y,c(ye))),E(ke,be)}),Q(()=>j(P,`Features (${e.gpuInfo.features.length??""})`)),E(R,Z)};te(ce,R=>{var Z;(Z=e.gpuInfo.features)!=null&&Z.length&&R(ne)})}Q(()=>{j(u,e.gpuInfo.vendor),j(m,e.gpuInfo.architecture)}),E(t,n),Et()}var Vm=C('<button class="gpu-badge svelte-1ktw27c"> </button>'),Ym=C('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Qm=C('<span class="stats svelte-1ktw27c"> </span>'),Xm=C('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Zm=C('<span class="stats preparing svelte-1ktw27c"> </span>'),Jm=C('<span class="stats svelte-1ktw27c"> </span>'),$m=C('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),eg=C('<button class="btn svelte-1ktw27c">Stop</button>'),tg=C('<button class="btn primary svelte-1ktw27c">Send</button>'),ng=C('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function rg(t,e){St(e,!0),nn(()=>qn("ChatView"));let n=Ne(e,"messages",19,()=>[]),a=Ne(e,"pendingData",3,null),s=Ne(e,"hasScanData",3,!1),o=Ne(e,"engineReady",3,!1),u=Ne(e,"isScanning",3,!1),f=Ne(e,"isRunning",3,!1),h=Ne(e,"tps",3,null),m=Ne(e,"numTokens",3,null),y=Ne(e,"generationPhase",3,null),x=Ne(e,"gpuInfo",3,null),b=Ne(e,"backend",3,"webgpu"),k=Ne(e,"chatContainer",15),I=Re(""),L=Re(!1);function z(G){G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),ie())}function ie(){const G=c(I).trim();!G||f()||(A(I,""),e.onsend(G))}function ce(G){G&&!f()&&e.onsend(G)}var ne=ng(),R=p(ne),Z=p(R);{var W=G=>{var de=Vm();de.__click=()=>A(L,!c(L));var Me=p(de);Q(()=>j(Me,`WebGPU ${c(L)?"â²":"â¼"}`)),E(G,de)},P=G=>{var de=Ym();E(G,de)};te(Z,G=>{x()?G(W):b()==="ollama"&&G(P,1)})}var ue=g(Z,2);{var ke=G=>{var de=Qm(),Me=p(de);Q((re,T)=>j(Me,`${m()??""} tokens in ${re??""}s
        (${T??""} tok/s)`),[()=>(m()/h()).toFixed(1),()=>h().toFixed(1)]),E(G,de)},ye=G=>{var de=Xm();E(G,de)},be=G=>{var de=Zm(),Me=p(de);Q(re=>j(Me,`thinking... ${re??""}`),[()=>h()?`${h().toFixed(0)} tok/s`:""]),E(G,de)},Y=G=>{var de=Jm(),Me=p(de);Q(re=>j(Me,`${re??""} tok/s`),[()=>h().toFixed(1)]),E(G,de)};te(ue,G=>{h()&&!f()?G(ke):f()&&y()==="preparing"?G(ye,1):f()&&y()==="thinking"?G(be,2):h()&&f()&&G(Y,3)})}var J=g(ue,4);J.__click=function(...G){var de;(de=e.onreset)==null||de.apply(this,G)};var ve=g(R,2);{var ae=G=>{Hm(G,{get gpuInfo(){return x()}})};te(ve,G=>{c(L)&&x()&&G(ae)})}var he=g(ve,2),xe=p(he);{var le=G=>{var de=$m();E(G,de)};te(xe,G=>{n().length===0&&!(a()&&a().total>0)&&G(le)})}var fe=g(xe,2);Ct(fe,17,n,Gt,(G,de,Me)=>{var re=Xn(),T=$e(re);{var pe=qe=>{Dm(qe,{get pendingData(){return c(de).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:ce})},$=qe=>{Tm(qe,{get msg(){return c(de)},get oncommand(){return e.oncommand}})},Ee=qe=>{{let Fe=dt(()=>Me===n().length-1);Mh(qe,{get msg(){return c(de)},get isLast(){return c(Fe)},get isRunning(){return f()},get generationPhase(){return y()},get numTokens(){return m()}})}};te(T,qe=>{c(de).type==="dashboard"?qe(pe):c(de).type==="event"||c(de).type==="event-batch"||c(de).type==="events-grouped"?qe($,1):qe(Ee,!1)})}E(G,re)}),Vu(he,G=>k(G),()=>k());var we=g(he,2);qm(we,{get hasScanData(){return s()},get engineReady(){return o()},get isScanning(){return u()},get onscan(){return e.onscan}});var Se=g(we,2),me=p(Se);me.__keydown=z;var D=g(me,2);{var H=G=>{var de=eg();de.__click=function(...Me){var re;(re=e.onstop)==null||re.apply(this,Me)},E(G,de)},se=G=>{var de=tg();de.__click=ie,Q(Me=>de.disabled=Me,[()=>!c(I).trim()]),E(G,de)};te(D,G=>{f()?G(H):G(se,!1)})}Q(()=>{J.disabled=f(),me.disabled=f()}),Hn(me,()=>c(I),G=>A(I,G)),E(t,ne),Et()}Bt(["click","keydown"]);var ag=C('<div class="container center svelte-1bi93vx"><!> <!></div>');function sg(t,e){St(e,!0);const n=!!navigator.gpu,a=Zu();let s=Re("webgpu"),o=Re(Pt(wr[0].id)),u=Re(null),f=Re(null),h=Re(""),m=Re(Pt([])),y=Re(Pt([])),x=Re(!1),b=Re(null),k=Re(null),I=Re(null),L=Re(null),z=Re(null),ie=Re(null),ce=Re(!1),ne=Re(!1),R=!1;nn(async()=>{const[D,H]=await Promise.all([Is("aiBackend"),Is("selectedModel")]);D&&A(s,D,!0),H&&A(o,H,!0),a.check(),a.isReady&&Z();const se=a.onMessage(G=>{switch(G.status){case"webgpu-info":A(L,G.data,!0);break;case"loading":A(u,"loading"),A(h,G.data,!0);break;case"initiate":A(m,[...c(m),G],!0);break;case"progress":A(m,c(m).map(de=>de.file===G.file?{...de,...G}:de),!0);break;case"done":A(m,c(m).filter(de=>de.file!==G.file),!0);break;case"ready":A(u,"ready"),Z();break;case"start":if(!c(x))break;A(z,G.phase||"preparing",!0),A(y,[...c(y),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!c(x))break;A(z,G.phase,!0);break;case"thinking":{if(!c(x))break;A(b,G.tps,!0),A(k,G.numTokens,!0);const de=c(y)[c(y).length-1];A(y,[...c(y).slice(0,-1),{...de,thinking:(de.thinking||"")+G.content}],!0),J();break}case"thinking-done":{if(!c(x))break;A(b,G.tps,!0),A(k,G.numTokens,!0);const de=c(y)[c(y).length-1];A(y,[...c(y).slice(0,-1),{...de,thinking:G.content}],!0);break}case"update":{if(!c(x))break;A(b,G.tps,!0),A(k,G.numTokens,!0);const de=c(y)[c(y).length-1];A(y,[...c(y).slice(0,-1),{...de,content:de.content+G.output}],!0),J();break}case"complete":if(!c(x))break;G.tps!==void 0&&A(b,G.tps,!0),G.numTokens!==void 0&&A(k,G.numTokens,!0),A(x,!1),A(z,null),W();break;case"error":A(f,G.data,!0),c(u)==="loading"&&A(u,null),c(x)&&(A(x,!1),A(z,null));break}});return()=>se()});async function Z(){if(!(R||c(y).length>0))try{const D=await xc();A(ie,D,!0),D&&(R=!0,A(y,[{role:"assistant",type:"dashboard",pendingData:D}],!0),J());const H=await Fo();A(ce,H.classified>0)}catch{}}async function W(){try{const D=await xc();A(ie,D,!0);const H=c(y).findIndex(G=>G.type==="dashboard");H!==-1&&(D&&D.total>0?A(y,c(y).map((G,de)=>de===H?{...G,pendingData:D}:G),!0):A(y,c(y).filter((G,de)=>de!==H),!0));const se=await Fo();A(ce,se.classified>0)}catch{}}async function P(D){await ki(D,"acted"),await W()}async function ue(D){await ki(D,"dismissed"),await W()}async function ke(D){await dd(D),await W()}async function ye(D){await gl(D),await W()}async function be(){if(c(ne)||!a.isReady)return;A(ne,!0);let D=null;try{if(await cd(a,{count:20,onProgress:H=>{var se;H.phase==="done"&&((se=H.results)==null?void 0:se.length)>0&&(D=H.results)}}),await W(),(D==null?void 0:D.length)>0){const H=await Cp(D);A(y,[...c(y),H],!0),J()}c(ie)&&!c(y).some(H=>H.type==="dashboard")&&(A(y,[{role:"assistant",type:"dashboard",pendingData:c(ie)},...c(y)],!0),J())}catch(H){console.error("Scan failed:",H)}finally{A(ne,!1)}}function Y({event:D,commandId:H}){var se,G;`${H}${D.type}${((se=D.data)==null?void 0:se.subject)||"unknown"}`,A(y,[...c(y),{role:"assistant",content:`Command: ${H}

This command is not yet implemented. In the future, "${H}" will be executed on the ${D.source} event "${((G=D.data)==null?void 0:G.subject)||""}".`}],!0),J()}function J(){Uu().then(()=>{c(I)&&(c(I).scrollTop=c(I).scrollHeight)})}async function ve(){A(u,"loading"),await Rs("selectedModel",c(o)),await Rs("aiBackend",c(s)),c(s)==="ollama"&&A(L,null),a.loadModel(c(o))}Ea(()=>{c(s)==="webgpu"&&!wr.find(D=>D.id===c(o))?A(o,wr[0].id,!0):c(s)==="ollama"&&!kr.find(D=>D.name===c(o))&&A(o,kr[0].name,!0)});async function ae(D){if(!D||c(x))return;if(D.trim().toLowerCase()==="/events"){A(y,[...c(y),{role:"user",content:D}],!0);try{const G=await ud();if(!G.order.length)A(y,[...c(y),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const de=await Ip(G);A(y,[...c(y),de],!0)}}catch(G){A(y,[...c(y),{role:"assistant",content:`Failed to load events: ${G.message}`}],!0)}J();return}A(y,[...c(y),{role:"user",content:D}],!0),A(b,null),A(x,!0);let H=[];try{const de=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(D)?await gp(D):await mp();de&&(H=[{role:"system",content:de}])}catch{}const se=c(y).filter(G=>G.type!=="dashboard"&&G.type!=="events-grouped"&&G.type!=="event-batch"&&G.type!=="event").map(G=>({role:G.role,content:G.content}));a.generate([...H,...se]),J()}function he(){a.interrupt()}function xe(){a.reset(),A(y,[],!0),A(b,null),A(k,null),R=!1,Z()}var le=Xn(),fe=$e(le);{var we=D=>{var H=ag(),se=p(H);qp(se,{get isWebGPUAvailable(){return n},get backend(){return c(s)},set backend(re){A(s,re,!0)}});var G=g(se,2);{var de=re=>{Zp(re,{get gpuInfo(){return c(L)},get error(){return c(f)},onload:ve,get selectedModel(){return c(o)},set selectedModel(T){A(o,T,!0)}})},Me=re=>{ph(re,{onload:ve,get selectedModel(){return c(o)},set selectedModel(T){A(o,T,!0)},get error(){return c(f)},set error(T){A(f,T,!0)}})};te(G,re=>{c(s)==="webgpu"?re(de):c(s)==="ollama"&&re(Me,1)})}E(D,H)},Se=D=>{kh(D,{get message(){return c(h)},get items(){return c(m)}})},me=D=>{rg(D,{get messages(){return c(y)},get pendingData(){return c(ie)},get hasScanData(){return c(ce)},get engineReady(){return a.isReady},get isScanning(){return c(ne)},get isRunning(){return c(x)},get tps(){return c(b)},get numTokens(){return c(k)},get generationPhase(){return c(z)},get gpuInfo(){return c(L)},get backend(){return c(s)},onsend:ae,onstop:he,onreset:xe,onmarkacted:P,ondismiss:ue,onremove:ke,oncleargroup:ye,onscan:be,oncommand:Y,get chatContainer(){return c(I)},set chatContainer(H){A(I,H,!0)}})};te(fe,D=>{c(u)===null?D(we):c(u)==="loading"?D(Se,1):D(me,!1)})}E(t,le),Et()}const cn="gmail",Oc=8,hd=50,md=100;async function ig(t,{limit:e=hd,onProgress:n=()=>{},signal:a}={}){var u;const s=await He.syncState.get(cn);if(s!=null&&s.historyId)try{return await dg(t,s,n,a)}catch(f){if(f instanceof pl&&(f.status===404||f.code==="notFound")||((u=f.message)==null?void 0:u.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await He.syncState.delete(cn);else throw f}return await cg(t,e===0?1/0:e,n,a)}async function og(t,{limit:e=hd,onProgress:n=()=>{},signal:a}={}){const s=await He.syncState.get(cn);return s!=null&&s.oldestPageToken?await ug(t,s,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function lg(){const t=await He.syncState.get(cn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function gd(){await He.transaction("rw",[He.items,He.syncState],async()=>{await He.items.where("sourceType").equals(cn).delete(),await He.syncState.delete(cn)})}async function cg(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Aa(a);const s=await Ju(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(s.messagesTotal||e,e)});const o=[];let u,f=null;for(;o.length<e;){Aa(a);const x=e-o.length,b=await $u(t,{maxResults:Math.min(md,x),pageToken:u}),k=(b.messages||[]).map(I=>I.id);if(o.push(...k),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(s.messagesTotal||e,e)}),u=b.nextPageToken,!u||k.length===0)break}if(f=u||null,o.length===0)return await He.syncState.put({sourceType:cn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:h,errors:m}=await _d(t,o,n,a),y=await He.items.where("sourceType").equals(cn).count();return await He.syncState.put({sourceType:cn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:y,oldestPageToken:f}),n({phase:"done",message:`Synced ${h} messages`,current:h,total:h}),{added:h,deleted:0,errors:m}}async function ug(t,e,n,a,s){a({phase:"listing",message:"Loading more messages...",current:0}),Aa(s);const o=[];let u=e.oldestPageToken,f=null;for(;o.length<n;){Aa(s);const x=n-o.length,b=await $u(t,{maxResults:Math.min(md,x),pageToken:u}),k=(b.messages||[]).map(I=>I.id);if(o.push(...k),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),u=b.nextPageToken,!u||k.length===0)break}if(f=u||null,o.length===0)return await He.syncState.update(cn,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:h,errors:m}=await _d(t,o,a,s),y=await He.items.where("sourceType").equals(cn).count();return await He.syncState.update(cn,{totalItems:y,lastSyncAt:Date.now(),oldestPageToken:f}),a({phase:"done",message:f?`Downloaded ${h} more (more available)`:`Downloaded ${h} more (all synced)`,current:y,total:y}),{added:h,errors:m}}async function dg(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Aa(a);let s=0,o=0,u=0,f,h=e.historyId;do{Aa(a);const y=await sp(t,{startHistoryId:e.historyId,pageToken:f});if(h=y.historyId||h,f=y.nextPageToken,!!y.history){for(const x of y.history){if(x.messagesAdded){const b=x.messagesAdded.map(I=>I.message.id),k=[...new Set(b.filter(I=>I))];if(k.length>0){const I=await Promise.allSettled(k.map(z=>ed(t,z))),L=[];for(const z of I)z.status==="fulfilled"?L.push(yd(z.value)):u++;L.length>0&&(await He.items.bulkPut(L),await bd(L),s+=L.length)}}if(x.messagesDeleted){const b=x.messagesDeleted.map(k=>Yu(cn,k.message.id)).filter(k=>k);b.length>0&&(await He.items.bulkDelete(b),o+=b.length)}}n({phase:"syncing",message:`Changes: +${s} -${o}`,current:s+o})}}while(f);const m=await He.items.where("sourceType").equals(cn).count();return await He.syncState.put({sourceType:cn,historyId:h,lastSyncAt:Date.now(),totalItems:m,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:s===0&&o===0?"Already up to date":`Synced: +${s} -${o}`,current:m,total:m}),{added:s,deleted:o,errors:u}}async function _d(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let s=0,o=0;for(let u=0;u<e.length;u+=Oc){Aa(a);const f=e.slice(u,u+Oc),h=await Promise.allSettled(f.map(y=>ed(t,y))),m=[];for(const y of h)y.status==="fulfilled"?m.push(yd(y.value)):o++;m.length>0&&(await He.items.bulkPut(m),await bd(m)),s+=m.length,n({phase:"downloading",message:`Downloaded ${s} of ${e.length} messages`,current:s,total:e.length})}return{added:s,errors:o}}function yd(t){const e=Gr(t,"From"),n=Gr(t,"To"),a=Gr(t,"Cc"),s=Gr(t,"Subject")||"(no subject)",o=Gr(t,"Date"),u=Gr(t,"Message-ID"),f=Gr(t,"In-Reply-To"),h=Gr(t,"References");let m;try{m=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{m=Date.now()}return{id:Yu(cn,t.id),sourceType:cn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:s,snippet:t.snippet||"",body:ip(t),htmlBody:op(t),date:m,labels:t.labelIds||[],messageId:u,inReplyTo:f,references:h,raw:t,syncedAt:Date.now()}}async function bd(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const s=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of s){const u=fg(o);u&&!e.has(u.email)&&e.set(u.email,{...u,date:n.date})}}for(const[n,{name:a,date:s}]of e)try{const o=await He.contacts.where("email").equals(n).first();if(o){const u={};a&&!o.name&&(u.name=a),s>(o.lastSeen||0)&&(u.lastSeen=s),Object.keys(u).length>0&&await He.contacts.update(o.id,u)}else await He.contacts.add({email:n,name:a||"",firstSeen:s,lastSeen:s})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function fg(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),s=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:s}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Aa(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var vg=C(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),pg=C(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),hg=C(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function mg(t,e){St(e,!0);let n=Ne(e,"clientIdInput",15),a=Ne(e,"defaultClientId",3,"");nn(()=>qn("SetupGuide"));let s=Re(null);async function o(I){try{await navigator.clipboard.writeText(I),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}catch{const L=document.createElement("input");L.value=I,document.body.appendChild(L),L.select(),document.execCommand("copy"),document.body.removeChild(L),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}}const u="http://localhost:5173",f="https://cypherkitty.github.io",h="https://cypherkitty.github.io/me-ai/";var m=hg(),y=p(m),x=g(p(y),4);{var b=I=>{var L=vg(),z=$e(L),ie=g(p(z),2);ie.__click=()=>{n(a()),e.onsave()};var ce=g(z,2),ne=g(p(ce),2),R=p(ne),Z=g(p(R),6),W=g(p(Z),2),P=g(p(W),2),ue=g(p(P),2),ke=p(ue);ke.__click=()=>o(u);var ye=p(ke);ye.textContent="http://localhost:5173";var be=g(ye,2),Y=p(be),J=g(ke,2);J.__click=()=>o(f);var ve=p(J);ve.textContent="https://cypherkitty.github.io";var ae=g(ve,2),he=p(ae),xe=g(P,2),le=g(p(xe),2),fe=p(le);fe.__click=()=>o(u);var we=p(fe);we.textContent="http://localhost:5173";var Se=g(we,2),me=p(Se),D=g(fe,2);D.__click=()=>o(f);var H=p(D);H.textContent="https://cypherkitty.github.io";var se=g(H,2),G=p(se),de=g(D,2);de.__click=()=>o(h);var Me=p(de);Me.textContent="https://cypherkitty.github.io/me-ai/";var re=g(Me,2),T=p(re),pe=g(R,2),$=p(pe);$.__keydown=qe=>qe.key==="Enter"&&e.onsave();var Ee=g($,2);Ee.__click=function(...qe){var Fe;(Fe=e.onsave)==null||Fe.apply(this,qe)},Q(qe=>{j(Y,c(s)===u?"â":"â§"),j(he,c(s)===f?"â":"â§"),j(me,c(s)===u?"â":"â§"),j(G,c(s)===f?"â":"â§"),j(T,c(s)===h?"â":"â§"),Ee.disabled=qe},[()=>!n().trim()]),Hn($,n),E(I,L)},k=I=>{var L=pg(),z=$e(L),ie=g(p(z),6),ce=g(p(ie),2),ne=g(p(ce),2),R=g(p(ne),2),Z=p(R);Z.__click=()=>o(u);var W=p(Z);W.textContent="http://localhost:5173";var P=g(W,2),ue=p(P),ke=g(Z,2);ke.__click=()=>o(f);var ye=p(ke);ye.textContent="https://cypherkitty.github.io";var be=g(ye,2),Y=p(be),J=g(ne,2),ve=g(p(J),2),ae=p(ve);ae.__click=()=>o(u);var he=p(ae);he.textContent="http://localhost:5173";var xe=g(he,2),le=p(xe),fe=g(ae,2);fe.__click=()=>o(f);var we=p(fe);we.textContent="https://cypherkitty.github.io";var Se=g(we,2),me=p(Se),D=g(fe,2);D.__click=()=>o(h);var H=p(D);H.textContent="https://cypherkitty.github.io/me-ai/";var se=g(H,2),G=p(se),de=g(z,2),Me=p(de);Me.__keydown=T=>T.key==="Enter"&&e.onsave();var re=g(Me,2);re.__click=function(...T){var pe;(pe=e.onsave)==null||pe.apply(this,T)},Q(T=>{j(ue,c(s)===u?"â":"â§"),j(Y,c(s)===f?"â":"â§"),j(le,c(s)===u?"â":"â§"),j(me,c(s)===f?"â":"â§"),j(G,c(s)===h?"â":"â§"),re.disabled=T},[()=>!n().trim()]),Hn(Me,n),E(I,L)};te(x,I=>{a()?I(b):I(k,!1)})}E(t,m),Et()}Bt(["click","keydown"]);function gg(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof pl?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const s=n.match(/project\s+(\d+)/),o=s==null?void 0:s[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var _g=C('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),yg=C('<div class="error-card-title svelte-14buhqq"> </div>'),bg=C('<p class="error-card-fix svelte-14buhqq"> </p>'),wg=C('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),kg=C('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),xg=C('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function wd(t,e){St(e,!0);let n=Ne(e,"ondismiss",3,null),a=Ne(e,"onsignout",3,null),s=dt(()=>gg(e.error));nn(()=>qn("ErrorCard"));var o=xg(),u=p(o);{var f=ie=>{var ce=_g(),ne=p(ce),R=p(ne),Z=g(ne,2);Z.__click=function(...W){var P;(P=n())==null||P.apply(this,W)},Q(()=>j(R,c(s).title)),E(ie,ce)},h=ie=>{var ce=yg(),ne=p(ce);Q(()=>j(ne,c(s).title)),E(ie,ce)};te(u,ie=>{n()?ie(f):ie(h,!1)})}var m=g(u,2),y=p(m),x=g(m,2);{var b=ie=>{var ce=bg(),ne=p(ce);Q(()=>j(ne,c(s).fix)),E(ie,ce)};te(x,ie=>{c(s).fix&&ie(b)})}var k=g(x,2);{var I=ie=>{var ce=wg(),ne=p(ce);Q(()=>{ul(ce,"href",c(s).link.url),j(ne,`${c(s).link.label??""} â`)}),E(ie,ce)};te(k,ie=>{c(s).link&&ie(I)})}var L=g(k,2);{var z=ie=>{var ce=kg();ce.__click=function(...ne){var R;(R=a())==null||R.apply(this,ne)},E(ie,ce)};te(L,ie=>{c(s).action==="signout"&&a()&&ie(z)})}Q(()=>j(y,c(s).description)),E(t,o),Et()}Bt(["click"]);var Sg=C('<span class="spinner svelte-nyqevv"></span> Signing in...',1),Eg=ll('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),Tg=C('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),Ag=C('<span class="client-id-value svelte-nyqevv"> </span>'),Cg=C(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function Ig(t,e){St(e,!0);let n=Ne(e,"isDefaultClientId",3,!1),a=Ne(e,"error",3,null),s=Ne(e,"loadingAuth",3,!1);nn(()=>qn("AuthCard"));var o=Cg(),u=p(o),f=g(p(u),4);{var h=ce=>{wd(ce,{get error(){return a()},get onsignout(){return e.onsignout}})};te(f,ce=>{a()&&ce(h)})}var m=g(f,2);m.__click=function(...ce){var ne;(ne=e.onsignin)==null||ne.apply(this,ce)};var y=p(m);{var x=ce=>{var ne=Sg();E(ce,ne)},b=ce=>{var ne=Eg();E(ce,ne)};te(y,ce=>{s()?ce(x):ce(b,!1)})}var k=g(m,4),I=g(p(k),2);{var L=ce=>{var ne=Tg();E(ce,ne)},z=ce=>{var ne=Ag(),R=p(ne);Q(Z=>j(R,`${Z??""}...`),[()=>e.clientId.slice(0,20)]),E(ce,ne)};te(I,ce=>{n()?ce(L):ce(z,!1)})}var ie=g(I,2);ie.__click=function(...ce){var ne;(ne=e.onclear)==null||ne.apply(this,ce)},Q(()=>m.disabled=s()),E(t,o),Et()}Bt(["click"]);var Rg=C('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),Og=C('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),Pg=C('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function Mg(t,e){St(e,!0);let n=Ne(e,"profile",3,null),a=Ne(e,"loadingProfile",3,!1);nn(()=>qn("ProfileCard"));var s=Pg(),o=p(s),u=p(o),f=g(o,2),h=p(f);{var m=b=>{var k=Rg();E(b,k)},y=b=>{var k=Og(),I=$e(k),L=p(I),z=g(I,2),ie=p(z);Q((ce,ne)=>{j(L,n().emailAddress),j(ie,`${ce??""} messages
        Â· ${ne??""} threads`)},[()=>{var ce;return((ce=n().messagesTotal)==null?void 0:ce.toLocaleString())||"?"},()=>{var ce;return((ce=n().threadsTotal)==null?void 0:ce.toLocaleString())||"?"}]),E(b,k)};te(h,b=>{a()?b(m):n()&&b(y,1)})}var x=g(f,2);x.__click=function(...b){var k;(k=e.onsignout)==null||k.apply(this,b)},Q(b=>j(u,b),[()=>n()?nd(n().emailAddress):"?"]),E(t,s),Et()}Bt(["click"]);var Dg=C('<span class="spinner svelte-1ds3j4k"></span>'),jg=ll('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),Lg=C('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),Ng=C('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),qg=C('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),Bg=C('<option class="svelte-1ds3j4k"> </option>'),Fg=C('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),zg=C('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),Ug=C('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Kg=C('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),Gg=C('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),Wg=C('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function Hg(t,e){St(e,!0),nn(()=>qn("SyncStatus"));let n=Ne(e,"syncStatus",3,null),a=Ne(e,"syncProgress",3,null),s=Ne(e,"isSyncing",3,!1),o=Re(!1),u=Re(50);const f=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function h(le){if(!le)return"never";const fe=Math.floor((Date.now()-le)/1e3);if(fe<60)return"just now";const we=Math.floor(fe/60);if(we<60)return`${we}m ago`;const Se=Math.floor(we/60);return Se<24?`${Se}h ago`:`${Math.floor(Se/24)}d ago`}function m(){var le,fe;return!((le=a())!=null&&le.total)||!((fe=a())!=null&&fe.current)?0:Math.round(a().current/a().total*100)}var y=Wg(),x=p(y),b=p(x),k=p(b);{var I=le=>{var fe=Dg();E(le,fe)},L=le=>{var fe=jg();E(le,fe)};te(k,le=>{s()?le(I):le(L,!1)})}var z=g(b,2),ie=g(p(z),2);{var ce=le=>{var fe=Lg(),we=p(fe),Se=g(we);{var me=H=>{var se=gn("Â· more available");E(H,se)},D=H=>{var se=gn("Â· all synced");E(H,se)};te(Se,H=>{n().hasMore?H(me):H(D,!1)})}Q((H,se)=>j(we,`${H??""} emails stored
          Â· synced ${se??""} `),[()=>n().totalItems.toLocaleString(),()=>h(n().lastSyncAt)]),E(le,fe)},ne=le=>{var fe=Ng();E(le,fe)};te(ie,le=>{var fe;(fe=n())!=null&&fe.synced?le(ce):le(ne,!1)})}var R=g(z,2),Z=p(R);{var W=le=>{var fe=qg();fe.__click=()=>A(o,!c(o)),E(le,fe)};te(Z,le=>{var fe;(fe=n())!=null&&fe.synced&&!s()&&le(W)})}var P=g(x,2),ue=p(P),ke=g(p(ue),2);Ct(ke,21,()=>f,Gt,(le,fe)=>{var we=Bg(),Se=p(we),me={};Q(()=>{j(Se,c(fe).label),me!==(me=c(fe).value)&&(we.value=(we.__value=c(fe).value)??"")}),E(le,we)});var ye=g(ue,2),be=p(ye);{var Y=le=>{var fe=zg(),we=$e(fe);we.__click=()=>e.onsync(c(u));var Se=p(we),me=g(we,2);{var D=H=>{var se=Fg();se.__click=()=>e.onsyncmore(c(u));var G=p(se);Q(()=>{se.disabled=s(),j(G,s()?"Loading...":"Sync More")}),E(H,se)};te(me,H=>{n().hasMore&&H(D)})}Q(()=>{we.disabled=s(),j(Se,s()?"Syncing...":"Sync New")}),E(le,fe)},J=le=>{var fe=Ug();fe.__click=()=>e.onsync(c(u));var we=p(fe);Q(()=>{fe.disabled=s(),j(we,s()?"Syncing...":"Download Emails")}),E(le,fe)};te(be,le=>{var fe;(fe=n())!=null&&fe.synced?le(Y):le(J,!1)})}var ve=g(P,2);{var ae=le=>{var fe=Kg(),we=p(fe),Se=p(we);let me,D;var H=g(we,2),se=p(H);Q(G=>{me=Mt(Se,1,"progress-fill svelte-1ds3j4k",null,me,{indeterminate:!a().total}),D=ln(Se,"",D,G),j(se,a().message||"Syncing...")},[()=>({width:`${m()??""}%`})]),E(le,fe)};te(ve,le=>{s()&&a()&&le(ae)})}var he=g(ve,2);{var xe=le=>{var fe=Gg(),we=g(p(fe),2),Se=p(we);Se.__click=()=>A(o,!1);var me=g(Se,2);me.__click=()=>{e.onclear(),A(o,!1)},E(le,fe)};te(he,le=>{c(o)&&le(xe)})}Q(()=>ke.disabled=s()),Pi(ke,()=>c(u),le=>A(u,le)),E(t,y),Et()}Bt(["click"]);var Vg=C('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Yg=C('<div class="message-list svelte-y2uamw"></div>');function Qg(t,e){St(e,!0);let n=Ne(e,"messages",19,()=>[]);nn(()=>qn("MessageList"));var a=Yg();Ct(a,21,n,Gt,(s,o)=>{var u=Vg();u.__click=()=>e.onselect(c(o));var f=p(u),h=p(f),m=g(f,2),y=p(m),x=p(y),b=p(x),k=g(x,2),I=p(k),L=g(y,2),z=p(L),ie=g(L,2),ce=p(ie);Q((ne,R,Z)=>{j(h,ne),j(b,R),j(I,Z),j(z,c(o).subject),j(ce,c(o).snippet)},[()=>nd(c(o).from),()=>td(c(o).from),()=>hl(c(o).date)]),E(s,u)}),E(t,a),Et()}Bt(["click"]);function bl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Oa=bl();function kd(t){Oa=t}var ua={exec:()=>null};function _t(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(s,o)=>{let u=typeof o=="string"?o:o.source;return u=u.replace(_n.caret,"$1"),n=n.replace(s,u),a},getRegex:()=>new RegExp(n,e)};return a}var Xg=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),_n={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},Zg=/^(?:[ \t]*(?:\n|$))+/,Jg=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,$g=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Us=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,e_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,wl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,xd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Sd=_t(xd).replace(/bull/g,wl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),t_=_t(xd).replace(/bull/g,wl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),kl=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,n_=/^[^\n]+/,xl=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,r_=_t(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",xl).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),a_=_t(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,wl).getRegex(),Ni="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Sl=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,s_=_t("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Sl).replace("tag",Ni).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ed=_t(kl).replace("hr",Us).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex(),i_=_t(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Ed).getRegex(),El={blockquote:i_,code:Jg,def:r_,fences:$g,heading:e_,hr:Us,html:s_,lheading:Sd,list:a_,newline:Zg,paragraph:Ed,table:ua,text:n_},Pc=_t("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Us).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex(),o_={...El,lheading:t_,table:Pc,paragraph:_t(kl).replace("hr",Us).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Pc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ni).getRegex()},l_={...El,html:_t(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Sl).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ua,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:_t(kl).replace("hr",Us).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Sd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},c_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,u_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Td=/^( {2,}|\\)\n(?!\s*$)/,d_=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,qi=/[\p{P}\p{S}]/u,Tl=/[\s\p{P}\p{S}]/u,Ad=/[^\s\p{P}\p{S}]/u,f_=_t(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Tl).getRegex(),Cd=/(?!~)[\p{P}\p{S}]/u,v_=/(?!~)[\s\p{P}\p{S}]/u,p_=/(?:[^\s\p{P}\p{S}]|~)/u,Id=/(?![*_])[\p{P}\p{S}]/u,h_=/(?![*_])[\s\p{P}\p{S}]/u,m_=/(?:[^\s\p{P}\p{S}]|[*_])/u,g_=_t(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Xg?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Rd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,__=_t(Rd,"u").replace(/punct/g,qi).getRegex(),y_=_t(Rd,"u").replace(/punct/g,Cd).getRegex(),Od="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",b_=_t(Od,"gu").replace(/notPunctSpace/g,Ad).replace(/punctSpace/g,Tl).replace(/punct/g,qi).getRegex(),w_=_t(Od,"gu").replace(/notPunctSpace/g,p_).replace(/punctSpace/g,v_).replace(/punct/g,Cd).getRegex(),k_=_t("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ad).replace(/punctSpace/g,Tl).replace(/punct/g,qi).getRegex(),x_=_t(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Id).getRegex(),S_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",E_=_t(S_,"gu").replace(/notPunctSpace/g,m_).replace(/punctSpace/g,h_).replace(/punct/g,Id).getRegex(),T_=_t(/\\(punct)/,"gu").replace(/punct/g,qi).getRegex(),A_=_t(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),C_=_t(Sl).replace("(?:-->|$)","-->").getRegex(),I_=_t("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",C_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),xi=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,R_=_t(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",xi).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Pd=_t(/^!?\[(label)\]\[(ref)\]/).replace("label",xi).replace("ref",xl).getRegex(),Md=_t(/^!?\[(ref)\](?:\[\])?/).replace("ref",xl).getRegex(),O_=_t("reflink|nolink(?!\\()","g").replace("reflink",Pd).replace("nolink",Md).getRegex(),Mc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Al={_backpedal:ua,anyPunctuation:T_,autolink:A_,blockSkip:g_,br:Td,code:u_,del:ua,delLDelim:ua,delRDelim:ua,emStrongLDelim:__,emStrongRDelimAst:b_,emStrongRDelimUnd:k_,escape:c_,link:R_,nolink:Md,punctuation:f_,reflink:Pd,reflinkSearch:O_,tag:I_,text:d_,url:ua},P_={...Al,link:_t(/^!?\[(label)\]\((.*?)\)/).replace("label",xi).getRegex(),reflink:_t(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",xi).getRegex()},Ko={...Al,emStrongRDelimAst:w_,emStrongLDelim:y_,delLDelim:x_,delRDelim:E_,url:_t(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Mc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:_t(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Mc).getRegex()},M_={...Ko,br:_t(Td).replace("{2,}","*").getRegex(),text:_t(Ko.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ui={normal:El,gfm:o_,pedantic:l_},fs={normal:Al,gfm:Ko,breaks:M_,pedantic:P_},D_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Dc=t=>D_[t];function Cr(t,e){if(e){if(_n.escapeTest.test(t))return t.replace(_n.escapeReplace,Dc)}else if(_n.escapeTestNoEncode.test(t))return t.replace(_n.escapeReplaceNoEncode,Dc);return t}function jc(t){try{t=encodeURI(t).replace(_n.percentDecode,"%")}catch{return null}return t}function Lc(t,e){var o;let n=t.replace(_n.findPipe,(u,f,h)=>{let m=!1,y=f;for(;--y>=0&&h[y]==="\\";)m=!m;return m?"|":" |"}),a=n.split(_n.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace(_n.slashPipe,"|");return a}function vs(t,e,n){let a=t.length;if(a===0)return"";let s=0;for(;s<a&&t.charAt(a-s-1)===e;)s++;return t.slice(0,a-s)}function j_(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function L_(t,e=0){let n=e,a="";for(let s of t)if(s==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=s,n++;return a}function Nc(t,e,n,a,s){let o=e.href,u=e.title||null,f=t[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let h={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:u,text:f,tokens:a.inlineTokens(f)};return a.state.inLink=!1,h}function N_(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let s=a[1];return e.split(`
`).map(o=>{let u=o.match(n.other.beginningSpace);if(u===null)return o;let[f]=u;return f.length>=s.length?o.slice(s.length):o}).join(`
`)}var Si=class{constructor(t){ct(this,"options");ct(this,"rules");ct(this,"lexer");this.options=t||Oa}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:vs(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=N_(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=vs(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:vs(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=vs(e[0],`
`).split(`
`),a="",s="",o=[];for(;n.length>0;){let u=!1,f=[],h;for(h=0;h<n.length;h++)if(this.rules.other.blockquoteStart.test(n[h]))f.push(n[h]),u=!0;else if(!u)f.push(n[h]);else break;n=n.slice(h);let m=f.join(`
`),y=m.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${m}`:m,s=s?`${s}
${y}`:y;let x=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(y,o,!0),this.lexer.state.top=x,n.length===0)break;let b=o.at(-1);if((b==null?void 0:b.type)==="code")break;if((b==null?void 0:b.type)==="blockquote"){let k=b,I=k.raw+`
`+n.join(`
`),L=this.blockquote(I);o[o.length-1]=L,a=a.substring(0,a.length-k.raw.length)+L.raw,s=s.substring(0,s.length-k.text.length)+L.text;break}else if((b==null?void 0:b.type)==="list"){let k=b,I=k.raw+`
`+n.join(`
`),L=this.list(I);o[o.length-1]=L,a=a.substring(0,a.length-b.raw.length)+L.raw,s=s.substring(0,s.length-k.raw.length)+L.raw,n=I.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:s}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim(),o=s.length>1,u={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let f=this.rules.other.listItemRegex(s),h=!1;for(;t;){let y=!1,x="",b="";if(!(e=f.exec(t))||this.rules.block.hr.test(t))break;x=e[0],t=t.substring(x.length);let k=L_(e[2].split(`
`,1)[0],e[1].length),I=t.split(`
`,1)[0],L=!k.trim(),z=0;if(this.options.pedantic?(z=2,b=k.trimStart()):L?z=e[1].length+1:(z=k.search(this.rules.other.nonSpaceChar),z=z>4?1:z,b=k.slice(z),z+=e[1].length),L&&this.rules.other.blankLine.test(I)&&(x+=I+`
`,t=t.substring(I.length+1),y=!0),!y){let ie=this.rules.other.nextBulletRegex(z),ce=this.rules.other.hrRegex(z),ne=this.rules.other.fencesBeginRegex(z),R=this.rules.other.headingBeginRegex(z),Z=this.rules.other.htmlBeginRegex(z),W=this.rules.other.blockquoteBeginRegex(z);for(;t;){let P=t.split(`
`,1)[0],ue;if(I=P,this.options.pedantic?(I=I.replace(this.rules.other.listReplaceNesting,"  "),ue=I):ue=I.replace(this.rules.other.tabCharGlobal,"    "),ne.test(I)||R.test(I)||Z.test(I)||W.test(I)||ie.test(I)||ce.test(I))break;if(ue.search(this.rules.other.nonSpaceChar)>=z||!I.trim())b+=`
`+ue.slice(z);else{if(L||k.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||ne.test(k)||R.test(k)||ce.test(k))break;b+=`
`+I}L=!I.trim(),x+=P+`
`,t=t.substring(P.length+1),k=ue.slice(z)}}u.loose||(h?u.loose=!0:this.rules.other.doubleBlankLine.test(x)&&(h=!0)),u.items.push({type:"list_item",raw:x,task:!!this.options.gfm&&this.rules.other.listIsTask.test(b),loose:!1,text:b,tokens:[]}),u.raw+=x}let m=u.items.at(-1);if(m)m.raw=m.raw.trimEnd(),m.text=m.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let y of u.items){if(this.lexer.state.top=!1,y.tokens=this.lexer.blockTokens(y.text,[]),y.task){if(y.text=y.text.replace(this.rules.other.listReplaceTask,""),((n=y.tokens[0])==null?void 0:n.type)==="text"||((a=y.tokens[0])==null?void 0:a.type)==="paragraph"){y.tokens[0].raw=y.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),y.tokens[0].text=y.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let b=this.lexer.inlineQueue.length-1;b>=0;b--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[b].src)){this.lexer.inlineQueue[b].src=this.lexer.inlineQueue[b].src.replace(this.rules.other.listReplaceTask,"");break}}let x=this.rules.other.listTaskCheckbox.exec(y.raw);if(x){let b={type:"checkbox",raw:x[0]+" ",checked:x[0]!=="[ ]"};y.checked=b.checked,u.loose?y.tokens[0]&&["paragraph","text"].includes(y.tokens[0].type)&&"tokens"in y.tokens[0]&&y.tokens[0].tokens?(y.tokens[0].raw=b.raw+y.tokens[0].raw,y.tokens[0].text=b.raw+y.tokens[0].text,y.tokens[0].tokens.unshift(b)):y.tokens.unshift({type:"paragraph",raw:b.raw,text:b.raw,tokens:[b]}):y.tokens.unshift(b)}}if(!u.loose){let x=y.tokens.filter(k=>k.type==="space"),b=x.length>0&&x.some(k=>this.rules.other.anyLine.test(k.raw));u.loose=b}}if(u.loose)for(let y of u.items){y.loose=!0;for(let x of y.tokens)x.type==="text"&&(x.type="paragraph")}return u}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:s}}}table(t){var u;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=Lc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let f of a)this.rules.other.tableAlignRight.test(f)?o.align.push("right"):this.rules.other.tableAlignCenter.test(f)?o.align.push("center"):this.rules.other.tableAlignLeft.test(f)?o.align.push("left"):o.align.push(null);for(let f=0;f<n.length;f++)o.header.push({text:n[f],tokens:this.lexer.inline(n[f]),header:!0,align:o.align[f]});for(let f of s)o.rows.push(Lc(f,o.header.length).map((h,m)=>({text:h,tokens:this.lexer.inline(h),header:!1,align:o.align[m]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=vs(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=j_(e[2],"()");if(o===-2)return;if(o>-1){let u=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],s=o[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),Nc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[a.toLowerCase()];if(!s){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Nc(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,f=s,h=0,m=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(m.lastIndex=0,e=e.slice(-1*t.length+s);(a=m.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(u=[...o].length,a[3]||a[4]){f+=u;continue}else if((a[5]||a[6])&&s%3&&!((s+u)%3)){h+=u;continue}if(f-=u,f>0)continue;u=Math.min(u,u+f+h);let y=[...a[0]][0].length,x=t.slice(0,s+a.index+y+u);if(Math.min(s,u)%2){let k=x.slice(1,-1);return{type:"em",raw:x,text:k,tokens:this.lexer.inlineTokens(k)}}let b=x.slice(2,-2);return{type:"strong",raw:x,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,f=s,h=this.rules.inline.delRDelim;for(h.lastIndex=0,e=e.slice(-1*t.length+s);(a=h.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(u=[...o].length,u!==s))continue;if(a[3]||a[4]){f+=u;continue}if(f-=u,f>0)continue;u=Math.min(u,u+f);let m=[...a[0]][0].length,y=t.slice(0,s+a.index+m+u),x=y.slice(s,-s);return{type:"del",raw:y,text:x,tokens:this.lexer.inlineTokens(x)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,s;if(e[2]==="@")a=e[0],s="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:a,href:s,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},sr=class Go{constructor(e){ct(this,"tokens");ct(this,"options");ct(this,"state");ct(this,"inlineQueue");ct(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Oa,this.options.tokenizer=this.options.tokenizer||new Si,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:_n,block:ui.normal,inline:fs.normal};this.options.pedantic?(n.block=ui.pedantic,n.inline=fs.pedantic):this.options.gfm&&(n.block=ui.gfm,this.options.breaks?n.inline=fs.breaks:n.inline=fs.gfm),this.tokenizer.rules=n}static get rules(){return{block:ui,inline:fs}}static lex(e,n){return new Go(n).lex(e)}static lexInline(e,n){return new Go(n).inlineTokens(e)}lex(e){e=e.replace(_n.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var s,o,u;for(this.options.pedantic&&(e=e.replace(_n.tabCharGlobal,"    ").replace(_n.spaceLine,""));e;){let f;if((o=(s=this.options.extensions)==null?void 0:s.block)!=null&&o.some(m=>(f=m.call({lexer:this},e,n))?(e=e.substring(f.raw.length),n.push(f),!0):!1))continue;if(f=this.tokenizer.space(e)){e=e.substring(f.raw.length);let m=n.at(-1);f.raw.length===1&&m!==void 0?m.raw+=`
`:n.push(f);continue}if(f=this.tokenizer.code(e)){e=e.substring(f.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+f.raw,m.text+=`
`+f.text,this.inlineQueue.at(-1).src=m.text):n.push(f);continue}if(f=this.tokenizer.fences(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.heading(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.hr(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.blockquote(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.list(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.html(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.def(e)){e=e.substring(f.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+f.raw,m.text+=`
`+f.raw,this.inlineQueue.at(-1).src=m.text):this.tokens.links[f.tag]||(this.tokens.links[f.tag]={href:f.href,title:f.title},n.push(f));continue}if(f=this.tokenizer.table(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.lheading(e)){e=e.substring(f.raw.length),n.push(f);continue}let h=e;if((u=this.options.extensions)!=null&&u.startBlock){let m=1/0,y=e.slice(1),x;this.options.extensions.startBlock.forEach(b=>{x=b.call({lexer:this},y),typeof x=="number"&&x>=0&&(m=Math.min(m,x))}),m<1/0&&m>=0&&(h=e.substring(0,m+1))}if(this.state.top&&(f=this.tokenizer.paragraph(h))){let m=n.at(-1);a&&(m==null?void 0:m.type)==="paragraph"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+f.raw,m.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(f),a=h.length!==e.length,e=e.substring(f.raw.length);continue}if(f=this.tokenizer.text(e)){e=e.substring(f.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+f.raw,m.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(f);continue}if(e){let m="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var h,m,y,x,b;let a=e,s=null;if(this.tokens.links){let k=Object.keys(this.tokens.links);if(k.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)k.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=s[2]?s[2].length:0,a=a.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((m=(h=this.options.hooks)==null?void 0:h.emStrongMask)==null?void 0:m.call({lexer:this},a))??a;let u=!1,f="";for(;e;){u||(f=""),u=!1;let k;if((x=(y=this.options.extensions)==null?void 0:y.inline)!=null&&x.some(L=>(k=L.call({lexer:this},e,n))?(e=e.substring(k.raw.length),n.push(k),!0):!1))continue;if(k=this.tokenizer.escape(e)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.tag(e)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.link(e)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(k.raw.length);let L=n.at(-1);k.type==="text"&&(L==null?void 0:L.type)==="text"?(L.raw+=k.raw,L.text+=k.text):n.push(k);continue}if(k=this.tokenizer.emStrong(e,a,f)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.codespan(e)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.br(e)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.del(e,a,f)){e=e.substring(k.raw.length),n.push(k);continue}if(k=this.tokenizer.autolink(e)){e=e.substring(k.raw.length),n.push(k);continue}if(!this.state.inLink&&(k=this.tokenizer.url(e))){e=e.substring(k.raw.length),n.push(k);continue}let I=e;if((b=this.options.extensions)!=null&&b.startInline){let L=1/0,z=e.slice(1),ie;this.options.extensions.startInline.forEach(ce=>{ie=ce.call({lexer:this},z),typeof ie=="number"&&ie>=0&&(L=Math.min(L,ie))}),L<1/0&&L>=0&&(I=e.substring(0,L+1))}if(k=this.tokenizer.inlineText(I)){e=e.substring(k.raw.length),k.raw.slice(-1)!=="_"&&(f=k.raw.slice(-1)),u=!0;let L=n.at(-1);(L==null?void 0:L.type)==="text"?(L.raw+=k.raw,L.text+=k.text):n.push(k);continue}if(e){let L="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(L);break}else throw new Error(L)}}return n}},Ei=class{constructor(t){ct(this,"options");ct(this,"parser");this.options=t||Oa}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(_n.notSpaceStart))==null?void 0:o[0],s=t.replace(_n.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Cr(a)+'">'+(n?s:Cr(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:Cr(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let u=0;u<t.items.length;u++){let f=t.items[u];a+=this.listitem(f)}let s=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+s+o+`>
`+a+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let a="";for(let s=0;s<t.rows.length;s++){let o=t.rows[s];n="";for(let u=0;u<o.length;u++)n+=this.tablecell(o[u]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Cr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),s=jc(t);if(s===null)return a;t=s;let o='<a href="'+t+'"';return e&&(o+=' title="'+Cr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=jc(t);if(s===null)return Cr(n);t=s;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Cr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Cr(t.text)}},Cl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},ir=class Wo{constructor(e){ct(this,"options");ct(this,"renderer");ct(this,"textRenderer");this.options=e||Oa,this.options.renderer=this.options.renderer||new Ei,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Cl}static parse(e,n){return new Wo(n).parse(e)}static parseInline(e,n){return new Wo(n).parseInline(e)}parse(e){var a,s;let n="";for(let o=0;o<e.length;o++){let u=e[o];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[u.type]){let h=u,m=this.options.extensions.renderers[h.type].call({parser:this},h);if(m!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(h.type)){n+=m||"";continue}}let f=u;switch(f.type){case"space":{n+=this.renderer.space(f);break}case"hr":{n+=this.renderer.hr(f);break}case"heading":{n+=this.renderer.heading(f);break}case"code":{n+=this.renderer.code(f);break}case"table":{n+=this.renderer.table(f);break}case"blockquote":{n+=this.renderer.blockquote(f);break}case"list":{n+=this.renderer.list(f);break}case"checkbox":{n+=this.renderer.checkbox(f);break}case"html":{n+=this.renderer.html(f);break}case"def":{n+=this.renderer.def(f);break}case"paragraph":{n+=this.renderer.paragraph(f);break}case"text":{n+=this.renderer.text(f);break}default:{let h='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return n}parseInline(e,n=this.renderer){var s,o;let a="";for(let u=0;u<e.length;u++){let f=e[u];if((o=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&o[f.type]){let m=this.options.extensions.renderers[f.type].call({parser:this},f);if(m!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(f.type)){a+=m||"";continue}}let h=f;switch(h.type){case"escape":{a+=n.text(h);break}case"html":{a+=n.html(h);break}case"link":{a+=n.link(h);break}case"image":{a+=n.image(h);break}case"checkbox":{a+=n.checkbox(h);break}case"strong":{a+=n.strong(h);break}case"em":{a+=n.em(h);break}case"codespan":{a+=n.codespan(h);break}case"br":{a+=n.br(h);break}case"del":{a+=n.del(h);break}case"text":{a+=n.text(h);break}default:{let m='Token with "'+h.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return a}},vi,ws=(vi=class{constructor(t){ct(this,"options");ct(this,"block");this.options=t||Oa}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?sr.lex:sr.lexInline}provideParser(){return this.block?ir.parse:ir.parseInline}},ct(vi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ct(vi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),vi),q_=class{constructor(...t){ct(this,"defaults",bl());ct(this,"options",this.setOptions);ct(this,"parse",this.parseMarkdown(!0));ct(this,"parseInline",this.parseMarkdown(!1));ct(this,"Parser",ir);ct(this,"Renderer",Ei);ct(this,"TextRenderer",Cl);ct(this,"Lexer",sr);ct(this,"Tokenizer",Si);ct(this,"Hooks",ws);this.use(...t)}walkTokens(t,e){var a,s;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let u=o;for(let f of u.header)n=n.concat(this.walkTokens(f.tokens,e));for(let f of u.rows)for(let h of f)n=n.concat(this.walkTokens(h.tokens,e));break}case"list":{let u=o;n=n.concat(this.walkTokens(u.items,e));break}default:{let u=o;(s=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&s[u.type]?this.defaults.extensions.childTokens[u.type].forEach(f=>{let h=u[f].flat(1/0);n=n.concat(this.walkTokens(h,e))}):u.tokens&&(n=n.concat(this.walkTokens(u.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=e.renderers[s.name];o?e.renderers[s.name]=function(...u){let f=s.renderer.apply(this,u);return f===!1&&(f=o.apply(this,u)),f}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),a.extensions=e),n.renderer){let s=this.defaults.renderer||new Ei(this.defaults);for(let o in n.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let u=o,f=n.renderer[u],h=s[u];s[u]=(...m)=>{let y=f.apply(s,m);return y===!1&&(y=h.apply(s,m)),y||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Si(this.defaults);for(let o in n.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let u=o,f=n.tokenizer[u],h=s[u];s[u]=(...m)=>{let y=f.apply(s,m);return y===!1&&(y=h.apply(s,m)),y}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new ws;for(let o in n.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let u=o,f=n.hooks[u],h=s[u];ws.passThroughHooks.has(o)?s[u]=m=>{if(this.defaults.async&&ws.passThroughHooksRespectAsync.has(o))return(async()=>{let x=await f.call(s,m);return h.call(s,x)})();let y=f.call(s,m);return h.call(s,y)}:s[u]=(...m)=>{if(this.defaults.async)return(async()=>{let x=await f.apply(s,m);return x===!1&&(x=await h.apply(s,m)),x})();let y=f.apply(s,m);return y===!1&&(y=h.apply(s,m)),y}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(u){let f=[];return f.push(o.call(this,u)),s&&(f=f.concat(s.call(this,u))),f}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return sr.lex(t,e??this.defaults)}parser(t,e){return ir.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},s={...this.defaults,...a},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let u=s.hooks?await s.hooks.preprocess(e):e,f=await(s.hooks?await s.hooks.provideLexer():t?sr.lex:sr.lexInline)(u,s),h=s.hooks?await s.hooks.processAllTokens(f):f;s.walkTokens&&await Promise.all(this.walkTokens(h,s.walkTokens));let m=await(s.hooks?await s.hooks.provideParser():t?ir.parse:ir.parseInline)(h,s);return s.hooks?await s.hooks.postprocess(m):m})().catch(o);try{s.hooks&&(e=s.hooks.preprocess(e));let u=(s.hooks?s.hooks.provideLexer():t?sr.lex:sr.lexInline)(e,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let f=(s.hooks?s.hooks.provideParser():t?ir.parse:ir.parseInline)(u,s);return s.hooks&&(f=s.hooks.postprocess(f)),f}catch(u){return o(u)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Cr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},Ca=new q_;function xt(t,e){return Ca.parse(t,e)}xt.options=xt.setOptions=function(t){return Ca.setOptions(t),xt.defaults=Ca.defaults,kd(xt.defaults),xt};xt.getDefaults=bl;xt.defaults=Oa;xt.use=function(...t){return Ca.use(...t),xt.defaults=Ca.defaults,kd(xt.defaults),xt};xt.walkTokens=function(t,e){return Ca.walkTokens(t,e)};xt.parseInline=Ca.parseInline;xt.Parser=ir;xt.parser=ir.parse;xt.Renderer=Ei;xt.TextRenderer=Cl;xt.Lexer=sr;xt.lexer=sr.lex;xt.Tokenizer=Si;xt.Hooks=ws;xt.parse=xt;xt.options;xt.setOptions;xt.use;xt.walkTokens;xt.parseInline;ir.parse;sr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Dd,setPrototypeOf:qc,isFrozen:B_,getPrototypeOf:F_,getOwnPropertyDescriptor:z_}=Object;let{freeze:yn,seal:Zn,create:Ho}=Object,{apply:Vo,construct:Yo}=typeof Reflect<"u"&&Reflect;yn||(yn=function(e){return e});Zn||(Zn=function(e){return e});Vo||(Vo=function(e,n){for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return e.apply(n,s)});Yo||(Yo=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return new e(...a)});const di=bn(Array.prototype.forEach),U_=bn(Array.prototype.lastIndexOf),Bc=bn(Array.prototype.pop),ps=bn(Array.prototype.push),K_=bn(Array.prototype.splice),yi=bn(String.prototype.toLowerCase),bo=bn(String.prototype.toString),wo=bn(String.prototype.match),hs=bn(String.prototype.replace),G_=bn(String.prototype.indexOf),W_=bn(String.prototype.trim),rr=bn(Object.prototype.hasOwnProperty),mn=bn(RegExp.prototype.test),ms=H_(TypeError);function bn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return Vo(t,e,a)}}function H_(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Yo(t,n)}}function lt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yi;qc&&qc(t,null);let a=e.length;for(;a--;){let s=e[a];if(typeof s=="string"){const o=n(s);o!==s&&(B_(e)||(e[a]=o),s=o)}t[s]=!0}return t}function V_(t){for(let e=0;e<t.length;e++)rr(t,e)||(t[e]=null);return t}function mr(t){const e=Ho(null);for(const[n,a]of Dd(t))rr(t,n)&&(Array.isArray(a)?e[n]=V_(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=mr(a):e[n]=a);return e}function gs(t,e){for(;t!==null;){const a=z_(t,e);if(a){if(a.get)return bn(a.get);if(typeof a.value=="function")return bn(a.value)}t=F_(t)}function n(){return null}return n}const Fc=yn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ko=yn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xo=yn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Y_=yn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),So=yn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Q_=yn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),zc=yn(["#text"]),Uc=yn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Eo=yn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Kc=yn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),fi=yn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),X_=Zn(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Z_=Zn(/<%[\w\W]*|[\w\W]*%>/gm),J_=Zn(/\$\{[\w\W]*/gm),$_=Zn(/^data-[\-\w.\u00B7-\uFFFF]+$/),ey=Zn(/^aria-[\-\w]+$/),jd=Zn(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ty=Zn(/^(?:\w+script|data):/i),ny=Zn(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ld=Zn(/^html$/i),ry=Zn(/^[a-z][.\w]*(-[.\w]+)+$/i);var Gc=Object.freeze({__proto__:null,ARIA_ATTR:ey,ATTR_WHITESPACE:ny,CUSTOM_ELEMENT:ry,DATA_ATTR:$_,DOCTYPE_NAME:Ld,ERB_EXPR:Z_,IS_ALLOWED_URI:jd,IS_SCRIPT_OR_DATA:ty,MUSTACHE_EXPR:X_,TMPLIT_EXPR:J_});const _s={element:1,text:3,progressingInstruction:7,comment:8,document:9},ay=function(){return typeof window>"u"?null:window},sy=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(a=n.getAttribute(s));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Wc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Nd(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ay();const e=Ge=>Nd(Ge);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==_s.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,s=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:f,Element:h,NodeFilter:m,NamedNodeMap:y=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:x,DOMParser:b,trustedTypes:k}=t,I=h.prototype,L=gs(I,"cloneNode"),z=gs(I,"remove"),ie=gs(I,"nextSibling"),ce=gs(I,"childNodes"),ne=gs(I,"parentNode");if(typeof u=="function"){const Ge=n.createElement("template");Ge.content&&Ge.content.ownerDocument&&(n=Ge.content.ownerDocument)}let R,Z="";const{implementation:W,createNodeIterator:P,createDocumentFragment:ue,getElementsByTagName:ke}=n,{importNode:ye}=a;let be=Wc();e.isSupported=typeof Dd=="function"&&typeof ne=="function"&&W&&W.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Y,ERB_EXPR:J,TMPLIT_EXPR:ve,DATA_ATTR:ae,ARIA_ATTR:he,IS_SCRIPT_OR_DATA:xe,ATTR_WHITESPACE:le,CUSTOM_ELEMENT:fe}=Gc;let{IS_ALLOWED_URI:we}=Gc,Se=null;const me=lt({},[...Fc,...ko,...xo,...So,...zc]);let D=null;const H=lt({},[...Uc,...Eo,...Kc,...fi]);let se=Object.seal(Ho(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),G=null,de=null;const Me=Object.seal(Ho(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let re=!0,T=!0,pe=!1,$=!0,Ee=!1,qe=!0,Fe=!1,et=!1,rt=!1,nt=!1,Ve=!1,Xe=!1,tt=!0,vt=!1;const At="user-content-";let We=!0,Ke=!1,Ze={},Ye=null;const mt=lt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Dt=null;const rn=lt({},["audio","video","img","source","image","track"]);let an=null;const Ft=lt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),It="http://www.w3.org/1998/Math/MathML",Jt="http://www.w3.org/2000/svg",Qe="http://www.w3.org/1999/xhtml";let Ae=Qe,pt=!1,Rt=null;const Qt=lt({},[It,Jt,Qe],bo);let Oe=lt({},["mi","mo","mn","ms","mtext"]),Xt=lt({},["annotation-xml"]);const Br=lt({},["title","style","font","a","script"]);let Cn=null;const zt=["application/xhtml+xml","text/html"],jt="text/html";let kt=null,In=null;const dr=n.createElement("form"),Rn=function(M){return M instanceof RegExp||M instanceof Function},fr=function(){let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(In&&In===M)){if((!M||typeof M!="object")&&(M={}),M=mr(M),Cn=zt.indexOf(M.PARSER_MEDIA_TYPE)===-1?jt:M.PARSER_MEDIA_TYPE,kt=Cn==="application/xhtml+xml"?bo:yi,Se=rr(M,"ALLOWED_TAGS")?lt({},M.ALLOWED_TAGS,kt):me,D=rr(M,"ALLOWED_ATTR")?lt({},M.ALLOWED_ATTR,kt):H,Rt=rr(M,"ALLOWED_NAMESPACES")?lt({},M.ALLOWED_NAMESPACES,bo):Qt,an=rr(M,"ADD_URI_SAFE_ATTR")?lt(mr(Ft),M.ADD_URI_SAFE_ATTR,kt):Ft,Dt=rr(M,"ADD_DATA_URI_TAGS")?lt(mr(rn),M.ADD_DATA_URI_TAGS,kt):rn,Ye=rr(M,"FORBID_CONTENTS")?lt({},M.FORBID_CONTENTS,kt):mt,G=rr(M,"FORBID_TAGS")?lt({},M.FORBID_TAGS,kt):mr({}),de=rr(M,"FORBID_ATTR")?lt({},M.FORBID_ATTR,kt):mr({}),Ze=rr(M,"USE_PROFILES")?M.USE_PROFILES:!1,re=M.ALLOW_ARIA_ATTR!==!1,T=M.ALLOW_DATA_ATTR!==!1,pe=M.ALLOW_UNKNOWN_PROTOCOLS||!1,$=M.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ee=M.SAFE_FOR_TEMPLATES||!1,qe=M.SAFE_FOR_XML!==!1,Fe=M.WHOLE_DOCUMENT||!1,nt=M.RETURN_DOM||!1,Ve=M.RETURN_DOM_FRAGMENT||!1,Xe=M.RETURN_TRUSTED_TYPE||!1,rt=M.FORCE_BODY||!1,tt=M.SANITIZE_DOM!==!1,vt=M.SANITIZE_NAMED_PROPS||!1,We=M.KEEP_CONTENT!==!1,Ke=M.IN_PLACE||!1,we=M.ALLOWED_URI_REGEXP||jd,Ae=M.NAMESPACE||Qe,Oe=M.MATHML_TEXT_INTEGRATION_POINTS||Oe,Xt=M.HTML_INTEGRATION_POINTS||Xt,se=M.CUSTOM_ELEMENT_HANDLING||{},M.CUSTOM_ELEMENT_HANDLING&&Rn(M.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(se.tagNameCheck=M.CUSTOM_ELEMENT_HANDLING.tagNameCheck),M.CUSTOM_ELEMENT_HANDLING&&Rn(M.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(se.attributeNameCheck=M.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),M.CUSTOM_ELEMENT_HANDLING&&typeof M.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(se.allowCustomizedBuiltInElements=M.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ee&&(T=!1),Ve&&(nt=!0),Ze&&(Se=lt({},zc),D=[],Ze.html===!0&&(lt(Se,Fc),lt(D,Uc)),Ze.svg===!0&&(lt(Se,ko),lt(D,Eo),lt(D,fi)),Ze.svgFilters===!0&&(lt(Se,xo),lt(D,Eo),lt(D,fi)),Ze.mathMl===!0&&(lt(Se,So),lt(D,Kc),lt(D,fi))),M.ADD_TAGS&&(typeof M.ADD_TAGS=="function"?Me.tagCheck=M.ADD_TAGS:(Se===me&&(Se=mr(Se)),lt(Se,M.ADD_TAGS,kt))),M.ADD_ATTR&&(typeof M.ADD_ATTR=="function"?Me.attributeCheck=M.ADD_ATTR:(D===H&&(D=mr(D)),lt(D,M.ADD_ATTR,kt))),M.ADD_URI_SAFE_ATTR&&lt(an,M.ADD_URI_SAFE_ATTR,kt),M.FORBID_CONTENTS&&(Ye===mt&&(Ye=mr(Ye)),lt(Ye,M.FORBID_CONTENTS,kt)),M.ADD_FORBID_CONTENTS&&(Ye===mt&&(Ye=mr(Ye)),lt(Ye,M.ADD_FORBID_CONTENTS,kt)),We&&(Se["#text"]=!0),Fe&&lt(Se,["html","head","body"]),Se.table&&(lt(Se,["tbody"]),delete G.tbody),M.TRUSTED_TYPES_POLICY){if(typeof M.TRUSTED_TYPES_POLICY.createHTML!="function")throw ms('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof M.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ms('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');R=M.TRUSTED_TYPES_POLICY,Z=R.createHTML("")}else R===void 0&&(R=sy(k,s)),R!==null&&typeof Z=="string"&&(Z=R.createHTML(""));yn&&yn(M),In=M}},Er=lt({},[...ko,...xo,...Y_]),Ot=lt({},[...So,...Q_]),Zt=function(M){let Ie=ne(M);(!Ie||!Ie.tagName)&&(Ie={namespaceURI:Ae,tagName:"template"});const De=yi(M.tagName),yt=yi(Ie.tagName);return Rt[M.namespaceURI]?M.namespaceURI===Jt?Ie.namespaceURI===Qe?De==="svg":Ie.namespaceURI===It?De==="svg"&&(yt==="annotation-xml"||Oe[yt]):!!Er[De]:M.namespaceURI===It?Ie.namespaceURI===Qe?De==="math":Ie.namespaceURI===Jt?De==="math"&&Xt[yt]:!!Ot[De]:M.namespaceURI===Qe?Ie.namespaceURI===Jt&&!Xt[yt]||Ie.namespaceURI===It&&!Oe[yt]?!1:!Ot[De]&&(Br[De]||!Er[De]):!!(Cn==="application/xhtml+xml"&&Rt[M.namespaceURI]):!1},Bn=function(M){ps(e.removed,{element:M});try{ne(M).removeChild(M)}catch{z(M)}},Fn=function(M,Ie){try{ps(e.removed,{attribute:Ie.getAttributeNode(M),from:Ie})}catch{ps(e.removed,{attribute:null,from:Ie})}if(Ie.removeAttribute(M),M==="is")if(nt||Ve)try{Bn(Ie)}catch{}else try{Ie.setAttribute(M,"")}catch{}},$r=function(M){let Ie=null,De=null;if(rt)M="<remove></remove>"+M;else{const Ut=wo(M,/^[\r\n\t ]+/);De=Ut&&Ut[0]}Cn==="application/xhtml+xml"&&Ae===Qe&&(M='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+M+"</body></html>");const yt=R?R.createHTML(M):M;if(Ae===Qe)try{Ie=new b().parseFromString(yt,Cn)}catch{}if(!Ie||!Ie.documentElement){Ie=W.createDocument(Ae,"template",null);try{Ie.documentElement.innerHTML=pt?Z:yt}catch{}}const Lt=Ie.body||Ie.documentElement;return M&&De&&Lt.insertBefore(n.createTextNode(De),Lt.childNodes[0]||null),Ae===Qe?ke.call(Ie,Fe?"html":"body")[0]:Fe?Ie.documentElement:Lt},ea=function(M){return P.call(M.ownerDocument||M,M,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},es=function(M){return M instanceof x&&(typeof M.nodeName!="string"||typeof M.textContent!="string"||typeof M.removeChild!="function"||!(M.attributes instanceof y)||typeof M.removeAttribute!="function"||typeof M.setAttribute!="function"||typeof M.namespaceURI!="string"||typeof M.insertBefore!="function"||typeof M.hasChildNodes!="function")},Jn=function(M){return typeof f=="function"&&M instanceof f};function fn(Ge,M,Ie){di(Ge,De=>{De.call(e,M,Ie,In)})}const $n=function(M){let Ie=null;if(fn(be.beforeSanitizeElements,M,null),es(M))return Bn(M),!0;const De=kt(M.nodeName);if(fn(be.uponSanitizeElement,M,{tagName:De,allowedTags:Se}),qe&&M.hasChildNodes()&&!Jn(M.firstElementChild)&&mn(/<[/\w!]/g,M.innerHTML)&&mn(/<[/\w!]/g,M.textContent)||M.nodeType===_s.progressingInstruction||qe&&M.nodeType===_s.comment&&mn(/<[/\w]/g,M.data))return Bn(M),!0;if(!(Me.tagCheck instanceof Function&&Me.tagCheck(De))&&(!Se[De]||G[De])){if(!G[De]&&Ks(De)&&(se.tagNameCheck instanceof RegExp&&mn(se.tagNameCheck,De)||se.tagNameCheck instanceof Function&&se.tagNameCheck(De)))return!1;if(We&&!Ye[De]){const yt=ne(M)||M.parentNode,Lt=ce(M)||M.childNodes;if(Lt&&yt){const Ut=Lt.length;for(let Ht=Ut-1;Ht>=0;--Ht){const wn=L(Lt[Ht],!0);wn.__removalCount=(M.__removalCount||0)+1,yt.insertBefore(wn,ie(M))}}}return Bn(M),!0}return M instanceof h&&!Zt(M)||(De==="noscript"||De==="noembed"||De==="noframes")&&mn(/<\/no(script|embed|frames)/i,M.innerHTML)?(Bn(M),!0):(Ee&&M.nodeType===_s.text&&(Ie=M.textContent,di([Y,J,ve],yt=>{Ie=hs(Ie,yt," ")}),M.textContent!==Ie&&(ps(e.removed,{element:M.cloneNode()}),M.textContent=Ie)),fn(be.afterSanitizeElements,M,null),!1)},ta=function(M,Ie,De){if(tt&&(Ie==="id"||Ie==="name")&&(De in n||De in dr))return!1;if(!(T&&!de[Ie]&&mn(ae,Ie))){if(!(re&&mn(he,Ie))){if(!(Me.attributeCheck instanceof Function&&Me.attributeCheck(Ie,M))){if(!D[Ie]||de[Ie]){if(!(Ks(M)&&(se.tagNameCheck instanceof RegExp&&mn(se.tagNameCheck,M)||se.tagNameCheck instanceof Function&&se.tagNameCheck(M))&&(se.attributeNameCheck instanceof RegExp&&mn(se.attributeNameCheck,Ie)||se.attributeNameCheck instanceof Function&&se.attributeNameCheck(Ie,M))||Ie==="is"&&se.allowCustomizedBuiltInElements&&(se.tagNameCheck instanceof RegExp&&mn(se.tagNameCheck,De)||se.tagNameCheck instanceof Function&&se.tagNameCheck(De))))return!1}else if(!an[Ie]){if(!mn(we,hs(De,le,""))){if(!((Ie==="src"||Ie==="xlink:href"||Ie==="href")&&M!=="script"&&G_(De,"data:")===0&&Dt[M])){if(!(pe&&!mn(xe,hs(De,le,"")))){if(De)return!1}}}}}}}return!0},Ks=function(M){return M!=="annotation-xml"&&wo(M,fe)},er=function(M){fn(be.beforeSanitizeAttributes,M,null);const{attributes:Ie}=M;if(!Ie||es(M))return;const De={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:D,forceKeepAttr:void 0};let yt=Ie.length;for(;yt--;){const Lt=Ie[yt],{name:Ut,namespaceURI:Ht,value:wn}=Lt,vr=kt(Ut),na=wn;let qt=Ut==="value"?na:W_(na);if(De.attrName=vr,De.attrValue=qt,De.keepAttr=!0,De.forceKeepAttr=void 0,fn(be.uponSanitizeAttribute,M,De),qt=De.attrValue,vt&&(vr==="id"||vr==="name")&&(Fn(Ut,M),qt=At+qt),qe&&mn(/((--!?|])>)|<\/(style|title|textarea)/i,qt)){Fn(Ut,M);continue}if(vr==="attributename"&&wo(qt,"href")){Fn(Ut,M);continue}if(De.forceKeepAttr)continue;if(!De.keepAttr){Fn(Ut,M);continue}if(!$&&mn(/\/>/i,qt)){Fn(Ut,M);continue}Ee&&di([Y,J,ve],ra=>{qt=hs(qt,ra," ")});const ts=kt(M.nodeName);if(!ta(ts,vr,qt)){Fn(Ut,M);continue}if(R&&typeof k=="object"&&typeof k.getAttributeType=="function"&&!Ht)switch(k.getAttributeType(ts,vr)){case"TrustedHTML":{qt=R.createHTML(qt);break}case"TrustedScriptURL":{qt=R.createScriptURL(qt);break}}if(qt!==na)try{Ht?M.setAttributeNS(Ht,Ut,qt):M.setAttribute(Ut,qt),es(M)?Bn(M):Bc(e.removed)}catch{Fn(Ut,M)}}fn(be.afterSanitizeAttributes,M,null)},Gs=function Ge(M){let Ie=null;const De=ea(M);for(fn(be.beforeSanitizeShadowDOM,M,null);Ie=De.nextNode();)fn(be.uponSanitizeShadowNode,Ie,null),$n(Ie),er(Ie),Ie.content instanceof o&&Ge(Ie.content);fn(be.afterSanitizeShadowDOM,M,null)};return e.sanitize=function(Ge){let M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie=null,De=null,yt=null,Lt=null;if(pt=!Ge,pt&&(Ge="<!-->"),typeof Ge!="string"&&!Jn(Ge))if(typeof Ge.toString=="function"){if(Ge=Ge.toString(),typeof Ge!="string")throw ms("dirty is not a string, aborting")}else throw ms("toString is not a function");if(!e.isSupported)return Ge;if(et||fr(M),e.removed=[],typeof Ge=="string"&&(Ke=!1),Ke){if(Ge.nodeName){const wn=kt(Ge.nodeName);if(!Se[wn]||G[wn])throw ms("root node is forbidden and cannot be sanitized in-place")}}else if(Ge instanceof f)Ie=$r("<!---->"),De=Ie.ownerDocument.importNode(Ge,!0),De.nodeType===_s.element&&De.nodeName==="BODY"||De.nodeName==="HTML"?Ie=De:Ie.appendChild(De);else{if(!nt&&!Ee&&!Fe&&Ge.indexOf("<")===-1)return R&&Xe?R.createHTML(Ge):Ge;if(Ie=$r(Ge),!Ie)return nt?null:Xe?Z:""}Ie&&rt&&Bn(Ie.firstChild);const Ut=ea(Ke?Ge:Ie);for(;yt=Ut.nextNode();)$n(yt),er(yt),yt.content instanceof o&&Gs(yt.content);if(Ke)return Ge;if(nt){if(Ve)for(Lt=ue.call(Ie.ownerDocument);Ie.firstChild;)Lt.appendChild(Ie.firstChild);else Lt=Ie;return(D.shadowroot||D.shadowrootmode)&&(Lt=ye.call(a,Lt,!0)),Lt}let Ht=Fe?Ie.outerHTML:Ie.innerHTML;return Fe&&Se["!doctype"]&&Ie.ownerDocument&&Ie.ownerDocument.doctype&&Ie.ownerDocument.doctype.name&&mn(Ld,Ie.ownerDocument.doctype.name)&&(Ht="<!DOCTYPE "+Ie.ownerDocument.doctype.name+`>
`+Ht),Ee&&di([Y,J,ve],wn=>{Ht=hs(Ht,wn," ")}),R&&Xe?R.createHTML(Ht):Ht},e.setConfig=function(){let Ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};fr(Ge),et=!0},e.clearConfig=function(){In=null,et=!1},e.isValidAttribute=function(Ge,M,Ie){In||fr({});const De=kt(Ge),yt=kt(M);return ta(De,yt,Ie)},e.addHook=function(Ge,M){typeof M=="function"&&ps(be[Ge],M)},e.removeHook=function(Ge,M){if(M!==void 0){const Ie=U_(be[Ge],M);return Ie===-1?void 0:K_(be[Ge],Ie,1)[0]}return Bc(be[Ge])},e.removeHooks=function(Ge){be[Ge]=[]},e.removeAllHooks=function(){be=Wc()},e}var iy=Nd();function oy(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Hc(t.from)} |`),e.push(`| **To** | ${Hc(t.to)} |`),e.push(`| **Date** | ${hl(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?ly(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Hc(t){return(t||"").replace(/\|/g,"\\|")}function ly(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Qo(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function cy(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const s=e.toLowerCase();return s.includes("spacer")||s.includes("transparent")||s.includes("transp.gif")||s.includes("/track")&&s.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(s)?!0:s.includes("mail.google.com/mail/u/")&&s.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(s)||s.endsWith(".gif")&&s.includes("1x1"))}function Qo(t){var s;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",u=t.getAttribute("alt")||"";return cy(t,o)?"":`![${u}](${o})`}const n=Array.from(t.childNodes).map(Qo).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((s=t.parentElement)==null?void 0:s.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(u=>Qo(u).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),u=(o.match(/\|/g)||[]).length-1,f="| "+Array(Math.max(u,1)).fill("---").join(" | ")+" |";return`${o}${f}
`}return n}function uy(t){return rd(t,"md")}function Vc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function dy(t){return t.raw||null}function fy(t){const e=dy(t);return e?JSON.stringify(e,null,2):"null"}function vy(t){return rd(t,"json")}var py=C('<button title="View as Markdown">.md</button>'),hy=C('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),my=C('<pre class="md-raw svelte-1b0rzpb"> </pre>'),gy=C('<div class="md-preview svelte-1b0rzpb"><!></div>'),_y=C('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),yy=C('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),by=C('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),wy=C('<pre class="message-text svelte-1b0rzpb"> </pre>'),ky=C('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),xy=C('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),Sy=C('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function Ey(t,e){St(e,!0);let n=Ne(e,"loading",3,!1);nn(()=>qn("MessageModal"));const a=new xt.Renderer;a.link=({href:Y,title:J,text:ve})=>{const ae=J?` title="${J}"`:"";return`<a href="${Y}"${ae} target="_blank" rel="noopener">${ve}</a>`},xt.setOptions({breaks:!0,gfm:!0,renderer:a});let s=Re("email"),o=dt(()=>e.message.body?oy(e.message):""),u=dt(()=>fy(e.message)),f=Re("raw");function h(Y){A(s,c(s)===Y?"email":Y,!0),Y==="markdown"&&A(f,"raw")}function m(){Vc(c(o),uy(e.message))}function y(){Vc(c(u),vy(e.message),"application/json;charset=utf-8")}function x(Y){const J=xt.parse(Y);return iy.sanitize(J,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let b=Re(null);Ea(()=>{var Y;if(c(b)&&e.message.htmlBody&&!n()&&c(s)==="email"){const J=c(b).contentDocument||((Y=c(b).contentWindow)==null?void 0:Y.document);J&&(J.open(),J.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),J.close())}});var k=Sy();k.__click=function(...Y){var J;(J=e.onclose)==null||J.apply(this,Y)};var I=p(k);I.__click=Y=>Y.stopPropagation();var L=p(I),z=p(L),ie=p(z),ce=g(z,2),ne=p(ce);let R;ne.__click=()=>h("json");var Z=g(ne,2);{var W=Y=>{var J=py();let ve;J.__click=()=>h("markdown"),Q(()=>ve=Mt(J,1,"action-btn svelte-1b0rzpb",null,ve,{active:c(s)==="markdown"})),E(Y,J)};te(Z,Y=>{e.message.body&&Y(W)})}var P=g(Z,2);P.__click=function(...Y){var J;(J=e.onclose)==null||J.apply(this,Y)};var ue=g(L,2);{var ke=Y=>{var J=hy(),ve=$e(J),ae=g(p(ve),2);ae.__click=y;var he=g(ve,2),xe=p(he),le=p(xe);Q(()=>j(le,c(u))),E(Y,J)},ye=Y=>{var J=_y(),ve=$e(J),ae=p(ve),he=p(ae);let xe;he.__click=()=>A(f,"raw");var le=g(he,2);let fe;le.__click=()=>A(f,"preview");var we=g(ae,2);we.__click=m;var Se=g(ve,2),me=p(Se);{var D=se=>{var G=my(),de=p(G);Q(()=>j(de,c(o))),E(se,G)},H=se=>{var G=gy(),de=p(G);Iv(de,()=>x(c(o))),E(se,G)};te(me,se=>{c(f)==="raw"?se(D):se(H,!1)})}Q(()=>{xe=Mt(he,1,"md-tab svelte-1b0rzpb",null,xe,{active:c(f)==="raw"}),fe=Mt(le,1,"md-tab svelte-1b0rzpb",null,fe,{active:c(f)==="preview"})}),E(Y,J)},be=Y=>{var J=xy(),ve=$e(J),ae=p(ve),he=g(p(ae),2),xe=p(he),le=g(ae,2),fe=g(p(le),2),we=p(fe),Se=g(le,2),me=g(p(Se),2),D=p(me),H=g(ve,2),se=p(H);{var G=T=>{var pe=yy();E(T,pe)},de=T=>{var pe=by();Vu(pe,$=>A(b,$),()=>c(b)),E(T,pe)},Me=T=>{var pe=wy(),$=p(pe);Q(()=>j($,e.message.body)),E(T,pe)},re=T=>{var pe=ky();E(T,pe)};te(se,T=>{n()?T(G):e.message.htmlBody?T(de,1):e.message.body?T(Me,2):T(re,!1)})}Q(T=>{j(xe,e.message.from),j(we,e.message.to),j(D,T)},[()=>hl(e.message.date)]),E(Y,J)};te(ue,Y=>{c(s)==="json"?Y(ke):c(s)==="markdown"?Y(ye,1):Y(be,!1)})}Q(()=>{j(ie,e.message.subject),R=Mt(ne,1,"action-btn svelte-1b0rzpb",null,R,{active:c(s)==="json"})}),E(t,k),Et()}Bt(["click"]);var Ty=C('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),Ay=C('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),Cy=C('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),Iy=C("<p> </p>"),Ry=C('<p>No emails in local storage. Click "Sync New" to download.</p>'),Oy=C('<div class="empty-state svelte-6ts5xm"><!></div>'),Py=C('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),My=C('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Dy(t,e){St(e,!0),nn(()=>qn("DashboardView"));let n=Ne(e,"error",3,null),a=Ne(e,"profile",3,null),s=Ne(e,"loadingProfile",3,!1),o=Ne(e,"emailMessages",19,()=>[]),u=Ne(e,"totalLocalMessages",3,0),f=Ne(e,"hasMoreLocal",3,!1),h=Ne(e,"loadingMessages",3,!1),m=Ne(e,"selectedMessage",3,null),y=Ne(e,"syncStatus",3,null),x=Ne(e,"syncProgress",3,null),b=Ne(e,"isSyncing",3,!1),k=Ne(e,"searchQuery",15);var I=My(),L=$e(I),z=p(L);{var ie=ae=>{wd(ae,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};te(z,ae=>{n()&&ae(ie)})}var ce=g(z,2);Mg(ce,{get profile(){return a()},get loadingProfile(){return s()},get onsignout(){return e.onsignout}});var ne=g(ce,2);Hg(ne,{get syncStatus(){return y()},get syncProgress(){return x()},get isSyncing(){return b()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var R=g(ne,2),Z=p(R);Z.__keydown=ae=>ae.key==="Enter"&&e.onsearch();var W=g(Z,2);W.__click=function(...ae){var he;(he=e.onsearch)==null||he.apply(this,ae)};var P=p(W),ue=g(R,2);{var ke=ae=>{var he=Ay(),xe=$e(he),le=p(xe),fe=p(le),we=g(xe,2);Qg(we,{get messages(){return o()},get onselect(){return e.onviewmessage}});var Se=g(we,2);{var me=D=>{var H=Ty(),se=p(H);se.__click=function(...de){var Me;(Me=e.onloadmore)==null||Me.apply(this,de)};var G=p(se);Q(()=>{se.disabled=h(),j(G,h()?"Loading...":"Load More")}),E(D,H)};te(Se,D=>{f()&&D(me)})}Q(D=>j(fe,`Showing ${o().length??""} of ${D??""}
        ${k()?" matching":""} emails`),[()=>u().toLocaleString()]),E(ae,he)},ye=ae=>{var he=Cy();E(ae,he)},be=ae=>{var he=Oy(),xe=p(he);{var le=we=>{var Se=Iy(),me=p(Se);Q(()=>j(me,`No emails match "${k()??""}".`)),E(we,Se)},fe=we=>{var Se=Ry();E(we,Se)};te(xe,we=>{k()?we(le):we(fe,!1)})}E(ae,he)},Y=ae=>{var he=Py();E(ae,he)};te(ue,ae=>{var he;o().length>0?ae(ke):h()?ae(ye,1):(he=y())!=null&&he.synced?ae(be,2):ae(Y,!1)})}var J=g(L,2);{var ve=ae=>{Ey(ae,{get message(){return m()},loading:!1,get onclose(){return e.onclosedetail}})};te(J,ae=>{m()&&ae(ve)})}Q(()=>{W.disabled=h(),j(P,h()?"Searching...":"Search")}),Hn(Z,k),E(t,I),Et()}Bt(["keydown","click"]);var jy=C('<div class="dashboard svelte-1q5o2lv"><!></div>');function Ly(t,e){St(e,!0);function n($){$.key==="Escape"&&c(b)&&me()}let a=null;nn(async()=>{if(window.addEventListener("keydown",n),!c(f)){const $=await Is("googleClientId");A(f,$||u,!0),A(h,$||u,!0)}return()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}});function s(){a&&clearTimeout(a);const $=Gh();if($<=0)return;const Ee=Math.max(0,$-120*1e3);a=setTimeout(async()=>{try{const qe=await Cc();A(y,qe.access_token,!0),s()}catch{A(y,null),A(x,null),A(R,"Session expired. Please sign in again.")}},Ee)}async function o(){if(Kh())return c(y);try{const $=await Cc();return A(y,$.access_token,!0),s(),c(y)}catch{return A(y,null),A(x,null),A(R,"Session expired. Please sign in again."),null}}const u="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let f=Re(Pt(u)),h=Re(Pt(u)),m=Re(!1),y=Re(null),x=Re(null),b=Re(null),k=Re(""),I=Re(Pt([])),L=Re(0),z=Re(0),ie=Re(!1),ce=Re(!1),ne=Re(!1),R=Re(null),Z=Re(null),W=Re(null),P=Re(!1);const ue=50;Ea(()=>{c(y)&&(D(),le())});let ke=dt(()=>!c(f)),ye=dt(()=>c(f)===u),be=dt(()=>!!c(y)),Y=dt(()=>c(I).length<c(L));Ea(()=>{c(f)&&!c(m)&&Ic(c(f)).then(async()=>{if(A(m,!0),!c(y)){const $=await Li();$&&(A(y,$.access_token,!0),s(),xe())}}).catch($=>{A(R,`Auth init failed: ${$.message}`)})});async function J(){const $=c(h).trim();$&&(await Rs("googleClientId",$),A(f,$,!0),A(R,null))}async function ve(){await dl("googleClientId"),A(f,""),A(h,u),A(m,!1),A(y,null),A(x,null),A(I,[],!0),A(L,0)}async function ae(){A(R,null),A(ce,!0);try{c(m)||(await Ic(c(f)),A(m,!0));const $=await Hh();A(y,$.access_token,!0),s(),await xe()}catch($){A(R,$.message,!0)}finally{A(ce,!1)}}async function he(){if(a&&clearTimeout(a),c(y))try{await Vh(c(y))}catch{}A(y,null),A(x,null),A(I,[],!0),A(L,0),A(b,null),A(R,null)}async function xe(){A(ne,!0);try{const $=await Ju(c(y));if(!c(y))return;A(x,$,!0)}catch($){if(!c(y))return;A(R,`Profile fetch failed: ${$.message}`)}finally{A(ne,!1)}}async function le($=!1){A(ie,!0);try{const Ee=$?c(z):0,qe=await hp({query:c(k)||void 0,limit:ue,offset:Ee});$?A(I,[...c(I),...qe.items],!0):A(I,qe.items,!0),A(L,qe.total,!0),A(z,c(I).length,!0)}catch(Ee){A(R,`Failed to load messages: ${Ee.message}`)}finally{A(ie,!1)}}function fe(){A(z,0),le(!1)}function we(){le(!0)}function Se($){A(b,$,!0)}function me(){A(b,null)}async function D(){try{A(Z,await lg(),!0)}catch{}}async function H($){if(c(P)||!c(y))return;const Ee=await o();if(!Ee)return;A(R,null),A(P,!0),A(W,null);const qe=new AbortController;try{await ig(Ee,{limit:$,onProgress:Fe=>{A(W,{...Fe},!0)},signal:qe.signal}),await D(),await le(!1)}catch(Fe){if(Fe.name!=="AbortError"){if(!c(y))return;A(R,`Sync failed: ${Fe.message}`)}}finally{A(P,!1)}}async function se($){if(c(P)||!c(y))return;const Ee=await o();if(!Ee)return;A(R,null),A(P,!0),A(W,null);const qe=new AbortController;try{await og(Ee,{limit:$,onProgress:Fe=>{A(W,{...Fe},!0)},signal:qe.signal}),await D(),await le(!1)}catch(Fe){if(Fe.name!=="AbortError"){if(!c(y))return;A(R,`Sync more failed: ${Fe.message}`)}}finally{A(P,!1)}}async function G(){try{await gd(),await D(),A(I,[],!0),A(L,0),A(z,0)}catch($){A(R,`Failed to clear data: ${$.message}`)}}var de=jy(),Me=p(de);{var re=$=>{mg($,{onsave:J,defaultClientId:u,get clientIdInput(){return c(h)},set clientIdInput(Ee){A(h,Ee,!0)}})},T=$=>{Ig($,{get clientId(){return c(f)},get isDefaultClientId(){return c(ye)},get error(){return c(R)},get loadingAuth(){return c(ce)},onsignin:ae,onclear:ve,onsignout:he})},pe=$=>{Dy($,{get error(){return c(R)},get profile(){return c(x)},get loadingProfile(){return c(ne)},get emailMessages(){return c(I)},get totalLocalMessages(){return c(L)},get hasMoreLocal(){return c(Y)},get loadingMessages(){return c(ie)},get selectedMessage(){return c(b)},get syncStatus(){return c(Z)},get syncProgress(){return c(W)},get isSyncing(){return c(P)},onsignout:he,onsearch:fe,onloadmore:we,onviewmessage:Se,onclosedetail:me,ondismisserror:()=>A(R,null),onsync:H,onsyncmore:se,oncleardata:G,get searchQuery(){return c(k)},set searchQuery(Ee){A(k,Ee,!0)}})};te(Me,$=>{c(ke)?$(re):c(be)?$(pe,!1):$(T,1)})}E(t,de),Et()}var Ny=C('<span class="err svelte-t1ig66"> </span>'),qy=C('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),By=C('<span class="stream-stats svelte-t1ig66"> </span>'),Fy=C('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),zy=C('<span class="ei-tag svelte-t1ig66"> </span>'),Uy=C('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),Ky=C('<span class="sep svelte-t1ig66">Â·</span> ',1),Gy=C('<div class="ei-summary svelte-t1ig66"> </div>'),Wy=C('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Hy=C('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Vy=C("<!> <!> <!>",1),Yy=C('<div class="ei-error svelte-t1ig66"> </div>'),Qy=C('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Xy=C('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Zy=C('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Jy=C('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),$y=C(' <span class="sep svelte-t1ig66">Â·</span>',1),eb=C('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),tb=C('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),nb=C('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),rb=C('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function ab(t,e){St(e,!0);let n=Ne(e,"progress",3,null);function a(b){return!b||b<0?"â":b<1e3?`${Math.round(b)}ms`:`${(b/1e3).toFixed(1)}s`}function s(b){return b?b>=1e3?`${(b/1e3).toFixed(1)}k`:String(b):"0"}function o(b){if(!b)return"â";const k=b.replace(/<.*>/,"").trim();return k.length>30?k.slice(0,28)+"â¦":k}function u(b){if(!b)return"";try{return new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let f=dt(()=>{var b;return(b=n())!=null&&b.total?Math.round(n().current/n().total*100):0}),h=dt(()=>{var b;return((b=n())==null?void 0:b.phase)==="done"});var m=Xn(),y=$e(m);{var x=b=>{var k=rb(),I=p(k),L=p(I),z=p(L);{var ie=me=>{var D=gn();Q(()=>j(D,`Scan complete â ${(n().classified||0)??""} classified`)),E(me,D)},ce=me=>{var D=gn("Loading emailsâ¦");E(me,D)},ne=me=>{var D=gn();Q(()=>j(D,`Processing ${n().current??0??""} / ${n().total??0??""}`)),E(me,D)};te(z,me=>{c(h)?me(ie):n().phase==="loading"?me(ce,1):me(ne,!1)})}var R=g(L,2),Z=p(R),W=g(I,2),P=p(W);let ue,ke;var ye=g(W,2);{var be=me=>{var D=qy(),H=p(D),se=g(H);{var G=re=>{var T=Ny(),pe=p(T);Q(()=>j(pe,`Â· ${n().errors??""} errors`)),E(re,T)};te(se,re=>{n().errors&&re(G)})}var de=g(se,3),Me=g(de,2);Q((re,T,pe)=>{j(H,`${(n().classified||0)??""} classified `),j(de,` ${re??""} in + ${T??""} out `),j(Me,` ${pe??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(me,D)};te(ye,me=>{n().totals&&!c(h)&&me(be)})}var Y=g(ye,2);{var J=me=>{var D=Fy(),H=p(D),se=p(H),G=p(se),de=g(se,2);{var Me=pe=>{var $=By(),Ee=p($);Q(qe=>j(Ee,`${qe??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),E(pe,$)};te(de,pe=>{var $;($=n().live)!=null&&$.tps&&pe(Me)})}var re=g(H,2),T=p(re);Q(()=>{j(G,n().email.subject||"(no subject)"),j(T,n().streamingText||"Waiting for modelâ¦")}),E(me,D)};te(Y,me=>{!c(h)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&me(J)})}var ve=g(Y,2);{var ae=me=>{var D=Xy(),H=p(D),se=g(p(H),2),G=p(se),de=g(H,2);Ct(de,17,()=>n().results,Gt,(Me,re,T)=>{var pe=Qy();let $;var Ee=p(pe),qe=p(Ee);qe.textContent=`${T+1}.`;var Fe=g(qe,2),et=p(Fe),rt=g(Fe,2);{var nt=Ye=>{var mt=zy(),Dt=p(mt);Q(()=>j(Dt,c(re).classification.action)),E(Ye,mt)},Ve=Ye=>{var mt=Uy();E(Ye,mt)};te(rt,Ye=>{c(re).success?Ye(nt):Ye(Ve,!1)})}var Xe=g(Ee,2),tt=p(Xe),vt=g(tt);{var At=Ye=>{var mt=Ky(),Dt=g($e(mt),1,!0);Q(rn=>j(Dt,rn),[()=>u(c(re).email.date)]),E(Ye,mt)};te(vt,Ye=>{c(re).email.date&&Ye(At)})}var We=g(Xe,2);{var Ke=Ye=>{var mt=Vy(),Dt=$e(mt);{var rn=Qe=>{var Ae=Gy(),pt=p(Ae);Q(()=>j(pt,c(re).classification.summary)),E(Qe,Ae)};te(Dt,Qe=>{c(re).classification.summary&&Qe(rn)})}var an=g(Dt,2);{var Ft=Qe=>{var Ae=Wy(),pt=p(Ae),Rt=g(pt,2),Qt=g(Rt,2);Q((Oe,Xt)=>{j(pt,`${Oe??""} `),j(Rt,` ${(c(re).stats.inputTokens||0)??""} in + ${(c(re).stats.numTokens||0)??""} out `),j(Qt,` ${Xt??""}`)},[()=>c(re).stats.tps?`${c(re).stats.tps.toFixed(0)} tok/s`:"â",()=>a(c(re).stats.elapsed)]),E(Qe,Ae)};te(an,Qe=>{c(re).stats&&Qe(Ft)})}var It=g(an,2);{var Jt=Qe=>{var Ae=Hy(),pt=g(p(Ae),2),Rt=p(pt);Q(()=>j(Rt,c(re).rawResponse)),E(Qe,Ae)};te(It,Qe=>{c(re).rawResponse&&Qe(Jt)})}E(Ye,mt)},Ze=Ye=>{var mt=Yy(),Dt=p(mt);Q(()=>j(Dt,c(re).error)),E(Ye,mt)};te(We,Ye=>{c(re).success?Ye(Ke):Ye(Ze,!1)})}Q(Ye=>{$=Mt(pe,1,"email-item svelte-t1ig66",null,$,{failed:!c(re).success}),j(et,c(re).email.subject||"(no subject)"),j(tt,Ye)},[()=>o(c(re).email.from)]),E(Me,pe)}),Q(()=>j(G,n().results.length)),E(me,D)};te(ve,me=>{var D;((D=n().results)==null?void 0:D.length)>0&&me(ae)})}var he=g(ve,2);{var xe=me=>{var D=eb(),H=p(D),se=p(H),G=p(se),de=g(se,4),Me=p(de),re=g(de,2);{var T=Ve=>{var Xe=Zy(),tt=g($e(Xe)),vt=p(tt);Q(()=>j(vt,`${n().errors??""} errors`)),E(Ve,Xe)};te(re,Ve=>{n().errors>0&&Ve(T)})}var pe=g(re,2);{var $=Ve=>{var Xe=Jy(),tt=g($e(Xe)),vt=p(tt);Q(()=>j(vt,`${n().summary.skipped??""} skipped`)),E(Ve,Xe)};te(pe,Ve=>{var Xe;(Xe=n().summary)!=null&&Xe.skipped&&Ve($)})}var Ee=g(H,2),qe=p(Ee);{var Fe=Ve=>{var Xe=$y(),tt=$e(Xe);Q(()=>j(tt,`Avg ${n().summary.avgTps??""} tok/s`)),E(Ve,Xe)};te(qe,Ve=>{var Xe;(Xe=n().summary)!=null&&Xe.avgTps&&Ve(Fe)})}var et=g(qe),rt=g(et,2),nt=g(rt,2);Q((Ve,Xe,tt)=>{var vt,At;j(G,`${(((vt=n().summary)==null?void 0:vt.processed)||n().total||0)??""} processed`),j(Me,`${(n().classified||0)??""} classified`),j(et,` ${Ve??""} in + ${Xe??""} out `),j(rt,` ${tt??""} `),j(nt,` Model: ${(((At=n().summary)==null?void 0:At.modelName)||"Unknown")??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(me,D)};te(he,me=>{c(h)&&n().totals&&me(xe)})}var le=g(he,2),fe=p(le);{var we=me=>{var D=tb(),H=$e(D);H.__click=function(...G){var de;(de=e.oninspect)==null||de.apply(this,G)};var se=g(H,2);se.__click=function(...G){var de;(de=e.onclose)==null||de.apply(this,G)},E(me,D)},Se=me=>{var D=nb(),H=$e(D);H.__click=function(...G){var de;(de=e.oninspect)==null||de.apply(this,G)};var se=g(H,2);se.__click=function(...G){var de;(de=e.onstop)==null||de.apply(this,G)},E(me,D)};te(fe,me=>{c(h)?me(we):me(Se,!1)})}Q(()=>{j(Z,`${c(f)??""}%`),ue=Mt(P,1,"bar-fill svelte-t1ig66",null,ue,{done:c(h)}),ke=ln(P,"",ke,{width:`${c(f)??""}%`})}),E(b,k)};te(y,b=>{n()&&b(x)})}E(t,m),Et()}Bt(["click"]);var sb=C('<span class="spinner svelte-ois7em"></span>'),ib=ll('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),ob=C('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),lb=C("<option> </option>"),cb=C('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),ub=C('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function db(t,e){St(e,!0);let n=Ne(e,"engineStatus",3,"idle"),a=Ne(e,"modelName",3,""),s=Ne(e,"isScanning",3,!1),o=Ne(e,"scanProgress",3,null),u=Ne(e,"scanCount",15,20),f=Ne(e,"stats",3,null);const h=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function m(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function y(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function x(){return n()==="ready"&&!s()}let b=dt(()=>{var D;return s()&&((D=o())==null?void 0:D.phase)!=="done"});var k=ub(),I=p(k),L=p(I),z=p(L);{var ie=D=>{var H=sb();E(D,H)},ce=D=>{var H=ib();E(D,H)};te(z,D=>{c(b)?D(ie):D(ce,!1)})}var ne=g(L,2),R=p(ne),Z=g(p(R),2);Z.__click=function(...D){var H;(H=e.oninspect)==null||H.apply(this,D)};var W=g(R,2),P=p(W);let ue;var ke=g(P),ye=g(I,2);{var be=D=>{var H=ob(),se=p(H),G=p(se),de=g(se,4),Me=p(de),re=g(de,4),T=p(re);Q(()=>{j(G,`${f().totalEmails??""} emails in storage`),j(Me,`${f().classified??""} classified`),j(T,`${f().unclassified??""} new`)}),E(D,H)};te(ye,D=>{f()&&D(be)})}var Y=g(ye,2),J=p(Y),ve=g(p(J),2);Ct(ve,21,()=>h,Gt,(D,H)=>{var se=lb(),G=p(se),de={};Q(()=>{j(G,c(H).label),de!==(de=c(H).value)&&(se.value=(se.__value=c(H).value)??"")}),E(D,se)});var ae=g(J,2),he=p(ae);he.__click=function(...D){var H;(H=e.onscan)==null||H.apply(this,D)};var xe=p(he),le=g(he,2);le.__click=function(...D){var H;(H=e.onrescan)==null||H.apply(this,D)};var fe=g(Y,2);{var we=D=>{var H=cb();E(D,H)};te(fe,D=>{n()!=="ready"&&n()!=="loading"&&D(we)})}var Se=g(fe,2);{var me=D=>{ab(D,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};te(Se,D=>{var H;(s()||((H=o())==null?void 0:H.phase)==="done")&&D(me)})}Q((D,H,se,G)=>{ue=ln(P,"",ue,D),j(ke,` ${H??""}`),ve.disabled=s(),he.disabled=se,j(xe,c(b)?"Scanning...":s()?"Finalizing...":"Scan New"),le.disabled=G},[()=>({background:y()}),m,()=>!x(),()=>!x()]),Pi(ve,u),E(t,k),Et()}Bt(["click"]);var fb=C('<span class="row-date svelte-1czytqk"> </span>'),vb=C('<span class="tag svelte-1czytqk"> </span>'),pb=C('<span class="row-tags svelte-1czytqk"></span>'),hb=C('<span class="row-reason svelte-1czytqk"> </span>'),mb=C('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),gb=C('<span class="status-label svelte-1czytqk"> </span>'),_b=C('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),yb=C('<p class="summary-reason svelte-1czytqk"> </p>'),bb=C('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),wb=C('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function Yc(t,e){St(e,!0);let n=Ne(e,"actionColor",3,"#666"),a=Ne(e,"dimmed",3,!1);function s(ae){if(!ae)return"";try{return new Date(ae).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=dt(()=>e.item.status==="pending"),u=Re(!1);var f=wb(),h=$e(f);let m;var y=p(h);y.__click=()=>A(u,!c(u));let x;var b=p(y),k=p(b),I=g(b,2),L=p(I),z=p(L),ie=g(L,2);{var ce=ae=>{var he=fb(),xe=p(he);Q(le=>j(xe,le),[()=>s(e.item.date)]),E(ae,he)};te(ie,ae=>{e.item.date&&ae(ce)})}var ne=g(I,2);{var R=ae=>{var he=pb();Ct(he,21,()=>e.item.tags,Gt,(xe,le)=>{var fe=vb();let we;var Se=p(fe);Q(me=>{we=ln(fe,"",we,me),j(Se,c(le))},[()=>({background:jp(c(le))})]),E(xe,fe)}),E(ae,he)};te(ne,ae=>{e.item.tags&&e.item.tags.length>0&&ae(R)})}var Z=g(ne,2);{var W=ae=>{var he=hb(),xe=p(he);Q(()=>j(xe,e.item.reason)),E(ae,he)};te(Z,ae=>{e.item.reason&&!c(u)&&ae(W)})}var P=g(y,2),ue=p(P);{var ke=ae=>{var he=mb(),xe=$e(he);xe.__click=()=>e.onmarkacted(e.item.emailId);var le=g(xe,2);le.__click=()=>e.ondismiss(e.item.emailId),E(ae,he)},ye=ae=>{var he=gb(),xe=p(he);Q(()=>j(xe,e.item.status)),E(ae,he)};te(ue,ae=>{c(o)?ae(ke):ae(ye,!1)})}var be=g(ue,2);{var Y=ae=>{var he=_b();he.__click=()=>e.onremove(e.item.emailId),E(ae,he)};te(be,ae=>{e.onremove&&ae(Y)})}var J=g(h,2);{var ve=ae=>{var he=bb();let xe;var le=p(he),fe=p(le),we=g(le,2);{var Se=me=>{var D=yb(),H=p(D);Q(()=>j(H,e.item.reason)),E(me,D)};te(we,me=>{e.item.reason&&me(Se)})}Q(()=>{xe=ln(he,"",xe,{"border-left-color":n()}),j(fe,e.item.summary)}),E(ae,he)};te(J,ae=>{c(u)&&e.item.summary&&ae(ve)})}Q(()=>{m=Mt(h,1,"email-row svelte-1czytqk",null,m,{dimmed:a()}),x=ln(y,"",x,{"border-left-color":n()}),j(k,e.item.subject),j(z,e.item.from)}),E(t,f),Et()}Bt(["click"]);var kb=C('<span class="group-acted svelte-tl1unp"> </span>'),xb=C('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),Sb=C('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),Eb=C('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),Tb=C('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),Ab=C('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),Cb=C('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Ib(t,e){St(e,!0);let n=Ne(e,"color",3,"#888");Ne(e,"count",3,0);let a=Ne(e,"items",19,()=>[]),s=Ne(e,"expanded",3,!1),o=dt(()=>a().filter(W=>W.status==="pending")),u=dt(()=>a().filter(W=>W.status!=="pending")),f=Re(!1);function h(W){return W.split("_").map(P=>P.charAt(0)+P.slice(1).toLowerCase()).join(" ")}var m=Cb(),y=p(m);y.__click=function(...W){var P;(P=e.ontoggle)==null||P.apply(this,W)};var x=p(y);let b;var k=p(x),I=g(x,2),L=p(I),z=g(I,2);{var ie=W=>{var P=kb(),ue=p(P);Q(()=>j(ue,`${c(u).length??""} handled`)),E(W,P)};te(z,W=>{c(u).length>0&&W(ie)})}var ce=g(z,4);let ne;var R=g(y,2);{var Z=W=>{var P=Ab(),ue=p(P);{var ke=xe=>{var le=xb();E(xe,le)};te(ue,xe=>{c(o).length===0&&c(u).length===0&&xe(ke)})}var ye=g(ue,2);Ct(ye,17,()=>c(o),xe=>xe.emailId,(xe,le)=>{Yc(xe,{get item(){return c(le)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var be=g(ye,2);{var Y=xe=>{var le=Sb(),fe=p(le),we=p(fe),Se=g(fe,2);Ct(Se,17,()=>c(u),me=>me.emailId,(me,D)=>{Yc(me,{get item(){return c(D)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),Q(()=>j(we,`${c(u).length??""} handled`)),E(xe,le)};te(be,xe=>{c(u).length>0&&xe(Y)})}var J=g(be,2),ve=p(J);{var ae=xe=>{var le=Eb();le.__click=()=>A(f,!0),E(xe,le)},he=xe=>{var le=Tb(),fe=p(le),we=g(fe);we.__click=()=>A(f,!1);var Se=g(we,2);Se.__click=()=>{e.oncleargroup(),A(f,!1)},Q(()=>j(fe,`Clear ${a().length??""} items? `)),E(xe,le)};te(ve,xe=>{c(f)?xe(he,!1):xe(ae)})}E(W,P)};te(R,W=>{s()&&W(Z)})}Q(W=>{b=ln(x,"",b,{background:n()}),j(k,W),j(L,c(o).length),ne=Mt(ce,0,"chevron svelte-tl1unp",null,ne,{open:s()})},[()=>h(e.action)]),E(t,m),Et()}Bt(["click"]);var Rb=C(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),Ob=C(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),Pb=C(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),Mb=C('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function Db(t,e){St(e,!0);let n=Ne(e,"open",15,!1),a=Ne(e,"sampleEmail",3,null),s=Re("system");function o(){return a()?fd(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function u(){n(!1)}function f(x){x.target===x.currentTarget&&u()}var h=Xn(),m=$e(h);{var y=x=>{var b=Mb();b.__click=f,b.__keydown=Y=>Y.key==="Escape"&&u();var k=p(b),I=p(k),L=g(p(I),2);L.__click=u;var z=g(I,2),ie=p(z);let ce;ie.__click=()=>A(s,"system");var ne=g(ie,2);let R;ne.__click=()=>A(s,"email");var Z=g(ne,2);let W;Z.__click=()=>A(s,"config");var P=g(z,2),ue=p(P);{var ke=Y=>{var J=Rb(),ve=g($e(J),2),ae=p(ve);Q(()=>j(ae,bs)),E(Y,J)},ye=Y=>{var J=Ob(),ve=g($e(J),2),ae=g(p(ve),2);ae.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var he=g(ve,2),xe=g(p(he),2),le=p(xe);Q(fe=>j(le,fe),[o]),E(Y,J)},be=Y=>{var J=Pb(),ve=g($e(J),2),ae=p(ve),he=g(p(ae),2),xe=p(he),le=g(ae,2),fe=g(p(le),2),we=p(fe),Se=g(le,2),me=g(p(Se),2),D=p(me),H=g(ve,4);H.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,Q(()=>{j(xe,Op.maxTokens),j(we,"false"),j(D,"false")}),E(Y,J)};te(ue,Y=>{c(s)==="system"?Y(ke):c(s)==="email"?Y(ye,1):c(s)==="config"&&Y(be,2)})}Q(()=>{ce=Mt(ie,1,"tab svelte-10pcy9j",null,ce,{active:c(s)==="system"}),R=Mt(ne,1,"tab svelte-10pcy9j",null,R,{active:c(s)==="email"}),W=Mt(Z,1,"tab svelte-10pcy9j",null,W,{active:c(s)==="config"})}),E(x,b)};te(m,x=>{n()&&x(y)})}E(t,h),Et()}Bt(["click","keydown"]);var jb=C('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),Lb=C('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="type-count svelte-d25j4l"> </span></button>'),Nb=C('<div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" placeholder="Icon (emoji)" class="icon-input svelte-d25j4l"/> <input type="text" placeholder="Action name" class="name-input svelte-d25j4l"/></div> <input type="text" placeholder="Description" class="desc-input svelte-d25j4l"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Add Action</button></div></div>'),qb=C('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),Bb=C('<span class="cmd-icon svelte-d25j4l"> </span>'),Fb=C('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),zb=C('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),Ub=C('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <button class="text-btn danger svelte-d25j4l">Delete event</button> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),Kb=C('<p class="svelte-d25j4l">No events yet. Click <strong>+</strong> to create your first event and define its action pipeline.</p>'),Gb=C('<p class="svelte-d25j4l">Select an event on the left to view and edit its actions.</p>'),Wb=C('<div class="no-selection svelte-d25j4l"><!></div>'),Hb=C('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Events</span> <button class="icon-btn svelte-d25j4l" title="Add event">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function Vb(t,e){St(e,!0);let n=Ne(e,"open",15,!1),a=Re(Pt([])),s=Re(Pt({})),o=Re(null),u=Re(!1),f=Re(Pt([])),h=Re(null),m=Re(!1),y=Re(""),x=Re(!1),b=Re(Pt({name:"",description:"",icon:""}));async function k(){A(a,await ld(),!0);const Y={};await Promise.all(c(a).map(async J=>{Y[J]=(await yo(J)).length})),A(s,Y,!0),c(o)&&(A(f,(await yo(c(o))).map(J=>({...J})),!0),A(u,await hasUserOverride(c(o)),!0))}Ea(()=>{n()&&k()});async function I(Y){A(o,Y,!0),A(f,(await yo(Y)).map(J=>({...J})),!0),A(u,await hasUserOverride(Y),!0),A(h,null),A(x,!1)}function L(Y){return Y.split("_").map(J=>J.charAt(0)+J.slice(1).toLowerCase()).join(" ")}function z(Y){return`hsl(${Mi(Y)}, 55%, 55%)`}async function ie(){const Y=c(y).trim();if(!Y)return;await _p(Y),A(y,""),A(m,!1),await k();const J=Y.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await I(J)}async function ce(){c(o)&&(await yp(c(o)),A(o,null),A(f,[],!0),A(u,!1),await k())}async function ne(){if(!c(b).name.trim())return;const Y=c(b).name.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");await kp(c(o),{id:Y,name:c(b).name.trim(),description:c(b).description.trim(),icon:c(b).icon.trim()||void 0}),A(b,{name:"",description:"",icon:""},!0),A(x,!1),await k()}async function R(Y){await Sp(c(o),Y),await k()}function Z(Y){A(h,{...Y},!0)}async function W(){c(h)&&(await Tp(c(o),c(h).id,{name:c(h).name,description:c(h).description,icon:c(h).icon}),A(h,null),await k())}function P(){A(h,null)}async function ue(Y,J){const ve=[...c(f)],ae=Y+J;ae<0||ae>=ve.length||([ve[Y],ve[ae]]=[ve[ae],ve[Y]],await bp(c(o),ve),await k())}var ke=Xn(),ye=$e(ke);{var be=Y=>{var J=Hb(),ve=p(J),ae=p(ve),he=g(p(ae),4);he.__click=()=>n(!1);var xe=g(ae,2),le=p(xe),fe=p(le),we=g(p(fe),2);we.__click=()=>A(m,!c(m));var Se=g(fe,2);{var me=Me=>{var re=jb(),T=p(re);T.__keydown=$=>$.key==="Enter"&&ie();var pe=g(T,2);pe.__click=ie,Hn(T,()=>c(y),$=>A(y,$)),E(Me,re)};te(Se,Me=>{c(m)&&Me(me)})}var D=g(Se,2);Ct(D,21,()=>c(a),Gt,(Me,re)=>{var T=Lb();let pe;T.__click=()=>I(c(re));var $=p(T);let Ee;var qe=g($,2),Fe=p(qe),et=g(qe,2),rt=p(et);Q((nt,Ve)=>{pe=Mt(T,1,"type-item svelte-d25j4l",null,pe,{selected:c(o)===c(re)}),Ee=ln($,"",Ee,nt),j(Fe,Ve),j(rt,c(s)[c(re)]??0)},[()=>({background:z(c(re))}),()=>L(c(re))]),E(Me,T)});var H=g(le,2),se=p(H);{var G=Me=>{var re=Ub(),T=$e(re),pe=p(T);let $;var Ee=p(pe),qe=g(pe,2),Fe=p(qe),et=g(qe,6);et.__click=ce;var rt=g(et,2);rt.__click=()=>{A(x,!c(x)),A(h,null)};var nt=p(rt),Ve=g(T,2);{var Xe=Ke=>{var Ze=Nb(),Ye=p(Ze),mt=p(Ye),Dt=g(mt,2),rn=g(Ye,2),an=g(rn,2),Ft=p(an);Ft.__click=ne,Hn(mt,()=>c(b).icon,It=>c(b).icon=It),Hn(Dt,()=>c(b).name,It=>c(b).name=It),Hn(rn,()=>c(b).description,It=>c(b).description=It),E(Ke,Ze)};te(Ve,Ke=>{c(x)&&Ke(Xe)})}var tt=g(Ve,2),vt=p(tt);Ct(vt,19,()=>c(f),Ke=>Ke.id,(Ke,Ze,Ye)=>{var mt=Xn(),Dt=$e(mt);{var rn=Ft=>{var It=qb(),Jt=p(It),Qe=p(Jt),Ae=g(Qe,2),pt=g(Jt,2),Rt=g(pt,2),Qt=p(Rt);Qt.__click=W;var Oe=g(Qt,2);Oe.__click=P,Hn(Qe,()=>c(h).icon,Xt=>c(h).icon=Xt),Hn(Ae,()=>c(h).name,Xt=>c(h).name=Xt),Hn(pt,()=>c(h).description,Xt=>c(h).description=Xt),E(Ft,It)},an=Ft=>{var It=Fb(),Jt=p(It),Qe=p(Jt),Ae=g(Jt,2),pt=p(Ae);{var Rt=Rn=>{var fr=Bb(),Er=p(fr);Q(()=>j(Er,c(Ze).icon)),E(Rn,fr)};te(pt,Rn=>{c(Ze).icon&&Rn(Rt)})}var Qt=g(pt,2),Oe=p(Qt),Xt=p(Oe),Br=g(Oe,2),Cn=p(Br),zt=g(Ae,2),jt=p(zt);jt.__click=()=>ue(c(Ye),-1);var kt=g(jt,2);kt.__click=()=>ue(c(Ye),1);var In=g(kt,2);In.__click=()=>Z(c(Ze));var dr=g(In,2);dr.__click=()=>R(c(Ze).id),Q(()=>{j(Qe,c(Ye)+1),j(Xt,c(Ze).name),j(Cn,c(Ze).description),jt.disabled=c(Ye)===0,kt.disabled=c(Ye)===c(f).length-1}),E(Ft,It)};te(Dt,Ft=>{var It;((It=c(h))==null?void 0:It.id)===c(Ze).id?Ft(rn):Ft(an,!1)})}E(Ke,mt)});var At=g(vt,2);{var We=Ke=>{var Ze=zb();E(Ke,Ze)};te(At,Ke=>{c(f).length===0&&Ke(We)})}Q((Ke,Ze)=>{$=ln(pe,"",$,Ke),j(Ee,Ze),j(Fe,`${c(f).length??""} action${c(f).length===1?"":"s"}`),j(nt,c(x)?"Cancel":"+ Add Action")},[()=>({background:z(c(o))}),()=>L(c(o))]),E(Me,re)},de=Me=>{var re=Wb(),T=p(re);{var pe=Ee=>{var qe=Kb();E(Ee,qe)},$=Ee=>{var qe=Gb();E(Ee,qe)};te(T,Ee=>{c(a).length===0?Ee(pe):Ee($,!1)})}E(Me,re)};te(se,Me=>{c(o)?Me(G):Me(de,!1)})}E(Y,J)};te(ye,Y=>{n()&&Y(be)})}E(t,ke),Et()}Bt(["click","keydown"]);var Yb=C('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Qb=C('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),Xb=C('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),Zb=C('<button class="chip svelte-s2dwjj"> </button>'),Jb=C('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),$b=C('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),e1=C('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),t1=C('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),n1=C('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),r1=C('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),a1=C('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),s1=C('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),i1=C('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),o1=C('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),l1=C('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),c1=C('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function u1(t,e){St(e,!0);let n=Ne(e,"groupOrder",19,()=>[]),a=Re(!1),s=Re(null),o=Re(!1),u=Re(null);async function f(){var be;const[P,ue,ke]=await Promise.all([He.items.where("sourceType").equals("gmail").count(),He.emailClassifications.count(),He.contacts.count()]);let ye=0;try{const Y=await((be=navigator.storage)==null?void 0:be.estimate());ye=(Y==null?void 0:Y.usage)??0}catch{}A(u,{emailCount:P,classCount:ue,contactCount:ke,totalBytes:ye},!0)}function h(P){return P?P<1024?`${P} B`:P<1024*1024?`${(P/1024).toFixed(1)} KB`:`${(P/(1024*1024)).toFixed(1)} MB`:"â"}function m(){A(a,!c(a)),c(a)&&f()}async function y(P){var ue;A(o,!0),A(s,null);try{await P(),await f(),(ue=e.onrefresh)==null||ue.call(e)}finally{A(o,!1)}}async function x(){await y(()=>Sc())}async function b(P){await y(()=>gl(P))}async function k(){await y(async()=>{await gd(),await Sc()})}async function I(){await y(()=>He.contacts.clear())}async function L(){await y(async()=>{await He.delete(),window.location.reload()})}function z(P){return P.split("_").map(ue=>ue.charAt(0)+ue.slice(1).toLowerCase()).join(" ")}var ie=c1(),ce=p(ie);ce.__click=m;var ne=g(p(ce),2);let R;var Z=g(ce,2);{var W=P=>{var ue=l1(),ke=p(ue);{var ye=T=>{var pe=Qb(),$=p(pe),Ee=p($),qe=g($,4),Fe=p(qe),et=g(qe,4),rt=p(et),nt=g(et,2);{var Ve=Xe=>{var tt=Yb(),vt=g($e(tt),2),At=p(vt);Q(We=>j(At,`${We??""} used`),[()=>h(c(u).totalBytes)]),E(Xe,tt)};te(nt,Xe=>{c(u).totalBytes&&Xe(Ve)})}Q(()=>{j(Ee,`${c(u).emailCount??""} emails`),j(Fe,`${c(u).classCount??""} classifications`),j(rt,`${c(u).contactCount??""} contacts`)}),E(T,pe)};te(ke,T=>{c(u)&&T(ye)})}var be=g(ke,2);{var Y=T=>{var pe=Jb(),$=g(p(pe),2);Ct($,21,n,Gt,(Ee,qe)=>{var Fe=Xn(),et=$e(Fe);{var rt=Ve=>{var Xe=Xb(),tt=p(Xe),vt=g(tt);vt.__click=()=>A(s,null);var At=g(vt,2);At.__click=()=>b(c(qe)),Q(We=>{j(tt,`Delete ${We??""}? `),At.disabled=c(o)},[()=>z(c(qe))]),E(Ve,Xe)},nt=Ve=>{var Xe=Zb();Xe.__click=()=>A(s,`group:${c(qe)}`);var tt=p(Xe);Q(vt=>{Xe.disabled=c(o),j(tt,`${vt??""} â`)},[()=>z(c(qe))]),E(Ve,Xe)};te(et,Ve=>{c(s)===`group:${c(qe)}`?Ve(rt):Ve(nt,!1)})}E(Ee,Fe)}),E(T,pe)};te(be,T=>{n().length>0&&T(Y)})}var J=g(be,2),ve=g(p(J),2),ae=p(ve);{var he=T=>{var pe=$b(),$=g(p(pe),2);$.__click=()=>A(s,null);var Ee=g($,2);Ee.__click=x,Q(()=>Ee.disabled=c(o)),E(T,pe)},xe=T=>{var pe=e1();pe.__click=()=>A(s,"classifications"),Q(()=>pe.disabled=c(o)),E(T,pe)};te(ae,T=>{c(s)==="classifications"?T(he):T(xe,!1)})}var le=g(ae,2);{var fe=T=>{var pe=t1(),$=g(p(pe),2);$.__click=()=>A(s,null);var Ee=g($,2);Ee.__click=k,Q(()=>Ee.disabled=c(o)),E(T,pe)},we=T=>{var pe=n1();pe.__click=()=>A(s,"emails"),Q(()=>pe.disabled=c(o)),E(T,pe)};te(le,T=>{c(s)==="emails"?T(fe):T(we,!1)})}var Se=g(le,2);{var me=T=>{var pe=r1(),$=g(p(pe),2);$.__click=()=>A(s,null);var Ee=g($,2);Ee.__click=I,Q(()=>Ee.disabled=c(o)),E(T,pe)},D=T=>{var pe=a1();pe.__click=()=>A(s,"contacts"),Q(()=>pe.disabled=c(o)),E(T,pe)};te(Se,T=>{c(s)==="contacts"?T(me):T(D,!1)})}var H=g(J,2),se=p(H);{var G=T=>{var pe=s1(),$=g(p(pe),2);$.__click=()=>A(s,null);var Ee=g($,2);Ee.__click=L,Q(()=>Ee.disabled=c(o)),E(T,pe)},de=T=>{var pe=i1();pe.__click=()=>A(s,"nuke"),Q(()=>pe.disabled=c(o)),E(T,pe)};te(se,T=>{c(s)==="nuke"?T(G):T(de,!1)})}var Me=g(H,2);{var re=T=>{var pe=o1();E(T,pe)};te(Me,T=>{c(o)&&T(re)})}E(P,ue)};te(Z,P=>{c(a)&&P(W)})}Q(()=>R=Mt(ne,0,"chev svelte-s2dwjj",null,R,{open:c(a)})),E(t,ie),Et()}Bt(["click"]);var d1=C('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),f1=C('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),v1=C('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),p1=C('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <div class="toolbar svelte-12gkq0i"><button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!></div>');function h1(t,e){St(e,!0);let n=Ne(e,"groups",19,()=>({})),a=Ne(e,"groupOrder",19,()=>[]),s=Ne(e,"counts",19,()=>({})),o=Ne(e,"stats",3,null),u=Ne(e,"expandedGroup",3,null),f=Ne(e,"isScanning",3,!1),h=Ne(e,"scanProgress",3,null),m=Ne(e,"scanCount",15,20),y=Ne(e,"error",3,null),x=Re(!1),b=Re(!1),k=dt(()=>{for(const ye of a()){const be=n()[ye];if((be==null?void 0:be.length)>0)return be[0]}return null});var I=p1(),L=p(I);db(L,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return f()},get scanProgress(){return h()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>A(x,!0),get scanCount(){return m()},set scanCount(ye){m(ye)}});var z=g(L,2);Db(z,{get sampleEmail(){return c(k)},get open(){return c(x)},set open(ye){A(x,ye,!0)}});var ie=g(z,2);Vb(ie,{get open(){return c(b)},set open(ye){A(b,ye,!0)}});var ce=g(ie,2),ne=p(ce);ne.__click=()=>A(b,!0);var R=g(ce,2);{var Z=ye=>{var be=d1(),Y=p(be),J=p(Y),ve=g(Y,2);ve.__click=function(...ae){var he;(he=e.ondismisserror)==null||he.apply(this,ae)},Q(()=>j(J,y())),E(ye,be)};te(R,ye=>{y()&&ye(Z)})}var W=g(R,2);{var P=ye=>{var be=f1(),Y=$e(be);Ct(Y,20,a,he=>he,(he,xe)=>{{let le=dt(()=>zo(xe)),fe=dt(()=>{var me;return((me=n()[xe])==null?void 0:me.length)||0}),we=dt(()=>n()[xe]||[]),Se=dt(()=>u()===xe);Ib(he,{get action(){return xe},get color(){return c(le)},get count(){return c(fe)},get items(){return c(we)},get expanded(){return c(Se)},ontoggle:()=>e.ontogglegroup(xe),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(xe)})}});var J=g(Y,2),ve=p(J),ae=p(ve);Q(()=>j(ae,`${s().total??""} emails classified into ${a().length??""} groups`)),E(ye,be)},ue=ye=>{var be=v1();E(ye,be)};te(W,ye=>{s().total>0?ye(P):f()||ye(ue,1)})}var ke=g(W,2);u1(ke,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),E(t,I),Et()}Bt(["click"]);var m1=C('<div class="actions-page svelte-3tch4q"><!></div>');function g1(t,e){St(e,!0);const n=Zu();let a=Re(Pt(n.status)),s=Re(""),o=Re(Pt({})),u=Re(Pt([])),f=Re(Pt({total:0})),h=Re(null),m=Re(null),y=Re(!1),x=Re(null),b=Re(3),k=Re(null),I=Re(null);const L="me-ai-scan-history";async function z(){return await Is(L)}async function ie(ve){!ve||ve.phase!=="done"||await Rs(L,{timestamp:Date.now(),classified:ve.classified||0,errors:ve.errors||0,total:ve.total||0,totals:ve.totals||{},summary:ve.summary||{}})}nn(async()=>{const ve=n.onMessage(he=>{if(he.status==="ready"){A(a,"ready");const xe=wr.find(we=>we.id===n.modelId),le=kr.find(we=>we.name===n.modelId),fe=xe||le;A(s,(fe==null?void 0:fe.name)||(fe==null?void 0:fe.displayName)||n.modelId||"",!0)}he.status==="loading"&&A(a,"loading")});if(A(a,n.status,!0),n.modelId){const he=wr.find(fe=>fe.id===n.modelId),xe=kr.find(fe=>fe.name===n.modelId),le=he||xe;A(s,(le==null?void 0:le.name)||(le==null?void 0:le.displayName)||n.modelId||"",!0)}const ae=await z();return ae&&A(x,{phase:"done",...ae},!0),ce(),()=>ve()});async function ce(){try{const ve=await ud();A(o,ve.groups,!0),A(u,ve.order,!0),A(f,await Pp(),!0),A(h,await Fo(),!0)}catch(ve){A(k,`Failed to load data: ${ve.message}`)}}async function ne(){await Z(!1)}async function R(){await Z(!0)}async function Z(ve){if(c(y)||!n.isReady)return;A(k,null),A(y,!0),A(x,null);const ae=new AbortController;A(I,ae,!0);try{await cd(n,{count:c(b),force:ve,signal:ae.signal,onProgress:he=>{A(x,{...he},!0),he.phase==="done"&&ie(he)}}),await ce()}catch(he){ae.signal.aborted||A(k,`Scan failed: ${he.message}`)}finally{A(y,!1),A(I,null)}}function W(){var ve;(ve=c(I))==null||ve.abort()}async function P(ve){await ki(ve,"acted"),await ce()}async function ue(ve){await ki(ve,"dismissed"),await ce()}async function ke(ve){await dd(ve),await ce()}async function ye(ve){await gl(ve),await ce()}function be(ve){A(m,c(m)===ve?null:ve,!0)}var Y=m1(),J=p(Y);h1(J,{get engineStatus(){return c(a)},get modelName(){return c(s)},get groups(){return c(o)},get groupOrder(){return c(u)},get counts(){return c(f)},get stats(){return c(h)},get expandedGroup(){return c(m)},get isScanning(){return c(y)},get scanProgress(){return c(x)},get error(){return c(k)},onscan:ne,onrescan:R,ontogglegroup:be,onmarkacted:P,ondismiss:ue,onremove:ke,oncleargroup:ye,ondismisserror:()=>A(k,null),onstop:W,onrefresh:ce,oncloseprogress:async()=>{A(x,null),await dl(L)},get scanCount(){return c(b)},set scanCount(ve){A(b,ve,!0)}}),E(t,Y),Et()}var _1=C('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function y1(t,e){St(e,!0);function n(){const P=location.hash;return P==="#dashboard"?"dashboard":P==="#actions"?"actions":"chat"}let a=Re(Pt(n()));nn(()=>{function P(){A(a,n(),!0)}return window.addEventListener("hashchange",P),()=>window.removeEventListener("hashchange",P)});var s=_1(),o=p(s),u=g(p(o),2),f=p(u);let h;var m=g(f,2);let y;var x=g(m,2);let b;var k=g(o,2),I=p(k);let L;var z=p(I);sg(z,{});var ie=g(I,2);let ce;var ne=p(ie);g1(ne,{});var R=g(ie,2);let Z;var W=p(R);Ly(W,{}),Q(()=>{h=Mt(f,1,"svelte-1n46o8q",null,h,{active:c(a)==="chat"}),y=Mt(m,1,"svelte-1n46o8q",null,y,{active:c(a)==="actions"}),b=Mt(x,1,"svelte-1n46o8q",null,b,{active:c(a)==="dashboard"}),L=ln(I,"",L,{display:c(a)==="chat"?"flex":"none"}),ce=ln(ie,"",ce,{display:c(a)==="actions"?"flex":"none"}),Z=ln(R,"",Z,{display:c(a)==="dashboard"?"flex":"none"})}),E(t,s),Et()}kv(y1,{target:document.getElementById("app")});
