var Yd=Object.defineProperty;var Yl=t=>{throw TypeError(t)};var Qd=(t,e,n)=>e in t?Yd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var st=(t,e,n)=>Qd(t,typeof e!="symbol"?e+"":e,n),ro=(t,e,n)=>e.has(t)||Yl("Cannot "+n);var me=(t,e,n)=>(ro(t,e,"read from private field"),n?n.call(t):e.get(t)),it=(t,e,n)=>e.has(t)?Yl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),nt=(t,e,n,a)=>(ro(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),dn=(t,e,n)=>(ro(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const yo=!1;var Wo=Array.isArray,Xd=Array.prototype.indexOf,Ua=Array.prototype.includes,xi=Array.from,Zd=Object.defineProperty,Da=Object.getOwnPropertyDescriptor,Jd=Object.getOwnPropertyDescriptors,$d=Object.prototype,ef=Array.prototype,Kc=Object.getPrototypeOf,Ql=Object.isExtensible;const tf=()=>{};function nf(t){for(var e=0;e<t.length;e++)t[e]()}function Uc(){var t,e,n=new Promise((a,i)=>{t=a,e=i});return{promise:n,resolve:t,reject:e}}const sn=2,xs=4,Si=8,Gc=1<<24,Mr=16,or=32,Sa=64,Wc=128,zn=512,Jt=1024,on=2048,ir=4096,In=8192,Ir=16384,Is=32768,Ga=65536,Xl=1<<17,Hc=1<<18,Qa=1<<19,rf=1<<20,Pr=1<<25,_a=65536,bo=1<<21,Ho=1<<22,Kr=1<<23,ha=Symbol("$state"),af=Symbol("legacy props"),sf=Symbol(""),ia=new class extends Error{constructor(){super(...arguments);st(this,"name","StaleReactionError");st(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function of(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function lf(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function cf(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function uf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function df(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ff(t){throw new Error("https://svelte.dev/e/effect_orphan")}function vf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function pf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function hf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function mf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function gf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function _f(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const yf=1,bf=2,Vc=4,wf=8,kf=16,xf=1,Sf=4,Ef=8,Tf=16,Yc=1,Af=2,tn=Symbol(),Qc="http://www.w3.org/1999/xhtml";function Cf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Pf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Xc(t){return t===this.v}function If(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Zc(t){return!If(t,this.v)}let Rf=!1,Rn=null;function Wa(t){Rn=t}function yt(t,e=!1,n){Rn={p:Rn,i:!1,c:null,e:null,s:t,x:null,l:null}}function bt(t){var e=Rn,n=e.e;if(n!==null){e.e=null;for(var a of n)yu(a)}return t!==void 0&&(e.x=t),e.i=!0,Rn=e.p,t??{}}function Jc(){return!0}let oa=[];function $c(){var t=oa;oa=[],nf(t)}function Ur(t){if(oa.length===0&&!_s){var e=oa;queueMicrotask(()=>{e===oa&&$c()})}oa.push(t)}function Of(){for(;oa.length>0;)$c()}function eu(t){var e=wt;if(e===null)return ot.f|=Kr,t;if((e.f&Is)===0&&(e.f&xs)===0)throw t;Ha(t,e)}function Ha(t,e){for(;e!==null;){if((e.f&Wc)!==0){if((e.f&Is)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Mf=-7169;function Ht(t,e){t.f=t.f&Mf|e}function Vo(t){(t.f&zn)!==0||t.deps===null?Ht(t,Jt):Ht(t,ir)}function tu(t){if(t!==null)for(const e of t)(e.f&sn)===0||(e.f&_a)===0||(e.f^=_a,tu(e.deps))}function nu(t,e,n){(t.f&on)!==0?e.add(t):(t.f&ir)!==0&&n.add(t),tu(t.deps),Ht(t,Jt)}const ti=new Set;let $e=null,hi=null,nn=null,bn=[],Ei=null,wo=!1,_s=!1;var La,Na,ca,qa,Ts,As,ua,Er,Ba,br,ko,xo,ru;const bl=class bl{constructor(){it(this,br);st(this,"committed",!1);st(this,"current",new Map);st(this,"previous",new Map);it(this,La,new Set);it(this,Na,new Set);it(this,ca,0);it(this,qa,0);it(this,Ts,null);it(this,As,new Set);it(this,ua,new Set);it(this,Er,new Map);st(this,"is_fork",!1);it(this,Ba,!1)}is_deferred(){return this.is_fork||me(this,qa)>0}skip_effect(e){me(this,Er).has(e)||me(this,Er).set(e,{d:[],m:[]})}unskip_effect(e){var n=me(this,Er).get(e);if(n){me(this,Er).delete(e);for(var a of n.d)Ht(a,on),rr(a);for(a of n.m)Ht(a,ir),rr(a)}}process(e){var i;bn=[],this.apply();var n=[],a=[];for(const o of e)dn(this,br,ko).call(this,o,n,a);if(this.is_deferred()){dn(this,br,xo).call(this,a),dn(this,br,xo).call(this,n);for(const[o,c]of me(this,Er))ou(o,c)}else{for(const o of me(this,La))o();me(this,La).clear(),me(this,ca)===0&&dn(this,br,ru).call(this),hi=this,$e=null,Zl(a),Zl(n),hi=null,(i=me(this,Ts))==null||i.resolve()}nn=null}capture(e,n){n!==tn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Kr)===0&&(this.current.set(e,e.v),nn==null||nn.set(e,e.v))}activate(){$e=this,this.apply()}deactivate(){$e===this&&($e=null,nn=null)}flush(){if(this.activate(),bn.length>0){if(au(),$e!==null&&$e!==this)return}else me(this,ca)===0&&this.process([]);this.deactivate()}discard(){for(const e of me(this,Na))e(this);me(this,Na).clear()}increment(e){nt(this,ca,me(this,ca)+1),e&&nt(this,qa,me(this,qa)+1)}decrement(e){nt(this,ca,me(this,ca)-1),e&&nt(this,qa,me(this,qa)-1),!me(this,Ba)&&(nt(this,Ba,!0),Ur(()=>{nt(this,Ba,!1),this.is_deferred()?bn.length>0&&this.flush():this.revive()}))}revive(){for(const e of me(this,As))me(this,ua).delete(e),Ht(e,on),rr(e);for(const e of me(this,ua))Ht(e,ir),rr(e);this.flush()}oncommit(e){me(this,La).add(e)}ondiscard(e){me(this,Na).add(e)}settled(){return(me(this,Ts)??nt(this,Ts,Uc())).promise}static ensure(){if($e===null){const e=$e=new bl;ti.add($e),_s||Ur(()=>{$e===e&&e.flush()})}return $e}apply(){}};La=new WeakMap,Na=new WeakMap,ca=new WeakMap,qa=new WeakMap,Ts=new WeakMap,As=new WeakMap,ua=new WeakMap,Er=new WeakMap,Ba=new WeakMap,br=new WeakSet,ko=function(e,n,a){e.f^=Jt;for(var i=e.first,o=null;i!==null;){var c=i.f,f=(c&(or|Sa))!==0,m=f&&(c&Jt)!==0,h=m||(c&In)!==0||me(this,Er).has(i);if(!h&&i.fn!==null){f?i.f^=Jt:o!==null&&(c&(xs|Si|Gc))!==0?o.b.defer_effect(i):(c&xs)!==0?n.push(i):Os(i)&&((c&Mr)!==0&&me(this,ua).add(i),Ya(i));var b=i.first;if(b!==null){i=b;continue}}var y=i.parent;for(i=i.next;i===null&&y!==null;)y===o&&(o=null),i=y.next,y=y.parent}},xo=function(e){for(var n=0;n<e.length;n+=1)nu(e[n],me(this,As),me(this,ua))},ru=function(){var i;if(ti.size>1){this.previous.clear();var e=nn,n=!0;for(const o of ti){if(o===this){n=!1;continue}const c=[];for(const[m,h]of this.current){if(o.current.has(m))if(n&&h!==o.current.get(m))o.current.set(m,h);else continue;c.push(m)}if(c.length===0)continue;const f=[...o.current.keys()].filter(m=>!this.current.has(m));if(f.length>0){var a=bn;bn=[];const m=new Set,h=new Map;for(const b of c)su(b,f,m,h);if(bn.length>0){$e=o,o.apply();for(const b of bn)dn(i=o,br,ko).call(i,b,[],[]);o.deactivate()}bn=a}}$e=null,nn=e}this.committed=!0,ti.delete(this)};let Gr=bl;function jf(t){var e=_s;_s=!0;try{for(var n;;){if(Of(),bn.length===0&&($e==null||$e.flush(),bn.length===0))return Ei=null,n;au()}}finally{_s=e}}function au(){wo=!0;var t=null;try{for(var e=0;bn.length>0;){var n=Gr.ensure();if(e++>1e3){var a,i;Df()}n.process(bn),Wr.clear()}}finally{bn=[],wo=!1,Ei=null}}function Df(){try{vf()}catch(t){Ha(t,Ei)}}let Zn=null;function Zl(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Ir|In))===0&&Os(a)&&(Zn=new Set,Ya(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&xu(a),(Zn==null?void 0:Zn.size)>0)){Wr.clear();for(const i of Zn){if((i.f&(Ir|In))!==0)continue;const o=[i];let c=i.parent;for(;c!==null;)Zn.has(c)&&(Zn.delete(c),o.push(c)),c=c.parent;for(let f=o.length-1;f>=0;f--){const m=o[f];(m.f&(Ir|In))===0&&Ya(m)}}Zn.clear()}}Zn=null}}function su(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const o=i.f;(o&sn)!==0?su(i,e,n,a):(o&(Ho|Mr))!==0&&(o&on)===0&&iu(i,e,a)&&(Ht(i,on),rr(i))}}function iu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const i of t.deps){if(Ua.call(e,i))return!0;if((i.f&sn)!==0&&iu(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function rr(t){for(var e=Ei=t;e.parent!==null;){e=e.parent;var n=e.f;if(wo&&e===wt&&(n&Mr)!==0&&(n&Hc)===0)return;if((n&(Sa|or))!==0){if((n&Jt)===0)return;e.f^=Jt}}bn.push(e)}function ou(t,e){if(!((t.f&or)!==0&&(t.f&Jt)!==0)){(t.f&on)!==0?e.d.push(t):(t.f&ir)!==0&&e.m.push(t),Ht(t,Jt);for(var n=t.first;n!==null;)ou(n,e),n=n.next}}function Lf(t){let e=0,n=ya(0),a;return()=>{Xo()&&(d(n),Zo(()=>(e===0&&(a=Ms(()=>t(()=>ys(n)))),e+=1,()=>{Ur(()=>{e-=1,e===0&&(a==null||a(),a=void 0,ys(n))})})))}}var Nf=Ga|Qa|Wc;function qf(t,e,n){new Bf(t,e,n)}var Nn,Go,pr,da,hr,qn,_n,mr,Tr,zr,fa,Fr,za,va,Fa,Ka,Ar,wi,$t,zf,Ff,So,ci,ui,Eo;class Bf{constructor(e,n,a){it(this,$t);st(this,"parent");st(this,"is_pending",!1);it(this,Nn);it(this,Go,null);it(this,pr);it(this,da);it(this,hr);it(this,qn,null);it(this,_n,null);it(this,mr,null);it(this,Tr,null);it(this,zr,null);it(this,fa,0);it(this,Fr,0);it(this,za,!1);it(this,va,!1);it(this,Fa,new Set);it(this,Ka,new Set);it(this,Ar,null);it(this,wi,Lf(()=>(nt(this,Ar,ya(me(this,fa))),()=>{nt(this,Ar,null)})));nt(this,Nn,e),nt(this,pr,n),nt(this,da,a),this.parent=wt.b,this.is_pending=!!me(this,pr).pending,nt(this,hr,Jo(()=>{wt.b=this;{var i=dn(this,$t,So).call(this);try{nt(this,qn,Bn(()=>a(i)))}catch(o){this.error(o)}me(this,Fr)>0?dn(this,$t,ui).call(this):this.is_pending=!1}return()=>{var o;(o=me(this,zr))==null||o.remove()}},Nf))}defer_effect(e){nu(e,me(this,Fa),me(this,Ka))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!me(this,pr).pending}update_pending_count(e){dn(this,$t,Eo).call(this,e),nt(this,fa,me(this,fa)+e),!(!me(this,Ar)||me(this,za))&&(nt(this,za,!0),Ur(()=>{nt(this,za,!1),me(this,Ar)&&Va(me(this,Ar),me(this,fa))}))}get_effect_pending(){return me(this,wi).call(this),d(me(this,Ar))}error(e){var n=me(this,pr).onerror;let a=me(this,pr).failed;if(me(this,va)||!n&&!a)throw e;me(this,qn)&&(kn(me(this,qn)),nt(this,qn,null)),me(this,_n)&&(kn(me(this,_n)),nt(this,_n,null)),me(this,mr)&&(kn(me(this,mr)),nt(this,mr,null));var i=!1,o=!1;const c=()=>{if(i){Pf();return}i=!0,o&&_f(),Gr.ensure(),nt(this,fa,0),me(this,mr)!==null&&ma(me(this,mr),()=>{nt(this,mr,null)}),this.is_pending=this.has_pending_snippet(),nt(this,qn,dn(this,$t,ci).call(this,()=>(nt(this,va,!1),Bn(()=>me(this,da).call(this,me(this,Nn)))))),me(this,Fr)>0?dn(this,$t,ui).call(this):this.is_pending=!1};Ur(()=>{try{o=!0,n==null||n(e,c),o=!1}catch(f){Ha(f,me(this,hr)&&me(this,hr).parent)}a&&nt(this,mr,dn(this,$t,ci).call(this,()=>{Gr.ensure(),nt(this,va,!0);try{return Bn(()=>{a(me(this,Nn),()=>e,()=>c)})}catch(f){return Ha(f,me(this,hr).parent),null}finally{nt(this,va,!1)}}))})}}Nn=new WeakMap,Go=new WeakMap,pr=new WeakMap,da=new WeakMap,hr=new WeakMap,qn=new WeakMap,_n=new WeakMap,mr=new WeakMap,Tr=new WeakMap,zr=new WeakMap,fa=new WeakMap,Fr=new WeakMap,za=new WeakMap,va=new WeakMap,Fa=new WeakMap,Ka=new WeakMap,Ar=new WeakMap,wi=new WeakMap,$t=new WeakSet,zf=function(){try{nt(this,qn,Bn(()=>me(this,da).call(this,me(this,Nn))))}catch(e){this.error(e)}},Ff=function(){const e=me(this,pr).pending;e&&(nt(this,_n,Bn(()=>e(me(this,Nn)))),Ur(()=>{var n=dn(this,$t,So).call(this);nt(this,qn,dn(this,$t,ci).call(this,()=>(Gr.ensure(),Bn(()=>me(this,da).call(this,n))))),me(this,Fr)>0?dn(this,$t,ui).call(this):(ma(me(this,_n),()=>{nt(this,_n,null)}),this.is_pending=!1)}))},So=function(){var e=me(this,Nn);return this.is_pending&&(nt(this,zr,Rr()),me(this,Nn).before(me(this,zr)),e=me(this,zr)),e},ci=function(e){var n=wt,a=ot,i=Rn;yr(me(this,hr)),Kn(me(this,hr)),Wa(me(this,hr).ctx);try{return e()}catch(o){return eu(o),null}finally{yr(n),Kn(a),Wa(i)}},ui=function(){const e=me(this,pr).pending;me(this,qn)!==null&&(nt(this,Tr,document.createDocumentFragment()),me(this,Tr).append(me(this,zr)),Tu(me(this,qn),me(this,Tr))),me(this,_n)===null&&nt(this,_n,Bn(()=>e(me(this,Nn))))},Eo=function(e){var n;if(!this.has_pending_snippet()){this.parent&&dn(n=this.parent,$t,Eo).call(n,e);return}if(nt(this,Fr,me(this,Fr)+e),me(this,Fr)===0){this.is_pending=!1;for(const a of me(this,Fa))Ht(a,on),rr(a);for(const a of me(this,Ka))Ht(a,ir),rr(a);me(this,Fa).clear(),me(this,Ka).clear(),me(this,_n)&&ma(me(this,_n),()=>{nt(this,_n,null)}),me(this,Tr)&&(me(this,Nn).before(me(this,Tr)),nt(this,Tr,null))}};function Kf(t,e,n,a){const i=Ti;var o=t.filter(w=>!w.settled);if(n.length===0&&o.length===0){a(e.map(i));return}var c=$e,f=wt,m=Uf(),h=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(w=>w.promise)):null;function b(w){m();try{a(w)}catch(x){(f.f&Ir)===0&&Ha(x,f)}c==null||c.deactivate(),To()}if(n.length===0){h.then(()=>b(e.map(i)));return}function y(){m(),Promise.all(n.map(w=>Gf(w))).then(w=>b([...e.map(i),...w])).catch(w=>Ha(w,f))}h?h.then(y):y()}function Uf(){var t=wt,e=ot,n=Rn,a=$e;return function(o=!0){yr(t),Kn(e),Wa(n),o&&(a==null||a.activate())}}function To(){yr(null),Kn(null),Wa(null)}function Ti(t){var e=sn|on,n=ot!==null&&(ot.f&sn)!==0?ot:null;return wt!==null&&(wt.f|=Qa),{ctx:Rn,deps:null,effects:null,equals:Xc,f:e,fn:t,reactions:null,rv:0,v:tn,wv:0,parent:n??wt,ac:null}}function Gf(t,e,n){let a=wt;a===null&&lf();var i=a.b,o=void 0,c=ya(tn),f=!ot,m=new Map;return av(()=>{var x;var h=Uc();o=h.promise;try{Promise.resolve(t()).then(h.resolve,h.reject).then(()=>{b===$e&&b.committed&&b.deactivate(),To()})}catch(I){h.reject(I),To()}var b=$e;if(f){var y=i.is_rendered();i.update_pending_count(1),b.increment(y),(x=m.get(b))==null||x.reject(ia),m.delete(b),m.set(b,h)}const w=(I,G=void 0)=>{if(b.activate(),G)G!==ia&&(c.f|=Kr,Va(c,G));else{(c.f&Kr)!==0&&(c.f^=Kr),Va(c,I);for(const[A,V]of m){if(m.delete(A),A===b)break;V.reject(ia)}}f&&(i.update_pending_count(-1),b.decrement(y))};h.promise.then(w,I=>w(null,I||"unknown"))}),_u(()=>{for(const h of m.values())h.reject(ia)}),new Promise(h=>{function b(y){function w(){y===o?h(c):b(o)}y.then(w,w)}b(o)})}function ft(t){const e=Ti(t);return Au(e),e}function lu(t){const e=Ti(t);return e.equals=Zc,e}function Wf(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)kn(e[n])}}function Hf(t){for(var e=t.parent;e!==null;){if((e.f&sn)===0)return(e.f&Ir)===0?e:null;e=e.parent}return null}function Yo(t){var e,n=wt;yr(Hf(t));try{t.f&=~_a,Wf(t),e=Ru(t)}finally{yr(n)}return e}function cu(t){var e=Yo(t);if(!t.equals(e)&&(t.wv=Pu(),(!($e!=null&&$e.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Ht(t,Jt);return}Hr||(nn!==null?(Xo()||$e!=null&&$e.is_fork)&&nn.set(t,e):Vo(t))}function Vf(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(ia),a.teardown=tf,a.ac=null,Ss(a,0),$o(a))}function uu(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Ya(e)}let Ao=new Set;const Wr=new Map;let du=!1;function ya(t,e){var n={f:0,v:t,reactions:null,equals:Xc,rv:0,wv:0};return n}function Pe(t,e){const n=ya(t);return Au(n),n}function Yf(t,e=!1,n=!0){const a=ya(t);return e||(a.equals=Zc),a}function C(t,e,n=!1){ot!==null&&(!ar||(ot.f&Xl)!==0)&&Jc()&&(ot.f&(sn|Mr|Ho|Xl))!==0&&(Fn===null||!Ua.call(Fn,t))&&gf();let a=n?Nt(e):e;return Va(t,a)}function Va(t,e){if(!t.equals(e)){var n=t.v;Hr?Wr.set(t,e):Wr.set(t,n),t.v=e;var a=Gr.ensure();if(a.capture(t,n),(t.f&sn)!==0){const i=t;(t.f&on)!==0&&Yo(i),Vo(i)}t.wv=Pu(),fu(t,on),wt!==null&&(wt.f&Jt)!==0&&(wt.f&(or|Sa))===0&&(Ln===null?iv([t]):Ln.push(t)),!a.is_fork&&Ao.size>0&&!du&&Qf()}return e}function Qf(){du=!1;for(const t of Ao)(t.f&Jt)!==0&&Ht(t,ir),Os(t)&&Ya(t);Ao.clear()}function ys(t){C(t,t.v+1)}function fu(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,i=0;i<a;i++){var o=n[i],c=o.f,f=(c&on)===0;if(f&&Ht(o,e),(c&sn)!==0){var m=o;nn==null||nn.delete(m),(c&_a)===0&&(c&zn&&(o.f|=_a),fu(m,ir))}else f&&((c&Mr)!==0&&Zn!==null&&Zn.add(o),rr(o))}}function Nt(t){if(typeof t!="object"||t===null||ha in t)return t;const e=Kc(t);if(e!==$d&&e!==ef)return t;var n=new Map,a=Wo(t),i=Pe(0),o=ga,c=f=>{if(ga===o)return f();var m=ot,h=ga;Kn(null),nc(o);var b=f();return Kn(m),nc(h),b};return a&&n.set("length",Pe(t.length)),new Proxy(t,{defineProperty(f,m,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&hf();var b=n.get(m);return b===void 0?c(()=>{var y=Pe(h.value);return n.set(m,y),y}):C(b,h.value,!0),!0},deleteProperty(f,m){var h=n.get(m);if(h===void 0){if(m in f){const b=c(()=>Pe(tn));n.set(m,b),ys(i)}}else C(h,tn),ys(i);return!0},get(f,m,h){var x;if(m===ha)return t;var b=n.get(m),y=m in f;if(b===void 0&&(!y||(x=Da(f,m))!=null&&x.writable)&&(b=c(()=>{var I=Nt(y?f[m]:tn),G=Pe(I);return G}),n.set(m,b)),b!==void 0){var w=d(b);return w===tn?void 0:w}return Reflect.get(f,m,h)},getOwnPropertyDescriptor(f,m){var h=Reflect.getOwnPropertyDescriptor(f,m);if(h&&"value"in h){var b=n.get(m);b&&(h.value=d(b))}else if(h===void 0){var y=n.get(m),w=y==null?void 0:y.v;if(y!==void 0&&w!==tn)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return h},has(f,m){var w;if(m===ha)return!0;var h=n.get(m),b=h!==void 0&&h.v!==tn||Reflect.has(f,m);if(h!==void 0||wt!==null&&(!b||(w=Da(f,m))!=null&&w.writable)){h===void 0&&(h=c(()=>{var x=b?Nt(f[m]):tn,I=Pe(x);return I}),n.set(m,h));var y=d(h);if(y===tn)return!1}return b},set(f,m,h,b){var Z;var y=n.get(m),w=m in f;if(a&&m==="length")for(var x=h;x<y.v;x+=1){var I=n.get(x+"");I!==void 0?C(I,tn):x in f&&(I=c(()=>Pe(tn)),n.set(x+"",I))}if(y===void 0)(!w||(Z=Da(f,m))!=null&&Z.writable)&&(y=c(()=>Pe(void 0)),C(y,Nt(h)),n.set(m,y));else{w=y.v!==tn;var G=c(()=>Nt(h));C(y,G)}var A=Reflect.getOwnPropertyDescriptor(f,m);if(A!=null&&A.set&&A.set.call(b,h),!w){if(a&&typeof m=="string"){var V=n.get("length"),de=Number(m);Number.isInteger(de)&&de>=V.v&&C(V,de+1)}ys(i)}return!0},ownKeys(f){d(i);var m=Reflect.ownKeys(f).filter(y=>{var w=n.get(y);return w===void 0||w.v!==tn});for(var[h,b]of n)b.v!==tn&&!(h in f)&&m.push(h);return m},setPrototypeOf(){mf()}})}function Jl(t){try{if(t!==null&&typeof t=="object"&&ha in t)return t[ha]}catch{}return t}function Xf(t,e){return Object.is(Jl(t),Jl(e))}var $l,vu,pu,hu;function Zf(){if($l===void 0){$l=window,vu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;pu=Da(e,"firstChild").get,hu=Da(e,"nextSibling").get,Ql(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ql(n)&&(n.__t=void 0)}}function Rr(t=""){return document.createTextNode(t)}function Pn(t){return pu.call(t)}function Rs(t){return hu.call(t)}function p(t,e){return Pn(t)}function Xe(t,e=!1){{var n=Pn(t);return n instanceof Comment&&n.data===""?Rs(n):n}}function _(t,e=1,n=!1){let a=t;for(;e--;)a=Rs(a);return a}function Jf(t){t.textContent=""}function mu(){return!1}function $f(t,e,n){return document.createElementNS(Qc,t,void 0)}let ec=!1;function ev(){ec||(ec=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Qo(t){var e=ot,n=wt;Kn(null),yr(null);try{return t()}finally{Kn(e),yr(n)}}function gu(t,e,n,a=n){t.addEventListener(e,()=>Qo(n));const i=t.__on_r;i?t.__on_r=()=>{i(),a(!0)}:t.__on_r=()=>a(!0),ev()}function tv(t){wt===null&&(ot===null&&ff(),df()),Hr&&uf()}function nv(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function jr(t,e,n){var a=wt;a!==null&&(a.f&In)!==0&&(t|=In);var i={ctx:Rn,deps:null,nodes:null,f:t|on|zn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Ya(i)}catch(f){throw kn(i),f}else e!==null&&rr(i);var o=i;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&Qa)===0&&(o=o.first,(t&Mr)!==0&&(t&Ga)!==0&&o!==null&&(o.f|=Ga)),o!==null&&(o.parent=a,a!==null&&nv(o,a),ot!==null&&(ot.f&sn)!==0&&(t&Sa)===0)){var c=ot;(c.effects??(c.effects=[])).push(o)}return i}function Xo(){return ot!==null&&!ar}function _u(t){const e=jr(Si,null,!1);return Ht(e,Jt),e.teardown=t,e}function ba(t){tv();var e=wt.f,n=!ot&&(e&or)!==0&&(e&Is)===0;if(n){var a=Rn;(a.e??(a.e=[])).push(t)}else return yu(t)}function yu(t){return jr(xs|rf,t,!1)}function rv(t){Gr.ensure();const e=jr(Sa|Qa,t,!0);return(n={})=>new Promise(a=>{n.outro?ma(e,()=>{kn(e),a(void 0)}):(kn(e),a(void 0))})}function bu(t){return jr(xs,t,!1)}function av(t){return jr(Ho|Qa,t,!0)}function Zo(t,e=0){return jr(Si|e,t,!0)}function $(t,e=[],n=[],a=[]){Kf(a,e,n,i=>{jr(Si,()=>t(...i.map(d)),!0)})}function Jo(t,e=0){var n=jr(Mr|e,t,!0);return n}function Bn(t){return jr(or|Qa,t,!0)}function wu(t){var e=t.teardown;if(e!==null){const n=Hr,a=ot;tc(!0),Kn(null);try{e.call(null)}finally{tc(n),Kn(a)}}}function $o(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Qo(()=>{i.abort(ia)});var a=n.next;(n.f&Sa)!==0?n.parent=null:kn(n,e),n=a}}function sv(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&or)===0&&kn(e),e=n}}function kn(t,e=!0){var n=!1;(e||(t.f&Hc)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(ku(t.nodes.start,t.nodes.end),n=!0),$o(t,e&&!n),Ss(t,0),Ht(t,Ir);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();wu(t);var i=t.parent;i!==null&&i.first!==null&&xu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function ku(t,e){for(;t!==null;){var n=t===e?null:Rs(t);t.remove(),t=n}}function xu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function ma(t,e,n=!0){var a=[];Su(t,a,!0);var i=()=>{n&&kn(t),e&&e()},o=a.length;if(o>0){var c=()=>--o||i();for(var f of a)f.out(c)}else i()}function Su(t,e,n){if((t.f&In)===0){t.f^=In;var a=t.nodes&&t.nodes.t;if(a!==null)for(const f of a)(f.is_global||n)&&e.push(f);for(var i=t.first;i!==null;){var o=i.next,c=(i.f&Ga)!==0||(i.f&or)!==0&&(t.f&Mr)!==0;Su(i,e,c?n:!1),i=o}}}function el(t){Eu(t,!0)}function Eu(t,e){if((t.f&In)!==0){t.f^=In,(t.f&Jt)===0&&(Ht(t,on),rr(t));for(var n=t.first;n!==null;){var a=n.next,i=(n.f&Ga)!==0||(n.f&or)!==0;Eu(n,i?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const c of o)(c.is_global||e)&&c.in()}}function Tu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var i=n===a?null:Rs(n);e.append(n),n=i}}let di=!1,Hr=!1;function tc(t){Hr=t}let ot=null,ar=!1;function Kn(t){ot=t}let wt=null;function yr(t){wt=t}let Fn=null;function Au(t){ot!==null&&(Fn===null?Fn=[t]:Fn.push(t))}let wn=null,An=0,Ln=null;function iv(t){Ln=t}let Cu=1,la=0,ga=la;function nc(t){ga=t}function Pu(){return++Cu}function Os(t){var e=t.f;if((e&on)!==0)return!0;if(e&sn&&(t.f&=~_a),(e&ir)!==0){for(var n=t.deps,a=n.length,i=0;i<a;i++){var o=n[i];if(Os(o)&&cu(o),o.wv>t.wv)return!0}(e&zn)!==0&&nn===null&&Ht(t,Jt)}return!1}function Iu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(Fn!==null&&Ua.call(Fn,t)))for(var i=0;i<a.length;i++){var o=a[i];(o.f&sn)!==0?Iu(o,e,!1):e===o&&(n?Ht(o,on):(o.f&Jt)!==0&&Ht(o,ir),rr(o))}}function Ru(t){var G;var e=wn,n=An,a=Ln,i=ot,o=Fn,c=Rn,f=ar,m=ga,h=t.f;wn=null,An=0,Ln=null,ot=(h&(or|Sa))===0?t:null,Fn=null,Wa(t.ctx),ar=!1,ga=++la,t.ac!==null&&(Qo(()=>{t.ac.abort(ia)}),t.ac=null);try{t.f|=bo;var b=t.fn,y=b();t.f|=Is;var w=t.deps,x=$e==null?void 0:$e.is_fork;if(wn!==null){var I;if(x||Ss(t,An),w!==null&&An>0)for(w.length=An+wn.length,I=0;I<wn.length;I++)w[An+I]=wn[I];else t.deps=w=wn;if(Xo()&&(t.f&zn)!==0)for(I=An;I<w.length;I++)((G=w[I]).reactions??(G.reactions=[])).push(t)}else!x&&w!==null&&An<w.length&&(Ss(t,An),w.length=An);if(Jc()&&Ln!==null&&!ar&&w!==null&&(t.f&(sn|ir|on))===0)for(I=0;I<Ln.length;I++)Iu(Ln[I],t);if(i!==null&&i!==t){if(la++,i.deps!==null)for(let A=0;A<n;A+=1)i.deps[A].rv=la;if(e!==null)for(const A of e)A.rv=la;Ln!==null&&(a===null?a=Ln:a.push(...Ln))}return(t.f&Kr)!==0&&(t.f^=Kr),y}catch(A){return eu(A)}finally{t.f^=bo,wn=e,An=n,Ln=a,ot=i,Fn=o,Wa(c),ar=f,ga=m}}function ov(t,e){let n=e.reactions;if(n!==null){var a=Xd.call(n,t);if(a!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[a]=n[i],n.pop())}}if(n===null&&(e.f&sn)!==0&&(wn===null||!Ua.call(wn,e))){var o=e;(o.f&zn)!==0&&(o.f^=zn,o.f&=~_a),Vo(o),Vf(o),Ss(o,0)}}function Ss(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)ov(t,n[a])}function Ya(t){var e=t.f;if((e&Ir)===0){Ht(t,Jt);var n=wt,a=di;wt=t,di=!0;try{(e&(Mr|Gc))!==0?sv(t):$o(t),wu(t);var i=Ru(t);t.teardown=typeof i=="function"?i:null,t.wv=Cu;var o;yo&&Rf&&(t.f&on)!==0&&t.deps}finally{di=a,wt=n}}}async function Ou(){await Promise.resolve(),jf()}function d(t){var e=t.f,n=(e&sn)!==0;if(ot!==null&&!ar){var a=wt!==null&&(wt.f&Ir)!==0;if(!a&&(Fn===null||!Ua.call(Fn,t))){var i=ot.deps;if((ot.f&bo)!==0)t.rv<la&&(t.rv=la,wn===null&&i!==null&&i[An]===t?An++:wn===null?wn=[t]:wn.push(t));else{(ot.deps??(ot.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[ot]:Ua.call(o,ot)||o.push(ot)}}}if(Hr&&Wr.has(t))return Wr.get(t);if(n){var c=t;if(Hr){var f=c.v;return((c.f&Jt)===0&&c.reactions!==null||ju(c))&&(f=Yo(c)),Wr.set(c,f),f}var m=(c.f&zn)===0&&!ar&&ot!==null&&(di||(ot.f&zn)!==0),h=(c.f&Is)===0;Os(c)&&(m&&(c.f|=zn),cu(c)),m&&!h&&(uu(c),Mu(c))}if(nn!=null&&nn.has(t))return nn.get(t);if((t.f&Kr)!==0)throw t.v;return t.v}function Mu(t){if(t.f|=zn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&sn)!==0&&(e.f&zn)===0&&(uu(e),Mu(e))}function ju(t){if(t.v===tn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Wr.has(e)||(e.f&sn)!==0&&ju(e))return!0;return!1}function Ms(t){var e=ar;try{return ar=!0,t()}finally{ar=e}}const lv=["touchstart","touchmove"];function cv(t){return lv.includes(t)}const Du=new Set,Co=new Set;function qt(t){for(var e=0;e<t.length;e++)Du.add(t[e]);for(var n of Co)n(t)}let rc=null;function ac(t){var A;var e=this,n=e.ownerDocument,a=t.type,i=((A=t.composedPath)==null?void 0:A.call(t))||[],o=i[0]||t.target;rc=t;var c=0,f=rc===t&&t.__root;if(f){var m=i.indexOf(f);if(m!==-1&&(e===document||e===window)){t.__root=e;return}var h=i.indexOf(e);if(h===-1)return;m<=h&&(c=m)}if(o=i[c]||t.target,o!==e){Zd(t,"currentTarget",{configurable:!0,get(){return o||n}});var b=ot,y=wt;Kn(null),yr(null);try{for(var w,x=[];o!==null;){var I=o.assignedSlot||o.parentNode||o.host||null;try{var G=o["__"+a];G!=null&&(!o.disabled||t.target===o)&&G.call(o,t)}catch(V){w?x.push(V):w=V}if(t.cancelBubble||I===e||I===null)break;o=I}if(w){for(let V of x)queueMicrotask(()=>{throw V});throw w}}finally{t.__root=e,delete t.currentTarget,Kn(b),yr(y)}}}var Bc,zc;const ao=(zc=(Bc=globalThis==null?void 0:globalThis.window)==null?void 0:Bc.trustedTypes)==null?void 0:zc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function uv(t){return(ao==null?void 0:ao.createHTML(t))??t}function tl(t,e=!1){var n=$f("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?uv(t):t,n.content}function wa(t,e){var n=wt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function P(t,e){var n=(e&Yc)!==0,a=(e&Af)!==0,i,o=!t.startsWith("<!>");return()=>{i===void 0&&(i=tl(o?t:"<!>"+t,!0),n||(i=Pn(i)));var c=a||vu?document.importNode(i,!0):i.cloneNode(!0);if(n){var f=Pn(c),m=c.lastChild;wa(f,m)}else wa(c,c);return c}}function dv(t,e,n="svg"){var a=!t.startsWith("<!>"),i=(e&Yc)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,c;return()=>{if(!c){var f=tl(o,!0),m=Pn(f);if(i)for(c=document.createDocumentFragment();Pn(m);)c.appendChild(Pn(m));else c=Pn(m)}var h=c.cloneNode(!0);if(i){var b=Pn(h),y=h.lastChild;wa(b,y)}else wa(h,h);return h}}function nl(t,e){return dv(t,e,"svg")}function Or(t=""){{var e=Rr(t+"");return wa(e,e),e}}function Un(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Rr();return t.append(e,n),wa(e,n),t}function E(t,e){t!==null&&t.before(e)}function U(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function fv(t,e){return vv(t,e)}const ni=new Map;function vv(t,{target:e,anchor:n,props:a={},events:i,context:o,intro:c=!0}){Zf();var f=new Set,m=y=>{for(var w=0;w<y.length;w++){var x=y[w];if(!f.has(x)){f.add(x);var I=cv(x);for(const V of[e,document]){var G=ni.get(V);G===void 0&&(G=new Map,ni.set(V,G));var A=G.get(x);A===void 0?(V.addEventListener(x,ac,{passive:I}),G.set(x,1)):G.set(x,A+1)}}}};m(xi(Du)),Co.add(m);var h=void 0,b=rv(()=>{var y=n??e.appendChild(Rr());return qf(y,{pending:()=>{}},w=>{yt({});var x=Rn;o&&(x.c=o),i&&(a.$$events=i),h=t(w,a)||{},bt()}),()=>{var G;for(var w of f)for(const A of[e,document]){var x=ni.get(A),I=x.get(w);--I==0?(A.removeEventListener(w,ac),x.delete(w),x.size===0&&ni.delete(A)):x.set(w,I)}Co.delete(m),y!==n&&((G=y.parentNode)==null||G.removeChild(y))}});return pv.set(h,b),h}let pv=new WeakMap;var $n,gr,Cn,pa,Cs,Ps,ki;class hv{constructor(e,n=!0){st(this,"anchor");it(this,$n,new Map);it(this,gr,new Map);it(this,Cn,new Map);it(this,pa,new Set);it(this,Cs,!0);it(this,Ps,()=>{var e=$e;if(me(this,$n).has(e)){var n=me(this,$n).get(e),a=me(this,gr).get(n);if(a)el(a),me(this,pa).delete(n);else{var i=me(this,Cn).get(n);i&&(me(this,gr).set(n,i.effect),me(this,Cn).delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),a=i.effect)}for(const[o,c]of me(this,$n)){if(me(this,$n).delete(o),o===e)break;const f=me(this,Cn).get(c);f&&(kn(f.effect),me(this,Cn).delete(c))}for(const[o,c]of me(this,gr)){if(o===n||me(this,pa).has(o))continue;const f=()=>{if(Array.from(me(this,$n).values()).includes(o)){var h=document.createDocumentFragment();Tu(c,h),h.append(Rr()),me(this,Cn).set(o,{effect:c,fragment:h})}else kn(c);me(this,pa).delete(o),me(this,gr).delete(o)};me(this,Cs)||!a?(me(this,pa).add(o),ma(c,f,!1)):f()}}});it(this,ki,e=>{me(this,$n).delete(e);const n=Array.from(me(this,$n).values());for(const[a,i]of me(this,Cn))n.includes(a)||(kn(i.effect),me(this,Cn).delete(a))});this.anchor=e,nt(this,Cs,n)}ensure(e,n){var a=$e,i=mu();if(n&&!me(this,gr).has(e)&&!me(this,Cn).has(e))if(i){var o=document.createDocumentFragment(),c=Rr();o.append(c),me(this,Cn).set(e,{effect:Bn(()=>n(c)),fragment:o})}else me(this,gr).set(e,Bn(()=>n(this.anchor)));if(me(this,$n).set(a,e),i){for(const[f,m]of me(this,gr))f===e?a.unskip_effect(m):a.skip_effect(m);for(const[f,m]of me(this,Cn))f===e?a.unskip_effect(m.effect):a.skip_effect(m.effect);a.oncommit(me(this,Ps)),a.ondiscard(me(this,ki))}else me(this,Ps).call(this)}}$n=new WeakMap,gr=new WeakMap,Cn=new WeakMap,pa=new WeakMap,Cs=new WeakMap,Ps=new WeakMap,ki=new WeakMap;function re(t,e,n=!1){var a=new hv(t),i=n?Ga:0;function o(c,f){a.ensure(c,f)}Jo(()=>{var c=!1;e((f,m=0)=>{c=!0,o(m,f)}),c||o(!1,null)},i)}function Ft(t,e){return e}function mv(t,e,n){for(var a=[],i=e.length,o,c=e.length,f=0;f<i;f++){let y=e[f];ma(y,()=>{if(o){if(o.pending.delete(y),o.done.add(y),o.pending.size===0){var w=t.outrogroups;Po(xi(o.done)),w.delete(o),w.size===0&&(t.outrogroups=null)}}else c-=1},!1)}if(c===0){var m=a.length===0&&n!==null;if(m){var h=n,b=h.parentNode;Jf(b),b.append(h),t.items.clear()}Po(e,!m)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Po(t,e=!0){for(var n=0;n<t.length;n++)kn(t[n],e)}var sc;function kt(t,e,n,a,i,o=null){var c=t,f=new Map,m=(e&Vc)!==0;if(m){var h=t;c=h.appendChild(Rr())}var b=null,y=lu(()=>{var V=n();return Wo(V)?V:V==null?[]:xi(V)}),w,x=!0;function I(){A.fallback=b,gv(A,w,c,e,a),b!==null&&(w.length===0?(b.f&Pr)===0?el(b):(b.f^=Pr,hs(b,null,c)):ma(b,()=>{b=null}))}var G=Jo(()=>{w=d(y);for(var V=w.length,de=new Set,Z=$e,R=mu(),X=0;X<V;X+=1){var ce=w[X],D=a(ce,X),pe=x?null:f.get(D);pe?(pe.v&&Va(pe.v,ce),pe.i&&Va(pe.i,X),R&&Z.unskip_effect(pe.e)):(pe=_v(f,x?c:sc??(sc=Rr()),ce,D,X,i,e,n),x||(pe.e.f|=Pr),f.set(D,pe)),de.add(D)}if(V===0&&o&&!b&&(x?b=Bn(()=>o(c)):(b=Bn(()=>o(sc??(sc=Rr()))),b.f|=Pr)),V>de.size&&cf(),!x)if(R){for(const[ke,ue]of f)de.has(ke)||Z.skip_effect(ue.e);Z.oncommit(I),Z.ondiscard(()=>{})}else I();d(y)}),A={effect:G,items:f,outrogroups:null,fallback:b};x=!1}function os(t){for(;t!==null&&(t.f&or)===0;)t=t.next;return t}function gv(t,e,n,a,i){var ue,ge,ae,_e,fe,ie,he,be,oe;var o=(a&wf)!==0,c=e.length,f=t.items,m=os(t.effect.first),h,b=null,y,w=[],x=[],I,G,A,V;if(o)for(V=0;V<c;V+=1)I=e[V],G=i(I,V),A=f.get(G).e,(A.f&Pr)===0&&((ge=(ue=A.nodes)==null?void 0:ue.a)==null||ge.measure(),(y??(y=new Set)).add(A));for(V=0;V<c;V+=1){if(I=e[V],G=i(I,V),A=f.get(G).e,t.outrogroups!==null)for(const ve of t.outrogroups)ve.pending.delete(A),ve.done.delete(A);if((A.f&Pr)!==0)if(A.f^=Pr,A===m)hs(A,null,n);else{var de=b?b.next:m;A===t.effect.last&&(t.effect.last=A.prev),A.prev&&(A.prev.next=A.next),A.next&&(A.next.prev=A.prev),qr(t,b,A),qr(t,A,de),hs(A,de,n),b=A,w=[],x=[],m=os(b.next);continue}if((A.f&In)!==0&&(el(A),o&&((_e=(ae=A.nodes)==null?void 0:ae.a)==null||_e.unfix(),(y??(y=new Set)).delete(A))),A!==m){if(h!==void 0&&h.has(A)){if(w.length<x.length){var Z=x[0],R;b=Z.prev;var X=w[0],ce=w[w.length-1];for(R=0;R<w.length;R+=1)hs(w[R],Z,n);for(R=0;R<x.length;R+=1)h.delete(x[R]);qr(t,X.prev,ce.next),qr(t,b,X),qr(t,ce,Z),m=Z,b=ce,V-=1,w=[],x=[]}else h.delete(A),hs(A,m,n),qr(t,A.prev,A.next),qr(t,A,b===null?t.effect.first:b.next),qr(t,b,A),b=A;continue}for(w=[],x=[];m!==null&&m!==A;)(h??(h=new Set)).add(m),x.push(m),m=os(m.next);if(m===null)continue}(A.f&Pr)===0&&w.push(A),b=A,m=os(A.next)}if(t.outrogroups!==null){for(const ve of t.outrogroups)ve.pending.size===0&&(Po(xi(ve.done)),(fe=t.outrogroups)==null||fe.delete(ve));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||h!==void 0){var D=[];if(h!==void 0)for(A of h)(A.f&In)===0&&D.push(A);for(;m!==null;)(m.f&In)===0&&m!==t.fallback&&D.push(m),m=os(m.next);var pe=D.length;if(pe>0){var ke=(a&Vc)!==0&&c===0?n:null;if(o){for(V=0;V<pe;V+=1)(he=(ie=D[V].nodes)==null?void 0:ie.a)==null||he.measure();for(V=0;V<pe;V+=1)(oe=(be=D[V].nodes)==null?void 0:be.a)==null||oe.fix()}mv(t,D,ke)}}o&&Ur(()=>{var ve,se;if(y!==void 0)for(A of y)(se=(ve=A.nodes)==null?void 0:ve.a)==null||se.apply()})}function _v(t,e,n,a,i,o,c,f){var m=(c&yf)!==0?(c&kf)===0?Yf(n,!1,!1):ya(n):null,h=(c&bf)!==0?ya(i):null;return{v:m,i:h,e:Bn(()=>(o(e,m??n,h??i,f),()=>{t.delete(a)}))}}function hs(t,e,n){if(t.nodes)for(var a=t.nodes.start,i=t.nodes.end,o=e&&(e.f&Pr)===0?e.nodes.start:n;a!==null;){var c=Rs(a);if(o.before(a),a===i)return;a=c}}function qr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function yv(t,e,n=!1,a=!1,i=!1){var o=t,c="";$(()=>{var f=wt;if(c!==(c=e()??"")&&(f.nodes!==null&&(ku(f.nodes.start,f.nodes.end),f.nodes=null),c!=="")){var m=c+"";n?m=`<svg>${m}</svg>`:a&&(m=`<math>${m}</math>`);var h=tl(m);if((n||a)&&(h=Pn(h)),wa(Pn(h),h.lastChild),n||a)for(;Pn(h);)o.before(Pn(h));else o.before(h)}})}const ic=[...` 	
\r\fÂ \v\uFEFF`];function bv(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var i in n)if(n[i])a=a?a+" "+i:i;else if(a.length)for(var o=i.length,c=0;(c=a.indexOf(i,c))>=0;){var f=c+o;(c===0||ic.includes(a[c-1]))&&(f===a.length||ic.includes(a[f]))?a=(c===0?"":a.substring(0,c))+a.substring(f+1):c=f}}return a===""?null:a}function oc(t,e=!1){var n=e?" !important;":";",a="";for(var i in t){var o=t[i];o!=null&&o!==""&&(a+=" "+i+": "+o+n)}return a}function so(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function wv(t,e){if(e){var n="",a,i;if(Array.isArray(e)?(a=e[0],i=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,c=0,f=!1,m=[];a&&m.push(...Object.keys(a).map(so)),i&&m.push(...Object.keys(i).map(so));var h=0,b=-1;const G=t.length;for(var y=0;y<G;y++){var w=t[y];if(f?w==="/"&&t[y-1]==="*"&&(f=!1):o?o===w&&(o=!1):w==="/"&&t[y+1]==="*"?f=!0:w==='"'||w==="'"?o=w:w==="("?c++:w===")"&&c--,!f&&o===!1&&c===0){if(w===":"&&b===-1)b=y;else if(w===";"||y===G-1){if(b!==-1){var x=so(t.substring(h,b).trim());if(!m.includes(x)){w!==";"&&y++;var I=t.substring(h,y).trim();n+=" "+I+";"}}h=y+1,b=-1}}}}return a&&(n+=oc(a)),i&&(n+=oc(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Dt(t,e,n,a,i,o){var c=t.__className;if(c!==n||c===void 0){var f=bv(n,a,o);f==null?t.removeAttribute("class"):e?t.className=f:t.setAttribute("class",f),t.__className=n}else if(o&&i!==o)for(var m in o){var h=!!o[m];(i==null||h!==!!i[m])&&t.classList.toggle(m,h)}return o}function io(t,e={},n,a){for(var i in n){var o=n[i];e[i]!==o&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,o,a))}}function rn(t,e,n,a){var i=t.__style;if(i!==e){var o=wv(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(io(t,n==null?void 0:n[0],a[0]),io(t,n==null?void 0:n[1],a[1],"important")):io(t,n,a));return a}function Lu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Wo(e))return Cf();for(var a of t.options)a.selected=e.includes(bs(a));return}for(a of t.options){var i=bs(a);if(Xf(i,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function kv(t){var e=new MutationObserver(()=>{Lu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),_u(()=>{e.disconnect()})}function Ai(t,e,n=e){var a=new WeakSet,i=!0;gu(t,"change",o=>{var c=o?"[selected]":":checked",f;if(t.multiple)f=[].map.call(t.querySelectorAll(c),bs);else{var m=t.querySelector(c)??t.querySelector("option:not([disabled])");f=m&&bs(m)}n(f),$e!==null&&a.add($e)}),bu(()=>{var o=e();if(t===document.activeElement){var c=hi??$e;if(a.has(c))return}if(Lu(t,o,i),i&&o===void 0){var f=t.querySelector(":checked");f!==null&&(o=bs(f),n(o))}t.__value=o,i=!1}),kv(t)}function bs(t){return"__value"in t?t.__value:t.value}const xv=Symbol("is custom element"),Sv=Symbol("is html");function Nu(t,e,n,a){var i=Ev(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[sf]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Tv(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Ev(t){return t.__attributes??(t.__attributes={[xv]:t.nodeName.includes("-"),[Sv]:t.namespaceURI===Qc})}var lc=new Map;function Tv(t){var e=t.getAttribute("is")||t.nodeName,n=lc.get(e);if(n)return n;lc.set(e,n=[]);for(var a,i=t,o=Element.prototype;o!==i;){a=Jd(i);for(var c in a)a[c].set&&n.push(c);i=Kc(i)}return n}function er(t,e,n=e){var a=new WeakSet;gu(t,"input",async i=>{var o=i?t.defaultValue:t.value;if(o=oo(t)?lo(o):o,n(o),$e!==null&&a.add($e),await Ou(),o!==(o=e())){var c=t.selectionStart,f=t.selectionEnd,m=t.value.length;if(t.value=o??"",f!==null){var h=t.value.length;c===f&&f===m&&h>m?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=c,t.selectionEnd=Math.min(f,h))}}}),Ms(e)==null&&t.value&&(n(oo(t)?lo(t.value):t.value),$e!==null&&a.add($e)),Zo(()=>{var i=e();if(t===document.activeElement){var o=hi??$e;if(a.has(o))return}oo(t)&&i===lo(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function oo(t){var e=t.type;return e==="number"||e==="range"}function lo(t){return t===""?null:+t}function cc(t,e){return t===e||(t==null?void 0:t[ha])===e}function qu(t={},e,n,a){return bu(()=>{var i,o;return Zo(()=>{i=o,o=[],Ms(()=>{t!==n(...o)&&(e(t,...o),i&&cc(n(...i),t)&&e(null,...i))})}),()=>{Ur(()=>{o&&cc(n(...o),t)&&e(null,...o)})}}),t}let ri=!1;function Av(t){var e=ri;try{return ri=!1,[t(),ri]}finally{ri=e}}function Le(t,e,n,a){var de;var i=(n&Ef)!==0,o=(n&Tf)!==0,c=a,f=!0,m=()=>(f&&(f=!1,c=o?Ms(a):a),c),h;if(i){var b=ha in t||af in t;h=((de=Da(t,e))==null?void 0:de.set)??(b&&e in t?Z=>t[e]=Z:void 0)}var y,w=!1;i?[y,w]=Av(()=>t[e]):y=t[e],y===void 0&&a!==void 0&&(y=m(),h&&(pf(),h(y)));var x;if(x=()=>{var Z=t[e];return Z===void 0?m():(f=!0,Z)},(n&Sf)===0)return x;if(h){var I=t.$$legacy;return(function(Z,R){return arguments.length>0?((!R||I||w)&&h(R?x():Z),Z):x()})}var G=!1,A=((n&xf)!==0?Ti:lu)(()=>(G=!1,x()));i&&d(A);var V=wt;return(function(Z,R){if(arguments.length>0){const X=R?d(A):i?Nt(Z):Z;return C(A,X),G=!0,c!==void 0&&(c=X),Z}return Hr&&G||(V.f&Ir)!==0?A.v:d(A)})}function ln(t){Rn===null&&of(),ba(()=>{const e=Ms(t);if(typeof e=="function")return e})}const Cv="5";var Fc;typeof window<"u"&&((Fc=window.__svelte??(window.__svelte={})).v??(Fc.v=new Set)).add(Cv);const _r=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function rl(t){return _r.find(e=>e.id===t)}const Pv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:_r,getModelInfo:rl},Symbol.toStringTag,{value:"Module"})),sr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Bu(){return sr.filter(t=>t.recommended)}function al(t){return sr.find(e=>e.name===t||e.name.startsWith(t+":"))}const Iv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:sr,getOllamaModelInfo:al,getRecommendedOllamaModels:Bu},Symbol.toStringTag,{value:"Module"}));let yn=null,Cr="idle",fi=null,ra=new Set;function ai(){return yn||(yn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),yn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Cr="loading"),e.status==="ready"&&(Cr="ready"),e.status==="start"&&(Cr="generating"),(e.status==="complete"||e.status==="error")&&(Cr=fi?"ready":"idle");for(const n of ra)try{n(e)}catch{}})),yn}function co(){return{check(){ai().postMessage({type:"check"})},loadModel(t){fi=t,Cr="loading",ai().postMessage({type:"load",modelId:t})},generate(t,e){ai().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,i)=>{let o="",c=null,f=0,m=0;const h=y=>{switch(y.status){case"start":m=y.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=y.output,c=y.tps??c,f=y.numTokens??f,n)try{n({tps:c,numTokens:f,text:o})}catch{}break;case"complete":b(),a({text:o,tps:c,numTokens:f,inputTokens:m});break;case"error":b(),i(new Error(y.data));break}},b=()=>{ra.delete(h)};ra.add(h),ai().postMessage({type:"generate",data:t,options:e})})},interrupt(){yn==null||yn.postMessage({type:"interrupt"})},reset(){yn==null||yn.postMessage({type:"reset"})},onMessage(t){return ra.add(t),()=>ra.delete(t)},offMessage(t){ra.delete(t)},get status(){return Cr},get isReady(){return Cr==="ready"},get isGenerating(){return Cr==="generating"},get modelId(){return fi},terminate(){yn==null||yn.terminate(),yn=null,Cr="idle",fi=null,ra.clear()}}}const uc="http://localhost:11434";function js(){try{return localStorage.getItem("ollamaUrl")||uc}catch{return uc}}function Rv(t){try{localStorage.setItem("ollamaUrl",t)}catch{}}async function Io(t=js()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function Ov(t=js()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function Mv(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:i}={},o=()=>{},c=js()){var I;const f={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};i!==void 0?f.keep_alive=i:f.keep_alive="10m";const m=new AbortController,h=setTimeout(()=>m.abort(),3e5),b=await fetch(`${c}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f),signal:m.signal});if(clearTimeout(h),!b.ok){const G=await b.text();throw new Error(`Ollama API error: ${G}`)}const y=b.body.getReader(),w=new TextDecoder;let x="";try{for(;;){const{done:G,value:A}=await y.read();if(G)break;const de=w.decode(A).split(`
`).filter(Boolean);for(const Z of de)try{const R=JSON.parse(Z);if((I=R.message)!=null&&I.content&&(x+=R.message.content,o({content:R.message.content,done:!1,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration})),R.done){o({content:"",done:!0,total_duration:R.total_duration,eval_count:R.eval_count,eval_duration:R.eval_duration});break}}catch{}}}finally{y.releaseLock()}return x}let Tn="idle",Ma=null,aa=new Set;function Xn(t){for(const e of aa)try{e(t)}catch{}}function jv(){return{async check(){Tn="loading",Xn({status:"loading",data:"Testing Ollama connection..."});const t=await Io();t.connected?(Tn="idle",Xn({status:"ready",data:{type:"ollama",version:t.version,url:js()}})):(Tn="idle",Xn({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ma=t,Tn="loading",Xn({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Io();if(!e.connected){Tn="idle",Ma=null,Xn({status:"error",data:`Ollama not available: ${e.error}`});return}Tn="ready",Xn({status:"ready"})},async generate(t,e={}){if(!Ma){Xn({status:"error",data:"No Ollama model selected"});return}Tn="generating",Xn({status:"start",inputTokens:0});let n=0,a=performance.now();try{await Mv(Ma,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},i=>{if(i.content){n++;const o=performance.now()-a,c=o>0?n/o*1e3:0;Xn({status:"update",output:i.content,tps:Math.round(c*10)/10,numTokens:n})}i.done&&(Tn="ready",Xn({status:"complete",tps:i.eval_duration?Math.round(i.eval_count/(i.eval_duration/1e9)*10)/10:null,numTokens:i.eval_count||n}))})}catch(i){Tn="ready",Xn({status:"error",data:i.message})}},generateFull(t,e,n){return new Promise((a,i)=>{let o="",c=null,f=0,m=0;const h=y=>{switch(y.status){case"start":m=y.inputTokens||0;break;case"update":if(o+=y.output,c=y.tps??c,f=y.numTokens??f,n)try{n({tps:c,numTokens:f,text:o})}catch{}break;case"complete":b(),a({text:o,tps:c,numTokens:f,inputTokens:m});break;case"error":b(),i(new Error(y.data));break}},b=()=>{aa.delete(h)};aa.add(h),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return aa.add(t),()=>aa.delete(t)},offMessage(t){aa.delete(t)},get status(){return Tn},get isReady(){return Tn==="ready"},get isGenerating(){return Tn==="generating"},get modelId(){return Ma},get backend(){return"ollama"},terminate(){Tn="idle",Ma=null,aa.clear()}}}let na=null,Je=null,uo=new Set;function Dv(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function zu(){return{loadModel(t){const e=Dv(t);if(na!==e){Je&&Je.terminate(),na=e,Je=e==="webgpu"?co():jv();for(const n of uo)Je.onMessage(n)}Je.loadModel(t)},check(){Je||(Je=co(),na="webgpu"),Je.check()},generate(t,e){if(!Je)throw new Error("No engine loaded. Call loadModel() first.");return Je.generate(t,e)},generateFull(t,e,n){return Je?Je.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Je==null||Je.interrupt()},reset(){Je==null||Je.reset()},onMessage(t){return Je||(Je=co(),na="webgpu"),uo.add(t),Je.onMessage(t)},offMessage(t){uo.delete(t),Je==null||Je.offMessage(t)},get status(){return(Je==null?void 0:Je.status)||"idle"},get isReady(){return(Je==null?void 0:Je.isReady)||!1},get isGenerating(){return(Je==null?void 0:Je.isGenerating)||!1},get modelId(){return(Je==null?void 0:Je.modelId)||null},get backend(){return na},getModelInfo(){const t=this.modelId;return t?na==="webgpu"?rl(t):al(t):null},terminate(){Je==null||Je.terminate(),Je=null,na=null}}}var Lv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vi={exports:{}},qv=vi.exports,dc;function Bv(){return dc||(dc=1,(function(t,e){((n,a)=>{t.exports=a()})(qv,function(){var n=function(r,s){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,u){l.__proto__=u}:function(l,u){for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&(l[v]=u[v])}))(r,s)},a=function(){return(a=Object.assign||function(r){for(var s,l=1,u=arguments.length;l<u;l++)for(var v in s=arguments[l])Object.prototype.hasOwnProperty.call(s,v)&&(r[v]=s[v]);return r}).apply(this,arguments)};function i(r,s,l){for(var u,v=0,g=s.length;v<g;v++)!u&&v in s||((u=u||Array.prototype.slice.call(s,0,v))[v]=s[v]);return r.concat(u||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Lv,c=Object.keys,f=Array.isArray;function m(r,s){return typeof s=="object"&&c(s).forEach(function(l){r[l]=s[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var h=Object.getPrototypeOf,b={}.hasOwnProperty;function y(r,s){return b.call(r,s)}function w(r,s){typeof s=="function"&&(s=s(h(r))),(typeof Reflect>"u"?c:Reflect.ownKeys)(s).forEach(function(l){I(r,l,s[l])})}var x=Object.defineProperty;function I(r,s,l,u){x(r,s,m(l&&y(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},u))}function G(r){return{from:function(s){return r.prototype=Object.create(s.prototype),I(r.prototype,"constructor",r),{extend:w.bind(null,r.prototype)}}}}var A=Object.getOwnPropertyDescriptor,V=[].slice;function de(r,s,l){return V.call(r,s,l)}function Z(r,s){return s(r)}function R(r){if(!r)throw new Error("Assertion Failed")}function X(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function ce(r,s){if(typeof s=="string"&&y(r,s))return r[s];if(!s)return r;if(typeof s!="string"){for(var l=[],u=0,v=s.length;u<v;++u){var g=ce(r,s[u]);l.push(g)}return l}var k,S=s.indexOf(".");return S===-1||(k=r[s.substr(0,S)])==null?void 0:ce(k,s.substr(S+1))}function D(r,s,l){if(r&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof s!="string"&&"length"in s){R(typeof l!="string"&&"length"in l);for(var u=0,v=s.length;u<v;++u)D(r,s[u],l[u])}else{var g,k,S=s.indexOf(".");S!==-1?(g=s.substr(0,S),(S=s.substr(S+1))===""?l===void 0?f(r)&&!isNaN(parseInt(g))?r.splice(g,1):delete r[g]:r[g]=l:D(k=(k=r[g])&&y(r,g)?k:r[g]={},S,l)):l===void 0?f(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=l}}function pe(r){var s,l={};for(s in r)y(r,s)&&(l[s]=r[s]);return l}var ke=[].concat;function ue(r){return ke.apply([],r)}var te="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ue([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(s){return s+r+"Array"})}))).filter(function(r){return o[r]}),ge=new Set(te.map(function(r){return o[r]})),ae=null;function _e(r){return ae=new WeakMap,r=(function s(l){if(!l||typeof l!="object")return l;var u=ae.get(l);if(u)return u;if(f(l)){u=[],ae.set(l,u);for(var v=0,g=l.length;v<g;++v)u.push(s(l[v]))}else if(ge.has(l.constructor))u=l;else{var k,S=h(l);for(k in u=S===Object.prototype?{}:Object.create(S),ae.set(l,u),l)y(l,k)&&(u[k]=s(l[k]))}return u})(r),ae=null,r}var fe={}.toString;function ie(r){return fe.call(r).slice(8,-1)}var he=typeof Symbol<"u"?Symbol.iterator:"@@iterator",be=typeof he=="symbol"?function(r){var s;return r!=null&&(s=r[he])&&s.apply(r)}:function(){return null};function oe(r,s){s=r.indexOf(s),0<=s&&r.splice(s,1)}var ve={};function se(r){var s,l,u,v;if(arguments.length===1){if(f(r))return r.slice();if(this===ve&&typeof r=="string")return[r];if(v=be(r))for(l=[];!(u=v.next()).done;)l.push(u.value);else{if(r==null)return[r];if(typeof(s=r.length)!="number")return[r];for(l=new Array(s);s--;)l[s]=r[s]}}else for(s=arguments.length,l=new Array(s);s--;)l[s]=arguments[s];return l}var le=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},te=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ye=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(te),L={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function T(r,s){this.name=r,this.message=s}function F(r,s){return r+". Errors: "+Object.keys(s).map(function(l){return s[l].toString()}).filter(function(l,u,v){return v.indexOf(l)===u}).join(`
`)}function H(r,s,l,u){this.failures=s,this.failedKeys=u,this.successCount=l,this.message=F(r,s)}function ee(r,s){this.name="BulkError",this.failures=Object.keys(s).map(function(l){return s[l]}),this.failuresByPos=s,this.message=F(r,this.failures)}G(T).from(Error).extend({toString:function(){return this.name+": "+this.message}}),G(H).from(T),G(ee).from(T);var Te=Ye.reduce(function(r,s){return r[s]=s+"Error",r},{}),Re=T,M=Ye.reduce(function(r,s){var l=s+"Error";function u(v,g){this.name=l,v?typeof v=="string"?(this.message="".concat(v).concat(g?`
 `+g:""),this.inner=g||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=L[s]||l,this.inner=null)}return G(u).from(Re),r[s]=u,r},{}),we=(M.Syntax=SyntaxError,M.Type=TypeError,M.Range=RangeError,te.reduce(function(r,s){return r[s+"Error"]=M[s],r},{}));te=Ye.reduce(function(r,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(r[s+"Error"]=M[s]),r},{});function Ae(){}function qe(r){return r}function Qe(r,s){return r==null||r===qe?s:function(l){return s(r(l))}}function et(r,s){return function(){r.apply(this,arguments),s.apply(this,arguments)}}function xt(r,s){return r===Ae?s:function(){var l=r.apply(this,arguments),u=(l!==void 0&&(arguments[0]=l),this.onsuccess),v=this.onerror,g=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return u&&(this.onsuccess=this.onsuccess?et(u,this.onsuccess):u),v&&(this.onerror=this.onerror?et(v,this.onerror):v),g!==void 0?g:l}}function Tt(r,s){return r===Ae?s:function(){r.apply(this,arguments);var l=this.onsuccess,u=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?et(l,this.onsuccess):l),u&&(this.onerror=this.onerror?et(u,this.onerror):u)}}function At(r,s){return r===Ae?s:function(v){var u=r.apply(this,arguments),v=(m(v,u),this.onsuccess),g=this.onerror,k=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?et(v,this.onsuccess):v),g&&(this.onerror=this.onerror?et(g,this.onerror):g),u===void 0?k===void 0?void 0:k:m(u,k)}}function Ze(r,s){return r===Ae?s:function(){return s.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Be(r,s){return r===Ae?s:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var u=this,v=arguments.length,g=new Array(v);v--;)g[v]=arguments[v];return l.then(function(){return s.apply(u,g)})}return s.apply(this,arguments)}}te.ModifyError=H,te.DexieError=T,te.BulkError=ee;var Ge=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pt(r){Ge=r}var It={},ut=100,Ve=typeof Promise>"u"?[]:(Ye=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Ve=crypto.subtle.digest("SHA-512",new Uint8Array([0])),h(Ve),Ye]:[Ye,h(Ye),Ye]),Ye=Ve[0],Ra=Ve[1],Ra=Ra&&Ra.then,We=Ye&&Ye.constructor,lt=!!Ve[2],Rt=function(r,s){Ot.push([r,s]),en&&(queueMicrotask(Hn),en=!1)},Yt=!0,en=!0,Lt=[],St=[],Qt=qe,at={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Ae,pgp:!1,env:{},finalize:Ae},Oe=at,Ot=[],Kt=0,xn=[];function Ie(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=Oe;if(typeof r!="function"){if(r!==It)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Wn(this,this._value)}else this._state=null,this._value=null,++s.ref,(function l(u,v){try{v(function(g){if(u._state===null){if(g===u)throw new TypeError("A promise cannot be resolved with itself.");var k=u._lib&&lr();g&&typeof g.then=="function"?l(u,function(S,q){g instanceof Ie?g._then(S,q):g.then(S,q)}):(u._state=!0,u._value=g,Aa(u)),k&&Sn()}},Wn.bind(null,u))}catch(g){Wn(u,g)}})(this,r)}var Xt={get:function(){var r=Oe,s=Qr;function l(u,v){var g=this,k=!r.global&&(r!==Oe||s!==Qr),S=k&&!Yn(),q=new Ie(function(Q,B){wr(g,new Ta(j(u,r,k,S),j(v,r,k,S),Q,B,r))});return this._consoleTask&&(q._consoleTask=this._consoleTask),q}return l.prototype=It,l},set:function(r){I(this,"then",r&&r.prototype===It?Xt:{get:function(){return r},set:Xt.set})}};function Ta(r,s,l,u,v){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof s=="function"?s:null,this.resolve=l,this.reject=u,this.psd=v}function Wn(r,s){var l,u;St.push(s),r._state===null&&(l=r._lib&&lr(),s=Qt(s),r._state=!1,r._value=s,u=r,Lt.some(function(v){return v._value===u._value})||Lt.push(u),Aa(r),l)&&Sn()}function Aa(r){var s=r._listeners;r._listeners=[];for(var l=0,u=s.length;l<u;++l)wr(r,s[l]);var v=r._PSD;--v.ref||v.finalize(),Kt===0&&(++Kt,Rt(function(){--Kt==0&&cr()},[]))}function wr(r,s){if(r._state===null)r._listeners.push(s);else{var l=r._state?s.onFulfilled:s.onRejected;if(l===null)return(r._state?s.resolve:s.reject)(r._value);++s.psd.ref,++Kt,Rt(Mt,[l,r,s])}}function Mt(r,s,l){try{var u,v=s._value;!s._state&&St.length&&(St=[]),u=Ge&&s._consoleTask?s._consoleTask.run(function(){return r(v)}):r(v),s._state||St.indexOf(v)!==-1||(g=>{for(var k=Lt.length;k;)if(Lt[--k]._value===g._value)return Lt.splice(k,1)})(s),l.resolve(u)}catch(g){l.reject(g)}finally{--Kt==0&&cr(),--l.psd.ref||l.psd.finalize()}}function Hn(){Ke(at,function(){lr()&&Sn()})}function lr(){var r=Yt;return en=Yt=!1,r}function Sn(){var r,s,l;do for(;0<Ot.length;)for(r=Ot,Ot=[],l=r.length,s=0;s<l;++s){var u=r[s];u[0].apply(null,u[1])}while(0<Ot.length);en=Yt=!0}function cr(){for(var r=Lt,s=(Lt=[],r.forEach(function(u){u._PSD.onunhandled.call(null,u._value,u)}),xn.slice(0)),l=s.length;l;)s[--l]()}function kr(r){return new Ie(It,!1,r)}function Et(r,s){var l=Oe;return function(){var u=lr(),v=Oe;try{return Qn(l,!0),r.apply(this,arguments)}catch(g){s&&s(g)}finally{Qn(v,!1),u&&Sn()}}}w(Ie.prototype,{then:Xt,_then:function(r,s){wr(this,new Ta(null,null,r,s,Oe))},catch:function(r){var s,l;return arguments.length===1?this.then(null,r):(s=r,l=arguments[1],typeof s=="function"?this.then(null,function(u){return(u instanceof s?l:kr)(u)}):this.then(null,function(u){return(u&&u.name===s?l:kr)(u)}))},finally:function(r){return this.then(function(s){return Ie.resolve(r()).then(function(){return s})},function(s){return Ie.resolve(r()).then(function(){return kr(s)})})},timeout:function(r,s){var l=this;return r<1/0?new Ie(function(u,v){var g=setTimeout(function(){return v(new M.Timeout(s))},r);l.then(u,v).finally(clearTimeout.bind(null,g))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),at.env=Bs(),w(Ie,{all:function(){var r=se.apply(null,arguments).map(Xr);return new Ie(function(s,l){r.length===0&&s([]);var u=r.length;r.forEach(function(v,g){return Ie.resolve(v).then(function(k){r[g]=k,--u||s(r)},l)})})},resolve:function(r){return r instanceof Ie?r:r&&typeof r.then=="function"?new Ie(function(s,l){r.then(s,l)}):new Ie(It,!0,r)},reject:kr,race:function(){var r=se.apply(null,arguments).map(Xr);return new Ie(function(s,l){r.map(function(u){return Ie.resolve(u).then(s,l)})})},PSD:{get:function(){return Oe},set:function(r){return Oe=r}},totalEchoes:{get:function(){return Qr}},newPSD:Vn,usePSD:Ke,scheduler:{get:function(){return Rt},set:function(r){Rt=r}},rejectionMapper:{get:function(){return Qt},set:function(r){Qt=r}},follow:function(r,s){return new Ie(function(l,u){return Vn(function(v,g){var k=Oe;k.unhandleds=[],k.onunhandled=g,k.finalize=et(function(){var S,q=this;S=function(){q.unhandleds.length===0?v():g(q.unhandleds[0])},xn.push(function Q(){S(),xn.splice(xn.indexOf(Q),1)}),++Kt,Rt(function(){--Kt==0&&cr()},[])},k.finalize),r()},s,l,u)})}}),We&&(We.allSettled&&I(Ie,"allSettled",function(){var r=se.apply(null,arguments).map(Xr);return new Ie(function(s){r.length===0&&s([]);var l=r.length,u=new Array(l);r.forEach(function(v,g){return Ie.resolve(v).then(function(k){return u[g]={status:"fulfilled",value:k}},function(k){return u[g]={status:"rejected",reason:k}}).then(function(){return--l||s(u)})})})}),We.any&&typeof AggregateError<"u"&&I(Ie,"any",function(){var r=se.apply(null,arguments).map(Xr);return new Ie(function(s,l){r.length===0&&l(new AggregateError([]));var u=r.length,v=new Array(u);r.forEach(function(g,k){return Ie.resolve(g).then(function(S){return s(S)},function(S){v[k]=S,--u||l(new AggregateError(v))})})})}),We.withResolvers)&&(Ie.withResolvers=We.withResolvers);var Vt={awaits:0,echoes:0,id:0},Mn=0,jn=[],Yr=0,Qr=0,Xa=0;function Vn(r,k,l,u){var v=Oe,g=Object.create(v),k=(g.parent=v,g.ref=0,g.global=!1,g.id=++Xa,at.env,g.env=lt?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject}:{},k&&m(g,k),++v.ref,g.finalize=function(){--this.parent.ref||this.parent.finalize()},Ke(g,r,l,u));return g.ref===0&&g.finalize(),k}function cn(){return Vt.id||(Vt.id=++Mn),++Vt.awaits,Vt.echoes+=ut,Vt.id}function Yn(){return!!Vt.awaits&&(--Vt.awaits==0&&(Vt.id=0),Vt.echoes=Vt.awaits*ut,!0)}function Xr(r){return Vt.echoes&&r&&r.constructor===We?(cn(),r.then(function(s){return Yn(),s},function(s){return Yn(),Me(s)})):r}function qs(){var r=jn[jn.length-1];jn.pop(),Qn(r,!1)}function Qn(r,s){var l,u,v=Oe;(s?!Vt.echoes||Yr++&&r===Oe:!Yr||--Yr&&r===Oe)||queueMicrotask(s?(function(g){++Qr,Vt.echoes&&--Vt.echoes!=0||(Vt.echoes=Vt.awaits=Vt.id=0),jn.push(Oe),Qn(g,!0)}).bind(null,r):qs),r!==Oe&&(Oe=r,v===at&&(at.env=Bs()),lt)&&(l=at.env.Promise,u=r.env,v.global||r.global)&&(Object.defineProperty(o,"Promise",u.PromiseProp),l.all=u.all,l.race=u.race,l.resolve=u.resolve,l.reject=u.reject,u.allSettled&&(l.allSettled=u.allSettled),u.any)&&(l.any=u.any)}function Bs(){var r=o.Promise;return lt?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ke(r,s,l,u,v){var g=Oe;try{return Qn(r,!0),s(l,u,v)}finally{Qn(g,!1)}}function j(r,s,l,u){return typeof r!="function"?r:function(){var v=Oe;l&&cn(),Qn(s,!0);try{return r.apply(this,arguments)}finally{Qn(v,!1),u&&queueMicrotask(Yn)}}}function Ee(r){Promise===We&&Vt.echoes===0?Yr===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+Ra).indexOf("[native code]")===-1&&(cn=Yn=Ae);var Me=Ie.reject,ht="ï¿¿",Ct="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Bt="String expected.",Gt=[],gn="__dbnames",ur="readonly",Zr="readwrite";function jt(r,s){return r?s?function(){return r.apply(this,arguments)&&s.apply(this,arguments)}:r:s}var Za={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Jr(r){return typeof r!="string"||/\./.test(r)?function(s){return s}:function(s){return s[r]===void 0&&r in s&&delete(s=_e(s))[r],s}}function wl(){throw M.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ct(r,s){try{var l=kl(r),u=kl(s);if(l!==u)return l==="Array"?1:u==="Array"?-1:l==="binary"?1:u==="binary"?-1:l==="string"?1:u==="string"?-1:l==="Date"?1:u!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return s<r?1:r<s?-1:0;case"binary":for(var v=xl(r),g=xl(s),k=v.length,S=g.length,q=k<S?k:S,Q=0;Q<q;++Q)if(v[Q]!==g[Q])return v[Q]<g[Q]?-1:1;return k===S?0:k<S?-1:1;case"Array":for(var B=r,O=s,K=B.length,W=O.length,z=K<W?K:W,N=0;N<z;++N){var J=ct(B[N],O[N]);if(J!==0)return J}return K===W?0:K<W?-1:1}}catch{}return NaN}function kl(r){var s=typeof r;return s=="object"&&(ArrayBuffer.isView(r)||(s=ie(r))==="ArrayBuffer")?"binary":s}function xl(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function zs(r,s,l){var u=r.schema.yProps;return u?(s&&0<l.numFailures&&(s=s.filter(function(v,g){return!l.failures[g]})),Promise.all(u.map(function(v){return v=v.updatesTable,s?r.db.table(v).where("k").anyOf(s).delete():r.db.table(v).clear()})).then(function(){return l})):l}Sl.prototype.execute=function(r){var s=this["@@propmod"];if(s.add!==void 0){var l=s.add;if(f(l))return i(i([],f(r)?r:[],!0),l).sort();if(typeof l=="number")return(Number(r)||0)+l;if(typeof l=="bigint")try{return BigInt(r)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(s.remove!==void 0){var u=s.remove;if(f(u))return f(r)?r.filter(function(v){return!u.includes(v)}).sort():[];if(typeof u=="number")return Number(r)-u;if(typeof u=="bigint")try{return BigInt(r)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return l=(l=s.replacePrefix)==null?void 0:l[0],l&&typeof r=="string"&&r.startsWith(l)?s.replacePrefix[1]+r.substring(l.length):r};var Ja=Sl;function Sl(r){this["@@propmod"]=r}function El(r,s){for(var l=c(s),u=l.length,v=!1,g=0;g<u;++g){var k=l[g],S=s[k],q=ce(r,k);S instanceof Ja?(D(r,k,S.execute(q)),v=!0):q!==S&&(D(r,k,S),v=!0)}return v}Pt.prototype._trans=function(r,s,l){var u=this._tx||Oe.trans,v=this.name,g=Ge&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function k(Q,B,O){if(O.schema[v])return s(O.idbtrans,O);throw new M.NotFound("Table "+v+" not part of transaction")}var S=lr();try{var q=u&&u.db._novip===this.db._novip?u===Oe.trans?u._promise(r,k,l):Vn(function(){return u._promise(r,k,l)},{trans:u,transless:Oe.transless||Oe}):(function Q(B,O,K,W){if(B.idbdb&&(B._state.openComplete||Oe.letThrough||B._vip)){var z=B._createTransaction(O,K,B._dbSchema);try{z.create(),B._state.PR1398_maxLoop=3}catch(N){return N.name===Te.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return Q(B,O,K,W)})):Me(N)}return z._promise(O,function(N,J){return Vn(function(){return Oe.trans=z,W(N,J,z)})}).then(function(N){if(O==="readwrite")try{z.idbtrans.commit()}catch{}return O==="readonly"?N:z._completion.then(function(){return N})})}if(B._state.openComplete)return Me(new M.DatabaseClosed(B._state.dbOpenError));if(!B._state.isBeingOpened){if(!B._state.autoOpen)return Me(new M.DatabaseClosed);B.open().catch(Ae)}return B._state.dbReadyPromise.then(function(){return Q(B,O,K,W)})})(this.db,r,[this.name],k);return g&&(q._consoleTask=g,q=q.catch(function(Q){return console.trace(Q),Me(Q)})),q}finally{S&&Sn()}},Pt.prototype.get=function(r,s){var l=this;return r&&r.constructor===Object?this.where(r).first(s):r==null?Me(new M.Type("Invalid argument to Table.get()")):this._trans("readonly",function(u){return l.core.get({trans:u,key:r}).then(function(v){return l.hook.reading.fire(v)})}).then(s)},Pt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(f(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var s=c(r);if(s.length===1)return this.where(s[0]).equals(r[s[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&s.every(function(Q){return 0<=S.keyPath.indexOf(Q)})){for(var q=0;q<s.length;++q)if(s.indexOf(S.keyPath[q])===-1)return!1;return!0}return!1}).sort(function(S,q){return S.keyPath.length-q.keyPath.length})[0];if(l&&this.db._maxKey!==ht)return k=l.keyPath.slice(0,s.length),this.where(k).equals(k.map(function(S){return r[S]}));!l&&Ge&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var u=this.schema.idxByName;function v(S,q){return ct(S,q)===0}var k=s.reduce(function(B,q){var Q=B[0],B=B[1],O=u[q],K=r[q];return[Q||O,Q||!O?jt(B,O&&O.multi?function(W){return W=ce(W,q),f(W)&&W.some(function(z){return v(K,z)})}:function(W){return v(K,ce(W,q))}):B]},[null,null]),g=k[0],k=k[1];return g?this.where(g.name).equals(r[g.keyPath]).filter(k):l?this.filter(k):this.where(s).equals("")},Pt.prototype.filter=function(r){return this.toCollection().and(r)},Pt.prototype.count=function(r){return this.toCollection().count(r)},Pt.prototype.offset=function(r){return this.toCollection().offset(r)},Pt.prototype.limit=function(r){return this.toCollection().limit(r)},Pt.prototype.each=function(r){return this.toCollection().each(r)},Pt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Pt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Pt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,f(r)?"[".concat(r.join("+"),"]"):r))},Pt.prototype.reverse=function(){return this.toCollection().reverse()},Pt.prototype.mapToClass=function(r){for(var s=this.db,l=this.name,u=((this.schema.mappedClass=r).prototype instanceof wl&&(r=(k=>{var S=B,q=k;if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function Q(){this.constructor=S}function B(){return k!==null&&k.apply(this,arguments)||this}return n(S,q),S.prototype=q===null?Object.create(q):(Q.prototype=q.prototype,new Q),Object.defineProperty(B.prototype,"db",{get:function(){return s},enumerable:!1,configurable:!0}),B.prototype.table=function(){return l},B})(r)),new Set),v=r.prototype;v;v=h(v))Object.getOwnPropertyNames(v).forEach(function(k){return u.add(k)});function g(k){if(!k)return k;var S,q=Object.create(r.prototype);for(S in k)if(!u.has(S))try{q[S]=k[S]}catch{}return q}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=g,this.hook("reading",g),r},Pt.prototype.defineClass=function(){return this.mapToClass(function(r){m(this,r)})},Pt.prototype.add=function(r,s){var l=this,u=this.schema.primKey,v=u.auto,g=u.keyPath,k=r;return g&&v&&(k=Jr(g)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:s!=null?[s]:null,values:[k]})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(g)try{D(r,g,S)}catch{}return S})},Pt.prototype.upsert=function(r,s){var l=this,u=this.schema.primKey.keyPath;return this._trans("readwrite",function(v){return l.core.get({trans:v,key:r}).then(function(g){var k=g??{};return El(k,s),u&&D(k,u,r),l.core.mutate({trans:v,type:"put",values:[k],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[s]}}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):!!g})})})},Pt.prototype.update=function(r,s){return typeof r!="object"||f(r)?this.where(":id").equals(r).modify(s):(r=ce(r,this.schema.primKey.keyPath))===void 0?Me(new M.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(s)},Pt.prototype.put=function(r,s){var l=this,u=this.schema.primKey,v=u.auto,g=u.keyPath,k=r;return g&&v&&(k=Jr(g)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[k],keys:s!=null?[s]:null})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(g)try{D(r,g,S)}catch{}return S})},Pt.prototype.delete=function(r){var s=this;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:[r]}).then(function(u){return zs(s,[r],u)}).then(function(u){return u.numFailures?Ie.reject(u.failures[0]):void 0})})},Pt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"deleteRange",range:Za}).then(function(l){return zs(r,null,l)})}).then(function(s){return s.numFailures?Ie.reject(s.failures[0]):void 0})},Pt.prototype.bulkGet=function(r){var s=this;return this._trans("readonly",function(l){return s.core.getMany({keys:r,trans:l}).then(function(u){return u.map(function(v){return s.hook.reading.fire(v)})})})},Pt.prototype.bulkAdd=function(r,s,l){var u=this,v=Array.isArray(s)?s:void 0,g=(l=l||(v?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(k){var S=u.schema.primKey,Q=S.auto,S=S.keyPath;if(S&&v)throw new M.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,Q=S&&Q?r.map(Jr(S)):r;return u.core.mutate({trans:k,type:"add",keys:v,values:Q,wantResults:g}).then(function(B){var O=B.numFailures,K=B.failures;if(O===0)return g?B.results:B.lastResult;throw new ee("".concat(u.name,".bulkAdd(): ").concat(O," of ").concat(q," operations failed"),K)})})},Pt.prototype.bulkPut=function(r,s,l){var u=this,v=Array.isArray(s)?s:void 0,g=(l=l||(v?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(k){var S=u.schema.primKey,Q=S.auto,S=S.keyPath;if(S&&v)throw new M.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new M.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,Q=S&&Q?r.map(Jr(S)):r;return u.core.mutate({trans:k,type:"put",keys:v,values:Q,wantResults:g}).then(function(B){var O=B.numFailures,K=B.failures;if(O===0)return g?B.results:B.lastResult;throw new ee("".concat(u.name,".bulkPut(): ").concat(O," of ").concat(q," operations failed"),K)})})},Pt.prototype.bulkUpdate=function(r){var s=this,l=this.core,u=r.map(function(k){return k.key}),v=r.map(function(k){return k.changes}),g=[];return this._trans("readwrite",function(k){return l.getMany({trans:k,keys:u,cache:"clone"}).then(function(S){var q=[],Q=[],B=(r.forEach(function(O,K){var W=O.key,z=O.changes,N=S[K];if(N){for(var J=0,ne=Object.keys(z);J<ne.length;J++){var Y=ne[J],ye=z[Y];if(Y===s.schema.primKey.keyPath){if(ct(ye,W)!==0)throw new M.Constraint("Cannot update primary key in bulkUpdate()")}else D(N,Y,ye)}g.push(K),q.push(W),Q.push(N)}}),q.length);return l.mutate({trans:k,type:"put",keys:q,values:Q,updates:{keys:u,changeSpecs:v}}).then(function(O){var K=O.numFailures,W=O.failures;if(K===0)return B;for(var z=0,N=Object.keys(W);z<N.length;z++){var J,ne=N[z],Y=g[Number(ne)];Y!=null&&(J=W[ne],delete W[ne],W[Y]=J)}throw new ee("".concat(s.name,".bulkUpdate(): ").concat(K," of ").concat(B," operations failed"),W)})})})},Pt.prototype.bulkDelete=function(r){var s=this,l=r.length;return this._trans("readwrite",function(u){return s.core.mutate({trans:u,type:"delete",keys:r}).then(function(v){return zs(s,r,v)})}).then(function(u){var v=u.numFailures,g=u.failures;if(v===0)return u.lastResult;throw new ee("".concat(s.name,".bulkDelete(): ").concat(v," of ").concat(l," operations failed"),g)})};var Tl=Pt;function Pt(){}function $a(r){function s(k,S){if(S){for(var q=arguments.length,Q=new Array(q-1);--q;)Q[q-1]=arguments[q];return l[k].subscribe.apply(null,Q),r}if(typeof k=="string")return l[k]}var l={};s.addEventType=g;for(var u=1,v=arguments.length;u<v;++u)g(arguments[u]);return s;function g(k,S,q){var Q,B;if(typeof k!="object")return S=S||Ze,B={subscribers:[],fire:q=q||Ae,subscribe:function(O){B.subscribers.indexOf(O)===-1&&(B.subscribers.push(O),B.fire=S(B.fire,O))},unsubscribe:function(O){B.subscribers=B.subscribers.filter(function(K){return K!==O}),B.fire=B.subscribers.reduce(S,q)}},l[k]=s[k]=B;c(Q=k).forEach(function(O){var K=Q[O];if(f(K))g(O,Q[O][0],Q[O][1]);else{if(K!=="asap")throw new M.InvalidArgument("Invalid event config");var W=g(O,qe,function(){for(var z=arguments.length,N=new Array(z);z--;)N[z]=arguments[z];W.subscribers.forEach(function(J){X(function(){J.apply(null,N)})})})}})}}function es(r,s){return G(s).from({prototype:r}),s}function Ca(r,s){return!(r.filter||r.algorithm||r.or)&&(s?r.justLimit:!r.replayFilter)}function Mi(r,s){r.filter=jt(r.filter,s)}function ji(r,s,l){var u=r.replayFilter;r.replayFilter=u?function(){return jt(u(),s())}:s,r.justLimit=l&&!u}function Fs(r,s){if(r.isPrimKey)return s.primaryKey;var l=s.getIndexByKeyPath(r.index);if(l)return l;throw new M.Schema("KeyPath "+r.index+" on object store "+s.name+" is not indexed")}function Al(r,s,l){var u=Fs(r,s.schema);return s.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:u,range:r.range}})}function Ks(r,s,l,u){var v,g,k=r.replayFilter?jt(r.filter,r.replayFilter()):r.filter;return r.or?(v={},g=function(S,q,Q){var B,O;k&&!k(q,Q,function(K){return q.stop(K)},function(K){return q.fail(K)})||((O=""+(B=q.primaryKey))=="[object ArrayBuffer]"&&(O=""+new Uint8Array(B)),y(v,O))||(v[O]=!0,s(S,q,Q))},Promise.all([r.or._iterate(g,l),Cl(Al(r,u,l),r.algorithm,g,!r.keysOnly&&r.valueMapper)])):Cl(Al(r,u,l),jt(r.algorithm,k),s,!r.keysOnly&&r.valueMapper)}function Cl(r,s,l,u){var v=Et(u?function(g,k,S){return l(u(g),k,S)}:l);return r.then(function(g){if(g)return g.start(function(){var k=function(){return g.continue()};s&&!s(g,function(S){return k=S},function(S){g.stop(S),k=Ae},function(S){g.fail(S),k=Ae})||v(g.value,g,function(S){return k=S}),k()})})}mt.prototype._read=function(r,s){var l=this._ctx;return l.error?l.table._trans(null,Me.bind(null,l.error)):l.table._trans("readonly",r).then(s)},mt.prototype._write=function(r){var s=this._ctx;return s.error?s.table._trans(null,Me.bind(null,s.error)):s.table._trans("readwrite",r,"locked")},mt.prototype._addAlgorithm=function(r){var s=this._ctx;s.algorithm=jt(s.algorithm,r)},mt.prototype._iterate=function(r,s){return Ks(this._ctx,r,s,this._ctx.table.core)},mt.prototype.clone=function(r){var s=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&m(l,r),s._ctx=l,s},mt.prototype.raw=function(){return this._ctx.valueMapper=null,this},mt.prototype.each=function(r){var s=this._ctx;return this._read(function(l){return Ks(s,r,l,s.table.core)})},mt.prototype.count=function(r){var s=this;return this._read(function(l){var u,v=s._ctx,g=v.table.core;return Ca(v,!0)?g.count({trans:l,query:{index:Fs(v,g.schema),range:v.range}}).then(function(k){return Math.min(k,v.limit)}):(u=0,Ks(v,function(){return++u,!1},l,g).then(function(){return u}))}).then(r)},mt.prototype.sortBy=function(r,s){var l=r.split(".").reverse(),u=l[0],v=l.length-1;function g(q,Q){return Q?g(q[l[Q]],Q-1):q[u]}var k=this._ctx.dir==="next"?1:-1;function S(q,Q){return ct(g(q,v),g(Q,v))*k}return this.toArray(function(q){return q.sort(S)}).then(s)},mt.prototype.toArray=function(r){var s=this;return this._read(function(l){var u,v,g,k=s._ctx;return k.dir==="next"&&Ca(k,!0)&&0<k.limit?(u=k.valueMapper,v=Fs(k,k.table.core.schema),k.table.core.query({trans:l,limit:k.limit,values:!0,query:{index:v,range:k.range}}).then(function(S){return S=S.result,u?S.map(u):S})):(g=[],Ks(k,function(S){return g.push(S)},l,k.table.core).then(function(){return g}))},r)},mt.prototype.offset=function(r){var s=this._ctx;return r<=0||(s.offset+=r,Ca(s)?ji(s,function(){var l=r;return function(u,v){return l===0||(l===1?--l:v(function(){u.advance(l),l=0}),!1)}}):ji(s,function(){var l=r;return function(){return--l<0}})),this},mt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),ji(this._ctx,function(){var s=r;return function(l,u,v){return--s<=0&&u(v),0<=s}},!0),this},mt.prototype.until=function(r,s){return Mi(this._ctx,function(l,u,v){return!r(l.value)||(u(v),s)}),this},mt.prototype.first=function(r){return this.limit(1).toArray(function(s){return s[0]}).then(r)},mt.prototype.last=function(r){return this.reverse().first(r)},mt.prototype.filter=function(r){var s;return Mi(this._ctx,function(l){return r(l.value)}),(s=this._ctx).isMatch=jt(s.isMatch,r),this},mt.prototype.and=function(r){return this.filter(r)},mt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},mt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},mt.prototype.desc=function(){return this.reverse()},mt.prototype.eachKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,u){r(u.key,u)})},mt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},mt.prototype.eachPrimaryKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,u){r(u.primaryKey,u)})},mt.prototype.keys=function(r){var s=this._ctx,l=(s.keysOnly=!s.isMatch,[]);return this.each(function(u,v){l.push(v.key)}).then(function(){return l}).then(r)},mt.prototype.primaryKeys=function(r){var s=this._ctx;if(s.dir==="next"&&Ca(s,!0)&&0<s.limit)return this._read(function(u){var v=Fs(s,s.table.core.schema);return s.table.core.query({trans:u,values:!1,limit:s.limit,query:{index:v,range:s.range}})}).then(function(u){return u.result}).then(r);s.keysOnly=!s.isMatch;var l=[];return this.each(function(u,v){l.push(v.primaryKey)}).then(function(){return l}).then(r)},mt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},mt.prototype.firstKey=function(r){return this.limit(1).keys(function(s){return s[0]}).then(r)},mt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},mt.prototype.distinct=function(){var r,s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];return s&&s.multi&&(r={},Mi(this._ctx,function(u){var u=u.primaryKey.toString(),v=y(r,u);return r[u]=!0,!v})),this},mt.prototype.modify=function(r){var s=this,l=this._ctx;return this._write(function(u){function v(N,J){var ne=J.failures;K+=N-J.numFailures;for(var Y=0,ye=c(ne);Y<ye.length;Y++){var xe=ye[Y];O.push(ne[xe])}}var g=typeof r=="function"?r:function(N){return El(N,r)},k=l.table.core,B=k.schema.primaryKey,S=B.outbound,q=B.extractKey,Q=200,B=s.db._options.modifyChunkSize,O=(B&&(Q=typeof B=="object"?B[k.name]||B["*"]||200:B),[]),K=0,W=[],z=r===Pl;return s.clone().primaryKeys().then(function(N){function J(Y){var ye=Math.min(Q,N.length-Y),xe=N.slice(Y,Y+ye);return(z?Promise.resolve([]):k.getMany({trans:u,keys:xe,cache:"immutable"})).then(function(je){var De=[],Se=[],ze=S?[]:null,Ne=z?xe:[];if(!z)for(var Ce=0;Ce<ye;++Ce){var Fe=je[Ce],dt={value:_e(Fe),primKey:N[Y+Ce]};g.call(dt,dt.value,dt)!==!1&&(dt.value==null?Ne.push(N[Y+Ce]):S||ct(q(Fe),q(dt.value))===0?(Se.push(dt.value),S&&ze.push(N[Y+Ce])):(Ne.push(N[Y+Ce]),De.push(dt.value)))}return Promise.resolve(0<De.length&&k.mutate({trans:u,type:"add",values:De}).then(function(gt){for(var He in gt.failures)Ne.splice(parseInt(He),1);v(De.length,gt)})).then(function(){return(0<Se.length||ne&&typeof r=="object")&&k.mutate({trans:u,type:"put",keys:ze,values:Se,criteria:ne,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<Y}).then(function(gt){return v(Se.length,gt)})}).then(function(){return(0<Ne.length||ne&&z)&&k.mutate({trans:u,type:"delete",keys:Ne,criteria:ne,isAdditionalChunk:0<Y}).then(function(gt){return zs(l.table,Ne,gt)}).then(function(gt){return v(Ne.length,gt)})}).then(function(){return N.length>Y+ye&&J(Y+Q)})})}var ne=Ca(l)&&l.limit===1/0&&(typeof r!="function"||z)&&{index:l.index,range:l.range};return J(0).then(function(){if(0<O.length)throw new H("Error modifying one or more objects",O,K,W);return N.length})})})},mt.prototype.delete=function(){var r=this._ctx,s=r.range;return!Ca(r)||r.table.schema.yProps||!r.isPrimKey&&s.type!==3?this.modify(Pl):this._write(function(l){var u=r.table.core.schema.primaryKey,v=s;return r.table.core.count({trans:l,query:{index:u,range:v}}).then(function(g){return r.table.core.mutate({trans:l,type:"deleteRange",range:v}).then(function(q){var S=q.failures,q=q.numFailures;if(q)throw new H("Could not delete some values",Object.keys(S).map(function(Q){return S[Q]}),g-q);return g-q})})})};var Cd=mt;function mt(){}var Pl=function(r,s){return s.value=null};function Pd(r,s){return r<s?-1:r===s?0:1}function Id(r,s){return s<r?-1:r===s?0:1}function En(r,s,l){return r=r instanceof Rl?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(s),r}function Pa(r){return new r.Collection(r,function(){return Il("")}).limit(0)}function Us(W,s,l,u){var v,g,k,S,q,Q,B,O=l.length;if(!l.every(function(N){return typeof N=="string"}))return En(W,Bt);function K(N){v=N==="next"?function(ne){return ne.toUpperCase()}:function(ne){return ne.toLowerCase()},g=N==="next"?function(ne){return ne.toLowerCase()}:function(ne){return ne.toUpperCase()},k=N==="next"?Pd:Id;var J=l.map(function(ne){return{lower:g(ne),upper:v(ne)}}).sort(function(ne,Y){return k(ne.lower,Y.lower)});S=J.map(function(ne){return ne.upper}),q=J.map(function(ne){return ne.lower}),B=(Q=N)==="next"?"":u}K("next");var W=new W.Collection(W,function(){return Dr(S[0],q[O-1]+u)}),z=(W._ondirectionchange=function(N){K(N)},0);return W._addAlgorithm(function(N,J,ne){var Y=N.key;if(typeof Y=="string"){var ye=g(Y);if(s(ye,q,z))return!0;for(var xe=null,je=z;je<O;++je){var De=((Se,ze,Ne,Ce,Fe,dt)=>{for(var gt=Math.min(Se.length,Ce.length),He=-1,tt=0;tt<gt;++tt){var zt=ze[tt];if(zt!==Ce[tt])return Fe(Se[tt],Ne[tt])<0?Se.substr(0,tt)+Ne[tt]+Ne.substr(tt+1):Fe(Se[tt],Ce[tt])<0?Se.substr(0,tt)+Ce[tt]+Ne.substr(tt+1):0<=He?Se.substr(0,He)+ze[He]+Ne.substr(He+1):null;Fe(Se[tt],zt)<0&&(He=tt)}return gt<Ce.length&&dt==="next"?Se+Ne.substr(Se.length):gt<Se.length&&dt==="prev"?Se.substr(0,Ne.length):He<0?null:Se.substr(0,He)+Ce[He]+Ne.substr(He+1)})(Y,ye,S[je],q[je],k,Q);De===null&&xe===null?z=je+1:(xe===null||0<k(xe,De))&&(xe=De)}J(xe!==null?function(){N.continue(xe+B)}:ne)}return!1}),W}function Dr(r,s,l,u){return{type:2,lower:r,upper:s,lowerOpen:l,upperOpen:u}}function Il(r){return{type:1,lower:r,upper:r}}Object.defineProperty(Zt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Zt.prototype.between=function(r,s,l,u){l=l!==!1,u=u===!0;try{return 0<this._cmp(r,s)||this._cmp(r,s)===0&&(l||u)&&(!l||!u)?Pa(this):new this.Collection(this,function(){return Dr(r,s,!l,!u)})}catch{return En(this,Ct)}},Zt.prototype.equals=function(r){return r==null?En(this,Ct):new this.Collection(this,function(){return Il(r)})},Zt.prototype.above=function(r){return r==null?En(this,Ct):new this.Collection(this,function(){return Dr(r,void 0,!0)})},Zt.prototype.aboveOrEqual=function(r){return r==null?En(this,Ct):new this.Collection(this,function(){return Dr(r,void 0,!1)})},Zt.prototype.below=function(r){return r==null?En(this,Ct):new this.Collection(this,function(){return Dr(void 0,r,!1,!0)})},Zt.prototype.belowOrEqual=function(r){return r==null?En(this,Ct):new this.Collection(this,function(){return Dr(void 0,r)})},Zt.prototype.startsWith=function(r){return typeof r!="string"?En(this,Bt):this.between(r,r+ht,!0,!0)},Zt.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Us(this,function(s,l){return s.indexOf(l[0])===0},[r],ht)},Zt.prototype.equalsIgnoreCase=function(r){return Us(this,function(s,l){return s===l[0]},[r],"")},Zt.prototype.anyOfIgnoreCase=function(){var r=se.apply(ve,arguments);return r.length===0?Pa(this):Us(this,function(s,l){return l.indexOf(s)!==-1},r,"")},Zt.prototype.startsWithAnyOfIgnoreCase=function(){var r=se.apply(ve,arguments);return r.length===0?Pa(this):Us(this,function(s,l){return l.some(function(u){return s.indexOf(u)===0})},r,ht)},Zt.prototype.anyOf=function(){var r,s,l=this,u=se.apply(ve,arguments),v=this._cmp;try{u.sort(v)}catch{return En(this,Ct)}return u.length===0?Pa(this):((r=new this.Collection(this,function(){return Dr(u[0],u[u.length-1])}))._ondirectionchange=function(g){v=g==="next"?l._ascending:l._descending,u.sort(v)},s=0,r._addAlgorithm(function(g,k,S){for(var q=g.key;0<v(q,u[s]);)if(++s===u.length)return k(S),!1;return v(q,u[s])===0||(k(function(){g.continue(u[s])}),!1)}),r)},Zt.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Zt.prototype.noneOf=function(){var r=se.apply(ve,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return En(this,Ct)}var s=r.reduce(function(l,u){return l?l.concat([[l[l.length-1][1],u]]):[[-1/0,u]]},null);return s.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},Zt.prototype.inAnyRange=function(r,ne){var l=this,u=this._cmp,v=this._ascending,g=this._descending,k=this._min,S=this._max;if(r.length===0)return Pa(this);if(!r.every(function(Y){return Y[0]!==void 0&&Y[1]!==void 0&&v(Y[0],Y[1])<=0}))return En(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",M.InvalidArgument);var q=!ne||ne.includeLowers!==!1,Q=ne&&ne.includeUppers===!0,B,O=v;function K(Y,ye){return O(Y[0],ye[0])}try{(B=r.reduce(function(Y,ye){for(var xe=0,je=Y.length;xe<je;++xe){var De=Y[xe];if(u(ye[0],De[1])<0&&0<u(ye[1],De[0])){De[0]=k(De[0],ye[0]),De[1]=S(De[1],ye[1]);break}}return xe===je&&Y.push(ye),Y},[])).sort(K)}catch{return En(this,Ct)}var W=0,z=Q?function(Y){return 0<v(Y,B[W][1])}:function(Y){return 0<=v(Y,B[W][1])},N=q?function(Y){return 0<g(Y,B[W][0])}:function(Y){return 0<=g(Y,B[W][0])},J=z,ne=new this.Collection(this,function(){return Dr(B[0][0],B[B.length-1][1],!q,!Q)});return ne._ondirectionchange=function(Y){O=Y==="next"?(J=z,v):(J=N,g),B.sort(K)},ne._addAlgorithm(function(Y,ye,xe){for(var je,De=Y.key;J(De);)if(++W===B.length)return ye(xe),!1;return!z(je=De)&&!N(je)||(l._cmp(De,B[W][1])===0||l._cmp(De,B[W][0])===0||ye(function(){O===v?Y.continue(B[W][0]):Y.continue(B[W][1])}),!1)}),ne},Zt.prototype.startsWithAnyOf=function(){var r=se.apply(ve,arguments);return r.every(function(s){return typeof s=="string"})?r.length===0?Pa(this):this.inAnyRange(r.map(function(s){return[s,s+ht]})):En(this,"startsWithAnyOf() only works with strings")};var Rl=Zt;function Zt(){}function dr(r){return Et(function(s){return ts(s),r(s.target.error),!1})}function ts(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var ns="storagemutated",Di="x-storagemutated-1",Lr=$a(null,ns),Rd=(fr.prototype._lock=function(){return R(!Oe.global),++this._reculock,this._reculock!==1||Oe.global||(Oe.lockOwnerFor=this),this},fr.prototype._unlock=function(){if(R(!Oe.global),--this._reculock==0)for(Oe.global||(Oe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ke(r[1],r[0])}catch{}}return this},fr.prototype._locked=function(){return this._reculock&&Oe.lockOwnerFor!==this},fr.prototype.create=function(r){var s=this;if(this.mode){var l=this.db.idbdb,u=this.db._state.dbOpenError;if(R(!this.idbtrans),!r&&!l)switch(u&&u.name){case"DatabaseClosedError":throw new M.DatabaseClosed(u);case"MissingAPIError":throw new M.MissingAPI(u.message,u);default:throw new M.OpenFailed(u)}if(!this.active)throw new M.TransactionInactive;R(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Et(function(v){ts(v),s._reject(r.error)}),r.onabort=Et(function(v){ts(v),s.active&&s._reject(new M.Abort(r.error)),s.active=!1,s.on("abort").fire(v)}),r.oncomplete=Et(function(){s.active=!1,s._resolve(),"mutatedParts"in r&&Lr.storagemutated.fire(r.mutatedParts)})}return this},fr.prototype._promise=function(r,s,l){var u,v=this;return r==="readwrite"&&this.mode!=="readwrite"?Me(new M.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ie(function(g,k){v._blockedFuncs.push([function(){v._promise(r,s,l).then(g,k)},Oe])}):l?Vn(function(){var g=new Ie(function(k,S){v._lock();var q=s(k,S,v);q&&q.then&&q.then(k,S)});return g.finally(function(){return v._unlock()}),g._lib=!0,g}):((u=new Ie(function(g,k){var S=s(g,k,v);S&&S.then&&S.then(g,k)}))._lib=!0,u):Me(new M.TransactionInactive)},fr.prototype._root=function(){return this.parent?this.parent._root():this},fr.prototype.waitFor=function(r){var s,l=this._root(),u=Ie.resolve(r),v=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return u}):(l._waitingFor=u,l._waitingQueue=[],s=l.idbtrans.objectStore(l.storeNames[0]),(function g(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(s.get(-1/0).onsuccess=g)})()),l._waitingFor);return new Ie(function(g,k){u.then(function(S){return l._waitingQueue.push(Et(g.bind(null,S)))},function(S){return l._waitingQueue.push(Et(k.bind(null,S)))}).finally(function(){l._waitingFor===v&&(l._waitingFor=null)})})},fr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new M.Abort))},fr.prototype.table=function(r){var s=this._memoizedTables||(this._memoizedTables={});if(y(s,r))return s[r];var l=this.schema[r];if(l)return(l=new this.db.Table(r,l,this)).core=this.db.core.table(r),s[r]=l;throw new M.NotFound("Table "+r+" not part of transaction")},fr);function fr(){}function Li(r,s,l,u,v,g,k,S){return{name:r,keyPath:s,unique:l,multi:u,auto:v,compound:g,src:(l&&!k?"&":"")+(u?"*":"")+(v?"++":"")+Ol(s),type:S}}function Ol(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Ni(r,s,l){return{name:r,primKey:s,indexes:l,mappedClass:null,idxByName:(u=function(v){return[v.name,v]},l.reduce(function(v,g,k){return g=u(g,k),g&&(v[g[0]]=g[1]),v},{}))};var u}var rs=function(r){try{return r.only([[]]),rs=function(){return[[]]},[[]]}catch{return rs=function(){return ht},ht}};function qi(r){return r==null?function(){}:typeof r=="string"?(s=r).split(".").length===1?function(l){return l[s]}:function(l){return ce(l,s)}:function(l){return ce(l,r)};var s}function Ml(r){return[].slice.call(r)}var Od=0;function as(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Md(r,s,q){function u(z){if(z.type===3)return null;if(z.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var O=z.lower,K=z.upper,W=z.lowerOpen,z=z.upperOpen;return O===void 0?K===void 0?null:s.upperBound(K,!!z):K===void 0?s.lowerBound(O,!!W):s.bound(O,K,!!W,!!z)}function v(B){var O,K=B.name;return{name:K,schema:B,mutate:function(W){var z=W.trans,N=W.type,J=W.keys,ne=W.values,Y=W.range;return new Promise(function(ye,xe){ye=Et(ye);var je=z.objectStore(K),De=je.keyPath==null,Se=N==="put"||N==="add";if(!Se&&N!=="delete"&&N!=="deleteRange")throw new Error("Invalid operation type: "+N);var ze,Ne=(J||ne||{length:1}).length;if(J&&ne&&J.length!==ne.length)throw new Error("Given keys array must have same length as given values array.");if(Ne===0)return ye({numFailures:0,failures:{},results:[],lastResult:void 0});function Ce(Ut){++gt,ts(Ut)}var Fe=[],dt=[],gt=0;if(N==="deleteRange"){if(Y.type===4)return ye({numFailures:gt,failures:dt,results:[],lastResult:void 0});Y.type===3?Fe.push(ze=je.clear()):Fe.push(ze=je.delete(u(Y)))}else{var De=Se?De?[ne,J]:[ne,null]:[J,null],He=De[0],tt=De[1];if(Se)for(var zt=0;zt<Ne;++zt)Fe.push(ze=tt&&tt[zt]!==void 0?je[N](He[zt],tt[zt]):je[N](He[zt])),ze.onerror=Ce;else for(zt=0;zt<Ne;++zt)Fe.push(ze=je[N](He[zt])),ze.onerror=Ce}function Dn(Ut){Ut=Ut.target.result,Fe.forEach(function(ta,no){return ta.error!=null&&(dt[no]=ta.error)}),ye({numFailures:gt,failures:dt,results:N==="delete"?J:Fe.map(function(ta){return ta.result}),lastResult:Ut})}ze.onerror=function(Ut){Ce(Ut),Dn(Ut)},ze.onsuccess=Dn})},getMany:function(W){var z=W.trans,N=W.keys;return new Promise(function(J,ne){J=Et(J);for(var Y,ye=z.objectStore(K),xe=N.length,je=new Array(xe),De=0,Se=0,ze=function(Fe){Fe=Fe.target,je[Fe._pos]=Fe.result,++Se===De&&J(je)},Ne=dr(ne),Ce=0;Ce<xe;++Ce)N[Ce]!=null&&((Y=ye.get(N[Ce]))._pos=Ce,Y.onsuccess=ze,Y.onerror=Ne,++De);De===0&&J(je)})},get:function(W){var z=W.trans,N=W.key;return new Promise(function(J,ne){J=Et(J);var Y=z.objectStore(K).get(N);Y.onsuccess=function(ye){return J(ye.target.result)},Y.onerror=dr(ne)})},query:(O=S,function(W){return new Promise(function(z,N){z=Et(z);var J,ne,Y,Se=W.trans,ye=W.values,xe=W.limit,De=W.query,je=xe===1/0?void 0:xe,ze=De.index,De=De.range,Se=Se.objectStore(K),Se=ze.isPrimaryKey?Se:Se.index(ze.name),ze=u(De);if(xe===0)return z({result:[]});O?((De=ye?Se.getAll(ze,je):Se.getAllKeys(ze,je)).onsuccess=function(Ne){return z({result:Ne.target.result})},De.onerror=dr(N)):(J=0,ne=!ye&&"openKeyCursor"in Se?Se.openKeyCursor(ze):Se.openCursor(ze),Y=[],ne.onsuccess=function(Ne){var Ce=ne.result;return!Ce||(Y.push(ye?Ce.value:Ce.primaryKey),++J===xe)?z({result:Y}):void Ce.continue()},ne.onerror=dr(N))})}),openCursor:function(W){var z=W.trans,N=W.values,J=W.query,ne=W.reverse,Y=W.unique;return new Promise(function(ye,xe){ye=Et(ye);var Se=J.index,je=J.range,De=z.objectStore(K),De=Se.isPrimaryKey?De:De.index(Se.name),Se=ne?Y?"prevunique":"prev":Y?"nextunique":"next",ze=!N&&"openKeyCursor"in De?De.openKeyCursor(u(je),Se):De.openCursor(u(je),Se);ze.onerror=dr(xe),ze.onsuccess=Et(function(Ne){var Ce,Fe,dt,gt,He=ze.result;He?(He.___id=++Od,He.done=!1,Ce=He.continue.bind(He),Fe=(Fe=He.continuePrimaryKey)&&Fe.bind(He),dt=He.advance.bind(He),gt=function(){throw new Error("Cursor not stopped")},He.trans=z,He.stop=He.continue=He.continuePrimaryKey=He.advance=function(){throw new Error("Cursor not started")},He.fail=Et(xe),He.next=function(){var tt=this,zt=1;return this.start(function(){return zt--?tt.continue():tt.stop()}).then(function(){return tt})},He.start=function(tt){function zt(){if(ze.result)try{tt()}catch(Ut){He.fail(Ut)}else He.done=!0,He.start=function(){throw new Error("Cursor behind last entry")},He.stop()}var Dn=new Promise(function(Ut,ta){Ut=Et(Ut),ze.onerror=dr(ta),He.fail=ta,He.stop=function(no){He.stop=He.continue=He.continuePrimaryKey=He.advance=gt,Ut(no)}});return ze.onsuccess=Et(function(Ut){ze.onsuccess=zt,zt()}),He.continue=Ce,He.continuePrimaryKey=Fe,He.advance=dt,zt(),Dn},ye(He)):ye(null)},xe)})},count:function(W){var z=W.query,N=W.trans,J=z.index,ne=z.range;return new Promise(function(Y,ye){var xe=N.objectStore(K),xe=J.isPrimaryKey?xe:xe.index(J.name),je=u(ne),je=je?xe.count(je):xe.count();je.onsuccess=Et(function(De){return Y(De.target.result)}),je.onerror=dr(ye)})}}}g=q,k=Ml((q=r).objectStoreNames);var g,q={schema:{name:q.name,tables:k.map(function(B){return g.objectStore(B)}).map(function(B){var O=B.keyPath,K=B.autoIncrement,z=f(O),W={},z={name:B.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O==null,compound:z,keyPath:O,autoIncrement:K,unique:!0,extractKey:qi(O)},indexes:Ml(B.indexNames).map(function(N){return B.index(N)}).map(function(Y){var ye=Y.name,J=Y.unique,ne=Y.multiEntry,Y=Y.keyPath,ye={name:ye,compound:f(Y),keyPath:Y,unique:J,multiEntry:ne,extractKey:qi(Y)};return W[as(Y)]=ye}),getIndexByKeyPath:function(N){return W[as(N)]}};return W[":id"]=z.primaryKey,O!=null&&(W[as(O)]=z.primaryKey),z})},hasGetAll:0<k.length&&"getAll"in g.objectStore(k[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},k=q.schema,S=q.hasGetAll,q=k.tables.map(v),Q={};return q.forEach(function(B){return Q[B.name]=B}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(B){if(Q[B])return Q[B];throw new Error("Table '".concat(B,"' not found"))},MIN_KEY:-1/0,MAX_KEY:rs(s),schema:k}}function jd(r,s,l,u){return l=l.IDBKeyRange,s=Md(s,l,u),{dbcore:r.dbcore.reduce(function(v,g){return g=g.create,a(a({},v),g(v))},s)}}function Gs(r,s){var l=s.db,l=jd(r._middlewares,l,r._deps,s);r.core=l.dbcore,r.tables.forEach(function(u){var v=u.name;r.core.schema.tables.some(function(g){return g.name===v})&&(u.core=r.core.table(v),r[v]instanceof r.Table)&&(r[v].core=u.core)})}function Ws(r,s,l,u){l.forEach(function(v){var g=u[v];s.forEach(function(k){var S=(function q(Q,B){return A(Q,B)||(Q=h(Q))&&q(Q,B)})(k,v);(!S||"value"in S&&S.value===void 0)&&(k===r.Transaction.prototype||k instanceof r.Transaction?I(k,v,{get:function(){return this.table(v)},set:function(q){x(this,v,{value:q,writable:!0,configurable:!0,enumerable:!0})}}):k[v]=new r.Table(v,g))})})}function Bi(r,s){s.forEach(function(l){for(var u in l)l[u]instanceof r.Table&&delete l[u]})}function Dd(r,s){return r._cfg.version-s._cfg.version}function Ld(r,s,l,u){var v=r._dbSchema,g=(l.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=Ni("$meta",Dl("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,v)),k=(g.create(l),g._completion.catch(u),g._reject.bind(g)),S=Oe.transless||Oe;Vn(function(){if(Oe.trans=g,Oe.transless=S,s!==0)return Gs(r,l),Q=s,((q=g).storeNames.includes("$meta")?q.table("$meta").get("version").then(function(B){return B??Q}):Ie.resolve(Q)).then(function(J){var O=r,K=J,W=g,z=l,N=[],J=O._versions,ne=O._dbSchema=Vs(0,O.idbdb,z);return(J=J.filter(function(Y){return Y._cfg.version>=K})).length===0?Ie.resolve():(J.forEach(function(Y){N.push(function(){var ye,xe,je,De=ne,Se=Y._cfg.dbschema,ze=(Ys(O,De,z),Ys(O,Se,z),ne=O._dbSchema=Se,zi(De,Se)),Ne=(ze.add.forEach(function(Ce){Fi(z,Ce[0],Ce[1].primKey,Ce[1].indexes)}),ze.change.forEach(function(Ce){if(Ce.recreate)throw new M.Upgrade("Not yet support for changing primary key");var Fe=z.objectStore(Ce.name);Ce.add.forEach(function(dt){return Hs(Fe,dt)}),Ce.change.forEach(function(dt){Fe.deleteIndex(dt.name),Hs(Fe,dt)}),Ce.del.forEach(function(dt){return Fe.deleteIndex(dt)})}),Y._cfg.contentUpgrade);if(Ne&&Y._cfg.version>K)return Gs(O,z),W._memoizedTables={},ye=pe(Se),ze.del.forEach(function(Ce){ye[Ce]=De[Ce]}),Bi(O,[O.Transaction.prototype]),Ws(O,[O.Transaction.prototype],c(ye),ye),W.schema=ye,(xe=le(Ne))&&cn(),Se=Ie.follow(function(){var Ce;(je=Ne(W))&&xe&&(Ce=Yn.bind(null,null),je.then(Ce,Ce))}),je&&typeof je.then=="function"?Ie.resolve(je):Se.then(function(){return je})}),N.push(function(ye){var xe,je,De=Y._cfg.dbschema;xe=De,je=ye,[].slice.call(je.db.objectStoreNames).forEach(function(Se){return xe[Se]==null&&je.db.deleteObjectStore(Se)}),Bi(O,[O.Transaction.prototype]),Ws(O,[O.Transaction.prototype],O._storeNames,O._dbSchema),W.schema=O._dbSchema}),N.push(function(ye){O.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(O.idbdb.version/10)===Y._cfg.version?(O.idbdb.deleteObjectStore("$meta"),delete O._dbSchema.$meta,O._storeNames=O._storeNames.filter(function(xe){return xe!=="$meta"})):ye.objectStore("$meta").put(Y._cfg.version,"version"))})}),(function Y(){return N.length?Ie.resolve(N.shift()(W.idbtrans)).then(Y):Ie.resolve()})().then(function(){jl(ne,z)}))}).catch(k);var q,Q;c(v).forEach(function(B){Fi(l,B,v[B].primKey,v[B].indexes)}),Gs(r,l),Ie.follow(function(){return r.on.populate.fire(g)}).catch(k)})}function Nd(r,s){jl(r._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var l=Vs(0,r.idbdb,s);Ys(r,r._dbSchema,s);for(var u=0,v=zi(l,r._dbSchema).change;u<v.length;u++){var g=(k=>{if(k.change.length||k.recreate)return console.warn("Unable to patch indexes of table ".concat(k.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=s.objectStore(k.name);k.add.forEach(function(q){Ge&&console.debug("Dexie upgrade patch: Creating missing index ".concat(k.name,".").concat(q.src)),Hs(S,q)})})(v[u]);if(typeof g=="object")return g.value}}function zi(r,s){var l,u={del:[],add:[],change:[]};for(l in r)s[l]||u.del.push(l);for(l in s){var v=r[l],g=s[l];if(v){var k={name:l,def:g,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(g.primKey.keyPath||"")||v.primKey.auto!==g.primKey.auto)k.recreate=!0,u.change.push(k);else{var S=v.idxByName,q=g.idxByName,Q=void 0;for(Q in S)q[Q]||k.del.push(Q);for(Q in q){var B=S[Q],O=q[Q];B?B.src!==O.src&&k.change.push(O):k.add.push(O)}(0<k.del.length||0<k.add.length||0<k.change.length)&&u.change.push(k)}}else u.add.push([l,g])}return u}function Fi(r,s,l,u){var v=r.db.createObjectStore(s,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});u.forEach(function(g){return Hs(v,g)})}function jl(r,s){c(r).forEach(function(l){s.db.objectStoreNames.contains(l)||(Ge&&console.debug("Dexie: Creating missing table",l),Fi(s,l,r[l].primKey,r[l].indexes))})}function Hs(r,s){r.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function Vs(r,s,l){var u={};return de(s.objectStoreNames,0).forEach(function(v){for(var g=l.objectStore(v),k=Li(Ol(Q=g.keyPath),Q||"",!0,!1,!!g.autoIncrement,Q&&typeof Q!="string",!0),S=[],q=0;q<g.indexNames.length;++q){var B=g.index(g.indexNames[q]),Q=B.keyPath,B=Li(B.name,Q,!!B.unique,!!B.multiEntry,!1,Q&&typeof Q!="string",!1);S.push(B)}u[v]=Ni(v,k,S)}),u}function Ys(r,s,l){for(var u=l.db.objectStoreNames,v=0;v<u.length;++v){var g=u[v],k=l.objectStore(g);r._hasGetAll="getAll"in k;for(var S=0;S<k.indexNames.length;++S){var q,Q=k.indexNames[S],B=k.index(Q).keyPath,B=typeof B=="string"?B:"["+de(B).join("+")+"]";s[g]&&(q=s[g].idxByName[B])&&(q.name=Q,delete s[g].idxByName[B],s[g].idxByName[Q]=q)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Dl(r){return r.split(",").map(function(s,l){var v=s.split(":"),u=(u=v[1])==null?void 0:u.trim(),v=(s=v[0].trim()).replace(/([&*]|\+\+)/g,""),g=/^\[/.test(v)?v.match(/^\[(.*)\]$/)[1].split("+"):v;return Li(v,g||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),f(g),l===0,u)})}Ia.prototype._createTableSchema=Ni,Ia.prototype._parseIndexSyntax=Dl,Ia.prototype._parseStoresSpec=function(r,s){var l=this;c(r).forEach(function(u){if(r[u]!==null){var v=l._parseIndexSyntax(r[u]),g=v.shift();if(!g)throw new M.Schema("Invalid schema for table "+u+": "+r[u]);if(g.unique=!0,g.multi)throw new M.Schema("Primary key cannot be multiEntry*");v.forEach(function(k){if(k.auto)throw new M.Schema("Only primary key can be marked as autoIncrement (++)");if(!k.keyPath)throw new M.Schema("Index must have a name and cannot be an empty string")}),g=l._createTableSchema(u,g,v),s[u]=g}})},Ia.prototype.stores=function(l){var s=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?m(this._cfg.storesSource,l):l,s._versions),u={},v={};return l.forEach(function(g){m(u,g._cfg.storesSource),v=g._cfg.dbschema={},g._parseStoresSpec(u,v)}),s._dbSchema=v,Bi(s,[s._allTables,s,s.Transaction.prototype]),Ws(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],c(v),v),s._storeNames=c(v),this},Ia.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Be(this._cfg.contentUpgrade||Ae,r),this};var qd=Ia;function Ia(){}function Ki(r,s){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new xr(gn,{addons:[],indexedDB:r,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Ui(r){return r&&typeof r.databases=="function"}function Gi(r){return Vn(function(){return Oe.letThrough=!0,r()})}function Wi(r){return!("from"in r)}var un=function(r,s){var l;if(!this)return l=new un,r&&"d"in r&&m(l,r),l;m(this,arguments.length?{d:1,from:r,to:1<arguments.length?s:r}:{d:0})};function ss(r,s,l){var u=ct(s,l);if(!isNaN(u)){if(0<u)throw RangeError();if(Wi(r))return m(r,{from:s,to:l,d:1});var u=r.l,v=r.r;if(ct(l,r.from)<0)return u?ss(u,s,l):r.l={from:s,to:l,d:1,l:null,r:null},Nl(r);if(0<ct(s,r.to))return v?ss(v,s,l):r.r={from:s,to:l,d:1,l:null,r:null},Nl(r);ct(s,r.from)<0&&(r.from=s,r.l=null,r.d=v?v.d+1:1),0<ct(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),s=!r.r,u&&!r.l&&is(r,u),v&&s&&is(r,v)}}function is(r,s){Wi(s)||(function l(u,v){var g=v.from,k=v.l,S=v.r;ss(u,g,v.to),k&&l(u,k),S&&l(u,S)})(r,s)}function Ll(r,s){var l=Qs(s),u=l.next();if(!u.done)for(var v=u.value,g=Qs(r),k=g.next(v.from),S=k.value;!u.done&&!k.done;){if(ct(S.from,v.to)<=0&&0<=ct(S.to,v.from))return!0;ct(v.from,S.from)<0?v=(u=l.next(S.from)).value:S=(k=g.next(v.from)).value}return!1}function Qs(r){var s=Wi(r)?null:{s:0,n:r};return{next:function(l){for(var u=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,u)for(;s.n.l&&ct(l,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!u||ct(l,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function Nl(r){var s,l,u,v=(((v=r.r)==null?void 0:v.d)||0)-(((v=r.l)==null?void 0:v.d)||0),v=1<v?"r":v<-1?"l":"";v&&(s=v=="r"?"l":"r",l=a({},r),u=r[v],r.from=u.from,r.to=u.to,r[v]=u[v],l[v]=u[s],(r[s]=l).d=ql(l)),r.d=ql(r)}function ql(l){var s=l.r,l=l.l;return(s?l?Math.max(s.d,l.d):s.d:l?l.d:0)+1}function Xs(r,s){return c(s).forEach(function(l){r[l]?is(r[l],s[l]):r[l]=(function u(v){var g,k,S={};for(g in v)y(v,g)&&(k=v[g],S[g]=!k||typeof k!="object"||ge.has(k.constructor)?k:u(k));return S})(s[l])}),r}function Hi(r,s){return r.all||s.all||Object.keys(r).some(function(l){return s[l]&&Ll(s[l],r[l])})}w(un.prototype,((Ye={add:function(r){return is(this,r),this},addKey:function(r){return ss(this,r,r),this},addKeys:function(r){var s=this;return r.forEach(function(l){return ss(s,l,l)}),this},hasKey:function(r){var s=Qs(this).next(r).value;return s&&ct(s.from,r)<=0&&0<=ct(s.to,r)}})[he]=function(){return Qs(this)},Ye));var $r={},Vi={},Yi=!1;function Zs(r){Xs(Vi,r),Yi||(Yi=!0,setTimeout(function(){Yi=!1,Qi(Vi,!(Vi={}))},0))}function Qi(r,s){s===void 0&&(s=!1);var l=new Set;if(r.all)for(var u=0,v=Object.values($r);u<v.length;u++)Bl(S=v[u],r,l,s);else for(var g in r){var k,S,g=/^idb\:\/\/(.*)\/(.*)\//.exec(g);g&&(k=g[1],g=g[2],S=$r["idb://".concat(k,"/").concat(g)])&&Bl(S,r,l,s)}l.forEach(function(q){return q()})}function Bl(r,s,l,u){for(var v=[],g=0,k=Object.entries(r.queries.query);g<k.length;g++){for(var S=k[g],q=S[0],Q=[],B=0,O=S[1];B<O.length;B++){var K=O[B];Hi(s,K.obsSet)?K.subscribers.forEach(function(J){return l.add(J)}):u&&Q.push(K)}u&&v.push([q,Q])}if(u)for(var W=0,z=v;W<z.length;W++){var N=z[W],q=N[0],Q=N[1];r.queries.query[q]=Q}}function Bd(r){var s=r._state,l=r._deps.indexedDB;if(s.isBeingOpened||r.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?Me(s.dbOpenError):r});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var u=s.openCanceller,v=Math.round(10*r.verno),g=!1;function k(){if(s.openCanceller!==u)throw new M.DatabaseClosed("db.open() was cancelled")}function S(){return new Ie(function(K,W){if(k(),!l)throw new M.MissingAPI;var z=r.name,N=s.autoSchema||!v?l.open(z):l.open(z,v);if(!N)throw new M.MissingAPI;N.onerror=dr(W),N.onblocked=Et(r._fireOnBlocked),N.onupgradeneeded=Et(function(J){var ne;B=N.transaction,s.autoSchema&&!r._options.allowEmptyDB?(N.onerror=ts,B.abort(),N.result.close(),(ne=l.deleteDatabase(z)).onsuccess=ne.onerror=Et(function(){W(new M.NoSuchDatabase("Database ".concat(z," doesnt exist")))})):(B.onerror=dr(W),ne=J.oldVersion>Math.pow(2,62)?0:J.oldVersion,O=ne<1,r.idbdb=N.result,g&&Nd(r,B),Ld(r,ne/10,B,W))},W),N.onsuccess=Et(function(){B=null;var J,ne,Y,ye,xe,je,De=r.idbdb=N.result,Se=de(De.objectStoreNames);if(0<Se.length)try{var ze=De.transaction((xe=Se).length===1?xe[0]:xe,"readonly");if(s.autoSchema)je=De,ye=ze,(Y=r).verno=je.version/10,ye=Y._dbSchema=Vs(0,je,ye),Y._storeNames=de(je.objectStoreNames,0),Ws(Y,[Y._allTables],c(ye),ye);else if(Ys(r,r._dbSchema,ze),ne=ze,((ne=zi(Vs(0,(J=r).idbdb,ne),J._dbSchema)).add.length||ne.change.some(function(Ne){return Ne.add.length||Ne.change.length}))&&!g)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),De.close(),v=De.version+1,g=!0,K(S());Gs(r,ze)}catch{}Gt.push(r),De.onversionchange=Et(function(Ne){s.vcFired=!0,r.on("versionchange").fire(Ne)}),De.onclose=Et(function(){r.close({disableAutoOpen:!1})}),O&&(Se=r._deps,xe=z,Ui(je=Se.indexedDB)||xe===gn||Ki(je,Se.IDBKeyRange).put({name:xe}).catch(Ae)),K()},W)}).catch(function(K){switch(K==null?void 0:K.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<v)return v=0,S()}return Ie.reject(K)})}var q,Q=s.dbReadyResolve,B=null,O=!1;return Ie.race([u,(typeof navigator>"u"?Ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(K){function W(){return indexedDB.databases().finally(K)}q=setInterval(W,100),W()}).finally(function(){return clearInterval(q)}):Promise.resolve()).then(S)]).then(function(){return k(),s.onReadyBeingFired=[],Ie.resolve(Gi(function(){return r.on.ready.fire(r.vip)})).then(function K(){var W;if(0<s.onReadyBeingFired.length)return W=s.onReadyBeingFired.reduce(Be,Ae),s.onReadyBeingFired=[],Ie.resolve(Gi(function(){return W(r.vip)})).then(K)})}).finally(function(){s.openCanceller===u&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(K){s.dbOpenError=K;try{B&&B.abort()}catch{}return u===s.openCanceller&&r._close(),Me(K)}).finally(function(){s.openComplete=!0,Q()}).then(function(){var K;return O&&(K={},r.tables.forEach(function(W){W.schema.indexes.forEach(function(z){z.name&&(K["idb://".concat(r.name,"/").concat(W.name,"/").concat(z.name)]=new un(-1/0,[[[]]]))}),K["idb://".concat(r.name,"/").concat(W.name,"/")]=K["idb://".concat(r.name,"/").concat(W.name,"/:dels")]=new un(-1/0,[[[]]])}),Lr(ns).fire(K),Qi(K,!0)),r})}function Xi(r){function s(g){return r.next(g)}var l=v(s),u=v(function(g){return r.throw(g)});function v(g){return function(S){var S=g(S),q=S.value;return S.done?q:q&&typeof q.then=="function"?q.then(l,u):f(q)?Promise.all(q).then(l,u):l(q)}}return v(s)()}function Js(r,s,l){for(var u=f(r)?r.slice():[r],v=0;v<l;++v)u.push(s);return u}var zd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(u){var l=r.table(u),u=l.schema,v={},g=[];function k(K,W,z){var Y=as(K),N=v[Y]=v[Y]||[],J=K==null?0:typeof K=="string"?1:K.length,ne=0<W,Y=a(a({},z),{name:ne?"".concat(Y,"(virtual-from:").concat(z.name,")"):z.name,lowLevelIndex:z,isVirtual:ne,keyTail:W,keyLength:J,extractKey:qi(K),unique:!ne&&z.unique});return N.push(Y),Y.isPrimaryKey||g.push(Y),1<J&&k(J===2?K[0]:K.slice(0,J-1),W+1,z),N.sort(function(ye,xe){return ye.keyTail-xe.keyTail}),Y}var S=k(u.primaryKey.keyPath,0,u.primaryKey);v[":id"]=[S];for(var q=0,Q=u.indexes;q<Q.length;q++){var B=Q[q];k(B.keyPath,0,B)}function O(K){var W,z=K.query.index;return z.isVirtual?a(a({},K),{query:{index:z.lowLevelIndex,range:(W=K.query.range,z=z.keyTail,{type:W.type===1?2:W.type,lower:Js(W.lower,W.lowerOpen?r.MAX_KEY:r.MIN_KEY,z),lowerOpen:!0,upper:Js(W.upper,W.upperOpen?r.MIN_KEY:r.MAX_KEY,z),upperOpen:!0})}}):K}return a(a({},l),{schema:a(a({},u),{primaryKey:S,indexes:g,getIndexByKeyPath:function(K){return(K=v[as(K)])&&K[0]}}),count:function(K){return l.count(O(K))},query:function(K){return l.query(O(K))},openCursor:function(K){var W=K.query.index,z=W.keyTail,N=W.keyLength;return W.isVirtual?l.openCursor(O(K)).then(function(ne){return ne&&J(ne)}):l.openCursor(K);function J(ne){return Object.create(ne,{continue:{value:function(Y){Y!=null?ne.continue(Js(Y,K.reverse?r.MAX_KEY:r.MIN_KEY,z)):K.unique?ne.continue(ne.key.slice(0,N).concat(K.reverse?r.MIN_KEY:r.MAX_KEY,z)):ne.continue()}},continuePrimaryKey:{value:function(Y,ye){ne.continuePrimaryKey(Js(Y,r.MAX_KEY,z),ye)}},primaryKey:{get:function(){return ne.primaryKey}},key:{get:function(){var Y=ne.key;return N===1?Y[0]:Y.slice(0,N)}},value:{get:function(){return ne.value}}})}}})}})}};function Zi(r,s,l,u){return l=l||{},u=u||"",c(r).forEach(function(v){var g,k,S;y(s,v)?(g=r[v],k=s[v],typeof g=="object"&&typeof k=="object"&&g&&k?(S=ie(g))!==ie(k)?l[u+v]=s[v]:S==="Object"?Zi(g,k,l,u+v+"."):g!==k&&(l[u+v]=s[v]):g!==k&&(l[u+v]=s[v])):l[u+v]=void 0}),c(s).forEach(function(v){y(r,v)||(l[u+v]=s[v])}),l}function Ji(r,s){return s.type==="delete"?s.keys:s.keys||s.values.map(r.extractKey)}var Fd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(s){var l=r.table(s),u=l.schema.primaryKey;return a(a({},l),{mutate:function(v){var g=Oe.trans,k=g.table(s).hook,S=k.deleting,q=k.creating,Q=k.updating;switch(v.type){case"add":if(q.fire===Ae)break;return g._promise("readwrite",function(){return B(v)},!0);case"put":if(q.fire===Ae&&Q.fire===Ae)break;return g._promise("readwrite",function(){return B(v)},!0);case"delete":if(S.fire===Ae)break;return g._promise("readwrite",function(){return B(v)},!0);case"deleteRange":if(S.fire===Ae)break;return g._promise("readwrite",function(){return(function O(K,W,z){return l.query({trans:K,values:!1,query:{index:u,range:W},limit:z}).then(function(N){var J=N.result;return B({type:"delete",keys:J,trans:K}).then(function(ne){return 0<ne.numFailures?Promise.reject(ne.failures[0]):J.length<z?{failures:[],numFailures:0,lastResult:void 0}:O(K,a(a({},W),{lower:J[J.length-1],lowerOpen:!0}),z)})})})(v.trans,v.range,1e4)},!0)}return l.mutate(v);function B(O){var K,W,z,N=Oe.trans,J=O.keys||Ji(u,O);if(J)return(O=O.type==="add"||O.type==="put"?a(a({},O),{keys:J}):a({},O)).type!=="delete"&&(O.values=i([],O.values)),O.keys&&(O.keys=i([],O.keys)),K=l,z=J,((W=O).type==="add"?Promise.resolve([]):K.getMany({trans:W.trans,keys:z,cache:"immutable"})).then(function(ne){var Y=J.map(function(ye,xe){var je,De,Se,ze=ne[xe],Ne={onerror:null,onsuccess:null};return O.type==="delete"?S.fire.call(Ne,ye,ze,N):O.type==="add"||ze===void 0?(je=q.fire.call(Ne,ye,O.values[xe],N),ye==null&&je!=null&&(O.keys[xe]=ye=je,u.outbound||D(O.values[xe],u.keyPath,ye))):(je=Zi(ze,O.values[xe]),(De=Q.fire.call(Ne,je,ye,ze,N))&&(Se=O.values[xe],Object.keys(De).forEach(function(Ce){y(Se,Ce)?Se[Ce]=De[Ce]:D(Se,Ce,De[Ce])}))),Ne});return l.mutate(O).then(function(ye){for(var xe=ye.failures,je=ye.results,De=ye.numFailures,ye=ye.lastResult,Se=0;Se<J.length;++Se){var ze=(je||J)[Se],Ne=Y[Se];ze==null?Ne.onerror&&Ne.onerror(xe[Se]):Ne.onsuccess&&Ne.onsuccess(O.type==="put"&&ne[Se]?O.values[Se]:ze)}return{failures:xe,results:je,numFailures:De,lastResult:ye}}).catch(function(ye){return Y.forEach(function(xe){return xe.onerror&&xe.onerror(ye)}),Promise.reject(ye)})});throw new Error("Keys missing")}}})}})}};function zl(r,s,l){try{if(!s||s.keys.length<r.length)return null;for(var u=[],v=0,g=0;v<s.keys.length&&g<r.length;++v)ct(s.keys[v],r[g])===0&&(u.push(l?_e(s.values[v]):s.values[v]),++g);return u.length===r.length?u:null}catch{return null}}var Kd={stack:"dbcore",level:-1,create:function(r){return{table:function(s){var l=r.table(s);return a(a({},l),{getMany:function(u){var v;return u.cache?(v=zl(u.keys,u.trans._cache,u.cache==="clone"))?Ie.resolve(v):l.getMany(u).then(function(g){return u.trans._cache={keys:u.keys,values:u.cache==="clone"?_e(g):g},g}):l.getMany(u)},mutate:function(u){return u.type!=="add"&&(u.trans._cache=null),l.mutate(u)}})}}}};function Fl(r,s){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function Kl(r,s){switch(r){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ud={stack:"dbcore",level:0,name:"Observability",create:function(r){var s=r.schema.name,l=new un(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(u,v,g){if(Oe.subscr&&v!=="readonly")throw new M.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Oe.querier));return r.transaction(u,v,g)},table:function(u){function v(J){var N,J=J.query;return[N=J.index,new un((N=(J=J.range).lower)!=null?N:r.MIN_KEY,(N=J.upper)!=null?N:r.MAX_KEY)]}var g=r.table(u),k=g.schema,S=k.primaryKey,q=k.indexes,Q=S.extractKey,B=S.outbound,O=S.autoIncrement&&q.filter(function(z){return z.compound&&z.keyPath.includes(S.keyPath)}),K=a(a({},g),{mutate:function(z){function N(Fe){return Fe="idb://".concat(s,"/").concat(u,"/").concat(Fe),xe[Fe]||(xe[Fe]=new un)}var J,ne,Y,ye=z.trans,xe=z.mutatedParts||(z.mutatedParts={}),je=N(""),De=N(":dels"),Se=z.type,Ne=z.type==="deleteRange"?[z.range]:z.type==="delete"?[z.keys]:z.values.length<50?[Ji(S,z).filter(function(Fe){return Fe}),z.values]:[],ze=Ne[0],Ne=Ne[1],Ce=z.trans._cache;return f(ze)?(je.addKeys(ze),(Se=Se==="delete"||ze.length===Ne.length?zl(ze,Ce):null)||De.addKeys(ze),(Se||Ne)&&(J=N,ne=Se,Y=Ne,k.indexes.forEach(function(Fe){var dt=J(Fe.name||"");function gt(tt){return tt!=null?Fe.extractKey(tt):null}function He(tt){Fe.multiEntry&&f(tt)?tt.forEach(function(zt){return dt.addKey(zt)}):dt.addKey(tt)}(ne||Y).forEach(function(tt,Ut){var Dn=ne&&gt(ne[Ut]),Ut=Y&&gt(Y[Ut]);ct(Dn,Ut)!==0&&(Dn!=null&&He(Dn),Ut!=null)&&He(Ut)})}))):ze?(Ne={from:(Ce=ze.lower)!=null?Ce:r.MIN_KEY,to:(Se=ze.upper)!=null?Se:r.MAX_KEY},De.add(Ne),je.add(Ne)):(je.add(l),De.add(l),k.indexes.forEach(function(Fe){return N(Fe.name).add(l)})),g.mutate(z).then(function(Fe){return!ze||z.type!=="add"&&z.type!=="put"||(je.addKeys(Fe.results),O&&O.forEach(function(dt){for(var gt=z.values.map(function(Dn){return dt.extractKey(Dn)}),He=dt.keyPath.findIndex(function(Dn){return Dn===S.keyPath}),tt=0,zt=Fe.results.length;tt<zt;++tt)gt[tt][He]=Fe.results[tt];N(dt.name).addKeys(gt)})),ye.mutatedParts=Xs(ye.mutatedParts||{},xe),Fe})}}),W={get:function(z){return[S,new un(z.key)]},getMany:function(z){return[S,new un().addKeys(z.keys)]},count:v,query:v,openCursor:v};return c(W).forEach(function(z){K[z]=function(N){var J=Oe.subscr,ne=!!J,Y=Fl(Oe,g)&&Kl(z,N)?N.obsSet={}:J;if(ne){var ye,J=function(Ne){return Ne="idb://".concat(s,"/").concat(u,"/").concat(Ne),Y[Ne]||(Y[Ne]=new un)},xe=J(""),je=J(":dels"),ne=W[z](N),De=ne[0],ne=ne[1];if((z==="query"&&De.isPrimaryKey&&!N.values?je:J(De.name||"")).add(ne),!De.isPrimaryKey){if(z!=="count")return ye=z==="query"&&B&&N.values&&g.query(a(a({},N),{values:!1})),g[z].apply(this,arguments).then(function(Ne){if(z==="query"){if(B&&N.values)return ye.then(function(gt){return gt=gt.result,xe.addKeys(gt),Ne});var Ce=N.values?Ne.result.map(Q):Ne.result;(N.values?xe:je).addKeys(Ce)}else{var Fe,dt;if(z==="openCursor")return dt=N.values,(Fe=Ne)&&Object.create(Fe,{key:{get:function(){return je.addKey(Fe.primaryKey),Fe.key}},primaryKey:{get:function(){var gt=Fe.primaryKey;return je.addKey(gt),gt}},value:{get:function(){return dt&&xe.addKey(Fe.primaryKey),Fe.value}}})}return Ne});je.add(l)}}return g[z].apply(this,arguments)}}),K}})}};function Ul(r,s,l){var u;return l.numFailures===0?s:s.type==="deleteRange"||(u=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1,l.numFailures===u)?null:(u=a({},s),f(u.keys)&&(u.keys=u.keys.filter(function(v,g){return!(g in l.failures)})),"values"in u&&f(u.values)&&(u.values=u.values.filter(function(v,g){return!(g in l.failures)})),u)}function $i(r,s){return l=r,((u=s).lower===void 0||(u.lowerOpen?0<ct(l,u.lower):0<=ct(l,u.lower)))&&(l=r,(u=s).upper===void 0||(u.upperOpen?ct(l,u.upper)<0:ct(l,u.upper)<=0));var l,u}function Gl(r,s,l,u,v,g){var k,S,q,Q,B,O;return!l||l.length===0||(k=s.query.index,S=k.multiEntry,q=s.query.range,Q=u.schema.primaryKey.extractKey,B=k.extractKey,O=(k.lowLevelIndex||k).extractKey,(u=l.reduce(function(K,W){var z=K,N=[];if(W.type==="add"||W.type==="put")for(var J=new un,ne=W.values.length-1;0<=ne;--ne){var Y,ye=W.values[ne],xe=Q(ye);!J.hasKey(xe)&&(Y=B(ye),S&&f(Y)?Y.some(function(Ne){return $i(Ne,q)}):$i(Y,q))&&(J.addKey(xe),N.push(ye))}switch(W.type){case"add":var je=new un().addKeys(s.values?K.map(function(Ce){return Q(Ce)}):K),z=K.concat(s.values?N.filter(function(Ce){return Ce=Q(Ce),!je.hasKey(Ce)&&(je.addKey(Ce),!0)}):N.map(function(Ce){return Q(Ce)}).filter(function(Ce){return!je.hasKey(Ce)&&(je.addKey(Ce),!0)}));break;case"put":var De=new un().addKeys(W.values.map(function(Ce){return Q(Ce)}));z=K.filter(function(Ce){return!De.hasKey(s.values?Q(Ce):Ce)}).concat(s.values?N:N.map(function(Ce){return Q(Ce)}));break;case"delete":var Se=new un().addKeys(W.keys);z=K.filter(function(Ce){return!Se.hasKey(s.values?Q(Ce):Ce)});break;case"deleteRange":var ze=W.range;z=K.filter(function(Ce){return!$i(Q(Ce),ze)})}return z},r))===r)?r:(u.sort(function(K,W){return ct(O(K),O(W))||ct(Q(K),Q(W))}),s.limit&&s.limit<1/0&&(u.length>s.limit?u.length=s.limit:r.length===s.limit&&u.length<s.limit&&(v.dirty=!0)),g?Object.freeze(u):u)}function Wl(r,s){return ct(r.lower,s.lower)===0&&ct(r.upper,s.upper)===0&&!!r.lowerOpen==!!s.lowerOpen&&!!r.upperOpen==!!s.upperOpen}function Gd(r,s){return((l,u,v,g)=>{if(l===void 0)return u!==void 0?-1:0;if(u===void 0)return 1;if((l=ct(l,u))===0){if(v&&g)return 0;if(v)return 1;if(g)return-1}return l})(r.lower,s.lower,r.lowerOpen,s.lowerOpen)<=0&&0<=((l,u,v,g)=>{if(l===void 0)return u!==void 0?1:0;if(u===void 0)return-1;if((l=ct(l,u))===0){if(v&&g)return 0;if(v)return-1;if(g)return 1}return l})(r.upper,s.upper,r.upperOpen,s.upperOpen)}function Wd(r,s,l,u){r.subscribers.add(l),u.addEventListener("abort",function(){var v,g;r.subscribers.delete(l),r.subscribers.size===0&&(v=r,g=s,setTimeout(function(){v.subscribers.size===0&&oe(g,v)},3e3))})}var Hd={stack:"dbcore",level:0,name:"Cache",create:function(r){var s=r.schema.name;return a(a({},r),{transaction:function(l,u,v){var g,k,S=r.transaction(l,u,v);return u==="readwrite"&&(v=(g=new AbortController).signal,S.addEventListener("abort",(k=function(q){return function(){if(g.abort(),u==="readwrite"){for(var Q=new Set,B=0,O=l;B<O.length;B++){var K=O[B],W=$r["idb://".concat(s,"/").concat(K)];if(W){var z=r.table(K),N=W.optimisticOps.filter(function(Fe){return Fe.trans===S});if(S._explicit&&q&&S.mutatedParts)for(var J=0,ne=Object.values(W.queries.query);J<ne.length;J++)for(var Y=0,ye=(De=ne[J]).slice();Y<ye.length;Y++)Hi((Se=ye[Y]).obsSet,S.mutatedParts)&&(oe(De,Se),Se.subscribers.forEach(function(Fe){return Q.add(Fe)}));else if(0<N.length){W.optimisticOps=W.optimisticOps.filter(function(Fe){return Fe.trans!==S});for(var xe=0,je=Object.values(W.queries.query);xe<je.length;xe++)for(var De,Se,ze,Ne=0,Ce=(De=je[xe]).slice();Ne<Ce.length;Ne++)(Se=Ce[Ne]).res!=null&&S.mutatedParts&&(q&&!Se.dirty?(ze=Object.isFrozen(Se.res),ze=Gl(Se.res,Se.req,N,z,Se,ze),Se.dirty?(oe(De,Se),Se.subscribers.forEach(function(Fe){return Q.add(Fe)})):ze!==Se.res&&(Se.res=ze,Se.promise=Ie.resolve({result:ze}))):(Se.dirty&&oe(De,Se),Se.subscribers.forEach(function(Fe){return Q.add(Fe)})))}}}Q.forEach(function(Fe){return Fe()})}}})(!1),{signal:v}),S.addEventListener("error",k(!1),{signal:v}),S.addEventListener("complete",k(!0),{signal:v})),S},table:function(l){var u=r.table(l),v=u.schema.primaryKey;return a(a({},u),{mutate:function(g){var k,S=Oe.trans;return!v.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(k=$r["idb://".concat(s,"/").concat(l)])?(S=u.mutate(g),g.type!=="add"&&g.type!=="put"||!(50<=g.values.length||Ji(v,g).some(function(q){return q==null}))?(k.optimisticOps.push(g),g.mutatedParts&&Zs(g.mutatedParts),S.then(function(q){0<q.numFailures&&(oe(k.optimisticOps,g),(q=Ul(0,g,q))&&k.optimisticOps.push(q),g.mutatedParts)&&Zs(g.mutatedParts)}),S.catch(function(){oe(k.optimisticOps,g),g.mutatedParts&&Zs(g.mutatedParts)})):S.then(function(q){var Q=Ul(0,a(a({},g),{values:g.values.map(function(B,O){var K;return q.failures[O]?B:(D(K=(K=v.keyPath)!=null&&K.includes(".")?_e(B):a({},B),v.keyPath,q.results[O]),K)})}),q);k.optimisticOps.push(Q),queueMicrotask(function(){return g.mutatedParts&&Zs(g.mutatedParts)})}),S):u.mutate(g)},query:function(g){var k,S,q,Q,B,O,K;return Fl(Oe,u)&&Kl("query",g)?(k=((q=Oe.trans)==null?void 0:q.db._options.cache)==="immutable",S=(q=Oe).requery,q=q.signal,O=((W,z,N,J)=>{var ne=$r["idb://".concat(W,"/").concat(z)];if(!ne)return[];if(!(W=ne.queries[N]))return[null,!1,ne,null];var Y=W[(J.query?J.query.index.name:null)||""];if(!Y)return[null,!1,ne,null];switch(N){case"query":var ye=Y.find(function(xe){return xe.req.limit===J.limit&&xe.req.values===J.values&&Wl(xe.req.query.range,J.query.range)});return ye?[ye,!0,ne,Y]:[Y.find(function(xe){return("limit"in xe.req?xe.req.limit:1/0)>=J.limit&&(!J.values||xe.req.values)&&Gd(xe.req.query.range,J.query.range)}),!1,ne,Y];case"count":return ye=Y.find(function(xe){return Wl(xe.req.query.range,J.query.range)}),[ye,!!ye,ne,Y]}})(s,l,"query",g),K=O[0],Q=O[2],B=O[3],K&&O[1]?K.obsSet=g.obsSet:(O=u.query(g).then(function(W){var z=W.result;if(K&&(K.res=z),k){for(var N=0,J=z.length;N<J;++N)Object.freeze(z[N]);Object.freeze(z)}else W.result=_e(z);return W}).catch(function(W){return B&&K&&oe(B,K),Promise.reject(W)}),K={obsSet:g.obsSet,promise:O,subscribers:new Set,type:"query",req:g,dirty:!1},B?B.push(K):(B=[K],(Q=Q||($r["idb://".concat(s,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[g.query.index.name||""]=B)),Wd(K,B,S,q),K.promise.then(function(W){return{result:Gl(W.result,g,Q==null?void 0:Q.optimisticOps,u,K,k)}})):u.query(g)}})}})}};function $s(r,s){return new Proxy(r,{get:function(l,u,v){return u==="db"?s:Reflect.get(l,u,v)}})}Wt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new M.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new M.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var s=this._versions,l=s.filter(function(u){return u._cfg.version===r})[0];return l||(l=new this.Version(r),s.push(l),s.sort(Dd),l.stores({}),this._state.autoSchema=!1),l},Wt.prototype._whenReady=function(r){var s=this;return this.idbdb&&(this._state.openComplete||Oe.letThrough||this._vip)?r():new Ie(function(l,u){if(s._state.openComplete)return u(new M.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void u(new M.DatabaseClosed);s.open().catch(Ae)}s._state.dbReadyPromise.then(l,u)}).then(r)},Wt.prototype.use=function(v){var s=v.stack,l=v.create,u=v.level,v=v.name,g=(v&&this.unuse({stack:s,name:v}),this._middlewares[s]||(this._middlewares[s]=[]));return g.push({stack:s,create:l,level:u??10,name:v}),g.sort(function(k,S){return k.level-S.level}),this},Wt.prototype.unuse=function(r){var s=r.stack,l=r.name,u=r.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(v){return u?v.create!==u:!!l&&v.name!==l})),this},Wt.prototype.open=function(){var r=this;return Ke(at,function(){return Bd(r)})},Wt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,s=Gt.indexOf(this);if(0<=s&&Gt.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Ie(function(l){r.dbReadyResolve=l}),r.openCanceller=new Ie(function(l,u){r.cancelOpen=u}))},Wt.prototype.close=function(s){var s=(s===void 0?{disableAutoOpen:!0}:s).disableAutoOpen,l=this._state;s?(l.isBeingOpened&&l.cancelOpen(new M.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new M.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Wt.prototype.delete=function(r){var s=this,l=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),u=this._state;return new Ie(function(v,g){function k(){s.close(r);var S=s._deps.indexedDB.deleteDatabase(s.name);S.onsuccess=Et(function(){var q,Q,B;q=s._deps,Q=s.name,Ui(B=q.indexedDB)||Q===gn||Ki(B,q.IDBKeyRange).delete(Q).catch(Ae),v()}),S.onerror=dr(g),S.onblocked=s._fireOnBlocked}if(l)throw new M.InvalidArgument("Invalid closeOptions argument to db.delete()");u.isBeingOpened?u.dbReadyPromise.then(k):k()})},Wt.prototype.backendDB=function(){return this.idbdb},Wt.prototype.isOpen=function(){return this.idbdb!==null},Wt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Wt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Wt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Wt.prototype,"tables",{get:function(){var r=this;return c(this._allTables).map(function(s){return r._allTables[s]})},enumerable:!1,configurable:!0}),Wt.prototype.transaction=function(){var r=(function(s,l,u){var v=arguments.length;if(v<2)throw new M.InvalidArgument("Too few arguments");for(var g=new Array(v-1);--v;)g[v-1]=arguments[v];return u=g.pop(),[s,ue(g),u]}).apply(this,arguments);return this._transaction.apply(this,r)},Wt.prototype._transaction=function(r,s,l){var u,v,g=this,k=Oe.trans,S=(k&&k.db===this&&r.indexOf("!")===-1||(k=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(v=s.map(function(Q){if(Q=Q instanceof g.Table?Q.name:Q,typeof Q!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Q}),r=="r"||r===ur)u=ur;else{if(r!="rw"&&r!=Zr)throw new M.InvalidArgument("Invalid transaction mode: "+r);u=Zr}if(k){if(k.mode===ur&&u===Zr){if(!S)throw new M.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&v.forEach(function(Q){if(k&&k.storeNames.indexOf(Q)===-1){if(!S)throw new M.SubTransaction("Table "+Q+" not included in parent transaction.");k=null}}),S&&k&&!k.active&&(k=null)}}catch(Q){return k?k._promise(null,function(B,O){O(Q)}):Me(Q)}var q=(function Q(B,O,K,W,z){return Ie.resolve().then(function(){var Y=Oe.transless||Oe,N=B._createTransaction(O,K,B._dbSchema,W),Y=(N.explicit=!0,{trans:N,transless:Y});if(W)N.idbtrans=W.idbtrans;else try{N.create(),N.idbtrans._explicit=!0,B._state.PR1398_maxLoop=3}catch(ye){return ye.name===Te.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return Q(B,O,K,null,z)})):Me(ye)}var J,ne=le(z),Y=(ne&&cn(),Ie.follow(function(){var ye;(J=z.call(N,N))&&(ne?(ye=Yn.bind(null,null),J.then(ye,ye)):typeof J.next=="function"&&typeof J.throw=="function"&&(J=Xi(J)))},Y));return(J&&typeof J.then=="function"?Ie.resolve(J).then(function(ye){return N.active?ye:Me(new M.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Y.then(function(){return J})).then(function(ye){return W&&N._resolve(),N._completion.then(function(){return ye})}).catch(function(ye){return N._reject(ye),Me(ye)})})}).bind(null,this,u,v,k,l);return k?k._promise(u,q,"lock"):Oe.trans?Ke(Oe.transless,function(){return g._whenReady(q)}):this._whenReady(q)},Wt.prototype.table=function(r){if(y(this._allTables,r))return this._allTables[r];throw new M.InvalidTable("Table ".concat(r," does not exist"))};var xr=Wt;function Wt(r,s){var l,u,v,g,k,S=this,q=(this._middlewares={},this.verno=0,Wt.dependencies),q=(this._options=s=a({addons:Wt.addons,autoOpen:!0,indexedDB:q.indexedDB,IDBKeyRange:q.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},s.addons),Q=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Ae,dbReadyPromise:null,cancelOpen:Ae,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen}),B=(Q.dbReadyPromise=new Ie(function(O){Q.dbReadyResolve=O}),Q.openCanceller=new Ie(function(O,K){Q.cancelOpen=K}),this._state=Q,this.name=r,this.on=$a(this,"populate","blocked","versionchange","close",{ready:[Be,Ae]}),this.once=function(O,K){var W=function(){for(var z=[],N=0;N<arguments.length;N++)z[N]=arguments[N];S.on(O).unsubscribe(W),K.apply(S,z)};return S.on(O,W)},this.on.ready.subscribe=Z(this.on.ready.subscribe,function(O){return function(K,W){Wt.vip(function(){var z,N=S._state;N.openComplete?(N.dbOpenError||Ie.resolve().then(K),W&&O(K)):N.onReadyBeingFired?(N.onReadyBeingFired.push(K),W&&O(K)):(O(K),z=S,W||O(function J(){z.on.ready.unsubscribe(K),z.on.ready.unsubscribe(J)}))})}}),this.Collection=(l=this,es(Cd.prototype,function(J,N){this.db=l;var W=Za,z=null;if(N)try{W=N()}catch(Y){z=Y}var N=J._ctx,J=N.table,ne=J.hook.reading.fire;this._ctx={table:J,index:N.index,isPrimKey:!N.index||J.schema.primKey.keyPath&&N.index===J.schema.primKey.name,range:W,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:z,or:N.or,valueMapper:ne!==qe?ne:null}})),this.Table=(u=this,es(Tl.prototype,function(O,K,W){this.db=u,this._tx=W,this.name=O,this.schema=K,this.hook=u._allTables[O]?u._allTables[O].hook:$a(null,{creating:[xt,Ae],reading:[Qe,qe],updating:[At,Ae],deleting:[Tt,Ae]})})),this.Transaction=(v=this,es(Rd.prototype,function(O,K,W,z,N){var J=this;O!=="readonly"&&K.forEach(function(ne){ne=(ne=W[ne])==null?void 0:ne.yProps,ne&&(K=K.concat(ne.map(function(Y){return Y.updatesTable})))}),this.db=v,this.mode=O,this.storeNames=K,this.schema=W,this.chromeTransactionDurability=z,this.idbtrans=null,this.on=$a(this,"complete","error","abort"),this.parent=N||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(function(ne,Y){J._resolve=ne,J._reject=Y}),this._completion.then(function(){J.active=!1,J.on.complete.fire()},function(ne){var Y=J.active;return J.active=!1,J.on.error.fire(ne),J.parent?J.parent._reject(ne):Y&&J.idbtrans&&J.idbtrans.abort(),Me(ne)})})),this.Version=(g=this,es(qd.prototype,function(O){this.db=g,this._cfg={version:O,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,es(Rl.prototype,function(O,K,W){if(this.db=k,this._ctx={table:O,index:K===":id"?null:K,or:W},this._cmp=this._ascending=ct,this._descending=function(z,N){return ct(N,z)},this._max=function(z,N){return 0<ct(z,N)?z:N},this._min=function(z,N){return ct(z,N)<0?z:N},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new M.MissingAPI})),this.on("versionchange",function(O){0<O.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(O){!O.newVersion||O.newVersion<O.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(O.oldVersion/10))}),this._maxKey=rs(s.IDBKeyRange),this._createTransaction=function(O,K,W,z){return new S.Transaction(O,K,W,S._options.chromeTransactionDurability,z)},this._fireOnBlocked=function(O){S.on("blocked").fire(O),Gt.filter(function(K){return K.name===S.name&&K!==S&&!K._state.vcFired}).map(function(K){return K.on("versionchange").fire(O)})},this.use(Kd),this.use(Hd),this.use(Ud),this.use(zd),this.use(Fd),new Proxy(this,{get:function(O,K,W){var z;return K==="_vip"||(K==="table"?function(N){return $s(S.table(N),B)}:(z=Reflect.get(O,K,W))instanceof Tl?$s(z,B):K==="tables"?z.map(function(N){return $s(N,B)}):K==="_createTransaction"?function(){return $s(z.apply(this,arguments),B)}:z)}}));this.vip=B,q.forEach(function(O){return O(S)})}var ei,Ra=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Vd=(eo.prototype.subscribe=function(r,s,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:s,complete:l})},eo.prototype[Ra]=function(){return this},eo);function eo(r){this._subscribe=r}try{ei={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{ei={indexedDB:null,IDBKeyRange:null}}function Hl(r){var s,l=!1,u=new Vd(function(v){var g=le(r),k,S=!1,q={},Q={},B={get closed(){return S},unsubscribe:function(){S||(S=!0,k&&k.abort(),O&&Lr.storagemutated.unsubscribe(W))}},O=(v.start&&v.start(B),!1),K=function(){return Ee(z)},W=function(N){Xs(q,N),Hi(Q,q)&&K()},z=function(){var N,J,ne;!S&&ei.indexedDB&&(q={},N={},k&&k.abort(),k=new AbortController,ne=(Y=>{var ye=lr();try{g&&cn();var xe=Vn(r,Y);return xe=g?xe.finally(Yn):xe}finally{ye&&Sn()}})(J={subscr:N,signal:k.signal,requery:K,querier:r,trans:null}),Promise.resolve(ne).then(function(Y){l=!0,s=Y,S||J.signal.aborted||(q={},(ye=>{for(var xe in ye)if(y(ye,xe))return;return 1})(Q=N)||O||(Lr(ns,W),O=!0),Ee(function(){return!S&&v.next&&v.next(Y)}))},function(Y){l=!1,["DatabaseClosedError","AbortError"].includes(Y==null?void 0:Y.name)||S||Ee(function(){S||v.error&&v.error(Y)})}))};return setTimeout(K,0),B});return u.hasValue=function(){return l},u.getValue=function(){return s},u}var ea=xr;function to(r){var s=Nr;try{Nr=!0,Lr.storagemutated.fire(r),Qi(r,!0)}finally{Nr=s}}w(ea,a(a({},te),{delete:function(r){return new ea(r,{addons:[]}).delete()},exists:function(r){return new ea(r,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return s=ea.dependencies,l=s.indexedDB,s=s.IDBKeyRange,(Ui(l)?Promise.resolve(l.databases()).then(function(u){return u.map(function(v){return v.name}).filter(function(v){return v!==gn})}):Ki(l,s).toCollection().primaryKeys()).then(r)}catch{return Me(new M.MissingAPI)}var s,l},defineClass:function(){return function(r){m(this,r)}},ignoreTransaction:function(r){return Oe.trans?Ke(Oe.transless,r):r()},vip:Gi,async:function(r){return function(){try{var s=Xi(r.apply(this,arguments));return s&&typeof s.then=="function"?s:Ie.resolve(s)}catch(l){return Me(l)}}},spawn:function(r,s,l){try{var u=Xi(r.apply(l,s||[]));return u&&typeof u.then=="function"?u:Ie.resolve(u)}catch(v){return Me(v)}},currentTransaction:{get:function(){return Oe.trans||null}},waitFor:function(r,s){return r=Ie.resolve(typeof r=="function"?ea.ignoreTransaction(r):r).timeout(s||6e4),Oe.trans?Oe.trans.waitFor(r):r},Promise:Ie,debug:{get:function(){return Ge},set:function(r){pt(r)}},derive:G,extend:m,props:w,override:Z,Events:$a,on:Lr,liveQuery:Hl,extendObservabilitySet:Xs,getByKeyPath:ce,setByKeyPath:D,delByKeyPath:function(r,s){typeof s=="string"?D(r,s,void 0):"length"in s&&[].map.call(s,function(l){D(r,l,void 0)})},shallowClone:pe,deepClone:_e,getObjectDiff:Zi,cmp:ct,asap:X,minKey:-1/0,addons:[],connections:Gt,errnames:Te,dependencies:ei,cache:$r,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,s,l){return r+s/Math.pow(10,2*l)})})),ea.maxKey=rs(ea.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Lr(ns,function(r){Nr||(r=new CustomEvent(Di,{detail:r}),Nr=!0,dispatchEvent(r),Nr=!1)}),addEventListener(Di,function(r){r=r.detail,Nr||to(r)}));var Oa,Nr=!1,Vl=function(){};return typeof BroadcastChannel<"u"&&((Vl=function(){(Oa=new BroadcastChannel(Di)).onmessage=function(r){return r.data&&to(r.data)}})(),typeof Oa.unref=="function"&&Oa.unref(),Lr(ns,function(r){Nr||Oa.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!xr.disableBfCache&&r.persisted){Ge&&console.debug("Dexie: handling persisted pagehide"),Oa!=null&&Oa.close();for(var s=0,l=Gt;s<l.length;s++)l[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!xr.disableBfCache&&r.persisted&&(Ge&&console.debug("Dexie: handling persisted pageshow"),Vl(),to({all:new un(-1/0,[[]])}))})),Ie.rejectionMapper=function(r,s){return!r||r instanceof T||r instanceof TypeError||r instanceof SyntaxError||!r.name||!we[r.name]?r:(s=new we[r.name](s||r.message,r),"stack"in r&&I(s,"stack",{get:function(){return this.inner.stack}}),s)},pt(Ge),a(xr,Object.freeze({__proto__:null,Dexie:xr,Entity:wl,PropModification:Ja,RangeSet:un,add:function(r){return new Ja({add:r})},cmp:ct,default:xr,liveQuery:Hl,mergeRanges:is,rangesOverlap:Ll,remove:function(r){return new Ja({remove:r})},replacePrefix:function(r,s){return new Ja({replacePrefix:[r,s]})}}),{default:xr}),xr})})(vi)),vi.exports}var zv=Bv();const Ro=Nv(zv),fc=Symbol.for("Dexie"),fn=globalThis[fc]||(globalThis[fc]=Ro);if(Ro.semVer!==fn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Ro.semVer} and ${fn.semVer}`);const{liveQuery:Jb,mergeRanges:$b,rangesOverlap:e1,RangeSet:t1,cmp:n1,Entity:r1,PropModification:a1,replacePrefix:s1,add:i1,remove:o1,DexieYProvider:l1}=fn,Ue=new fn("me-ai-store");Ue.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Ue.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Ue.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Ue.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});function sl(t,e){return`${t}:${e}`}const Fv=Object.freeze(Object.defineProperty({__proto__:null,db:Ue,makeItemId:sl},Symbol.toStringTag,{value:"Module"}));function Oo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function fo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),i=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return i.toFixed(o)+" "+n[a]}function Kv(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Uv(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Ci(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const Gv="https://gmail.googleapis.com/gmail/v1/users/me";class il extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function Wv(t){return{Authorization:`Bearer ${t}`}}async function Pi(t,e){var a,i,o,c;const n=await fetch(`${Gv}${e}`,{headers:Wv(t)});if(!n.ok){const f=await n.json().catch(()=>({})),m=((a=f.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,h=((c=(o=(i=f.error)==null?void 0:i.errors)==null?void 0:o[0])==null?void 0:c.reason)||void 0;throw new il(m,n.status,h)}return n.json()}function Fu(t){return Pi(t,"/profile")}function Ku(t,{maxResults:e=20,pageToken:n,q:a}={}){const i=new URLSearchParams;return i.set("maxResults",String(e)),n&&i.set("pageToken",n),a&&i.set("q",a),Pi(t,`/messages?${i}`)}function Uu(t,e,n="full"){return Pi(t,`/messages/${e}?format=${n}`)}function Hv(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const i=new URLSearchParams;return i.set("startHistoryId",e),i.set("maxResults",String(a)),i.append("historyTypes","messageAdded"),i.append("historyTypes","messageDeleted"),n&&i.set("pageToken",n),Pi(t,`/history?${i}`)}function Br(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),i=n.find(c=>c.name.toLowerCase()===a);return(i==null?void 0:i.value)||""}function ws(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),i=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(i)}function Vv(t){var o,c,f;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return ws(e.body.data);const n=e.parts||[],a=mi(n,"text/plain");if((c=a==null?void 0:a.body)!=null&&c.data)return ws(a.body.data);const i=mi(n,"text/html");if((f=i==null?void 0:i.body)!=null&&f.data){const m=ws(i.body.data);return Qv(m)}return"(no body)"}function Yv(t){var i,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((i=e.body)!=null&&i.data))return ws(e.body.data);const n=e.parts||[],a=mi(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?ws(a.body.data):null}function mi(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=mi(n.parts,e);if(a)return a}}return null}function Qv(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function ol(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function Gu(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function Wu(t){return Gu(t).charAt(0).toUpperCase()}function Xv(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${i}`}catch{return"email"}}function Zv(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function Hu(t,e){return`${Xv(t.date)}_${Zv(t.subject)}.${e}`}function Vu(t){const e={};for(const a of t){const i=a.action||"UNKNOWN";e[i]||(e[i]=[]),e[i].push(a)}for(const a of Object.keys(e))e[a].sort((i,o)=>(o.date||0)-(i.date||0));const n=Object.keys(e).sort((a,i)=>e[i].length-e[a].length);return{groups:e,order:n}}async function Jv(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:i}=await Yu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),c=new Date(i.date).toLocaleDateString();n.push(`Date range: ${o} to ${c}.`)}return n.join(" ")}async function $v(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:i}=await Yu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),c=new Date(i.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${c}`)}return n.join(`
`)}async function ep(t=10){const e=await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(Qu).join(`

---

`)}async function tp(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),i=(await Ue.items.where("sourceType").equals("gmail").toArray()).map(o=>{var f,m,h,b,y;let c=0;return(f=o.subject)!=null&&f.toLowerCase().includes(n)&&(c+=3),(m=o.from)!=null&&m.toLowerCase().includes(n)&&(c+=2),(h=o.to)!=null&&h.toLowerCase().includes(n)&&(c+=2),(b=o.snippet)!=null&&b.toLowerCase().includes(n)&&(c+=1),(y=o.body)!=null&&y.toLowerCase().includes(n)&&(c+=1),{item:o,score:c}}).filter(({score:o})=>o>0).sort((o,c)=>c.score-o.score).slice(0,e);return i.length===0?`No results found for "${t}".`:i.map(({item:o})=>Qu(o)).join(`

---

`)}async function vc(){const t=await Ue.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=Vu(t);return{groups:e,order:n,total:t.length}}async function np({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),c=await Ue.items.where("sourceType").equals("gmail").filter(f=>{var m,h,b,y;return((m=f.subject)==null?void 0:m.toLowerCase().includes(o))||((h=f.from)==null?void 0:h.toLowerCase().includes(o))||((b=f.to)==null?void 0:b.toLowerCase().includes(o))||((y=f.snippet)==null?void 0:y.toLowerCase().includes(o))}).toArray();return c.sort((f,m)=>(m.date||0)-(f.date||0)),{items:c.slice(n,n+e),total:c.length}}const a=await Ue.items.where("sourceType").equals("gmail").count();return{items:await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function Yu(){const t=await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).first(),e=await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).last();return{oldest:t,newest:e}}function Qu(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=Uv(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function rp(){const t=await Jv();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function ap(t){const e=[],n=await $v();if(e.push(n),t){const a=await tp(t,5);e.push("","## Relevant Emails",a)}else{const a=await ep(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const sp="modulepreload",ip=function(t){return"/me-ai/"+t},pc={},Mo=function(e,n,a){let i=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(b=>Promise.resolve(b).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),m=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));i=c(n.map(h=>{if(h=ip(h),h in pc)return;pc[h]=!0;const b=h.endsWith(".css"),y=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const w=document.createElement("link");if(w.rel=b?"stylesheet":sp,b||(w.as="script"),w.crossOrigin="",w.href=h,m&&w.setAttribute("nonce",m),document.head.appendChild(w),b)return new Promise((x,I)=>{w.addEventListener("load",x),w.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return i.then(c=>{for(const f of c||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},Xu="me-ai-action-pipelines",Zu={REPLY:[{id:"draft_reply",name:"Draft Reply",description:"Generate a reply draft using LLM",icon:"âï¸"},{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"}],FOLLOW_UP:[{id:"draft_follow_up",name:"Draft Follow-up",description:"Generate a follow-up message",icon:"âï¸"},{id:"set_reminder",name:"Set Reminder",description:"Remind me to follow up",icon:"â°"}],DELETE:[{id:"confirm_delete",name:"Delete",description:"Confirm deletion",icon:"ðï¸"}],ARCHIVE:[{id:"confirm_archive",name:"Archive",description:"Move to archive",icon:"ð¦"}],READ_LATER:[{id:"snooze",name:"Snooze",description:"Remind me later",icon:"â°"},{id:"summarize",name:"Summarize",description:"Get a quick LLM summary",icon:"ð"}],REVIEW:[{id:"summarize",name:"Summarize",description:"Get a quick LLM summary",icon:"ð"},{id:"mark_done",name:"Mark Done",description:"Mark as reviewed",icon:"â"}],PAY_BILL:[{id:"extract_amount",name:"Extract Details",description:"Extract payment amount and due date",icon:"ð°"},{id:"set_reminder",name:"Set Reminder",description:"Remind me before due date",icon:"â°"},{id:"mark_done",name:"Mark Paid",description:"Mark as paid",icon:"â"}],TRACK_DELIVERY:[{id:"extract_tracking",name:"Extract Tracking",description:"Find tracking number and carrier",icon:"ð¦"},{id:"set_reminder",name:"Set Reminder",description:"Remind me to check delivery",icon:"â°"},{id:"mark_done",name:"Mark Delivered",description:"Mark as delivered",icon:"â"}],SCHEDULE_MEETING:[{id:"extract_details",name:"Extract Details",description:"Extract meeting time, location, attendees",icon:"ð"},{id:"draft_reply",name:"Confirm/Decline",description:"Draft a response",icon:"âï¸"}],UNSUBSCRIBE:[{id:"find_unsubscribe",name:"Find Unsubscribe Link",description:"Locate unsubscribe URL in email",icon:"ð"},{id:"confirm_delete",name:"Delete",description:"Delete this email",icon:"ðï¸"}],SAVE_RECEIPT:[{id:"extract_amount",name:"Extract Details",description:"Extract amount, vendor, date",icon:"ð§¾"},{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"}],ACKNOWLEDGE:[{id:"mark_done",name:"Acknowledge",description:"Mark as acknowledged",icon:"â"}],NO_ACTION:[{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"}],IGNORE:[{id:"confirm_delete",name:"Delete",description:"Delete this email",icon:"ðï¸"}]},Ju=[{id:"mark_done",name:"Mark Done",description:"Mark as handled",icon:"â"}];function Ds(){try{const t=localStorage.getItem(Xu);return t?JSON.parse(t):{}}catch{return{}}}function $u(t){localStorage.setItem(Xu,JSON.stringify(t))}function Ii(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=Ds();return n[e]?n[e]:Zu[e]||Ju}const ja=Ii;function op(){const t=Ds();return[...new Set([...Object.keys(Zu),...Object.keys(t)])]}async function lp(){try{const{db:t}=await Mo(async()=>{const{db:a}=await Promise.resolve().then(()=>Fv);return{db:a}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(a=>a.action).filter(Boolean))].sort()}catch{return[]}}async function cp(){const t=op(),e=await lp();return[...new Set([...t,...e])].sort()}function Ls(t,e){const n=t.toUpperCase(),a=Ds();a[n]=e,$u(a)}const up=Ls;function dp(t,e){const n=Ii(t);Ls(t,[...n,e])}const fp=dp;function vp(t,e){const n=Ii(t);Ls(t,n.filter(a=>a.id!==e))}const pp=vp;function hp(t,e,n){const a=Ii(t);Ls(t,a.map(i=>i.id===e?{...i,...n}:i))}const mp=hp;function gp(t,e){const n=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");n&&Ls(n,[...Ju])}function _p(t){const e=t.toUpperCase(),n=Ds();delete n[e],$u(n)}function yp(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=Ds();return e in n}function bp(t){_p(t)}function wp(t,e){var i;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((i=e.body)==null?void 0:i.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=ja(t.action);return{event:n,commands:a}}function kp(t){return{role:"assistant",type:"event-batch",items:t.filter(n=>n.success&&n.classification).map(n=>{const{event:a,commands:i}=wp(n.classification,n.email);return{event:a,commands:i}}),content:""}}function xp(t){const e=t.order.map(a=>{const i=t.groups[a]||[],o=ja(a),c=i.map(f=>({emailId:f.emailId,subject:f.subject||"(no subject)",from:f.from||"",date:f.date,summary:f.summary||"",reason:f.reason||"",tags:f.tags||[],status:f.status||"pending"}));return{eventType:a,emails:c,commands:o}}),n=e.reduce((a,i)=>a+i.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}const Sp=20,Ep={maxTokens:512},ms=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function ed(t,{count:e=Sp,force:n=!1,onProgress:a=()=>{},signal:i}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,c=0;if(n)o=await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).reverse().limit(e).toArray();else{const Z=new Set(await Ue.emailClassifications.toCollection().primaryKeys());c=0,o=[],await Ue.items.where("[sourceType+date]").between(["gmail",fn.minKey],["gmail",fn.maxKey]).reverse().until(()=>o.length>=e).each(R=>{Z.has(R.id)?c++:o.push(R)})}if(o.length===0){const Z=n?"No emails to scan.":`All emails already classified (${c} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:Z,classified:0}),{scanned:0,classified:0,skipped:c,errors:0}}const f=Date.now(),m=performance.now();let h=0,b=0,y=0,w=0;const x=[],I=t.modelId,G=rl(I)||al(I);if(!G)throw new Error(`Unknown model: ${I}`);if(!G.recommendedForEmailProcessing&&o.length>0){const{MODELS:Z}=await Mo(async()=>{const{MODELS:D}=await Promise.resolve().then(()=>Pv);return{MODELS:D}},void 0),{OLLAMA_MODELS:R}=await Mo(async()=>{const{OLLAMA_MODELS:D}=await Promise.resolve().then(()=>Iv);return{OLLAMA_MODELS:D}},void 0),X=[...Z.filter(D=>D.recommendedForEmailProcessing).map(D=>D.name),...R.filter(D=>D.recommendedForEmailProcessing).map(D=>D.displayName)],ce=G.displayName||G.name;console.warn(`â ï¸ Current model (${ce}) is not optimized for email processing. For best results with long emails, use: ${X.join(", ")}. Some emails may fail due to memory limits.`)}for(let Z=0;Z<o.length&&!(i!=null&&i.aborted);Z++){const R=o[Z],X=rd(R),ce=[{role:"system",content:ms},{role:"user",content:X}];a({phase:"scanning",current:Z+1,total:o.length,classified:h,errors:b,results:x,email:{subject:R.subject,from:R.from,date:R.date},prompt:{system:ms,user:X},systemPromptLength:ms.length,live:null,lastResult:null,totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}});const D=performance.now();try{const{text:pe,tps:ke,numTokens:ue,inputTokens:ge}=await t.generateFull(ce,{maxTokens:512,enableThinking:!1,temperature:0},fe=>{a({phase:"generating",current:Z+1,total:o.length,classified:h,errors:b,results:x,email:{subject:R.subject,from:R.from,date:R.date},live:{tps:fe.tps,numTokens:fe.numTokens},streamingText:fe.text||"",totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}})});y+=ue,w+=ge;const ae=Ap(pe),_e=performance.now()-D;if(ae){await Ue.emailClassifications.put({emailId:R.id,action:ae.action,reason:ae.reason,summary:ae.summary,tags:ae.tags,subject:R.subject||"(no subject)",from:R.from||"",date:R.date,scannedAt:f,status:"pending"}),h++;const fe={success:!0,email:{subject:R.subject,from:R.from,date:R.date},classification:ae,rawResponse:pe,stats:{tps:ke,numTokens:ue,inputTokens:ge,elapsed:_e},promptSize:X.length};x.push(fe),a({phase:"classified",current:Z+1,total:o.length,classified:h,errors:b,results:x,email:{subject:R.subject,from:R.from,date:R.date},result:ae,rawResponse:pe,emailStats:{tps:ke,numTokens:ue,inputTokens:ge,elapsed:_e},totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}})}}catch(pe){console.error(`Triage email ${Z+1} failed:`,pe),b++;const ke=pe.message||String(pe),ue=ke.length>200?ke.slice(0,200)+"...":ke;x.push({success:!1,email:{subject:R.subject,from:R.from,date:R.date},error:ue,promptSize:X.length})}}const A=performance.now()-m,V=x.length>0?Math.round(x.reduce((Z,R)=>Z+R.promptSize,0)/x.length):0,de=x.filter(Z=>{var R;return Z.success&&((R=Z.stats)==null?void 0:R.tps)}).length>0?Math.round(x.filter(Z=>Z.success).reduce((Z,R)=>{var X;return Z+(((X=R.stats)==null?void 0:X.tps)||0)},0)/x.filter(Z=>{var R;return Z.success&&((R=Z.stats)==null?void 0:R.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:h,errors:b,results:x,summary:{avgPromptSize:V,avgTps:de,systemPromptSize:ms.length,processed:o.length,skipped:c,modelName:G.displayName||G.name,modelContextWindow:G.contextWindow,modelMaxEmailTokens:G.maxEmailTokens},totals:{outputTokens:y,inputTokens:w,elapsed:A}}),{scanned:o.length,classified:h,skipped:c,errors:b}}async function td(){const t=await Ue.emailClassifications.toArray();return Vu(t)}async function Tp(){const t=await Ue.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function gi(t,e){await Ue.emailClassifications.update(t,{status:e})}async function hc(){await Ue.emailClassifications.clear()}async function ll(t){await Ue.emailClassifications.where("action").equals(t).delete()}async function nd(t){await Ue.emailClassifications.delete(t)}async function jo(){const t=await Ue.items.where("sourceType").equals("gmail").count(),e=await Ue.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function rd(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function Ap(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const n=e.indexOf("{"),a=e.lastIndexOf("}");if(n===-1||a===-1||a<=n)return console.warn("Triage: no JSON object found in response"),null;const i=e.indexOf("[");if(i!==-1&&i<n)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(n,a+1);try{const c=JSON.parse(o);if(!c||typeof c!="object"||Array.isArray(c))return null;const f=Cp(c.action);if(!f)return console.warn("Triage: missing or invalid action field"),null;let m=[];return Array.isArray(c.tags)&&(m=c.tags.filter(h=>typeof h=="string"&&h.trim()).map(h=>h.trim().toLowerCase()).slice(0,10)),{action:f,reason:String(c.reason||"").slice(0,300),summary:String(c.summary||"").slice(0,500),tags:m}}catch(c){return console.warn("Triage: failed to parse JSON response:",c.message),null}}function Cp(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Do(t){return`hsl(${Ci(t)}, 55%, 55%)`}function Pp(t){return`hsl(${Ci(t)}, 40%, 35%)`}var Ip=P('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Rp=P('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function Op(t,e){yt(e,!0);let n=Le(e,"backend",15,"webgpu"),a=Le(e,"isWebGPUAvailable",3,!0);var i=Rp(),o=_(p(i),2),c=p(o);let f;c.__click=()=>n("webgpu");var m=_(c,2);let h;m.__click=()=>n("ollama");var b=_(o,2);{var y=w=>{var x=Ip();E(w,x)};re(b,w=>{!a()&&n()==="webgpu"&&w(y)})}$(()=>{f=Dt(c,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="webgpu"}),c.disabled=!a(),h=Dt(m,1,"backend-btn svelte-1n2kfl0",null,h,{active:n()==="ollama"})}),E(t,i),bt()}qt(["click"]);const Mp=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function mc(...t){Mp&&console.log("[debug]",...t)}function On(t){return mc(`[MOUNT] ${t}`),()=>mc(`[DESTROY] ${t}`)}var jp=P("<option> </option>"),Dp=P('<p class="model-description svelte-1p89qnn"> </p>'),Lp=P('<span class="current-badge svelte-1p89qnn">Current</span>'),Np=P('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),qp=P('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Bp=P('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),zp=P('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),Fp=P('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),Kp=P('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),Up=P('<p class="error svelte-1p89qnn"> </p>'),Gp=P('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Wp(t,e){yt(e,!0);let n=Le(e,"selectedModel",15),a=Le(e,"gpuInfo",3,null),i=Le(e,"error",3,null);ln(()=>On("ModelSelector"));var o=Gp(),c=p(o),f=_(p(c),2),m=_(p(f),2);kt(m,21,()=>_r,Ft,(R,X)=>{var ce=jp(),D=p(ce),pe={};$(()=>{U(D,`${d(X).name??""} â ${d(X).size??""}`),pe!==(pe=d(X).id)&&(ce.value=(ce.__value=d(X).id)??"")}),E(R,ce)});var h=_(m,2);{var b=R=>{const X=ft(()=>_r.find(ke=>ke.id===n()));var ce=Un(),D=Xe(ce);{var pe=ke=>{var ue=Dp(),ge=p(ue);$(()=>U(ge,d(X).description)),E(ke,ue)};re(D,ke=>{d(X)&&ke(pe)})}E(R,ce)};re(h,R=>{n()&&R(b)})}var y=_(f,2),w=_(p(y),2),x=p(w),I=_(p(x));kt(I,21,()=>_r,Ft,(R,X)=>{var ce=zp();let D;var pe=p(ce),ke=p(pe),ue=_(ke);{var ge=te=>{var L=Lp();E(te,L)};re(ue,te=>{d(X).id===n()&&te(ge)})}var ae=_(pe),_e=p(ae),fe=p(_e),ie=_(ae),he=p(ie),be=_(ie),oe=p(be);{var ve=te=>{var L=Np();E(te,L)},se=te=>{var L=qp();E(te,L)},le=te=>{var L=Bp();E(te,L)};re(oe,te=>{d(X).recommendedForEmailProcessing?te(ve):d(X).maxEmailTokens>=6e3?te(se,1):te(le,!1)})}$((te,L)=>{D=Dt(ce,1,"svelte-1p89qnn",null,D,{selected:d(X).id===n()}),U(ke,`${d(X).name??""} `),U(fe,`${te??""}k`),U(he,`~${L??""}k`)},[()=>(d(X).contextWindow/1024).toFixed(0),()=>(d(X).maxEmailTokens/1e3).toFixed(0)]),E(R,ce)});var G=_(y,2);{var A=R=>{var X=Kp(),ce=_(p(X),2),D=p(ce),pe=_(p(D)),ke=p(pe),ue=_(D,2),ge=_(p(ue)),ae=p(ge),_e=_(ue,2);{var fe=ie=>{var he=Fp(),be=_(p(he)),oe=p(be);$(ve=>U(oe,ve),[()=>Oo(a().limits.maxBufferSize)]),E(ie,he)};re(_e,ie=>{var he;(he=a().limits)!=null&&he.maxBufferSize&&ie(fe)})}$(()=>{U(ke,a().vendor),U(ae,a().architecture)}),E(R,X)};re(G,R=>{a()&&R(A)})}var V=_(G,2);{var de=R=>{var X=Up(),ce=p(X);$(()=>U(ce,i())),E(R,X)};re(V,R=>{i()&&R(de)})}var Z=_(V,2);Z.__click=function(...R){var X;(X=e.onload)==null||X.apply(this,R)},$(()=>Z.disabled=i()),Ai(m,n),E(t,o),bt()}qt(["click"]);var Hp=P('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),Vp=P('<span class="status-dot disconnected svelte-1bvvk8o"></span> <span> </span>',1),Yp=P("<div><!></div>"),Qp=P("<option> <!></option>"),Xp=P("<option> <!></option>"),Zp=P('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Jp=P('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),$p=P('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),eh=P('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),th=P('<span class="current-badge svelte-1bvvk8o">Current</span>'),nh=P('<span class="installed-badge svelte-1bvvk8o">â</span>'),rh=P('<span class="rec-badge svelte-1bvvk8o">â</span>'),ah=P('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),sh=P('<p class="error svelte-1bvvk8o"> </p>'),ih=P('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL:</label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" placeholder="http://localhost:11434" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function oh(t,e){yt(e,!0);let n=Le(e,"selectedModel",15),a=Le(e,"error",15),i=Pe(Nt(js())),o=Pe(!1),c=Pe(null),f=Pe(Nt([])),m=Pe(!1);ba(()=>{h()});async function h(){C(o,!0),C(c,null);const se=await Io(d(i));C(c,se,!0),C(o,!1),se.connected&&b()}async function b(){C(m,!0);try{const se=await Ov(d(i));C(f,se.map(le=>le.name),!0)}catch(se){console.error("Failed to load Ollama models:",se),C(f,[],!0)}C(m,!1)}function y(){Rv(d(i)),h()}function w(){if(!n()){a("Please select a model");return}e.onload()}function x(se){return d(f).length?d(f).includes(se):!1}const I=Bu();var G=ih(),A=p(G),V=_(p(A),2),de=p(V);de.__change=y;var Z=_(de,2);Z.__click=h;var R=p(Z),X=_(V,2);{var ce=se=>{var le=Yp();let te;var L=p(le);{var T=H=>{var ee=Hp(),Te=_(Xe(ee),2),Re=p(Te);$(()=>U(Re,`Connected â¢ v${d(c).version??""}`)),E(H,ee)},F=H=>{var ee=Vp(),Te=_(Xe(ee),2),Re=p(Te);$(()=>U(Re,`Disconnected: ${d(c).error??""}`)),E(H,ee)};re(L,H=>{d(c).connected?H(T):H(F,!1)})}$(()=>te=Dt(le,1,"connection-status svelte-1bvvk8o",null,te,{connected:d(c).connected})),E(se,le)};re(X,se=>{d(c)&&se(ce)})}var D=_(A,2),pe=_(p(D),2),ke=p(pe);kt(ke,21,()=>I,Ft,(se,le)=>{var te=Qp(),L=p(te),T=_(L);{var F=Te=>{var Re=Or("â");E(Te,Re)},H=ft(()=>x(d(le).name));re(T,Te=>{d(H)&&Te(F)})}var ee={};$(Te=>{U(L,`${d(le).displayName??""} (${d(le).params??""}) - ${Te??""}k context `),ee!==(ee=d(le).name)&&(te.value=(te.__value=d(le).name)??"")},[()=>(d(le).contextWindow/1024).toFixed(0)]),E(se,te)});var ue=_(ke);kt(ue,21,()=>sr.filter(se=>!se.recommended),Ft,(se,le)=>{var te=Xp(),L=p(te),T=_(L);{var F=Te=>{var Re=Or("â");E(Te,Re)},H=ft(()=>x(d(le).name));re(T,Te=>{d(H)&&Te(F)})}var ee={};$(Te=>{U(L,`${d(le).displayName??""} (${d(le).params??""}) - ${Te??""}k context `),ee!==(ee=d(le).name)&&(te.value=(te.__value=d(le).name)??"")},[()=>(d(le).contextWindow/1024).toFixed(0)]),E(se,te)});var ge=_(pe,2);{var ae=se=>{const le=ft(()=>sr.find(F=>F.name===n()));var te=Un(),L=Xe(te);{var T=F=>{var H=eh(),ee=p(H),Te=p(ee),Re=_(ee,2),M=p(Re),we=p(M),Ae=_(M,4),qe=p(Ae),Qe=_(Ae,2);{var et=Be=>{var Ge=Zp(),pt=_(Xe(Ge),2),It=p(pt);$(ut=>U(It,ut),[()=>d(le).tags.join(", ")]),E(Be,Ge)};re(Qe,Be=>{var Ge;(Ge=d(le).tags)!=null&&Ge.length&&Be(et)})}var xt=_(Re,2);{var Tt=Be=>{var Ge=Jp(),pt=_(p(Ge),2),It=p(pt);$(()=>U(It,`ollama pull ${n()??""}`)),E(Be,Ge)},At=ft(()=>!x(n())),Ze=Be=>{var Ge=$p();E(Be,Ge)};re(xt,Be=>{d(At)?Be(Tt):Be(Ze,!1)})}$(Be=>{U(Te,d(le).description),U(we,`${Be??""}k context`),U(qe,`${d(le).params??""} params`)},[()=>(d(le).contextWindow/1024).toFixed(0)]),E(F,H)};re(L,F=>{d(le)&&F(T)})}E(se,te)};re(ge,se=>{n()&&se(ae)})}var _e=_(D,2),fe=_(p(_e),2),ie=p(fe),he=_(p(ie));kt(he,21,()=>sr,Ft,(se,le)=>{var te=ah();let L;var T=p(te),F=p(T),H=_(F);{var ee=Be=>{var Ge=th();E(Be,Ge)};re(H,Be=>{d(le).name===n()&&Be(ee)})}var Te=_(H,2);{var Re=Be=>{var Ge=nh();E(Be,Ge)},M=ft(()=>x(d(le).name));re(Te,Be=>{d(M)&&Be(Re)})}var we=_(T),Ae=p(we),qe=p(Ae),Qe=_(we),et=p(Qe),xt=_(Qe),Tt=p(xt);{var At=Be=>{var Ge=rh();E(Be,Ge)};re(Tt,Be=>{d(le).recommended&&Be(At)})}var Ze=_(Tt);$((Be,Ge,pt)=>{L=Dt(te,1,"svelte-1bvvk8o",null,L,Be),U(F,`${d(le).displayName??""} `),U(qe,`${Ge??""}k`),U(et,d(le).params),U(Ze,` ${pt??""}`)},[()=>({selected:d(le).name===n(),installed:x(d(le).name)}),()=>(d(le).contextWindow/1024).toFixed(0),()=>d(le).tags.slice(0,2).join(", ")]),E(se,te)});var be=_(_e,2);{var oe=se=>{var le=sh(),te=p(le);$(()=>U(te,a())),E(se,le)};re(be,se=>{a()&&se(oe)})}var ve=_(be,2);ve.__click=w,$(()=>{var se;Z.disabled=d(o),U(R,d(o)?"Testing...":"Test"),ve.disabled=!((se=d(c))!=null&&se.connected)||a()}),er(de,()=>d(i),se=>C(i,se)),Ai(pe,n),E(t,G),bt()}qt(["change","click"]);var lh=P('<span class="progress-percent svelte-r5fnze"> </span>'),ch=P('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),uh=P('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),dh=P('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),fh=P('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),vh=P('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),ph=P('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function hh(t,e){yt(e,!0);let n=Le(e,"message",3,""),a=Le(e,"items",19,()=>[]);ln(()=>On("LoadingProgress"));var i=ph(),o=p(i),c=p(o),f=_(o,2);kt(f,17,a,Ft,(m,h)=>{const b=ft(()=>d(h).total?Kv(d(h).loaded||0,d(h).total):null);var y=vh(),w=p(y),x=p(w),I=p(x),G=_(x,2);{var A=R=>{var X=lh(),ce=p(X);$(D=>U(ce,`${D??""}%`),[()=>d(b).toFixed(1)]),E(R,X)};re(G,R=>{d(b)!==null&&R(A)})}var V=_(w,2);{var de=R=>{var X=ch(),ce=Xe(X),D=p(ce),pe=_(ce,2),ke=p(pe),ue=p(ke),ge=_(ke,4),ae=p(ge),_e=_(ge,2),fe=p(_e);$((ie,he,be,oe,ve)=>{rn(D,`width: ${ie??""}%`),U(ue,he),U(ae,be),U(fe,`(${oe??""} / ${ve??""} B)`)},[()=>Math.max(d(h).progress??0,.5).toFixed(1),()=>fo(d(h).loaded||0),()=>fo(d(h).total),()=>(d(h).loaded||0).toLocaleString(),()=>d(h).total.toLocaleString()]),E(R,X)},Z=R=>{var X=fh(),ce=_(Xe(X),2),D=p(ce);{var pe=ue=>{var ge=uh(),ae=Xe(ge),_e=p(ae),fe=_(ae,2),ie=p(fe);$((he,be)=>{U(_e,he),U(ie,`(${be??""} B)`)},[()=>fo(d(h).loaded),()=>d(h).loaded.toLocaleString()]),E(ue,ge)},ke=ue=>{var ge=dh();E(ue,ge)};re(D,ue=>{d(h).loaded?ue(pe):ue(ke,!1)})}E(R,X)};re(V,R=>{d(h).total?R(de):R(Z,!1)})}$(()=>{Nu(x,"title",d(h).file),U(I,d(h).file)}),E(m,y)}),$(()=>U(c,n())),E(t,i),bt()}var mh=P('<span class="thinking-tokens svelte-11gjw00"> </span>'),gh=P('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),_h=P('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),yh=P('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),bh=P('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),wh=P('<span class="cursor svelte-11gjw00">|</span>'),kh=P(" <!>",1),xh=P('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),Sh=P('<div class="content svelte-11gjw00"> </div>'),Eh=P('<div><div class="role svelte-11gjw00"> </div> <!></div>');function Th(t,e){yt(e,!0);let n=Le(e,"isLast",3,!1),a=Le(e,"isRunning",3,!1),i=Le(e,"generationPhase",3,null),o=Le(e,"numTokens",3,null);ln(()=>On(`MessageBubble[${e.msg.role}]`));var c=Eh(),f=p(c),m=p(f),h=_(f,2);{var b=w=>{var x=xh(),I=Xe(x);{var G=D=>{var pe=gh(),ke=_(p(pe),4);{var ue=ge=>{var ae=mh(),_e=p(ae);$(()=>U(_e,`${o()??""} tokens`)),E(ge,ae)};re(ke,ge=>{o()&&ge(ue)})}E(D,pe)},A=D=>{var pe=_h();E(D,pe)};re(I,D=>{a()&&n()&&i()==="thinking"?D(G):a()&&n()&&i()==="preparing"&&D(A,1)})}var V=_(I,2);{var de=D=>{var pe=yh(),ke=p(pe),ue=_(p(ke),2),ge=p(ue),ae=_(ke,2),_e=p(ae);$(fe=>{U(ge,`${fe??""} words`),U(_e,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),E(D,pe)};re(V,D=>{e.msg.thinking&&D(de)})}var Z=_(V,2),R=p(Z);{var X=D=>{var pe=bh();E(D,pe)},ce=D=>{var pe=kh(),ke=Xe(pe,!0),ue=_(ke);{var ge=ae=>{var _e=wh();E(ae,_e)};re(ue,ae=>{a()&&n()&&ae(ge)})}$(()=>U(ke,e.msg.content)),E(D,pe)};re(R,D=>{a()&&n()&&!e.msg.content&&i()!=="thinking"?D(X):D(ce,!1)})}E(w,x)},y=w=>{var x=Sh(),I=p(x);$(()=>U(I,e.msg.content)),E(w,x)};re(h,w=>{e.msg.role==="assistant"?w(b):w(y,!1)})}$(()=>{Dt(c,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),U(m,e.msg.role==="user"?"You":"AI")}),E(t,c),bt()}var Ah=P('<span class="cmd-icon svelte-1m7x4wq"> </span>'),Ch=P('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),Ph=P('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function gc(t,e){yt(e,!0);var n=Ph(),a=Xe(n);a.__click=()=>{var x;return(x=e.onexecute)==null?void 0:x.call(e,e.command.id)};var i=p(a);{var o=x=>{var I=Ah(),G=p(I);$(()=>U(G,e.command.icon)),E(x,I)};re(i,x=>{e.command.icon&&x(o)})}var c=_(i,2),f=p(c),m=p(f),h=_(f,2),b=p(h),y=_(a,2);{var w=x=>{var I=Ch(),G=p(I),A=p(G);$(()=>U(A,e.command.body)),E(x,I)};re(y,x=>{e.command.body&&x(w)})}$(()=>{U(m,e.command.name),U(b,e.command.description)}),E(t,n),bt()}qt(["click"]);var Ih=P('<div class="event-subject svelte-1w66m1k"> </div>'),Rh=P('<span class="sep svelte-1w66m1k">Â·</span> ',1),Oh=P('<div class="event-summary svelte-1w66m1k"> </div>'),Mh=P('<span class="tag svelte-1w66m1k"> </span>'),jh=P('<div class="event-tags svelte-1w66m1k"></div>'),Dh=P('<div class="event-reason svelte-1w66m1k"> </div>'),Lh=P('<div class="commands svelte-1w66m1k"></div>'),Nh=P('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),qh=P('<span class="event-subject-inline svelte-1w66m1k"> </span>'),Bh=P('<span class="sep svelte-1w66m1k">Â·</span> ',1),zh=P('<div class="event-summary svelte-1w66m1k"> </div>'),Fh=P('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),Kh=P('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),Uh=P('<span class="email-from svelte-1w66m1k"> </span>'),Gh=P('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),Wh=P('<div class="email-summary svelte-1w66m1k"> </div>'),Hh=P('<span class="tag svelte-1w66m1k"> </span>'),Vh=P('<div class="email-tags svelte-1w66m1k"></div>'),Yh=P('<span class="step-icon svelte-1w66m1k"> </span>'),Qh=P('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),Xh=P('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <button class="execute-btn svelte-1w66m1k">â¶ Execute</button></div> <div class="pipeline-steps svelte-1w66m1k"></div></div></div>'),Zh=P('<div class="group-emails svelte-1w66m1k"></div>'),Jh=P('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <button class="execute-all-btn svelte-1w66m1k"> </button></div> <!></div>'),$h=P('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function em(t,e){yt(e,!0);let n=Pe(Nt({}));function a(A){if(!A)return"â";const V=A.replace(/<.*>/,"").trim();return V.length>40?V.slice(0,38)+"â¦":V}function i(A){if(!A)return"";try{return new Date(A).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function o(A,V){var de;(de=e.oncommand)==null||de.call(e,{event:A,commandId:V})}function c(A){var V;(V=e.oncommand)==null||V.call(e,{event:A,action:"execute_pipeline"})}function f(A,V){var de;(de=e.oncommand)==null||de.call(e,{eventType:A,emails:V,action:"execute_pipeline_batch"})}function m(A){C(n,{...d(n),[A]:!d(n)[A]},!0)}function h(A){return A.split("_").map(V=>V.charAt(0)+V.slice(1).toLowerCase()).join(" ")}function b(A){return`hsl(${Ci(A)}, 55%, 55%)`}var y=Un(),w=Xe(y);{var x=A=>{var V=Nh(),de=p(V),Z=p(de),R=p(Z),X=p(R),ce=_(R,2),D=p(ce),pe=_(Z,2);{var ke=L=>{var T=Ih(),F=p(T);$(()=>U(F,e.msg.event.data.subject)),E(L,T)};re(pe,L=>{var T;(T=e.msg.event.data)!=null&&T.subject&&L(ke)})}var ue=_(pe,2),ge=p(ue);{var ae=L=>{var T=Or();$(F=>U(T,F),[()=>a(e.msg.event.data.from)]),E(L,T)};re(ge,L=>{var T;(T=e.msg.event.data)!=null&&T.from&&L(ae)})}var _e=_(ge,2);{var fe=L=>{var T=Rh(),F=_(Xe(T),1,!0);$(H=>U(F,H),[()=>i(e.msg.event.data.date)]),E(L,T)};re(_e,L=>{var T;(T=e.msg.event.data)!=null&&T.date&&L(fe)})}var ie=_(ue,2);{var he=L=>{var T=Oh(),F=p(T);$(()=>U(F,e.msg.event.metadata.summary)),E(L,T)};re(ie,L=>{var T;(T=e.msg.event.metadata)!=null&&T.summary&&L(he)})}var be=_(ie,2);{var oe=L=>{var T=jh();kt(T,21,()=>e.msg.event.metadata.tags,Ft,(F,H)=>{var ee=Mh(),Te=p(ee);$(()=>U(Te,d(H))),E(F,ee)}),E(L,T)};re(be,L=>{var T,F;(F=(T=e.msg.event.metadata)==null?void 0:T.tags)!=null&&F.length&&L(oe)})}var ve=_(be,2);{var se=L=>{var T=Dh(),F=p(T);$(()=>U(F,e.msg.event.metadata.reason)),E(L,T)};re(ve,L=>{var T;(T=e.msg.event.metadata)!=null&&T.reason&&L(se)})}var le=_(de,2);{var te=L=>{var T=Lh();kt(T,21,()=>e.msg.commands,Ft,(F,H)=>{gc(F,{get command(){return d(H)},onexecute:ee=>o(e.msg.event,ee)})}),E(L,T)};re(le,L=>{var T;(T=e.msg.commands)!=null&&T.length&&L(te)})}$(()=>{U(X,e.msg.event.type),U(D,e.msg.event.source)}),E(A,V)},I=A=>{var V=Kh(),de=p(V),Z=p(de),R=p(Z),X=_(de,2);kt(X,17,()=>e.msg.items,Ft,(ce,D)=>{var pe=Fh(),ke=p(pe),ue=p(ke),ge=p(ue),ae=p(ge),_e=_(ge,2);{var fe=L=>{var T=qh(),F=p(T);$(()=>U(F,d(D).event.data.subject)),E(L,T)};re(_e,L=>{var T;(T=d(D).event.data)!=null&&T.subject&&L(fe)})}var ie=_(ue,2),he=p(ie);{var be=L=>{var T=Or();$(F=>U(T,F),[()=>a(d(D).event.data.from)]),E(L,T)};re(he,L=>{var T;(T=d(D).event.data)!=null&&T.from&&L(be)})}var oe=_(he,2);{var ve=L=>{var T=Bh(),F=_(Xe(T),1,!0);$(H=>U(F,H),[()=>i(d(D).event.data.date)]),E(L,T)};re(oe,L=>{var T;(T=d(D).event.data)!=null&&T.date&&L(ve)})}var se=_(ie,2);{var le=L=>{var T=zh(),F=p(T);$(()=>U(F,d(D).event.metadata.summary)),E(L,T)};re(se,L=>{var T;(T=d(D).event.metadata)!=null&&T.summary&&L(le)})}var te=_(ke,2);kt(te,21,()=>d(D).commands,Ft,(L,T)=>{gc(L,{get command(){return d(T)},onexecute:F=>o(d(D).event,F)})}),$(()=>U(ae,d(D).event.type)),E(ce,pe)}),$(()=>U(R,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),E(A,V)},G=A=>{var V=$h(),de=p(V),Z=_(p(de),2),R=p(Z),X=_(de,2);kt(X,17,()=>e.msg.groups,Ft,(ce,D)=>{const pe=ft(()=>d(n)[d(D).eventType]??!0);var ke=Jh(),ue=p(ke),ge=p(ue);ge.__click=()=>m(d(D).eventType);var ae=p(ge);let _e;var fe=p(ae),ie=_(ae,2),he=p(ie),be=_(ie,4);let oe;var ve=_(ge,2);ve.__click=L=>{L.stopPropagation(),f(d(D).eventType,d(D).emails)};var se=p(ve),le=_(ue,2);{var te=L=>{var T=Zh();kt(T,21,()=>d(D).emails,Ft,(F,H)=>{var ee=Xh(),Te=p(ee),Re=p(Te),M=p(Re),we=_(Re,2),Ae=p(we);{var qe=ut=>{var Ve=Uh(),Ye=p(Ve);$(We=>U(Ye,We),[()=>a(d(H).from)]),E(ut,Ve)};re(Ae,ut=>{d(H).from&&ut(qe)})}var Qe=_(Ae,2);{var et=ut=>{var Ve=Gh(),Ye=_(Xe(Ve)),We=p(Ye);$(lt=>U(We,lt),[()=>i(d(H).date)]),E(ut,Ve)};re(Qe,ut=>{d(H).date&&ut(et)})}var xt=_(we,2);{var Tt=ut=>{var Ve=Wh(),Ye=p(Ve);$(()=>U(Ye,d(H).summary)),E(ut,Ve)};re(xt,ut=>{d(H).summary&&ut(Tt)})}var At=_(xt,2);{var Ze=ut=>{var Ve=Vh();kt(Ve,21,()=>d(H).tags,Ft,(Ye,We)=>{var lt=Hh(),Rt=p(lt);$(()=>U(Rt,d(We))),E(Ye,lt)}),E(ut,Ve)};re(At,ut=>{var Ve;(Ve=d(H).tags)!=null&&Ve.length&&ut(Ze)})}var Be=_(Te,2),Ge=p(Be),pt=_(p(Ge),2);pt.__click=()=>c({type:d(D).eventType,source:"gmail",data:d(H)});var It=_(Ge,2);kt(It,21,()=>d(D).commands,Ft,(ut,Ve,Ye)=>{var We=Qh(),lt=p(We);lt.textContent=Ye+1;var Rt=_(lt,2),Yt=p(Rt);{var en=Oe=>{var Ot=Yh(),Kt=p(Ot);$(()=>U(Kt,d(Ve).icon)),E(Oe,Ot)};re(Yt,Oe=>{d(Ve).icon&&Oe(en)})}var Lt=_(Yt,2),St=p(Lt),Qt=_(Lt,2),at=p(Qt);$(()=>{U(St,d(Ve).name),U(at,d(Ve).description)}),E(ut,We)}),$(()=>U(M,d(H).subject)),E(F,ee)}),E(L,T)};re(le,L=>{d(pe)&&L(te)})}$((L,T)=>{_e=rn(ae,"",_e,L),U(fe,T),U(he,d(D).emails.length),oe=Dt(be,0,"chevron svelte-1w66m1k",null,oe,{open:d(pe)}),U(se,`â¶ Execute All (${d(D).emails.length??""})`)},[()=>({background:b(d(D).eventType)}),()=>h(d(D).eventType)]),E(ce,ke)}),$(()=>U(R,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} group${e.msg.groups.length===1?"":"s"}`)),E(A,V)};re(w,A=>{e.msg.type==="event"?A(x):e.msg.type==="event-batch"?A(I,1):e.msg.type==="events-grouped"&&A(G,2)})}E(t,y),bt()}qt(["click"]);var tm=P('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),nm=P('<span class="edate svelte-mt5nvh"> </span>'),rm=P('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),am=P('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),sm=P('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),im=P('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),om=P('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function lm(t,e){yt(e,!0);let n=Le(e,"pendingData",3,null),a=Pe(null),i=Pe(null);function o(x){C(a,d(a)===x?null:x,!0),C(i,null)}function c(x){return x.split("_").map(I=>I.charAt(0)+I.slice(1).toLowerCase()).join(" ")}function f(x){if(!x)return"";try{return new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function m(x){if(!x)return"";const I=x.replace(/<.*>/,"").trim();return I.length>24?I.slice(0,22)+"â¦":I}var h={toggleGroup:o},b=Un(),y=Xe(b);{var w=x=>{var I=om(),G=p(I),A=p(G),V=_(G,2);kt(V,20,()=>n().order,R=>R,(R,X)=>{const ce=ft(()=>n().groups[X]),D=ft(()=>Do(X)),pe=ft(()=>d(a)===X);var ke=tm();let ue;ke.__click=()=>o(X);let ge;var ae=p(ke);let _e;var fe=_(ae),ie=_(fe),he=p(ie);$(be=>{ue=Dt(ke,1,"chip svelte-mt5nvh",null,ue,{active:d(pe)}),ge=rn(ke,"",ge,{"--c":d(D)}),_e=rn(ae,"",_e,{background:d(D)}),U(fe,` ${be??""} `),U(he,d(ce).length)},[()=>c(X)]),E(R,ke)});var de=_(V,2);{var Z=R=>{const X=ft(()=>n().groups[d(a)]),ce=ft(()=>Do(d(a)));var D=im(),pe=p(D);let ke;var ue=p(pe);ue.__click=()=>{C(a,null),C(i,null)};var ge=_(ue,2),ae=p(ge),_e=_(ge,2),fe=p(_e),ie=_(pe,2);kt(ie,21,()=>d(X),se=>se.emailId,(se,le)=>{var te=rm(),L=p(te);L.__click=()=>{var qe;return(qe=e.onaskai)==null?void 0:qe.call(e,`Tell me about the email "${d(le).subject}" from ${d(le).from}`)};var T=p(L),F=p(T),H=_(T,2),ee=p(H),Te=_(ee);{var Re=qe=>{var Qe=nm(),et=p(Qe);$(xt=>U(et,xt),[()=>f(d(le).date)]),E(qe,Qe)};re(Te,qe=>{d(le).date&&qe(Re)})}var M=_(L,2),we=p(M);we.__click=()=>{var qe;return(qe=e.onmarkacted)==null?void 0:qe.call(e,d(le).emailId)};var Ae=_(we,2);Ae.__click=()=>{var qe;return(qe=e.ondismiss)==null?void 0:qe.call(e,d(le).emailId)},$(qe=>{U(F,d(le).subject),U(ee,qe)},[()=>m(d(le).from)]),E(se,te)});var he=_(ie,2),be=p(he);{var oe=se=>{var le=am(),te=Xe(le);te.__click=()=>d(X).forEach(T=>{var F;return(F=e.onmarkacted)==null?void 0:F.call(e,T.emailId)});var L=_(te,2);L.__click=()=>C(i,d(a),!0),E(se,le)},ve=se=>{var le=sm(),te=Xe(le),L=p(te),T=_(te,2);T.__click=()=>C(i,null);var F=_(T,2);F.__click=()=>{var H;(H=e.oncleargroup)==null||H.call(e,d(a)),C(i,null),C(a,null)},$(()=>U(L,`Remove ${d(X).length??""}?`)),E(se,le)};re(be,se=>{d(i)!==d(a)?se(oe):se(ve,!1)})}$(se=>{ke=rn(pe,"",ke,{"border-color":d(ce)}),U(ae,se),U(fe,d(X).length)},[()=>c(d(a))]),E(R,D)};re(de,R=>{d(a)&&n().groups[d(a)]&&R(Z)})}$(()=>U(A,`${n().total??""} item${n().total!==1?"s":""} need attention`)),E(x,I)};re(y,x=>{n()&&n().total>0&&x(w)})}return E(t,b),bt(h)}qt(["click"]);var cm=P('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),um=P('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),dm=P('<div class="strip svelte-1ed7zw1"><!></div>');function fm(t,e){let n=Le(e,"hasScanData",3,!1),a=Le(e,"engineReady",3,!1),i=Le(e,"isScanning",3,!1),o=ft(()=>a()&&!n()&&!i()),c=ft(()=>d(o)||i());var f=Un(),m=Xe(f);{var h=b=>{var y=dm(),w=p(y);{var x=G=>{var A=cm();E(G,A)},I=G=>{var A=um();A.__click=function(...V){var de;(de=e.onscan)==null||de.apply(this,V)},E(G,A)};re(w,G=>{i()?G(x):d(o)&&G(I,1)})}E(b,y)};re(m,b=>{d(c)&&b(h)})}E(t,f)}qt(["click"]);var vm=P('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),pm=P('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),hm=P('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),mm=P('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),gm=P('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),_m=P('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),ym=P('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function bm(t,e){yt(e,!0),ln(()=>On("GpuPanel"));var n=ym(),a=p(n),i=_(p(a),2),o=_(p(i),2),c=p(o),f=_(i,2),m=_(p(f),2),h=p(m),b=_(f,2);{var y=R=>{var X=vm(),ce=_(p(X),2),D=p(ce);$(()=>U(D,e.gpuInfo.device)),E(R,X)};re(b,R=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&R(y)})}var w=_(b,2);{var x=R=>{var X=pm(),ce=_(p(X),2),D=p(ce);$(pe=>U(D,pe),[()=>Oo(e.gpuInfo.limits.maxBufferSize)]),E(R,X)};re(w,R=>{var X;(X=e.gpuInfo.limits)!=null&&X.maxBufferSize&&R(x)})}var I=_(w,2);{var G=R=>{var X=hm(),ce=_(p(X),2),D=p(ce);$(()=>U(D,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),E(R,X)};re(I,R=>{var X;(X=e.gpuInfo.limits)!=null&&X.maxComputeInvocationsPerWorkgroup&&R(G)})}var A=_(I,2);{var V=R=>{var X=mm(),ce=_(p(X),2),D=p(ce);$(pe=>U(D,pe),[()=>Oo(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),E(R,X)};re(A,R=>{var X;(X=e.gpuInfo.limits)!=null&&X.maxComputeWorkgroupStorageSize&&R(V)})}var de=_(A,2);{var Z=R=>{var X=_m(),ce=p(X),D=p(ce),pe=_(ce,2);kt(pe,21,()=>e.gpuInfo.features,Ft,(ke,ue)=>{var ge=gm(),ae=p(ge);$(()=>U(ae,d(ue))),E(ke,ge)}),$(()=>U(D,`Features (${e.gpuInfo.features.length??""})`)),E(R,X)};re(de,R=>{var X;(X=e.gpuInfo.features)!=null&&X.length&&R(Z)})}$(()=>{U(c,e.gpuInfo.vendor),U(h,e.gpuInfo.architecture)}),E(t,n),bt()}var wm=P('<button class="gpu-badge svelte-1ktw27c"> </button>'),km=P('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),xm=P('<span class="stats svelte-1ktw27c"> </span>'),Sm=P('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Em=P('<span class="stats preparing svelte-1ktw27c"> </span>'),Tm=P('<span class="stats svelte-1ktw27c"> </span>'),Am=P('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Cm=P('<button class="btn svelte-1ktw27c">Stop</button>'),Pm=P('<button class="btn primary svelte-1ktw27c">Send</button>'),Im=P('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Rm(t,e){yt(e,!0),ln(()=>On("ChatView"));let n=Le(e,"messages",19,()=>[]),a=Le(e,"pendingData",3,null),i=Le(e,"hasScanData",3,!1),o=Le(e,"engineReady",3,!1),c=Le(e,"isScanning",3,!1),f=Le(e,"isRunning",3,!1),m=Le(e,"tps",3,null),h=Le(e,"numTokens",3,null),b=Le(e,"generationPhase",3,null),y=Le(e,"gpuInfo",3,null),w=Le(e,"backend",3,"webgpu"),x=Le(e,"chatContainer",15),I=Pe(""),G=Pe(!1);function A(H){H.key==="Enter"&&!H.shiftKey&&(H.preventDefault(),V())}function V(){const H=d(I).trim();!H||f()||(C(I,""),e.onsend(H))}function de(H){H&&!f()&&e.onsend(H)}var Z=Im(),R=p(Z),X=p(R);{var ce=H=>{var ee=wm();ee.__click=()=>C(G,!d(G));var Te=p(ee);$(()=>U(Te,`WebGPU ${d(G)?"â²":"â¼"}`)),E(H,ee)},D=H=>{var ee=km();E(H,ee)};re(X,H=>{y()?H(ce):w()==="ollama"&&H(D,1)})}var pe=_(X,2);{var ke=H=>{var ee=xm(),Te=p(ee);$((Re,M)=>U(Te,`${h()??""} tokens in ${Re??""}s
        (${M??""} tok/s)`),[()=>(h()/m()).toFixed(1),()=>m().toFixed(1)]),E(H,ee)},ue=H=>{var ee=Sm();E(H,ee)},ge=H=>{var ee=Em(),Te=p(ee);$(Re=>U(Te,`thinking... ${Re??""}`),[()=>m()?`${m().toFixed(0)} tok/s`:""]),E(H,ee)},ae=H=>{var ee=Tm(),Te=p(ee);$(Re=>U(Te,`${Re??""} tok/s`),[()=>m().toFixed(1)]),E(H,ee)};re(pe,H=>{m()&&!f()?H(ke):f()&&b()==="preparing"?H(ue,1):f()&&b()==="thinking"?H(ge,2):m()&&f()&&H(ae,3)})}var _e=_(pe,4);_e.__click=function(...H){var ee;(ee=e.onreset)==null||ee.apply(this,H)};var fe=_(R,2);{var ie=H=>{bm(H,{get gpuInfo(){return y()}})};re(fe,H=>{d(G)&&y()&&H(ie)})}var he=_(fe,2),be=p(he);{var oe=H=>{var ee=Am();E(H,ee)};re(be,H=>{n().length===0&&!(a()&&a().total>0)&&H(oe)})}var ve=_(be,2);kt(ve,17,n,Ft,(H,ee,Te)=>{var Re=Un(),M=Xe(Re);{var we=Qe=>{lm(Qe,{get pendingData(){return d(ee).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:de})},Ae=Qe=>{em(Qe,{get msg(){return d(ee)},get oncommand(){return e.oncommand}})},qe=Qe=>{{let et=ft(()=>Te===n().length-1);Th(Qe,{get msg(){return d(ee)},get isLast(){return d(et)},get isRunning(){return f()},get generationPhase(){return b()},get numTokens(){return h()}})}};re(M,Qe=>{d(ee).type==="dashboard"?Qe(we):d(ee).type==="event"||d(ee).type==="event-batch"||d(ee).type==="events-grouped"?Qe(Ae,1):Qe(qe,!1)})}E(H,Re)}),qu(he,H=>x(H),()=>x());var se=_(he,2);fm(se,{get hasScanData(){return i()},get engineReady(){return o()},get isScanning(){return c()},get onscan(){return e.onscan}});var le=_(se,2),te=p(le);te.__keydown=A;var L=_(te,2);{var T=H=>{var ee=Cm();ee.__click=function(...Te){var Re;(Re=e.onstop)==null||Re.apply(this,Te)},E(H,ee)},F=H=>{var ee=Pm();ee.__click=V,$(Te=>ee.disabled=Te,[()=>!d(I).trim()]),E(H,ee)};re(L,H=>{f()?H(T):H(F,!1)})}$(()=>{_e.disabled=f(),te.disabled=f()}),er(te,()=>d(I),H=>C(I,H)),E(t,Z),bt()}qt(["click","keydown"]);var Om=P('<div class="container center svelte-1bi93vx"><!> <!></div>');function Mm(t,e){yt(e,!0);const n=!!navigator.gpu,a=zu();let i=Pe(Nt(localStorage.getItem("aiBackend")||"webgpu"));function o(){const T=localStorage.getItem("selectedModel");return T||(d(i)==="webgpu"?_r[0].id:sr[0].name)}let c=Pe(Nt(o())),f=Pe(null),m=Pe(null),h=Pe(""),b=Pe(Nt([])),y=Pe(Nt([])),w=Pe(!1),x=Pe(null),I=Pe(null),G=Pe(null),A=Pe(null),V=Pe(null),de=Pe(null),Z=Pe(!1),R=Pe(!1),X=!1;ln(()=>{a.check(),a.isReady&&ce();const T=a.onMessage(F=>{switch(F.status){case"webgpu-info":C(A,F.data,!0);break;case"loading":C(f,"loading"),C(h,F.data,!0);break;case"initiate":C(b,[...d(b),F],!0);break;case"progress":C(b,d(b).map(H=>H.file===F.file?{...H,...F}:H),!0);break;case"done":C(b,d(b).filter(H=>H.file!==F.file),!0);break;case"ready":C(f,"ready"),ce();break;case"start":if(!d(w))break;C(V,F.phase||"preparing",!0),C(y,[...d(y),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!d(w))break;C(V,F.phase,!0);break;case"thinking":{if(!d(w))break;C(x,F.tps,!0),C(I,F.numTokens,!0);const H=d(y)[d(y).length-1];C(y,[...d(y).slice(0,-1),{...H,thinking:(H.thinking||"")+F.content}],!0),fe();break}case"thinking-done":{if(!d(w))break;C(x,F.tps,!0),C(I,F.numTokens,!0);const H=d(y)[d(y).length-1];C(y,[...d(y).slice(0,-1),{...H,thinking:F.content}],!0);break}case"update":{if(!d(w))break;C(x,F.tps,!0),C(I,F.numTokens,!0);const H=d(y)[d(y).length-1];C(y,[...d(y).slice(0,-1),{...H,content:H.content+F.output}],!0),fe();break}case"complete":if(!d(w))break;F.tps!==void 0&&C(x,F.tps,!0),F.numTokens!==void 0&&C(I,F.numTokens,!0),C(w,!1),C(V,null),D();break;case"error":C(m,F.data,!0),d(f)==="loading"&&C(f,null),d(w)&&(C(w,!1),C(V,null));break}});return()=>T()});async function ce(){if(!(X||d(y).length>0))try{const T=await vc();C(de,T,!0),T&&(X=!0,C(y,[{role:"assistant",type:"dashboard",pendingData:T}],!0),fe());const F=await jo();C(Z,F.classified>0)}catch{}}async function D(){try{const T=await vc();C(de,T,!0);const F=d(y).findIndex(ee=>ee.type==="dashboard");F!==-1&&(T&&T.total>0?C(y,d(y).map((ee,Te)=>Te===F?{...ee,pendingData:T}:ee),!0):C(y,d(y).filter((ee,Te)=>Te!==F),!0));const H=await jo();C(Z,H.classified>0)}catch{}}async function pe(T){await gi(T,"acted"),await D()}async function ke(T){await gi(T,"dismissed"),await D()}async function ue(T){await nd(T),await D()}async function ge(T){await ll(T),await D()}async function ae(){if(d(R)||!a.isReady)return;C(R,!0);let T=null;try{if(await ed(a,{count:20,onProgress:F=>{var H;F.phase==="done"&&((H=F.results)==null?void 0:H.length)>0&&(T=F.results)}}),await D(),(T==null?void 0:T.length)>0){const F=kp(T);C(y,[...d(y),F],!0),fe()}d(de)&&!d(y).some(F=>F.type==="dashboard")&&(C(y,[{role:"assistant",type:"dashboard",pendingData:d(de)},...d(y)],!0),fe())}catch(F){console.error("Scan failed:",F)}finally{C(R,!1)}}function _e({event:T,commandId:F}){var H,ee;`${F}${T.type}${((H=T.data)==null?void 0:H.subject)||"unknown"}`,C(y,[...d(y),{role:"assistant",content:`Command: ${F}

This command is not yet implemented. In the future, "${F}" will be executed on the ${T.source} event "${((ee=T.data)==null?void 0:ee.subject)||""}".`}],!0),fe()}function fe(){Ou().then(()=>{d(G)&&(d(G).scrollTop=d(G).scrollHeight)})}function ie(){C(f,"loading"),localStorage.setItem("selectedModel",d(c)),localStorage.setItem("aiBackend",d(i)),d(i)==="ollama"&&C(A,null),a.loadModel(d(c))}ba(()=>{d(i)==="webgpu"&&!_r.find(T=>T.id===d(c))?C(c,_r[0].id,!0):d(i)==="ollama"&&!sr.find(T=>T.name===d(c))&&C(c,sr[0].name,!0)});async function he(T){if(!T||d(w))return;if(T.trim().toLowerCase()==="/events"){C(y,[...d(y),{role:"user",content:T}],!0);try{const ee=await td();if(!ee.order.length)C(y,[...d(y),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const Te=xp(ee);C(y,[...d(y),Te],!0)}}catch(ee){C(y,[...d(y),{role:"assistant",content:`Failed to load events: ${ee.message}`}],!0)}fe();return}C(y,[...d(y),{role:"user",content:T}],!0),C(x,null),C(w,!0);let F=[];try{const Te=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(T)?await ap(T):await rp();Te&&(F=[{role:"system",content:Te}])}catch{}const H=d(y).filter(ee=>ee.type!=="dashboard"&&ee.type!=="events-grouped"&&ee.type!=="event-batch"&&ee.type!=="event").map(ee=>({role:ee.role,content:ee.content}));a.generate([...F,...H]),fe()}function be(){a.interrupt()}function oe(){a.reset(),C(y,[],!0),C(x,null),C(I,null),X=!1,ce()}var ve=Un(),se=Xe(ve);{var le=T=>{var F=Om(),H=p(F);Op(H,{get isWebGPUAvailable(){return n},get backend(){return d(i)},set backend(M){C(i,M,!0)}});var ee=_(H,2);{var Te=M=>{Wp(M,{get gpuInfo(){return d(A)},get error(){return d(m)},onload:ie,get selectedModel(){return d(c)},set selectedModel(we){C(c,we,!0)}})},Re=M=>{oh(M,{onload:ie,get selectedModel(){return d(c)},set selectedModel(we){C(c,we,!0)},get error(){return d(m)},set error(we){C(m,we,!0)}})};re(ee,M=>{d(i)==="webgpu"?M(Te):d(i)==="ollama"&&M(Re,1)})}E(T,F)},te=T=>{hh(T,{get message(){return d(h)},get items(){return d(b)}})},L=T=>{Rm(T,{get messages(){return d(y)},get pendingData(){return d(de)},get hasScanData(){return d(Z)},get engineReady(){return a.isReady},get isScanning(){return d(R)},get isRunning(){return d(w)},get tps(){return d(x)},get numTokens(){return d(I)},get generationPhase(){return d(V)},get gpuInfo(){return d(A)},get backend(){return d(i)},onsend:he,onstop:be,onreset:oe,onmarkacted:pe,ondismiss:ke,onremove:ue,oncleargroup:ge,onscan:ae,oncommand:_e,get chatContainer(){return d(G)},set chatContainer(F){C(G,F,!0)}})};re(se,T=>{d(f)===null?T(le):d(f)==="loading"?T(te,1):T(L,!1)})}E(t,ve),bt()}const _c="https://accounts.google.com/gsi/client",jm="https://www.googleapis.com/auth/gmail.readonly",cl="me-ai:oauth-token",ul=300*1e3;let Es=null,ks=null,Vr=0;function ad(t,e){Vr=Date.now()+e*1e3;try{sessionStorage.setItem(cl,JSON.stringify({access_token:t,expires_at:Vr}))}catch{}}function Lo(){Vr=0;try{sessionStorage.removeItem(cl)}catch{}}function Dm(){try{const t=sessionStorage.getItem(cl);if(!t)return null;const{access_token:e,expires_at:n}=JSON.parse(t);return!e||Date.now()>n-ul?(Lo(),null):(Vr=n,{access_token:e})}catch{return Lo(),null}}function Lm(){return Vr>0&&Date.now()<Vr-ul}function Nm(){return Vr<=0?0:Math.max(0,Vr-ul-Date.now())}function yc(){return new Promise((t,e)=>{if(!Es){e(new Error("Google Auth not initialized."));return}ks=n=>{n.error?e(new Error(n.error_description||n.error)):(ad(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Es.requestAccessToken({prompt:""})})}function qm(){return new Promise((t,e)=>{var i,o;if((o=(i=window.google)==null?void 0:i.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${_c}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=_c,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function bc(t){await qm(),Es=google.accounts.oauth2.initTokenClient({client_id:t,scope:jm,callback:e=>{ks&&(ks(e),ks=null)}})}function Bm(){return new Promise((t,e)=>{if(!Es){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}ks=n=>{n.error?e(new Error(n.error_description||n.error)):(ad(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Es.requestAccessToken()})}function zm(t){return Lo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}const an="gmail",wc=8,sd=50,id=100;async function Fm(t,{limit:e=sd,onProgress:n=()=>{},signal:a}={}){var c;const i=await Ue.syncState.get(an);if(i!=null&&i.historyId)try{return await Hm(t,i,n,a)}catch(f){if(f instanceof il&&(f.status===404||f.code==="notFound")||((c=f.message)==null?void 0:c.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Ue.syncState.delete(an);else throw f}return await Gm(t,e===0?1/0:e,n,a)}async function Km(t,{limit:e=sd,onProgress:n=()=>{},signal:a}={}){const i=await Ue.syncState.get(an);return i!=null&&i.oldestPageToken?await Wm(t,i,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function Um(){const t=await Ue.syncState.get(an);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function od(){await Ue.transaction("rw",[Ue.items,Ue.syncState],async()=>{await Ue.items.where("sourceType").equals(an).delete(),await Ue.syncState.delete(an)})}async function Gm(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),ka(a);const i=await Fu(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(i.messagesTotal||e,e)});const o=[];let c,f=null;for(;o.length<e;){ka(a);const y=e-o.length,w=await Ku(t,{maxResults:Math.min(id,y),pageToken:c}),x=(w.messages||[]).map(I=>I.id);if(o.push(...x),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(i.messagesTotal||e,e)}),c=w.nextPageToken,!c||x.length===0)break}if(f=c||null,o.length===0)return await Ue.syncState.put({sourceType:an,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:m,errors:h}=await ld(t,o,n,a),b=await Ue.items.where("sourceType").equals(an).count();return await Ue.syncState.put({sourceType:an,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:b,oldestPageToken:f}),n({phase:"done",message:`Synced ${m} messages`,current:m,total:m}),{added:m,deleted:0,errors:h}}async function Wm(t,e,n,a,i){a({phase:"listing",message:"Loading more messages...",current:0}),ka(i);const o=[];let c=e.oldestPageToken,f=null;for(;o.length<n;){ka(i);const y=n-o.length,w=await Ku(t,{maxResults:Math.min(id,y),pageToken:c}),x=(w.messages||[]).map(I=>I.id);if(o.push(...x),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),c=w.nextPageToken,!c||x.length===0)break}if(f=c||null,o.length===0)return await Ue.syncState.update(an,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:m,errors:h}=await ld(t,o,a,i),b=await Ue.items.where("sourceType").equals(an).count();return await Ue.syncState.update(an,{totalItems:b,lastSyncAt:Date.now(),oldestPageToken:f}),a({phase:"done",message:f?`Downloaded ${m} more (more available)`:`Downloaded ${m} more (all synced)`,current:b,total:b}),{added:m,errors:h}}async function Hm(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),ka(a);let i=0,o=0,c=0,f,m=e.historyId;do{ka(a);const b=await Hv(t,{startHistoryId:e.historyId,pageToken:f});if(m=b.historyId||m,f=b.nextPageToken,!!b.history){for(const y of b.history){if(y.messagesAdded){const w=y.messagesAdded.map(I=>I.message.id),x=[...new Set(w.filter(I=>I))];if(x.length>0){const I=await Promise.allSettled(x.map(A=>Uu(t,A))),G=[];for(const A of I)A.status==="fulfilled"?G.push(cd(A.value)):c++;G.length>0&&(await Ue.items.bulkPut(G),await ud(G),i+=G.length)}}if(y.messagesDeleted){const w=y.messagesDeleted.map(x=>sl(an,x.message.id)).filter(x=>x);w.length>0&&(await Ue.items.bulkDelete(w),o+=w.length)}}n({phase:"syncing",message:`Changes: +${i} -${o}`,current:i+o})}}while(f);const h=await Ue.items.where("sourceType").equals(an).count();return await Ue.syncState.put({sourceType:an,historyId:m,lastSyncAt:Date.now(),totalItems:h,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:i===0&&o===0?"Already up to date":`Synced: +${i} -${o}`,current:h,total:h}),{added:i,deleted:o,errors:c}}async function ld(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let i=0,o=0;for(let c=0;c<e.length;c+=wc){ka(a);const f=e.slice(c,c+wc),m=await Promise.allSettled(f.map(b=>Uu(t,b))),h=[];for(const b of m)b.status==="fulfilled"?h.push(cd(b.value)):o++;h.length>0&&(await Ue.items.bulkPut(h),await ud(h)),i+=h.length,n({phase:"downloading",message:`Downloaded ${i} of ${e.length} messages`,current:i,total:e.length})}return{added:i,errors:o}}function cd(t){const e=Br(t,"From"),n=Br(t,"To"),a=Br(t,"Cc"),i=Br(t,"Subject")||"(no subject)",o=Br(t,"Date"),c=Br(t,"Message-ID"),f=Br(t,"In-Reply-To"),m=Br(t,"References");let h;try{h=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{h=Date.now()}return{id:sl(an,t.id),sourceType:an,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:i,snippet:t.snippet||"",body:Vv(t),htmlBody:Yv(t),date:h,labels:t.labelIds||[],messageId:c,inReplyTo:f,references:m,raw:t,syncedAt:Date.now()}}async function ud(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const i=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of i){const c=Vm(o);c&&!e.has(c.email)&&e.set(c.email,{...c,date:n.date})}}for(const[n,{name:a,date:i}]of e)try{const o=await Ue.contacts.where("email").equals(n).first();if(o){const c={};a&&!o.name&&(c.name=a),i>(o.lastSeen||0)&&(c.lastSeen=i),Object.keys(c).length>0&&await Ue.contacts.update(o.id,c)}else await Ue.contacts.add({email:n,name:a||"",firstSeen:i,lastSeen:i})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function Vm(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),i=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:i}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function ka(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var Ym=P(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">To access Gmail from the browser, you need a Google Cloud OAuth Client ID.
      This stays in your browser â no data is sent to any server.</p> <div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
            is required because the app is deployed at a subpath. Changes may take a
            few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></div>`);function Qm(t,e){yt(e,!0);let n=Le(e,"clientIdInput",15);ln(()=>On("SetupGuide"));let a=Pe(null);async function i(T){try{await navigator.clipboard.writeText(T),C(a,T,!0),setTimeout(()=>{C(a,null)},1500)}catch{const F=document.createElement("input");F.value=T,document.body.appendChild(F),F.select(),document.execCommand("copy"),document.body.removeChild(F),C(a,T,!0),setTimeout(()=>{C(a,null)},1500)}}const o="http://localhost:5173",c="https://cypherkitty.github.io",f="https://cypherkitty.github.io/me-ai/";var m=Ym(),h=p(m),b=_(p(h),4),y=_(p(b),6),w=_(p(y),2),x=_(p(w),2),I=_(p(x),2),G=p(I);G.__click=()=>i(o);var A=p(G);A.textContent="http://localhost:5173";var V=_(A,2),de=p(V),Z=_(G,2);Z.__click=()=>i(c);var R=p(Z);R.textContent="https://cypherkitty.github.io";var X=_(R,2),ce=p(X),D=_(x,2),pe=_(p(D),2),ke=p(pe);ke.__click=()=>i(o);var ue=p(ke);ue.textContent="http://localhost:5173";var ge=_(ue,2),ae=p(ge),_e=_(ke,2);_e.__click=()=>i(c);var fe=p(_e);fe.textContent="https://cypherkitty.github.io";var ie=_(fe,2),he=p(ie),be=_(_e,2);be.__click=()=>i(f);var oe=p(be);oe.textContent="https://cypherkitty.github.io/me-ai/";var ve=_(oe,2),se=p(ve),le=_(b,2),te=p(le);te.__keydown=T=>T.key==="Enter"&&e.onsave();var L=_(te,2);L.__click=function(...T){var F;(F=e.onsave)==null||F.apply(this,T)},$(T=>{U(de,d(a)===o?"â":"â§"),U(ce,d(a)===c?"â":"â§"),U(ae,d(a)===o?"â":"â§"),U(he,d(a)===c?"â":"â§"),U(se,d(a)===f?"â":"â§"),L.disabled=T},[()=>!n().trim()]),er(te,n),E(t,m),bt()}qt(["click","keydown"]);function Xm(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof il?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const i=n.match(/project\s+(\d+)/),o=i==null?void 0:i[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var Zm=P('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),Jm=P('<div class="error-card-title svelte-14buhqq"> </div>'),$m=P('<p class="error-card-fix svelte-14buhqq"> </p>'),eg=P('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),tg=P('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),ng=P('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function dd(t,e){yt(e,!0);let n=Le(e,"ondismiss",3,null),a=Le(e,"onsignout",3,null),i=ft(()=>Xm(e.error));ln(()=>On("ErrorCard"));var o=ng(),c=p(o);{var f=V=>{var de=Zm(),Z=p(de),R=p(Z),X=_(Z,2);X.__click=function(...ce){var D;(D=n())==null||D.apply(this,ce)},$(()=>U(R,d(i).title)),E(V,de)},m=V=>{var de=Jm(),Z=p(de);$(()=>U(Z,d(i).title)),E(V,de)};re(c,V=>{n()?V(f):V(m,!1)})}var h=_(c,2),b=p(h),y=_(h,2);{var w=V=>{var de=$m(),Z=p(de);$(()=>U(Z,d(i).fix)),E(V,de)};re(y,V=>{d(i).fix&&V(w)})}var x=_(y,2);{var I=V=>{var de=eg(),Z=p(de);$(()=>{Nu(de,"href",d(i).link.url),U(Z,`${d(i).link.label??""} â`)}),E(V,de)};re(x,V=>{d(i).link&&V(I)})}var G=_(x,2);{var A=V=>{var de=tg();de.__click=function(...Z){var R;(R=a())==null||R.apply(this,Z)},E(V,de)};re(G,V=>{d(i).action==="signout"&&a()&&V(A)})}$(()=>U(b,d(i).description)),E(t,o),bt()}qt(["click"]);var rg=P('<span class="spinner svelte-nyqevv"></span> Signing in...',1),ag=nl('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),sg=P(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <span class="client-id-value svelte-nyqevv"> </span> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function ig(t,e){yt(e,!0);let n=Le(e,"error",3,null),a=Le(e,"loadingAuth",3,!1);ln(()=>On("AuthCard"));var i=sg(),o=p(i),c=_(p(o),4);{var f=A=>{dd(A,{get error(){return n()},get onsignout(){return e.onsignout}})};re(c,A=>{n()&&A(f)})}var m=_(c,2);m.__click=function(...A){var V;(V=e.onsignin)==null||V.apply(this,A)};var h=p(m);{var b=A=>{var V=rg();E(A,V)},y=A=>{var V=ag();E(A,V)};re(h,A=>{a()?A(b):A(y,!1)})}var w=_(m,4),x=_(p(w),2),I=p(x),G=_(x,2);G.__click=function(...A){var V;(V=e.onclear)==null||V.apply(this,A)},$(A=>{m.disabled=a(),U(I,`${A??""}...`)},[()=>e.clientId.slice(0,20)]),E(t,i),bt()}qt(["click"]);var og=P('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),lg=P('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),cg=P('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function ug(t,e){yt(e,!0);let n=Le(e,"profile",3,null),a=Le(e,"loadingProfile",3,!1);ln(()=>On("ProfileCard"));var i=cg(),o=p(i),c=p(o),f=_(o,2),m=p(f);{var h=w=>{var x=og();E(w,x)},b=w=>{var x=lg(),I=Xe(x),G=p(I),A=_(I,2),V=p(A);$((de,Z)=>{U(G,n().emailAddress),U(V,`${de??""} messages
        Â· ${Z??""} threads`)},[()=>{var de;return((de=n().messagesTotal)==null?void 0:de.toLocaleString())||"?"},()=>{var de;return((de=n().threadsTotal)==null?void 0:de.toLocaleString())||"?"}]),E(w,x)};re(m,w=>{a()?w(h):n()&&w(b,1)})}var y=_(f,2);y.__click=function(...w){var x;(x=e.onsignout)==null||x.apply(this,w)},$(w=>U(c,w),[()=>n()?Wu(n().emailAddress):"?"]),E(t,i),bt()}qt(["click"]);var dg=P('<span class="spinner svelte-1ds3j4k"></span>'),fg=nl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),vg=P('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),pg=P('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),hg=P('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),mg=P('<option class="svelte-1ds3j4k"> </option>'),gg=P('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),_g=P('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),yg=P('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),bg=P('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),wg=P('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),kg=P('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function xg(t,e){yt(e,!0),ln(()=>On("SyncStatus"));let n=Le(e,"syncStatus",3,null),a=Le(e,"syncProgress",3,null),i=Le(e,"isSyncing",3,!1),o=Pe(!1),c=Pe(50);const f=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function m(oe){if(!oe)return"never";const ve=Math.floor((Date.now()-oe)/1e3);if(ve<60)return"just now";const se=Math.floor(ve/60);if(se<60)return`${se}m ago`;const le=Math.floor(se/60);return le<24?`${le}h ago`:`${Math.floor(le/24)}d ago`}function h(){var oe,ve;return!((oe=a())!=null&&oe.total)||!((ve=a())!=null&&ve.current)?0:Math.round(a().current/a().total*100)}var b=kg(),y=p(b),w=p(y),x=p(w);{var I=oe=>{var ve=dg();E(oe,ve)},G=oe=>{var ve=fg();E(oe,ve)};re(x,oe=>{i()?oe(I):oe(G,!1)})}var A=_(w,2),V=_(p(A),2);{var de=oe=>{var ve=vg(),se=p(ve),le=_(se);{var te=T=>{var F=Or("Â· more available");E(T,F)},L=T=>{var F=Or("Â· all synced");E(T,F)};re(le,T=>{n().hasMore?T(te):T(L,!1)})}$((T,F)=>U(se,`${T??""} emails stored
          Â· synced ${F??""} `),[()=>n().totalItems.toLocaleString(),()=>m(n().lastSyncAt)]),E(oe,ve)},Z=oe=>{var ve=pg();E(oe,ve)};re(V,oe=>{var ve;(ve=n())!=null&&ve.synced?oe(de):oe(Z,!1)})}var R=_(A,2),X=p(R);{var ce=oe=>{var ve=hg();ve.__click=()=>C(o,!d(o)),E(oe,ve)};re(X,oe=>{var ve;(ve=n())!=null&&ve.synced&&!i()&&oe(ce)})}var D=_(y,2),pe=p(D),ke=_(p(pe),2);kt(ke,21,()=>f,Ft,(oe,ve)=>{var se=mg(),le=p(se),te={};$(()=>{U(le,d(ve).label),te!==(te=d(ve).value)&&(se.value=(se.__value=d(ve).value)??"")}),E(oe,se)});var ue=_(pe,2),ge=p(ue);{var ae=oe=>{var ve=_g(),se=Xe(ve);se.__click=()=>e.onsync(d(c));var le=p(se),te=_(se,2);{var L=T=>{var F=gg();F.__click=()=>e.onsyncmore(d(c));var H=p(F);$(()=>{F.disabled=i(),U(H,i()?"Loading...":"Sync More")}),E(T,F)};re(te,T=>{n().hasMore&&T(L)})}$(()=>{se.disabled=i(),U(le,i()?"Syncing...":"Sync New")}),E(oe,ve)},_e=oe=>{var ve=yg();ve.__click=()=>e.onsync(d(c));var se=p(ve);$(()=>{ve.disabled=i(),U(se,i()?"Syncing...":"Download Emails")}),E(oe,ve)};re(ge,oe=>{var ve;(ve=n())!=null&&ve.synced?oe(ae):oe(_e,!1)})}var fe=_(D,2);{var ie=oe=>{var ve=bg(),se=p(ve),le=p(se);let te,L;var T=_(se,2),F=p(T);$(H=>{te=Dt(le,1,"progress-fill svelte-1ds3j4k",null,te,{indeterminate:!a().total}),L=rn(le,"",L,H),U(F,a().message||"Syncing...")},[()=>({width:`${h()??""}%`})]),E(oe,ve)};re(fe,oe=>{i()&&a()&&oe(ie)})}var he=_(fe,2);{var be=oe=>{var ve=wg(),se=_(p(ve),2),le=p(se);le.__click=()=>C(o,!1);var te=_(le,2);te.__click=()=>{e.onclear(),C(o,!1)},E(oe,ve)};re(he,oe=>{d(o)&&oe(be)})}$(()=>ke.disabled=i()),Ai(ke,()=>d(c),oe=>C(c,oe)),E(t,b),bt()}qt(["click"]);var Sg=P('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Eg=P('<div class="message-list svelte-y2uamw"></div>');function Tg(t,e){yt(e,!0);let n=Le(e,"messages",19,()=>[]);ln(()=>On("MessageList"));var a=Eg();kt(a,21,n,Ft,(i,o)=>{var c=Sg();c.__click=()=>e.onselect(d(o));var f=p(c),m=p(f),h=_(f,2),b=p(h),y=p(b),w=p(y),x=_(y,2),I=p(x),G=_(b,2),A=p(G),V=_(G,2),de=p(V);$((Z,R,X)=>{U(m,Z),U(w,R),U(I,X),U(A,d(o).subject),U(de,d(o).snippet)},[()=>Wu(d(o).from),()=>Gu(d(o).from),()=>ol(d(o).date)]),E(i,c)}),E(t,a),bt()}qt(["click"]);function dl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ea=dl();function fd(t){Ea=t}var sa={exec:()=>null};function vt(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(i,o)=>{let c=typeof o=="string"?o:o.source;return c=c.replace(pn.caret,"$1"),n=n.replace(i,c),a},getRegex:()=>new RegExp(n,e)};return a}var Ag=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),pn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},Cg=/^(?:[ \t]*(?:\n|$))+/,Pg=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ig=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ns=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Rg=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,fl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,vd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,pd=vt(vd).replace(/bull/g,fl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Og=vt(vd).replace(/bull/g,fl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),vl=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Mg=/^[^\n]+/,pl=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,jg=vt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",pl).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Dg=vt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,fl).getRegex(),Ri="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",hl=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Lg=vt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",hl).replace("tag",Ri).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),hd=vt(vl).replace("hr",Ns).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ri).getRegex(),Ng=vt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",hd).getRegex(),ml={blockquote:Ng,code:Pg,def:jg,fences:Ig,heading:Rg,hr:Ns,html:Lg,lheading:pd,list:Dg,newline:Cg,paragraph:hd,table:sa,text:Mg},kc=vt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ns).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ri).getRegex(),qg={...ml,lheading:Og,table:kc,paragraph:vt(vl).replace("hr",Ns).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",kc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ri).getRegex()},Bg={...ml,html:vt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",hl).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:sa,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:vt(vl).replace("hr",Ns).replace("heading",` *#{1,6} *[^
]`).replace("lheading",pd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},zg=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Fg=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,md=/^( {2,}|\\)\n(?!\s*$)/,Kg=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Oi=/[\p{P}\p{S}]/u,gl=/[\s\p{P}\p{S}]/u,gd=/[^\s\p{P}\p{S}]/u,Ug=vt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,gl).getRegex(),_d=/(?!~)[\p{P}\p{S}]/u,Gg=/(?!~)[\s\p{P}\p{S}]/u,Wg=/(?:[^\s\p{P}\p{S}]|~)/u,yd=/(?![*_])[\p{P}\p{S}]/u,Hg=/(?![*_])[\s\p{P}\p{S}]/u,Vg=/(?:[^\s\p{P}\p{S}]|[*_])/u,Yg=vt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Ag?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),bd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Qg=vt(bd,"u").replace(/punct/g,Oi).getRegex(),Xg=vt(bd,"u").replace(/punct/g,_d).getRegex(),wd="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Zg=vt(wd,"gu").replace(/notPunctSpace/g,gd).replace(/punctSpace/g,gl).replace(/punct/g,Oi).getRegex(),Jg=vt(wd,"gu").replace(/notPunctSpace/g,Wg).replace(/punctSpace/g,Gg).replace(/punct/g,_d).getRegex(),$g=vt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,gd).replace(/punctSpace/g,gl).replace(/punct/g,Oi).getRegex(),e_=vt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,yd).getRegex(),t_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",n_=vt(t_,"gu").replace(/notPunctSpace/g,Vg).replace(/punctSpace/g,Hg).replace(/punct/g,yd).getRegex(),r_=vt(/\\(punct)/,"gu").replace(/punct/g,Oi).getRegex(),a_=vt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),s_=vt(hl).replace("(?:-->|$)","-->").getRegex(),i_=vt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",s_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_i=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,o_=vt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_i).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),kd=vt(/^!?\[(label)\]\[(ref)\]/).replace("label",_i).replace("ref",pl).getRegex(),xd=vt(/^!?\[(ref)\](?:\[\])?/).replace("ref",pl).getRegex(),l_=vt("reflink|nolink(?!\\()","g").replace("reflink",kd).replace("nolink",xd).getRegex(),xc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,_l={_backpedal:sa,anyPunctuation:r_,autolink:a_,blockSkip:Yg,br:md,code:Fg,del:sa,delLDelim:sa,delRDelim:sa,emStrongLDelim:Qg,emStrongRDelimAst:Zg,emStrongRDelimUnd:$g,escape:zg,link:o_,nolink:xd,punctuation:Ug,reflink:kd,reflinkSearch:l_,tag:i_,text:Kg,url:sa},c_={..._l,link:vt(/^!?\[(label)\]\((.*?)\)/).replace("label",_i).getRegex(),reflink:vt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_i).getRegex()},No={..._l,emStrongRDelimAst:Jg,emStrongLDelim:Xg,delLDelim:e_,delRDelim:n_,url:vt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",xc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:vt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",xc).getRegex()},u_={...No,br:vt(md).replace("{2,}","*").getRegex(),text:vt(No.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},si={normal:ml,gfm:qg,pedantic:Bg},ls={normal:_l,gfm:No,breaks:u_,pedantic:c_},d_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Sc=t=>d_[t];function Sr(t,e){if(e){if(pn.escapeTest.test(t))return t.replace(pn.escapeReplace,Sc)}else if(pn.escapeTestNoEncode.test(t))return t.replace(pn.escapeReplaceNoEncode,Sc);return t}function Ec(t){try{t=encodeURI(t).replace(pn.percentDecode,"%")}catch{return null}return t}function Tc(t,e){var o;let n=t.replace(pn.findPipe,(c,f,m)=>{let h=!1,b=f;for(;--b>=0&&m[b]==="\\";)h=!h;return h?"|":" |"}),a=n.split(pn.splitPipe),i=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;i<a.length;i++)a[i]=a[i].trim().replace(pn.slashPipe,"|");return a}function cs(t,e,n){let a=t.length;if(a===0)return"";let i=0;for(;i<a&&t.charAt(a-i-1)===e;)i++;return t.slice(0,a-i)}function f_(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function v_(t,e=0){let n=e,a="";for(let i of t)if(i==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=i,n++;return a}function Ac(t,e,n,a,i){let o=e.href,c=e.title||null,f=t[1].replace(i.other.outputLinkReplace,"$1");a.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:c,text:f,tokens:a.inlineTokens(f)};return a.state.inLink=!1,m}function p_(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let i=a[1];return e.split(`
`).map(o=>{let c=o.match(n.other.beginningSpace);if(c===null)return o;let[f]=c;return f.length>=i.length?o.slice(i.length):o}).join(`
`)}var yi=class{constructor(t){st(this,"options");st(this,"rules");st(this,"lexer");this.options=t||Ea}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:cs(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=p_(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=cs(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:cs(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=cs(e[0],`
`).split(`
`),a="",i="",o=[];for(;n.length>0;){let c=!1,f=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))f.push(n[m]),c=!0;else if(!c)f.push(n[m]);else break;n=n.slice(m);let h=f.join(`
`),b=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${h}`:h,i=i?`${i}
${b}`:b;let y=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(b,o,!0),this.lexer.state.top=y,n.length===0)break;let w=o.at(-1);if((w==null?void 0:w.type)==="code")break;if((w==null?void 0:w.type)==="blockquote"){let x=w,I=x.raw+`
`+n.join(`
`),G=this.blockquote(I);o[o.length-1]=G,a=a.substring(0,a.length-x.raw.length)+G.raw,i=i.substring(0,i.length-x.text.length)+G.text;break}else if((w==null?void 0:w.type)==="list"){let x=w,I=x.raw+`
`+n.join(`
`),G=this.list(I);o[o.length-1]=G,a=a.substring(0,a.length-w.raw.length)+G.raw,i=i.substring(0,i.length-x.raw.length)+G.raw,n=I.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:i}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let i=e[1].trim(),o=i.length>1,c={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");let f=this.rules.other.listItemRegex(i),m=!1;for(;t;){let b=!1,y="",w="";if(!(e=f.exec(t))||this.rules.block.hr.test(t))break;y=e[0],t=t.substring(y.length);let x=v_(e[2].split(`
`,1)[0],e[1].length),I=t.split(`
`,1)[0],G=!x.trim(),A=0;if(this.options.pedantic?(A=2,w=x.trimStart()):G?A=e[1].length+1:(A=x.search(this.rules.other.nonSpaceChar),A=A>4?1:A,w=x.slice(A),A+=e[1].length),G&&this.rules.other.blankLine.test(I)&&(y+=I+`
`,t=t.substring(I.length+1),b=!0),!b){let V=this.rules.other.nextBulletRegex(A),de=this.rules.other.hrRegex(A),Z=this.rules.other.fencesBeginRegex(A),R=this.rules.other.headingBeginRegex(A),X=this.rules.other.htmlBeginRegex(A),ce=this.rules.other.blockquoteBeginRegex(A);for(;t;){let D=t.split(`
`,1)[0],pe;if(I=D,this.options.pedantic?(I=I.replace(this.rules.other.listReplaceNesting,"  "),pe=I):pe=I.replace(this.rules.other.tabCharGlobal,"    "),Z.test(I)||R.test(I)||X.test(I)||ce.test(I)||V.test(I)||de.test(I))break;if(pe.search(this.rules.other.nonSpaceChar)>=A||!I.trim())w+=`
`+pe.slice(A);else{if(G||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Z.test(x)||R.test(x)||de.test(x))break;w+=`
`+I}G=!I.trim(),y+=D+`
`,t=t.substring(D.length+1),x=pe.slice(A)}}c.loose||(m?c.loose=!0:this.rules.other.doubleBlankLine.test(y)&&(m=!0)),c.items.push({type:"list_item",raw:y,task:!!this.options.gfm&&this.rules.other.listIsTask.test(w),loose:!1,text:w,tokens:[]}),c.raw+=y}let h=c.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;c.raw=c.raw.trimEnd();for(let b of c.items){if(this.lexer.state.top=!1,b.tokens=this.lexer.blockTokens(b.text,[]),b.task){if(b.text=b.text.replace(this.rules.other.listReplaceTask,""),((n=b.tokens[0])==null?void 0:n.type)==="text"||((a=b.tokens[0])==null?void 0:a.type)==="paragraph"){b.tokens[0].raw=b.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),b.tokens[0].text=b.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let w=this.lexer.inlineQueue.length-1;w>=0;w--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[w].src)){this.lexer.inlineQueue[w].src=this.lexer.inlineQueue[w].src.replace(this.rules.other.listReplaceTask,"");break}}let y=this.rules.other.listTaskCheckbox.exec(b.raw);if(y){let w={type:"checkbox",raw:y[0]+" ",checked:y[0]!=="[ ]"};b.checked=w.checked,c.loose?b.tokens[0]&&["paragraph","text"].includes(b.tokens[0].type)&&"tokens"in b.tokens[0]&&b.tokens[0].tokens?(b.tokens[0].raw=w.raw+b.tokens[0].raw,b.tokens[0].text=w.raw+b.tokens[0].text,b.tokens[0].tokens.unshift(w)):b.tokens.unshift({type:"paragraph",raw:w.raw,text:w.raw,tokens:[w]}):b.tokens.unshift(w)}}if(!c.loose){let y=b.tokens.filter(x=>x.type==="space"),w=y.length>0&&y.some(x=>this.rules.other.anyLine.test(x.raw));c.loose=w}}if(c.loose)for(let b of c.items){b.loose=!0;for(let y of b.tokens)y.type==="text"&&(y.type="paragraph")}return c}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:i}}}table(t){var c;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=Tc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(c=e[3])!=null&&c.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let f of a)this.rules.other.tableAlignRight.test(f)?o.align.push("right"):this.rules.other.tableAlignCenter.test(f)?o.align.push("center"):this.rules.other.tableAlignLeft.test(f)?o.align.push("left"):o.align.push(null);for(let f=0;f<n.length;f++)o.header.push({text:n[f],tokens:this.lexer.inline(n[f]),header:!0,align:o.align[f]});for(let f of i)o.rows.push(Tc(f,o.header.length).map((m,h)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:o.align[h]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=cs(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=f_(e[2],"()");if(o===-2)return;if(o>-1){let c=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,c).trim(),e[3]=""}}let a=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),Ac(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[a.toLowerCase()];if(!i){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Ac(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...a[0]].length-1,o,c,f=i,m=0,h=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,e=e.slice(-1*t.length+i);(a=h.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(c=[...o].length,a[3]||a[4]){f+=c;continue}else if((a[5]||a[6])&&i%3&&!((i+c)%3)){m+=c;continue}if(f-=c,f>0)continue;c=Math.min(c,c+f+m);let b=[...a[0]][0].length,y=t.slice(0,i+a.index+b+c);if(Math.min(i,c)%2){let x=y.slice(1,-1);return{type:"em",raw:y,text:x,tokens:this.lexer.inlineTokens(x)}}let w=y.slice(2,-2);return{type:"strong",raw:y,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let i=[...a[0]].length-1,o,c,f=i,m=this.rules.inline.delRDelim;for(m.lastIndex=0,e=e.slice(-1*t.length+i);(a=m.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(c=[...o].length,c!==i))continue;if(a[3]||a[4]){f+=c;continue}if(f-=c,f>0)continue;c=Math.min(c,c+f);let h=[...a[0]][0].length,b=t.slice(0,i+a.index+h+c),y=b.slice(i,-i);return{type:"del",raw:b,text:y,tokens:this.lexer.inlineTokens(y)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,i;if(e[2]==="@")a=e[0],i="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:a,href:i,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},tr=class qo{constructor(e){st(this,"tokens");st(this,"options");st(this,"state");st(this,"inlineQueue");st(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ea,this.options.tokenizer=this.options.tokenizer||new yi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:pn,block:si.normal,inline:ls.normal};this.options.pedantic?(n.block=si.pedantic,n.inline=ls.pedantic):this.options.gfm&&(n.block=si.gfm,this.options.breaks?n.inline=ls.breaks:n.inline=ls.gfm),this.tokenizer.rules=n}static get rules(){return{block:si,inline:ls}}static lex(e,n){return new qo(n).lex(e)}static lexInline(e,n){return new qo(n).inlineTokens(e)}lex(e){e=e.replace(pn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var i,o,c;for(this.options.pedantic&&(e=e.replace(pn.tabCharGlobal,"    ").replace(pn.spaceLine,""));e;){let f;if((o=(i=this.options.extensions)==null?void 0:i.block)!=null&&o.some(h=>(f=h.call({lexer:this},e,n))?(e=e.substring(f.raw.length),n.push(f),!0):!1))continue;if(f=this.tokenizer.space(e)){e=e.substring(f.raw.length);let h=n.at(-1);f.raw.length===1&&h!==void 0?h.raw+=`
`:n.push(f);continue}if(f=this.tokenizer.code(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.at(-1).src=h.text):n.push(f);continue}if(f=this.tokenizer.fences(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.heading(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.hr(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.blockquote(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.list(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.html(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.def(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.raw,this.inlineQueue.at(-1).src=h.text):this.tokens.links[f.tag]||(this.tokens.links[f.tag]={href:f.href,title:f.title},n.push(f));continue}if(f=this.tokenizer.table(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.lheading(e)){e=e.substring(f.raw.length),n.push(f);continue}let m=e;if((c=this.options.extensions)!=null&&c.startBlock){let h=1/0,b=e.slice(1),y;this.options.extensions.startBlock.forEach(w=>{y=w.call({lexer:this},b),typeof y=="number"&&y>=0&&(h=Math.min(h,y))}),h<1/0&&h>=0&&(m=e.substring(0,h+1))}if(this.state.top&&(f=this.tokenizer.paragraph(m))){let h=n.at(-1);a&&(h==null?void 0:h.type)==="paragraph"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):n.push(f),a=m.length!==e.length,e=e.substring(f.raw.length);continue}if(f=this.tokenizer.text(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):n.push(f);continue}if(e){let h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var m,h,b,y,w;let a=e,i=null;if(this.tokens.links){let x=Object.keys(this.tokens.links);if(x.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)x.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,i.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=i[2]?i[2].length:0,a=a.slice(0,i.index+o)+"["+"a".repeat(i[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((h=(m=this.options.hooks)==null?void 0:m.emStrongMask)==null?void 0:h.call({lexer:this},a))??a;let c=!1,f="";for(;e;){c||(f=""),c=!1;let x;if((y=(b=this.options.extensions)==null?void 0:b.inline)!=null&&y.some(G=>(x=G.call({lexer:this},e,n))?(e=e.substring(x.raw.length),n.push(x),!0):!1))continue;if(x=this.tokenizer.escape(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.tag(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.link(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(x.raw.length);let G=n.at(-1);x.type==="text"&&(G==null?void 0:G.type)==="text"?(G.raw+=x.raw,G.text+=x.text):n.push(x);continue}if(x=this.tokenizer.emStrong(e,a,f)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.codespan(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.br(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.del(e,a,f)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.autolink(e)){e=e.substring(x.raw.length),n.push(x);continue}if(!this.state.inLink&&(x=this.tokenizer.url(e))){e=e.substring(x.raw.length),n.push(x);continue}let I=e;if((w=this.options.extensions)!=null&&w.startInline){let G=1/0,A=e.slice(1),V;this.options.extensions.startInline.forEach(de=>{V=de.call({lexer:this},A),typeof V=="number"&&V>=0&&(G=Math.min(G,V))}),G<1/0&&G>=0&&(I=e.substring(0,G+1))}if(x=this.tokenizer.inlineText(I)){e=e.substring(x.raw.length),x.raw.slice(-1)!=="_"&&(f=x.raw.slice(-1)),c=!0;let G=n.at(-1);(G==null?void 0:G.type)==="text"?(G.raw+=x.raw,G.text+=x.text):n.push(x);continue}if(e){let G="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(G);break}else throw new Error(G)}}return n}},bi=class{constructor(t){st(this,"options");st(this,"parser");this.options=t||Ea}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(pn.notSpaceStart))==null?void 0:o[0],i=t.replace(pn.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Sr(a)+'">'+(n?i:Sr(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:Sr(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let c=0;c<t.items.length;c++){let f=t.items[c];a+=this.listitem(f)}let i=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+i+o+`>
`+a+"</"+i+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let i=0;i<t.header.length;i++)n+=this.tablecell(t.header[i]);e+=this.tablerow({text:n});let a="";for(let i=0;i<t.rows.length;i++){let o=t.rows[i];n="";for(let c=0;c<o.length;c++)n+=this.tablecell(o[c]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Sr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),i=Ec(t);if(i===null)return a;t=i;let o='<a href="'+t+'"';return e&&(o+=' title="'+Sr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let i=Ec(t);if(i===null)return Sr(n);t=i;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Sr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Sr(t.text)}},yl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},nr=class Bo{constructor(e){st(this,"options");st(this,"renderer");st(this,"textRenderer");this.options=e||Ea,this.options.renderer=this.options.renderer||new bi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new yl}static parse(e,n){return new Bo(n).parse(e)}static parseInline(e,n){return new Bo(n).parseInline(e)}parse(e){var a,i;let n="";for(let o=0;o<e.length;o++){let c=e[o];if((i=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&i[c.type]){let m=c,h=this.options.extensions.renderers[m.type].call({parser:this},m);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(m.type)){n+=h||"";continue}}let f=c;switch(f.type){case"space":{n+=this.renderer.space(f);break}case"hr":{n+=this.renderer.hr(f);break}case"heading":{n+=this.renderer.heading(f);break}case"code":{n+=this.renderer.code(f);break}case"table":{n+=this.renderer.table(f);break}case"blockquote":{n+=this.renderer.blockquote(f);break}case"list":{n+=this.renderer.list(f);break}case"checkbox":{n+=this.renderer.checkbox(f);break}case"html":{n+=this.renderer.html(f);break}case"def":{n+=this.renderer.def(f);break}case"paragraph":{n+=this.renderer.paragraph(f);break}case"text":{n+=this.renderer.text(f);break}default:{let m='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return n}parseInline(e,n=this.renderer){var i,o;let a="";for(let c=0;c<e.length;c++){let f=e[c];if((o=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&o[f.type]){let h=this.options.extensions.renderers[f.type].call({parser:this},f);if(h!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(f.type)){a+=h||"";continue}}let m=f;switch(m.type){case"escape":{a+=n.text(m);break}case"html":{a+=n.html(m);break}case"link":{a+=n.link(m);break}case"image":{a+=n.image(m);break}case"checkbox":{a+=n.checkbox(m);break}case"strong":{a+=n.strong(m);break}case"em":{a+=n.em(m);break}case"codespan":{a+=n.codespan(m);break}case"br":{a+=n.br(m);break}case"del":{a+=n.del(m);break}case"text":{a+=n.text(m);break}default:{let h='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return a}},li,gs=(li=class{constructor(t){st(this,"options");st(this,"block");this.options=t||Ea}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?tr.lex:tr.lexInline}provideParser(){return this.block?nr.parse:nr.parseInline}},st(li,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),st(li,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),li),h_=class{constructor(...t){st(this,"defaults",dl());st(this,"options",this.setOptions);st(this,"parse",this.parseMarkdown(!0));st(this,"parseInline",this.parseMarkdown(!1));st(this,"Parser",nr);st(this,"Renderer",bi);st(this,"TextRenderer",yl);st(this,"Lexer",tr);st(this,"Tokenizer",yi);st(this,"Hooks",gs);this.use(...t)}walkTokens(t,e){var a,i;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let c=o;for(let f of c.header)n=n.concat(this.walkTokens(f.tokens,e));for(let f of c.rows)for(let m of f)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let c=o;n=n.concat(this.walkTokens(c.items,e));break}default:{let c=o;(i=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&i[c.type]?this.defaults.extensions.childTokens[c.type].forEach(f=>{let m=c[f].flat(1/0);n=n.concat(this.walkTokens(m,e))}):c.tokens&&(n=n.concat(this.walkTokens(c.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...c){let f=i.renderer.apply(this,c);return f===!1&&(f=o.apply(this,c)),f}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),a.extensions=e),n.renderer){let i=this.defaults.renderer||new bi(this.defaults);for(let o in n.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let c=o,f=n.renderer[c],m=i[c];i[c]=(...h)=>{let b=f.apply(i,h);return b===!1&&(b=m.apply(i,h)),b||""}}a.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new yi(this.defaults);for(let o in n.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let c=o,f=n.tokenizer[c],m=i[c];i[c]=(...h)=>{let b=f.apply(i,h);return b===!1&&(b=m.apply(i,h)),b}}a.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new gs;for(let o in n.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let c=o,f=n.hooks[c],m=i[c];gs.passThroughHooks.has(o)?i[c]=h=>{if(this.defaults.async&&gs.passThroughHooksRespectAsync.has(o))return(async()=>{let y=await f.call(i,h);return m.call(i,y)})();let b=f.call(i,h);return m.call(i,b)}:i[c]=(...h)=>{if(this.defaults.async)return(async()=>{let y=await f.apply(i,h);return y===!1&&(y=await m.apply(i,h)),y})();let b=f.apply(i,h);return b===!1&&(b=m.apply(i,h)),b}}a.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(c){let f=[];return f.push(o.call(this,c)),i&&(f=f.concat(i.call(this,c))),f}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return tr.lex(t,e??this.defaults)}parser(t,e){return nr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},i={...this.defaults,...a},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=t),i.async)return(async()=>{let c=i.hooks?await i.hooks.preprocess(e):e,f=await(i.hooks?await i.hooks.provideLexer():t?tr.lex:tr.lexInline)(c,i),m=i.hooks?await i.hooks.processAllTokens(f):f;i.walkTokens&&await Promise.all(this.walkTokens(m,i.walkTokens));let h=await(i.hooks?await i.hooks.provideParser():t?nr.parse:nr.parseInline)(m,i);return i.hooks?await i.hooks.postprocess(h):h})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let c=(i.hooks?i.hooks.provideLexer():t?tr.lex:tr.lexInline)(e,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let f=(i.hooks?i.hooks.provideParser():t?nr.parse:nr.parseInline)(c,i);return i.hooks&&(f=i.hooks.postprocess(f)),f}catch(c){return o(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Sr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},xa=new h_;function _t(t,e){return xa.parse(t,e)}_t.options=_t.setOptions=function(t){return xa.setOptions(t),_t.defaults=xa.defaults,fd(_t.defaults),_t};_t.getDefaults=dl;_t.defaults=Ea;_t.use=function(...t){return xa.use(...t),_t.defaults=xa.defaults,fd(_t.defaults),_t};_t.walkTokens=function(t,e){return xa.walkTokens(t,e)};_t.parseInline=xa.parseInline;_t.Parser=nr;_t.parser=nr.parse;_t.Renderer=bi;_t.TextRenderer=yl;_t.Lexer=tr;_t.lexer=tr.lex;_t.Tokenizer=yi;_t.Hooks=gs;_t.parse=_t;_t.options;_t.setOptions;_t.use;_t.walkTokens;_t.parseInline;nr.parse;tr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Sd,setPrototypeOf:Cc,isFrozen:m_,getPrototypeOf:g_,getOwnPropertyDescriptor:__}=Object;let{freeze:hn,seal:Gn,create:zo}=Object,{apply:Fo,construct:Ko}=typeof Reflect<"u"&&Reflect;hn||(hn=function(e){return e});Gn||(Gn=function(e){return e});Fo||(Fo=function(e,n){for(var a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];return e.apply(n,i)});Ko||(Ko=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return new e(...a)});const ii=mn(Array.prototype.forEach),y_=mn(Array.prototype.lastIndexOf),Pc=mn(Array.prototype.pop),us=mn(Array.prototype.push),b_=mn(Array.prototype.splice),pi=mn(String.prototype.toLowerCase),vo=mn(String.prototype.toString),po=mn(String.prototype.match),ds=mn(String.prototype.replace),w_=mn(String.prototype.indexOf),k_=mn(String.prototype.trim),Jn=mn(Object.prototype.hasOwnProperty),vn=mn(RegExp.prototype.test),fs=x_(TypeError);function mn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return Fo(t,e,a)}}function x_(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Ko(t,n)}}function rt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pi;Cc&&Cc(t,null);let a=e.length;for(;a--;){let i=e[a];if(typeof i=="string"){const o=n(i);o!==i&&(m_(e)||(e[a]=o),i=o)}t[i]=!0}return t}function S_(t){for(let e=0;e<t.length;e++)Jn(t,e)||(t[e]=null);return t}function vr(t){const e=zo(null);for(const[n,a]of Sd(t))Jn(t,n)&&(Array.isArray(a)?e[n]=S_(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=vr(a):e[n]=a);return e}function vs(t,e){for(;t!==null;){const a=__(t,e);if(a){if(a.get)return mn(a.get);if(typeof a.value=="function")return mn(a.value)}t=g_(t)}function n(){return null}return n}const Ic=hn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ho=hn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),mo=hn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),E_=hn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),go=hn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),T_=hn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Rc=hn(["#text"]),Oc=hn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),_o=hn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Mc=hn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),oi=hn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),A_=Gn(/\{\{[\w\W]*|[\w\W]*\}\}/gm),C_=Gn(/<%[\w\W]*|[\w\W]*%>/gm),P_=Gn(/\$\{[\w\W]*/gm),I_=Gn(/^data-[\-\w.\u00B7-\uFFFF]+$/),R_=Gn(/^aria-[\-\w]+$/),Ed=Gn(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),O_=Gn(/^(?:\w+script|data):/i),M_=Gn(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Td=Gn(/^html$/i),j_=Gn(/^[a-z][.\w]*(-[.\w]+)+$/i);var jc=Object.freeze({__proto__:null,ARIA_ATTR:R_,ATTR_WHITESPACE:M_,CUSTOM_ELEMENT:j_,DATA_ATTR:I_,DOCTYPE_NAME:Td,ERB_EXPR:C_,IS_ALLOWED_URI:Ed,IS_SCRIPT_OR_DATA:O_,MUSTACHE_EXPR:A_,TMPLIT_EXPR:P_});const ps={element:1,text:3,progressingInstruction:7,comment:8,document:9},D_=function(){return typeof window>"u"?null:window},L_=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(a=n.getAttribute(i));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Dc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ad(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D_();const e=Ke=>Ad(Ke);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==ps.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,i=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:c,Node:f,Element:m,NodeFilter:h,NamedNodeMap:b=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:y,DOMParser:w,trustedTypes:x}=t,I=m.prototype,G=vs(I,"cloneNode"),A=vs(I,"remove"),V=vs(I,"nextSibling"),de=vs(I,"childNodes"),Z=vs(I,"parentNode");if(typeof c=="function"){const Ke=n.createElement("template");Ke.content&&Ke.content.ownerDocument&&(n=Ke.content.ownerDocument)}let R,X="";const{implementation:ce,createNodeIterator:D,createDocumentFragment:pe,getElementsByTagName:ke}=n,{importNode:ue}=a;let ge=Dc();e.isSupported=typeof Sd=="function"&&typeof Z=="function"&&ce&&ce.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ae,ERB_EXPR:_e,TMPLIT_EXPR:fe,DATA_ATTR:ie,ARIA_ATTR:he,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:oe,CUSTOM_ELEMENT:ve}=jc;let{IS_ALLOWED_URI:se}=jc,le=null;const te=rt({},[...Ic,...ho,...mo,...go,...Rc]);let L=null;const T=rt({},[...Oc,..._o,...Mc,...oi]);let F=Object.seal(zo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),H=null,ee=null;const Te=Object.seal(zo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Re=!0,M=!0,we=!1,Ae=!0,qe=!1,Qe=!0,et=!1,xt=!1,Tt=!1,At=!1,Ze=!1,Be=!1,Ge=!0,pt=!1;const It="user-content-";let ut=!0,Ve=!1,Ye={},We=null;const lt=rt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Rt=null;const Yt=rt({},["audio","video","img","source","image","track"]);let en=null;const Lt=rt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),St="http://www.w3.org/1998/Math/MathML",Qt="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let Oe=at,Ot=!1,Kt=null;const xn=rt({},[St,Qt,at],vo);let Ie=rt({},["mi","mo","mn","ms","mtext"]),Xt=rt({},["annotation-xml"]);const Ta=rt({},["title","style","font","a","script"]);let Wn=null;const Aa=["application/xhtml+xml","text/html"],wr="text/html";let Mt=null,Hn=null;const lr=n.createElement("form"),Sn=function(j){return j instanceof RegExp||j instanceof Function},cr=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Hn&&Hn===j)){if((!j||typeof j!="object")&&(j={}),j=vr(j),Wn=Aa.indexOf(j.PARSER_MEDIA_TYPE)===-1?wr:j.PARSER_MEDIA_TYPE,Mt=Wn==="application/xhtml+xml"?vo:pi,le=Jn(j,"ALLOWED_TAGS")?rt({},j.ALLOWED_TAGS,Mt):te,L=Jn(j,"ALLOWED_ATTR")?rt({},j.ALLOWED_ATTR,Mt):T,Kt=Jn(j,"ALLOWED_NAMESPACES")?rt({},j.ALLOWED_NAMESPACES,vo):xn,en=Jn(j,"ADD_URI_SAFE_ATTR")?rt(vr(Lt),j.ADD_URI_SAFE_ATTR,Mt):Lt,Rt=Jn(j,"ADD_DATA_URI_TAGS")?rt(vr(Yt),j.ADD_DATA_URI_TAGS,Mt):Yt,We=Jn(j,"FORBID_CONTENTS")?rt({},j.FORBID_CONTENTS,Mt):lt,H=Jn(j,"FORBID_TAGS")?rt({},j.FORBID_TAGS,Mt):vr({}),ee=Jn(j,"FORBID_ATTR")?rt({},j.FORBID_ATTR,Mt):vr({}),Ye=Jn(j,"USE_PROFILES")?j.USE_PROFILES:!1,Re=j.ALLOW_ARIA_ATTR!==!1,M=j.ALLOW_DATA_ATTR!==!1,we=j.ALLOW_UNKNOWN_PROTOCOLS||!1,Ae=j.ALLOW_SELF_CLOSE_IN_ATTR!==!1,qe=j.SAFE_FOR_TEMPLATES||!1,Qe=j.SAFE_FOR_XML!==!1,et=j.WHOLE_DOCUMENT||!1,At=j.RETURN_DOM||!1,Ze=j.RETURN_DOM_FRAGMENT||!1,Be=j.RETURN_TRUSTED_TYPE||!1,Tt=j.FORCE_BODY||!1,Ge=j.SANITIZE_DOM!==!1,pt=j.SANITIZE_NAMED_PROPS||!1,ut=j.KEEP_CONTENT!==!1,Ve=j.IN_PLACE||!1,se=j.ALLOWED_URI_REGEXP||Ed,Oe=j.NAMESPACE||at,Ie=j.MATHML_TEXT_INTEGRATION_POINTS||Ie,Xt=j.HTML_INTEGRATION_POINTS||Xt,F=j.CUSTOM_ELEMENT_HANDLING||{},j.CUSTOM_ELEMENT_HANDLING&&Sn(j.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(F.tagNameCheck=j.CUSTOM_ELEMENT_HANDLING.tagNameCheck),j.CUSTOM_ELEMENT_HANDLING&&Sn(j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(F.attributeNameCheck=j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),j.CUSTOM_ELEMENT_HANDLING&&typeof j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(F.allowCustomizedBuiltInElements=j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),qe&&(M=!1),Ze&&(At=!0),Ye&&(le=rt({},Rc),L=[],Ye.html===!0&&(rt(le,Ic),rt(L,Oc)),Ye.svg===!0&&(rt(le,ho),rt(L,_o),rt(L,oi)),Ye.svgFilters===!0&&(rt(le,mo),rt(L,_o),rt(L,oi)),Ye.mathMl===!0&&(rt(le,go),rt(L,Mc),rt(L,oi))),j.ADD_TAGS&&(typeof j.ADD_TAGS=="function"?Te.tagCheck=j.ADD_TAGS:(le===te&&(le=vr(le)),rt(le,j.ADD_TAGS,Mt))),j.ADD_ATTR&&(typeof j.ADD_ATTR=="function"?Te.attributeCheck=j.ADD_ATTR:(L===T&&(L=vr(L)),rt(L,j.ADD_ATTR,Mt))),j.ADD_URI_SAFE_ATTR&&rt(en,j.ADD_URI_SAFE_ATTR,Mt),j.FORBID_CONTENTS&&(We===lt&&(We=vr(We)),rt(We,j.FORBID_CONTENTS,Mt)),j.ADD_FORBID_CONTENTS&&(We===lt&&(We=vr(We)),rt(We,j.ADD_FORBID_CONTENTS,Mt)),ut&&(le["#text"]=!0),et&&rt(le,["html","head","body"]),le.table&&(rt(le,["tbody"]),delete H.tbody),j.TRUSTED_TYPES_POLICY){if(typeof j.TRUSTED_TYPES_POLICY.createHTML!="function")throw fs('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof j.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw fs('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');R=j.TRUSTED_TYPES_POLICY,X=R.createHTML("")}else R===void 0&&(R=L_(x,i)),R!==null&&typeof X=="string"&&(X=R.createHTML(""));hn&&hn(j),Hn=j}},kr=rt({},[...ho,...mo,...E_]),Et=rt({},[...go,...T_]),Vt=function(j){let Ee=Z(j);(!Ee||!Ee.tagName)&&(Ee={namespaceURI:Oe,tagName:"template"});const Me=pi(j.tagName),ht=pi(Ee.tagName);return Kt[j.namespaceURI]?j.namespaceURI===Qt?Ee.namespaceURI===at?Me==="svg":Ee.namespaceURI===St?Me==="svg"&&(ht==="annotation-xml"||Ie[ht]):!!kr[Me]:j.namespaceURI===St?Ee.namespaceURI===at?Me==="math":Ee.namespaceURI===Qt?Me==="math"&&Xt[ht]:!!Et[Me]:j.namespaceURI===at?Ee.namespaceURI===Qt&&!Xt[ht]||Ee.namespaceURI===St&&!Ie[ht]?!1:!Et[Me]&&(Ta[Me]||!kr[Me]):!!(Wn==="application/xhtml+xml"&&Kt[j.namespaceURI]):!1},Mn=function(j){us(e.removed,{element:j});try{Z(j).removeChild(j)}catch{A(j)}},jn=function(j,Ee){try{us(e.removed,{attribute:Ee.getAttributeNode(j),from:Ee})}catch{us(e.removed,{attribute:null,from:Ee})}if(Ee.removeAttribute(j),j==="is")if(At||Ze)try{Mn(Ee)}catch{}else try{Ee.setAttribute(j,"")}catch{}},Yr=function(j){let Ee=null,Me=null;if(Tt)j="<remove></remove>"+j;else{const Bt=po(j,/^[\r\n\t ]+/);Me=Bt&&Bt[0]}Wn==="application/xhtml+xml"&&Oe===at&&(j='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+j+"</body></html>");const ht=R?R.createHTML(j):j;if(Oe===at)try{Ee=new w().parseFromString(ht,Wn)}catch{}if(!Ee||!Ee.documentElement){Ee=ce.createDocument(Oe,"template",null);try{Ee.documentElement.innerHTML=Ot?X:ht}catch{}}const Ct=Ee.body||Ee.documentElement;return j&&Me&&Ct.insertBefore(n.createTextNode(Me),Ct.childNodes[0]||null),Oe===at?ke.call(Ee,et?"html":"body")[0]:et?Ee.documentElement:Ct},Qr=function(j){return D.call(j.ownerDocument||j,j,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},Xa=function(j){return j instanceof y&&(typeof j.nodeName!="string"||typeof j.textContent!="string"||typeof j.removeChild!="function"||!(j.attributes instanceof b)||typeof j.removeAttribute!="function"||typeof j.setAttribute!="function"||typeof j.namespaceURI!="string"||typeof j.insertBefore!="function"||typeof j.hasChildNodes!="function")},Vn=function(j){return typeof f=="function"&&j instanceof f};function cn(Ke,j,Ee){ii(Ke,Me=>{Me.call(e,j,Ee,Hn)})}const Yn=function(j){let Ee=null;if(cn(ge.beforeSanitizeElements,j,null),Xa(j))return Mn(j),!0;const Me=Mt(j.nodeName);if(cn(ge.uponSanitizeElement,j,{tagName:Me,allowedTags:le}),Qe&&j.hasChildNodes()&&!Vn(j.firstElementChild)&&vn(/<[/\w!]/g,j.innerHTML)&&vn(/<[/\w!]/g,j.textContent)||j.nodeType===ps.progressingInstruction||Qe&&j.nodeType===ps.comment&&vn(/<[/\w]/g,j.data))return Mn(j),!0;if(!(Te.tagCheck instanceof Function&&Te.tagCheck(Me))&&(!le[Me]||H[Me])){if(!H[Me]&&qs(Me)&&(F.tagNameCheck instanceof RegExp&&vn(F.tagNameCheck,Me)||F.tagNameCheck instanceof Function&&F.tagNameCheck(Me)))return!1;if(ut&&!We[Me]){const ht=Z(j)||j.parentNode,Ct=de(j)||j.childNodes;if(Ct&&ht){const Bt=Ct.length;for(let Gt=Bt-1;Gt>=0;--Gt){const gn=G(Ct[Gt],!0);gn.__removalCount=(j.__removalCount||0)+1,ht.insertBefore(gn,V(j))}}}return Mn(j),!0}return j instanceof m&&!Vt(j)||(Me==="noscript"||Me==="noembed"||Me==="noframes")&&vn(/<\/no(script|embed|frames)/i,j.innerHTML)?(Mn(j),!0):(qe&&j.nodeType===ps.text&&(Ee=j.textContent,ii([ae,_e,fe],ht=>{Ee=ds(Ee,ht," ")}),j.textContent!==Ee&&(us(e.removed,{element:j.cloneNode()}),j.textContent=Ee)),cn(ge.afterSanitizeElements,j,null),!1)},Xr=function(j,Ee,Me){if(Ge&&(Ee==="id"||Ee==="name")&&(Me in n||Me in lr))return!1;if(!(M&&!ee[Ee]&&vn(ie,Ee))){if(!(Re&&vn(he,Ee))){if(!(Te.attributeCheck instanceof Function&&Te.attributeCheck(Ee,j))){if(!L[Ee]||ee[Ee]){if(!(qs(j)&&(F.tagNameCheck instanceof RegExp&&vn(F.tagNameCheck,j)||F.tagNameCheck instanceof Function&&F.tagNameCheck(j))&&(F.attributeNameCheck instanceof RegExp&&vn(F.attributeNameCheck,Ee)||F.attributeNameCheck instanceof Function&&F.attributeNameCheck(Ee,j))||Ee==="is"&&F.allowCustomizedBuiltInElements&&(F.tagNameCheck instanceof RegExp&&vn(F.tagNameCheck,Me)||F.tagNameCheck instanceof Function&&F.tagNameCheck(Me))))return!1}else if(!en[Ee]){if(!vn(se,ds(Me,oe,""))){if(!((Ee==="src"||Ee==="xlink:href"||Ee==="href")&&j!=="script"&&w_(Me,"data:")===0&&Rt[j])){if(!(we&&!vn(be,ds(Me,oe,"")))){if(Me)return!1}}}}}}}return!0},qs=function(j){return j!=="annotation-xml"&&po(j,ve)},Qn=function(j){cn(ge.beforeSanitizeAttributes,j,null);const{attributes:Ee}=j;if(!Ee||Xa(j))return;const Me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:L,forceKeepAttr:void 0};let ht=Ee.length;for(;ht--;){const Ct=Ee[ht],{name:Bt,namespaceURI:Gt,value:gn}=Ct,ur=Mt(Bt),Zr=gn;let jt=Bt==="value"?Zr:k_(Zr);if(Me.attrName=ur,Me.attrValue=jt,Me.keepAttr=!0,Me.forceKeepAttr=void 0,cn(ge.uponSanitizeAttribute,j,Me),jt=Me.attrValue,pt&&(ur==="id"||ur==="name")&&(jn(Bt,j),jt=It+jt),Qe&&vn(/((--!?|])>)|<\/(style|title|textarea)/i,jt)){jn(Bt,j);continue}if(ur==="attributename"&&po(jt,"href")){jn(Bt,j);continue}if(Me.forceKeepAttr)continue;if(!Me.keepAttr){jn(Bt,j);continue}if(!Ae&&vn(/\/>/i,jt)){jn(Bt,j);continue}qe&&ii([ae,_e,fe],Jr=>{jt=ds(jt,Jr," ")});const Za=Mt(j.nodeName);if(!Xr(Za,ur,jt)){jn(Bt,j);continue}if(R&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Gt)switch(x.getAttributeType(Za,ur)){case"TrustedHTML":{jt=R.createHTML(jt);break}case"TrustedScriptURL":{jt=R.createScriptURL(jt);break}}if(jt!==Zr)try{Gt?j.setAttributeNS(Gt,Bt,jt):j.setAttribute(Bt,jt),Xa(j)?Mn(j):Pc(e.removed)}catch{jn(Bt,j)}}cn(ge.afterSanitizeAttributes,j,null)},Bs=function Ke(j){let Ee=null;const Me=Qr(j);for(cn(ge.beforeSanitizeShadowDOM,j,null);Ee=Me.nextNode();)cn(ge.uponSanitizeShadowNode,Ee,null),Yn(Ee),Qn(Ee),Ee.content instanceof o&&Ke(Ee.content);cn(ge.afterSanitizeShadowDOM,j,null)};return e.sanitize=function(Ke){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ee=null,Me=null,ht=null,Ct=null;if(Ot=!Ke,Ot&&(Ke="<!-->"),typeof Ke!="string"&&!Vn(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw fs("dirty is not a string, aborting")}else throw fs("toString is not a function");if(!e.isSupported)return Ke;if(xt||cr(j),e.removed=[],typeof Ke=="string"&&(Ve=!1),Ve){if(Ke.nodeName){const gn=Mt(Ke.nodeName);if(!le[gn]||H[gn])throw fs("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof f)Ee=Yr("<!---->"),Me=Ee.ownerDocument.importNode(Ke,!0),Me.nodeType===ps.element&&Me.nodeName==="BODY"||Me.nodeName==="HTML"?Ee=Me:Ee.appendChild(Me);else{if(!At&&!qe&&!et&&Ke.indexOf("<")===-1)return R&&Be?R.createHTML(Ke):Ke;if(Ee=Yr(Ke),!Ee)return At?null:Be?X:""}Ee&&Tt&&Mn(Ee.firstChild);const Bt=Qr(Ve?Ke:Ee);for(;ht=Bt.nextNode();)Yn(ht),Qn(ht),ht.content instanceof o&&Bs(ht.content);if(Ve)return Ke;if(At){if(Ze)for(Ct=pe.call(Ee.ownerDocument);Ee.firstChild;)Ct.appendChild(Ee.firstChild);else Ct=Ee;return(L.shadowroot||L.shadowrootmode)&&(Ct=ue.call(a,Ct,!0)),Ct}let Gt=et?Ee.outerHTML:Ee.innerHTML;return et&&le["!doctype"]&&Ee.ownerDocument&&Ee.ownerDocument.doctype&&Ee.ownerDocument.doctype.name&&vn(Td,Ee.ownerDocument.doctype.name)&&(Gt="<!DOCTYPE "+Ee.ownerDocument.doctype.name+`>
`+Gt),qe&&ii([ae,_e,fe],gn=>{Gt=ds(Gt,gn," ")}),R&&Be?R.createHTML(Gt):Gt},e.setConfig=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};cr(Ke),xt=!0},e.clearConfig=function(){Hn=null,xt=!1},e.isValidAttribute=function(Ke,j,Ee){Hn||cr({});const Me=Mt(Ke),ht=Mt(j);return Xr(Me,ht,Ee)},e.addHook=function(Ke,j){typeof j=="function"&&us(ge[Ke],j)},e.removeHook=function(Ke,j){if(j!==void 0){const Ee=y_(ge[Ke],j);return Ee===-1?void 0:b_(ge[Ke],Ee,1)[0]}return Pc(ge[Ke])},e.removeHooks=function(Ke){ge[Ke]=[]},e.removeAllHooks=function(){ge=Dc()},e}var N_=Ad();function q_(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Lc(t.from)} |`),e.push(`| **To** | ${Lc(t.to)} |`),e.push(`| **Date** | ${ol(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?B_(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Lc(t){return(t||"").replace(/\|/g,"\\|")}function B_(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Uo(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function z_(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const i=e.toLowerCase();return i.includes("spacer")||i.includes("transparent")||i.includes("transp.gif")||i.includes("/track")&&i.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(i)?!0:i.includes("mail.google.com/mail/u/")&&i.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(i)||i.endsWith(".gif")&&i.includes("1x1"))}function Uo(t){var i;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",c=t.getAttribute("alt")||"";return z_(t,o)?"":`![${c}](${o})`}const n=Array.from(t.childNodes).map(Uo).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((i=t.parentElement)==null?void 0:i.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(c=>Uo(c).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),c=(o.match(/\|/g)||[]).length-1,f="| "+Array(Math.max(c,1)).fill("---").join(" | ")+" |";return`${o}${f}
`}return n}function F_(t){return Hu(t,"md")}function Nc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}function K_(t){return t.raw||null}function U_(t){const e=K_(t);return e?JSON.stringify(e,null,2):"null"}function G_(t){return Hu(t,"json")}var W_=P('<button title="View as Markdown">.md</button>'),H_=P('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),V_=P('<pre class="md-raw svelte-1b0rzpb"> </pre>'),Y_=P('<div class="md-preview svelte-1b0rzpb"><!></div>'),Q_=P('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),X_=P('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),Z_=P('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),J_=P('<pre class="message-text svelte-1b0rzpb"> </pre>'),$_=P('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),ey=P('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),ty=P('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function ny(t,e){yt(e,!0);let n=Le(e,"loading",3,!1);ln(()=>On("MessageModal"));const a=new _t.Renderer;a.link=({href:ae,title:_e,text:fe})=>{const ie=_e?` title="${_e}"`:"";return`<a href="${ae}"${ie} target="_blank" rel="noopener">${fe}</a>`},_t.setOptions({breaks:!0,gfm:!0,renderer:a});let i=Pe("email"),o=ft(()=>e.message.body?q_(e.message):""),c=ft(()=>U_(e.message)),f=Pe("raw");function m(ae){C(i,d(i)===ae?"email":ae,!0),ae==="markdown"&&C(f,"raw")}function h(){Nc(d(o),F_(e.message))}function b(){Nc(d(c),G_(e.message),"application/json;charset=utf-8")}function y(ae){const _e=_t.parse(ae);return N_.sanitize(_e,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let w=Pe(null);ba(()=>{var ae;if(d(w)&&e.message.htmlBody&&!n()&&d(i)==="email"){const _e=d(w).contentDocument||((ae=d(w).contentWindow)==null?void 0:ae.document);_e&&(_e.open(),_e.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),_e.close())}});var x=ty();x.__click=function(...ae){var _e;(_e=e.onclose)==null||_e.apply(this,ae)};var I=p(x);I.__click=ae=>ae.stopPropagation();var G=p(I),A=p(G),V=p(A),de=_(A,2),Z=p(de);let R;Z.__click=()=>m("json");var X=_(Z,2);{var ce=ae=>{var _e=W_();let fe;_e.__click=()=>m("markdown"),$(()=>fe=Dt(_e,1,"action-btn svelte-1b0rzpb",null,fe,{active:d(i)==="markdown"})),E(ae,_e)};re(X,ae=>{e.message.body&&ae(ce)})}var D=_(X,2);D.__click=function(...ae){var _e;(_e=e.onclose)==null||_e.apply(this,ae)};var pe=_(G,2);{var ke=ae=>{var _e=H_(),fe=Xe(_e),ie=_(p(fe),2);ie.__click=b;var he=_(fe,2),be=p(he),oe=p(be);$(()=>U(oe,d(c))),E(ae,_e)},ue=ae=>{var _e=Q_(),fe=Xe(_e),ie=p(fe),he=p(ie);let be;he.__click=()=>C(f,"raw");var oe=_(he,2);let ve;oe.__click=()=>C(f,"preview");var se=_(ie,2);se.__click=h;var le=_(fe,2),te=p(le);{var L=F=>{var H=V_(),ee=p(H);$(()=>U(ee,d(o))),E(F,H)},T=F=>{var H=Y_(),ee=p(H);yv(ee,()=>y(d(o))),E(F,H)};re(te,F=>{d(f)==="raw"?F(L):F(T,!1)})}$(()=>{be=Dt(he,1,"md-tab svelte-1b0rzpb",null,be,{active:d(f)==="raw"}),ve=Dt(oe,1,"md-tab svelte-1b0rzpb",null,ve,{active:d(f)==="preview"})}),E(ae,_e)},ge=ae=>{var _e=ey(),fe=Xe(_e),ie=p(fe),he=_(p(ie),2),be=p(he),oe=_(ie,2),ve=_(p(oe),2),se=p(ve),le=_(oe,2),te=_(p(le),2),L=p(te),T=_(fe,2),F=p(T);{var H=M=>{var we=X_();E(M,we)},ee=M=>{var we=Z_();qu(we,Ae=>C(w,Ae),()=>d(w)),E(M,we)},Te=M=>{var we=J_(),Ae=p(we);$(()=>U(Ae,e.message.body)),E(M,we)},Re=M=>{var we=$_();E(M,we)};re(F,M=>{n()?M(H):e.message.htmlBody?M(ee,1):e.message.body?M(Te,2):M(Re,!1)})}$(M=>{U(be,e.message.from),U(se,e.message.to),U(L,M)},[()=>ol(e.message.date)]),E(ae,_e)};re(pe,ae=>{d(i)==="json"?ae(ke):d(i)==="markdown"?ae(ue,1):ae(ge,!1)})}$(()=>{U(V,e.message.subject),R=Dt(Z,1,"action-btn svelte-1b0rzpb",null,R,{active:d(i)==="json"})}),E(t,x),bt()}qt(["click"]);var ry=P('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),ay=P('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),sy=P('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),iy=P("<p> </p>"),oy=P('<p>No emails in local storage. Click "Sync New" to download.</p>'),ly=P('<div class="empty-state svelte-6ts5xm"><!></div>'),cy=P('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),uy=P('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function dy(t,e){yt(e,!0),ln(()=>On("DashboardView"));let n=Le(e,"error",3,null),a=Le(e,"profile",3,null),i=Le(e,"loadingProfile",3,!1),o=Le(e,"emailMessages",19,()=>[]),c=Le(e,"totalLocalMessages",3,0),f=Le(e,"hasMoreLocal",3,!1),m=Le(e,"loadingMessages",3,!1),h=Le(e,"selectedMessage",3,null),b=Le(e,"syncStatus",3,null),y=Le(e,"syncProgress",3,null),w=Le(e,"isSyncing",3,!1),x=Le(e,"searchQuery",15);var I=uy(),G=Xe(I),A=p(G);{var V=ie=>{dd(ie,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};re(A,ie=>{n()&&ie(V)})}var de=_(A,2);ug(de,{get profile(){return a()},get loadingProfile(){return i()},get onsignout(){return e.onsignout}});var Z=_(de,2);xg(Z,{get syncStatus(){return b()},get syncProgress(){return y()},get isSyncing(){return w()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var R=_(Z,2),X=p(R);X.__keydown=ie=>ie.key==="Enter"&&e.onsearch();var ce=_(X,2);ce.__click=function(...ie){var he;(he=e.onsearch)==null||he.apply(this,ie)};var D=p(ce),pe=_(R,2);{var ke=ie=>{var he=ay(),be=Xe(he),oe=p(be),ve=p(oe),se=_(be,2);Tg(se,{get messages(){return o()},get onselect(){return e.onviewmessage}});var le=_(se,2);{var te=L=>{var T=ry(),F=p(T);F.__click=function(...ee){var Te;(Te=e.onloadmore)==null||Te.apply(this,ee)};var H=p(F);$(()=>{F.disabled=m(),U(H,m()?"Loading...":"Load More")}),E(L,T)};re(le,L=>{f()&&L(te)})}$(L=>U(ve,`Showing ${o().length??""} of ${L??""}
        ${x()?" matching":""} emails`),[()=>c().toLocaleString()]),E(ie,he)},ue=ie=>{var he=sy();E(ie,he)},ge=ie=>{var he=ly(),be=p(he);{var oe=se=>{var le=iy(),te=p(le);$(()=>U(te,`No emails match "${x()??""}".`)),E(se,le)},ve=se=>{var le=oy();E(se,le)};re(be,se=>{x()?se(oe):se(ve,!1)})}E(ie,he)},ae=ie=>{var he=cy();E(ie,he)};re(pe,ie=>{var he;o().length>0?ie(ke):m()?ie(ue,1):(he=b())!=null&&he.synced?ie(ge,2):ie(ae,!1)})}var _e=_(G,2);{var fe=ie=>{ny(ie,{get message(){return h()},loading:!1,get onclose(){return e.onclosedetail}})};re(_e,ie=>{h()&&ie(fe)})}$(()=>{ce.disabled=m(),U(D,m()?"Searching...":"Search")}),er(X,x),E(t,I),bt()}qt(["keydown","click"]);var fy=P('<div class="dashboard svelte-1q5o2lv"><!></div>');function vy(t,e){yt(e,!0);function n(M){M.key==="Escape"&&d(y)&&se()}let a=null;ln(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}));function i(){a&&clearTimeout(a);const M=Nm();if(M<=0)return;const we=Math.max(0,M-120*1e3);a=setTimeout(async()=>{try{const Ae=await yc();C(h,Ae.access_token,!0),i()}catch{C(h,null),C(b,null),C(Z,"Session expired. Please sign in again.")}},we)}async function o(){if(Lm())return d(h);try{const M=await yc();return C(h,M.access_token,!0),i(),d(h)}catch{return C(h,null),C(b,null),C(Z,"Session expired. Please sign in again."),null}}let c=Pe(Nt(localStorage.getItem("googleClientId")||"")),f=Pe(Nt(localStorage.getItem("googleClientId")||"")),m=Pe(!1),h=Pe(null),b=Pe(null),y=Pe(null),w=Pe(""),x=Pe(Nt([])),I=Pe(0),G=Pe(0),A=Pe(!1),V=Pe(!1),de=Pe(!1),Z=Pe(null),R=Pe(null),X=Pe(null),ce=Pe(!1);const D=50;ba(()=>{d(h)&&(le(),he())});let pe=ft(()=>!d(c)),ke=ft(()=>!!d(h)),ue=ft(()=>d(x).length<d(I));ba(()=>{d(c)&&!d(m)&&bc(d(c)).then(()=>{if(C(m,!0),!d(h)){const M=Dm();M&&(C(h,M.access_token,!0),i(),ie())}}).catch(M=>{C(Z,`Auth init failed: ${M.message}`)})});function ge(){const M=d(f).trim();M&&(localStorage.setItem("googleClientId",M),C(c,M,!0),C(Z,null))}function ae(){localStorage.removeItem("googleClientId"),C(c,""),C(f,""),C(m,!1),C(h,null),C(b,null),C(x,[],!0),C(I,0)}async function _e(){C(Z,null),C(V,!0);try{d(m)||(await bc(d(c)),C(m,!0));const M=await Bm();C(h,M.access_token,!0),i(),await ie()}catch(M){C(Z,M.message,!0)}finally{C(V,!1)}}async function fe(){if(a&&clearTimeout(a),d(h))try{await zm(d(h))}catch{}C(h,null),C(b,null),C(x,[],!0),C(I,0),C(y,null),C(Z,null)}async function ie(){C(de,!0);try{const M=await Fu(d(h));if(!d(h))return;C(b,M,!0)}catch(M){if(!d(h))return;C(Z,`Profile fetch failed: ${M.message}`)}finally{C(de,!1)}}async function he(M=!1){C(A,!0);try{const we=M?d(G):0,Ae=await np({query:d(w)||void 0,limit:D,offset:we});M?C(x,[...d(x),...Ae.items],!0):C(x,Ae.items,!0),C(I,Ae.total,!0),C(G,d(x).length,!0)}catch(we){C(Z,`Failed to load messages: ${we.message}`)}finally{C(A,!1)}}function be(){C(G,0),he(!1)}function oe(){he(!0)}function ve(M){C(y,M,!0)}function se(){C(y,null)}async function le(){try{C(R,await Um(),!0)}catch{}}async function te(M){if(d(ce)||!d(h))return;const we=await o();if(!we)return;C(Z,null),C(ce,!0),C(X,null);const Ae=new AbortController;try{await Fm(we,{limit:M,onProgress:qe=>{C(X,{...qe},!0)},signal:Ae.signal}),await le(),await he(!1)}catch(qe){if(qe.name!=="AbortError"){if(!d(h))return;C(Z,`Sync failed: ${qe.message}`)}}finally{C(ce,!1)}}async function L(M){if(d(ce)||!d(h))return;const we=await o();if(!we)return;C(Z,null),C(ce,!0),C(X,null);const Ae=new AbortController;try{await Km(we,{limit:M,onProgress:qe=>{C(X,{...qe},!0)},signal:Ae.signal}),await le(),await he(!1)}catch(qe){if(qe.name!=="AbortError"){if(!d(h))return;C(Z,`Sync more failed: ${qe.message}`)}}finally{C(ce,!1)}}async function T(){try{await od(),await le(),C(x,[],!0),C(I,0),C(G,0)}catch(M){C(Z,`Failed to clear data: ${M.message}`)}}var F=fy(),H=p(F);{var ee=M=>{Qm(M,{onsave:ge,get clientIdInput(){return d(f)},set clientIdInput(we){C(f,we,!0)}})},Te=M=>{ig(M,{get clientId(){return d(c)},get error(){return d(Z)},get loadingAuth(){return d(V)},onsignin:_e,onclear:ae,onsignout:fe})},Re=M=>{dy(M,{get error(){return d(Z)},get profile(){return d(b)},get loadingProfile(){return d(de)},get emailMessages(){return d(x)},get totalLocalMessages(){return d(I)},get hasMoreLocal(){return d(ue)},get loadingMessages(){return d(A)},get selectedMessage(){return d(y)},get syncStatus(){return d(R)},get syncProgress(){return d(X)},get isSyncing(){return d(ce)},onsignout:fe,onsearch:be,onloadmore:oe,onviewmessage:ve,onclosedetail:se,ondismisserror:()=>C(Z,null),onsync:te,onsyncmore:L,oncleardata:T,get searchQuery(){return d(w)},set searchQuery(we){C(w,we,!0)}})};re(H,M=>{d(pe)?M(ee):d(ke)?M(Re,!1):M(Te,1)})}E(t,F),bt()}var py=P('<span class="err svelte-t1ig66"> </span>'),hy=P('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),my=P('<span class="stream-stats svelte-t1ig66"> </span>'),gy=P('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),_y=P('<span class="ei-action svelte-t1ig66"> </span>'),yy=P('<span class="ei-action err svelte-t1ig66">ERROR</span>'),by=P('<span class="sep svelte-t1ig66">Â·</span> ',1),wy=P('<div class="ei-summary svelte-t1ig66"> </div>'),ky=P('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),xy=P('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),Sy=P("<!> <!> <!>",1),Ey=P('<div class="ei-error svelte-t1ig66"> </div>'),Ty=P('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),Ay=P('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Cy=P('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Py=P('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Iy=P(' <span class="sep svelte-t1ig66">Â·</span>',1),Ry=P('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Oy=P('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),My=P('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),jy=P('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function Dy(t,e){yt(e,!0);let n=Le(e,"progress",3,null);function a(w){return!w||w<0?"â":w<1e3?`${Math.round(w)}ms`:`${(w/1e3).toFixed(1)}s`}function i(w){return w?w>=1e3?`${(w/1e3).toFixed(1)}k`:String(w):"0"}function o(w){if(!w)return"â";const x=w.replace(/<.*>/,"").trim();return x.length>30?x.slice(0,28)+"â¦":x}function c(w){if(!w)return"";try{return new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let f=ft(()=>{var w;return(w=n())!=null&&w.total?Math.round(n().current/n().total*100):0}),m=ft(()=>{var w;return((w=n())==null?void 0:w.phase)==="done"});var h=Un(),b=Xe(h);{var y=w=>{var x=jy(),I=p(x),G=p(I),A=p(G);{var V=te=>{var L=Or();$(()=>U(L,`Scan complete â ${(n().classified||0)??""} classified`)),E(te,L)},de=te=>{var L=Or("Loading emailsâ¦");E(te,L)},Z=te=>{var L=Or();$(()=>U(L,`Processing ${n().current??0??""} / ${n().total??0??""}`)),E(te,L)};re(A,te=>{d(m)?te(V):n().phase==="loading"?te(de,1):te(Z,!1)})}var R=_(G,2),X=p(R),ce=_(I,2),D=p(ce);let pe,ke;var ue=_(ce,2);{var ge=te=>{var L=hy(),T=p(L),F=_(T);{var H=Re=>{var M=py(),we=p(M);$(()=>U(we,`Â· ${n().errors??""} errors`)),E(Re,M)};re(F,Re=>{n().errors&&Re(H)})}var ee=_(F,3),Te=_(ee,2);$((Re,M,we)=>{U(T,`${(n().classified||0)??""} classified `),U(ee,` ${Re??""} in + ${M??""} out `),U(Te,` ${we??""}`)},[()=>i(n().totals.inputTokens),()=>i(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(te,L)};re(ue,te=>{n().totals&&!d(m)&&te(ge)})}var ae=_(ue,2);{var _e=te=>{var L=gy(),T=p(L),F=p(T),H=p(F),ee=_(F,2);{var Te=we=>{var Ae=my(),qe=p(Ae);$(Qe=>U(qe,`${Qe??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),E(we,Ae)};re(ee,we=>{var Ae;(Ae=n().live)!=null&&Ae.tps&&we(Te)})}var Re=_(T,2),M=p(Re);$(()=>{U(H,n().email.subject||"(no subject)"),U(M,n().streamingText||"Waiting for modelâ¦")}),E(te,L)};re(ae,te=>{!d(m)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&te(_e)})}var fe=_(ae,2);{var ie=te=>{var L=Ay(),T=p(L),F=_(p(T),2),H=p(F),ee=_(T,2);kt(ee,17,()=>n().results,Ft,(Te,Re,M)=>{var we=Ty();let Ae;var qe=p(we),Qe=p(qe);Qe.textContent=`${M+1}.`;var et=_(Qe,2),xt=p(et),Tt=_(et,2);{var At=We=>{var lt=_y(),Rt=p(lt);$(()=>U(Rt,d(Re).classification.action)),E(We,lt)},Ze=We=>{var lt=yy();E(We,lt)};re(Tt,We=>{d(Re).success?We(At):We(Ze,!1)})}var Be=_(qe,2),Ge=p(Be),pt=_(Ge);{var It=We=>{var lt=by(),Rt=_(Xe(lt),1,!0);$(Yt=>U(Rt,Yt),[()=>c(d(Re).email.date)]),E(We,lt)};re(pt,We=>{d(Re).email.date&&We(It)})}var ut=_(Be,2);{var Ve=We=>{var lt=Sy(),Rt=Xe(lt);{var Yt=at=>{var Oe=wy(),Ot=p(Oe);$(()=>U(Ot,d(Re).classification.summary)),E(at,Oe)};re(Rt,at=>{d(Re).classification.summary&&at(Yt)})}var en=_(Rt,2);{var Lt=at=>{var Oe=ky(),Ot=p(Oe),Kt=_(Ot,2),xn=_(Kt,2);$((Ie,Xt)=>{U(Ot,`${Ie??""} `),U(Kt,` ${(d(Re).stats.inputTokens||0)??""} in + ${(d(Re).stats.numTokens||0)??""} out `),U(xn,` ${Xt??""}`)},[()=>d(Re).stats.tps?`${d(Re).stats.tps.toFixed(0)} tok/s`:"â",()=>a(d(Re).stats.elapsed)]),E(at,Oe)};re(en,at=>{d(Re).stats&&at(Lt)})}var St=_(en,2);{var Qt=at=>{var Oe=xy(),Ot=_(p(Oe),2),Kt=p(Ot);$(()=>U(Kt,d(Re).rawResponse)),E(at,Oe)};re(St,at=>{d(Re).rawResponse&&at(Qt)})}E(We,lt)},Ye=We=>{var lt=Ey(),Rt=p(lt);$(()=>U(Rt,d(Re).error)),E(We,lt)};re(ut,We=>{d(Re).success?We(Ve):We(Ye,!1)})}$(We=>{Ae=Dt(we,1,"email-item svelte-t1ig66",null,Ae,{failed:!d(Re).success}),U(xt,d(Re).email.subject||"(no subject)"),U(Ge,We)},[()=>o(d(Re).email.from)]),E(Te,we)}),$(()=>U(H,n().results.length)),E(te,L)};re(fe,te=>{var L;((L=n().results)==null?void 0:L.length)>0&&te(ie)})}var he=_(fe,2);{var be=te=>{var L=Ry(),T=p(L),F=p(T),H=p(F),ee=_(F,4),Te=p(ee),Re=_(ee,2);{var M=Ze=>{var Be=Cy(),Ge=_(Xe(Be)),pt=p(Ge);$(()=>U(pt,`${n().errors??""} errors`)),E(Ze,Be)};re(Re,Ze=>{n().errors>0&&Ze(M)})}var we=_(Re,2);{var Ae=Ze=>{var Be=Py(),Ge=_(Xe(Be)),pt=p(Ge);$(()=>U(pt,`${n().summary.skipped??""} skipped`)),E(Ze,Be)};re(we,Ze=>{var Be;(Be=n().summary)!=null&&Be.skipped&&Ze(Ae)})}var qe=_(T,2),Qe=p(qe);{var et=Ze=>{var Be=Iy(),Ge=Xe(Be);$(()=>U(Ge,`Avg ${n().summary.avgTps??""} tok/s`)),E(Ze,Be)};re(Qe,Ze=>{var Be;(Be=n().summary)!=null&&Be.avgTps&&Ze(et)})}var xt=_(Qe),Tt=_(xt,2),At=_(Tt,2);$((Ze,Be,Ge)=>{var pt,It;U(H,`${(((pt=n().summary)==null?void 0:pt.processed)||n().total||0)??""} processed`),U(Te,`${(n().classified||0)??""} classified`),U(xt,` ${Ze??""} in + ${Be??""} out `),U(Tt,` ${Ge??""} `),U(At,` Model: ${(((It=n().summary)==null?void 0:It.modelName)||"Unknown")??""}`)},[()=>i(n().totals.inputTokens),()=>i(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(te,L)};re(he,te=>{d(m)&&n().totals&&te(be)})}var oe=_(he,2),ve=p(oe);{var se=te=>{var L=Oy(),T=Xe(L);T.__click=function(...H){var ee;(ee=e.oninspect)==null||ee.apply(this,H)};var F=_(T,2);F.__click=function(...H){var ee;(ee=e.onclose)==null||ee.apply(this,H)},E(te,L)},le=te=>{var L=My(),T=Xe(L);T.__click=function(...H){var ee;(ee=e.oninspect)==null||ee.apply(this,H)};var F=_(T,2);F.__click=function(...H){var ee;(ee=e.onstop)==null||ee.apply(this,H)},E(te,L)};re(ve,te=>{d(m)?te(se):te(le,!1)})}$(()=>{U(X,`${d(f)??""}%`),pe=Dt(D,1,"bar-fill svelte-t1ig66",null,pe,{done:d(m)}),ke=rn(D,"",ke,{width:`${d(f)??""}%`})}),E(w,x)};re(b,w=>{n()&&w(y)})}E(t,h),bt()}qt(["click"]);var Ly=P('<span class="spinner svelte-ois7em"></span>'),Ny=nl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),qy=P('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),By=P("<option> </option>"),zy=P('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),Fy=P('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function Ky(t,e){yt(e,!0);let n=Le(e,"engineStatus",3,"idle"),a=Le(e,"modelName",3,""),i=Le(e,"isScanning",3,!1),o=Le(e,"scanProgress",3,null),c=Le(e,"scanCount",15,20),f=Le(e,"stats",3,null);const m=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function h(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function b(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function y(){return n()==="ready"&&!i()}let w=ft(()=>{var L;return i()&&((L=o())==null?void 0:L.phase)!=="done"});var x=Fy(),I=p(x),G=p(I),A=p(G);{var V=L=>{var T=Ly();E(L,T)},de=L=>{var T=Ny();E(L,T)};re(A,L=>{d(w)?L(V):L(de,!1)})}var Z=_(G,2),R=p(Z),X=_(p(R),2);X.__click=function(...L){var T;(T=e.oninspect)==null||T.apply(this,L)};var ce=_(R,2),D=p(ce);let pe;var ke=_(D),ue=_(I,2);{var ge=L=>{var T=qy(),F=p(T),H=p(F),ee=_(F,4),Te=p(ee),Re=_(ee,4),M=p(Re);$(()=>{U(H,`${f().totalEmails??""} emails in storage`),U(Te,`${f().classified??""} classified`),U(M,`${f().unclassified??""} new`)}),E(L,T)};re(ue,L=>{f()&&L(ge)})}var ae=_(ue,2),_e=p(ae),fe=_(p(_e),2);kt(fe,21,()=>m,Ft,(L,T)=>{var F=By(),H=p(F),ee={};$(()=>{U(H,d(T).label),ee!==(ee=d(T).value)&&(F.value=(F.__value=d(T).value)??"")}),E(L,F)});var ie=_(_e,2),he=p(ie);he.__click=function(...L){var T;(T=e.onscan)==null||T.apply(this,L)};var be=p(he),oe=_(he,2);oe.__click=function(...L){var T;(T=e.onrescan)==null||T.apply(this,L)};var ve=_(ae,2);{var se=L=>{var T=zy();E(L,T)};re(ve,L=>{n()!=="ready"&&n()!=="loading"&&L(se)})}var le=_(ve,2);{var te=L=>{Dy(L,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};re(le,L=>{var T;(i()||((T=o())==null?void 0:T.phase)==="done")&&L(te)})}$((L,T,F,H)=>{pe=rn(D,"",pe,L),U(ke,` ${T??""}`),fe.disabled=i(),he.disabled=F,U(be,d(w)?"Scanning...":i()?"Finalizing...":"Scan New"),oe.disabled=H},[()=>({background:b()}),h,()=>!y(),()=>!y()]),Ai(fe,c),E(t,x),bt()}qt(["click"]);var Uy=P('<span class="row-date svelte-1czytqk"> </span>'),Gy=P('<span class="tag svelte-1czytqk"> </span>'),Wy=P('<span class="row-tags svelte-1czytqk"></span>'),Hy=P('<span class="row-reason svelte-1czytqk"> </span>'),Vy=P('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),Yy=P('<span class="status-label svelte-1czytqk"> </span>'),Qy=P('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),Xy=P('<p class="summary-reason svelte-1czytqk"> </p>'),Zy=P('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),Jy=P('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function qc(t,e){yt(e,!0);let n=Le(e,"actionColor",3,"#666"),a=Le(e,"dimmed",3,!1);function i(ie){if(!ie)return"";try{return new Date(ie).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=ft(()=>e.item.status==="pending"),c=Pe(!1);var f=Jy(),m=Xe(f);let h;var b=p(m);b.__click=()=>C(c,!d(c));let y;var w=p(b),x=p(w),I=_(w,2),G=p(I),A=p(G),V=_(G,2);{var de=ie=>{var he=Uy(),be=p(he);$(oe=>U(be,oe),[()=>i(e.item.date)]),E(ie,he)};re(V,ie=>{e.item.date&&ie(de)})}var Z=_(I,2);{var R=ie=>{var he=Wy();kt(he,21,()=>e.item.tags,Ft,(be,oe)=>{var ve=Gy();let se;var le=p(ve);$(te=>{se=rn(ve,"",se,te),U(le,d(oe))},[()=>({background:Pp(d(oe))})]),E(be,ve)}),E(ie,he)};re(Z,ie=>{e.item.tags&&e.item.tags.length>0&&ie(R)})}var X=_(Z,2);{var ce=ie=>{var he=Hy(),be=p(he);$(()=>U(be,e.item.reason)),E(ie,he)};re(X,ie=>{e.item.reason&&!d(c)&&ie(ce)})}var D=_(b,2),pe=p(D);{var ke=ie=>{var he=Vy(),be=Xe(he);be.__click=()=>e.onmarkacted(e.item.emailId);var oe=_(be,2);oe.__click=()=>e.ondismiss(e.item.emailId),E(ie,he)},ue=ie=>{var he=Yy(),be=p(he);$(()=>U(be,e.item.status)),E(ie,he)};re(pe,ie=>{d(o)?ie(ke):ie(ue,!1)})}var ge=_(pe,2);{var ae=ie=>{var he=Qy();he.__click=()=>e.onremove(e.item.emailId),E(ie,he)};re(ge,ie=>{e.onremove&&ie(ae)})}var _e=_(m,2);{var fe=ie=>{var he=Zy();let be;var oe=p(he),ve=p(oe),se=_(oe,2);{var le=te=>{var L=Xy(),T=p(L);$(()=>U(T,e.item.reason)),E(te,L)};re(se,te=>{e.item.reason&&te(le)})}$(()=>{be=rn(he,"",be,{"border-left-color":n()}),U(ve,e.item.summary)}),E(ie,he)};re(_e,ie=>{d(c)&&e.item.summary&&ie(fe)})}$(()=>{h=Dt(m,1,"email-row svelte-1czytqk",null,h,{dimmed:a()}),y=rn(b,"",y,{"border-left-color":n()}),U(x,e.item.subject),U(A,e.item.from)}),E(t,f),bt()}qt(["click"]);var $y=P('<span class="group-acted svelte-tl1unp"> </span>'),eb=P('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),tb=P('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),nb=P('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),rb=P('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),ab=P('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),sb=P('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function ib(t,e){yt(e,!0);let n=Le(e,"color",3,"#888");Le(e,"count",3,0);let a=Le(e,"items",19,()=>[]),i=Le(e,"expanded",3,!1),o=ft(()=>a().filter(ce=>ce.status==="pending")),c=ft(()=>a().filter(ce=>ce.status!=="pending")),f=Pe(!1);function m(ce){return ce.split("_").map(D=>D.charAt(0)+D.slice(1).toLowerCase()).join(" ")}var h=sb(),b=p(h);b.__click=function(...ce){var D;(D=e.ontoggle)==null||D.apply(this,ce)};var y=p(b);let w;var x=p(y),I=_(y,2),G=p(I),A=_(I,2);{var V=ce=>{var D=$y(),pe=p(D);$(()=>U(pe,`${d(c).length??""} handled`)),E(ce,D)};re(A,ce=>{d(c).length>0&&ce(V)})}var de=_(A,4);let Z;var R=_(b,2);{var X=ce=>{var D=ab(),pe=p(D);{var ke=be=>{var oe=eb();E(be,oe)};re(pe,be=>{d(o).length===0&&d(c).length===0&&be(ke)})}var ue=_(pe,2);kt(ue,17,()=>d(o),be=>be.emailId,(be,oe)=>{qc(be,{get item(){return d(oe)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var ge=_(ue,2);{var ae=be=>{var oe=tb(),ve=p(oe),se=p(ve),le=_(ve,2);kt(le,17,()=>d(c),te=>te.emailId,(te,L)=>{qc(te,{get item(){return d(L)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),$(()=>U(se,`${d(c).length??""} handled`)),E(be,oe)};re(ge,be=>{d(c).length>0&&be(ae)})}var _e=_(ge,2),fe=p(_e);{var ie=be=>{var oe=nb();oe.__click=()=>C(f,!0),E(be,oe)},he=be=>{var oe=rb(),ve=p(oe),se=_(ve);se.__click=()=>C(f,!1);var le=_(se,2);le.__click=()=>{e.oncleargroup(),C(f,!1)},$(()=>U(ve,`Clear ${a().length??""} items? `)),E(be,oe)};re(fe,be=>{d(f)?be(he,!1):be(ie)})}E(ce,D)};re(R,ce=>{i()&&ce(X)})}$(ce=>{w=rn(y,"",w,{background:n()}),U(x,ce),U(G,d(o).length),Z=Dt(de,0,"chevron svelte-tl1unp",null,Z,{open:i()})},[()=>m(e.action)]),E(t,h),bt()}qt(["click"]);var ob=P(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),lb=P(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),cb=P(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),ub=P('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function db(t,e){yt(e,!0);let n=Le(e,"open",15,!1),a=Le(e,"sampleEmail",3,null),i=Pe("system");function o(){return a()?rd(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function c(){n(!1)}function f(y){y.target===y.currentTarget&&c()}var m=Un(),h=Xe(m);{var b=y=>{var w=ub();w.__click=f,w.__keydown=ae=>ae.key==="Escape"&&c();var x=p(w),I=p(x),G=_(p(I),2);G.__click=c;var A=_(I,2),V=p(A);let de;V.__click=()=>C(i,"system");var Z=_(V,2);let R;Z.__click=()=>C(i,"email");var X=_(Z,2);let ce;X.__click=()=>C(i,"config");var D=_(A,2),pe=p(D);{var ke=ae=>{var _e=ob(),fe=_(Xe(_e),2),ie=p(fe);$(()=>U(ie,ms)),E(ae,_e)},ue=ae=>{var _e=lb(),fe=_(Xe(_e),2),ie=_(p(fe),2);ie.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var he=_(fe,2),be=_(p(he),2),oe=p(be);$(ve=>U(oe,ve),[o]),E(ae,_e)},ge=ae=>{var _e=cb(),fe=_(Xe(_e),2),ie=p(fe),he=_(p(ie),2),be=p(he),oe=_(ie,2),ve=_(p(oe),2),se=p(ve),le=_(oe,2),te=_(p(le),2),L=p(te),T=_(fe,4);T.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,$(()=>{U(be,Ep.maxTokens),U(se,"false"),U(L,"false")}),E(ae,_e)};re(pe,ae=>{d(i)==="system"?ae(ke):d(i)==="email"?ae(ue,1):d(i)==="config"&&ae(ge,2)})}$(()=>{de=Dt(V,1,"tab svelte-10pcy9j",null,de,{active:d(i)==="system"}),R=Dt(Z,1,"tab svelte-10pcy9j",null,R,{active:d(i)==="email"}),ce=Dt(X,1,"tab svelte-10pcy9j",null,ce,{active:d(i)==="config"})}),E(y,w)};re(h,y=>{n()&&y(b)})}E(t,m),bt()}qt(["click","keydown"]);var fb=P('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),vb=P('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="type-count svelte-d25j4l"> </span></button>'),pb=P('<button class="text-btn svelte-d25j4l">Reset to defaults</button>'),hb=P('<div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" placeholder="Icon (emoji)" class="icon-input svelte-d25j4l"/> <input type="text" placeholder="Action name" class="name-input svelte-d25j4l"/></div> <input type="text" placeholder="Description" class="desc-input svelte-d25j4l"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Add Action</button></div></div>'),mb=P('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),gb=P('<span class="cmd-icon svelte-d25j4l"> </span>'),_b=P('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),yb=P('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),bb=P('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <!> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),wb=P('<div class="no-selection svelte-d25j4l"><p class="svelte-d25j4l">Select an event type on the left to view and edit its commands.</p></div>'),kb=P('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function xb(t,e){yt(e,!0);let n=Le(e,"open",15,!1),a=Pe(Nt([])),i=Pe(null),o=Pe(Nt([])),c=Pe(null),f=Pe(!1),m=Pe(""),h=Pe(!1),b=Pe(Nt({name:"",description:"",icon:""}));async function y(){C(a,await cp(),!0),d(i)&&C(o,ja(d(i)).map(ue=>({...ue})),!0)}ba(()=>{n()&&y()});function w(ue){C(i,ue,!0),C(o,ja(ue).map(ge=>({...ge})),!0),C(c,null),C(h,!1)}function x(ue){return ue.split("_").map(ge=>ge.charAt(0)+ge.slice(1).toLowerCase()).join(" ")}function I(ue){return`hsl(${Ci(ue)}, 55%, 55%)`}async function G(){const ue=d(m).trim();if(!ue)return;gp(ue),C(m,""),C(f,!1),await y();const ge=ue.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");w(ge)}async function A(){d(i)&&(bp(d(i)),await y(),C(o,ja(d(i)).map(ue=>({...ue})),!0))}async function V(){if(!d(b).name.trim())return;const ue=d(b).name.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");fp(d(i),{id:ue,name:d(b).name.trim(),description:d(b).description.trim(),icon:d(b).icon.trim()||void 0}),C(b,{name:"",description:"",icon:""},!0),C(h,!1),await y()}async function de(ue){pp(d(i),ue),await y()}function Z(ue){C(c,{...ue},!0)}async function R(){d(c)&&(mp(d(i),d(c).id,{name:d(c).name,description:d(c).description,icon:d(c).icon}),C(c,null),await y())}function X(){C(c,null)}async function ce(ue,ge){const ae=[...d(o)],_e=ue+ge;_e<0||_e>=ae.length||([ae[ue],ae[_e]]=[ae[_e],ae[ue]],up(d(i),ae),await y())}var D=Un(),pe=Xe(D);{var ke=ue=>{var ge=kb(),ae=p(ge),_e=p(ae),fe=_(p(_e),4);fe.__click=()=>n(!1);var ie=_(_e,2),he=p(ie),be=p(he),oe=_(p(be),2);oe.__click=()=>C(f,!d(f));var ve=_(be,2);{var se=H=>{var ee=fb(),Te=p(ee);Te.__keydown=M=>M.key==="Enter"&&G();var Re=_(Te,2);Re.__click=G,er(Te,()=>d(m),M=>C(m,M)),E(H,ee)};re(ve,H=>{d(f)&&H(se)})}var le=_(ve,2);kt(le,21,()=>d(a),Ft,(H,ee)=>{var Te=vb();let Re;Te.__click=()=>w(d(ee));var M=p(Te);let we;var Ae=_(M,2),qe=p(Ae),Qe=_(Ae,2),et=p(Qe);$((xt,Tt,At)=>{Re=Dt(Te,1,"type-item svelte-d25j4l",null,Re,{selected:d(i)===d(ee)}),we=rn(M,"",we,xt),U(qe,Tt),U(et,At)},[()=>({background:I(d(ee))}),()=>x(d(ee)),()=>ja(d(ee)).length]),E(H,Te)});var te=_(he,2),L=p(te);{var T=H=>{var ee=bb(),Te=Xe(ee),Re=p(Te);let M;var we=p(Re),Ae=_(Re,2),qe=p(Ae),Qe=_(Ae,6);{var et=Ve=>{var Ye=pb();Ye.__click=A,E(Ve,Ye)},xt=ft(()=>yp(d(i)));re(Qe,Ve=>{d(xt)&&Ve(et)})}var Tt=_(Qe,2);Tt.__click=()=>{C(h,!d(h)),C(c,null)};var At=p(Tt),Ze=_(Te,2);{var Be=Ve=>{var Ye=hb(),We=p(Ye),lt=p(We),Rt=_(lt,2),Yt=_(We,2),en=_(Yt,2),Lt=p(en);Lt.__click=V,er(lt,()=>d(b).icon,St=>d(b).icon=St),er(Rt,()=>d(b).name,St=>d(b).name=St),er(Yt,()=>d(b).description,St=>d(b).description=St),E(Ve,Ye)};re(Ze,Ve=>{d(h)&&Ve(Be)})}var Ge=_(Ze,2),pt=p(Ge);kt(pt,19,()=>d(o),Ve=>Ve.id,(Ve,Ye,We)=>{var lt=Un(),Rt=Xe(lt);{var Yt=Lt=>{var St=mb(),Qt=p(St),at=p(Qt),Oe=_(at,2),Ot=_(Qt,2),Kt=_(Ot,2),xn=p(Kt);xn.__click=R;var Ie=_(xn,2);Ie.__click=X,er(at,()=>d(c).icon,Xt=>d(c).icon=Xt),er(Oe,()=>d(c).name,Xt=>d(c).name=Xt),er(Ot,()=>d(c).description,Xt=>d(c).description=Xt),E(Lt,St)},en=Lt=>{var St=_b(),Qt=p(St),at=p(Qt),Oe=_(Qt,2),Ot=p(Oe);{var Kt=Sn=>{var cr=gb(),kr=p(cr);$(()=>U(kr,d(Ye).icon)),E(Sn,cr)};re(Ot,Sn=>{d(Ye).icon&&Sn(Kt)})}var xn=_(Ot,2),Ie=p(xn),Xt=p(Ie),Ta=_(Ie,2),Wn=p(Ta),Aa=_(Oe,2),wr=p(Aa);wr.__click=()=>ce(d(We),-1);var Mt=_(wr,2);Mt.__click=()=>ce(d(We),1);var Hn=_(Mt,2);Hn.__click=()=>Z(d(Ye));var lr=_(Hn,2);lr.__click=()=>de(d(Ye).id),$(()=>{U(at,d(We)+1),U(Xt,d(Ye).name),U(Wn,d(Ye).description),wr.disabled=d(We)===0,Mt.disabled=d(We)===d(o).length-1}),E(Lt,St)};re(Rt,Lt=>{var St;((St=d(c))==null?void 0:St.id)===d(Ye).id?Lt(Yt):Lt(en,!1)})}E(Ve,lt)});var It=_(pt,2);{var ut=Ve=>{var Ye=yb();E(Ve,Ye)};re(It,Ve=>{d(o).length===0&&Ve(ut)})}$((Ve,Ye)=>{M=rn(Re,"",M,Ve),U(we,Ye),U(qe,`${d(o).length??""} action${d(o).length===1?"":"s"}`),U(At,d(h)?"Cancel":"+ Add Action")},[()=>({background:I(d(i))}),()=>x(d(i))]),E(H,ee)},F=H=>{var ee=wb();E(H,ee)};re(L,H=>{d(i)?H(T):H(F,!1)})}E(ue,ge)};re(pe,ue=>{n()&&ue(ke)})}E(t,D),bt()}qt(["click","keydown"]);var Sb=P('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Eb=P('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),Tb=P('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),Ab=P('<button class="chip svelte-s2dwjj"> </button>'),Cb=P('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),Pb=P('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Ib=P('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),Rb=P('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Ob=P('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),Mb=P('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),jb=P('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),Db=P('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),Lb=P('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),Nb=P('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),qb=P('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),Bb=P('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function zb(t,e){yt(e,!0);let n=Le(e,"groupOrder",19,()=>[]),a=Pe(!1),i=Pe(null),o=Pe(!1),c=Pe(null);async function f(){var ge;const[D,pe,ke]=await Promise.all([Ue.items.where("sourceType").equals("gmail").count(),Ue.emailClassifications.count(),Ue.contacts.count()]);let ue=0;try{const ae=await((ge=navigator.storage)==null?void 0:ge.estimate());ue=(ae==null?void 0:ae.usage)??0}catch{}C(c,{emailCount:D,classCount:pe,contactCount:ke,totalBytes:ue},!0)}function m(D){return D?D<1024?`${D} B`:D<1024*1024?`${(D/1024).toFixed(1)} KB`:`${(D/(1024*1024)).toFixed(1)} MB`:"â"}function h(){C(a,!d(a)),d(a)&&f()}async function b(D){var pe;C(o,!0),C(i,null);try{await D(),await f(),(pe=e.onrefresh)==null||pe.call(e)}finally{C(o,!1)}}async function y(){await b(()=>hc())}async function w(D){await b(()=>ll(D))}async function x(){await b(async()=>{await od(),await hc()})}async function I(){await b(()=>Ue.contacts.clear())}async function G(){await b(async()=>{await Ue.delete(),window.location.reload()})}function A(D){return D.split("_").map(pe=>pe.charAt(0)+pe.slice(1).toLowerCase()).join(" ")}var V=Bb(),de=p(V);de.__click=h;var Z=_(p(de),2);let R;var X=_(de,2);{var ce=D=>{var pe=qb(),ke=p(pe);{var ue=M=>{var we=Eb(),Ae=p(we),qe=p(Ae),Qe=_(Ae,4),et=p(Qe),xt=_(Qe,4),Tt=p(xt),At=_(xt,2);{var Ze=Be=>{var Ge=Sb(),pt=_(Xe(Ge),2),It=p(pt);$(ut=>U(It,`${ut??""} used`),[()=>m(d(c).totalBytes)]),E(Be,Ge)};re(At,Be=>{d(c).totalBytes&&Be(Ze)})}$(()=>{U(qe,`${d(c).emailCount??""} emails`),U(et,`${d(c).classCount??""} classifications`),U(Tt,`${d(c).contactCount??""} contacts`)}),E(M,we)};re(ke,M=>{d(c)&&M(ue)})}var ge=_(ke,2);{var ae=M=>{var we=Cb(),Ae=_(p(we),2);kt(Ae,21,n,Ft,(qe,Qe)=>{var et=Un(),xt=Xe(et);{var Tt=Ze=>{var Be=Tb(),Ge=p(Be),pt=_(Ge);pt.__click=()=>C(i,null);var It=_(pt,2);It.__click=()=>w(d(Qe)),$(ut=>{U(Ge,`Delete ${ut??""}? `),It.disabled=d(o)},[()=>A(d(Qe))]),E(Ze,Be)},At=Ze=>{var Be=Ab();Be.__click=()=>C(i,`group:${d(Qe)}`);var Ge=p(Be);$(pt=>{Be.disabled=d(o),U(Ge,`${pt??""} â`)},[()=>A(d(Qe))]),E(Ze,Be)};re(xt,Ze=>{d(i)===`group:${d(Qe)}`?Ze(Tt):Ze(At,!1)})}E(qe,et)}),E(M,we)};re(ge,M=>{n().length>0&&M(ae)})}var _e=_(ge,2),fe=_(p(_e),2),ie=p(fe);{var he=M=>{var we=Pb(),Ae=_(p(we),2);Ae.__click=()=>C(i,null);var qe=_(Ae,2);qe.__click=y,$(()=>qe.disabled=d(o)),E(M,we)},be=M=>{var we=Ib();we.__click=()=>C(i,"classifications"),$(()=>we.disabled=d(o)),E(M,we)};re(ie,M=>{d(i)==="classifications"?M(he):M(be,!1)})}var oe=_(ie,2);{var ve=M=>{var we=Rb(),Ae=_(p(we),2);Ae.__click=()=>C(i,null);var qe=_(Ae,2);qe.__click=x,$(()=>qe.disabled=d(o)),E(M,we)},se=M=>{var we=Ob();we.__click=()=>C(i,"emails"),$(()=>we.disabled=d(o)),E(M,we)};re(oe,M=>{d(i)==="emails"?M(ve):M(se,!1)})}var le=_(oe,2);{var te=M=>{var we=Mb(),Ae=_(p(we),2);Ae.__click=()=>C(i,null);var qe=_(Ae,2);qe.__click=I,$(()=>qe.disabled=d(o)),E(M,we)},L=M=>{var we=jb();we.__click=()=>C(i,"contacts"),$(()=>we.disabled=d(o)),E(M,we)};re(le,M=>{d(i)==="contacts"?M(te):M(L,!1)})}var T=_(_e,2),F=p(T);{var H=M=>{var we=Db(),Ae=_(p(we),2);Ae.__click=()=>C(i,null);var qe=_(Ae,2);qe.__click=G,$(()=>qe.disabled=d(o)),E(M,we)},ee=M=>{var we=Lb();we.__click=()=>C(i,"nuke"),$(()=>we.disabled=d(o)),E(M,we)};re(F,M=>{d(i)==="nuke"?M(H):M(ee,!1)})}var Te=_(T,2);{var Re=M=>{var we=Nb();E(M,we)};re(Te,M=>{d(o)&&M(Re)})}E(D,pe)};re(X,D=>{d(a)&&D(ce)})}$(()=>R=Dt(Z,0,"chev svelte-s2dwjj",null,R,{open:d(a)})),E(t,V),bt()}qt(["click"]);var Fb=P('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),Kb=P('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),Ub=P('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),Gb=P('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <div class="toolbar svelte-12gkq0i"><button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!></div>');function Wb(t,e){yt(e,!0);let n=Le(e,"groups",19,()=>({})),a=Le(e,"groupOrder",19,()=>[]),i=Le(e,"counts",19,()=>({})),o=Le(e,"stats",3,null),c=Le(e,"expandedGroup",3,null),f=Le(e,"isScanning",3,!1),m=Le(e,"scanProgress",3,null),h=Le(e,"scanCount",15,20),b=Le(e,"error",3,null),y=Pe(!1),w=Pe(!1),x=ft(()=>{for(const ue of a()){const ge=n()[ue];if((ge==null?void 0:ge.length)>0)return ge[0]}return null});var I=Gb(),G=p(I);Ky(G,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return f()},get scanProgress(){return m()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>C(y,!0),get scanCount(){return h()},set scanCount(ue){h(ue)}});var A=_(G,2);db(A,{get sampleEmail(){return d(x)},get open(){return d(y)},set open(ue){C(y,ue,!0)}});var V=_(A,2);xb(V,{get open(){return d(w)},set open(ue){C(w,ue,!0)}});var de=_(V,2),Z=p(de);Z.__click=()=>C(w,!0);var R=_(de,2);{var X=ue=>{var ge=Fb(),ae=p(ge),_e=p(ae),fe=_(ae,2);fe.__click=function(...ie){var he;(he=e.ondismisserror)==null||he.apply(this,ie)},$(()=>U(_e,b())),E(ue,ge)};re(R,ue=>{b()&&ue(X)})}var ce=_(R,2);{var D=ue=>{var ge=Kb(),ae=Xe(ge);kt(ae,20,a,he=>he,(he,be)=>{{let oe=ft(()=>Do(be)),ve=ft(()=>{var te;return((te=n()[be])==null?void 0:te.length)||0}),se=ft(()=>n()[be]||[]),le=ft(()=>c()===be);ib(he,{get action(){return be},get color(){return d(oe)},get count(){return d(ve)},get items(){return d(se)},get expanded(){return d(le)},ontoggle:()=>e.ontogglegroup(be),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(be)})}});var _e=_(ae,2),fe=p(_e),ie=p(fe);$(()=>U(ie,`${i().total??""} emails classified into ${a().length??""} groups`)),E(ue,ge)},pe=ue=>{var ge=Ub();E(ue,ge)};re(ce,ue=>{i().total>0?ue(D):f()||ue(pe,1)})}var ke=_(ce,2);zb(ke,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),E(t,I),bt()}qt(["click"]);var Hb=P('<div class="actions-page svelte-3tch4q"><!></div>');function Vb(t,e){yt(e,!0);const n=zu();let a=Pe(Nt(n.status)),i=Pe(""),o=Pe(Nt({})),c=Pe(Nt([])),f=Pe(Nt({total:0})),m=Pe(null),h=Pe(null),b=Pe(!1),y=Pe(null),w=Pe(3),x=Pe(null),I=Pe(null);const G="me-ai-scan-history";function A(){try{const fe=localStorage.getItem(G);if(fe)return JSON.parse(fe)}catch{}return null}function V(fe){if(!(!fe||fe.phase!=="done"))try{const ie={timestamp:Date.now(),classified:fe.classified||0,errors:fe.errors||0,total:fe.total||0,results:fe.results||[],totals:fe.totals||{},summary:fe.summary||{}};localStorage.setItem(G,JSON.stringify(ie))}catch{}}ln(()=>{const fe=n.onMessage(he=>{if(he.status==="ready"){C(a,"ready");const be=_r.find(se=>se.id===n.modelId),oe=sr.find(se=>se.name===n.modelId),ve=be||oe;C(i,(ve==null?void 0:ve.name)||(ve==null?void 0:ve.displayName)||n.modelId||"",!0)}he.status==="loading"&&C(a,"loading")});if(C(a,n.status,!0),n.modelId){const he=_r.find(ve=>ve.id===n.modelId),be=sr.find(ve=>ve.name===n.modelId),oe=he||be;C(i,(oe==null?void 0:oe.name)||(oe==null?void 0:oe.displayName)||n.modelId||"",!0)}const ie=A();return ie&&C(y,{phase:"done",...ie},!0),de(),()=>fe()});async function de(){try{const fe=await td();C(o,fe.groups,!0),C(c,fe.order,!0),C(f,await Tp(),!0),C(m,await jo(),!0)}catch(fe){C(x,`Failed to load data: ${fe.message}`)}}async function Z(){await X(!1)}async function R(){await X(!0)}async function X(fe){if(d(b)||!n.isReady)return;C(x,null),C(b,!0),C(y,null);const ie=new AbortController;C(I,ie,!0);try{await ed(n,{count:d(w),force:fe,signal:ie.signal,onProgress:he=>{C(y,{...he},!0),he.phase==="done"&&V(he)}}),await de()}catch(he){ie.signal.aborted||C(x,`Scan failed: ${he.message}`)}finally{C(b,!1),C(I,null)}}function ce(){var fe;(fe=d(I))==null||fe.abort()}async function D(fe){await gi(fe,"acted"),await de()}async function pe(fe){await gi(fe,"dismissed"),await de()}async function ke(fe){await nd(fe),await de()}async function ue(fe){await ll(fe),await de()}function ge(fe){C(h,d(h)===fe?null:fe,!0)}var ae=Hb(),_e=p(ae);Wb(_e,{get engineStatus(){return d(a)},get modelName(){return d(i)},get groups(){return d(o)},get groupOrder(){return d(c)},get counts(){return d(f)},get stats(){return d(m)},get expandedGroup(){return d(h)},get isScanning(){return d(b)},get scanProgress(){return d(y)},get error(){return d(x)},onscan:Z,onrescan:R,ontogglegroup:ge,onmarkacted:D,ondismiss:pe,onremove:ke,oncleargroup:ue,ondismisserror:()=>C(x,null),onstop:ce,onrefresh:de,oncloseprogress:()=>{C(y,null),localStorage.removeItem(G)},get scanCount(){return d(w)},set scanCount(fe){C(w,fe,!0)}}),E(t,ae),bt()}var Yb=P('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function Qb(t,e){yt(e,!0);function n(){const D=location.hash;return D==="#dashboard"?"dashboard":D==="#actions"?"actions":"chat"}let a=Pe(Nt(n()));ln(()=>{function D(){C(a,n(),!0)}return window.addEventListener("hashchange",D),()=>window.removeEventListener("hashchange",D)});var i=Yb(),o=p(i),c=_(p(o),2),f=p(c);let m;var h=_(f,2);let b;var y=_(h,2);let w;var x=_(o,2),I=p(x);let G;var A=p(I);Mm(A,{});var V=_(I,2);let de;var Z=p(V);Vb(Z,{});var R=_(V,2);let X;var ce=p(R);vy(ce,{}),$(()=>{m=Dt(f,1,"svelte-1n46o8q",null,m,{active:d(a)==="chat"}),b=Dt(h,1,"svelte-1n46o8q",null,b,{active:d(a)==="actions"}),w=Dt(y,1,"svelte-1n46o8q",null,w,{active:d(a)==="dashboard"}),G=rn(I,"",G,{display:d(a)==="chat"?"flex":"none"}),de=rn(V,"",de,{display:d(a)==="actions"?"flex":"none"}),X=rn(R,"",X,{display:d(a)==="dashboard"?"flex":"none"})}),E(t,i),bt()}fv(Qb,{target:document.getElementById("app")});
