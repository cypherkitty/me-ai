var Jd=Object.defineProperty;var Xl=t=>{throw TypeError(t)};var $d=(t,e,n)=>e in t?Jd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var st=(t,e,n)=>$d(t,typeof e!="symbol"?e+"":e,n),so=(t,e,n)=>e.has(t)||Xl("Cannot "+n);var ge=(t,e,n)=>(so(t,e,"read from private field"),n?n.call(t):e.get(t)),it=(t,e,n)=>e.has(t)?Xl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),nt=(t,e,n,a)=>(so(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),pn=(t,e,n)=>(so(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const wo=!1;var Vo=Array.isArray,ef=Array.prototype.indexOf,Wa=Array.prototype.includes,Ti=Array.from,tf=Object.defineProperty,Na=Object.getOwnPropertyDescriptor,nf=Object.getOwnPropertyDescriptors,rf=Object.prototype,af=Array.prototype,Wc=Object.getPrototypeOf,Zl=Object.isExtensible;const sf=()=>{};function of(t){for(var e=0;e<t.length;e++)t[e]()}function Hc(){var t,e,n=new Promise((a,s)=>{t=a,e=s});return{promise:n,resolve:t,reject:e}}const cn=2,Ts=4,Ai=8,Vc=1<<24,Nr=16,pr=32,Ia=64,Yc=128,Qn=512,tn=1024,un=2048,vr=4096,Ln=8192,jr=16384,Ms=32768,Ha=65536,Jl=1<<17,Qc=1<<18,Za=1<<19,lf=1<<20,Dr=1<<25,ka=65536,ko=1<<21,Yo=1<<22,Hr=1<<23,ya=Symbol("$state"),cf=Symbol("legacy props"),uf=Symbol(""),ua=new class extends Error{constructor(){super(...arguments);st(this,"name","StaleReactionError");st(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function df(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ff(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function vf(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function pf(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function hf(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function gf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function _f(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function yf(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function bf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function wf(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function kf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const xf=1,Sf=2,Xc=4,Ef=8,Tf=16,Af=1,If=4,Cf=8,Rf=16,Zc=1,Of=2,an=Symbol(),Jc="http://www.w3.org/1999/xhtml";function Pf(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Mf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function $c(t){return t===this.v}function Df(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function eu(t){return!Df(t,this.v)}let jf=!1,Nn=null;function Va(t){Nn=t}function bt(t,e=!1,n){Nn={p:Nn,i:!1,c:null,e:null,s:t,x:null,l:null}}function wt(t){var e=Nn,n=e.e;if(n!==null){e.e=null;for(var a of n)ku(a)}return t!==void 0&&(e.x=t),e.i=!0,Nn=e.p,t??{}}function tu(){return!0}let da=[];function nu(){var t=da;da=[],of(t)}function Vr(t){if(da.length===0&&!ws){var e=da;queueMicrotask(()=>{e===da&&nu()})}da.push(t)}function Lf(){for(;da.length>0;)nu()}function ru(t){var e=xt;if(e===null)return ot.f|=Hr,t;if((e.f&Ms)===0&&(e.f&Ts)===0)throw t;Ya(t,e)}function Ya(t,e){for(;e!==null;){if((e.f&Yc)!==0){if((e.f&Ms)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Nf=-7169;function Yt(t,e){t.f=t.f&Nf|e}function Qo(t){(t.f&Qn)!==0||t.deps===null?Yt(t,tn):Yt(t,vr)}function au(t){if(t!==null)for(const e of t)(e.f&cn)===0||(e.f&ka)===0||(e.f^=ka,au(e.deps))}function su(t,e,n){(t.f&un)!==0?e.add(t):(t.f&vr)!==0&&n.add(t),au(t.deps),Yt(t,tn)}const ai=new Set;let et=null,_i=null,sn=null,An=[],Ii=null,xo=!1,ws=!1;var qa,Ba,va,Fa,Cs,Rs,pa,Rr,za,Tr,So,Eo,iu;const kl=class kl{constructor(){it(this,Tr);st(this,"committed",!1);st(this,"current",new Map);st(this,"previous",new Map);it(this,qa,new Set);it(this,Ba,new Set);it(this,va,0);it(this,Fa,0);it(this,Cs,null);it(this,Rs,new Set);it(this,pa,new Set);it(this,Rr,new Map);st(this,"is_fork",!1);it(this,za,!1)}is_deferred(){return this.is_fork||ge(this,Fa)>0}skip_effect(e){ge(this,Rr).has(e)||ge(this,Rr).set(e,{d:[],m:[]})}unskip_effect(e){var n=ge(this,Rr).get(e);if(n){ge(this,Rr).delete(e);for(var a of n.d)Yt(a,un),ur(a);for(a of n.m)Yt(a,vr),ur(a)}}process(e){var s;An=[],this.apply();var n=[],a=[];for(const o of e)pn(this,Tr,So).call(this,o,n,a);if(this.is_deferred()){pn(this,Tr,Eo).call(this,a),pn(this,Tr,Eo).call(this,n);for(const[o,c]of ge(this,Rr))uu(o,c)}else{for(const o of ge(this,qa))o();ge(this,qa).clear(),ge(this,va)===0&&pn(this,Tr,iu).call(this),_i=this,et=null,$l(a),$l(n),_i=null,(s=ge(this,Cs))==null||s.resolve()}sn=null}capture(e,n){n!==an&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Hr)===0&&(this.current.set(e,e.v),sn==null||sn.set(e,e.v))}activate(){et=this,this.apply()}deactivate(){et===this&&(et=null,sn=null)}flush(){if(this.activate(),An.length>0){if(ou(),et!==null&&et!==this)return}else ge(this,va)===0&&this.process([]);this.deactivate()}discard(){for(const e of ge(this,Ba))e(this);ge(this,Ba).clear()}increment(e){nt(this,va,ge(this,va)+1),e&&nt(this,Fa,ge(this,Fa)+1)}decrement(e){nt(this,va,ge(this,va)-1),e&&nt(this,Fa,ge(this,Fa)-1),!ge(this,za)&&(nt(this,za,!0),Vr(()=>{nt(this,za,!1),this.is_deferred()?An.length>0&&this.flush():this.revive()}))}revive(){for(const e of ge(this,Rs))ge(this,pa).delete(e),Yt(e,un),ur(e);for(const e of ge(this,pa))Yt(e,vr),ur(e);this.flush()}oncommit(e){ge(this,qa).add(e)}ondiscard(e){ge(this,Ba).add(e)}settled(){return(ge(this,Cs)??nt(this,Cs,Hc())).promise}static ensure(){if(et===null){const e=et=new kl;ai.add(et),ws||Vr(()=>{et===e&&e.flush()})}return et}apply(){}};qa=new WeakMap,Ba=new WeakMap,va=new WeakMap,Fa=new WeakMap,Cs=new WeakMap,Rs=new WeakMap,pa=new WeakMap,Rr=new WeakMap,za=new WeakMap,Tr=new WeakSet,So=function(e,n,a){e.f^=tn;for(var s=e.first,o=null;s!==null;){var c=s.f,f=(c&(pr|Ia))!==0,m=f&&(c&tn)!==0,h=m||(c&Ln)!==0||ge(this,Rr).has(s);if(!h&&s.fn!==null){f?s.f^=tn:o!==null&&(c&(Ts|Ai|Vc))!==0?o.b.defer_effect(s):(c&Ts)!==0?n.push(s):js(s)&&((c&Nr)!==0&&ge(this,pa).add(s),Xa(s));var b=s.first;if(b!==null){s=b;continue}}var y=s.parent;for(s=s.next;s===null&&y!==null;)y===o&&(o=null),s=y.next,y=y.parent}},Eo=function(e){for(var n=0;n<e.length;n+=1)su(e[n],ge(this,Rs),ge(this,pa))},iu=function(){var s;if(ai.size>1){this.previous.clear();var e=sn,n=!0;for(const o of ai){if(o===this){n=!1;continue}const c=[];for(const[m,h]of this.current){if(o.current.has(m))if(n&&h!==o.current.get(m))o.current.set(m,h);else continue;c.push(m)}if(c.length===0)continue;const f=[...o.current.keys()].filter(m=>!this.current.has(m));if(f.length>0){var a=An;An=[];const m=new Set,h=new Map;for(const b of c)lu(b,f,m,h);if(An.length>0){et=o,o.apply();for(const b of An)pn(s=o,Tr,So).call(s,b,[],[]);o.deactivate()}An=a}}et=null,sn=e}this.committed=!0,ai.delete(this)};let Yr=kl;function qf(t){var e=ws;ws=!0;try{for(var n;;){if(Lf(),An.length===0&&(et==null||et.flush(),An.length===0))return Ii=null,n;ou()}}finally{ws=e}}function ou(){xo=!0;var t=null;try{for(var e=0;An.length>0;){var n=Yr.ensure();if(e++>1e3){var a,s;Bf()}n.process(An),Qr.clear()}}finally{An=[],xo=!1,Ii=null}}function Bf(){try{gf()}catch(t){Ya(t,Ii)}}let ar=null;function $l(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(jr|Ln))===0&&js(a)&&(ar=new Set,Xa(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&Tu(a),(ar==null?void 0:ar.size)>0)){Qr.clear();for(const s of ar){if((s.f&(jr|Ln))!==0)continue;const o=[s];let c=s.parent;for(;c!==null;)ar.has(c)&&(ar.delete(c),o.push(c)),c=c.parent;for(let f=o.length-1;f>=0;f--){const m=o[f];(m.f&(jr|Ln))===0&&Xa(m)}}ar.clear()}}ar=null}}function lu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&cn)!==0?lu(s,e,n,a):(o&(Yo|Nr))!==0&&(o&un)===0&&cu(s,e,a)&&(Yt(s,un),ur(s))}}function cu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const s of t.deps){if(Wa.call(e,s))return!0;if((s.f&cn)!==0&&cu(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function ur(t){for(var e=Ii=t;e.parent!==null;){e=e.parent;var n=e.f;if(xo&&e===xt&&(n&Nr)!==0&&(n&Qc)===0)return;if((n&(Ia|pr))!==0){if((n&tn)===0)return;e.f^=tn}}An.push(e)}function uu(t,e){if(!((t.f&pr)!==0&&(t.f&tn)!==0)){(t.f&un)!==0?e.d.push(t):(t.f&vr)!==0&&e.m.push(t),Yt(t,tn);for(var n=t.first;n!==null;)uu(n,e),n=n.next}}function Ff(t){let e=0,n=xa(0),a;return()=>{Jo()&&(u(n),$o(()=>(e===0&&(a=Ls(()=>t(()=>ks(n)))),e+=1,()=>{Vr(()=>{e-=1,e===0&&(a==null||a(),a=void 0,ks(n))})})))}}var zf=Ha|Za|Yc;function Uf(t,e,n){new Kf(t,e,n)}var Hn,Ho,br,ha,wr,Vn,En,kr,Or,Gr,ma,Wr,Ua,ga,Ka,Ga,Pr,Si,nn,Gf,Wf,To,fi,vi,Ao;class Kf{constructor(e,n,a){it(this,nn);st(this,"parent");st(this,"is_pending",!1);it(this,Hn);it(this,Ho,null);it(this,br);it(this,ha);it(this,wr);it(this,Vn,null);it(this,En,null);it(this,kr,null);it(this,Or,null);it(this,Gr,null);it(this,ma,0);it(this,Wr,0);it(this,Ua,!1);it(this,ga,!1);it(this,Ka,new Set);it(this,Ga,new Set);it(this,Pr,null);it(this,Si,Ff(()=>(nt(this,Pr,xa(ge(this,ma))),()=>{nt(this,Pr,null)})));nt(this,Hn,e),nt(this,br,n),nt(this,ha,a),this.parent=xt.b,this.is_pending=!!ge(this,br).pending,nt(this,wr,el(()=>{xt.b=this;{var s=pn(this,nn,To).call(this);try{nt(this,Vn,Yn(()=>a(s)))}catch(o){this.error(o)}ge(this,Wr)>0?pn(this,nn,vi).call(this):this.is_pending=!1}return()=>{var o;(o=ge(this,Gr))==null||o.remove()}},zf))}defer_effect(e){su(e,ge(this,Ka),ge(this,Ga))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!ge(this,br).pending}update_pending_count(e){pn(this,nn,Ao).call(this,e),nt(this,ma,ge(this,ma)+e),!(!ge(this,Pr)||ge(this,Ua))&&(nt(this,Ua,!0),Vr(()=>{nt(this,Ua,!1),ge(this,Pr)&&Qa(ge(this,Pr),ge(this,ma))}))}get_effect_pending(){return ge(this,Si).call(this),u(ge(this,Pr))}error(e){var n=ge(this,br).onerror;let a=ge(this,br).failed;if(ge(this,ga)||!n&&!a)throw e;ge(this,Vn)&&(Cn(ge(this,Vn)),nt(this,Vn,null)),ge(this,En)&&(Cn(ge(this,En)),nt(this,En,null)),ge(this,kr)&&(Cn(ge(this,kr)),nt(this,kr,null));var s=!1,o=!1;const c=()=>{if(s){Mf();return}s=!0,o&&kf(),Yr.ensure(),nt(this,ma,0),ge(this,kr)!==null&&ba(ge(this,kr),()=>{nt(this,kr,null)}),this.is_pending=this.has_pending_snippet(),nt(this,Vn,pn(this,nn,fi).call(this,()=>(nt(this,ga,!1),Yn(()=>ge(this,ha).call(this,ge(this,Hn)))))),ge(this,Wr)>0?pn(this,nn,vi).call(this):this.is_pending=!1};Vr(()=>{try{o=!0,n==null||n(e,c),o=!1}catch(f){Ya(f,ge(this,wr)&&ge(this,wr).parent)}a&&nt(this,kr,pn(this,nn,fi).call(this,()=>{Yr.ensure(),nt(this,ga,!0);try{return Yn(()=>{a(ge(this,Hn),()=>e,()=>c)})}catch(f){return Ya(f,ge(this,wr).parent),null}finally{nt(this,ga,!1)}}))})}}Hn=new WeakMap,Ho=new WeakMap,br=new WeakMap,ha=new WeakMap,wr=new WeakMap,Vn=new WeakMap,En=new WeakMap,kr=new WeakMap,Or=new WeakMap,Gr=new WeakMap,ma=new WeakMap,Wr=new WeakMap,Ua=new WeakMap,ga=new WeakMap,Ka=new WeakMap,Ga=new WeakMap,Pr=new WeakMap,Si=new WeakMap,nn=new WeakSet,Gf=function(){try{nt(this,Vn,Yn(()=>ge(this,ha).call(this,ge(this,Hn))))}catch(e){this.error(e)}},Wf=function(){const e=ge(this,br).pending;e&&(nt(this,En,Yn(()=>e(ge(this,Hn)))),Vr(()=>{var n=pn(this,nn,To).call(this);nt(this,Vn,pn(this,nn,fi).call(this,()=>(Yr.ensure(),Yn(()=>ge(this,ha).call(this,n))))),ge(this,Wr)>0?pn(this,nn,vi).call(this):(ba(ge(this,En),()=>{nt(this,En,null)}),this.is_pending=!1)}))},To=function(){var e=ge(this,Hn);return this.is_pending&&(nt(this,Gr,Lr()),ge(this,Hn).before(ge(this,Gr)),e=ge(this,Gr)),e},fi=function(e){var n=xt,a=ot,s=Nn;Er(ge(this,wr)),Zn(ge(this,wr)),Va(ge(this,wr).ctx);try{return e()}catch(o){return ru(o),null}finally{Er(n),Zn(a),Va(s)}},vi=function(){const e=ge(this,br).pending;ge(this,Vn)!==null&&(nt(this,Or,document.createDocumentFragment()),ge(this,Or).append(ge(this,Gr)),Cu(ge(this,Vn),ge(this,Or))),ge(this,En)===null&&nt(this,En,Yn(()=>e(ge(this,Hn))))},Ao=function(e){var n;if(!this.has_pending_snippet()){this.parent&&pn(n=this.parent,nn,Ao).call(n,e);return}if(nt(this,Wr,ge(this,Wr)+e),ge(this,Wr)===0){this.is_pending=!1;for(const a of ge(this,Ka))Yt(a,un),ur(a);for(const a of ge(this,Ga))Yt(a,vr),ur(a);ge(this,Ka).clear(),ge(this,Ga).clear(),ge(this,En)&&ba(ge(this,En),()=>{nt(this,En,null)}),ge(this,Or)&&(ge(this,Hn).before(ge(this,Or)),nt(this,Or,null))}};function Hf(t,e,n,a){const s=Ci;var o=t.filter(w=>!w.settled);if(n.length===0&&o.length===0){a(e.map(s));return}var c=et,f=xt,m=Vf(),h=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(w=>w.promise)):null;function b(w){m();try{a(w)}catch(x){(f.f&jr)===0&&Ya(x,f)}c==null||c.deactivate(),Io()}if(n.length===0){h.then(()=>b(e.map(s)));return}function y(){m(),Promise.all(n.map(w=>Yf(w))).then(w=>b([...e.map(s),...w])).catch(w=>Ya(w,f))}h?h.then(y):y()}function Vf(){var t=xt,e=ot,n=Nn,a=et;return function(o=!0){Er(t),Zn(e),Va(n),o&&(a==null||a.activate())}}function Io(){Er(null),Zn(null),Va(null)}function Ci(t){var e=cn|un,n=ot!==null&&(ot.f&cn)!==0?ot:null;return xt!==null&&(xt.f|=Za),{ctx:Nn,deps:null,effects:null,equals:$c,f:e,fn:t,reactions:null,rv:0,v:an,wv:0,parent:n??xt,ac:null}}function Yf(t,e,n){let a=xt;a===null&&ff();var s=a.b,o=void 0,c=xa(an),f=!ot,m=new Map;return lv(()=>{var x;var h=Hc();o=h.promise;try{Promise.resolve(t()).then(h.resolve,h.reject).then(()=>{b===et&&b.committed&&b.deactivate(),Io()})}catch(O){h.reject(O),Io()}var b=et;if(f){var y=s.is_rendered();s.update_pending_count(1),b.increment(y),(x=m.get(b))==null||x.reject(ua),m.delete(b),m.set(b,h)}const w=(O,U=void 0)=>{if(b.activate(),U)U!==ua&&(c.f|=Hr,Qa(c,U));else{(c.f&Hr)!==0&&(c.f^=Hr),Qa(c,O);for(const[M,$]of m){if(m.delete(M),M===b)break;$.reject(ua)}}f&&(s.update_pending_count(-1),b.decrement(y))};h.promise.then(w,O=>w(null,O||"unknown"))}),wu(()=>{for(const h of m.values())h.reject(ua)}),new Promise(h=>{function b(y){function w(){y===o?h(c):b(o)}y.then(w,w)}b(o)})}function lt(t){const e=Ci(t);return Ru(e),e}function du(t){const e=Ci(t);return e.equals=eu,e}function Qf(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Cn(e[n])}}function Xf(t){for(var e=t.parent;e!==null;){if((e.f&cn)===0)return(e.f&jr)===0?e:null;e=e.parent}return null}function Xo(t){var e,n=xt;Er(Xf(t));try{t.f&=~ka,Qf(t),e=Du(t)}finally{Er(n)}return e}function fu(t){var e=Xo(t);if(!t.equals(e)&&(t.wv=Pu(),(!(et!=null&&et.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Yt(t,tn);return}Xr||(sn!==null?(Jo()||et!=null&&et.is_fork)&&sn.set(t,e):Qo(t))}function Zf(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(ua),a.teardown=sf,a.ac=null,As(a,0),tl(a))}function vu(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&Xa(e)}let Co=new Set;const Qr=new Map;let pu=!1;function xa(t,e){var n={f:0,v:t,reactions:null,equals:$c,rv:0,wv:0};return n}function Oe(t,e){const n=xa(t);return Ru(n),n}function Jf(t,e=!1,n=!0){const a=xa(t);return e||(a.equals=eu),a}function A(t,e,n=!1){ot!==null&&(!dr||(ot.f&Jl)!==0)&&tu()&&(ot.f&(cn|Nr|Yo|Jl))!==0&&(Xn===null||!Wa.call(Xn,t))&&wf();let a=n?jt(e):e;return Qa(t,a)}function Qa(t,e){if(!t.equals(e)){var n=t.v;Xr?Qr.set(t,e):Qr.set(t,n),t.v=e;var a=Yr.ensure();if(a.capture(t,n),(t.f&cn)!==0){const s=t;(t.f&un)!==0&&Xo(s),Qo(s)}t.wv=Pu(),hu(t,un),xt!==null&&(xt.f&tn)!==0&&(xt.f&(pr|Ia))===0&&(Wn===null?uv([t]):Wn.push(t)),!a.is_fork&&Co.size>0&&!pu&&$f()}return e}function $f(){pu=!1;for(const t of Co)(t.f&tn)!==0&&Yt(t,vr),js(t)&&Xa(t);Co.clear()}function ks(t){A(t,t.v+1)}function hu(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,s=0;s<a;s++){var o=n[s],c=o.f,f=(c&un)===0;if(f&&Yt(o,e),(c&cn)!==0){var m=o;sn==null||sn.delete(m),(c&ka)===0&&(c&Qn&&(o.f|=ka),hu(m,vr))}else f&&((c&Nr)!==0&&ar!==null&&ar.add(o),ur(o))}}function jt(t){if(typeof t!="object"||t===null||ya in t)return t;const e=Wc(t);if(e!==rf&&e!==af)return t;var n=new Map,a=Vo(t),s=Oe(0),o=wa,c=f=>{if(wa===o)return f();var m=ot,h=wa;Zn(null),ac(o);var b=f();return Zn(m),ac(h),b};return a&&n.set("length",Oe(t.length)),new Proxy(t,{defineProperty(f,m,h){(!("value"in h)||h.configurable===!1||h.enumerable===!1||h.writable===!1)&&yf();var b=n.get(m);return b===void 0?c(()=>{var y=Oe(h.value);return n.set(m,y),y}):A(b,h.value,!0),!0},deleteProperty(f,m){var h=n.get(m);if(h===void 0){if(m in f){const b=c(()=>Oe(an));n.set(m,b),ks(s)}}else A(h,an),ks(s);return!0},get(f,m,h){var x;if(m===ya)return t;var b=n.get(m),y=m in f;if(b===void 0&&(!y||(x=Na(f,m))!=null&&x.writable)&&(b=c(()=>{var O=jt(y?f[m]:an),U=Oe(O);return U}),n.set(m,b)),b!==void 0){var w=u(b);return w===an?void 0:w}return Reflect.get(f,m,h)},getOwnPropertyDescriptor(f,m){var h=Reflect.getOwnPropertyDescriptor(f,m);if(h&&"value"in h){var b=n.get(m);b&&(h.value=u(b))}else if(h===void 0){var y=n.get(m),w=y==null?void 0:y.v;if(y!==void 0&&w!==an)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return h},has(f,m){var w;if(m===ya)return!0;var h=n.get(m),b=h!==void 0&&h.v!==an||Reflect.has(f,m);if(h!==void 0||xt!==null&&(!b||(w=Na(f,m))!=null&&w.writable)){h===void 0&&(h=c(()=>{var x=b?jt(f[m]):an,O=Oe(x);return O}),n.set(m,h));var y=u(h);if(y===an)return!1}return b},set(f,m,h,b){var H;var y=n.get(m),w=m in f;if(a&&m==="length")for(var x=h;x<y.v;x+=1){var O=n.get(x+"");O!==void 0?A(O,an):x in f&&(O=c(()=>Oe(an)),n.set(x+"",O))}if(y===void 0)(!w||(H=Na(f,m))!=null&&H.writable)&&(y=c(()=>Oe(void 0)),A(y,jt(h)),n.set(m,y));else{w=y.v!==an;var U=c(()=>jt(h));A(y,U)}var M=Reflect.getOwnPropertyDescriptor(f,m);if(M!=null&&M.set&&M.set.call(b,h),!w){if(a&&typeof m=="string"){var $=n.get("length"),ee=Number(m);Number.isInteger(ee)&&ee>=$.v&&A($,ee+1)}ks(s)}return!0},ownKeys(f){u(s);var m=Reflect.ownKeys(f).filter(y=>{var w=n.get(y);return w===void 0||w.v!==an});for(var[h,b]of n)b.v!==an&&!(h in f)&&m.push(h);return m},setPrototypeOf(){bf()}})}function ec(t){try{if(t!==null&&typeof t=="object"&&ya in t)return t[ya]}catch{}return t}function ev(t,e){return Object.is(ec(t),ec(e))}var tc,mu,gu,_u;function tv(){if(tc===void 0){tc=window,mu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;gu=Na(e,"firstChild").get,_u=Na(e,"nextSibling").get,Zl(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Zl(n)&&(n.__t=void 0)}}function Lr(t=""){return document.createTextNode(t)}function jn(t){return gu.call(t)}function Ds(t){return _u.call(t)}function p(t,e){return jn(t)}function Xe(t,e=!1){{var n=jn(t);return n instanceof Comment&&n.data===""?Ds(n):n}}function _(t,e=1,n=!1){let a=t;for(;e--;)a=Ds(a);return a}function nv(t){t.textContent=""}function yu(){return!1}function rv(t,e,n){return document.createElementNS(Jc,t,void 0)}let nc=!1;function av(){nc||(nc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Zo(t){var e=ot,n=xt;Zn(null),Er(null);try{return t()}finally{Zn(e),Er(n)}}function bu(t,e,n,a=n){t.addEventListener(e,()=>Zo(n));const s=t.__on_r;s?t.__on_r=()=>{s(),a(!0)}:t.__on_r=()=>a(!0),av()}function sv(t){xt===null&&(ot===null&&mf(),hf()),Xr&&pf()}function iv(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function qr(t,e,n){var a=xt;a!==null&&(a.f&Ln)!==0&&(t|=Ln);var s={ctx:Nn,deps:null,nodes:null,f:t|un|Qn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Xa(s)}catch(f){throw Cn(s),f}else e!==null&&ur(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&Za)===0&&(o=o.first,(t&Nr)!==0&&(t&Ha)!==0&&o!==null&&(o.f|=Ha)),o!==null&&(o.parent=a,a!==null&&iv(o,a),ot!==null&&(ot.f&cn)!==0&&(t&Ia)===0)){var c=ot;(c.effects??(c.effects=[])).push(o)}return s}function Jo(){return ot!==null&&!dr}function wu(t){const e=qr(Ai,null,!1);return Yt(e,tn),e.teardown=t,e}function Sa(t){sv();var e=xt.f,n=!ot&&(e&pr)!==0&&(e&Ms)===0;if(n){var a=Nn;(a.e??(a.e=[])).push(t)}else return ku(t)}function ku(t){return qr(Ts|lf,t,!1)}function ov(t){Yr.ensure();const e=qr(Ia|Za,t,!0);return(n={})=>new Promise(a=>{n.outro?ba(e,()=>{Cn(e),a(void 0)}):(Cn(e),a(void 0))})}function xu(t){return qr(Ts,t,!1)}function lv(t){return qr(Yo|Za,t,!0)}function $o(t,e=0){return qr(Ai|e,t,!0)}function Z(t,e=[],n=[],a=[]){Hf(a,e,n,s=>{qr(Ai,()=>t(...s.map(u)),!0)})}function el(t,e=0){var n=qr(Nr|e,t,!0);return n}function Yn(t){return qr(pr|Za,t,!0)}function Su(t){var e=t.teardown;if(e!==null){const n=Xr,a=ot;rc(!0),Zn(null);try{e.call(null)}finally{rc(n),Zn(a)}}}function tl(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&Zo(()=>{s.abort(ua)});var a=n.next;(n.f&Ia)!==0?n.parent=null:Cn(n,e),n=a}}function cv(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&pr)===0&&Cn(e),e=n}}function Cn(t,e=!0){var n=!1;(e||(t.f&Qc)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Eu(t.nodes.start,t.nodes.end),n=!0),tl(t,e&&!n),As(t,0),Yt(t,jr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();Su(t);var s=t.parent;s!==null&&s.first!==null&&Tu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Eu(t,e){for(;t!==null;){var n=t===e?null:Ds(t);t.remove(),t=n}}function Tu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function ba(t,e,n=!0){var a=[];Au(t,a,!0);var s=()=>{n&&Cn(t),e&&e()},o=a.length;if(o>0){var c=()=>--o||s();for(var f of a)f.out(c)}else s()}function Au(t,e,n){if((t.f&Ln)===0){t.f^=Ln;var a=t.nodes&&t.nodes.t;if(a!==null)for(const f of a)(f.is_global||n)&&e.push(f);for(var s=t.first;s!==null;){var o=s.next,c=(s.f&Ha)!==0||(s.f&pr)!==0&&(t.f&Nr)!==0;Au(s,e,c?n:!1),s=o}}}function nl(t){Iu(t,!0)}function Iu(t,e){if((t.f&Ln)!==0){t.f^=Ln,(t.f&tn)===0&&(Yt(t,un),ur(t));for(var n=t.first;n!==null;){var a=n.next,s=(n.f&Ha)!==0||(n.f&pr)!==0;Iu(n,s?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const c of o)(c.is_global||e)&&c.in()}}function Cu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var s=n===a?null:Ds(n);e.append(n),n=s}}let pi=!1,Xr=!1;function rc(t){Xr=t}let ot=null,dr=!1;function Zn(t){ot=t}let xt=null;function Er(t){xt=t}let Xn=null;function Ru(t){ot!==null&&(Xn===null?Xn=[t]:Xn.push(t))}let In=null,Mn=0,Wn=null;function uv(t){Wn=t}let Ou=1,fa=0,wa=fa;function ac(t){wa=t}function Pu(){return++Ou}function js(t){var e=t.f;if((e&un)!==0)return!0;if(e&cn&&(t.f&=~ka),(e&vr)!==0){for(var n=t.deps,a=n.length,s=0;s<a;s++){var o=n[s];if(js(o)&&fu(o),o.wv>t.wv)return!0}(e&Qn)!==0&&sn===null&&Yt(t,tn)}return!1}function Mu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(Xn!==null&&Wa.call(Xn,t)))for(var s=0;s<a.length;s++){var o=a[s];(o.f&cn)!==0?Mu(o,e,!1):e===o&&(n?Yt(o,un):(o.f&tn)!==0&&Yt(o,vr),ur(o))}}function Du(t){var U;var e=In,n=Mn,a=Wn,s=ot,o=Xn,c=Nn,f=dr,m=wa,h=t.f;In=null,Mn=0,Wn=null,ot=(h&(pr|Ia))===0?t:null,Xn=null,Va(t.ctx),dr=!1,wa=++fa,t.ac!==null&&(Zo(()=>{t.ac.abort(ua)}),t.ac=null);try{t.f|=ko;var b=t.fn,y=b();t.f|=Ms;var w=t.deps,x=et==null?void 0:et.is_fork;if(In!==null){var O;if(x||As(t,Mn),w!==null&&Mn>0)for(w.length=Mn+In.length,O=0;O<In.length;O++)w[Mn+O]=In[O];else t.deps=w=In;if(Jo()&&(t.f&Qn)!==0)for(O=Mn;O<w.length;O++)((U=w[O]).reactions??(U.reactions=[])).push(t)}else!x&&w!==null&&Mn<w.length&&(As(t,Mn),w.length=Mn);if(tu()&&Wn!==null&&!dr&&w!==null&&(t.f&(cn|vr|un))===0)for(O=0;O<Wn.length;O++)Mu(Wn[O],t);if(s!==null&&s!==t){if(fa++,s.deps!==null)for(let M=0;M<n;M+=1)s.deps[M].rv=fa;if(e!==null)for(const M of e)M.rv=fa;Wn!==null&&(a===null?a=Wn:a.push(...Wn))}return(t.f&Hr)!==0&&(t.f^=Hr),y}catch(M){return ru(M)}finally{t.f^=ko,In=e,Mn=n,Wn=a,ot=s,Xn=o,Va(c),dr=f,wa=m}}function dv(t,e){let n=e.reactions;if(n!==null){var a=ef.call(n,t);if(a!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[a]=n[s],n.pop())}}if(n===null&&(e.f&cn)!==0&&(In===null||!Wa.call(In,e))){var o=e;(o.f&Qn)!==0&&(o.f^=Qn,o.f&=~ka),Qo(o),Zf(o),As(o,0)}}function As(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)dv(t,n[a])}function Xa(t){var e=t.f;if((e&jr)===0){Yt(t,tn);var n=xt,a=pi;xt=t,pi=!0;try{(e&(Nr|Vc))!==0?cv(t):tl(t),Su(t);var s=Du(t);t.teardown=typeof s=="function"?s:null,t.wv=Ou;var o;wo&&jf&&(t.f&un)!==0&&t.deps}finally{pi=a,xt=n}}}async function ju(){await Promise.resolve(),qf()}function u(t){var e=t.f,n=(e&cn)!==0;if(ot!==null&&!dr){var a=xt!==null&&(xt.f&jr)!==0;if(!a&&(Xn===null||!Wa.call(Xn,t))){var s=ot.deps;if((ot.f&ko)!==0)t.rv<fa&&(t.rv=fa,In===null&&s!==null&&s[Mn]===t?Mn++:In===null?In=[t]:In.push(t));else{(ot.deps??(ot.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[ot]:Wa.call(o,ot)||o.push(ot)}}}if(Xr&&Qr.has(t))return Qr.get(t);if(n){var c=t;if(Xr){var f=c.v;return((c.f&tn)===0&&c.reactions!==null||Nu(c))&&(f=Xo(c)),Qr.set(c,f),f}var m=(c.f&Qn)===0&&!dr&&ot!==null&&(pi||(ot.f&Qn)!==0),h=(c.f&Ms)===0;js(c)&&(m&&(c.f|=Qn),fu(c)),m&&!h&&(vu(c),Lu(c))}if(sn!=null&&sn.has(t))return sn.get(t);if((t.f&Hr)!==0)throw t.v;return t.v}function Lu(t){if(t.f|=Qn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&cn)!==0&&(e.f&Qn)===0&&(vu(e),Lu(e))}function Nu(t){if(t.v===an)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Qr.has(e)||(e.f&cn)!==0&&Nu(e))return!0;return!1}function Ls(t){var e=dr;try{return dr=!0,t()}finally{dr=e}}const fv=["touchstart","touchmove"];function vv(t){return fv.includes(t)}const qu=new Set,Ro=new Set;function Nt(t){for(var e=0;e<t.length;e++)qu.add(t[e]);for(var n of Ro)n(t)}let sc=null;function ic(t){var M;var e=this,n=e.ownerDocument,a=t.type,s=((M=t.composedPath)==null?void 0:M.call(t))||[],o=s[0]||t.target;sc=t;var c=0,f=sc===t&&t.__root;if(f){var m=s.indexOf(f);if(m!==-1&&(e===document||e===window)){t.__root=e;return}var h=s.indexOf(e);if(h===-1)return;m<=h&&(c=m)}if(o=s[c]||t.target,o!==e){tf(t,"currentTarget",{configurable:!0,get(){return o||n}});var b=ot,y=xt;Zn(null),Er(null);try{for(var w,x=[];o!==null;){var O=o.assignedSlot||o.parentNode||o.host||null;try{var U=o["__"+a];U!=null&&(!o.disabled||t.target===o)&&U.call(o,t)}catch($){w?x.push($):w=$}if(t.cancelBubble||O===e||O===null)break;o=O}if(w){for(let $ of x)queueMicrotask(()=>{throw $});throw w}}finally{t.__root=e,delete t.currentTarget,Zn(b),Er(y)}}}var Uc,Kc;const io=(Kc=(Uc=globalThis==null?void 0:globalThis.window)==null?void 0:Uc.trustedTypes)==null?void 0:Kc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function pv(t){return(io==null?void 0:io.createHTML(t))??t}function rl(t,e=!1){var n=rv("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?pv(t):t,n.content}function Ea(t,e){var n=xt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function I(t,e){var n=(e&Zc)!==0,a=(e&Of)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=rl(o?t:"<!>"+t,!0),n||(s=jn(s)));var c=a||mu?document.importNode(s,!0):s.cloneNode(!0);if(n){var f=jn(c),m=c.lastChild;Ea(f,m)}else Ea(c,c);return c}}function hv(t,e,n="svg"){var a=!t.startsWith("<!>"),s=(e&Zc)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,c;return()=>{if(!c){var f=rl(o,!0),m=jn(f);if(s)for(c=document.createDocumentFragment();jn(m);)c.appendChild(jn(m));else c=jn(m)}var h=c.cloneNode(!0);if(s){var b=jn(h),y=h.lastChild;Ea(b,y)}else Ea(h,h);return h}}function al(t,e){return hv(t,e,"svg")}function _n(t=""){{var e=Lr(t+"");return Ea(e,e),e}}function Jn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Lr();return t.append(e,n),Ea(e,n),t}function E(t,e){t!==null&&t.before(e)}function F(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function mv(t,e){return gv(t,e)}const si=new Map;function gv(t,{target:e,anchor:n,props:a={},events:s,context:o,intro:c=!0}){tv();var f=new Set,m=y=>{for(var w=0;w<y.length;w++){var x=y[w];if(!f.has(x)){f.add(x);var O=vv(x);for(const $ of[e,document]){var U=si.get($);U===void 0&&(U=new Map,si.set($,U));var M=U.get(x);M===void 0?($.addEventListener(x,ic,{passive:O}),U.set(x,1)):U.set(x,M+1)}}}};m(Ti(qu)),Ro.add(m);var h=void 0,b=ov(()=>{var y=n??e.appendChild(Lr());return Uf(y,{pending:()=>{}},w=>{bt({});var x=Nn;o&&(x.c=o),s&&(a.$$events=s),h=t(w,a)||{},wt()}),()=>{var U;for(var w of f)for(const M of[e,document]){var x=si.get(M),O=x.get(w);--O==0?(M.removeEventListener(w,ic),x.delete(w),x.size===0&&si.delete(M)):x.set(w,O)}Ro.delete(m),y!==n&&((U=y.parentNode)==null||U.removeChild(y))}});return _v.set(h,b),h}let _v=new WeakMap;var ir,xr,Dn,_a,Os,Ps,Ei;class yv{constructor(e,n=!0){st(this,"anchor");it(this,ir,new Map);it(this,xr,new Map);it(this,Dn,new Map);it(this,_a,new Set);it(this,Os,!0);it(this,Ps,()=>{var e=et;if(ge(this,ir).has(e)){var n=ge(this,ir).get(e),a=ge(this,xr).get(n);if(a)nl(a),ge(this,_a).delete(n);else{var s=ge(this,Dn).get(n);s&&(ge(this,xr).set(n,s.effect),ge(this,Dn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),a=s.effect)}for(const[o,c]of ge(this,ir)){if(ge(this,ir).delete(o),o===e)break;const f=ge(this,Dn).get(c);f&&(Cn(f.effect),ge(this,Dn).delete(c))}for(const[o,c]of ge(this,xr)){if(o===n||ge(this,_a).has(o))continue;const f=()=>{if(Array.from(ge(this,ir).values()).includes(o)){var h=document.createDocumentFragment();Cu(c,h),h.append(Lr()),ge(this,Dn).set(o,{effect:c,fragment:h})}else Cn(c);ge(this,_a).delete(o),ge(this,xr).delete(o)};ge(this,Os)||!a?(ge(this,_a).add(o),ba(c,f,!1)):f()}}});it(this,Ei,e=>{ge(this,ir).delete(e);const n=Array.from(ge(this,ir).values());for(const[a,s]of ge(this,Dn))n.includes(a)||(Cn(s.effect),ge(this,Dn).delete(a))});this.anchor=e,nt(this,Os,n)}ensure(e,n){var a=et,s=yu();if(n&&!ge(this,xr).has(e)&&!ge(this,Dn).has(e))if(s){var o=document.createDocumentFragment(),c=Lr();o.append(c),ge(this,Dn).set(e,{effect:Yn(()=>n(c)),fragment:o})}else ge(this,xr).set(e,Yn(()=>n(this.anchor)));if(ge(this,ir).set(a,e),s){for(const[f,m]of ge(this,xr))f===e?a.unskip_effect(m):a.skip_effect(m);for(const[f,m]of ge(this,Dn))f===e?a.unskip_effect(m.effect):a.skip_effect(m.effect);a.oncommit(ge(this,Ps)),a.ondiscard(ge(this,Ei))}else ge(this,Ps).call(this)}}ir=new WeakMap,xr=new WeakMap,Dn=new WeakMap,_a=new WeakMap,Os=new WeakMap,Ps=new WeakMap,Ei=new WeakMap;function re(t,e,n=!1){var a=new yv(t),s=n?Ha:0;function o(c,f){a.ensure(c,f)}el(()=>{var c=!1;e((f,m=0)=>{c=!0,o(m,f)}),c||o(!1,null)},s)}function Ut(t,e){return e}function bv(t,e,n){for(var a=[],s=e.length,o,c=e.length,f=0;f<s;f++){let y=e[f];ba(y,()=>{if(o){if(o.pending.delete(y),o.done.add(y),o.pending.size===0){var w=t.outrogroups;Oo(Ti(o.done)),w.delete(o),w.size===0&&(t.outrogroups=null)}}else c-=1},!1)}if(c===0){var m=a.length===0&&n!==null;if(m){var h=n,b=h.parentNode;nv(b),b.append(h),t.items.clear()}Oo(e,!m)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Oo(t,e=!0){for(var n=0;n<t.length;n++)Cn(t[n],e)}var oc;function At(t,e,n,a,s,o=null){var c=t,f=new Map,m=(e&Xc)!==0;if(m){var h=t;c=h.appendChild(Lr())}var b=null,y=du(()=>{var $=n();return Vo($)?$:$==null?[]:Ti($)}),w,x=!0;function O(){M.fallback=b,wv(M,w,c,e,a),b!==null&&(w.length===0?(b.f&Dr)===0?nl(b):(b.f^=Dr,_s(b,null,c)):ba(b,()=>{b=null}))}var U=el(()=>{w=u(y);for(var $=w.length,ee=new Set,H=et,C=yu(),Y=0;Y<$;Y+=1){var se=w[Y],G=a(se,Y),me=x?null:f.get(G);me?(me.v&&Qa(me.v,se),me.i&&Qa(me.i,Y),C&&H.unskip_effect(me.e)):(me=kv(f,x?c:oc??(oc=Lr()),se,G,Y,s,e,n),x||(me.e.f|=Dr),f.set(G,me)),ee.add(G)}if($===0&&o&&!b&&(x?b=Yn(()=>o(c)):(b=Yn(()=>o(oc??(oc=Lr()))),b.f|=Dr)),$>ee.size&&vf(),!x)if(C){for(const[ke,de]of f)ee.has(ke)||H.skip_effect(de.e);H.oncommit(O),H.ondiscard(()=>{})}else O();u(y)}),M={effect:U,items:f,outrogroups:null,fallback:b};x=!1}function us(t){for(;t!==null&&(t.f&pr)===0;)t=t.next;return t}function wv(t,e,n,a,s){var de,pe,ie,_e,fe,ue,he,Se,oe;var o=(a&Ef)!==0,c=e.length,f=t.items,m=us(t.effect.first),h,b=null,y,w=[],x=[],O,U,M,$;if(o)for($=0;$<c;$+=1)O=e[$],U=s(O,$),M=f.get(U).e,(M.f&Dr)===0&&((pe=(de=M.nodes)==null?void 0:de.a)==null||pe.measure(),(y??(y=new Set)).add(M));for($=0;$<c;$+=1){if(O=e[$],U=s(O,$),M=f.get(U).e,t.outrogroups!==null)for(const ve of t.outrogroups)ve.pending.delete(M),ve.done.delete(M);if((M.f&Dr)!==0)if(M.f^=Dr,M===m)_s(M,null,n);else{var ee=b?b.next:m;M===t.effect.last&&(t.effect.last=M.prev),M.prev&&(M.prev.next=M.next),M.next&&(M.next.prev=M.prev),Ur(t,b,M),Ur(t,M,ee),_s(M,ee,n),b=M,w=[],x=[],m=us(b.next);continue}if((M.f&Ln)!==0&&(nl(M),o&&((_e=(ie=M.nodes)==null?void 0:ie.a)==null||_e.unfix(),(y??(y=new Set)).delete(M))),M!==m){if(h!==void 0&&h.has(M)){if(w.length<x.length){var H=x[0],C;b=H.prev;var Y=w[0],se=w[w.length-1];for(C=0;C<w.length;C+=1)_s(w[C],H,n);for(C=0;C<x.length;C+=1)h.delete(x[C]);Ur(t,Y.prev,se.next),Ur(t,b,Y),Ur(t,se,H),m=H,b=se,$-=1,w=[],x=[]}else h.delete(M),_s(M,m,n),Ur(t,M.prev,M.next),Ur(t,M,b===null?t.effect.first:b.next),Ur(t,b,M),b=M;continue}for(w=[],x=[];m!==null&&m!==M;)(h??(h=new Set)).add(m),x.push(m),m=us(m.next);if(m===null)continue}(M.f&Dr)===0&&w.push(M),b=M,m=us(M.next)}if(t.outrogroups!==null){for(const ve of t.outrogroups)ve.pending.size===0&&(Oo(Ti(ve.done)),(fe=t.outrogroups)==null||fe.delete(ve));t.outrogroups.size===0&&(t.outrogroups=null)}if(m!==null||h!==void 0){var G=[];if(h!==void 0)for(M of h)(M.f&Ln)===0&&G.push(M);for(;m!==null;)(m.f&Ln)===0&&m!==t.fallback&&G.push(m),m=us(m.next);var me=G.length;if(me>0){var ke=(a&Xc)!==0&&c===0?n:null;if(o){for($=0;$<me;$+=1)(he=(ue=G[$].nodes)==null?void 0:ue.a)==null||he.measure();for($=0;$<me;$+=1)(oe=(Se=G[$].nodes)==null?void 0:Se.a)==null||oe.fix()}bv(t,G,ke)}}o&&Vr(()=>{var ve,le;if(y!==void 0)for(M of y)(le=(ve=M.nodes)==null?void 0:ve.a)==null||le.apply()})}function kv(t,e,n,a,s,o,c,f){var m=(c&xf)!==0?(c&Tf)===0?Jf(n,!1,!1):xa(n):null,h=(c&Sf)!==0?xa(s):null;return{v:m,i:h,e:Yn(()=>(o(e,m??n,h??s,f),()=>{t.delete(a)}))}}function _s(t,e,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,o=e&&(e.f&Dr)===0?e.nodes.start:n;a!==null;){var c=Ds(a);if(o.before(a),a===s)return;a=c}}function Ur(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function xv(t,e,n=!1,a=!1,s=!1){var o=t,c="";Z(()=>{var f=xt;if(c!==(c=e()??"")&&(f.nodes!==null&&(Eu(f.nodes.start,f.nodes.end),f.nodes=null),c!=="")){var m=c+"";n?m=`<svg>${m}</svg>`:a&&(m=`<math>${m}</math>`);var h=rl(m);if((n||a)&&(h=jn(h)),Ea(jn(h),h.lastChild),n||a)for(;jn(h);)o.before(jn(h));else o.before(h)}})}const lc=[...` 	
\r\fÂ \v\uFEFF`];function Sv(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var s in n)if(n[s])a=a?a+" "+s:s;else if(a.length)for(var o=s.length,c=0;(c=a.indexOf(s,c))>=0;){var f=c+o;(c===0||lc.includes(a[c-1]))&&(f===a.length||lc.includes(a[f]))?a=(c===0?"":a.substring(0,c))+a.substring(f+1):c=f}}return a===""?null:a}function cc(t,e=!1){var n=e?" !important;":";",a="";for(var s in t){var o=t[s];o!=null&&o!==""&&(a+=" "+s+": "+o+n)}return a}function oo(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ev(t,e){if(e){var n="",a,s;if(Array.isArray(e)?(a=e[0],s=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,c=0,f=!1,m=[];a&&m.push(...Object.keys(a).map(oo)),s&&m.push(...Object.keys(s).map(oo));var h=0,b=-1;const U=t.length;for(var y=0;y<U;y++){var w=t[y];if(f?w==="/"&&t[y-1]==="*"&&(f=!1):o?o===w&&(o=!1):w==="/"&&t[y+1]==="*"?f=!0:w==='"'||w==="'"?o=w:w==="("?c++:w===")"&&c--,!f&&o===!1&&c===0){if(w===":"&&b===-1)b=y;else if(w===";"||y===U-1){if(b!==-1){var x=oo(t.substring(h,b).trim());if(!m.includes(x)){w!==";"&&y++;var O=t.substring(h,y).trim();n+=" "+O+";"}}h=y+1,b=-1}}}}return a&&(n+=cc(a)),s&&(n+=cc(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Rt(t,e,n,a,s,o){var c=t.__className;if(c!==n||c===void 0){var f=Sv(n,a,o);f==null?t.removeAttribute("class"):e?t.className=f:t.setAttribute("class",f),t.__className=n}else if(o&&s!==o)for(var m in o){var h=!!o[m];(s==null||h!==!!s[m])&&t.classList.toggle(m,h)}return o}function lo(t,e={},n,a){for(var s in n){var o=n[s];e[s]!==o&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,o,a))}}function on(t,e,n,a){var s=t.__style;if(s!==e){var o=Ev(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(lo(t,n==null?void 0:n[0],a[0]),lo(t,n==null?void 0:n[1],a[1],"important")):lo(t,n,a));return a}function Bu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Vo(e))return Pf();for(var a of t.options)a.selected=e.includes(xs(a));return}for(a of t.options){var s=xs(a);if(ev(s,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Tv(t){var e=new MutationObserver(()=>{Bu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),wu(()=>{e.disconnect()})}function Ri(t,e,n=e){var a=new WeakSet,s=!0;bu(t,"change",o=>{var c=o?"[selected]":":checked",f;if(t.multiple)f=[].map.call(t.querySelectorAll(c),xs);else{var m=t.querySelector(c)??t.querySelector("option:not([disabled])");f=m&&xs(m)}n(f),et!==null&&a.add(et)}),xu(()=>{var o=e();if(t===document.activeElement){var c=_i??et;if(a.has(c))return}if(Bu(t,o,s),s&&o===void 0){var f=t.querySelector(":checked");f!==null&&(o=xs(f),n(o))}t.__value=o,s=!1}),Tv(t)}function xs(t){return"__value"in t?t.__value:t.value}const Av=Symbol("is custom element"),Iv=Symbol("is html");function Fu(t,e,n,a){var s=Cv(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[uf]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Rv(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Cv(t){return t.__attributes??(t.__attributes={[Av]:t.nodeName.includes("-"),[Iv]:t.namespaceURI===Jc})}var uc=new Map;function Rv(t){var e=t.getAttribute("is")||t.nodeName,n=uc.get(e);if(n)return n;uc.set(e,n=[]);for(var a,s=t,o=Element.prototype;o!==s;){a=nf(s);for(var c in a)a[c].set&&n.push(c);s=Wc(s)}return n}function or(t,e,n=e){var a=new WeakSet;bu(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=co(t)?uo(o):o,n(o),et!==null&&a.add(et),await ju(),o!==(o=e())){var c=t.selectionStart,f=t.selectionEnd,m=t.value.length;if(t.value=o??"",f!==null){var h=t.value.length;c===f&&f===m&&h>m?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=c,t.selectionEnd=Math.min(f,h))}}}),Ls(e)==null&&t.value&&(n(co(t)?uo(t.value):t.value),et!==null&&a.add(et)),$o(()=>{var s=e();if(t===document.activeElement){var o=_i??et;if(a.has(o))return}co(t)&&s===uo(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function co(t){var e=t.type;return e==="number"||e==="range"}function uo(t){return t===""?null:+t}function dc(t,e){return t===e||(t==null?void 0:t[ya])===e}function zu(t={},e,n,a){return xu(()=>{var s,o;return $o(()=>{s=o,o=[],Ls(()=>{t!==n(...o)&&(e(t,...o),s&&dc(n(...s),t)&&e(null,...s))})}),()=>{Vr(()=>{o&&dc(n(...o),t)&&e(null,...o)})}}),t}let ii=!1;function Ov(t){var e=ii;try{return ii=!1,[t(),ii]}finally{ii=e}}function Ne(t,e,n,a){var ee;var s=(n&Cf)!==0,o=(n&Rf)!==0,c=a,f=!0,m=()=>(f&&(f=!1,c=o?Ls(a):a),c),h;if(s){var b=ya in t||cf in t;h=((ee=Na(t,e))==null?void 0:ee.set)??(b&&e in t?H=>t[e]=H:void 0)}var y,w=!1;s?[y,w]=Ov(()=>t[e]):y=t[e],y===void 0&&a!==void 0&&(y=m(),h&&(_f(),h(y)));var x;if(x=()=>{var H=t[e];return H===void 0?m():(f=!0,H)},(n&If)===0)return x;if(h){var O=t.$$legacy;return(function(H,C){return arguments.length>0?((!C||O||w)&&h(C?x():H),H):x()})}var U=!1,M=((n&Af)!==0?Ci:du)(()=>(U=!1,x()));s&&u(M);var $=xt;return(function(H,C){if(arguments.length>0){const Y=C?u(M):s?jt(H):H;return A(M,Y),U=!0,c!==void 0&&(c=Y),H}return Xr&&U||($.f&jr)!==0?M.v:u(M)})}function dn(t){Nn===null&&df(),Sa(()=>{const e=Ls(t);if(typeof e=="function")return e})}const Pv="5";var Gc;typeof window<"u"&&((Gc=window.__svelte??(window.__svelte={})).v??(Gc.v=new Set)).add(Pv);const Sr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function sl(t){return Sr.find(e=>e.id===t)}const Mv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Sr,getModelInfo:sl},Symbol.toStringTag,{value:"Module"})),fr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Uu(){return fr.filter(t=>t.recommended)}function il(t){return fr.find(e=>e.name===t||e.name.startsWith(t+":"))}const Dv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:fr,getOllamaModelInfo:il,getRecommendedOllamaModels:Uu},Symbol.toStringTag,{value:"Module"}));let Tn=null,Mr="idle",hi=null,oa=new Set;function oi(){return Tn||(Tn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Tn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Mr="loading"),e.status==="ready"&&(Mr="ready"),e.status==="start"&&(Mr="generating"),(e.status==="complete"||e.status==="error")&&(Mr=hi?"ready":"idle");for(const n of oa)try{n(e)}catch{}})),Tn}function fo(){return{check(){oi().postMessage({type:"check"})},loadModel(t){hi=t,Mr="loading",oi().postMessage({type:"load",modelId:t})},generate(t,e){oi().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,s)=>{let o="",c=null,f=0,m=0;const h=y=>{switch(y.status){case"start":m=y.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=y.output,c=y.tps??c,f=y.numTokens??f,n)try{n({tps:c,numTokens:f,text:o})}catch{}break;case"complete":b(),a({text:o,tps:c,numTokens:f,inputTokens:m});break;case"error":b(),s(new Error(y.data));break}},b=()=>{oa.delete(h)};oa.add(h),oi().postMessage({type:"generate",data:t,options:e})})},interrupt(){Tn==null||Tn.postMessage({type:"interrupt"})},reset(){Tn==null||Tn.postMessage({type:"reset"})},onMessage(t){return oa.add(t),()=>oa.delete(t)},offMessage(t){oa.delete(t)},get status(){return Mr},get isReady(){return Mr==="ready"},get isGenerating(){return Mr==="generating"},get modelId(){return hi},terminate(){Tn==null||Tn.terminate(),Tn=null,Mr="idle",hi=null,oa.clear()}}}const fc="https://me-ai.metaelon.space";function Ns(){try{return localStorage.getItem("ollamaUrl")||fc}catch{return fc}}function jv(t){try{localStorage.setItem("ollamaUrl",t)}catch{}}async function Po(t=Ns()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function Lv(t=Ns()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function Nv(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:s}={},o=()=>{},c=Ns()){var O;const f={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};s!==void 0?f.keep_alive=s:f.keep_alive="10m";const m=new AbortController,h=setTimeout(()=>m.abort(),3e5),b=await fetch(`${c}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f),signal:m.signal});if(clearTimeout(h),!b.ok){const U=await b.text();throw new Error(`Ollama API error: ${U}`)}const y=b.body.getReader(),w=new TextDecoder;let x="";try{for(;;){const{done:U,value:M}=await y.read();if(U)break;const ee=w.decode(M).split(`
`).filter(Boolean);for(const H of ee)try{const C=JSON.parse(H);if((O=C.message)!=null&&O.content&&(x+=C.message.content,o({content:C.message.content,done:!1,total_duration:C.total_duration,eval_count:C.eval_count,eval_duration:C.eval_duration})),C.done){o({content:"",done:!0,total_duration:C.total_duration,eval_count:C.eval_count,eval_duration:C.eval_duration});break}}catch{}}}finally{y.releaseLock()}return x}let Pn="idle",ja=null,la=new Set;function rr(t){for(const e of la)try{e(t)}catch{}}function qv(){return{async check(){Pn="loading",rr({status:"loading",data:"Testing Ollama connection..."});const t=await Po();t.connected?(Pn="idle",rr({status:"ready",data:{type:"ollama",version:t.version,url:Ns()}})):(Pn="idle",rr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){ja=t,Pn="loading",rr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Po();if(!e.connected){Pn="idle",ja=null,rr({status:"error",data:`Ollama not available: ${e.error}`});return}Pn="ready",rr({status:"ready"})},async generate(t,e={}){if(!ja){rr({status:"error",data:"No Ollama model selected"});return}Pn="generating",rr({status:"start",inputTokens:0});let n=0,a=performance.now();try{await Nv(ja,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},s=>{if(s.content){n++;const o=performance.now()-a,c=o>0?n/o*1e3:0;rr({status:"update",output:s.content,tps:Math.round(c*10)/10,numTokens:n})}s.done&&(Pn="ready",rr({status:"complete",tps:s.eval_duration?Math.round(s.eval_count/(s.eval_duration/1e9)*10)/10:null,numTokens:s.eval_count||n}))})}catch(s){Pn="ready",rr({status:"error",data:s.message})}},generateFull(t,e,n){return new Promise((a,s)=>{let o="",c=null,f=0,m=0;const h=y=>{switch(y.status){case"start":m=y.inputTokens||0;break;case"update":if(o+=y.output,c=y.tps??c,f=y.numTokens??f,n)try{n({tps:c,numTokens:f,text:o})}catch{}break;case"complete":b(),a({text:o,tps:c,numTokens:f,inputTokens:m});break;case"error":b(),s(new Error(y.data));break}},b=()=>{la.delete(h)};la.add(h),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return la.add(t),()=>la.delete(t)},offMessage(t){la.delete(t)},get status(){return Pn},get isReady(){return Pn==="ready"},get isGenerating(){return Pn==="generating"},get modelId(){return ja},get backend(){return"ollama"},terminate(){Pn="idle",ja=null,la.clear()}}}let ia=null,$e=null,vo=new Set;function Bv(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function Ku(){return{loadModel(t){const e=Bv(t);if(ia!==e){$e&&$e.terminate(),ia=e,$e=e==="webgpu"?fo():qv();for(const n of vo)$e.onMessage(n)}$e.loadModel(t)},check(){$e||($e=fo(),ia="webgpu"),$e.check()},generate(t,e){if(!$e)throw new Error("No engine loaded. Call loadModel() first.");return $e.generate(t,e)},generateFull(t,e,n){return $e?$e.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){$e==null||$e.interrupt()},reset(){$e==null||$e.reset()},onMessage(t){return $e||($e=fo(),ia="webgpu"),vo.add(t),$e.onMessage(t)},offMessage(t){vo.delete(t),$e==null||$e.offMessage(t)},get status(){return($e==null?void 0:$e.status)||"idle"},get isReady(){return($e==null?void 0:$e.isReady)||!1},get isGenerating(){return($e==null?void 0:$e.isGenerating)||!1},get modelId(){return($e==null?void 0:$e.modelId)||null},get backend(){return ia},getModelInfo(){const t=this.modelId;return t?ia==="webgpu"?sl(t):il(t):null},terminate(){$e==null||$e.terminate(),$e=null,ia=null}}}var Fv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mi={exports:{}},Uv=mi.exports,vc;function Kv(){return vc||(vc=1,(function(t,e){((n,a)=>{t.exports=a()})(Uv,function(){var n=function(r,i){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,d){l.__proto__=d}:function(l,d){for(var v in d)Object.prototype.hasOwnProperty.call(d,v)&&(l[v]=d[v])}))(r,i)},a=function(){return(a=Object.assign||function(r){for(var i,l=1,d=arguments.length;l<d;l++)for(var v in i=arguments[l])Object.prototype.hasOwnProperty.call(i,v)&&(r[v]=i[v]);return r}).apply(this,arguments)};function s(r,i,l){for(var d,v=0,g=i.length;v<g;v++)!d&&v in i||((d=d||Array.prototype.slice.call(i,0,v))[v]=i[v]);return r.concat(d||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Fv,c=Object.keys,f=Array.isArray;function m(r,i){return typeof i=="object"&&c(i).forEach(function(l){r[l]=i[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var h=Object.getPrototypeOf,b={}.hasOwnProperty;function y(r,i){return b.call(r,i)}function w(r,i){typeof i=="function"&&(i=i(h(r))),(typeof Reflect>"u"?c:Reflect.ownKeys)(i).forEach(function(l){O(r,l,i[l])})}var x=Object.defineProperty;function O(r,i,l,d){x(r,i,m(l&&y(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},d))}function U(r){return{from:function(i){return r.prototype=Object.create(i.prototype),O(r.prototype,"constructor",r),{extend:w.bind(null,r.prototype)}}}}var M=Object.getOwnPropertyDescriptor,$=[].slice;function ee(r,i,l){return $.call(r,i,l)}function H(r,i){return i(r)}function C(r){if(!r)throw new Error("Assertion Failed")}function Y(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function se(r,i){if(typeof i=="string"&&y(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var l=[],d=0,v=i.length;d<v;++d){var g=se(r,i[d]);l.push(g)}return l}var k,S=i.indexOf(".");return S===-1||(k=r[i.substr(0,S)])==null?void 0:se(k,i.substr(S+1))}function G(r,i,l){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){C(typeof l!="string"&&"length"in l);for(var d=0,v=i.length;d<v;++d)G(r,i[d],l[d])}else{var g,k,S=i.indexOf(".");S!==-1?(g=i.substr(0,S),(S=i.substr(S+1))===""?l===void 0?f(r)&&!isNaN(parseInt(g))?r.splice(g,1):delete r[g]:r[g]=l:G(k=(k=r[g])&&y(r,g)?k:r[g]={},S,l)):l===void 0?f(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=l}}function me(r){var i,l={};for(i in r)y(r,i)&&(l[i]=r[i]);return l}var ke=[].concat;function de(r){return ke.apply([],r)}var te="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(de([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),pe=new Set(te.map(function(r){return o[r]})),ie=null;function _e(r){return ie=new WeakMap,r=(function i(l){if(!l||typeof l!="object")return l;var d=ie.get(l);if(d)return d;if(f(l)){d=[],ie.set(l,d);for(var v=0,g=l.length;v<g;++v)d.push(i(l[v]))}else if(pe.has(l.constructor))d=l;else{var k,S=h(l);for(k in d=S===Object.prototype?{}:Object.create(S),ie.set(l,d),l)y(l,k)&&(d[k]=i(l[k]))}return d})(r),ie=null,r}var fe={}.toString;function ue(r){return fe.call(r).slice(8,-1)}var he=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Se=typeof he=="symbol"?function(r){var i;return r!=null&&(i=r[he])&&i.apply(r)}:function(){return null};function oe(r,i){i=r.indexOf(i),0<=i&&r.splice(i,1)}var ve={};function le(r){var i,l,d,v;if(arguments.length===1){if(f(r))return r.slice();if(this===ve&&typeof r=="string")return[r];if(v=Se(r))for(l=[];!(d=v.next()).done;)l.push(d.value);else{if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(l=new Array(i);i--;)l[i]=r[i]}}else for(i=arguments.length,l=new Array(i);i--;)l[i]=arguments[i];return l}var ce=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},te=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Je=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(te),ne={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function W(r,i){this.name=r,this.message=i}function R(r,i){return r+". Errors: "+Object.keys(i).map(function(l){return i[l].toString()}).filter(function(l,d,v){return v.indexOf(l)===d}).join(`
`)}function T(r,i,l,d){this.failures=i,this.failedKeys=d,this.successCount=l,this.message=R(r,i)}function V(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(l){return i[l]}),this.failuresByPos=i,this.message=R(r,this.failures)}U(W).from(Error).extend({toString:function(){return this.name+": "+this.message}}),U(T).from(W),U(V).from(W);var Te=Je.reduce(function(r,i){return r[i]=i+"Error",r},{}),Ce=W,P=Je.reduce(function(r,i){var l=i+"Error";function d(v,g){this.name=l,v?typeof v=="string"?(this.message="".concat(v).concat(g?`
 `+g:""),this.inner=g||null):typeof v=="object"&&(this.message="".concat(v.name," ").concat(v.message),this.inner=v):(this.message=ne[i]||l,this.inner=null)}return U(d).from(Ce),r[i]=d,r},{}),ye=(P.Syntax=SyntaxError,P.Type=TypeError,P.Range=RangeError,te.reduce(function(r,i){return r[i+"Error"]=P[i],r},{}));te=Je.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=P[i]),r},{});function xe(){}function Pe(r){return r}function Ue(r,i){return r==null||r===Pe?i:function(l){return i(r(l))}}function Ye(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function _t(r,i){return r===xe?i:function(){var l=r.apply(this,arguments),d=(l!==void 0&&(arguments[0]=l),this.onsuccess),v=this.onerror,g=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return d&&(this.onsuccess=this.onsuccess?Ye(d,this.onsuccess):d),v&&(this.onerror=this.onerror?Ye(v,this.onerror):v),g!==void 0?g:l}}function St(r,i){return r===xe?i:function(){r.apply(this,arguments);var l=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?Ye(l,this.onsuccess):l),d&&(this.onerror=this.onerror?Ye(d,this.onerror):d)}}function Et(r,i){return r===xe?i:function(v){var d=r.apply(this,arguments),v=(m(v,d),this.onsuccess),g=this.onerror,k=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?Ye(v,this.onsuccess):v),g&&(this.onerror=this.onerror?Ye(g,this.onerror):g),d===void 0?k===void 0?void 0:k:m(d,k)}}function Ze(r,i){return r===xe?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Be(r,i){return r===xe?i:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var d=this,v=arguments.length,g=new Array(v);v--;)g[v]=arguments[v];return l.then(function(){return i.apply(d,g)})}return i.apply(this,arguments)}}te.ModifyError=T,te.DexieError=W,te.BulkError=V;var We=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function pt(r){We=r}var Mt={},Zt=100,ut=typeof Promise>"u"?[]:(Je=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[ut=crypto.subtle.digest("SHA-512",new Uint8Array([0])),h(ut),Je]:[Je,h(Je),Je]),Je=ut[0],Ma=ut[1],Ma=Ma&&Ma.then,Ve=Je&&Je.constructor,Tt=!!ut[2],qt=function(r,i){Lt.push([r,i]),Qt&&(queueMicrotask(kn),Qt=!1)},Jt=!0,Qt=!0,Bt=[],It=[],$t=Pe,at={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xe,pgp:!1,env:{},finalize:xe},De=at,Lt=[],Kt=0,Qe=[];function be(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=De;if(typeof r!="function"){if(r!==Mt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Xt(this,this._value)}else this._state=null,this._value=null,++i.ref,(function l(d,v){try{v(function(g){if(d._state===null){if(g===d)throw new TypeError("A promise cannot be resolved with itself.");var k=d._lib&&Fn();g&&typeof g.then=="function"?l(d,function(S,N){g instanceof be?g._then(S,N):g.then(S,N)}):(d._state=!0,d._value=g,hr(d)),k&&mn()}},Xt.bind(null,d))}catch(g){Xt(d,g)}})(this,r)}var dt={get:function(){var r=De,i=$r;function l(d,v){var g=this,k=!r.global&&(r!==De||i!==$r),S=k&&!tr(),N=new be(function(X,q){Bn(g,new rn(j(d,r,k,S),j(v,r,k,S),X,q,r))});return this._consoleTask&&(N._consoleTask=this._consoleTask),N}return l.prototype=Mt,l},set:function(r){O(this,"then",r&&r.prototype===Mt?dt:{get:function(){return r},set:dt.set})}};function rn(r,i,l,d,v){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=l,this.reject=d,this.psd=v}function Xt(r,i){var l,d;It.push(i),r._state===null&&(l=r._lib&&Fn(),i=$t(i),r._state=!1,r._value=i,d=r,Bt.some(function(v){return v._value===d._value})||Bt.push(d),hr(r),l)&&mn()}function hr(r){var i=r._listeners;r._listeners=[];for(var l=0,d=i.length;l<d;++l)Bn(r,i[l]);var v=r._PSD;--v.ref||v.finalize(),Kt===0&&(++Kt,qt(function(){--Kt==0&&zn()},[]))}function Bn(r,i){if(r._state===null)r._listeners.push(i);else{var l=r._state?i.onFulfilled:i.onRejected;if(l===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++Kt,qt(Ct,[l,r,i])}}function Ct(r,i,l){try{var d,v=i._value;!i._state&&It.length&&(It=[]),d=We&&i._consoleTask?i._consoleTask.run(function(){return r(v)}):r(v),i._state||It.indexOf(v)!==-1||(g=>{for(var k=Bt.length;k;)if(Bt[--k]._value===g._value)return Bt.splice(k,1)})(i),l.resolve(d)}catch(g){l.reject(g)}finally{--Kt==0&&zn(),--l.psd.ref||l.psd.finalize()}}function kn(){Ke(at,function(){Fn()&&mn()})}function Fn(){var r=Jt;return Qt=Jt=!1,r}function mn(){var r,i,l;do for(;0<Lt.length;)for(r=Lt,Lt=[],l=r.length,i=0;i<l;++i){var d=r[i];d[0].apply(null,d[1])}while(0<Lt.length);Qt=Jt=!0}function zn(){for(var r=Bt,i=(Bt=[],r.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)}),Qe.slice(0)),l=i.length;l;)i[--l]()}function Rn(r){return new be(Mt,!1,r)}function kt(r,i){var l=De;return function(){var d=Fn(),v=De;try{return nr(l,!0),r.apply(this,arguments)}catch(g){i&&i(g)}finally{nr(v,!1),d&&mn()}}}w(be.prototype,{then:dt,_then:function(r,i){Bn(this,new rn(null,null,r,i,De))},catch:function(r){var i,l;return arguments.length===1?this.then(null,r):(i=r,l=arguments[1],typeof i=="function"?this.then(null,function(d){return(d instanceof i?l:Rn)(d)}):this.then(null,function(d){return(d&&d.name===i?l:Rn)(d)}))},finally:function(r){return this.then(function(i){return be.resolve(r()).then(function(){return i})},function(i){return be.resolve(r()).then(function(){return Rn(i)})})},timeout:function(r,i){var l=this;return r<1/0?new be(function(d,v){var g=setTimeout(function(){return v(new P.Timeout(i))},r);l.then(d,v).finally(clearTimeout.bind(null,g))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&O(be.prototype,Symbol.toStringTag,"Dexie.Promise"),at.env=Us(),w(be,{all:function(){var r=le.apply(null,arguments).map(ea);return new be(function(i,l){r.length===0&&i([]);var d=r.length;r.forEach(function(v,g){return be.resolve(v).then(function(k){r[g]=k,--d||i(r)},l)})})},resolve:function(r){return r instanceof be?r:r&&typeof r.then=="function"?new be(function(i,l){r.then(i,l)}):new be(Mt,!0,r)},reject:Rn,race:function(){var r=le.apply(null,arguments).map(ea);return new be(function(i,l){r.map(function(d){return be.resolve(d).then(i,l)})})},PSD:{get:function(){return De},set:function(r){return De=r}},totalEchoes:{get:function(){return $r}},newPSD:er,usePSD:Ke,scheduler:{get:function(){return qt},set:function(r){qt=r}},rejectionMapper:{get:function(){return $t},set:function(r){$t=r}},follow:function(r,i){return new be(function(l,d){return er(function(v,g){var k=De;k.unhandleds=[],k.onunhandled=g,k.finalize=Ye(function(){var S,N=this;S=function(){N.unhandleds.length===0?v():g(N.unhandleds[0])},Qe.push(function X(){S(),Qe.splice(Qe.indexOf(X),1)}),++Kt,qt(function(){--Kt==0&&zn()},[])},k.finalize),r()},i,l,d)})}}),Ve&&(Ve.allSettled&&O(be,"allSettled",function(){var r=le.apply(null,arguments).map(ea);return new be(function(i){r.length===0&&i([]);var l=r.length,d=new Array(l);r.forEach(function(v,g){return be.resolve(v).then(function(k){return d[g]={status:"fulfilled",value:k}},function(k){return d[g]={status:"rejected",reason:k}}).then(function(){return--l||i(d)})})})}),Ve.any&&typeof AggregateError<"u"&&O(be,"any",function(){var r=le.apply(null,arguments).map(ea);return new be(function(i,l){r.length===0&&l(new AggregateError([]));var d=r.length,v=new Array(d);r.forEach(function(g,k){return be.resolve(g).then(function(S){return i(S)},function(S){v[k]=S,--d||l(new AggregateError(v))})})})}),Ve.withResolvers)&&(be.withResolvers=Ve.withResolvers);var Gt={awaits:0,echoes:0,id:0},Un=0,Kn=[],Jr=0,$r=0,$a=0;function er(r,k,l,d){var v=De,g=Object.create(v),k=(g.parent=v,g.ref=0,g.global=!1,g.id=++$a,at.env,g.env=Tt?{Promise:be,PromiseProp:{value:be,configurable:!0,writable:!0},all:be.all,race:be.race,allSettled:be.allSettled,any:be.any,resolve:be.resolve,reject:be.reject}:{},k&&m(g,k),++v.ref,g.finalize=function(){--this.parent.ref||this.parent.finalize()},Ke(g,r,l,d));return g.ref===0&&g.finalize(),k}function fn(){return Gt.id||(Gt.id=++Un),++Gt.awaits,Gt.echoes+=Zt,Gt.id}function tr(){return!!Gt.awaits&&(--Gt.awaits==0&&(Gt.id=0),Gt.echoes=Gt.awaits*Zt,!0)}function ea(r){return Gt.echoes&&r&&r.constructor===Ve?(fn(),r.then(function(i){return tr(),i},function(i){return tr(),Me(i)})):r}function zs(){var r=Kn[Kn.length-1];Kn.pop(),nr(r,!1)}function nr(r,i){var l,d,v=De;(i?!Gt.echoes||Jr++&&r===De:!Jr||--Jr&&r===De)||queueMicrotask(i?(function(g){++$r,Gt.echoes&&--Gt.echoes!=0||(Gt.echoes=Gt.awaits=Gt.id=0),Kn.push(De),nr(g,!0)}).bind(null,r):zs),r!==De&&(De=r,v===at&&(at.env=Us()),Tt)&&(l=at.env.Promise,d=r.env,v.global||r.global)&&(Object.defineProperty(o,"Promise",d.PromiseProp),l.all=d.all,l.race=d.race,l.resolve=d.resolve,l.reject=d.reject,d.allSettled&&(l.allSettled=d.allSettled),d.any)&&(l.any=d.any)}function Us(){var r=o.Promise;return Tt?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ke(r,i,l,d,v){var g=De;try{return nr(r,!0),i(l,d,v)}finally{nr(g,!1)}}function j(r,i,l,d){return typeof r!="function"?r:function(){var v=De;l&&fn(),nr(i,!0);try{return r.apply(this,arguments)}finally{nr(v,!1),d&&queueMicrotask(tr)}}}function Ie(r){Promise===Ve&&Gt.echoes===0?Jr===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+Ma).indexOf("[native code]")===-1&&(fn=tr=xe);var Me=be.reject,ht="ï¿¿",Ot="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ft="String expected.",Ht=[],xn="__dbnames",mr="readonly",ta="readwrite";function Dt(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var es={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function na(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=_e(i))[r],i}}function xl(){throw P.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ct(r,i){try{var l=Sl(r),d=Sl(i);if(l!==d)return l==="Array"?1:d==="Array"?-1:l==="binary"?1:d==="binary"?-1:l==="string"?1:d==="string"?-1:l==="Date"?1:d!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":for(var v=El(r),g=El(i),k=v.length,S=g.length,N=k<S?k:S,X=0;X<N;++X)if(v[X]!==g[X])return v[X]<g[X]?-1:1;return k===S?0:k<S?-1:1;case"Array":for(var q=r,D=i,z=q.length,K=D.length,B=z<K?z:K,L=0;L<B;++L){var J=ct(q[L],D[L]);if(J!==0)return J}return z===K?0:z<K?-1:1}}catch{}return NaN}function Sl(r){var i=typeof r;return i=="object"&&(ArrayBuffer.isView(r)||(i=ue(r))==="ArrayBuffer")?"binary":i}function El(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Ks(r,i,l){var d=r.schema.yProps;return d?(i&&0<l.numFailures&&(i=i.filter(function(v,g){return!l.failures[g]})),Promise.all(d.map(function(v){return v=v.updatesTable,i?r.db.table(v).where("k").anyOf(i).delete():r.db.table(v).clear()})).then(function(){return l})):l}Tl.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var l=i.add;if(f(l))return s(s([],f(r)?r:[],!0),l).sort();if(typeof l=="number")return(Number(r)||0)+l;if(typeof l=="bigint")try{return BigInt(r)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(i.remove!==void 0){var d=i.remove;if(f(d))return f(r)?r.filter(function(v){return!d.includes(v)}).sort():[];if(typeof d=="number")return Number(r)-d;if(typeof d=="bigint")try{return BigInt(r)-d}catch{return BigInt(0)-d}throw new TypeError("Invalid subtrahend ".concat(d))}return l=(l=i.replacePrefix)==null?void 0:l[0],l&&typeof r=="string"&&r.startsWith(l)?i.replacePrefix[1]+r.substring(l.length):r};var ts=Tl;function Tl(r){this["@@propmod"]=r}function Al(r,i){for(var l=c(i),d=l.length,v=!1,g=0;g<d;++g){var k=l[g],S=i[k],N=se(r,k);S instanceof ts?(G(r,k,S.execute(N)),v=!0):N!==S&&(G(r,k,S),v=!0)}return v}Pt.prototype._trans=function(r,i,l){var d=this._tx||De.trans,v=this.name,g=We&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function k(X,q,D){if(D.schema[v])return i(D.idbtrans,D);throw new P.NotFound("Table "+v+" not part of transaction")}var S=Fn();try{var N=d&&d.db._novip===this.db._novip?d===De.trans?d._promise(r,k,l):er(function(){return d._promise(r,k,l)},{trans:d,transless:De.transless||De}):(function X(q,D,z,K){if(q.idbdb&&(q._state.openComplete||De.letThrough||q._vip)){var B=q._createTransaction(D,z,q._dbSchema);try{B.create(),q._state.PR1398_maxLoop=3}catch(L){return L.name===Te.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return X(q,D,z,K)})):Me(L)}return B._promise(D,function(L,J){return er(function(){return De.trans=B,K(L,J,B)})}).then(function(L){if(D==="readwrite")try{B.idbtrans.commit()}catch{}return D==="readonly"?L:B._completion.then(function(){return L})})}if(q._state.openComplete)return Me(new P.DatabaseClosed(q._state.dbOpenError));if(!q._state.isBeingOpened){if(!q._state.autoOpen)return Me(new P.DatabaseClosed);q.open().catch(xe)}return q._state.dbReadyPromise.then(function(){return X(q,D,z,K)})})(this.db,r,[this.name],k);return g&&(N._consoleTask=g,N=N.catch(function(X){return console.trace(X),Me(X)})),N}finally{S&&mn()}},Pt.prototype.get=function(r,i){var l=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?Me(new P.Type("Invalid argument to Table.get()")):this._trans("readonly",function(d){return l.core.get({trans:d,key:r}).then(function(v){return l.hook.reading.fire(v)})}).then(i)},Pt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(f(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=c(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&i.every(function(X){return 0<=S.keyPath.indexOf(X)})){for(var N=0;N<i.length;++N)if(i.indexOf(S.keyPath[N])===-1)return!1;return!0}return!1}).sort(function(S,N){return S.keyPath.length-N.keyPath.length})[0];if(l&&this.db._maxKey!==ht)return k=l.keyPath.slice(0,i.length),this.where(k).equals(k.map(function(S){return r[S]}));!l&&We&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var d=this.schema.idxByName;function v(S,N){return ct(S,N)===0}var k=i.reduce(function(q,N){var X=q[0],q=q[1],D=d[N],z=r[N];return[X||D,X||!D?Dt(q,D&&D.multi?function(K){return K=se(K,N),f(K)&&K.some(function(B){return v(z,B)})}:function(K){return v(z,se(K,N))}):q]},[null,null]),g=k[0],k=k[1];return g?this.where(g.name).equals(r[g.keyPath]).filter(k):l?this.filter(k):this.where(i).equals("")},Pt.prototype.filter=function(r){return this.toCollection().and(r)},Pt.prototype.count=function(r){return this.toCollection().count(r)},Pt.prototype.offset=function(r){return this.toCollection().offset(r)},Pt.prototype.limit=function(r){return this.toCollection().limit(r)},Pt.prototype.each=function(r){return this.toCollection().each(r)},Pt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Pt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Pt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,f(r)?"[".concat(r.join("+"),"]"):r))},Pt.prototype.reverse=function(){return this.toCollection().reverse()},Pt.prototype.mapToClass=function(r){for(var i=this.db,l=this.name,d=((this.schema.mappedClass=r).prototype instanceof xl&&(r=(k=>{var S=q,N=k;if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function X(){this.constructor=S}function q(){return k!==null&&k.apply(this,arguments)||this}return n(S,N),S.prototype=N===null?Object.create(N):(X.prototype=N.prototype,new X),Object.defineProperty(q.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),q.prototype.table=function(){return l},q})(r)),new Set),v=r.prototype;v;v=h(v))Object.getOwnPropertyNames(v).forEach(function(k){return d.add(k)});function g(k){if(!k)return k;var S,N=Object.create(r.prototype);for(S in k)if(!d.has(S))try{N[S]=k[S]}catch{}return N}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=g,this.hook("reading",g),r},Pt.prototype.defineClass=function(){return this.mapToClass(function(r){m(this,r)})},Pt.prototype.add=function(r,i){var l=this,d=this.schema.primKey,v=d.auto,g=d.keyPath,k=r;return g&&v&&(k=na(g)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:i!=null?[i]:null,values:[k]})}).then(function(S){return S.numFailures?be.reject(S.failures[0]):S.lastResult}).then(function(S){if(g)try{G(r,g,S)}catch{}return S})},Pt.prototype.upsert=function(r,i){var l=this,d=this.schema.primKey.keyPath;return this._trans("readwrite",function(v){return l.core.get({trans:v,key:r}).then(function(g){var k=g??{};return Al(k,i),d&&G(k,d,r),l.core.mutate({trans:v,type:"put",values:[k],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[i]}}).then(function(S){return S.numFailures?be.reject(S.failures[0]):!!g})})})},Pt.prototype.update=function(r,i){return typeof r!="object"||f(r)?this.where(":id").equals(r).modify(i):(r=se(r,this.schema.primKey.keyPath))===void 0?Me(new P.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i)},Pt.prototype.put=function(r,i){var l=this,d=this.schema.primKey,v=d.auto,g=d.keyPath,k=r;return g&&v&&(k=na(g)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[k],keys:i!=null?[i]:null})}).then(function(S){return S.numFailures?be.reject(S.failures[0]):S.lastResult}).then(function(S){if(g)try{G(r,g,S)}catch{}return S})},Pt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(l){return i.core.mutate({trans:l,type:"delete",keys:[r]}).then(function(d){return Ks(i,[r],d)}).then(function(d){return d.numFailures?be.reject(d.failures[0]):void 0})})},Pt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:es}).then(function(l){return Ks(r,null,l)})}).then(function(i){return i.numFailures?be.reject(i.failures[0]):void 0})},Pt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(l){return i.core.getMany({keys:r,trans:l}).then(function(d){return d.map(function(v){return i.hook.reading.fire(v)})})})},Pt.prototype.bulkAdd=function(r,i,l){var d=this,v=Array.isArray(i)?i:void 0,g=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(k){var S=d.schema.primKey,X=S.auto,S=S.keyPath;if(S&&v)throw new P.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,X=S&&X?r.map(na(S)):r;return d.core.mutate({trans:k,type:"add",keys:v,values:X,wantResults:g}).then(function(q){var D=q.numFailures,z=q.failures;if(D===0)return g?q.results:q.lastResult;throw new V("".concat(d.name,".bulkAdd(): ").concat(D," of ").concat(N," operations failed"),z)})})},Pt.prototype.bulkPut=function(r,i,l){var d=this,v=Array.isArray(i)?i:void 0,g=(l=l||(v?void 0:i))?l.allKeys:void 0;return this._trans("readwrite",function(k){var S=d.schema.primKey,X=S.auto,S=S.keyPath;if(S&&v)throw new P.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(v&&v.length!==r.length)throw new P.InvalidArgument("Arguments objects and keys must have the same length");var N=r.length,X=S&&X?r.map(na(S)):r;return d.core.mutate({trans:k,type:"put",keys:v,values:X,wantResults:g}).then(function(q){var D=q.numFailures,z=q.failures;if(D===0)return g?q.results:q.lastResult;throw new V("".concat(d.name,".bulkPut(): ").concat(D," of ").concat(N," operations failed"),z)})})},Pt.prototype.bulkUpdate=function(r){var i=this,l=this.core,d=r.map(function(k){return k.key}),v=r.map(function(k){return k.changes}),g=[];return this._trans("readwrite",function(k){return l.getMany({trans:k,keys:d,cache:"clone"}).then(function(S){var N=[],X=[],q=(r.forEach(function(D,z){var K=D.key,B=D.changes,L=S[z];if(L){for(var J=0,ae=Object.keys(B);J<ae.length;J++){var Q=ae[J],we=B[Q];if(Q===i.schema.primKey.keyPath){if(ct(we,K)!==0)throw new P.Constraint("Cannot update primary key in bulkUpdate()")}else G(L,Q,we)}g.push(z),N.push(K),X.push(L)}}),N.length);return l.mutate({trans:k,type:"put",keys:N,values:X,updates:{keys:d,changeSpecs:v}}).then(function(D){var z=D.numFailures,K=D.failures;if(z===0)return q;for(var B=0,L=Object.keys(K);B<L.length;B++){var J,ae=L[B],Q=g[Number(ae)];Q!=null&&(J=K[ae],delete K[ae],K[Q]=J)}throw new V("".concat(i.name,".bulkUpdate(): ").concat(z," of ").concat(q," operations failed"),K)})})})},Pt.prototype.bulkDelete=function(r){var i=this,l=r.length;return this._trans("readwrite",function(d){return i.core.mutate({trans:d,type:"delete",keys:r}).then(function(v){return Ks(i,r,v)})}).then(function(d){var v=d.numFailures,g=d.failures;if(v===0)return d.lastResult;throw new V("".concat(i.name,".bulkDelete(): ").concat(v," of ").concat(l," operations failed"),g)})};var Il=Pt;function Pt(){}function ns(r){function i(k,S){if(S){for(var N=arguments.length,X=new Array(N-1);--N;)X[N-1]=arguments[N];return l[k].subscribe.apply(null,X),r}if(typeof k=="string")return l[k]}var l={};i.addEventType=g;for(var d=1,v=arguments.length;d<v;++d)g(arguments[d]);return i;function g(k,S,N){var X,q;if(typeof k!="object")return S=S||Ze,q={subscribers:[],fire:N=N||xe,subscribe:function(D){q.subscribers.indexOf(D)===-1&&(q.subscribers.push(D),q.fire=S(q.fire,D))},unsubscribe:function(D){q.subscribers=q.subscribers.filter(function(z){return z!==D}),q.fire=q.subscribers.reduce(S,N)}},l[k]=i[k]=q;c(X=k).forEach(function(D){var z=X[D];if(f(z))g(D,X[D][0],X[D][1]);else{if(z!=="asap")throw new P.InvalidArgument("Invalid event config");var K=g(D,Pe,function(){for(var B=arguments.length,L=new Array(B);B--;)L[B]=arguments[B];K.subscribers.forEach(function(J){Y(function(){J.apply(null,L)})})})}})}}function rs(r,i){return U(i).from({prototype:r}),i}function Ra(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function ji(r,i){r.filter=Dt(r.filter,i)}function Li(r,i,l){var d=r.replayFilter;r.replayFilter=d?function(){return Dt(d(),i())}:i,r.justLimit=l&&!d}function Gs(r,i){if(r.isPrimKey)return i.primaryKey;var l=i.getIndexByKeyPath(r.index);if(l)return l;throw new P.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed")}function Cl(r,i,l){var d=Gs(r,i.schema);return i.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:d,range:r.range}})}function Ws(r,i,l,d){var v,g,k=r.replayFilter?Dt(r.filter,r.replayFilter()):r.filter;return r.or?(v={},g=function(S,N,X){var q,D;k&&!k(N,X,function(z){return N.stop(z)},function(z){return N.fail(z)})||((D=""+(q=N.primaryKey))=="[object ArrayBuffer]"&&(D=""+new Uint8Array(q)),y(v,D))||(v[D]=!0,i(S,N,X))},Promise.all([r.or._iterate(g,l),Rl(Cl(r,d,l),r.algorithm,g,!r.keysOnly&&r.valueMapper)])):Rl(Cl(r,d,l),Dt(r.algorithm,k),i,!r.keysOnly&&r.valueMapper)}function Rl(r,i,l,d){var v=kt(d?function(g,k,S){return l(d(g),k,S)}:l);return r.then(function(g){if(g)return g.start(function(){var k=function(){return g.continue()};i&&!i(g,function(S){return k=S},function(S){g.stop(S),k=xe},function(S){g.fail(S),k=xe})||v(g.value,g,function(S){return k=S}),k()})})}mt.prototype._read=function(r,i){var l=this._ctx;return l.error?l.table._trans(null,Me.bind(null,l.error)):l.table._trans("readonly",r).then(i)},mt.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,Me.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},mt.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=Dt(i.algorithm,r)},mt.prototype._iterate=function(r,i){return Ws(this._ctx,r,i,this._ctx.table.core)},mt.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&m(l,r),i._ctx=l,i},mt.prototype.raw=function(){return this._ctx.valueMapper=null,this},mt.prototype.each=function(r){var i=this._ctx;return this._read(function(l){return Ws(i,r,l,i.table.core)})},mt.prototype.count=function(r){var i=this;return this._read(function(l){var d,v=i._ctx,g=v.table.core;return Ra(v,!0)?g.count({trans:l,query:{index:Gs(v,g.schema),range:v.range}}).then(function(k){return Math.min(k,v.limit)}):(d=0,Ws(v,function(){return++d,!1},l,g).then(function(){return d}))}).then(r)},mt.prototype.sortBy=function(r,i){var l=r.split(".").reverse(),d=l[0],v=l.length-1;function g(N,X){return X?g(N[l[X]],X-1):N[d]}var k=this._ctx.dir==="next"?1:-1;function S(N,X){return ct(g(N,v),g(X,v))*k}return this.toArray(function(N){return N.sort(S)}).then(i)},mt.prototype.toArray=function(r){var i=this;return this._read(function(l){var d,v,g,k=i._ctx;return k.dir==="next"&&Ra(k,!0)&&0<k.limit?(d=k.valueMapper,v=Gs(k,k.table.core.schema),k.table.core.query({trans:l,limit:k.limit,values:!0,query:{index:v,range:k.range}}).then(function(S){return S=S.result,d?S.map(d):S})):(g=[],Ws(k,function(S){return g.push(S)},l,k.table.core).then(function(){return g}))},r)},mt.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,Ra(i)?Li(i,function(){var l=r;return function(d,v){return l===0||(l===1?--l:v(function(){d.advance(l),l=0}),!1)}}):Li(i,function(){var l=r;return function(){return--l<0}})),this},mt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),Li(this._ctx,function(){var i=r;return function(l,d,v){return--i<=0&&d(v),0<=i}},!0),this},mt.prototype.until=function(r,i){return ji(this._ctx,function(l,d,v){return!r(l.value)||(d(v),i)}),this},mt.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},mt.prototype.last=function(r){return this.reverse().first(r)},mt.prototype.filter=function(r){var i;return ji(this._ctx,function(l){return r(l.value)}),(i=this._ctx).isMatch=Dt(i.isMatch,r),this},mt.prototype.and=function(r){return this.filter(r)},mt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},mt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},mt.prototype.desc=function(){return this.reverse()},mt.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.key,d)})},mt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},mt.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(l,d){r(d.primaryKey,d)})},mt.prototype.keys=function(r){var i=this._ctx,l=(i.keysOnly=!i.isMatch,[]);return this.each(function(d,v){l.push(v.key)}).then(function(){return l}).then(r)},mt.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&Ra(i,!0)&&0<i.limit)return this._read(function(d){var v=Gs(i,i.table.core.schema);return i.table.core.query({trans:d,values:!1,limit:i.limit,query:{index:v,range:i.range}})}).then(function(d){return d.result}).then(r);i.keysOnly=!i.isMatch;var l=[];return this.each(function(d,v){l.push(v.primaryKey)}).then(function(){return l}).then(r)},mt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},mt.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},mt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},mt.prototype.distinct=function(){var r,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(r={},ji(this._ctx,function(d){var d=d.primaryKey.toString(),v=y(r,d);return r[d]=!0,!v})),this},mt.prototype.modify=function(r){var i=this,l=this._ctx;return this._write(function(d){function v(L,J){var ae=J.failures;z+=L-J.numFailures;for(var Q=0,we=c(ae);Q<we.length;Q++){var Ee=we[Q];D.push(ae[Ee])}}var g=typeof r=="function"?r:function(L){return Al(L,r)},k=l.table.core,q=k.schema.primaryKey,S=q.outbound,N=q.extractKey,X=200,q=i.db._options.modifyChunkSize,D=(q&&(X=typeof q=="object"?q[k.name]||q["*"]||200:q),[]),z=0,K=[],B=r===Ol;return i.clone().primaryKeys().then(function(L){function J(Q){var we=Math.min(X,L.length-Q),Ee=L.slice(Q,Q+we);return(B?Promise.resolve([]):k.getMany({trans:d,keys:Ee,cache:"immutable"})).then(function(je){var Le=[],Ae=[],Fe=S?[]:null,qe=B?Ee:[];if(!B)for(var Re=0;Re<we;++Re){var ze=je[Re],ft={value:_e(ze),primKey:L[Q+Re]};g.call(ft,ft.value,ft)!==!1&&(ft.value==null?qe.push(L[Q+Re]):S||ct(N(ze),N(ft.value))===0?(Ae.push(ft.value),S&&Fe.push(L[Q+Re])):(qe.push(L[Q+Re]),Le.push(ft.value)))}return Promise.resolve(0<Le.length&&k.mutate({trans:d,type:"add",values:Le}).then(function(gt){for(var He in gt.failures)qe.splice(parseInt(He),1);v(Le.length,gt)})).then(function(){return(0<Ae.length||ae&&typeof r=="object")&&k.mutate({trans:d,type:"put",keys:Fe,values:Ae,criteria:ae,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<Q}).then(function(gt){return v(Ae.length,gt)})}).then(function(){return(0<qe.length||ae&&B)&&k.mutate({trans:d,type:"delete",keys:qe,criteria:ae,isAdditionalChunk:0<Q}).then(function(gt){return Ks(l.table,qe,gt)}).then(function(gt){return v(qe.length,gt)})}).then(function(){return L.length>Q+we&&J(Q+X)})})}var ae=Ra(l)&&l.limit===1/0&&(typeof r!="function"||B)&&{index:l.index,range:l.range};return J(0).then(function(){if(0<D.length)throw new T("Error modifying one or more objects",D,z,K);return L.length})})})},mt.prototype.delete=function(){var r=this._ctx,i=r.range;return!Ra(r)||r.table.schema.yProps||!r.isPrimKey&&i.type!==3?this.modify(Ol):this._write(function(l){var d=r.table.core.schema.primaryKey,v=i;return r.table.core.count({trans:l,query:{index:d,range:v}}).then(function(g){return r.table.core.mutate({trans:l,type:"deleteRange",range:v}).then(function(N){var S=N.failures,N=N.numFailures;if(N)throw new T("Could not delete some values",Object.keys(S).map(function(X){return S[X]}),g-N);return g-N})})})};var Pd=mt;function mt(){}var Ol=function(r,i){return i.value=null};function Md(r,i){return r<i?-1:r===i?0:1}function Dd(r,i){return i<r?-1:r===i?0:1}function On(r,i,l){return r=r instanceof Ml?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(i),r}function Oa(r){return new r.Collection(r,function(){return Pl("")}).limit(0)}function Hs(K,i,l,d){var v,g,k,S,N,X,q,D=l.length;if(!l.every(function(L){return typeof L=="string"}))return On(K,Ft);function z(L){v=L==="next"?function(ae){return ae.toUpperCase()}:function(ae){return ae.toLowerCase()},g=L==="next"?function(ae){return ae.toLowerCase()}:function(ae){return ae.toUpperCase()},k=L==="next"?Md:Dd;var J=l.map(function(ae){return{lower:g(ae),upper:v(ae)}}).sort(function(ae,Q){return k(ae.lower,Q.lower)});S=J.map(function(ae){return ae.upper}),N=J.map(function(ae){return ae.lower}),q=(X=L)==="next"?"":d}z("next");var K=new K.Collection(K,function(){return Br(S[0],N[D-1]+d)}),B=(K._ondirectionchange=function(L){z(L)},0);return K._addAlgorithm(function(L,J,ae){var Q=L.key;if(typeof Q=="string"){var we=g(Q);if(i(we,N,B))return!0;for(var Ee=null,je=B;je<D;++je){var Le=((Ae,Fe,qe,Re,ze,ft)=>{for(var gt=Math.min(Ae.length,Re.length),He=-1,tt=0;tt<gt;++tt){var zt=Fe[tt];if(zt!==Re[tt])return ze(Ae[tt],qe[tt])<0?Ae.substr(0,tt)+qe[tt]+qe.substr(tt+1):ze(Ae[tt],Re[tt])<0?Ae.substr(0,tt)+Re[tt]+qe.substr(tt+1):0<=He?Ae.substr(0,He)+Fe[He]+qe.substr(He+1):null;ze(Ae[tt],zt)<0&&(He=tt)}return gt<Re.length&&ft==="next"?Ae+qe.substr(Ae.length):gt<Ae.length&&ft==="prev"?Ae.substr(0,qe.length):He<0?null:Ae.substr(0,He)+Re[He]+qe.substr(He+1)})(Q,we,S[je],N[je],k,X);Le===null&&Ee===null?B=je+1:(Ee===null||0<k(Ee,Le))&&(Ee=Le)}J(Ee!==null?function(){L.continue(Ee+q)}:ae)}return!1}),K}function Br(r,i,l,d){return{type:2,lower:r,upper:i,lowerOpen:l,upperOpen:d}}function Pl(r){return{type:1,lower:r,upper:r}}Object.defineProperty(en.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),en.prototype.between=function(r,i,l,d){l=l!==!1,d=d===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(l||d)&&(!l||!d)?Oa(this):new this.Collection(this,function(){return Br(r,i,!l,!d)})}catch{return On(this,Ot)}},en.prototype.equals=function(r){return r==null?On(this,Ot):new this.Collection(this,function(){return Pl(r)})},en.prototype.above=function(r){return r==null?On(this,Ot):new this.Collection(this,function(){return Br(r,void 0,!0)})},en.prototype.aboveOrEqual=function(r){return r==null?On(this,Ot):new this.Collection(this,function(){return Br(r,void 0,!1)})},en.prototype.below=function(r){return r==null?On(this,Ot):new this.Collection(this,function(){return Br(void 0,r,!1,!0)})},en.prototype.belowOrEqual=function(r){return r==null?On(this,Ot):new this.Collection(this,function(){return Br(void 0,r)})},en.prototype.startsWith=function(r){return typeof r!="string"?On(this,Ft):this.between(r,r+ht,!0,!0)},en.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Hs(this,function(i,l){return i.indexOf(l[0])===0},[r],ht)},en.prototype.equalsIgnoreCase=function(r){return Hs(this,function(i,l){return i===l[0]},[r],"")},en.prototype.anyOfIgnoreCase=function(){var r=le.apply(ve,arguments);return r.length===0?Oa(this):Hs(this,function(i,l){return l.indexOf(i)!==-1},r,"")},en.prototype.startsWithAnyOfIgnoreCase=function(){var r=le.apply(ve,arguments);return r.length===0?Oa(this):Hs(this,function(i,l){return l.some(function(d){return i.indexOf(d)===0})},r,ht)},en.prototype.anyOf=function(){var r,i,l=this,d=le.apply(ve,arguments),v=this._cmp;try{d.sort(v)}catch{return On(this,Ot)}return d.length===0?Oa(this):((r=new this.Collection(this,function(){return Br(d[0],d[d.length-1])}))._ondirectionchange=function(g){v=g==="next"?l._ascending:l._descending,d.sort(v)},i=0,r._addAlgorithm(function(g,k,S){for(var N=g.key;0<v(N,d[i]);)if(++i===d.length)return k(S),!1;return v(N,d[i])===0||(k(function(){g.continue(d[i])}),!1)}),r)},en.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},en.prototype.noneOf=function(){var r=le.apply(ve,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return On(this,Ot)}var i=r.reduce(function(l,d){return l?l.concat([[l[l.length-1][1],d]]):[[-1/0,d]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},en.prototype.inAnyRange=function(r,ae){var l=this,d=this._cmp,v=this._ascending,g=this._descending,k=this._min,S=this._max;if(r.length===0)return Oa(this);if(!r.every(function(Q){return Q[0]!==void 0&&Q[1]!==void 0&&v(Q[0],Q[1])<=0}))return On(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",P.InvalidArgument);var N=!ae||ae.includeLowers!==!1,X=ae&&ae.includeUppers===!0,q,D=v;function z(Q,we){return D(Q[0],we[0])}try{(q=r.reduce(function(Q,we){for(var Ee=0,je=Q.length;Ee<je;++Ee){var Le=Q[Ee];if(d(we[0],Le[1])<0&&0<d(we[1],Le[0])){Le[0]=k(Le[0],we[0]),Le[1]=S(Le[1],we[1]);break}}return Ee===je&&Q.push(we),Q},[])).sort(z)}catch{return On(this,Ot)}var K=0,B=X?function(Q){return 0<v(Q,q[K][1])}:function(Q){return 0<=v(Q,q[K][1])},L=N?function(Q){return 0<g(Q,q[K][0])}:function(Q){return 0<=g(Q,q[K][0])},J=B,ae=new this.Collection(this,function(){return Br(q[0][0],q[q.length-1][1],!N,!X)});return ae._ondirectionchange=function(Q){D=Q==="next"?(J=B,v):(J=L,g),q.sort(z)},ae._addAlgorithm(function(Q,we,Ee){for(var je,Le=Q.key;J(Le);)if(++K===q.length)return we(Ee),!1;return!B(je=Le)&&!L(je)||(l._cmp(Le,q[K][1])===0||l._cmp(Le,q[K][0])===0||we(function(){D===v?Q.continue(q[K][0]):Q.continue(q[K][1])}),!1)}),ae},en.prototype.startsWithAnyOf=function(){var r=le.apply(ve,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Oa(this):this.inAnyRange(r.map(function(i){return[i,i+ht]})):On(this,"startsWithAnyOf() only works with strings")};var Ml=en;function en(){}function gr(r){return kt(function(i){return as(i),r(i.target.error),!1})}function as(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var ss="storagemutated",Ni="x-storagemutated-1",Fr=ns(null,ss),jd=(_r.prototype._lock=function(){return C(!De.global),++this._reculock,this._reculock!==1||De.global||(De.lockOwnerFor=this),this},_r.prototype._unlock=function(){if(C(!De.global),--this._reculock==0)for(De.global||(De.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ke(r[1],r[0])}catch{}}return this},_r.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},_r.prototype.create=function(r){var i=this;if(this.mode){var l=this.db.idbdb,d=this.db._state.dbOpenError;if(C(!this.idbtrans),!r&&!l)switch(d&&d.name){case"DatabaseClosedError":throw new P.DatabaseClosed(d);case"MissingAPIError":throw new P.MissingAPI(d.message,d);default:throw new P.OpenFailed(d)}if(!this.active)throw new P.TransactionInactive;C(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=kt(function(v){as(v),i._reject(r.error)}),r.onabort=kt(function(v){as(v),i.active&&i._reject(new P.Abort(r.error)),i.active=!1,i.on("abort").fire(v)}),r.oncomplete=kt(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&Fr.storagemutated.fire(r.mutatedParts)})}return this},_r.prototype._promise=function(r,i,l){var d,v=this;return r==="readwrite"&&this.mode!=="readwrite"?Me(new P.ReadOnly("Transaction is readonly")):this.active?this._locked()?new be(function(g,k){v._blockedFuncs.push([function(){v._promise(r,i,l).then(g,k)},De])}):l?er(function(){var g=new be(function(k,S){v._lock();var N=i(k,S,v);N&&N.then&&N.then(k,S)});return g.finally(function(){return v._unlock()}),g._lib=!0,g}):((d=new be(function(g,k){var S=i(g,k,v);S&&S.then&&S.then(g,k)}))._lib=!0,d):Me(new P.TransactionInactive)},_r.prototype._root=function(){return this.parent?this.parent._root():this},_r.prototype.waitFor=function(r){var i,l=this._root(),d=be.resolve(r),v=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return d}):(l._waitingFor=d,l._waitingQueue=[],i=l.idbtrans.objectStore(l.storeNames[0]),(function g(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(i.get(-1/0).onsuccess=g)})()),l._waitingFor);return new be(function(g,k){d.then(function(S){return l._waitingQueue.push(kt(g.bind(null,S)))},function(S){return l._waitingQueue.push(kt(k.bind(null,S)))}).finally(function(){l._waitingFor===v&&(l._waitingFor=null)})})},_r.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new P.Abort))},_r.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(y(i,r))return i[r];var l=this.schema[r];if(l)return(l=new this.db.Table(r,l,this)).core=this.db.core.table(r),i[r]=l;throw new P.NotFound("Table "+r+" not part of transaction")},_r);function _r(){}function qi(r,i,l,d,v,g,k,S){return{name:r,keyPath:i,unique:l,multi:d,auto:v,compound:g,src:(l&&!k?"&":"")+(d?"*":"")+(v?"++":"")+Dl(i),type:S}}function Dl(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Bi(r,i,l){return{name:r,primKey:i,indexes:l,mappedClass:null,idxByName:(d=function(v){return[v.name,v]},l.reduce(function(v,g,k){return g=d(g,k),g&&(v[g[0]]=g[1]),v},{}))};var d}var is=function(r){try{return r.only([[]]),is=function(){return[[]]},[[]]}catch{return is=function(){return ht},ht}};function Fi(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(l){return l[i]}:function(l){return se(l,i)}:function(l){return se(l,r)};var i}function jl(r){return[].slice.call(r)}var Ld=0;function os(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Nd(r,i,N){function d(B){if(B.type===3)return null;if(B.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var D=B.lower,z=B.upper,K=B.lowerOpen,B=B.upperOpen;return D===void 0?z===void 0?null:i.upperBound(z,!!B):z===void 0?i.lowerBound(D,!!K):i.bound(D,z,!!K,!!B)}function v(q){var D,z=q.name;return{name:z,schema:q,mutate:function(K){var B=K.trans,L=K.type,J=K.keys,ae=K.values,Q=K.range;return new Promise(function(we,Ee){we=kt(we);var je=B.objectStore(z),Le=je.keyPath==null,Ae=L==="put"||L==="add";if(!Ae&&L!=="delete"&&L!=="deleteRange")throw new Error("Invalid operation type: "+L);var Fe,qe=(J||ae||{length:1}).length;if(J&&ae&&J.length!==ae.length)throw new Error("Given keys array must have same length as given values array.");if(qe===0)return we({numFailures:0,failures:{},results:[],lastResult:void 0});function Re(Wt){++gt,as(Wt)}var ze=[],ft=[],gt=0;if(L==="deleteRange"){if(Q.type===4)return we({numFailures:gt,failures:ft,results:[],lastResult:void 0});Q.type===3?ze.push(Fe=je.clear()):ze.push(Fe=je.delete(d(Q)))}else{var Le=Ae?Le?[ae,J]:[ae,null]:[J,null],He=Le[0],tt=Le[1];if(Ae)for(var zt=0;zt<qe;++zt)ze.push(Fe=tt&&tt[zt]!==void 0?je[L](He[zt],tt[zt]):je[L](He[zt])),Fe.onerror=Re;else for(zt=0;zt<qe;++zt)ze.push(Fe=je[L](He[zt])),Fe.onerror=Re}function Gn(Wt){Wt=Wt.target.result,ze.forEach(function(sa,ao){return sa.error!=null&&(ft[ao]=sa.error)}),we({numFailures:gt,failures:ft,results:L==="delete"?J:ze.map(function(sa){return sa.result}),lastResult:Wt})}Fe.onerror=function(Wt){Re(Wt),Gn(Wt)},Fe.onsuccess=Gn})},getMany:function(K){var B=K.trans,L=K.keys;return new Promise(function(J,ae){J=kt(J);for(var Q,we=B.objectStore(z),Ee=L.length,je=new Array(Ee),Le=0,Ae=0,Fe=function(ze){ze=ze.target,je[ze._pos]=ze.result,++Ae===Le&&J(je)},qe=gr(ae),Re=0;Re<Ee;++Re)L[Re]!=null&&((Q=we.get(L[Re]))._pos=Re,Q.onsuccess=Fe,Q.onerror=qe,++Le);Le===0&&J(je)})},get:function(K){var B=K.trans,L=K.key;return new Promise(function(J,ae){J=kt(J);var Q=B.objectStore(z).get(L);Q.onsuccess=function(we){return J(we.target.result)},Q.onerror=gr(ae)})},query:(D=S,function(K){return new Promise(function(B,L){B=kt(B);var J,ae,Q,Ae=K.trans,we=K.values,Ee=K.limit,Le=K.query,je=Ee===1/0?void 0:Ee,Fe=Le.index,Le=Le.range,Ae=Ae.objectStore(z),Ae=Fe.isPrimaryKey?Ae:Ae.index(Fe.name),Fe=d(Le);if(Ee===0)return B({result:[]});D?((Le=we?Ae.getAll(Fe,je):Ae.getAllKeys(Fe,je)).onsuccess=function(qe){return B({result:qe.target.result})},Le.onerror=gr(L)):(J=0,ae=!we&&"openKeyCursor"in Ae?Ae.openKeyCursor(Fe):Ae.openCursor(Fe),Q=[],ae.onsuccess=function(qe){var Re=ae.result;return!Re||(Q.push(we?Re.value:Re.primaryKey),++J===Ee)?B({result:Q}):void Re.continue()},ae.onerror=gr(L))})}),openCursor:function(K){var B=K.trans,L=K.values,J=K.query,ae=K.reverse,Q=K.unique;return new Promise(function(we,Ee){we=kt(we);var Ae=J.index,je=J.range,Le=B.objectStore(z),Le=Ae.isPrimaryKey?Le:Le.index(Ae.name),Ae=ae?Q?"prevunique":"prev":Q?"nextunique":"next",Fe=!L&&"openKeyCursor"in Le?Le.openKeyCursor(d(je),Ae):Le.openCursor(d(je),Ae);Fe.onerror=gr(Ee),Fe.onsuccess=kt(function(qe){var Re,ze,ft,gt,He=Fe.result;He?(He.___id=++Ld,He.done=!1,Re=He.continue.bind(He),ze=(ze=He.continuePrimaryKey)&&ze.bind(He),ft=He.advance.bind(He),gt=function(){throw new Error("Cursor not stopped")},He.trans=B,He.stop=He.continue=He.continuePrimaryKey=He.advance=function(){throw new Error("Cursor not started")},He.fail=kt(Ee),He.next=function(){var tt=this,zt=1;return this.start(function(){return zt--?tt.continue():tt.stop()}).then(function(){return tt})},He.start=function(tt){function zt(){if(Fe.result)try{tt()}catch(Wt){He.fail(Wt)}else He.done=!0,He.start=function(){throw new Error("Cursor behind last entry")},He.stop()}var Gn=new Promise(function(Wt,sa){Wt=kt(Wt),Fe.onerror=gr(sa),He.fail=sa,He.stop=function(ao){He.stop=He.continue=He.continuePrimaryKey=He.advance=gt,Wt(ao)}});return Fe.onsuccess=kt(function(Wt){Fe.onsuccess=zt,zt()}),He.continue=Re,He.continuePrimaryKey=ze,He.advance=ft,zt(),Gn},we(He)):we(null)},Ee)})},count:function(K){var B=K.query,L=K.trans,J=B.index,ae=B.range;return new Promise(function(Q,we){var Ee=L.objectStore(z),Ee=J.isPrimaryKey?Ee:Ee.index(J.name),je=d(ae),je=je?Ee.count(je):Ee.count();je.onsuccess=kt(function(Le){return Q(Le.target.result)}),je.onerror=gr(we)})}}}g=N,k=jl((N=r).objectStoreNames);var g,N={schema:{name:N.name,tables:k.map(function(q){return g.objectStore(q)}).map(function(q){var D=q.keyPath,z=q.autoIncrement,B=f(D),K={},B={name:q.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:D==null,compound:B,keyPath:D,autoIncrement:z,unique:!0,extractKey:Fi(D)},indexes:jl(q.indexNames).map(function(L){return q.index(L)}).map(function(Q){var we=Q.name,J=Q.unique,ae=Q.multiEntry,Q=Q.keyPath,we={name:we,compound:f(Q),keyPath:Q,unique:J,multiEntry:ae,extractKey:Fi(Q)};return K[os(Q)]=we}),getIndexByKeyPath:function(L){return K[os(L)]}};return K[":id"]=B.primaryKey,D!=null&&(K[os(D)]=B.primaryKey),B})},hasGetAll:0<k.length&&"getAll"in g.objectStore(k[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},k=N.schema,S=N.hasGetAll,N=k.tables.map(v),X={};return N.forEach(function(q){return X[q.name]=q}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(q){if(X[q])return X[q];throw new Error("Table '".concat(q,"' not found"))},MIN_KEY:-1/0,MAX_KEY:is(i),schema:k}}function qd(r,i,l,d){return l=l.IDBKeyRange,i=Nd(i,l,d),{dbcore:r.dbcore.reduce(function(v,g){return g=g.create,a(a({},v),g(v))},i)}}function Vs(r,i){var l=i.db,l=qd(r._middlewares,l,r._deps,i);r.core=l.dbcore,r.tables.forEach(function(d){var v=d.name;r.core.schema.tables.some(function(g){return g.name===v})&&(d.core=r.core.table(v),r[v]instanceof r.Table)&&(r[v].core=d.core)})}function Ys(r,i,l,d){l.forEach(function(v){var g=d[v];i.forEach(function(k){var S=(function N(X,q){return M(X,q)||(X=h(X))&&N(X,q)})(k,v);(!S||"value"in S&&S.value===void 0)&&(k===r.Transaction.prototype||k instanceof r.Transaction?O(k,v,{get:function(){return this.table(v)},set:function(N){x(this,v,{value:N,writable:!0,configurable:!0,enumerable:!0})}}):k[v]=new r.Table(v,g))})})}function zi(r,i){i.forEach(function(l){for(var d in l)l[d]instanceof r.Table&&delete l[d]})}function Bd(r,i){return r._cfg.version-i._cfg.version}function Fd(r,i,l,d){var v=r._dbSchema,g=(l.objectStoreNames.contains("$meta")&&!v.$meta&&(v.$meta=Bi("$meta",Nl("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,v)),k=(g.create(l),g._completion.catch(d),g._reject.bind(g)),S=De.transless||De;er(function(){if(De.trans=g,De.transless=S,i!==0)return Vs(r,l),X=i,((N=g).storeNames.includes("$meta")?N.table("$meta").get("version").then(function(q){return q??X}):be.resolve(X)).then(function(J){var D=r,z=J,K=g,B=l,L=[],J=D._versions,ae=D._dbSchema=Xs(0,D.idbdb,B);return(J=J.filter(function(Q){return Q._cfg.version>=z})).length===0?be.resolve():(J.forEach(function(Q){L.push(function(){var we,Ee,je,Le=ae,Ae=Q._cfg.dbschema,Fe=(Zs(D,Le,B),Zs(D,Ae,B),ae=D._dbSchema=Ae,Ui(Le,Ae)),qe=(Fe.add.forEach(function(Re){Ki(B,Re[0],Re[1].primKey,Re[1].indexes)}),Fe.change.forEach(function(Re){if(Re.recreate)throw new P.Upgrade("Not yet support for changing primary key");var ze=B.objectStore(Re.name);Re.add.forEach(function(ft){return Qs(ze,ft)}),Re.change.forEach(function(ft){ze.deleteIndex(ft.name),Qs(ze,ft)}),Re.del.forEach(function(ft){return ze.deleteIndex(ft)})}),Q._cfg.contentUpgrade);if(qe&&Q._cfg.version>z)return Vs(D,B),K._memoizedTables={},we=me(Ae),Fe.del.forEach(function(Re){we[Re]=Le[Re]}),zi(D,[D.Transaction.prototype]),Ys(D,[D.Transaction.prototype],c(we),we),K.schema=we,(Ee=ce(qe))&&fn(),Ae=be.follow(function(){var Re;(je=qe(K))&&Ee&&(Re=tr.bind(null,null),je.then(Re,Re))}),je&&typeof je.then=="function"?be.resolve(je):Ae.then(function(){return je})}),L.push(function(we){var Ee,je,Le=Q._cfg.dbschema;Ee=Le,je=we,[].slice.call(je.db.objectStoreNames).forEach(function(Ae){return Ee[Ae]==null&&je.db.deleteObjectStore(Ae)}),zi(D,[D.Transaction.prototype]),Ys(D,[D.Transaction.prototype],D._storeNames,D._dbSchema),K.schema=D._dbSchema}),L.push(function(we){D.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(D.idbdb.version/10)===Q._cfg.version?(D.idbdb.deleteObjectStore("$meta"),delete D._dbSchema.$meta,D._storeNames=D._storeNames.filter(function(Ee){return Ee!=="$meta"})):we.objectStore("$meta").put(Q._cfg.version,"version"))})}),(function Q(){return L.length?be.resolve(L.shift()(K.idbtrans)).then(Q):be.resolve()})().then(function(){Ll(ae,B)}))}).catch(k);var N,X;c(v).forEach(function(q){Ki(l,q,v[q].primKey,v[q].indexes)}),Vs(r,l),be.follow(function(){return r.on.populate.fire(g)}).catch(k)})}function zd(r,i){Ll(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var l=Xs(0,r.idbdb,i);Zs(r,r._dbSchema,i);for(var d=0,v=Ui(l,r._dbSchema).change;d<v.length;d++){var g=(k=>{if(k.change.length||k.recreate)return console.warn("Unable to patch indexes of table ".concat(k.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=i.objectStore(k.name);k.add.forEach(function(N){We&&console.debug("Dexie upgrade patch: Creating missing index ".concat(k.name,".").concat(N.src)),Qs(S,N)})})(v[d]);if(typeof g=="object")return g.value}}function Ui(r,i){var l,d={del:[],add:[],change:[]};for(l in r)i[l]||d.del.push(l);for(l in i){var v=r[l],g=i[l];if(v){var k={name:l,def:g,recreate:!1,del:[],add:[],change:[]};if(""+(v.primKey.keyPath||"")!=""+(g.primKey.keyPath||"")||v.primKey.auto!==g.primKey.auto)k.recreate=!0,d.change.push(k);else{var S=v.idxByName,N=g.idxByName,X=void 0;for(X in S)N[X]||k.del.push(X);for(X in N){var q=S[X],D=N[X];q?q.src!==D.src&&k.change.push(D):k.add.push(D)}(0<k.del.length||0<k.add.length||0<k.change.length)&&d.change.push(k)}}else d.add.push([l,g])}return d}function Ki(r,i,l,d){var v=r.db.createObjectStore(i,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});d.forEach(function(g){return Qs(v,g)})}function Ll(r,i){c(r).forEach(function(l){i.db.objectStoreNames.contains(l)||(We&&console.debug("Dexie: Creating missing table",l),Ki(i,l,r[l].primKey,r[l].indexes))})}function Qs(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function Xs(r,i,l){var d={};return ee(i.objectStoreNames,0).forEach(function(v){for(var g=l.objectStore(v),k=qi(Dl(X=g.keyPath),X||"",!0,!1,!!g.autoIncrement,X&&typeof X!="string",!0),S=[],N=0;N<g.indexNames.length;++N){var q=g.index(g.indexNames[N]),X=q.keyPath,q=qi(q.name,X,!!q.unique,!!q.multiEntry,!1,X&&typeof X!="string",!1);S.push(q)}d[v]=Bi(v,k,S)}),d}function Zs(r,i,l){for(var d=l.db.objectStoreNames,v=0;v<d.length;++v){var g=d[v],k=l.objectStore(g);r._hasGetAll="getAll"in k;for(var S=0;S<k.indexNames.length;++S){var N,X=k.indexNames[S],q=k.index(X).keyPath,q=typeof q=="string"?q:"["+ee(q).join("+")+"]";i[g]&&(N=i[g].idxByName[q])&&(N.name=X,delete i[g].idxByName[q],i[g].idxByName[X]=N)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Nl(r){return r.split(",").map(function(i,l){var v=i.split(":"),d=(d=v[1])==null?void 0:d.trim(),v=(i=v[0].trim()).replace(/([&*]|\+\+)/g,""),g=/^\[/.test(v)?v.match(/^\[(.*)\]$/)[1].split("+"):v;return qi(v,g||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),f(g),l===0,d)})}Pa.prototype._createTableSchema=Bi,Pa.prototype._parseIndexSyntax=Nl,Pa.prototype._parseStoresSpec=function(r,i){var l=this;c(r).forEach(function(d){if(r[d]!==null){var v=l._parseIndexSyntax(r[d]),g=v.shift();if(!g)throw new P.Schema("Invalid schema for table "+d+": "+r[d]);if(g.unique=!0,g.multi)throw new P.Schema("Primary key cannot be multiEntry*");v.forEach(function(k){if(k.auto)throw new P.Schema("Only primary key can be marked as autoIncrement (++)");if(!k.keyPath)throw new P.Schema("Index must have a name and cannot be an empty string")}),g=l._createTableSchema(d,g,v),i[d]=g}})},Pa.prototype.stores=function(l){var i=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?m(this._cfg.storesSource,l):l,i._versions),d={},v={};return l.forEach(function(g){m(d,g._cfg.storesSource),v=g._cfg.dbschema={},g._parseStoresSpec(d,v)}),i._dbSchema=v,zi(i,[i._allTables,i,i.Transaction.prototype]),Ys(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],c(v),v),i._storeNames=c(v),this},Pa.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Be(this._cfg.contentUpgrade||xe,r),this};var Ud=Pa;function Pa(){}function Gi(r,i){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new Ar(xn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Wi(r){return r&&typeof r.databases=="function"}function Hi(r){return er(function(){return De.letThrough=!0,r()})}function Vi(r){return!("from"in r)}var vn=function(r,i){var l;if(!this)return l=new vn,r&&"d"in r&&m(l,r),l;m(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function ls(r,i,l){var d=ct(i,l);if(!isNaN(d)){if(0<d)throw RangeError();if(Vi(r))return m(r,{from:i,to:l,d:1});var d=r.l,v=r.r;if(ct(l,r.from)<0)return d?ls(d,i,l):r.l={from:i,to:l,d:1,l:null,r:null},Bl(r);if(0<ct(i,r.to))return v?ls(v,i,l):r.r={from:i,to:l,d:1,l:null,r:null},Bl(r);ct(i,r.from)<0&&(r.from=i,r.l=null,r.d=v?v.d+1:1),0<ct(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),i=!r.r,d&&!r.l&&cs(r,d),v&&i&&cs(r,v)}}function cs(r,i){Vi(i)||(function l(d,v){var g=v.from,k=v.l,S=v.r;ls(d,g,v.to),k&&l(d,k),S&&l(d,S)})(r,i)}function ql(r,i){var l=Js(i),d=l.next();if(!d.done)for(var v=d.value,g=Js(r),k=g.next(v.from),S=k.value;!d.done&&!k.done;){if(ct(S.from,v.to)<=0&&0<=ct(S.to,v.from))return!0;ct(v.from,S.from)<0?v=(d=l.next(S.from)).value:S=(k=g.next(v.from)).value}return!1}function Js(r){var i=Vi(r)?null:{s:0,n:r};return{next:function(l){for(var d=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,d)for(;i.n.l&&ct(l,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!d||ct(l,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Bl(r){var i,l,d,v=(((v=r.r)==null?void 0:v.d)||0)-(((v=r.l)==null?void 0:v.d)||0),v=1<v?"r":v<-1?"l":"";v&&(i=v=="r"?"l":"r",l=a({},r),d=r[v],r.from=d.from,r.to=d.to,r[v]=d[v],l[v]=d[i],(r[i]=l).d=Fl(l)),r.d=Fl(r)}function Fl(l){var i=l.r,l=l.l;return(i?l?Math.max(i.d,l.d):i.d:l?l.d:0)+1}function $s(r,i){return c(i).forEach(function(l){r[l]?cs(r[l],i[l]):r[l]=(function d(v){var g,k,S={};for(g in v)y(v,g)&&(k=v[g],S[g]=!k||typeof k!="object"||pe.has(k.constructor)?k:d(k));return S})(i[l])}),r}function Yi(r,i){return r.all||i.all||Object.keys(r).some(function(l){return i[l]&&ql(i[l],r[l])})}w(vn.prototype,((Je={add:function(r){return cs(this,r),this},addKey:function(r){return ls(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(l){return ls(i,l,l)}),this},hasKey:function(r){var i=Js(this).next(r).value;return i&&ct(i.from,r)<=0&&0<=ct(i.to,r)}})[he]=function(){return Js(this)},Je));var ra={},Qi={},Xi=!1;function ei(r){$s(Qi,r),Xi||(Xi=!0,setTimeout(function(){Xi=!1,Zi(Qi,!(Qi={}))},0))}function Zi(r,i){i===void 0&&(i=!1);var l=new Set;if(r.all)for(var d=0,v=Object.values(ra);d<v.length;d++)zl(S=v[d],r,l,i);else for(var g in r){var k,S,g=/^idb\:\/\/(.*)\/(.*)\//.exec(g);g&&(k=g[1],g=g[2],S=ra["idb://".concat(k,"/").concat(g)])&&zl(S,r,l,i)}l.forEach(function(N){return N()})}function zl(r,i,l,d){for(var v=[],g=0,k=Object.entries(r.queries.query);g<k.length;g++){for(var S=k[g],N=S[0],X=[],q=0,D=S[1];q<D.length;q++){var z=D[q];Yi(i,z.obsSet)?z.subscribers.forEach(function(J){return l.add(J)}):d&&X.push(z)}d&&v.push([N,X])}if(d)for(var K=0,B=v;K<B.length;K++){var L=B[K],N=L[0],X=L[1];r.queries.query[N]=X}}function Kd(r){var i=r._state,l=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Me(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var d=i.openCanceller,v=Math.round(10*r.verno),g=!1;function k(){if(i.openCanceller!==d)throw new P.DatabaseClosed("db.open() was cancelled")}function S(){return new be(function(z,K){if(k(),!l)throw new P.MissingAPI;var B=r.name,L=i.autoSchema||!v?l.open(B):l.open(B,v);if(!L)throw new P.MissingAPI;L.onerror=gr(K),L.onblocked=kt(r._fireOnBlocked),L.onupgradeneeded=kt(function(J){var ae;q=L.transaction,i.autoSchema&&!r._options.allowEmptyDB?(L.onerror=as,q.abort(),L.result.close(),(ae=l.deleteDatabase(B)).onsuccess=ae.onerror=kt(function(){K(new P.NoSuchDatabase("Database ".concat(B," doesnt exist")))})):(q.onerror=gr(K),ae=J.oldVersion>Math.pow(2,62)?0:J.oldVersion,D=ae<1,r.idbdb=L.result,g&&zd(r,q),Fd(r,ae/10,q,K))},K),L.onsuccess=kt(function(){q=null;var J,ae,Q,we,Ee,je,Le=r.idbdb=L.result,Ae=ee(Le.objectStoreNames);if(0<Ae.length)try{var Fe=Le.transaction((Ee=Ae).length===1?Ee[0]:Ee,"readonly");if(i.autoSchema)je=Le,we=Fe,(Q=r).verno=je.version/10,we=Q._dbSchema=Xs(0,je,we),Q._storeNames=ee(je.objectStoreNames,0),Ys(Q,[Q._allTables],c(we),we);else if(Zs(r,r._dbSchema,Fe),ae=Fe,((ae=Ui(Xs(0,(J=r).idbdb,ae),J._dbSchema)).add.length||ae.change.some(function(qe){return qe.add.length||qe.change.length}))&&!g)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Le.close(),v=Le.version+1,g=!0,z(S());Vs(r,Fe)}catch{}Ht.push(r),Le.onversionchange=kt(function(qe){i.vcFired=!0,r.on("versionchange").fire(qe)}),Le.onclose=kt(function(){r.close({disableAutoOpen:!1})}),D&&(Ae=r._deps,Ee=B,Wi(je=Ae.indexedDB)||Ee===xn||Gi(je,Ae.IDBKeyRange).put({name:Ee}).catch(xe)),z()},K)}).catch(function(z){switch(z==null?void 0:z.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<v)return v=0,S()}return be.reject(z)})}var N,X=i.dbReadyResolve,q=null,D=!1;return be.race([d,(typeof navigator>"u"?be.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(z){function K(){return indexedDB.databases().finally(z)}N=setInterval(K,100),K()}).finally(function(){return clearInterval(N)}):Promise.resolve()).then(S)]).then(function(){return k(),i.onReadyBeingFired=[],be.resolve(Hi(function(){return r.on.ready.fire(r.vip)})).then(function z(){var K;if(0<i.onReadyBeingFired.length)return K=i.onReadyBeingFired.reduce(Be,xe),i.onReadyBeingFired=[],be.resolve(Hi(function(){return K(r.vip)})).then(z)})}).finally(function(){i.openCanceller===d&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(z){i.dbOpenError=z;try{q&&q.abort()}catch{}return d===i.openCanceller&&r._close(),Me(z)}).finally(function(){i.openComplete=!0,X()}).then(function(){var z;return D&&(z={},r.tables.forEach(function(K){K.schema.indexes.forEach(function(B){B.name&&(z["idb://".concat(r.name,"/").concat(K.name,"/").concat(B.name)]=new vn(-1/0,[[[]]]))}),z["idb://".concat(r.name,"/").concat(K.name,"/")]=z["idb://".concat(r.name,"/").concat(K.name,"/:dels")]=new vn(-1/0,[[[]]])}),Fr(ss).fire(z),Zi(z,!0)),r})}function Ji(r){function i(g){return r.next(g)}var l=v(i),d=v(function(g){return r.throw(g)});function v(g){return function(S){var S=g(S),N=S.value;return S.done?N:N&&typeof N.then=="function"?N.then(l,d):f(N)?Promise.all(N).then(l,d):l(N)}}return v(i)()}function ti(r,i,l){for(var d=f(r)?r.slice():[r],v=0;v<l;++v)d.push(i);return d}var Gd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(d){var l=r.table(d),d=l.schema,v={},g=[];function k(z,K,B){var Q=os(z),L=v[Q]=v[Q]||[],J=z==null?0:typeof z=="string"?1:z.length,ae=0<K,Q=a(a({},B),{name:ae?"".concat(Q,"(virtual-from:").concat(B.name,")"):B.name,lowLevelIndex:B,isVirtual:ae,keyTail:K,keyLength:J,extractKey:Fi(z),unique:!ae&&B.unique});return L.push(Q),Q.isPrimaryKey||g.push(Q),1<J&&k(J===2?z[0]:z.slice(0,J-1),K+1,B),L.sort(function(we,Ee){return we.keyTail-Ee.keyTail}),Q}var S=k(d.primaryKey.keyPath,0,d.primaryKey);v[":id"]=[S];for(var N=0,X=d.indexes;N<X.length;N++){var q=X[N];k(q.keyPath,0,q)}function D(z){var K,B=z.query.index;return B.isVirtual?a(a({},z),{query:{index:B.lowLevelIndex,range:(K=z.query.range,B=B.keyTail,{type:K.type===1?2:K.type,lower:ti(K.lower,K.lowerOpen?r.MAX_KEY:r.MIN_KEY,B),lowerOpen:!0,upper:ti(K.upper,K.upperOpen?r.MIN_KEY:r.MAX_KEY,B),upperOpen:!0})}}):z}return a(a({},l),{schema:a(a({},d),{primaryKey:S,indexes:g,getIndexByKeyPath:function(z){return(z=v[os(z)])&&z[0]}}),count:function(z){return l.count(D(z))},query:function(z){return l.query(D(z))},openCursor:function(z){var K=z.query.index,B=K.keyTail,L=K.keyLength;return K.isVirtual?l.openCursor(D(z)).then(function(ae){return ae&&J(ae)}):l.openCursor(z);function J(ae){return Object.create(ae,{continue:{value:function(Q){Q!=null?ae.continue(ti(Q,z.reverse?r.MAX_KEY:r.MIN_KEY,B)):z.unique?ae.continue(ae.key.slice(0,L).concat(z.reverse?r.MIN_KEY:r.MAX_KEY,B)):ae.continue()}},continuePrimaryKey:{value:function(Q,we){ae.continuePrimaryKey(ti(Q,r.MAX_KEY,B),we)}},primaryKey:{get:function(){return ae.primaryKey}},key:{get:function(){var Q=ae.key;return L===1?Q[0]:Q.slice(0,L)}},value:{get:function(){return ae.value}}})}}})}})}};function $i(r,i,l,d){return l=l||{},d=d||"",c(r).forEach(function(v){var g,k,S;y(i,v)?(g=r[v],k=i[v],typeof g=="object"&&typeof k=="object"&&g&&k?(S=ue(g))!==ue(k)?l[d+v]=i[v]:S==="Object"?$i(g,k,l,d+v+"."):g!==k&&(l[d+v]=i[v]):g!==k&&(l[d+v]=i[v])):l[d+v]=void 0}),c(i).forEach(function(v){y(r,v)||(l[d+v]=i[v])}),l}function eo(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var Wd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(i){var l=r.table(i),d=l.schema.primaryKey;return a(a({},l),{mutate:function(v){var g=De.trans,k=g.table(i).hook,S=k.deleting,N=k.creating,X=k.updating;switch(v.type){case"add":if(N.fire===xe)break;return g._promise("readwrite",function(){return q(v)},!0);case"put":if(N.fire===xe&&X.fire===xe)break;return g._promise("readwrite",function(){return q(v)},!0);case"delete":if(S.fire===xe)break;return g._promise("readwrite",function(){return q(v)},!0);case"deleteRange":if(S.fire===xe)break;return g._promise("readwrite",function(){return(function D(z,K,B){return l.query({trans:z,values:!1,query:{index:d,range:K},limit:B}).then(function(L){var J=L.result;return q({type:"delete",keys:J,trans:z}).then(function(ae){return 0<ae.numFailures?Promise.reject(ae.failures[0]):J.length<B?{failures:[],numFailures:0,lastResult:void 0}:D(z,a(a({},K),{lower:J[J.length-1],lowerOpen:!0}),B)})})})(v.trans,v.range,1e4)},!0)}return l.mutate(v);function q(D){var z,K,B,L=De.trans,J=D.keys||eo(d,D);if(J)return(D=D.type==="add"||D.type==="put"?a(a({},D),{keys:J}):a({},D)).type!=="delete"&&(D.values=s([],D.values)),D.keys&&(D.keys=s([],D.keys)),z=l,B=J,((K=D).type==="add"?Promise.resolve([]):z.getMany({trans:K.trans,keys:B,cache:"immutable"})).then(function(ae){var Q=J.map(function(we,Ee){var je,Le,Ae,Fe=ae[Ee],qe={onerror:null,onsuccess:null};return D.type==="delete"?S.fire.call(qe,we,Fe,L):D.type==="add"||Fe===void 0?(je=N.fire.call(qe,we,D.values[Ee],L),we==null&&je!=null&&(D.keys[Ee]=we=je,d.outbound||G(D.values[Ee],d.keyPath,we))):(je=$i(Fe,D.values[Ee]),(Le=X.fire.call(qe,je,we,Fe,L))&&(Ae=D.values[Ee],Object.keys(Le).forEach(function(Re){y(Ae,Re)?Ae[Re]=Le[Re]:G(Ae,Re,Le[Re])}))),qe});return l.mutate(D).then(function(we){for(var Ee=we.failures,je=we.results,Le=we.numFailures,we=we.lastResult,Ae=0;Ae<J.length;++Ae){var Fe=(je||J)[Ae],qe=Q[Ae];Fe==null?qe.onerror&&qe.onerror(Ee[Ae]):qe.onsuccess&&qe.onsuccess(D.type==="put"&&ae[Ae]?D.values[Ae]:Fe)}return{failures:Ee,results:je,numFailures:Le,lastResult:we}}).catch(function(we){return Q.forEach(function(Ee){return Ee.onerror&&Ee.onerror(we)}),Promise.reject(we)})});throw new Error("Keys missing")}}})}})}};function Ul(r,i,l){try{if(!i||i.keys.length<r.length)return null;for(var d=[],v=0,g=0;v<i.keys.length&&g<r.length;++v)ct(i.keys[v],r[g])===0&&(d.push(l?_e(i.values[v]):i.values[v]),++g);return d.length===r.length?d:null}catch{return null}}var Hd={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var l=r.table(i);return a(a({},l),{getMany:function(d){var v;return d.cache?(v=Ul(d.keys,d.trans._cache,d.cache==="clone"))?be.resolve(v):l.getMany(d).then(function(g){return d.trans._cache={keys:d.keys,values:d.cache==="clone"?_e(g):g},g}):l.getMany(d)},mutate:function(d){return d.type!=="add"&&(d.trans._cache=null),l.mutate(d)}})}}}};function Kl(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Gl(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Vd={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,l=new vn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(d,v,g){if(De.subscr&&v!=="readonly")throw new P.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(De.querier));return r.transaction(d,v,g)},table:function(d){function v(J){var L,J=J.query;return[L=J.index,new vn((L=(J=J.range).lower)!=null?L:r.MIN_KEY,(L=J.upper)!=null?L:r.MAX_KEY)]}var g=r.table(d),k=g.schema,S=k.primaryKey,N=k.indexes,X=S.extractKey,q=S.outbound,D=S.autoIncrement&&N.filter(function(B){return B.compound&&B.keyPath.includes(S.keyPath)}),z=a(a({},g),{mutate:function(B){function L(ze){return ze="idb://".concat(i,"/").concat(d,"/").concat(ze),Ee[ze]||(Ee[ze]=new vn)}var J,ae,Q,we=B.trans,Ee=B.mutatedParts||(B.mutatedParts={}),je=L(""),Le=L(":dels"),Ae=B.type,qe=B.type==="deleteRange"?[B.range]:B.type==="delete"?[B.keys]:B.values.length<50?[eo(S,B).filter(function(ze){return ze}),B.values]:[],Fe=qe[0],qe=qe[1],Re=B.trans._cache;return f(Fe)?(je.addKeys(Fe),(Ae=Ae==="delete"||Fe.length===qe.length?Ul(Fe,Re):null)||Le.addKeys(Fe),(Ae||qe)&&(J=L,ae=Ae,Q=qe,k.indexes.forEach(function(ze){var ft=J(ze.name||"");function gt(tt){return tt!=null?ze.extractKey(tt):null}function He(tt){ze.multiEntry&&f(tt)?tt.forEach(function(zt){return ft.addKey(zt)}):ft.addKey(tt)}(ae||Q).forEach(function(tt,Wt){var Gn=ae&&gt(ae[Wt]),Wt=Q&&gt(Q[Wt]);ct(Gn,Wt)!==0&&(Gn!=null&&He(Gn),Wt!=null)&&He(Wt)})}))):Fe?(qe={from:(Re=Fe.lower)!=null?Re:r.MIN_KEY,to:(Ae=Fe.upper)!=null?Ae:r.MAX_KEY},Le.add(qe),je.add(qe)):(je.add(l),Le.add(l),k.indexes.forEach(function(ze){return L(ze.name).add(l)})),g.mutate(B).then(function(ze){return!Fe||B.type!=="add"&&B.type!=="put"||(je.addKeys(ze.results),D&&D.forEach(function(ft){for(var gt=B.values.map(function(Gn){return ft.extractKey(Gn)}),He=ft.keyPath.findIndex(function(Gn){return Gn===S.keyPath}),tt=0,zt=ze.results.length;tt<zt;++tt)gt[tt][He]=ze.results[tt];L(ft.name).addKeys(gt)})),we.mutatedParts=$s(we.mutatedParts||{},Ee),ze})}}),K={get:function(B){return[S,new vn(B.key)]},getMany:function(B){return[S,new vn().addKeys(B.keys)]},count:v,query:v,openCursor:v};return c(K).forEach(function(B){z[B]=function(L){var J=De.subscr,ae=!!J,Q=Kl(De,g)&&Gl(B,L)?L.obsSet={}:J;if(ae){var we,J=function(qe){return qe="idb://".concat(i,"/").concat(d,"/").concat(qe),Q[qe]||(Q[qe]=new vn)},Ee=J(""),je=J(":dels"),ae=K[B](L),Le=ae[0],ae=ae[1];if((B==="query"&&Le.isPrimaryKey&&!L.values?je:J(Le.name||"")).add(ae),!Le.isPrimaryKey){if(B!=="count")return we=B==="query"&&q&&L.values&&g.query(a(a({},L),{values:!1})),g[B].apply(this,arguments).then(function(qe){if(B==="query"){if(q&&L.values)return we.then(function(gt){return gt=gt.result,Ee.addKeys(gt),qe});var Re=L.values?qe.result.map(X):qe.result;(L.values?Ee:je).addKeys(Re)}else{var ze,ft;if(B==="openCursor")return ft=L.values,(ze=qe)&&Object.create(ze,{key:{get:function(){return je.addKey(ze.primaryKey),ze.key}},primaryKey:{get:function(){var gt=ze.primaryKey;return je.addKey(gt),gt}},value:{get:function(){return ft&&Ee.addKey(ze.primaryKey),ze.value}}})}return qe});je.add(l)}}return g[B].apply(this,arguments)}}),z}})}};function Wl(r,i,l){var d;return l.numFailures===0?i:i.type==="deleteRange"||(d=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,l.numFailures===d)?null:(d=a({},i),f(d.keys)&&(d.keys=d.keys.filter(function(v,g){return!(g in l.failures)})),"values"in d&&f(d.values)&&(d.values=d.values.filter(function(v,g){return!(g in l.failures)})),d)}function to(r,i){return l=r,((d=i).lower===void 0||(d.lowerOpen?0<ct(l,d.lower):0<=ct(l,d.lower)))&&(l=r,(d=i).upper===void 0||(d.upperOpen?ct(l,d.upper)<0:ct(l,d.upper)<=0));var l,d}function Hl(r,i,l,d,v,g){var k,S,N,X,q,D;return!l||l.length===0||(k=i.query.index,S=k.multiEntry,N=i.query.range,X=d.schema.primaryKey.extractKey,q=k.extractKey,D=(k.lowLevelIndex||k).extractKey,(d=l.reduce(function(z,K){var B=z,L=[];if(K.type==="add"||K.type==="put")for(var J=new vn,ae=K.values.length-1;0<=ae;--ae){var Q,we=K.values[ae],Ee=X(we);!J.hasKey(Ee)&&(Q=q(we),S&&f(Q)?Q.some(function(qe){return to(qe,N)}):to(Q,N))&&(J.addKey(Ee),L.push(we))}switch(K.type){case"add":var je=new vn().addKeys(i.values?z.map(function(Re){return X(Re)}):z),B=z.concat(i.values?L.filter(function(Re){return Re=X(Re),!je.hasKey(Re)&&(je.addKey(Re),!0)}):L.map(function(Re){return X(Re)}).filter(function(Re){return!je.hasKey(Re)&&(je.addKey(Re),!0)}));break;case"put":var Le=new vn().addKeys(K.values.map(function(Re){return X(Re)}));B=z.filter(function(Re){return!Le.hasKey(i.values?X(Re):Re)}).concat(i.values?L:L.map(function(Re){return X(Re)}));break;case"delete":var Ae=new vn().addKeys(K.keys);B=z.filter(function(Re){return!Ae.hasKey(i.values?X(Re):Re)});break;case"deleteRange":var Fe=K.range;B=z.filter(function(Re){return!to(X(Re),Fe)})}return B},r))===r)?r:(d.sort(function(z,K){return ct(D(z),D(K))||ct(X(z),X(K))}),i.limit&&i.limit<1/0&&(d.length>i.limit?d.length=i.limit:r.length===i.limit&&d.length<i.limit&&(v.dirty=!0)),g?Object.freeze(d):d)}function Vl(r,i){return ct(r.lower,i.lower)===0&&ct(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function Yd(r,i){return((l,d,v,g)=>{if(l===void 0)return d!==void 0?-1:0;if(d===void 0)return 1;if((l=ct(l,d))===0){if(v&&g)return 0;if(v)return 1;if(g)return-1}return l})(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=((l,d,v,g)=>{if(l===void 0)return d!==void 0?1:0;if(d===void 0)return-1;if((l=ct(l,d))===0){if(v&&g)return 0;if(v)return-1;if(g)return 1}return l})(r.upper,i.upper,r.upperOpen,i.upperOpen)}function Qd(r,i,l,d){r.subscribers.add(l),d.addEventListener("abort",function(){var v,g;r.subscribers.delete(l),r.subscribers.size===0&&(v=r,g=i,setTimeout(function(){v.subscribers.size===0&&oe(g,v)},3e3))})}var Xd={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return a(a({},r),{transaction:function(l,d,v){var g,k,S=r.transaction(l,d,v);return d==="readwrite"&&(v=(g=new AbortController).signal,S.addEventListener("abort",(k=function(N){return function(){if(g.abort(),d==="readwrite"){for(var X=new Set,q=0,D=l;q<D.length;q++){var z=D[q],K=ra["idb://".concat(i,"/").concat(z)];if(K){var B=r.table(z),L=K.optimisticOps.filter(function(ze){return ze.trans===S});if(S._explicit&&N&&S.mutatedParts)for(var J=0,ae=Object.values(K.queries.query);J<ae.length;J++)for(var Q=0,we=(Le=ae[J]).slice();Q<we.length;Q++)Yi((Ae=we[Q]).obsSet,S.mutatedParts)&&(oe(Le,Ae),Ae.subscribers.forEach(function(ze){return X.add(ze)}));else if(0<L.length){K.optimisticOps=K.optimisticOps.filter(function(ze){return ze.trans!==S});for(var Ee=0,je=Object.values(K.queries.query);Ee<je.length;Ee++)for(var Le,Ae,Fe,qe=0,Re=(Le=je[Ee]).slice();qe<Re.length;qe++)(Ae=Re[qe]).res!=null&&S.mutatedParts&&(N&&!Ae.dirty?(Fe=Object.isFrozen(Ae.res),Fe=Hl(Ae.res,Ae.req,L,B,Ae,Fe),Ae.dirty?(oe(Le,Ae),Ae.subscribers.forEach(function(ze){return X.add(ze)})):Fe!==Ae.res&&(Ae.res=Fe,Ae.promise=be.resolve({result:Fe}))):(Ae.dirty&&oe(Le,Ae),Ae.subscribers.forEach(function(ze){return X.add(ze)})))}}}X.forEach(function(ze){return ze()})}}})(!1),{signal:v}),S.addEventListener("error",k(!1),{signal:v}),S.addEventListener("complete",k(!0),{signal:v})),S},table:function(l){var d=r.table(l),v=d.schema.primaryKey;return a(a({},d),{mutate:function(g){var k,S=De.trans;return!v.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(k=ra["idb://".concat(i,"/").concat(l)])?(S=d.mutate(g),g.type!=="add"&&g.type!=="put"||!(50<=g.values.length||eo(v,g).some(function(N){return N==null}))?(k.optimisticOps.push(g),g.mutatedParts&&ei(g.mutatedParts),S.then(function(N){0<N.numFailures&&(oe(k.optimisticOps,g),(N=Wl(0,g,N))&&k.optimisticOps.push(N),g.mutatedParts)&&ei(g.mutatedParts)}),S.catch(function(){oe(k.optimisticOps,g),g.mutatedParts&&ei(g.mutatedParts)})):S.then(function(N){var X=Wl(0,a(a({},g),{values:g.values.map(function(q,D){var z;return N.failures[D]?q:(G(z=(z=v.keyPath)!=null&&z.includes(".")?_e(q):a({},q),v.keyPath,N.results[D]),z)})}),N);k.optimisticOps.push(X),queueMicrotask(function(){return g.mutatedParts&&ei(g.mutatedParts)})}),S):d.mutate(g)},query:function(g){var k,S,N,X,q,D,z;return Kl(De,d)&&Gl("query",g)?(k=((N=De.trans)==null?void 0:N.db._options.cache)==="immutable",S=(N=De).requery,N=N.signal,D=((K,B,L,J)=>{var ae=ra["idb://".concat(K,"/").concat(B)];if(!ae)return[];if(!(K=ae.queries[L]))return[null,!1,ae,null];var Q=K[(J.query?J.query.index.name:null)||""];if(!Q)return[null,!1,ae,null];switch(L){case"query":var we=Q.find(function(Ee){return Ee.req.limit===J.limit&&Ee.req.values===J.values&&Vl(Ee.req.query.range,J.query.range)});return we?[we,!0,ae,Q]:[Q.find(function(Ee){return("limit"in Ee.req?Ee.req.limit:1/0)>=J.limit&&(!J.values||Ee.req.values)&&Yd(Ee.req.query.range,J.query.range)}),!1,ae,Q];case"count":return we=Q.find(function(Ee){return Vl(Ee.req.query.range,J.query.range)}),[we,!!we,ae,Q]}})(i,l,"query",g),z=D[0],X=D[2],q=D[3],z&&D[1]?z.obsSet=g.obsSet:(D=d.query(g).then(function(K){var B=K.result;if(z&&(z.res=B),k){for(var L=0,J=B.length;L<J;++L)Object.freeze(B[L]);Object.freeze(B)}else K.result=_e(B);return K}).catch(function(K){return q&&z&&oe(q,z),Promise.reject(K)}),z={obsSet:g.obsSet,promise:D,subscribers:new Set,type:"query",req:g,dirty:!1},q?q.push(z):(q=[z],(X=X||(ra["idb://".concat(i,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[g.query.index.name||""]=q)),Qd(z,q,S,N),z.promise.then(function(K){return{result:Hl(K.result,g,X==null?void 0:X.optimisticOps,d,z,k)}})):d.query(g)}})}})}};function ni(r,i){return new Proxy(r,{get:function(l,d,v){return d==="db"?i:Reflect.get(l,d,v)}})}Vt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new P.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new P.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,l=i.filter(function(d){return d._cfg.version===r})[0];return l||(l=new this.Version(r),i.push(l),i.sort(Bd),l.stores({}),this._state.autoSchema=!1),l},Vt.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||De.letThrough||this._vip)?r():new be(function(l,d){if(i._state.openComplete)return d(new P.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void d(new P.DatabaseClosed);i.open().catch(xe)}i._state.dbReadyPromise.then(l,d)}).then(r)},Vt.prototype.use=function(v){var i=v.stack,l=v.create,d=v.level,v=v.name,g=(v&&this.unuse({stack:i,name:v}),this._middlewares[i]||(this._middlewares[i]=[]));return g.push({stack:i,create:l,level:d??10,name:v}),g.sort(function(k,S){return k.level-S.level}),this},Vt.prototype.unuse=function(r){var i=r.stack,l=r.name,d=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(v){return d?v.create!==d:!!l&&v.name!==l})),this},Vt.prototype.open=function(){var r=this;return Ke(at,function(){return Kd(r)})},Vt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,i=Ht.indexOf(this);if(0<=i&&Ht.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new be(function(l){r.dbReadyResolve=l}),r.openCanceller=new be(function(l,d){r.cancelOpen=d}))},Vt.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,l=this._state;i?(l.isBeingOpened&&l.cancelOpen(new P.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new P.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Vt.prototype.delete=function(r){var i=this,l=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),d=this._state;return new be(function(v,g){function k(){i.close(r);var S=i._deps.indexedDB.deleteDatabase(i.name);S.onsuccess=kt(function(){var N,X,q;N=i._deps,X=i.name,Wi(q=N.indexedDB)||X===xn||Gi(q,N.IDBKeyRange).delete(X).catch(xe),v()}),S.onerror=gr(g),S.onblocked=i._fireOnBlocked}if(l)throw new P.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(k):k()})},Vt.prototype.backendDB=function(){return this.idbdb},Vt.prototype.isOpen=function(){return this.idbdb!==null},Vt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Vt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Vt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Vt.prototype,"tables",{get:function(){var r=this;return c(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),Vt.prototype.transaction=function(){var r=(function(i,l,d){var v=arguments.length;if(v<2)throw new P.InvalidArgument("Too few arguments");for(var g=new Array(v-1);--v;)g[v-1]=arguments[v];return d=g.pop(),[i,de(g),d]}).apply(this,arguments);return this._transaction.apply(this,r)},Vt.prototype._transaction=function(r,i,l){var d,v,g=this,k=De.trans,S=(k&&k.db===this&&r.indexOf("!")===-1||(k=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(v=i.map(function(X){if(X=X instanceof g.Table?X.name:X,typeof X!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return X}),r=="r"||r===mr)d=mr;else{if(r!="rw"&&r!=ta)throw new P.InvalidArgument("Invalid transaction mode: "+r);d=ta}if(k){if(k.mode===mr&&d===ta){if(!S)throw new P.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&v.forEach(function(X){if(k&&k.storeNames.indexOf(X)===-1){if(!S)throw new P.SubTransaction("Table "+X+" not included in parent transaction.");k=null}}),S&&k&&!k.active&&(k=null)}}catch(X){return k?k._promise(null,function(q,D){D(X)}):Me(X)}var N=(function X(q,D,z,K,B){return be.resolve().then(function(){var Q=De.transless||De,L=q._createTransaction(D,z,q._dbSchema,K),Q=(L.explicit=!0,{trans:L,transless:Q});if(K)L.idbtrans=K.idbtrans;else try{L.create(),L.idbtrans._explicit=!0,q._state.PR1398_maxLoop=3}catch(we){return we.name===Te.InvalidState&&q.isOpen()&&0<--q._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),q.close({disableAutoOpen:!1}),q.open().then(function(){return X(q,D,z,null,B)})):Me(we)}var J,ae=ce(B),Q=(ae&&fn(),be.follow(function(){var we;(J=B.call(L,L))&&(ae?(we=tr.bind(null,null),J.then(we,we)):typeof J.next=="function"&&typeof J.throw=="function"&&(J=Ji(J)))},Q));return(J&&typeof J.then=="function"?be.resolve(J).then(function(we){return L.active?we:Me(new P.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Q.then(function(){return J})).then(function(we){return K&&L._resolve(),L._completion.then(function(){return we})}).catch(function(we){return L._reject(we),Me(we)})})}).bind(null,this,d,v,k,l);return k?k._promise(d,N,"lock"):De.trans?Ke(De.transless,function(){return g._whenReady(N)}):this._whenReady(N)},Vt.prototype.table=function(r){if(y(this._allTables,r))return this._allTables[r];throw new P.InvalidTable("Table ".concat(r," does not exist"))};var Ar=Vt;function Vt(r,i){var l,d,v,g,k,S=this,N=(this._middlewares={},this.verno=0,Vt.dependencies),N=(this._options=i=a({addons:Vt.addons,autoOpen:!0,indexedDB:N.indexedDB,IDBKeyRange:N.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),X=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:xe,dbReadyPromise:null,cancelOpen:xe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),q=(X.dbReadyPromise=new be(function(D){X.dbReadyResolve=D}),X.openCanceller=new be(function(D,z){X.cancelOpen=z}),this._state=X,this.name=r,this.on=ns(this,"populate","blocked","versionchange","close",{ready:[Be,xe]}),this.once=function(D,z){var K=function(){for(var B=[],L=0;L<arguments.length;L++)B[L]=arguments[L];S.on(D).unsubscribe(K),z.apply(S,B)};return S.on(D,K)},this.on.ready.subscribe=H(this.on.ready.subscribe,function(D){return function(z,K){Vt.vip(function(){var B,L=S._state;L.openComplete?(L.dbOpenError||be.resolve().then(z),K&&D(z)):L.onReadyBeingFired?(L.onReadyBeingFired.push(z),K&&D(z)):(D(z),B=S,K||D(function J(){B.on.ready.unsubscribe(z),B.on.ready.unsubscribe(J)}))})}}),this.Collection=(l=this,rs(Pd.prototype,function(J,L){this.db=l;var K=es,B=null;if(L)try{K=L()}catch(Q){B=Q}var L=J._ctx,J=L.table,ae=J.hook.reading.fire;this._ctx={table:J,index:L.index,isPrimKey:!L.index||J.schema.primKey.keyPath&&L.index===J.schema.primKey.name,range:K,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:B,or:L.or,valueMapper:ae!==Pe?ae:null}})),this.Table=(d=this,rs(Il.prototype,function(D,z,K){this.db=d,this._tx=K,this.name=D,this.schema=z,this.hook=d._allTables[D]?d._allTables[D].hook:ns(null,{creating:[_t,xe],reading:[Ue,Pe],updating:[Et,xe],deleting:[St,xe]})})),this.Transaction=(v=this,rs(jd.prototype,function(D,z,K,B,L){var J=this;D!=="readonly"&&z.forEach(function(ae){ae=(ae=K[ae])==null?void 0:ae.yProps,ae&&(z=z.concat(ae.map(function(Q){return Q.updatesTable})))}),this.db=v,this.mode=D,this.storeNames=z,this.schema=K,this.chromeTransactionDurability=B,this.idbtrans=null,this.on=ns(this,"complete","error","abort"),this.parent=L||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new be(function(ae,Q){J._resolve=ae,J._reject=Q}),this._completion.then(function(){J.active=!1,J.on.complete.fire()},function(ae){var Q=J.active;return J.active=!1,J.on.error.fire(ae),J.parent?J.parent._reject(ae):Q&&J.idbtrans&&J.idbtrans.abort(),Me(ae)})})),this.Version=(g=this,rs(Ud.prototype,function(D){this.db=g,this._cfg={version:D,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,rs(Ml.prototype,function(D,z,K){if(this.db=k,this._ctx={table:D,index:z===":id"?null:z,or:K},this._cmp=this._ascending=ct,this._descending=function(B,L){return ct(L,B)},this._max=function(B,L){return 0<ct(B,L)?B:L},this._min=function(B,L){return ct(B,L)<0?B:L},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new P.MissingAPI})),this.on("versionchange",function(D){0<D.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(D){!D.newVersion||D.newVersion<D.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(D.oldVersion/10))}),this._maxKey=is(i.IDBKeyRange),this._createTransaction=function(D,z,K,B){return new S.Transaction(D,z,K,S._options.chromeTransactionDurability,B)},this._fireOnBlocked=function(D){S.on("blocked").fire(D),Ht.filter(function(z){return z.name===S.name&&z!==S&&!z._state.vcFired}).map(function(z){return z.on("versionchange").fire(D)})},this.use(Hd),this.use(Xd),this.use(Vd),this.use(Gd),this.use(Wd),new Proxy(this,{get:function(D,z,K){var B;return z==="_vip"||(z==="table"?function(L){return ni(S.table(L),q)}:(B=Reflect.get(D,z,K))instanceof Il?ni(B,q):z==="tables"?B.map(function(L){return ni(L,q)}):z==="_createTransaction"?function(){return ni(B.apply(this,arguments),q)}:B)}}));this.vip=q,N.forEach(function(D){return D(S)})}var ri,Ma=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Zd=(no.prototype.subscribe=function(r,i,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:l})},no.prototype[Ma]=function(){return this},no);function no(r){this._subscribe=r}try{ri={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{ri={indexedDB:null,IDBKeyRange:null}}function Yl(r){var i,l=!1,d=new Zd(function(v){var g=ce(r),k,S=!1,N={},X={},q={get closed(){return S},unsubscribe:function(){S||(S=!0,k&&k.abort(),D&&Fr.storagemutated.unsubscribe(K))}},D=(v.start&&v.start(q),!1),z=function(){return Ie(B)},K=function(L){$s(N,L),Yi(X,N)&&z()},B=function(){var L,J,ae;!S&&ri.indexedDB&&(N={},L={},k&&k.abort(),k=new AbortController,ae=(Q=>{var we=Fn();try{g&&fn();var Ee=er(r,Q);return Ee=g?Ee.finally(tr):Ee}finally{we&&mn()}})(J={subscr:L,signal:k.signal,requery:z,querier:r,trans:null}),Promise.resolve(ae).then(function(Q){l=!0,i=Q,S||J.signal.aborted||(N={},(we=>{for(var Ee in we)if(y(we,Ee))return;return 1})(X=L)||D||(Fr(ss,K),D=!0),Ie(function(){return!S&&v.next&&v.next(Q)}))},function(Q){l=!1,["DatabaseClosedError","AbortError"].includes(Q==null?void 0:Q.name)||S||Ie(function(){S||v.error&&v.error(Q)})}))};return setTimeout(z,0),q});return d.hasValue=function(){return l},d.getValue=function(){return i},d}var aa=Ar;function ro(r){var i=zr;try{zr=!0,Fr.storagemutated.fire(r),Zi(r,!0)}finally{zr=i}}w(aa,a(a({},te),{delete:function(r){return new aa(r,{addons:[]}).delete()},exists:function(r){return new aa(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=aa.dependencies,l=i.indexedDB,i=i.IDBKeyRange,(Wi(l)?Promise.resolve(l.databases()).then(function(d){return d.map(function(v){return v.name}).filter(function(v){return v!==xn})}):Gi(l,i).toCollection().primaryKeys()).then(r)}catch{return Me(new P.MissingAPI)}var i,l},defineClass:function(){return function(r){m(this,r)}},ignoreTransaction:function(r){return De.trans?Ke(De.transless,r):r()},vip:Hi,async:function(r){return function(){try{var i=Ji(r.apply(this,arguments));return i&&typeof i.then=="function"?i:be.resolve(i)}catch(l){return Me(l)}}},spawn:function(r,i,l){try{var d=Ji(r.apply(l,i||[]));return d&&typeof d.then=="function"?d:be.resolve(d)}catch(v){return Me(v)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(r,i){return r=be.resolve(typeof r=="function"?aa.ignoreTransaction(r):r).timeout(i||6e4),De.trans?De.trans.waitFor(r):r},Promise:be,debug:{get:function(){return We},set:function(r){pt(r)}},derive:U,extend:m,props:w,override:H,Events:ns,on:Fr,liveQuery:Yl,extendObservabilitySet:$s,getByKeyPath:se,setByKeyPath:G,delByKeyPath:function(r,i){typeof i=="string"?G(r,i,void 0):"length"in i&&[].map.call(i,function(l){G(r,l,void 0)})},shallowClone:me,deepClone:_e,getObjectDiff:$i,cmp:ct,asap:Y,minKey:-1/0,addons:[],connections:Ht,errnames:Te,dependencies:ri,cache:ra,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,l){return r+i/Math.pow(10,2*l)})})),aa.maxKey=is(aa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Fr(ss,function(r){zr||(r=new CustomEvent(Ni,{detail:r}),zr=!0,dispatchEvent(r),zr=!1)}),addEventListener(Ni,function(r){r=r.detail,zr||ro(r)}));var Da,zr=!1,Ql=function(){};return typeof BroadcastChannel<"u"&&((Ql=function(){(Da=new BroadcastChannel(Ni)).onmessage=function(r){return r.data&&ro(r.data)}})(),typeof Da.unref=="function"&&Da.unref(),Fr(ss,function(r){zr||Da.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Ar.disableBfCache&&r.persisted){We&&console.debug("Dexie: handling persisted pagehide"),Da!=null&&Da.close();for(var i=0,l=Ht;i<l.length;i++)l[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Ar.disableBfCache&&r.persisted&&(We&&console.debug("Dexie: handling persisted pageshow"),Ql(),ro({all:new vn(-1/0,[[]])}))})),be.rejectionMapper=function(r,i){return!r||r instanceof W||r instanceof TypeError||r instanceof SyntaxError||!r.name||!ye[r.name]?r:(i=new ye[r.name](i||r.message,r),"stack"in r&&O(i,"stack",{get:function(){return this.inner.stack}}),i)},pt(We),a(Ar,Object.freeze({__proto__:null,Dexie:Ar,Entity:xl,PropModification:ts,RangeSet:vn,add:function(r){return new ts({add:r})},cmp:ct,default:Ar,liveQuery:Yl,mergeRanges:cs,rangesOverlap:ql,remove:function(r){return new ts({remove:r})},replacePrefix:function(r,i){return new ts({replacePrefix:[r,i]})}}),{default:Ar}),Ar})})(mi)),mi.exports}var Gv=Kv();const Mo=zv(Gv),pc=Symbol.for("Dexie"),hn=globalThis[pc]||(globalThis[pc]=Mo);if(Mo.semVer!==hn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Mo.semVer} and ${hn.semVer}`);const{liveQuery:f1,mergeRanges:v1,rangesOverlap:p1,RangeSet:h1,cmp:m1,Entity:g1,PropModification:_1,replacePrefix:y1,add:b1,remove:w1,DexieYProvider:k1}=hn,Ge=new hn("me-ai-store");Ge.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Ge.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Ge.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Ge.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});function ol(t,e){return`${t}:${e}`}const Wv=Object.freeze(Object.defineProperty({__proto__:null,db:Ge,makeItemId:ol},Symbol.toStringTag,{value:"Module"}));function Do(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function po(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),s=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return s.toFixed(o)+" "+n[a]}function Hv(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Vv(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Oi(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const Yv="https://gmail.googleapis.com/gmail/v1/users/me";class ll extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function Qv(t){return{Authorization:`Bearer ${t}`}}async function Pi(t,e){var a,s,o,c;const n=await fetch(`${Yv}${e}`,{headers:Qv(t)});if(!n.ok){const f=await n.json().catch(()=>({})),m=((a=f.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,h=((c=(o=(s=f.error)==null?void 0:s.errors)==null?void 0:o[0])==null?void 0:c.reason)||void 0;throw new ll(m,n.status,h)}return n.json()}function Gu(t){return Pi(t,"/profile")}function Wu(t,{maxResults:e=20,pageToken:n,q:a}={}){const s=new URLSearchParams;return s.set("maxResults",String(e)),n&&s.set("pageToken",n),a&&s.set("q",a),Pi(t,`/messages?${s}`)}function Hu(t,e,n="full"){return Pi(t,`/messages/${e}?format=${n}`)}function Xv(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const s=new URLSearchParams;return s.set("startHistoryId",e),s.set("maxResults",String(a)),s.append("historyTypes","messageAdded"),s.append("historyTypes","messageDeleted"),n&&s.set("pageToken",n),Pi(t,`/history?${s}`)}function Kr(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),s=n.find(c=>c.name.toLowerCase()===a);return(s==null?void 0:s.value)||""}function Ss(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),s=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(s)}function Zv(t){var o,c,f;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Ss(e.body.data);const n=e.parts||[],a=yi(n,"text/plain");if((c=a==null?void 0:a.body)!=null&&c.data)return Ss(a.body.data);const s=yi(n,"text/html");if((f=s==null?void 0:s.body)!=null&&f.data){const m=Ss(s.body.data);return $v(m)}return"(no body)"}function Jv(t){var s,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((s=e.body)!=null&&s.data))return Ss(e.body.data);const n=e.parts||[],a=yi(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Ss(a.body.data):null}function yi(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=yi(n.parts,e);if(a)return a}}return null}function $v(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function cl(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function Vu(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function Yu(t){return Vu(t).charAt(0).toUpperCase()}function ep(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${s}`}catch{return"email"}}function tp(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function Qu(t,e){return`${ep(t.date)}_${tp(t.subject)}.${e}`}function Xu(t){const e={};for(const a of t){const s=a.action||"UNKNOWN";e[s]||(e[s]=[]),e[s].push(a)}for(const a of Object.keys(e))e[a].sort((s,o)=>(o.date||0)-(s.date||0));const n=Object.keys(e).sort((a,s)=>e[s].length-e[a].length);return{groups:e,order:n}}async function np(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:s}=await Zu();if(a&&s){const o=new Date(a.date).toLocaleDateString(),c=new Date(s.date).toLocaleDateString();n.push(`Date range: ${o} to ${c}.`)}return n.join(" ")}async function rp(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:s}=await Zu();if(a&&s){const o=new Date(a.date).toLocaleDateString(),c=new Date(s.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${c}`)}return n.join(`
`)}async function ap(t=10){const e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(Ju).join(`

---

`)}async function sp(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),s=(await Ge.items.where("sourceType").equals("gmail").toArray()).map(o=>{var f,m,h,b,y;let c=0;return(f=o.subject)!=null&&f.toLowerCase().includes(n)&&(c+=3),(m=o.from)!=null&&m.toLowerCase().includes(n)&&(c+=2),(h=o.to)!=null&&h.toLowerCase().includes(n)&&(c+=2),(b=o.snippet)!=null&&b.toLowerCase().includes(n)&&(c+=1),(y=o.body)!=null&&y.toLowerCase().includes(n)&&(c+=1),{item:o,score:c}}).filter(({score:o})=>o>0).sort((o,c)=>c.score-o.score).slice(0,e);return s.length===0?`No results found for "${t}".`:s.map(({item:o})=>Ju(o)).join(`

---

`)}async function hc(){const t=await Ge.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=Xu(t);return{groups:e,order:n,total:t.length}}async function ip({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),c=await Ge.items.where("sourceType").equals("gmail").filter(f=>{var m,h,b,y;return((m=f.subject)==null?void 0:m.toLowerCase().includes(o))||((h=f.from)==null?void 0:h.toLowerCase().includes(o))||((b=f.to)==null?void 0:b.toLowerCase().includes(o))||((y=f.snippet)==null?void 0:y.toLowerCase().includes(o))}).toArray();return c.sort((f,m)=>(m.date||0)-(f.date||0)),{items:c.slice(n,n+e),total:c.length}}const a=await Ge.items.where("sourceType").equals("gmail").count();return{items:await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function Zu(){const t=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).first(),e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).last();return{oldest:t,newest:e}}function Ju(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=Vv(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function op(){const t=await np();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function lp(t){const e=[],n=await rp();if(e.push(n),t){const a=await sp(t,5);e.push("","## Relevant Emails",a)}else{const a=await ap(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const cp="modulepreload",up=function(t){return"/me-ai/"+t},mc={},jo=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(b=>Promise.resolve(b).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),m=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));s=c(n.map(h=>{if(h=up(h),h in mc)return;mc[h]=!0;const b=h.endsWith(".css"),y=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const w=document.createElement("link");if(w.rel=b?"stylesheet":cp,b||(w.as="script"),w.crossOrigin="",w.href=h,m&&w.setAttribute("nonce",m),document.head.appendChild(w),b)return new Promise((x,O)=>{w.addEventListener("load",x),w.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return s.then(c=>{for(const f of c||[])f.status==="rejected"&&o(f.reason);return e().catch(o)})},$u="me-ai-action-pipelines",ed={REPLY:[{id:"star",name:"Star",description:"Mark as important for follow-up",icon:"â­"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],FOLLOW_UP:[{id:"star",name:"Star",description:"Mark for follow-up",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],DELETE:[{id:"trash",name:"Move to Trash",description:"Move email to trash",icon:"ðï¸"}],ARCHIVE:[{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],READ_LATER:[{id:"star",name:"Star",description:"Mark for reading later",icon:"â­"},{id:"mark_unread",name:"Keep Unread",description:"Keep as unread reminder",icon:"ð§"}],REVIEW:[{id:"mark_read",name:"Mark as Read",description:"Mark as reviewed",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}],PAY_BILL:[{id:"star",name:"Star",description:"Mark for payment",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],TRACK_DELIVERY:[{id:"star",name:"Star",description:"Track delivery",icon:"â­"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],SCHEDULE_MEETING:[{id:"star",name:"Star",description:"Mark for scheduling",icon:"â­"},{id:"mark_important",name:"Mark Important",description:"Flag as important",icon:"ð´"}],UNSUBSCRIBE:[{id:"mark_spam",name:"Mark as Spam",description:"Move to spam folder",icon:"ð«"}],SAVE_RECEIPT:[{id:"star",name:"Star",description:"Star for records",icon:"â­"},{id:"archive",name:"Archive",description:"Move to archive",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],ACKNOWLEDGE:[{id:"mark_read",name:"Mark as Read",description:"Mark as acknowledged",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}],NO_ACTION:[{id:"archive",name:"Archive",description:"Archive without action",icon:"ð¦"},{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"}],IGNORE:[{id:"mark_spam",name:"Mark as Spam",description:"Mark as spam and remove",icon:"ð«"}]},td=[{id:"mark_read",name:"Mark as Read",description:"Mark email as read",icon:"â"},{id:"archive",name:"Archive",description:"Remove from inbox",icon:"ð¦"}];function qs(){try{const t=localStorage.getItem($u);return t?JSON.parse(t):{}}catch{return{}}}function nd(t){localStorage.setItem($u,JSON.stringify(t))}function Ja(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=qs();return n[e]?n[e]:ed[e]||td}const La=Ja;function dp(){const t=qs();return[...new Set([...Object.keys(ed),...Object.keys(t)])]}async function fp(){try{const{db:t}=await jo(async()=>{const{db:a}=await Promise.resolve().then(()=>Wv);return{db:a}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(a=>a.action).filter(Boolean))].sort()}catch{return[]}}async function vp(){const t=dp(),e=await fp();return[...new Set([...t,...e])].sort()}function Bs(t,e){const n=t.toUpperCase(),a=qs();a[n]=e,nd(a)}const pp=Bs;function hp(t,e){const n=Ja(t);Bs(t,[...n,e])}const mp=hp;function gp(t,e){const n=Ja(t);Bs(t,n.filter(a=>a.id!==e))}const _p=gp;function yp(t,e,n){const a=Ja(t);Bs(t,a.map(s=>s.id===e?{...s,...n}:s))}const bp=yp;function wp(t,e){const n=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");n&&Bs(n,[...td])}function kp(t){const e=t.toUpperCase(),n=qs();delete n[e],nd(n)}function xp(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"",n=qs();return e in n}function Sp(t){kp(t)}function Ep(t,e){var s;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((s=e.body)==null?void 0:s.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=La(t.action);return{event:n,commands:a}}function Tp(t){return{role:"assistant",type:"event-batch",items:t.filter(n=>n.success&&n.classification).map(n=>{const{event:a,commands:s}=Ep(n.classification,n.email);return{event:a,commands:s}}),content:""}}function Ap(t){const e=t.order.map(a=>{const s=t.groups[a]||[],o=La(a),c=s.map(f=>({emailId:f.emailId,subject:f.subject||"(no subject)",from:f.from||"",date:f.date,summary:f.summary||"",reason:f.reason||"",tags:f.tags||[],status:f.status||"pending"}));return{eventType:a,emails:c,commands:o}}),n=e.reduce((a,s)=>a+s.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}const Ip=20,Cp={maxTokens:512},ys=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function rd(t,{count:e=Ip,force:n=!1,onProgress:a=()=>{},signal:s}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,c=0;if(n)o=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(e).toArray();else{const H=new Set(await Ge.emailClassifications.toCollection().primaryKeys());c=0,o=[],await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().until(()=>o.length>=e).each(C=>{H.has(C.id)?c++:o.push(C)})}if(o.length===0){const H=n?"No emails to scan.":`All emails already classified (${c} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:H,classified:0}),{scanned:0,classified:0,skipped:c,errors:0}}const f=Date.now(),m=performance.now();let h=0,b=0,y=0,w=0;const x=[],O=t.modelId,U=sl(O)||il(O);if(!U)throw new Error(`Unknown model: ${O}`);if(!U.recommendedForEmailProcessing&&o.length>0){const{MODELS:H}=await jo(async()=>{const{MODELS:G}=await Promise.resolve().then(()=>Mv);return{MODELS:G}},void 0),{OLLAMA_MODELS:C}=await jo(async()=>{const{OLLAMA_MODELS:G}=await Promise.resolve().then(()=>Dv);return{OLLAMA_MODELS:G}},void 0),Y=[...H.filter(G=>G.recommendedForEmailProcessing).map(G=>G.name),...C.filter(G=>G.recommendedForEmailProcessing).map(G=>G.displayName)],se=U.displayName||U.name;console.warn(`â ï¸ Current model (${se}) is not optimized for email processing. For best results with long emails, use: ${Y.join(", ")}. Some emails may fail due to memory limits.`)}for(let H=0;H<o.length&&!(s!=null&&s.aborted);H++){const C=o[H],Y=id(C),se=[{role:"system",content:ys},{role:"user",content:Y}];a({phase:"scanning",current:H+1,total:o.length,classified:h,errors:b,results:x,email:{subject:C.subject,from:C.from,date:C.date},prompt:{system:ys,user:Y},systemPromptLength:ys.length,live:null,lastResult:null,totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}});const G=performance.now();try{const{text:me,tps:ke,numTokens:de,inputTokens:pe}=await t.generateFull(se,{maxTokens:512,enableThinking:!1,temperature:0},fe=>{a({phase:"generating",current:H+1,total:o.length,classified:h,errors:b,results:x,email:{subject:C.subject,from:C.from,date:C.date},live:{tps:fe.tps,numTokens:fe.numTokens},streamingText:fe.text||"",totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}})});y+=de,w+=pe;const ie=Op(me),_e=performance.now()-G;if(ie){await Ge.emailClassifications.put({emailId:C.id,action:ie.action,reason:ie.reason,summary:ie.summary,tags:ie.tags,subject:C.subject||"(no subject)",from:C.from||"",date:C.date,scannedAt:f,status:"pending"}),h++;const fe={success:!0,email:{subject:C.subject,from:C.from,date:C.date},classification:ie,rawResponse:me,stats:{tps:ke,numTokens:de,inputTokens:pe,elapsed:_e},promptSize:Y.length};x.push(fe),a({phase:"classified",current:H+1,total:o.length,classified:h,errors:b,results:x,email:{subject:C.subject,from:C.from,date:C.date},result:ie,rawResponse:me,emailStats:{tps:ke,numTokens:de,inputTokens:pe,elapsed:_e},totals:{outputTokens:y,inputTokens:w,elapsed:performance.now()-m}})}}catch(me){console.error(`Triage email ${H+1} failed:`,me),b++;const ke=me.message||String(me),de=ke.length>200?ke.slice(0,200)+"...":ke;x.push({success:!1,email:{subject:C.subject,from:C.from,date:C.date},error:de,promptSize:Y.length})}}const M=performance.now()-m,$=x.length>0?Math.round(x.reduce((H,C)=>H+C.promptSize,0)/x.length):0,ee=x.filter(H=>{var C;return H.success&&((C=H.stats)==null?void 0:C.tps)}).length>0?Math.round(x.filter(H=>H.success).reduce((H,C)=>{var Y;return H+(((Y=C.stats)==null?void 0:Y.tps)||0)},0)/x.filter(H=>{var C;return H.success&&((C=H.stats)==null?void 0:C.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:h,errors:b,results:x,summary:{avgPromptSize:$,avgTps:ee,systemPromptSize:ys.length,processed:o.length,skipped:c,modelName:U.displayName||U.name,modelContextWindow:U.contextWindow,modelMaxEmailTokens:U.maxEmailTokens},totals:{outputTokens:y,inputTokens:w,elapsed:M}}),{scanned:o.length,classified:h,skipped:c,errors:b}}async function ad(){const t=await Ge.emailClassifications.toArray();return Xu(t)}async function Rp(){const t=await Ge.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function bi(t,e){await Ge.emailClassifications.update(t,{status:e})}async function gc(){await Ge.emailClassifications.clear()}async function ul(t){await Ge.emailClassifications.where("action").equals(t).delete()}async function sd(t){await Ge.emailClassifications.delete(t)}async function Lo(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function id(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function Op(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const n=e.indexOf("{"),a=e.lastIndexOf("}");if(n===-1||a===-1||a<=n)return console.warn("Triage: no JSON object found in response"),null;const s=e.indexOf("[");if(s!==-1&&s<n)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(n,a+1);try{const c=JSON.parse(o);if(!c||typeof c!="object"||Array.isArray(c))return null;const f=Pp(c.action);if(!f)return console.warn("Triage: missing or invalid action field"),null;let m=[];return Array.isArray(c.tags)&&(m=c.tags.filter(h=>typeof h=="string"&&h.trim()).map(h=>h.trim().toLowerCase()).slice(0,10)),{action:f,reason:String(c.reason||"").slice(0,300),summary:String(c.summary||"").slice(0,500),tags:m}}catch(c){return console.warn("Triage: failed to parse JSON response:",c.message),null}}function Pp(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function No(t){return`hsl(${Oi(t)}, 55%, 55%)`}function Mp(t){return`hsl(${Oi(t)}, 40%, 35%)`}var Dp=I('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),jp=I('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function Lp(t,e){bt(e,!0);let n=Ne(e,"backend",15,"webgpu"),a=Ne(e,"isWebGPUAvailable",3,!0);var s=jp(),o=_(p(s),2),c=p(o);let f;c.__click=()=>n("webgpu");var m=_(c,2);let h;m.__click=()=>n("ollama");var b=_(o,2);{var y=w=>{var x=Dp();E(w,x)};re(b,w=>{!a()&&n()==="webgpu"&&w(y)})}Z(()=>{f=Rt(c,1,"backend-btn svelte-1n2kfl0",null,f,{active:n()==="webgpu"}),c.disabled=!a(),h=Rt(m,1,"backend-btn svelte-1n2kfl0",null,h,{active:n()==="ollama"})}),E(t,s),wt()}Nt(["click"]);const Np=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function _c(...t){Np&&console.log("[debug]",...t)}function qn(t){return _c(`[MOUNT] ${t}`),()=>_c(`[DESTROY] ${t}`)}var qp=I("<option> </option>"),Bp=I('<p class="model-description svelte-1p89qnn"> </p>'),Fp=I('<span class="current-badge svelte-1p89qnn">Current</span>'),zp=I('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Up=I('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Kp=I('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),Gp=I('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),Wp=I('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),Hp=I('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),Vp=I('<p class="error svelte-1p89qnn"> </p>'),Yp=I('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function Qp(t,e){bt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"gpuInfo",3,null),s=Ne(e,"error",3,null);dn(()=>qn("ModelSelector"));var o=Yp(),c=p(o),f=_(p(c),2),m=_(p(f),2);At(m,21,()=>Sr,Ut,(C,Y)=>{var se=qp(),G=p(se),me={};Z(()=>{F(G,`${u(Y).name??""} â ${u(Y).size??""}`),me!==(me=u(Y).id)&&(se.value=(se.__value=u(Y).id)??"")}),E(C,se)});var h=_(m,2);{var b=C=>{const Y=lt(()=>Sr.find(ke=>ke.id===n()));var se=Jn(),G=Xe(se);{var me=ke=>{var de=Bp(),pe=p(de);Z(()=>F(pe,u(Y).description)),E(ke,de)};re(G,ke=>{u(Y)&&ke(me)})}E(C,se)};re(h,C=>{n()&&C(b)})}var y=_(f,2),w=_(p(y),2),x=p(w),O=_(p(x));At(O,21,()=>Sr,Ut,(C,Y)=>{var se=Gp();let G;var me=p(se),ke=p(me),de=_(ke);{var pe=te=>{var ne=Fp();E(te,ne)};re(de,te=>{u(Y).id===n()&&te(pe)})}var ie=_(me),_e=p(ie),fe=p(_e),ue=_(ie),he=p(ue),Se=_(ue),oe=p(Se);{var ve=te=>{var ne=zp();E(te,ne)},le=te=>{var ne=Up();E(te,ne)},ce=te=>{var ne=Kp();E(te,ne)};re(oe,te=>{u(Y).recommendedForEmailProcessing?te(ve):u(Y).maxEmailTokens>=6e3?te(le,1):te(ce,!1)})}Z((te,ne)=>{G=Rt(se,1,"svelte-1p89qnn",null,G,{selected:u(Y).id===n()}),F(ke,`${u(Y).name??""} `),F(fe,`${te??""}k`),F(he,`~${ne??""}k`)},[()=>(u(Y).contextWindow/1024).toFixed(0),()=>(u(Y).maxEmailTokens/1e3).toFixed(0)]),E(C,se)});var U=_(y,2);{var M=C=>{var Y=Hp(),se=_(p(Y),2),G=p(se),me=_(p(G)),ke=p(me),de=_(G,2),pe=_(p(de)),ie=p(pe),_e=_(de,2);{var fe=ue=>{var he=Wp(),Se=_(p(he)),oe=p(Se);Z(ve=>F(oe,ve),[()=>Do(a().limits.maxBufferSize)]),E(ue,he)};re(_e,ue=>{var he;(he=a().limits)!=null&&he.maxBufferSize&&ue(fe)})}Z(()=>{F(ke,a().vendor),F(ie,a().architecture)}),E(C,Y)};re(U,C=>{a()&&C(M)})}var $=_(U,2);{var ee=C=>{var Y=Vp(),se=p(Y);Z(()=>F(se,s())),E(C,Y)};re($,C=>{s()&&C(ee)})}var H=_($,2);H.__click=function(...C){var Y;(Y=e.onload)==null||Y.apply(this,C)},Z(()=>H.disabled=s()),Ri(m,n),E(t,o),wt()}Nt(["click"]);var Xp=I('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),Zp=I('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),Jp=I('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),$p=I("<div><!></div>"),eh=I("<option> <!></option>"),th=I("<option> <!></option>"),nh=I('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),rh=I('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),ah=I('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),sh=I('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),ih=I('<span class="current-badge svelte-1bvvk8o">Current</span>'),oh=I('<span class="installed-badge svelte-1bvvk8o">â</span>'),lh=I('<span class="rec-badge svelte-1bvvk8o">â</span>'),ch=I('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),uh=I('<p class="error svelte-1bvvk8o"> </p>'),dh=I('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL:</label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" placeholder="https://me-ai.metaelon.space" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function fh(t,e){bt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"error",15),s=Oe(jt(Ns())),o=Oe(!1),c=Oe(null),f=Oe(jt([])),m=Oe(!1);Sa(()=>{h()});async function h(){A(o,!0),A(c,null);const le=await Po(u(s));A(c,le,!0),A(o,!1),le.connected&&b()}async function b(){A(m,!0);try{const le=await Lv(u(s));A(f,le.map(ce=>ce.name),!0)}catch(le){console.error("Failed to load Ollama models:",le),A(f,[],!0)}A(m,!1)}function y(){jv(u(s)),h()}function w(){if(!n()){a("Please select a model");return}e.onload()}function x(le){return u(f).length?u(f).includes(le):!1}const O=Uu();var U=dh(),M=p(U),$=_(p(M),2),ee=p($);ee.__change=y;var H=_(ee,2);H.__click=h;var C=p(H),Y=_($,2);{var se=le=>{var ce=$p();let te;var ne=p(ce);{var W=T=>{var V=Xp(),Te=_(Xe(V),2),Ce=p(Te);Z(()=>F(Ce,`Connected â¢ v${u(c).version??""}`)),E(T,V)},R=T=>{var V=Jp(),Te=_(Xe(V),2),Ce=p(Te),P=p(Ce),ye=_(Ce,2);{var xe=Pe=>{var Ue=Zp(),Ye=_(p(Ue),2),_t=p(Ye),St=_(p(_t));St.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var Et=_(_t,2),Ze=_(p(Et));Ze.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,E(Pe,Ue)};re(ye,Pe=>{u(c).corsError&&Pe(xe)})}Z(()=>F(P,`Disconnected: ${u(c).error??""}`)),E(T,V)};re(ne,T=>{u(c).connected?T(W):T(R,!1)})}Z(()=>te=Rt(ce,1,"connection-status svelte-1bvvk8o",null,te,{connected:u(c).connected})),E(le,ce)};re(Y,le=>{u(c)&&le(se)})}var G=_(M,2),me=_(p(G),2),ke=p(me);At(ke,21,()=>O,Ut,(le,ce)=>{var te=eh(),ne=p(te),W=_(ne);{var R=Te=>{var Ce=_n("â");E(Te,Ce)},T=lt(()=>x(u(ce).name));re(W,Te=>{u(T)&&Te(R)})}var V={};Z(Te=>{F(ne,`${u(ce).displayName??""} (${u(ce).params??""}) - ${Te??""}k context `),V!==(V=u(ce).name)&&(te.value=(te.__value=u(ce).name)??"")},[()=>(u(ce).contextWindow/1024).toFixed(0)]),E(le,te)});var de=_(ke);At(de,21,()=>fr.filter(le=>!le.recommended),Ut,(le,ce)=>{var te=th(),ne=p(te),W=_(ne);{var R=Te=>{var Ce=_n("â");E(Te,Ce)},T=lt(()=>x(u(ce).name));re(W,Te=>{u(T)&&Te(R)})}var V={};Z(Te=>{F(ne,`${u(ce).displayName??""} (${u(ce).params??""}) - ${Te??""}k context `),V!==(V=u(ce).name)&&(te.value=(te.__value=u(ce).name)??"")},[()=>(u(ce).contextWindow/1024).toFixed(0)]),E(le,te)});var pe=_(me,2);{var ie=le=>{const ce=lt(()=>fr.find(R=>R.name===n()));var te=Jn(),ne=Xe(te);{var W=R=>{var T=sh(),V=p(T),Te=p(V),Ce=_(V,2),P=p(Ce),ye=p(P),xe=_(P,4),Pe=p(xe),Ue=_(xe,2);{var Ye=Be=>{var We=nh(),pt=_(Xe(We),2),Mt=p(pt);Z(Zt=>F(Mt,Zt),[()=>u(ce).tags.join(", ")]),E(Be,We)};re(Ue,Be=>{var We;(We=u(ce).tags)!=null&&We.length&&Be(Ye)})}var _t=_(Ce,2);{var St=Be=>{var We=rh(),pt=_(p(We),2),Mt=p(pt);Z(()=>F(Mt,`ollama pull ${n()??""}`)),E(Be,We)},Et=lt(()=>!x(n())),Ze=Be=>{var We=ah();E(Be,We)};re(_t,Be=>{u(Et)?Be(St):Be(Ze,!1)})}Z(Be=>{F(Te,u(ce).description),F(ye,`${Be??""}k context`),F(Pe,`${u(ce).params??""} params`)},[()=>(u(ce).contextWindow/1024).toFixed(0)]),E(R,T)};re(ne,R=>{u(ce)&&R(W)})}E(le,te)};re(pe,le=>{n()&&le(ie)})}var _e=_(G,2),fe=_(p(_e),2),ue=p(fe),he=_(p(ue));At(he,21,()=>fr,Ut,(le,ce)=>{var te=ch();let ne;var W=p(te),R=p(W),T=_(R);{var V=Be=>{var We=ih();E(Be,We)};re(T,Be=>{u(ce).name===n()&&Be(V)})}var Te=_(T,2);{var Ce=Be=>{var We=oh();E(Be,We)},P=lt(()=>x(u(ce).name));re(Te,Be=>{u(P)&&Be(Ce)})}var ye=_(W),xe=p(ye),Pe=p(xe),Ue=_(ye),Ye=p(Ue),_t=_(Ue),St=p(_t);{var Et=Be=>{var We=lh();E(Be,We)};re(St,Be=>{u(ce).recommended&&Be(Et)})}var Ze=_(St);Z((Be,We,pt)=>{ne=Rt(te,1,"svelte-1bvvk8o",null,ne,Be),F(R,`${u(ce).displayName??""} `),F(Pe,`${We??""}k`),F(Ye,u(ce).params),F(Ze,` ${pt??""}`)},[()=>({selected:u(ce).name===n(),installed:x(u(ce).name)}),()=>(u(ce).contextWindow/1024).toFixed(0),()=>u(ce).tags.slice(0,2).join(", ")]),E(le,te)});var Se=_(_e,2);{var oe=le=>{var ce=uh(),te=p(ce);Z(()=>F(te,a())),E(le,ce)};re(Se,le=>{a()&&le(oe)})}var ve=_(Se,2);ve.__click=w,Z(()=>{var le;H.disabled=u(o),F(C,u(o)?"Testing...":"Test"),ve.disabled=!((le=u(c))!=null&&le.connected)||a()}),or(ee,()=>u(s),le=>A(s,le)),Ri(me,n),E(t,U),wt()}Nt(["change","click"]);var vh=I('<span class="progress-percent svelte-r5fnze"> </span>'),ph=I('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),hh=I('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),mh=I('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),gh=I('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),_h=I('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),yh=I('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function bh(t,e){bt(e,!0);let n=Ne(e,"message",3,""),a=Ne(e,"items",19,()=>[]);dn(()=>qn("LoadingProgress"));var s=yh(),o=p(s),c=p(o),f=_(o,2);At(f,17,a,Ut,(m,h)=>{const b=lt(()=>u(h).total?Hv(u(h).loaded||0,u(h).total):null);var y=_h(),w=p(y),x=p(w),O=p(x),U=_(x,2);{var M=C=>{var Y=vh(),se=p(Y);Z(G=>F(se,`${G??""}%`),[()=>u(b).toFixed(1)]),E(C,Y)};re(U,C=>{u(b)!==null&&C(M)})}var $=_(w,2);{var ee=C=>{var Y=ph(),se=Xe(Y),G=p(se),me=_(se,2),ke=p(me),de=p(ke),pe=_(ke,4),ie=p(pe),_e=_(pe,2),fe=p(_e);Z((ue,he,Se,oe,ve)=>{on(G,`width: ${ue??""}%`),F(de,he),F(ie,Se),F(fe,`(${oe??""} / ${ve??""} B)`)},[()=>Math.max(u(h).progress??0,.5).toFixed(1),()=>po(u(h).loaded||0),()=>po(u(h).total),()=>(u(h).loaded||0).toLocaleString(),()=>u(h).total.toLocaleString()]),E(C,Y)},H=C=>{var Y=gh(),se=_(Xe(Y),2),G=p(se);{var me=de=>{var pe=hh(),ie=Xe(pe),_e=p(ie),fe=_(ie,2),ue=p(fe);Z((he,Se)=>{F(_e,he),F(ue,`(${Se??""} B)`)},[()=>po(u(h).loaded),()=>u(h).loaded.toLocaleString()]),E(de,pe)},ke=de=>{var pe=mh();E(de,pe)};re(G,de=>{u(h).loaded?de(me):de(ke,!1)})}E(C,Y)};re($,C=>{u(h).total?C(ee):C(H,!1)})}Z(()=>{Fu(x,"title",u(h).file),F(O,u(h).file)}),E(m,y)}),Z(()=>F(c,n())),E(t,s),wt()}var wh=I('<span class="thinking-tokens svelte-11gjw00"> </span>'),kh=I('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),xh=I('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Sh=I('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Eh=I('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),Th=I('<span class="cursor svelte-11gjw00">|</span>'),Ah=I(" <!>",1),Ih=I('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),Ch=I('<div class="content svelte-11gjw00"> </div>'),Rh=I('<div><div class="role svelte-11gjw00"> </div> <!></div>');function Oh(t,e){bt(e,!0);let n=Ne(e,"isLast",3,!1),a=Ne(e,"isRunning",3,!1),s=Ne(e,"generationPhase",3,null),o=Ne(e,"numTokens",3,null);dn(()=>qn(`MessageBubble[${e.msg.role}]`));var c=Rh(),f=p(c),m=p(f),h=_(f,2);{var b=w=>{var x=Ih(),O=Xe(x);{var U=G=>{var me=kh(),ke=_(p(me),4);{var de=pe=>{var ie=wh(),_e=p(ie);Z(()=>F(_e,`${o()??""} tokens`)),E(pe,ie)};re(ke,pe=>{o()&&pe(de)})}E(G,me)},M=G=>{var me=xh();E(G,me)};re(O,G=>{a()&&n()&&s()==="thinking"?G(U):a()&&n()&&s()==="preparing"&&G(M,1)})}var $=_(O,2);{var ee=G=>{var me=Sh(),ke=p(me),de=_(p(ke),2),pe=p(de),ie=_(ke,2),_e=p(ie);Z(fe=>{F(pe,`${fe??""} words`),F(_e,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),E(G,me)};re($,G=>{e.msg.thinking&&G(ee)})}var H=_($,2),C=p(H);{var Y=G=>{var me=Eh();E(G,me)},se=G=>{var me=Ah(),ke=Xe(me,!0),de=_(ke);{var pe=ie=>{var _e=Th();E(ie,_e)};re(de,ie=>{a()&&n()&&ie(pe)})}Z(()=>F(ke,e.msg.content)),E(G,me)};re(C,G=>{a()&&n()&&!e.msg.content&&s()!=="thinking"?G(Y):G(se,!1)})}E(w,x)},y=w=>{var x=Ch(),O=p(x);Z(()=>F(O,e.msg.content)),E(w,x)};re(h,w=>{e.msg.role==="assistant"?w(b):w(y,!1)})}Z(()=>{Rt(c,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),F(m,e.msg.role==="user"?"You":"AI")}),E(t,c),wt()}var Ph=I('<span class="cmd-icon svelte-1m7x4wq"> </span>'),Mh=I('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),Dh=I('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function yc(t,e){bt(e,!0);var n=Dh(),a=Xe(n);a.__click=()=>{var x;return(x=e.onexecute)==null?void 0:x.call(e,e.command.id)};var s=p(a);{var o=x=>{var O=Ph(),U=p(O);Z(()=>F(U,e.command.icon)),E(x,O)};re(s,x=>{e.command.icon&&x(o)})}var c=_(s,2),f=p(c),m=p(f),h=_(f,2),b=p(h),y=_(a,2);{var w=x=>{var O=Mh(),U=p(O),M=p(U);Z(()=>F(M,e.command.body)),E(x,O)};re(y,x=>{e.command.body&&x(w)})}Z(()=>{F(m,e.command.name),F(b,e.command.description)}),E(t,n),wt()}Nt(["click"]);class jh{constructor(e,n){this.workerId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var s,o,c;const a=this.handlers.get(e);if(!a)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} worker`};try{(s=n.onProgress)==null||s.call(n,{phase:"executing",actionId:e,actionName:a.name});const f=await a.execute(n);return(o=n.onProgress)==null||o.call(n,{phase:"completed",actionId:e,actionName:a.name,result:f}),f}catch(f){const m={success:!1,error:f,message:f.message||"Unknown error"};return(c=n.onProgress)==null||c.call(n,{phase:"failed",actionId:e,actionName:a.name,error:f.message}),m}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const Lh="https://gmail.googleapis.com/gmail/v1/users/me",Ir={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Sn(t,e,n,a=null){var c;const s={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};a&&(s.body=JSON.stringify(a));const o=await fetch(`${Lh}${n}`,s);if(!o.ok){const m=((c=(await o.json().catch(()=>({}))).error)==null?void 0:c.message)||`Gmail API error: ${o.status}`;throw new Error(m)}return o.status===204?{success:!0}:o.json()}class Nh extends jh{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.SPAM],removeLabelIds:[Ir.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[a]}),{success:!0,message:`Applied label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[a]}),{success:!0,message:`Removed label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[Ir.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await Sn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[Ir.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,a=[],s=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Sn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:a,removeLabelIds:s}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Sn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const qh=new Nh;class Bh{constructor(){this.workers=new Map,this.registerDefaultWorkers()}registerDefaultWorkers(){this.registerWorker(qh)}registerWorker(e){this.workers.set(e.workerId,e)}getWorker(e){return this.workers.get(e)}getAllWorkers(){return Array.from(this.workers.values())}async executeAction(e,n){const a=this.resolveWorkerId(n.event.source),s=this.getWorker(a);return s?s.canExecute(e)?s.execute(e,n):{success:!1,message:`Action "${e}" not supported by ${s.serviceName}`,error:new Error(`Action not supported: ${e}`)}:{success:!1,message:`No worker found for source: ${n.event.source}`,error:new Error(`Worker not found: ${a}`)}}async executePipeline(e,n){var o,c;const a=[];let s=!0;for(const f of e){(o=n.onProgress)==null||o.call(n,{phase:"action_start",actionId:f.id,actionName:f.name});const m=await this.executeAction(f.id,n);a.push({actionId:f.id,actionName:f.name,...m}),m.success||(s=!1),(c=n.onProgress)==null||c.call(n,{phase:"action_complete",actionId:f.id,actionName:f.name,result:m})}return{success:s,results:a,message:s?`All ${a.length} actions completed successfully`:`Pipeline completed with ${a.filter(f=>!f.success).length} failure(s)`}}async executePipelineBatch(e,n,a){var c,f;const s=[];for(let m=0;m<n.length;m++){const h=n[m];(c=a.onProgress)==null||c.call(a,{phase:"batch_event_start",eventIndex:m,totalEvents:n.length,event:h});const b={...a,event:h},y=await this.executePipeline(e,b);s.push({event:h,...y}),(f=a.onProgress)==null||f.call(a,{phase:"batch_event_complete",eventIndex:m,totalEvents:n.length,event:h,result:y})}return{success:s.every(m=>m.success),results:s,total:n.length,successful:s.filter(m=>m.success).length,failed:s.filter(m=>!m.success).length,message:`Processed ${n.length} event(s): ${s.filter(m=>m.success).length} successful, ${s.filter(m=>!m.success).length} failed`}}resolveWorkerId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolveWorkerId(e),a=this.getWorker(n);return a?a.getHandlers():[]}getRequiredScopes(e,n){const a=this.resolveWorkerId(n),s=this.getWorker(a);return s?s.getRequiredScopes(e):[]}}const od=new Bh;async function Fh(t,e){try{e==null||e({phase:"starting",event:t});const n=sessionStorage.getItem("access_token");if(!n)throw new Error("Not authenticated. Please sign in to Gmail first.");const a=Ja(t.type);if(!a||a.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:a,actionCount:a.length});const s={accessToken:n,event:t,onProgress:e},o=await od.executePipeline(a,s);return e==null||e({phase:"done",result:o}),o}catch(n){const a={success:!1,error:n,message:n.message||"Unknown error"};return e==null||e({phase:"error",error:n.message}),a}}async function zh(t,e,n){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=sessionStorage.getItem("access_token");if(!a)throw new Error("Not authenticated. Please sign in to Gmail first.");const s=Ja(t);if(!s||s.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:s,actionCount:s.length});const o=e.map(m=>({type:t,source:"gmail",data:m})),c={accessToken:a,onProgress:n},f=await od.executePipelineBatch(s,o,c);return n==null||n({phase:"done",result:f}),f}catch(a){const s={success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length};return n==null||n({phase:"error",error:a.message}),s}}function bc(){return!!sessionStorage.getItem("access_token")}var Uh=I('<div class="event-subject svelte-1w66m1k"> </div>'),Kh=I('<span class="sep svelte-1w66m1k">Â·</span> ',1),Gh=I('<div class="event-summary svelte-1w66m1k"> </div>'),Wh=I('<span class="tag svelte-1w66m1k"> </span>'),Hh=I('<div class="event-tags svelte-1w66m1k"></div>'),Vh=I('<div class="event-reason svelte-1w66m1k"> </div>'),Yh=I('<div class="commands svelte-1w66m1k"></div>'),Qh=I('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),Xh=I('<span class="event-subject-inline svelte-1w66m1k"> </span>'),Zh=I('<span class="sep svelte-1w66m1k">Â·</span> ',1),Jh=I('<div class="event-summary svelte-1w66m1k"> </div>'),$h=I('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),em=I('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),tm=I("<div> </div>"),nm=I('<span class="email-from svelte-1w66m1k"> </span>'),rm=I('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),am=I('<div class="email-summary svelte-1w66m1k"> </div>'),sm=I('<span class="tag svelte-1w66m1k"> </span>'),im=I('<div class="email-tags svelte-1w66m1k"></div>'),om=I('<span class="step-icon svelte-1w66m1k"> </span>'),lm=I('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),cm=I("<div> </div>"),um=I('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <button class="execute-btn svelte-1w66m1k"><!></button></div> <div class="pipeline-steps svelte-1w66m1k"></div> <!></div></div>'),dm=I('<div class="group-emails svelte-1w66m1k"></div>'),fm=I('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <button class="execute-all-btn svelte-1w66m1k"><!></button></div> <!> <!></div>'),vm=I('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function pm(t,e){bt(e,!0);let n=Oe(jt({})),a=jt({});function s(ee){if(!ee)return"â";const H=ee.replace(/<.*>/,"").trim();return H.length>40?H.slice(0,38)+"â¦":H}function o(ee){if(!ee)return"";try{return new Date(ee).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function c(ee,H){var C;(C=e.oncommand)==null||C.call(e,{event:ee,commandId:H})}async function f(ee,H){if(!bc()){alert("Please sign in to Gmail first (Dashboard page)");return}const C=`single_${H}`;a[C]={running:!0,progress:null,result:null};try{const Y=await Fh(ee,se=>{a[C]={...a[C],progress:se}});a[C]={running:!1,progress:null,result:Y}}catch(Y){a[C]={running:!1,progress:null,result:{success:!1,message:Y.message}}}}async function m(ee,H){if(!bc()){alert("Please sign in to Gmail first (Dashboard page)");return}const C=`batch_${ee}`;a[C]={running:!0,progress:null,result:null};try{const Y=await zh(ee,H,se=>{a[C]={...a[C],progress:se}});a[C]={running:!1,progress:null,result:Y}}catch(Y){a[C]={running:!1,progress:null,result:{success:!1,message:Y.message}}}}function h(ee){A(n,{...u(n),[ee]:!u(n)[ee]},!0)}function b(ee){return ee.split("_").map(H=>H.charAt(0)+H.slice(1).toLowerCase()).join(" ")}function y(ee){return`hsl(${Oi(ee)}, 55%, 55%)`}function w(ee){return a[ee]}var x=Jn(),O=Xe(x);{var U=ee=>{var H=Qh(),C=p(H),Y=p(C),se=p(Y),G=p(se),me=_(se,2),ke=p(me),de=_(Y,2);{var pe=R=>{var T=Uh(),V=p(T);Z(()=>F(V,e.msg.event.data.subject)),E(R,T)};re(de,R=>{var T;(T=e.msg.event.data)!=null&&T.subject&&R(pe)})}var ie=_(de,2),_e=p(ie);{var fe=R=>{var T=_n();Z(V=>F(T,V),[()=>s(e.msg.event.data.from)]),E(R,T)};re(_e,R=>{var T;(T=e.msg.event.data)!=null&&T.from&&R(fe)})}var ue=_(_e,2);{var he=R=>{var T=Kh(),V=_(Xe(T),1,!0);Z(Te=>F(V,Te),[()=>o(e.msg.event.data.date)]),E(R,T)};re(ue,R=>{var T;(T=e.msg.event.data)!=null&&T.date&&R(he)})}var Se=_(ie,2);{var oe=R=>{var T=Gh(),V=p(T);Z(()=>F(V,e.msg.event.metadata.summary)),E(R,T)};re(Se,R=>{var T;(T=e.msg.event.metadata)!=null&&T.summary&&R(oe)})}var ve=_(Se,2);{var le=R=>{var T=Hh();At(T,21,()=>e.msg.event.metadata.tags,Ut,(V,Te)=>{var Ce=Wh(),P=p(Ce);Z(()=>F(P,u(Te))),E(V,Ce)}),E(R,T)};re(ve,R=>{var T,V;(V=(T=e.msg.event.metadata)==null?void 0:T.tags)!=null&&V.length&&R(le)})}var ce=_(ve,2);{var te=R=>{var T=Vh(),V=p(T);Z(()=>F(V,e.msg.event.metadata.reason)),E(R,T)};re(ce,R=>{var T;(T=e.msg.event.metadata)!=null&&T.reason&&R(te)})}var ne=_(C,2);{var W=R=>{var T=Yh();At(T,21,()=>e.msg.commands,Ut,(V,Te)=>{yc(V,{get command(){return u(Te)},onexecute:Ce=>c(e.msg.event,Ce)})}),E(R,T)};re(ne,R=>{var T;(T=e.msg.commands)!=null&&T.length&&R(W)})}Z(()=>{F(G,e.msg.event.type),F(ke,e.msg.event.source)}),E(ee,H)},M=ee=>{var H=em(),C=p(H),Y=p(C),se=p(Y),G=_(C,2);At(G,17,()=>e.msg.items,Ut,(me,ke)=>{var de=$h(),pe=p(de),ie=p(pe),_e=p(ie),fe=p(_e),ue=_(_e,2);{var he=R=>{var T=Xh(),V=p(T);Z(()=>F(V,u(ke).event.data.subject)),E(R,T)};re(ue,R=>{var T;(T=u(ke).event.data)!=null&&T.subject&&R(he)})}var Se=_(ie,2),oe=p(Se);{var ve=R=>{var T=_n();Z(V=>F(T,V),[()=>s(u(ke).event.data.from)]),E(R,T)};re(oe,R=>{var T;(T=u(ke).event.data)!=null&&T.from&&R(ve)})}var le=_(oe,2);{var ce=R=>{var T=Zh(),V=_(Xe(T),1,!0);Z(Te=>F(V,Te),[()=>o(u(ke).event.data.date)]),E(R,T)};re(le,R=>{var T;(T=u(ke).event.data)!=null&&T.date&&R(ce)})}var te=_(Se,2);{var ne=R=>{var T=Jh(),V=p(T);Z(()=>F(V,u(ke).event.metadata.summary)),E(R,T)};re(te,R=>{var T;(T=u(ke).event.metadata)!=null&&T.summary&&R(ne)})}var W=_(pe,2);At(W,21,()=>u(ke).commands,Ut,(R,T)=>{yc(R,{get command(){return u(T)},onexecute:V=>c(u(ke).event,V)})}),Z(()=>F(fe,u(ke).event.type)),E(me,de)}),Z(()=>F(se,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),E(ee,H)},$=ee=>{var H=vm(),C=p(H),Y=_(p(C),2),se=p(Y),G=_(C,2);At(G,17,()=>e.msg.groups,Ut,(me,ke)=>{const de=lt(()=>u(n)[u(ke).eventType]??!0),pe=lt(()=>w(`batch_${u(ke).eventType}`));var ie=fm(),_e=p(ie),fe=p(_e);fe.__click=()=>h(u(ke).eventType);var ue=p(fe);let he;var Se=p(ue),oe=_(ue,2),ve=p(oe),le=_(oe,4);let ce;var te=_(fe,2);te.__click=ye=>{ye.stopPropagation(),m(u(ke).eventType,u(ke).emails)};var ne=p(te);{var W=ye=>{var xe=_n("â³ Running...");E(ye,xe)},R=ye=>{var xe=_n();Z(()=>F(xe,u(pe).result.success?`â Done (${u(pe).result.successful}/${u(pe).result.total})`:`â Failed (${u(pe).result.failed}/${u(pe).result.total})`)),E(ye,xe)},T=ye=>{var xe=_n();Z(()=>F(xe,`â¶ Execute All (${u(ke).emails.length??""})`)),E(ye,xe)};re(ne,ye=>{var xe,Pe;(xe=u(pe))!=null&&xe.running?ye(W):(Pe=u(pe))!=null&&Pe.result?ye(R,1):ye(T,!1)})}var V=_(_e,2);{var Te=ye=>{var xe=tm();let Pe;var Ue=p(xe);Z(()=>{Pe=Rt(xe,1,"batch-result svelte-1w66m1k",null,Pe,{success:u(pe).result.success,error:!u(pe).result.success}),F(Ue,u(pe).result.message)}),E(ye,xe)};re(V,ye=>{var xe;(xe=u(pe))!=null&&xe.result&&ye(Te)})}var Ce=_(V,2);{var P=ye=>{var xe=dm();At(xe,21,()=>u(ke).emails,Ut,(Pe,Ue)=>{const Ye=lt(()=>w(`single_${u(Ue).emailId}`));var _t=um(),St=p(_t),Et=p(St),Ze=p(Et),Be=_(Et,2),We=p(Be);{var pt=Qe=>{var be=nm(),dt=p(be);Z(rn=>F(dt,rn),[()=>s(u(Ue).from)]),E(Qe,be)};re(We,Qe=>{u(Ue).from&&Qe(pt)})}var Mt=_(We,2);{var Zt=Qe=>{var be=rm(),dt=_(Xe(be)),rn=p(dt);Z(Xt=>F(rn,Xt),[()=>o(u(Ue).date)]),E(Qe,be)};re(Mt,Qe=>{u(Ue).date&&Qe(Zt)})}var ut=_(Be,2);{var Je=Qe=>{var be=am(),dt=p(be);Z(()=>F(dt,u(Ue).summary)),E(Qe,be)};re(ut,Qe=>{u(Ue).summary&&Qe(Je)})}var Ve=_(ut,2);{var Tt=Qe=>{var be=im();At(be,21,()=>u(Ue).tags,Ut,(dt,rn)=>{var Xt=sm(),hr=p(Xt);Z(()=>F(hr,u(rn))),E(dt,Xt)}),E(Qe,be)};re(Ve,Qe=>{var be;(be=u(Ue).tags)!=null&&be.length&&Qe(Tt)})}var qt=_(St,2),Jt=p(qt),Qt=_(p(Jt),2);Qt.__click=()=>f({type:u(ke).eventType,source:"gmail",data:u(Ue)},u(Ue).emailId);var Bt=p(Qt);{var It=Qe=>{var be=_n("â³ Running...");E(Qe,be)},$t=Qe=>{var be=_n();Z(()=>F(be,u(Ye).result.success?"â Done":"â Failed")),E(Qe,be)},at=Qe=>{var be=_n("â¶ Execute");E(Qe,be)};re(Bt,Qe=>{var be,dt;(be=u(Ye))!=null&&be.running?Qe(It):(dt=u(Ye))!=null&&dt.result?Qe($t,1):Qe(at,!1)})}var De=_(Jt,2);At(De,21,()=>u(ke).commands,Ut,(Qe,be,dt)=>{var rn=lm(),Xt=p(rn);Xt.textContent=dt+1;var hr=_(Xt,2),Bn=p(hr);{var Ct=Rn=>{var kt=om(),Gt=p(kt);Z(()=>F(Gt,u(be).icon)),E(Rn,kt)};re(Bn,Rn=>{u(be).icon&&Rn(Ct)})}var kn=_(Bn,2),Fn=p(kn),mn=_(kn,2),zn=p(mn);Z(()=>{F(Fn,u(be).name),F(zn,u(be).description)}),E(Qe,rn)});var Lt=_(De,2);{var Kt=Qe=>{var be=cm();let dt;var rn=p(be);Z(()=>{dt=Rt(be,1,"execution-result svelte-1w66m1k",null,dt,{success:u(Ye).result.success,error:!u(Ye).result.success}),F(rn,u(Ye).result.message)}),E(Qe,be)};re(Lt,Qe=>{var be;(be=u(Ye))!=null&&be.result&&Qe(Kt)})}Z(()=>{var Qe;F(Ze,u(Ue).subject),Qt.disabled=(Qe=u(Ye))==null?void 0:Qe.running}),E(Pe,_t)}),E(ye,xe)};re(Ce,ye=>{u(de)&&ye(P)})}Z((ye,xe)=>{var Pe;he=on(ue,"",he,ye),F(Se,xe),F(ve,u(ke).emails.length),ce=Rt(le,0,"chevron svelte-1w66m1k",null,ce,{open:u(de)}),te.disabled=(Pe=u(pe))==null?void 0:Pe.running},[()=>({background:y(u(ke).eventType)}),()=>b(u(ke).eventType)]),E(me,ie)}),Z(()=>F(se,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} group${e.msg.groups.length===1?"":"s"}`)),E(ee,H)};re(O,ee=>{e.msg.type==="event"?ee(U):e.msg.type==="event-batch"?ee(M,1):e.msg.type==="events-grouped"&&ee($,2)})}E(t,x),wt()}Nt(["click"]);var hm=I('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),mm=I('<span class="edate svelte-mt5nvh"> </span>'),gm=I('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),_m=I('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),ym=I('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),bm=I('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),wm=I('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function km(t,e){bt(e,!0);let n=Ne(e,"pendingData",3,null),a=Oe(null),s=Oe(null);function o(x){A(a,u(a)===x?null:x,!0),A(s,null)}function c(x){return x.split("_").map(O=>O.charAt(0)+O.slice(1).toLowerCase()).join(" ")}function f(x){if(!x)return"";try{return new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function m(x){if(!x)return"";const O=x.replace(/<.*>/,"").trim();return O.length>24?O.slice(0,22)+"â¦":O}var h={toggleGroup:o},b=Jn(),y=Xe(b);{var w=x=>{var O=wm(),U=p(O),M=p(U),$=_(U,2);At($,20,()=>n().order,C=>C,(C,Y)=>{const se=lt(()=>n().groups[Y]),G=lt(()=>No(Y)),me=lt(()=>u(a)===Y);var ke=hm();let de;ke.__click=()=>o(Y);let pe;var ie=p(ke);let _e;var fe=_(ie),ue=_(fe),he=p(ue);Z(Se=>{de=Rt(ke,1,"chip svelte-mt5nvh",null,de,{active:u(me)}),pe=on(ke,"",pe,{"--c":u(G)}),_e=on(ie,"",_e,{background:u(G)}),F(fe,` ${Se??""} `),F(he,u(se).length)},[()=>c(Y)]),E(C,ke)});var ee=_($,2);{var H=C=>{const Y=lt(()=>n().groups[u(a)]),se=lt(()=>No(u(a)));var G=bm(),me=p(G);let ke;var de=p(me);de.__click=()=>{A(a,null),A(s,null)};var pe=_(de,2),ie=p(pe),_e=_(pe,2),fe=p(_e),ue=_(me,2);At(ue,21,()=>u(Y),le=>le.emailId,(le,ce)=>{var te=gm(),ne=p(te);ne.__click=()=>{var Pe;return(Pe=e.onaskai)==null?void 0:Pe.call(e,`Tell me about the email "${u(ce).subject}" from ${u(ce).from}`)};var W=p(ne),R=p(W),T=_(W,2),V=p(T),Te=_(V);{var Ce=Pe=>{var Ue=mm(),Ye=p(Ue);Z(_t=>F(Ye,_t),[()=>f(u(ce).date)]),E(Pe,Ue)};re(Te,Pe=>{u(ce).date&&Pe(Ce)})}var P=_(ne,2),ye=p(P);ye.__click=()=>{var Pe;return(Pe=e.onmarkacted)==null?void 0:Pe.call(e,u(ce).emailId)};var xe=_(ye,2);xe.__click=()=>{var Pe;return(Pe=e.ondismiss)==null?void 0:Pe.call(e,u(ce).emailId)},Z(Pe=>{F(R,u(ce).subject),F(V,Pe)},[()=>m(u(ce).from)]),E(le,te)});var he=_(ue,2),Se=p(he);{var oe=le=>{var ce=_m(),te=Xe(ce);te.__click=()=>u(Y).forEach(W=>{var R;return(R=e.onmarkacted)==null?void 0:R.call(e,W.emailId)});var ne=_(te,2);ne.__click=()=>A(s,u(a),!0),E(le,ce)},ve=le=>{var ce=ym(),te=Xe(ce),ne=p(te),W=_(te,2);W.__click=()=>A(s,null);var R=_(W,2);R.__click=()=>{var T;(T=e.oncleargroup)==null||T.call(e,u(a)),A(s,null),A(a,null)},Z(()=>F(ne,`Remove ${u(Y).length??""}?`)),E(le,ce)};re(Se,le=>{u(s)!==u(a)?le(oe):le(ve,!1)})}Z(le=>{ke=on(me,"",ke,{"border-color":u(se)}),F(ie,le),F(fe,u(Y).length)},[()=>c(u(a))]),E(C,G)};re(ee,C=>{u(a)&&n().groups[u(a)]&&C(H)})}Z(()=>F(M,`${n().total??""} item${n().total!==1?"s":""} need attention`)),E(x,O)};re(y,x=>{n()&&n().total>0&&x(w)})}return E(t,b),wt(h)}Nt(["click"]);var xm=I('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Sm=I('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Em=I('<div class="strip svelte-1ed7zw1"><!></div>');function Tm(t,e){let n=Ne(e,"hasScanData",3,!1),a=Ne(e,"engineReady",3,!1),s=Ne(e,"isScanning",3,!1),o=lt(()=>a()&&!n()&&!s()),c=lt(()=>u(o)||s());var f=Jn(),m=Xe(f);{var h=b=>{var y=Em(),w=p(y);{var x=U=>{var M=xm();E(U,M)},O=U=>{var M=Sm();M.__click=function(...$){var ee;(ee=e.onscan)==null||ee.apply(this,$)},E(U,M)};re(w,U=>{s()?U(x):u(o)&&U(O,1)})}E(b,y)};re(m,b=>{u(c)&&b(h)})}E(t,f)}Nt(["click"]);var Am=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Im=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Cm=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Rm=I('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),Om=I('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),Pm=I('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),Mm=I('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function Dm(t,e){bt(e,!0),dn(()=>qn("GpuPanel"));var n=Mm(),a=p(n),s=_(p(a),2),o=_(p(s),2),c=p(o),f=_(s,2),m=_(p(f),2),h=p(m),b=_(f,2);{var y=C=>{var Y=Am(),se=_(p(Y),2),G=p(se);Z(()=>F(G,e.gpuInfo.device)),E(C,Y)};re(b,C=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&C(y)})}var w=_(b,2);{var x=C=>{var Y=Im(),se=_(p(Y),2),G=p(se);Z(me=>F(G,me),[()=>Do(e.gpuInfo.limits.maxBufferSize)]),E(C,Y)};re(w,C=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxBufferSize&&C(x)})}var O=_(w,2);{var U=C=>{var Y=Cm(),se=_(p(Y),2),G=p(se);Z(()=>F(G,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),E(C,Y)};re(O,C=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxComputeInvocationsPerWorkgroup&&C(U)})}var M=_(O,2);{var $=C=>{var Y=Rm(),se=_(p(Y),2),G=p(se);Z(me=>F(G,me),[()=>Do(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),E(C,Y)};re(M,C=>{var Y;(Y=e.gpuInfo.limits)!=null&&Y.maxComputeWorkgroupStorageSize&&C($)})}var ee=_(M,2);{var H=C=>{var Y=Pm(),se=p(Y),G=p(se),me=_(se,2);At(me,21,()=>e.gpuInfo.features,Ut,(ke,de)=>{var pe=Om(),ie=p(pe);Z(()=>F(ie,u(de))),E(ke,pe)}),Z(()=>F(G,`Features (${e.gpuInfo.features.length??""})`)),E(C,Y)};re(ee,C=>{var Y;(Y=e.gpuInfo.features)!=null&&Y.length&&C(H)})}Z(()=>{F(c,e.gpuInfo.vendor),F(h,e.gpuInfo.architecture)}),E(t,n),wt()}var jm=I('<button class="gpu-badge svelte-1ktw27c"> </button>'),Lm=I('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),Nm=I('<span class="stats svelte-1ktw27c"> </span>'),qm=I('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Bm=I('<span class="stats preparing svelte-1ktw27c"> </span>'),Fm=I('<span class="stats svelte-1ktw27c"> </span>'),zm=I('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Um=I('<button class="btn svelte-1ktw27c">Stop</button>'),Km=I('<button class="btn primary svelte-1ktw27c">Send</button>'),Gm=I('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Wm(t,e){bt(e,!0),dn(()=>qn("ChatView"));let n=Ne(e,"messages",19,()=>[]),a=Ne(e,"pendingData",3,null),s=Ne(e,"hasScanData",3,!1),o=Ne(e,"engineReady",3,!1),c=Ne(e,"isScanning",3,!1),f=Ne(e,"isRunning",3,!1),m=Ne(e,"tps",3,null),h=Ne(e,"numTokens",3,null),b=Ne(e,"generationPhase",3,null),y=Ne(e,"gpuInfo",3,null),w=Ne(e,"backend",3,"webgpu"),x=Ne(e,"chatContainer",15),O=Oe(""),U=Oe(!1);function M(T){T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),$())}function $(){const T=u(O).trim();!T||f()||(A(O,""),e.onsend(T))}function ee(T){T&&!f()&&e.onsend(T)}var H=Gm(),C=p(H),Y=p(C);{var se=T=>{var V=jm();V.__click=()=>A(U,!u(U));var Te=p(V);Z(()=>F(Te,`WebGPU ${u(U)?"â²":"â¼"}`)),E(T,V)},G=T=>{var V=Lm();E(T,V)};re(Y,T=>{y()?T(se):w()==="ollama"&&T(G,1)})}var me=_(Y,2);{var ke=T=>{var V=Nm(),Te=p(V);Z((Ce,P)=>F(Te,`${h()??""} tokens in ${Ce??""}s
        (${P??""} tok/s)`),[()=>(h()/m()).toFixed(1),()=>m().toFixed(1)]),E(T,V)},de=T=>{var V=qm();E(T,V)},pe=T=>{var V=Bm(),Te=p(V);Z(Ce=>F(Te,`thinking... ${Ce??""}`),[()=>m()?`${m().toFixed(0)} tok/s`:""]),E(T,V)},ie=T=>{var V=Fm(),Te=p(V);Z(Ce=>F(Te,`${Ce??""} tok/s`),[()=>m().toFixed(1)]),E(T,V)};re(me,T=>{m()&&!f()?T(ke):f()&&b()==="preparing"?T(de,1):f()&&b()==="thinking"?T(pe,2):m()&&f()&&T(ie,3)})}var _e=_(me,4);_e.__click=function(...T){var V;(V=e.onreset)==null||V.apply(this,T)};var fe=_(C,2);{var ue=T=>{Dm(T,{get gpuInfo(){return y()}})};re(fe,T=>{u(U)&&y()&&T(ue)})}var he=_(fe,2),Se=p(he);{var oe=T=>{var V=zm();E(T,V)};re(Se,T=>{n().length===0&&!(a()&&a().total>0)&&T(oe)})}var ve=_(Se,2);At(ve,17,n,Ut,(T,V,Te)=>{var Ce=Jn(),P=Xe(Ce);{var ye=Ue=>{km(Ue,{get pendingData(){return u(V).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:ee})},xe=Ue=>{pm(Ue,{get msg(){return u(V)},get oncommand(){return e.oncommand}})},Pe=Ue=>{{let Ye=lt(()=>Te===n().length-1);Oh(Ue,{get msg(){return u(V)},get isLast(){return u(Ye)},get isRunning(){return f()},get generationPhase(){return b()},get numTokens(){return h()}})}};re(P,Ue=>{u(V).type==="dashboard"?Ue(ye):u(V).type==="event"||u(V).type==="event-batch"||u(V).type==="events-grouped"?Ue(xe,1):Ue(Pe,!1)})}E(T,Ce)}),zu(he,T=>x(T),()=>x());var le=_(he,2);Tm(le,{get hasScanData(){return s()},get engineReady(){return o()},get isScanning(){return c()},get onscan(){return e.onscan}});var ce=_(le,2),te=p(ce);te.__keydown=M;var ne=_(te,2);{var W=T=>{var V=Um();V.__click=function(...Te){var Ce;(Ce=e.onstop)==null||Ce.apply(this,Te)},E(T,V)},R=T=>{var V=Km();V.__click=$,Z(Te=>V.disabled=Te,[()=>!u(O).trim()]),E(T,V)};re(ne,T=>{f()?T(W):T(R,!1)})}Z(()=>{_e.disabled=f(),te.disabled=f()}),or(te,()=>u(O),T=>A(O,T)),E(t,H),wt()}Nt(["click","keydown"]);var Hm=I('<div class="container center svelte-1bi93vx"><!> <!></div>');function Vm(t,e){bt(e,!0);const n=!!navigator.gpu,a=Ku();let s=Oe(jt(localStorage.getItem("aiBackend")||"webgpu"));function o(){const W=localStorage.getItem("selectedModel");return W||(u(s)==="webgpu"?Sr[0].id:fr[0].name)}let c=Oe(jt(o())),f=Oe(null),m=Oe(null),h=Oe(""),b=Oe(jt([])),y=Oe(jt([])),w=Oe(!1),x=Oe(null),O=Oe(null),U=Oe(null),M=Oe(null),$=Oe(null),ee=Oe(null),H=Oe(!1),C=Oe(!1),Y=!1;dn(()=>{a.check(),a.isReady&&se();const W=a.onMessage(R=>{switch(R.status){case"webgpu-info":A(M,R.data,!0);break;case"loading":A(f,"loading"),A(h,R.data,!0);break;case"initiate":A(b,[...u(b),R],!0);break;case"progress":A(b,u(b).map(T=>T.file===R.file?{...T,...R}:T),!0);break;case"done":A(b,u(b).filter(T=>T.file!==R.file),!0);break;case"ready":A(f,"ready"),se();break;case"start":if(!u(w))break;A($,R.phase||"preparing",!0),A(y,[...u(y),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!u(w))break;A($,R.phase,!0);break;case"thinking":{if(!u(w))break;A(x,R.tps,!0),A(O,R.numTokens,!0);const T=u(y)[u(y).length-1];A(y,[...u(y).slice(0,-1),{...T,thinking:(T.thinking||"")+R.content}],!0),fe();break}case"thinking-done":{if(!u(w))break;A(x,R.tps,!0),A(O,R.numTokens,!0);const T=u(y)[u(y).length-1];A(y,[...u(y).slice(0,-1),{...T,thinking:R.content}],!0);break}case"update":{if(!u(w))break;A(x,R.tps,!0),A(O,R.numTokens,!0);const T=u(y)[u(y).length-1];A(y,[...u(y).slice(0,-1),{...T,content:T.content+R.output}],!0),fe();break}case"complete":if(!u(w))break;R.tps!==void 0&&A(x,R.tps,!0),R.numTokens!==void 0&&A(O,R.numTokens,!0),A(w,!1),A($,null),G();break;case"error":A(m,R.data,!0),u(f)==="loading"&&A(f,null),u(w)&&(A(w,!1),A($,null));break}});return()=>W()});async function se(){if(!(Y||u(y).length>0))try{const W=await hc();A(ee,W,!0),W&&(Y=!0,A(y,[{role:"assistant",type:"dashboard",pendingData:W}],!0),fe());const R=await Lo();A(H,R.classified>0)}catch{}}async function G(){try{const W=await hc();A(ee,W,!0);const R=u(y).findIndex(V=>V.type==="dashboard");R!==-1&&(W&&W.total>0?A(y,u(y).map((V,Te)=>Te===R?{...V,pendingData:W}:V),!0):A(y,u(y).filter((V,Te)=>Te!==R),!0));const T=await Lo();A(H,T.classified>0)}catch{}}async function me(W){await bi(W,"acted"),await G()}async function ke(W){await bi(W,"dismissed"),await G()}async function de(W){await sd(W),await G()}async function pe(W){await ul(W),await G()}async function ie(){if(u(C)||!a.isReady)return;A(C,!0);let W=null;try{if(await rd(a,{count:20,onProgress:R=>{var T;R.phase==="done"&&((T=R.results)==null?void 0:T.length)>0&&(W=R.results)}}),await G(),(W==null?void 0:W.length)>0){const R=Tp(W);A(y,[...u(y),R],!0),fe()}u(ee)&&!u(y).some(R=>R.type==="dashboard")&&(A(y,[{role:"assistant",type:"dashboard",pendingData:u(ee)},...u(y)],!0),fe())}catch(R){console.error("Scan failed:",R)}finally{A(C,!1)}}function _e({event:W,commandId:R}){var T,V;`${R}${W.type}${((T=W.data)==null?void 0:T.subject)||"unknown"}`,A(y,[...u(y),{role:"assistant",content:`Command: ${R}

This command is not yet implemented. In the future, "${R}" will be executed on the ${W.source} event "${((V=W.data)==null?void 0:V.subject)||""}".`}],!0),fe()}function fe(){ju().then(()=>{u(U)&&(u(U).scrollTop=u(U).scrollHeight)})}function ue(){A(f,"loading"),localStorage.setItem("selectedModel",u(c)),localStorage.setItem("aiBackend",u(s)),u(s)==="ollama"&&A(M,null),a.loadModel(u(c))}Sa(()=>{u(s)==="webgpu"&&!Sr.find(W=>W.id===u(c))?A(c,Sr[0].id,!0):u(s)==="ollama"&&!fr.find(W=>W.name===u(c))&&A(c,fr[0].name,!0)});async function he(W){if(!W||u(w))return;if(W.trim().toLowerCase()==="/events"){A(y,[...u(y),{role:"user",content:W}],!0);try{const V=await ad();if(!V.order.length)A(y,[...u(y),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const Te=Ap(V);A(y,[...u(y),Te],!0)}}catch(V){A(y,[...u(y),{role:"assistant",content:`Failed to load events: ${V.message}`}],!0)}fe();return}A(y,[...u(y),{role:"user",content:W}],!0),A(x,null),A(w,!0);let R=[];try{const Te=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(W)?await lp(W):await op();Te&&(R=[{role:"system",content:Te}])}catch{}const T=u(y).filter(V=>V.type!=="dashboard"&&V.type!=="events-grouped"&&V.type!=="event-batch"&&V.type!=="event").map(V=>({role:V.role,content:V.content}));a.generate([...R,...T]),fe()}function Se(){a.interrupt()}function oe(){a.reset(),A(y,[],!0),A(x,null),A(O,null),Y=!1,se()}var ve=Jn(),le=Xe(ve);{var ce=W=>{var R=Hm(),T=p(R);Lp(T,{get isWebGPUAvailable(){return n},get backend(){return u(s)},set backend(P){A(s,P,!0)}});var V=_(T,2);{var Te=P=>{Qp(P,{get gpuInfo(){return u(M)},get error(){return u(m)},onload:ue,get selectedModel(){return u(c)},set selectedModel(ye){A(c,ye,!0)}})},Ce=P=>{fh(P,{onload:ue,get selectedModel(){return u(c)},set selectedModel(ye){A(c,ye,!0)},get error(){return u(m)},set error(ye){A(m,ye,!0)}})};re(V,P=>{u(s)==="webgpu"?P(Te):u(s)==="ollama"&&P(Ce,1)})}E(W,R)},te=W=>{bh(W,{get message(){return u(h)},get items(){return u(b)}})},ne=W=>{Wm(W,{get messages(){return u(y)},get pendingData(){return u(ee)},get hasScanData(){return u(H)},get engineReady(){return a.isReady},get isScanning(){return u(C)},get isRunning(){return u(w)},get tps(){return u(x)},get numTokens(){return u(O)},get generationPhase(){return u($)},get gpuInfo(){return u(M)},get backend(){return u(s)},onsend:he,onstop:Se,onreset:oe,onmarkacted:me,ondismiss:ke,onremove:de,oncleargroup:pe,onscan:ie,oncommand:_e,get chatContainer(){return u(U)},set chatContainer(R){A(U,R,!0)}})};re(le,W=>{u(f)===null?W(ce):u(f)==="loading"?W(te,1):W(ne,!1)})}E(t,ve),wt()}const wc="https://accounts.google.com/gsi/client",Ym="https://www.googleapis.com/auth/gmail.readonly",dl="me-ai:oauth-token",fl=300*1e3;let Is=null,Es=null,Zr=0;function ld(t,e){Zr=Date.now()+e*1e3;try{sessionStorage.setItem(dl,JSON.stringify({access_token:t,expires_at:Zr}))}catch{}}function qo(){Zr=0;try{sessionStorage.removeItem(dl)}catch{}}function Qm(){try{const t=sessionStorage.getItem(dl);if(!t)return null;const{access_token:e,expires_at:n}=JSON.parse(t);return!e||Date.now()>n-fl?(qo(),null):(Zr=n,{access_token:e})}catch{return qo(),null}}function Xm(){return Zr>0&&Date.now()<Zr-fl}function Zm(){return Zr<=0?0:Math.max(0,Zr-fl-Date.now())}function kc(){return new Promise((t,e)=>{if(!Is){e(new Error("Google Auth not initialized."));return}Es=n=>{n.error?e(new Error(n.error_description||n.error)):(ld(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Is.requestAccessToken({prompt:""})})}function Jm(){return new Promise((t,e)=>{var s,o;if((o=(s=window.google)==null?void 0:s.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${wc}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=wc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function xc(t){await Jm(),Is=google.accounts.oauth2.initTokenClient({client_id:t,scope:Ym,callback:e=>{Es&&(Es(e),Es=null)}})}function $m(){return new Promise((t,e)=>{if(!Is){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Es=n=>{n.error?e(new Error(n.error_description||n.error)):(ld(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Is.requestAccessToken()})}function eg(t){return qo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}const ln="gmail",Sc=8,cd=50,ud=100;async function tg(t,{limit:e=cd,onProgress:n=()=>{},signal:a}={}){var c;const s=await Ge.syncState.get(ln);if(s!=null&&s.historyId)try{return await ig(t,s,n,a)}catch(f){if(f instanceof ll&&(f.status===404||f.code==="notFound")||((c=f.message)==null?void 0:c.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Ge.syncState.delete(ln);else throw f}return await ag(t,e===0?1/0:e,n,a)}async function ng(t,{limit:e=cd,onProgress:n=()=>{},signal:a}={}){const s=await Ge.syncState.get(ln);return s!=null&&s.oldestPageToken?await sg(t,s,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function rg(){const t=await Ge.syncState.get(ln);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function dd(){await Ge.transaction("rw",[Ge.items,Ge.syncState],async()=>{await Ge.items.where("sourceType").equals(ln).delete(),await Ge.syncState.delete(ln)})}async function ag(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Ta(a);const s=await Gu(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(s.messagesTotal||e,e)});const o=[];let c,f=null;for(;o.length<e;){Ta(a);const y=e-o.length,w=await Wu(t,{maxResults:Math.min(ud,y),pageToken:c}),x=(w.messages||[]).map(O=>O.id);if(o.push(...x),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(s.messagesTotal||e,e)}),c=w.nextPageToken,!c||x.length===0)break}if(f=c||null,o.length===0)return await Ge.syncState.put({sourceType:ln,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:m,errors:h}=await fd(t,o,n,a),b=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:b,oldestPageToken:f}),n({phase:"done",message:`Synced ${m} messages`,current:m,total:m}),{added:m,deleted:0,errors:h}}async function sg(t,e,n,a,s){a({phase:"listing",message:"Loading more messages...",current:0}),Ta(s);const o=[];let c=e.oldestPageToken,f=null;for(;o.length<n;){Ta(s);const y=n-o.length,w=await Wu(t,{maxResults:Math.min(ud,y),pageToken:c}),x=(w.messages||[]).map(O=>O.id);if(o.push(...x),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),c=w.nextPageToken,!c||x.length===0)break}if(f=c||null,o.length===0)return await Ge.syncState.update(ln,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:m,errors:h}=await fd(t,o,a,s),b=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.update(ln,{totalItems:b,lastSyncAt:Date.now(),oldestPageToken:f}),a({phase:"done",message:f?`Downloaded ${m} more (more available)`:`Downloaded ${m} more (all synced)`,current:b,total:b}),{added:m,errors:h}}async function ig(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Ta(a);let s=0,o=0,c=0,f,m=e.historyId;do{Ta(a);const b=await Xv(t,{startHistoryId:e.historyId,pageToken:f});if(m=b.historyId||m,f=b.nextPageToken,!!b.history){for(const y of b.history){if(y.messagesAdded){const w=y.messagesAdded.map(O=>O.message.id),x=[...new Set(w.filter(O=>O))];if(x.length>0){const O=await Promise.allSettled(x.map(M=>Hu(t,M))),U=[];for(const M of O)M.status==="fulfilled"?U.push(vd(M.value)):c++;U.length>0&&(await Ge.items.bulkPut(U),await pd(U),s+=U.length)}}if(y.messagesDeleted){const w=y.messagesDeleted.map(x=>ol(ln,x.message.id)).filter(x=>x);w.length>0&&(await Ge.items.bulkDelete(w),o+=w.length)}}n({phase:"syncing",message:`Changes: +${s} -${o}`,current:s+o})}}while(f);const h=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:m,lastSyncAt:Date.now(),totalItems:h,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:s===0&&o===0?"Already up to date":`Synced: +${s} -${o}`,current:h,total:h}),{added:s,deleted:o,errors:c}}async function fd(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let s=0,o=0;for(let c=0;c<e.length;c+=Sc){Ta(a);const f=e.slice(c,c+Sc),m=await Promise.allSettled(f.map(b=>Hu(t,b))),h=[];for(const b of m)b.status==="fulfilled"?h.push(vd(b.value)):o++;h.length>0&&(await Ge.items.bulkPut(h),await pd(h)),s+=h.length,n({phase:"downloading",message:`Downloaded ${s} of ${e.length} messages`,current:s,total:e.length})}return{added:s,errors:o}}function vd(t){const e=Kr(t,"From"),n=Kr(t,"To"),a=Kr(t,"Cc"),s=Kr(t,"Subject")||"(no subject)",o=Kr(t,"Date"),c=Kr(t,"Message-ID"),f=Kr(t,"In-Reply-To"),m=Kr(t,"References");let h;try{h=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{h=Date.now()}return{id:ol(ln,t.id),sourceType:ln,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:s,snippet:t.snippet||"",body:Zv(t),htmlBody:Jv(t),date:h,labels:t.labelIds||[],messageId:c,inReplyTo:f,references:m,raw:t,syncedAt:Date.now()}}async function pd(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const s=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of s){const c=og(o);c&&!e.has(c.email)&&e.set(c.email,{...c,date:n.date})}}for(const[n,{name:a,date:s}]of e)try{const o=await Ge.contacts.where("email").equals(n).first();if(o){const c={};a&&!o.name&&(c.name=a),s>(o.lastSeen||0)&&(c.lastSeen=s),Object.keys(c).length>0&&await Ge.contacts.update(o.id,c)}else await Ge.contacts.add({email:n,name:a||"",firstSeen:s,lastSeen:s})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function og(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),s=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:s}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Ta(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var lg=I(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">To access Gmail from the browser, you need a Google Cloud OAuth Client ID.
      This stays in your browser â no data is sent to any server.</p> <div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
            is required because the app is deployed at a subpath. Changes may take a
            few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></div>`);function cg(t,e){bt(e,!0);let n=Ne(e,"clientIdInput",15);dn(()=>qn("SetupGuide"));let a=Oe(null);async function s(W){try{await navigator.clipboard.writeText(W),A(a,W,!0),setTimeout(()=>{A(a,null)},1500)}catch{const R=document.createElement("input");R.value=W,document.body.appendChild(R),R.select(),document.execCommand("copy"),document.body.removeChild(R),A(a,W,!0),setTimeout(()=>{A(a,null)},1500)}}const o="http://localhost:5173",c="https://cypherkitty.github.io",f="https://cypherkitty.github.io/me-ai/";var m=lg(),h=p(m),b=_(p(h),4),y=_(p(b),6),w=_(p(y),2),x=_(p(w),2),O=_(p(x),2),U=p(O);U.__click=()=>s(o);var M=p(U);M.textContent="http://localhost:5173";var $=_(M,2),ee=p($),H=_(U,2);H.__click=()=>s(c);var C=p(H);C.textContent="https://cypherkitty.github.io";var Y=_(C,2),se=p(Y),G=_(x,2),me=_(p(G),2),ke=p(me);ke.__click=()=>s(o);var de=p(ke);de.textContent="http://localhost:5173";var pe=_(de,2),ie=p(pe),_e=_(ke,2);_e.__click=()=>s(c);var fe=p(_e);fe.textContent="https://cypherkitty.github.io";var ue=_(fe,2),he=p(ue),Se=_(_e,2);Se.__click=()=>s(f);var oe=p(Se);oe.textContent="https://cypherkitty.github.io/me-ai/";var ve=_(oe,2),le=p(ve),ce=_(b,2),te=p(ce);te.__keydown=W=>W.key==="Enter"&&e.onsave();var ne=_(te,2);ne.__click=function(...W){var R;(R=e.onsave)==null||R.apply(this,W)},Z(W=>{F(ee,u(a)===o?"â":"â§"),F(se,u(a)===c?"â":"â§"),F(ie,u(a)===o?"â":"â§"),F(he,u(a)===c?"â":"â§"),F(le,u(a)===f?"â":"â§"),ne.disabled=W},[()=>!n().trim()]),or(te,n),E(t,m),wt()}Nt(["click","keydown"]);function ug(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof ll?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const s=n.match(/project\s+(\d+)/),o=s==null?void 0:s[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var dg=I('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),fg=I('<div class="error-card-title svelte-14buhqq"> </div>'),vg=I('<p class="error-card-fix svelte-14buhqq"> </p>'),pg=I('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),hg=I('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),mg=I('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function hd(t,e){bt(e,!0);let n=Ne(e,"ondismiss",3,null),a=Ne(e,"onsignout",3,null),s=lt(()=>ug(e.error));dn(()=>qn("ErrorCard"));var o=mg(),c=p(o);{var f=$=>{var ee=dg(),H=p(ee),C=p(H),Y=_(H,2);Y.__click=function(...se){var G;(G=n())==null||G.apply(this,se)},Z(()=>F(C,u(s).title)),E($,ee)},m=$=>{var ee=fg(),H=p(ee);Z(()=>F(H,u(s).title)),E($,ee)};re(c,$=>{n()?$(f):$(m,!1)})}var h=_(c,2),b=p(h),y=_(h,2);{var w=$=>{var ee=vg(),H=p(ee);Z(()=>F(H,u(s).fix)),E($,ee)};re(y,$=>{u(s).fix&&$(w)})}var x=_(y,2);{var O=$=>{var ee=pg(),H=p(ee);Z(()=>{Fu(ee,"href",u(s).link.url),F(H,`${u(s).link.label??""} â`)}),E($,ee)};re(x,$=>{u(s).link&&$(O)})}var U=_(x,2);{var M=$=>{var ee=hg();ee.__click=function(...H){var C;(C=a())==null||C.apply(this,H)},E($,ee)};re(U,$=>{u(s).action==="signout"&&a()&&$(M)})}Z(()=>F(b,u(s).description)),E(t,o),wt()}Nt(["click"]);var gg=I('<span class="spinner svelte-nyqevv"></span> Signing in...',1),_g=al('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),yg=I(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <span class="client-id-value svelte-nyqevv"> </span> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function bg(t,e){bt(e,!0);let n=Ne(e,"error",3,null),a=Ne(e,"loadingAuth",3,!1);dn(()=>qn("AuthCard"));var s=yg(),o=p(s),c=_(p(o),4);{var f=M=>{hd(M,{get error(){return n()},get onsignout(){return e.onsignout}})};re(c,M=>{n()&&M(f)})}var m=_(c,2);m.__click=function(...M){var $;($=e.onsignin)==null||$.apply(this,M)};var h=p(m);{var b=M=>{var $=gg();E(M,$)},y=M=>{var $=_g();E(M,$)};re(h,M=>{a()?M(b):M(y,!1)})}var w=_(m,4),x=_(p(w),2),O=p(x),U=_(x,2);U.__click=function(...M){var $;($=e.onclear)==null||$.apply(this,M)},Z(M=>{m.disabled=a(),F(O,`${M??""}...`)},[()=>e.clientId.slice(0,20)]),E(t,s),wt()}Nt(["click"]);var wg=I('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),kg=I('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),xg=I('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function Sg(t,e){bt(e,!0);let n=Ne(e,"profile",3,null),a=Ne(e,"loadingProfile",3,!1);dn(()=>qn("ProfileCard"));var s=xg(),o=p(s),c=p(o),f=_(o,2),m=p(f);{var h=w=>{var x=wg();E(w,x)},b=w=>{var x=kg(),O=Xe(x),U=p(O),M=_(O,2),$=p(M);Z((ee,H)=>{F(U,n().emailAddress),F($,`${ee??""} messages
        Â· ${H??""} threads`)},[()=>{var ee;return((ee=n().messagesTotal)==null?void 0:ee.toLocaleString())||"?"},()=>{var ee;return((ee=n().threadsTotal)==null?void 0:ee.toLocaleString())||"?"}]),E(w,x)};re(m,w=>{a()?w(h):n()&&w(b,1)})}var y=_(f,2);y.__click=function(...w){var x;(x=e.onsignout)==null||x.apply(this,w)},Z(w=>F(c,w),[()=>n()?Yu(n().emailAddress):"?"]),E(t,s),wt()}Nt(["click"]);var Eg=I('<span class="spinner svelte-1ds3j4k"></span>'),Tg=al('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),Ag=I('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),Ig=I('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),Cg=I('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),Rg=I('<option class="svelte-1ds3j4k"> </option>'),Og=I('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Pg=I('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),Mg=I('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),Dg=I('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),jg=I('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),Lg=I('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function Ng(t,e){bt(e,!0),dn(()=>qn("SyncStatus"));let n=Ne(e,"syncStatus",3,null),a=Ne(e,"syncProgress",3,null),s=Ne(e,"isSyncing",3,!1),o=Oe(!1),c=Oe(50);const f=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function m(oe){if(!oe)return"never";const ve=Math.floor((Date.now()-oe)/1e3);if(ve<60)return"just now";const le=Math.floor(ve/60);if(le<60)return`${le}m ago`;const ce=Math.floor(le/60);return ce<24?`${ce}h ago`:`${Math.floor(ce/24)}d ago`}function h(){var oe,ve;return!((oe=a())!=null&&oe.total)||!((ve=a())!=null&&ve.current)?0:Math.round(a().current/a().total*100)}var b=Lg(),y=p(b),w=p(y),x=p(w);{var O=oe=>{var ve=Eg();E(oe,ve)},U=oe=>{var ve=Tg();E(oe,ve)};re(x,oe=>{s()?oe(O):oe(U,!1)})}var M=_(w,2),$=_(p(M),2);{var ee=oe=>{var ve=Ag(),le=p(ve),ce=_(le);{var te=W=>{var R=_n("Â· more available");E(W,R)},ne=W=>{var R=_n("Â· all synced");E(W,R)};re(ce,W=>{n().hasMore?W(te):W(ne,!1)})}Z((W,R)=>F(le,`${W??""} emails stored
          Â· synced ${R??""} `),[()=>n().totalItems.toLocaleString(),()=>m(n().lastSyncAt)]),E(oe,ve)},H=oe=>{var ve=Ig();E(oe,ve)};re($,oe=>{var ve;(ve=n())!=null&&ve.synced?oe(ee):oe(H,!1)})}var C=_(M,2),Y=p(C);{var se=oe=>{var ve=Cg();ve.__click=()=>A(o,!u(o)),E(oe,ve)};re(Y,oe=>{var ve;(ve=n())!=null&&ve.synced&&!s()&&oe(se)})}var G=_(y,2),me=p(G),ke=_(p(me),2);At(ke,21,()=>f,Ut,(oe,ve)=>{var le=Rg(),ce=p(le),te={};Z(()=>{F(ce,u(ve).label),te!==(te=u(ve).value)&&(le.value=(le.__value=u(ve).value)??"")}),E(oe,le)});var de=_(me,2),pe=p(de);{var ie=oe=>{var ve=Pg(),le=Xe(ve);le.__click=()=>e.onsync(u(c));var ce=p(le),te=_(le,2);{var ne=W=>{var R=Og();R.__click=()=>e.onsyncmore(u(c));var T=p(R);Z(()=>{R.disabled=s(),F(T,s()?"Loading...":"Sync More")}),E(W,R)};re(te,W=>{n().hasMore&&W(ne)})}Z(()=>{le.disabled=s(),F(ce,s()?"Syncing...":"Sync New")}),E(oe,ve)},_e=oe=>{var ve=Mg();ve.__click=()=>e.onsync(u(c));var le=p(ve);Z(()=>{ve.disabled=s(),F(le,s()?"Syncing...":"Download Emails")}),E(oe,ve)};re(pe,oe=>{var ve;(ve=n())!=null&&ve.synced?oe(ie):oe(_e,!1)})}var fe=_(G,2);{var ue=oe=>{var ve=Dg(),le=p(ve),ce=p(le);let te,ne;var W=_(le,2),R=p(W);Z(T=>{te=Rt(ce,1,"progress-fill svelte-1ds3j4k",null,te,{indeterminate:!a().total}),ne=on(ce,"",ne,T),F(R,a().message||"Syncing...")},[()=>({width:`${h()??""}%`})]),E(oe,ve)};re(fe,oe=>{s()&&a()&&oe(ue)})}var he=_(fe,2);{var Se=oe=>{var ve=jg(),le=_(p(ve),2),ce=p(le);ce.__click=()=>A(o,!1);var te=_(ce,2);te.__click=()=>{e.onclear(),A(o,!1)},E(oe,ve)};re(he,oe=>{u(o)&&oe(Se)})}Z(()=>ke.disabled=s()),Ri(ke,()=>u(c),oe=>A(c,oe)),E(t,b),wt()}Nt(["click"]);var qg=I('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Bg=I('<div class="message-list svelte-y2uamw"></div>');function Fg(t,e){bt(e,!0);let n=Ne(e,"messages",19,()=>[]);dn(()=>qn("MessageList"));var a=Bg();At(a,21,n,Ut,(s,o)=>{var c=qg();c.__click=()=>e.onselect(u(o));var f=p(c),m=p(f),h=_(f,2),b=p(h),y=p(b),w=p(y),x=_(y,2),O=p(x),U=_(b,2),M=p(U),$=_(U,2),ee=p($);Z((H,C,Y)=>{F(m,H),F(w,C),F(O,Y),F(M,u(o).subject),F(ee,u(o).snippet)},[()=>Yu(u(o).from),()=>Vu(u(o).from),()=>cl(u(o).date)]),E(s,c)}),E(t,a),wt()}Nt(["click"]);function vl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ca=vl();function md(t){Ca=t}var ca={exec:()=>null};function vt(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(s,o)=>{let c=typeof o=="string"?o:o.source;return c=c.replace(yn.caret,"$1"),n=n.replace(s,c),a},getRegex:()=>new RegExp(n,e)};return a}var zg=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),yn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},Ug=/^(?:[ \t]*(?:\n|$))+/,Kg=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Gg=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Fs=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Wg=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,pl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,gd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_d=vt(gd).replace(/bull/g,pl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Hg=vt(gd).replace(/bull/g,pl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),hl=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Vg=/^[^\n]+/,ml=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Yg=vt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ml).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Qg=vt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,pl).getRegex(),Mi="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",gl=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Xg=vt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",gl).replace("tag",Mi).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),yd=vt(hl).replace("hr",Fs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mi).getRegex(),Zg=vt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",yd).getRegex(),_l={blockquote:Zg,code:Kg,def:Yg,fences:Gg,heading:Wg,hr:Fs,html:Xg,lheading:_d,list:Qg,newline:Ug,paragraph:yd,table:ca,text:Vg},Ec=vt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Fs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mi).getRegex(),Jg={..._l,lheading:Hg,table:Ec,paragraph:vt(hl).replace("hr",Fs).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ec).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Mi).getRegex()},$g={..._l,html:vt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",gl).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ca,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:vt(hl).replace("hr",Fs).replace("heading",` *#{1,6} *[^
]`).replace("lheading",_d).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},e_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,t_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,bd=/^( {2,}|\\)\n(?!\s*$)/,n_=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Di=/[\p{P}\p{S}]/u,yl=/[\s\p{P}\p{S}]/u,wd=/[^\s\p{P}\p{S}]/u,r_=vt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,yl).getRegex(),kd=/(?!~)[\p{P}\p{S}]/u,a_=/(?!~)[\s\p{P}\p{S}]/u,s_=/(?:[^\s\p{P}\p{S}]|~)/u,xd=/(?![*_])[\p{P}\p{S}]/u,i_=/(?![*_])[\s\p{P}\p{S}]/u,o_=/(?:[^\s\p{P}\p{S}]|[*_])/u,l_=vt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",zg?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Sd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,c_=vt(Sd,"u").replace(/punct/g,Di).getRegex(),u_=vt(Sd,"u").replace(/punct/g,kd).getRegex(),Ed="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",d_=vt(Ed,"gu").replace(/notPunctSpace/g,wd).replace(/punctSpace/g,yl).replace(/punct/g,Di).getRegex(),f_=vt(Ed,"gu").replace(/notPunctSpace/g,s_).replace(/punctSpace/g,a_).replace(/punct/g,kd).getRegex(),v_=vt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,wd).replace(/punctSpace/g,yl).replace(/punct/g,Di).getRegex(),p_=vt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,xd).getRegex(),h_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",m_=vt(h_,"gu").replace(/notPunctSpace/g,o_).replace(/punctSpace/g,i_).replace(/punct/g,xd).getRegex(),g_=vt(/\\(punct)/,"gu").replace(/punct/g,Di).getRegex(),__=vt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),y_=vt(gl).replace("(?:-->|$)","-->").getRegex(),b_=vt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",y_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),wi=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,w_=vt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",wi).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Td=vt(/^!?\[(label)\]\[(ref)\]/).replace("label",wi).replace("ref",ml).getRegex(),Ad=vt(/^!?\[(ref)\](?:\[\])?/).replace("ref",ml).getRegex(),k_=vt("reflink|nolink(?!\\()","g").replace("reflink",Td).replace("nolink",Ad).getRegex(),Tc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,bl={_backpedal:ca,anyPunctuation:g_,autolink:__,blockSkip:l_,br:bd,code:t_,del:ca,delLDelim:ca,delRDelim:ca,emStrongLDelim:c_,emStrongRDelimAst:d_,emStrongRDelimUnd:v_,escape:e_,link:w_,nolink:Ad,punctuation:r_,reflink:Td,reflinkSearch:k_,tag:b_,text:n_,url:ca},x_={...bl,link:vt(/^!?\[(label)\]\((.*?)\)/).replace("label",wi).getRegex(),reflink:vt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",wi).getRegex()},Bo={...bl,emStrongRDelimAst:f_,emStrongLDelim:u_,delLDelim:p_,delRDelim:m_,url:vt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Tc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:vt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Tc).getRegex()},S_={...Bo,br:vt(bd).replace("{2,}","*").getRegex(),text:vt(Bo.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},li={normal:_l,gfm:Jg,pedantic:$g},ds={normal:bl,gfm:Bo,breaks:S_,pedantic:x_},E_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ac=t=>E_[t];function Cr(t,e){if(e){if(yn.escapeTest.test(t))return t.replace(yn.escapeReplace,Ac)}else if(yn.escapeTestNoEncode.test(t))return t.replace(yn.escapeReplaceNoEncode,Ac);return t}function Ic(t){try{t=encodeURI(t).replace(yn.percentDecode,"%")}catch{return null}return t}function Cc(t,e){var o;let n=t.replace(yn.findPipe,(c,f,m)=>{let h=!1,b=f;for(;--b>=0&&m[b]==="\\";)h=!h;return h?"|":" |"}),a=n.split(yn.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace(yn.slashPipe,"|");return a}function fs(t,e,n){let a=t.length;if(a===0)return"";let s=0;for(;s<a&&t.charAt(a-s-1)===e;)s++;return t.slice(0,a-s)}function T_(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function A_(t,e=0){let n=e,a="";for(let s of t)if(s==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=s,n++;return a}function Rc(t,e,n,a,s){let o=e.href,c=e.title||null,f=t[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:c,text:f,tokens:a.inlineTokens(f)};return a.state.inLink=!1,m}function I_(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let s=a[1];return e.split(`
`).map(o=>{let c=o.match(n.other.beginningSpace);if(c===null)return o;let[f]=c;return f.length>=s.length?o.slice(s.length):o}).join(`
`)}var ki=class{constructor(t){st(this,"options");st(this,"rules");st(this,"lexer");this.options=t||Ca}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:fs(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=I_(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=fs(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:fs(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=fs(e[0],`
`).split(`
`),a="",s="",o=[];for(;n.length>0;){let c=!1,f=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))f.push(n[m]),c=!0;else if(!c)f.push(n[m]);else break;n=n.slice(m);let h=f.join(`
`),b=h.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${h}`:h,s=s?`${s}
${b}`:b;let y=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(b,o,!0),this.lexer.state.top=y,n.length===0)break;let w=o.at(-1);if((w==null?void 0:w.type)==="code")break;if((w==null?void 0:w.type)==="blockquote"){let x=w,O=x.raw+`
`+n.join(`
`),U=this.blockquote(O);o[o.length-1]=U,a=a.substring(0,a.length-x.raw.length)+U.raw,s=s.substring(0,s.length-x.text.length)+U.text;break}else if((w==null?void 0:w.type)==="list"){let x=w,O=x.raw+`
`+n.join(`
`),U=this.list(O);o[o.length-1]=U,a=a.substring(0,a.length-w.raw.length)+U.raw,s=s.substring(0,s.length-x.raw.length)+U.raw,n=O.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:s}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim(),o=s.length>1,c={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let f=this.rules.other.listItemRegex(s),m=!1;for(;t;){let b=!1,y="",w="";if(!(e=f.exec(t))||this.rules.block.hr.test(t))break;y=e[0],t=t.substring(y.length);let x=A_(e[2].split(`
`,1)[0],e[1].length),O=t.split(`
`,1)[0],U=!x.trim(),M=0;if(this.options.pedantic?(M=2,w=x.trimStart()):U?M=e[1].length+1:(M=x.search(this.rules.other.nonSpaceChar),M=M>4?1:M,w=x.slice(M),M+=e[1].length),U&&this.rules.other.blankLine.test(O)&&(y+=O+`
`,t=t.substring(O.length+1),b=!0),!b){let $=this.rules.other.nextBulletRegex(M),ee=this.rules.other.hrRegex(M),H=this.rules.other.fencesBeginRegex(M),C=this.rules.other.headingBeginRegex(M),Y=this.rules.other.htmlBeginRegex(M),se=this.rules.other.blockquoteBeginRegex(M);for(;t;){let G=t.split(`
`,1)[0],me;if(O=G,this.options.pedantic?(O=O.replace(this.rules.other.listReplaceNesting,"  "),me=O):me=O.replace(this.rules.other.tabCharGlobal,"    "),H.test(O)||C.test(O)||Y.test(O)||se.test(O)||$.test(O)||ee.test(O))break;if(me.search(this.rules.other.nonSpaceChar)>=M||!O.trim())w+=`
`+me.slice(M);else{if(U||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||H.test(x)||C.test(x)||ee.test(x))break;w+=`
`+O}U=!O.trim(),y+=G+`
`,t=t.substring(G.length+1),x=me.slice(M)}}c.loose||(m?c.loose=!0:this.rules.other.doubleBlankLine.test(y)&&(m=!0)),c.items.push({type:"list_item",raw:y,task:!!this.options.gfm&&this.rules.other.listIsTask.test(w),loose:!1,text:w,tokens:[]}),c.raw+=y}let h=c.items.at(-1);if(h)h.raw=h.raw.trimEnd(),h.text=h.text.trimEnd();else return;c.raw=c.raw.trimEnd();for(let b of c.items){if(this.lexer.state.top=!1,b.tokens=this.lexer.blockTokens(b.text,[]),b.task){if(b.text=b.text.replace(this.rules.other.listReplaceTask,""),((n=b.tokens[0])==null?void 0:n.type)==="text"||((a=b.tokens[0])==null?void 0:a.type)==="paragraph"){b.tokens[0].raw=b.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),b.tokens[0].text=b.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let w=this.lexer.inlineQueue.length-1;w>=0;w--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[w].src)){this.lexer.inlineQueue[w].src=this.lexer.inlineQueue[w].src.replace(this.rules.other.listReplaceTask,"");break}}let y=this.rules.other.listTaskCheckbox.exec(b.raw);if(y){let w={type:"checkbox",raw:y[0]+" ",checked:y[0]!=="[ ]"};b.checked=w.checked,c.loose?b.tokens[0]&&["paragraph","text"].includes(b.tokens[0].type)&&"tokens"in b.tokens[0]&&b.tokens[0].tokens?(b.tokens[0].raw=w.raw+b.tokens[0].raw,b.tokens[0].text=w.raw+b.tokens[0].text,b.tokens[0].tokens.unshift(w)):b.tokens.unshift({type:"paragraph",raw:w.raw,text:w.raw,tokens:[w]}):b.tokens.unshift(w)}}if(!c.loose){let y=b.tokens.filter(x=>x.type==="space"),w=y.length>0&&y.some(x=>this.rules.other.anyLine.test(x.raw));c.loose=w}}if(c.loose)for(let b of c.items){b.loose=!0;for(let y of b.tokens)y.type==="text"&&(y.type="paragraph")}return c}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:s}}}table(t){var c;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=Cc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(c=e[3])!=null&&c.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let f of a)this.rules.other.tableAlignRight.test(f)?o.align.push("right"):this.rules.other.tableAlignCenter.test(f)?o.align.push("center"):this.rules.other.tableAlignLeft.test(f)?o.align.push("left"):o.align.push(null);for(let f=0;f<n.length;f++)o.header.push({text:n[f],tokens:this.lexer.inline(n[f]),header:!0,align:o.align[f]});for(let f of s)o.rows.push(Cc(f,o.header.length).map((m,h)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:o.align[h]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=fs(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=T_(e[2],"()");if(o===-2)return;if(o>-1){let c=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,c).trim(),e[3]=""}}let a=e[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],s=o[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),Rc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[a.toLowerCase()];if(!s){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return Rc(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,c,f=s,m=0,h=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,e=e.slice(-1*t.length+s);(a=h.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(c=[...o].length,a[3]||a[4]){f+=c;continue}else if((a[5]||a[6])&&s%3&&!((s+c)%3)){m+=c;continue}if(f-=c,f>0)continue;c=Math.min(c,c+f+m);let b=[...a[0]][0].length,y=t.slice(0,s+a.index+b+c);if(Math.min(s,c)%2){let x=y.slice(1,-1);return{type:"em",raw:y,text:x,tokens:this.lexer.inlineTokens(x)}}let w=y.slice(2,-2);return{type:"strong",raw:y,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,c,f=s,m=this.rules.inline.delRDelim;for(m.lastIndex=0,e=e.slice(-1*t.length+s);(a=m.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(c=[...o].length,c!==s))continue;if(a[3]||a[4]){f+=c;continue}if(f-=c,f>0)continue;c=Math.min(c,c+f);let h=[...a[0]][0].length,b=t.slice(0,s+a.index+h+c),y=b.slice(s,-s);return{type:"del",raw:b,text:y,tokens:this.lexer.inlineTokens(y)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,s;if(e[2]==="@")a=e[0],s="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:a,href:s,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},lr=class Fo{constructor(e){st(this,"tokens");st(this,"options");st(this,"state");st(this,"inlineQueue");st(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ca,this.options.tokenizer=this.options.tokenizer||new ki,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:yn,block:li.normal,inline:ds.normal};this.options.pedantic?(n.block=li.pedantic,n.inline=ds.pedantic):this.options.gfm&&(n.block=li.gfm,this.options.breaks?n.inline=ds.breaks:n.inline=ds.gfm),this.tokenizer.rules=n}static get rules(){return{block:li,inline:ds}}static lex(e,n){return new Fo(n).lex(e)}static lexInline(e,n){return new Fo(n).inlineTokens(e)}lex(e){e=e.replace(yn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var s,o,c;for(this.options.pedantic&&(e=e.replace(yn.tabCharGlobal,"    ").replace(yn.spaceLine,""));e;){let f;if((o=(s=this.options.extensions)==null?void 0:s.block)!=null&&o.some(h=>(f=h.call({lexer:this},e,n))?(e=e.substring(f.raw.length),n.push(f),!0):!1))continue;if(f=this.tokenizer.space(e)){e=e.substring(f.raw.length);let h=n.at(-1);f.raw.length===1&&h!==void 0?h.raw+=`
`:n.push(f);continue}if(f=this.tokenizer.code(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.at(-1).src=h.text):n.push(f);continue}if(f=this.tokenizer.fences(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.heading(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.hr(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.blockquote(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.list(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.html(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.def(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="paragraph"||(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.raw,this.inlineQueue.at(-1).src=h.text):this.tokens.links[f.tag]||(this.tokens.links[f.tag]={href:f.href,title:f.title},n.push(f));continue}if(f=this.tokenizer.table(e)){e=e.substring(f.raw.length),n.push(f);continue}if(f=this.tokenizer.lheading(e)){e=e.substring(f.raw.length),n.push(f);continue}let m=e;if((c=this.options.extensions)!=null&&c.startBlock){let h=1/0,b=e.slice(1),y;this.options.extensions.startBlock.forEach(w=>{y=w.call({lexer:this},b),typeof y=="number"&&y>=0&&(h=Math.min(h,y))}),h<1/0&&h>=0&&(m=e.substring(0,h+1))}if(this.state.top&&(f=this.tokenizer.paragraph(m))){let h=n.at(-1);a&&(h==null?void 0:h.type)==="paragraph"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):n.push(f),a=m.length!==e.length,e=e.substring(f.raw.length);continue}if(f=this.tokenizer.text(e)){e=e.substring(f.raw.length);let h=n.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=(h.raw.endsWith(`
`)?"":`
`)+f.raw,h.text+=`
`+f.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=h.text):n.push(f);continue}if(e){let h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var m,h,b,y,w;let a=e,s=null;if(this.tokens.links){let x=Object.keys(this.tokens.links);if(x.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)x.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=s[2]?s[2].length:0,a=a.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((h=(m=this.options.hooks)==null?void 0:m.emStrongMask)==null?void 0:h.call({lexer:this},a))??a;let c=!1,f="";for(;e;){c||(f=""),c=!1;let x;if((y=(b=this.options.extensions)==null?void 0:b.inline)!=null&&y.some(U=>(x=U.call({lexer:this},e,n))?(e=e.substring(x.raw.length),n.push(x),!0):!1))continue;if(x=this.tokenizer.escape(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.tag(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.link(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(x.raw.length);let U=n.at(-1);x.type==="text"&&(U==null?void 0:U.type)==="text"?(U.raw+=x.raw,U.text+=x.text):n.push(x);continue}if(x=this.tokenizer.emStrong(e,a,f)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.codespan(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.br(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.del(e,a,f)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.autolink(e)){e=e.substring(x.raw.length),n.push(x);continue}if(!this.state.inLink&&(x=this.tokenizer.url(e))){e=e.substring(x.raw.length),n.push(x);continue}let O=e;if((w=this.options.extensions)!=null&&w.startInline){let U=1/0,M=e.slice(1),$;this.options.extensions.startInline.forEach(ee=>{$=ee.call({lexer:this},M),typeof $=="number"&&$>=0&&(U=Math.min(U,$))}),U<1/0&&U>=0&&(O=e.substring(0,U+1))}if(x=this.tokenizer.inlineText(O)){e=e.substring(x.raw.length),x.raw.slice(-1)!=="_"&&(f=x.raw.slice(-1)),c=!0;let U=n.at(-1);(U==null?void 0:U.type)==="text"?(U.raw+=x.raw,U.text+=x.text):n.push(x);continue}if(e){let U="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(U);break}else throw new Error(U)}}return n}},xi=class{constructor(t){st(this,"options");st(this,"parser");this.options=t||Ca}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(yn.notSpaceStart))==null?void 0:o[0],s=t.replace(yn.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Cr(a)+'">'+(n?s:Cr(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:Cr(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let c=0;c<t.items.length;c++){let f=t.items[c];a+=this.listitem(f)}let s=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+s+o+`>
`+a+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let a="";for(let s=0;s<t.rows.length;s++){let o=t.rows[s];n="";for(let c=0;c<o.length;c++)n+=this.tablecell(o[c]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Cr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),s=Ic(t);if(s===null)return a;t=s;let o='<a href="'+t+'"';return e&&(o+=' title="'+Cr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=Ic(t);if(s===null)return Cr(n);t=s;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Cr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Cr(t.text)}},wl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},cr=class zo{constructor(e){st(this,"options");st(this,"renderer");st(this,"textRenderer");this.options=e||Ca,this.options.renderer=this.options.renderer||new xi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new wl}static parse(e,n){return new zo(n).parse(e)}static parseInline(e,n){return new zo(n).parseInline(e)}parse(e){var a,s;let n="";for(let o=0;o<e.length;o++){let c=e[o];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[c.type]){let m=c,h=this.options.extensions.renderers[m.type].call({parser:this},m);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(m.type)){n+=h||"";continue}}let f=c;switch(f.type){case"space":{n+=this.renderer.space(f);break}case"hr":{n+=this.renderer.hr(f);break}case"heading":{n+=this.renderer.heading(f);break}case"code":{n+=this.renderer.code(f);break}case"table":{n+=this.renderer.table(f);break}case"blockquote":{n+=this.renderer.blockquote(f);break}case"list":{n+=this.renderer.list(f);break}case"checkbox":{n+=this.renderer.checkbox(f);break}case"html":{n+=this.renderer.html(f);break}case"def":{n+=this.renderer.def(f);break}case"paragraph":{n+=this.renderer.paragraph(f);break}case"text":{n+=this.renderer.text(f);break}default:{let m='Token with "'+f.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return n}parseInline(e,n=this.renderer){var s,o;let a="";for(let c=0;c<e.length;c++){let f=e[c];if((o=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&o[f.type]){let h=this.options.extensions.renderers[f.type].call({parser:this},f);if(h!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(f.type)){a+=h||"";continue}}let m=f;switch(m.type){case"escape":{a+=n.text(m);break}case"html":{a+=n.html(m);break}case"link":{a+=n.link(m);break}case"image":{a+=n.image(m);break}case"checkbox":{a+=n.checkbox(m);break}case"strong":{a+=n.strong(m);break}case"em":{a+=n.em(m);break}case"codespan":{a+=n.codespan(m);break}case"br":{a+=n.br(m);break}case"del":{a+=n.del(m);break}case"text":{a+=n.text(m);break}default:{let h='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(h),"";throw new Error(h)}}}return a}},di,bs=(di=class{constructor(t){st(this,"options");st(this,"block");this.options=t||Ca}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?lr.lex:lr.lexInline}provideParser(){return this.block?cr.parse:cr.parseInline}},st(di,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),st(di,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),di),C_=class{constructor(...t){st(this,"defaults",vl());st(this,"options",this.setOptions);st(this,"parse",this.parseMarkdown(!0));st(this,"parseInline",this.parseMarkdown(!1));st(this,"Parser",cr);st(this,"Renderer",xi);st(this,"TextRenderer",wl);st(this,"Lexer",lr);st(this,"Tokenizer",ki);st(this,"Hooks",bs);this.use(...t)}walkTokens(t,e){var a,s;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let c=o;for(let f of c.header)n=n.concat(this.walkTokens(f.tokens,e));for(let f of c.rows)for(let m of f)n=n.concat(this.walkTokens(m.tokens,e));break}case"list":{let c=o;n=n.concat(this.walkTokens(c.items,e));break}default:{let c=o;(s=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&s[c.type]?this.defaults.extensions.childTokens[c.type].forEach(f=>{let m=c[f].flat(1/0);n=n.concat(this.walkTokens(m,e))}):c.tokens&&(n=n.concat(this.walkTokens(c.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=e.renderers[s.name];o?e.renderers[s.name]=function(...c){let f=s.renderer.apply(this,c);return f===!1&&(f=o.apply(this,c)),f}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),a.extensions=e),n.renderer){let s=this.defaults.renderer||new xi(this.defaults);for(let o in n.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let c=o,f=n.renderer[c],m=s[c];s[c]=(...h)=>{let b=f.apply(s,h);return b===!1&&(b=m.apply(s,h)),b||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new ki(this.defaults);for(let o in n.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let c=o,f=n.tokenizer[c],m=s[c];s[c]=(...h)=>{let b=f.apply(s,h);return b===!1&&(b=m.apply(s,h)),b}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new bs;for(let o in n.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let c=o,f=n.hooks[c],m=s[c];bs.passThroughHooks.has(o)?s[c]=h=>{if(this.defaults.async&&bs.passThroughHooksRespectAsync.has(o))return(async()=>{let y=await f.call(s,h);return m.call(s,y)})();let b=f.call(s,h);return m.call(s,b)}:s[c]=(...h)=>{if(this.defaults.async)return(async()=>{let y=await f.apply(s,h);return y===!1&&(y=await m.apply(s,h)),y})();let b=f.apply(s,h);return b===!1&&(b=m.apply(s,h)),b}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(c){let f=[];return f.push(o.call(this,c)),s&&(f=f.concat(s.call(this,c))),f}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return lr.lex(t,e??this.defaults)}parser(t,e){return cr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},s={...this.defaults,...a},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let c=s.hooks?await s.hooks.preprocess(e):e,f=await(s.hooks?await s.hooks.provideLexer():t?lr.lex:lr.lexInline)(c,s),m=s.hooks?await s.hooks.processAllTokens(f):f;s.walkTokens&&await Promise.all(this.walkTokens(m,s.walkTokens));let h=await(s.hooks?await s.hooks.provideParser():t?cr.parse:cr.parseInline)(m,s);return s.hooks?await s.hooks.postprocess(h):h})().catch(o);try{s.hooks&&(e=s.hooks.preprocess(e));let c=(s.hooks?s.hooks.provideLexer():t?lr.lex:lr.lexInline)(e,s);s.hooks&&(c=s.hooks.processAllTokens(c)),s.walkTokens&&this.walkTokens(c,s.walkTokens);let f=(s.hooks?s.hooks.provideParser():t?cr.parse:cr.parseInline)(c,s);return s.hooks&&(f=s.hooks.postprocess(f)),f}catch(c){return o(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Cr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},Aa=new C_;function yt(t,e){return Aa.parse(t,e)}yt.options=yt.setOptions=function(t){return Aa.setOptions(t),yt.defaults=Aa.defaults,md(yt.defaults),yt};yt.getDefaults=vl;yt.defaults=Ca;yt.use=function(...t){return Aa.use(...t),yt.defaults=Aa.defaults,md(yt.defaults),yt};yt.walkTokens=function(t,e){return Aa.walkTokens(t,e)};yt.parseInline=Aa.parseInline;yt.Parser=cr;yt.parser=cr.parse;yt.Renderer=xi;yt.TextRenderer=wl;yt.Lexer=lr;yt.lexer=lr.lex;yt.Tokenizer=ki;yt.Hooks=bs;yt.parse=yt;yt.options;yt.setOptions;yt.use;yt.walkTokens;yt.parseInline;cr.parse;lr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Id,setPrototypeOf:Oc,isFrozen:R_,getPrototypeOf:O_,getOwnPropertyDescriptor:P_}=Object;let{freeze:bn,seal:$n,create:Uo}=Object,{apply:Ko,construct:Go}=typeof Reflect<"u"&&Reflect;bn||(bn=function(e){return e});$n||($n=function(e){return e});Ko||(Ko=function(e,n){for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return e.apply(n,s)});Go||(Go=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return new e(...a)});const ci=wn(Array.prototype.forEach),M_=wn(Array.prototype.lastIndexOf),Pc=wn(Array.prototype.pop),vs=wn(Array.prototype.push),D_=wn(Array.prototype.splice),gi=wn(String.prototype.toLowerCase),ho=wn(String.prototype.toString),mo=wn(String.prototype.match),ps=wn(String.prototype.replace),j_=wn(String.prototype.indexOf),L_=wn(String.prototype.trim),sr=wn(Object.prototype.hasOwnProperty),gn=wn(RegExp.prototype.test),hs=N_(TypeError);function wn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return Ko(t,e,a)}}function N_(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Go(t,n)}}function rt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gi;Oc&&Oc(t,null);let a=e.length;for(;a--;){let s=e[a];if(typeof s=="string"){const o=n(s);o!==s&&(R_(e)||(e[a]=o),s=o)}t[s]=!0}return t}function q_(t){for(let e=0;e<t.length;e++)sr(t,e)||(t[e]=null);return t}function yr(t){const e=Uo(null);for(const[n,a]of Id(t))sr(t,n)&&(Array.isArray(a)?e[n]=q_(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=yr(a):e[n]=a);return e}function ms(t,e){for(;t!==null;){const a=P_(t,e);if(a){if(a.get)return wn(a.get);if(typeof a.value=="function")return wn(a.value)}t=O_(t)}function n(){return null}return n}const Mc=bn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),go=bn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),_o=bn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),B_=bn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),yo=bn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),F_=bn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Dc=bn(["#text"]),jc=bn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),bo=bn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Lc=bn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ui=bn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),z_=$n(/\{\{[\w\W]*|[\w\W]*\}\}/gm),U_=$n(/<%[\w\W]*|[\w\W]*%>/gm),K_=$n(/\$\{[\w\W]*/gm),G_=$n(/^data-[\-\w.\u00B7-\uFFFF]+$/),W_=$n(/^aria-[\-\w]+$/),Cd=$n(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),H_=$n(/^(?:\w+script|data):/i),V_=$n(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Rd=$n(/^html$/i),Y_=$n(/^[a-z][.\w]*(-[.\w]+)+$/i);var Nc=Object.freeze({__proto__:null,ARIA_ATTR:W_,ATTR_WHITESPACE:V_,CUSTOM_ELEMENT:Y_,DATA_ATTR:G_,DOCTYPE_NAME:Rd,ERB_EXPR:U_,IS_ALLOWED_URI:Cd,IS_SCRIPT_OR_DATA:H_,MUSTACHE_EXPR:z_,TMPLIT_EXPR:K_});const gs={element:1,text:3,progressingInstruction:7,comment:8,document:9},Q_=function(){return typeof window>"u"?null:window},X_=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(a=n.getAttribute(s));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(c){return c},createScriptURL(c){return c}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},qc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Od(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Q_();const e=Ke=>Od(Ke);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==gs.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,s=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:c,Node:f,Element:m,NodeFilter:h,NamedNodeMap:b=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:y,DOMParser:w,trustedTypes:x}=t,O=m.prototype,U=ms(O,"cloneNode"),M=ms(O,"remove"),$=ms(O,"nextSibling"),ee=ms(O,"childNodes"),H=ms(O,"parentNode");if(typeof c=="function"){const Ke=n.createElement("template");Ke.content&&Ke.content.ownerDocument&&(n=Ke.content.ownerDocument)}let C,Y="";const{implementation:se,createNodeIterator:G,createDocumentFragment:me,getElementsByTagName:ke}=n,{importNode:de}=a;let pe=qc();e.isSupported=typeof Id=="function"&&typeof H=="function"&&se&&se.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ie,ERB_EXPR:_e,TMPLIT_EXPR:fe,DATA_ATTR:ue,ARIA_ATTR:he,IS_SCRIPT_OR_DATA:Se,ATTR_WHITESPACE:oe,CUSTOM_ELEMENT:ve}=Nc;let{IS_ALLOWED_URI:le}=Nc,ce=null;const te=rt({},[...Mc,...go,..._o,...yo,...Dc]);let ne=null;const W=rt({},[...jc,...bo,...Lc,...ui]);let R=Object.seal(Uo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),T=null,V=null;const Te=Object.seal(Uo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ce=!0,P=!0,ye=!1,xe=!0,Pe=!1,Ue=!0,Ye=!1,_t=!1,St=!1,Et=!1,Ze=!1,Be=!1,We=!0,pt=!1;const Mt="user-content-";let Zt=!0,ut=!1,Je={},Ve=null;const Tt=rt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let qt=null;const Jt=rt({},["audio","video","img","source","image","track"]);let Qt=null;const Bt=rt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),It="http://www.w3.org/1998/Math/MathML",$t="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let De=at,Lt=!1,Kt=null;const Qe=rt({},[It,$t,at],ho);let be=rt({},["mi","mo","mn","ms","mtext"]),dt=rt({},["annotation-xml"]);const rn=rt({},["title","style","font","a","script"]);let Xt=null;const hr=["application/xhtml+xml","text/html"],Bn="text/html";let Ct=null,kn=null;const Fn=n.createElement("form"),mn=function(j){return j instanceof RegExp||j instanceof Function},zn=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(kn&&kn===j)){if((!j||typeof j!="object")&&(j={}),j=yr(j),Xt=hr.indexOf(j.PARSER_MEDIA_TYPE)===-1?Bn:j.PARSER_MEDIA_TYPE,Ct=Xt==="application/xhtml+xml"?ho:gi,ce=sr(j,"ALLOWED_TAGS")?rt({},j.ALLOWED_TAGS,Ct):te,ne=sr(j,"ALLOWED_ATTR")?rt({},j.ALLOWED_ATTR,Ct):W,Kt=sr(j,"ALLOWED_NAMESPACES")?rt({},j.ALLOWED_NAMESPACES,ho):Qe,Qt=sr(j,"ADD_URI_SAFE_ATTR")?rt(yr(Bt),j.ADD_URI_SAFE_ATTR,Ct):Bt,qt=sr(j,"ADD_DATA_URI_TAGS")?rt(yr(Jt),j.ADD_DATA_URI_TAGS,Ct):Jt,Ve=sr(j,"FORBID_CONTENTS")?rt({},j.FORBID_CONTENTS,Ct):Tt,T=sr(j,"FORBID_TAGS")?rt({},j.FORBID_TAGS,Ct):yr({}),V=sr(j,"FORBID_ATTR")?rt({},j.FORBID_ATTR,Ct):yr({}),Je=sr(j,"USE_PROFILES")?j.USE_PROFILES:!1,Ce=j.ALLOW_ARIA_ATTR!==!1,P=j.ALLOW_DATA_ATTR!==!1,ye=j.ALLOW_UNKNOWN_PROTOCOLS||!1,xe=j.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Pe=j.SAFE_FOR_TEMPLATES||!1,Ue=j.SAFE_FOR_XML!==!1,Ye=j.WHOLE_DOCUMENT||!1,Et=j.RETURN_DOM||!1,Ze=j.RETURN_DOM_FRAGMENT||!1,Be=j.RETURN_TRUSTED_TYPE||!1,St=j.FORCE_BODY||!1,We=j.SANITIZE_DOM!==!1,pt=j.SANITIZE_NAMED_PROPS||!1,Zt=j.KEEP_CONTENT!==!1,ut=j.IN_PLACE||!1,le=j.ALLOWED_URI_REGEXP||Cd,De=j.NAMESPACE||at,be=j.MATHML_TEXT_INTEGRATION_POINTS||be,dt=j.HTML_INTEGRATION_POINTS||dt,R=j.CUSTOM_ELEMENT_HANDLING||{},j.CUSTOM_ELEMENT_HANDLING&&mn(j.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(R.tagNameCheck=j.CUSTOM_ELEMENT_HANDLING.tagNameCheck),j.CUSTOM_ELEMENT_HANDLING&&mn(j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(R.attributeNameCheck=j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),j.CUSTOM_ELEMENT_HANDLING&&typeof j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(R.allowCustomizedBuiltInElements=j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(P=!1),Ze&&(Et=!0),Je&&(ce=rt({},Dc),ne=[],Je.html===!0&&(rt(ce,Mc),rt(ne,jc)),Je.svg===!0&&(rt(ce,go),rt(ne,bo),rt(ne,ui)),Je.svgFilters===!0&&(rt(ce,_o),rt(ne,bo),rt(ne,ui)),Je.mathMl===!0&&(rt(ce,yo),rt(ne,Lc),rt(ne,ui))),j.ADD_TAGS&&(typeof j.ADD_TAGS=="function"?Te.tagCheck=j.ADD_TAGS:(ce===te&&(ce=yr(ce)),rt(ce,j.ADD_TAGS,Ct))),j.ADD_ATTR&&(typeof j.ADD_ATTR=="function"?Te.attributeCheck=j.ADD_ATTR:(ne===W&&(ne=yr(ne)),rt(ne,j.ADD_ATTR,Ct))),j.ADD_URI_SAFE_ATTR&&rt(Qt,j.ADD_URI_SAFE_ATTR,Ct),j.FORBID_CONTENTS&&(Ve===Tt&&(Ve=yr(Ve)),rt(Ve,j.FORBID_CONTENTS,Ct)),j.ADD_FORBID_CONTENTS&&(Ve===Tt&&(Ve=yr(Ve)),rt(Ve,j.ADD_FORBID_CONTENTS,Ct)),Zt&&(ce["#text"]=!0),Ye&&rt(ce,["html","head","body"]),ce.table&&(rt(ce,["tbody"]),delete T.tbody),j.TRUSTED_TYPES_POLICY){if(typeof j.TRUSTED_TYPES_POLICY.createHTML!="function")throw hs('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof j.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw hs('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');C=j.TRUSTED_TYPES_POLICY,Y=C.createHTML("")}else C===void 0&&(C=X_(x,s)),C!==null&&typeof Y=="string"&&(Y=C.createHTML(""));bn&&bn(j),kn=j}},Rn=rt({},[...go,..._o,...B_]),kt=rt({},[...yo,...F_]),Gt=function(j){let Ie=H(j);(!Ie||!Ie.tagName)&&(Ie={namespaceURI:De,tagName:"template"});const Me=gi(j.tagName),ht=gi(Ie.tagName);return Kt[j.namespaceURI]?j.namespaceURI===$t?Ie.namespaceURI===at?Me==="svg":Ie.namespaceURI===It?Me==="svg"&&(ht==="annotation-xml"||be[ht]):!!Rn[Me]:j.namespaceURI===It?Ie.namespaceURI===at?Me==="math":Ie.namespaceURI===$t?Me==="math"&&dt[ht]:!!kt[Me]:j.namespaceURI===at?Ie.namespaceURI===$t&&!dt[ht]||Ie.namespaceURI===It&&!be[ht]?!1:!kt[Me]&&(rn[Me]||!Rn[Me]):!!(Xt==="application/xhtml+xml"&&Kt[j.namespaceURI]):!1},Un=function(j){vs(e.removed,{element:j});try{H(j).removeChild(j)}catch{M(j)}},Kn=function(j,Ie){try{vs(e.removed,{attribute:Ie.getAttributeNode(j),from:Ie})}catch{vs(e.removed,{attribute:null,from:Ie})}if(Ie.removeAttribute(j),j==="is")if(Et||Ze)try{Un(Ie)}catch{}else try{Ie.setAttribute(j,"")}catch{}},Jr=function(j){let Ie=null,Me=null;if(St)j="<remove></remove>"+j;else{const Ft=mo(j,/^[\r\n\t ]+/);Me=Ft&&Ft[0]}Xt==="application/xhtml+xml"&&De===at&&(j='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+j+"</body></html>");const ht=C?C.createHTML(j):j;if(De===at)try{Ie=new w().parseFromString(ht,Xt)}catch{}if(!Ie||!Ie.documentElement){Ie=se.createDocument(De,"template",null);try{Ie.documentElement.innerHTML=Lt?Y:ht}catch{}}const Ot=Ie.body||Ie.documentElement;return j&&Me&&Ot.insertBefore(n.createTextNode(Me),Ot.childNodes[0]||null),De===at?ke.call(Ie,Ye?"html":"body")[0]:Ye?Ie.documentElement:Ot},$r=function(j){return G.call(j.ownerDocument||j,j,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},$a=function(j){return j instanceof y&&(typeof j.nodeName!="string"||typeof j.textContent!="string"||typeof j.removeChild!="function"||!(j.attributes instanceof b)||typeof j.removeAttribute!="function"||typeof j.setAttribute!="function"||typeof j.namespaceURI!="string"||typeof j.insertBefore!="function"||typeof j.hasChildNodes!="function")},er=function(j){return typeof f=="function"&&j instanceof f};function fn(Ke,j,Ie){ci(Ke,Me=>{Me.call(e,j,Ie,kn)})}const tr=function(j){let Ie=null;if(fn(pe.beforeSanitizeElements,j,null),$a(j))return Un(j),!0;const Me=Ct(j.nodeName);if(fn(pe.uponSanitizeElement,j,{tagName:Me,allowedTags:ce}),Ue&&j.hasChildNodes()&&!er(j.firstElementChild)&&gn(/<[/\w!]/g,j.innerHTML)&&gn(/<[/\w!]/g,j.textContent)||j.nodeType===gs.progressingInstruction||Ue&&j.nodeType===gs.comment&&gn(/<[/\w]/g,j.data))return Un(j),!0;if(!(Te.tagCheck instanceof Function&&Te.tagCheck(Me))&&(!ce[Me]||T[Me])){if(!T[Me]&&zs(Me)&&(R.tagNameCheck instanceof RegExp&&gn(R.tagNameCheck,Me)||R.tagNameCheck instanceof Function&&R.tagNameCheck(Me)))return!1;if(Zt&&!Ve[Me]){const ht=H(j)||j.parentNode,Ot=ee(j)||j.childNodes;if(Ot&&ht){const Ft=Ot.length;for(let Ht=Ft-1;Ht>=0;--Ht){const xn=U(Ot[Ht],!0);xn.__removalCount=(j.__removalCount||0)+1,ht.insertBefore(xn,$(j))}}}return Un(j),!0}return j instanceof m&&!Gt(j)||(Me==="noscript"||Me==="noembed"||Me==="noframes")&&gn(/<\/no(script|embed|frames)/i,j.innerHTML)?(Un(j),!0):(Pe&&j.nodeType===gs.text&&(Ie=j.textContent,ci([ie,_e,fe],ht=>{Ie=ps(Ie,ht," ")}),j.textContent!==Ie&&(vs(e.removed,{element:j.cloneNode()}),j.textContent=Ie)),fn(pe.afterSanitizeElements,j,null),!1)},ea=function(j,Ie,Me){if(We&&(Ie==="id"||Ie==="name")&&(Me in n||Me in Fn))return!1;if(!(P&&!V[Ie]&&gn(ue,Ie))){if(!(Ce&&gn(he,Ie))){if(!(Te.attributeCheck instanceof Function&&Te.attributeCheck(Ie,j))){if(!ne[Ie]||V[Ie]){if(!(zs(j)&&(R.tagNameCheck instanceof RegExp&&gn(R.tagNameCheck,j)||R.tagNameCheck instanceof Function&&R.tagNameCheck(j))&&(R.attributeNameCheck instanceof RegExp&&gn(R.attributeNameCheck,Ie)||R.attributeNameCheck instanceof Function&&R.attributeNameCheck(Ie,j))||Ie==="is"&&R.allowCustomizedBuiltInElements&&(R.tagNameCheck instanceof RegExp&&gn(R.tagNameCheck,Me)||R.tagNameCheck instanceof Function&&R.tagNameCheck(Me))))return!1}else if(!Qt[Ie]){if(!gn(le,ps(Me,oe,""))){if(!((Ie==="src"||Ie==="xlink:href"||Ie==="href")&&j!=="script"&&j_(Me,"data:")===0&&qt[j])){if(!(ye&&!gn(Se,ps(Me,oe,"")))){if(Me)return!1}}}}}}}return!0},zs=function(j){return j!=="annotation-xml"&&mo(j,ve)},nr=function(j){fn(pe.beforeSanitizeAttributes,j,null);const{attributes:Ie}=j;if(!Ie||$a(j))return;const Me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ne,forceKeepAttr:void 0};let ht=Ie.length;for(;ht--;){const Ot=Ie[ht],{name:Ft,namespaceURI:Ht,value:xn}=Ot,mr=Ct(Ft),ta=xn;let Dt=Ft==="value"?ta:L_(ta);if(Me.attrName=mr,Me.attrValue=Dt,Me.keepAttr=!0,Me.forceKeepAttr=void 0,fn(pe.uponSanitizeAttribute,j,Me),Dt=Me.attrValue,pt&&(mr==="id"||mr==="name")&&(Kn(Ft,j),Dt=Mt+Dt),Ue&&gn(/((--!?|])>)|<\/(style|title|textarea)/i,Dt)){Kn(Ft,j);continue}if(mr==="attributename"&&mo(Dt,"href")){Kn(Ft,j);continue}if(Me.forceKeepAttr)continue;if(!Me.keepAttr){Kn(Ft,j);continue}if(!xe&&gn(/\/>/i,Dt)){Kn(Ft,j);continue}Pe&&ci([ie,_e,fe],na=>{Dt=ps(Dt,na," ")});const es=Ct(j.nodeName);if(!ea(es,mr,Dt)){Kn(Ft,j);continue}if(C&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Ht)switch(x.getAttributeType(es,mr)){case"TrustedHTML":{Dt=C.createHTML(Dt);break}case"TrustedScriptURL":{Dt=C.createScriptURL(Dt);break}}if(Dt!==ta)try{Ht?j.setAttributeNS(Ht,Ft,Dt):j.setAttribute(Ft,Dt),$a(j)?Un(j):Pc(e.removed)}catch{Kn(Ft,j)}}fn(pe.afterSanitizeAttributes,j,null)},Us=function Ke(j){let Ie=null;const Me=$r(j);for(fn(pe.beforeSanitizeShadowDOM,j,null);Ie=Me.nextNode();)fn(pe.uponSanitizeShadowNode,Ie,null),tr(Ie),nr(Ie),Ie.content instanceof o&&Ke(Ie.content);fn(pe.afterSanitizeShadowDOM,j,null)};return e.sanitize=function(Ke){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie=null,Me=null,ht=null,Ot=null;if(Lt=!Ke,Lt&&(Ke="<!-->"),typeof Ke!="string"&&!er(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw hs("dirty is not a string, aborting")}else throw hs("toString is not a function");if(!e.isSupported)return Ke;if(_t||zn(j),e.removed=[],typeof Ke=="string"&&(ut=!1),ut){if(Ke.nodeName){const xn=Ct(Ke.nodeName);if(!ce[xn]||T[xn])throw hs("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof f)Ie=Jr("<!---->"),Me=Ie.ownerDocument.importNode(Ke,!0),Me.nodeType===gs.element&&Me.nodeName==="BODY"||Me.nodeName==="HTML"?Ie=Me:Ie.appendChild(Me);else{if(!Et&&!Pe&&!Ye&&Ke.indexOf("<")===-1)return C&&Be?C.createHTML(Ke):Ke;if(Ie=Jr(Ke),!Ie)return Et?null:Be?Y:""}Ie&&St&&Un(Ie.firstChild);const Ft=$r(ut?Ke:Ie);for(;ht=Ft.nextNode();)tr(ht),nr(ht),ht.content instanceof o&&Us(ht.content);if(ut)return Ke;if(Et){if(Ze)for(Ot=me.call(Ie.ownerDocument);Ie.firstChild;)Ot.appendChild(Ie.firstChild);else Ot=Ie;return(ne.shadowroot||ne.shadowrootmode)&&(Ot=de.call(a,Ot,!0)),Ot}let Ht=Ye?Ie.outerHTML:Ie.innerHTML;return Ye&&ce["!doctype"]&&Ie.ownerDocument&&Ie.ownerDocument.doctype&&Ie.ownerDocument.doctype.name&&gn(Rd,Ie.ownerDocument.doctype.name)&&(Ht="<!DOCTYPE "+Ie.ownerDocument.doctype.name+`>
`+Ht),Pe&&ci([ie,_e,fe],xn=>{Ht=ps(Ht,xn," ")}),C&&Be?C.createHTML(Ht):Ht},e.setConfig=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};zn(Ke),_t=!0},e.clearConfig=function(){kn=null,_t=!1},e.isValidAttribute=function(Ke,j,Ie){kn||zn({});const Me=Ct(Ke),ht=Ct(j);return ea(Me,ht,Ie)},e.addHook=function(Ke,j){typeof j=="function"&&vs(pe[Ke],j)},e.removeHook=function(Ke,j){if(j!==void 0){const Ie=M_(pe[Ke],j);return Ie===-1?void 0:D_(pe[Ke],Ie,1)[0]}return Pc(pe[Ke])},e.removeHooks=function(Ke){pe[Ke]=[]},e.removeAllHooks=function(){pe=qc()},e}var Z_=Od();function J_(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Bc(t.from)} |`),e.push(`| **To** | ${Bc(t.to)} |`),e.push(`| **Date** | ${cl(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?$_(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Bc(t){return(t||"").replace(/\|/g,"\\|")}function $_(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Wo(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function ey(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const s=e.toLowerCase();return s.includes("spacer")||s.includes("transparent")||s.includes("transp.gif")||s.includes("/track")&&s.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(s)?!0:s.includes("mail.google.com/mail/u/")&&s.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(s)||s.endsWith(".gif")&&s.includes("1x1"))}function Wo(t){var s;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",c=t.getAttribute("alt")||"";return ey(t,o)?"":`![${c}](${o})`}const n=Array.from(t.childNodes).map(Wo).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((s=t.parentElement)==null?void 0:s.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(c=>Wo(c).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),c=(o.match(/\|/g)||[]).length-1,f="| "+Array(Math.max(c,1)).fill("---").join(" | ")+" |";return`${o}${f}
`}return n}function ty(t){return Qu(t,"md")}function Fc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function ny(t){return t.raw||null}function ry(t){const e=ny(t);return e?JSON.stringify(e,null,2):"null"}function ay(t){return Qu(t,"json")}var sy=I('<button title="View as Markdown">.md</button>'),iy=I('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),oy=I('<pre class="md-raw svelte-1b0rzpb"> </pre>'),ly=I('<div class="md-preview svelte-1b0rzpb"><!></div>'),cy=I('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),uy=I('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),dy=I('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),fy=I('<pre class="message-text svelte-1b0rzpb"> </pre>'),vy=I('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),py=I('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),hy=I('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function my(t,e){bt(e,!0);let n=Ne(e,"loading",3,!1);dn(()=>qn("MessageModal"));const a=new yt.Renderer;a.link=({href:ie,title:_e,text:fe})=>{const ue=_e?` title="${_e}"`:"";return`<a href="${ie}"${ue} target="_blank" rel="noopener">${fe}</a>`},yt.setOptions({breaks:!0,gfm:!0,renderer:a});let s=Oe("email"),o=lt(()=>e.message.body?J_(e.message):""),c=lt(()=>ry(e.message)),f=Oe("raw");function m(ie){A(s,u(s)===ie?"email":ie,!0),ie==="markdown"&&A(f,"raw")}function h(){Fc(u(o),ty(e.message))}function b(){Fc(u(c),ay(e.message),"application/json;charset=utf-8")}function y(ie){const _e=yt.parse(ie);return Z_.sanitize(_e,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let w=Oe(null);Sa(()=>{var ie;if(u(w)&&e.message.htmlBody&&!n()&&u(s)==="email"){const _e=u(w).contentDocument||((ie=u(w).contentWindow)==null?void 0:ie.document);_e&&(_e.open(),_e.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),_e.close())}});var x=hy();x.__click=function(...ie){var _e;(_e=e.onclose)==null||_e.apply(this,ie)};var O=p(x);O.__click=ie=>ie.stopPropagation();var U=p(O),M=p(U),$=p(M),ee=_(M,2),H=p(ee);let C;H.__click=()=>m("json");var Y=_(H,2);{var se=ie=>{var _e=sy();let fe;_e.__click=()=>m("markdown"),Z(()=>fe=Rt(_e,1,"action-btn svelte-1b0rzpb",null,fe,{active:u(s)==="markdown"})),E(ie,_e)};re(Y,ie=>{e.message.body&&ie(se)})}var G=_(Y,2);G.__click=function(...ie){var _e;(_e=e.onclose)==null||_e.apply(this,ie)};var me=_(U,2);{var ke=ie=>{var _e=iy(),fe=Xe(_e),ue=_(p(fe),2);ue.__click=b;var he=_(fe,2),Se=p(he),oe=p(Se);Z(()=>F(oe,u(c))),E(ie,_e)},de=ie=>{var _e=cy(),fe=Xe(_e),ue=p(fe),he=p(ue);let Se;he.__click=()=>A(f,"raw");var oe=_(he,2);let ve;oe.__click=()=>A(f,"preview");var le=_(ue,2);le.__click=h;var ce=_(fe,2),te=p(ce);{var ne=R=>{var T=oy(),V=p(T);Z(()=>F(V,u(o))),E(R,T)},W=R=>{var T=ly(),V=p(T);xv(V,()=>y(u(o))),E(R,T)};re(te,R=>{u(f)==="raw"?R(ne):R(W,!1)})}Z(()=>{Se=Rt(he,1,"md-tab svelte-1b0rzpb",null,Se,{active:u(f)==="raw"}),ve=Rt(oe,1,"md-tab svelte-1b0rzpb",null,ve,{active:u(f)==="preview"})}),E(ie,_e)},pe=ie=>{var _e=py(),fe=Xe(_e),ue=p(fe),he=_(p(ue),2),Se=p(he),oe=_(ue,2),ve=_(p(oe),2),le=p(ve),ce=_(oe,2),te=_(p(ce),2),ne=p(te),W=_(fe,2),R=p(W);{var T=P=>{var ye=uy();E(P,ye)},V=P=>{var ye=dy();zu(ye,xe=>A(w,xe),()=>u(w)),E(P,ye)},Te=P=>{var ye=fy(),xe=p(ye);Z(()=>F(xe,e.message.body)),E(P,ye)},Ce=P=>{var ye=vy();E(P,ye)};re(R,P=>{n()?P(T):e.message.htmlBody?P(V,1):e.message.body?P(Te,2):P(Ce,!1)})}Z(P=>{F(Se,e.message.from),F(le,e.message.to),F(ne,P)},[()=>cl(e.message.date)]),E(ie,_e)};re(me,ie=>{u(s)==="json"?ie(ke):u(s)==="markdown"?ie(de,1):ie(pe,!1)})}Z(()=>{F($,e.message.subject),C=Rt(H,1,"action-btn svelte-1b0rzpb",null,C,{active:u(s)==="json"})}),E(t,x),wt()}Nt(["click"]);var gy=I('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),_y=I('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),yy=I('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),by=I("<p> </p>"),wy=I('<p>No emails in local storage. Click "Sync New" to download.</p>'),ky=I('<div class="empty-state svelte-6ts5xm"><!></div>'),xy=I('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Sy=I('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Ey(t,e){bt(e,!0),dn(()=>qn("DashboardView"));let n=Ne(e,"error",3,null),a=Ne(e,"profile",3,null),s=Ne(e,"loadingProfile",3,!1),o=Ne(e,"emailMessages",19,()=>[]),c=Ne(e,"totalLocalMessages",3,0),f=Ne(e,"hasMoreLocal",3,!1),m=Ne(e,"loadingMessages",3,!1),h=Ne(e,"selectedMessage",3,null),b=Ne(e,"syncStatus",3,null),y=Ne(e,"syncProgress",3,null),w=Ne(e,"isSyncing",3,!1),x=Ne(e,"searchQuery",15);var O=Sy(),U=Xe(O),M=p(U);{var $=ue=>{hd(ue,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};re(M,ue=>{n()&&ue($)})}var ee=_(M,2);Sg(ee,{get profile(){return a()},get loadingProfile(){return s()},get onsignout(){return e.onsignout}});var H=_(ee,2);Ng(H,{get syncStatus(){return b()},get syncProgress(){return y()},get isSyncing(){return w()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var C=_(H,2),Y=p(C);Y.__keydown=ue=>ue.key==="Enter"&&e.onsearch();var se=_(Y,2);se.__click=function(...ue){var he;(he=e.onsearch)==null||he.apply(this,ue)};var G=p(se),me=_(C,2);{var ke=ue=>{var he=_y(),Se=Xe(he),oe=p(Se),ve=p(oe),le=_(Se,2);Fg(le,{get messages(){return o()},get onselect(){return e.onviewmessage}});var ce=_(le,2);{var te=ne=>{var W=gy(),R=p(W);R.__click=function(...V){var Te;(Te=e.onloadmore)==null||Te.apply(this,V)};var T=p(R);Z(()=>{R.disabled=m(),F(T,m()?"Loading...":"Load More")}),E(ne,W)};re(ce,ne=>{f()&&ne(te)})}Z(ne=>F(ve,`Showing ${o().length??""} of ${ne??""}
        ${x()?" matching":""} emails`),[()=>c().toLocaleString()]),E(ue,he)},de=ue=>{var he=yy();E(ue,he)},pe=ue=>{var he=ky(),Se=p(he);{var oe=le=>{var ce=by(),te=p(ce);Z(()=>F(te,`No emails match "${x()??""}".`)),E(le,ce)},ve=le=>{var ce=wy();E(le,ce)};re(Se,le=>{x()?le(oe):le(ve,!1)})}E(ue,he)},ie=ue=>{var he=xy();E(ue,he)};re(me,ue=>{var he;o().length>0?ue(ke):m()?ue(de,1):(he=b())!=null&&he.synced?ue(pe,2):ue(ie,!1)})}var _e=_(U,2);{var fe=ue=>{my(ue,{get message(){return h()},loading:!1,get onclose(){return e.onclosedetail}})};re(_e,ue=>{h()&&ue(fe)})}Z(()=>{se.disabled=m(),F(G,m()?"Searching...":"Search")}),or(Y,x),E(t,O),wt()}Nt(["keydown","click"]);var Ty=I('<div class="dashboard svelte-1q5o2lv"><!></div>');function Ay(t,e){bt(e,!0);function n(P){P.key==="Escape"&&u(y)&&le()}let a=null;dn(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}));function s(){a&&clearTimeout(a);const P=Zm();if(P<=0)return;const ye=Math.max(0,P-120*1e3);a=setTimeout(async()=>{try{const xe=await kc();A(h,xe.access_token,!0),s()}catch{A(h,null),A(b,null),A(H,"Session expired. Please sign in again.")}},ye)}async function o(){if(Xm())return u(h);try{const P=await kc();return A(h,P.access_token,!0),s(),u(h)}catch{return A(h,null),A(b,null),A(H,"Session expired. Please sign in again."),null}}let c=Oe(jt(localStorage.getItem("googleClientId")||"")),f=Oe(jt(localStorage.getItem("googleClientId")||"")),m=Oe(!1),h=Oe(null),b=Oe(null),y=Oe(null),w=Oe(""),x=Oe(jt([])),O=Oe(0),U=Oe(0),M=Oe(!1),$=Oe(!1),ee=Oe(!1),H=Oe(null),C=Oe(null),Y=Oe(null),se=Oe(!1);const G=50;Sa(()=>{u(h)&&(ce(),he())});let me=lt(()=>!u(c)),ke=lt(()=>!!u(h)),de=lt(()=>u(x).length<u(O));Sa(()=>{u(c)&&!u(m)&&xc(u(c)).then(()=>{if(A(m,!0),!u(h)){const P=Qm();P&&(A(h,P.access_token,!0),s(),ue())}}).catch(P=>{A(H,`Auth init failed: ${P.message}`)})});function pe(){const P=u(f).trim();P&&(localStorage.setItem("googleClientId",P),A(c,P,!0),A(H,null))}function ie(){localStorage.removeItem("googleClientId"),A(c,""),A(f,""),A(m,!1),A(h,null),A(b,null),A(x,[],!0),A(O,0)}async function _e(){A(H,null),A($,!0);try{u(m)||(await xc(u(c)),A(m,!0));const P=await $m();A(h,P.access_token,!0),s(),await ue()}catch(P){A(H,P.message,!0)}finally{A($,!1)}}async function fe(){if(a&&clearTimeout(a),u(h))try{await eg(u(h))}catch{}A(h,null),A(b,null),A(x,[],!0),A(O,0),A(y,null),A(H,null)}async function ue(){A(ee,!0);try{const P=await Gu(u(h));if(!u(h))return;A(b,P,!0)}catch(P){if(!u(h))return;A(H,`Profile fetch failed: ${P.message}`)}finally{A(ee,!1)}}async function he(P=!1){A(M,!0);try{const ye=P?u(U):0,xe=await ip({query:u(w)||void 0,limit:G,offset:ye});P?A(x,[...u(x),...xe.items],!0):A(x,xe.items,!0),A(O,xe.total,!0),A(U,u(x).length,!0)}catch(ye){A(H,`Failed to load messages: ${ye.message}`)}finally{A(M,!1)}}function Se(){A(U,0),he(!1)}function oe(){he(!0)}function ve(P){A(y,P,!0)}function le(){A(y,null)}async function ce(){try{A(C,await rg(),!0)}catch{}}async function te(P){if(u(se)||!u(h))return;const ye=await o();if(!ye)return;A(H,null),A(se,!0),A(Y,null);const xe=new AbortController;try{await tg(ye,{limit:P,onProgress:Pe=>{A(Y,{...Pe},!0)},signal:xe.signal}),await ce(),await he(!1)}catch(Pe){if(Pe.name!=="AbortError"){if(!u(h))return;A(H,`Sync failed: ${Pe.message}`)}}finally{A(se,!1)}}async function ne(P){if(u(se)||!u(h))return;const ye=await o();if(!ye)return;A(H,null),A(se,!0),A(Y,null);const xe=new AbortController;try{await ng(ye,{limit:P,onProgress:Pe=>{A(Y,{...Pe},!0)},signal:xe.signal}),await ce(),await he(!1)}catch(Pe){if(Pe.name!=="AbortError"){if(!u(h))return;A(H,`Sync more failed: ${Pe.message}`)}}finally{A(se,!1)}}async function W(){try{await dd(),await ce(),A(x,[],!0),A(O,0),A(U,0)}catch(P){A(H,`Failed to clear data: ${P.message}`)}}var R=Ty(),T=p(R);{var V=P=>{cg(P,{onsave:pe,get clientIdInput(){return u(f)},set clientIdInput(ye){A(f,ye,!0)}})},Te=P=>{bg(P,{get clientId(){return u(c)},get error(){return u(H)},get loadingAuth(){return u($)},onsignin:_e,onclear:ie,onsignout:fe})},Ce=P=>{Ey(P,{get error(){return u(H)},get profile(){return u(b)},get loadingProfile(){return u(ee)},get emailMessages(){return u(x)},get totalLocalMessages(){return u(O)},get hasMoreLocal(){return u(de)},get loadingMessages(){return u(M)},get selectedMessage(){return u(y)},get syncStatus(){return u(C)},get syncProgress(){return u(Y)},get isSyncing(){return u(se)},onsignout:fe,onsearch:Se,onloadmore:oe,onviewmessage:ve,onclosedetail:le,ondismisserror:()=>A(H,null),onsync:te,onsyncmore:ne,oncleardata:W,get searchQuery(){return u(w)},set searchQuery(ye){A(w,ye,!0)}})};re(T,P=>{u(me)?P(V):u(ke)?P(Ce,!1):P(Te,1)})}E(t,R),wt()}var Iy=I('<span class="err svelte-t1ig66"> </span>'),Cy=I('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Ry=I('<span class="stream-stats svelte-t1ig66"> </span>'),Oy=I('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),Py=I('<span class="ei-action svelte-t1ig66"> </span>'),My=I('<span class="ei-action err svelte-t1ig66">ERROR</span>'),Dy=I('<span class="sep svelte-t1ig66">Â·</span> ',1),jy=I('<div class="ei-summary svelte-t1ig66"> </div>'),Ly=I('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),Ny=I('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),qy=I("<!> <!> <!>",1),By=I('<div class="ei-error svelte-t1ig66"> </div>'),Fy=I('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),zy=I('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),Uy=I('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),Ky=I('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),Gy=I(' <span class="sep svelte-t1ig66">Â·</span>',1),Wy=I('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Hy=I('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Vy=I('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),Yy=I('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function Qy(t,e){bt(e,!0);let n=Ne(e,"progress",3,null);function a(w){return!w||w<0?"â":w<1e3?`${Math.round(w)}ms`:`${(w/1e3).toFixed(1)}s`}function s(w){return w?w>=1e3?`${(w/1e3).toFixed(1)}k`:String(w):"0"}function o(w){if(!w)return"â";const x=w.replace(/<.*>/,"").trim();return x.length>30?x.slice(0,28)+"â¦":x}function c(w){if(!w)return"";try{return new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let f=lt(()=>{var w;return(w=n())!=null&&w.total?Math.round(n().current/n().total*100):0}),m=lt(()=>{var w;return((w=n())==null?void 0:w.phase)==="done"});var h=Jn(),b=Xe(h);{var y=w=>{var x=Yy(),O=p(x),U=p(O),M=p(U);{var $=te=>{var ne=_n();Z(()=>F(ne,`Scan complete â ${(n().classified||0)??""} classified`)),E(te,ne)},ee=te=>{var ne=_n("Loading emailsâ¦");E(te,ne)},H=te=>{var ne=_n();Z(()=>F(ne,`Processing ${n().current??0??""} / ${n().total??0??""}`)),E(te,ne)};re(M,te=>{u(m)?te($):n().phase==="loading"?te(ee,1):te(H,!1)})}var C=_(U,2),Y=p(C),se=_(O,2),G=p(se);let me,ke;var de=_(se,2);{var pe=te=>{var ne=Cy(),W=p(ne),R=_(W);{var T=Ce=>{var P=Iy(),ye=p(P);Z(()=>F(ye,`Â· ${n().errors??""} errors`)),E(Ce,P)};re(R,Ce=>{n().errors&&Ce(T)})}var V=_(R,3),Te=_(V,2);Z((Ce,P,ye)=>{F(W,`${(n().classified||0)??""} classified `),F(V,` ${Ce??""} in + ${P??""} out `),F(Te,` ${ye??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(te,ne)};re(de,te=>{n().totals&&!u(m)&&te(pe)})}var ie=_(de,2);{var _e=te=>{var ne=Oy(),W=p(ne),R=p(W),T=p(R),V=_(R,2);{var Te=ye=>{var xe=Ry(),Pe=p(xe);Z(Ue=>F(Pe,`${Ue??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),E(ye,xe)};re(V,ye=>{var xe;(xe=n().live)!=null&&xe.tps&&ye(Te)})}var Ce=_(W,2),P=p(Ce);Z(()=>{F(T,n().email.subject||"(no subject)"),F(P,n().streamingText||"Waiting for modelâ¦")}),E(te,ne)};re(ie,te=>{!u(m)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&te(_e)})}var fe=_(ie,2);{var ue=te=>{var ne=zy(),W=p(ne),R=_(p(W),2),T=p(R),V=_(W,2);At(V,17,()=>n().results,Ut,(Te,Ce,P)=>{var ye=Fy();let xe;var Pe=p(ye),Ue=p(Pe);Ue.textContent=`${P+1}.`;var Ye=_(Ue,2),_t=p(Ye),St=_(Ye,2);{var Et=Ve=>{var Tt=Py(),qt=p(Tt);Z(()=>F(qt,u(Ce).classification.action)),E(Ve,Tt)},Ze=Ve=>{var Tt=My();E(Ve,Tt)};re(St,Ve=>{u(Ce).success?Ve(Et):Ve(Ze,!1)})}var Be=_(Pe,2),We=p(Be),pt=_(We);{var Mt=Ve=>{var Tt=Dy(),qt=_(Xe(Tt),1,!0);Z(Jt=>F(qt,Jt),[()=>c(u(Ce).email.date)]),E(Ve,Tt)};re(pt,Ve=>{u(Ce).email.date&&Ve(Mt)})}var Zt=_(Be,2);{var ut=Ve=>{var Tt=qy(),qt=Xe(Tt);{var Jt=at=>{var De=jy(),Lt=p(De);Z(()=>F(Lt,u(Ce).classification.summary)),E(at,De)};re(qt,at=>{u(Ce).classification.summary&&at(Jt)})}var Qt=_(qt,2);{var Bt=at=>{var De=Ly(),Lt=p(De),Kt=_(Lt,2),Qe=_(Kt,2);Z((be,dt)=>{F(Lt,`${be??""} `),F(Kt,` ${(u(Ce).stats.inputTokens||0)??""} in + ${(u(Ce).stats.numTokens||0)??""} out `),F(Qe,` ${dt??""}`)},[()=>u(Ce).stats.tps?`${u(Ce).stats.tps.toFixed(0)} tok/s`:"â",()=>a(u(Ce).stats.elapsed)]),E(at,De)};re(Qt,at=>{u(Ce).stats&&at(Bt)})}var It=_(Qt,2);{var $t=at=>{var De=Ny(),Lt=_(p(De),2),Kt=p(Lt);Z(()=>F(Kt,u(Ce).rawResponse)),E(at,De)};re(It,at=>{u(Ce).rawResponse&&at($t)})}E(Ve,Tt)},Je=Ve=>{var Tt=By(),qt=p(Tt);Z(()=>F(qt,u(Ce).error)),E(Ve,Tt)};re(Zt,Ve=>{u(Ce).success?Ve(ut):Ve(Je,!1)})}Z(Ve=>{xe=Rt(ye,1,"email-item svelte-t1ig66",null,xe,{failed:!u(Ce).success}),F(_t,u(Ce).email.subject||"(no subject)"),F(We,Ve)},[()=>o(u(Ce).email.from)]),E(Te,ye)}),Z(()=>F(T,n().results.length)),E(te,ne)};re(fe,te=>{var ne;((ne=n().results)==null?void 0:ne.length)>0&&te(ue)})}var he=_(fe,2);{var Se=te=>{var ne=Wy(),W=p(ne),R=p(W),T=p(R),V=_(R,4),Te=p(V),Ce=_(V,2);{var P=Ze=>{var Be=Uy(),We=_(Xe(Be)),pt=p(We);Z(()=>F(pt,`${n().errors??""} errors`)),E(Ze,Be)};re(Ce,Ze=>{n().errors>0&&Ze(P)})}var ye=_(Ce,2);{var xe=Ze=>{var Be=Ky(),We=_(Xe(Be)),pt=p(We);Z(()=>F(pt,`${n().summary.skipped??""} skipped`)),E(Ze,Be)};re(ye,Ze=>{var Be;(Be=n().summary)!=null&&Be.skipped&&Ze(xe)})}var Pe=_(W,2),Ue=p(Pe);{var Ye=Ze=>{var Be=Gy(),We=Xe(Be);Z(()=>F(We,`Avg ${n().summary.avgTps??""} tok/s`)),E(Ze,Be)};re(Ue,Ze=>{var Be;(Be=n().summary)!=null&&Be.avgTps&&Ze(Ye)})}var _t=_(Ue),St=_(_t,2),Et=_(St,2);Z((Ze,Be,We)=>{var pt,Mt;F(T,`${(((pt=n().summary)==null?void 0:pt.processed)||n().total||0)??""} processed`),F(Te,`${(n().classified||0)??""} classified`),F(_t,` ${Ze??""} in + ${Be??""} out `),F(St,` ${We??""} `),F(Et,` Model: ${(((Mt=n().summary)==null?void 0:Mt.modelName)||"Unknown")??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),E(te,ne)};re(he,te=>{u(m)&&n().totals&&te(Se)})}var oe=_(he,2),ve=p(oe);{var le=te=>{var ne=Hy(),W=Xe(ne);W.__click=function(...T){var V;(V=e.oninspect)==null||V.apply(this,T)};var R=_(W,2);R.__click=function(...T){var V;(V=e.onclose)==null||V.apply(this,T)},E(te,ne)},ce=te=>{var ne=Vy(),W=Xe(ne);W.__click=function(...T){var V;(V=e.oninspect)==null||V.apply(this,T)};var R=_(W,2);R.__click=function(...T){var V;(V=e.onstop)==null||V.apply(this,T)},E(te,ne)};re(ve,te=>{u(m)?te(le):te(ce,!1)})}Z(()=>{F(Y,`${u(f)??""}%`),me=Rt(G,1,"bar-fill svelte-t1ig66",null,me,{done:u(m)}),ke=on(G,"",ke,{width:`${u(f)??""}%`})}),E(w,x)};re(b,w=>{n()&&w(y)})}E(t,h),wt()}Nt(["click"]);var Xy=I('<span class="spinner svelte-ois7em"></span>'),Zy=al('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),Jy=I('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),$y=I("<option> </option>"),eb=I('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),tb=I('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function nb(t,e){bt(e,!0);let n=Ne(e,"engineStatus",3,"idle"),a=Ne(e,"modelName",3,""),s=Ne(e,"isScanning",3,!1),o=Ne(e,"scanProgress",3,null),c=Ne(e,"scanCount",15,20),f=Ne(e,"stats",3,null);const m=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function h(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function b(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function y(){return n()==="ready"&&!s()}let w=lt(()=>{var ne;return s()&&((ne=o())==null?void 0:ne.phase)!=="done"});var x=tb(),O=p(x),U=p(O),M=p(U);{var $=ne=>{var W=Xy();E(ne,W)},ee=ne=>{var W=Zy();E(ne,W)};re(M,ne=>{u(w)?ne($):ne(ee,!1)})}var H=_(U,2),C=p(H),Y=_(p(C),2);Y.__click=function(...ne){var W;(W=e.oninspect)==null||W.apply(this,ne)};var se=_(C,2),G=p(se);let me;var ke=_(G),de=_(O,2);{var pe=ne=>{var W=Jy(),R=p(W),T=p(R),V=_(R,4),Te=p(V),Ce=_(V,4),P=p(Ce);Z(()=>{F(T,`${f().totalEmails??""} emails in storage`),F(Te,`${f().classified??""} classified`),F(P,`${f().unclassified??""} new`)}),E(ne,W)};re(de,ne=>{f()&&ne(pe)})}var ie=_(de,2),_e=p(ie),fe=_(p(_e),2);At(fe,21,()=>m,Ut,(ne,W)=>{var R=$y(),T=p(R),V={};Z(()=>{F(T,u(W).label),V!==(V=u(W).value)&&(R.value=(R.__value=u(W).value)??"")}),E(ne,R)});var ue=_(_e,2),he=p(ue);he.__click=function(...ne){var W;(W=e.onscan)==null||W.apply(this,ne)};var Se=p(he),oe=_(he,2);oe.__click=function(...ne){var W;(W=e.onrescan)==null||W.apply(this,ne)};var ve=_(ie,2);{var le=ne=>{var W=eb();E(ne,W)};re(ve,ne=>{n()!=="ready"&&n()!=="loading"&&ne(le)})}var ce=_(ve,2);{var te=ne=>{Qy(ne,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};re(ce,ne=>{var W;(s()||((W=o())==null?void 0:W.phase)==="done")&&ne(te)})}Z((ne,W,R,T)=>{me=on(G,"",me,ne),F(ke,` ${W??""}`),fe.disabled=s(),he.disabled=R,F(Se,u(w)?"Scanning...":s()?"Finalizing...":"Scan New"),oe.disabled=T},[()=>({background:b()}),h,()=>!y(),()=>!y()]),Ri(fe,c),E(t,x),wt()}Nt(["click"]);var rb=I('<span class="row-date svelte-1czytqk"> </span>'),ab=I('<span class="tag svelte-1czytqk"> </span>'),sb=I('<span class="row-tags svelte-1czytqk"></span>'),ib=I('<span class="row-reason svelte-1czytqk"> </span>'),ob=I('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),lb=I('<span class="status-label svelte-1czytqk"> </span>'),cb=I('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),ub=I('<p class="summary-reason svelte-1czytqk"> </p>'),db=I('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),fb=I('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function zc(t,e){bt(e,!0);let n=Ne(e,"actionColor",3,"#666"),a=Ne(e,"dimmed",3,!1);function s(ue){if(!ue)return"";try{return new Date(ue).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=lt(()=>e.item.status==="pending"),c=Oe(!1);var f=fb(),m=Xe(f);let h;var b=p(m);b.__click=()=>A(c,!u(c));let y;var w=p(b),x=p(w),O=_(w,2),U=p(O),M=p(U),$=_(U,2);{var ee=ue=>{var he=rb(),Se=p(he);Z(oe=>F(Se,oe),[()=>s(e.item.date)]),E(ue,he)};re($,ue=>{e.item.date&&ue(ee)})}var H=_(O,2);{var C=ue=>{var he=sb();At(he,21,()=>e.item.tags,Ut,(Se,oe)=>{var ve=ab();let le;var ce=p(ve);Z(te=>{le=on(ve,"",le,te),F(ce,u(oe))},[()=>({background:Mp(u(oe))})]),E(Se,ve)}),E(ue,he)};re(H,ue=>{e.item.tags&&e.item.tags.length>0&&ue(C)})}var Y=_(H,2);{var se=ue=>{var he=ib(),Se=p(he);Z(()=>F(Se,e.item.reason)),E(ue,he)};re(Y,ue=>{e.item.reason&&!u(c)&&ue(se)})}var G=_(b,2),me=p(G);{var ke=ue=>{var he=ob(),Se=Xe(he);Se.__click=()=>e.onmarkacted(e.item.emailId);var oe=_(Se,2);oe.__click=()=>e.ondismiss(e.item.emailId),E(ue,he)},de=ue=>{var he=lb(),Se=p(he);Z(()=>F(Se,e.item.status)),E(ue,he)};re(me,ue=>{u(o)?ue(ke):ue(de,!1)})}var pe=_(me,2);{var ie=ue=>{var he=cb();he.__click=()=>e.onremove(e.item.emailId),E(ue,he)};re(pe,ue=>{e.onremove&&ue(ie)})}var _e=_(m,2);{var fe=ue=>{var he=db();let Se;var oe=p(he),ve=p(oe),le=_(oe,2);{var ce=te=>{var ne=ub(),W=p(ne);Z(()=>F(W,e.item.reason)),E(te,ne)};re(le,te=>{e.item.reason&&te(ce)})}Z(()=>{Se=on(he,"",Se,{"border-left-color":n()}),F(ve,e.item.summary)}),E(ue,he)};re(_e,ue=>{u(c)&&e.item.summary&&ue(fe)})}Z(()=>{h=Rt(m,1,"email-row svelte-1czytqk",null,h,{dimmed:a()}),y=on(b,"",y,{"border-left-color":n()}),F(x,e.item.subject),F(M,e.item.from)}),E(t,f),wt()}Nt(["click"]);var vb=I('<span class="group-acted svelte-tl1unp"> </span>'),pb=I('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),hb=I('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),mb=I('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),gb=I('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),_b=I('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),yb=I('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function bb(t,e){bt(e,!0);let n=Ne(e,"color",3,"#888");Ne(e,"count",3,0);let a=Ne(e,"items",19,()=>[]),s=Ne(e,"expanded",3,!1),o=lt(()=>a().filter(se=>se.status==="pending")),c=lt(()=>a().filter(se=>se.status!=="pending")),f=Oe(!1);function m(se){return se.split("_").map(G=>G.charAt(0)+G.slice(1).toLowerCase()).join(" ")}var h=yb(),b=p(h);b.__click=function(...se){var G;(G=e.ontoggle)==null||G.apply(this,se)};var y=p(b);let w;var x=p(y),O=_(y,2),U=p(O),M=_(O,2);{var $=se=>{var G=vb(),me=p(G);Z(()=>F(me,`${u(c).length??""} handled`)),E(se,G)};re(M,se=>{u(c).length>0&&se($)})}var ee=_(M,4);let H;var C=_(b,2);{var Y=se=>{var G=_b(),me=p(G);{var ke=Se=>{var oe=pb();E(Se,oe)};re(me,Se=>{u(o).length===0&&u(c).length===0&&Se(ke)})}var de=_(me,2);At(de,17,()=>u(o),Se=>Se.emailId,(Se,oe)=>{zc(Se,{get item(){return u(oe)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var pe=_(de,2);{var ie=Se=>{var oe=hb(),ve=p(oe),le=p(ve),ce=_(ve,2);At(ce,17,()=>u(c),te=>te.emailId,(te,ne)=>{zc(te,{get item(){return u(ne)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),Z(()=>F(le,`${u(c).length??""} handled`)),E(Se,oe)};re(pe,Se=>{u(c).length>0&&Se(ie)})}var _e=_(pe,2),fe=p(_e);{var ue=Se=>{var oe=mb();oe.__click=()=>A(f,!0),E(Se,oe)},he=Se=>{var oe=gb(),ve=p(oe),le=_(ve);le.__click=()=>A(f,!1);var ce=_(le,2);ce.__click=()=>{e.oncleargroup(),A(f,!1)},Z(()=>F(ve,`Clear ${a().length??""} items? `)),E(Se,oe)};re(fe,Se=>{u(f)?Se(he,!1):Se(ue)})}E(se,G)};re(C,se=>{s()&&se(Y)})}Z(se=>{w=on(y,"",w,{background:n()}),F(x,se),F(U,u(o).length),H=Rt(ee,0,"chevron svelte-tl1unp",null,H,{open:s()})},[()=>m(e.action)]),E(t,h),wt()}Nt(["click"]);var wb=I(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),kb=I(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),xb=I(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),Sb=I('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function Eb(t,e){bt(e,!0);let n=Ne(e,"open",15,!1),a=Ne(e,"sampleEmail",3,null),s=Oe("system");function o(){return a()?id(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function c(){n(!1)}function f(y){y.target===y.currentTarget&&c()}var m=Jn(),h=Xe(m);{var b=y=>{var w=Sb();w.__click=f,w.__keydown=ie=>ie.key==="Escape"&&c();var x=p(w),O=p(x),U=_(p(O),2);U.__click=c;var M=_(O,2),$=p(M);let ee;$.__click=()=>A(s,"system");var H=_($,2);let C;H.__click=()=>A(s,"email");var Y=_(H,2);let se;Y.__click=()=>A(s,"config");var G=_(M,2),me=p(G);{var ke=ie=>{var _e=wb(),fe=_(Xe(_e),2),ue=p(fe);Z(()=>F(ue,ys)),E(ie,_e)},de=ie=>{var _e=kb(),fe=_(Xe(_e),2),ue=_(p(fe),2);ue.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var he=_(fe,2),Se=_(p(he),2),oe=p(Se);Z(ve=>F(oe,ve),[o]),E(ie,_e)},pe=ie=>{var _e=xb(),fe=_(Xe(_e),2),ue=p(fe),he=_(p(ue),2),Se=p(he),oe=_(ue,2),ve=_(p(oe),2),le=p(ve),ce=_(oe,2),te=_(p(ce),2),ne=p(te),W=_(fe,4);W.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,Z(()=>{F(Se,Cp.maxTokens),F(le,"false"),F(ne,"false")}),E(ie,_e)};re(me,ie=>{u(s)==="system"?ie(ke):u(s)==="email"?ie(de,1):u(s)==="config"&&ie(pe,2)})}Z(()=>{ee=Rt($,1,"tab svelte-10pcy9j",null,ee,{active:u(s)==="system"}),C=Rt(H,1,"tab svelte-10pcy9j",null,C,{active:u(s)==="email"}),se=Rt(Y,1,"tab svelte-10pcy9j",null,se,{active:u(s)==="config"})}),E(y,w)};re(h,y=>{n()&&y(b)})}E(t,m),wt()}Nt(["click","keydown"]);var Tb=I('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),Ab=I('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="type-count svelte-d25j4l"> </span></button>'),Ib=I('<button class="text-btn svelte-d25j4l">Reset to defaults</button>'),Cb=I('<div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" placeholder="Icon (emoji)" class="icon-input svelte-d25j4l"/> <input type="text" placeholder="Action name" class="name-input svelte-d25j4l"/></div> <input type="text" placeholder="Description" class="desc-input svelte-d25j4l"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Add Action</button></div></div>'),Rb=I('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),Ob=I('<span class="cmd-icon svelte-d25j4l"> </span>'),Pb=I('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),Mb=I('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),Db=I('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <!> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),jb=I('<div class="no-selection svelte-d25j4l"><p class="svelte-d25j4l">Select an event type on the left to view and edit its commands.</p></div>'),Lb=I('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function Nb(t,e){bt(e,!0);let n=Ne(e,"open",15,!1),a=Oe(jt([])),s=Oe(null),o=Oe(jt([])),c=Oe(null),f=Oe(!1),m=Oe(""),h=Oe(!1),b=Oe(jt({name:"",description:"",icon:""}));async function y(){A(a,await vp(),!0),u(s)&&A(o,La(u(s)).map(de=>({...de})),!0)}Sa(()=>{n()&&y()});function w(de){A(s,de,!0),A(o,La(de).map(pe=>({...pe})),!0),A(c,null),A(h,!1)}function x(de){return de.split("_").map(pe=>pe.charAt(0)+pe.slice(1).toLowerCase()).join(" ")}function O(de){return`hsl(${Oi(de)}, 55%, 55%)`}async function U(){const de=u(m).trim();if(!de)return;wp(de),A(m,""),A(f,!1),await y();const pe=de.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");w(pe)}async function M(){u(s)&&(Sp(u(s)),await y(),A(o,La(u(s)).map(de=>({...de})),!0))}async function $(){if(!u(b).name.trim())return;const de=u(b).name.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");mp(u(s),{id:de,name:u(b).name.trim(),description:u(b).description.trim(),icon:u(b).icon.trim()||void 0}),A(b,{name:"",description:"",icon:""},!0),A(h,!1),await y()}async function ee(de){_p(u(s),de),await y()}function H(de){A(c,{...de},!0)}async function C(){u(c)&&(bp(u(s),u(c).id,{name:u(c).name,description:u(c).description,icon:u(c).icon}),A(c,null),await y())}function Y(){A(c,null)}async function se(de,pe){const ie=[...u(o)],_e=de+pe;_e<0||_e>=ie.length||([ie[de],ie[_e]]=[ie[_e],ie[de]],pp(u(s),ie),await y())}var G=Jn(),me=Xe(G);{var ke=de=>{var pe=Lb(),ie=p(pe),_e=p(ie),fe=_(p(_e),4);fe.__click=()=>n(!1);var ue=_(_e,2),he=p(ue),Se=p(he),oe=_(p(Se),2);oe.__click=()=>A(f,!u(f));var ve=_(Se,2);{var le=T=>{var V=Tb(),Te=p(V);Te.__keydown=P=>P.key==="Enter"&&U();var Ce=_(Te,2);Ce.__click=U,or(Te,()=>u(m),P=>A(m,P)),E(T,V)};re(ve,T=>{u(f)&&T(le)})}var ce=_(ve,2);At(ce,21,()=>u(a),Ut,(T,V)=>{var Te=Ab();let Ce;Te.__click=()=>w(u(V));var P=p(Te);let ye;var xe=_(P,2),Pe=p(xe),Ue=_(xe,2),Ye=p(Ue);Z((_t,St,Et)=>{Ce=Rt(Te,1,"type-item svelte-d25j4l",null,Ce,{selected:u(s)===u(V)}),ye=on(P,"",ye,_t),F(Pe,St),F(Ye,Et)},[()=>({background:O(u(V))}),()=>x(u(V)),()=>La(u(V)).length]),E(T,Te)});var te=_(he,2),ne=p(te);{var W=T=>{var V=Db(),Te=Xe(V),Ce=p(Te);let P;var ye=p(Ce),xe=_(Ce,2),Pe=p(xe),Ue=_(xe,6);{var Ye=ut=>{var Je=Ib();Je.__click=M,E(ut,Je)},_t=lt(()=>xp(u(s)));re(Ue,ut=>{u(_t)&&ut(Ye)})}var St=_(Ue,2);St.__click=()=>{A(h,!u(h)),A(c,null)};var Et=p(St),Ze=_(Te,2);{var Be=ut=>{var Je=Cb(),Ve=p(Je),Tt=p(Ve),qt=_(Tt,2),Jt=_(Ve,2),Qt=_(Jt,2),Bt=p(Qt);Bt.__click=$,or(Tt,()=>u(b).icon,It=>u(b).icon=It),or(qt,()=>u(b).name,It=>u(b).name=It),or(Jt,()=>u(b).description,It=>u(b).description=It),E(ut,Je)};re(Ze,ut=>{u(h)&&ut(Be)})}var We=_(Ze,2),pt=p(We);At(pt,19,()=>u(o),ut=>ut.id,(ut,Je,Ve)=>{var Tt=Jn(),qt=Xe(Tt);{var Jt=Bt=>{var It=Rb(),$t=p(It),at=p($t),De=_(at,2),Lt=_($t,2),Kt=_(Lt,2),Qe=p(Kt);Qe.__click=C;var be=_(Qe,2);be.__click=Y,or(at,()=>u(c).icon,dt=>u(c).icon=dt),or(De,()=>u(c).name,dt=>u(c).name=dt),or(Lt,()=>u(c).description,dt=>u(c).description=dt),E(Bt,It)},Qt=Bt=>{var It=Pb(),$t=p(It),at=p($t),De=_($t,2),Lt=p(De);{var Kt=mn=>{var zn=Ob(),Rn=p(zn);Z(()=>F(Rn,u(Je).icon)),E(mn,zn)};re(Lt,mn=>{u(Je).icon&&mn(Kt)})}var Qe=_(Lt,2),be=p(Qe),dt=p(be),rn=_(be,2),Xt=p(rn),hr=_(De,2),Bn=p(hr);Bn.__click=()=>se(u(Ve),-1);var Ct=_(Bn,2);Ct.__click=()=>se(u(Ve),1);var kn=_(Ct,2);kn.__click=()=>H(u(Je));var Fn=_(kn,2);Fn.__click=()=>ee(u(Je).id),Z(()=>{F(at,u(Ve)+1),F(dt,u(Je).name),F(Xt,u(Je).description),Bn.disabled=u(Ve)===0,Ct.disabled=u(Ve)===u(o).length-1}),E(Bt,It)};re(qt,Bt=>{var It;((It=u(c))==null?void 0:It.id)===u(Je).id?Bt(Jt):Bt(Qt,!1)})}E(ut,Tt)});var Mt=_(pt,2);{var Zt=ut=>{var Je=Mb();E(ut,Je)};re(Mt,ut=>{u(o).length===0&&ut(Zt)})}Z((ut,Je)=>{P=on(Ce,"",P,ut),F(ye,Je),F(Pe,`${u(o).length??""} action${u(o).length===1?"":"s"}`),F(Et,u(h)?"Cancel":"+ Add Action")},[()=>({background:O(u(s))}),()=>x(u(s))]),E(T,V)},R=T=>{var V=jb();E(T,V)};re(ne,T=>{u(s)?T(W):T(R,!1)})}E(de,pe)};re(me,de=>{n()&&de(ke)})}E(t,G),wt()}Nt(["click","keydown"]);var qb=I('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Bb=I('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),Fb=I('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),zb=I('<button class="chip svelte-s2dwjj"> </button>'),Ub=I('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),Kb=I('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Gb=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),Wb=I('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Hb=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),Vb=I('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Yb=I('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),Qb=I('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),Xb=I('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),Zb=I('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),Jb=I('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),$b=I('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function e1(t,e){bt(e,!0);let n=Ne(e,"groupOrder",19,()=>[]),a=Oe(!1),s=Oe(null),o=Oe(!1),c=Oe(null);async function f(){var pe;const[G,me,ke]=await Promise.all([Ge.items.where("sourceType").equals("gmail").count(),Ge.emailClassifications.count(),Ge.contacts.count()]);let de=0;try{const ie=await((pe=navigator.storage)==null?void 0:pe.estimate());de=(ie==null?void 0:ie.usage)??0}catch{}A(c,{emailCount:G,classCount:me,contactCount:ke,totalBytes:de},!0)}function m(G){return G?G<1024?`${G} B`:G<1024*1024?`${(G/1024).toFixed(1)} KB`:`${(G/(1024*1024)).toFixed(1)} MB`:"â"}function h(){A(a,!u(a)),u(a)&&f()}async function b(G){var me;A(o,!0),A(s,null);try{await G(),await f(),(me=e.onrefresh)==null||me.call(e)}finally{A(o,!1)}}async function y(){await b(()=>gc())}async function w(G){await b(()=>ul(G))}async function x(){await b(async()=>{await dd(),await gc()})}async function O(){await b(()=>Ge.contacts.clear())}async function U(){await b(async()=>{await Ge.delete(),window.location.reload()})}function M(G){return G.split("_").map(me=>me.charAt(0)+me.slice(1).toLowerCase()).join(" ")}var $=$b(),ee=p($);ee.__click=h;var H=_(p(ee),2);let C;var Y=_(ee,2);{var se=G=>{var me=Jb(),ke=p(me);{var de=P=>{var ye=Bb(),xe=p(ye),Pe=p(xe),Ue=_(xe,4),Ye=p(Ue),_t=_(Ue,4),St=p(_t),Et=_(_t,2);{var Ze=Be=>{var We=qb(),pt=_(Xe(We),2),Mt=p(pt);Z(Zt=>F(Mt,`${Zt??""} used`),[()=>m(u(c).totalBytes)]),E(Be,We)};re(Et,Be=>{u(c).totalBytes&&Be(Ze)})}Z(()=>{F(Pe,`${u(c).emailCount??""} emails`),F(Ye,`${u(c).classCount??""} classifications`),F(St,`${u(c).contactCount??""} contacts`)}),E(P,ye)};re(ke,P=>{u(c)&&P(de)})}var pe=_(ke,2);{var ie=P=>{var ye=Ub(),xe=_(p(ye),2);At(xe,21,n,Ut,(Pe,Ue)=>{var Ye=Jn(),_t=Xe(Ye);{var St=Ze=>{var Be=Fb(),We=p(Be),pt=_(We);pt.__click=()=>A(s,null);var Mt=_(pt,2);Mt.__click=()=>w(u(Ue)),Z(Zt=>{F(We,`Delete ${Zt??""}? `),Mt.disabled=u(o)},[()=>M(u(Ue))]),E(Ze,Be)},Et=Ze=>{var Be=zb();Be.__click=()=>A(s,`group:${u(Ue)}`);var We=p(Be);Z(pt=>{Be.disabled=u(o),F(We,`${pt??""} â`)},[()=>M(u(Ue))]),E(Ze,Be)};re(_t,Ze=>{u(s)===`group:${u(Ue)}`?Ze(St):Ze(Et,!1)})}E(Pe,Ye)}),E(P,ye)};re(pe,P=>{n().length>0&&P(ie)})}var _e=_(pe,2),fe=_(p(_e),2),ue=p(fe);{var he=P=>{var ye=Kb(),xe=_(p(ye),2);xe.__click=()=>A(s,null);var Pe=_(xe,2);Pe.__click=y,Z(()=>Pe.disabled=u(o)),E(P,ye)},Se=P=>{var ye=Gb();ye.__click=()=>A(s,"classifications"),Z(()=>ye.disabled=u(o)),E(P,ye)};re(ue,P=>{u(s)==="classifications"?P(he):P(Se,!1)})}var oe=_(ue,2);{var ve=P=>{var ye=Wb(),xe=_(p(ye),2);xe.__click=()=>A(s,null);var Pe=_(xe,2);Pe.__click=x,Z(()=>Pe.disabled=u(o)),E(P,ye)},le=P=>{var ye=Hb();ye.__click=()=>A(s,"emails"),Z(()=>ye.disabled=u(o)),E(P,ye)};re(oe,P=>{u(s)==="emails"?P(ve):P(le,!1)})}var ce=_(oe,2);{var te=P=>{var ye=Vb(),xe=_(p(ye),2);xe.__click=()=>A(s,null);var Pe=_(xe,2);Pe.__click=O,Z(()=>Pe.disabled=u(o)),E(P,ye)},ne=P=>{var ye=Yb();ye.__click=()=>A(s,"contacts"),Z(()=>ye.disabled=u(o)),E(P,ye)};re(ce,P=>{u(s)==="contacts"?P(te):P(ne,!1)})}var W=_(_e,2),R=p(W);{var T=P=>{var ye=Qb(),xe=_(p(ye),2);xe.__click=()=>A(s,null);var Pe=_(xe,2);Pe.__click=U,Z(()=>Pe.disabled=u(o)),E(P,ye)},V=P=>{var ye=Xb();ye.__click=()=>A(s,"nuke"),Z(()=>ye.disabled=u(o)),E(P,ye)};re(R,P=>{u(s)==="nuke"?P(T):P(V,!1)})}var Te=_(W,2);{var Ce=P=>{var ye=Zb();E(P,ye)};re(Te,P=>{u(o)&&P(Ce)})}E(G,me)};re(Y,G=>{u(a)&&G(se)})}Z(()=>C=Rt(H,0,"chev svelte-s2dwjj",null,C,{open:u(a)})),E(t,$),wt()}Nt(["click"]);var t1=I('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),n1=I('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),r1=I('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),a1=I('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <div class="toolbar svelte-12gkq0i"><button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!></div>');function s1(t,e){bt(e,!0);let n=Ne(e,"groups",19,()=>({})),a=Ne(e,"groupOrder",19,()=>[]),s=Ne(e,"counts",19,()=>({})),o=Ne(e,"stats",3,null),c=Ne(e,"expandedGroup",3,null),f=Ne(e,"isScanning",3,!1),m=Ne(e,"scanProgress",3,null),h=Ne(e,"scanCount",15,20),b=Ne(e,"error",3,null),y=Oe(!1),w=Oe(!1),x=lt(()=>{for(const de of a()){const pe=n()[de];if((pe==null?void 0:pe.length)>0)return pe[0]}return null});var O=a1(),U=p(O);nb(U,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return f()},get scanProgress(){return m()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>A(y,!0),get scanCount(){return h()},set scanCount(de){h(de)}});var M=_(U,2);Eb(M,{get sampleEmail(){return u(x)},get open(){return u(y)},set open(de){A(y,de,!0)}});var $=_(M,2);Nb($,{get open(){return u(w)},set open(de){A(w,de,!0)}});var ee=_($,2),H=p(ee);H.__click=()=>A(w,!0);var C=_(ee,2);{var Y=de=>{var pe=t1(),ie=p(pe),_e=p(ie),fe=_(ie,2);fe.__click=function(...ue){var he;(he=e.ondismisserror)==null||he.apply(this,ue)},Z(()=>F(_e,b())),E(de,pe)};re(C,de=>{b()&&de(Y)})}var se=_(C,2);{var G=de=>{var pe=n1(),ie=Xe(pe);At(ie,20,a,he=>he,(he,Se)=>{{let oe=lt(()=>No(Se)),ve=lt(()=>{var te;return((te=n()[Se])==null?void 0:te.length)||0}),le=lt(()=>n()[Se]||[]),ce=lt(()=>c()===Se);bb(he,{get action(){return Se},get color(){return u(oe)},get count(){return u(ve)},get items(){return u(le)},get expanded(){return u(ce)},ontoggle:()=>e.ontogglegroup(Se),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(Se)})}});var _e=_(ie,2),fe=p(_e),ue=p(fe);Z(()=>F(ue,`${s().total??""} emails classified into ${a().length??""} groups`)),E(de,pe)},me=de=>{var pe=r1();E(de,pe)};re(se,de=>{s().total>0?de(G):f()||de(me,1)})}var ke=_(se,2);e1(ke,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),E(t,O),wt()}Nt(["click"]);var i1=I('<div class="actions-page svelte-3tch4q"><!></div>');function o1(t,e){bt(e,!0);const n=Ku();let a=Oe(jt(n.status)),s=Oe(""),o=Oe(jt({})),c=Oe(jt([])),f=Oe(jt({total:0})),m=Oe(null),h=Oe(null),b=Oe(!1),y=Oe(null),w=Oe(3),x=Oe(null),O=Oe(null);const U="me-ai-scan-history";function M(){try{const fe=localStorage.getItem(U);if(fe)return JSON.parse(fe)}catch{}return null}function $(fe){if(!(!fe||fe.phase!=="done"))try{const ue={timestamp:Date.now(),classified:fe.classified||0,errors:fe.errors||0,total:fe.total||0,results:fe.results||[],totals:fe.totals||{},summary:fe.summary||{}};localStorage.setItem(U,JSON.stringify(ue))}catch{}}dn(()=>{const fe=n.onMessage(he=>{if(he.status==="ready"){A(a,"ready");const Se=Sr.find(le=>le.id===n.modelId),oe=fr.find(le=>le.name===n.modelId),ve=Se||oe;A(s,(ve==null?void 0:ve.name)||(ve==null?void 0:ve.displayName)||n.modelId||"",!0)}he.status==="loading"&&A(a,"loading")});if(A(a,n.status,!0),n.modelId){const he=Sr.find(ve=>ve.id===n.modelId),Se=fr.find(ve=>ve.name===n.modelId),oe=he||Se;A(s,(oe==null?void 0:oe.name)||(oe==null?void 0:oe.displayName)||n.modelId||"",!0)}const ue=M();return ue&&A(y,{phase:"done",...ue},!0),ee(),()=>fe()});async function ee(){try{const fe=await ad();A(o,fe.groups,!0),A(c,fe.order,!0),A(f,await Rp(),!0),A(m,await Lo(),!0)}catch(fe){A(x,`Failed to load data: ${fe.message}`)}}async function H(){await Y(!1)}async function C(){await Y(!0)}async function Y(fe){if(u(b)||!n.isReady)return;A(x,null),A(b,!0),A(y,null);const ue=new AbortController;A(O,ue,!0);try{await rd(n,{count:u(w),force:fe,signal:ue.signal,onProgress:he=>{A(y,{...he},!0),he.phase==="done"&&$(he)}}),await ee()}catch(he){ue.signal.aborted||A(x,`Scan failed: ${he.message}`)}finally{A(b,!1),A(O,null)}}function se(){var fe;(fe=u(O))==null||fe.abort()}async function G(fe){await bi(fe,"acted"),await ee()}async function me(fe){await bi(fe,"dismissed"),await ee()}async function ke(fe){await sd(fe),await ee()}async function de(fe){await ul(fe),await ee()}function pe(fe){A(h,u(h)===fe?null:fe,!0)}var ie=i1(),_e=p(ie);s1(_e,{get engineStatus(){return u(a)},get modelName(){return u(s)},get groups(){return u(o)},get groupOrder(){return u(c)},get counts(){return u(f)},get stats(){return u(m)},get expandedGroup(){return u(h)},get isScanning(){return u(b)},get scanProgress(){return u(y)},get error(){return u(x)},onscan:H,onrescan:C,ontogglegroup:pe,onmarkacted:G,ondismiss:me,onremove:ke,oncleargroup:de,ondismisserror:()=>A(x,null),onstop:se,onrefresh:ee,oncloseprogress:()=>{A(y,null),localStorage.removeItem(U)},get scanCount(){return u(w)},set scanCount(fe){A(w,fe,!0)}}),E(t,ie),wt()}var l1=I('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function c1(t,e){bt(e,!0);function n(){const G=location.hash;return G==="#dashboard"?"dashboard":G==="#actions"?"actions":"chat"}let a=Oe(jt(n()));dn(()=>{function G(){A(a,n(),!0)}return window.addEventListener("hashchange",G),()=>window.removeEventListener("hashchange",G)});var s=l1(),o=p(s),c=_(p(o),2),f=p(c);let m;var h=_(f,2);let b;var y=_(h,2);let w;var x=_(o,2),O=p(x);let U;var M=p(O);Vm(M,{});var $=_(O,2);let ee;var H=p($);o1(H,{});var C=_($,2);let Y;var se=p(C);Ay(se,{}),Z(()=>{m=Rt(f,1,"svelte-1n46o8q",null,m,{active:u(a)==="chat"}),b=Rt(h,1,"svelte-1n46o8q",null,b,{active:u(a)==="actions"}),w=Rt(y,1,"svelte-1n46o8q",null,w,{active:u(a)==="dashboard"}),U=on(O,"",U,{display:u(a)==="chat"?"flex":"none"}),ee=on($,"",ee,{display:u(a)==="actions"?"flex":"none"}),Y=on(C,"",Y,{display:u(a)==="dashboard"?"flex":"none"})}),E(t,s),wt()}mv(c1,{target:document.getElementById("app")});
