var Km=Object.defineProperty;var If=t=>{throw TypeError(t)};var Hm=(t,e,n)=>e in t?Km(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ht=(t,e,n)=>Hm(t,typeof e!="symbol"?e+"":e,n),zc=(t,e,n)=>e.has(t)||If("Cannot "+n);var U=(t,e,n)=>(zc(t,e,"read from private field"),n?n.call(t):e.get(t)),Pe=(t,e,n)=>e.has(t)?If("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),Et=(t,e,n,r)=>(zc(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),An=(t,e,n)=>(zc(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const du=!1;var Ul=Array.isArray,Gm=Array.prototype.indexOf,ti=Array.prototype.includes,Vl=Array.from,Um=Object.defineProperty,ja=Object.getOwnPropertyDescriptor,ch=Object.getOwnPropertyDescriptors,uh=Object.prototype,Vm=Array.prototype,Wl=Object.getPrototypeOf,Pf=Object.isExtensible;function Ci(t){return typeof t=="function"}const Es=()=>{};function Wm(t){return t()}function fu(t){for(var e=0;e<t.length;e++)t[e]()}function dh(){var t,e,n=new Promise((r,a)=>{t=r,e=a});return{promise:n,resolve:t,reject:e}}function Bn(t,e,n=!1){return t===void 0?n?e():e:t}function ho(t,e){if(Array.isArray(t))return t;if(e===void 0||!(Symbol.iterator in t))return Array.from(t);const n=[];for(const r of t)if(n.push(r),n.length===e)break;return n}const In=2,Zi=4,po=8,td=1<<24,ka=16,zr=32,Ua=64,fh=128,gr=512,xn=1024,Pn=2048,Lr=4096,cr=8192,_a=16384,go=32768,Fa=65536,Mf=1<<17,vh=1<<18,As=1<<19,hh=1<<20,ga=1<<25,gs=65536,vu=1<<21,nd=1<<22,za=1<<23,Jr=Symbol("$state"),ph=Symbol("legacy props"),Ym=Symbol(""),rs=new class extends Error{constructor(){super(...arguments);ht(this,"name","StaleReactionError");ht(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};var sh;const gh=((sh=globalThis.document)==null?void 0:sh.contentType.includes("xml"))??!1;function rd(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Xm(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Zm(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function Qm(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Jm(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function $m(t){throw new Error("https://svelte.dev/e/effect_orphan")}function ey(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ty(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function ny(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ry(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ay(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function sy(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const iy=1,oy=2,mh=4,ly=8,cy=16,uy=1,dy=2,fy=4,vy=8,hy=16,yh=1,py=2,wn=Symbol(),_h="http://www.w3.org/1999/xhtml",gy="@attach";function my(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function yy(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function bh(t){return t===this.v}function wh(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function xh(t){return!wh(t,this.v)}let vi=!1,_y=!1;function by(){vi=!0}const wy=[];function kh(t,e=!1,n=!1){return ol(t,new Map,"",wy,null,n)}function ol(t,e,n,r,a=null,s=!1){if(typeof t=="object"&&t!==null){var i=e.get(t);if(i!==void 0)return i;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(Ul(t)){var l=Array(t.length);e.set(t,l),a!==null&&e.set(a,l);for(var u=0;u<t.length;u+=1){var d=t[u];u in t&&(l[u]=ol(d,e,n,r,null,s))}return l}if(Wl(t)===uh){l={},e.set(t,l),a!==null&&e.set(a,l);for(var v in t)l[v]=ol(t[v],e,n,r,null,s);return l}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return ol(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let tn=null;function ni(t){tn=t}function ad(t){return sd().get(t)}function Sh(t,e){return sd().set(t,e),e}function xy(t){return sd().has(t)}function at(t,e=!1,n){tn={p:tn,i:!1,c:null,e:null,s:t,x:null,l:vi&&!e?{s:null,u:null,$:[]}:null}}function st(t){var e=tn,n=e.e;if(n!==null){e.e=null;for(var r of n)Vh(r)}return t!==void 0&&(e.x=t),e.i=!0,tn=e.p,t??{}}function mo(){return!vi||tn!==null&&tn.l===null}function sd(t){return tn===null&&rd(),tn.c??(tn.c=new Map(ky(tn)||void 0))}function ky(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let as=[];function Eh(){var t=as;as=[],fu(t)}function $r(t){if(as.length===0&&!Gi){var e=as;queueMicrotask(()=>{e===as&&Eh()})}as.push(t)}function Sy(){for(;as.length>0;)Eh()}function Ah(t){var e=Yt;if(e===null)return Lt.f|=za,t;if((e.f&go)===0&&(e.f&Zi)===0)throw t;ri(t,e)}function ri(t,e){for(;e!==null;){if((e.f&fh)!==0){if((e.f&go)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Ey=-7169;function gn(t,e){t.f=t.f&Ey|e}function id(t){(t.f&gr)!==0||t.deps===null?gn(t,xn):gn(t,Lr)}function Th(t){if(t!==null)for(const e of t)(e.f&In)===0||(e.f&gs)===0||(e.f^=gs,Th(e.deps))}function Ch(t,e,n){(t.f&Pn)!==0?e.add(t):(t.f&Lr)!==0&&n.add(t),Th(t.deps),gn(t,xn)}const Vo=new Set;let It=null,bl=null,Tn=null,Qn=[],Yl=null,hu=!1,Gi=!1;var Ws,Ys,os,Xs,io,oo,ls,da,Zs,sa,pu,gu,Ih;const ef=class ef{constructor(){Pe(this,sa);ht(this,"committed",!1);ht(this,"current",new Map);ht(this,"previous",new Map);Pe(this,Ws,new Set);Pe(this,Ys,new Set);Pe(this,os,0);Pe(this,Xs,0);Pe(this,io,null);Pe(this,oo,new Set);Pe(this,ls,new Set);Pe(this,da,new Map);ht(this,"is_fork",!1);Pe(this,Zs,!1)}is_deferred(){return this.is_fork||U(this,Xs)>0}skip_effect(e){U(this,da).has(e)||U(this,da).set(e,{d:[],m:[]})}unskip_effect(e){var n=U(this,da).get(e);if(n){U(this,da).delete(e);for(var r of n.d)gn(r,Pn),Nr(r);for(r of n.m)gn(r,Lr),Nr(r)}}process(e){var a;Qn=[],this.apply();var n=[],r=[];for(const s of e)An(this,sa,pu).call(this,s,n,r);if(this.is_deferred()){An(this,sa,gu).call(this,r),An(this,sa,gu).call(this,n);for(const[s,i]of U(this,da))Nh(s,i)}else{for(const s of U(this,Ws))s();U(this,Ws).clear(),U(this,os)===0&&An(this,sa,Ih).call(this),bl=this,It=null,Of(r),Of(n),bl=null,(a=U(this,io))==null||a.resolve()}Tn=null}capture(e,n){n!==wn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&za)===0&&(this.current.set(e,e.v),Tn==null||Tn.set(e,e.v))}activate(){It=this,this.apply()}deactivate(){It===this&&(It=null,Tn=null)}flush(){if(this.activate(),Qn.length>0){if(Ph(),It!==null&&It!==this)return}else U(this,os)===0&&this.process([]);this.deactivate()}discard(){for(const e of U(this,Ys))e(this);U(this,Ys).clear()}increment(e){Et(this,os,U(this,os)+1),e&&Et(this,Xs,U(this,Xs)+1)}decrement(e){Et(this,os,U(this,os)-1),e&&Et(this,Xs,U(this,Xs)-1),!U(this,Zs)&&(Et(this,Zs,!0),$r(()=>{Et(this,Zs,!1),this.is_deferred()?Qn.length>0&&this.flush():this.revive()}))}revive(){for(const e of U(this,oo))U(this,ls).delete(e),gn(e,Pn),Nr(e);for(const e of U(this,ls))gn(e,Lr),Nr(e);this.flush()}oncommit(e){U(this,Ws).add(e)}ondiscard(e){U(this,Ys).add(e)}settled(){return(U(this,io)??Et(this,io,dh())).promise}static ensure(){if(It===null){const e=It=new ef;Vo.add(It),Gi||$r(()=>{It===e&&e.flush()})}return It}apply(){}};Ws=new WeakMap,Ys=new WeakMap,os=new WeakMap,Xs=new WeakMap,io=new WeakMap,oo=new WeakMap,ls=new WeakMap,da=new WeakMap,Zs=new WeakMap,sa=new WeakSet,pu=function(e,n,r){e.f^=xn;for(var a=e.first,s=null;a!==null;){var i=a.f,l=(i&(zr|Ua))!==0,u=l&&(i&xn)!==0,d=u||(i&cr)!==0||U(this,da).has(a);if(!d&&a.fn!==null){l?a.f^=xn:s!==null&&(i&(Zi|po|td))!==0?s.b.defer_effect(a):(i&Zi)!==0?n.push(a):wo(a)&&((i&ka)!==0&&U(this,ls).add(a),si(a));var v=a.first;if(v!==null){a=v;continue}}var p=a.parent;for(a=a.next;a===null&&p!==null;)p===s&&(s=null),a=p.next,p=p.parent}},gu=function(e){for(var n=0;n<e.length;n+=1)Ch(e[n],U(this,oo),U(this,ls))},Ih=function(){var a;if(Vo.size>1){this.previous.clear();var e=Tn,n=!0;for(const s of Vo){if(s===this){n=!1;continue}const i=[];for(const[u,d]of this.current){if(s.current.has(u))if(n&&d!==s.current.get(u))s.current.set(u,d);else continue;i.push(u)}if(i.length===0)continue;const l=[...s.current.keys()].filter(u=>!this.current.has(u));if(l.length>0){var r=Qn;Qn=[];const u=new Set,d=new Map;for(const v of i)Mh(v,l,u,d);if(Qn.length>0){It=s,s.apply();for(const v of Qn)An(a=s,sa,pu).call(a,v,[],[]);s.deactivate()}Qn=r}}It=null,Tn=e}this.committed=!0,Vo.delete(this)};let ba=ef;function Ay(t){var e=Gi;Gi=!0;try{for(var n;;){if(Sy(),Qn.length===0&&(It==null||It.flush(),Qn.length===0))return Yl=null,n;Ph()}}finally{Gi=e}}function Ph(){hu=!0;var t=null;try{for(var e=0;Qn.length>0;){var n=ba.ensure();if(e++>1e3){var r,a;Ty()}n.process(Qn),qa.clear()}}finally{Qn=[],hu=!1,Yl=null}}function Ty(){try{ey()}catch(t){ri(t,Yl)}}let Ar=null;function Of(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(_a|cr))===0&&wo(r)&&(Ar=new Set,si(r),r.deps===null&&r.first===null&&r.nodes===null&&r.teardown===null&&r.ac===null&&Jh(r),(Ar==null?void 0:Ar.size)>0)){qa.clear();for(const a of Ar){if((a.f&(_a|cr))!==0)continue;const s=[a];let i=a.parent;for(;i!==null;)Ar.has(i)&&(Ar.delete(i),s.push(i)),i=i.parent;for(let l=s.length-1;l>=0;l--){const u=s[l];(u.f&(_a|cr))===0&&si(u)}}Ar.clear()}}Ar=null}}function Mh(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const a of t.reactions){const s=a.f;(s&In)!==0?Mh(a,e,n,r):(s&(nd|ka))!==0&&(s&Pn)===0&&Oh(a,e,r)&&(gn(a,Pn),Nr(a))}}function Oh(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const a of t.deps){if(ti.call(e,a))return!0;if((a.f&In)!==0&&Oh(a,e,n))return n.set(a,!0),!0}return n.set(t,!1),!1}function Nr(t){for(var e=Yl=t;e.parent!==null;){e=e.parent;var n=e.f;if(hu&&e===Yt&&(n&ka)!==0&&(n&vh)===0)return;if((n&(Ua|zr))!==0){if((n&xn)===0)return;e.f^=xn}}Qn.push(e)}function Nh(t,e){if(!((t.f&zr)!==0&&(t.f&xn)!==0)){(t.f&Pn)!==0?e.d.push(t):(t.f&Lr)!==0&&e.m.push(t),gn(t,xn);for(var n=t.first;n!==null;)Nh(n,e),n=n.next}}function Dh(t){let e=0,n=ms(0),r;return()=>{cd()&&(o(n),Zl(()=>(e===0&&(r=er(()=>t(()=>Ui(n)))),e+=1,()=>{$r(()=>{e-=1,e===0&&(r==null||r(),r=void 0,Ui(n))})})))}}var Cy=Fa|As|fh;function Iy(t,e,n){new Py(t,e,n)}var hr,ed,Ur,cs,Vr,pr,Yn,Wr,fa,Na,us,Da,Qs,ds,Js,$s,va,Fl,Sn,My,Oy,mu,ll,cl,yu;class Py{constructor(e,n,r){Pe(this,Sn);ht(this,"parent");ht(this,"is_pending",!1);Pe(this,hr);Pe(this,ed,null);Pe(this,Ur);Pe(this,cs);Pe(this,Vr);Pe(this,pr,null);Pe(this,Yn,null);Pe(this,Wr,null);Pe(this,fa,null);Pe(this,Na,null);Pe(this,us,0);Pe(this,Da,0);Pe(this,Qs,!1);Pe(this,ds,!1);Pe(this,Js,new Set);Pe(this,$s,new Set);Pe(this,va,null);Pe(this,Fl,Dh(()=>(Et(this,va,ms(U(this,us))),()=>{Et(this,va,null)})));Et(this,hr,e),Et(this,Ur,n),Et(this,cs,r),this.parent=Yt.b,this.is_pending=!!U(this,Ur).pending,Et(this,Vr,bo(()=>{Yt.b=this;{var a=An(this,Sn,mu).call(this);try{Et(this,pr,$n(()=>r(a)))}catch(s){this.error(s)}U(this,Da)>0?An(this,Sn,cl).call(this):this.is_pending=!1}return()=>{var s;(s=U(this,Na))==null||s.remove()}},Cy))}defer_effect(e){Ch(e,U(this,Js),U(this,$s))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!U(this,Ur).pending}update_pending_count(e){An(this,Sn,yu).call(this,e),Et(this,us,U(this,us)+e),!(!U(this,va)||U(this,Qs))&&(Et(this,Qs,!0),$r(()=>{Et(this,Qs,!1),U(this,va)&&ai(U(this,va),U(this,us))}))}get_effect_pending(){return U(this,Fl).call(this),o(U(this,va))}error(e){var n=U(this,Ur).onerror;let r=U(this,Ur).failed;if(U(this,ds)||!n&&!r)throw e;U(this,pr)&&(kn(U(this,pr)),Et(this,pr,null)),U(this,Yn)&&(kn(U(this,Yn)),Et(this,Yn,null)),U(this,Wr)&&(kn(U(this,Wr)),Et(this,Wr,null));var a=!1,s=!1;const i=()=>{if(a){yy();return}a=!0,s&&sy(),ba.ensure(),Et(this,us,0),U(this,Wr)!==null&&vs(U(this,Wr),()=>{Et(this,Wr,null)}),this.is_pending=this.has_pending_snippet(),Et(this,pr,An(this,Sn,ll).call(this,()=>(Et(this,ds,!1),$n(()=>U(this,cs).call(this,U(this,hr)))))),U(this,Da)>0?An(this,Sn,cl).call(this):this.is_pending=!1};$r(()=>{try{s=!0,n==null||n(e,i),s=!1}catch(l){ri(l,U(this,Vr)&&U(this,Vr).parent)}r&&Et(this,Wr,An(this,Sn,ll).call(this,()=>{ba.ensure(),Et(this,ds,!0);try{return $n(()=>{r(U(this,hr),()=>e,()=>i)})}catch(l){return ri(l,U(this,Vr).parent),null}finally{Et(this,ds,!1)}}))})}}hr=new WeakMap,ed=new WeakMap,Ur=new WeakMap,cs=new WeakMap,Vr=new WeakMap,pr=new WeakMap,Yn=new WeakMap,Wr=new WeakMap,fa=new WeakMap,Na=new WeakMap,us=new WeakMap,Da=new WeakMap,Qs=new WeakMap,ds=new WeakMap,Js=new WeakMap,$s=new WeakMap,va=new WeakMap,Fl=new WeakMap,Sn=new WeakSet,My=function(){try{Et(this,pr,$n(()=>U(this,cs).call(this,U(this,hr))))}catch(e){this.error(e)}},Oy=function(){const e=U(this,Ur).pending;e&&(Et(this,Yn,$n(()=>e(U(this,hr)))),$r(()=>{var n=An(this,Sn,mu).call(this);Et(this,pr,An(this,Sn,ll).call(this,()=>(ba.ensure(),$n(()=>U(this,cs).call(this,n))))),U(this,Da)>0?An(this,Sn,cl).call(this):(vs(U(this,Yn),()=>{Et(this,Yn,null)}),this.is_pending=!1)}))},mu=function(){var e=U(this,hr);return this.is_pending&&(Et(this,Na,wa()),U(this,hr).before(U(this,Na)),e=U(this,Na)),e},ll=function(e){var n=Yt,r=Lt,a=tn;ra(U(this,Vr)),_r(U(this,Vr)),ni(U(this,Vr).ctx);try{return e()}catch(s){return Ah(s),null}finally{ra(n),_r(r),ni(a)}},cl=function(){const e=U(this,Ur).pending;U(this,pr)!==null&&(Et(this,fa,document.createDocumentFragment()),U(this,fa).append(U(this,Na)),tp(U(this,pr),U(this,fa))),U(this,Yn)===null&&Et(this,Yn,$n(()=>e(U(this,hr))))},yu=function(e){var n;if(!this.has_pending_snippet()){this.parent&&An(n=this.parent,Sn,yu).call(n,e);return}if(Et(this,Da,U(this,Da)+e),U(this,Da)===0){this.is_pending=!1;for(const r of U(this,Js))gn(r,Pn),Nr(r);for(const r of U(this,$s))gn(r,Lr),Nr(r);U(this,Js).clear(),U(this,$s).clear(),U(this,Yn)&&vs(U(this,Yn),()=>{Et(this,Yn,null)}),U(this,fa)&&(U(this,hr).before(U(this,fa)),Et(this,fa,null))}};function Rh(t,e,n,r){const a=mo()?yo:od;var s=t.filter(h=>!h.settled);if(n.length===0&&s.length===0){r(e.map(a));return}var i=It,l=Yt,u=Ny(),d=s.length===1?s[0].promise:s.length>1?Promise.all(s.map(h=>h.promise)):null;function v(h){u();try{r(h)}catch(m){(l.f&_a)===0&&ri(m,l)}i==null||i.deactivate(),_u()}if(n.length===0){d.then(()=>v(e.map(a)));return}function p(){u(),Promise.all(n.map(h=>Dy(h))).then(h=>v([...e.map(a),...h])).catch(h=>ri(h,l))}d?d.then(p):p()}function Ny(){var t=Yt,e=Lt,n=tn,r=It;return function(s=!0){ra(t),_r(e),ni(n),s&&(r==null||r.activate())}}function _u(){ra(null),_r(null),ni(null)}function yo(t){var e=In|Pn,n=Lt!==null&&(Lt.f&In)!==0?Lt:null;return Yt!==null&&(Yt.f|=As),{ctx:tn,deps:null,effects:null,equals:bh,f:e,fn:t,reactions:null,rv:0,v:wn,wv:0,parent:n??Yt,ac:null}}function Dy(t,e,n){let r=Yt;r===null&&Xm();var a=r.b,s=void 0,i=ms(wn),l=!Lt,u=new Map;return Yy(()=>{var m;var d=dh();s=d.promise;try{Promise.resolve(t()).then(d.resolve,d.reject).then(()=>{v===It&&v.committed&&v.deactivate(),_u()})}catch(x){d.reject(x),_u()}var v=It;if(l){var p=a.is_rendered();a.update_pending_count(1),v.increment(p),(m=u.get(v))==null||m.reject(rs),u.delete(v),u.set(v,d)}const h=(x,k=void 0)=>{if(v.activate(),k)k!==rs&&(i.f|=za,ai(i,k));else{(i.f&za)!==0&&(i.f^=za),ai(i,x);for(const[E,D]of u){if(u.delete(E),E===v)break;D.reject(rs)}}l&&(a.update_pending_count(-1),v.decrement(p))};d.promise.then(h,x=>h(null,x||"unknown"))}),ud(()=>{for(const d of u.values())d.reject(rs)}),new Promise(d=>{function v(p){function h(){p===s?d(i):v(s)}p.then(h,h)}v(s)})}function Q(t){const e=yo(t);return np(e),e}function od(t){const e=yo(t);return e.equals=xh,e}function Ry(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)kn(e[n])}}function Ly(t){for(var e=t.parent;e!==null;){if((e.f&In)===0)return(e.f&_a)===0?e:null;e=e.parent}return null}function ld(t){var e,n=Yt;ra(Ly(t));try{t.f&=~gs,Ry(t),e=ip(t)}finally{ra(n)}return e}function Lh(t){var e=ld(t);if(!t.equals(e)&&(t.wv=ap(),(!(It!=null&&It.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){gn(t,xn);return}Ka||(Tn!==null?(cd()||It!=null&&It.is_fork)&&Tn.set(t,e):id(t))}function jy(t){var e,n;if(t.effects!==null)for(const r of t.effects)(r.teardown||r.ac)&&((e=r.teardown)==null||e.call(r),(n=r.ac)==null||n.abort(rs),r.teardown=Es,r.ac=null,Qi(r,0),dd(r))}function jh(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&si(e)}let bu=new Set;const qa=new Map;let zh=!1;function ms(t,e){var n={f:0,v:t,reactions:null,equals:bh,rv:0,wv:0};return n}function Me(t,e){const n=ms(t);return np(n),n}function zy(t,e=!1,n=!0){var a;const r=ms(t);return e||(r.equals=xh),vi&&n&&tn!==null&&tn.l!==null&&((a=tn.l).s??(a.s=[])).push(r),r}function P(t,e,n=!1){Lt!==null&&(!Dr||(Lt.f&Mf)!==0)&&mo()&&(Lt.f&(In|ka|nd|Mf))!==0&&(mr===null||!ti.call(mr,t))&&ay();let r=n?Wt(e):e;return ai(t,r)}function ai(t,e){if(!t.equals(e)){var n=t.v;Ka?qa.set(t,e):qa.set(t,n),t.v=e;var r=ba.ensure();if(r.capture(t,n),(t.f&In)!==0){const a=t;(t.f&Pn)!==0&&ld(a),id(a)}t.wv=ap(),qh(t,Pn),mo()&&Yt!==null&&(Yt.f&xn)!==0&&(Yt.f&(zr|Ua))===0&&(vr===null?Zy([t]):vr.push(t)),!r.is_fork&&bu.size>0&&!zh&&qy()}return e}function qy(){zh=!1;for(const t of bu)(t.f&xn)!==0&&gn(t,Lr),wo(t)&&si(t);bu.clear()}function Ui(t){P(t,t.v+1)}function qh(t,e){var n=t.reactions;if(n!==null)for(var r=mo(),a=n.length,s=0;s<a;s++){var i=n[s],l=i.f;if(!(!r&&i===Yt)){var u=(l&Pn)===0;if(u&&gn(i,e),(l&In)!==0){var d=i;Tn==null||Tn.delete(d),(l&gs)===0&&(l&gr&&(i.f|=gs),qh(d,Lr))}else u&&((l&ka)!==0&&Ar!==null&&Ar.add(i),Nr(i))}}}function Wt(t){if(typeof t!="object"||t===null||Jr in t)return t;const e=Wl(t);if(e!==uh&&e!==Vm)return t;var n=new Map,r=Ul(t),a=Me(0),s=hs,i=l=>{if(hs===s)return l();var u=Lt,d=hs;_r(null),Lf(s);var v=l();return _r(u),Lf(d),v};return r&&n.set("length",Me(t.length)),new Proxy(t,{defineProperty(l,u,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&ny();var v=n.get(u);return v===void 0?i(()=>{var p=Me(d.value);return n.set(u,p),p}):P(v,d.value,!0),!0},deleteProperty(l,u){var d=n.get(u);if(d===void 0){if(u in l){const v=i(()=>Me(wn));n.set(u,v),Ui(a)}}else P(d,wn),Ui(a);return!0},get(l,u,d){var m;if(u===Jr)return t;var v=n.get(u),p=u in l;if(v===void 0&&(!p||(m=ja(l,u))!=null&&m.writable)&&(v=i(()=>{var x=Wt(p?l[u]:wn),k=Me(x);return k}),n.set(u,v)),v!==void 0){var h=o(v);return h===wn?void 0:h}return Reflect.get(l,u,d)},getOwnPropertyDescriptor(l,u){var d=Reflect.getOwnPropertyDescriptor(l,u);if(d&&"value"in d){var v=n.get(u);v&&(d.value=o(v))}else if(d===void 0){var p=n.get(u),h=p==null?void 0:p.v;if(p!==void 0&&h!==wn)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return d},has(l,u){var h;if(u===Jr)return!0;var d=n.get(u),v=d!==void 0&&d.v!==wn||Reflect.has(l,u);if(d!==void 0||Yt!==null&&(!v||(h=ja(l,u))!=null&&h.writable)){d===void 0&&(d=i(()=>{var m=v?Wt(l[u]):wn,x=Me(m);return x}),n.set(u,d));var p=o(d);if(p===wn)return!1}return v},set(l,u,d,v){var Y;var p=n.get(u),h=u in l;if(r&&u==="length")for(var m=d;m<p.v;m+=1){var x=n.get(m+"");x!==void 0?P(x,wn):m in l&&(x=i(()=>Me(wn)),n.set(m+"",x))}if(p===void 0)(!h||(Y=ja(l,u))!=null&&Y.writable)&&(p=i(()=>Me(void 0)),P(p,Wt(d)),n.set(u,p));else{h=p.v!==wn;var k=i(()=>Wt(d));P(p,k)}var E=Reflect.getOwnPropertyDescriptor(l,u);if(E!=null&&E.set&&E.set.call(v,d),!h){if(r&&typeof u=="string"){var D=n.get("length"),B=Number(u);Number.isInteger(B)&&B>=D.v&&P(D,B+1)}Ui(a)}return!0},ownKeys(l){o(a);var u=Reflect.ownKeys(l).filter(p=>{var h=n.get(p);return h===void 0||h.v!==wn});for(var[d,v]of n)v.v!==wn&&!(d in l)&&u.push(d);return u},setPrototypeOf(){ry()}})}function Nf(t){try{if(t!==null&&typeof t=="object"&&Jr in t)return t[Jr]}catch{}return t}function By(t,e){return Object.is(Nf(t),Nf(e))}var Wn,Bh,Fh,Kh;function Fy(){if(Wn===void 0){Wn=window,Bh=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Fh=ja(e,"firstChild").get,Kh=ja(e,"nextSibling").get,Pf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Pf(n)&&(n.__t=void 0)}}function wa(t=""){return document.createTextNode(t)}function lr(t){return Fh.call(t)}function _o(t){return Kh.call(t)}function _(t,e){return lr(t)}function Xe(t,e=!1){{var n=lr(t);return n instanceof Comment&&n.data===""?_o(n):n}}function b(t,e=1,n=!1){let r=t;for(;e--;)r=_o(r);return r}function Ky(t){t.textContent=""}function Hh(){return!1}function Hy(t,e,n){return document.createElementNS(_h,t,void 0)}function Gy(t,e){if(e){const n=document.body;t.autofocus=!0,$r(()=>{document.activeElement===n&&t.focus()})}}let Df=!1;function Uy(){Df||(Df=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Xl(t){var e=Lt,n=Yt;_r(null),ra(null);try{return t()}finally{_r(e),ra(n)}}function Gh(t,e,n,r=n){t.addEventListener(e,()=>Xl(n));const a=t.__on_r;a?t.__on_r=()=>{a(),r(!0)}:t.__on_r=()=>r(!0),Uy()}function Uh(t){Yt===null&&(Lt===null&&$m(),Jm()),Ka&&Qm()}function Vy(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function wr(t,e,n){var r=Yt;r!==null&&(r.f&cr)!==0&&(t|=cr);var a={ctx:tn,deps:null,nodes:null,f:t|Pn|gr,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{si(a)}catch(l){throw kn(a),l}else e!==null&&Nr(a);var s=a;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&As)===0&&(s=s.first,(t&ka)!==0&&(t&Fa)!==0&&s!==null&&(s.f|=Fa)),s!==null&&(s.parent=r,r!==null&&Vy(s,r),Lt!==null&&(Lt.f&In)!==0&&(t&Ua)===0)){var i=Lt;(i.effects??(i.effects=[])).push(s)}return a}function cd(){return Lt!==null&&!Dr}function ud(t){const e=wr(po,null,!1);return gn(e,xn),e.teardown=t,e}function yn(t){Uh();var e=Yt.f,n=!Lt&&(e&zr)!==0&&(e&go)===0;if(n){var r=tn;(r.e??(r.e=[])).push(t)}else return Vh(t)}function Vh(t){return wr(Zi|hh,t,!1)}function Wh(t){return Uh(),wr(po|hh,t,!0)}function Yh(t){ba.ensure();const e=wr(Ua|As,t,!0);return()=>{kn(e)}}function Wy(t){ba.ensure();const e=wr(Ua|As,t,!0);return(n={})=>new Promise(r=>{n.outro?vs(e,()=>{kn(e),r(void 0)}):(kn(e),r(void 0))})}function hi(t){return wr(Zi,t,!1)}function Yy(t){return wr(nd|As,t,!0)}function Zl(t,e=0){return wr(po|e,t,!0)}function se(t,e=[],n=[],r=[]){Rh(r,e,n,a=>{wr(po,()=>t(...a.map(o)),!0)})}function bo(t,e=0){var n=wr(ka|e,t,!0);return n}function Xh(t,e=0){var n=wr(td|e,t,!0);return n}function $n(t){return wr(zr|As,t,!0)}function Zh(t){var e=t.teardown;if(e!==null){const n=Ka,r=Lt;Rf(!0),_r(null);try{e.call(null)}finally{Rf(n),_r(r)}}}function dd(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const a=n.ac;a!==null&&Xl(()=>{a.abort(rs)});var r=n.next;(n.f&Ua)!==0?n.parent=null:kn(n,e),n=r}}function Xy(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&zr)===0&&kn(e),e=n}}function kn(t,e=!0){var n=!1;(e||(t.f&vh)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Qh(t.nodes.start,t.nodes.end),n=!0),dd(t,e&&!n),Qi(t,0),gn(t,_a);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();Zh(t);var a=t.parent;a!==null&&a.first!==null&&Jh(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Qh(t,e){for(;t!==null;){var n=t===e?null:_o(t);t.remove(),t=n}}function Jh(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function vs(t,e,n=!0){var r=[];$h(t,r,!0);var a=()=>{n&&kn(t),e&&e()},s=r.length;if(s>0){var i=()=>--s||a();for(var l of r)l.out(i)}else a()}function $h(t,e,n){if((t.f&cr)===0){t.f^=cr;var r=t.nodes&&t.nodes.t;if(r!==null)for(const l of r)(l.is_global||n)&&e.push(l);for(var a=t.first;a!==null;){var s=a.next,i=(a.f&Fa)!==0||(a.f&zr)!==0&&(t.f&ka)!==0;$h(a,e,i?n:!1),a=s}}}function fd(t){ep(t,!0)}function ep(t,e){if((t.f&cr)!==0){t.f^=cr,(t.f&xn)===0&&(gn(t,Pn),Nr(t));for(var n=t.first;n!==null;){var r=n.next,a=(n.f&Fa)!==0||(n.f&zr)!==0;ep(n,a?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const i of s)(i.is_global||e)&&i.in()}}function tp(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var a=n===r?null:_o(n);e.append(n),n=a}}let ul=!1,Ka=!1;function Rf(t){Ka=t}let Lt=null,Dr=!1;function _r(t){Lt=t}let Yt=null;function ra(t){Yt=t}let mr=null;function np(t){Lt!==null&&(mr===null?mr=[t]:mr.push(t))}let Jn=null,ir=0,vr=null;function Zy(t){vr=t}let rp=1,ss=0,hs=ss;function Lf(t){hs=t}function ap(){return++rp}function wo(t){var e=t.f;if((e&Pn)!==0)return!0;if(e&In&&(t.f&=~gs),(e&Lr)!==0){for(var n=t.deps,r=n.length,a=0;a<r;a++){var s=n[a];if(wo(s)&&Lh(s),s.wv>t.wv)return!0}(e&gr)!==0&&Tn===null&&gn(t,xn)}return!1}function sp(t,e,n=!0){var r=t.reactions;if(r!==null&&!(mr!==null&&ti.call(mr,t)))for(var a=0;a<r.length;a++){var s=r[a];(s.f&In)!==0?sp(s,e,!1):e===s&&(n?gn(s,Pn):(s.f&xn)!==0&&gn(s,Lr),Nr(s))}}function ip(t){var k;var e=Jn,n=ir,r=vr,a=Lt,s=mr,i=tn,l=Dr,u=hs,d=t.f;Jn=null,ir=0,vr=null,Lt=(d&(zr|Ua))===0?t:null,mr=null,ni(t.ctx),Dr=!1,hs=++ss,t.ac!==null&&(Xl(()=>{t.ac.abort(rs)}),t.ac=null);try{t.f|=vu;var v=t.fn,p=v();t.f|=go;var h=t.deps,m=It==null?void 0:It.is_fork;if(Jn!==null){var x;if(m||Qi(t,ir),h!==null&&ir>0)for(h.length=ir+Jn.length,x=0;x<Jn.length;x++)h[ir+x]=Jn[x];else t.deps=h=Jn;if(cd()&&(t.f&gr)!==0)for(x=ir;x<h.length;x++)((k=h[x]).reactions??(k.reactions=[])).push(t)}else!m&&h!==null&&ir<h.length&&(Qi(t,ir),h.length=ir);if(mo()&&vr!==null&&!Dr&&h!==null&&(t.f&(In|Lr|Pn))===0)for(x=0;x<vr.length;x++)sp(vr[x],t);if(a!==null&&a!==t){if(ss++,a.deps!==null)for(let E=0;E<n;E+=1)a.deps[E].rv=ss;if(e!==null)for(const E of e)E.rv=ss;vr!==null&&(r===null?r=vr:r.push(...vr))}return(t.f&za)!==0&&(t.f^=za),p}catch(E){return Ah(E)}finally{t.f^=vu,Jn=e,ir=n,vr=r,Lt=a,mr=s,ni(i),Dr=l,hs=u}}function Qy(t,e){let n=e.reactions;if(n!==null){var r=Gm.call(n,t);if(r!==-1){var a=n.length-1;a===0?n=e.reactions=null:(n[r]=n[a],n.pop())}}if(n===null&&(e.f&In)!==0&&(Jn===null||!ti.call(Jn,e))){var s=e;(s.f&gr)!==0&&(s.f^=gr,s.f&=~gs),id(s),jy(s),Qi(s,0)}}function Qi(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)Qy(t,n[r])}function si(t){var e=t.f;if((e&_a)===0){gn(t,xn);var n=Yt,r=ul;Yt=t,ul=!0;try{(e&(ka|td))!==0?Xy(t):dd(t),Zh(t);var a=ip(t);t.teardown=typeof a=="function"?a:null,t.wv=rp;var s;du&&_y&&(t.f&Pn)!==0&&t.deps}finally{ul=r,Yt=n}}}async function op(){await Promise.resolve(),Ay()}function o(t){var e=t.f,n=(e&In)!==0;if(Lt!==null&&!Dr){var r=Yt!==null&&(Yt.f&_a)!==0;if(!r&&(mr===null||!ti.call(mr,t))){var a=Lt.deps;if((Lt.f&vu)!==0)t.rv<ss&&(t.rv=ss,Jn===null&&a!==null&&a[ir]===t?ir++:Jn===null?Jn=[t]:Jn.push(t));else{(Lt.deps??(Lt.deps=[])).push(t);var s=t.reactions;s===null?t.reactions=[Lt]:ti.call(s,Lt)||s.push(Lt)}}}if(Ka&&qa.has(t))return qa.get(t);if(n){var i=t;if(Ka){var l=i.v;return((i.f&xn)===0&&i.reactions!==null||cp(i))&&(l=ld(i)),qa.set(i,l),l}var u=(i.f&gr)===0&&!Dr&&Lt!==null&&(ul||(Lt.f&gr)!==0),d=(i.f&go)===0;wo(i)&&(u&&(i.f|=gr),Lh(i)),u&&!d&&(jh(i),lp(i))}if(Tn!=null&&Tn.has(t))return Tn.get(t);if((t.f&za)!==0)throw t.v;return t.v}function lp(t){if(t.f|=gr,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&In)!==0&&(e.f&gr)===0&&(jh(e),lp(e))}function cp(t){if(t.v===wn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(qa.has(e)||(e.f&In)!==0&&cp(e))return!0;return!1}function er(t){var e=Dr;try{return Dr=!0,t()}finally{Dr=e}}function Jy(t,e){var n={};for(var r in t)e.includes(r)||(n[r]=t[r]);for(var a of Object.getOwnPropertySymbols(t))Object.propertyIsEnumerable.call(t,a)&&!e.includes(a)&&(n[a]=t[a]);return n}function up(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Jr in t)wu(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Jr in n&&wu(n)}}}function wu(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{wu(t[r],e)}catch{}const n=Wl(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=ch(n);for(let a in r){const s=r[a].get;if(s)try{s.call(t)}catch{}}}}}function $y(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const e_=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function t_(t){return e_.includes(t)}const n_={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function r_(t){return t=t.toLowerCase(),n_[t]??t}const a_=["touchstart","touchmove"];function s_(t){return a_.includes(t)}const dp=new Set,xu=new Set;function vd(t,e,n,r={}){function a(s){if(r.capture||Su.call(e,s),!s.cancelBubble)return Xl(()=>n==null?void 0:n.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?$r(()=>{e.addEventListener(t,a,r)}):e.addEventListener(t,a,r),a}function ku(t,e,n,r={}){var a=vd(e,t,n,r);return()=>{t.removeEventListener(e,a,r)}}function wl(t,e,n,r,a){var s={capture:r,passive:a},i=vd(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ud(()=>{e.removeEventListener(t,i,s)})}function Xt(t){for(var e=0;e<t.length;e++)dp.add(t[e]);for(var n of xu)n(t)}let jf=null;function Su(t){var E;var e=this,n=e.ownerDocument,r=t.type,a=((E=t.composedPath)==null?void 0:E.call(t))||[],s=a[0]||t.target;jf=t;var i=0,l=jf===t&&t.__root;if(l){var u=a.indexOf(l);if(u!==-1&&(e===document||e===window)){t.__root=e;return}var d=a.indexOf(e);if(d===-1)return;u<=d&&(i=u)}if(s=a[i]||t.target,s!==e){Um(t,"currentTarget",{configurable:!0,get(){return s||n}});var v=Lt,p=Yt;_r(null),ra(null);try{for(var h,m=[];s!==null;){var x=s.assignedSlot||s.parentNode||s.host||null;try{var k=s["__"+r];k!=null&&(!s.disabled||t.target===s)&&k.call(s,t)}catch(D){h?m.push(D):h=D}if(t.cancelBubble||x===e||x===null)break;s=x}if(h){for(let D of m)queueMicrotask(()=>{throw D});throw h}}finally{t.__root=e,delete t.currentTarget,_r(v),ra(p)}}}var ih,oh;const qc=(oh=(ih=globalThis==null?void 0:globalThis.window)==null?void 0:ih.trustedTypes)==null?void 0:oh.createPolicy("svelte-trusted-html",{createHTML:t=>t});function i_(t){return(qc==null?void 0:qc.createHTML(t))??t}function hd(t,e=!1){var n=Hy("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?i_(t):t,n.content}function ys(t,e){var n=Yt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function z(t,e){var n=(e&yh)!==0,r=(e&py)!==0,a,s=!t.startsWith("<!>");return()=>{a===void 0&&(a=hd(s?t:"<!>"+t,!0),n||(a=lr(a)));var i=r||Bh?document.importNode(a,!0):a.cloneNode(!0);if(n){var l=lr(i),u=i.lastChild;ys(l,u)}else ys(i,i);return i}}function o_(t,e,n="svg"){var r=!t.startsWith("<!>"),a=(e&yh)!==0,s=`<${n}>${r?t:"<!>"+t}</${n}>`,i;return()=>{if(!i){var l=hd(s,!0),u=lr(l);if(a)for(i=document.createDocumentFragment();lr(u);)i.appendChild(lr(u));else i=lr(u)}var d=i.cloneNode(!0);if(a){var v=lr(d),p=d.lastChild;ys(v,p)}else ys(d,d);return d}}function mn(t,e){return o_(t,e,"svg")}function on(t=""){{var e=wa(t+"");return ys(e,e),e}}function an(){var t=document.createDocumentFragment(),e=document.createComment(""),n=wa();return t.append(e,n),ys(e,n),t}function T(t,e){t!==null&&t.before(e)}function ee(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function l_(t,e){return c_(t,e)}const Wo=new Map;function c_(t,{target:e,anchor:n,props:r={},events:a,context:s,intro:i=!0}){Fy();var l=new Set,u=p=>{for(var h=0;h<p.length;h++){var m=p[h];if(!l.has(m)){l.add(m);var x=s_(m);for(const D of[e,document]){var k=Wo.get(D);k===void 0&&(k=new Map,Wo.set(D,k));var E=k.get(m);E===void 0?(D.addEventListener(m,Su,{passive:x}),k.set(m,1)):k.set(m,E+1)}}}};u(Vl(dp)),xu.add(u);var d=void 0,v=Wy(()=>{var p=n??e.appendChild(wa());return Iy(p,{pending:()=>{}},h=>{at({});var m=tn;s&&(m.c=s),a&&(r.$$events=a),d=t(h,r)||{},st()}),()=>{var k;for(var h of l)for(const E of[e,document]){var m=Wo.get(E),x=m.get(h);--x==0?(E.removeEventListener(h,Su),m.delete(h),m.size===0&&Wo.delete(E)):m.set(h,x)}xu.delete(u),p!==n&&((k=p.parentNode)==null||k.removeChild(p))}});return u_.set(d,v),d}let u_=new WeakMap;var Cr,Yr,or,fs,lo,co,Kl;class pd{constructor(e,n=!0){ht(this,"anchor");Pe(this,Cr,new Map);Pe(this,Yr,new Map);Pe(this,or,new Map);Pe(this,fs,new Set);Pe(this,lo,!0);Pe(this,co,()=>{var e=It;if(U(this,Cr).has(e)){var n=U(this,Cr).get(e),r=U(this,Yr).get(n);if(r)fd(r),U(this,fs).delete(n);else{var a=U(this,or).get(n);a&&(U(this,Yr).set(n,a.effect),U(this,or).delete(n),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),r=a.effect)}for(const[s,i]of U(this,Cr)){if(U(this,Cr).delete(s),s===e)break;const l=U(this,or).get(i);l&&(kn(l.effect),U(this,or).delete(i))}for(const[s,i]of U(this,Yr)){if(s===n||U(this,fs).has(s))continue;const l=()=>{if(Array.from(U(this,Cr).values()).includes(s)){var d=document.createDocumentFragment();tp(i,d),d.append(wa()),U(this,or).set(s,{effect:i,fragment:d})}else kn(i);U(this,fs).delete(s),U(this,Yr).delete(s)};U(this,lo)||!r?(U(this,fs).add(s),vs(i,l,!1)):l()}}});Pe(this,Kl,e=>{U(this,Cr).delete(e);const n=Array.from(U(this,Cr).values());for(const[r,a]of U(this,or))n.includes(r)||(kn(a.effect),U(this,or).delete(r))});this.anchor=e,Et(this,lo,n)}ensure(e,n){var r=It,a=Hh();if(n&&!U(this,Yr).has(e)&&!U(this,or).has(e))if(a){var s=document.createDocumentFragment(),i=wa();s.append(i),U(this,or).set(e,{effect:$n(()=>n(i)),fragment:s})}else U(this,Yr).set(e,$n(()=>n(this.anchor)));if(U(this,Cr).set(r,e),a){for(const[l,u]of U(this,Yr))l===e?r.unskip_effect(u):r.skip_effect(u);for(const[l,u]of U(this,or))l===e?r.unskip_effect(u.effect):r.skip_effect(u.effect);r.oncommit(U(this,co)),r.ondiscard(U(this,Kl))}else U(this,co).call(this)}}Cr=new WeakMap,Yr=new WeakMap,or=new WeakMap,fs=new WeakMap,lo=new WeakMap,co=new WeakMap,Kl=new WeakMap;function ce(t,e,n=!1){var r=new pd(t),a=n?Fa:0;function s(i,l){r.ensure(i,l)}bo(()=>{var i=!1;e((l,u=0)=>{i=!0,s(u,l)}),i||s(!1,null)},a)}function Ut(t,e){return e}function d_(t,e,n){for(var r=[],a=e.length,s,i=e.length,l=0;l<a;l++){let p=e[l];vs(p,()=>{if(s){if(s.pending.delete(p),s.done.add(p),s.pending.size===0){var h=t.outrogroups;Eu(Vl(s.done)),h.delete(s),h.size===0&&(t.outrogroups=null)}}else i-=1},!1)}if(i===0){var u=r.length===0&&n!==null;if(u){var d=n,v=d.parentNode;Ky(v),v.append(d),t.items.clear()}Eu(e,!u)}else s={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(s)}function Eu(t,e=!0){for(var n=0;n<t.length;n++)kn(t[n],e)}var zf;function Ot(t,e,n,r,a,s=null){var i=t,l=new Map,u=(e&mh)!==0;if(u){var d=t;i=d.appendChild(wa())}var v=null,p=od(()=>{var D=n();return Ul(D)?D:D==null?[]:Vl(D)}),h,m=!0;function x(){E.fallback=v,f_(E,h,i,e,r),v!==null&&(h.length===0?(v.f&ga)===0?fd(v):(v.f^=ga,Bi(v,null,i)):vs(v,()=>{v=null}))}var k=bo(()=>{h=o(p);for(var D=h.length,B=new Set,Y=It,S=Hh(),V=0;V<D;V+=1){var K=h[V],O=r(K,V),J=m?null:l.get(O);J?(J.v&&ai(J.v,K),J.i&&ai(J.i,V),S&&Y.unskip_effect(J.e)):(J=v_(l,m?i:zf??(zf=wa()),K,O,V,a,e,n),m||(J.e.f|=ga),l.set(O,J)),B.add(O)}if(D===0&&s&&!v&&(m?v=$n(()=>s(i)):(v=$n(()=>s(zf??(zf=wa()))),v.f|=ga)),D>B.size&&Zm(),!m)if(S){for(const[ie,ke]of l)B.has(ie)||Y.skip_effect(ke.e);Y.oncommit(x),Y.ondiscard(()=>{})}else x();o(p)}),E={effect:k,items:l,outrogroups:null,fallback:v};m=!1}function Ii(t){for(;t!==null&&(t.f&zr)===0;)t=t.next;return t}function f_(t,e,n,r,a){var ke,F,I,j,C,N,M,$,H;var s=(r&ly)!==0,i=e.length,l=t.items,u=Ii(t.effect.first),d,v=null,p,h=[],m=[],x,k,E,D;if(s)for(D=0;D<i;D+=1)x=e[D],k=a(x,D),E=l.get(k).e,(E.f&ga)===0&&((F=(ke=E.nodes)==null?void 0:ke.a)==null||F.measure(),(p??(p=new Set)).add(E));for(D=0;D<i;D+=1){if(x=e[D],k=a(x,D),E=l.get(k).e,t.outrogroups!==null)for(const L of t.outrogroups)L.pending.delete(E),L.done.delete(E);if((E.f&ga)!==0)if(E.f^=ga,E===u)Bi(E,null,n);else{var B=v?v.next:u;E===t.effect.last&&(t.effect.last=E.prev),E.prev&&(E.prev.next=E.next),E.next&&(E.next.prev=E.prev),Ca(t,v,E),Ca(t,E,B),Bi(E,B,n),v=E,h=[],m=[],u=Ii(v.next);continue}if((E.f&cr)!==0&&(fd(E),s&&((j=(I=E.nodes)==null?void 0:I.a)==null||j.unfix(),(p??(p=new Set)).delete(E))),E!==u){if(d!==void 0&&d.has(E)){if(h.length<m.length){var Y=m[0],S;v=Y.prev;var V=h[0],K=h[h.length-1];for(S=0;S<h.length;S+=1)Bi(h[S],Y,n);for(S=0;S<m.length;S+=1)d.delete(m[S]);Ca(t,V.prev,K.next),Ca(t,v,V),Ca(t,K,Y),u=Y,v=K,D-=1,h=[],m=[]}else d.delete(E),Bi(E,u,n),Ca(t,E.prev,E.next),Ca(t,E,v===null?t.effect.first:v.next),Ca(t,v,E),v=E;continue}for(h=[],m=[];u!==null&&u!==E;)(d??(d=new Set)).add(u),m.push(u),u=Ii(u.next);if(u===null)continue}(E.f&ga)===0&&h.push(E),v=E,u=Ii(E.next)}if(t.outrogroups!==null){for(const L of t.outrogroups)L.pending.size===0&&(Eu(Vl(L.done)),(C=t.outrogroups)==null||C.delete(L));t.outrogroups.size===0&&(t.outrogroups=null)}if(u!==null||d!==void 0){var O=[];if(d!==void 0)for(E of d)(E.f&cr)===0&&O.push(E);for(;u!==null;)(u.f&cr)===0&&u!==t.fallback&&O.push(u),u=Ii(u.next);var J=O.length;if(J>0){var ie=(r&mh)!==0&&i===0?n:null;if(s){for(D=0;D<J;D+=1)(M=(N=O[D].nodes)==null?void 0:N.a)==null||M.measure();for(D=0;D<J;D+=1)(H=($=O[D].nodes)==null?void 0:$.a)==null||H.fix()}d_(t,O,ie)}}s&&$r(()=>{var L,q;if(p!==void 0)for(E of p)(q=(L=E.nodes)==null?void 0:L.a)==null||q.apply()})}function v_(t,e,n,r,a,s,i,l){var u=(i&iy)!==0?(i&cy)===0?zy(n,!1,!1):ms(n):null,d=(i&oy)!==0?ms(a):null;return{v:u,i:d,e:$n(()=>(s(e,u??n,d??a,l),()=>{t.delete(r)}))}}function Bi(t,e,n){if(t.nodes)for(var r=t.nodes.start,a=t.nodes.end,s=e&&(e.f&ga)===0?e.nodes.start:n;r!==null;){var i=_o(r);if(s.before(r),r===a)return;r=i}}function Ca(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function h_(t,e,n=!1,r=!1,a=!1){var s=t,i="";se(()=>{var l=Yt;if(i!==(i=e()??"")&&(l.nodes!==null&&(Qh(l.nodes.start,l.nodes.end),l.nodes=null),i!=="")){var u=i+"";n?u=`<svg>${u}</svg>`:r&&(u=`<math>${u}</math>`);var d=hd(u);if((n||r)&&(d=lr(d)),ys(lr(d),d.lastChild),n||r)for(;lr(d);)s.before(lr(d));else s.before(d)}})}function yr(t,e,...n){var r=new pd(t);bo(()=>{const a=e()??null;r.ensure(a,a&&(s=>a(s,...n)))},Fa)}function gd(t,e,n){var r=new pd(t);bo(()=>{var a=e()??null;r.ensure(a,a&&(s=>n(s,a)))},Fa)}function Xn(t,e,n){hi(()=>{var r=er(()=>e(t,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var a=!1,s={};Zl(()=>{var i=n();up(i),a&&wh(s,i)&&(s=i,r.update(i))}),a=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function p_(t,e){var n=void 0,r;Xh(()=>{n!==(n=e())&&(r&&(kn(r),r=null),n&&(r=$n(()=>{hi(()=>n(t))})))})}function fp(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=fp(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function g_(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=fp(t))&&(r&&(r+=" "),r+=e);return r}function Ts(t){return typeof t=="object"?g_(t):t??""}const qf=[...` 	
\r\fÂ \v\uFEFF`];function m_(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var a in n)if(n[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,i=0;(i=r.indexOf(a,i))>=0;){var l=i+s;(i===0||qf.includes(r[i-1]))&&(l===r.length||qf.includes(r[l]))?r=(i===0?"":r.substring(0,i))+r.substring(l+1):i=l}}return r===""?null:r}function Bf(t,e=!1){var n=e?" !important;":";",r="";for(var a in t){var s=t[a];s!=null&&s!==""&&(r+=" "+a+": "+s+n)}return r}function Bc(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function y_(t,e){if(e){var n="",r,a;if(Array.isArray(e)?(r=e[0],a=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,i=0,l=!1,u=[];r&&u.push(...Object.keys(r).map(Bc)),a&&u.push(...Object.keys(a).map(Bc));var d=0,v=-1;const k=t.length;for(var p=0;p<k;p++){var h=t[p];if(l?h==="/"&&t[p-1]==="*"&&(l=!1):s?s===h&&(s=!1):h==="/"&&t[p+1]==="*"?l=!0:h==='"'||h==="'"?s=h:h==="("?i++:h===")"&&i--,!l&&s===!1&&i===0){if(h===":"&&v===-1)v=p;else if(h===";"||p===k-1){if(v!==-1){var m=Bc(t.substring(d,v).trim());if(!u.includes(m)){h!==";"&&p++;var x=t.substring(d,p).trim();n+=" "+x+";"}}d=p+1,v=-1}}}}return r&&(n+=Bf(r)),a&&(n+=Bf(a,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function xt(t,e,n,r,a,s){var i=t.__className;if(i!==n||i===void 0){var l=m_(n,r,s);l==null?t.removeAttribute("class"):e?t.className=l:t.setAttribute("class",l),t.__className=n}else if(s&&a!==s)for(var u in s){var d=!!s[u];(a==null||d!==!!a[u])&&t.classList.toggle(u,d)}return s}function Fc(t,e={},n,r){for(var a in n){var s=n[a];e[a]!==s&&(n[a]==null?t.style.removeProperty(a):t.style.setProperty(a,s,r))}}function Dt(t,e,n,r){var a=t.__style;if(a!==e){var s=y_(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Fc(t,n==null?void 0:n[0],r[0]),Fc(t,n==null?void 0:n[1],r[1],"important")):Fc(t,n,r));return r}function xl(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Ul(e))return my();for(var r of t.options)r.selected=e.includes(Vi(r));return}for(r of t.options){var a=Vi(r);if(By(a,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function vp(t){var e=new MutationObserver(()=>{xl(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ud(()=>{e.disconnect()})}function pi(t,e,n=e){var r=new WeakSet,a=!0;Gh(t,"change",s=>{var i=s?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(i),Vi);else{var u=t.querySelector(i)??t.querySelector("option:not([disabled])");l=u&&Vi(u)}n(l),It!==null&&r.add(It)}),hi(()=>{var s=e();if(t===document.activeElement){var i=bl??It;if(r.has(i))return}if(xl(t,s,a),a&&s===void 0){var l=t.querySelector(":checked");l!==null&&(s=Vi(l),n(s))}t.__value=s,a=!1}),vp(t)}function Vi(t){return"__value"in t?t.__value:t.value}const Ma=Symbol("class"),ha=Symbol("style"),hp=Symbol("is custom element"),pp=Symbol("is html"),__=gh?"option":"OPTION",b_=gh?"select":"SELECT";function w_(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function kt(t,e,n,r){var a=gp(t);a[e]!==(a[e]=n)&&(e==="loading"&&(t[Ym]=n),n==null?t.removeAttribute(e):typeof n!="string"&&mp(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function x_(t,e,n,r,a=!1,s=!1){var i=gp(t),l=i[hp],u=!i[pp],d=e||{},v=t.nodeName===__;for(var p in e)p in n||(n[p]=null);n.class?n.class=Ts(n.class):(r||n[Ma])&&(n.class=null),n[ha]&&(n.style??(n.style=null));var h=mp(t);for(const Y in n){let S=n[Y];if(v&&Y==="value"&&S==null){t.value=t.__value="",d[Y]=S;continue}if(Y==="class"){var m=t.namespaceURI==="http://www.w3.org/1999/xhtml";xt(t,m,S,r,e==null?void 0:e[Ma],n[Ma]),d[Y]=S,d[Ma]=n[Ma];continue}if(Y==="style"){Dt(t,S,e==null?void 0:e[ha],n[ha]),d[Y]=S,d[ha]=n[ha];continue}var x=d[Y];if(!(S===x&&!(S===void 0&&t.hasAttribute(Y)))){d[Y]=S;var k=Y[0]+Y[1];if(k!=="$$")if(k==="on"){const V={},K="$$"+Y;let O=Y.slice(2);var E=t_(O);if($y(O)&&(O=O.slice(0,-7),V.capture=!0),!E&&x){if(S!=null)continue;t.removeEventListener(O,d[K],V),d[K]=null}if(S!=null)if(E)t[`__${O}`]=S,Xt([O]);else{let J=function(ie){d[Y].call(this,ie)};d[K]=vd(O,t,J,V)}else E&&(t[`__${O}`]=void 0)}else if(Y==="style")kt(t,Y,S);else if(Y==="autofocus")Gy(t,!!S);else if(!l&&(Y==="__value"||Y==="value"&&S!=null))t.value=t.__value=S;else if(Y==="selected"&&v)w_(t,S);else{var D=Y;u||(D=r_(D));var B=D==="defaultValue"||D==="defaultChecked";if(S==null&&!l&&!B)if(i[Y]=null,D==="value"||D==="checked"){let V=t;const K=e===void 0;if(D==="value"){let O=V.defaultValue;V.removeAttribute(D),V.defaultValue=O,V.value=V.__value=K?O:null}else{let O=V.defaultChecked;V.removeAttribute(D),V.defaultChecked=O,V.checked=K?O:!1}}else t.removeAttribute(Y);else B||h.includes(D)&&(l||typeof S!="string")?(t[D]=S,D in i&&(i[D]=wn)):typeof S!="function"&&kt(t,D,S)}}}return d}function Va(t,e,n=[],r=[],a=[],s,i=!1,l=!1){Rh(a,n,r,u=>{var d=void 0,v={},p=t.nodeName===b_,h=!1;if(Xh(()=>{var x=e(...u.map(o)),k=x_(t,d,x,s,i,l);h&&p&&"value"in x&&xl(t,x.value);for(let D of Object.getOwnPropertySymbols(v))x[D]||kn(v[D]);for(let D of Object.getOwnPropertySymbols(x)){var E=x[D];D.description===gy&&(!d||E!==d[D])&&(v[D]&&kn(v[D]),v[D]=$n(()=>p_(t,()=>E))),k[D]=E}d=k}),p){var m=t;hi(()=>{xl(m,d.value,!0),vp(m)})}h=!0})}function gp(t){return t.__attributes??(t.__attributes={[hp]:t.nodeName.includes("-"),[pp]:t.namespaceURI===_h})}var Ff=new Map;function mp(t){var e=t.getAttribute("is")||t.nodeName,n=Ff.get(e);if(n)return n;Ff.set(e,n=[]);for(var r,a=t,s=Element.prototype;s!==a;){r=ch(a);for(var i in r)r[i].set&&n.push(i);a=Wl(a)}return n}function Zr(t,e,n=e){var r=new WeakSet;Gh(t,"input",async a=>{var s=a?t.defaultValue:t.value;if(s=Kc(t)?Hc(s):s,n(s),It!==null&&r.add(It),await op(),s!==(s=e())){var i=t.selectionStart,l=t.selectionEnd,u=t.value.length;if(t.value=s??"",l!==null){var d=t.value.length;i===l&&l===u&&d>u?(t.selectionStart=d,t.selectionEnd=d):(t.selectionStart=i,t.selectionEnd=Math.min(l,d))}}}),er(e)==null&&t.value&&(n(Kc(t)?Hc(t.value):t.value),It!==null&&r.add(It)),Zl(()=>{var a=e();if(t===document.activeElement){var s=bl??It;if(r.has(s))return}Kc(t)&&a===Hc(t.value)||t.type==="date"&&!a&&!t.value||a!==t.value&&(t.value=a??"")})}function Kc(t){var e=t.type;return e==="number"||e==="range"}function Hc(t){return t===""?null:+t}var Ra,ei,uo,Hl,yp;const Gl=class Gl{constructor(e){Pe(this,Hl);Pe(this,Ra,new WeakMap);Pe(this,ei);Pe(this,uo);Et(this,uo,e)}observe(e,n){var r=U(this,Ra).get(e)||new Set;return r.add(n),U(this,Ra).set(e,r),An(this,Hl,yp).call(this).observe(e,U(this,uo)),()=>{var a=U(this,Ra).get(e);a.delete(n),a.size===0&&(U(this,Ra).delete(e),U(this,ei).unobserve(e))}}};Ra=new WeakMap,ei=new WeakMap,uo=new WeakMap,Hl=new WeakSet,yp=function(){return U(this,ei)??Et(this,ei,new ResizeObserver(e=>{for(var n of e){Gl.entries.set(n.target,n);for(var r of U(this,Ra).get(n.target)||[])r(n)}}))},ht(Gl,"entries",new WeakMap);let Au=Gl;var k_=new Au({box:"border-box"});function Kf(t,e,n){var r=k_.observe(t,()=>n(t[e]));hi(()=>(er(()=>n(t[e])),r))}function Hf(t,e){return t===e||(t==null?void 0:t[Jr])===e}function Cs(t={},e,n,r){return hi(()=>{var a,s;return Zl(()=>{a=s,s=[],er(()=>{t!==n(...s)&&(e(t,...s),a&&Hf(n(...a),t)&&e(null,...a))})}),()=>{$r(()=>{s&&Hf(n(...s),t)&&e(null,...s)})}}),t}function S_(t=!1){const e=tn,n=e.l.u;if(!n)return;let r=()=>up(e.s);if(t){let a=0,s={};const i=yo(()=>{let l=!1;const u=e.s;for(const d in u)u[d]!==s[d]&&(s[d]=u[d],l=!0);return l&&a++,a});r=()=>o(i)}n.b.length&&Wh(()=>{Gf(e,r),fu(n.b)}),yn(()=>{const a=er(()=>n.m.map(Wm));return()=>{for(const s of a)typeof s=="function"&&s()}}),n.a.length&&yn(()=>{Gf(e,r),fu(n.a)})}function Gf(t,e){if(t.l.s)for(const n of t.l.s)o(n);e()}let Yo=!1;function E_(t){var e=Yo;try{return Yo=!1,[t(),Yo]}finally{Yo=e}}const A_={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function Is(t,e,n){return new Proxy({props:t,exclude:e},A_)}const T_={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(Ci(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let a=t.props[r];Ci(a)&&(a=a());const s=ja(a,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(Ci(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const a=ja(r,e);return a&&!a.configurable&&(a.configurable=!0),a}}},has(t,e){if(e===Jr||e===ph)return!1;for(let n of t.props)if(Ci(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(Ci(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function Fs(...t){return new Proxy({props:t},T_)}function Ae(t,e,n,r){var Y;var a=!vi||(n&dy)!==0,s=(n&vy)!==0,i=(n&hy)!==0,l=r,u=!0,d=()=>(u&&(u=!1,l=i?er(r):r),l),v;if(s){var p=Jr in t||ph in t;v=((Y=ja(t,e))==null?void 0:Y.set)??(p&&e in t?S=>t[e]=S:void 0)}var h,m=!1;s?[h,m]=E_(()=>t[e]):h=t[e],h===void 0&&r!==void 0&&(h=d(),v&&(a&&ty(),v(h)));var x;if(a?x=()=>{var S=t[e];return S===void 0?d():(u=!0,S)}:x=()=>{var S=t[e];return S!==void 0&&(l=void 0),S===void 0?l:S},a&&(n&fy)===0)return x;if(v){var k=t.$$legacy;return(function(S,V){return arguments.length>0?((!a||!V||k||m)&&v(V?x():S),S):x()})}var E=!1,D=((n&uy)!==0?yo:od)(()=>(E=!1,x()));s&&o(D);var B=Yt;return(function(S,V){if(arguments.length>0){const K=V?o(D):a&&s?Wt(S):S;return P(D,K),E=!0,l!==void 0&&(l=K),S}return Ka&&E||(B.f&_a)!==0?D.v:o(D)})}function _n(t){tn===null&&rd(),vi&&tn.l!==null?C_(tn).m.push(t):yn(()=>{const e=er(t);if(typeof e=="function")return e})}function md(t){tn===null&&rd(),_n(()=>()=>er(t))}function C_(t){var e=t.l;return e.u??(e.u={a:[],b:[],m:[]})}const I_="5";var lh;typeof window<"u"&&((lh=window.__svelte??(window.__svelte={})).v??(lh.v=new Set)).add(I_);var P_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dl={exports:{}},O_=dl.exports,Uf;function N_(){return Uf||(Uf=1,(function(t,e){((n,r)=>{t.exports=r()})(O_,function(){var n=function(c,f){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(g,y){g.__proto__=y}:function(g,y){for(var w in y)Object.prototype.hasOwnProperty.call(y,w)&&(g[w]=y[w])}))(c,f)},r=function(){return(r=Object.assign||function(c){for(var f,g=1,y=arguments.length;g<y;g++)for(var w in f=arguments[g])Object.prototype.hasOwnProperty.call(f,w)&&(c[w]=f[w]);return c}).apply(this,arguments)};function a(c,f,g){for(var y,w=0,A=f.length;w<A;w++)!y&&w in f||((y=y||Array.prototype.slice.call(f,0,w))[w]=f[w]);return c.concat(y||Array.prototype.slice.call(f))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:P_,i=Object.keys,l=Array.isArray;function u(c,f){return typeof f=="object"&&i(f).forEach(function(g){c[g]=f[g]}),c}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var d=Object.getPrototypeOf,v={}.hasOwnProperty;function p(c,f){return v.call(c,f)}function h(c,f){typeof f=="function"&&(f=f(d(c))),(typeof Reflect>"u"?i:Reflect.ownKeys)(f).forEach(function(g){x(c,g,f[g])})}var m=Object.defineProperty;function x(c,f,g,y){m(c,f,u(g&&p(g,"get")&&typeof g.get=="function"?{get:g.get,set:g.set,configurable:!0}:{value:g,configurable:!0,writable:!0},y))}function k(c){return{from:function(f){return c.prototype=Object.create(f.prototype),x(c.prototype,"constructor",c),{extend:h.bind(null,c.prototype)}}}}var E=Object.getOwnPropertyDescriptor,D=[].slice;function B(c,f,g){return D.call(c,f,g)}function Y(c,f){return f(c)}function S(c){if(!c)throw new Error("Assertion Failed")}function V(c){s.setImmediate?setImmediate(c):setTimeout(c,0)}function K(c,f){if(typeof f=="string"&&p(c,f))return c[f];if(!f)return c;if(typeof f!="string"){for(var g=[],y=0,w=f.length;y<w;++y){var A=K(c,f[y]);g.push(A)}return g}var R,X=f.indexOf(".");return X===-1||(R=c[f.substr(0,X)])==null?void 0:K(R,f.substr(X+1))}function O(c,f,g){if(c&&f!==void 0&&!("isFrozen"in Object&&Object.isFrozen(c)))if(typeof f!="string"&&"length"in f){S(typeof g!="string"&&"length"in g);for(var y=0,w=f.length;y<w;++y)O(c,f[y],g[y])}else{var A,R,X=f.indexOf(".");X!==-1?(A=f.substr(0,X),(X=f.substr(X+1))===""?g===void 0?l(c)&&!isNaN(parseInt(A))?c.splice(A,1):delete c[A]:c[A]=g:O(R=(R=c[A])&&p(c,A)?R:c[A]={},X,g)):g===void 0?l(c)&&!isNaN(parseInt(f))?c.splice(f,1):delete c[f]:c[f]=g}}function J(c){var f,g={};for(f in c)p(c,f)&&(g[f]=c[f]);return g}var ie=[].concat;function ke(c){return ie.apply([],c)}var ae="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ke([8,16,32,64].map(function(c){return["Int","Uint","Float"].map(function(f){return f+c+"Array"})}))).filter(function(c){return s[c]}),F=new Set(ae.map(function(c){return s[c]})),I=null;function j(c){return I=new WeakMap,c=(function f(g){if(!g||typeof g!="object")return g;var y=I.get(g);if(y)return y;if(l(g)){y=[],I.set(g,y);for(var w=0,A=g.length;w<A;++w)y.push(f(g[w]))}else if(F.has(g.constructor))y=g;else{var R,X=d(g);for(R in y=X===Object.prototype?{}:Object.create(X),I.set(g,y),g)p(g,R)&&(y[R]=f(g[R]))}return y})(c),I=null,c}var C={}.toString;function N(c){return C.call(c).slice(8,-1)}var M=typeof Symbol<"u"?Symbol.iterator:"@@iterator",$=typeof M=="symbol"?function(c){var f;return c!=null&&(f=c[M])&&f.apply(c)}:function(){return null};function H(c,f){f=c.indexOf(f),0<=f&&c.splice(f,1)}var L={};function q(c){var f,g,y,w;if(arguments.length===1){if(l(c))return c.slice();if(this===L&&typeof c=="string")return[c];if(w=$(c))for(g=[];!(y=w.next()).done;)g.push(y.value);else{if(c==null)return[c];if(typeof(f=c.length)!="number")return[c];for(g=new Array(f);f--;)g[f]=c[f]}}else for(f=arguments.length,g=new Array(f);f--;)g[f]=arguments[f];return g}var te=typeof Symbol<"u"?function(c){return c[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ae=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],tt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ae),W={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function G(c,f){this.name=c,this.message=f}function ne(c,f){return c+". Errors: "+Object.keys(f).map(function(g){return f[g].toString()}).filter(function(g,y,w){return w.indexOf(g)===y}).join(`
`)}function re(c,f,g,y){this.failures=f,this.failedKeys=y,this.successCount=g,this.message=ne(c,f)}function pe(c,f){this.name="BulkError",this.failures=Object.keys(f).map(function(g){return f[g]}),this.failuresByPos=f,this.message=ne(c,this.failures)}k(G).from(Error).extend({toString:function(){return this.name+": "+this.message}}),k(re).from(G),k(pe).from(G);var ye=tt.reduce(function(c,f){return c[f]=f+"Error",c},{}),Se=G,Z=tt.reduce(function(c,f){var g=f+"Error";function y(w,A){this.name=g,w?typeof w=="string"?(this.message="".concat(w).concat(A?`
 `+A:""),this.inner=A||null):typeof w=="object"&&(this.message="".concat(w.name," ").concat(w.message),this.inner=w):(this.message=W[f]||g,this.inner=null)}return k(y).from(Se),c[f]=y,c},{}),he=(Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError,ae.reduce(function(c,f){return c[f+"Error"]=Z[f],c},{}));ae=tt.reduce(function(c,f){return["Syntax","Type","Range"].indexOf(f)===-1&&(c[f+"Error"]=Z[f]),c},{});function be(){}function Ie(c){return c}function Ye(c,f){return c==null||c===Ie?f:function(g){return f(c(g))}}function Je(c,f){return function(){c.apply(this,arguments),f.apply(this,arguments)}}function ct(c,f){return c===be?f:function(){var g=c.apply(this,arguments),y=(g!==void 0&&(arguments[0]=g),this.onsuccess),w=this.onerror,A=(this.onsuccess=null,this.onerror=null,f.apply(this,arguments));return y&&(this.onsuccess=this.onsuccess?Je(y,this.onsuccess):y),w&&(this.onerror=this.onerror?Je(w,this.onerror):w),A!==void 0?A:g}}function qe(c,f){return c===be?f:function(){c.apply(this,arguments);var g=this.onsuccess,y=this.onerror;this.onsuccess=this.onerror=null,f.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?Je(g,this.onsuccess):g),y&&(this.onerror=this.onerror?Je(y,this.onerror):y)}}function Oe(c,f){return c===be?f:function(w){var y=c.apply(this,arguments),w=(u(w,y),this.onsuccess),A=this.onerror,R=(this.onsuccess=null,this.onerror=null,f.apply(this,arguments));return w&&(this.onsuccess=this.onsuccess?Je(w,this.onsuccess):w),A&&(this.onerror=this.onerror?Je(A,this.onerror):A),y===void 0?R===void 0?void 0:R:u(y,R)}}function ze(c,f){return c===be?f:function(){return f.apply(this,arguments)!==!1&&c.apply(this,arguments)}}function Ne(c,f){return c===be?f:function(){var g=c.apply(this,arguments);if(g&&typeof g.then=="function"){for(var y=this,w=arguments.length,A=new Array(w);w--;)A[w]=arguments[w];return g.then(function(){return f.apply(y,A)})}return f.apply(this,arguments)}}ae.ModifyError=re,ae.DexieError=G,ae.BulkError=pe;var Fe=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ke(c){Fe=c}var $e={},Ze=100,Ge=typeof Promise>"u"?[]:(tt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Ge=crypto.subtle.digest("SHA-512",new Uint8Array([0])),d(Ge),tt]:[tt,d(tt),tt]),tt=Ge[0],Ls=Ge[1],Ls=Ls&&Ls.then,nt=tt&&tt.constructor,ft=!!Ge[2],mt=function(c,f){Rt.push([c,f]),St&&(queueMicrotask(Mn),St=!1)},vt=!0,St=!0,bt=[],pt=[],yt=Ie,dt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:be,pgp:!1,env:{},finalize:be},Le=dt,Rt=[],At=0,Gt=[];function De(c){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var f=this._PSD=Le;if(typeof c!="function"){if(c!==$e)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&_e(this,this._value)}else this._state=null,this._value=null,++f.ref,(function g(y,w){try{w(function(A){if(y._state===null){if(A===y)throw new TypeError("A promise cannot be resolved with itself.");var R=y._lib&&it();A&&typeof A.then=="function"?g(y,function(X,de){A instanceof De?A._then(X,de):A.then(X,de)}):(y._state=!0,y._value=A,ln(y)),R&&ut()}},_e.bind(null,y))}catch(A){_e(y,A)}})(this,c)}var Qt={get:function(){var c=Le,f=en;function g(y,w){var A=this,R=!c.global&&(c!==Le||f!==en),X=R&&!xr(),de=new De(function(xe,fe){En(A,new Gn(le(y,c,R,X),le(w,c,R,X),xe,fe,c))});return this._consoleTask&&(de._consoleTask=this._consoleTask),de}return g.prototype=$e,g},set:function(c){x(this,"then",c&&c.prototype===$e?Qt:{get:function(){return c},set:Qt.set})}};function Gn(c,f,g,y,w){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof f=="function"?f:null,this.resolve=g,this.reject=y,this.psd=w}function _e(c,f){var g,y;pt.push(f),c._state===null&&(g=c._lib&&it(),f=yt(f),c._state=!1,c._value=f,y=c,bt.some(function(w){return w._value===y._value})||bt.push(y),ln(c),g)&&ut()}function ln(c){var f=c._listeners;c._listeners=[];for(var g=0,y=f.length;g<y;++g)En(c,f[g]);var w=c._PSD;--w.ref||w.finalize(),At===0&&(++At,mt(function(){--At==0&&Pt()},[]))}function En(c,f){if(c._state===null)c._listeners.push(f);else{var g=c._state?f.onFulfilled:f.onRejected;if(g===null)return(c._state?f.resolve:f.reject)(c._value);++f.psd.ref,++At,mt(Ct,[g,c,f])}}function Ct(c,f,g){try{var y,w=f._value;!f._state&&pt.length&&(pt=[]),y=Fe&&f._consoleTask?f._consoleTask.run(function(){return c(w)}):c(w),f._state||pt.indexOf(w)!==-1||(A=>{for(var R=bt.length;R;)if(bt[--R]._value===A._value)return bt.splice(R,1)})(f),g.resolve(y)}catch(A){g.reject(A)}finally{--At==0&&Pt(),--g.psd.ref||g.psd.finalize()}}function Mn(){ot(dt,function(){it()&&ut()})}function it(){var c=vt;return St=vt=!1,c}function ut(){var c,f,g;do for(;0<Rt.length;)for(c=Rt,Rt=[],g=c.length,f=0;f<g;++f){var y=c[f];y[0].apply(null,y[1])}while(0<Rt.length);St=vt=!0}function Pt(){for(var c=bt,f=(bt=[],c.forEach(function(y){y._PSD.onunhandled.call(null,y._value,y)}),Gt.slice(0)),g=f.length;g;)f[--g]()}function $t(c){return new De($e,!1,c)}function _t(c,f){var g=Le;return function(){var y=it(),w=Le;try{return kr(g,!0),c.apply(this,arguments)}catch(A){f&&f(A)}finally{kr(w,!1),y&&ut()}}}h(De.prototype,{then:Qt,_then:function(c,f){En(this,new Gn(null,null,c,f,Le))},catch:function(c){var f,g;return arguments.length===1?this.then(null,c):(f=c,g=arguments[1],typeof f=="function"?this.then(null,function(y){return(y instanceof f?g:$t)(y)}):this.then(null,function(y){return(y&&y.name===f?g:$t)(y)}))},finally:function(c){return this.then(function(f){return De.resolve(c()).then(function(){return f})},function(f){return De.resolve(c()).then(function(){return $t(f)})})},timeout:function(c,f){var g=this;return c<1/0?new De(function(y,w){var A=setTimeout(function(){return w(new Z.Timeout(f))},c);g.then(y,w).finally(clearTimeout.bind(null,A))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&x(De.prototype,Symbol.toStringTag,"Dexie.Promise"),dt.env=Po(),h(De,{all:function(){var c=q.apply(null,arguments).map(Wa);return new De(function(f,g){c.length===0&&f([]);var y=c.length;c.forEach(function(w,A){return De.resolve(w).then(function(R){c[A]=R,--y||f(c)},g)})})},resolve:function(c){return c instanceof De?c:c&&typeof c.then=="function"?new De(function(f,g){c.then(f,g)}):new De($e,!0,c)},reject:$t,race:function(){var c=q.apply(null,arguments).map(Wa);return new De(function(f,g){c.map(function(y){return De.resolve(y).then(f,g)})})},PSD:{get:function(){return Le},set:function(c){return Le=c}},totalEchoes:{get:function(){return en}},newPSD:On,usePSD:ot,scheduler:{get:function(){return mt},set:function(c){mt=c}},rejectionMapper:{get:function(){return yt},set:function(c){yt=c}},follow:function(c,f){return new De(function(g,y){return On(function(w,A){var R=Le;R.unhandleds=[],R.onunhandled=A,R.finalize=Je(function(){var X,de=this;X=function(){de.unhandleds.length===0?w():A(de.unhandleds[0])},Gt.push(function xe(){X(),Gt.splice(Gt.indexOf(xe),1)}),++At,mt(function(){--At==0&&Pt()},[])},R.finalize),c()},f,g,y)})}}),nt&&(nt.allSettled&&x(De,"allSettled",function(){var c=q.apply(null,arguments).map(Wa);return new De(function(f){c.length===0&&f([]);var g=c.length,y=new Array(g);c.forEach(function(w,A){return De.resolve(w).then(function(R){return y[A]={status:"fulfilled",value:R}},function(R){return y[A]={status:"rejected",reason:R}}).then(function(){return--g||f(y)})})})}),nt.any&&typeof AggregateError<"u"&&x(De,"any",function(){var c=q.apply(null,arguments).map(Wa);return new De(function(f,g){c.length===0&&g(new AggregateError([]));var y=c.length,w=new Array(y);c.forEach(function(A,R){return De.resolve(A).then(function(X){return f(X)},function(X){w[R]=X,--y||g(new AggregateError(w))})})})}),nt.withResolvers)&&(De.withResolvers=nt.withResolvers);var jt={awaits:0,echoes:0,id:0},fn=0,cn=[],Jt=0,en=0,jn=0;function On(c,R,g,y){var w=Le,A=Object.create(w),R=(A.parent=w,A.ref=0,A.global=!1,A.id=++jn,dt.env,A.env=ft?{Promise:De,PromiseProp:{value:De,configurable:!0,writable:!0},all:De.all,race:De.race,allSettled:De.allSettled,any:De.any,resolve:De.resolve,reject:De.reject}:{},R&&u(A,R),++w.ref,A.finalize=function(){--this.parent.ref||this.parent.finalize()},ot(A,c,g,y));return A.ref===0&&A.finalize(),R}function Nn(){return jt.id||(jt.id=++fn),++jt.awaits,jt.echoes+=Ze,jt.id}function xr(){return!!jt.awaits&&(--jt.awaits==0&&(jt.id=0),jt.echoes=jt.awaits*Ze,!0)}function Wa(c){return jt.echoes&&c&&c.constructor===nt?(Nn(),c.then(function(f){return xr(),f},function(f){return xr(),Ue(f)})):c}function Io(){var c=cn[cn.length-1];cn.pop(),kr(c,!1)}function kr(c,f){var g,y,w=Le;(f?!jt.echoes||Jt++&&c===Le:!Jt||--Jt&&c===Le)||queueMicrotask(f?(function(A){++en,jt.echoes&&--jt.echoes!=0||(jt.echoes=jt.awaits=jt.id=0),cn.push(Le),kr(A,!0)}).bind(null,c):Io),c!==Le&&(Le=c,w===dt&&(dt.env=Po()),ft)&&(g=dt.env.Promise,y=c.env,w.global||c.global)&&(Object.defineProperty(s,"Promise",y.PromiseProp),g.all=y.all,g.race=y.race,g.resolve=y.resolve,g.reject=y.reject,y.allSettled&&(g.allSettled=y.allSettled),y.any)&&(g.any=y.any)}function Po(){var c=s.Promise;return ft?{Promise:c,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:c.all,race:c.race,allSettled:c.allSettled,any:c.any,resolve:c.resolve,reject:c.reject}:{}}function ot(c,f,g,y,w){var A=Le;try{return kr(c,!0),f(g,y,w)}finally{kr(A,!1)}}function le(c,f,g,y){return typeof c!="function"?c:function(){var w=Le;g&&Nn(),kr(f,!0);try{return c.apply(this,arguments)}finally{kr(w,!1),y&&queueMicrotask(xr)}}}function Be(c){Promise===nt&&jt.echoes===0?Jt===0?c():enqueueNativeMicroTask(c):setTimeout(c,0)}(""+Ls).indexOf("[native code]")===-1&&(Nn=xr=be);var Ue=De.reject,Ft="ï¿¿",nn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",un="String expected.",hn=[],Un="__dbnames",Br="readonly",Ya="readwrite";function sn(c,f){return c?f?function(){return c.apply(this,arguments)&&f.apply(this,arguments)}:c:f}var yi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Xa(c){return typeof c!="string"||/\./.test(c)?function(f){return f}:function(f){return f[c]===void 0&&c in f&&delete(f=j(f))[c],f}}function tf(){throw Z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function zt(c,f){try{var g=nf(c),y=nf(f);if(g!==y)return g==="Array"?1:y==="Array"?-1:g==="binary"?1:y==="binary"?-1:g==="string"?1:y==="string"?-1:g==="Date"?1:y!=="Date"?NaN:-1;switch(g){case"number":case"Date":case"string":return f<c?1:c<f?-1:0;case"binary":for(var w=rf(c),A=rf(f),R=w.length,X=A.length,de=R<X?R:X,xe=0;xe<de;++xe)if(w[xe]!==A[xe])return w[xe]<A[xe]?-1:1;return R===X?0:R<X?-1:1;case"Array":for(var fe=c,oe=f,ge=fe.length,me=oe.length,ve=ge<me?ge:me,ue=0;ue<ve;++ue){var Ee=zt(fe[ue],oe[ue]);if(Ee!==0)return Ee}return ge===me?0:ge<me?-1:1}}catch{}return NaN}function nf(c){var f=typeof c;return f=="object"&&(ArrayBuffer.isView(c)||(f=N(c))==="ArrayBuffer")?"binary":f}function rf(c){return c instanceof Uint8Array?c:ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c)}function Mo(c,f,g){var y=c.schema.yProps;return y?(f&&0<g.numFailures&&(f=f.filter(function(w,A){return!g.failures[A]})),Promise.all(y.map(function(w){return w=w.updatesTable,f?c.db.table(w).where("k").anyOf(f).delete():c.db.table(w).clear()})).then(function(){return g})):g}af.prototype.execute=function(c){var f=this["@@propmod"];if(f.add!==void 0){var g=f.add;if(l(g))return a(a([],l(c)?c:[],!0),g).sort();if(typeof g=="number")return(Number(c)||0)+g;if(typeof g=="bigint")try{return BigInt(c)+g}catch{return BigInt(0)+g}throw new TypeError("Invalid term ".concat(g))}if(f.remove!==void 0){var y=f.remove;if(l(y))return l(c)?c.filter(function(w){return!y.includes(w)}).sort():[];if(typeof y=="number")return Number(c)-y;if(typeof y=="bigint")try{return BigInt(c)-y}catch{return BigInt(0)-y}throw new TypeError("Invalid subtrahend ".concat(y))}return g=(g=f.replacePrefix)==null?void 0:g[0],g&&typeof c=="string"&&c.startsWith(g)?f.replacePrefix[1]+c.substring(g.length):c};var _i=af;function af(c){this["@@propmod"]=c}function sf(c,f){for(var g=i(f),y=g.length,w=!1,A=0;A<y;++A){var R=g[A],X=f[R],de=K(c,R);X instanceof _i?(O(c,R,X.execute(de)),w=!0):de!==X&&(O(c,R,X),w=!0)}return w}rn.prototype._trans=function(c,f,g){var y=this._tx||Le.trans,w=this.name,A=Fe&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(c==="readonly"?"read":"write"," ").concat(this.name));function R(xe,fe,oe){if(oe.schema[w])return f(oe.idbtrans,oe);throw new Z.NotFound("Table "+w+" not part of transaction")}var X=it();try{var de=y&&y.db._novip===this.db._novip?y===Le.trans?y._promise(c,R,g):On(function(){return y._promise(c,R,g)},{trans:y,transless:Le.transless||Le}):(function xe(fe,oe,ge,me){if(fe.idbdb&&(fe._state.openComplete||Le.letThrough||fe._vip)){var ve=fe._createTransaction(oe,ge,fe._dbSchema);try{ve.create(),fe._state.PR1398_maxLoop=3}catch(ue){return ue.name===ye.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,oe,ge,me)})):Ue(ue)}return ve._promise(oe,function(ue,Ee){return On(function(){return Le.trans=ve,me(ue,Ee,ve)})}).then(function(ue){if(oe==="readwrite")try{ve.idbtrans.commit()}catch{}return oe==="readonly"?ue:ve._completion.then(function(){return ue})})}if(fe._state.openComplete)return Ue(new Z.DatabaseClosed(fe._state.dbOpenError));if(!fe._state.isBeingOpened){if(!fe._state.autoOpen)return Ue(new Z.DatabaseClosed);fe.open().catch(be)}return fe._state.dbReadyPromise.then(function(){return xe(fe,oe,ge,me)})})(this.db,c,[this.name],R);return A&&(de._consoleTask=A,de=de.catch(function(xe){return console.trace(xe),Ue(xe)})),de}finally{X&&ut()}},rn.prototype.get=function(c,f){var g=this;return c&&c.constructor===Object?this.where(c).first(f):c==null?Ue(new Z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(y){return g.core.get({trans:y,key:c}).then(function(w){return g.hook.reading.fire(w)})}).then(f)},rn.prototype.where=function(c){if(typeof c=="string")return new this.db.WhereClause(this,c);if(l(c))return new this.db.WhereClause(this,"[".concat(c.join("+"),"]"));var f=i(c);if(f.length===1)return this.where(f[0]).equals(c[f[0]]);var g=this.schema.indexes.concat(this.schema.primKey).filter(function(X){if(X.compound&&f.every(function(xe){return 0<=X.keyPath.indexOf(xe)})){for(var de=0;de<f.length;++de)if(f.indexOf(X.keyPath[de])===-1)return!1;return!0}return!1}).sort(function(X,de){return X.keyPath.length-de.keyPath.length})[0];if(g&&this.db._maxKey!==Ft)return R=g.keyPath.slice(0,f.length),this.where(R).equals(R.map(function(X){return c[X]}));!g&&Fe&&console.warn("The query ".concat(JSON.stringify(c)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(f.join("+"),"]"));var y=this.schema.idxByName;function w(X,de){return zt(X,de)===0}var R=f.reduce(function(fe,de){var xe=fe[0],fe=fe[1],oe=y[de],ge=c[de];return[xe||oe,xe||!oe?sn(fe,oe&&oe.multi?function(me){return me=K(me,de),l(me)&&me.some(function(ve){return w(ge,ve)})}:function(me){return w(ge,K(me,de))}):fe]},[null,null]),A=R[0],R=R[1];return A?this.where(A.name).equals(c[A.keyPath]).filter(R):g?this.filter(R):this.where(f).equals("")},rn.prototype.filter=function(c){return this.toCollection().and(c)},rn.prototype.count=function(c){return this.toCollection().count(c)},rn.prototype.offset=function(c){return this.toCollection().offset(c)},rn.prototype.limit=function(c){return this.toCollection().limit(c)},rn.prototype.each=function(c){return this.toCollection().each(c)},rn.prototype.toArray=function(c){return this.toCollection().toArray(c)},rn.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},rn.prototype.orderBy=function(c){return new this.db.Collection(new this.db.WhereClause(this,l(c)?"[".concat(c.join("+"),"]"):c))},rn.prototype.reverse=function(){return this.toCollection().reverse()},rn.prototype.mapToClass=function(c){for(var f=this.db,g=this.name,y=((this.schema.mappedClass=c).prototype instanceof tf&&(c=(R=>{var X=fe,de=R;if(typeof de!="function"&&de!==null)throw new TypeError("Class extends value "+String(de)+" is not a constructor or null");function xe(){this.constructor=X}function fe(){return R!==null&&R.apply(this,arguments)||this}return n(X,de),X.prototype=de===null?Object.create(de):(xe.prototype=de.prototype,new xe),Object.defineProperty(fe.prototype,"db",{get:function(){return f},enumerable:!1,configurable:!0}),fe.prototype.table=function(){return g},fe})(c)),new Set),w=c.prototype;w;w=d(w))Object.getOwnPropertyNames(w).forEach(function(R){return y.add(R)});function A(R){if(!R)return R;var X,de=Object.create(c.prototype);for(X in R)if(!y.has(X))try{de[X]=R[X]}catch{}return de}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=A,this.hook("reading",A),c},rn.prototype.defineClass=function(){return this.mapToClass(function(c){u(this,c)})},rn.prototype.add=function(c,f){var g=this,y=this.schema.primKey,w=y.auto,A=y.keyPath,R=c;return A&&w&&(R=Xa(A)(c)),this._trans("readwrite",function(X){return g.core.mutate({trans:X,type:"add",keys:f!=null?[f]:null,values:[R]})}).then(function(X){return X.numFailures?De.reject(X.failures[0]):X.lastResult}).then(function(X){if(A)try{O(c,A,X)}catch{}return X})},rn.prototype.upsert=function(c,f){var g=this,y=this.schema.primKey.keyPath;return this._trans("readwrite",function(w){return g.core.get({trans:w,key:c}).then(function(A){var R=A??{};return sf(R,f),y&&O(R,y,c),g.core.mutate({trans:w,type:"put",values:[R],keys:[c],upsert:!0,updates:{keys:[c],changeSpecs:[f]}}).then(function(X){return X.numFailures?De.reject(X.failures[0]):!!A})})})},rn.prototype.update=function(c,f){return typeof c!="object"||l(c)?this.where(":id").equals(c).modify(f):(c=K(c,this.schema.primKey.keyPath))===void 0?Ue(new Z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(f)},rn.prototype.put=function(c,f){var g=this,y=this.schema.primKey,w=y.auto,A=y.keyPath,R=c;return A&&w&&(R=Xa(A)(c)),this._trans("readwrite",function(X){return g.core.mutate({trans:X,type:"put",values:[R],keys:f!=null?[f]:null})}).then(function(X){return X.numFailures?De.reject(X.failures[0]):X.lastResult}).then(function(X){if(A)try{O(c,A,X)}catch{}return X})},rn.prototype.delete=function(c){var f=this;return this._trans("readwrite",function(g){return f.core.mutate({trans:g,type:"delete",keys:[c]}).then(function(y){return Mo(f,[c],y)}).then(function(y){return y.numFailures?De.reject(y.failures[0]):void 0})})},rn.prototype.clear=function(){var c=this;return this._trans("readwrite",function(f){return c.core.mutate({trans:f,type:"deleteRange",range:yi}).then(function(g){return Mo(c,null,g)})}).then(function(f){return f.numFailures?De.reject(f.failures[0]):void 0})},rn.prototype.bulkGet=function(c){var f=this;return this._trans("readonly",function(g){return f.core.getMany({keys:c,trans:g}).then(function(y){return y.map(function(w){return f.hook.reading.fire(w)})})})},rn.prototype.bulkAdd=function(c,f,g){var y=this,w=Array.isArray(f)?f:void 0,A=(g=g||(w?void 0:f))?g.allKeys:void 0;return this._trans("readwrite",function(R){var X=y.schema.primKey,xe=X.auto,X=X.keyPath;if(X&&w)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(w&&w.length!==c.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=X&&xe?c.map(Xa(X)):c;return y.core.mutate({trans:R,type:"add",keys:w,values:xe,wantResults:A}).then(function(fe){var oe=fe.numFailures,ge=fe.failures;if(oe===0)return A?fe.results:fe.lastResult;throw new pe("".concat(y.name,".bulkAdd(): ").concat(oe," of ").concat(de," operations failed"),ge)})})},rn.prototype.bulkPut=function(c,f,g){var y=this,w=Array.isArray(f)?f:void 0,A=(g=g||(w?void 0:f))?g.allKeys:void 0;return this._trans("readwrite",function(R){var X=y.schema.primKey,xe=X.auto,X=X.keyPath;if(X&&w)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(w&&w.length!==c.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var de=c.length,xe=X&&xe?c.map(Xa(X)):c;return y.core.mutate({trans:R,type:"put",keys:w,values:xe,wantResults:A}).then(function(fe){var oe=fe.numFailures,ge=fe.failures;if(oe===0)return A?fe.results:fe.lastResult;throw new pe("".concat(y.name,".bulkPut(): ").concat(oe," of ").concat(de," operations failed"),ge)})})},rn.prototype.bulkUpdate=function(c){var f=this,g=this.core,y=c.map(function(R){return R.key}),w=c.map(function(R){return R.changes}),A=[];return this._trans("readwrite",function(R){return g.getMany({trans:R,keys:y,cache:"clone"}).then(function(X){var de=[],xe=[],fe=(c.forEach(function(oe,ge){var me=oe.key,ve=oe.changes,ue=X[ge];if(ue){for(var Ee=0,Te=Object.keys(ve);Ee<Te.length;Ee++){var we=Te[Ee],Ce=ve[we];if(we===f.schema.primKey.keyPath){if(zt(Ce,me)!==0)throw new Z.Constraint("Cannot update primary key in bulkUpdate()")}else O(ue,we,Ce)}A.push(ge),de.push(me),xe.push(ue)}}),de.length);return g.mutate({trans:R,type:"put",keys:de,values:xe,updates:{keys:y,changeSpecs:w}}).then(function(oe){var ge=oe.numFailures,me=oe.failures;if(ge===0)return fe;for(var ve=0,ue=Object.keys(me);ve<ue.length;ve++){var Ee,Te=ue[ve],we=A[Number(Te)];we!=null&&(Ee=me[Te],delete me[Te],me[we]=Ee)}throw new pe("".concat(f.name,".bulkUpdate(): ").concat(ge," of ").concat(fe," operations failed"),me)})})})},rn.prototype.bulkDelete=function(c){var f=this,g=c.length;return this._trans("readwrite",function(y){return f.core.mutate({trans:y,type:"delete",keys:c}).then(function(w){return Mo(f,c,w)})}).then(function(y){var w=y.numFailures,A=y.failures;if(w===0)return y.lastResult;throw new pe("".concat(f.name,".bulkDelete(): ").concat(w," of ").concat(g," operations failed"),A)})};var of=rn;function rn(){}function bi(c){function f(R,X){if(X){for(var de=arguments.length,xe=new Array(de-1);--de;)xe[de-1]=arguments[de];return g[R].subscribe.apply(null,xe),c}if(typeof R=="string")return g[R]}var g={};f.addEventType=A;for(var y=1,w=arguments.length;y<w;++y)A(arguments[y]);return f;function A(R,X,de){var xe,fe;if(typeof R!="object")return X=X||ze,fe={subscribers:[],fire:de=de||be,subscribe:function(oe){fe.subscribers.indexOf(oe)===-1&&(fe.subscribers.push(oe),fe.fire=X(fe.fire,oe))},unsubscribe:function(oe){fe.subscribers=fe.subscribers.filter(function(ge){return ge!==oe}),fe.fire=fe.subscribers.reduce(X,de)}},g[R]=f[R]=fe;i(xe=R).forEach(function(oe){var ge=xe[oe];if(l(ge))A(oe,xe[oe][0],xe[oe][1]);else{if(ge!=="asap")throw new Z.InvalidArgument("Invalid event config");var me=A(oe,Ie,function(){for(var ve=arguments.length,ue=new Array(ve);ve--;)ue[ve]=arguments[ve];me.subscribers.forEach(function(Ee){V(function(){Ee.apply(null,ue)})})})}})}}function wi(c,f){return k(f).from({prototype:c}),f}function Ns(c,f){return!(c.filter||c.algorithm||c.or)&&(f?c.justLimit:!c.replayFilter)}function hc(c,f){c.filter=sn(c.filter,f)}function pc(c,f,g){var y=c.replayFilter;c.replayFilter=y?function(){return sn(y(),f())}:f,c.justLimit=g&&!y}function Oo(c,f){if(c.isPrimKey)return f.primaryKey;var g=f.getIndexByKeyPath(c.index);if(g)return g;throw new Z.Schema("KeyPath "+c.index+" on object store "+f.name+" is not indexed")}function lf(c,f,g){var y=Oo(c,f.schema);return f.openCursor({trans:g,values:!c.keysOnly,reverse:c.dir==="prev",unique:!!c.unique,query:{index:y,range:c.range}})}function No(c,f,g,y){var w,A,R=c.replayFilter?sn(c.filter,c.replayFilter()):c.filter;return c.or?(w={},A=function(X,de,xe){var fe,oe;R&&!R(de,xe,function(ge){return de.stop(ge)},function(ge){return de.fail(ge)})||((oe=""+(fe=de.primaryKey))=="[object ArrayBuffer]"&&(oe=""+new Uint8Array(fe)),p(w,oe))||(w[oe]=!0,f(X,de,xe))},Promise.all([c.or._iterate(A,g),cf(lf(c,y,g),c.algorithm,A,!c.keysOnly&&c.valueMapper)])):cf(lf(c,y,g),sn(c.algorithm,R),f,!c.keysOnly&&c.valueMapper)}function cf(c,f,g,y){var w=_t(y?function(A,R,X){return g(y(A),R,X)}:g);return c.then(function(A){if(A)return A.start(function(){var R=function(){return A.continue()};f&&!f(A,function(X){return R=X},function(X){A.stop(X),R=be},function(X){A.fail(X),R=be})||w(A.value,A,function(X){return R=X}),R()})})}Kt.prototype._read=function(c,f){var g=this._ctx;return g.error?g.table._trans(null,Ue.bind(null,g.error)):g.table._trans("readonly",c).then(f)},Kt.prototype._write=function(c){var f=this._ctx;return f.error?f.table._trans(null,Ue.bind(null,f.error)):f.table._trans("readwrite",c,"locked")},Kt.prototype._addAlgorithm=function(c){var f=this._ctx;f.algorithm=sn(f.algorithm,c)},Kt.prototype._iterate=function(c,f){return No(this._ctx,c,f,this._ctx.table.core)},Kt.prototype.clone=function(c){var f=Object.create(this.constructor.prototype),g=Object.create(this._ctx);return c&&u(g,c),f._ctx=g,f},Kt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Kt.prototype.each=function(c){var f=this._ctx;return this._read(function(g){return No(f,c,g,f.table.core)})},Kt.prototype.count=function(c){var f=this;return this._read(function(g){var y,w=f._ctx,A=w.table.core;return Ns(w,!0)?A.count({trans:g,query:{index:Oo(w,A.schema),range:w.range}}).then(function(R){return Math.min(R,w.limit)}):(y=0,No(w,function(){return++y,!1},g,A).then(function(){return y}))}).then(c)},Kt.prototype.sortBy=function(c,f){var g=c.split(".").reverse(),y=g[0],w=g.length-1;function A(de,xe){return xe?A(de[g[xe]],xe-1):de[y]}var R=this._ctx.dir==="next"?1:-1;function X(de,xe){return zt(A(de,w),A(xe,w))*R}return this.toArray(function(de){return de.sort(X)}).then(f)},Kt.prototype.toArray=function(c){var f=this;return this._read(function(g){var y,w,A,R=f._ctx;return R.dir==="next"&&Ns(R,!0)&&0<R.limit?(y=R.valueMapper,w=Oo(R,R.table.core.schema),R.table.core.query({trans:g,limit:R.limit,values:!0,query:{index:w,range:R.range}}).then(function(X){return X=X.result,y?X.map(y):X})):(A=[],No(R,function(X){return A.push(X)},g,R.table.core).then(function(){return A}))},c)},Kt.prototype.offset=function(c){var f=this._ctx;return c<=0||(f.offset+=c,Ns(f)?pc(f,function(){var g=c;return function(y,w){return g===0||(g===1?--g:w(function(){y.advance(g),g=0}),!1)}}):pc(f,function(){var g=c;return function(){return--g<0}})),this},Kt.prototype.limit=function(c){return this._ctx.limit=Math.min(this._ctx.limit,c),pc(this._ctx,function(){var f=c;return function(g,y,w){return--f<=0&&y(w),0<=f}},!0),this},Kt.prototype.until=function(c,f){return hc(this._ctx,function(g,y,w){return!c(g.value)||(y(w),f)}),this},Kt.prototype.first=function(c){return this.limit(1).toArray(function(f){return f[0]}).then(c)},Kt.prototype.last=function(c){return this.reverse().first(c)},Kt.prototype.filter=function(c){var f;return hc(this._ctx,function(g){return c(g.value)}),(f=this._ctx).isMatch=sn(f.isMatch,c),this},Kt.prototype.and=function(c){return this.filter(c)},Kt.prototype.or=function(c){return new this.db.WhereClause(this._ctx.table,c,this)},Kt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Kt.prototype.desc=function(){return this.reverse()},Kt.prototype.eachKey=function(c){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(g,y){c(y.key,y)})},Kt.prototype.eachUniqueKey=function(c){return this._ctx.unique="unique",this.eachKey(c)},Kt.prototype.eachPrimaryKey=function(c){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(g,y){c(y.primaryKey,y)})},Kt.prototype.keys=function(c){var f=this._ctx,g=(f.keysOnly=!f.isMatch,[]);return this.each(function(y,w){g.push(w.key)}).then(function(){return g}).then(c)},Kt.prototype.primaryKeys=function(c){var f=this._ctx;if(f.dir==="next"&&Ns(f,!0)&&0<f.limit)return this._read(function(y){var w=Oo(f,f.table.core.schema);return f.table.core.query({trans:y,values:!1,limit:f.limit,query:{index:w,range:f.range}})}).then(function(y){return y.result}).then(c);f.keysOnly=!f.isMatch;var g=[];return this.each(function(y,w){g.push(w.primaryKey)}).then(function(){return g}).then(c)},Kt.prototype.uniqueKeys=function(c){return this._ctx.unique="unique",this.keys(c)},Kt.prototype.firstKey=function(c){return this.limit(1).keys(function(f){return f[0]}).then(c)},Kt.prototype.lastKey=function(c){return this.reverse().firstKey(c)},Kt.prototype.distinct=function(){var c,f=this._ctx,f=f.index&&f.table.schema.idxByName[f.index];return f&&f.multi&&(c={},hc(this._ctx,function(y){var y=y.primaryKey.toString(),w=p(c,y);return c[y]=!0,!w})),this},Kt.prototype.modify=function(c){var f=this,g=this._ctx;return this._write(function(y){function w(ue,Ee){var Te=Ee.failures;ge+=ue-Ee.numFailures;for(var we=0,Ce=i(Te);we<Ce.length;we++){var Re=Ce[we];oe.push(Te[Re])}}var A=typeof c=="function"?c:function(ue){return sf(ue,c)},R=g.table.core,fe=R.schema.primaryKey,X=fe.outbound,de=fe.extractKey,xe=200,fe=f.db._options.modifyChunkSize,oe=(fe&&(xe=typeof fe=="object"?fe[R.name]||fe["*"]||200:fe),[]),ge=0,me=[],ve=c===uf;return f.clone().primaryKeys().then(function(ue){function Ee(we){var Ce=Math.min(xe,ue.length-we),Re=ue.slice(we,we+Ce);return(ve?Promise.resolve([]):R.getMany({trans:y,keys:Re,cache:"immutable"})).then(function(Ve){var We=[],je=[],et=X?[]:null,Qe=ve?Re:[];if(!ve)for(var He=0;He<Ce;++He){var rt=Ve[He],qt={value:j(rt),primKey:ue[we+He]};A.call(qt,qt.value,qt)!==!1&&(qt.value==null?Qe.push(ue[we+He]):X||zt(de(rt),de(qt.value))===0?(je.push(qt.value),X&&et.push(ue[we+He])):(Qe.push(ue[we+He]),We.push(qt.value)))}return Promise.resolve(0<We.length&&R.mutate({trans:y,type:"add",values:We}).then(function(Ht){for(var gt in Ht.failures)Qe.splice(parseInt(gt),1);w(We.length,Ht)})).then(function(){return(0<je.length||Te&&typeof c=="object")&&R.mutate({trans:y,type:"put",keys:et,values:je,criteria:Te,changeSpec:typeof c!="function"&&c,isAdditionalChunk:0<we}).then(function(Ht){return w(je.length,Ht)})}).then(function(){return(0<Qe.length||Te&&ve)&&R.mutate({trans:y,type:"delete",keys:Qe,criteria:Te,isAdditionalChunk:0<we}).then(function(Ht){return Mo(g.table,Qe,Ht)}).then(function(Ht){return w(Qe.length,Ht)})}).then(function(){return ue.length>we+Ce&&Ee(we+xe)})})}var Te=Ns(g)&&g.limit===1/0&&(typeof c!="function"||ve)&&{index:g.index,range:g.range};return Ee(0).then(function(){if(0<oe.length)throw new re("Error modifying one or more objects",oe,ge,me);return ue.length})})})},Kt.prototype.delete=function(){var c=this._ctx,f=c.range;return!Ns(c)||c.table.schema.yProps||!c.isPrimKey&&f.type!==3?this.modify(uf):this._write(function(g){var y=c.table.core.schema.primaryKey,w=f;return c.table.core.count({trans:g,query:{index:y,range:w}}).then(function(A){return c.table.core.mutate({trans:g,type:"deleteRange",range:w}).then(function(de){var X=de.failures,de=de.numFailures;if(de)throw new re("Could not delete some values",Object.keys(X).map(function(xe){return X[xe]}),A-de);return A-de})})})};var xm=Kt;function Kt(){}var uf=function(c,f){return f.value=null};function km(c,f){return c<f?-1:c===f?0:1}function Sm(c,f){return f<c?-1:c===f?0:1}function rr(c,f,g){return c=c instanceof ff?new c.Collection(c):c,c._ctx.error=new(g||TypeError)(f),c}function Ds(c){return new c.Collection(c,function(){return df("")}).limit(0)}function Do(me,f,g,y){var w,A,R,X,de,xe,fe,oe=g.length;if(!g.every(function(ue){return typeof ue=="string"}))return rr(me,un);function ge(ue){w=ue==="next"?function(Te){return Te.toUpperCase()}:function(Te){return Te.toLowerCase()},A=ue==="next"?function(Te){return Te.toLowerCase()}:function(Te){return Te.toUpperCase()},R=ue==="next"?km:Sm;var Ee=g.map(function(Te){return{lower:A(Te),upper:w(Te)}}).sort(function(Te,we){return R(Te.lower,we.lower)});X=Ee.map(function(Te){return Te.upper}),de=Ee.map(function(Te){return Te.lower}),fe=(xe=ue)==="next"?"":y}ge("next");var me=new me.Collection(me,function(){return Ea(X[0],de[oe-1]+y)}),ve=(me._ondirectionchange=function(ue){ge(ue)},0);return me._addAlgorithm(function(ue,Ee,Te){var we=ue.key;if(typeof we=="string"){var Ce=A(we);if(f(Ce,de,ve))return!0;for(var Re=null,Ve=ve;Ve<oe;++Ve){var We=((je,et,Qe,He,rt,qt)=>{for(var Ht=Math.min(je.length,He.length),gt=-1,Mt=0;Mt<Ht;++Mt){var dn=et[Mt];if(dn!==He[Mt])return rt(je[Mt],Qe[Mt])<0?je.substr(0,Mt)+Qe[Mt]+Qe.substr(Mt+1):rt(je[Mt],He[Mt])<0?je.substr(0,Mt)+He[Mt]+Qe.substr(Mt+1):0<=gt?je.substr(0,gt)+et[gt]+Qe.substr(gt+1):null;rt(je[Mt],dn)<0&&(gt=Mt)}return Ht<He.length&&qt==="next"?je+Qe.substr(je.length):Ht<je.length&&qt==="prev"?je.substr(0,Qe.length):gt<0?null:je.substr(0,gt)+He[gt]+Qe.substr(gt+1)})(we,Ce,X[Ve],de[Ve],R,xe);We===null&&Re===null?ve=Ve+1:(Re===null||0<R(Re,We))&&(Re=We)}Ee(Re!==null?function(){ue.continue(Re+fe)}:Te)}return!1}),me}function Ea(c,f,g,y){return{type:2,lower:c,upper:f,lowerOpen:g,upperOpen:y}}function df(c){return{type:1,lower:c,upper:c}}Object.defineProperty(bn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),bn.prototype.between=function(c,f,g,y){g=g!==!1,y=y===!0;try{return 0<this._cmp(c,f)||this._cmp(c,f)===0&&(g||y)&&(!g||!y)?Ds(this):new this.Collection(this,function(){return Ea(c,f,!g,!y)})}catch{return rr(this,nn)}},bn.prototype.equals=function(c){return c==null?rr(this,nn):new this.Collection(this,function(){return df(c)})},bn.prototype.above=function(c){return c==null?rr(this,nn):new this.Collection(this,function(){return Ea(c,void 0,!0)})},bn.prototype.aboveOrEqual=function(c){return c==null?rr(this,nn):new this.Collection(this,function(){return Ea(c,void 0,!1)})},bn.prototype.below=function(c){return c==null?rr(this,nn):new this.Collection(this,function(){return Ea(void 0,c,!1,!0)})},bn.prototype.belowOrEqual=function(c){return c==null?rr(this,nn):new this.Collection(this,function(){return Ea(void 0,c)})},bn.prototype.startsWith=function(c){return typeof c!="string"?rr(this,un):this.between(c,c+Ft,!0,!0)},bn.prototype.startsWithIgnoreCase=function(c){return c===""?this.startsWith(c):Do(this,function(f,g){return f.indexOf(g[0])===0},[c],Ft)},bn.prototype.equalsIgnoreCase=function(c){return Do(this,function(f,g){return f===g[0]},[c],"")},bn.prototype.anyOfIgnoreCase=function(){var c=q.apply(L,arguments);return c.length===0?Ds(this):Do(this,function(f,g){return g.indexOf(f)!==-1},c,"")},bn.prototype.startsWithAnyOfIgnoreCase=function(){var c=q.apply(L,arguments);return c.length===0?Ds(this):Do(this,function(f,g){return g.some(function(y){return f.indexOf(y)===0})},c,Ft)},bn.prototype.anyOf=function(){var c,f,g=this,y=q.apply(L,arguments),w=this._cmp;try{y.sort(w)}catch{return rr(this,nn)}return y.length===0?Ds(this):((c=new this.Collection(this,function(){return Ea(y[0],y[y.length-1])}))._ondirectionchange=function(A){w=A==="next"?g._ascending:g._descending,y.sort(w)},f=0,c._addAlgorithm(function(A,R,X){for(var de=A.key;0<w(de,y[f]);)if(++f===y.length)return R(X),!1;return w(de,y[f])===0||(R(function(){A.continue(y[f])}),!1)}),c)},bn.prototype.notEqual=function(c){return this.inAnyRange([[-1/0,c],[c,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},bn.prototype.noneOf=function(){var c=q.apply(L,arguments);if(c.length===0)return new this.Collection(this);try{c.sort(this._ascending)}catch{return rr(this,nn)}var f=c.reduce(function(g,y){return g?g.concat([[g[g.length-1][1],y]]):[[-1/0,y]]},null);return f.push([c[c.length-1],this.db._maxKey]),this.inAnyRange(f,{includeLowers:!1,includeUppers:!1})},bn.prototype.inAnyRange=function(c,Te){var g=this,y=this._cmp,w=this._ascending,A=this._descending,R=this._min,X=this._max;if(c.length===0)return Ds(this);if(!c.every(function(we){return we[0]!==void 0&&we[1]!==void 0&&w(we[0],we[1])<=0}))return rr(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var de=!Te||Te.includeLowers!==!1,xe=Te&&Te.includeUppers===!0,fe,oe=w;function ge(we,Ce){return oe(we[0],Ce[0])}try{(fe=c.reduce(function(we,Ce){for(var Re=0,Ve=we.length;Re<Ve;++Re){var We=we[Re];if(y(Ce[0],We[1])<0&&0<y(Ce[1],We[0])){We[0]=R(We[0],Ce[0]),We[1]=X(We[1],Ce[1]);break}}return Re===Ve&&we.push(Ce),we},[])).sort(ge)}catch{return rr(this,nn)}var me=0,ve=xe?function(we){return 0<w(we,fe[me][1])}:function(we){return 0<=w(we,fe[me][1])},ue=de?function(we){return 0<A(we,fe[me][0])}:function(we){return 0<=A(we,fe[me][0])},Ee=ve,Te=new this.Collection(this,function(){return Ea(fe[0][0],fe[fe.length-1][1],!de,!xe)});return Te._ondirectionchange=function(we){oe=we==="next"?(Ee=ve,w):(Ee=ue,A),fe.sort(ge)},Te._addAlgorithm(function(we,Ce,Re){for(var Ve,We=we.key;Ee(We);)if(++me===fe.length)return Ce(Re),!1;return!ve(Ve=We)&&!ue(Ve)||(g._cmp(We,fe[me][1])===0||g._cmp(We,fe[me][0])===0||Ce(function(){oe===w?we.continue(fe[me][0]):we.continue(fe[me][1])}),!1)}),Te},bn.prototype.startsWithAnyOf=function(){var c=q.apply(L,arguments);return c.every(function(f){return typeof f=="string"})?c.length===0?Ds(this):this.inAnyRange(c.map(function(f){return[f,f+Ft]})):rr(this,"startsWithAnyOf() only works with strings")};var ff=bn;function bn(){}function Fr(c){return _t(function(f){return xi(f),c(f.target.error),!1})}function xi(c){c.stopPropagation&&c.stopPropagation(),c.preventDefault&&c.preventDefault()}var ki="storagemutated",gc="x-storagemutated-1",Aa=bi(null,ki),Em=(Kr.prototype._lock=function(){return S(!Le.global),++this._reculock,this._reculock!==1||Le.global||(Le.lockOwnerFor=this),this},Kr.prototype._unlock=function(){if(S(!Le.global),--this._reculock==0)for(Le.global||(Le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var c=this._blockedFuncs.shift();try{ot(c[1],c[0])}catch{}}return this},Kr.prototype._locked=function(){return this._reculock&&Le.lockOwnerFor!==this},Kr.prototype.create=function(c){var f=this;if(this.mode){var g=this.db.idbdb,y=this.db._state.dbOpenError;if(S(!this.idbtrans),!c&&!g)switch(y&&y.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(y);case"MissingAPIError":throw new Z.MissingAPI(y.message,y);default:throw new Z.OpenFailed(y)}if(!this.active)throw new Z.TransactionInactive;S(this._completion._state===null),(c=this.idbtrans=c||(this.db.core||g).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=_t(function(w){xi(w),f._reject(c.error)}),c.onabort=_t(function(w){xi(w),f.active&&f._reject(new Z.Abort(c.error)),f.active=!1,f.on("abort").fire(w)}),c.oncomplete=_t(function(){f.active=!1,f._resolve(),"mutatedParts"in c&&Aa.storagemutated.fire(c.mutatedParts)})}return this},Kr.prototype._promise=function(c,f,g){var y,w=this;return c==="readwrite"&&this.mode!=="readwrite"?Ue(new Z.ReadOnly("Transaction is readonly")):this.active?this._locked()?new De(function(A,R){w._blockedFuncs.push([function(){w._promise(c,f,g).then(A,R)},Le])}):g?On(function(){var A=new De(function(R,X){w._lock();var de=f(R,X,w);de&&de.then&&de.then(R,X)});return A.finally(function(){return w._unlock()}),A._lib=!0,A}):((y=new De(function(A,R){var X=f(A,R,w);X&&X.then&&X.then(A,R)}))._lib=!0,y):Ue(new Z.TransactionInactive)},Kr.prototype._root=function(){return this.parent?this.parent._root():this},Kr.prototype.waitFor=function(c){var f,g=this._root(),y=De.resolve(c),w=(g._waitingFor?g._waitingFor=g._waitingFor.then(function(){return y}):(g._waitingFor=y,g._waitingQueue=[],f=g.idbtrans.objectStore(g.storeNames[0]),(function A(){for(++g._spinCount;g._waitingQueue.length;)g._waitingQueue.shift()();g._waitingFor&&(f.get(-1/0).onsuccess=A)})()),g._waitingFor);return new De(function(A,R){y.then(function(X){return g._waitingQueue.push(_t(A.bind(null,X)))},function(X){return g._waitingQueue.push(_t(R.bind(null,X)))}).finally(function(){g._waitingFor===w&&(g._waitingFor=null)})})},Kr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},Kr.prototype.table=function(c){var f=this._memoizedTables||(this._memoizedTables={});if(p(f,c))return f[c];var g=this.schema[c];if(g)return(g=new this.db.Table(c,g,this)).core=this.db.core.table(c),f[c]=g;throw new Z.NotFound("Table "+c+" not part of transaction")},Kr);function Kr(){}function mc(c,f,g,y,w,A,R,X){return{name:c,keyPath:f,unique:g,multi:y,auto:w,compound:A,src:(g&&!R?"&":"")+(y?"*":"")+(w?"++":"")+vf(f),type:X}}function vf(c){return typeof c=="string"?c:c?"["+[].join.call(c,"+")+"]":""}function yc(c,f,g){return{name:c,primKey:f,indexes:g,mappedClass:null,idxByName:(y=function(w){return[w.name,w]},g.reduce(function(w,A,R){return A=y(A,R),A&&(w[A[0]]=A[1]),w},{}))};var y}var Si=function(c){try{return c.only([[]]),Si=function(){return[[]]},[[]]}catch{return Si=function(){return Ft},Ft}};function _c(c){return c==null?function(){}:typeof c=="string"?(f=c).split(".").length===1?function(g){return g[f]}:function(g){return K(g,f)}:function(g){return K(g,c)};var f}function hf(c){return[].slice.call(c)}var Am=0;function Ei(c){return c==null?":id":typeof c=="string"?c:"[".concat(c.join("+"),"]")}function Tm(c,f,de){function y(ve){if(ve.type===3)return null;if(ve.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var oe=ve.lower,ge=ve.upper,me=ve.lowerOpen,ve=ve.upperOpen;return oe===void 0?ge===void 0?null:f.upperBound(ge,!!ve):ge===void 0?f.lowerBound(oe,!!me):f.bound(oe,ge,!!me,!!ve)}function w(fe){var oe,ge=fe.name;return{name:ge,schema:fe,mutate:function(me){var ve=me.trans,ue=me.type,Ee=me.keys,Te=me.values,we=me.range;return new Promise(function(Ce,Re){Ce=_t(Ce);var Ve=ve.objectStore(ge),We=Ve.keyPath==null,je=ue==="put"||ue==="add";if(!je&&ue!=="delete"&&ue!=="deleteRange")throw new Error("Invalid operation type: "+ue);var et,Qe=(Ee||Te||{length:1}).length;if(Ee&&Te&&Ee.length!==Te.length)throw new Error("Given keys array must have same length as given values array.");if(Qe===0)return Ce({numFailures:0,failures:{},results:[],lastResult:void 0});function He(vn){++Ht,xi(vn)}var rt=[],qt=[],Ht=0;if(ue==="deleteRange"){if(we.type===4)return Ce({numFailures:Ht,failures:qt,results:[],lastResult:void 0});we.type===3?rt.push(et=Ve.clear()):rt.push(et=Ve.delete(y(we)))}else{var We=je?We?[Te,Ee]:[Te,null]:[Ee,null],gt=We[0],Mt=We[1];if(je)for(var dn=0;dn<Qe;++dn)rt.push(et=Mt&&Mt[dn]!==void 0?Ve[ue](gt[dn],Mt[dn]):Ve[ue](gt[dn])),et.onerror=He;else for(dn=0;dn<Qe;++dn)rt.push(et=Ve[ue](gt[dn])),et.onerror=He}function fr(vn){vn=vn.target.result,rt.forEach(function(Ja,jc){return Ja.error!=null&&(qt[jc]=Ja.error)}),Ce({numFailures:Ht,failures:qt,results:ue==="delete"?Ee:rt.map(function(Ja){return Ja.result}),lastResult:vn})}et.onerror=function(vn){He(vn),fr(vn)},et.onsuccess=fr})},getMany:function(me){var ve=me.trans,ue=me.keys;return new Promise(function(Ee,Te){Ee=_t(Ee);for(var we,Ce=ve.objectStore(ge),Re=ue.length,Ve=new Array(Re),We=0,je=0,et=function(rt){rt=rt.target,Ve[rt._pos]=rt.result,++je===We&&Ee(Ve)},Qe=Fr(Te),He=0;He<Re;++He)ue[He]!=null&&((we=Ce.get(ue[He]))._pos=He,we.onsuccess=et,we.onerror=Qe,++We);We===0&&Ee(Ve)})},get:function(me){var ve=me.trans,ue=me.key;return new Promise(function(Ee,Te){Ee=_t(Ee);var we=ve.objectStore(ge).get(ue);we.onsuccess=function(Ce){return Ee(Ce.target.result)},we.onerror=Fr(Te)})},query:(oe=X,function(me){return new Promise(function(ve,ue){ve=_t(ve);var Ee,Te,we,je=me.trans,Ce=me.values,Re=me.limit,We=me.query,Ve=Re===1/0?void 0:Re,et=We.index,We=We.range,je=je.objectStore(ge),je=et.isPrimaryKey?je:je.index(et.name),et=y(We);if(Re===0)return ve({result:[]});oe?((We=Ce?je.getAll(et,Ve):je.getAllKeys(et,Ve)).onsuccess=function(Qe){return ve({result:Qe.target.result})},We.onerror=Fr(ue)):(Ee=0,Te=!Ce&&"openKeyCursor"in je?je.openKeyCursor(et):je.openCursor(et),we=[],Te.onsuccess=function(Qe){var He=Te.result;return!He||(we.push(Ce?He.value:He.primaryKey),++Ee===Re)?ve({result:we}):void He.continue()},Te.onerror=Fr(ue))})}),openCursor:function(me){var ve=me.trans,ue=me.values,Ee=me.query,Te=me.reverse,we=me.unique;return new Promise(function(Ce,Re){Ce=_t(Ce);var je=Ee.index,Ve=Ee.range,We=ve.objectStore(ge),We=je.isPrimaryKey?We:We.index(je.name),je=Te?we?"prevunique":"prev":we?"nextunique":"next",et=!ue&&"openKeyCursor"in We?We.openKeyCursor(y(Ve),je):We.openCursor(y(Ve),je);et.onerror=Fr(Re),et.onsuccess=_t(function(Qe){var He,rt,qt,Ht,gt=et.result;gt?(gt.___id=++Am,gt.done=!1,He=gt.continue.bind(gt),rt=(rt=gt.continuePrimaryKey)&&rt.bind(gt),qt=gt.advance.bind(gt),Ht=function(){throw new Error("Cursor not stopped")},gt.trans=ve,gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=function(){throw new Error("Cursor not started")},gt.fail=_t(Re),gt.next=function(){var Mt=this,dn=1;return this.start(function(){return dn--?Mt.continue():Mt.stop()}).then(function(){return Mt})},gt.start=function(Mt){function dn(){if(et.result)try{Mt()}catch(vn){gt.fail(vn)}else gt.done=!0,gt.start=function(){throw new Error("Cursor behind last entry")},gt.stop()}var fr=new Promise(function(vn,Ja){vn=_t(vn),et.onerror=Fr(Ja),gt.fail=Ja,gt.stop=function(jc){gt.stop=gt.continue=gt.continuePrimaryKey=gt.advance=Ht,vn(jc)}});return et.onsuccess=_t(function(vn){et.onsuccess=dn,dn()}),gt.continue=He,gt.continuePrimaryKey=rt,gt.advance=qt,dn(),fr},Ce(gt)):Ce(null)},Re)})},count:function(me){var ve=me.query,ue=me.trans,Ee=ve.index,Te=ve.range;return new Promise(function(we,Ce){var Re=ue.objectStore(ge),Re=Ee.isPrimaryKey?Re:Re.index(Ee.name),Ve=y(Te),Ve=Ve?Re.count(Ve):Re.count();Ve.onsuccess=_t(function(We){return we(We.target.result)}),Ve.onerror=Fr(Ce)})}}}A=de,R=hf((de=c).objectStoreNames);var A,de={schema:{name:de.name,tables:R.map(function(fe){return A.objectStore(fe)}).map(function(fe){var oe=fe.keyPath,ge=fe.autoIncrement,ve=l(oe),me={},ve={name:fe.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:oe==null,compound:ve,keyPath:oe,autoIncrement:ge,unique:!0,extractKey:_c(oe)},indexes:hf(fe.indexNames).map(function(ue){return fe.index(ue)}).map(function(we){var Ce=we.name,Ee=we.unique,Te=we.multiEntry,we=we.keyPath,Ce={name:Ce,compound:l(we),keyPath:we,unique:Ee,multiEntry:Te,extractKey:_c(we)};return me[Ei(we)]=Ce}),getIndexByKeyPath:function(ue){return me[Ei(ue)]}};return me[":id"]=ve.primaryKey,oe!=null&&(me[Ei(oe)]=ve.primaryKey),ve})},hasGetAll:0<R.length&&"getAll"in A.objectStore(R[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},R=de.schema,X=de.hasGetAll,de=R.tables.map(w),xe={};return de.forEach(function(fe){return xe[fe.name]=fe}),{stack:"dbcore",transaction:c.transaction.bind(c),table:function(fe){if(xe[fe])return xe[fe];throw new Error("Table '".concat(fe,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Si(f),schema:R}}function Cm(c,f,g,y){return g=g.IDBKeyRange,f=Tm(f,g,y),{dbcore:c.dbcore.reduce(function(w,A){return A=A.create,r(r({},w),A(w))},f)}}function Ro(c,f){var g=f.db,g=Cm(c._middlewares,g,c._deps,f);c.core=g.dbcore,c.tables.forEach(function(y){var w=y.name;c.core.schema.tables.some(function(A){return A.name===w})&&(y.core=c.core.table(w),c[w]instanceof c.Table)&&(c[w].core=y.core)})}function Lo(c,f,g,y){g.forEach(function(w){var A=y[w];f.forEach(function(R){var X=(function de(xe,fe){return E(xe,fe)||(xe=d(xe))&&de(xe,fe)})(R,w);(!X||"value"in X&&X.value===void 0)&&(R===c.Transaction.prototype||R instanceof c.Transaction?x(R,w,{get:function(){return this.table(w)},set:function(de){m(this,w,{value:de,writable:!0,configurable:!0,enumerable:!0})}}):R[w]=new c.Table(w,A))})})}function bc(c,f){f.forEach(function(g){for(var y in g)g[y]instanceof c.Table&&delete g[y]})}function Im(c,f){return c._cfg.version-f._cfg.version}function Pm(c,f,g,y){var w=c._dbSchema,A=(g.objectStoreNames.contains("$meta")&&!w.$meta&&(w.$meta=yc("$meta",gf("")[0],[]),c._storeNames.push("$meta")),c._createTransaction("readwrite",c._storeNames,w)),R=(A.create(g),A._completion.catch(y),A._reject.bind(A)),X=Le.transless||Le;On(function(){if(Le.trans=A,Le.transless=X,f!==0)return Ro(c,g),xe=f,((de=A).storeNames.includes("$meta")?de.table("$meta").get("version").then(function(fe){return fe??xe}):De.resolve(xe)).then(function(Ee){var oe=c,ge=Ee,me=A,ve=g,ue=[],Ee=oe._versions,Te=oe._dbSchema=zo(0,oe.idbdb,ve);return(Ee=Ee.filter(function(we){return we._cfg.version>=ge})).length===0?De.resolve():(Ee.forEach(function(we){ue.push(function(){var Ce,Re,Ve,We=Te,je=we._cfg.dbschema,et=(qo(oe,We,ve),qo(oe,je,ve),Te=oe._dbSchema=je,wc(We,je)),Qe=(et.add.forEach(function(He){xc(ve,He[0],He[1].primKey,He[1].indexes)}),et.change.forEach(function(He){if(He.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var rt=ve.objectStore(He.name);He.add.forEach(function(qt){return jo(rt,qt)}),He.change.forEach(function(qt){rt.deleteIndex(qt.name),jo(rt,qt)}),He.del.forEach(function(qt){return rt.deleteIndex(qt)})}),we._cfg.contentUpgrade);if(Qe&&we._cfg.version>ge)return Ro(oe,ve),me._memoizedTables={},Ce=J(je),et.del.forEach(function(He){Ce[He]=We[He]}),bc(oe,[oe.Transaction.prototype]),Lo(oe,[oe.Transaction.prototype],i(Ce),Ce),me.schema=Ce,(Re=te(Qe))&&Nn(),je=De.follow(function(){var He;(Ve=Qe(me))&&Re&&(He=xr.bind(null,null),Ve.then(He,He))}),Ve&&typeof Ve.then=="function"?De.resolve(Ve):je.then(function(){return Ve})}),ue.push(function(Ce){var Re,Ve,We=we._cfg.dbschema;Re=We,Ve=Ce,[].slice.call(Ve.db.objectStoreNames).forEach(function(je){return Re[je]==null&&Ve.db.deleteObjectStore(je)}),bc(oe,[oe.Transaction.prototype]),Lo(oe,[oe.Transaction.prototype],oe._storeNames,oe._dbSchema),me.schema=oe._dbSchema}),ue.push(function(Ce){oe.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(oe.idbdb.version/10)===we._cfg.version?(oe.idbdb.deleteObjectStore("$meta"),delete oe._dbSchema.$meta,oe._storeNames=oe._storeNames.filter(function(Re){return Re!=="$meta"})):Ce.objectStore("$meta").put(we._cfg.version,"version"))})}),(function we(){return ue.length?De.resolve(ue.shift()(me.idbtrans)).then(we):De.resolve()})().then(function(){pf(Te,ve)}))}).catch(R);var de,xe;i(w).forEach(function(fe){xc(g,fe,w[fe].primKey,w[fe].indexes)}),Ro(c,g),De.follow(function(){return c.on.populate.fire(A)}).catch(R)})}function Mm(c,f){pf(c._dbSchema,f),f.db.version%10!=0||f.objectStoreNames.contains("$meta")||f.db.createObjectStore("$meta").add(Math.ceil(f.db.version/10-1),"version");var g=zo(0,c.idbdb,f);qo(c,c._dbSchema,f);for(var y=0,w=wc(g,c._dbSchema).change;y<w.length;y++){var A=(R=>{if(R.change.length||R.recreate)return console.warn("Unable to patch indexes of table ".concat(R.name," because it has changes on the type of index or primary key.")),{value:void 0};var X=f.objectStore(R.name);R.add.forEach(function(de){Fe&&console.debug("Dexie upgrade patch: Creating missing index ".concat(R.name,".").concat(de.src)),jo(X,de)})})(w[y]);if(typeof A=="object")return A.value}}function wc(c,f){var g,y={del:[],add:[],change:[]};for(g in c)f[g]||y.del.push(g);for(g in f){var w=c[g],A=f[g];if(w){var R={name:g,def:A,recreate:!1,del:[],add:[],change:[]};if(""+(w.primKey.keyPath||"")!=""+(A.primKey.keyPath||"")||w.primKey.auto!==A.primKey.auto)R.recreate=!0,y.change.push(R);else{var X=w.idxByName,de=A.idxByName,xe=void 0;for(xe in X)de[xe]||R.del.push(xe);for(xe in de){var fe=X[xe],oe=de[xe];fe?fe.src!==oe.src&&R.change.push(oe):R.add.push(oe)}(0<R.del.length||0<R.add.length||0<R.change.length)&&y.change.push(R)}}else y.add.push([g,A])}return y}function xc(c,f,g,y){var w=c.db.createObjectStore(f,g.keyPath?{keyPath:g.keyPath,autoIncrement:g.auto}:{autoIncrement:g.auto});y.forEach(function(A){return jo(w,A)})}function pf(c,f){i(c).forEach(function(g){f.db.objectStoreNames.contains(g)||(Fe&&console.debug("Dexie: Creating missing table",g),xc(f,g,c[g].primKey,c[g].indexes))})}function jo(c,f){c.createIndex(f.name,f.keyPath,{unique:f.unique,multiEntry:f.multi})}function zo(c,f,g){var y={};return B(f.objectStoreNames,0).forEach(function(w){for(var A=g.objectStore(w),R=mc(vf(xe=A.keyPath),xe||"",!0,!1,!!A.autoIncrement,xe&&typeof xe!="string",!0),X=[],de=0;de<A.indexNames.length;++de){var fe=A.index(A.indexNames[de]),xe=fe.keyPath,fe=mc(fe.name,xe,!!fe.unique,!!fe.multiEntry,!1,xe&&typeof xe!="string",!1);X.push(fe)}y[w]=yc(w,R,X)}),y}function qo(c,f,g){for(var y=g.db.objectStoreNames,w=0;w<y.length;++w){var A=y[w],R=g.objectStore(A);c._hasGetAll="getAll"in R;for(var X=0;X<R.indexNames.length;++X){var de,xe=R.indexNames[X],fe=R.index(xe).keyPath,fe=typeof fe=="string"?fe:"["+B(fe).join("+")+"]";f[A]&&(de=f[A].idxByName[fe])&&(de.name=xe,delete f[A].idxByName[fe],f[A].idxByName[xe]=de)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(c._hasGetAll=!1)}function gf(c){return c.split(",").map(function(f,g){var w=f.split(":"),y=(y=w[1])==null?void 0:y.trim(),w=(f=w[0].trim()).replace(/([&*]|\+\+)/g,""),A=/^\[/.test(w)?w.match(/^\[(.*)\]$/)[1].split("+"):w;return mc(w,A||null,/\&/.test(f),/\*/.test(f),/\+\+/.test(f),l(A),g===0,y)})}Rs.prototype._createTableSchema=yc,Rs.prototype._parseIndexSyntax=gf,Rs.prototype._parseStoresSpec=function(c,f){var g=this;i(c).forEach(function(y){if(c[y]!==null){var w=g._parseIndexSyntax(c[y]),A=w.shift();if(!A)throw new Z.Schema("Invalid schema for table "+y+": "+c[y]);if(A.unique=!0,A.multi)throw new Z.Schema("Primary key cannot be multiEntry*");w.forEach(function(R){if(R.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!R.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")}),A=g._createTableSchema(y,A,w),f[y]=A}})},Rs.prototype.stores=function(g){var f=this.db,g=(this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,g):g,f._versions),y={},w={};return g.forEach(function(A){u(y,A._cfg.storesSource),w=A._cfg.dbschema={},A._parseStoresSpec(y,w)}),f._dbSchema=w,bc(f,[f._allTables,f,f.Transaction.prototype]),Lo(f,[f._allTables,f,f.Transaction.prototype,this._cfg.tables],i(w),w),f._storeNames=i(w),this},Rs.prototype.upgrade=function(c){return this._cfg.contentUpgrade=Ne(this._cfg.contentUpgrade||be,c),this};var Om=Rs;function Rs(){}function kc(c,f){var g=c._dbNamesDB;return g||(g=c._dbNamesDB=new oa(Un,{addons:[],indexedDB:c,IDBKeyRange:f})).version(1).stores({dbnames:"name"}),g.table("dbnames")}function Sc(c){return c&&typeof c.databases=="function"}function Ec(c){return On(function(){return Le.letThrough=!0,c()})}function Ac(c){return!("from"in c)}var Dn=function(c,f){var g;if(!this)return g=new Dn,c&&"d"in c&&u(g,c),g;u(this,arguments.length?{d:1,from:c,to:1<arguments.length?f:c}:{d:0})};function Ai(c,f,g){var y=zt(f,g);if(!isNaN(y)){if(0<y)throw RangeError();if(Ac(c))return u(c,{from:f,to:g,d:1});var y=c.l,w=c.r;if(zt(g,c.from)<0)return y?Ai(y,f,g):c.l={from:f,to:g,d:1,l:null,r:null},yf(c);if(0<zt(f,c.to))return w?Ai(w,f,g):c.r={from:f,to:g,d:1,l:null,r:null},yf(c);zt(f,c.from)<0&&(c.from=f,c.l=null,c.d=w?w.d+1:1),0<zt(g,c.to)&&(c.to=g,c.r=null,c.d=c.l?c.l.d+1:1),f=!c.r,y&&!c.l&&Ti(c,y),w&&f&&Ti(c,w)}}function Ti(c,f){Ac(f)||(function g(y,w){var A=w.from,R=w.l,X=w.r;Ai(y,A,w.to),R&&g(y,R),X&&g(y,X)})(c,f)}function mf(c,f){var g=Bo(f),y=g.next();if(!y.done)for(var w=y.value,A=Bo(c),R=A.next(w.from),X=R.value;!y.done&&!R.done;){if(zt(X.from,w.to)<=0&&0<=zt(X.to,w.from))return!0;zt(w.from,X.from)<0?w=(y=g.next(X.from)).value:X=(R=A.next(w.from)).value}return!1}function Bo(c){var f=Ac(c)?null:{s:0,n:c};return{next:function(g){for(var y=0<arguments.length;f;)switch(f.s){case 0:if(f.s=1,y)for(;f.n.l&&zt(g,f.n.from)<0;)f={up:f,n:f.n.l,s:1};else for(;f.n.l;)f={up:f,n:f.n.l,s:1};case 1:if(f.s=2,!y||zt(g,f.n.to)<=0)return{value:f.n,done:!1};case 2:if(f.n.r){f.s=3,f={up:f,n:f.n.r,s:0};continue}case 3:f=f.up}return{done:!0}}}}function yf(c){var f,g,y,w=(((w=c.r)==null?void 0:w.d)||0)-(((w=c.l)==null?void 0:w.d)||0),w=1<w?"r":w<-1?"l":"";w&&(f=w=="r"?"l":"r",g=r({},c),y=c[w],c.from=y.from,c.to=y.to,c[w]=y[w],g[w]=y[f],(c[f]=g).d=_f(g)),c.d=_f(c)}function _f(g){var f=g.r,g=g.l;return(f?g?Math.max(f.d,g.d):f.d:g?g.d:0)+1}function Fo(c,f){return i(f).forEach(function(g){c[g]?Ti(c[g],f[g]):c[g]=(function y(w){var A,R,X={};for(A in w)p(w,A)&&(R=w[A],X[A]=!R||typeof R!="object"||F.has(R.constructor)?R:y(R));return X})(f[g])}),c}function Tc(c,f){return c.all||f.all||Object.keys(c).some(function(g){return f[g]&&mf(f[g],c[g])})}h(Dn.prototype,((tt={add:function(c){return Ti(this,c),this},addKey:function(c){return Ai(this,c,c),this},addKeys:function(c){var f=this;return c.forEach(function(g){return Ai(f,g,g)}),this},hasKey:function(c){var f=Bo(this).next(c).value;return f&&zt(f.from,c)<=0&&0<=zt(f.to,c)}})[M]=function(){return Bo(this)},tt));var Za={},Cc={},Ic=!1;function Ko(c){Fo(Cc,c),Ic||(Ic=!0,setTimeout(function(){Ic=!1,Pc(Cc,!(Cc={}))},0))}function Pc(c,f){f===void 0&&(f=!1);var g=new Set;if(c.all)for(var y=0,w=Object.values(Za);y<w.length;y++)bf(X=w[y],c,g,f);else for(var A in c){var R,X,A=/^idb\:\/\/(.*)\/(.*)\//.exec(A);A&&(R=A[1],A=A[2],X=Za["idb://".concat(R,"/").concat(A)])&&bf(X,c,g,f)}g.forEach(function(de){return de()})}function bf(c,f,g,y){for(var w=[],A=0,R=Object.entries(c.queries.query);A<R.length;A++){for(var X=R[A],de=X[0],xe=[],fe=0,oe=X[1];fe<oe.length;fe++){var ge=oe[fe];Tc(f,ge.obsSet)?ge.subscribers.forEach(function(Ee){return g.add(Ee)}):y&&xe.push(ge)}y&&w.push([de,xe])}if(y)for(var me=0,ve=w;me<ve.length;me++){var ue=ve[me],de=ue[0],xe=ue[1];c.queries.query[de]=xe}}function Nm(c){var f=c._state,g=c._deps.indexedDB;if(f.isBeingOpened||c.idbdb)return f.dbReadyPromise.then(function(){return f.dbOpenError?Ue(f.dbOpenError):c});f.isBeingOpened=!0,f.dbOpenError=null,f.openComplete=!1;var y=f.openCanceller,w=Math.round(10*c.verno),A=!1;function R(){if(f.openCanceller!==y)throw new Z.DatabaseClosed("db.open() was cancelled")}function X(){return new De(function(ge,me){if(R(),!g)throw new Z.MissingAPI;var ve=c.name,ue=f.autoSchema||!w?g.open(ve):g.open(ve,w);if(!ue)throw new Z.MissingAPI;ue.onerror=Fr(me),ue.onblocked=_t(c._fireOnBlocked),ue.onupgradeneeded=_t(function(Ee){var Te;fe=ue.transaction,f.autoSchema&&!c._options.allowEmptyDB?(ue.onerror=xi,fe.abort(),ue.result.close(),(Te=g.deleteDatabase(ve)).onsuccess=Te.onerror=_t(function(){me(new Z.NoSuchDatabase("Database ".concat(ve," doesnt exist")))})):(fe.onerror=Fr(me),Te=Ee.oldVersion>Math.pow(2,62)?0:Ee.oldVersion,oe=Te<1,c.idbdb=ue.result,A&&Mm(c,fe),Pm(c,Te/10,fe,me))},me),ue.onsuccess=_t(function(){fe=null;var Ee,Te,we,Ce,Re,Ve,We=c.idbdb=ue.result,je=B(We.objectStoreNames);if(0<je.length)try{var et=We.transaction((Re=je).length===1?Re[0]:Re,"readonly");if(f.autoSchema)Ve=We,Ce=et,(we=c).verno=Ve.version/10,Ce=we._dbSchema=zo(0,Ve,Ce),we._storeNames=B(Ve.objectStoreNames,0),Lo(we,[we._allTables],i(Ce),Ce);else if(qo(c,c._dbSchema,et),Te=et,((Te=wc(zo(0,(Ee=c).idbdb,Te),Ee._dbSchema)).add.length||Te.change.some(function(Qe){return Qe.add.length||Qe.change.length}))&&!A)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),We.close(),w=We.version+1,A=!0,ge(X());Ro(c,et)}catch{}hn.push(c),We.onversionchange=_t(function(Qe){f.vcFired=!0,c.on("versionchange").fire(Qe)}),We.onclose=_t(function(){c.close({disableAutoOpen:!1})}),oe&&(je=c._deps,Re=ve,Sc(Ve=je.indexedDB)||Re===Un||kc(Ve,je.IDBKeyRange).put({name:Re}).catch(be)),ge()},me)}).catch(function(ge){switch(ge==null?void 0:ge.name){case"UnknownError":if(0<f.PR1398_maxLoop)return f.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),X();break;case"VersionError":if(0<w)return w=0,X()}return De.reject(ge)})}var de,xe=f.dbReadyResolve,fe=null,oe=!1;return De.race([y,(typeof navigator>"u"?De.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ge){function me(){return indexedDB.databases().finally(ge)}de=setInterval(me,100),me()}).finally(function(){return clearInterval(de)}):Promise.resolve()).then(X)]).then(function(){return R(),f.onReadyBeingFired=[],De.resolve(Ec(function(){return c.on.ready.fire(c.vip)})).then(function ge(){var me;if(0<f.onReadyBeingFired.length)return me=f.onReadyBeingFired.reduce(Ne,be),f.onReadyBeingFired=[],De.resolve(Ec(function(){return me(c.vip)})).then(ge)})}).finally(function(){f.openCanceller===y&&(f.onReadyBeingFired=null,f.isBeingOpened=!1)}).catch(function(ge){f.dbOpenError=ge;try{fe&&fe.abort()}catch{}return y===f.openCanceller&&c._close(),Ue(ge)}).finally(function(){f.openComplete=!0,xe()}).then(function(){var ge;return oe&&(ge={},c.tables.forEach(function(me){me.schema.indexes.forEach(function(ve){ve.name&&(ge["idb://".concat(c.name,"/").concat(me.name,"/").concat(ve.name)]=new Dn(-1/0,[[[]]]))}),ge["idb://".concat(c.name,"/").concat(me.name,"/")]=ge["idb://".concat(c.name,"/").concat(me.name,"/:dels")]=new Dn(-1/0,[[[]]])}),Aa(ki).fire(ge),Pc(ge,!0)),c})}function Mc(c){function f(A){return c.next(A)}var g=w(f),y=w(function(A){return c.throw(A)});function w(A){return function(X){var X=A(X),de=X.value;return X.done?de:de&&typeof de.then=="function"?de.then(g,y):l(de)?Promise.all(de).then(g,y):g(de)}}return w(f)()}function Ho(c,f,g){for(var y=l(c)?c.slice():[c],w=0;w<g;++w)y.push(f);return y}var Dm={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(c){return r(r({},c),{table:function(y){var g=c.table(y),y=g.schema,w={},A=[];function R(ge,me,ve){var we=Ei(ge),ue=w[we]=w[we]||[],Ee=ge==null?0:typeof ge=="string"?1:ge.length,Te=0<me,we=r(r({},ve),{name:Te?"".concat(we,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Te,keyTail:me,keyLength:Ee,extractKey:_c(ge),unique:!Te&&ve.unique});return ue.push(we),we.isPrimaryKey||A.push(we),1<Ee&&R(Ee===2?ge[0]:ge.slice(0,Ee-1),me+1,ve),ue.sort(function(Ce,Re){return Ce.keyTail-Re.keyTail}),we}var X=R(y.primaryKey.keyPath,0,y.primaryKey);w[":id"]=[X];for(var de=0,xe=y.indexes;de<xe.length;de++){var fe=xe[de];R(fe.keyPath,0,fe)}function oe(ge){var me,ve=ge.query.index;return ve.isVirtual?r(r({},ge),{query:{index:ve.lowLevelIndex,range:(me=ge.query.range,ve=ve.keyTail,{type:me.type===1?2:me.type,lower:Ho(me.lower,me.lowerOpen?c.MAX_KEY:c.MIN_KEY,ve),lowerOpen:!0,upper:Ho(me.upper,me.upperOpen?c.MIN_KEY:c.MAX_KEY,ve),upperOpen:!0})}}):ge}return r(r({},g),{schema:r(r({},y),{primaryKey:X,indexes:A,getIndexByKeyPath:function(ge){return(ge=w[Ei(ge)])&&ge[0]}}),count:function(ge){return g.count(oe(ge))},query:function(ge){return g.query(oe(ge))},openCursor:function(ge){var me=ge.query.index,ve=me.keyTail,ue=me.keyLength;return me.isVirtual?g.openCursor(oe(ge)).then(function(Te){return Te&&Ee(Te)}):g.openCursor(ge);function Ee(Te){return Object.create(Te,{continue:{value:function(we){we!=null?Te.continue(Ho(we,ge.reverse?c.MAX_KEY:c.MIN_KEY,ve)):ge.unique?Te.continue(Te.key.slice(0,ue).concat(ge.reverse?c.MIN_KEY:c.MAX_KEY,ve)):Te.continue()}},continuePrimaryKey:{value:function(we,Ce){Te.continuePrimaryKey(Ho(we,c.MAX_KEY,ve),Ce)}},primaryKey:{get:function(){return Te.primaryKey}},key:{get:function(){var we=Te.key;return ue===1?we[0]:we.slice(0,ue)}},value:{get:function(){return Te.value}}})}}})}})}};function Oc(c,f,g,y){return g=g||{},y=y||"",i(c).forEach(function(w){var A,R,X;p(f,w)?(A=c[w],R=f[w],typeof A=="object"&&typeof R=="object"&&A&&R?(X=N(A))!==N(R)?g[y+w]=f[w]:X==="Object"?Oc(A,R,g,y+w+"."):A!==R&&(g[y+w]=f[w]):A!==R&&(g[y+w]=f[w])):g[y+w]=void 0}),i(f).forEach(function(w){p(c,w)||(g[y+w]=f[w])}),g}function Nc(c,f){return f.type==="delete"?f.keys:f.keys||f.values.map(c.extractKey)}var Rm={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(c){return r(r({},c),{table:function(f){var g=c.table(f),y=g.schema.primaryKey;return r(r({},g),{mutate:function(w){var A=Le.trans,R=A.table(f).hook,X=R.deleting,de=R.creating,xe=R.updating;switch(w.type){case"add":if(de.fire===be)break;return A._promise("readwrite",function(){return fe(w)},!0);case"put":if(de.fire===be&&xe.fire===be)break;return A._promise("readwrite",function(){return fe(w)},!0);case"delete":if(X.fire===be)break;return A._promise("readwrite",function(){return fe(w)},!0);case"deleteRange":if(X.fire===be)break;return A._promise("readwrite",function(){return(function oe(ge,me,ve){return g.query({trans:ge,values:!1,query:{index:y,range:me},limit:ve}).then(function(ue){var Ee=ue.result;return fe({type:"delete",keys:Ee,trans:ge}).then(function(Te){return 0<Te.numFailures?Promise.reject(Te.failures[0]):Ee.length<ve?{failures:[],numFailures:0,lastResult:void 0}:oe(ge,r(r({},me),{lower:Ee[Ee.length-1],lowerOpen:!0}),ve)})})})(w.trans,w.range,1e4)},!0)}return g.mutate(w);function fe(oe){var ge,me,ve,ue=Le.trans,Ee=oe.keys||Nc(y,oe);if(Ee)return(oe=oe.type==="add"||oe.type==="put"?r(r({},oe),{keys:Ee}):r({},oe)).type!=="delete"&&(oe.values=a([],oe.values)),oe.keys&&(oe.keys=a([],oe.keys)),ge=g,ve=Ee,((me=oe).type==="add"?Promise.resolve([]):ge.getMany({trans:me.trans,keys:ve,cache:"immutable"})).then(function(Te){var we=Ee.map(function(Ce,Re){var Ve,We,je,et=Te[Re],Qe={onerror:null,onsuccess:null};return oe.type==="delete"?X.fire.call(Qe,Ce,et,ue):oe.type==="add"||et===void 0?(Ve=de.fire.call(Qe,Ce,oe.values[Re],ue),Ce==null&&Ve!=null&&(oe.keys[Re]=Ce=Ve,y.outbound||O(oe.values[Re],y.keyPath,Ce))):(Ve=Oc(et,oe.values[Re]),(We=xe.fire.call(Qe,Ve,Ce,et,ue))&&(je=oe.values[Re],Object.keys(We).forEach(function(He){p(je,He)?je[He]=We[He]:O(je,He,We[He])}))),Qe});return g.mutate(oe).then(function(Ce){for(var Re=Ce.failures,Ve=Ce.results,We=Ce.numFailures,Ce=Ce.lastResult,je=0;je<Ee.length;++je){var et=(Ve||Ee)[je],Qe=we[je];et==null?Qe.onerror&&Qe.onerror(Re[je]):Qe.onsuccess&&Qe.onsuccess(oe.type==="put"&&Te[je]?oe.values[je]:et)}return{failures:Re,results:Ve,numFailures:We,lastResult:Ce}}).catch(function(Ce){return we.forEach(function(Re){return Re.onerror&&Re.onerror(Ce)}),Promise.reject(Ce)})});throw new Error("Keys missing")}}})}})}};function wf(c,f,g){try{if(!f||f.keys.length<c.length)return null;for(var y=[],w=0,A=0;w<f.keys.length&&A<c.length;++w)zt(f.keys[w],c[A])===0&&(y.push(g?j(f.values[w]):f.values[w]),++A);return y.length===c.length?y:null}catch{return null}}var Lm={stack:"dbcore",level:-1,create:function(c){return{table:function(f){var g=c.table(f);return r(r({},g),{getMany:function(y){var w;return y.cache?(w=wf(y.keys,y.trans._cache,y.cache==="clone"))?De.resolve(w):g.getMany(y).then(function(A){return y.trans._cache={keys:y.keys,values:y.cache==="clone"?j(A):A},A}):g.getMany(y)},mutate:function(y){return y.type!=="add"&&(y.trans._cache=null),g.mutate(y)}})}}}};function xf(c,f){return c.trans.mode==="readonly"&&!!c.subscr&&!c.trans.explicit&&c.trans.db._options.cache!=="disabled"&&!f.schema.primaryKey.outbound}function kf(c,f){switch(c){case"query":return f.values&&!f.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var jm={stack:"dbcore",level:0,name:"Observability",create:function(c){var f=c.schema.name,g=new Dn(c.MIN_KEY,c.MAX_KEY);return r(r({},c),{transaction:function(y,w,A){if(Le.subscr&&w!=="readonly")throw new Z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Le.querier));return c.transaction(y,w,A)},table:function(y){function w(Ee){var ue,Ee=Ee.query;return[ue=Ee.index,new Dn((ue=(Ee=Ee.range).lower)!=null?ue:c.MIN_KEY,(ue=Ee.upper)!=null?ue:c.MAX_KEY)]}var A=c.table(y),R=A.schema,X=R.primaryKey,de=R.indexes,xe=X.extractKey,fe=X.outbound,oe=X.autoIncrement&&de.filter(function(ve){return ve.compound&&ve.keyPath.includes(X.keyPath)}),ge=r(r({},A),{mutate:function(ve){function ue(rt){return rt="idb://".concat(f,"/").concat(y,"/").concat(rt),Re[rt]||(Re[rt]=new Dn)}var Ee,Te,we,Ce=ve.trans,Re=ve.mutatedParts||(ve.mutatedParts={}),Ve=ue(""),We=ue(":dels"),je=ve.type,Qe=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[Nc(X,ve).filter(function(rt){return rt}),ve.values]:[],et=Qe[0],Qe=Qe[1],He=ve.trans._cache;return l(et)?(Ve.addKeys(et),(je=je==="delete"||et.length===Qe.length?wf(et,He):null)||We.addKeys(et),(je||Qe)&&(Ee=ue,Te=je,we=Qe,R.indexes.forEach(function(rt){var qt=Ee(rt.name||"");function Ht(Mt){return Mt!=null?rt.extractKey(Mt):null}function gt(Mt){rt.multiEntry&&l(Mt)?Mt.forEach(function(dn){return qt.addKey(dn)}):qt.addKey(Mt)}(Te||we).forEach(function(Mt,vn){var fr=Te&&Ht(Te[vn]),vn=we&&Ht(we[vn]);zt(fr,vn)!==0&&(fr!=null&&gt(fr),vn!=null)&&gt(vn)})}))):et?(Qe={from:(He=et.lower)!=null?He:c.MIN_KEY,to:(je=et.upper)!=null?je:c.MAX_KEY},We.add(Qe),Ve.add(Qe)):(Ve.add(g),We.add(g),R.indexes.forEach(function(rt){return ue(rt.name).add(g)})),A.mutate(ve).then(function(rt){return!et||ve.type!=="add"&&ve.type!=="put"||(Ve.addKeys(rt.results),oe&&oe.forEach(function(qt){for(var Ht=ve.values.map(function(fr){return qt.extractKey(fr)}),gt=qt.keyPath.findIndex(function(fr){return fr===X.keyPath}),Mt=0,dn=rt.results.length;Mt<dn;++Mt)Ht[Mt][gt]=rt.results[Mt];ue(qt.name).addKeys(Ht)})),Ce.mutatedParts=Fo(Ce.mutatedParts||{},Re),rt})}}),me={get:function(ve){return[X,new Dn(ve.key)]},getMany:function(ve){return[X,new Dn().addKeys(ve.keys)]},count:w,query:w,openCursor:w};return i(me).forEach(function(ve){ge[ve]=function(ue){var Ee=Le.subscr,Te=!!Ee,we=xf(Le,A)&&kf(ve,ue)?ue.obsSet={}:Ee;if(Te){var Ce,Ee=function(Qe){return Qe="idb://".concat(f,"/").concat(y,"/").concat(Qe),we[Qe]||(we[Qe]=new Dn)},Re=Ee(""),Ve=Ee(":dels"),Te=me[ve](ue),We=Te[0],Te=Te[1];if((ve==="query"&&We.isPrimaryKey&&!ue.values?Ve:Ee(We.name||"")).add(Te),!We.isPrimaryKey){if(ve!=="count")return Ce=ve==="query"&&fe&&ue.values&&A.query(r(r({},ue),{values:!1})),A[ve].apply(this,arguments).then(function(Qe){if(ve==="query"){if(fe&&ue.values)return Ce.then(function(Ht){return Ht=Ht.result,Re.addKeys(Ht),Qe});var He=ue.values?Qe.result.map(xe):Qe.result;(ue.values?Re:Ve).addKeys(He)}else{var rt,qt;if(ve==="openCursor")return qt=ue.values,(rt=Qe)&&Object.create(rt,{key:{get:function(){return Ve.addKey(rt.primaryKey),rt.key}},primaryKey:{get:function(){var Ht=rt.primaryKey;return Ve.addKey(Ht),Ht}},value:{get:function(){return qt&&Re.addKey(rt.primaryKey),rt.value}}})}return Qe});Ve.add(g)}}return A[ve].apply(this,arguments)}}),ge}})}};function Sf(c,f,g){var y;return g.numFailures===0?f:f.type==="deleteRange"||(y=f.keys?f.keys.length:"values"in f&&f.values?f.values.length:1,g.numFailures===y)?null:(y=r({},f),l(y.keys)&&(y.keys=y.keys.filter(function(w,A){return!(A in g.failures)})),"values"in y&&l(y.values)&&(y.values=y.values.filter(function(w,A){return!(A in g.failures)})),y)}function Dc(c,f){return g=c,((y=f).lower===void 0||(y.lowerOpen?0<zt(g,y.lower):0<=zt(g,y.lower)))&&(g=c,(y=f).upper===void 0||(y.upperOpen?zt(g,y.upper)<0:zt(g,y.upper)<=0));var g,y}function Ef(c,f,g,y,w,A){var R,X,de,xe,fe,oe;return!g||g.length===0||(R=f.query.index,X=R.multiEntry,de=f.query.range,xe=y.schema.primaryKey.extractKey,fe=R.extractKey,oe=(R.lowLevelIndex||R).extractKey,(y=g.reduce(function(ge,me){var ve=ge,ue=[];if(me.type==="add"||me.type==="put")for(var Ee=new Dn,Te=me.values.length-1;0<=Te;--Te){var we,Ce=me.values[Te],Re=xe(Ce);!Ee.hasKey(Re)&&(we=fe(Ce),X&&l(we)?we.some(function(Qe){return Dc(Qe,de)}):Dc(we,de))&&(Ee.addKey(Re),ue.push(Ce))}switch(me.type){case"add":var Ve=new Dn().addKeys(f.values?ge.map(function(He){return xe(He)}):ge),ve=ge.concat(f.values?ue.filter(function(He){return He=xe(He),!Ve.hasKey(He)&&(Ve.addKey(He),!0)}):ue.map(function(He){return xe(He)}).filter(function(He){return!Ve.hasKey(He)&&(Ve.addKey(He),!0)}));break;case"put":var We=new Dn().addKeys(me.values.map(function(He){return xe(He)}));ve=ge.filter(function(He){return!We.hasKey(f.values?xe(He):He)}).concat(f.values?ue:ue.map(function(He){return xe(He)}));break;case"delete":var je=new Dn().addKeys(me.keys);ve=ge.filter(function(He){return!je.hasKey(f.values?xe(He):He)});break;case"deleteRange":var et=me.range;ve=ge.filter(function(He){return!Dc(xe(He),et)})}return ve},c))===c)?c:(y.sort(function(ge,me){return zt(oe(ge),oe(me))||zt(xe(ge),xe(me))}),f.limit&&f.limit<1/0&&(y.length>f.limit?y.length=f.limit:c.length===f.limit&&y.length<f.limit&&(w.dirty=!0)),A?Object.freeze(y):y)}function Af(c,f){return zt(c.lower,f.lower)===0&&zt(c.upper,f.upper)===0&&!!c.lowerOpen==!!f.lowerOpen&&!!c.upperOpen==!!f.upperOpen}function zm(c,f){return((g,y,w,A)=>{if(g===void 0)return y!==void 0?-1:0;if(y===void 0)return 1;if((g=zt(g,y))===0){if(w&&A)return 0;if(w)return 1;if(A)return-1}return g})(c.lower,f.lower,c.lowerOpen,f.lowerOpen)<=0&&0<=((g,y,w,A)=>{if(g===void 0)return y!==void 0?1:0;if(y===void 0)return-1;if((g=zt(g,y))===0){if(w&&A)return 0;if(w)return-1;if(A)return 1}return g})(c.upper,f.upper,c.upperOpen,f.upperOpen)}function qm(c,f,g,y){c.subscribers.add(g),y.addEventListener("abort",function(){var w,A;c.subscribers.delete(g),c.subscribers.size===0&&(w=c,A=f,setTimeout(function(){w.subscribers.size===0&&H(A,w)},3e3))})}var Bm={stack:"dbcore",level:0,name:"Cache",create:function(c){var f=c.schema.name;return r(r({},c),{transaction:function(g,y,w){var A,R,X=c.transaction(g,y,w);return y==="readwrite"&&(w=(A=new AbortController).signal,X.addEventListener("abort",(R=function(de){return function(){if(A.abort(),y==="readwrite"){for(var xe=new Set,fe=0,oe=g;fe<oe.length;fe++){var ge=oe[fe],me=Za["idb://".concat(f,"/").concat(ge)];if(me){var ve=c.table(ge),ue=me.optimisticOps.filter(function(rt){return rt.trans===X});if(X._explicit&&de&&X.mutatedParts)for(var Ee=0,Te=Object.values(me.queries.query);Ee<Te.length;Ee++)for(var we=0,Ce=(We=Te[Ee]).slice();we<Ce.length;we++)Tc((je=Ce[we]).obsSet,X.mutatedParts)&&(H(We,je),je.subscribers.forEach(function(rt){return xe.add(rt)}));else if(0<ue.length){me.optimisticOps=me.optimisticOps.filter(function(rt){return rt.trans!==X});for(var Re=0,Ve=Object.values(me.queries.query);Re<Ve.length;Re++)for(var We,je,et,Qe=0,He=(We=Ve[Re]).slice();Qe<He.length;Qe++)(je=He[Qe]).res!=null&&X.mutatedParts&&(de&&!je.dirty?(et=Object.isFrozen(je.res),et=Ef(je.res,je.req,ue,ve,je,et),je.dirty?(H(We,je),je.subscribers.forEach(function(rt){return xe.add(rt)})):et!==je.res&&(je.res=et,je.promise=De.resolve({result:et}))):(je.dirty&&H(We,je),je.subscribers.forEach(function(rt){return xe.add(rt)})))}}}xe.forEach(function(rt){return rt()})}}})(!1),{signal:w}),X.addEventListener("error",R(!1),{signal:w}),X.addEventListener("complete",R(!0),{signal:w})),X},table:function(g){var y=c.table(g),w=y.schema.primaryKey;return r(r({},y),{mutate:function(A){var R,X=Le.trans;return!w.outbound&&X.db._options.cache!=="disabled"&&!X.explicit&&X.idbtrans.mode==="readwrite"&&(R=Za["idb://".concat(f,"/").concat(g)])?(X=y.mutate(A),A.type!=="add"&&A.type!=="put"||!(50<=A.values.length||Nc(w,A).some(function(de){return de==null}))?(R.optimisticOps.push(A),A.mutatedParts&&Ko(A.mutatedParts),X.then(function(de){0<de.numFailures&&(H(R.optimisticOps,A),(de=Sf(0,A,de))&&R.optimisticOps.push(de),A.mutatedParts)&&Ko(A.mutatedParts)}),X.catch(function(){H(R.optimisticOps,A),A.mutatedParts&&Ko(A.mutatedParts)})):X.then(function(de){var xe=Sf(0,r(r({},A),{values:A.values.map(function(fe,oe){var ge;return de.failures[oe]?fe:(O(ge=(ge=w.keyPath)!=null&&ge.includes(".")?j(fe):r({},fe),w.keyPath,de.results[oe]),ge)})}),de);R.optimisticOps.push(xe),queueMicrotask(function(){return A.mutatedParts&&Ko(A.mutatedParts)})}),X):y.mutate(A)},query:function(A){var R,X,de,xe,fe,oe,ge;return xf(Le,y)&&kf("query",A)?(R=((de=Le.trans)==null?void 0:de.db._options.cache)==="immutable",X=(de=Le).requery,de=de.signal,oe=((me,ve,ue,Ee)=>{var Te=Za["idb://".concat(me,"/").concat(ve)];if(!Te)return[];if(!(me=Te.queries[ue]))return[null,!1,Te,null];var we=me[(Ee.query?Ee.query.index.name:null)||""];if(!we)return[null,!1,Te,null];switch(ue){case"query":var Ce=we.find(function(Re){return Re.req.limit===Ee.limit&&Re.req.values===Ee.values&&Af(Re.req.query.range,Ee.query.range)});return Ce?[Ce,!0,Te,we]:[we.find(function(Re){return("limit"in Re.req?Re.req.limit:1/0)>=Ee.limit&&(!Ee.values||Re.req.values)&&zm(Re.req.query.range,Ee.query.range)}),!1,Te,we];case"count":return Ce=we.find(function(Re){return Af(Re.req.query.range,Ee.query.range)}),[Ce,!!Ce,Te,we]}})(f,g,"query",A),ge=oe[0],xe=oe[2],fe=oe[3],ge&&oe[1]?ge.obsSet=A.obsSet:(oe=y.query(A).then(function(me){var ve=me.result;if(ge&&(ge.res=ve),R){for(var ue=0,Ee=ve.length;ue<Ee;++ue)Object.freeze(ve[ue]);Object.freeze(ve)}else me.result=j(ve);return me}).catch(function(me){return fe&&ge&&H(fe,ge),Promise.reject(me)}),ge={obsSet:A.obsSet,promise:oe,subscribers:new Set,type:"query",req:A,dirty:!1},fe?fe.push(ge):(fe=[ge],(xe=xe||(Za["idb://".concat(f,"/").concat(g)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[A.query.index.name||""]=fe)),qm(ge,fe,X,de),ge.promise.then(function(me){return{result:Ef(me.result,A,xe==null?void 0:xe.optimisticOps,y,ge,R)}})):y.query(A)}})}})}};function Go(c,f){return new Proxy(c,{get:function(g,y,w){return y==="db"?f:Reflect.get(g,y,w)}})}pn.prototype.version=function(c){if(isNaN(c)||c<.1)throw new Z.Type("Given version is not a positive number");if(c=Math.round(10*c)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,c);var f=this._versions,g=f.filter(function(y){return y._cfg.version===c})[0];return g||(g=new this.Version(c),f.push(g),f.sort(Im),g.stores({}),this._state.autoSchema=!1),g},pn.prototype._whenReady=function(c){var f=this;return this.idbdb&&(this._state.openComplete||Le.letThrough||this._vip)?c():new De(function(g,y){if(f._state.openComplete)return y(new Z.DatabaseClosed(f._state.dbOpenError));if(!f._state.isBeingOpened){if(!f._state.autoOpen)return void y(new Z.DatabaseClosed);f.open().catch(be)}f._state.dbReadyPromise.then(g,y)}).then(c)},pn.prototype.use=function(w){var f=w.stack,g=w.create,y=w.level,w=w.name,A=(w&&this.unuse({stack:f,name:w}),this._middlewares[f]||(this._middlewares[f]=[]));return A.push({stack:f,create:g,level:y??10,name:w}),A.sort(function(R,X){return R.level-X.level}),this},pn.prototype.unuse=function(c){var f=c.stack,g=c.name,y=c.create;return f&&this._middlewares[f]&&(this._middlewares[f]=this._middlewares[f].filter(function(w){return y?w.create!==y:!!g&&w.name!==g})),this},pn.prototype.open=function(){var c=this;return ot(dt,function(){return Nm(c)})},pn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var c=this._state,f=hn.indexOf(this);if(0<=f&&hn.splice(f,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}c.isBeingOpened||(c.dbReadyPromise=new De(function(g){c.dbReadyResolve=g}),c.openCanceller=new De(function(g,y){c.cancelOpen=y}))},pn.prototype.close=function(f){var f=(f===void 0?{disableAutoOpen:!0}:f).disableAutoOpen,g=this._state;f?(g.isBeingOpened&&g.cancelOpen(new Z.DatabaseClosed),this._close(),g.autoOpen=!1,g.dbOpenError=new Z.DatabaseClosed):(this._close(),g.autoOpen=this._options.autoOpen||g.isBeingOpened,g.openComplete=!1,g.dbOpenError=null)},pn.prototype.delete=function(c){var f=this,g=(c===void 0&&(c={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),y=this._state;return new De(function(w,A){function R(){f.close(c);var X=f._deps.indexedDB.deleteDatabase(f.name);X.onsuccess=_t(function(){var de,xe,fe;de=f._deps,xe=f.name,Sc(fe=de.indexedDB)||xe===Un||kc(fe,de.IDBKeyRange).delete(xe).catch(be),w()}),X.onerror=Fr(A),X.onblocked=f._fireOnBlocked}if(g)throw new Z.InvalidArgument("Invalid closeOptions argument to db.delete()");y.isBeingOpened?y.dbReadyPromise.then(R):R()})},pn.prototype.backendDB=function(){return this.idbdb},pn.prototype.isOpen=function(){return this.idbdb!==null},pn.prototype.hasBeenClosed=function(){var c=this._state.dbOpenError;return c&&c.name==="DatabaseClosed"},pn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pn.prototype,"tables",{get:function(){var c=this;return i(this._allTables).map(function(f){return c._allTables[f]})},enumerable:!1,configurable:!0}),pn.prototype.transaction=function(){var c=(function(f,g,y){var w=arguments.length;if(w<2)throw new Z.InvalidArgument("Too few arguments");for(var A=new Array(w-1);--w;)A[w-1]=arguments[w];return y=A.pop(),[f,ke(A),y]}).apply(this,arguments);return this._transaction.apply(this,c)},pn.prototype._transaction=function(c,f,g){var y,w,A=this,R=Le.trans,X=(R&&R.db===this&&c.indexOf("!")===-1||(R=null),c.indexOf("?")!==-1);c=c.replace("!","").replace("?","");try{if(w=f.map(function(xe){if(xe=xe instanceof A.Table?xe.name:xe,typeof xe!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return xe}),c=="r"||c===Br)y=Br;else{if(c!="rw"&&c!=Ya)throw new Z.InvalidArgument("Invalid transaction mode: "+c);y=Ya}if(R){if(R.mode===Br&&y===Ya){if(!X)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");R=null}R&&w.forEach(function(xe){if(R&&R.storeNames.indexOf(xe)===-1){if(!X)throw new Z.SubTransaction("Table "+xe+" not included in parent transaction.");R=null}}),X&&R&&!R.active&&(R=null)}}catch(xe){return R?R._promise(null,function(fe,oe){oe(xe)}):Ue(xe)}var de=(function xe(fe,oe,ge,me,ve){return De.resolve().then(function(){var we=Le.transless||Le,ue=fe._createTransaction(oe,ge,fe._dbSchema,me),we=(ue.explicit=!0,{trans:ue,transless:we});if(me)ue.idbtrans=me.idbtrans;else try{ue.create(),ue.idbtrans._explicit=!0,fe._state.PR1398_maxLoop=3}catch(Ce){return Ce.name===ye.InvalidState&&fe.isOpen()&&0<--fe._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),fe.close({disableAutoOpen:!1}),fe.open().then(function(){return xe(fe,oe,ge,null,ve)})):Ue(Ce)}var Ee,Te=te(ve),we=(Te&&Nn(),De.follow(function(){var Ce;(Ee=ve.call(ue,ue))&&(Te?(Ce=xr.bind(null,null),Ee.then(Ce,Ce)):typeof Ee.next=="function"&&typeof Ee.throw=="function"&&(Ee=Mc(Ee)))},we));return(Ee&&typeof Ee.then=="function"?De.resolve(Ee).then(function(Ce){return ue.active?Ce:Ue(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):we.then(function(){return Ee})).then(function(Ce){return me&&ue._resolve(),ue._completion.then(function(){return Ce})}).catch(function(Ce){return ue._reject(Ce),Ue(Ce)})})}).bind(null,this,y,w,R,g);return R?R._promise(y,de,"lock"):Le.trans?ot(Le.transless,function(){return A._whenReady(de)}):this._whenReady(de)},pn.prototype.table=function(c){if(p(this._allTables,c))return this._allTables[c];throw new Z.InvalidTable("Table ".concat(c," does not exist"))};var oa=pn;function pn(c,f){var g,y,w,A,R,X=this,de=(this._middlewares={},this.verno=0,pn.dependencies),de=(this._options=f=r({addons:pn.addons,autoOpen:!0,indexedDB:de.indexedDB,IDBKeyRange:de.IDBKeyRange,cache:"cloned"},f),this._deps={indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange},f.addons),xe=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:be,dbReadyPromise:null,cancelOpen:be,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:f.autoOpen}),fe=(xe.dbReadyPromise=new De(function(oe){xe.dbReadyResolve=oe}),xe.openCanceller=new De(function(oe,ge){xe.cancelOpen=ge}),this._state=xe,this.name=c,this.on=bi(this,"populate","blocked","versionchange","close",{ready:[Ne,be]}),this.once=function(oe,ge){var me=function(){for(var ve=[],ue=0;ue<arguments.length;ue++)ve[ue]=arguments[ue];X.on(oe).unsubscribe(me),ge.apply(X,ve)};return X.on(oe,me)},this.on.ready.subscribe=Y(this.on.ready.subscribe,function(oe){return function(ge,me){pn.vip(function(){var ve,ue=X._state;ue.openComplete?(ue.dbOpenError||De.resolve().then(ge),me&&oe(ge)):ue.onReadyBeingFired?(ue.onReadyBeingFired.push(ge),me&&oe(ge)):(oe(ge),ve=X,me||oe(function Ee(){ve.on.ready.unsubscribe(ge),ve.on.ready.unsubscribe(Ee)}))})}}),this.Collection=(g=this,wi(xm.prototype,function(Ee,ue){this.db=g;var me=yi,ve=null;if(ue)try{me=ue()}catch(we){ve=we}var ue=Ee._ctx,Ee=ue.table,Te=Ee.hook.reading.fire;this._ctx={table:Ee,index:ue.index,isPrimKey:!ue.index||Ee.schema.primKey.keyPath&&ue.index===Ee.schema.primKey.name,range:me,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ve,or:ue.or,valueMapper:Te!==Ie?Te:null}})),this.Table=(y=this,wi(of.prototype,function(oe,ge,me){this.db=y,this._tx=me,this.name=oe,this.schema=ge,this.hook=y._allTables[oe]?y._allTables[oe].hook:bi(null,{creating:[ct,be],reading:[Ye,Ie],updating:[Oe,be],deleting:[qe,be]})})),this.Transaction=(w=this,wi(Em.prototype,function(oe,ge,me,ve,ue){var Ee=this;oe!=="readonly"&&ge.forEach(function(Te){Te=(Te=me[Te])==null?void 0:Te.yProps,Te&&(ge=ge.concat(Te.map(function(we){return we.updatesTable})))}),this.db=w,this.mode=oe,this.storeNames=ge,this.schema=me,this.chromeTransactionDurability=ve,this.idbtrans=null,this.on=bi(this,"complete","error","abort"),this.parent=ue||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new De(function(Te,we){Ee._resolve=Te,Ee._reject=we}),this._completion.then(function(){Ee.active=!1,Ee.on.complete.fire()},function(Te){var we=Ee.active;return Ee.active=!1,Ee.on.error.fire(Te),Ee.parent?Ee.parent._reject(Te):we&&Ee.idbtrans&&Ee.idbtrans.abort(),Ue(Te)})})),this.Version=(A=this,wi(Om.prototype,function(oe){this.db=A,this._cfg={version:oe,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(R=this,wi(ff.prototype,function(oe,ge,me){if(this.db=R,this._ctx={table:oe,index:ge===":id"?null:ge,or:me},this._cmp=this._ascending=zt,this._descending=function(ve,ue){return zt(ue,ve)},this._max=function(ve,ue){return 0<zt(ve,ue)?ve:ue},this._min=function(ve,ue){return zt(ve,ue)<0?ve:ue},this._IDBKeyRange=R._deps.IDBKeyRange,!this._IDBKeyRange)throw new Z.MissingAPI})),this.on("versionchange",function(oe){0<oe.newVersion?console.warn("Another connection wants to upgrade database '".concat(X.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(X.name,"'. Closing db now to resume the delete request.")),X.close({disableAutoOpen:!1})}),this.on("blocked",function(oe){!oe.newVersion||oe.newVersion<oe.oldVersion?console.warn("Dexie.delete('".concat(X.name,"') was blocked")):console.warn("Upgrade '".concat(X.name,"' blocked by other connection holding version ").concat(oe.oldVersion/10))}),this._maxKey=Si(f.IDBKeyRange),this._createTransaction=function(oe,ge,me,ve){return new X.Transaction(oe,ge,me,X._options.chromeTransactionDurability,ve)},this._fireOnBlocked=function(oe){X.on("blocked").fire(oe),hn.filter(function(ge){return ge.name===X.name&&ge!==X&&!ge._state.vcFired}).map(function(ge){return ge.on("versionchange").fire(oe)})},this.use(Lm),this.use(Bm),this.use(jm),this.use(Dm),this.use(Rm),new Proxy(this,{get:function(oe,ge,me){var ve;return ge==="_vip"||(ge==="table"?function(ue){return Go(X.table(ue),fe)}:(ve=Reflect.get(oe,ge,me))instanceof of?Go(ve,fe):ge==="tables"?ve.map(function(ue){return Go(ue,fe)}):ge==="_createTransaction"?function(){return Go(ve.apply(this,arguments),fe)}:ve)}}));this.vip=fe,de.forEach(function(oe){return oe(X)})}var Uo,Ls=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Fm=(Rc.prototype.subscribe=function(c,f,g){return this._subscribe(c&&typeof c!="function"?c:{next:c,error:f,complete:g})},Rc.prototype[Ls]=function(){return this},Rc);function Rc(c){this._subscribe=c}try{Uo={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{Uo={indexedDB:null,IDBKeyRange:null}}function Tf(c){var f,g=!1,y=new Fm(function(w){var A=te(c),R,X=!1,de={},xe={},fe={get closed(){return X},unsubscribe:function(){X||(X=!0,R&&R.abort(),oe&&Aa.storagemutated.unsubscribe(me))}},oe=(w.start&&w.start(fe),!1),ge=function(){return Be(ve)},me=function(ue){Fo(de,ue),Tc(xe,de)&&ge()},ve=function(){var ue,Ee,Te;!X&&Uo.indexedDB&&(de={},ue={},R&&R.abort(),R=new AbortController,Te=(we=>{var Ce=it();try{A&&Nn();var Re=On(c,we);return Re=A?Re.finally(xr):Re}finally{Ce&&ut()}})(Ee={subscr:ue,signal:R.signal,requery:ge,querier:c,trans:null}),Promise.resolve(Te).then(function(we){g=!0,f=we,X||Ee.signal.aborted||(de={},(Ce=>{for(var Re in Ce)if(p(Ce,Re))return;return 1})(xe=ue)||oe||(Aa(ki,me),oe=!0),Be(function(){return!X&&w.next&&w.next(we)}))},function(we){g=!1,["DatabaseClosedError","AbortError"].includes(we==null?void 0:we.name)||X||Be(function(){X||w.error&&w.error(we)})}))};return setTimeout(ge,0),fe});return y.hasValue=function(){return g},y.getValue=function(){return f},y}var Qa=oa;function Lc(c){var f=Ta;try{Ta=!0,Aa.storagemutated.fire(c),Pc(c,!0)}finally{Ta=f}}h(Qa,r(r({},ae),{delete:function(c){return new Qa(c,{addons:[]}).delete()},exists:function(c){return new Qa(c,{addons:[]}).open().then(function(f){return f.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(c){try{return f=Qa.dependencies,g=f.indexedDB,f=f.IDBKeyRange,(Sc(g)?Promise.resolve(g.databases()).then(function(y){return y.map(function(w){return w.name}).filter(function(w){return w!==Un})}):kc(g,f).toCollection().primaryKeys()).then(c)}catch{return Ue(new Z.MissingAPI)}var f,g},defineClass:function(){return function(c){u(this,c)}},ignoreTransaction:function(c){return Le.trans?ot(Le.transless,c):c()},vip:Ec,async:function(c){return function(){try{var f=Mc(c.apply(this,arguments));return f&&typeof f.then=="function"?f:De.resolve(f)}catch(g){return Ue(g)}}},spawn:function(c,f,g){try{var y=Mc(c.apply(g,f||[]));return y&&typeof y.then=="function"?y:De.resolve(y)}catch(w){return Ue(w)}},currentTransaction:{get:function(){return Le.trans||null}},waitFor:function(c,f){return c=De.resolve(typeof c=="function"?Qa.ignoreTransaction(c):c).timeout(f||6e4),Le.trans?Le.trans.waitFor(c):c},Promise:De,debug:{get:function(){return Fe},set:function(c){Ke(c)}},derive:k,extend:u,props:h,override:Y,Events:bi,on:Aa,liveQuery:Tf,extendObservabilitySet:Fo,getByKeyPath:K,setByKeyPath:O,delByKeyPath:function(c,f){typeof f=="string"?O(c,f,void 0):"length"in f&&[].map.call(f,function(g){O(c,g,void 0)})},shallowClone:J,deepClone:j,getObjectDiff:Oc,cmp:zt,asap:V,minKey:-1/0,addons:[],connections:hn,errnames:ye,dependencies:Uo,cache:Za,semVer:"4.3.0",version:"4.3.0".split(".").map(function(c){return parseInt(c)}).reduce(function(c,f,g){return c+f/Math.pow(10,2*g)})})),Qa.maxKey=Si(Qa.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Aa(ki,function(c){Ta||(c=new CustomEvent(gc,{detail:c}),Ta=!0,dispatchEvent(c),Ta=!1)}),addEventListener(gc,function(c){c=c.detail,Ta||Lc(c)}));var js,Ta=!1,Cf=function(){};return typeof BroadcastChannel<"u"&&((Cf=function(){(js=new BroadcastChannel(gc)).onmessage=function(c){return c.data&&Lc(c.data)}})(),typeof js.unref=="function"&&js.unref(),Aa(ki,function(c){Ta||js.postMessage(c)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(c){if(!oa.disableBfCache&&c.persisted){Fe&&console.debug("Dexie: handling persisted pagehide"),js!=null&&js.close();for(var f=0,g=hn;f<g.length;f++)g[f].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(c){!oa.disableBfCache&&c.persisted&&(Fe&&console.debug("Dexie: handling persisted pageshow"),Cf(),Lc({all:new Dn(-1/0,[[]])}))})),De.rejectionMapper=function(c,f){return!c||c instanceof G||c instanceof TypeError||c instanceof SyntaxError||!c.name||!he[c.name]?c:(f=new he[c.name](f||c.message,c),"stack"in c&&x(f,"stack",{get:function(){return this.inner.stack}}),f)},Ke(Fe),r(oa,Object.freeze({__proto__:null,Dexie:oa,Entity:tf,PropModification:_i,RangeSet:Dn,add:function(c){return new _i({add:c})},cmp:zt,default:oa,liveQuery:Tf,mergeRanges:Ti,rangesOverlap:mf,remove:function(c){return new _i({remove:c})},replacePrefix:function(c,f){return new _i({replacePrefix:[c,f]})}}),{default:oa}),oa})})(dl)),dl.exports}var D_=N_();const Tu=M_(D_),Vf=Symbol.for("Dexie"),Rn=globalThis[Vf]||(globalThis[Vf]=Tu);if(Tu.semVer!==Rn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Tu.semVer} and ${Rn.semVer}`);const{liveQuery:P3,mergeRanges:M3,rangesOverlap:O3,RangeSet:N3,cmp:D3,Entity:R3,PropModification:L3,replacePrefix:j3,add:z3,remove:q3,DexieYProvider:B3}=Rn,lt=new Rn("me-ai-store");lt.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});lt.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});lt.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});lt.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});lt.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});lt.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function yd(t,e){return`${t}:${e}`}const R_=Object.freeze(Object.defineProperty({__proto__:null,db:lt,makeItemId:yd},Symbol.toStringTag,{value:"Module"}));async function Qr(t,e=null){try{const n=await lt.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function ii(t,e){try{await lt.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function _d(t){try{await lt.settings.delete(t)}catch{}}async function L_(t){const e=await lt.settings.bulkGet(t);return Object.fromEntries(t.map((n,r)=>{var a;return[n,((a=e[r])==null?void 0:a.value)??null]}))}const Sa=Object.freeze(Object.defineProperty({__proto__:null,getSetting:Qr,getSettings:L_,removeSetting:_d,setSetting:ii},Symbol.toStringTag,{value:"Module"})),ea=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function bd(t){return ea.find(e=>e.id===t)}const j_=Object.freeze(Object.defineProperty({__proto__:null,MODELS:ea,getModelInfo:bd},Symbol.toStringTag,{value:"Module"})),ta=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function _p(){return ta.filter(t=>t.recommended)}function wd(t){return ta.find(e=>e.name===t||e.name.startsWith(t+":"))}const z_=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:ta,getOllamaModelInfo:wd,getRecommendedOllamaModels:_p},Symbol.toStringTag,{value:"Module"})),La=[{id:"gpt-4.5-preview",name:"gpt-4.5-preview",displayName:"GPT-4.5 Preview",provider:"openai",description:"OpenAI's latest frontier model",contextWindow:128e3,maxEmailTokens:16384,recommendedForEmailProcessing:!0},{id:"o3-mini",name:"o3-mini",displayName:"o3-mini",provider:"openai",description:"Fast reasoning model",contextWindow:2e5,maxEmailTokens:32e3,recommendedForEmailProcessing:!0},{id:"claude-3-7-sonnet-latest",name:"claude-3-7-sonnet-latest",displayName:"Claude 3.7 Sonnet",provider:"anthropic",description:"Anthropic's most intelligent model",contextWindow:2e5,maxEmailTokens:32e3,recommendedForEmailProcessing:!0},{id:"claude-3-5-haiku-latest",name:"claude-3-5-haiku-latest",displayName:"Claude 3.5 Haiku",provider:"anthropic",description:"Fastest and most compact model",contextWindow:2e5,maxEmailTokens:32e3,recommendedForEmailProcessing:!0},{id:"gemini-3.1-pro-preview",name:"gemini-3.1-pro-preview",displayName:"Gemini 3.1 Pro",provider:"google",description:"Google's latest flagship model",contextWindow:1048576,maxEmailTokens:65536,recommendedForEmailProcessing:!0},{id:"gemini-3-flash-preview",name:"gemini-3-flash-preview",displayName:"Gemini 3 Flash",provider:"google",description:"Fast and lightweight model",contextWindow:1048576,maxEmailTokens:65536,recommendedForEmailProcessing:!0},{id:"grok-3-latest",name:"grok-3-latest",displayName:"Grok 3",provider:"xai",description:"xAI's latest frontier model",contextWindow:128e3,maxEmailTokens:16384,recommendedForEmailProcessing:!0},{id:"grok-2-latest",name:"grok-2-latest",displayName:"Grok 2",provider:"xai",description:"xAI's previous model",contextWindow:128e3,maxEmailTokens:16384,recommendedForEmailProcessing:!0}];function bp(t){return La.find(e=>e.id===t)||null}let Zn=null,pa="idle",fl=null,$a=new Set;function Xo(){return Zn||(Zn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Zn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(pa="loading"),e.status==="ready"&&(pa="ready"),e.status==="start"&&(pa="generating"),(e.status==="complete"||e.status==="error")&&(pa=fl?"ready":"idle");for(const n of $a)try{n(e)}catch{}})),Zn}function Gc(){return{check(){Xo().postMessage({type:"check"})},loadModel(t){fl=t,pa="loading",Xo().postMessage({type:"load",modelId:t})},generate(t,e){Xo().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,u=0;const d=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{$a.delete(d)};$a.add(d),Xo().postMessage({type:"generate",data:t,options:e})})},interrupt(){Zn==null||Zn.postMessage({type:"interrupt"})},reset(){Zn==null||Zn.postMessage({type:"reset"})},onMessage(t){return $a.add(t),()=>$a.delete(t)},offMessage(t){$a.delete(t)},get status(){return pa},get isReady(){return pa==="ready"},get isGenerating(){return pa==="generating"},get modelId(){return fl},terminate(){Zn==null||Zn.terminate(),Zn=null,pa="idle",fl=null,$a.clear()}}}const q_="modulepreload",B_=function(t){return"/me-ai/"+t},Wf={},Ln=function(e,n,r){let a=Promise.resolve();if(n&&n.length>0){let i=function(d){return Promise.all(d.map(v=>Promise.resolve(v).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=i(n.map(d=>{if(d=B_(d),d in Wf)return;Wf[d]=!0;const v=d.endsWith(".css"),p=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const h=document.createElement("link");if(h.rel=v?"stylesheet":q_,v||(h.as="script"),h.crossOrigin="",h.href=d,u&&h.setAttribute("nonce",u),document.head.appendChild(h),v)return new Promise((m,x)=>{h.addEventListener("load",m),h.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},Yf="http://localhost:11434",F_="https://me-ai.metaelon.space";function wp(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?Yf:F_}catch{return Yf}}function xo(){return wp()}async function K_(){const{getSetting:t}=await Ln(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Sa);return{getSetting:e}},void 0);return await t("ollamaUrl")||wp()}async function H_(t){const{setSetting:e}=await Ln(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Sa);return{setSetting:n}},void 0);await e("ollamaUrl",t)}async function Cu(t=xo()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function G_(t=xo()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function U_(t,e,{temperature:n=.7,maxTokens:r=4096,keepAlive:a}={},s=()=>{},i=xo()){var x;const l={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:r}};a!==void 0?l.keep_alive=a:l.keep_alive="10m";const u=new AbortController,d=setTimeout(()=>u.abort(),3e5),v=await fetch(`${i}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),signal:u.signal});if(clearTimeout(d),!v.ok){const k=await v.text();throw new Error(`Ollama API error: ${k}`)}const p=v.body.getReader(),h=new TextDecoder;let m="";try{for(;;){const{done:k,value:E}=await p.read();if(k)break;const B=h.decode(E).split(`
`).filter(Boolean);for(const Y of B)try{const S=JSON.parse(Y);if((x=S.message)!=null&&x.content&&(m+=S.message.content,s({content:S.message.content,done:!1,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration})),S.done){s({content:"",done:!0,total_duration:S.total_duration,eval_count:S.eval_count,eval_duration:S.eval_duration});break}}catch{}}}finally{p.releaseLock()}return m}let ar="idle",zs=null,es=new Set;function Sr(t){for(const e of es)try{e(t)}catch{}}function V_(){return{async check(){ar="loading",Sr({status:"loading",data:"Testing Ollama connection..."});const t=await Cu();t.connected?(ar="idle",Sr({status:"ready",data:{type:"ollama",version:t.version,url:xo()}})):(ar="idle",Sr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){zs=t,ar="loading",Sr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Cu();if(!e.connected){ar="idle",zs=null,Sr({status:"error",data:`Ollama not available: ${e.error}`});return}ar="ready",Sr({status:"ready"})},async generate(t,e={}){if(!zs){Sr({status:"error",data:"No Ollama model selected"});return}ar="generating",Sr({status:"start",inputTokens:0});let n=0,r=performance.now();try{await U_(zs,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},a=>{if(a.content){n++;const s=performance.now()-r,i=s>0?n/s*1e3:0;Sr({status:"update",output:a.content,tps:Math.round(i*10)/10,numTokens:n})}a.done&&(ar="ready",Sr({status:"complete",tps:a.eval_duration?Math.round(a.eval_count/(a.eval_duration/1e9)*10)/10:null,numTokens:a.eval_count||n}))})}catch(a){ar="ready",Sr({status:"error",data:a.message})}},generateFull(t,e,n){return new Promise((r,a)=>{let s="",i=null,l=0,u=0;const d=p=>{switch(p.status){case"start":u=p.inputTokens||0;break;case"update":if(s+=p.output,i=p.tps??i,l=p.numTokens??l,n)try{n({tps:i,numTokens:l,text:s})}catch{}break;case"complete":v(),r({text:s,tps:i,numTokens:l,inputTokens:u});break;case"error":v(),a(new Error(p.data));break}},v=()=>{es.delete(d)};es.add(d),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return es.add(t),()=>es.delete(t)},offMessage(t){es.delete(t)},get status(){return ar},get isReady(){return ar==="ready"},get isGenerating(){return ar==="generating"},get modelId(){return zs},get backend(){return"ollama"},terminate(){ar="idle",zs=null,es.clear()}}}async function xp(t){return await Qr(`${t}ApiKey`)}async function kp(t,e){if(!e)return{connected:!1,error:"API key is required"};try{let n,r;if(t==="openai"||t==="xai"){n=t==="openai"?"https://api.openai.com/v1/models":"https://api.x.ai/v1/models",r={Authorization:`Bearer ${e}`};const a=await fetch(n,{method:"GET",headers:r,signal:AbortSignal.timeout(5e3)});if(!a.ok){const s=await a.text();return{connected:!1,error:`HTTP ${a.status}: ${s}`}}return{connected:!0}}else if(t==="anthropic"){n="https://api.anthropic.com/v1/messages",r={"x-api-key":e,"anthropic-version":"2023-06-01","anthropic-dangerously-allow-browser":"true","content-type":"application/json"};const a=JSON.stringify({model:"claude-3-5-haiku-latest",max_tokens:1,messages:[{role:"user",content:"test"}]}),s=await fetch(n,{method:"POST",headers:r,body:a,signal:AbortSignal.timeout(5e3)});if(!s.ok){const i=await s.text();if(s.status===401||s.status===403)return{connected:!1,error:`HTTP ${s.status}: ${i}`};s.status}return{connected:!0}}else if(t==="google"){n=`https://generativelanguage.googleapis.com/v1beta/models?key=${e}`;const a=await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)});if(!a.ok){const s=await a.text();return{connected:!1,error:`HTTP ${a.status}: ${s}`}}return{connected:!0}}return{connected:!1,error:"Unknown provider"}}catch(n){return{connected:!1,error:n.message}}}async function Sp(t,e,n,{temperature:r=.7,maxTokens:a=4096,signal:s}={},i=()=>{}){var D,B,Y,S,V,K,O,J,ie,ke,F;const l=await xp(t);if(!l)throw new Error(`No API key configured for ${t}. Please check your settings.`);let u,d,v;if(t==="openai"||t==="xai"){u=t==="openai"?"https://api.openai.com/v1/chat/completions":"https://api.x.ai/v1/chat/completions",d={"Content-Type":"application/json",Authorization:`Bearer ${l}`};const I=n.find(N=>N.role==="system"),j=n.filter(N=>N.role!=="system"),C=e.startsWith("o1")||e.startsWith("o3");v=JSON.stringify({model:e,messages:I?[I,...j]:j,temperature:C?1:r,max_completion_tokens:a,stream:!0})}else if(t==="anthropic"){u="https://api.anthropic.com/v1/messages",d={"x-api-key":l,"anthropic-version":"2023-06-01","anthropic-dangerously-allow-browser":"true","content-type":"application/json"};const I=n.find(C=>C.role==="system"),j=n.filter(C=>C.role!=="system");v=JSON.stringify({model:e,system:I?I.content:void 0,messages:j,temperature:r,max_tokens:a,stream:!0})}else if(t==="google"){u=`https://generativelanguage.googleapis.com/v1beta/models/${e}:streamGenerateContent?key=${l}`,d={"Content-Type":"application/json"};const I=n.find(M=>M.role==="system"),N={contents:n.filter(M=>M.role!=="system").map(M=>({role:M.role==="assistant"?"model":"user",parts:[{text:M.content}]})),generationConfig:{temperature:r,maxOutputTokens:a}};I&&(N.systemInstruction={parts:[{text:I.content}]}),v=JSON.stringify(N)}const p=await fetch(u,{method:"POST",headers:d,body:v,signal:s});if(!p.ok){const I=await p.text();throw new Error(`${t} API error: ${I}`)}const h=p.body.getReader(),m=new TextDecoder("utf-8");let x=0,k=0,E="";try{for(;;){const{done:I,value:j}=await h.read();if(I)break;const C=m.decode(j,{stream:!0});E+=C;const N=E.split(`
`);E=N.pop()||"";for(const M of N){const $=M.trim();if(!$||!$.startsWith("data:"))continue;const H=$.slice(5).trim();if(H==="[DONE]")break;try{const L=JSON.parse(H);if(t==="openai"||t==="xai"){const q=(Y=(B=(D=L.choices)==null?void 0:D[0])==null?void 0:B.delta)==null?void 0:Y.content;q&&(k++,i({content:q,done:!1})),L.usage&&(x=L.usage.prompt_tokens||0,k=L.usage.completion_tokens||k)}else if(t==="anthropic")L.type==="message_start"?x=((V=(S=L.message)==null?void 0:S.usage)==null?void 0:V.input_tokens)||0:L.type==="content_block_delta"&&((K=L.delta)!=null&&K.text)?(k++,i({content:L.delta.text,done:!1})):L.type==="message_delta"&&L.usage&&(k=L.usage.output_tokens||k);else if(t==="google"){const q=(F=(ke=(ie=(J=(O=L.candidates)==null?void 0:O[0])==null?void 0:J.content)==null?void 0:ie.parts)==null?void 0:ke[0])==null?void 0:F.text;q&&(k++,i({content:q,done:!1})),L.usageMetadata&&(x=L.usageMetadata.promptTokenCount||x,k=L.usageMetadata.candidatesTokenCount||k)}}catch{}}}i({content:"",done:!0,inputTokens:x,outputTokens:k})}finally{h.releaseLock()}}const Xf=Object.freeze(Object.defineProperty({__proto__:null,getApiKey:xp,streamApiChat:Sp,testApiConnection:kp},Symbol.toStringTag,{value:"Module"}));let zn="idle",qs=null,Pi=null,ts=new Set,Er=null;function sr(t){for(const e of ts)try{e(t)}catch{}}function W_(t){return{async check(){zn="loading",Pi=t,sr({status:"loading",data:`Checking ${t} connection...`});const{getApiKey:e}=await Ln(async()=>{const{getApiKey:a}=await Promise.resolve().then(()=>Xf);return{getApiKey:a}},void 0),n=await e(t);if(!n){zn="idle",sr({status:"error",data:`${t} API key not found. Please configure it in settings.`});return}const r=await kp(t,n);r.connected?(zn="idle",sr({status:"ready",data:{type:"api",provider:t}})):(zn="idle",sr({status:"error",data:`${t} connection failed: ${r.error}`}))},async loadModel(e){qs=e,Pi=t,zn="loading",sr({status:"loading",data:`Connecting to ${t} model: ${e}...`});const{getApiKey:n}=await Ln(async()=>{const{getApiKey:a}=await Promise.resolve().then(()=>Xf);return{getApiKey:a}},void 0);if(!await n(t)){zn="idle",qs=null,sr({status:"error",data:`${t} API key not configured.`});return}zn="ready",sr({status:"ready"})},async generate(e,n={}){if(!qs||!Pi){sr({status:"error",data:"No model or provider selected"});return}zn="generating",sr({status:"start",inputTokens:0});let r=0,a=performance.now();Er=new AbortController;try{await Sp(Pi,qs,e,{...n,signal:Er.signal},s=>{if(!Er.signal.aborted)if(s.done){zn="ready";const i=(performance.now()-a)/1e3,l=i>0?r/i:null;sr({status:"complete",tps:l!==null?Math.round(l*10)/10:null,numTokens:s.outputTokens||r,inputTokens:s.inputTokens||0})}else{r++;const i=performance.now()-a,l=i>0?r/i*1e3:0;sr({status:"update",output:s.content,tps:Math.round(l*10)/10,numTokens:r})}})}catch(s){Er.signal.aborted?(zn="ready",sr({status:"complete",tps:null,numTokens:r})):(zn="ready",sr({status:"error",data:s.message}))}finally{Er=null}},generateFull(e,n,r){return new Promise((a,s)=>{let i="",l=null,u=0,d=0;const v=h=>{switch(h.status){case"start":d=h.inputTokens||0;break;case"update":if(i+=h.output,l=h.tps??l,u=h.numTokens??u,r)try{r({tps:l,numTokens:u,text:i})}catch{}break;case"complete":p(),a({text:i,tps:l,numTokens:u,inputTokens:d});break;case"error":p(),s(new Error(h.data));break}},p=()=>{ts.delete(v)};ts.add(v),this.generate(e,n)})},interrupt(){Er&&Er.abort()},reset(){Er&&Er.abort()},onMessage(e){return ts.add(e),()=>ts.delete(e)},offMessage(e){ts.delete(e)},get status(){return zn},get isReady(){return zn==="ready"},get isGenerating(){return zn==="generating"},get modelId(){return qs},get backend(){return Pi},terminate(){zn="idle",qs=null,Er&&Er.abort(),ts.clear()}}}let Ia=null,Tt=null,Uc=new Set;function Y_(t){if(t.startsWith("onnx-community/")||t.startsWith("microsoft/"))return"webgpu";const e=bp(t);return e?e.provider:"ollama"}function Ep(){return{loadModel(t){const e=Y_(t);if(Ia!==e){Tt&&Tt.terminate(),Ia=e,e==="webgpu"?Tt=Gc():e==="ollama"?Tt=V_():Tt=W_(e);for(const n of Uc)Tt.onMessage(n)}Tt.loadModel(t)},check(){Tt||(Tt=Gc(),Ia="webgpu"),Tt.check()},generate(t,e){if(!Tt)throw new Error("No engine loaded. Call loadModel() first.");return Tt.generate(t,e)},generateFull(t,e,n){return Tt?Tt.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){Tt==null||Tt.interrupt()},reset(){Tt==null||Tt.reset()},onMessage(t){return Tt||(Tt=Gc(),Ia="webgpu"),Uc.add(t),Tt.onMessage(t)},offMessage(t){Uc.delete(t),Tt==null||Tt.offMessage(t)},get status(){return(Tt==null?void 0:Tt.status)||"idle"},get isReady(){return(Tt==null?void 0:Tt.isReady)||!1},get isGenerating(){return(Tt==null?void 0:Tt.isGenerating)||!1},get modelId(){return(Tt==null?void 0:Tt.modelId)||null},get backend(){return Ia},getModelInfo(){const t=this.modelId;return t?Ia==="webgpu"?bd(t):Ia==="ollama"?wd(t):bp(t):null},terminate(){Tt==null||Tt.terminate(),Tt=null,Ia=null}}}function Iu(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,r)).toFixed(1)+" "+n[r]}function Vc(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e)),a=t/Math.pow(e,r),s=r>=2?2:r>=1?1:0;return a.toFixed(s)+" "+n[r]}function X_(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Z_(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Ql(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const Q_="https://gmail.googleapis.com/gmail/v1/users/me";class xd extends Error{constructor(e,n,r){super(e),this.name="GmailApiError",this.status=n,this.code=r||null}}function J_(t){return{Authorization:`Bearer ${t}`}}async function Jl(t,e){var r,a,s,i;const n=await fetch(`${Q_}${e}`,{headers:J_(t)});if(!n.ok){const l=await n.json().catch(()=>({})),u=((r=l.error)==null?void 0:r.message)||`Gmail API error: ${n.status}`,d=((i=(s=(a=l.error)==null?void 0:a.errors)==null?void 0:s[0])==null?void 0:i.reason)||void 0;throw new xd(u,n.status,d)}return n.json()}function Ap(t){return Jl(t,"/profile")}function Tp(t,{maxResults:e=20,pageToken:n,q:r}={}){const a=new URLSearchParams;return a.set("maxResults",String(e)),n&&a.set("pageToken",n),r&&a.set("q",r),Jl(t,`/messages?${a}`)}function Cp(t,e,n="full"){return Jl(t,`/messages/${e}?format=${n}`)}function $_(t,{startHistoryId:e,pageToken:n,maxResults:r=500}={}){const a=new URLSearchParams;return a.set("startHistoryId",e),a.set("maxResults",String(r)),a.append("historyTypes","messageAdded"),a.append("historyTypes","messageDeleted"),n&&a.set("pageToken",n),Jl(t,`/history?${a}`)}function Pa(t,e){var s;const n=((s=t==null?void 0:t.payload)==null?void 0:s.headers)||[],r=e.toLowerCase(),a=n.find(i=>i.name.toLowerCase()===r);return(a==null?void 0:a.value)||""}function Wi(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const r=atob(e),a=Uint8Array.from(r,s=>s.charCodeAt(0));return new TextDecoder().decode(a)}function eb(t){var s,i,l;const e=t==null?void 0:t.payload;if(!e)return"";if((s=e.body)!=null&&s.data)return Wi(e.body.data);const n=e.parts||[],r=kl(n,"text/plain");if((i=r==null?void 0:r.body)!=null&&i.data)return Wi(r.body.data);const a=kl(n,"text/html");if((l=a==null?void 0:a.body)!=null&&l.data){const u=Wi(a.body.data);return nb(u)}return"(no body)"}function tb(t){var a,s;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((a=e.body)!=null&&a.data))return Wi(e.body.data);const n=e.parts||[],r=kl(n,"text/html");return(s=r==null?void 0:r.body)!=null&&s.data?Wi(r.body.data):null}function kl(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const r=kl(n.parts,e);if(r)return r}}return null}function nb(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function kd(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function Ip(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function Pp(t){return Ip(t).charAt(0).toUpperCase()}function rb(t){try{const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${a}`}catch{return"email"}}function ab(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function Mp(t,e){return`${rb(t.date)}_${ab(t.subject)}.${e}`}function Op(t){const e={};for(const r of t){const a=r.action||"UNKNOWN";e[a]||(e[a]=[]),e[a].push(r)}for(const r of Object.keys(e))e[r].sort((a,s)=>(s.date||0)-(a.date||0));const n=Object.keys(e).sort((r,a)=>e[a].length-e[r].length);return{groups:e,order:n}}async function sb(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:r,newest:a}=await Np();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`Date range: ${s} to ${i}.`)}return n.join(" ")}async function ib(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:r,newest:a}=await Np();if(r&&a){const s=new Date(r.date).toLocaleDateString(),i=new Date(a.date).toLocaleDateString();n.push(`- **Date range:** ${s} â ${i}`)}return n.join(`
`)}async function ob(t=10){const e=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(Dp).join(`

---

`)}async function lb(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),a=(await lt.items.where("sourceType").equals("gmail").toArray()).map(s=>{var l,u,d,v,p;let i=0;return(l=s.subject)!=null&&l.toLowerCase().includes(n)&&(i+=3),(u=s.from)!=null&&u.toLowerCase().includes(n)&&(i+=2),(d=s.to)!=null&&d.toLowerCase().includes(n)&&(i+=2),(v=s.snippet)!=null&&v.toLowerCase().includes(n)&&(i+=1),(p=s.body)!=null&&p.toLowerCase().includes(n)&&(i+=1),{item:s,score:i}}).filter(({score:s})=>s>0).sort((s,i)=>i.score-s.score).slice(0,e);return a.length===0?`No results found for "${t}".`:a.map(({item:s})=>Dp(s)).join(`

---

`)}async function Zf(){const t=await lt.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=Op(t);return{groups:e,order:n,total:t.length}}async function cb({query:t,limit:e=50,offset:n=0}={}){if(t){const s=t.toLowerCase(),i=await lt.items.where("sourceType").equals("gmail").filter(l=>{var u,d,v,p;return((u=l.subject)==null?void 0:u.toLowerCase().includes(s))||((d=l.from)==null?void 0:d.toLowerCase().includes(s))||((v=l.to)==null?void 0:v.toLowerCase().includes(s))||((p=l.snippet)==null?void 0:p.toLowerCase().includes(s))}).toArray();return i.sort((l,u)=>(u.date||0)-(l.date||0)),{items:i.slice(n,n+e),total:i.length}}const r=await lt.items.where("sourceType").equals("gmail").count();return{items:await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().offset(n).limit(e).toArray(),total:r}}async function Np(){const t=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).first(),e=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).last();return{oldest:t,newest:e}}function Dp(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=Z_(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function ub(){const t=await sb();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function db(t){const e=[],n=await ib();if(e.push(n),t){const r=await lb(t,5);e.push("","## Relevant Emails",r)}else{const r=await ob(5);e.push("","## Recent Emails",r)}return e.join(`
`)}const nr={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},Sd="INFO",Rp="me-ai-events",Lp="me-ai-event-groups";async function gi(){const{getSetting:t}=await Ln(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Sa);return{getSetting:e}},void 0);return await t(Rp)||{}}async function $l(t){const{setSetting:e}=await Ln(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Sa);return{setSetting:n}},void 0);await e(Rp,t)}async function ec(){const{getSetting:t}=await Ln(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Sa);return{getSetting:e}},void 0);return await t(Lp)||{}}async function jp(t){const{setSetting:e}=await Ln(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Sa);return{setSetting:n}},void 0);await e(Lp,t)}async function fb(){try{const{db:t}=await Ln(async()=>{const{db:r}=await Promise.resolve().then(()=>R_);return{db:r}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(r=>r.action).filter(Boolean))].sort()}catch{return[]}}async function vb(){const t=await gi(),e=await fb();return[...new Set([...Object.keys(t),...e])].sort()}async function Ji(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await ec())[e]||Sd}async function hb(t,e){const n=t.toUpperCase();if(!nr[e])throw new Error(`Unknown group: ${e}`);const r=await ec();r[n]=e,await jp(r)}async function pb(){return ec()}async function zp(t){const e=await Ji(t),n=nr[e]||nr[Sd];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function jr(t){var r;const e=((r=t==null?void 0:t.toUpperCase)==null?void 0:r.call(t))||"";return(await gi())[e]||[]}const Wc=jr;async function gb(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await gi();e in n||(n[e]=[],await $l(n))}async function mb(t,e,n){const r=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!r)return;const a=await gi(),s=await ec();if(!(r in s)){const i=nr[e]?e:Sd;s[r]=i,await jp(s)}if(!(r in a)){const{pluginRegistry:i}=await Ln(async()=>{const{pluginRegistry:v}=await Promise.resolve().then(()=>Ob);return{pluginRegistry:v}},void 0),l=i.getAvailableActions("gmail"),u=Object.fromEntries(l.map(v=>[v.actionId,v])),d=(n||[]).filter(v=>u[v]).map(v=>({id:v,pluginId:"gmail",commandId:v,name:u[v].name,description:u[v].description}));a[r]=d,await $l(a)}}async function yb(t){const e=t.toUpperCase(),n=await gi();delete n[e],await $l(n)}async function Ed(t,e){const n=t.toUpperCase(),r=await gi();r[n]=e,await $l(r)}async function _b(t,e){const n=await jr(t);await Ed(t,[...n,e])}const Qf=_b;async function bb(t,e){const n=await jr(t);await Ed(t,n.filter(r=>r.id!==e))}const wb=bb;async function xb(t,e,n){const r=await jr(t);await Ed(t,r.map(a=>a.id===e?{...a,...n}:a))}const kb=xb;async function Sb(t,e){var a;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((a=e.body)==null?void 0:a.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},r=await jr(t.action);return{event:n,commands:r}}async function Eb(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:r,commands:a}=await Sb(n.classification,n.email);return{event:r,commands:a}})),content:""}}async function Ab(t){const e=await Promise.all(t.order.map(async r=>{const a=t.groups[r]||[],s=await jr(r),i=await Ji(r),l=a.map(u=>({emailId:u.emailId,subject:u.subject||"(no subject)",from:u.from||"",date:u.date,summary:u.summary||"",reason:u.reason||"",tags:u.tags||[],status:u.status||"pending"}));return{eventType:r,group:i,emails:l,commands:s}})),n=e.reduce((r,a)=>r+a.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class Tb{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var a,s,i;const r=this.handlers.get(e);if(!r)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(a=n.onProgress)==null||a.call(n,{phase:"executing",actionId:e,actionName:r.name});const l=await r.execute(n);return(s=n.onProgress)==null||s.call(n,{phase:"completed",actionId:e,actionName:r.name,result:l}),l}catch(l){const u={success:!1,error:l,message:l.message||"Unknown error"};return(i=n.onProgress)==null||i.call(n,{phase:"failed",actionId:e,actionName:r.name,error:l.message}),u}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const Cb="https://gmail.googleapis.com/gmail/v1/users/me",la={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function Vn(t,e,n,r=null){var i;const a={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};r&&(a.body=JSON.stringify(r));const s=await fetch(`${Cb}${n}`,a);if(!s.ok){const u=((i=(await s.json().catch(()=>({}))).error)==null?void 0:i.message)||`Gmail API error: ${s.status}`;throw new Error(u)}return s.status===204?{success:!0}:s.json()}class Ib extends Tb{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}extractMessageId(e){const n=e.event.data.emailId||e.event.data.id;return n?n.startsWith("gmail:")?n.substring(6):n:null}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[la.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[la.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[la.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[la.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[la.SPAM],removeLabelIds:[la.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[la.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[r]}),{success:!0,message:`Applied label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var a;const n=this.extractMessageId(e),r=(a=e.config)==null?void 0:a.labelId;if(!n)throw new Error("No message ID provided");if(!r)throw new Error("No label ID provided in config");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[r]}),{success:!0,message:`Removed label: ${r}`,data:{messageId:n,labelId:r}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[la.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=this.extractMessageId(e);if(!n)throw new Error("No message ID provided");return await Vn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[la.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,r=[],a=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await Vn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:r,removeLabelIds:a}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await Vn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const Pb=new Ib;let Mb=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(Pb)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const r=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,a=r.pluginId||this.resolvePluginId(n.event.source),s=r.commandId||r.id,i=this.getPlugin(a);return i?i.canExecute(s)?i.execute(s,n):{success:!1,message:`Command "${s}" not found in plugin "${i.serviceName}". Available: ${i.getHandlers().map(l=>l.actionId).join(", ")}`,error:new Error(`Command not supported: ${s}`)}:{success:!1,message:`Plugin "${a}" not found. Is it registered?`,error:new Error(`Plugin not found: ${a}`)}}async executePipeline(e,n){var u,d;const r=[];let a=!0;for(const v of e){(u=n.onProgress)==null||u.call(n,{phase:"action_start",actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId});const p=await this.executeAction(v,n);r.push({actionId:v.id,actionName:v.name,pluginId:v.pluginId,commandId:v.commandId,...p}),p.success||(a=!1),(d=n.onProgress)==null||d.call(n,{phase:"action_complete",actionId:v.id,actionName:v.name,result:p})}const i=r.filter(v=>!v.success).map(v=>{var p;return`${v.pluginId}Â·${v.commandId}: ${v.message||((p=v.error)==null?void 0:p.message)||"Unknown error"}`}).join("; "),l=r.filter(v=>v.success).map(v=>`${v.pluginId}Â·${v.commandId}`).join(", ");return{success:a,results:r,message:a?`Successfully executed: ${l}`:`Pipeline failed: ${i}`}}async executePipelineBatch(e,n,r){var l,u;const a=[];for(let d=0;d<n.length;d++){const v=n[d];(l=r.onProgress)==null||l.call(r,{phase:"batch_event_start",eventIndex:d,totalEvents:n.length,event:v});const p={...r,event:v},h=await this.executePipeline(e,p);a.push({event:v,...h}),(u=r.onProgress)==null||u.call(r,{phase:"batch_event_complete",eventIndex:d,totalEvents:n.length,event:v,result:h})}const s=a.filter(d=>d.success).length,i=a.filter(d=>!d.success).length;return{success:i===0,results:a,total:n.length,successful:s,failed:i,message:`Processed ${n.length} event(s): ${s} successful, ${i} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),r=this.getPlugin(n);return r?r.getHandlers():[]}getRequiredScopes(e,n){const r=this.resolvePluginId(n),a=this.getPlugin(r);return a?a.getRequiredScopes(e):[]}};const mi=new Mb,Ob=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:mi},Symbol.toStringTag,{value:"Module"})),Nb=20,Db={maxTokens:512};function qp(t){const e=[],n=[];for(const s of t)if(s.actions.length){e.push(`${s.pluginName} plugin:`);for(const i of s.actions)e.push(`  ${i.actionId.padEnd(22)} â ${i.name}: ${i.description}`),n.push(i.actionId)}const r=e.length?e.join(`
`):"  (no actions available)",a=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${r}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${a})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function Bp(){return mi.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const Fp=qp(Bp());async function Kp(t,{count:e=Nb,force:n=!1,onProgress:r=()=>{},signal:a}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");r({phase:"loading",message:"Loading recent emails..."});let s,i=0;if(n)s=await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().limit(e).toArray();else{const K=new Set(await lt.emailClassifications.toCollection().primaryKeys());i=0,s=[],await lt.items.where("[sourceType+date]").between(["gmail",Rn.minKey],["gmail",Rn.maxKey]).reverse().until(()=>s.length>=e).each(O=>{K.has(O.id)?i++:s.push(O)})}if(s.length===0){const K=n?"No emails to scan.":`All emails already classified (${i} total). Use "Rescan All" to reclassify.`;return r({phase:"done",message:K,classified:0}),{scanned:0,classified:0,skipped:i,errors:0}}const l=Date.now(),u=performance.now();let d=0,v=0,p=0,h=0;const m=[],x=Bp(),k=qp(x),E=new Set(x.flatMap(K=>K.actions.map(O=>O.actionId))),D=t.modelId,B=bd(D)||wd(D);if(!B)throw new Error(`Unknown model: ${D}`);if(!B.recommendedForEmailProcessing&&s.length>0){const{MODELS:K}=await Ln(async()=>{const{MODELS:ke}=await Promise.resolve().then(()=>j_);return{MODELS:ke}},void 0),{OLLAMA_MODELS:O}=await Ln(async()=>{const{OLLAMA_MODELS:ke}=await Promise.resolve().then(()=>z_);return{OLLAMA_MODELS:ke}},void 0),J=[...K.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.name),...O.filter(ke=>ke.recommendedForEmailProcessing).map(ke=>ke.displayName)],ie=B.displayName||B.name;console.warn(`â ï¸ Current model (${ie}) is not optimized for email processing. For best results with long emails, use: ${J.join(", ")}. Some emails may fail due to memory limits.`)}for(let K=0;K<s.length&&!(a!=null&&a.aborted);K++){const O=s[K],J=Up(O),ie=[{role:"system",content:k},{role:"user",content:J}];r({phase:"scanning",current:K+1,total:s.length,classified:d,errors:v,results:m,email:{subject:O.subject,from:O.from,date:O.date},prompt:{system:Fp,user:J},systemPromptLength:k.length,live:null,lastResult:null,totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}});const ke=performance.now();try{const{text:F,tps:I,numTokens:j,inputTokens:C}=await t.generateFull(ie,{maxTokens:512,enableThinking:!1,temperature:0},$=>{r({phase:"generating",current:K+1,total:s.length,classified:d,errors:v,results:m,email:{subject:O.subject,from:O.from,date:O.date},live:{tps:$.tps,numTokens:$.numTokens},streamingText:$.text||"",totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})});p+=j,h+=C;const N=Lb(F,E),M=performance.now()-ke;if(N){await lt.emailClassifications.put({emailId:O.id,action:N.action,group:N.group,reason:N.reason,summary:N.summary,tags:N.tags,subject:O.subject||"(no subject)",from:O.from||"",date:O.date,scannedAt:l,status:"pending"}),await mb(N.action,N.group,N.suggestedActions),d++;const $={success:!0,email:{subject:O.subject,from:O.from,date:O.date},classification:N,rawResponse:F,stats:{tps:I,numTokens:j,inputTokens:C,elapsed:M},promptSize:J.length};m.push($),r({phase:"classified",current:K+1,total:s.length,classified:d,errors:v,results:m,email:{subject:O.subject,from:O.from,date:O.date},result:N,rawResponse:F,emailStats:{tps:I,numTokens:j,inputTokens:C,elapsed:M},totals:{outputTokens:p,inputTokens:h,elapsed:performance.now()-u}})}}catch(F){console.error(`Triage email ${K+1} failed:`,F),v++;const I=F.message||String(F),j=I.length>200?I.slice(0,200)+"...":I;m.push({success:!1,email:{subject:O.subject,from:O.from,date:O.date},error:j,promptSize:J.length})}}const Y=performance.now()-u,S=m.length>0?Math.round(m.reduce((K,O)=>K+O.promptSize,0)/m.length):0,V=m.filter(K=>{var O;return K.success&&((O=K.stats)==null?void 0:O.tps)}).length>0?Math.round(m.filter(K=>K.success).reduce((K,O)=>{var J;return K+(((J=O.stats)==null?void 0:J.tps)||0)},0)/m.filter(K=>{var O;return K.success&&((O=K.stats)==null?void 0:O.tps)}).length):null;return r({phase:"done",current:s.length,total:s.length,classified:d,errors:v,results:m,summary:{avgPromptSize:S,avgTps:V,systemPromptSize:k.length,processed:s.length,skipped:i,modelName:B.displayName||B.name,modelContextWindow:B.contextWindow,modelMaxEmailTokens:B.maxEmailTokens},totals:{outputTokens:p,inputTokens:h,elapsed:Y}}),{scanned:s.length,classified:d,skipped:i,errors:v}}async function Hp(){const t=await lt.emailClassifications.toArray();return Op(t)}async function Rb(){const t=await lt.emailClassifications.toArray(),e={total:t.length};for(const n of t){const r=n.action||"UNKNOWN";e[r]=(e[r]||0)+1}return e}async function Sl(t,e){await lt.emailClassifications.update(t,{status:e})}async function Jf(){await lt.emailClassifications.clear()}async function Ad(t){await lt.emailClassifications.where("action").equals(t).delete()}async function Gp(t){await lt.emailClassifications.delete(t)}async function Pu(){const t=await lt.items.where("sourceType").equals("gmail").count(),e=await lt.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Up(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function Lb(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const r=n.indexOf("{"),a=n.lastIndexOf("}");if(r===-1||a===-1||a<=r)return console.warn("Triage: no JSON object found in response"),null;const s=n.indexOf("[");if(s!==-1&&s<r)return console.warn("Triage: expected JSON object, got array"),null;const i=n.slice(r,a+1);try{const l=JSON.parse(i);if(!l||typeof l!="object"||Array.isArray(l))return null;const u=jb(l.action);if(!u)return console.warn("Triage: missing or invalid action field"),null;const v=["NOISE","INFO","CRITICAL"].includes(l.group)?l.group:"INFO";let p=[];Array.isArray(l.suggestedActions)&&(p=l.suggestedActions.filter(m=>typeof m!="string"||!m.trim()?!1:e?e.has(m.trim()):!0).map(m=>m.trim()).slice(0,5)),p.length===0&&Array.isArray(l.suggestedActions)&&l.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",l.suggestedActions);let h=[];return Array.isArray(l.tags)&&(h=l.tags.filter(m=>typeof m=="string"&&m.trim()).map(m=>m.trim().toLowerCase()).slice(0,10)),{action:u,group:v,suggestedActions:p,reason:String(l.reason||"").slice(0,300),summary:String(l.summary||"").slice(0,500),tags:h}}catch(l){return console.warn("Triage: failed to parse JSON response:",l.message),null}}function jb(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Mu(t){return`hsl(${Ql(t)}, 55%, 55%)`}function zb(t){return`hsl(${Ql(t)}, 40%, 35%)`}var qb=z('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),Bb=z('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">âï¸</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Cloud APIs</div> <div class="backend-desc svelte-1n2kfl0">ChatGPT, Claude, Gemini, Grok</div></div></button></div> <!></div>');function Fb(t,e){at(e,!0);let n=Ae(e,"backend",15,"webgpu"),r=Ae(e,"isWebGPUAvailable",3,!0);var a=Bb(),s=b(_(a),2),i=_(s);let l;i.__click=()=>n("webgpu");var u=b(i,2);let d;u.__click=()=>n("ollama");var v=b(u,2);let p;v.__click=()=>n("cloud");var h=b(s,2);{var m=x=>{var k=qb();T(x,k)};ce(h,x=>{!r()&&n()==="webgpu"&&x(m)})}se(()=>{l=xt(i,1,"backend-btn svelte-1n2kfl0",null,l,{active:n()==="webgpu"}),i.disabled=!r(),d=xt(u,1,"backend-btn svelte-1n2kfl0",null,d,{active:n()==="ollama"}),p=xt(v,1,"backend-btn cloud-btn svelte-1n2kfl0",null,p,{active:n()==="cloud"})}),T(t,a),st()}Xt(["click"]);const Kb=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function $f(...t){Kb&&console.log("[debug]",...t)}function dr(t){return $f(`[MOUNT] ${t}`),()=>$f(`[DESTROY] ${t}`)}var Hb=z("<option> </option>"),Gb=z('<p class="model-description svelte-1p89qnn"> </p>'),Ub=z('<span class="current-badge svelte-1p89qnn">Current</span>'),Vb=z('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),Wb=z('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),Yb=z('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),Xb=z('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),Zb=z('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),Qb=z('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),Jb=z('<p class="error svelte-1p89qnn"> </p>'),$b=z('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function e0(t,e){at(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"gpuInfo",3,null),a=Ae(e,"error",3,null);_n(()=>dr("ModelSelector"));var s=$b(),i=_(s),l=b(_(i),2),u=b(_(l),2);Ot(u,21,()=>ea,Ut,(S,V)=>{var K=Hb(),O=_(K),J={};se(()=>{ee(O,`${o(V).name??""} â ${o(V).size??""}`),J!==(J=o(V).id)&&(K.value=(K.__value=o(V).id)??"")}),T(S,K)});var d=b(u,2);{var v=S=>{const V=Q(()=>ea.find(ie=>ie.id===n()));var K=an(),O=Xe(K);{var J=ie=>{var ke=Gb(),F=_(ke);se(()=>ee(F,o(V).description)),T(ie,ke)};ce(O,ie=>{o(V)&&ie(J)})}T(S,K)};ce(d,S=>{n()&&S(v)})}var p=b(l,2),h=b(_(p),2),m=_(h),x=b(_(m));Ot(x,21,()=>ea,Ut,(S,V)=>{var K=Xb();let O;var J=_(K),ie=_(J),ke=b(ie);{var F=ae=>{var W=Ub();T(ae,W)};ce(ke,ae=>{o(V).id===n()&&ae(F)})}var I=b(J),j=_(I),C=_(j),N=b(I),M=_(N),$=b(N),H=_($);{var L=ae=>{var W=Vb();T(ae,W)},q=ae=>{var W=Wb();T(ae,W)},te=ae=>{var W=Yb();T(ae,W)};ce(H,ae=>{o(V).recommendedForEmailProcessing?ae(L):o(V).maxEmailTokens>=6e3?ae(q,1):ae(te,!1)})}se((ae,W)=>{O=xt(K,1,"svelte-1p89qnn",null,O,{selected:o(V).id===n()}),ee(ie,`${o(V).name??""} `),ee(C,`${ae??""}k`),ee(M,`~${W??""}k`)},[()=>(o(V).contextWindow/1024).toFixed(0),()=>(o(V).maxEmailTokens/1e3).toFixed(0)]),T(S,K)});var k=b(p,2);{var E=S=>{var V=Qb(),K=b(_(V),2),O=_(K),J=b(_(O)),ie=_(J),ke=b(O,2),F=b(_(ke)),I=_(F),j=b(ke,2);{var C=N=>{var M=Zb(),$=b(_(M)),H=_($);se(L=>ee(H,L),[()=>Iu(r().limits.maxBufferSize)]),T(N,M)};ce(j,N=>{var M;(M=r().limits)!=null&&M.maxBufferSize&&N(C)})}se(()=>{ee(ie,r().vendor),ee(I,r().architecture)}),T(S,V)};ce(k,S=>{r()&&S(E)})}var D=b(k,2);{var B=S=>{var V=Jb(),K=_(V);se(()=>ee(K,a())),T(S,V)};ce(D,S=>{a()&&S(B)})}var Y=b(D,2);Y.__click=function(...S){var V;(V=e.onload)==null||V.apply(this,S)},se(()=>Y.disabled=a()),pi(u,n),T(t,s),st()}Xt(["click"]);var t0=z('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),n0=z('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),r0=z('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),a0=z("<div><!></div>"),s0=z("<option> <!></option>"),i0=z("<option> <!></option>"),o0=z('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),l0=z('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),c0=z('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),u0=z('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),d0=z('<span class="current-badge svelte-1bvvk8o">Current</span>'),f0=z('<span class="installed-badge svelte-1bvvk8o">â</span>'),v0=z('<span class="rec-badge svelte-1bvvk8o">â</span>'),h0=z('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),p0=z('<p class="error svelte-1bvvk8o"> </p>'),g0=z('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function m0(t,e){at(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"error",15);const a=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let s=Me(Wt(xo())),i=Me(!1),l=Me(null),u=Me(Wt([])),d=Me(!1);yn(()=>{K_().then(G=>{P(s,G,!0),v()})});async function v(){P(i,!0),P(l,null);const G=await Cu(o(s));P(l,G,!0),P(i,!1),G.connected&&p()}async function p(){P(d,!0);try{const G=await G_(o(s));P(u,G.map(ne=>ne.name),!0)}catch(G){console.error("Failed to load Ollama models:",G),P(u,[],!0)}P(d,!1)}function h(){H_(o(s)),v()}function m(){if(!n()){r("Please select a model");return}e.onload()}function x(G){return o(u).length?o(u).includes(G):!1}const k=_p();var E=g0(),D=_(E),B=_(D),Y=b(_(B)),S=_(Y),V=b(B,2),K=_(V);K.__change=h;var O=b(K,2);O.__click=v;var J=_(O),ie=b(V,2);{var ke=G=>{var ne=a0();let re;var pe=_(ne);{var ye=Z=>{var he=t0(),be=b(Xe(he),2),Ie=_(be);se(()=>ee(Ie,`Connected â¢ v${o(l).version??""}`)),T(Z,he)},Se=Z=>{var he=r0(),be=b(Xe(he),2),Ie=_(be),Ye=_(Ie),Je=b(Ie,2);{var ct=qe=>{var Oe=n0(),ze=b(_(Oe),2),Ne=_(ze),Fe=b(_(Ne));Fe.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var Ke=b(Ne,2),$e=b(_(Ke));$e.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,T(qe,Oe)};ce(Je,qe=>{o(l).corsError&&qe(ct)})}se(()=>ee(Ye,`Disconnected: ${o(l).error??""}`)),T(Z,he)};ce(pe,Z=>{o(l).connected?Z(ye):Z(Se,!1)})}se(()=>re=xt(ne,1,"connection-status svelte-1bvvk8o",null,re,{connected:o(l).connected})),T(G,ne)};ce(ie,G=>{o(l)&&G(ke)})}var F=b(D,2),I=b(_(F),2),j=_(I);Ot(j,21,()=>k,Ut,(G,ne)=>{var re=s0(),pe=_(re),ye=b(pe);{var Se=be=>{var Ie=on("â");T(be,Ie)},Z=Q(()=>x(o(ne).name));ce(ye,be=>{o(Z)&&be(Se)})}var he={};se(be=>{ee(pe,`${o(ne).displayName??""} (${o(ne).params??""}) - ${be??""}k context `),he!==(he=o(ne).name)&&(re.value=(re.__value=o(ne).name)??"")},[()=>(o(ne).contextWindow/1024).toFixed(0)]),T(G,re)});var C=b(j);Ot(C,21,()=>ta.filter(G=>!G.recommended),Ut,(G,ne)=>{var re=i0(),pe=_(re),ye=b(pe);{var Se=be=>{var Ie=on("â");T(be,Ie)},Z=Q(()=>x(o(ne).name));ce(ye,be=>{o(Z)&&be(Se)})}var he={};se(be=>{ee(pe,`${o(ne).displayName??""} (${o(ne).params??""}) - ${be??""}k context `),he!==(he=o(ne).name)&&(re.value=(re.__value=o(ne).name)??"")},[()=>(o(ne).contextWindow/1024).toFixed(0)]),T(G,re)});var N=b(I,2);{var M=G=>{const ne=Q(()=>ta.find(Se=>Se.name===n()));var re=an(),pe=Xe(re);{var ye=Se=>{var Z=u0(),he=_(Z),be=_(he),Ie=b(he,2),Ye=_(Ie),Je=_(Ye),ct=b(Ye,4),qe=_(ct),Oe=b(ct,2);{var ze=Ze=>{var Ge=o0(),tt=b(Xe(Ge),2),nt=_(tt);se(ft=>ee(nt,ft),[()=>o(ne).tags.join(", ")]),T(Ze,Ge)};ce(Oe,Ze=>{var Ge;(Ge=o(ne).tags)!=null&&Ge.length&&Ze(ze)})}var Ne=b(Ie,2);{var Fe=Ze=>{var Ge=l0(),tt=b(_(Ge),2),nt=_(tt);se(()=>ee(nt,`ollama pull ${n()??""}`)),T(Ze,Ge)},Ke=Q(()=>!x(n())),$e=Ze=>{var Ge=c0();T(Ze,Ge)};ce(Ne,Ze=>{o(Ke)?Ze(Fe):Ze($e,!1)})}se(Ze=>{ee(be,o(ne).description),ee(Je,`${Ze??""}k context`),ee(qe,`${o(ne).params??""} params`)},[()=>(o(ne).contextWindow/1024).toFixed(0)]),T(Se,Z)};ce(pe,Se=>{o(ne)&&Se(ye)})}T(G,re)};ce(N,G=>{n()&&G(M)})}var $=b(F,2),H=b(_($),2),L=_(H),q=b(_(L));Ot(q,21,()=>ta,Ut,(G,ne)=>{var re=h0();let pe;var ye=_(re),Se=_(ye),Z=b(Se);{var he=Ze=>{var Ge=d0();T(Ze,Ge)};ce(Z,Ze=>{o(ne).name===n()&&Ze(he)})}var be=b(Z,2);{var Ie=Ze=>{var Ge=f0();T(Ze,Ge)},Ye=Q(()=>x(o(ne).name));ce(be,Ze=>{o(Ye)&&Ze(Ie)})}var Je=b(ye),ct=_(Je),qe=_(ct),Oe=b(Je),ze=_(Oe),Ne=b(Oe),Fe=_(Ne);{var Ke=Ze=>{var Ge=v0();T(Ze,Ge)};ce(Fe,Ze=>{o(ne).recommended&&Ze(Ke)})}var $e=b(Fe);se((Ze,Ge,tt)=>{pe=xt(re,1,"svelte-1bvvk8o",null,pe,Ze),ee(Se,`${o(ne).displayName??""} `),ee(qe,`${Ge??""}k`),ee(ze,o(ne).params),ee($e,` ${tt??""}`)},[()=>({selected:o(ne).name===n(),installed:x(o(ne).name)}),()=>(o(ne).contextWindow/1024).toFixed(0),()=>o(ne).tags.slice(0,2).join(", ")]),T(G,re)});var te=b($,2);{var ae=G=>{var ne=p0(),re=_(ne);se(()=>ee(re,r())),T(G,ne)};ce(te,G=>{r()&&G(ae)})}var W=b(te,2);W.__click=m,se(()=>{var G;ee(S,a?"ð¥ local":"âï¸ remote"),kt(K,"placeholder",a?"http://localhost:11434":"https://me-ai.metaelon.space"),O.disabled=o(i),ee(J,o(i)?"Testing...":"Test"),W.disabled=!((G=o(l))!=null&&G.connected)||r()}),Zr(K,()=>o(s),G=>P(s,G)),pi(I,n),T(t,E),st()}Xt(["change","click"]);var y0=z("<option> <!></option>"),_0=z('<span class="warning svelte-1cdiev9">May struggle with long emails.</span>'),b0=z('<div class="model-info svelte-1cdiev9"> <!></div>'),w0=z('<div class="error-msg svelte-1cdiev9"> </div>'),x0=z('<div class="api-settings svelte-1cdiev9"><div class="tabs svelte-1cdiev9"><button><span class="icon svelte-1cdiev9">â¡</span> OpenAI</button> <button><span class="icon svelte-1cdiev9">ð§ </span> Anthropic</button> <button><span class="icon svelte-1cdiev9">ð</span> Google</button> <button><span class="icon svelte-1cdiev9">âï¸</span> xAI</button></div> <div class="field mt svelte-1cdiev9"><label for="api-key" class="svelte-1cdiev9"> </label> <div class="input-row svelte-1cdiev9"><input id="api-key" type="password" placeholder="Enter your API key..." autocomplete="off" class="svelte-1cdiev9"/></div> <div class="hint svelte-1cdiev9"> </div></div> <div class="field svelte-1cdiev9"><label for="model-select" class="svelte-1cdiev9">Select Model</label> <select id="model-select" class="svelte-1cdiev9"></select> <!></div> <button class="btn primary load-btn svelte-1cdiev9"> </button> <!></div>');function k0(t,e){at(e,!0);let n=Ae(e,"selectedModel",15),r=Ae(e,"error",15,null),a=Me("openai"),s=Wt({openai:"",anthropic:"",google:"",xai:""}),i=Me(!1),l=Q(()=>La.filter(H=>H.provider===o(a)));_n(async()=>{var L;s.openai=await Qr("openaiApiKey")||"",s.anthropic=await Qr("anthropicApiKey")||"",s.google=await Qr("googleApiKey")||"",s.xai=await Qr("xaiApiKey")||"";const H=La.find(q=>q.id===n());H?P(a,H.provider,!0):(P(a,"openai"),n((L=o(l)[0])==null?void 0:L.id))}),yn(()=>{var H;La.filter(L=>L.provider===o(a)).some(L=>L.id===n())||n((H=La.filter(L=>L.provider===o(a))[0])==null?void 0:H.id)});async function u(){if(!s[o(a)]){r(`API key for ${o(a)} is required`);return}r(null),P(i,!0),await ii(`${o(a)}ApiKey`,s[o(a)]),P(i,!1),e.onload()}var d=x0(),v=_(d),p=_(v);let h;p.__click=()=>P(a,"openai");var m=b(p,2);let x;m.__click=()=>P(a,"anthropic");var k=b(m,2);let E;k.__click=()=>P(a,"google");var D=b(k,2);let B;D.__click=()=>P(a,"xai");var Y=b(v,2),S=_(Y),V=_(S),K=b(S,2),O=_(K),J=b(K,2),ie=_(J),ke=b(Y,2),F=b(_(ke),2);Ot(F,21,()=>o(l),Ut,(H,L)=>{var q=y0(),te=_(q),ae=b(te);{var W=ne=>{var re=on("â");T(ne,re)};ce(ae,ne=>{o(L).recommendedForEmailProcessing&&ne(W)})}var G={};se(()=>{ee(te,`${o(L).displayName??""} `),G!==(G=o(L).id)&&(q.value=(q.__value=o(L).id)??"")}),T(H,q)});var I=b(F,2);{var j=H=>{const L=Q(()=>o(l).find(W=>W.id===n()));var q=an(),te=Xe(q);{var ae=W=>{var G=b0(),ne=_(G),re=b(ne);{var pe=ye=>{var Se=_0();T(ye,Se)};ce(re,ye=>{o(L).recommendedForEmailProcessing||ye(pe)})}se(ye=>ee(ne,`${o(L).description??""}. Context window: ${ye??""} tokens. `),[()=>o(L).contextWindow.toLocaleString()]),T(W,G)};ce(te,W=>{o(L)&&W(ae)})}T(H,q)};ce(I,H=>{n()&&H(j)})}var C=b(ke,2);C.__click=u;var N=_(C),M=b(C,2);{var $=H=>{var L=w0(),q=_(L);se(()=>ee(q,r())),T(H,L)};ce(M,H=>{r()&&H($)})}se((H,L)=>{h=xt(p,1,"tab-btn svelte-1cdiev9",null,h,{active:o(a)==="openai"}),x=xt(m,1,"tab-btn svelte-1cdiev9",null,x,{active:o(a)==="anthropic"}),E=xt(k,1,"tab-btn svelte-1cdiev9",null,E,{active:o(a)==="google"}),B=xt(D,1,"tab-btn svelte-1cdiev9",null,B,{active:o(a)==="xai"}),ee(V,`${H??""} API Key`),ee(ie,`Your key is stored locally in your browser's IndexedDB and never sent anywhere except directly to ${L??""}.`),C.disabled=o(i)||!s[o(a)],ee(N,o(i)?"Checking...":"Load Model")},[()=>o(a).toUpperCase(),()=>o(a).toUpperCase()]),Zr(O,()=>s[o(a)],H=>s[o(a)]=H),pi(F,n),T(t,d),st()}Xt(["click"]);var S0=z('<span class="progress-percent svelte-r5fnze"> </span>'),E0=z('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),A0=z('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),T0=z('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),C0=z('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),I0=z('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),P0=z('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function M0(t,e){at(e,!0);let n=Ae(e,"message",3,""),r=Ae(e,"items",19,()=>[]);_n(()=>dr("LoadingProgress"));var a=P0(),s=_(a),i=_(s),l=b(s,2);Ot(l,17,r,Ut,(u,d)=>{const v=Q(()=>o(d).total?X_(o(d).loaded||0,o(d).total):null);var p=I0(),h=_(p),m=_(h),x=_(m),k=b(m,2);{var E=S=>{var V=S0(),K=_(V);se(O=>ee(K,`${O??""}%`),[()=>o(v).toFixed(1)]),T(S,V)};ce(k,S=>{o(v)!==null&&S(E)})}var D=b(h,2);{var B=S=>{var V=E0(),K=Xe(V),O=_(K),J=b(K,2),ie=_(J),ke=_(ie),F=b(ie,4),I=_(F),j=b(F,2),C=_(j);se((N,M,$,H,L)=>{Dt(O,`width: ${N??""}%`),ee(ke,M),ee(I,$),ee(C,`(${H??""} / ${L??""} B)`)},[()=>Math.max(o(d).progress??0,.5).toFixed(1),()=>Vc(o(d).loaded||0),()=>Vc(o(d).total),()=>(o(d).loaded||0).toLocaleString(),()=>o(d).total.toLocaleString()]),T(S,V)},Y=S=>{var V=C0(),K=b(Xe(V),2),O=_(K);{var J=ke=>{var F=A0(),I=Xe(F),j=_(I),C=b(I,2),N=_(C);se((M,$)=>{ee(j,M),ee(N,`(${$??""} B)`)},[()=>Vc(o(d).loaded),()=>o(d).loaded.toLocaleString()]),T(ke,F)},ie=ke=>{var F=T0();T(ke,F)};ce(O,ke=>{o(d).loaded?ke(J):ke(ie,!1)})}T(S,V)};ce(D,S=>{o(d).total?S(B):S(Y,!1)})}se(()=>{kt(m,"title",o(d).file),ee(x,o(d).file)}),T(u,p)}),se(()=>ee(i,n())),T(t,a),st()}var O0=z('<span class="thinking-tokens svelte-11gjw00"> </span>'),N0=z('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),D0=z('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),R0=z('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),L0=z('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),j0=z('<span class="cursor svelte-11gjw00">|</span>'),z0=z(" <!>",1),q0=z('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),B0=z('<div class="content svelte-11gjw00"> </div>'),F0=z('<div><div class="role svelte-11gjw00"> </div> <!></div>');function K0(t,e){at(e,!0);let n=Ae(e,"isLast",3,!1),r=Ae(e,"isRunning",3,!1),a=Ae(e,"generationPhase",3,null),s=Ae(e,"numTokens",3,null);_n(()=>dr(`MessageBubble[${e.msg.role}]`));var i=F0(),l=_(i),u=_(l),d=b(l,2);{var v=h=>{var m=q0(),x=Xe(m);{var k=O=>{var J=N0(),ie=b(_(J),4);{var ke=F=>{var I=O0(),j=_(I);se(()=>ee(j,`${s()??""} tokens`)),T(F,I)};ce(ie,F=>{s()&&F(ke)})}T(O,J)},E=O=>{var J=D0();T(O,J)};ce(x,O=>{r()&&n()&&a()==="thinking"?O(k):r()&&n()&&a()==="preparing"&&O(E,1)})}var D=b(x,2);{var B=O=>{var J=R0(),ie=_(J),ke=b(_(ie),2),F=_(ke),I=b(ie,2),j=_(I);se(C=>{ee(F,`${C??""} words`),ee(j,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),T(O,J)};ce(D,O=>{e.msg.thinking&&O(B)})}var Y=b(D,2),S=_(Y);{var V=O=>{var J=L0();T(O,J)},K=O=>{var J=z0(),ie=Xe(J,!0),ke=b(ie);{var F=I=>{var j=j0();T(I,j)};ce(ke,I=>{r()&&n()&&I(F)})}se(()=>ee(ie,e.msg.content)),T(O,J)};ce(S,O=>{r()&&n()&&!e.msg.content&&a()!=="thinking"?O(V):O(K,!1)})}T(h,m)},p=h=>{var m=B0(),x=_(m);se(()=>ee(x,e.msg.content)),T(h,m)};ce(d,h=>{e.msg.role==="assistant"?h(v):h(p,!1)})}se(()=>{xt(i,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),ee(u,e.msg.role==="user"?"You":"AI")}),T(t,i),st()}Xt(["click"]);var H0=z('<div class="group svelte-1fa8qqq"> </div>'),G0=z('<div class="binding svelte-1fa8qqq"> </div>'),U0=z('<div class="binding unbound svelte-1fa8qqq">unbound</div>'),V0=z('<div class="connector svelte-1fa8qqq"><div class="line svelte-1fa8qqq"></div> <div class="arrow svelte-1fa8qqq">â¶</div></div> <div class="node action-node svelte-1fa8qqq"><div class="node-header action-header svelte-1fa8qqq"><span class="icon"> </span> </div> <div class="node-body svelte-1fa8qqq"><div class="desc svelte-1fa8qqq"> </div> <!></div></div>',1),W0=z('<div class="pipeline-graph svelte-1fa8qqq"><div class="node trigger-node svelte-1fa8qqq"><div class="node-header svelte-1fa8qqq"><span class="icon">â¡</span> Trigger</div> <div class="node-body svelte-1fa8qqq"><div class="label svelte-1fa8qqq"> </div> <!></div></div> <!></div>');function vl(t,e){at(e,!0);let n=Ae(e,"commands",19,()=>[]);Ae(e,"executionState",3,null);let r=Q(()=>e.group?nr[e.group]:nr.INFO);var a=W0(),s=_(a);let i;var l=_(s);let u;var d=b(l,2),v=_(d),p=_(v),h=b(v,2);{var m=k=>{var E=H0();let D;var B=_(E);se(()=>{D=Dt(E,"",D,{color:o(r).color}),ee(B,o(r).label)}),T(k,E)};ce(h,k=>{o(r)&&k(m)})}var x=b(s,2);Ot(x,17,n,Ut,(k,E)=>{var D=V0(),B=b(Xe(D),2),Y=_(B),S=_(Y),V=_(S),K=b(S),O=b(Y,2),J=_(O),ie=_(J),ke=b(J,2);{var F=j=>{var C=G0(),N=_(C);se(()=>ee(N,`${o(E).pluginId??""}Â·${o(E).commandId??""}`)),T(j,C)},I=j=>{var C=U0();T(j,C)};ce(ke,j=>{o(E).pluginId&&o(E).commandId?j(F):j(I,!1)})}se(()=>{ee(V,o(E).icon||"âï¸"),ee(K,` ${o(E).name??""}`),kt(J,"title",o(E).description),ee(ie,o(E).description)}),T(k,D)}),se(()=>{var k,E;i=Dt(s,"",i,{"border-color":(k=o(r))==null?void 0:k.color}),u=Dt(l,"",u,{background:(E=o(r))==null?void 0:E.color}),ee(p,e.eventType)}),T(t,a),st()}const ev="https://accounts.google.com/gsi/client",Y0="https://www.googleapis.com/auth/gmail.modify",Td="me-ai:oauth-token",Cd=300*1e3;let $i=null,Yi=null,Ha=0;async function Vp(t,e){Ha=Date.now()+e*1e3;const{setSetting:n}=await Ln(async()=>{const{setSetting:r}=await Promise.resolve().then(()=>Sa);return{setSetting:r}},void 0);await n(Td,{access_token:t,expires_at:Ha})}async function Ou(){Ha=0;const{removeSetting:t}=await Ln(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>Sa);return{removeSetting:e}},void 0);await t(Td)}async function tc(){try{const{getSetting:t}=await Ln(async()=>{const{getSetting:a}=await Promise.resolve().then(()=>Sa);return{getSetting:a}},void 0),e=await t(Td);if(!e)return null;const{access_token:n,expires_at:r}=e;return!n||Date.now()>r-Cd?(await Ou(),null):(Ha=r,{access_token:n})}catch{return await Ou(),null}}function X0(){return Ha>0&&Date.now()<Ha-Cd}function Z0(){return Ha<=0?0:Math.max(0,Ha-Cd-Date.now())}function tv(){return new Promise((t,e)=>{if(!$i){e(new Error("Google Auth not initialized."));return}Yi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Vp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},$i.requestAccessToken({prompt:""})})}function Q0(){return new Promise((t,e)=>{var a,s;if((s=(a=window.google)==null?void 0:a.accounts)!=null&&s.oauth2){t();return}const n=document.querySelector(`script[src="${ev}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const r=document.createElement("script");r.src=ev,r.async=!0,r.defer=!0,r.onload=()=>t(),r.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async function nv(t){await Q0(),$i=google.accounts.oauth2.initTokenClient({client_id:t,scope:Y0,callback:e=>{Yi&&(Yi(e),Yi=null)}})}function J0(){return new Promise((t,e)=>{if(!$i){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Yi=async n=>{n.error?e(new Error(n.error_description||n.error)):(await Vp(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},$i.requestAccessToken()})}async function $0(t){return await Ou(),new Promise(e=>{var n,r;(r=(n=window.google)==null?void 0:n.accounts)!=null&&r.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function Wp(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const r=await zp(t.type);if(e==null||e({phase:"policy_check",group:r.group,policy:r}),r.requiresApproval&&!n){const d=await jr(t.type);return{success:!1,requiresApproval:!0,group:r.group,actions:d,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const a=await tc();if(!(a!=null&&a.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const s=a.access_token,i=await jr(t.type);if(!i||i.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:i,actionCount:i.length});const l={accessToken:s,event:t,onProgress:e},u=await mi.executePipeline(i,l);return e==null||e({phase:"done",result:u}),u}catch(r){return e==null||e({phase:"error",error:r.message}),{success:!1,error:r,message:r.message||"Unknown error"}}}async function Yp(t,e,n,r=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const a=await zp(t);if(a.requiresApproval&&!r){const p=await jr(t);return{success:!1,requiresApproval:!0,group:a.group,actions:p,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await tc();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const i=s.access_token,l=await jr(t);if(!l||l.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:l,actionCount:l.length});const u=e.map(p=>({type:t,source:"gmail",data:p})),d={accessToken:i,onProgress:n},v=await mi.executePipelineBatch(l,u,d);return n==null||n({phase:"done",result:v}),v}catch(a){return n==null||n({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function Xp(t){return mi.getAvailableActions(t)}async function Nu(){const t=await tc();return!!(t!=null&&t.access_token)}const ew=Object.freeze(Object.defineProperty({__proto__:null,EVENT_GROUPS:nr,executePipeline:Wp,executePipelineBatch:Yp,getAvailableActions:Xp,isAuthenticated:Nu},Symbol.toStringTag,{value:"Module"}));var tw=z('<div class="event-subject svelte-1w66m1k"> </div>'),nw=z('<span class="sep svelte-1w66m1k">Â·</span> ',1),rw=z('<div class="event-summary svelte-1w66m1k"> </div>'),aw=z('<span class="tag svelte-1w66m1k"> </span>'),sw=z('<div class="event-tags svelte-1w66m1k"></div>'),iw=z('<div class="event-reason svelte-1w66m1k"> </div>'),ow=z("<button><!></button>"),lw=z('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),cw=z("<div> </div>"),uw=z('<div class="pipeline-header svelte-1w66m1k" style="margin-top: 0.5rem;"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div> <!>',1),dw=z('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),fw=z('<span class="event-subject-inline svelte-1w66m1k"> </span>'),vw=z('<span class="sep svelte-1w66m1k">Â·</span> ',1),hw=z('<div class="event-summary svelte-1w66m1k"> </div>'),pw=z('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div></div>'),gw=z('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),mw=z('<span class="group-tier-chip svelte-1w66m1k"> </span>'),yw=z("<button><!></button>"),_w=z("<span> </span>"),bw=z('<span class="approval-action-desc svelte-1w66m1k"> </span>'),ww=z("<li><!> <strong> </strong> <!></li>"),xw=z('<ul class="approval-actions svelte-1w66m1k"></ul>'),kw=z(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),Sw=z("<div> </div>"),Ew=z('<span class="email-from svelte-1w66m1k"> </span>'),Aw=z('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),Tw=z('<div class="email-summary svelte-1w66m1k"> </div>'),Cw=z('<span class="tag svelte-1w66m1k"> </span>'),Iw=z('<div class="email-tags svelte-1w66m1k"></div>'),Pw=z("<button><!></button>"),Mw=z('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),Ow=z('<div class="pipeline-steps-wrapper" style="margin-top: 0.3rem;"><!></div>'),Nw=z('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Control Board</div>'),Dw=z("<div> </div>"),Rw=z('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),Lw=z('<div class="group-emails svelte-1w66m1k"></div>'),jw=z('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),zw=z('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function qw(t,e){at(e,!0);let n=Me(Wt({})),r=Wt({}),a=Me(Wt({}));function s(S){if(!S)return"â";const V=S.replace(/<.*>/,"").trim();return V.length>40?V.slice(0,38)+"â¦":V}function i(S){if(!S)return"";try{return new Date(S).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}async function l(S,V,K=!1){if(!await Nu()){alert("Please sign in to Gmail first (Dashboard page)");return}const O=`single_${V}`;r[O]={running:!0,progress:null,result:null};try{const J=await Wp(S,ie=>{r[O]={...r[O],progress:ie}},K);if(J.requiresApproval){r[O]={running:!1,progress:null,result:null},o(a)[O]={event:S,emailId:V,actions:J.actions,group:J.group,isBatch:!1};return}r[O]={running:!1,progress:null,result:J}}catch(J){r[O]={running:!1,progress:null,result:{success:!1,message:J.message}}}}async function u(S,V,K=!1){if(!await Nu()){alert("Please sign in to Gmail first (Dashboard page)");return}const O=`batch_${S}`;r[O]={running:!0,progress:null,result:null};try{const J=await Yp(S,V,ie=>{r[O]={...r[O],progress:ie}},K);if(J.requiresApproval){r[O]={running:!1,progress:null,result:null},o(a)[O]={eventType:S,emails:V,actions:J.actions,group:J.group,isBatch:!0};return}r[O]={running:!1,progress:null,result:J}}catch(J){r[O]={running:!1,progress:null,result:{success:!1,message:J.message}}}}async function d(S){const V=o(a)[S];V&&(delete o(a)[S],P(a,{...o(a)},!0),V.isBatch?await u(V.eventType,V.emails,!0):await l(V.event,V.emailId,!0))}function v(S){delete o(a)[S],P(a,{...o(a)},!0)}function p(S){P(n,{...o(n),[S]:!o(n)[S]},!0)}function h(S){return S.split("_").map(V=>V.charAt(0)+V.slice(1).toLowerCase()).join(" ")}function m(S){return`hsl(${Ql(S)}, 55%, 55%)`}function x(S){return r[S]}var k=an(),E=Xe(k);{var D=S=>{var V=dw(),K=_(V),O=_(K),J=_(O),ie=_(J),ke=b(J,2),F=_(ke),I=b(O,2);{var j=pe=>{var ye=tw(),Se=_(ye);se(()=>ee(Se,e.msg.event.data.subject)),T(pe,ye)};ce(I,pe=>{var ye;(ye=e.msg.event.data)!=null&&ye.subject&&pe(j)})}var C=b(I,2),N=_(C);{var M=pe=>{var ye=on();se(Se=>ee(ye,Se),[()=>s(e.msg.event.data.from)]),T(pe,ye)};ce(N,pe=>{var ye;(ye=e.msg.event.data)!=null&&ye.from&&pe(M)})}var $=b(N,2);{var H=pe=>{var ye=nw(),Se=b(Xe(ye),1,!0);se(Z=>ee(Se,Z),[()=>i(e.msg.event.data.date)]),T(pe,ye)};ce($,pe=>{var ye;(ye=e.msg.event.data)!=null&&ye.date&&pe(H)})}var L=b(C,2);{var q=pe=>{var ye=rw(),Se=_(ye);se(()=>ee(Se,e.msg.event.metadata.summary)),T(pe,ye)};ce(L,pe=>{var ye;(ye=e.msg.event.metadata)!=null&&ye.summary&&pe(q)})}var te=b(L,2);{var ae=pe=>{var ye=sw();Ot(ye,21,()=>e.msg.event.metadata.tags,Ut,(Se,Z)=>{var he=aw(),be=_(he);se(()=>ee(be,o(Z))),T(Se,he)}),T(pe,ye)};ce(te,pe=>{var ye,Se;(Se=(ye=e.msg.event.metadata)==null?void 0:ye.tags)!=null&&Se.length&&pe(ae)})}var W=b(te,2);{var G=pe=>{var ye=iw(),Se=_(ye);se(()=>ee(Se,e.msg.event.metadata.reason)),T(pe,ye)};ce(W,pe=>{var ye;(ye=e.msg.event.metadata)!=null&&ye.reason&&pe(G)})}var ne=b(K,2);{var re=pe=>{const ye=Q(()=>`single_${e.msg.event.data.emailId||Date.now()}`),Se=Q(()=>x(o(ye))),Z=Q(()=>o(a)[o(ye)]),he=Q(()=>{var Ke;return(Ke=e.msg.event.metadata)!=null&&Ke.group?nr[e.msg.event.metadata.group]:null});var be=uw(),Ie=Xe(be),Ye=b(_(Ie),2);{var Je=Ke=>{var $e=ow();let Ze;$e.__click=()=>l(e.msg.event,e.msg.event.data.emailId);var Ge=_($e);{var tt=vt=>{var St=on("â³ Running...");T(vt,St)},nt=vt=>{var St=on();se(()=>ee(St,o(Se).result.success?"â Done":"â Failed")),T(vt,St)},ft=vt=>{var St=on("ð Review");T(vt,St)},mt=vt=>{var St=on("â¶ Execute");T(vt,St)};ce(Ge,vt=>{var St,bt,pt;(St=o(Se))!=null&&St.running?vt(tt):(bt=o(Se))!=null&&bt.result?vt(nt,1):(pt=o(he))!=null&&pt.requiresApproval?vt(ft,2):vt(mt,!1)})}se(()=>{var vt,St;Ze=xt($e,1,"execute-btn svelte-1w66m1k",null,Ze,{critical:(vt=o(he))==null?void 0:vt.requiresApproval}),$e.disabled=(St=o(Se))==null?void 0:St.running}),T(Ke,$e)};ce(Ye,Ke=>{o(Z)||Ke(Je)})}var ct=b(Ie,2);{var qe=Ke=>{var $e=lw(),Ze=b(_($e),4),Ge=_(Ze);Ge.__click=()=>d(o(ye));var tt=b(Ge,2);tt.__click=()=>v(o(ye)),T(Ke,$e)};ce(ct,Ke=>{o(Z)&&Ke(qe)})}var Oe=b(ct,2),ze=_(Oe);{let Ke=Q(()=>{var $e;return($e=e.msg.event.metadata)==null?void 0:$e.group});vl(ze,{get eventType(){return e.msg.event.type},get group(){return o(Ke)},get commands(){return e.msg.commands}})}var Ne=b(Oe,2);{var Fe=Ke=>{var $e=cw();let Ze;var Ge=_($e);se(()=>{Ze=xt($e,1,"execution-result svelte-1w66m1k",null,Ze,{success:o(Se).result.success,error:!o(Se).result.success}),ee(Ge,o(Se).result.message)}),T(Ke,$e)};ce(Ne,Ke=>{var $e;($e=o(Se))!=null&&$e.result&&Ke(Fe)})}T(pe,be)};ce(ne,pe=>{var ye;(ye=e.msg.commands)!=null&&ye.length&&pe(re)})}se(()=>{ee(ie,e.msg.event.type),ee(F,e.msg.event.source)}),T(S,V)},B=S=>{var V=gw(),K=_(V),O=_(K),J=_(O),ie=b(K,2);Ot(ie,17,()=>e.msg.items,Ut,(ke,F)=>{var I=pw(),j=_(I),C=_(j),N=_(C),M=_(N),$=b(N,2);{var H=ye=>{var Se=fw(),Z=_(Se);se(()=>ee(Z,o(F).event.data.subject)),T(ye,Se)};ce($,ye=>{var Se;(Se=o(F).event.data)!=null&&Se.subject&&ye(H)})}var L=b(C,2),q=_(L);{var te=ye=>{var Se=on();se(Z=>ee(Se,Z),[()=>s(o(F).event.data.from)]),T(ye,Se)};ce(q,ye=>{var Se;(Se=o(F).event.data)!=null&&Se.from&&ye(te)})}var ae=b(q,2);{var W=ye=>{var Se=vw(),Z=b(Xe(Se),1,!0);se(he=>ee(Z,he),[()=>i(o(F).event.data.date)]),T(ye,Se)};ce(ae,ye=>{var Se;(Se=o(F).event.data)!=null&&Se.date&&ye(W)})}var G=b(L,2);{var ne=ye=>{var Se=hw(),Z=_(Se);se(()=>ee(Z,o(F).event.metadata.summary)),T(ye,Se)};ce(G,ye=>{var Se;(Se=o(F).event.metadata)!=null&&Se.summary&&ye(ne)})}var re=b(j,2),pe=_(re);{let ye=Q(()=>{var Se;return(Se=o(F).event.metadata)==null?void 0:Se.group});vl(pe,{get eventType(){return o(F).event.type},get group(){return o(ye)},get commands(){return o(F).commands}})}se(()=>ee(M,o(F).event.type)),T(ke,I)}),se(()=>ee(J,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),T(S,V)},Y=S=>{var V=zw(),K=_(V),O=b(_(K),2),J=_(O),ie=b(K,2);Ot(ie,17,()=>e.msg.groups,Ut,(ke,F)=>{const I=Q(()=>o(n)[o(F).eventType]??!0),j=Q(()=>`batch_${o(F).eventType}`),C=Q(()=>x(o(j))),N=Q(()=>o(a)[o(j)]),M=Q(()=>o(F).group?nr[o(F).group]:null);var $=jw(),H=_($),L=_(H);L.__click=()=>p(o(F).eventType);var q=_(L);let te;var ae=_(q),W=b(q,2);{var G=qe=>{var Oe=mw();let ze;var Ne=_(Oe);se(()=>{kt(Oe,"title",o(M).description),ze=Dt(Oe,"",ze,{color:o(M).color}),ee(Ne,o(M).label)}),T(qe,Oe)};ce(W,qe=>{o(M)&&qe(G)})}var ne=b(W,2),re=_(ne),pe=b(ne,4);let ye;var Se=b(L,2);{var Z=qe=>{var Oe=yw();let ze;Oe.__click=Ge=>{Ge.stopPropagation(),u(o(F).eventType,o(F).emails)};var Ne=_(Oe);{var Fe=Ge=>{var tt=on("â³ Running...");T(Ge,tt)},Ke=Ge=>{var tt=on();se(()=>ee(tt,o(C).result.success?`â Done (${o(C).result.successful}/${o(C).result.total})`:"â Failed")),T(Ge,tt)},$e=Ge=>{var tt=on();se(()=>ee(tt,`ð Review & Execute (${o(F).emails.length??""})`)),T(Ge,tt)},Ze=Ge=>{var tt=on();se(()=>ee(tt,`â¶ Execute All (${o(F).emails.length??""})`)),T(Ge,tt)};ce(Ne,Ge=>{var tt,nt,ft;(tt=o(C))!=null&&tt.running?Ge(Fe):(nt=o(C))!=null&&nt.result?Ge(Ke,1):(ft=o(M))!=null&&ft.requiresApproval?Ge($e,2):Ge(Ze,!1)})}se(()=>{var Ge,tt;ze=xt(Oe,1,"execute-all-btn svelte-1w66m1k",null,ze,{critical:(Ge=o(M))==null?void 0:Ge.requiresApproval}),Oe.disabled=(tt=o(C))==null?void 0:tt.running}),T(qe,Oe)};ce(Se,qe=>{o(N)||qe(Z)})}var he=b(H,2);{var be=qe=>{var Oe=kw(),ze=b(_(Oe),2),Ne=b(_(ze)),Fe=_(Ne),Ke=b(ze,2);{var $e=nt=>{var ft=xw();Ot(ft,21,()=>o(N).actions,Ut,(mt,vt)=>{var St=ww(),bt=_(St);{var pt=At=>{var Gt=_w(),De=_(Gt);se(()=>ee(De,o(vt).icon)),T(At,Gt)};ce(bt,At=>{o(vt).icon&&At(pt)})}var yt=b(bt,2),dt=_(yt),Le=b(yt,2);{var Rt=At=>{var Gt=bw(),De=_(Gt);se(()=>ee(De,`â ${o(vt).description??""}`)),T(At,Gt)};ce(Le,At=>{o(vt).description&&At(Rt)})}se(()=>ee(dt,o(vt).name)),T(mt,St)}),T(nt,ft)};ce(Ke,nt=>{var ft;(ft=o(N).actions)!=null&&ft.length&&nt($e)})}var Ze=b(Ke,2),Ge=_(Ze);Ge.__click=()=>d(o(j));var tt=b(Ge,2);tt.__click=()=>v(o(j)),se(()=>ee(Fe,`${o(F).emails.length??""} email${o(F).emails.length===1?"":"s"}`)),T(qe,Oe)};ce(he,qe=>{o(N)&&qe(be)})}var Ie=b(he,2);{var Ye=qe=>{var Oe=Sw();let ze;var Ne=_(Oe);se(()=>{ze=xt(Oe,1,"batch-result svelte-1w66m1k",null,ze,{success:o(C).result.success,error:!o(C).result.success}),ee(Ne,o(C).result.message)}),T(qe,Oe)};ce(Ie,qe=>{var Oe;(Oe=o(C))!=null&&Oe.result&&!o(N)&&qe(Ye)})}var Je=b(Ie,2);{var ct=qe=>{var Oe=Lw();Ot(Oe,21,()=>o(F).emails,Ut,(ze,Ne)=>{const Fe=Q(()=>`single_${o(Ne).emailId}`),Ke=Q(()=>x(o(Fe))),$e=Q(()=>o(a)[o(Fe)]);var Ze=Rw(),Ge=_(Ze),tt=_(Ge),nt=_(tt),ft=b(tt,2),mt=_(ft);{var vt=it=>{var ut=Ew(),Pt=_(ut);se($t=>ee(Pt,$t),[()=>s(o(Ne).from)]),T(it,ut)};ce(mt,it=>{o(Ne).from&&it(vt)})}var St=b(mt,2);{var bt=it=>{var ut=Aw(),Pt=b(Xe(ut)),$t=_(Pt);se(_t=>ee($t,_t),[()=>i(o(Ne).date)]),T(it,ut)};ce(St,it=>{o(Ne).date&&it(bt)})}var pt=b(ft,2);{var yt=it=>{var ut=Tw(),Pt=_(ut);se(()=>ee(Pt,o(Ne).summary)),T(it,ut)};ce(pt,it=>{o(Ne).summary&&it(yt)})}var dt=b(pt,2);{var Le=it=>{var ut=Iw();Ot(ut,21,()=>o(Ne).tags,Ut,(Pt,$t)=>{var _t=Cw(),jt=_(_t);se(()=>ee(jt,o($t))),T(Pt,_t)}),T(it,ut)};ce(dt,it=>{var ut;(ut=o(Ne).tags)!=null&&ut.length&&it(Le)})}var Rt=b(Ge,2),At=_(Rt),Gt=b(_(At),2);{var De=it=>{var ut=Pw();let Pt;ut.__click=()=>l({type:o(F).eventType,source:"gmail",data:o(Ne)},o(Ne).emailId);var $t=_(ut);{var _t=Jt=>{var en=on("â³ Running...");T(Jt,en)},jt=Jt=>{var en=on();se(()=>ee(en,o(Ke).result.success?"â Done":"â Failed")),T(Jt,en)},fn=Jt=>{var en=on("ð Review");T(Jt,en)},cn=Jt=>{var en=on("â¶ Execute");T(Jt,en)};ce($t,Jt=>{var en,jn,On;(en=o(Ke))!=null&&en.running?Jt(_t):(jn=o(Ke))!=null&&jn.result?Jt(jt,1):(On=o(M))!=null&&On.requiresApproval?Jt(fn,2):Jt(cn,!1)})}se(()=>{var Jt,en;Pt=xt(ut,1,"execute-btn svelte-1w66m1k",null,Pt,{critical:(Jt=o(M))==null?void 0:Jt.requiresApproval}),ut.disabled=(en=o(Ke))==null?void 0:en.running}),T(it,ut)};ce(Gt,it=>{o($e)||it(De)})}var Qt=b(At,2);{var Gn=it=>{var ut=Mw(),Pt=b(_(ut),4),$t=_(Pt);$t.__click=()=>d(o(Fe));var _t=b($t,2);_t.__click=()=>v(o(Fe)),T(it,ut)};ce(Qt,it=>{o($e)&&it(Gn)})}var _e=b(Qt,2);{var ln=it=>{var ut=Ow(),Pt=_(ut);vl(Pt,{get eventType(){return o(F).eventType},get group(){return o(F).group},get commands(){return o(F).commands}}),T(it,ut)},En=it=>{var ut=Nw();T(it,ut)};ce(_e,it=>{var ut;(ut=o(F).commands)!=null&&ut.length?it(ln):it(En,!1)})}var Ct=b(_e,2);{var Mn=it=>{var ut=Dw();let Pt;var $t=_(ut);se(()=>{Pt=xt(ut,1,"execution-result svelte-1w66m1k",null,Pt,{success:o(Ke).result.success,error:!o(Ke).result.success}),ee($t,o(Ke).result.message)}),T(it,ut)};ce(Ct,it=>{var ut;(ut=o(Ke))!=null&&ut.result&&it(Mn)})}se(()=>ee(nt,o(Ne).subject)),T(ze,Ze)}),T(qe,Oe)};ce(Je,qe=>{o(I)&&qe(ct)})}se((qe,Oe)=>{te=Dt(q,"",te,qe),ee(ae,Oe),ee(re,o(F).emails.length),ye=xt(pe,0,"chevron svelte-1w66m1k",null,ye,{open:o(I)})},[()=>({background:m(o(F).eventType)}),()=>h(o(F).eventType)]),T(ke,$)}),se(()=>ee(J,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),T(S,V)};ce(E,S=>{e.msg.type==="event"?S(D):e.msg.type==="event-batch"?S(B,1):e.msg.type==="events-grouped"&&S(Y,2)})}T(t,k),st()}Xt(["click"]);var Bw=z('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Fw=z('<span class="edate svelte-mt5nvh"> </span>'),Kw=z('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),Hw=z('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),Gw=z('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),Uw=z('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="pipeline-preview" style="margin-bottom: 0.5rem; background: #111; padding: 0.2rem 0.5rem; border-radius: 8px; border: 1px solid #1a1a1a;"><!></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),Vw=z('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function Ww(t,e){at(e,!0);let n=Ae(e,"pendingData",3,null),r=Me(null),a=Me(null),s=Me(Wt([])),i=Me(null);function l(k){P(r,o(r)===k?null:k,!0),P(a,null)}yn(()=>{o(r)?(jr(o(r)).then(k=>P(s,k,!0)),Ji(o(r)).then(k=>P(i,k,!0))):(P(s,[],!0),P(i,null))});function u(k){return k.split("_").map(E=>E.charAt(0)+E.slice(1).toLowerCase()).join(" ")}function d(k){if(!k)return"";try{return new Date(k).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function v(k){if(!k)return"";const E=k.replace(/<.*>/,"").trim();return E.length>24?E.slice(0,22)+"â¦":E}var p={toggleGroup:l},h=an(),m=Xe(h);{var x=k=>{var E=Vw(),D=_(E),B=_(D),Y=b(D,2);Ot(Y,20,()=>n().order,K=>K,(K,O)=>{const J=Q(()=>n().groups[O]),ie=Q(()=>Mu(O)),ke=Q(()=>o(r)===O);var F=Bw();let I;F.__click=()=>l(O);let j;var C=_(F);let N;var M=b(C),$=b(M),H=_($);se(L=>{I=xt(F,1,"chip svelte-mt5nvh",null,I,{active:o(ke)}),j=Dt(F,"",j,{"--c":o(ie)}),N=Dt(C,"",N,{background:o(ie)}),ee(M,` ${L??""} `),ee(H,o(J).length)},[()=>u(O)]),T(K,F)});var S=b(Y,2);{var V=K=>{const O=Q(()=>n().groups[o(r)]),J=Q(()=>Mu(o(r)));var ie=Uw(),ke=_(ie);let F;var I=_(ke);I.__click=()=>{P(r,null),P(a,null)};var j=b(I,2),C=_(j),N=b(j,2),M=_(N),$=b(ke,2),H=_($);vl(H,{get eventType(){return o(r)},get group(){return o(i)},get commands(){return o(s)}});var L=b($,2);Ot(L,21,()=>o(O),G=>G.emailId,(G,ne)=>{var re=Kw(),pe=_(re);pe.__click=()=>{var qe;return(qe=e.onaskai)==null?void 0:qe.call(e,`Tell me about the email "${o(ne).subject}" from ${o(ne).from}`)};var ye=_(pe),Se=_(ye),Z=b(ye,2),he=_(Z),be=b(he);{var Ie=qe=>{var Oe=Fw(),ze=_(Oe);se(Ne=>ee(ze,Ne),[()=>d(o(ne).date)]),T(qe,Oe)};ce(be,qe=>{o(ne).date&&qe(Ie)})}var Ye=b(pe,2),Je=_(Ye);Je.__click=()=>{var qe;return(qe=e.onmarkacted)==null?void 0:qe.call(e,o(ne).emailId)};var ct=b(Je,2);ct.__click=()=>{var qe;return(qe=e.ondismiss)==null?void 0:qe.call(e,o(ne).emailId)},se(qe=>{ee(Se,o(ne).subject),ee(he,qe)},[()=>v(o(ne).from)]),T(G,re)});var q=b(L,2),te=_(q);{var ae=G=>{var ne=Hw(),re=Xe(ne);re.__click=()=>o(O).forEach(ye=>{var Se;return(Se=e.onmarkacted)==null?void 0:Se.call(e,ye.emailId)});var pe=b(re,2);pe.__click=()=>P(a,o(r),!0),T(G,ne)},W=G=>{var ne=Gw(),re=Xe(ne),pe=_(re),ye=b(re,2);ye.__click=()=>P(a,null);var Se=b(ye,2);Se.__click=()=>{var Z;(Z=e.oncleargroup)==null||Z.call(e,o(r)),P(a,null),P(r,null)},se(()=>ee(pe,`Remove ${o(O).length??""}?`)),T(G,ne)};ce(te,G=>{o(a)!==o(r)?G(ae):G(W,!1)})}se(G=>{F=Dt(ke,"",F,{"border-color":o(J)}),ee(C,G),ee(M,o(O).length)},[()=>u(o(r))]),T(K,ie)};ce(S,K=>{o(r)&&n().groups[o(r)]&&K(V)})}se(()=>ee(B,`${n().total??""} item${n().total!==1?"s":""} need attention`)),T(k,E)};ce(m,k=>{n()&&n().total>0&&k(x)})}return T(t,h),st(p)}Xt(["click"]);var Yw=z('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),Xw=z('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),Zw=z('<div class="strip svelte-1ed7zw1"><!></div>');function Qw(t,e){let n=Ae(e,"hasScanData",3,!1),r=Ae(e,"engineReady",3,!1),a=Ae(e,"isScanning",3,!1),s=Q(()=>r()&&!n()&&!a()),i=Q(()=>o(s)||a());var l=an(),u=Xe(l);{var d=v=>{var p=Zw(),h=_(p);{var m=k=>{var E=Yw();T(k,E)},x=k=>{var E=Xw();E.__click=function(...D){var B;(B=e.onscan)==null||B.apply(this,D)},T(k,E)};ce(h,k=>{a()?k(m):o(s)&&k(x,1)})}T(v,p)};ce(u,v=>{o(i)&&v(d)})}T(t,l)}Xt(["click"]);var Jw=z('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),$w=z('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),e1=z('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),t1=z('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),n1=z('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),r1=z('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),a1=z('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function s1(t,e){at(e,!0),_n(()=>dr("GpuPanel"));var n=a1(),r=_(n),a=b(_(r),2),s=b(_(a),2),i=_(s),l=b(a,2),u=b(_(l),2),d=_(u),v=b(l,2);{var p=S=>{var V=Jw(),K=b(_(V),2),O=_(K);se(()=>ee(O,e.gpuInfo.device)),T(S,V)};ce(v,S=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&S(p)})}var h=b(v,2);{var m=S=>{var V=$w(),K=b(_(V),2),O=_(K);se(J=>ee(O,J),[()=>Iu(e.gpuInfo.limits.maxBufferSize)]),T(S,V)};ce(h,S=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxBufferSize&&S(m)})}var x=b(h,2);{var k=S=>{var V=e1(),K=b(_(V),2),O=_(K);se(()=>ee(O,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),T(S,V)};ce(x,S=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxComputeInvocationsPerWorkgroup&&S(k)})}var E=b(x,2);{var D=S=>{var V=t1(),K=b(_(V),2),O=_(K);se(J=>ee(O,J),[()=>Iu(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),T(S,V)};ce(E,S=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxComputeWorkgroupStorageSize&&S(D)})}var B=b(E,2);{var Y=S=>{var V=r1(),K=_(V),O=_(K),J=b(K,2);Ot(J,21,()=>e.gpuInfo.features,Ut,(ie,ke)=>{var F=n1(),I=_(F);se(()=>ee(I,o(ke))),T(ie,F)}),se(()=>ee(O,`Features (${e.gpuInfo.features.length??""})`)),T(S,V)};ce(B,S=>{var V;(V=e.gpuInfo.features)!=null&&V.length&&S(Y)})}se(()=>{ee(i,e.gpuInfo.vendor),ee(d,e.gpuInfo.architecture)}),T(t,n),st()}var i1=z('<button class="gpu-badge svelte-1ktw27c"> </button>'),o1=z('<span class="backend-badge ollama svelte-1ktw27c">ð¦ Ollama</span>'),l1=z('<span class="backend-badge openai svelte-1ktw27c">â¡ OpenAI</span>'),c1=z('<span class="backend-badge anthropic svelte-1ktw27c">ð§  Anthropic</span>'),u1=z('<span class="backend-badge google svelte-1ktw27c">ð Google</span>'),d1=z('<span class="backend-badge xai svelte-1ktw27c">âï¸ xAI</span>'),f1=z('<span class="stats svelte-1ktw27c"> </span>'),v1=z('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),h1=z('<span class="stats preparing svelte-1ktw27c"> </span>'),p1=z('<span class="stats svelte-1ktw27c"> </span>'),g1=z('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),m1=z('<button class="btn svelte-1ktw27c">Stop</button>'),y1=z('<button class="btn primary svelte-1ktw27c">Send</button>'),_1=z('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function b1(t,e){at(e,!0),_n(()=>dr("ChatView"));let n=Ae(e,"messages",19,()=>[]),r=Ae(e,"pendingData",3,null),a=Ae(e,"hasScanData",3,!1),s=Ae(e,"engineReady",3,!1),i=Ae(e,"isScanning",3,!1),l=Ae(e,"isRunning",3,!1),u=Ae(e,"tps",3,null),d=Ae(e,"numTokens",3,null),v=Ae(e,"generationPhase",3,null),p=Ae(e,"gpuInfo",3,null),h=Ae(e,"backend",3,"webgpu"),m=Ae(e,"chatContainer",15),x=Me(""),k=Me(!1);function E(Z){Z.key==="Enter"&&!Z.shiftKey&&(Z.preventDefault(),D())}function D(){const Z=o(x).trim();!Z||l()||(P(x,""),e.onsend(Z))}function B(Z){Z&&!l()&&e.onsend(Z)}var Y=_1(),S=_(Y),V=_(S);{var K=Z=>{var he=i1();he.__click=()=>P(k,!o(k));var be=_(he);se(()=>ee(be,`WebGPU ${o(k)?"â²":"â¼"}`)),T(Z,he)},O=Z=>{var he=o1();T(Z,he)},J=Z=>{var he=l1();T(Z,he)},ie=Z=>{var he=c1();T(Z,he)},ke=Z=>{var he=u1();T(Z,he)},F=Z=>{var he=d1();T(Z,he)};ce(V,Z=>{p()?Z(K):h()==="ollama"?Z(O,1):h()==="openai"?Z(J,2):h()==="anthropic"?Z(ie,3):h()==="google"?Z(ke,4):h()==="xai"&&Z(F,5)})}var I=b(V,2);{var j=Z=>{var he=f1(),be=_(he);se((Ie,Ye)=>ee(be,`${d()??""} tokens in ${Ie??""}s
        (${Ye??""} tok/s)`),[()=>(d()/u()).toFixed(1),()=>u().toFixed(1)]),T(Z,he)},C=Z=>{var he=v1();T(Z,he)},N=Z=>{var he=h1(),be=_(he);se(Ie=>ee(be,`thinking... ${Ie??""}`),[()=>u()?`${u().toFixed(0)} tok/s`:""]),T(Z,he)},M=Z=>{var he=p1(),be=_(he);se(Ie=>ee(be,`${Ie??""} tok/s`),[()=>u().toFixed(1)]),T(Z,he)};ce(I,Z=>{u()&&!l()?Z(j):l()&&v()==="preparing"?Z(C,1):l()&&v()==="thinking"?Z(N,2):u()&&l()&&Z(M,3)})}var $=b(I,4);$.__click=function(...Z){var he;(he=e.onreset)==null||he.apply(this,Z)};var H=b(S,2);{var L=Z=>{s1(Z,{get gpuInfo(){return p()}})};ce(H,Z=>{o(k)&&p()&&Z(L)})}var q=b(H,2),te=_(q);{var ae=Z=>{var he=g1();T(Z,he)};ce(te,Z=>{n().length===0&&!(r()&&r().total>0)&&Z(ae)})}var W=b(te,2);Ot(W,17,n,Ut,(Z,he,be)=>{var Ie=an(),Ye=Xe(Ie);{var Je=Oe=>{Ww(Oe,{get pendingData(){return o(he).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:B})},ct=Oe=>{qw(Oe,{get msg(){return o(he)},get oncommand(){return e.oncommand}})},qe=Oe=>{{let ze=Q(()=>be===n().length-1);K0(Oe,{get msg(){return o(he)},get isLast(){return o(ze)},get isRunning(){return l()},get generationPhase(){return v()},get numTokens(){return d()}})}};ce(Ye,Oe=>{o(he).type==="dashboard"?Oe(Je):o(he).type==="event"||o(he).type==="event-batch"||o(he).type==="events-grouped"?Oe(ct,1):Oe(qe,!1)})}T(Z,Ie)}),Cs(q,Z=>m(Z),()=>m());var G=b(q,2);Qw(G,{get hasScanData(){return a()},get engineReady(){return s()},get isScanning(){return i()},get onscan(){return e.onscan}});var ne=b(G,2),re=_(ne);re.__keydown=E;var pe=b(re,2);{var ye=Z=>{var he=m1();he.__click=function(...be){var Ie;(Ie=e.onstop)==null||Ie.apply(this,be)},T(Z,he)},Se=Z=>{var he=y1();he.__click=D,se(be=>he.disabled=be,[()=>!o(x).trim()]),T(Z,he)};ce(pe,Z=>{l()?Z(ye):Z(Se,!1)})}se(()=>{$.disabled=l(),re.disabled=l()}),Zr(re,()=>o(x),Z=>P(x,Z)),T(t,Y),st()}Xt(["click","keydown"]);var w1=z('<div class="container center svelte-1bi93vx"><!> <!></div>');function x1(t,e){at(e,!0);const n=!!navigator.gpu,r=Ep();let a=Me("webgpu"),s=Me(Wt(ea[0].id)),i=Me(null),l=Me(null),u=Me(""),d=Me(Wt([])),v=Me(Wt([])),p=Me(!1),h=Me(null),m=Me(null),x=Me(null),k=Me(null),E=Me(null),D=Me(null),B=Me(!1),Y=Me(!1),S=!1;_n(async()=>{const[W,G]=await Promise.all([Qr("aiBackend"),Qr("selectedModel")]);W&&P(a,W,!0),G&&P(s,G,!0),r.check(),r.isReady&&V();const ne=r.onMessage(re=>{switch(re.status){case"webgpu-info":P(k,re.data,!0);break;case"loading":P(i,"loading"),P(u,re.data,!0);break;case"initiate":P(d,[...o(d),re],!0);break;case"progress":P(d,o(d).map(pe=>pe.file===re.file?{...pe,...re}:pe),!0);break;case"done":P(d,o(d).filter(pe=>pe.file!==re.file),!0);break;case"ready":P(i,"ready"),V();break;case"start":if(!o(p))break;P(E,re.phase||"preparing",!0),P(v,[...o(v),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!o(p))break;P(E,re.phase,!0);break;case"thinking":{if(!o(p))break;P(h,re.tps,!0),P(m,re.numTokens,!0);const pe=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...pe,thinking:(pe.thinking||"")+re.content}],!0),j();break}case"thinking-done":{if(!o(p))break;P(h,re.tps,!0),P(m,re.numTokens,!0);const pe=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...pe,thinking:re.content}],!0);break}case"update":{if(!o(p))break;P(h,re.tps,!0),P(m,re.numTokens,!0);const pe=o(v)[o(v).length-1];P(v,[...o(v).slice(0,-1),{...pe,content:pe.content+re.output}],!0),j();break}case"complete":if(!o(p))break;re.tps!==void 0&&P(h,re.tps,!0),re.numTokens!==void 0&&P(m,re.numTokens,!0),P(p,!1),P(E,null),K();break;case"error":P(l,re.data,!0),o(i)==="loading"&&P(i,null),o(p)&&(P(p,!1),P(E,null));break}});return()=>ne()});async function V(){if(!(S||o(v).length>0))try{const W=await Zf();P(D,W,!0),W&&(S=!0,P(v,[{role:"assistant",type:"dashboard",pendingData:W}],!0),j());const G=await Pu();P(B,G.classified>0)}catch{}}async function K(){try{const W=await Zf();P(D,W,!0);const G=o(v).findIndex(re=>re.type==="dashboard");G!==-1&&(W&&W.total>0?P(v,o(v).map((re,pe)=>pe===G?{...re,pendingData:W}:re),!0):P(v,o(v).filter((re,pe)=>pe!==G),!0));const ne=await Pu();P(B,ne.classified>0)}catch{}}async function O(W){await Sl(W,"acted"),await K()}async function J(W){await Sl(W,"dismissed"),await K()}async function ie(W){await Gp(W),await K()}async function ke(W){await Ad(W),await K()}async function F(){if(o(Y)||!r.isReady)return;P(Y,!0);let W=null;try{if(await Kp(r,{count:20,onProgress:G=>{var ne;G.phase==="done"&&((ne=G.results)==null?void 0:ne.length)>0&&(W=G.results)}}),await K(),(W==null?void 0:W.length)>0){const G=await Eb(W);P(v,[...o(v),G],!0),j()}o(D)&&!o(v).some(G=>G.type==="dashboard")&&(P(v,[{role:"assistant",type:"dashboard",pendingData:o(D)},...o(v)],!0),j())}catch(G){console.error("Scan failed:",G)}finally{P(Y,!1)}}function I({event:W,commandId:G}){var ne,re;`${G}${W.type}${((ne=W.data)==null?void 0:ne.subject)||"unknown"}`,P(v,[...o(v),{role:"assistant",content:`Command: ${G}

This command is not yet implemented. In the future, "${G}" will be executed on the ${W.source} event "${((re=W.data)==null?void 0:re.subject)||""}".`}],!0),j()}function j(){op().then(()=>{o(x)&&(o(x).scrollTop=o(x).scrollHeight)})}async function C(){P(i,"loading"),await ii("selectedModel",o(s)),await ii("aiBackend",o(a)),o(a)==="ollama"&&P(k,null),r.loadModel(o(s))}yn(()=>{o(a)==="webgpu"&&!ea.find(W=>W.id===o(s))?P(s,ea[0].id,!0):o(a)==="ollama"&&!ta.find(W=>W.name===o(s))?P(s,ta[0].name,!0):o(a)==="cloud"&&!La.find(W=>W.id===o(s))&&P(s,La[0].id,!0)});async function N(W){if(!W||o(p))return;if(W.trim().toLowerCase()==="/events"){P(v,[...o(v),{role:"user",content:W}],!0);try{const re=await Hp();if(!re.order.length)P(v,[...o(v),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const pe=await Ab(re);P(v,[...o(v),pe],!0)}}catch(re){P(v,[...o(v),{role:"assistant",content:`Failed to load events: ${re.message}`}],!0)}j();return}P(v,[...o(v),{role:"user",content:W}],!0),P(h,null),P(p,!0);let G=[];try{const pe=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(W)?await db(W):await ub();pe&&(G=[{role:"system",content:pe}])}catch{}const ne=o(v).filter(re=>re.type!=="dashboard"&&re.type!=="events-grouped"&&re.type!=="event-batch"&&re.type!=="event").map(re=>({role:re.role,content:re.content}));r.generate([...G,...ne]),j()}function M(){r.interrupt()}function $(){r.reset(),P(v,[],!0),P(h,null),P(m,null),S=!1,V()}var H=an(),L=Xe(H);{var q=W=>{var G=w1(),ne=_(G);Fb(ne,{get isWebGPUAvailable(){return n},get backend(){return o(a)},set backend(Z){P(a,Z,!0)}});var re=b(ne,2);{var pe=Z=>{e0(Z,{get gpuInfo(){return o(k)},get error(){return o(l)},onload:C,get selectedModel(){return o(s)},set selectedModel(he){P(s,he,!0)}})},ye=Z=>{m0(Z,{onload:C,get selectedModel(){return o(s)},set selectedModel(he){P(s,he,!0)},get error(){return o(l)},set error(he){P(l,he,!0)}})},Se=Z=>{k0(Z,{onload:C,get selectedModel(){return o(s)},set selectedModel(he){P(s,he,!0)},get error(){return o(l)},set error(he){P(l,he,!0)}})};ce(re,Z=>{o(a)==="webgpu"?Z(pe):o(a)==="ollama"?Z(ye,1):o(a)==="cloud"&&Z(Se,2)})}T(W,G)},te=W=>{M0(W,{get message(){return o(u)},get items(){return o(d)}})},ae=W=>{{let G=Q(()=>{var ne;return o(a)==="cloud"?((ne=La.find(re=>re.id===o(s)))==null?void 0:ne.provider)||"cloud":o(a)});b1(W,{get messages(){return o(v)},get pendingData(){return o(D)},get hasScanData(){return o(B)},get engineReady(){return r.isReady},get isScanning(){return o(Y)},get isRunning(){return o(p)},get tps(){return o(h)},get numTokens(){return o(m)},get generationPhase(){return o(E)},get gpuInfo(){return o(k)},get backend(){return o(G)},onsend:N,onstop:M,onreset:$,onmarkacted:O,ondismiss:J,onremove:ie,oncleargroup:ke,onscan:F,oncommand:I,get chatContainer(){return o(x)},set chatContainer(ne){P(x,ne,!0)}})}};ce(L,W=>{o(i)===null?W(q):o(i)==="loading"?W(te,1):W(ae,!1)})}T(t,H),st()}const Cn="gmail",rv=8,Zp=50,Qp=100;async function k1(t,{limit:e=Zp,onProgress:n=()=>{},signal:r}={}){var i;const a=await lt.syncState.get(Cn);if(a!=null&&a.historyId)try{return await C1(t,a,n,r)}catch(l){if(l instanceof xd&&(l.status===404||l.code==="notFound")||((i=l.message)==null?void 0:i.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await lt.syncState.delete(Cn);else throw l}return await A1(t,e===0?1/0:e,n,r)}async function S1(t,{limit:e=Zp,onProgress:n=()=>{},signal:r}={}){const a=await lt.syncState.get(Cn);return a!=null&&a.oldestPageToken?await T1(t,a,e===0?1/0:e,n,r):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function E1(){const t=await lt.syncState.get(Cn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Jp(){await lt.transaction("rw",[lt.items,lt.syncState],async()=>{await lt.items.where("sourceType").equals(Cn).delete(),await lt.syncState.delete(Cn)})}async function A1(t,e,n,r){n({phase:"counting",message:"Getting mailbox info..."}),_s(r);const a=await Ap(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(a.messagesTotal||e,e)});const s=[];let i,l=null;for(;s.length<e;){_s(r);const p=e-s.length,h=await Tp(t,{maxResults:Math.min(Qp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),n({phase:"listing",message:`Listed ${s.length} messages...`,current:s.length,total:Math.min(a.messagesTotal||e,e)}),i=h.nextPageToken,!i||m.length===0)break}if(l=i||null,s.length===0)return await lt.syncState.put({sourceType:Cn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:u,errors:d}=await $p(t,s,n,r),v=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.put({sourceType:Cn,historyId:a.historyId,lastSyncAt:Date.now(),totalItems:v,oldestPageToken:l}),n({phase:"done",message:`Synced ${u} messages`,current:u,total:u}),{added:u,deleted:0,errors:d}}async function T1(t,e,n,r,a){r({phase:"listing",message:"Loading more messages...",current:0}),_s(a);const s=[];let i=e.oldestPageToken,l=null;for(;s.length<n;){_s(a);const p=n-s.length,h=await Tp(t,{maxResults:Math.min(Qp,p),pageToken:i}),m=(h.messages||[]).map(x=>x.id);if(s.push(...m),r({phase:"listing",message:`Listed ${s.length} more messages...`,current:s.length}),i=h.nextPageToken,!i||m.length===0)break}if(l=i||null,s.length===0)return await lt.syncState.update(Cn,{oldestPageToken:null,lastSyncAt:Date.now()}),r({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:u,errors:d}=await $p(t,s,r,a),v=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.update(Cn,{totalItems:v,lastSyncAt:Date.now(),oldestPageToken:l}),r({phase:"done",message:l?`Downloaded ${u} more (more available)`:`Downloaded ${u} more (all synced)`,current:v,total:v}),{added:u,errors:d}}async function C1(t,e,n,r){n({phase:"syncing",message:"Checking for changes..."}),_s(r);let a=0,s=0,i=0,l,u=e.historyId;do{_s(r);const v=await $_(t,{startHistoryId:e.historyId,pageToken:l});if(u=v.historyId||u,l=v.nextPageToken,!!v.history){for(const p of v.history){if(p.messagesAdded){const h=p.messagesAdded.map(x=>x.message.id),m=[...new Set(h.filter(x=>x))];if(m.length>0){const x=await Promise.allSettled(m.map(E=>Cp(t,E))),k=[];for(const E of x)E.status==="fulfilled"?k.push(eg(E.value)):i++;k.length>0&&(await lt.items.bulkPut(k),await tg(k),a+=k.length)}}if(p.messagesDeleted){const h=p.messagesDeleted.map(m=>yd(Cn,m.message.id)).filter(m=>m);h.length>0&&(await lt.items.bulkDelete(h),s+=h.length)}}n({phase:"syncing",message:`Changes: +${a} -${s}`,current:a+s})}}while(l);const d=await lt.items.where("sourceType").equals(Cn).count();return await lt.syncState.put({sourceType:Cn,historyId:u,lastSyncAt:Date.now(),totalItems:d,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:a===0&&s===0?"Already up to date":`Synced: +${a} -${s}`,current:d,total:d}),{added:a,deleted:s,errors:i}}async function $p(t,e,n,r){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let a=0,s=0;for(let i=0;i<e.length;i+=rv){_s(r);const l=e.slice(i,i+rv),u=await Promise.allSettled(l.map(v=>Cp(t,v))),d=[];for(const v of u)v.status==="fulfilled"?d.push(eg(v.value)):s++;d.length>0&&(await lt.items.bulkPut(d),await tg(d)),a+=d.length,n({phase:"downloading",message:`Downloaded ${a} of ${e.length} messages`,current:a,total:e.length})}return{added:a,errors:s}}function eg(t){const e=Pa(t,"From"),n=Pa(t,"To"),r=Pa(t,"Cc"),a=Pa(t,"Subject")||"(no subject)",s=Pa(t,"Date"),i=Pa(t,"Message-ID"),l=Pa(t,"In-Reply-To"),u=Pa(t,"References");let d;try{d=s?new Date(s).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{d=Date.now()}return{id:yd(Cn,t.id),sourceType:Cn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:r,subject:a,snippet:t.snippet||"",body:eb(t),htmlBody:tb(t),date:d,labels:t.labelIds||[],messageId:i,inReplyTo:l,references:u,raw:t,syncedAt:Date.now()}}async function tg(t){const e=new Map;for(const n of t)for(const r of[n.from,n.to,n.cc]){if(!r)continue;const a=r.split(",").map(s=>s.trim()).filter(Boolean);for(const s of a){const i=I1(s);i&&!e.has(i.email)&&e.set(i.email,{...i,date:n.date})}}for(const[n,{name:r,date:a}]of e)try{const s=await lt.contacts.where("email").equals(n).first();if(s){const i={};r&&!s.name&&(i.name=r),a>(s.lastSeen||0)&&(i.lastSeen=a),Object.keys(i).length>0&&await lt.contacts.update(s.id,i)}else await lt.contacts.add({email:n,name:r||"",firstSeen:a,lastSeen:a})}catch(s){(s==null?void 0:s.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(s==null?void 0:s.message)||s)}}function I1(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const r=e[1].toLowerCase().trim(),a=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:r,name:a}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function _s(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var P1=z(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),M1=z(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),O1=z(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function N1(t,e){at(e,!0);let n=Ae(e,"clientIdInput",15),r=Ae(e,"defaultClientId",3,"");_n(()=>dr("SetupGuide"));let a=Me(null);async function s(x){try{await navigator.clipboard.writeText(x),P(a,x,!0),setTimeout(()=>{P(a,null)},1500)}catch{const k=document.createElement("input");k.value=x,document.body.appendChild(k),k.select(),document.execCommand("copy"),document.body.removeChild(k),P(a,x,!0),setTimeout(()=>{P(a,null)},1500)}}const i="http://localhost:5173",l="https://cypherkitty.github.io",u="https://cypherkitty.github.io/me-ai/";var d=O1(),v=_(d),p=b(_(v),4);{var h=x=>{var k=P1(),E=Xe(k),D=b(_(E),2);D.__click=()=>{n(r()),e.onsave()};var B=b(E,2),Y=b(_(B),2),S=_(Y),V=b(_(S),6),K=b(_(V),2),O=b(_(K),2),J=b(_(O),2),ie=_(J);ie.__click=()=>s(i);var ke=_(ie);ke.textContent="http://localhost:5173";var F=b(ke,2),I=_(F),j=b(ie,2);j.__click=()=>s(l);var C=_(j);C.textContent="https://cypherkitty.github.io";var N=b(C,2),M=_(N),$=b(O,2),H=b(_($),2),L=_(H);L.__click=()=>s(i);var q=_(L);q.textContent="http://localhost:5173";var te=b(q,2),ae=_(te),W=b(L,2);W.__click=()=>s(l);var G=_(W);G.textContent="https://cypherkitty.github.io";var ne=b(G,2),re=_(ne),pe=b(W,2);pe.__click=()=>s(u);var ye=_(pe);ye.textContent="https://cypherkitty.github.io/me-ai/";var Se=b(ye,2),Z=_(Se),he=b(S,2),be=_(he);be.__keydown=Ye=>Ye.key==="Enter"&&e.onsave();var Ie=b(be,2);Ie.__click=function(...Ye){var Je;(Je=e.onsave)==null||Je.apply(this,Ye)},se(Ye=>{ee(I,o(a)===i?"â":"â§"),ee(M,o(a)===l?"â":"â§"),ee(ae,o(a)===i?"â":"â§"),ee(re,o(a)===l?"â":"â§"),ee(Z,o(a)===u?"â":"â§"),Ie.disabled=Ye},[()=>!n().trim()]),Zr(be,n),T(x,k)},m=x=>{var k=M1(),E=Xe(k),D=b(_(E),6),B=b(_(D),2),Y=b(_(B),2),S=b(_(Y),2),V=_(S);V.__click=()=>s(i);var K=_(V);K.textContent="http://localhost:5173";var O=b(K,2),J=_(O),ie=b(V,2);ie.__click=()=>s(l);var ke=_(ie);ke.textContent="https://cypherkitty.github.io";var F=b(ke,2),I=_(F),j=b(Y,2),C=b(_(j),2),N=_(C);N.__click=()=>s(i);var M=_(N);M.textContent="http://localhost:5173";var $=b(M,2),H=_($),L=b(N,2);L.__click=()=>s(l);var q=_(L);q.textContent="https://cypherkitty.github.io";var te=b(q,2),ae=_(te),W=b(L,2);W.__click=()=>s(u);var G=_(W);G.textContent="https://cypherkitty.github.io/me-ai/";var ne=b(G,2),re=_(ne),pe=b(E,2),ye=_(pe);ye.__keydown=Z=>Z.key==="Enter"&&e.onsave();var Se=b(ye,2);Se.__click=function(...Z){var he;(he=e.onsave)==null||he.apply(this,Z)},se(Z=>{ee(J,o(a)===i?"â":"â§"),ee(I,o(a)===l?"â":"â§"),ee(H,o(a)===i?"â":"â§"),ee(ae,o(a)===l?"â":"â§"),ee(re,o(a)===u?"â":"â§"),Se.disabled=Z},[()=>!n().trim()]),Zr(ye,n),T(x,k)};ce(p,x=>{r()?x(h):x(m,!1)})}T(t,d),st()}Xt(["click","keydown"]);function D1(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),r=e instanceof xd?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const a=n.match(/project\s+(\d+)/),s=a==null?void 0:a[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:s?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${s}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return r===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:r===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:r===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var R1=z('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),L1=z('<div class="error-card-title svelte-14buhqq"> </div>'),j1=z('<p class="error-card-fix svelte-14buhqq"> </p>'),z1=z('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),q1=z('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),B1=z('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function ng(t,e){at(e,!0);let n=Ae(e,"ondismiss",3,null),r=Ae(e,"onsignout",3,null),a=Q(()=>D1(e.error));_n(()=>dr("ErrorCard"));var s=B1(),i=_(s);{var l=D=>{var B=R1(),Y=_(B),S=_(Y),V=b(Y,2);V.__click=function(...K){var O;(O=n())==null||O.apply(this,K)},se(()=>ee(S,o(a).title)),T(D,B)},u=D=>{var B=L1(),Y=_(B);se(()=>ee(Y,o(a).title)),T(D,B)};ce(i,D=>{n()?D(l):D(u,!1)})}var d=b(i,2),v=_(d),p=b(d,2);{var h=D=>{var B=j1(),Y=_(B);se(()=>ee(Y,o(a).fix)),T(D,B)};ce(p,D=>{o(a).fix&&D(h)})}var m=b(p,2);{var x=D=>{var B=z1(),Y=_(B);se(()=>{kt(B,"href",o(a).link.url),ee(Y,`${o(a).link.label??""} â`)}),T(D,B)};ce(m,D=>{o(a).link&&D(x)})}var k=b(m,2);{var E=D=>{var B=q1();B.__click=function(...Y){var S;(S=r())==null||S.apply(this,Y)},T(D,B)};ce(k,D=>{o(a).action==="signout"&&r()&&D(E)})}se(()=>ee(v,o(a).description)),T(t,s),st()}Xt(["click"]);var F1=z('<span class="spinner svelte-nyqevv"></span> Signing in...',1),K1=mn('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),H1=z('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),G1=z('<span class="client-id-value svelte-nyqevv"> </span>'),U1=z(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function V1(t,e){at(e,!0);let n=Ae(e,"isDefaultClientId",3,!1),r=Ae(e,"error",3,null),a=Ae(e,"loadingAuth",3,!1);_n(()=>dr("AuthCard"));var s=U1(),i=_(s),l=b(_(i),4);{var u=B=>{ng(B,{get error(){return r()},get onsignout(){return e.onsignout}})};ce(l,B=>{r()&&B(u)})}var d=b(l,2);d.__click=function(...B){var Y;(Y=e.onsignin)==null||Y.apply(this,B)};var v=_(d);{var p=B=>{var Y=F1();T(B,Y)},h=B=>{var Y=K1();T(B,Y)};ce(v,B=>{a()?B(p):B(h,!1)})}var m=b(d,4),x=b(_(m),2);{var k=B=>{var Y=H1();T(B,Y)},E=B=>{var Y=G1(),S=_(Y);se(V=>ee(S,`${V??""}...`),[()=>e.clientId.slice(0,20)]),T(B,Y)};ce(x,B=>{n()?B(k):B(E,!1)})}var D=b(x,2);D.__click=function(...B){var Y;(Y=e.onclear)==null||Y.apply(this,B)},se(()=>d.disabled=a()),T(t,s),st()}Xt(["click"]);var W1=z('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),Y1=z('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),X1=z('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function Z1(t,e){at(e,!0);let n=Ae(e,"profile",3,null),r=Ae(e,"loadingProfile",3,!1);_n(()=>dr("ProfileCard"));var a=X1(),s=_(a),i=_(s),l=b(s,2),u=_(l);{var d=h=>{var m=W1();T(h,m)},v=h=>{var m=Y1(),x=Xe(m),k=_(x),E=b(x,2),D=_(E);se((B,Y)=>{ee(k,n().emailAddress),ee(D,`${B??""} messages
        Â· ${Y??""} threads`)},[()=>{var B;return((B=n().messagesTotal)==null?void 0:B.toLocaleString())||"?"},()=>{var B;return((B=n().threadsTotal)==null?void 0:B.toLocaleString())||"?"}]),T(h,m)};ce(u,h=>{r()?h(d):n()&&h(v,1)})}var p=b(l,2);p.__click=function(...h){var m;(m=e.onsignout)==null||m.apply(this,h)},se(h=>ee(i,h),[()=>n()?Pp(n().emailAddress):"?"]),T(t,a),st()}Xt(["click"]);var Q1=z('<span class="spinner svelte-1ds3j4k"></span>'),J1=mn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),$1=z('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),ex=z('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),tx=z('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),nx=z('<option class="svelte-1ds3j4k"> </option>'),rx=z('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),ax=z('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),sx=z('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),ix=z('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),ox=z('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),lx=z('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function cx(t,e){at(e,!0),_n(()=>dr("SyncStatus"));let n=Ae(e,"syncStatus",3,null),r=Ae(e,"syncProgress",3,null),a=Ae(e,"isSyncing",3,!1),s=Me(!1),i=Me(50);const l=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function u(H){if(!H)return"never";const L=Math.floor((Date.now()-H)/1e3);if(L<60)return"just now";const q=Math.floor(L/60);if(q<60)return`${q}m ago`;const te=Math.floor(q/60);return te<24?`${te}h ago`:`${Math.floor(te/24)}d ago`}function d(){var H,L;return!((H=r())!=null&&H.total)||!((L=r())!=null&&L.current)?0:Math.round(r().current/r().total*100)}var v=lx(),p=_(v),h=_(p),m=_(h);{var x=H=>{var L=Q1();T(H,L)},k=H=>{var L=J1();T(H,L)};ce(m,H=>{a()?H(x):H(k,!1)})}var E=b(h,2),D=b(_(E),2);{var B=H=>{var L=$1(),q=_(L),te=b(q);{var ae=G=>{var ne=on("Â· more available");T(G,ne)},W=G=>{var ne=on("Â· all synced");T(G,ne)};ce(te,G=>{n().hasMore?G(ae):G(W,!1)})}se((G,ne)=>ee(q,`${G??""} emails stored
          Â· synced ${ne??""} `),[()=>n().totalItems.toLocaleString(),()=>u(n().lastSyncAt)]),T(H,L)},Y=H=>{var L=ex();T(H,L)};ce(D,H=>{var L;(L=n())!=null&&L.synced?H(B):H(Y,!1)})}var S=b(E,2),V=_(S);{var K=H=>{var L=tx();L.__click=()=>P(s,!o(s)),T(H,L)};ce(V,H=>{var L;(L=n())!=null&&L.synced&&!a()&&H(K)})}var O=b(p,2),J=_(O),ie=b(_(J),2);Ot(ie,21,()=>l,Ut,(H,L)=>{var q=nx(),te=_(q),ae={};se(()=>{ee(te,o(L).label),ae!==(ae=o(L).value)&&(q.value=(q.__value=o(L).value)??"")}),T(H,q)});var ke=b(J,2),F=_(ke);{var I=H=>{var L=ax(),q=Xe(L);q.__click=()=>e.onsync(o(i));var te=_(q),ae=b(q,2);{var W=G=>{var ne=rx();ne.__click=()=>e.onsyncmore(o(i));var re=_(ne);se(()=>{ne.disabled=a(),ee(re,a()?"Loading...":"Sync More")}),T(G,ne)};ce(ae,G=>{n().hasMore&&G(W)})}se(()=>{q.disabled=a(),ee(te,a()?"Syncing...":"Sync New")}),T(H,L)},j=H=>{var L=sx();L.__click=()=>e.onsync(o(i));var q=_(L);se(()=>{L.disabled=a(),ee(q,a()?"Syncing...":"Download Emails")}),T(H,L)};ce(F,H=>{var L;(L=n())!=null&&L.synced?H(I):H(j,!1)})}var C=b(O,2);{var N=H=>{var L=ix(),q=_(L),te=_(q);let ae,W;var G=b(q,2),ne=_(G);se(re=>{ae=xt(te,1,"progress-fill svelte-1ds3j4k",null,ae,{indeterminate:!r().total}),W=Dt(te,"",W,re),ee(ne,r().message||"Syncing...")},[()=>({width:`${d()??""}%`})]),T(H,L)};ce(C,H=>{a()&&r()&&H(N)})}var M=b(C,2);{var $=H=>{var L=ox(),q=b(_(L),2),te=_(q);te.__click=()=>P(s,!1);var ae=b(te,2);ae.__click=()=>{e.onclear(),P(s,!1)},T(H,L)};ce(M,H=>{o(s)&&H($)})}se(()=>ie.disabled=a()),pi(ie,()=>o(i),H=>P(i,H)),T(t,v),st()}Xt(["click"]);var ux=z('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),dx=z('<div class="message-list svelte-y2uamw"></div>');function fx(t,e){at(e,!0);let n=Ae(e,"messages",19,()=>[]);_n(()=>dr("MessageList"));var r=dx();Ot(r,21,n,Ut,(a,s)=>{var i=ux();i.__click=()=>e.onselect(o(s));var l=_(i),u=_(l),d=b(l,2),v=_(d),p=_(v),h=_(p),m=b(p,2),x=_(m),k=b(v,2),E=_(k),D=b(k,2),B=_(D);se((Y,S,V)=>{ee(u,Y),ee(h,S),ee(x,V),ee(E,o(s).subject),ee(B,o(s).snippet)},[()=>Pp(o(s).from),()=>Ip(o(s).from),()=>kd(o(s).date)]),T(a,i)}),T(t,r),st()}Xt(["click"]);function Id(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ps=Id();function rg(t){Ps=t}var ns={exec:()=>null};function Bt(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(a,s)=>{let i=typeof s=="string"?s:s.source;return i=i.replace(Fn.caret,"$1"),n=n.replace(a,i),r},getRegex:()=>new RegExp(n,e)};return r}var vx=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Fn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},hx=/^(?:[ \t]*(?:\n|$))+/,px=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,gx=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,ko=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,mx=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Pd=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,ag=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,sg=Bt(ag).replace(/bull/g,Pd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),yx=Bt(ag).replace(/bull/g,Pd).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Md=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,_x=/^[^\n]+/,Od=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,bx=Bt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Od).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),wx=Bt(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Pd).getRegex(),nc="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Nd=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,xx=Bt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Nd).replace("tag",nc).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),ig=Bt(Md).replace("hr",ko).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nc).getRegex(),kx=Bt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",ig).getRegex(),Dd={blockquote:kx,code:px,def:bx,fences:gx,heading:mx,hr:ko,html:xx,lheading:sg,list:wx,newline:hx,paragraph:ig,table:ns,text:_x},av=Bt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",ko).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nc).getRegex(),Sx={...Dd,lheading:yx,table:av,paragraph:Bt(Md).replace("hr",ko).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",av).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",nc).getRegex()},Ex={...Dd,html:Bt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Nd).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ns,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Bt(Md).replace("hr",ko).replace("heading",` *#{1,6} *[^
]`).replace("lheading",sg).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Ax=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Tx=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,og=/^( {2,}|\\)\n(?!\s*$)/,Cx=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,rc=/[\p{P}\p{S}]/u,Rd=/[\s\p{P}\p{S}]/u,lg=/[^\s\p{P}\p{S}]/u,Ix=Bt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Rd).getRegex(),cg=/(?!~)[\p{P}\p{S}]/u,Px=/(?!~)[\s\p{P}\p{S}]/u,Mx=/(?:[^\s\p{P}\p{S}]|~)/u,ug=/(?![*_])[\p{P}\p{S}]/u,Ox=/(?![*_])[\s\p{P}\p{S}]/u,Nx=/(?:[^\s\p{P}\p{S}]|[*_])/u,Dx=Bt(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",vx?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),dg=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Rx=Bt(dg,"u").replace(/punct/g,rc).getRegex(),Lx=Bt(dg,"u").replace(/punct/g,cg).getRegex(),fg="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",jx=Bt(fg,"gu").replace(/notPunctSpace/g,lg).replace(/punctSpace/g,Rd).replace(/punct/g,rc).getRegex(),zx=Bt(fg,"gu").replace(/notPunctSpace/g,Mx).replace(/punctSpace/g,Px).replace(/punct/g,cg).getRegex(),qx=Bt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,lg).replace(/punctSpace/g,Rd).replace(/punct/g,rc).getRegex(),Bx=Bt(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,ug).getRegex(),Fx="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",Kx=Bt(Fx,"gu").replace(/notPunctSpace/g,Nx).replace(/punctSpace/g,Ox).replace(/punct/g,ug).getRegex(),Hx=Bt(/\\(punct)/,"gu").replace(/punct/g,rc).getRegex(),Gx=Bt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ux=Bt(Nd).replace("(?:-->|$)","-->").getRegex(),Vx=Bt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ux).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),El=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Wx=Bt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",El).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),vg=Bt(/^!?\[(label)\]\[(ref)\]/).replace("label",El).replace("ref",Od).getRegex(),hg=Bt(/^!?\[(ref)\](?:\[\])?/).replace("ref",Od).getRegex(),Yx=Bt("reflink|nolink(?!\\()","g").replace("reflink",vg).replace("nolink",hg).getRegex(),sv=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Ld={_backpedal:ns,anyPunctuation:Hx,autolink:Gx,blockSkip:Dx,br:og,code:Tx,del:ns,delLDelim:ns,delRDelim:ns,emStrongLDelim:Rx,emStrongRDelimAst:jx,emStrongRDelimUnd:qx,escape:Ax,link:Wx,nolink:hg,punctuation:Ix,reflink:vg,reflinkSearch:Yx,tag:Vx,text:Cx,url:ns},Xx={...Ld,link:Bt(/^!?\[(label)\]\((.*?)\)/).replace("label",El).getRegex(),reflink:Bt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",El).getRegex()},Du={...Ld,emStrongRDelimAst:zx,emStrongLDelim:Lx,delLDelim:Bx,delRDelim:Kx,url:Bt(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",sv).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Bt(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",sv).getRegex()},Zx={...Du,br:Bt(og).replace("{2,}","*").getRegex(),text:Bt(Du.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Zo={normal:Dd,gfm:Sx,pedantic:Ex},Mi={normal:Ld,gfm:Du,breaks:Zx,pedantic:Xx},Qx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},iv=t=>Qx[t];function ua(t,e){if(e){if(Fn.escapeTest.test(t))return t.replace(Fn.escapeReplace,iv)}else if(Fn.escapeTestNoEncode.test(t))return t.replace(Fn.escapeReplaceNoEncode,iv);return t}function ov(t){try{t=encodeURI(t).replace(Fn.percentDecode,"%")}catch{return null}return t}function lv(t,e){var s;let n=t.replace(Fn.findPipe,(i,l,u)=>{let d=!1,v=l;for(;--v>=0&&u[v]==="\\";)d=!d;return d?"|":" |"}),r=n.split(Fn.splitPipe),a=0;if(r[0].trim()||r.shift(),r.length>0&&!((s=r.at(-1))!=null&&s.trim())&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Fn.slashPipe,"|");return r}function Oi(t,e,n){let r=t.length;if(r===0)return"";let a=0;for(;a<r&&t.charAt(r-a-1)===e;)a++;return t.slice(0,r-a)}function Jx(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function $x(t,e=0){let n=e,r="";for(let a of t)if(a==="	"){let s=4-n%4;r+=" ".repeat(s),n+=s}else r+=a,n++;return r}function cv(t,e,n,r,a){let s=e.href,i=e.title||null,l=t[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:i,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,u}function ek(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let a=r[1];return e.split(`
`).map(s=>{let i=s.match(n.other.beginningSpace);if(i===null)return s;let[l]=i;return l.length>=a.length?s.slice(a.length):s}).join(`
`)}var Al=class{constructor(t){ht(this,"options");ht(this,"rules");ht(this,"lexer");this.options=t||Ps}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Oi(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=ek(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=Oi(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Oi(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=Oi(e[0],`
`).split(`
`),r="",a="",s=[];for(;n.length>0;){let i=!1,l=[],u;for(u=0;u<n.length;u++)if(this.rules.other.blockquoteStart.test(n[u]))l.push(n[u]),i=!0;else if(!i)l.push(n[u]);else break;n=n.slice(u);let d=l.join(`
`),v=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${d}`:d,a=a?`${a}
${v}`:v;let p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(v,s,!0),this.lexer.state.top=p,n.length===0)break;let h=s.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.blockquote(x);s[s.length-1]=k,r=r.substring(0,r.length-m.raw.length)+k.raw,a=a.substring(0,a.length-m.text.length)+k.text;break}else if((h==null?void 0:h.type)==="list"){let m=h,x=m.raw+`
`+n.join(`
`),k=this.list(x);s[s.length-1]=k,r=r.substring(0,r.length-h.raw.length)+k.raw,a=a.substring(0,a.length-m.raw.length)+k.raw,n=x.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:a}}}list(t){var n,r;let e=this.rules.block.list.exec(t);if(e){let a=e[1].trim(),s=a.length>1,i={type:"list",raw:"",ordered:s,start:s?+a.slice(0,-1):"",loose:!1,items:[]};a=s?`\\d{1,9}\\${a.slice(-1)}`:`\\${a}`,this.options.pedantic&&(a=s?a:"[*+-]");let l=this.rules.other.listItemRegex(a),u=!1;for(;t;){let v=!1,p="",h="";if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;p=e[0],t=t.substring(p.length);let m=$x(e[2].split(`
`,1)[0],e[1].length),x=t.split(`
`,1)[0],k=!m.trim(),E=0;if(this.options.pedantic?(E=2,h=m.trimStart()):k?E=e[1].length+1:(E=m.search(this.rules.other.nonSpaceChar),E=E>4?1:E,h=m.slice(E),E+=e[1].length),k&&this.rules.other.blankLine.test(x)&&(p+=x+`
`,t=t.substring(x.length+1),v=!0),!v){let D=this.rules.other.nextBulletRegex(E),B=this.rules.other.hrRegex(E),Y=this.rules.other.fencesBeginRegex(E),S=this.rules.other.headingBeginRegex(E),V=this.rules.other.htmlBeginRegex(E),K=this.rules.other.blockquoteBeginRegex(E);for(;t;){let O=t.split(`
`,1)[0],J;if(x=O,this.options.pedantic?(x=x.replace(this.rules.other.listReplaceNesting,"  "),J=x):J=x.replace(this.rules.other.tabCharGlobal,"    "),Y.test(x)||S.test(x)||V.test(x)||K.test(x)||D.test(x)||B.test(x))break;if(J.search(this.rules.other.nonSpaceChar)>=E||!x.trim())h+=`
`+J.slice(E);else{if(k||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||Y.test(m)||S.test(m)||B.test(m))break;h+=`
`+x}k=!x.trim(),p+=O+`
`,t=t.substring(O.length+1),m=J.slice(E)}}i.loose||(u?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(u=!0)),i.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(h),loose:!1,text:h,tokens:[]}),i.raw+=p}let d=i.items.at(-1);if(d)d.raw=d.raw.trimEnd(),d.text=d.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let v of i.items){if(this.lexer.state.top=!1,v.tokens=this.lexer.blockTokens(v.text,[]),v.task){if(v.text=v.text.replace(this.rules.other.listReplaceTask,""),((n=v.tokens[0])==null?void 0:n.type)==="text"||((r=v.tokens[0])==null?void 0:r.type)==="paragraph"){v.tokens[0].raw=v.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),v.tokens[0].text=v.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let h=this.lexer.inlineQueue.length-1;h>=0;h--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[h].src)){this.lexer.inlineQueue[h].src=this.lexer.inlineQueue[h].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(v.raw);if(p){let h={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};v.checked=h.checked,i.loose?v.tokens[0]&&["paragraph","text"].includes(v.tokens[0].type)&&"tokens"in v.tokens[0]&&v.tokens[0].tokens?(v.tokens[0].raw=h.raw+v.tokens[0].raw,v.tokens[0].text=h.raw+v.tokens[0].text,v.tokens[0].tokens.unshift(h)):v.tokens.unshift({type:"paragraph",raw:h.raw,text:h.raw,tokens:[h]}):v.tokens.unshift(h)}}if(!i.loose){let p=v.tokens.filter(m=>m.type==="space"),h=p.length>0&&p.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=h}}if(i.loose)for(let v of i.items){v.loose=!0;for(let p of v.tokens)p.type==="text"&&(p.type="paragraph")}return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:a}}}table(t){var i;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=lv(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(i=e[3])!=null&&i.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let l of r)this.rules.other.tableAlignRight.test(l)?s.align.push("right"):this.rules.other.tableAlignCenter.test(l)?s.align.push("center"):this.rules.other.tableAlignLeft.test(l)?s.align.push("left"):s.align.push(null);for(let l=0;l<n.length;l++)s.header.push({text:n[l],tokens:this.lexer.inline(n[l]),header:!0,align:s.align[l]});for(let l of a)s.rows.push(lv(l,s.header.length).map((u,d)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:s.align[d]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=Oi(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Jx(e[2],"()");if(s===-2)return;if(s>-1){let i=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,i).trim(),e[3]=""}}let r=e[2],a="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],a=s[3])}else a=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),cv(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=e[r.toLowerCase()];if(!a){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return cv(n,a,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,u=0,d=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,e=e.slice(-1*t.length+a);(r=d.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(i=[...s].length,r[3]||r[4]){l+=i;continue}else if((r[5]||r[6])&&a%3&&!((a+i)%3)){u+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l+u);let v=[...r[0]][0].length,p=t.slice(0,a+r.index+v+i);if(Math.min(a,i)%2){let m=p.slice(1,-1);return{type:"em",raw:p,text:m,tokens:this.lexer.inlineTokens(m)}}let h=p.slice(2,-2);return{type:"strong",raw:p,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let r=this.rules.inline.delLDelim.exec(t);if(r&&(!r[1]||!n||this.rules.inline.punctuation.exec(n))){let a=[...r[0]].length-1,s,i,l=a,u=this.rules.inline.delRDelim;for(u.lastIndex=0,e=e.slice(-1*t.length+a);(r=u.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s||(i=[...s].length,i!==a))continue;if(r[3]||r[4]){l+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l);let d=[...r[0]][0].length,v=t.slice(0,a+r.index+d+i),p=v.slice(a,-a);return{type:"del",raw:v,text:p,tokens:this.lexer.inlineTokens(p)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let r,a;if(e[2]==="@")r=e[0],a="mailto:"+r;else{let s;do s=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(s!==e[0]);r=e[0],e[1]==="www."?a="http://"+e[0]:a=e[0]}return{type:"link",raw:e[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Ir=class Ru{constructor(e){ht(this,"tokens");ht(this,"options");ht(this,"state");ht(this,"inlineQueue");ht(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Ps,this.options.tokenizer=this.options.tokenizer||new Al,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Fn,block:Zo.normal,inline:Mi.normal};this.options.pedantic?(n.block=Zo.pedantic,n.inline=Mi.pedantic):this.options.gfm&&(n.block=Zo.gfm,this.options.breaks?n.inline=Mi.breaks:n.inline=Mi.gfm),this.tokenizer.rules=n}static get rules(){return{block:Zo,inline:Mi}}static lex(e,n){return new Ru(n).lex(e)}static lexInline(e,n){return new Ru(n).inlineTokens(e)}lex(e){e=e.replace(Fn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){var a,s,i;for(this.options.pedantic&&(e=e.replace(Fn.tabCharGlobal,"    ").replace(Fn.spaceLine,""));e;){let l;if((s=(a=this.options.extensions)==null?void 0:a.block)!=null&&s.some(d=>(l=d.call({lexer:this},e,n))?(e=e.substring(l.raw.length),n.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);let d=n.at(-1);l.raw.length===1&&d!==void 0?d.raw+=`
`:n.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);let d=n.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+l.raw,d.text+=`
`+l.text,this.inlineQueue.at(-1).src=d.text):n.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);let d=n.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+l.raw,d.text+=`
`+l.raw,this.inlineQueue.at(-1).src=d.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title},n.push(l));continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),n.push(l);continue}let u=e;if((i=this.options.extensions)!=null&&i.startBlock){let d=1/0,v=e.slice(1),p;this.options.extensions.startBlock.forEach(h=>{p=h.call({lexer:this},v),typeof p=="number"&&p>=0&&(d=Math.min(d,p))}),d<1/0&&d>=0&&(u=e.substring(0,d+1))}if(this.state.top&&(l=this.tokenizer.paragraph(u))){let d=n.at(-1);r&&(d==null?void 0:d.type)==="paragraph"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+l.raw,d.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):n.push(l),r=u.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);let d=n.at(-1);(d==null?void 0:d.type)==="text"?(d.raw+=(d.raw.endsWith(`
`)?"":`
`)+l.raw,d.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):n.push(l);continue}if(e){let d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var u,d,v,p,h;let r=e,a=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)m.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=a[2]?a[2].length:0,r=r.slice(0,a.index+s)+"["+"a".repeat(a[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=((d=(u=this.options.hooks)==null?void 0:u.emStrongMask)==null?void 0:d.call({lexer:this},r))??r;let i=!1,l="";for(;e;){i||(l=""),i=!1;let m;if((p=(v=this.options.extensions)==null?void 0:v.inline)!=null&&p.some(k=>(m=k.call({lexer:this},e,n))?(e=e.substring(m.raw.length),n.push(m),!0):!1))continue;if(m=this.tokenizer.escape(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.tag(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.link(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(m.raw.length);let k=n.at(-1);m.type==="text"&&(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(m=this.tokenizer.emStrong(e,r,l)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.codespan(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.br(e)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.del(e,r,l)){e=e.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.autolink(e)){e=e.substring(m.raw.length),n.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(e))){e=e.substring(m.raw.length),n.push(m);continue}let x=e;if((h=this.options.extensions)!=null&&h.startInline){let k=1/0,E=e.slice(1),D;this.options.extensions.startInline.forEach(B=>{D=B.call({lexer:this},E),typeof D=="number"&&D>=0&&(k=Math.min(k,D))}),k<1/0&&k>=0&&(x=e.substring(0,k+1))}if(m=this.tokenizer.inlineText(x)){e=e.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(l=m.raw.slice(-1)),i=!0;let k=n.at(-1);(k==null?void 0:k.type)==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(e){let k="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return n}},Tl=class{constructor(t){ht(this,"options");ht(this,"parser");this.options=t||Ps}space(t){return""}code({text:t,lang:e,escaped:n}){var s;let r=(s=(e||"").match(Fn.notSpaceStart))==null?void 0:s[0],a=t.replace(Fn.endingNewline,"")+`
`;return r?'<pre><code class="language-'+ua(r)+'">'+(n?a:ua(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:ua(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let i=0;i<t.items.length;i++){let l=t.items[i];r+=this.listitem(l)}let a=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+a+s+`>
`+r+"</"+a+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);e+=this.tablerow({text:n});let r="";for(let a=0;a<t.rows.length;a++){let s=t.rows[a];n="";for(let i=0;i<s.length;i++)n+=this.tablecell(s[i]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${ua(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),a=ov(t);if(a===null)return r;t=a;let s='<a href="'+t+'"';return e&&(s+=' title="'+ua(e)+'"'),s+=">"+r+"</a>",s}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let a=ov(t);if(a===null)return ua(n);t=a;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${ua(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:ua(t.text)}},jd=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},Pr=class Lu{constructor(e){ht(this,"options");ht(this,"renderer");ht(this,"textRenderer");this.options=e||Ps,this.options.renderer=this.options.renderer||new Tl,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new jd}static parse(e,n){return new Lu(n).parse(e)}static parseInline(e,n){return new Lu(n).parseInline(e)}parse(e){var r,a;let n="";for(let s=0;s<e.length;s++){let i=e[s];if((a=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&a[i.type]){let u=i,d=this.options.extensions.renderers[u.type].call({parser:this},u);if(d!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(u.type)){n+=d||"";continue}}let l=i;switch(l.type){case"space":{n+=this.renderer.space(l);break}case"hr":{n+=this.renderer.hr(l);break}case"heading":{n+=this.renderer.heading(l);break}case"code":{n+=this.renderer.code(l);break}case"table":{n+=this.renderer.table(l);break}case"blockquote":{n+=this.renderer.blockquote(l);break}case"list":{n+=this.renderer.list(l);break}case"checkbox":{n+=this.renderer.checkbox(l);break}case"html":{n+=this.renderer.html(l);break}case"def":{n+=this.renderer.def(l);break}case"paragraph":{n+=this.renderer.paragraph(l);break}case"text":{n+=this.renderer.text(l);break}default:{let u='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return n}parseInline(e,n=this.renderer){var a,s;let r="";for(let i=0;i<e.length;i++){let l=e[i];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[l.type]){let d=this.options.extensions.renderers[l.type].call({parser:this},l);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){r+=d||"";continue}}let u=l;switch(u.type){case"escape":{r+=n.text(u);break}case"html":{r+=n.html(u);break}case"link":{r+=n.link(u);break}case"image":{r+=n.image(u);break}case"checkbox":{r+=n.checkbox(u);break}case"strong":{r+=n.strong(u);break}case"em":{r+=n.em(u);break}case"codespan":{r+=n.codespan(u);break}case"br":{r+=n.br(u);break}case"del":{r+=n.del(u);break}case"text":{r+=n.text(u);break}default:{let d='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return r}},il,Fi=(il=class{constructor(t){ht(this,"options");ht(this,"block");this.options=t||Ps}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?Ir.lex:Ir.lexInline}provideParser(){return this.block?Pr.parse:Pr.parseInline}},ht(il,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ht(il,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),il),tk=class{constructor(...t){ht(this,"defaults",Id());ht(this,"options",this.setOptions);ht(this,"parse",this.parseMarkdown(!0));ht(this,"parseInline",this.parseMarkdown(!1));ht(this,"Parser",Pr);ht(this,"Renderer",Tl);ht(this,"TextRenderer",jd);ht(this,"Lexer",Ir);ht(this,"Tokenizer",Al);ht(this,"Hooks",Fi);this.use(...t)}walkTokens(t,e){var r,a;let n=[];for(let s of t)switch(n=n.concat(e.call(this,s)),s.type){case"table":{let i=s;for(let l of i.header)n=n.concat(this.walkTokens(l.tokens,e));for(let l of i.rows)for(let u of l)n=n.concat(this.walkTokens(u.tokens,e));break}case"list":{let i=s;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=s;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[i.type]?this.defaults.extensions.childTokens[i.type].forEach(l=>{let u=i[l].flat(1/0);n=n.concat(this.walkTokens(u,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let s=e.renderers[a.name];s?e.renderers[a.name]=function(...i){let l=a.renderer.apply(this,i);return l===!1&&(l=s.apply(this,i)),l}:e.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[a.level];s?s.unshift(a.tokenizer):e[a.level]=[a.tokenizer],a.start&&(a.level==="block"?e.startBlock?e.startBlock.push(a.start):e.startBlock=[a.start]:a.level==="inline"&&(e.startInline?e.startInline.push(a.start):e.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(e.childTokens[a.name]=a.childTokens)}),r.extensions=e),n.renderer){let a=this.defaults.renderer||new Tl(this.defaults);for(let s in n.renderer){if(!(s in a))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let i=s,l=n.renderer[i],u=a[i];a[i]=(...d)=>{let v=l.apply(a,d);return v===!1&&(v=u.apply(a,d)),v||""}}r.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Al(this.defaults);for(let s in n.tokenizer){if(!(s in a))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let i=s,l=n.tokenizer[i],u=a[i];a[i]=(...d)=>{let v=l.apply(a,d);return v===!1&&(v=u.apply(a,d)),v}}r.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Fi;for(let s in n.hooks){if(!(s in a))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let i=s,l=n.hooks[i],u=a[i];Fi.passThroughHooks.has(s)?a[i]=d=>{if(this.defaults.async&&Fi.passThroughHooksRespectAsync.has(s))return(async()=>{let p=await l.call(a,d);return u.call(a,p)})();let v=l.call(a,d);return u.call(a,v)}:a[i]=(...d)=>{if(this.defaults.async)return(async()=>{let p=await l.apply(a,d);return p===!1&&(p=await u.apply(a,d)),p})();let v=l.apply(a,d);return v===!1&&(v=u.apply(a,d)),v}}r.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(i){let l=[];return l.push(s.call(this,i)),a&&(l=l.concat(a.call(this,i))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Ir.lex(t,e??this.defaults)}parser(t,e){return Pr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},a={...this.defaults,...r},s=this.onError(!!a.silent,!!a.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(a.hooks&&(a.hooks.options=a,a.hooks.block=t),a.async)return(async()=>{let i=a.hooks?await a.hooks.preprocess(e):e,l=await(a.hooks?await a.hooks.provideLexer():t?Ir.lex:Ir.lexInline)(i,a),u=a.hooks?await a.hooks.processAllTokens(l):l;a.walkTokens&&await Promise.all(this.walkTokens(u,a.walkTokens));let d=await(a.hooks?await a.hooks.provideParser():t?Pr.parse:Pr.parseInline)(u,a);return a.hooks?await a.hooks.postprocess(d):d})().catch(s);try{a.hooks&&(e=a.hooks.preprocess(e));let i=(a.hooks?a.hooks.provideLexer():t?Ir.lex:Ir.lexInline)(e,a);a.hooks&&(i=a.hooks.processAllTokens(i)),a.walkTokens&&this.walkTokens(i,a.walkTokens);let l=(a.hooks?a.hooks.provideParser():t?Pr.parse:Pr.parseInline)(i,a);return a.hooks&&(l=a.hooks.postprocess(l)),l}catch(i){return s(i)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+ua(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},bs=new tk;function Vt(t,e){return bs.parse(t,e)}Vt.options=Vt.setOptions=function(t){return bs.setOptions(t),Vt.defaults=bs.defaults,rg(Vt.defaults),Vt};Vt.getDefaults=Id;Vt.defaults=Ps;Vt.use=function(...t){return bs.use(...t),Vt.defaults=bs.defaults,rg(Vt.defaults),Vt};Vt.walkTokens=function(t,e){return bs.walkTokens(t,e)};Vt.parseInline=bs.parseInline;Vt.Parser=Pr;Vt.parser=Pr.parse;Vt.Renderer=Tl;Vt.TextRenderer=jd;Vt.Lexer=Ir;Vt.lexer=Ir.lex;Vt.Tokenizer=Al;Vt.Hooks=Fi;Vt.parse=Vt;Vt.options;Vt.setOptions;Vt.use;Vt.walkTokens;Vt.parseInline;Pr.parse;Ir.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:pg,setPrototypeOf:uv,isFrozen:nk,getPrototypeOf:rk,getOwnPropertyDescriptor:ak}=Object;let{freeze:Kn,seal:br,create:ju}=Object,{apply:zu,construct:qu}=typeof Reflect<"u"&&Reflect;Kn||(Kn=function(e){return e});br||(br=function(e){return e});zu||(zu=function(e,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return e.apply(n,a)});qu||(qu=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new e(...r)});const Qo=Hn(Array.prototype.forEach),sk=Hn(Array.prototype.lastIndexOf),dv=Hn(Array.prototype.pop),Ni=Hn(Array.prototype.push),ik=Hn(Array.prototype.splice),hl=Hn(String.prototype.toLowerCase),Yc=Hn(String.prototype.toString),Xc=Hn(String.prototype.match),Di=Hn(String.prototype.replace),ok=Hn(String.prototype.indexOf),lk=Hn(String.prototype.trim),Tr=Hn(Object.prototype.hasOwnProperty),qn=Hn(RegExp.prototype.test),Ri=ck(TypeError);function Hn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return zu(t,e,r)}}function ck(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return qu(t,n)}}function Nt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hl;uv&&uv(t,null);let r=e.length;for(;r--;){let a=e[r];if(typeof a=="string"){const s=n(a);s!==a&&(nk(e)||(e[r]=s),a=s)}t[a]=!0}return t}function uk(t){for(let e=0;e<t.length;e++)Tr(t,e)||(t[e]=null);return t}function Hr(t){const e=ju(null);for(const[n,r]of pg(t))Tr(t,n)&&(Array.isArray(r)?e[n]=uk(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=Hr(r):e[n]=r);return e}function Li(t,e){for(;t!==null;){const r=ak(t,e);if(r){if(r.get)return Hn(r.get);if(typeof r.value=="function")return Hn(r.value)}t=rk(t)}function n(){return null}return n}const fv=Kn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Zc=Kn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Qc=Kn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),dk=Kn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Jc=Kn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),fk=Kn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),vv=Kn(["#text"]),hv=Kn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),$c=Kn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),pv=Kn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Jo=Kn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),vk=br(/\{\{[\w\W]*|[\w\W]*\}\}/gm),hk=br(/<%[\w\W]*|[\w\W]*%>/gm),pk=br(/\$\{[\w\W]*/gm),gk=br(/^data-[\-\w.\u00B7-\uFFFF]+$/),mk=br(/^aria-[\-\w]+$/),gg=br(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),yk=br(/^(?:\w+script|data):/i),_k=br(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),mg=br(/^html$/i),bk=br(/^[a-z][.\w]*(-[.\w]+)+$/i);var gv=Object.freeze({__proto__:null,ARIA_ATTR:mk,ATTR_WHITESPACE:_k,CUSTOM_ELEMENT:bk,DATA_ATTR:gk,DOCTYPE_NAME:mg,ERB_EXPR:hk,IS_ALLOWED_URI:gg,IS_SCRIPT_OR_DATA:yk,MUSTACHE_EXPR:vk,TMPLIT_EXPR:pk});const ji={element:1,text:3,progressingInstruction:7,comment:8,document:9},wk=function(){return typeof window>"u"?null:window},xk=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},mv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function yg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wk();const e=ot=>yg(ot);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==ji.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:l,Element:u,NodeFilter:d,NamedNodeMap:v=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:h,trustedTypes:m}=t,x=u.prototype,k=Li(x,"cloneNode"),E=Li(x,"remove"),D=Li(x,"nextSibling"),B=Li(x,"childNodes"),Y=Li(x,"parentNode");if(typeof i=="function"){const ot=n.createElement("template");ot.content&&ot.content.ownerDocument&&(n=ot.content.ownerDocument)}let S,V="";const{implementation:K,createNodeIterator:O,createDocumentFragment:J,getElementsByTagName:ie}=n,{importNode:ke}=r;let F=mv();e.isSupported=typeof pg=="function"&&typeof Y=="function"&&K&&K.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:I,ERB_EXPR:j,TMPLIT_EXPR:C,DATA_ATTR:N,ARIA_ATTR:M,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:H,CUSTOM_ELEMENT:L}=gv;let{IS_ALLOWED_URI:q}=gv,te=null;const ae=Nt({},[...fv,...Zc,...Qc,...Jc,...vv]);let W=null;const G=Nt({},[...hv,...$c,...pv,...Jo]);let ne=Object.seal(ju(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),re=null,pe=null;const ye=Object.seal(ju(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Se=!0,Z=!0,he=!1,be=!0,Ie=!1,Ye=!0,Je=!1,ct=!1,qe=!1,Oe=!1,ze=!1,Ne=!1,Fe=!0,Ke=!1;const $e="user-content-";let Ze=!0,Ge=!1,tt={},nt=null;const ft=Nt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let mt=null;const vt=Nt({},["audio","video","img","source","image","track"]);let St=null;const bt=Nt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pt="http://www.w3.org/1998/Math/MathML",yt="http://www.w3.org/2000/svg",dt="http://www.w3.org/1999/xhtml";let Le=dt,Rt=!1,At=null;const Gt=Nt({},[pt,yt,dt],Yc);let De=Nt({},["mi","mo","mn","ms","mtext"]),Qt=Nt({},["annotation-xml"]);const Gn=Nt({},["title","style","font","a","script"]);let _e=null;const ln=["application/xhtml+xml","text/html"],En="text/html";let Ct=null,Mn=null;const it=n.createElement("form"),ut=function(le){return le instanceof RegExp||le instanceof Function},Pt=function(){let le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Mn&&Mn===le)){if((!le||typeof le!="object")&&(le={}),le=Hr(le),_e=ln.indexOf(le.PARSER_MEDIA_TYPE)===-1?En:le.PARSER_MEDIA_TYPE,Ct=_e==="application/xhtml+xml"?Yc:hl,te=Tr(le,"ALLOWED_TAGS")?Nt({},le.ALLOWED_TAGS,Ct):ae,W=Tr(le,"ALLOWED_ATTR")?Nt({},le.ALLOWED_ATTR,Ct):G,At=Tr(le,"ALLOWED_NAMESPACES")?Nt({},le.ALLOWED_NAMESPACES,Yc):Gt,St=Tr(le,"ADD_URI_SAFE_ATTR")?Nt(Hr(bt),le.ADD_URI_SAFE_ATTR,Ct):bt,mt=Tr(le,"ADD_DATA_URI_TAGS")?Nt(Hr(vt),le.ADD_DATA_URI_TAGS,Ct):vt,nt=Tr(le,"FORBID_CONTENTS")?Nt({},le.FORBID_CONTENTS,Ct):ft,re=Tr(le,"FORBID_TAGS")?Nt({},le.FORBID_TAGS,Ct):Hr({}),pe=Tr(le,"FORBID_ATTR")?Nt({},le.FORBID_ATTR,Ct):Hr({}),tt=Tr(le,"USE_PROFILES")?le.USE_PROFILES:!1,Se=le.ALLOW_ARIA_ATTR!==!1,Z=le.ALLOW_DATA_ATTR!==!1,he=le.ALLOW_UNKNOWN_PROTOCOLS||!1,be=le.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ie=le.SAFE_FOR_TEMPLATES||!1,Ye=le.SAFE_FOR_XML!==!1,Je=le.WHOLE_DOCUMENT||!1,Oe=le.RETURN_DOM||!1,ze=le.RETURN_DOM_FRAGMENT||!1,Ne=le.RETURN_TRUSTED_TYPE||!1,qe=le.FORCE_BODY||!1,Fe=le.SANITIZE_DOM!==!1,Ke=le.SANITIZE_NAMED_PROPS||!1,Ze=le.KEEP_CONTENT!==!1,Ge=le.IN_PLACE||!1,q=le.ALLOWED_URI_REGEXP||gg,Le=le.NAMESPACE||dt,De=le.MATHML_TEXT_INTEGRATION_POINTS||De,Qt=le.HTML_INTEGRATION_POINTS||Qt,ne=le.CUSTOM_ELEMENT_HANDLING||{},le.CUSTOM_ELEMENT_HANDLING&&ut(le.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ne.tagNameCheck=le.CUSTOM_ELEMENT_HANDLING.tagNameCheck),le.CUSTOM_ELEMENT_HANDLING&&ut(le.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ne.attributeNameCheck=le.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),le.CUSTOM_ELEMENT_HANDLING&&typeof le.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ne.allowCustomizedBuiltInElements=le.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ie&&(Z=!1),ze&&(Oe=!0),tt&&(te=Nt({},vv),W=[],tt.html===!0&&(Nt(te,fv),Nt(W,hv)),tt.svg===!0&&(Nt(te,Zc),Nt(W,$c),Nt(W,Jo)),tt.svgFilters===!0&&(Nt(te,Qc),Nt(W,$c),Nt(W,Jo)),tt.mathMl===!0&&(Nt(te,Jc),Nt(W,pv),Nt(W,Jo))),le.ADD_TAGS&&(typeof le.ADD_TAGS=="function"?ye.tagCheck=le.ADD_TAGS:(te===ae&&(te=Hr(te)),Nt(te,le.ADD_TAGS,Ct))),le.ADD_ATTR&&(typeof le.ADD_ATTR=="function"?ye.attributeCheck=le.ADD_ATTR:(W===G&&(W=Hr(W)),Nt(W,le.ADD_ATTR,Ct))),le.ADD_URI_SAFE_ATTR&&Nt(St,le.ADD_URI_SAFE_ATTR,Ct),le.FORBID_CONTENTS&&(nt===ft&&(nt=Hr(nt)),Nt(nt,le.FORBID_CONTENTS,Ct)),le.ADD_FORBID_CONTENTS&&(nt===ft&&(nt=Hr(nt)),Nt(nt,le.ADD_FORBID_CONTENTS,Ct)),Ze&&(te["#text"]=!0),Je&&Nt(te,["html","head","body"]),te.table&&(Nt(te,["tbody"]),delete re.tbody),le.TRUSTED_TYPES_POLICY){if(typeof le.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ri('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof le.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ri('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');S=le.TRUSTED_TYPES_POLICY,V=S.createHTML("")}else S===void 0&&(S=xk(m,a)),S!==null&&typeof V=="string"&&(V=S.createHTML(""));Kn&&Kn(le),Mn=le}},$t=Nt({},[...Zc,...Qc,...dk]),_t=Nt({},[...Jc,...fk]),jt=function(le){let Be=Y(le);(!Be||!Be.tagName)&&(Be={namespaceURI:Le,tagName:"template"});const Ue=hl(le.tagName),Ft=hl(Be.tagName);return At[le.namespaceURI]?le.namespaceURI===yt?Be.namespaceURI===dt?Ue==="svg":Be.namespaceURI===pt?Ue==="svg"&&(Ft==="annotation-xml"||De[Ft]):!!$t[Ue]:le.namespaceURI===pt?Be.namespaceURI===dt?Ue==="math":Be.namespaceURI===yt?Ue==="math"&&Qt[Ft]:!!_t[Ue]:le.namespaceURI===dt?Be.namespaceURI===yt&&!Qt[Ft]||Be.namespaceURI===pt&&!De[Ft]?!1:!_t[Ue]&&(Gn[Ue]||!$t[Ue]):!!(_e==="application/xhtml+xml"&&At[le.namespaceURI]):!1},fn=function(le){Ni(e.removed,{element:le});try{Y(le).removeChild(le)}catch{E(le)}},cn=function(le,Be){try{Ni(e.removed,{attribute:Be.getAttributeNode(le),from:Be})}catch{Ni(e.removed,{attribute:null,from:Be})}if(Be.removeAttribute(le),le==="is")if(Oe||ze)try{fn(Be)}catch{}else try{Be.setAttribute(le,"")}catch{}},Jt=function(le){let Be=null,Ue=null;if(qe)le="<remove></remove>"+le;else{const un=Xc(le,/^[\r\n\t ]+/);Ue=un&&un[0]}_e==="application/xhtml+xml"&&Le===dt&&(le='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+le+"</body></html>");const Ft=S?S.createHTML(le):le;if(Le===dt)try{Be=new h().parseFromString(Ft,_e)}catch{}if(!Be||!Be.documentElement){Be=K.createDocument(Le,"template",null);try{Be.documentElement.innerHTML=Rt?V:Ft}catch{}}const nn=Be.body||Be.documentElement;return le&&Ue&&nn.insertBefore(n.createTextNode(Ue),nn.childNodes[0]||null),Le===dt?ie.call(Be,Je?"html":"body")[0]:Je?Be.documentElement:nn},en=function(le){return O.call(le.ownerDocument||le,le,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},jn=function(le){return le instanceof p&&(typeof le.nodeName!="string"||typeof le.textContent!="string"||typeof le.removeChild!="function"||!(le.attributes instanceof v)||typeof le.removeAttribute!="function"||typeof le.setAttribute!="function"||typeof le.namespaceURI!="string"||typeof le.insertBefore!="function"||typeof le.hasChildNodes!="function")},On=function(le){return typeof l=="function"&&le instanceof l};function Nn(ot,le,Be){Qo(ot,Ue=>{Ue.call(e,le,Be,Mn)})}const xr=function(le){let Be=null;if(Nn(F.beforeSanitizeElements,le,null),jn(le))return fn(le),!0;const Ue=Ct(le.nodeName);if(Nn(F.uponSanitizeElement,le,{tagName:Ue,allowedTags:te}),Ye&&le.hasChildNodes()&&!On(le.firstElementChild)&&qn(/<[/\w!]/g,le.innerHTML)&&qn(/<[/\w!]/g,le.textContent)||le.nodeType===ji.progressingInstruction||Ye&&le.nodeType===ji.comment&&qn(/<[/\w]/g,le.data))return fn(le),!0;if(!(ye.tagCheck instanceof Function&&ye.tagCheck(Ue))&&(!te[Ue]||re[Ue])){if(!re[Ue]&&Io(Ue)&&(ne.tagNameCheck instanceof RegExp&&qn(ne.tagNameCheck,Ue)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(Ue)))return!1;if(Ze&&!nt[Ue]){const Ft=Y(le)||le.parentNode,nn=B(le)||le.childNodes;if(nn&&Ft){const un=nn.length;for(let hn=un-1;hn>=0;--hn){const Un=k(nn[hn],!0);Un.__removalCount=(le.__removalCount||0)+1,Ft.insertBefore(Un,D(le))}}}return fn(le),!0}return le instanceof u&&!jt(le)||(Ue==="noscript"||Ue==="noembed"||Ue==="noframes")&&qn(/<\/no(script|embed|frames)/i,le.innerHTML)?(fn(le),!0):(Ie&&le.nodeType===ji.text&&(Be=le.textContent,Qo([I,j,C],Ft=>{Be=Di(Be,Ft," ")}),le.textContent!==Be&&(Ni(e.removed,{element:le.cloneNode()}),le.textContent=Be)),Nn(F.afterSanitizeElements,le,null),!1)},Wa=function(le,Be,Ue){if(Fe&&(Be==="id"||Be==="name")&&(Ue in n||Ue in it))return!1;if(!(Z&&!pe[Be]&&qn(N,Be))){if(!(Se&&qn(M,Be))){if(!(ye.attributeCheck instanceof Function&&ye.attributeCheck(Be,le))){if(!W[Be]||pe[Be]){if(!(Io(le)&&(ne.tagNameCheck instanceof RegExp&&qn(ne.tagNameCheck,le)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(le))&&(ne.attributeNameCheck instanceof RegExp&&qn(ne.attributeNameCheck,Be)||ne.attributeNameCheck instanceof Function&&ne.attributeNameCheck(Be,le))||Be==="is"&&ne.allowCustomizedBuiltInElements&&(ne.tagNameCheck instanceof RegExp&&qn(ne.tagNameCheck,Ue)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(Ue))))return!1}else if(!St[Be]){if(!qn(q,Di(Ue,H,""))){if(!((Be==="src"||Be==="xlink:href"||Be==="href")&&le!=="script"&&ok(Ue,"data:")===0&&mt[le])){if(!(he&&!qn($,Di(Ue,H,"")))){if(Ue)return!1}}}}}}}return!0},Io=function(le){return le!=="annotation-xml"&&Xc(le,L)},kr=function(le){Nn(F.beforeSanitizeAttributes,le,null);const{attributes:Be}=le;if(!Be||jn(le))return;const Ue={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:W,forceKeepAttr:void 0};let Ft=Be.length;for(;Ft--;){const nn=Be[Ft],{name:un,namespaceURI:hn,value:Un}=nn,Br=Ct(un),Ya=Un;let sn=un==="value"?Ya:lk(Ya);if(Ue.attrName=Br,Ue.attrValue=sn,Ue.keepAttr=!0,Ue.forceKeepAttr=void 0,Nn(F.uponSanitizeAttribute,le,Ue),sn=Ue.attrValue,Ke&&(Br==="id"||Br==="name")&&(cn(un,le),sn=$e+sn),Ye&&qn(/((--!?|])>)|<\/(style|title|textarea)/i,sn)){cn(un,le);continue}if(Br==="attributename"&&Xc(sn,"href")){cn(un,le);continue}if(Ue.forceKeepAttr)continue;if(!Ue.keepAttr){cn(un,le);continue}if(!be&&qn(/\/>/i,sn)){cn(un,le);continue}Ie&&Qo([I,j,C],Xa=>{sn=Di(sn,Xa," ")});const yi=Ct(le.nodeName);if(!Wa(yi,Br,sn)){cn(un,le);continue}if(S&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!hn)switch(m.getAttributeType(yi,Br)){case"TrustedHTML":{sn=S.createHTML(sn);break}case"TrustedScriptURL":{sn=S.createScriptURL(sn);break}}if(sn!==Ya)try{hn?le.setAttributeNS(hn,un,sn):le.setAttribute(un,sn),jn(le)?fn(le):dv(e.removed)}catch{cn(un,le)}}Nn(F.afterSanitizeAttributes,le,null)},Po=function ot(le){let Be=null;const Ue=en(le);for(Nn(F.beforeSanitizeShadowDOM,le,null);Be=Ue.nextNode();)Nn(F.uponSanitizeShadowNode,Be,null),xr(Be),kr(Be),Be.content instanceof s&&ot(Be.content);Nn(F.afterSanitizeShadowDOM,le,null)};return e.sanitize=function(ot){let le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Be=null,Ue=null,Ft=null,nn=null;if(Rt=!ot,Rt&&(ot="<!-->"),typeof ot!="string"&&!On(ot))if(typeof ot.toString=="function"){if(ot=ot.toString(),typeof ot!="string")throw Ri("dirty is not a string, aborting")}else throw Ri("toString is not a function");if(!e.isSupported)return ot;if(ct||Pt(le),e.removed=[],typeof ot=="string"&&(Ge=!1),Ge){if(ot.nodeName){const Un=Ct(ot.nodeName);if(!te[Un]||re[Un])throw Ri("root node is forbidden and cannot be sanitized in-place")}}else if(ot instanceof l)Be=Jt("<!---->"),Ue=Be.ownerDocument.importNode(ot,!0),Ue.nodeType===ji.element&&Ue.nodeName==="BODY"||Ue.nodeName==="HTML"?Be=Ue:Be.appendChild(Ue);else{if(!Oe&&!Ie&&!Je&&ot.indexOf("<")===-1)return S&&Ne?S.createHTML(ot):ot;if(Be=Jt(ot),!Be)return Oe?null:Ne?V:""}Be&&qe&&fn(Be.firstChild);const un=en(Ge?ot:Be);for(;Ft=un.nextNode();)xr(Ft),kr(Ft),Ft.content instanceof s&&Po(Ft.content);if(Ge)return ot;if(Oe){if(ze)for(nn=J.call(Be.ownerDocument);Be.firstChild;)nn.appendChild(Be.firstChild);else nn=Be;return(W.shadowroot||W.shadowrootmode)&&(nn=ke.call(r,nn,!0)),nn}let hn=Je?Be.outerHTML:Be.innerHTML;return Je&&te["!doctype"]&&Be.ownerDocument&&Be.ownerDocument.doctype&&Be.ownerDocument.doctype.name&&qn(mg,Be.ownerDocument.doctype.name)&&(hn="<!DOCTYPE "+Be.ownerDocument.doctype.name+`>
`+hn),Ie&&Qo([I,j,C],Un=>{hn=Di(hn,Un," ")}),S&&Ne?S.createHTML(hn):hn},e.setConfig=function(){let ot=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Pt(ot),ct=!0},e.clearConfig=function(){Mn=null,ct=!1},e.isValidAttribute=function(ot,le,Be){Mn||Pt({});const Ue=Ct(ot),Ft=Ct(le);return Wa(Ue,Ft,Be)},e.addHook=function(ot,le){typeof le=="function"&&Ni(F[ot],le)},e.removeHook=function(ot,le){if(le!==void 0){const Be=sk(F[ot],le);return Be===-1?void 0:ik(F[ot],Be,1)[0]}return dv(F[ot])},e.removeHooks=function(ot){F[ot]=[]},e.removeAllHooks=function(){F=mv()},e}var kk=yg();function Sk(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${yv(t.from)} |`),e.push(`| **To** | ${yv(t.to)} |`),e.push(`| **Date** | ${kd(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?Ek(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function yv(t){return(t||"").replace(/\|/g,"\\|")}function Ek(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Bu(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function Ak(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),r=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||r>0&&r<=3)return!0;const a=e.toLowerCase();return a.includes("spacer")||a.includes("transparent")||a.includes("transp.gif")||a.includes("/track")&&a.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(a)?!0:a.includes("mail.google.com/mail/u/")&&a.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(a)||a.endsWith(".gif")&&a.includes("1x1"))}function Bu(t){var a;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const s=t.getAttribute("src")||"",i=t.getAttribute("alt")||"";return Ak(t,s)?"":`![${i}](${s})`}const n=Array.from(t.childNodes).map(Bu).join(""),r=n.trim();if(!r&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${r}

`;if(e==="blockquote")return`

> ${r.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const s=Number(e[1]);return`

${"#".repeat(s)} ${r}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((a=t.parentElement)==null?void 0:a.tagName.toLowerCase())==="ol"?"1.":"-"} ${r}
`;if(e==="a"){const s=t.getAttribute("href")||"";return!s||s.startsWith("mailto:")?r:r===s?s:`[${r}](${s})`}if(e==="strong"||e==="b")return`**${r}**`;if(e==="em"||e==="i")return`*${r}*`;if(e==="code")return`\`${r}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(i=>Bu(i).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const s=n.trim(),i=(s.match(/\|/g)||[]).length-1,l="| "+Array(Math.max(i,1)).fill("---").join(" | ")+" |";return`${s}${l}
`}return n}function Tk(t){return Mp(t,"md")}function _v(t,e,n="text/markdown;charset=utf-8"){const r=new Blob([t],{type:n}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function Ck(t){return t.raw||null}function Ik(t){const e=Ck(t);return e?JSON.stringify(e,null,2):"null"}function Pk(t){return Mp(t,"json")}var Mk=z('<button title="View as Markdown">.md</button>'),Ok=z('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),Nk=z('<pre class="md-raw svelte-1b0rzpb"> </pre>'),Dk=z('<div class="md-preview svelte-1b0rzpb"><!></div>'),Rk=z('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),Lk=z('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),jk=z('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),zk=z('<pre class="message-text svelte-1b0rzpb"> </pre>'),qk=z('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),Bk=z('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),Fk=z('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function Kk(t,e){at(e,!0);let n=Ae(e,"loading",3,!1);_n(()=>dr("MessageModal"));const r=new Vt.Renderer;r.link=({href:I,title:j,text:C})=>{const N=j?` title="${j}"`:"";return`<a href="${I}"${N} target="_blank" rel="noopener">${C}</a>`},Vt.setOptions({breaks:!0,gfm:!0,renderer:r});let a=Me("email"),s=Q(()=>e.message.body?Sk(e.message):""),i=Q(()=>Ik(e.message)),l=Me("raw");function u(I){P(a,o(a)===I?"email":I,!0),I==="markdown"&&P(l,"raw")}function d(){_v(o(s),Tk(e.message))}function v(){_v(o(i),Pk(e.message),"application/json;charset=utf-8")}function p(I){const j=Vt.parse(I);return kk.sanitize(j,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let h=Me(null);yn(()=>{var I;if(o(h)&&e.message.htmlBody&&!n()&&o(a)==="email"){const j=o(h).contentDocument||((I=o(h).contentWindow)==null?void 0:I.document);j&&(j.open(),j.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),j.close())}});var m=Fk();m.__click=function(...I){var j;(j=e.onclose)==null||j.apply(this,I)};var x=_(m);x.__click=I=>I.stopPropagation();var k=_(x),E=_(k),D=_(E),B=b(E,2),Y=_(B);let S;Y.__click=()=>u("json");var V=b(Y,2);{var K=I=>{var j=Mk();let C;j.__click=()=>u("markdown"),se(()=>C=xt(j,1,"action-btn svelte-1b0rzpb",null,C,{active:o(a)==="markdown"})),T(I,j)};ce(V,I=>{e.message.body&&I(K)})}var O=b(V,2);O.__click=function(...I){var j;(j=e.onclose)==null||j.apply(this,I)};var J=b(k,2);{var ie=I=>{var j=Ok(),C=Xe(j),N=b(_(C),2);N.__click=v;var M=b(C,2),$=_(M),H=_($);se(()=>ee(H,o(i))),T(I,j)},ke=I=>{var j=Rk(),C=Xe(j),N=_(C),M=_(N);let $;M.__click=()=>P(l,"raw");var H=b(M,2);let L;H.__click=()=>P(l,"preview");var q=b(N,2);q.__click=d;var te=b(C,2),ae=_(te);{var W=ne=>{var re=Nk(),pe=_(re);se(()=>ee(pe,o(s))),T(ne,re)},G=ne=>{var re=Dk(),pe=_(re);h_(pe,()=>p(o(s))),T(ne,re)};ce(ae,ne=>{o(l)==="raw"?ne(W):ne(G,!1)})}se(()=>{$=xt(M,1,"md-tab svelte-1b0rzpb",null,$,{active:o(l)==="raw"}),L=xt(H,1,"md-tab svelte-1b0rzpb",null,L,{active:o(l)==="preview"})}),T(I,j)},F=I=>{var j=Bk(),C=Xe(j),N=_(C),M=b(_(N),2),$=_(M),H=b(N,2),L=b(_(H),2),q=_(L),te=b(H,2),ae=b(_(te),2),W=_(ae),G=b(C,2),ne=_(G);{var re=Z=>{var he=Lk();T(Z,he)},pe=Z=>{var he=jk();Cs(he,be=>P(h,be),()=>o(h)),T(Z,he)},ye=Z=>{var he=zk(),be=_(he);se(()=>ee(be,e.message.body)),T(Z,he)},Se=Z=>{var he=qk();T(Z,he)};ce(ne,Z=>{n()?Z(re):e.message.htmlBody?Z(pe,1):e.message.body?Z(ye,2):Z(Se,!1)})}se(Z=>{ee($,e.message.from),ee(q,e.message.to),ee(W,Z)},[()=>kd(e.message.date)]),T(I,j)};ce(J,I=>{o(a)==="json"?I(ie):o(a)==="markdown"?I(ke,1):I(F,!1)})}se(()=>{ee(D,e.message.subject),S=xt(Y,1,"action-btn svelte-1b0rzpb",null,S,{active:o(a)==="json"})}),T(t,m),st()}Xt(["click"]);var Hk=z('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),Gk=z('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),Uk=z('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),Vk=z("<p> </p>"),Wk=z('<p>No emails in local storage. Click "Sync New" to download.</p>'),Yk=z('<div class="empty-state svelte-6ts5xm"><!></div>'),Xk=z('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),Zk=z('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function Qk(t,e){at(e,!0),_n(()=>dr("DashboardView"));let n=Ae(e,"error",3,null),r=Ae(e,"profile",3,null),a=Ae(e,"loadingProfile",3,!1),s=Ae(e,"emailMessages",19,()=>[]),i=Ae(e,"totalLocalMessages",3,0),l=Ae(e,"hasMoreLocal",3,!1),u=Ae(e,"loadingMessages",3,!1),d=Ae(e,"selectedMessage",3,null),v=Ae(e,"syncStatus",3,null),p=Ae(e,"syncProgress",3,null),h=Ae(e,"isSyncing",3,!1),m=Ae(e,"searchQuery",15);var x=Zk(),k=Xe(x),E=_(k);{var D=N=>{ng(N,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};ce(E,N=>{n()&&N(D)})}var B=b(E,2);Z1(B,{get profile(){return r()},get loadingProfile(){return a()},get onsignout(){return e.onsignout}});var Y=b(B,2);cx(Y,{get syncStatus(){return v()},get syncProgress(){return p()},get isSyncing(){return h()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var S=b(Y,2),V=_(S);V.__keydown=N=>N.key==="Enter"&&e.onsearch();var K=b(V,2);K.__click=function(...N){var M;(M=e.onsearch)==null||M.apply(this,N)};var O=_(K),J=b(S,2);{var ie=N=>{var M=Gk(),$=Xe(M),H=_($),L=_(H),q=b($,2);fx(q,{get messages(){return s()},get onselect(){return e.onviewmessage}});var te=b(q,2);{var ae=W=>{var G=Hk(),ne=_(G);ne.__click=function(...pe){var ye;(ye=e.onloadmore)==null||ye.apply(this,pe)};var re=_(ne);se(()=>{ne.disabled=u(),ee(re,u()?"Loading...":"Load More")}),T(W,G)};ce(te,W=>{l()&&W(ae)})}se(W=>ee(L,`Showing ${s().length??""} of ${W??""}
        ${m()?" matching":""} emails`),[()=>i().toLocaleString()]),T(N,M)},ke=N=>{var M=Uk();T(N,M)},F=N=>{var M=Yk(),$=_(M);{var H=q=>{var te=Vk(),ae=_(te);se(()=>ee(ae,`No emails match "${m()??""}".`)),T(q,te)},L=q=>{var te=Wk();T(q,te)};ce($,q=>{m()?q(H):q(L,!1)})}T(N,M)},I=N=>{var M=Xk();T(N,M)};ce(J,N=>{var M;s().length>0?N(ie):u()?N(ke,1):(M=v())!=null&&M.synced?N(F,2):N(I,!1)})}var j=b(k,2);{var C=N=>{Kk(N,{get message(){return d()},loading:!1,get onclose(){return e.onclosedetail}})};ce(j,N=>{d()&&N(C)})}se(()=>{K.disabled=u(),ee(O,u()?"Searching...":"Search")}),Zr(V,m),T(t,x),st()}Xt(["keydown","click"]);var Jk=z('<div class="dashboard svelte-1q5o2lv"><!></div>');function $k(t,e){at(e,!0);function n(be){be.key==="Escape"&&o(h)&&ae()}let r=null;_n(async()=>{if(window.addEventListener("keydown",n),!o(l)){const be=await Qr("googleClientId");P(l,be||i,!0),P(u,be||i,!0)}return()=>{window.removeEventListener("keydown",n),r&&clearTimeout(r)}});function a(){r&&clearTimeout(r);const be=Z0();if(be<=0)return;const Ie=Math.max(0,be-120*1e3);r=setTimeout(async()=>{try{const Ye=await tv();P(v,Ye.access_token,!0),a()}catch{P(v,null),P(p,null),P(S,"Session expired. Please sign in again.")}},Ie)}async function s(){if(X0())return o(v);try{const be=await tv();return P(v,be.access_token,!0),a(),o(v)}catch{return P(v,null),P(p,null),P(S,"Session expired. Please sign in again."),null}}const i="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let l=Me(Wt(i)),u=Me(Wt(i)),d=Me(!1),v=Me(null),p=Me(null),h=Me(null),m=Me(""),x=Me(Wt([])),k=Me(0),E=Me(0),D=Me(!1),B=Me(!1),Y=Me(!1),S=Me(null),V=Me(null),K=Me(null),O=Me(!1);const J=50;yn(()=>{o(v)&&(W(),H())});let ie=Q(()=>!o(l)),ke=Q(()=>o(l)===i),F=Q(()=>!!o(v)),I=Q(()=>o(x).length<o(k));yn(()=>{o(l)&&!o(d)&&nv(o(l)).then(async()=>{if(P(d,!0),!o(v)){const be=await tc();be&&(P(v,be.access_token,!0),a(),$())}}).catch(be=>{P(S,`Auth init failed: ${be.message}`)})});async function j(){const be=o(u).trim();be&&(await ii("googleClientId",be),P(l,be,!0),P(S,null))}async function C(){await _d("googleClientId"),P(l,""),P(u,i),P(d,!1),P(v,null),P(p,null),P(x,[],!0),P(k,0)}async function N(){P(S,null),P(B,!0);try{o(d)||(await nv(o(l)),P(d,!0));const be=await J0();P(v,be.access_token,!0),a(),await $()}catch(be){P(S,be.message,!0)}finally{P(B,!1)}}async function M(){if(r&&clearTimeout(r),o(v))try{await $0(o(v))}catch{}P(v,null),P(p,null),P(x,[],!0),P(k,0),P(h,null),P(S,null)}async function $(){P(Y,!0);try{const be=await Ap(o(v));if(!o(v))return;P(p,be,!0)}catch(be){if(!o(v))return;P(S,`Profile fetch failed: ${be.message}`)}finally{P(Y,!1)}}async function H(be=!1){P(D,!0);try{const Ie=be?o(E):0,Ye=await cb({query:o(m)||void 0,limit:J,offset:Ie});be?P(x,[...o(x),...Ye.items],!0):P(x,Ye.items,!0),P(k,Ye.total,!0),P(E,o(x).length,!0)}catch(Ie){P(S,`Failed to load messages: ${Ie.message}`)}finally{P(D,!1)}}function L(){P(E,0),H(!1)}function q(){H(!0)}function te(be){P(h,be,!0)}function ae(){P(h,null)}async function W(){try{P(V,await E1(),!0)}catch{}}async function G(be){if(o(O)||!o(v))return;const Ie=await s();if(!Ie)return;P(S,null),P(O,!0),P(K,null);const Ye=new AbortController;try{await k1(Ie,{limit:be,onProgress:Je=>{P(K,{...Je},!0)},signal:Ye.signal}),await W(),await H(!1)}catch(Je){if(Je.name!=="AbortError"){if(!o(v))return;P(S,`Sync failed: ${Je.message}`)}}finally{P(O,!1)}}async function ne(be){if(o(O)||!o(v))return;const Ie=await s();if(!Ie)return;P(S,null),P(O,!0),P(K,null);const Ye=new AbortController;try{await S1(Ie,{limit:be,onProgress:Je=>{P(K,{...Je},!0)},signal:Ye.signal}),await W(),await H(!1)}catch(Je){if(Je.name!=="AbortError"){if(!o(v))return;P(S,`Sync more failed: ${Je.message}`)}}finally{P(O,!1)}}async function re(){try{await Jp(),await W(),P(x,[],!0),P(k,0),P(E,0)}catch(be){P(S,`Failed to clear data: ${be.message}`)}}var pe=Jk(),ye=_(pe);{var Se=be=>{N1(be,{onsave:j,defaultClientId:i,get clientIdInput(){return o(u)},set clientIdInput(Ie){P(u,Ie,!0)}})},Z=be=>{V1(be,{get clientId(){return o(l)},get isDefaultClientId(){return o(ke)},get error(){return o(S)},get loadingAuth(){return o(B)},onsignin:N,onclear:C,onsignout:M})},he=be=>{Qk(be,{get error(){return o(S)},get profile(){return o(p)},get loadingProfile(){return o(Y)},get emailMessages(){return o(x)},get totalLocalMessages(){return o(k)},get hasMoreLocal(){return o(I)},get loadingMessages(){return o(D)},get selectedMessage(){return o(h)},get syncStatus(){return o(V)},get syncProgress(){return o(K)},get isSyncing(){return o(O)},onsignout:M,onsearch:L,onloadmore:q,onviewmessage:te,onclosedetail:ae,ondismisserror:()=>P(S,null),onsync:G,onsyncmore:ne,oncleardata:re,get searchQuery(){return o(m)},set searchQuery(Ie){P(m,Ie,!0)}})};ce(ye,be=>{o(ie)?be(Se):o(F)?be(he,!1):be(Z,1)})}T(t,pe),st()}var e2=z('<span class="err svelte-t1ig66"> </span>'),t2=z('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),n2=z('<span class="stream-stats svelte-t1ig66"> </span>'),r2=z('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),a2=z('<span class="ei-group svelte-t1ig66"> </span>'),s2=z('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),i2=z('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),o2=z('<span class="sep svelte-t1ig66">Â·</span> ',1),l2=z('<div class="ei-summary svelte-t1ig66"> </div>'),c2=z('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),u2=z('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),d2=z("<!> <!> <!>",1),f2=z('<div class="ei-error svelte-t1ig66"> </div>'),v2=z('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),h2=z('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),p2=z('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),g2=z('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),m2=z(' <span class="sep svelte-t1ig66">Â·</span>',1),y2=z('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),_2=z('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),b2=z('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),w2=z('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function x2(t,e){at(e,!0);let n=Ae(e,"progress",3,null);function r(h){return!h||h<0?"â":h<1e3?`${Math.round(h)}ms`:`${(h/1e3).toFixed(1)}s`}function a(h){return h?h>=1e3?`${(h/1e3).toFixed(1)}k`:String(h):"0"}function s(h){if(!h)return"â";const m=h.replace(/<.*>/,"").trim();return m.length>30?m.slice(0,28)+"â¦":m}function i(h){if(!h)return"";try{return new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let l=Q(()=>{var h;return(h=n())!=null&&h.total?Math.round(n().current/n().total*100):0}),u=Q(()=>{var h;return((h=n())==null?void 0:h.phase)==="done"});var d=an(),v=Xe(d);{var p=h=>{var m=w2(),x=_(m),k=_(x),E=_(k);{var D=ae=>{var W=on();se(()=>ee(W,`Scan complete â ${(n().classified||0)??""} classified`)),T(ae,W)},B=ae=>{var W=on("Loading emailsâ¦");T(ae,W)},Y=ae=>{var W=on();se(()=>ee(W,`Processing ${n().current??0??""} / ${n().total??0??""}`)),T(ae,W)};ce(E,ae=>{o(u)?ae(D):n().phase==="loading"?ae(B,1):ae(Y,!1)})}var S=b(k,2),V=_(S),K=b(x,2),O=_(K);let J,ie;var ke=b(K,2);{var F=ae=>{var W=t2(),G=_(W),ne=b(G);{var re=Se=>{var Z=e2(),he=_(Z);se(()=>ee(he,`Â· ${n().errors??""} errors`)),T(Se,Z)};ce(ne,Se=>{n().errors&&Se(re)})}var pe=b(ne,3),ye=b(pe,2);se((Se,Z,he)=>{ee(G,`${(n().classified||0)??""} classified `),ee(pe,` ${Se??""} in + ${Z??""} out `),ee(ye,` ${he??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),T(ae,W)};ce(ke,ae=>{n().totals&&!o(u)&&ae(F)})}var I=b(ke,2);{var j=ae=>{var W=r2(),G=_(W),ne=_(G),re=_(ne),pe=b(ne,2);{var ye=he=>{var be=n2(),Ie=_(be);se(Ye=>ee(Ie,`${Ye??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),T(he,be)};ce(pe,he=>{var be;(be=n().live)!=null&&be.tps&&he(ye)})}var Se=b(G,2),Z=_(Se);se(()=>{ee(re,n().email.subject||"(no subject)"),ee(Z,n().streamingText||"Waiting for modelâ¦")}),T(ae,W)};ce(I,ae=>{!o(u)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&ae(j)})}var C=b(I,2);{var N=ae=>{var W=h2(),G=_(W),ne=b(_(G),2),re=_(ne),pe=b(G,2);Ot(pe,17,()=>n().results,Ut,(ye,Se,Z)=>{var he=v2();let be;var Ie=_(he),Ye=_(Ie);Ye.textContent=`${Z+1}.`;var Je=b(Ye,2),ct=_(Je),qe=b(Je,2);{var Oe=nt=>{var ft=s2(),mt=Xe(ft),vt=_(mt),St=b(mt,2);{var bt=pt=>{const yt=Q(()=>nr[o(Se).classification.group]);var dt=an(),Le=Xe(dt);{var Rt=At=>{var Gt=a2();let De;var Qt=_(Gt);se(()=>{kt(Gt,"title",o(yt).description),De=Dt(Gt,"",De,{color:o(yt).color}),ee(Qt,o(yt).label)}),T(At,Gt)};ce(Le,At=>{o(yt)&&At(Rt)})}T(pt,dt)};ce(St,pt=>{o(Se).classification.group&&pt(bt)})}se(()=>ee(vt,o(Se).classification.action)),T(nt,ft)},ze=nt=>{var ft=i2();T(nt,ft)};ce(qe,nt=>{o(Se).success?nt(Oe):nt(ze,!1)})}var Ne=b(Ie,2),Fe=_(Ne),Ke=b(Fe);{var $e=nt=>{var ft=o2(),mt=b(Xe(ft),1,!0);se(vt=>ee(mt,vt),[()=>i(o(Se).email.date)]),T(nt,ft)};ce(Ke,nt=>{o(Se).email.date&&nt($e)})}var Ze=b(Ne,2);{var Ge=nt=>{var ft=d2(),mt=Xe(ft);{var vt=dt=>{var Le=l2(),Rt=_(Le);se(()=>ee(Rt,o(Se).classification.summary)),T(dt,Le)};ce(mt,dt=>{o(Se).classification.summary&&dt(vt)})}var St=b(mt,2);{var bt=dt=>{var Le=c2(),Rt=_(Le),At=b(Rt,2),Gt=b(At,2);se((De,Qt)=>{ee(Rt,`${De??""} `),ee(At,` ${(o(Se).stats.inputTokens||0)??""} in + ${(o(Se).stats.numTokens||0)??""} out `),ee(Gt,` ${Qt??""}`)},[()=>o(Se).stats.tps?`${o(Se).stats.tps.toFixed(0)} tok/s`:"â",()=>r(o(Se).stats.elapsed)]),T(dt,Le)};ce(St,dt=>{o(Se).stats&&dt(bt)})}var pt=b(St,2);{var yt=dt=>{var Le=u2(),Rt=b(_(Le),2),At=_(Rt);se(()=>ee(At,o(Se).rawResponse)),T(dt,Le)};ce(pt,dt=>{o(Se).rawResponse&&dt(yt)})}T(nt,ft)},tt=nt=>{var ft=f2(),mt=_(ft);se(()=>ee(mt,o(Se).error)),T(nt,ft)};ce(Ze,nt=>{o(Se).success?nt(Ge):nt(tt,!1)})}se(nt=>{be=xt(he,1,"email-item svelte-t1ig66",null,be,{failed:!o(Se).success}),ee(ct,o(Se).email.subject||"(no subject)"),ee(Fe,nt)},[()=>s(o(Se).email.from)]),T(ye,he)}),se(()=>ee(re,n().results.length)),T(ae,W)};ce(C,ae=>{var W;((W=n().results)==null?void 0:W.length)>0&&ae(N)})}var M=b(C,2);{var $=ae=>{var W=y2(),G=_(W),ne=_(G),re=_(ne),pe=b(ne,4),ye=_(pe),Se=b(pe,2);{var Z=ze=>{var Ne=p2(),Fe=b(Xe(Ne)),Ke=_(Fe);se(()=>ee(Ke,`${n().errors??""} errors`)),T(ze,Ne)};ce(Se,ze=>{n().errors>0&&ze(Z)})}var he=b(Se,2);{var be=ze=>{var Ne=g2(),Fe=b(Xe(Ne)),Ke=_(Fe);se(()=>ee(Ke,`${n().summary.skipped??""} skipped`)),T(ze,Ne)};ce(he,ze=>{var Ne;(Ne=n().summary)!=null&&Ne.skipped&&ze(be)})}var Ie=b(G,2),Ye=_(Ie);{var Je=ze=>{var Ne=m2(),Fe=Xe(Ne);se(()=>ee(Fe,`Avg ${n().summary.avgTps??""} tok/s`)),T(ze,Ne)};ce(Ye,ze=>{var Ne;(Ne=n().summary)!=null&&Ne.avgTps&&ze(Je)})}var ct=b(Ye),qe=b(ct,2),Oe=b(qe,2);se((ze,Ne,Fe)=>{var Ke,$e;ee(re,`${(((Ke=n().summary)==null?void 0:Ke.processed)||n().total||0)??""} processed`),ee(ye,`${(n().classified||0)??""} classified`),ee(ct,` ${ze??""} in + ${Ne??""} out `),ee(qe,` ${Fe??""} `),ee(Oe,` Model: ${((($e=n().summary)==null?void 0:$e.modelName)||"Unknown")??""}`)},[()=>a(n().totals.inputTokens),()=>a(n().totals.outputTokens),()=>r(n().totals.elapsed)]),T(ae,W)};ce(M,ae=>{o(u)&&n().totals&&ae($)})}var H=b(M,2),L=_(H);{var q=ae=>{var W=_2(),G=Xe(W);G.__click=function(...re){var pe;(pe=e.oninspect)==null||pe.apply(this,re)};var ne=b(G,2);ne.__click=function(...re){var pe;(pe=e.onclose)==null||pe.apply(this,re)},T(ae,W)},te=ae=>{var W=b2(),G=Xe(W);G.__click=function(...re){var pe;(pe=e.oninspect)==null||pe.apply(this,re)};var ne=b(G,2);ne.__click=function(...re){var pe;(pe=e.onstop)==null||pe.apply(this,re)},T(ae,W)};ce(L,ae=>{o(u)?ae(q):ae(te,!1)})}se(()=>{ee(V,`${o(l)??""}%`),J=xt(O,1,"bar-fill svelte-t1ig66",null,J,{done:o(u)}),ie=Dt(O,"",ie,{width:`${o(l)??""}%`})}),T(h,m)};ce(v,h=>{n()&&h(p)})}T(t,d),st()}Xt(["click"]);var k2=z('<span class="spinner svelte-ois7em"></span>'),S2=mn('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),E2=z('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),A2=z("<option> </option>"),T2=z('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),C2=z('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function I2(t,e){at(e,!0);let n=Ae(e,"engineStatus",3,"idle"),r=Ae(e,"modelName",3,""),a=Ae(e,"isScanning",3,!1),s=Ae(e,"scanProgress",3,null),i=Ae(e,"scanCount",15,20),l=Ae(e,"stats",3,null);const u=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function d(){return n()==="ready"?`${r()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function v(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function p(){return n()==="ready"&&!a()}let h=Q(()=>{var W;return a()&&((W=s())==null?void 0:W.phase)!=="done"});var m=C2(),x=_(m),k=_(x),E=_(k);{var D=W=>{var G=k2();T(W,G)},B=W=>{var G=S2();T(W,G)};ce(E,W=>{o(h)?W(D):W(B,!1)})}var Y=b(k,2),S=_(Y),V=b(_(S),2);V.__click=function(...W){var G;(G=e.oninspect)==null||G.apply(this,W)};var K=b(S,2),O=_(K);let J;var ie=b(O),ke=b(x,2);{var F=W=>{var G=E2(),ne=_(G),re=_(ne),pe=b(ne,4),ye=_(pe),Se=b(pe,4),Z=_(Se);se(()=>{ee(re,`${l().totalEmails??""} emails in storage`),ee(ye,`${l().classified??""} classified`),ee(Z,`${l().unclassified??""} new`)}),T(W,G)};ce(ke,W=>{l()&&W(F)})}var I=b(ke,2),j=_(I),C=b(_(j),2);Ot(C,21,()=>u,Ut,(W,G)=>{var ne=A2(),re=_(ne),pe={};se(()=>{ee(re,o(G).label),pe!==(pe=o(G).value)&&(ne.value=(ne.__value=o(G).value)??"")}),T(W,ne)});var N=b(j,2),M=_(N);M.__click=function(...W){var G;(G=e.onscan)==null||G.apply(this,W)};var $=_(M),H=b(M,2);H.__click=function(...W){var G;(G=e.onrescan)==null||G.apply(this,W)};var L=b(I,2);{var q=W=>{var G=T2();T(W,G)};ce(L,W=>{n()!=="ready"&&n()!=="loading"&&W(q)})}var te=b(L,2);{var ae=W=>{x2(W,{get progress(){return s()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};ce(te,W=>{var G;(a()||((G=s())==null?void 0:G.phase)==="done")&&W(ae)})}se((W,G,ne,re)=>{J=Dt(O,"",J,W),ee(ie,` ${G??""}`),C.disabled=a(),M.disabled=ne,ee($,o(h)?"Scanning...":a()?"Finalizing...":"Scan New"),H.disabled=re},[()=>({background:v()}),d,()=>!p(),()=>!p()]),pi(C,i),T(t,m),st()}Xt(["click"]);var P2=z('<span class="row-date svelte-1czytqk"> </span>'),M2=z('<span class="tag svelte-1czytqk"> </span>'),O2=z('<span class="row-tags svelte-1czytqk"></span>'),N2=z('<span class="row-reason svelte-1czytqk"> </span>'),D2=z('<button class="icon-btn exec-btn svelte-1czytqk" title="Execute actions"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button>'),R2=z('<!> <button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),L2=z('<span class="status-label svelte-1czytqk"> </span>'),j2=z('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),z2=z('<p class="summary-reason svelte-1czytqk"> </p>'),q2=z('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),B2=z('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function bv(t,e){at(e,!0);let n=Ae(e,"actionColor",3,"#666"),r=Ae(e,"dimmed",3,!1);function a(N){if(!N)return"";try{return new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let s=Q(()=>e.item.status==="pending"),i=Me(!1);var l=B2(),u=Xe(l);let d;var v=_(u);v.__click=()=>P(i,!o(i));let p;var h=_(v),m=_(h),x=b(h,2),k=_(x),E=_(k),D=b(k,2);{var B=N=>{var M=P2(),$=_(M);se(H=>ee($,H),[()=>a(e.item.date)]),T(N,M)};ce(D,N=>{e.item.date&&N(B)})}var Y=b(x,2);{var S=N=>{var M=O2();Ot(M,21,()=>e.item.tags,Ut,($,H)=>{var L=M2();let q;var te=_(L);se(ae=>{q=Dt(L,"",q,ae),ee(te,o(H))},[()=>({background:zb(o(H))})]),T($,L)}),T(N,M)};ce(Y,N=>{e.item.tags&&e.item.tags.length>0&&N(S)})}var V=b(Y,2);{var K=N=>{var M=N2(),$=_(M);se(()=>ee($,e.item.reason)),T(N,M)};ce(V,N=>{e.item.reason&&!o(i)&&N(K)})}var O=b(v,2),J=_(O);{var ie=N=>{var M=R2(),$=Xe(M);{var H=te=>{var ae=D2();ae.__click=W=>{W.stopPropagation(),e.onexecute(e.item)},T(te,ae)};ce($,te=>{e.onexecute&&te(H)})}var L=b($,2);L.__click=te=>{te.stopPropagation(),e.onmarkacted(e.item.emailId)};var q=b(L,2);q.__click=te=>{te.stopPropagation(),e.ondismiss(e.item.emailId)},T(N,M)},ke=N=>{var M=L2(),$=_(M);se(()=>ee($,e.item.status)),T(N,M)};ce(J,N=>{o(s)?N(ie):N(ke,!1)})}var F=b(J,2);{var I=N=>{var M=j2();M.__click=$=>{$.stopPropagation(),e.onremove(e.item.emailId)},T(N,M)};ce(F,N=>{e.onremove&&N(I)})}var j=b(u,2);{var C=N=>{var M=q2();let $;var H=_(M),L=_(H),q=b(H,2);{var te=ae=>{var W=z2(),G=_(W);se(()=>ee(G,e.item.reason)),T(ae,W)};ce(q,ae=>{e.item.reason&&ae(te)})}se(()=>{$=Dt(M,"",$,{"border-left-color":n()}),ee(L,e.item.summary)}),T(N,M)};ce(j,N=>{o(i)&&e.item.summary&&N(C)})}se(()=>{d=xt(u,1,"email-row svelte-1czytqk",null,d,{dimmed:r()}),p=Dt(v,"",p,{"border-left-color":n()}),ee(m,e.item.subject),ee(E,e.item.from)}),T(t,l),st()}Xt(["click"]);var F2=z('<span class="group-acted svelte-tl1unp"> </span>'),K2=z('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),H2=z('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),G2=z('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),U2=z('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),V2=z('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),W2=z('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Y2(t,e){at(e,!0);let n=Ae(e,"color",3,"#888");Ae(e,"count",3,0);let r=Ae(e,"items",19,()=>[]),a=Ae(e,"expanded",3,!1),s=Q(()=>r().filter(K=>K.status==="pending")),i=Q(()=>r().filter(K=>K.status!=="pending")),l=Me(!1);function u(K){return K.split("_").map(O=>O.charAt(0)+O.slice(1).toLowerCase()).join(" ")}var d=W2(),v=_(d);v.__click=function(...K){var O;(O=e.ontoggle)==null||O.apply(this,K)};var p=_(v);let h;var m=_(p),x=b(p,2),k=_(x),E=b(x,2);{var D=K=>{var O=F2(),J=_(O);se(()=>ee(J,`${o(i).length??""} handled`)),T(K,O)};ce(E,K=>{o(i).length>0&&K(D)})}var B=b(E,4);let Y;var S=b(v,2);{var V=K=>{var O=V2(),J=_(O);{var ie=$=>{var H=K2();T($,H)};ce(J,$=>{o(s).length===0&&o(i).length===0&&$(ie)})}var ke=b(J,2);Ot(ke,17,()=>o(s),$=>$.emailId,($,H)=>{bv($,{get item(){return o(H)},get actionColor(){return n()},get onexecute(){return e.onexecute},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var F=b(ke,2);{var I=$=>{var H=H2(),L=_(H),q=_(L),te=b(L,2);Ot(te,17,()=>o(i),ae=>ae.emailId,(ae,W)=>{bv(ae,{get item(){return o(W)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),se(()=>ee(q,`${o(i).length??""} handled`)),T($,H)};ce(F,$=>{o(i).length>0&&$(I)})}var j=b(F,2),C=_(j);{var N=$=>{var H=G2();H.__click=()=>P(l,!0),T($,H)},M=$=>{var H=U2(),L=_(H),q=b(L);q.__click=()=>P(l,!1);var te=b(q,2);te.__click=()=>{e.oncleargroup(),P(l,!1)},se(()=>ee(L,`Clear ${r().length??""} items? `)),T($,H)};ce(C,$=>{o(l)?$(M,!1):$(N)})}T(K,O)};ce(S,K=>{a()&&K(V)})}se(K=>{h=Dt(p,"",h,{background:n()}),ee(m,K),ee(k,o(s).length),Y=xt(B,0,"chevron svelte-tl1unp",null,Y,{open:a()})},[()=>u(e.action)]),T(t,d),st()}Xt(["click"]);var X2=z(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),Z2=z(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),Q2=z(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),J2=z('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function $2(t,e){at(e,!0);let n=Ae(e,"open",15,!1),r=Ae(e,"sampleEmail",3,null),a=Me("system");function s(){return r()?Up(r()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function i(){n(!1)}function l(p){p.target===p.currentTarget&&i()}var u=an(),d=Xe(u);{var v=p=>{var h=J2();h.__click=l,h.__keydown=I=>I.key==="Escape"&&i();var m=_(h),x=_(m),k=b(_(x),2);k.__click=i;var E=b(x,2),D=_(E);let B;D.__click=()=>P(a,"system");var Y=b(D,2);let S;Y.__click=()=>P(a,"email");var V=b(Y,2);let K;V.__click=()=>P(a,"config");var O=b(E,2),J=_(O);{var ie=I=>{var j=X2(),C=b(Xe(j),2),N=_(C);se(()=>ee(N,Fp)),T(I,j)},ke=I=>{var j=Z2(),C=b(Xe(j),2),N=b(_(C),2);N.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var M=b(C,2),$=b(_(M),2),H=_($);se(L=>ee(H,L),[s]),T(I,j)},F=I=>{var j=Q2(),C=b(Xe(j),2),N=_(C),M=b(_(N),2),$=_(M),H=b(N,2),L=b(_(H),2),q=_(L),te=b(H,2),ae=b(_(te),2),W=_(ae),G=b(C,4);G.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,se(()=>{ee($,Db.maxTokens),ee(q,"false"),ee(W,"false")}),T(I,j)};ce(J,I=>{o(a)==="system"?I(ie):o(a)==="email"?I(ke,1):o(a)==="config"&&I(F,2)})}se(()=>{B=xt(D,1,"tab svelte-10pcy9j",null,B,{active:o(a)==="system"}),S=xt(Y,1,"tab svelte-10pcy9j",null,S,{active:o(a)==="email"}),K=xt(V,1,"tab svelte-10pcy9j",null,K,{active:o(a)==="config"})}),T(p,h)};ce(d,p=>{n()&&p(v)})}T(t,u),st()}Xt(["click","keydown"]);var eS={value:()=>{}};function ac(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new pl(n)}function pl(t){this._=t}function tS(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}pl.prototype=ac.prototype={constructor:pl,on:function(t,e){var n=this._,r=tS(t+"",n),a,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((a=(t=r[s]).type)&&(a=nS(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<i;)if(a=(t=r[s]).type)n[a]=wv(n[a],t.name,e);else if(e==null)for(a in n)n[a]=wv(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new pl(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,s;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],r=0,a=s.length;r<a;++r)s[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,s=r.length;a<s;++a)r[a].value.apply(e,n)}};function nS(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function wv(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=eS,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Fu="http://www.w3.org/1999/xhtml";const xv={svg:"http://www.w3.org/2000/svg",xhtml:Fu,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sc(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),xv.hasOwnProperty(e)?{space:xv[e],local:t}:t}function rS(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Fu&&e.documentElement.namespaceURI===Fu?e.createElement(t):e.createElementNS(n,t)}}function aS(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function _g(t){var e=sc(t);return(e.local?aS:rS)(e)}function sS(){}function zd(t){return t==null?sS:function(){return this.querySelector(t)}}function iS(t){typeof t!="function"&&(t=zd(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=new Array(i),u,d,v=0;v<i;++v)(u=s[v])&&(d=t.call(u,u.__data__,v,s))&&("__data__"in u&&(d.__data__=u.__data__),l[v]=d);return new ur(r,this._parents)}function oS(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function lS(){return[]}function bg(t){return t==null?lS:function(){return this.querySelectorAll(t)}}function cS(t){return function(){return oS(t.apply(this,arguments))}}function uS(t){typeof t=="function"?t=cS(t):t=bg(t);for(var e=this._groups,n=e.length,r=[],a=[],s=0;s<n;++s)for(var i=e[s],l=i.length,u,d=0;d<l;++d)(u=i[d])&&(r.push(t.call(u,u.__data__,d,i)),a.push(u));return new ur(r,a)}function wg(t){return function(){return this.matches(t)}}function xg(t){return function(e){return e.matches(t)}}var dS=Array.prototype.find;function fS(t){return function(){return dS.call(this.children,t)}}function vS(){return this.firstElementChild}function hS(t){return this.select(t==null?vS:fS(typeof t=="function"?t:xg(t)))}var pS=Array.prototype.filter;function gS(){return Array.from(this.children)}function mS(t){return function(){return pS.call(this.children,t)}}function yS(t){return this.selectAll(t==null?gS:mS(typeof t=="function"?t:xg(t)))}function _S(t){typeof t!="function"&&(t=wg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],u,d=0;d<i;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new ur(r,this._parents)}function kg(t){return new Array(t.length)}function bS(){return new ur(this._enter||this._groups.map(kg),this._parents)}function Cl(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Cl.prototype={constructor:Cl,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function wS(t){return function(){return t}}function xS(t,e,n,r,a,s){for(var i=0,l,u=e.length,d=s.length;i<d;++i)(l=e[i])?(l.__data__=s[i],r[i]=l):n[i]=new Cl(t,s[i]);for(;i<u;++i)(l=e[i])&&(a[i]=l)}function kS(t,e,n,r,a,s,i){var l,u,d=new Map,v=e.length,p=s.length,h=new Array(v),m;for(l=0;l<v;++l)(u=e[l])&&(h[l]=m=i.call(u,u.__data__,l,e)+"",d.has(m)?a[l]=u:d.set(m,u));for(l=0;l<p;++l)m=i.call(t,s[l],l,s)+"",(u=d.get(m))?(r[l]=u,u.__data__=s[l],d.delete(m)):n[l]=new Cl(t,s[l]);for(l=0;l<v;++l)(u=e[l])&&d.get(h[l])===u&&(a[l]=u)}function SS(t){return t.__data__}function ES(t,e){if(!arguments.length)return Array.from(this,SS);var n=e?kS:xS,r=this._parents,a=this._groups;typeof t!="function"&&(t=wS(t));for(var s=a.length,i=new Array(s),l=new Array(s),u=new Array(s),d=0;d<s;++d){var v=r[d],p=a[d],h=p.length,m=AS(t.call(v,v&&v.__data__,d,r)),x=m.length,k=l[d]=new Array(x),E=i[d]=new Array(x),D=u[d]=new Array(h);n(v,p,k,E,D,m,e);for(var B=0,Y=0,S,V;B<x;++B)if(S=k[B]){for(B>=Y&&(Y=B+1);!(V=E[Y])&&++Y<x;);S._next=V||null}}return i=new ur(i,r),i._enter=l,i._exit=u,i}function AS(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function TS(){return new ur(this._exit||this._groups.map(kg),this._parents)}function CS(t,e,n){var r=this.enter(),a=this,s=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?s.remove():n(s),r&&a?r.merge(a).order():a}function IS(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,s=r.length,i=Math.min(a,s),l=new Array(a),u=0;u<i;++u)for(var d=n[u],v=r[u],p=d.length,h=l[u]=new Array(p),m,x=0;x<p;++x)(m=d[x]||v[x])&&(h[x]=m);for(;u<a;++u)l[u]=n[u];return new ur(l,this._parents)}function PS(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,s=r[a],i;--a>=0;)(i=r[a])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function MS(t){t||(t=OS);function e(p,h){return p&&h?t(p.__data__,h.__data__):!p-!h}for(var n=this._groups,r=n.length,a=new Array(r),s=0;s<r;++s){for(var i=n[s],l=i.length,u=a[s]=new Array(l),d,v=0;v<l;++v)(d=i[v])&&(u[v]=d);u.sort(e)}return new ur(a,this._parents).order()}function OS(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function NS(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function DS(){return Array.from(this)}function RS(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length;a<s;++a){var i=r[a];if(i)return i}return null}function LS(){let t=0;for(const e of this)++t;return t}function jS(){return!this.node()}function zS(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],s=0,i=a.length,l;s<i;++s)(l=a[s])&&t.call(l,l.__data__,s,a);return this}function qS(t){return function(){this.removeAttribute(t)}}function BS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function FS(t,e){return function(){this.setAttribute(t,e)}}function KS(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function HS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function GS(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function US(t,e){var n=sc(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?BS:qS:typeof e=="function"?n.local?GS:HS:n.local?KS:FS)(n,e))}function Sg(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function VS(t){return function(){this.style.removeProperty(t)}}function WS(t,e,n){return function(){this.style.setProperty(t,e,n)}}function YS(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function XS(t,e,n){return arguments.length>1?this.each((e==null?VS:typeof e=="function"?YS:WS)(t,e,n??"")):oi(this.node(),t)}function oi(t,e){return t.style.getPropertyValue(e)||Sg(t).getComputedStyle(t,null).getPropertyValue(e)}function ZS(t){return function(){delete this[t]}}function QS(t,e){return function(){this[t]=e}}function JS(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function $S(t,e){return arguments.length>1?this.each((e==null?ZS:typeof e=="function"?JS:QS)(t,e)):this.node()[t]}function Eg(t){return t.trim().split(/^|\s+/)}function qd(t){return t.classList||new Ag(t)}function Ag(t){this._node=t,this._names=Eg(t.getAttribute("class")||"")}Ag.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Tg(t,e){for(var n=qd(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function Cg(t,e){for(var n=qd(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function eE(t){return function(){Tg(this,t)}}function tE(t){return function(){Cg(this,t)}}function nE(t,e){return function(){(e.apply(this,arguments)?Tg:Cg)(this,t)}}function rE(t,e){var n=Eg(t+"");if(arguments.length<2){for(var r=qd(this.node()),a=-1,s=n.length;++a<s;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?nE:e?eE:tE)(n,e))}function aE(){this.textContent=""}function sE(t){return function(){this.textContent=t}}function iE(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function oE(t){return arguments.length?this.each(t==null?aE:(typeof t=="function"?iE:sE)(t)):this.node().textContent}function lE(){this.innerHTML=""}function cE(t){return function(){this.innerHTML=t}}function uE(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function dE(t){return arguments.length?this.each(t==null?lE:(typeof t=="function"?uE:cE)(t)):this.node().innerHTML}function fE(){this.nextSibling&&this.parentNode.appendChild(this)}function vE(){return this.each(fE)}function hE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function pE(){return this.each(hE)}function gE(t){var e=typeof t=="function"?t:_g(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function mE(){return null}function yE(t,e){var n=typeof t=="function"?t:_g(t),r=e==null?mE:typeof e=="function"?e:zd(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function _E(){var t=this.parentNode;t&&t.removeChild(this)}function bE(){return this.each(_E)}function wE(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function xE(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function kE(t){return this.select(t?xE:wE)}function SE(t){return arguments.length?this.property("__data__",t):this.node().__data__}function EE(t){return function(e){t.call(this,e,this.__data__)}}function AE(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function TE(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,s;n<a;++n)s=e[n],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function CE(t,e,n){return function(){var r=this.__on,a,s=EE(e);if(r){for(var i=0,l=r.length;i<l;++i)if((a=r[i]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=s,a.options=n),a.value=e;return}}this.addEventListener(t.type,s,n),a={type:t.type,name:t.name,value:e,listener:s,options:n},r?r.push(a):this.__on=[a]}}function IE(t,e,n){var r=AE(t+""),a,s=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,v;u<d;++u)for(a=0,v=l[u];a<s;++a)if((i=r[a]).type===v.type&&i.name===v.name)return v.value}return}for(l=e?CE:TE,a=0;a<s;++a)this.each(l(r[a],e,n));return this}function Ig(t,e,n){var r=Sg(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function PE(t,e){return function(){return Ig(this,t,e)}}function ME(t,e){return function(){return Ig(this,t,e.apply(this,arguments))}}function OE(t,e){return this.each((typeof e=="function"?ME:PE)(t,e))}function*NE(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,s=r.length,i;a<s;++a)(i=r[a])&&(yield i)}var Pg=[null];function ur(t,e){this._groups=t,this._parents=e}function So(){return new ur([[document.documentElement]],Pg)}function DE(){return this}ur.prototype=So.prototype={constructor:ur,select:iS,selectAll:uS,selectChild:hS,selectChildren:yS,filter:_S,data:ES,enter:bS,exit:TS,join:CS,merge:IS,selection:DE,order:PS,sort:MS,call:NS,nodes:DS,node:RS,size:LS,empty:jS,each:zS,attr:US,style:XS,property:$S,classed:rE,text:oE,html:dE,raise:vE,lower:pE,append:gE,insert:yE,remove:bE,clone:kE,datum:SE,on:IE,dispatch:OE,[Symbol.iterator]:NE};function Mr(t){return typeof t=="string"?new ur([[document.querySelector(t)]],[document.documentElement]):new ur([[t]],Pg)}function RE(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Gr(t,e){if(t=RE(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const LE={passive:!1},eo={capture:!0,passive:!1};function eu(t){t.stopImmediatePropagation()}function Hs(t){t.preventDefault(),t.stopImmediatePropagation()}function Mg(t){var e=t.document.documentElement,n=Mr(t).on("dragstart.drag",Hs,eo);"onselectstart"in e?n.on("selectstart.drag",Hs,eo):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Og(t,e){var n=t.document.documentElement,r=Mr(t).on("dragstart.drag",null);e&&(r.on("click.drag",Hs,eo),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const $o=t=>()=>t;function Ku(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:s,x:i,y:l,dx:u,dy:d,dispatch:v}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:i,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:v}})}Ku.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function jE(t){return!t.ctrlKey&&!t.button}function zE(){return this.parentNode}function qE(t,e){return e??{x:t.x,y:t.y}}function BE(){return navigator.maxTouchPoints||"ontouchstart"in this}function FE(){var t=jE,e=zE,n=qE,r=BE,a={},s=ac("start","drag","end"),i=0,l,u,d,v,p=0;function h(S){S.on("mousedown.drag",m).filter(r).on("touchstart.drag",E).on("touchmove.drag",D,LE).on("touchend.drag touchcancel.drag",B).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(S,V){if(!(v||!t.call(this,S,V))){var K=Y(this,e.call(this,S,V),S,V,"mouse");K&&(Mr(S.view).on("mousemove.drag",x,eo).on("mouseup.drag",k,eo),Mg(S.view),eu(S),d=!1,l=S.clientX,u=S.clientY,K("start",S))}}function x(S){if(Hs(S),!d){var V=S.clientX-l,K=S.clientY-u;d=V*V+K*K>p}a.mouse("drag",S)}function k(S){Mr(S.view).on("mousemove.drag mouseup.drag",null),Og(S.view,d),Hs(S),a.mouse("end",S)}function E(S,V){if(t.call(this,S,V)){var K=S.changedTouches,O=e.call(this,S,V),J=K.length,ie,ke;for(ie=0;ie<J;++ie)(ke=Y(this,O,S,V,K[ie].identifier,K[ie]))&&(eu(S),ke("start",S,K[ie]))}}function D(S){var V=S.changedTouches,K=V.length,O,J;for(O=0;O<K;++O)(J=a[V[O].identifier])&&(Hs(S),J("drag",S,V[O]))}function B(S){var V=S.changedTouches,K=V.length,O,J;for(v&&clearTimeout(v),v=setTimeout(function(){v=null},500),O=0;O<K;++O)(J=a[V[O].identifier])&&(eu(S),J("end",S,V[O]))}function Y(S,V,K,O,J,ie){var ke=s.copy(),F=Gr(ie||K,V),I,j,C;if((C=n.call(S,new Ku("beforestart",{sourceEvent:K,target:h,identifier:J,active:i,x:F[0],y:F[1],dx:0,dy:0,dispatch:ke}),O))!=null)return I=C.x-F[0]||0,j=C.y-F[1]||0,function N(M,$,H){var L=F,q;switch(M){case"start":a[J]=N,q=i++;break;case"end":delete a[J],--i;case"drag":F=Gr(H||$,V),q=i;break}ke.call(M,S,new Ku(M,{sourceEvent:$,subject:C,target:h,identifier:J,active:q,x:F[0]+I,y:F[1]+j,dx:F[0]-L[0],dy:F[1]-L[1],dispatch:ke}),O)}}return h.filter=function(S){return arguments.length?(t=typeof S=="function"?S:$o(!!S),h):t},h.container=function(S){return arguments.length?(e=typeof S=="function"?S:$o(S),h):e},h.subject=function(S){return arguments.length?(n=typeof S=="function"?S:$o(S),h):n},h.touchable=function(S){return arguments.length?(r=typeof S=="function"?S:$o(!!S),h):r},h.on=function(){var S=s.on.apply(s,arguments);return S===s?h:S},h.clickDistance=function(S){return arguments.length?(p=(S=+S)*S,h):Math.sqrt(p)},h}function Bd(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ng(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Eo(){}var to=.7,Il=1/to,Gs="\\s*([+-]?\\d+)\\s*",no="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",na="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",KE=/^#([0-9a-f]{3,8})$/,HE=new RegExp(`^rgb\\(${Gs},${Gs},${Gs}\\)$`),GE=new RegExp(`^rgb\\(${na},${na},${na}\\)$`),UE=new RegExp(`^rgba\\(${Gs},${Gs},${Gs},${no}\\)$`),VE=new RegExp(`^rgba\\(${na},${na},${na},${no}\\)$`),WE=new RegExp(`^hsl\\(${no},${na},${na}\\)$`),YE=new RegExp(`^hsla\\(${no},${na},${na},${no}\\)$`),kv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Bd(Eo,ws,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Sv,formatHex:Sv,formatHex8:XE,formatHsl:ZE,formatRgb:Ev,toString:Ev});function Sv(){return this.rgb().formatHex()}function XE(){return this.rgb().formatHex8()}function ZE(){return Dg(this).formatHsl()}function Ev(){return this.rgb().formatRgb()}function ws(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=KE.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Av(e):n===3?new tr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?el(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?el(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=HE.exec(t))?new tr(e[1],e[2],e[3],1):(e=GE.exec(t))?new tr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=UE.exec(t))?el(e[1],e[2],e[3],e[4]):(e=VE.exec(t))?el(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=WE.exec(t))?Iv(e[1],e[2]/100,e[3]/100,1):(e=YE.exec(t))?Iv(e[1],e[2]/100,e[3]/100,e[4]):kv.hasOwnProperty(t)?Av(kv[t]):t==="transparent"?new tr(NaN,NaN,NaN,0):null}function Av(t){return new tr(t>>16&255,t>>8&255,t&255,1)}function el(t,e,n,r){return r<=0&&(t=e=n=NaN),new tr(t,e,n,r)}function QE(t){return t instanceof Eo||(t=ws(t)),t?(t=t.rgb(),new tr(t.r,t.g,t.b,t.opacity)):new tr}function Hu(t,e,n,r){return arguments.length===1?QE(t):new tr(t,e,n,r??1)}function tr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Bd(tr,Hu,Ng(Eo,{brighter(t){return t=t==null?Il:Math.pow(Il,t),new tr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?to:Math.pow(to,t),new tr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new tr(ps(this.r),ps(this.g),ps(this.b),Pl(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Tv,formatHex:Tv,formatHex8:JE,formatRgb:Cv,toString:Cv}));function Tv(){return`#${is(this.r)}${is(this.g)}${is(this.b)}`}function JE(){return`#${is(this.r)}${is(this.g)}${is(this.b)}${is((isNaN(this.opacity)?1:this.opacity)*255)}`}function Cv(){const t=Pl(this.opacity);return`${t===1?"rgb(":"rgba("}${ps(this.r)}, ${ps(this.g)}, ${ps(this.b)}${t===1?")":`, ${t})`}`}function Pl(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ps(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function is(t){return t=ps(t),(t<16?"0":"")+t.toString(16)}function Iv(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Or(t,e,n,r)}function Dg(t){if(t instanceof Or)return new Or(t.h,t.s,t.l,t.opacity);if(t instanceof Eo||(t=ws(t)),!t)return new Or;if(t instanceof Or)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,l=s-a,u=(s+a)/2;return l?(e===s?i=(n-r)/l+(n<r)*6:n===s?i=(r-e)/l+2:i=(e-n)/l+4,l/=u<.5?s+a:2-s-a,i*=60):l=u>0&&u<1?0:i,new Or(i,l,u,t.opacity)}function $E(t,e,n,r){return arguments.length===1?Dg(t):new Or(t,e,n,r??1)}function Or(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Bd(Or,$E,Ng(Eo,{brighter(t){return t=t==null?Il:Math.pow(Il,t),new Or(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?to:Math.pow(to,t),new Or(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new tr(tu(t>=240?t-240:t+120,a,r),tu(t,a,r),tu(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new Or(Pv(this.h),tl(this.s),tl(this.l),Pl(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Pl(this.opacity);return`${t===1?"hsl(":"hsla("}${Pv(this.h)}, ${tl(this.s)*100}%, ${tl(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Pv(t){return t=(t||0)%360,t<0?t+360:t}function tl(t){return Math.max(0,Math.min(1,t||0))}function tu(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Fd=t=>()=>t;function eA(t,e){return function(n){return t+n*e}}function tA(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function nA(t){return(t=+t)==1?Rg:function(e,n){return n-e?tA(e,n,t):Fd(isNaN(e)?n:e)}}function Rg(t,e){var n=e-t;return n?eA(t,n):Fd(isNaN(t)?e:t)}const Ml=(function t(e){var n=nA(e);function r(a,s){var i=n((a=Hu(a)).r,(s=Hu(s)).r),l=n(a.g,s.g),u=n(a.b,s.b),d=Rg(a.opacity,s.opacity);return function(v){return a.r=i(v),a.g=l(v),a.b=u(v),a.opacity=d(v),a+""}}return r.gamma=t,r})(1);function rA(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function aA(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sA(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=Xi(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(l){for(i=0;i<r;++i)s[i]=a[i](l);return s}}function iA(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Xr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function oA(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Xi(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var Gu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nu=new RegExp(Gu.source,"g");function lA(t){return function(){return t}}function cA(t){return function(e){return t(e)+""}}function Lg(t,e){var n=Gu.lastIndex=nu.lastIndex=0,r,a,s,i=-1,l=[],u=[];for(t=t+"",e=e+"";(r=Gu.exec(t))&&(a=nu.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),l[i]?l[i]+=s:l[++i]=s),(r=r[0])===(a=a[0])?l[i]?l[i]+=a:l[++i]=a:(l[++i]=null,u.push({i,x:Xr(r,a)})),n=nu.lastIndex;return n<e.length&&(s=e.slice(n),l[i]?l[i]+=s:l[++i]=s),l.length<2?u[0]?cA(u[0].x):lA(e):(e=u.length,function(d){for(var v=0,p;v<e;++v)l[(p=u[v]).i]=p.x(d);return l.join("")})}function Xi(t,e){var n=typeof e,r;return e==null||n==="boolean"?Fd(e):(n==="number"?Xr:n==="string"?(r=ws(e))?(e=r,Ml):Lg:e instanceof ws?Ml:e instanceof Date?iA:aA(e)?rA:Array.isArray(e)?sA:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?oA:Xr)(t,e)}var Mv=180/Math.PI,Uu={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function jg(t,e,n,r,a,s){var i,l,u;return(i=Math.sqrt(t*t+e*e))&&(t/=i,e/=i),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,i=-i),{translateX:a,translateY:s,rotate:Math.atan2(e,t)*Mv,skewX:Math.atan(u)*Mv,scaleX:i,scaleY:l}}var nl;function uA(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Uu:jg(e.a,e.b,e.c,e.d,e.e,e.f)}function dA(t){return t==null||(nl||(nl=document.createElementNS("http://www.w3.org/2000/svg","g")),nl.setAttribute("transform",t),!(t=nl.transform.baseVal.consolidate()))?Uu:(t=t.matrix,jg(t.a,t.b,t.c,t.d,t.e,t.f))}function zg(t,e,n,r){function a(d){return d.length?d.pop()+" ":""}function s(d,v,p,h,m,x){if(d!==p||v!==h){var k=m.push("translate(",null,e,null,n);x.push({i:k-4,x:Xr(d,p)},{i:k-2,x:Xr(v,h)})}else(p||h)&&m.push("translate("+p+e+h+n)}function i(d,v,p,h){d!==v?(d-v>180?v+=360:v-d>180&&(d+=360),h.push({i:p.push(a(p)+"rotate(",null,r)-2,x:Xr(d,v)})):v&&p.push(a(p)+"rotate("+v+r)}function l(d,v,p,h){d!==v?h.push({i:p.push(a(p)+"skewX(",null,r)-2,x:Xr(d,v)}):v&&p.push(a(p)+"skewX("+v+r)}function u(d,v,p,h,m,x){if(d!==p||v!==h){var k=m.push(a(m)+"scale(",null,",",null,")");x.push({i:k-4,x:Xr(d,p)},{i:k-2,x:Xr(v,h)})}else(p!==1||h!==1)&&m.push(a(m)+"scale("+p+","+h+")")}return function(d,v){var p=[],h=[];return d=t(d),v=t(v),s(d.translateX,d.translateY,v.translateX,v.translateY,p,h),i(d.rotate,v.rotate,p,h),l(d.skewX,v.skewX,p,h),u(d.scaleX,d.scaleY,v.scaleX,v.scaleY,p,h),d=v=null,function(m){for(var x=-1,k=h.length,E;++x<k;)p[(E=h[x]).i]=E.x(m);return p.join("")}}}var fA=zg(uA,"px, ","px)","deg)"),vA=zg(dA,", ",")",")"),hA=1e-12;function Ov(t){return((t=Math.exp(t))+1/t)/2}function pA(t){return((t=Math.exp(t))-1/t)/2}function gA(t){return((t=Math.exp(2*t))-1)/(t+1)}const gl=(function t(e,n,r){function a(s,i){var l=s[0],u=s[1],d=s[2],v=i[0],p=i[1],h=i[2],m=v-l,x=p-u,k=m*m+x*x,E,D;if(k<hA)D=Math.log(h/d)/e,E=function(O){return[l+O*m,u+O*x,d*Math.exp(e*O*D)]};else{var B=Math.sqrt(k),Y=(h*h-d*d+r*k)/(2*d*n*B),S=(h*h-d*d-r*k)/(2*h*n*B),V=Math.log(Math.sqrt(Y*Y+1)-Y),K=Math.log(Math.sqrt(S*S+1)-S);D=(K-V)/e,E=function(O){var J=O*D,ie=Ov(V),ke=d/(n*B)*(ie*gA(e*J+V)-pA(V));return[l+ke*m,u+ke*x,d*ie/Ov(e*J+V)]}}return E.duration=D*1e3*e/Math.SQRT2,E}return a.rho=function(s){var i=Math.max(.001,+s),l=i*i,u=l*l;return t(i,l,u)},a})(Math.SQRT2,2,4);var li=0,Ki=0,zi=0,qg=1e3,Ol,Hi,Nl=0,xs=0,ic=0,ro=typeof performance=="object"&&performance.now?performance:Date,Bg=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Kd(){return xs||(Bg(mA),xs=ro.now()+ic)}function mA(){xs=0}function Dl(){this._call=this._time=this._next=null}Dl.prototype=Fg.prototype={constructor:Dl,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Kd():+n)+(e==null?0:+e),!this._next&&Hi!==this&&(Hi?Hi._next=this:Ol=this,Hi=this),this._call=t,this._time=n,Vu()},stop:function(){this._call&&(this._call=null,this._time=1/0,Vu())}};function Fg(t,e,n){var r=new Dl;return r.restart(t,e,n),r}function yA(){Kd(),++li;for(var t=Ol,e;t;)(e=xs-t._time)>=0&&t._call.call(void 0,e),t=t._next;--li}function Nv(){xs=(Nl=ro.now())+ic,li=Ki=0;try{yA()}finally{li=0,bA(),xs=0}}function _A(){var t=ro.now(),e=t-Nl;e>qg&&(ic-=e,Nl=t)}function bA(){for(var t,e=Ol,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ol=n);Hi=t,Vu(r)}function Vu(t){if(!li){Ki&&(Ki=clearTimeout(Ki));var e=t-xs;e>24?(t<1/0&&(Ki=setTimeout(Nv,t-ro.now()-ic)),zi&&(zi=clearInterval(zi))):(zi||(Nl=ro.now(),zi=setInterval(_A,qg)),li=1,Bg(Nv))}}function Dv(t,e,n){var r=new Dl;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var wA=ac("start","end","cancel","interrupt"),xA=[],Kg=0,Rv=1,Wu=2,ml=3,Lv=4,Yu=5,yl=6;function oc(t,e,n,r,a,s){var i=t.__transition;if(!i)t.__transition={};else if(n in i)return;kA(t,n,{name:e,index:r,group:a,on:wA,tween:xA,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Kg})}function Hd(t,e){var n=qr(t,e);if(n.state>Kg)throw new Error("too late; already scheduled");return n}function ia(t,e){var n=qr(t,e);if(n.state>ml)throw new Error("too late; already running");return n}function qr(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function kA(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Fg(s,0,n.time);function s(d){n.state=Rv,n.timer.restart(i,n.delay,n.time),n.delay<=d&&i(d-n.delay)}function i(d){var v,p,h,m;if(n.state!==Rv)return u();for(v in r)if(m=r[v],m.name===n.name){if(m.state===ml)return Dv(i);m.state===Lv?(m.state=yl,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete r[v]):+v<e&&(m.state=yl,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete r[v])}if(Dv(function(){n.state===ml&&(n.state=Lv,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=Wu,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Wu){for(n.state=ml,a=new Array(h=n.tween.length),v=0,p=-1;v<h;++v)(m=n.tween[v].value.call(t,t.__data__,n.index,n.group))&&(a[++p]=m);a.length=p+1}}function l(d){for(var v=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=Yu,1),p=-1,h=a.length;++p<h;)a[p].call(t,v);n.state===Yu&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=yl,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function _l(t,e){var n=t.__transition,r,a,s=!0,i;if(n){e=e==null?null:e+"";for(i in n){if((r=n[i]).name!==e){s=!1;continue}a=r.state>Wu&&r.state<Yu,r.state=yl,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[i]}s&&delete t.__transition}}function SA(t){return this.each(function(){_l(this,t)})}function EA(t,e){var n,r;return function(){var a=ia(this,t),s=a.tween;if(s!==n){r=n=s;for(var i=0,l=r.length;i<l;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}a.tween=r}}function AA(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var s=ia(this,t),i=s.tween;if(i!==r){a=(r=i).slice();for(var l={name:e,value:n},u=0,d=a.length;u<d;++u)if(a[u].name===e){a[u]=l;break}u===d&&a.push(l)}s.tween=a}}function TA(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=qr(this.node(),n).tween,a=0,s=r.length,i;a<s;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((e==null?EA:AA)(n,t,e))}function Gd(t,e,n){var r=t._id;return t.each(function(){var a=ia(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return qr(a,r).value[e]}}function Hg(t,e){var n;return(typeof e=="number"?Xr:e instanceof ws?Ml:(n=ws(e))?(e=n,Ml):Lg)(t,e)}function CA(t){return function(){this.removeAttribute(t)}}function IA(t){return function(){this.removeAttributeNS(t.space,t.local)}}function PA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttribute(t);return i===a?null:i===r?s:s=e(r=i,n)}}function MA(t,e,n){var r,a=n+"",s;return function(){var i=this.getAttributeNS(t.space,t.local);return i===a?null:i===r?s:s=e(r=i,n)}}function OA(t,e,n){var r,a,s;return function(){var i,l=n(this),u;return l==null?void this.removeAttribute(t):(i=this.getAttribute(t),u=l+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l)))}}function NA(t,e,n){var r,a,s;return function(){var i,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(i=this.getAttributeNS(t.space,t.local),u=l+"",i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l)))}}function DA(t,e){var n=sc(t),r=n==="transform"?vA:Hg;return this.attrTween(t,typeof e=="function"?(n.local?NA:OA)(n,r,Gd(this,"attr."+t,e)):e==null?(n.local?IA:CA)(n):(n.local?MA:PA)(n,r,e))}function RA(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function LA(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function jA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&LA(t,s)),n}return a._value=e,a}function zA(t,e){var n,r;function a(){var s=e.apply(this,arguments);return s!==r&&(n=(r=s)&&RA(t,s)),n}return a._value=e,a}function qA(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=sc(t);return this.tween(n,(r.local?jA:zA)(r,e))}function BA(t,e){return function(){Hd(this,t).delay=+e.apply(this,arguments)}}function FA(t,e){return e=+e,function(){Hd(this,t).delay=e}}function KA(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?BA:FA)(e,t)):qr(this.node(),e).delay}function HA(t,e){return function(){ia(this,t).duration=+e.apply(this,arguments)}}function GA(t,e){return e=+e,function(){ia(this,t).duration=e}}function UA(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?HA:GA)(e,t)):qr(this.node(),e).duration}function VA(t,e){if(typeof e!="function")throw new Error;return function(){ia(this,t).ease=e}}function WA(t){var e=this._id;return arguments.length?this.each(VA(e,t)):qr(this.node(),e).ease}function YA(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ia(this,t).ease=n}}function XA(t){if(typeof t!="function")throw new Error;return this.each(YA(this._id,t))}function ZA(t){typeof t!="function"&&(t=wg(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var s=e[a],i=s.length,l=r[a]=[],u,d=0;d<i;++d)(u=s[d])&&t.call(u,u.__data__,d,s)&&l.push(u);return new xa(r,this._parents,this._name,this._id)}function QA(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,s=Math.min(r,a),i=new Array(r),l=0;l<s;++l)for(var u=e[l],d=n[l],v=u.length,p=i[l]=new Array(v),h,m=0;m<v;++m)(h=u[m]||d[m])&&(p[m]=h);for(;l<r;++l)i[l]=e[l];return new xa(i,this._parents,this._name,this._id)}function JA(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function $A(t,e,n){var r,a,s=JA(e)?Hd:ia;return function(){var i=s(this,t),l=i.on;l!==r&&(a=(r=l).copy()).on(e,n),i.on=a}}function eT(t,e){var n=this._id;return arguments.length<2?qr(this.node(),n).on.on(t):this.each($A(n,t,e))}function tT(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function nT(){return this.on("end.remove",tT(this._id))}function rT(t){var e=this._name,n=this._id;typeof t!="function"&&(t=zd(t));for(var r=this._groups,a=r.length,s=new Array(a),i=0;i<a;++i)for(var l=r[i],u=l.length,d=s[i]=new Array(u),v,p,h=0;h<u;++h)(v=l[h])&&(p=t.call(v,v.__data__,h,l))&&("__data__"in v&&(p.__data__=v.__data__),d[h]=p,oc(d[h],e,n,h,d,qr(v,n)));return new xa(s,this._parents,e,n)}function aT(t){var e=this._name,n=this._id;typeof t!="function"&&(t=bg(t));for(var r=this._groups,a=r.length,s=[],i=[],l=0;l<a;++l)for(var u=r[l],d=u.length,v,p=0;p<d;++p)if(v=u[p]){for(var h=t.call(v,v.__data__,p,u),m,x=qr(v,n),k=0,E=h.length;k<E;++k)(m=h[k])&&oc(m,e,n,k,h,x);s.push(h),i.push(v)}return new xa(s,i,e,n)}var sT=So.prototype.constructor;function iT(){return new sT(this._groups,this._parents)}function oT(t,e){var n,r,a;return function(){var s=oi(this,t),i=(this.style.removeProperty(t),oi(this,t));return s===i?null:s===n&&i===r?a:a=e(n=s,r=i)}}function Gg(t){return function(){this.style.removeProperty(t)}}function lT(t,e,n){var r,a=n+"",s;return function(){var i=oi(this,t);return i===a?null:i===r?s:s=e(r=i,n)}}function cT(t,e,n){var r,a,s;return function(){var i=oi(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),oi(this,t))),i===u?null:i===r&&u===a?s:(a=u,s=e(r=i,l))}}function uT(t,e){var n,r,a,s="style."+e,i="end."+s,l;return function(){var u=ia(this,t),d=u.on,v=u.value[s]==null?l||(l=Gg(e)):void 0;(d!==n||a!==v)&&(r=(n=d).copy()).on(i,a=v),u.on=r}}function dT(t,e,n){var r=(t+="")=="transform"?fA:Hg;return e==null?this.styleTween(t,oT(t,r)).on("end.style."+t,Gg(t)):typeof e=="function"?this.styleTween(t,cT(t,r,Gd(this,"style."+t,e))).each(uT(this._id,t)):this.styleTween(t,lT(t,r,e),n).on("end.style."+t,null)}function fT(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function vT(t,e,n){var r,a;function s(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&fT(t,i,n)),r}return s._value=e,s}function hT(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,vT(t,e,n??""))}function pT(t){return function(){this.textContent=t}}function gT(t){return function(){var e=t(this);this.textContent=e??""}}function mT(t){return this.tween("text",typeof t=="function"?gT(Gd(this,"text",t)):pT(t==null?"":t+""))}function yT(t){return function(e){this.textContent=t.call(this,e)}}function _T(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&yT(a)),e}return r._value=t,r}function bT(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,_T(t))}function wT(){for(var t=this._name,e=this._id,n=Ug(),r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,u,d=0;d<l;++d)if(u=i[d]){var v=qr(u,e);oc(u,t,n,d,i,{time:v.time+v.delay+v.duration,delay:0,duration:v.duration,ease:v.ease})}return new xa(r,this._parents,t,n)}function xT(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(s,i){var l={value:i},u={value:function(){--a===0&&s()}};n.each(function(){var d=ia(this,r),v=d.on;v!==t&&(e=(t=v).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),a===0&&s()})}var kT=0;function xa(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Ug(){return++kT}var ca=So.prototype;xa.prototype={constructor:xa,select:rT,selectAll:aT,selectChild:ca.selectChild,selectChildren:ca.selectChildren,filter:ZA,merge:QA,selection:iT,transition:wT,call:ca.call,nodes:ca.nodes,node:ca.node,size:ca.size,empty:ca.empty,each:ca.each,on:eT,attr:DA,attrTween:qA,style:dT,styleTween:hT,text:mT,textTween:bT,remove:nT,tween:TA,delay:KA,duration:UA,ease:WA,easeVarying:XA,end:xT,[Symbol.iterator]:ca[Symbol.iterator]};function ST(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var ET={time:null,delay:0,duration:250,ease:ST};function AT(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function TT(t){var e,n;t instanceof xa?(e=t._id,t=t._name):(e=Ug(),(n=ET).time=Kd(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,s=0;s<a;++s)for(var i=r[s],l=i.length,u,d=0;d<l;++d)(u=i[d])&&oc(u,t,e,d,i,n||AT(u,e));return new xa(r,this._parents,t,e)}So.prototype.interrupt=SA;So.prototype.transition=TT;const rl=t=>()=>t;function CT(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function ma(t,e,n){this.k=t,this.x=e,this.y=n}ma.prototype={constructor:ma,scale:function(t){return t===1?this:new ma(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ma(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var lc=new ma(1,0,0);Vg.prototype=ma.prototype;function Vg(t){for(;!t.__zoom;)if(!(t=t.parentNode))return lc;return t.__zoom}function ru(t){t.stopImmediatePropagation()}function qi(t){t.preventDefault(),t.stopImmediatePropagation()}function IT(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function PT(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function jv(){return this.__zoom||lc}function MT(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function OT(){return navigator.maxTouchPoints||"ontouchstart"in this}function NT(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],s=t.invertY(e[0][1])-n[0][1],i=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function DT(){var t=IT,e=PT,n=NT,r=MT,a=OT,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,u=gl,d=ac("start","zoom","end"),v,p,h,m=500,x=150,k=0,E=10;function D(C){C.property("__zoom",jv).on("wheel.zoom",J,{passive:!1}).on("mousedown.zoom",ie).on("dblclick.zoom",ke).filter(a).on("touchstart.zoom",F).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",j).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}D.transform=function(C,N,M,$){var H=C.selection?C.selection():C;H.property("__zoom",jv),C!==H?V(C,N,M,$):H.interrupt().each(function(){K(this,arguments).event($).start().zoom(null,typeof N=="function"?N.apply(this,arguments):N).end()})},D.scaleBy=function(C,N,M,$){D.scaleTo(C,function(){var H=this.__zoom.k,L=typeof N=="function"?N.apply(this,arguments):N;return H*L},M,$)},D.scaleTo=function(C,N,M,$){D.transform(C,function(){var H=e.apply(this,arguments),L=this.__zoom,q=M==null?S(H):typeof M=="function"?M.apply(this,arguments):M,te=L.invert(q),ae=typeof N=="function"?N.apply(this,arguments):N;return n(Y(B(L,ae),q,te),H,i)},M,$)},D.translateBy=function(C,N,M,$){D.transform(C,function(){return n(this.__zoom.translate(typeof N=="function"?N.apply(this,arguments):N,typeof M=="function"?M.apply(this,arguments):M),e.apply(this,arguments),i)},null,$)},D.translateTo=function(C,N,M,$,H){D.transform(C,function(){var L=e.apply(this,arguments),q=this.__zoom,te=$==null?S(L):typeof $=="function"?$.apply(this,arguments):$;return n(lc.translate(te[0],te[1]).scale(q.k).translate(typeof N=="function"?-N.apply(this,arguments):-N,typeof M=="function"?-M.apply(this,arguments):-M),L,i)},$,H)};function B(C,N){return N=Math.max(s[0],Math.min(s[1],N)),N===C.k?C:new ma(N,C.x,C.y)}function Y(C,N,M){var $=N[0]-M[0]*C.k,H=N[1]-M[1]*C.k;return $===C.x&&H===C.y?C:new ma(C.k,$,H)}function S(C){return[(+C[0][0]+ +C[1][0])/2,(+C[0][1]+ +C[1][1])/2]}function V(C,N,M,$){C.on("start.zoom",function(){K(this,arguments).event($).start()}).on("interrupt.zoom end.zoom",function(){K(this,arguments).event($).end()}).tween("zoom",function(){var H=this,L=arguments,q=K(H,L).event($),te=e.apply(H,L),ae=M==null?S(te):typeof M=="function"?M.apply(H,L):M,W=Math.max(te[1][0]-te[0][0],te[1][1]-te[0][1]),G=H.__zoom,ne=typeof N=="function"?N.apply(H,L):N,re=u(G.invert(ae).concat(W/G.k),ne.invert(ae).concat(W/ne.k));return function(pe){if(pe===1)pe=ne;else{var ye=re(pe),Se=W/ye[2];pe=new ma(Se,ae[0]-ye[0]*Se,ae[1]-ye[1]*Se)}q.zoom(null,pe)}})}function K(C,N,M){return!M&&C.__zooming||new O(C,N)}function O(C,N){this.that=C,this.args=N,this.active=0,this.sourceEvent=null,this.extent=e.apply(C,N),this.taps=0}O.prototype={event:function(C){return C&&(this.sourceEvent=C),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(C,N){return this.mouse&&C!=="mouse"&&(this.mouse[1]=N.invert(this.mouse[0])),this.touch0&&C!=="touch"&&(this.touch0[1]=N.invert(this.touch0[0])),this.touch1&&C!=="touch"&&(this.touch1[1]=N.invert(this.touch1[0])),this.that.__zoom=N,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(C){var N=Mr(this.that).datum();d.call(C,this.that,new CT(C,{sourceEvent:this.sourceEvent,target:D,transform:this.that.__zoom,dispatch:d}),N)}};function J(C,...N){if(!t.apply(this,arguments))return;var M=K(this,N).event(C),$=this.__zoom,H=Math.max(s[0],Math.min(s[1],$.k*Math.pow(2,r.apply(this,arguments)))),L=Gr(C);if(M.wheel)(M.mouse[0][0]!==L[0]||M.mouse[0][1]!==L[1])&&(M.mouse[1]=$.invert(M.mouse[0]=L)),clearTimeout(M.wheel);else{if($.k===H)return;M.mouse=[L,$.invert(L)],_l(this),M.start()}qi(C),M.wheel=setTimeout(q,x),M.zoom("mouse",n(Y(B($,H),M.mouse[0],M.mouse[1]),M.extent,i));function q(){M.wheel=null,M.end()}}function ie(C,...N){if(h||!t.apply(this,arguments))return;var M=C.currentTarget,$=K(this,N,!0).event(C),H=Mr(C.view).on("mousemove.zoom",ae,!0).on("mouseup.zoom",W,!0),L=Gr(C,M),q=C.clientX,te=C.clientY;Mg(C.view),ru(C),$.mouse=[L,this.__zoom.invert(L)],_l(this),$.start();function ae(G){if(qi(G),!$.moved){var ne=G.clientX-q,re=G.clientY-te;$.moved=ne*ne+re*re>k}$.event(G).zoom("mouse",n(Y($.that.__zoom,$.mouse[0]=Gr(G,M),$.mouse[1]),$.extent,i))}function W(G){H.on("mousemove.zoom mouseup.zoom",null),Og(G.view,$.moved),qi(G),$.event(G).end()}}function ke(C,...N){if(t.apply(this,arguments)){var M=this.__zoom,$=Gr(C.changedTouches?C.changedTouches[0]:C,this),H=M.invert($),L=M.k*(C.shiftKey?.5:2),q=n(Y(B(M,L),$,H),e.apply(this,N),i);qi(C),l>0?Mr(this).transition().duration(l).call(V,q,$,C):Mr(this).call(D.transform,q,$,C)}}function F(C,...N){if(t.apply(this,arguments)){var M=C.touches,$=M.length,H=K(this,N,C.changedTouches.length===$).event(C),L,q,te,ae;for(ru(C),q=0;q<$;++q)te=M[q],ae=Gr(te,this),ae=[ae,this.__zoom.invert(ae),te.identifier],H.touch0?!H.touch1&&H.touch0[2]!==ae[2]&&(H.touch1=ae,H.taps=0):(H.touch0=ae,L=!0,H.taps=1+!!v);v&&(v=clearTimeout(v)),L&&(H.taps<2&&(p=ae[0],v=setTimeout(function(){v=null},m)),_l(this),H.start())}}function I(C,...N){if(this.__zooming){var M=K(this,N).event(C),$=C.changedTouches,H=$.length,L,q,te,ae;for(qi(C),L=0;L<H;++L)q=$[L],te=Gr(q,this),M.touch0&&M.touch0[2]===q.identifier?M.touch0[0]=te:M.touch1&&M.touch1[2]===q.identifier&&(M.touch1[0]=te);if(q=M.that.__zoom,M.touch1){var W=M.touch0[0],G=M.touch0[1],ne=M.touch1[0],re=M.touch1[1],pe=(pe=ne[0]-W[0])*pe+(pe=ne[1]-W[1])*pe,ye=(ye=re[0]-G[0])*ye+(ye=re[1]-G[1])*ye;q=B(q,Math.sqrt(pe/ye)),te=[(W[0]+ne[0])/2,(W[1]+ne[1])/2],ae=[(G[0]+re[0])/2,(G[1]+re[1])/2]}else if(M.touch0)te=M.touch0[0],ae=M.touch0[1];else return;M.zoom("touch",n(Y(q,te,ae),M.extent,i))}}function j(C,...N){if(this.__zooming){var M=K(this,N).event(C),$=C.changedTouches,H=$.length,L,q;for(ru(C),h&&clearTimeout(h),h=setTimeout(function(){h=null},m),L=0;L<H;++L)q=$[L],M.touch0&&M.touch0[2]===q.identifier?delete M.touch0:M.touch1&&M.touch1[2]===q.identifier&&delete M.touch1;if(M.touch1&&!M.touch0&&(M.touch0=M.touch1,delete M.touch1),M.touch0)M.touch0[1]=this.__zoom.invert(M.touch0[0]);else if(M.end(),M.taps===2&&(q=Gr(q,this),Math.hypot(p[0]-q[0],p[1]-q[1])<E)){var te=Mr(this).on("dblclick.zoom");te&&te.apply(this,arguments)}}}return D.wheelDelta=function(C){return arguments.length?(r=typeof C=="function"?C:rl(+C),D):r},D.filter=function(C){return arguments.length?(t=typeof C=="function"?C:rl(!!C),D):t},D.touchable=function(C){return arguments.length?(a=typeof C=="function"?C:rl(!!C),D):a},D.extent=function(C){return arguments.length?(e=typeof C=="function"?C:rl([[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]]),D):e},D.scaleExtent=function(C){return arguments.length?(s[0]=+C[0],s[1]=+C[1],D):[s[0],s[1]]},D.translateExtent=function(C){return arguments.length?(i[0][0]=+C[0][0],i[1][0]=+C[1][0],i[0][1]=+C[0][1],i[1][1]=+C[1][1],D):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},D.constrain=function(C){return arguments.length?(n=C,D):n},D.duration=function(C){return arguments.length?(l=+C,D):l},D.interpolate=function(C){return arguments.length?(u=C,D):u},D.on=function(){var C=d.on.apply(d,arguments);return C===d?D:C},D.clickDistance=function(C){return arguments.length?(k=(C=+C)*C,D):Math.sqrt(k)},D.tapDistance=function(C){return arguments.length?(E=+C,D):E},D}const ao={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:t=>`Node type "${t}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:t=>`The old edge with id=${t} does not exist.`,error009:t=>`Marker type "${t}" doesn't exist.`,error008:(t,{id:e,sourceHandle:n,targetHandle:r})=>`Couldn't create edge for ${t} handle id: "${t==="source"?n:r}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:t=>`Edge type "${t}" not found. Using fallback type "default".`,error012:t=>`Node with id "${t}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(t="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${t}/dist/style.css' or base.css to make sure everything is working properly.`,error014:()=>"useNodeConnections: No node ID found. Call useNodeConnections inside a custom Node or provide a node ID.",error015:()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs."},Xu=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Wg=["Enter"," ","Escape"],RT={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:t,x:e,y:n})=>`Moved selected node ${t}. New position, x: ${e}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var ci;(function(t){t.Strict="strict",t.Loose="loose"})(ci||(ci={}));var Us;(function(t){t.Free="free",t.Vertical="vertical",t.Horizontal="horizontal"})(Us||(Us={}));var Rl;(function(t){t.Partial="partial",t.Full="full"})(Rl||(Rl={}));const Zu={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null,pointer:null};var Oa;(function(t){t.Bezier="default",t.Straight="straight",t.Step="step",t.SmoothStep="smoothstep",t.SimpleBezier="simplebezier"})(Oa||(Oa={}));var Ll;(function(t){t.Arrow="arrow",t.ArrowClosed="arrowclosed"})(Ll||(Ll={}));var wt;(function(t){t.Left="left",t.Top="top",t.Right="right",t.Bottom="bottom"})(wt||(wt={}));const zv={[wt.Left]:wt.Right,[wt.Right]:wt.Left,[wt.Top]:wt.Bottom,[wt.Bottom]:wt.Top};function LT(t,e){if(!t&&!e)return!0;if(!t||!e||t.size!==e.size)return!1;if(!t.size&&!e.size)return!0;for(const n of t.keys())if(!e.has(n))return!1;return!0}function qv(t,e,n){if(!n)return;const r=[];t.forEach((a,s)=>{e!=null&&e.has(s)||r.push(a)}),r.length&&n(r)}function jT(t){return t===null?null:t?"valid":"invalid"}const Yg=t=>"id"in t&&"source"in t&&"target"in t,zT=t=>"id"in t&&"position"in t&&!("source"in t)&&!("target"in t),Ud=t=>"id"in t&&"internals"in t&&!("source"in t)&&!("target"in t),Ao=(t,e=[0,0])=>{const{width:n,height:r}=Ms(t),a=t.origin??e,s=n*a[0],i=r*a[1];return{x:t.position.x-s,y:t.position.y-i}},qT=(t,e={nodeOrigin:[0,0]})=>{if(t.length===0)return{x:0,y:0,width:0,height:0};const n=t.reduce((r,a)=>{const s=typeof a=="string";let i=!e.nodeLookup&&!s?a:void 0;e.nodeLookup&&(i=s?e.nodeLookup.get(a):Ud(a)?a:e.nodeLookup.get(a.id));const l=i?jl(i,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return uc(r,l)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return dc(n)},cc=(t,e={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},r=!1;return t.forEach(a=>{(e.filter===void 0||e.filter(a))&&(n=uc(n,jl(a)),r=!0)}),r?dc(n):{x:0,y:0,width:0,height:0}},Vd=(t,e,[n,r,a]=[0,0,1],s=!1,i=!1)=>{const l={...Co(e,[n,r,a]),width:e.width/a,height:e.height/a},u=[];for(const d of t.values()){const{measured:v,selectable:p=!0,hidden:h=!1}=d;if(i&&!p||h)continue;const m=v.width??d.width??d.initialWidth??null,x=v.height??d.height??d.initialHeight??null,k=so(l,di(d)),E=(m??0)*(x??0),D=s&&k>0;(!d.internals.handleBounds||D||k>=E||d.dragging)&&u.push(d)}return u},BT=(t,e)=>{const n=new Set;return t.forEach(r=>{n.add(r.id)}),e.filter(r=>n.has(r.source)||n.has(r.target))};function FT(t,e){const n=new Map,r=e!=null&&e.nodes?new Set(e.nodes.map(a=>a.id)):null;return t.forEach(a=>{a.measured.width&&a.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!a.hidden)&&(!r||r.has(a.id))&&n.set(a.id,a)}),n}async function KT({nodes:t,width:e,height:n,panZoom:r,minZoom:a,maxZoom:s},i){if(t.size===0)return Promise.resolve(!0);const l=FT(t,i),u=cc(l),d=Wd(u,e,n,(i==null?void 0:i.minZoom)??a,(i==null?void 0:i.maxZoom)??s,(i==null?void 0:i.padding)??.1);return await r.setViewport(d,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)}function Xg({nodeId:t,nextPosition:e,nodeLookup:n,nodeOrigin:r=[0,0],nodeExtent:a,onError:s}){const i=n.get(t),l=i.parentId?n.get(i.parentId):void 0,{x:u,y:d}=l?l.internals.positionAbsolute:{x:0,y:0},v=i.origin??r;let p=i.extent||a;if(i.extent==="parent"&&!i.expandParent)if(!l)s==null||s("005",ao.error005());else{const m=l.measured.width,x=l.measured.height;m&&x&&(p=[[u,d],[u+m,d+x]])}else l&&fi(i.extent)&&(p=[[i.extent[0][0]+u,i.extent[0][1]+d],[i.extent[1][0]+u,i.extent[1][1]+d]]);const h=fi(p)?ks(e,p,i.measured):e;return(i.measured.width===void 0||i.measured.height===void 0)&&(s==null||s("015",ao.error015())),{position:{x:h.x-u+(i.measured.width??0)*v[0],y:h.y-d+(i.measured.height??0)*v[1]},positionAbsolute:h}}async function HT({nodesToRemove:t=[],edgesToRemove:e=[],nodes:n,edges:r,onBeforeDelete:a}){const s=new Set(t.map(h=>h.id)),i=[];for(const h of n){if(h.deletable===!1)continue;const m=s.has(h.id),x=!m&&h.parentId&&i.find(k=>k.id===h.parentId);(m||x)&&i.push(h)}const l=new Set(e.map(h=>h.id)),u=r.filter(h=>h.deletable!==!1),v=BT(i,u);for(const h of u)l.has(h.id)&&!v.find(x=>x.id===h.id)&&v.push(h);if(!a)return{edges:v,nodes:i};const p=await a({nodes:i,edges:v});return typeof p=="boolean"?p?{edges:v,nodes:i}:{edges:[],nodes:[]}:p}const ui=(t,e=0,n=1)=>Math.min(Math.max(t,e),n),ks=(t={x:0,y:0},e,n)=>({x:ui(t.x,e[0][0],e[1][0]-((n==null?void 0:n.width)??0)),y:ui(t.y,e[0][1],e[1][1]-((n==null?void 0:n.height)??0))});function Zg(t,e,n){const{width:r,height:a}=Ms(n),{x:s,y:i}=n.internals.positionAbsolute;return ks(t,[[s,i],[s+r,i+a]],e)}const Bv=(t,e,n)=>t<e?ui(Math.abs(t-e),1,e)/e:t>n?-ui(Math.abs(t-n),1,e)/e:0,Qg=(t,e,n=15,r=40)=>{const a=Bv(t.x,r,e.width-r)*n,s=Bv(t.y,r,e.height-r)*n;return[a,s]},uc=(t,e)=>({x:Math.min(t.x,e.x),y:Math.min(t.y,e.y),x2:Math.max(t.x2,e.x2),y2:Math.max(t.y2,e.y2)}),Qu=({x:t,y:e,width:n,height:r})=>({x:t,y:e,x2:t+n,y2:e+r}),dc=({x:t,y:e,x2:n,y2:r})=>({x:t,y:e,width:n-t,height:r-e}),di=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=Ud(t)?t.internals.positionAbsolute:Ao(t,e);return{x:n,y:r,width:((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0,height:((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0}},jl=(t,e=[0,0])=>{var a,s;const{x:n,y:r}=Ud(t)?t.internals.positionAbsolute:Ao(t,e);return{x:n,y:r,x2:n+(((a=t.measured)==null?void 0:a.width)??t.width??t.initialWidth??0),y2:r+(((s=t.measured)==null?void 0:s.height)??t.height??t.initialHeight??0)}},GT=(t,e)=>dc(uc(Qu(t),Qu(e))),so=(t,e)=>{const n=Math.max(0,Math.min(t.x+t.width,e.x+e.width)-Math.max(t.x,e.x)),r=Math.max(0,Math.min(t.y+t.height,e.y+e.height)-Math.max(t.y,e.y));return Math.ceil(n*r)},Fv=t=>ya(t.width)&&ya(t.height)&&ya(t.x)&&ya(t.y),ya=t=>!isNaN(t)&&isFinite(t),UT=(t,e)=>{},To=(t,e=[1,1])=>({x:e[0]*Math.round(t.x/e[0]),y:e[1]*Math.round(t.y/e[1])}),Co=({x:t,y:e},[n,r,a],s=!1,i=[1,1])=>{const l={x:(t-n)/a,y:(e-r)/a};return s?To(l,i):l},zl=({x:t,y:e},[n,r,a])=>({x:t*a+n,y:e*a+r});function Bs(t,e){if(typeof t=="number")return Math.floor((e-e/(1+t))*.5);if(typeof t=="string"&&t.endsWith("px")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(n)}if(typeof t=="string"&&t.endsWith("%")){const n=parseFloat(t);if(!Number.isNaN(n))return Math.floor(e*n*.01)}return console.error(`[React Flow] The padding value "${t}" is invalid. Please provide a number or a string with a valid unit (px or %).`),0}function VT(t,e,n){if(typeof t=="string"||typeof t=="number"){const r=Bs(t,n),a=Bs(t,e);return{top:r,right:a,bottom:r,left:a,x:a*2,y:r*2}}if(typeof t=="object"){const r=Bs(t.top??t.y??0,n),a=Bs(t.bottom??t.y??0,n),s=Bs(t.left??t.x??0,e),i=Bs(t.right??t.x??0,e);return{top:r,right:i,bottom:a,left:s,x:s+i,y:r+a}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}function WT(t,e,n,r,a,s){const{x:i,y:l}=zl(t,[e,n,r]),{x:u,y:d}=zl({x:t.x+t.width,y:t.y+t.height},[e,n,r]),v=a-u,p=s-d;return{left:Math.floor(i),top:Math.floor(l),right:Math.floor(v),bottom:Math.floor(p)}}const Wd=(t,e,n,r,a,s)=>{const i=VT(s,e,n),l=(e-i.x)/t.width,u=(n-i.y)/t.height,d=Math.min(l,u),v=ui(d,r,a),p=t.x+t.width/2,h=t.y+t.height/2,m=e/2-p*v,x=n/2-h*v,k=WT(t,m,x,v,e,n),E={left:Math.min(k.left-i.left,0),top:Math.min(k.top-i.top,0),right:Math.min(k.right-i.right,0),bottom:Math.min(k.bottom-i.bottom,0)};return{x:m-E.left+E.right,y:x-E.top+E.bottom,zoom:v}},ql=()=>{var t;return typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)==null?void 0:t.indexOf("Mac"))>=0};function fi(t){return t!=null&&t!=="parent"}function Ms(t){var e,n;return{width:((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth??0,height:((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight??0}}function YT(t){var e,n;return(((e=t.measured)==null?void 0:e.width)??t.width??t.initialWidth)!==void 0&&(((n=t.measured)==null?void 0:n.height)??t.height??t.initialHeight)!==void 0}function XT(t,e={width:0,height:0},n,r,a){const s={...t},i=r.get(n);if(i){const l=i.origin||a;s.x+=i.internals.positionAbsolute.x-(e.width??0)*l[0],s.y+=i.internals.positionAbsolute.y-(e.height??0)*l[1]}return s}function ZT(t){return{...RT,...t||{}}}function au(t,{snapGrid:e=[0,0],snapToGrid:n=!1,transform:r,containerBounds:a}){const{x:s,y:i}=Rr(t),l=Co({x:s-((a==null?void 0:a.left)??0),y:i-((a==null?void 0:a.top)??0)},r),{x:u,y:d}=n?To(l,e):l;return{xSnapped:u,ySnapped:d,...l}}const Jg=t=>({width:t.offsetWidth,height:t.offsetHeight}),$g=t=>{var e;return((e=t==null?void 0:t.getRootNode)==null?void 0:e.call(t))||(window==null?void 0:window.document)},QT=["INPUT","SELECT","TEXTAREA"];function em(t){var r,a;const e=((a=(r=t.composedPath)==null?void 0:r.call(t))==null?void 0:a[0])||t.target;return(e==null?void 0:e.nodeType)!==1?!1:QT.includes(e.nodeName)||e.hasAttribute("contenteditable")||!!e.closest(".nokey")}const tm=t=>"clientX"in t,Rr=(t,e)=>{var s,i;const n=tm(t),r=n?t.clientX:(s=t.touches)==null?void 0:s[0].clientX,a=n?t.clientY:(i=t.touches)==null?void 0:i[0].clientY;return{x:r-((e==null?void 0:e.left)??0),y:a-((e==null?void 0:e.top)??0)}},Kv=(t,e,n,r,a)=>{const s=e.querySelectorAll(`.${t}`);return!s||!s.length?null:Array.from(s).map(i=>{const l=i.getBoundingClientRect();return{id:i.getAttribute("data-handleid"),type:t,nodeId:a,position:i.getAttribute("data-handlepos"),x:(l.left-n.left)/r,y:(l.top-n.top)/r,...Jg(i)}})};function JT({sourceX:t,sourceY:e,targetX:n,targetY:r,sourceControlX:a,sourceControlY:s,targetControlX:i,targetControlY:l}){const u=t*.125+a*.375+i*.375+n*.125,d=e*.125+s*.375+l*.375+r*.125,v=Math.abs(u-t),p=Math.abs(d-e);return[u,d,v,p]}function al(t,e){return t>=0?.5*t:e*25*Math.sqrt(-t)}function Hv({pos:t,x1:e,y1:n,x2:r,y2:a,c:s}){switch(t){case wt.Left:return[e-al(e-r,s),n];case wt.Right:return[e+al(r-e,s),n];case wt.Top:return[e,n-al(n-a,s)];case wt.Bottom:return[e,n+al(a-n,s)]}}function nm({sourceX:t,sourceY:e,sourcePosition:n=wt.Bottom,targetX:r,targetY:a,targetPosition:s=wt.Top,curvature:i=.25}){const[l,u]=Hv({pos:n,x1:t,y1:e,x2:r,y2:a,c:i}),[d,v]=Hv({pos:s,x1:r,y1:a,x2:t,y2:e,c:i}),[p,h,m,x]=JT({sourceX:t,sourceY:e,targetX:r,targetY:a,sourceControlX:l,sourceControlY:u,targetControlX:d,targetControlY:v});return[`M${t},${e} C${l},${u} ${d},${v} ${r},${a}`,p,h,m,x]}function rm({sourceX:t,sourceY:e,targetX:n,targetY:r}){const a=Math.abs(n-t)/2,s=n<t?n+a:n-a,i=Math.abs(r-e)/2,l=r<e?r+i:r-i;return[s,l,a,i]}function $T({sourceNode:t,targetNode:e,selected:n=!1,zIndex:r=0,elevateOnSelect:a=!1,zIndexMode:s="basic"}){if(s==="manual")return r;const i=a&&n?r+1e3:r,l=Math.max(t.parentId||a&&t.selected?t.internals.z:0,e.parentId||a&&e.selected?e.internals.z:0);return i+l}function eC({sourceNode:t,targetNode:e,width:n,height:r,transform:a}){const s=uc(jl(t),jl(e));s.x===s.x2&&(s.x2+=1),s.y===s.y2&&(s.y2+=1);const i={x:-a[0]/a[2],y:-a[1]/a[2],width:n/a[2],height:r/a[2]};return so(i,dc(s))>0}const tC=({source:t,sourceHandle:e,target:n,targetHandle:r})=>`xy-edge__${t}${e||""}-${n}${r||""}`,nC=(t,e)=>e.some(n=>n.source===t.source&&n.target===t.target&&(n.sourceHandle===t.sourceHandle||!n.sourceHandle&&!t.sourceHandle)&&(n.targetHandle===t.targetHandle||!n.targetHandle&&!t.targetHandle)),rC=(t,e,n={})=>{if(!t.source||!t.target)return e;const r=n.getEdgeId||tC;let a;return Yg(t)?a={...t}:a={...t,id:r(t)},nC(a,e)?e:(a.sourceHandle===null&&delete a.sourceHandle,a.targetHandle===null&&delete a.targetHandle,e.concat(a))};function am({sourceX:t,sourceY:e,targetX:n,targetY:r}){const[a,s,i,l]=rm({sourceX:t,sourceY:e,targetX:n,targetY:r});return[`M ${t},${e}L ${n},${r}`,a,s,i,l]}const Gv={[wt.Left]:{x:-1,y:0},[wt.Right]:{x:1,y:0},[wt.Top]:{x:0,y:-1},[wt.Bottom]:{x:0,y:1}},aC=({source:t,sourcePosition:e=wt.Bottom,target:n})=>e===wt.Left||e===wt.Right?t.x<n.x?{x:1,y:0}:{x:-1,y:0}:t.y<n.y?{x:0,y:1}:{x:0,y:-1},Uv=(t,e)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));function sC({source:t,sourcePosition:e=wt.Bottom,target:n,targetPosition:r=wt.Top,center:a,offset:s,stepPosition:i}){const l=Gv[e],u=Gv[r],d={x:t.x+l.x*s,y:t.y+l.y*s},v={x:n.x+u.x*s,y:n.y+u.y*s},p=aC({source:d,sourcePosition:e,target:v}),h=p.x!==0?"x":"y",m=p[h];let x=[],k,E;const D={x:0,y:0},B={x:0,y:0},[,,Y,S]=rm({sourceX:t.x,sourceY:t.y,targetX:n.x,targetY:n.y});if(l[h]*u[h]===-1){h==="x"?(k=a.x??d.x+(v.x-d.x)*i,E=a.y??(d.y+v.y)/2):(k=a.x??(d.x+v.x)/2,E=a.y??d.y+(v.y-d.y)*i);const K=[{x:k,y:d.y},{x:k,y:v.y}],O=[{x:d.x,y:E},{x:v.x,y:E}];l[h]===m?x=h==="x"?K:O:x=h==="x"?O:K}else{const K=[{x:d.x,y:v.y}],O=[{x:v.x,y:d.y}];if(h==="x"?x=l.x===m?O:K:x=l.y===m?K:O,e===r){const I=Math.abs(t[h]-n[h]);if(I<=s){const j=Math.min(s-1,s-I);l[h]===m?D[h]=(d[h]>t[h]?-1:1)*j:B[h]=(v[h]>n[h]?-1:1)*j}}if(e!==r){const I=h==="x"?"y":"x",j=l[h]===u[I],C=d[I]>v[I],N=d[I]<v[I];(l[h]===1&&(!j&&C||j&&N)||l[h]!==1&&(!j&&N||j&&C))&&(x=h==="x"?K:O)}const J={x:d.x+D.x,y:d.y+D.y},ie={x:v.x+B.x,y:v.y+B.y},ke=Math.max(Math.abs(J.x-x[0].x),Math.abs(ie.x-x[0].x)),F=Math.max(Math.abs(J.y-x[0].y),Math.abs(ie.y-x[0].y));ke>=F?(k=(J.x+ie.x)/2,E=x[0].y):(k=x[0].x,E=(J.y+ie.y)/2)}return[[t,{x:d.x+D.x,y:d.y+D.y},...x,{x:v.x+B.x,y:v.y+B.y},n],k,E,Y,S]}function iC(t,e,n,r){const a=Math.min(Uv(t,e)/2,Uv(e,n)/2,r),{x:s,y:i}=e;if(t.x===s&&s===n.x||t.y===i&&i===n.y)return`L${s} ${i}`;if(t.y===i){const d=t.x<n.x?-1:1,v=t.y<n.y?1:-1;return`L ${s+a*d},${i}Q ${s},${i} ${s},${i+a*v}`}const l=t.x<n.x?1:-1,u=t.y<n.y?-1:1;return`L ${s},${i+a*u}Q ${s},${i} ${s+a*l},${i}`}function Yd({sourceX:t,sourceY:e,sourcePosition:n=wt.Bottom,targetX:r,targetY:a,targetPosition:s=wt.Top,borderRadius:i=5,centerX:l,centerY:u,offset:d=20,stepPosition:v=.5}){const[p,h,m,x,k]=sC({source:{x:t,y:e},sourcePosition:n,target:{x:r,y:a},targetPosition:s,center:{x:l,y:u},offset:d,stepPosition:v});return[p.reduce((D,B,Y)=>{let S="";return Y>0&&Y<p.length-1?S=iC(p[Y-1],B,p[Y+1],i):S=`${Y===0?"M":"L"}${B.x} ${B.y}`,D+=S,D},""),h,m,x,k]}function Vv(t){var e;return t&&!!(t.internals.handleBounds||(e=t.handles)!=null&&e.length)&&!!(t.measured.width||t.width||t.initialWidth)}function oC(t){var p;const{sourceNode:e,targetNode:n}=t;if(!Vv(e)||!Vv(n))return null;const r=e.internals.handleBounds||Wv(e.handles),a=n.internals.handleBounds||Wv(n.handles),s=Yv((r==null?void 0:r.source)??[],t.sourceHandle),i=Yv(t.connectionMode===ci.Strict?(a==null?void 0:a.target)??[]:((a==null?void 0:a.target)??[]).concat((a==null?void 0:a.source)??[]),t.targetHandle);if(!s||!i)return(p=t.onError)==null||p.call(t,"008",ao.error008(s?"target":"source",{id:t.id,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle})),null;const l=(s==null?void 0:s.position)||wt.Bottom,u=(i==null?void 0:i.position)||wt.Top,d=Ss(e,s,l),v=Ss(n,i,u);return{sourceX:d.x,sourceY:d.y,targetX:v.x,targetY:v.y,sourcePosition:l,targetPosition:u}}function Wv(t){if(!t)return null;const e=[],n=[];for(const r of t)r.width=r.width??1,r.height=r.height??1,r.type==="source"?e.push(r):r.type==="target"&&n.push(r);return{source:e,target:n}}function Ss(t,e,n=wt.Left,r=!1){const a=((e==null?void 0:e.x)??0)+t.internals.positionAbsolute.x,s=((e==null?void 0:e.y)??0)+t.internals.positionAbsolute.y,{width:i,height:l}=e??Ms(t);if(r)return{x:a+i/2,y:s+l/2};switch((e==null?void 0:e.position)??n){case wt.Top:return{x:a+i/2,y:s};case wt.Right:return{x:a+i,y:s+l/2};case wt.Bottom:return{x:a+i/2,y:s+l};case wt.Left:return{x:a,y:s+l/2}}}function Yv(t,e){return t&&(e?t.find(n=>n.id===e):t[0])||null}function Ju(t,e){return t?typeof t=="string"?t:`${e?`${e}__`:""}${Object.keys(t).sort().map(r=>`${r}=${t[r]}`).join("&")}`:""}function lC(t,{id:e,defaultColor:n,defaultMarkerStart:r,defaultMarkerEnd:a}){const s=new Set;return t.reduce((i,l)=>([l.markerStart||r,l.markerEnd||a].forEach(u=>{if(u&&typeof u=="object"){const d=Ju(u,e);s.has(d)||(i.push({id:d,color:u.color||n,...u}),s.add(d))}}),i),[]).sort((i,l)=>i.id.localeCompare(l.id))}const sm=1e3,cC=10,Xd={nodeOrigin:[0,0],nodeExtent:Xu,elevateNodesOnSelect:!0,zIndexMode:"basic",defaults:{}},uC={...Xd,checkEquality:!0};function Zd(t,e){const n={...t};for(const r in e)e[r]!==void 0&&(n[r]=e[r]);return n}function dC(t,e,n){const r=Zd(Xd,n);for(const a of t.values())if(a.parentId)Jd(a,t,e,r);else{const s=Ao(a,r.nodeOrigin),i=fi(a.extent)?a.extent:r.nodeExtent,l=ks(s,i,Ms(a));a.internals.positionAbsolute=l}}function fC(t,e){if(!t.handles)return t.measured?e==null?void 0:e.internals.handleBounds:void 0;const n=[],r=[];for(const a of t.handles){const s={id:a.id,width:a.width??1,height:a.height??1,nodeId:t.id,x:a.x,y:a.y,position:a.position,type:a.type};a.type==="source"?n.push(s):a.type==="target"&&r.push(s)}return{source:n,target:r}}function Qd(t){return t==="manual"}function vC(t,e,n,r={}){var d,v;const a=Zd(uC,r),s={i:0},i=new Map(e),l=a!=null&&a.elevateNodesOnSelect&&!Qd(a.zIndexMode)?sm:0;let u=t.length>0;e.clear(),n.clear();for(const p of t){let h=i.get(p.id);if(a.checkEquality&&p===(h==null?void 0:h.internals.userNode))e.set(p.id,h);else{const m=Ao(p,a.nodeOrigin),x=fi(p.extent)?p.extent:a.nodeExtent,k=ks(m,x,Ms(p));h={...a.defaults,...p,measured:{width:(d=p.measured)==null?void 0:d.width,height:(v=p.measured)==null?void 0:v.height},internals:{positionAbsolute:k,handleBounds:fC(p,h),z:im(p,l,a.zIndexMode),userNode:p}},e.set(p.id,h)}(h.measured===void 0||h.measured.width===void 0||h.measured.height===void 0)&&!h.hidden&&(u=!1),p.parentId&&Jd(h,e,n,r,s)}return u}function hC(t,e){if(!t.parentId)return;const n=e.get(t.parentId);n?n.set(t.id,t):e.set(t.parentId,new Map([[t.id,t]]))}function Jd(t,e,n,r,a){const{elevateNodesOnSelect:s,nodeOrigin:i,nodeExtent:l,zIndexMode:u}=Zd(Xd,r),d=t.parentId,v=e.get(d);if(!v){console.warn(`Parent node ${d} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}hC(t,n),a&&!v.parentId&&v.internals.rootParentIndex===void 0&&u==="auto"&&(v.internals.rootParentIndex=++a.i,v.internals.z=v.internals.z+a.i*cC),a&&v.internals.rootParentIndex!==void 0&&(a.i=v.internals.rootParentIndex);const p=s&&!Qd(u)?sm:0,{x:h,y:m,z:x}=pC(t,v,i,l,p,u),{positionAbsolute:k}=t.internals,E=h!==k.x||m!==k.y;(E||x!==t.internals.z)&&e.set(t.id,{...t,internals:{...t.internals,positionAbsolute:E?{x:h,y:m}:k,z:x}})}function im(t,e,n){const r=ya(t.zIndex)?t.zIndex:0;return Qd(n)?r:r+(t.selected?e:0)}function pC(t,e,n,r,a,s){const{x:i,y:l}=e.internals.positionAbsolute,u=Ms(t),d=Ao(t,n),v=fi(t.extent)?ks(d,t.extent,u):d;let p=ks({x:i+v.x,y:l+v.y},r,u);t.extent==="parent"&&(p=Zg(p,u,e));const h=im(t,a,s),m=e.internals.z??0;return{x:p.x,y:p.y,z:m>=h?m+1:h}}function gC(t,e,n,r=[0,0]){var i;const a=[],s=new Map;for(const l of t){const u=e.get(l.parentId);if(!u)continue;const d=((i=s.get(l.parentId))==null?void 0:i.expandedRect)??di(u),v=GT(d,l.rect);s.set(l.parentId,{expandedRect:v,parent:u})}return s.size>0&&s.forEach(({expandedRect:l,parent:u},d)=>{var Y;const v=u.internals.positionAbsolute,p=Ms(u),h=u.origin??r,m=l.x<v.x?Math.round(Math.abs(v.x-l.x)):0,x=l.y<v.y?Math.round(Math.abs(v.y-l.y)):0,k=Math.max(p.width,Math.round(l.width)),E=Math.max(p.height,Math.round(l.height)),D=(k-p.width)*h[0],B=(E-p.height)*h[1];(m>0||x>0||D||B)&&(a.push({id:d,type:"position",position:{x:u.position.x-m+D,y:u.position.y-x+B}}),(Y=n.get(d))==null||Y.forEach(S=>{t.some(V=>V.id===S.id)||a.push({id:S.id,type:"position",position:{x:S.position.x+m,y:S.position.y+x}})})),(p.width<l.width||p.height<l.height||m||x)&&a.push({id:d,type:"dimensions",setAttributes:!0,dimensions:{width:k+(m?h[0]*m-D:0),height:E+(x?h[1]*x-B:0)}})}),a}function mC(t,e,n,r,a,s,i){const l=r==null?void 0:r.querySelector(".xyflow__viewport");let u=!1;if(!l)return{changes:[],updatedInternals:u};const d=[],v=window.getComputedStyle(l),{m22:p}=new window.DOMMatrixReadOnly(v.transform),h=[];for(const m of t.values()){const x=e.get(m.id);if(!x)continue;if(x.hidden){e.set(x.id,{...x,internals:{...x.internals,handleBounds:void 0}}),u=!0;continue}const k=Jg(m.nodeElement),E=x.measured.width!==k.width||x.measured.height!==k.height;if(!!(k.width&&k.height&&(E||!x.internals.handleBounds||m.force))){const B=m.nodeElement.getBoundingClientRect(),Y=fi(x.extent)?x.extent:s;let{positionAbsolute:S}=x.internals;x.parentId&&x.extent==="parent"?S=Zg(S,k,e.get(x.parentId)):Y&&(S=ks(S,Y,k));const V={...x,measured:k,internals:{...x.internals,positionAbsolute:S,handleBounds:{source:Kv("source",m.nodeElement,B,p,x.id),target:Kv("target",m.nodeElement,B,p,x.id)}}};e.set(x.id,V),x.parentId&&Jd(V,e,n,{nodeOrigin:a,zIndexMode:i}),u=!0,E&&(d.push({id:x.id,type:"dimensions",dimensions:k}),x.expandParent&&x.parentId&&h.push({id:x.id,parentId:x.parentId,rect:di(V,a)}))}}if(h.length>0){const m=gC(h,e,n,a);d.push(...m)}return{changes:d,updatedInternals:u}}async function yC({delta:t,panZoom:e,transform:n,translateExtent:r,width:a,height:s}){if(!e||!t.x&&!t.y)return Promise.resolve(!1);const i=await e.setViewportConstrained({x:n[0]+t.x,y:n[1]+t.y,zoom:n[2]},[[0,0],[a,s]],r),l=!!i&&(i.x!==n[0]||i.y!==n[1]||i.k!==n[2]);return Promise.resolve(l)}function Xv(t,e,n,r,a,s){let i=a;const l=r.get(i)||new Map;r.set(i,l.set(n,e)),i=`${a}-${t}`;const u=r.get(i)||new Map;if(r.set(i,u.set(n,e)),s){i=`${a}-${t}-${s}`;const d=r.get(i)||new Map;r.set(i,d.set(n,e))}}function _C(t,e,n){t.clear(),e.clear();for(const r of n){const{source:a,target:s,sourceHandle:i=null,targetHandle:l=null}=r,u={edgeId:r.id,source:a,target:s,sourceHandle:i,targetHandle:l},d=`${a}-${i}--${s}-${l}`,v=`${s}-${l}--${a}-${i}`;Xv("source",u,v,t,a,i),Xv("target",u,d,t,s,l),e.set(r.id,r)}}function om(t,e){if(!t.parentId)return!1;const n=e.get(t.parentId);return n?n.selected?!0:om(n,e):!1}function Zv(t,e,n){var a;let r=t;do{if((a=r==null?void 0:r.matches)!=null&&a.call(r,e))return!0;if(r===n)return!1;r=r==null?void 0:r.parentElement}while(r);return!1}function bC(t,e,n,r){const a=new Map;for(const[s,i]of t)if((i.selected||i.id===r)&&(!i.parentId||!om(i,t))&&(i.draggable||e&&typeof i.draggable>"u")){const l=t.get(s);l&&a.set(s,{id:s,position:l.position||{x:0,y:0},distance:{x:n.x-l.internals.positionAbsolute.x,y:n.y-l.internals.positionAbsolute.y},extent:l.extent,parentId:l.parentId,origin:l.origin,expandParent:l.expandParent,internals:{positionAbsolute:l.internals.positionAbsolute||{x:0,y:0}},measured:{width:l.measured.width??0,height:l.measured.height??0}})}return a}function su({nodeId:t,dragItems:e,nodeLookup:n,dragging:r=!0}){var i,l,u;const a=[];for(const[d,v]of e){const p=(i=n.get(d))==null?void 0:i.internals.userNode;p&&a.push({...p,position:v.position,dragging:r})}if(!t)return[a[0],a];const s=(l=n.get(t))==null?void 0:l.internals.userNode;return[s?{...s,position:((u=e.get(t))==null?void 0:u.position)||s.position,dragging:r}:a[0],a]}function wC({dragItems:t,snapGrid:e,x:n,y:r}){const a=t.values().next().value;if(!a)return null;const s={x:n-a.distance.x,y:r-a.distance.y},i=To(s,e);return{x:i.x-s.x,y:i.y-s.y}}function xC({onNodeMouseDown:t,getStoreItems:e,onDragStart:n,onDrag:r,onDragStop:a}){let s={x:null,y:null},i=0,l=new Map,u=!1,d={x:0,y:0},v=null,p=!1,h=null,m=!1,x=!1,k=null;function E({noDragClassName:B,handleSelector:Y,domNode:S,isSelectable:V,nodeId:K,nodeClickDistance:O=0}){h=Mr(S);function J({x:I,y:j}){const{nodeLookup:C,nodeExtent:N,snapGrid:M,snapToGrid:$,nodeOrigin:H,onNodeDrag:L,onSelectionDrag:q,onError:te,updateNodePositions:ae}=e();s={x:I,y:j};let W=!1;const G=l.size>1,ne=G&&N?Qu(cc(l)):null,re=G&&$?wC({dragItems:l,snapGrid:M,x:I,y:j}):null;for(const[pe,ye]of l){if(!C.has(pe))continue;let Se={x:I-ye.distance.x,y:j-ye.distance.y};$&&(Se=re?{x:Math.round(Se.x+re.x),y:Math.round(Se.y+re.y)}:To(Se,M));let Z=null;if(G&&N&&!ye.extent&&ne){const{positionAbsolute:Ie}=ye.internals,Ye=Ie.x-ne.x+N[0][0],Je=Ie.x+ye.measured.width-ne.x2+N[1][0],ct=Ie.y-ne.y+N[0][1],qe=Ie.y+ye.measured.height-ne.y2+N[1][1];Z=[[Ye,ct],[Je,qe]]}const{position:he,positionAbsolute:be}=Xg({nodeId:pe,nextPosition:Se,nodeLookup:C,nodeExtent:Z||N,nodeOrigin:H,onError:te});W=W||ye.position.x!==he.x||ye.position.y!==he.y,ye.position=he,ye.internals.positionAbsolute=be}if(x=x||W,!!W&&(ae(l,!0),k&&(r||L||!K&&q))){const[pe,ye]=su({nodeId:K,dragItems:l,nodeLookup:C});r==null||r(k,l,pe,ye),L==null||L(k,pe,ye),K||q==null||q(k,ye)}}async function ie(){if(!v)return;const{transform:I,panBy:j,autoPanSpeed:C,autoPanOnNodeDrag:N}=e();if(!N){u=!1,cancelAnimationFrame(i);return}const[M,$]=Qg(d,v,C);(M!==0||$!==0)&&(s.x=(s.x??0)-M/I[2],s.y=(s.y??0)-$/I[2],await j({x:M,y:$})&&J(s)),i=requestAnimationFrame(ie)}function ke(I){var G;const{nodeLookup:j,multiSelectionActive:C,nodesDraggable:N,transform:M,snapGrid:$,snapToGrid:H,selectNodesOnDrag:L,onNodeDragStart:q,onSelectionDragStart:te,unselectNodesAndEdges:ae}=e();p=!0,(!L||!V)&&!C&&K&&((G=j.get(K))!=null&&G.selected||ae()),V&&L&&K&&(t==null||t(K));const W=au(I.sourceEvent,{transform:M,snapGrid:$,snapToGrid:H,containerBounds:v});if(s=W,l=bC(j,N,W,K),l.size>0&&(n||q||!K&&te)){const[ne,re]=su({nodeId:K,dragItems:l,nodeLookup:j});n==null||n(I.sourceEvent,l,ne,re),q==null||q(I.sourceEvent,ne,re),K||te==null||te(I.sourceEvent,re)}}const F=FE().clickDistance(O).on("start",I=>{const{domNode:j,nodeDragThreshold:C,transform:N,snapGrid:M,snapToGrid:$}=e();v=(j==null?void 0:j.getBoundingClientRect())||null,m=!1,x=!1,k=I.sourceEvent,C===0&&ke(I),s=au(I.sourceEvent,{transform:N,snapGrid:M,snapToGrid:$,containerBounds:v}),d=Rr(I.sourceEvent,v)}).on("drag",I=>{const{autoPanOnNodeDrag:j,transform:C,snapGrid:N,snapToGrid:M,nodeDragThreshold:$,nodeLookup:H}=e(),L=au(I.sourceEvent,{transform:C,snapGrid:N,snapToGrid:M,containerBounds:v});if(k=I.sourceEvent,(I.sourceEvent.type==="touchmove"&&I.sourceEvent.touches.length>1||K&&!H.has(K))&&(m=!0),!m){if(!u&&j&&p&&(u=!0,ie()),!p){const q=Rr(I.sourceEvent,v),te=q.x-d.x,ae=q.y-d.y;Math.sqrt(te*te+ae*ae)>$&&ke(I)}(s.x!==L.xSnapped||s.y!==L.ySnapped)&&l&&p&&(d=Rr(I.sourceEvent,v),J(L))}}).on("end",I=>{if(!(!p||m)&&(u=!1,p=!1,cancelAnimationFrame(i),l.size>0)){const{nodeLookup:j,updateNodePositions:C,onNodeDragStop:N,onSelectionDragStop:M}=e();if(x&&(C(l,!1),x=!1),a||N||!K&&M){const[$,H]=su({nodeId:K,dragItems:l,nodeLookup:j,dragging:!1});a==null||a(I.sourceEvent,l,$,H),N==null||N(I.sourceEvent,$,H),K||M==null||M(I.sourceEvent,H)}}}).filter(I=>{const j=I.target;return!I.button&&(!B||!Zv(j,`.${B}`,S))&&(!Y||Zv(j,Y,S))});h.call(F)}function D(){h==null||h.on(".drag",null)}return{update:E,destroy:D}}function kC(t,e,n){const r=[],a={x:t.x-n,y:t.y-n,width:n*2,height:n*2};for(const s of e.values())so(a,di(s))>0&&r.push(s);return r}const SC=250;function EC(t,e,n,r){var l,u;let a=[],s=1/0;const i=kC(t,n,e+SC);for(const d of i){const v=[...((l=d.internals.handleBounds)==null?void 0:l.source)??[],...((u=d.internals.handleBounds)==null?void 0:u.target)??[]];for(const p of v){if(r.nodeId===p.nodeId&&r.type===p.type&&r.id===p.id)continue;const{x:h,y:m}=Ss(d,p,p.position,!0),x=Math.sqrt(Math.pow(h-t.x,2)+Math.pow(m-t.y,2));x>e||(x<s?(a=[{...p,x:h,y:m}],s=x):x===s&&a.push({...p,x:h,y:m}))}}if(!a.length)return null;if(a.length>1){const d=r.type==="source"?"target":"source";return a.find(v=>v.type===d)??a[0]}return a[0]}function lm(t,e,n,r,a,s=!1){var d,v,p;const i=r.get(t);if(!i)return null;const l=a==="strict"?(d=i.internals.handleBounds)==null?void 0:d[e]:[...((v=i.internals.handleBounds)==null?void 0:v.source)??[],...((p=i.internals.handleBounds)==null?void 0:p.target)??[]],u=(n?l==null?void 0:l.find(h=>h.id===n):l==null?void 0:l[0])??null;return u&&s?{...u,...Ss(i,u,u.position,!0)}:u}function cm(t,e){return t||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function AC(t,e){let n=null;return e?n=!0:t&&!e&&(n=!1),n}const um=()=>!0;function TC(t,{connectionMode:e,connectionRadius:n,handleId:r,nodeId:a,edgeUpdaterType:s,isTarget:i,domNode:l,nodeLookup:u,lib:d,autoPanOnConnect:v,flowId:p,panBy:h,cancelConnection:m,onConnectStart:x,onConnect:k,onConnectEnd:E,isValidConnection:D=um,onReconnectEnd:B,updateConnection:Y,getTransform:S,getFromHandle:V,autoPanSpeed:K,dragThreshold:O=1,handleDomNode:J}){const ie=$g(t.target);let ke=0,F;const{x:I,y:j}=Rr(t),C=cm(s,J),N=l==null?void 0:l.getBoundingClientRect();let M=!1;if(!N||!C)return;const $=lm(a,C,r,u,e);if(!$)return;let H=Rr(t,N),L=!1,q=null,te=!1,ae=null;function W(){if(!v||!N)return;const[he,be]=Qg(H,N,K);h({x:he,y:be}),ke=requestAnimationFrame(W)}const G={...$,nodeId:a,type:C,position:$.position},ne=u.get(a);let pe={inProgress:!0,isValid:null,from:Ss(ne,G,wt.Left,!0),fromHandle:G,fromPosition:G.position,fromNode:ne,to:H,toHandle:null,toPosition:zv[G.position],toNode:null,pointer:H};function ye(){M=!0,Y(pe),x==null||x(t,{nodeId:a,handleId:r,handleType:C})}O===0&&ye();function Se(he){if(!M){const{x:qe,y:Oe}=Rr(he),ze=qe-I,Ne=Oe-j;if(!(ze*ze+Ne*Ne>O*O))return;ye()}if(!V()||!G){Z(he);return}const be=S();H=Rr(he,N),F=EC(Co(H,be,!1,[1,1]),n,u,G),L||(W(),L=!0);const Ie=dm(he,{handle:F,connectionMode:e,fromNodeId:a,fromHandleId:r,fromType:i?"target":"source",isValidConnection:D,doc:ie,lib:d,flowId:p,nodeLookup:u});ae=Ie.handleDomNode,q=Ie.connection,te=AC(!!F,Ie.isValid);const Ye=u.get(a),Je=Ye?Ss(Ye,G,wt.Left,!0):pe.from,ct={...pe,from:Je,isValid:te,to:Ie.toHandle&&te?zl({x:Ie.toHandle.x,y:Ie.toHandle.y},be):H,toHandle:Ie.toHandle,toPosition:te&&Ie.toHandle?Ie.toHandle.position:zv[G.position],toNode:Ie.toHandle?u.get(Ie.toHandle.nodeId):null,pointer:H};Y(ct),pe=ct}function Z(he){if(!("touches"in he&&he.touches.length>0)){if(M){(F||ae)&&q&&te&&(k==null||k(q));const{inProgress:be,...Ie}=pe,Ye={...Ie,toPosition:pe.toHandle?pe.toPosition:null};E==null||E(he,Ye),s&&(B==null||B(he,Ye))}m(),cancelAnimationFrame(ke),L=!1,te=!1,q=null,ae=null,ie.removeEventListener("mousemove",Se),ie.removeEventListener("mouseup",Z),ie.removeEventListener("touchmove",Se),ie.removeEventListener("touchend",Z)}}ie.addEventListener("mousemove",Se),ie.addEventListener("mouseup",Z),ie.addEventListener("touchmove",Se),ie.addEventListener("touchend",Z)}function dm(t,{handle:e,connectionMode:n,fromNodeId:r,fromHandleId:a,fromType:s,doc:i,lib:l,flowId:u,isValidConnection:d=um,nodeLookup:v}){const p=s==="target",h=e?i.querySelector(`.${l}-flow__handle[data-id="${u}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:m,y:x}=Rr(t),k=i.elementFromPoint(m,x),E=k!=null&&k.classList.contains(`${l}-flow__handle`)?k:h,D={handleDomNode:E,isValid:!1,connection:null,toHandle:null};if(E){const B=cm(void 0,E),Y=E.getAttribute("data-nodeid"),S=E.getAttribute("data-handleid"),V=E.classList.contains("connectable"),K=E.classList.contains("connectableend");if(!Y||!B)return D;const O={source:p?Y:r,sourceHandle:p?S:a,target:p?r:Y,targetHandle:p?a:S};D.connection=O;const ie=V&&K&&(n===ci.Strict?p&&B==="source"||!p&&B==="target":Y!==r||S!==a);D.isValid=ie&&d(O),D.toHandle=lm(Y,B,S,v,n,!0)}return D}const Qv={onPointerDown:TC,isValid:dm},fc=t=>({x:t.x,y:t.y,zoom:t.k}),iu=({x:t,y:e,zoom:n})=>lc.translate(t,e).scale(n),Ks=(t,e)=>t.target.closest(`.${e}`),fm=(t,e)=>e===2&&Array.isArray(t)&&t.includes(2),CC=t=>((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2,ou=(t,e=0,n=CC,r=()=>{})=>{const a=typeof e=="number"&&e>0;return a||r(),a?t.transition().duration(e).ease(n).on("end",r):t},vm=t=>{const e=t.ctrlKey&&ql()?10:1;return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*e};function IC({zoomPanValues:t,noWheelClassName:e,d3Selection:n,d3Zoom:r,panOnScrollMode:a,panOnScrollSpeed:s,zoomOnPinch:i,onPanZoomStart:l,onPanZoom:u,onPanZoomEnd:d}){return v=>{if(Ks(v,e))return v.ctrlKey&&v.preventDefault(),!1;v.preventDefault(),v.stopImmediatePropagation();const p=n.property("__zoom").k||1;if(v.ctrlKey&&i){const E=Gr(v),D=vm(v),B=p*Math.pow(2,D);r.scaleTo(n,B,E,v);return}const h=v.deltaMode===1?20:1;let m=a===Us.Vertical?0:v.deltaX*h,x=a===Us.Horizontal?0:v.deltaY*h;!ql()&&v.shiftKey&&a!==Us.Vertical&&(m=v.deltaY*h,x=0),r.translateBy(n,-(m/p)*s,-(x/p)*s,{internal:!0});const k=fc(n.property("__zoom"));clearTimeout(t.panScrollTimeout),t.isPanScrolling?(u==null||u(v,k),t.panScrollTimeout=setTimeout(()=>{d==null||d(v,k),t.isPanScrolling=!1},150)):(t.isPanScrolling=!0,l==null||l(v,k))}}function PC({noWheelClassName:t,preventScrolling:e,d3ZoomHandler:n}){return function(r,a){const s=r.type==="wheel",i=!e&&s&&!r.ctrlKey,l=Ks(r,t);if(r.ctrlKey&&s&&l&&r.preventDefault(),i||l)return null;r.preventDefault(),n.call(this,r,a)}}function MC({zoomPanValues:t,onDraggingChange:e,onPanZoomStart:n}){return r=>{var s,i,l;if((s=r.sourceEvent)!=null&&s.internal)return;const a=fc(r.transform);t.mouseButton=((i=r.sourceEvent)==null?void 0:i.button)||0,t.isZoomingOrPanning=!0,t.prevViewport=a,((l=r.sourceEvent)==null?void 0:l.type)==="mousedown"&&e(!0),n&&(n==null||n(r.sourceEvent,a))}}function OC({zoomPanValues:t,panOnDrag:e,onPaneContextMenu:n,onTransformChange:r,onPanZoom:a}){return s=>{var i,l;t.usedRightMouseButton=!!(n&&fm(e,t.mouseButton??0)),(i=s.sourceEvent)!=null&&i.sync||r([s.transform.x,s.transform.y,s.transform.k]),a&&!((l=s.sourceEvent)!=null&&l.internal)&&(a==null||a(s.sourceEvent,fc(s.transform)))}}function NC({zoomPanValues:t,panOnDrag:e,panOnScroll:n,onDraggingChange:r,onPanZoomEnd:a,onPaneContextMenu:s}){return i=>{var l;if(!((l=i.sourceEvent)!=null&&l.internal)&&(t.isZoomingOrPanning=!1,s&&fm(e,t.mouseButton??0)&&!t.usedRightMouseButton&&i.sourceEvent&&s(i.sourceEvent),t.usedRightMouseButton=!1,r(!1),a)){const u=fc(i.transform);t.prevViewport=u,clearTimeout(t.timerId),t.timerId=setTimeout(()=>{a==null||a(i.sourceEvent,u)},n?150:0)}}}function DC({zoomActivationKeyPressed:t,zoomOnScroll:e,zoomOnPinch:n,panOnDrag:r,panOnScroll:a,zoomOnDoubleClick:s,userSelectionActive:i,noWheelClassName:l,noPanClassName:u,lib:d,connectionInProgress:v}){return p=>{var E;const h=t||e,m=n&&p.ctrlKey,x=p.type==="wheel";if(p.button===1&&p.type==="mousedown"&&(Ks(p,`${d}-flow__node`)||Ks(p,`${d}-flow__edge`)))return!0;if(!r&&!h&&!a&&!s&&!n||i||v&&!x||Ks(p,l)&&x||Ks(p,u)&&(!x||a&&x&&!t)||!n&&p.ctrlKey&&x)return!1;if(!n&&p.type==="touchstart"&&((E=p.touches)==null?void 0:E.length)>1)return p.preventDefault(),!1;if(!h&&!a&&!m&&x||!r&&(p.type==="mousedown"||p.type==="touchstart")||Array.isArray(r)&&!r.includes(p.button)&&p.type==="mousedown")return!1;const k=Array.isArray(r)&&r.includes(p.button)||!p.button||p.button<=1;return(!p.ctrlKey||x)&&k}}function RC({domNode:t,minZoom:e,maxZoom:n,translateExtent:r,viewport:a,onPanZoom:s,onPanZoomStart:i,onPanZoomEnd:l,onDraggingChange:u}){const d={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},v=t.getBoundingClientRect(),p=DT().scaleExtent([e,n]).translateExtent(r),h=Mr(t).call(p);B({x:a.x,y:a.y,zoom:ui(a.zoom,e,n)},[[0,0],[v.width,v.height]],r);const m=h.on("wheel.zoom"),x=h.on("dblclick.zoom");p.wheelDelta(vm);function k(F,I){return h?new Promise(j=>{p==null||p.interpolate((I==null?void 0:I.interpolate)==="linear"?Xi:gl).transform(ou(h,I==null?void 0:I.duration,I==null?void 0:I.ease,()=>j(!0)),F)}):Promise.resolve(!1)}function E({noWheelClassName:F,noPanClassName:I,onPaneContextMenu:j,userSelectionActive:C,panOnScroll:N,panOnDrag:M,panOnScrollMode:$,panOnScrollSpeed:H,preventScrolling:L,zoomOnPinch:q,zoomOnScroll:te,zoomOnDoubleClick:ae,zoomActivationKeyPressed:W,lib:G,onTransformChange:ne,connectionInProgress:re,paneClickDistance:pe,selectionOnDrag:ye}){C&&!d.isZoomingOrPanning&&D();const Se=N&&!W&&!C;p.clickDistance(ye?1/0:!ya(pe)||pe<0?0:pe);const Z=Se?IC({zoomPanValues:d,noWheelClassName:F,d3Selection:h,d3Zoom:p,panOnScrollMode:$,panOnScrollSpeed:H,zoomOnPinch:q,onPanZoomStart:i,onPanZoom:s,onPanZoomEnd:l}):PC({noWheelClassName:F,preventScrolling:L,d3ZoomHandler:m});if(h.on("wheel.zoom",Z,{passive:!1}),!C){const be=MC({zoomPanValues:d,onDraggingChange:u,onPanZoomStart:i});p.on("start",be);const Ie=OC({zoomPanValues:d,panOnDrag:M,onPaneContextMenu:!!j,onPanZoom:s,onTransformChange:ne});p.on("zoom",Ie);const Ye=NC({zoomPanValues:d,panOnDrag:M,panOnScroll:N,onPaneContextMenu:j,onPanZoomEnd:l,onDraggingChange:u});p.on("end",Ye)}const he=DC({zoomActivationKeyPressed:W,panOnDrag:M,zoomOnScroll:te,panOnScroll:N,zoomOnDoubleClick:ae,zoomOnPinch:q,userSelectionActive:C,noPanClassName:I,noWheelClassName:F,lib:G,connectionInProgress:re});p.filter(he),ae?h.on("dblclick.zoom",x):h.on("dblclick.zoom",null)}function D(){p.on("zoom",null)}async function B(F,I,j){const C=iu(F),N=p==null?void 0:p.constrain()(C,I,j);return N&&await k(N),new Promise(M=>M(N))}async function Y(F,I){const j=iu(F);return await k(j,I),new Promise(C=>C(j))}function S(F){if(h){const I=iu(F),j=h.property("__zoom");(j.k!==F.zoom||j.x!==F.x||j.y!==F.y)&&(p==null||p.transform(h,I,null,{sync:!0}))}}function V(){const F=h?Vg(h.node()):{x:0,y:0,k:1};return{x:F.x,y:F.y,zoom:F.k}}function K(F,I){return h?new Promise(j=>{p==null||p.interpolate((I==null?void 0:I.interpolate)==="linear"?Xi:gl).scaleTo(ou(h,I==null?void 0:I.duration,I==null?void 0:I.ease,()=>j(!0)),F)}):Promise.resolve(!1)}function O(F,I){return h?new Promise(j=>{p==null||p.interpolate((I==null?void 0:I.interpolate)==="linear"?Xi:gl).scaleBy(ou(h,I==null?void 0:I.duration,I==null?void 0:I.ease,()=>j(!0)),F)}):Promise.resolve(!1)}function J(F){p==null||p.scaleExtent(F)}function ie(F){p==null||p.translateExtent(F)}function ke(F){const I=!ya(F)||F<0?0:F;p==null||p.clickDistance(I)}return{update:E,destroy:D,setViewport:Y,setViewportConstrained:B,getViewport:V,scaleTo:K,scaleBy:O,setScaleExtent:J,setTranslateExtent:ie,syncViewport:S,setClickDistance:ke}}var Jv;(function(t){t.Line="line",t.Handle="handle"})(Jv||(Jv={}));function $d(){const t={};return[e=>{if(e&&!xy(t))throw new Error(e);return ad(t)},e=>Sh(t,e)]}const[LC,jC]=$d(),[zC,qC]=$d(),[BC,FC]=$d();var KC=z("<div><!></div>");function Ga(t,e){at(e,!0);let n=Ae(e,"id",3,null),r=Ae(e,"type",3,"source"),a=Ae(e,"position",19,()=>wt.Top),s=Ae(e,"isConnectableStart",3,!0),i=Ae(e,"isConnectableEnd",3,!0),l=Is(e,["$$slots","$$events","$$legacy","id","type","position","style","class","isConnectable","isConnectableStart","isConnectableEnd","isValidConnection","onconnect","ondisconnect","children"]);const u=LC("Handle must be used within a Custom Node component"),d=zC("Handle must be used within a Custom Node component");let v=Q(()=>r()==="target"),p=Q(()=>e.isConnectable!==void 0?e.isConnectable:d.value),h=Os(),m=Q(()=>h.ariaLabelConfig),x=null;Wh(()=>{if(e.onconnect||e.ondisconnect){h.edges;let I=h.connectionLookup.get(`${u}-${r()}${n()?`-${n()}`:""}`);if(x&&!LT(I,x)){const j=I??new Map;qv(x,j,e.ondisconnect),qv(j,x,e.onconnect)}x=new Map(I)}});let k=Q(()=>{if(!h.connection.inProgress)return[!1,!1,!1,!1,null];const{fromHandle:I,toHandle:j,isValid:C}=h.connection,N=I&&I.nodeId===u&&I.type===r()&&I.id===n(),M=j&&j.nodeId===u&&j.type===r()&&j.id===n(),$=h.connectionMode===ci.Strict?(I==null?void 0:I.type)!==r():u!==(I==null?void 0:I.nodeId)||n()!==(I==null?void 0:I.id);return[!0,N,M,$,M&&C]}),E=Q(()=>ho(o(k),5)),D=Q(()=>o(E)[0]),B=Q(()=>o(E)[1]),Y=Q(()=>o(E)[2]),S=Q(()=>o(E)[3]),V=Q(()=>o(E)[4]);function K(I){var C;const j=h.onbeforeconnect?h.onbeforeconnect(I):I;j&&(h.addEdge(j),(C=h.onconnect)==null||C.call(h,I))}function O(I){const j=tm(I);I.currentTarget&&(j&&I.button===0||!j)&&Qv.onPointerDown(I,{handleId:n(),nodeId:u,isTarget:o(v),connectionRadius:h.connectionRadius,domNode:h.domNode,nodeLookup:h.nodeLookup,connectionMode:h.connectionMode,lib:"svelte",autoPanOnConnect:h.autoPanOnConnect,autoPanSpeed:h.autoPanSpeed,flowId:h.flowId,isValidConnection:e.isValidConnection||((...C)=>{var N;return((N=h.isValidConnection)==null?void 0:N.call(h,...C))??!0}),updateConnection:h.updateConnection,cancelConnection:h.cancelConnection,panBy:h.panBy,onConnect:K,onConnectStart:h.onconnectstart,onConnectEnd:(...C)=>{var N;return(N=h.onconnectend)==null?void 0:N.call(h,...C)},getTransform:()=>[h.viewport.x,h.viewport.y,h.viewport.zoom],getFromHandle:()=>h.connection.fromHandle,dragThreshold:h.connectionDragThreshold,handleDomNode:I.currentTarget})}function J(I){var ae,W;if(!u||!h.clickConnectStartHandle&&!s())return;if(!h.clickConnectStartHandle){(ae=h.onclickconnectstart)==null||ae.call(h,I,{nodeId:u,handleId:n(),handleType:r()}),h.clickConnectStartHandle={nodeId:u,type:r(),id:n()};return}const j=$g(I.target),C=e.isValidConnection??h.isValidConnection,{connectionMode:N,clickConnectStartHandle:M,flowId:$,nodeLookup:H}=h,{connection:L,isValid:q}=Qv.isValid(I,{handle:{nodeId:u,id:n(),type:r()},connectionMode:N,fromNodeId:M.nodeId,fromHandleId:M.id??null,fromType:M.type,isValidConnection:C,flowId:$,doc:j,lib:"svelte",nodeLookup:H});q&&L&&K(L);const te=structuredClone(kh(h.connection));delete te.inProgress,te.toPosition=te.toHandle?te.toHandle.position:null,(W=h.onclickconnectend)==null||W.call(h,I,te),h.clickConnectStartHandle=null}var ie=KC(),ke=()=>{};Va(ie,()=>({"data-handleid":n(),"data-nodeid":u,"data-handlepos":a(),"data-id":`${h.flowId??""}-${u??""}-${n()??"null"??""}-${r()??""}`,class:["svelte-flow__handle",`svelte-flow__handle-${a()}`,h.noDragClass,h.noPanClass,a(),e.class],onmousedown:O,ontouchstart:O,onclick:h.clickConnect?J:void 0,onkeypress:ke,style:e.style,role:"button","aria-label":o(m)["handle.ariaLabel"],tabindex:"-1",...l,[Ma]:{valid:o(V),connectingto:o(Y),connectingfrom:o(B),source:!o(v),target:o(v),connectablestart:s(),connectableend:i(),connectable:o(p),connectionindicator:o(p)&&(!o(D)||o(S))&&(o(D)||h.clickConnectStartHandle?i():s())}}));var F=_(ie);yr(F,()=>e.children??Es),T(t,ie),st()}var HC=z("<!> <!>",1);function hm(t,e){at(e,!0);let n=Ae(e,"targetPosition",19,()=>wt.Top),r=Ae(e,"sourcePosition",19,()=>wt.Bottom);var a=HC(),s=Xe(a);Ga(s,{type:"target",get position(){return n()}});var i=b(s),l=b(i);Ga(l,{type:"source",get position(){return r()}}),se(()=>{var u;return ee(i,` ${((u=e.data)==null?void 0:u.label)??""} `)}),T(t,a),st()}var GC=z(" <!>",1);function UC(t,e){at(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"sourcePosition",19,()=>wt.Bottom);var a=GC(),s=Xe(a),i=b(s);Ga(i,{type:"source",get position(){return r()}}),se(()=>{var l;return ee(s,`${((l=n())==null?void 0:l.label)??""} `)}),T(t,a),st()}var VC=z(" <!>",1);function WC(t,e){at(e,!0);let n=Ae(e,"data",19,()=>({label:"Node"})),r=Ae(e,"targetPosition",19,()=>wt.Top);var a=VC(),s=Xe(a),i=b(s);Ga(i,{type:"target",get position(){return r()}}),se(()=>{var l;return ee(s,`${((l=n())==null?void 0:l.label)??""} `)}),T(t,a),st()}function YC(t,e){}function lu(t,e,n){if(!n||!e)return;const r=n==="root"?e:e.querySelector(`.svelte-flow__${n}`);r&&r.appendChild(t)}function cu(t,e){const n=Q(Os),r=Q(()=>o(n).domNode);let a;return o(r)?lu(t,o(r),e):a=Yh(()=>{yn(()=>{lu(t,o(r),e),a==null||a()})}),{async update(s){lu(t,o(r),s)},destroy(){t.parentNode&&t.parentNode.removeChild(t),a==null||a()}}}function XC(){let t=Me(typeof window>"u");if(o(t)){const e=Yh(()=>{yn(()=>{P(t,!1),e==null||e()})})}return{get value(){return o(t)}}}const $v=t=>zT(t),ZC=t=>Yg(t);function aa(t){return t===void 0?void 0:`${t}px`}const Bl={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var QC=z("<div><!></div>");function JC(t,e){at(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"selectEdgeOnClick",3,!1),s=Ae(e,"transparent",3,!1),i=Is(e,["$$slots","$$events","$$legacy","x","y","width","height","selectEdgeOnClick","transparent","class","children"]);const l=Os(),u=BC("EdgeLabel must be used within a Custom Edge component");let d=Q(()=>{var m;return(m=l.visible.edges.get(u))==null?void 0:m.zIndex});var v=QC(),p=()=>{a()&&u&&l.handleEdgeSelection(u)};Va(v,m=>({class:["svelte-flow__edge-label",{transparent:s()},e.class],tabindex:"-1",onclick:p,...i,[ha]:m}),[()=>({display:XC().value?"none":void 0,cursor:a()?"pointer":void 0,transform:`translate(-50%, -50%) translate(${n()??""}px,${r()??""}px)`,"pointer-events":"all",width:aa(e.width),height:aa(e.height),"z-index":o(d)})],void 0,void 0,"svelte-1wg91mu");var h=_(v);yr(h,()=>e.children??Es),Xn(v,(m,x)=>cu==null?void 0:cu(m,x),()=>"edge-labels"),T(t,v),st()}var $C=mn("<path></path>"),eI=mn('<path fill="none"></path><!><!>',1);function vc(t,e){let n=Ae(e,"interactionWidth",3,20),r=Is(e,["$$slots","$$events","$$legacy","id","path","label","labelX","labelY","labelStyle","markerStart","markerEnd","style","interactionWidth","class"]);var a=eI(),s=Xe(a),i=b(s);{var l=v=>{var p=$C();Va(p,()=>({d:e.path,"stroke-opacity":0,"stroke-width":n(),fill:"none",class:"svelte-flow__edge-interaction",...r})),T(v,p)};ce(i,v=>{n()>0&&v(l)})}var u=b(i);{var d=v=>{JC(v,{get x(){return e.labelX},get y(){return e.labelY},get style(){return e.labelStyle},selectEdgeOnClick:!0,children:(p,h)=>{var m=on();se(()=>ee(m,e.label)),T(p,m)},$$slots:{default:!0}})};ce(u,v=>{e.label&&v(d)})}se(()=>{kt(s,"id",e.id),kt(s,"d",e.path),xt(s,0,Ts(["svelte-flow__edge-path",e.class])),kt(s,"marker-start",e.markerStart),kt(s,"marker-end",e.markerEnd),Dt(s,e.style)}),T(t,a)}function pm(t,e){at(e,!0);let n=Q(()=>{var l;return nm({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,curvature:(l=e.pathOptions)==null?void 0:l.curvature})}),r=Q(()=>ho(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);vc(t,{get id(){return e.id},get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function tI(t,e){at(e,!0);let n=Q(()=>Yd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition})),r=Q(()=>ho(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);vc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function nI(t,e){at(e,!0);let n=Q(()=>am({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY})),r=Q(()=>ho(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);vc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}function rI(t,e){at(e,!0);let n=Q(()=>Yd({sourceX:e.sourceX,sourceY:e.sourceY,targetX:e.targetX,targetY:e.targetY,sourcePosition:e.sourcePosition,targetPosition:e.targetPosition,borderRadius:0})),r=Q(()=>ho(o(n),3)),a=Q(()=>o(r)[0]),s=Q(()=>o(r)[1]),i=Q(()=>o(r)[2]);vc(t,{get path(){return o(a)},get labelX(){return o(s)},get labelY(){return o(i)},get label(){return e.label},get labelStyle(){return e.labelStyle},get markerStart(){return e.markerStart},get markerEnd(){return e.markerEnd},get interactionWidth(){return e.interactionWidth},get style(){return e.style}}),st()}var fo,vo;class aI{constructor(e,n){Pe(this,fo);Pe(this,vo);Et(this,fo,e),Et(this,vo,Dh(n))}get current(){return U(this,vo).call(this),U(this,fo).call(this)}}fo=new WeakMap,vo=new WeakMap;const sI=/\(.+\)/,iI=new Set(["all","print","screen","and","or","not","only"]);class oI extends aI{constructor(e,n){let r=sI.test(e)||e.split(/[\s,]+/).some(s=>iI.has(s.trim()))?e:`(${e})`;const a=window.matchMedia(r);super(()=>a.matches,s=>ku(a,"change",s))}}function lI(t,e,n,r){const a=new Map;return Vd(t,{x:0,y:0,width:n,height:r},e,!0).forEach(s=>{a.set(s.id,s)}),a}function eh(t){const{edges:e,defaultEdgeOptions:n,nodeLookup:r,previousEdges:a,connectionMode:s,onerror:i,onlyRenderVisible:l,elevateEdgesOnSelect:u,zIndexMode:d}=t,v=new Map;for(const p of e){const h=r.get(p.source),m=r.get(p.target);if(!h||!m)continue;if(l){const{visibleNodes:E,transform:D,width:B,height:Y}=t;if(eC({sourceNode:h,targetNode:m,width:B,height:Y,transform:D}))E.set(h.id,h),E.set(m.id,m);else continue}const x=a.get(p.id);if(x&&p===x.edge&&h==x.sourceNode&&m==x.targetNode){v.set(p.id,x);continue}const k=oC({id:p.id,sourceNode:h,targetNode:m,sourceHandle:p.sourceHandle||null,targetHandle:p.targetHandle||null,connectionMode:s,onError:i});k&&v.set(p.id,{...n,...p,...k,zIndex:$T({selected:p.selected,zIndex:p.zIndex??n.zIndex,sourceNode:h,targetNode:m,elevateOnSelect:u,zIndexMode:d}),sourceNode:h,targetNode:m,edge:p})}return v}const gm={input:UC,output:WC,default:hm,group:YC},mm={straight:nI,smoothstep:tI,default:pm,step:rI};function cI(t,e,n,r,a,s){if(e&&!n&&r&&a){const i=cc(s,{filter:l=>!!((l.width||l.initialWidth)&&(l.height||l.initialHeight))});return Wd(i,r,a,.5,2,.1)}else return n??{x:0,y:0,zoom:1}}function uI(t){var n,r,a,s,i,l,u,d,v,p,h,m,x,k,E,D,B,Y,S,V,K,O,J,ie,ke,F,I,j,C,N,M,$,H,L,q,te,ae,W,G,ne,re,pe,ye,Se,Z,he,be,Ie,Ye,Je,ct,qe,Oe,ze,Ne,Fe,Ke,$e,Ze,Ge,tt,nt,ft,mt,vt,St,bt,pt,yt,dt,Le,Rt,At,Gt,De,Qt;class e{constructor(){Pe(this,n,Q(()=>t.props.id??"1"));Pe(this,r,Me(null));Pe(this,a,Me(null));Pe(this,s,Me(t.width??0));Pe(this,i,Me(t.height??0));Pe(this,l,Me(t.props.zIndexMode??"basic"));Pe(this,u,Q(()=>{var ln;const _e=vC(t.nodes,this.nodeLookup,this.parentLookup,{nodeExtent:this.nodeExtent,nodeOrigin:this.nodeOrigin,elevateNodesOnSelect:t.props.elevateNodesOnSelect??!0,checkEquality:!0,zIndexMode:this.zIndexMode});return this.fitViewQueued&&_e&&((ln=this.fitViewOptions)!=null&&ln.duration?this.resolveFitView():queueMicrotask(()=>{this.resolveFitView()})),_e}));Pe(this,d,Q(()=>this.panZoom!==null));Pe(this,v,Q(()=>(_C(this.connectionLookup,this.edgeLookup,t.edges),t.edges)));ht(this,"_prevSelectedNodes",[]);ht(this,"_prevSelectedNodeIds",new Set);Pe(this,p,Q(()=>{const _e=this._prevSelectedNodeIds.size,ln=new Set,En=this.nodes.filter(Ct=>(Ct.selected&&(ln.add(Ct.id),this._prevSelectedNodeIds.delete(Ct.id)),Ct.selected));return(_e!==ln.size||this._prevSelectedNodeIds.size>0)&&(this._prevSelectedNodes=En),this._prevSelectedNodeIds=ln,this._prevSelectedNodes}));ht(this,"_prevSelectedEdges",[]);ht(this,"_prevSelectedEdgeIds",new Set);Pe(this,h,Q(()=>{const _e=this._prevSelectedEdgeIds.size,ln=new Set,En=this.edges.filter(Ct=>(Ct.selected&&(ln.add(Ct.id),this._prevSelectedEdgeIds.delete(Ct.id)),Ct.selected));return(_e!==ln.size||this._prevSelectedEdgeIds.size>0)&&(this._prevSelectedEdges=En),this._prevSelectedEdgeIds=ln,this._prevSelectedEdges}));ht(this,"selectionChangeHandlers",new Map);ht(this,"nodeLookup",new Map);ht(this,"parentLookup",new Map);ht(this,"connectionLookup",new Map);ht(this,"edgeLookup",new Map);ht(this,"_prevVisibleEdges",new Map);Pe(this,m,Q(()=>{const{nodes:_e,_edges:ln,_prevVisibleEdges:En,nodeLookup:Ct,connectionMode:Mn,onerror:it,onlyRenderVisibleElements:ut,defaultEdgeOptions:Pt,zIndexMode:$t}=this;let _t,jt;const fn={edges:ln,defaultEdgeOptions:Pt,previousEdges:En,nodeLookup:Ct,connectionMode:Mn,elevateEdgesOnSelect:t.props.elevateEdgesOnSelect??!0,zIndexMode:$t,onerror:it};if(ut){const{viewport:cn,width:Jt,height:en}=this,jn=[cn.x,cn.y,cn.zoom];_t=lI(Ct,jn,Jt,en),jt=eh({...fn,onlyRenderVisible:!0,visibleNodes:_t,transform:jn,width:Jt,height:en})}else _t=this.nodeLookup,jt=eh(fn);return{nodes:_t,edges:jt}}));Pe(this,x,Q(()=>t.props.nodesDraggable??!0));Pe(this,k,Q(()=>t.props.nodesConnectable??!0));Pe(this,E,Q(()=>t.props.elementsSelectable??!0));Pe(this,D,Q(()=>t.props.nodesFocusable??!0));Pe(this,B,Q(()=>t.props.edgesFocusable??!0));Pe(this,Y,Q(()=>t.props.disableKeyboardA11y??!1));Pe(this,S,Q(()=>t.props.minZoom??.5));Pe(this,V,Q(()=>t.props.maxZoom??2));Pe(this,K,Q(()=>t.props.nodeOrigin??[0,0]));Pe(this,O,Q(()=>t.props.nodeExtent??Xu));Pe(this,J,Q(()=>t.props.translateExtent??Xu));Pe(this,ie,Q(()=>t.props.defaultEdgeOptions??{}));Pe(this,ke,Q(()=>t.props.nodeDragThreshold??1));Pe(this,F,Q(()=>t.props.autoPanOnNodeDrag??!0));Pe(this,I,Q(()=>t.props.autoPanOnConnect??!0));Pe(this,j,Q(()=>t.props.autoPanOnNodeFocus??!0));Pe(this,C,Q(()=>t.props.autoPanSpeed??15));Pe(this,N,Q(()=>t.props.connectionDragThreshold??1));ht(this,"fitViewQueued",t.props.fitView??!1);ht(this,"fitViewOptions",t.props.fitViewOptions);ht(this,"fitViewResolver",null);Pe(this,M,Q(()=>t.props.snapGrid??null));Pe(this,$,Me(!1));Pe(this,H,Me(null));Pe(this,L,Me(!1));Pe(this,q,Me(!1));Pe(this,te,Me(!1));Pe(this,ae,Me(!1));Pe(this,W,Me(!1));Pe(this,G,Me(null));Pe(this,ne,Me(""));Pe(this,re,Q(()=>t.props.selectionMode??Rl.Partial));Pe(this,pe,Q(()=>({...gm,...t.props.nodeTypes})));Pe(this,ye,Q(()=>({...mm,...t.props.edgeTypes})));Pe(this,Se,Q(()=>t.props.noPanClass??"nopan"));Pe(this,Z,Q(()=>t.props.noDragClass??"nodrag"));Pe(this,he,Q(()=>t.props.noWheelClass??"nowheel"));Pe(this,be,Q(()=>ZT(t.props.ariaLabelConfig)));Pe(this,Ie,Me(cI(this.nodesInitialized,t.props.fitView,t.props.initialViewport,this.width,this.height,this.nodeLookup)));Pe(this,Ye,Me(Zu));Pe(this,Je,Q(()=>this._connection.inProgress?{...this._connection,to:Co(this._connection.to,[this.viewport.x,this.viewport.y,this.viewport.zoom])}:this._connection));Pe(this,ct,Q(()=>t.props.connectionMode??ci.Strict));Pe(this,qe,Q(()=>t.props.connectionRadius??20));Pe(this,Oe,Q(()=>t.props.isValidConnection??(()=>!0)));Pe(this,ze,Q(()=>t.props.selectNodesOnDrag??!0));Pe(this,Ne,Q(()=>t.props.defaultMarkerColor===void 0?"#b1b1b7":t.props.defaultMarkerColor));Pe(this,Fe,Q(()=>lC(t.edges,{defaultColor:this.defaultMarkerColor,id:this.flowId,defaultMarkerStart:this.defaultEdgeOptions.markerStart,defaultMarkerEnd:this.defaultEdgeOptions.markerEnd})));Pe(this,Ke,Q(()=>t.props.onlyRenderVisibleElements??!1));Pe(this,$e,Q(()=>t.props.onflowerror??UT));Pe(this,Ze,Q(()=>t.props.ondelete));Pe(this,Ge,Q(()=>t.props.onbeforedelete));Pe(this,tt,Q(()=>t.props.onbeforeconnect));Pe(this,nt,Q(()=>t.props.onconnect));Pe(this,ft,Q(()=>t.props.onconnectstart));Pe(this,mt,Q(()=>t.props.onconnectend));Pe(this,vt,Q(()=>t.props.onbeforereconnect));Pe(this,St,Q(()=>t.props.onreconnect));Pe(this,bt,Q(()=>t.props.onreconnectstart));Pe(this,pt,Q(()=>t.props.onreconnectend));Pe(this,yt,Q(()=>t.props.clickConnect??!0));Pe(this,dt,Q(()=>t.props.onclickconnectstart));Pe(this,Le,Q(()=>t.props.onclickconnectend));Pe(this,Rt,Me(null));Pe(this,At,Q(()=>t.props.onselectiondrag));Pe(this,Gt,Q(()=>t.props.onselectiondragstart));Pe(this,De,Q(()=>t.props.onselectiondragstop));ht(this,"resolveFitView",async()=>{var _e;this.panZoom&&(await KT({nodes:this.nodeLookup,width:this.width,height:this.height,panZoom:this.panZoom,minZoom:this.minZoom,maxZoom:this.maxZoom},this.fitViewOptions),(_e=this.fitViewResolver)==null||_e.resolve(!0),this.fitViewQueued=!1,this.fitViewOptions=void 0,this.fitViewResolver=null)});ht(this,"_prefersDark",new oI("(prefers-color-scheme: dark)",t.props.colorModeSSR==="dark"));Pe(this,Qt,Q(()=>t.props.colorMode==="system"?this._prefersDark.current?"dark":"light":t.props.colorMode??"light"))}get flowId(){return o(U(this,n))}set flowId(_e){P(U(this,n),_e)}get domNode(){return o(U(this,r))}set domNode(_e){P(U(this,r),_e)}get panZoom(){return o(U(this,a))}set panZoom(_e){P(U(this,a),_e)}get width(){return o(U(this,s))}set width(_e){P(U(this,s),_e)}get height(){return o(U(this,i))}set height(_e){P(U(this,i),_e)}get zIndexMode(){return o(U(this,l))}set zIndexMode(_e){P(U(this,l),_e)}get nodesInitialized(){return o(U(this,u))}set nodesInitialized(_e){P(U(this,u),_e)}get viewportInitialized(){return o(U(this,d))}set viewportInitialized(_e){P(U(this,d),_e)}get _edges(){return o(U(this,v))}set _edges(_e){P(U(this,v),_e)}get nodes(){return this.nodesInitialized,t.nodes}set nodes(_e){t.nodes=_e}get edges(){return this._edges}set edges(_e){t.edges=_e}get selectedNodes(){return o(U(this,p))}set selectedNodes(_e){P(U(this,p),_e)}get selectedEdges(){return o(U(this,h))}set selectedEdges(_e){P(U(this,h),_e)}get visible(){return o(U(this,m))}set visible(_e){P(U(this,m),_e)}get nodesDraggable(){return o(U(this,x))}set nodesDraggable(_e){P(U(this,x),_e)}get nodesConnectable(){return o(U(this,k))}set nodesConnectable(_e){P(U(this,k),_e)}get elementsSelectable(){return o(U(this,E))}set elementsSelectable(_e){P(U(this,E),_e)}get nodesFocusable(){return o(U(this,D))}set nodesFocusable(_e){P(U(this,D),_e)}get edgesFocusable(){return o(U(this,B))}set edgesFocusable(_e){P(U(this,B),_e)}get disableKeyboardA11y(){return o(U(this,Y))}set disableKeyboardA11y(_e){P(U(this,Y),_e)}get minZoom(){return o(U(this,S))}set minZoom(_e){P(U(this,S),_e)}get maxZoom(){return o(U(this,V))}set maxZoom(_e){P(U(this,V),_e)}get nodeOrigin(){return o(U(this,K))}set nodeOrigin(_e){P(U(this,K),_e)}get nodeExtent(){return o(U(this,O))}set nodeExtent(_e){P(U(this,O),_e)}get translateExtent(){return o(U(this,J))}set translateExtent(_e){P(U(this,J),_e)}get defaultEdgeOptions(){return o(U(this,ie))}set defaultEdgeOptions(_e){P(U(this,ie),_e)}get nodeDragThreshold(){return o(U(this,ke))}set nodeDragThreshold(_e){P(U(this,ke),_e)}get autoPanOnNodeDrag(){return o(U(this,F))}set autoPanOnNodeDrag(_e){P(U(this,F),_e)}get autoPanOnConnect(){return o(U(this,I))}set autoPanOnConnect(_e){P(U(this,I),_e)}get autoPanOnNodeFocus(){return o(U(this,j))}set autoPanOnNodeFocus(_e){P(U(this,j),_e)}get autoPanSpeed(){return o(U(this,C))}set autoPanSpeed(_e){P(U(this,C),_e)}get connectionDragThreshold(){return o(U(this,N))}set connectionDragThreshold(_e){P(U(this,N),_e)}get snapGrid(){return o(U(this,M))}set snapGrid(_e){P(U(this,M),_e)}get dragging(){return o(U(this,$))}set dragging(_e){P(U(this,$),_e)}get selectionRect(){return o(U(this,H))}set selectionRect(_e){P(U(this,H),_e)}get selectionKeyPressed(){return o(U(this,L))}set selectionKeyPressed(_e){P(U(this,L),_e)}get multiselectionKeyPressed(){return o(U(this,q))}set multiselectionKeyPressed(_e){P(U(this,q),_e)}get deleteKeyPressed(){return o(U(this,te))}set deleteKeyPressed(_e){P(U(this,te),_e)}get panActivationKeyPressed(){return o(U(this,ae))}set panActivationKeyPressed(_e){P(U(this,ae),_e)}get zoomActivationKeyPressed(){return o(U(this,W))}set zoomActivationKeyPressed(_e){P(U(this,W),_e)}get selectionRectMode(){return o(U(this,G))}set selectionRectMode(_e){P(U(this,G),_e)}get ariaLiveMessage(){return o(U(this,ne))}set ariaLiveMessage(_e){P(U(this,ne),_e)}get selectionMode(){return o(U(this,re))}set selectionMode(_e){P(U(this,re),_e)}get nodeTypes(){return o(U(this,pe))}set nodeTypes(_e){P(U(this,pe),_e)}get edgeTypes(){return o(U(this,ye))}set edgeTypes(_e){P(U(this,ye),_e)}get noPanClass(){return o(U(this,Se))}set noPanClass(_e){P(U(this,Se),_e)}get noDragClass(){return o(U(this,Z))}set noDragClass(_e){P(U(this,Z),_e)}get noWheelClass(){return o(U(this,he))}set noWheelClass(_e){P(U(this,he),_e)}get ariaLabelConfig(){return o(U(this,be))}set ariaLabelConfig(_e){P(U(this,be),_e)}get _viewport(){return o(U(this,Ie))}set _viewport(_e){P(U(this,Ie),_e)}get viewport(){return t.viewport??this._viewport}set viewport(_e){t.viewport&&(t.viewport=_e),this._viewport=_e}get _connection(){return o(U(this,Ye))}set _connection(_e){P(U(this,Ye),_e)}get connection(){return o(U(this,Je))}set connection(_e){P(U(this,Je),_e)}get connectionMode(){return o(U(this,ct))}set connectionMode(_e){P(U(this,ct),_e)}get connectionRadius(){return o(U(this,qe))}set connectionRadius(_e){P(U(this,qe),_e)}get isValidConnection(){return o(U(this,Oe))}set isValidConnection(_e){P(U(this,Oe),_e)}get selectNodesOnDrag(){return o(U(this,ze))}set selectNodesOnDrag(_e){P(U(this,ze),_e)}get defaultMarkerColor(){return o(U(this,Ne))}set defaultMarkerColor(_e){P(U(this,Ne),_e)}get markers(){return o(U(this,Fe))}set markers(_e){P(U(this,Fe),_e)}get onlyRenderVisibleElements(){return o(U(this,Ke))}set onlyRenderVisibleElements(_e){P(U(this,Ke),_e)}get onerror(){return o(U(this,$e))}set onerror(_e){P(U(this,$e),_e)}get ondelete(){return o(U(this,Ze))}set ondelete(_e){P(U(this,Ze),_e)}get onbeforedelete(){return o(U(this,Ge))}set onbeforedelete(_e){P(U(this,Ge),_e)}get onbeforeconnect(){return o(U(this,tt))}set onbeforeconnect(_e){P(U(this,tt),_e)}get onconnect(){return o(U(this,nt))}set onconnect(_e){P(U(this,nt),_e)}get onconnectstart(){return o(U(this,ft))}set onconnectstart(_e){P(U(this,ft),_e)}get onconnectend(){return o(U(this,mt))}set onconnectend(_e){P(U(this,mt),_e)}get onbeforereconnect(){return o(U(this,vt))}set onbeforereconnect(_e){P(U(this,vt),_e)}get onreconnect(){return o(U(this,St))}set onreconnect(_e){P(U(this,St),_e)}get onreconnectstart(){return o(U(this,bt))}set onreconnectstart(_e){P(U(this,bt),_e)}get onreconnectend(){return o(U(this,pt))}set onreconnectend(_e){P(U(this,pt),_e)}get clickConnect(){return o(U(this,yt))}set clickConnect(_e){P(U(this,yt),_e)}get onclickconnectstart(){return o(U(this,dt))}set onclickconnectstart(_e){P(U(this,dt),_e)}get onclickconnectend(){return o(U(this,Le))}set onclickconnectend(_e){P(U(this,Le),_e)}get clickConnectStartHandle(){return o(U(this,Rt))}set clickConnectStartHandle(_e){P(U(this,Rt),_e)}get onselectiondrag(){return o(U(this,At))}set onselectiondrag(_e){P(U(this,At),_e)}get onselectiondragstart(){return o(U(this,Gt))}set onselectiondragstart(_e){P(U(this,Gt),_e)}get onselectiondragstop(){return o(U(this,De))}set onselectiondragstop(_e){P(U(this,De),_e)}get colorMode(){return o(U(this,Qt))}set colorMode(_e){P(U(this,Qt),_e)}resetStoreValues(){this.dragging=!1,this.selectionRect=null,this.selectionRectMode=null,this.selectionKeyPressed=!1,this.multiselectionKeyPressed=!1,this.deleteKeyPressed=!1,this.panActivationKeyPressed=!1,this.zoomActivationKeyPressed=!1,this._connection=Zu,this.clickConnectStartHandle=null,this.viewport=t.props.initialViewport??{x:0,y:0,zoom:1},this.ariaLiveMessage=""}}return n=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,i=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,v=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,x=new WeakMap,k=new WeakMap,E=new WeakMap,D=new WeakMap,B=new WeakMap,Y=new WeakMap,S=new WeakMap,V=new WeakMap,K=new WeakMap,O=new WeakMap,J=new WeakMap,ie=new WeakMap,ke=new WeakMap,F=new WeakMap,I=new WeakMap,j=new WeakMap,C=new WeakMap,N=new WeakMap,M=new WeakMap,$=new WeakMap,H=new WeakMap,L=new WeakMap,q=new WeakMap,te=new WeakMap,ae=new WeakMap,W=new WeakMap,G=new WeakMap,ne=new WeakMap,re=new WeakMap,pe=new WeakMap,ye=new WeakMap,Se=new WeakMap,Z=new WeakMap,he=new WeakMap,be=new WeakMap,Ie=new WeakMap,Ye=new WeakMap,Je=new WeakMap,ct=new WeakMap,qe=new WeakMap,Oe=new WeakMap,ze=new WeakMap,Ne=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,$e=new WeakMap,Ze=new WeakMap,Ge=new WeakMap,tt=new WeakMap,nt=new WeakMap,ft=new WeakMap,mt=new WeakMap,vt=new WeakMap,St=new WeakMap,bt=new WeakMap,pt=new WeakMap,yt=new WeakMap,dt=new WeakMap,Le=new WeakMap,Rt=new WeakMap,At=new WeakMap,Gt=new WeakMap,De=new WeakMap,Qt=new WeakMap,new e}function Os(){const t=ad($u);if(!t)throw new Error("To call useStore outside of <SvelteFlow /> you need to wrap your component in a <SvelteFlowProvider />");return t.getStore()}const $u=Symbol();function dI(t){const e=uI(t);function n(F){e.nodeTypes={...gm,...F}}function r(F){e.edgeTypes={...mm,...F}}function a(F){e.edges=rC(F,e.edges)}const s=(F,I=!1)=>{e.nodes=e.nodes.map(j=>{if(e.connection.inProgress&&e.connection.fromNode.id===j.id){const N=e.nodeLookup.get(j.id);N&&(e.connection={...e.connection,from:Ss(N,e.connection.fromHandle,wt.Left,!0)})}const C=F.get(j.id);return C?{...j,position:C.position,dragging:I}:j})};function i(F){var N,M,$;const{changes:I,updatedInternals:j}=mC(F,e.nodeLookup,e.parentLookup,e.domNode,e.nodeOrigin,e.nodeExtent,e.zIndexMode);if(!j)return;dC(e.nodeLookup,e.parentLookup,{nodeOrigin:e.nodeOrigin,nodeExtent:e.nodeExtent,zIndexMode:e.zIndexMode}),e.fitViewQueued&&e.resolveFitView();const C=new Map;for(const H of I){const L=(N=e.nodeLookup.get(H.id))==null?void 0:N.internals.userNode;if(!L)continue;const q={...L};switch(H.type){case"dimensions":{const te={...q.measured,...H.dimensions};H.setAttributes&&(q.width=((M=H.dimensions)==null?void 0:M.width)??q.width,q.height=(($=H.dimensions)==null?void 0:$.height)??q.height),q.measured=te;break}case"position":q.position=H.position??q.position;break}C.set(H.id,q)}e.nodes=e.nodes.map(H=>C.get(H.id)??H)}function l(F){const I=e.fitViewResolver??Promise.withResolvers();return e.fitViewQueued=!0,e.fitViewOptions=F,e.fitViewResolver=I,e.nodes=[...e.nodes],I.promise}async function u(F,I,j){const C=typeof(j==null?void 0:j.zoom)<"u"?j.zoom:e.maxZoom,N=e.panZoom;return N?(await N.setViewport({x:e.width/2-F*C,y:e.height/2-I*C,zoom:C},{duration:j==null?void 0:j.duration,ease:j==null?void 0:j.ease,interpolate:j==null?void 0:j.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)}function d(F,I){const j=e.panZoom;return j?j.scaleBy(F,I):Promise.resolve(!1)}function v(F){return d(1.2,F)}function p(F){return d(1/1.2,F)}function h(F){const I=e.panZoom;I&&(I.setScaleExtent([F,e.maxZoom]),e.minZoom=F)}function m(F){const I=e.panZoom;I&&(I.setScaleExtent([e.minZoom,F]),e.maxZoom=F)}function x(F){const I=e.panZoom;I&&(I.setTranslateExtent(F),e.translateExtent=F)}function k(F,I=null){let j=!1;const C=F.map(N=>(I?I.has(N.id):!0)&&N.selected?(j=!0,{...N,selected:!1}):N);return[j,C]}function E(F){const I=F!=null&&F.nodes?new Set(F.nodes.map(H=>H.id)):null,[j,C]=k(e.nodes,I);j&&(e.nodes=C);const N=F!=null&&F.edges?new Set(F.edges.map(H=>H.id)):null,[M,$]=k(e.edges,N);M&&(e.edges=$)}function D(F){const I=e.multiselectionKeyPressed;e.nodes=e.nodes.map(j=>{const C=F.includes(j.id),N=I&&j.selected||C;return!!j.selected!==N?{...j,selected:N}:j}),I||E({nodes:[]})}function B(F){const I=e.multiselectionKeyPressed;e.edges=e.edges.map(j=>{const C=F.includes(j.id),N=I&&j.selected||C;return!!j.selected!==N?{...j,selected:N}:j}),I||E({edges:[]})}function Y(F,I,j){const C=e.nodeLookup.get(F);if(!C){console.warn("012",ao.error012(F));return}e.selectionRect=null,e.selectionRectMode=null,C.selected?(I||C.selected&&e.multiselectionKeyPressed)&&(E({nodes:[C],edges:[]}),requestAnimationFrame(()=>j==null?void 0:j.blur())):D([F])}function S(F){const I=e.edgeLookup.get(F);if(!I){console.warn("012",ao.error012(F));return}(I.selectable||e.elementsSelectable&&typeof I.selectable>"u")&&(e.selectionRect=null,e.selectionRectMode=null,I.selected?I.selected&&e.multiselectionKeyPressed&&E({nodes:[],edges:[I]}):B([F]))}function V(F,I){const{nodeExtent:j,snapGrid:C,nodeOrigin:N,nodeLookup:M,nodesDraggable:$,onerror:H}=e,L=new Map,q=(C==null?void 0:C[0])??5,te=(C==null?void 0:C[1])??5,ae=F.x*q*I,W=F.y*te*I;for(const G of M.values()){if(!(G.selected&&(G.draggable||$&&typeof G.draggable>"u")))continue;let re={x:G.internals.positionAbsolute.x+ae,y:G.internals.positionAbsolute.y+W};C&&(re=To(re,C));const{position:pe,positionAbsolute:ye}=Xg({nodeId:G.id,nextPosition:re,nodeLookup:M,nodeExtent:j,nodeOrigin:N,onError:H});G.position=pe,G.internals.positionAbsolute=ye,L.set(G.id,G)}s(L)}function K(F){return yC({delta:F,panZoom:e.panZoom,transform:[e.viewport.x,e.viewport.y,e.viewport.zoom],translateExtent:e.translateExtent,width:e.width,height:e.height})}const O=F=>{e._connection={...F}};function J(){e._connection=Zu}function ie(){e.resetStoreValues(),E()}return Object.assign(e,{setNodeTypes:n,setEdgeTypes:r,addEdge:a,updateNodePositions:s,updateNodeInternals:i,zoomIn:v,zoomOut:p,fitView:l,setCenter:u,setMinZoom:h,setMaxZoom:m,setTranslateExtent:x,unselectNodesAndEdges:E,addSelectedNodes:D,addSelectedEdges:B,handleNodeSelection:Y,handleEdgeSelection:S,moveSelectedNodes:V,panBy:K,updateConnection:O,cancelConnection:J,reset:ie})}function uu(t,e){const{minZoom:n,maxZoom:r,initialViewport:a,onPanZoomStart:s,onPanZoom:i,onPanZoomEnd:l,translateExtent:u,setPanZoomInstance:d,onDraggingChange:v,onTransformChange:p}=e,h=RC({domNode:t,minZoom:n,maxZoom:r,translateExtent:u,viewport:a,onPanZoom:i,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:v}),m=h.getViewport();return(a.x!==m.x||a.y!==m.y||a.zoom!==m.zoom)&&p([m.x,m.y,m.zoom]),d(h),h.update(e),{update(x){h.update(x)}}}var fI=z('<div class="svelte-flow__zoom svelte-flow__container"><!></div>');function vI(t,e){at(e,!0);let n=Ae(e,"store",15),r=Q(()=>n().panActivationKeyPressed||e.panOnDrag),a=Q(()=>n().panActivationKeyPressed||e.panOnScroll);const{viewport:s}=n();let i=!1;yn(()=>{var d;!i&&n().viewportInitialized&&((d=e.oninit)==null||d.call(e),i=!0)});var l=fI(),u=_(l);yr(u,()=>e.children),Xn(l,(d,v)=>uu==null?void 0:uu(d,v),()=>({viewport:n().viewport,minZoom:n().minZoom,maxZoom:n().maxZoom,initialViewport:s,onDraggingChange:d=>{n(n().dragging=d,!0)},setPanZoomInstance:d=>{n(n().panZoom=d,!0)},onPanZoomStart:e.onmovestart,onPanZoom:e.onmove,onPanZoomEnd:e.onmoveend,zoomOnScroll:e.zoomOnScroll,zoomOnDoubleClick:e.zoomOnDoubleClick,zoomOnPinch:e.zoomOnPinch,panOnScroll:o(a),panOnDrag:o(r),panOnScrollSpeed:e.panOnScrollSpeed,panOnScrollMode:e.panOnScrollMode,zoomActivationKeyPressed:n().zoomActivationKeyPressed,preventScrolling:typeof e.preventScrolling=="boolean"?e.preventScrolling:!0,noPanClassName:n().noPanClass,noWheelClassName:n().noWheelClass,userSelectionActive:!!n().selectionRect,translateExtent:n().translateExtent,lib:"svelte",paneClickDistance:e.paneClickDistance,selectionOnDrag:e.selectionOnDrag,onTransformChange:d=>{n(n().viewport={x:d[0],y:d[1],zoom:d[2]},!0)},connectionInProgress:n().connection.inProgress})),T(t,l),st()}function th(t,e){return n=>{n.target===e&&(t==null||t(n))}}function nh(t){return e=>{const n=t.has(e.id);return!!e.selected!==n?{...e,selected:n}:e}}function rh(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}var hI=z("<div><!></div>");function pI(t,e){at(e,!0);let n=Ae(e,"store",15),r=Ae(e,"panOnDrag",3,!0),a=Ae(e,"paneClickDistance",3,1),s,i=null,l=new Set,u=new Set,d=Q(()=>n().panActivationKeyPressed||r()),v=Q(()=>n().selectionKeyPressed||!!n().selectionRect||e.selectionOnDrag&&o(d)!==!0),p=Q(()=>n().elementsSelectable&&(o(v)||n().selectionRectMode==="user")),h=!1;function m(J){var C,N;if(i=s==null?void 0:s.getBoundingClientRect(),!i)return;const ie=J.target===s,ke=!ie&&!!J.target.closest(".nokey"),F=e.selectionOnDrag&&ie||n().selectionKeyPressed;if(ke||!o(v)||!F||J.button!==0||!J.isPrimary)return;(N=(C=J.target)==null?void 0:C.setPointerCapture)==null||N.call(C,J.pointerId),h=!1;const{x:I,y:j}=Rr(J,i);n(n().selectionRect={width:0,height:0,startX:I,startY:j,x:I,y:j},!0),ie||(J.stopPropagation(),J.preventDefault())}function x(J){var M;if(!o(v)||!i||!n().selectionRect)return;const ie=Rr(J,i),{startX:ke=0,startY:F=0}=n().selectionRect;if(!h){const $=n().selectionKeyPressed?0:a();if(Math.hypot(ie.x-ke,ie.y-F)<=$)return;n().unselectNodesAndEdges(),(M=e.onselectionstart)==null||M.call(e,J)}h=!0;const I={...n().selectionRect,x:ie.x<ke?ie.x:ke,y:ie.y<F?ie.y:F,width:Math.abs(ie.x-ke),height:Math.abs(ie.y-F)},j=l,C=u;l=new Set(Vd(n().nodeLookup,I,[n().viewport.x,n().viewport.y,n().viewport.zoom],n().selectionMode===Rl.Partial,!0).map($=>$.id));const N=n().defaultEdgeOptions.selectable??!0;u=new Set;for(const $ of l){const H=n().connectionLookup.get($);if(H)for(const{edgeId:L}of H.values()){const q=n().edgeLookup.get(L);q&&(q.selectable??N)&&u.add(L)}}rh(j,l)||n(n().nodes=n().nodes.map(nh(l)),!0),rh(C,u)||n(n().edges=n().edges.map(nh(u)),!0),n(n().selectionRectMode="user",!0),n(n().selectionRect=I,!0)}function k(J){var ie,ke,F;J.button===0&&((ke=(ie=J.target)==null?void 0:ie.releasePointerCapture)==null||ke.call(ie,J.pointerId),!h&&J.target===s&&(B==null||B(J)),n(n().selectionRect=null,!0),h&&n(n().selectionRectMode=l.size>0?"nodes":null,!0),h&&((F=e.onselectionend)==null||F.call(e,J)))}const E=J=>{var ie;if(Array.isArray(o(d))&&o(d).includes(2)){J.preventDefault();return}(ie=e.onpanecontextmenu)==null||ie.call(e,{event:J})},D=J=>{h&&(J.stopPropagation(),h=!1)};function B(J){var ie;if(h||n().connection.inProgress){h=!1;return}(ie=e.onpaneclick)==null||ie.call(e,{event:J}),n().unselectNodesAndEdges(),n(n().selectionRectMode=null,!0),n(n().selectionRect=null,!0)}var Y=hI();let S;var V=Q(()=>o(p)?void 0:th(B,s));Y.__click=function(...J){var ie;(ie=o(V))==null||ie.apply(this,J)},Y.__pointermove=function(...J){var ie;(ie=o(p)?x:void 0)==null||ie.apply(this,J)},Y.__pointerup=function(...J){var ie;(ie=o(p)?k:void 0)==null||ie.apply(this,J)};var K=Q(()=>th(E,s));Y.__contextmenu=function(...J){var ie;(ie=o(K))==null||ie.apply(this,J)};var O=_(Y);yr(O,()=>e.children),Cs(Y,J=>s=J,()=>s),se(J=>S=xt(Y,1,"svelte-flow__pane svelte-flow__container",null,S,J),[()=>({draggable:r()===!0||Array.isArray(r())&&r().includes(0),dragging:n().dragging,selection:o(v)})]),wl("pointerdown",Y,function(...J){var ie;(ie=o(p)?m:void 0)==null||ie.apply(this,J)},!0),wl("click",Y,function(...J){var ie;(ie=o(p)?D:void 0)==null||ie.apply(this,J)},!0),T(t,Y),st()}Xt(["click","pointermove","pointerup","contextmenu"]);var gI=z('<div class="svelte-flow__viewport xyflow__viewport svelte-flow__container"><!></div>');function mI(t,e){at(e,!0);var n=gI();let r;var a=_(n);yr(a,()=>e.children),se(()=>r=Dt(n,"",r,{transform:`translate(${e.store.viewport.x??""}px, ${e.store.viewport.y??""}px) scale(${e.store.viewport.zoom??""})`})),T(t,n),st()}function Vs(t,e){const{store:n,onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i}=e,l=xC({onDrag:r,onDragStart:a,onDragStop:s,onNodeMouseDown:i,getStoreItems:()=>{const{snapGrid:d,viewport:v}=n;return{nodes:n.nodes,nodeLookup:n.nodeLookup,edges:n.edges,nodeExtent:n.nodeExtent,snapGrid:d||[0,0],snapToGrid:!!d,nodeOrigin:n.nodeOrigin,multiSelectionActive:n.multiselectionKeyPressed,domNode:n.domNode,transform:[v.x,v.y,v.zoom],autoPanOnNodeDrag:n.autoPanOnNodeDrag,nodesDraggable:n.nodesDraggable,selectNodesOnDrag:n.selectNodesOnDrag,nodeDragThreshold:n.nodeDragThreshold,unselectNodesAndEdges:n.unselectNodesAndEdges,updateNodePositions:n.updateNodePositions,onSelectionDrag:n.onselectiondrag,onSelectionDragStart:n.onselectiondragstart,onSelectionDragStop:n.onselectiondragstop,panBy:n.panBy}}});function u(d,v){if(v.disabled){l.destroy();return}l.update({domNode:d,noDragClassName:v.noDragClass,handleSelector:v.handleSelector,nodeId:v.nodeId,isSelectable:v.isSelectable,nodeClickDistance:v.nodeClickDistance})}return u(t,e),{update(d){u(t,d)},destroy(){l.destroy()}}}var yI=z('<div aria-live="assertive" aria-atomic="true" class="a11y-live-msg svelte-13pq11u"> </div>'),_I=z('<div class="a11y-hidden svelte-13pq11u"> </div> <div class="a11y-hidden svelte-13pq11u"> </div> <!>',1);function bI(t,e){at(e,!0);var n=_I(),r=Xe(n),a=_(r),s=b(r,2),i=_(s),l=b(s,2);{var u=d=>{var v=yI(),p=_(v);se(()=>{kt(v,"id",`${wI}-${e.store.flowId}`),ee(p,e.store.ariaLiveMessage)}),T(d,v)};ce(l,d=>{e.store.disableKeyboardA11y||d(u)})}se(()=>{kt(r,"id",`${ym}-${e.store.flowId}`),ee(a,e.store.disableKeyboardA11y?e.store.ariaLabelConfig["node.a11yDescription.default"]:e.store.ariaLabelConfig["node.a11yDescription.keyboardDisabled"]),kt(s,"id",`${_m}-${e.store.flowId}`),ee(i,e.store.ariaLabelConfig["edge.a11yDescription.default"])}),T(t,n),st()}const ym="svelte-flow__node-desc",_m="svelte-flow__edge-desc",wI="svelte-flow__aria-live";var xI=z("<div><!></div>");function kI(t,e){at(e,!0);let n=Ae(e,"store",15),r=Q(()=>Bn(e.node.data,()=>({}),!0)),a=Q(()=>Bn(e.node.selected,!1)),s=Q(()=>e.node.draggable),i=Q(()=>e.node.selectable),l=Q(()=>Bn(e.node.deletable,!0)),u=Q(()=>e.node.connectable),d=Q(()=>e.node.focusable),v=Q(()=>Bn(e.node.hidden,!1)),p=Q(()=>Bn(e.node.dragging,!1)),h=Q(()=>Bn(e.node.style,"")),m=Q(()=>e.node.class),x=Q(()=>Bn(e.node.type,"default")),k=Q(()=>e.node.parentId),E=Q(()=>e.node.sourcePosition),D=Q(()=>e.node.targetPosition),B=Q(()=>Bn(e.node.measured,()=>({width:0,height:0}),!0).width),Y=Q(()=>Bn(e.node.measured,()=>({width:0,height:0}),!0).height),S=Q(()=>e.node.initialWidth),V=Q(()=>e.node.initialHeight),K=Q(()=>e.node.width),O=Q(()=>e.node.height),J=Q(()=>e.node.dragHandle),ie=Q(()=>Bn(e.node.internals.z,0)),ke=Q(()=>e.node.internals.positionAbsolute.x),F=Q(()=>e.node.internals.positionAbsolute.y),I=Q(()=>e.node.internals.userNode),{id:j}=e.node,C=Q(()=>o(s)??n().nodesDraggable),N=Q(()=>o(i)??n().elementsSelectable),M=Q(()=>o(u)??n().nodesConnectable),$=Q(()=>YT(e.node)),H=Q(()=>!!e.node.internals.handleBounds),L=Q(()=>o($)&&o(H)),q=Q(()=>o(d)??n().nodesFocusable);function te(Oe){return n().parentLookup.has(Oe)}let ae=Q(()=>te(j)),W=Me(null),G=null,ne=o(x),re=o(E),pe=o(D),ye=Q(()=>n().nodeTypes[o(x)]??hm),Se=Q(()=>n().ariaLabelConfig),Z={get value(){return o(M)}};jC(j),qC(Z);let he=Q(()=>{const Oe=o(B)===void 0?o(K)??o(S):o(K),ze=o(Y)===void 0?o(O)??o(V):o(O);if(!(Oe===void 0&&ze===void 0&&o(h)===void 0))return`${o(h)};${Oe?`width:${aa(Oe)};`:""}${ze?`height:${aa(ze)};`:""}`});yn(()=>{(o(x)!==ne||o(E)!==re||o(D)!==pe)&&o(W)!==null&&requestAnimationFrame(()=>{o(W)!==null&&n().updateNodeInternals(new Map([[j,{id:j,nodeElement:o(W),force:!0}]]))}),ne=o(x),re=o(E),pe=o(D)}),yn(()=>{e.resizeObserver&&(!o(L)||o(W)!==G)&&(G&&e.resizeObserver.unobserve(G),o(W)&&e.resizeObserver.observe(o(W)),G=o(W))}),md(()=>{var Oe;G&&((Oe=e.resizeObserver)==null||Oe.unobserve(G))});function be(Oe){var ze;o(N)&&(!n().selectNodesOnDrag||!o(C)||n().nodeDragThreshold>0)&&n().handleNodeSelection(j),(ze=e.onnodeclick)==null||ze.call(e,{node:o(I),event:Oe})}function Ie(Oe){if(!(em(Oe)||n().disableKeyboardA11y))if(Wg.includes(Oe.key)&&o(N)){const ze=Oe.key==="Escape";n().handleNodeSelection(j,ze,o(W))}else o(C)&&e.node.selected&&Object.prototype.hasOwnProperty.call(Bl,Oe.key)&&(Oe.preventDefault(),n(n().ariaLiveMessage=o(Se)["node.a11yDescription.ariaLiveMessage"]({direction:Oe.key.replace("Arrow","").toLowerCase(),x:~~e.node.internals.positionAbsolute.x,y:~~e.node.internals.positionAbsolute.y}),!0),n().moveSelectedNodes(Bl[Oe.key],Oe.shiftKey?4:1))}const Ye=()=>{var Ke;if(n().disableKeyboardA11y||!n().autoPanOnNodeFocus||!((Ke=o(W))!=null&&Ke.matches(":focus-visible")))return;const{width:Oe,height:ze,viewport:Ne}=n();Vd(new Map([[j,e.node]]),{x:0,y:0,width:Oe,height:ze},[Ne.x,Ne.y,Ne.zoom],!0).length>0||n().setCenter(e.node.position.x+(e.node.measured.width??0)/2,e.node.position.y+(e.node.measured.height??0)/2,{zoom:Ne.zoom})};var Je=an(),ct=Xe(Je);{var qe=Oe=>{var ze=xI();Va(ze,()=>({"data-id":j,class:["svelte-flow__node",`svelte-flow__node-${o(x)}`,o(m)],style:o(he),onclick:be,onpointerenter:e.onnodepointerenter?Fe=>e.onnodepointerenter({node:o(I),event:Fe}):void 0,onpointerleave:e.onnodepointerleave?Fe=>e.onnodepointerleave({node:o(I),event:Fe}):void 0,onpointermove:e.onnodepointermove?Fe=>e.onnodepointermove({node:o(I),event:Fe}):void 0,oncontextmenu:e.onnodecontextmenu?Fe=>e.onnodecontextmenu({node:o(I),event:Fe}):void 0,onkeydown:o(q)?Ie:void 0,onfocus:o(q)?Ye:void 0,tabIndex:o(q)?0:void 0,role:e.node.ariaRole??(o(q)?"group":void 0),"aria-roledescription":"node","aria-describedby":n().disableKeyboardA11y?void 0:`${ym}-${n().flowId}`,...e.node.domAttributes,[Ma]:{dragging:o(p),selected:o(a),draggable:o(C),connectable:o(M),selectable:o(N),nopan:o(C),parent:o(ae)},[ha]:{"z-index":o(ie),transform:`translate(${o(ke)??""}px, ${o(F)??""}px)`,visibility:o($)?"visible":"hidden"}}));var Ne=_(ze);gd(Ne,()=>o(ye),(Fe,Ke)=>{Ke(Fe,{get data(){return o(r)},get id(){return j},get selected(){return o(a)},get selectable(){return o(N)},get deletable(){return o(l)},get sourcePosition(){return o(E)},get targetPosition(){return o(D)},get zIndex(){return o(ie)},get dragging(){return o(p)},get draggable(){return o(C)},get dragHandle(){return o(J)},get parentId(){return o(k)},get type(){return o(x)},get isConnectable(){return o(M)},get positionAbsoluteX(){return o(ke)},get positionAbsoluteY(){return o(F)},get width(){return o(K)},get height(){return o(O)}})}),Xn(ze,(Fe,Ke)=>Vs==null?void 0:Vs(Fe,Ke),()=>({nodeId:j,isSelectable:o(N),disabled:!o(C),handleSelector:o(J),noDragClass:n().noDragClass,nodeClickDistance:e.nodeClickDistance,onNodeMouseDown:n().handleNodeSelection,onDrag:(Fe,Ke,$e,Ze)=>{var Ge;(Ge=e.onnodedrag)==null||Ge.call(e,{event:Fe,targetNode:$e,nodes:Ze})},onDragStart:(Fe,Ke,$e,Ze)=>{var Ge;(Ge=e.onnodedragstart)==null||Ge.call(e,{event:Fe,targetNode:$e,nodes:Ze})},onDragStop:(Fe,Ke,$e,Ze)=>{var Ge;(Ge=e.onnodedragstop)==null||Ge.call(e,{event:Fe,targetNode:$e,nodes:Ze})},store:n()})),Cs(ze,Fe=>P(W,Fe),()=>o(W)),T(Oe,ze)};ce(ct,Oe=>{o(v)||Oe(qe)})}T(t,Je),st()}var SI=z('<div class="svelte-flow__nodes"></div>');function EI(t,e){at(e,!0);let n=Ae(e,"store",15);const r=typeof ResizeObserver>"u"?null:new ResizeObserver(s=>{const i=new Map;s.forEach(l=>{const u=l.target.getAttribute("data-id");i.set(u,{id:u,nodeElement:l.target,force:!0})}),n().updateNodeInternals(i)});md(()=>{r==null||r.disconnect()});var a=SI();Ot(a,21,()=>n().visible.nodes.values(),s=>s.id,(s,i)=>{kI(s,{get node(){return o(i)},get resizeObserver(){return r},get nodeClickDistance(){return e.nodeClickDistance},get onnodeclick(){return e.onnodeclick},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get onnodecontextmenu(){return e.onnodecontextmenu},get store(){return n()},set store(l){n(l)}})}),T(t,a),st()}var AI=mn('<svg class="svelte-flow__edge-wrapper"><g><!></g></svg>');function TI(t,e){at(e,!0);let n=Q(()=>e.edge.id),r=Q(()=>e.edge.source),a=Q(()=>e.edge.target),s=Q(()=>e.edge.sourceX),i=Q(()=>e.edge.sourceY),l=Q(()=>e.edge.targetX),u=Q(()=>e.edge.targetY),d=Q(()=>e.edge.sourcePosition),v=Q(()=>e.edge.targetPosition),p=Q(()=>Bn(e.edge.animated,!1)),h=Q(()=>Bn(e.edge.selected,!1)),m=Q(()=>e.edge.label),x=Q(()=>e.edge.labelStyle),k=Q(()=>Bn(e.edge.data,()=>({}),!0)),E=Q(()=>e.edge.style),D=Q(()=>e.edge.interactionWidth),B=Q(()=>Bn(e.edge.type,"default")),Y=Q(()=>e.edge.sourceHandle),S=Q(()=>e.edge.targetHandle),V=Q(()=>e.edge.markerStart),K=Q(()=>e.edge.markerEnd),O=Q(()=>e.edge.selectable),J=Q(()=>e.edge.focusable),ie=Q(()=>Bn(e.edge.deletable,!0)),ke=Q(()=>e.edge.hidden),F=Q(()=>e.edge.zIndex),I=Q(()=>e.edge.class),j=Q(()=>e.edge.ariaLabel);FC(o(n));let C=null,N=Q(()=>o(O)??e.store.elementsSelectable),M=Q(()=>o(J)??e.store.edgesFocusable),$=Q(()=>e.store.edgeTypes[o(B)]??pm),H=Q(()=>o(V)?`url('#${Ju(o(V),e.store.flowId)}')`:void 0),L=Q(()=>o(K)?`url('#${Ju(o(K),e.store.flowId)}')`:void 0);function q(re){var ye;const pe=e.store.edgeLookup.get(o(n));pe&&(o(N)&&e.store.handleEdgeSelection(o(n)),(ye=e.onedgeclick)==null||ye.call(e,{event:re,edge:pe}))}function te(re,pe){const ye=e.store.edgeLookup.get(o(n));ye&&pe({event:re,edge:ye})}function ae(re){if(!e.store.disableKeyboardA11y&&Wg.includes(re.key)&&o(N)){const{unselectNodesAndEdges:pe,addSelectedEdges:ye}=e.store;re.key==="Escape"?(C==null||C.blur(),pe({edges:[e.edge]})):ye([o(n)])}}var W=an(),G=Xe(W);{var ne=re=>{var pe=AI();let ye;var Se=_(pe);Va(Se,()=>({class:["svelte-flow__edge",o(I)],"data-id":o(n),onclick:q,oncontextmenu:e.onedgecontextmenu?he=>{te(he,e.onedgecontextmenu)}:void 0,onpointerenter:e.onedgepointerenter?he=>{te(he,e.onedgepointerenter)}:void 0,onpointerleave:e.onedgepointerleave?he=>{te(he,e.onedgepointerleave)}:void 0,"aria-label":o(j)===null?void 0:o(j)?o(j):`Edge from ${o(r)} to ${o(a)}`,"aria-describedby":o(M)?`${_m}-${e.store.flowId}`:void 0,role:e.edge.ariaRole??(o(M)?"group":"img"),"aria-roledescription":"edge",onkeydown:o(M)?ae:void 0,tabindex:o(M)?0:void 0,...e.edge.domAttributes,[Ma]:{animated:o(p),selected:o(h),selectable:o(N)}}));var Z=_(Se);gd(Z,()=>o($),(he,be)=>{be(he,{get id(){return o(n)},get source(){return o(r)},get target(){return o(a)},get sourceX(){return o(s)},get sourceY(){return o(i)},get targetX(){return o(l)},get targetY(){return o(u)},get sourcePosition(){return o(d)},get targetPosition(){return o(v)},get animated(){return o(p)},get selected(){return o(h)},get label(){return o(m)},get labelStyle(){return o(x)},get data(){return o(k)},get style(){return o(E)},get interactionWidth(){return o(D)},get selectable(){return o(N)},get deletable(){return o(ie)},get type(){return o(B)},get sourceHandleId(){return o(Y)},get targetHandleId(){return o(S)},get markerStart(){return o(H)},get markerEnd(){return o(L)}})}),Cs(Se,he=>C=he,()=>C),se(()=>ye=Dt(pe,"",ye,{"z-index":o(F)})),T(re,pe)};ce(G,re=>{o(ke)||re(ne)})}T(t,W),st()}by();var CI=mn("<defs></defs>");function II(t,e){at(e,!1);const n=Os();S_();var r=CI();Ot(r,5,()=>n.markers,a=>a.id,(a,s)=>{NI(a,Fs(()=>o(s)))}),T(t,r),st()}var PI=mn('<polyline class="arrow" fill="none" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4"></polyline>'),MI=mn('<polyline class="arrowclosed" stroke-linecap="round" stroke-linejoin="round" points="-5,-4 0,0 -5,4 -5,-4"></polyline>'),OI=mn('<marker class="svelte-flow__arrowhead" viewBox="-10 -10 20 20" refX="0" refY="0"><!></marker>');function NI(t,e){at(e,!0);let n=Ae(e,"width",3,12.5),r=Ae(e,"height",3,12.5),a=Ae(e,"markerUnits",3,"strokeWidth"),s=Ae(e,"orient",3,"auto-start-reverse"),i=Ae(e,"color",3,"none");var l=OI(),u=_(l);{var d=p=>{var h=PI();let m;se(()=>{kt(h,"stroke-width",e.strokeWidth),m=Dt(h,"",m,{stroke:i()})}),T(p,h)},v=p=>{var h=MI();let m;se(()=>{kt(h,"stroke-width",e.strokeWidth),m=Dt(h,"",m,{stroke:i(),fill:i()})}),T(p,h)};ce(u,p=>{e.type===Ll.Arrow?p(d):e.type===Ll.ArrowClosed&&p(v,1)})}se(()=>{kt(l,"id",e.id),kt(l,"markerWidth",`${n()}`),kt(l,"markerHeight",`${r()}`),kt(l,"markerUnits",a()),kt(l,"orient",s())}),T(t,l),st()}var DI=z('<div class="svelte-flow__edges"><svg class="svelte-flow__marker"><!></svg> <!></div>');function RI(t,e){at(e,!0);let n=Ae(e,"store",15);var r=DI(),a=_(r),s=_(a);II(s,{});var i=b(a,2);Ot(i,17,()=>n().visible.edges.values(),l=>l.id,(l,u)=>{TI(l,{get edge(){return o(u)},get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return n()},set store(d){n(d)}})}),T(t,r),st()}var LI=z('<div class="svelte-flow__selection svelte-1vr3gfi"></div>');function bm(t,e){at(e,!0);let n=Ae(e,"x",3,0),r=Ae(e,"y",3,0),a=Ae(e,"width",3,0),s=Ae(e,"height",3,0),i=Ae(e,"isVisible",3,!0);var l=an(),u=Xe(l);{var d=v=>{var p=LI();let h;se(m=>h=Dt(p,"",h,m),[()=>({width:typeof a()=="string"?a():aa(a()),height:typeof s()=="string"?s():aa(s()),transform:`translate(${n()}px, ${r()}px)`})]),T(v,p)};ce(u,v=>{i()&&v(d)})}T(t,l),st()}var jI=z("<div><!></div>");function zI(t,e){at(e,!0);let n=Me(void 0);yn(()=>{var p;e.store.disableKeyboardA11y||(p=o(n))==null||p.focus({preventScroll:!0})});let r=Q(()=>{if(e.store.selectionRectMode==="nodes"){e.store.nodes;const p=cc(e.store.nodeLookup,{filter:h=>!!h.selected});if(p.width>0&&p.height>0)return p}return null});function a(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectioncontextmenu)==null||m.call(e,{nodes:h,event:p})}function s(p){var m;const h=e.store.nodes.filter(x=>x.selected);(m=e.onselectionclick)==null||m.call(e,{nodes:h,event:p})}function i(p){Object.prototype.hasOwnProperty.call(Bl,p.key)&&(p.preventDefault(),e.store.moveSelectedNodes(Bl[p.key],p.shiftKey?4:1))}var l=an(),u=Xe(l);{var d=p=>{var h=jI();h.__contextmenu=a,h.__click=s,h.__keydown=function(...k){var E;(E=e.store.disableKeyboardA11y?void 0:i)==null||E.apply(this,k)};let m;var x=_(h);bm(x,{width:"100%",height:"100%",x:0,y:0}),Xn(h,(k,E)=>Vs==null?void 0:Vs(k,E),()=>({disabled:!1,store:e.store,onDrag:(k,E,D,B)=>{var Y;(Y=e.onnodedrag)==null||Y.call(e,{event:k,targetNode:null,nodes:B})},onDragStart:(k,E,D,B)=>{var Y;(Y=e.onnodedragstart)==null||Y.call(e,{event:k,targetNode:null,nodes:B})},onDragStop:(k,E,D,B)=>{var Y;(Y=e.onnodedragstop)==null||Y.call(e,{event:k,targetNode:null,nodes:B})}})),Cs(h,k=>P(n,k),()=>o(n)),se(k=>{xt(h,1,Ts(["svelte-flow__selection-wrapper",e.store.noPanClass]),"svelte-sf2y5e"),kt(h,"role",e.store.disableKeyboardA11y?void 0:"button"),kt(h,"tabindex",e.store.disableKeyboardA11y?void 0:-1),m=Dt(h,"",m,k)},[()=>({width:aa(o(r).width),height:aa(o(r).height),transform:`translate(${o(r).x??""}px, ${o(r).y??""}px)`})]),T(p,h)},v=Q(()=>e.store.selectionRectMode==="nodes"&&o(r)&&ya(o(r).x)&&ya(o(r).y));ce(u,p=>{o(v)&&p(d)})}T(t,l),st()}Xt(["contextmenu","click","keydown"]);function qI(t){switch(t){case"ctrl":return 8;case"shift":return 4;case"alt":return 2;case"meta":return 1}}function Zt(t,e){let{enabled:n=!0,trigger:r,type:a="keydown"}=e;function s(l){var v;const u=Array.isArray(r)?r:[r],d=[l.metaKey,l.altKey,l.shiftKey,l.ctrlKey].reduce((p,h,m)=>h?p|1<<m:p,0);for(const p of u){const h={preventDefault:!1,enabled:!0,...p},{modifier:m,key:x,callback:k,preventDefault:E,enabled:D}=h;if(D){if(l.key!==x)continue;if(m===null||m===!1){if(d!==0)continue}else if(m!==void 0&&((v=m==null?void 0:m[0])==null?void 0:v.length)>0){const Y=Array.isArray(m)?m:[m];let S=!1;for(const V of Y)if((Array.isArray(V)?V:[V]).reduce((O,J)=>O|qI(J),0)===d){S=!0;break}if(!S)continue}E&&l.preventDefault();const B={node:t,trigger:h,originalEvent:l};t.dispatchEvent(new CustomEvent("shortcut",{detail:B})),k==null||k(B)}}}let i;return n&&(i=ku(t,a,s)),{update:l=>{const{enabled:u=!0,type:d="keydown"}=l;n&&(!u||a!==d)?i==null||i():!n&&u&&(i=ku(t,d,s)),n=u,a=d,r=l.trigger},destroy:()=>{i==null||i()}}}function BI(){const t=Q(Os),e=s=>{var d,v;const i=$v(s)?s:o(t).nodeLookup.get(s.id),l=i.parentId?XT(i.position,i.measured,i.parentId,o(t).nodeLookup,o(t).nodeOrigin):i.position,u={...i,position:l,width:((d=i.measured)==null?void 0:d.width)??i.width,height:((v=i.measured)==null?void 0:v.height)??i.height};return di(u)};function n(s,i,l={replace:!1}){o(t).nodes=er(()=>o(t).nodes).map(u=>{if(u.id===s){const d=typeof i=="function"?i(u):i;return l!=null&&l.replace&&$v(d)?d:{...u,...d}}return u})}function r(s,i,l={replace:!1}){o(t).edges=er(()=>o(t).edges).map(u=>{if(u.id===s){const d=typeof i=="function"?i(u):i;return l.replace&&ZC(d)?d:{...u,...d}}return u})}const a=s=>o(t).nodeLookup.get(s);return{zoomIn:o(t).zoomIn,zoomOut:o(t).zoomOut,getInternalNode:a,getNode:s=>{var i;return(i=a(s))==null?void 0:i.internals.userNode},getNodes:s=>s===void 0?o(t).nodes:ah(o(t).nodeLookup,s),getEdge:s=>o(t).edgeLookup.get(s),getEdges:s=>s===void 0?o(t).edges:ah(o(t).edgeLookup,s),setZoom:(s,i)=>{const l=o(t).panZoom;return l?l.scaleTo(s,{duration:i==null?void 0:i.duration}):Promise.resolve(!1)},getZoom:()=>o(t).viewport.zoom,setViewport:async(s,i)=>{const l=o(t).viewport;return o(t).panZoom?(await o(t).panZoom.setViewport({x:s.x??l.x,y:s.y??l.y,zoom:s.zoom??l.zoom},i),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>kh(o(t).viewport),setCenter:async(s,i,l)=>o(t).setCenter(s,i,l),fitView:s=>o(t).fitView(s),fitBounds:async(s,i)=>{if(!o(t).panZoom)return Promise.resolve(!1);const l=Wd(s,o(t).width,o(t).height,o(t).minZoom,o(t).maxZoom,(i==null?void 0:i.padding)??.1);return await o(t).panZoom.setViewport(l,{duration:i==null?void 0:i.duration,ease:i==null?void 0:i.ease,interpolate:i==null?void 0:i.interpolate}),Promise.resolve(!0)},getIntersectingNodes:(s,i=!0,l)=>{const u=Fv(s),d=u?s:e(s);return d?(l||o(t).nodes).filter(v=>{const p=o(t).nodeLookup.get(v.id);if(!p||!u&&v.id===s.id)return!1;const h=di(p),m=so(h,d);return i&&m>0||m>=h.width*h.height||m>=d.width*d.height}):[]},isNodeIntersecting:(s,i,l=!0)=>{const d=Fv(s)?s:e(s);if(!d)return!1;const v=so(d,i);return l&&v>0||v>=i.width*i.height||v>=d.width*d.height},deleteElements:async({nodes:s=[],edges:i=[]})=>{var d,v;const{nodes:l,edges:u}=await HT({nodesToRemove:s,edgesToRemove:i,nodes:o(t).nodes,edges:o(t).edges,onBeforeDelete:o(t).onbeforedelete});return l&&(o(t).nodes=er(()=>o(t).nodes).filter(p=>!l.some(({id:h})=>h===p.id))),u&&(o(t).edges=er(()=>o(t).edges).filter(p=>!u.some(({id:h})=>h===p.id))),(l.length>0||u.length>0)&&((v=(d=o(t)).ondelete)==null||v.call(d,{nodes:l,edges:u})),{deletedNodes:l,deletedEdges:u}},screenToFlowPosition:(s,i={snapToGrid:!0})=>{if(!o(t).domNode)return s;const l=i.snapToGrid?o(t).snapGrid:!1,{x:u,y:d,zoom:v}=o(t).viewport,{x:p,y:h}=o(t).domNode.getBoundingClientRect(),m={x:s.x-p,y:s.y-h};return Co(m,[u,d,v],l!==null,l||[1,1])},flowToScreenPosition:s=>{if(!o(t).domNode)return s;const{x:i,y:l,zoom:u}=o(t).viewport,{x:d,y:v}=o(t).domNode.getBoundingClientRect(),p=zl(s,[i,l,u]);return{x:p.x+d,y:p.y+v}},toObject:()=>structuredClone({nodes:[...o(t).nodes],edges:[...o(t).edges],viewport:{...o(t).viewport}}),updateNode:n,updateNodeData:(s,i,l)=>{var v;const u=(v=o(t).nodeLookup.get(s))==null?void 0:v.internals.userNode;if(!u)return;const d=typeof i=="function"?i(u):i;n(s,p=>({...p,data:l!=null&&l.replace?d:{...p.data,...d}}))},updateEdge:r,getNodesBounds:s=>qT(s,{nodeLookup:o(t).nodeLookup,nodeOrigin:o(t).nodeOrigin}),getHandleConnections:({type:s,id:i,nodeId:l})=>{var u;return Array.from(((u=o(t).connectionLookup.get(`${l}-${s}-${i??null}`))==null?void 0:u.values())??[])}}}function ah(t,e){var r;const n=[];for(const a of e){const s=t.get(a);if(s){const i="internals"in s?(r=s.internals)==null?void 0:r.userNode:s;n.push(i)}}return n}function FI(t,e){at(e,!0);let n=Ae(e,"store",15),r=Ae(e,"selectionKey",3,"Shift"),a=Ae(e,"multiSelectionKey",19,()=>ql()?"Meta":"Control"),s=Ae(e,"deleteKey",3,"Backspace"),i=Ae(e,"panActivationKey",3," "),l=Ae(e,"zoomActivationKey",19,()=>ql()?"Meta":"Control"),{deleteElements:u}=BI();function d(k){return k!==null&&typeof k=="object"}function v(k){return d(k)?k.modifier||[]:[]}function p(k){return k==null?"":d(k)?k.key:k}function h(k,E){return(Array.isArray(k)?k:[k]).map(B=>{const Y=p(B);return{key:Y,modifier:v(B),enabled:Y!==null,callback:E}})}function m(){n(n().selectionRect=null,!0),n(n().selectionKeyPressed=!1,!0),n(n().multiselectionKeyPressed=!1,!0),n(n().deleteKeyPressed=!1,!0),n(n().panActivationKeyPressed=!1,!0),n(n().zoomActivationKeyPressed=!1,!0)}function x(){const k=n().nodes.filter(D=>D.selected),E=n().edges.filter(D=>D.selected);u({nodes:k,edges:E})}wl("blur",Wn,m),wl("contextmenu",Wn,m),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(r(),()=>n(n().selectionKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(a(),()=>{n(n().multiselectionKeyPressed=!0,!0)}),type:"keydown"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(a(),()=>n(n().multiselectionKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(s(),k=>{!(k.originalEvent.ctrlKey||k.originalEvent.metaKey||k.originalEvent.shiftKey)&&!em(k.originalEvent)&&(n(n().deleteKeyPressed=!0,!0),x())}),type:"keydown"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(s(),()=>n(n().deleteKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(i(),()=>n(n().panActivationKeyPressed=!1,!0)),type:"keyup"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!0,!0)),type:"keydown"})),Xn(Wn,(k,E)=>Zt==null?void 0:Zt(k,E),()=>({trigger:h(l(),()=>n(n().zoomActivationKeyPressed=!1,!0)),type:"keyup"})),st()}var KI=mn('<path fill="none" class="svelte-flow__connection-path"></path>'),HI=mn('<svg class="svelte-flow__connectionline"><g><!></g></svg>');function GI(t,e){at(e,!0);let n=Q(()=>{if(!e.store.connection.inProgress)return"";const i={sourceX:e.store.connection.from.x,sourceY:e.store.connection.from.y,sourcePosition:e.store.connection.fromPosition,targetX:e.store.connection.to.x,targetY:e.store.connection.to.y,targetPosition:e.store.connection.toPosition};switch(e.type){case Oa.Bezier:{const[l]=nm(i);return l}case Oa.Straight:{const[l]=am(i);return l}case Oa.Step:case Oa.SmoothStep:{const[l]=Yd({...i,borderRadius:e.type===Oa.Step?0:void 0});return l}}});var r=an(),a=Xe(r);{var s=i=>{var l=HI(),u=_(l),d=_(u);{var v=h=>{var m=an(),x=Xe(m);gd(x,()=>e.LineComponent,(k,E)=>{E(k,{})}),T(h,m)},p=h=>{var m=KI();se(()=>{kt(m,"d",o(n)),Dt(m,e.style)}),T(h,m)};ce(d,h=>{e.LineComponent?h(v):h(p,!1)})}se(h=>{kt(l,"width",e.store.width),kt(l,"height",e.store.height),Dt(l,e.containerStyle),xt(u,0,h)},[()=>Ts(["svelte-flow__connection",jT(e.store.connection.isValid)])]),T(i,l)};ce(a,i=>{e.store.connection.inProgress&&i(s)})}T(t,r),st()}var UI=z("<div><!></div>");function wm(t,e){at(e,!0);let n=Ae(e,"position",3,"top-right"),r=Is(e,["$$slots","$$events","$$legacy","position","style","class","children"]),a=Q(()=>`${n()}`.split("-"));var s=UI();Va(s,l=>({class:l,style:e.style,...r}),[()=>["svelte-flow__panel",e.class,...o(a)]]);var i=_(s);yr(i,()=>e.children??Es),T(t,s),st()}var VI=z('<a href="https://svelteflow.dev" target="_blank" rel="noopener noreferrer" aria-label="Svelte Flow attribution">Svelte Flow</a>');function WI(t,e){at(e,!0);let n=Ae(e,"position",3,"bottom-right");var r=an(),a=Xe(r);{var s=i=>{wm(i,{get position(){return n()},class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",children:(l,u)=>{var d=VI();T(l,d)},$$slots:{default:!0}})};ce(a,i=>{var l;(l=e.proOptions)!=null&&l.hideAttribution||i(s)})}T(t,r),st()}var YI=z("<div><!></div>");function XI(t,e){at(e,!0);let n=Ae(e,"domNode",15),r=Ae(e,"clientWidth",15),a=Ae(e,"clientHeight",15),s=Q(()=>e.rest.class),i=Q(()=>Jy(e.rest,["id","class","nodeTypes","edgeTypes","colorMode","isValidConnection","onmove","onmovestart","onmoveend","onflowerror","ondelete","onbeforedelete","onbeforeconnect","onconnect","onconnectstart","onconnectend","onbeforereconnect","onreconnect","onreconnectstart","onreconnectend","onclickconnectstart","onclickconnectend","oninit","onselectionchange","onselectiondragstart","onselectiondrag","onselectiondragstop","onselectionstart","onselectionend","clickConnect","fitView","fitViewOptions","nodeOrigin","nodeDragThreshold","connectionDragThreshold","minZoom","maxZoom","initialViewport","connectionRadius","connectionMode","selectionMode","selectNodesOnDrag","snapGrid","defaultMarkerColor","translateExtent","nodeExtent","onlyRenderVisibleElements","autoPanOnConnect","autoPanOnNodeDrag","colorModeSSR","defaultEdgeOptions","elevateNodesOnSelect","elevateEdgesOnSelect","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","elementsSelectable","nodesFocusable","edgesFocusable","disableKeyboardA11y","noDragClass","noPanClass","noWheelClass","ariaLabelConfig","autoPanSpeed","panOnScrollSpeed","zIndexMode"]));function l(v){v.currentTarget.scrollTo({top:0,left:0,behavior:"auto"}),e.rest.onscroll&&e.rest.onscroll(v)}var u=YI();Va(u,v=>({class:["svelte-flow","svelte-flow__container",o(s),e.colorMode],"data-testid":"svelte-flow__wrapper",role:"application",onscroll:l,...o(i),[ha]:v}),[()=>({width:aa(e.width),height:aa(e.height)})],void 0,void 0,"svelte-mkap6j");var d=_(u);yr(d,()=>e.children??Es),Cs(u,v=>n(v),()=>n()),Kf(u,"clientHeight",a),Kf(u,"clientWidth",r),T(t,u),st()}var ZI=z('<div class="svelte-flow__viewport-back svelte-flow__container"></div> <!> <div class="svelte-flow__edge-labels svelte-flow__container"></div> <!> <!> <!> <div class="svelte-flow__viewport-front svelte-flow__container"></div>',1),QI=z("<!> <!>",1),JI=z("<!> <!> <!> <!> <!>",1);function $I(t,e){at(e,!0);let n=Ae(e,"paneClickDistance",3,1),r=Ae(e,"nodeClickDistance",3,1),a=Ae(e,"panOnScrollMode",19,()=>Us.Free),s=Ae(e,"preventScrolling",3,!0),i=Ae(e,"zoomOnScroll",3,!0),l=Ae(e,"zoomOnDoubleClick",3,!0),u=Ae(e,"zoomOnPinch",3,!0),d=Ae(e,"panOnScroll",3,!1),v=Ae(e,"panOnScrollSpeed",3,.5),p=Ae(e,"panOnDrag",3,!0),h=Ae(e,"selectionOnDrag",3,!1),m=Ae(e,"connectionLineType",19,()=>Oa.Bezier),x=Ae(e,"nodes",31,()=>Wt([])),k=Ae(e,"edges",31,()=>Wt([])),E=Ae(e,"viewport",15,void 0),D=Is(e,["$$slots","$$events","$$legacy","width","height","proOptions","selectionKey","deleteKey","panActivationKey","multiSelectionKey","zoomActivationKey","paneClickDistance","nodeClickDistance","onmovestart","onmoveend","onmove","oninit","onnodeclick","onnodecontextmenu","onnodedrag","onnodedragstart","onnodedragstop","onnodepointerenter","onnodepointermove","onnodepointerleave","onselectionclick","onselectioncontextmenu","onselectionstart","onselectionend","onedgeclick","onedgecontextmenu","onedgepointerenter","onedgepointerleave","onpaneclick","onpanecontextmenu","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnScrollSpeed","panOnDrag","selectionOnDrag","connectionLineComponent","connectionLineStyle","connectionLineContainerStyle","connectionLineType","attributionPosition","children","nodes","edges","viewport"]),B=dI({props:D,width:e.width,height:e.height,get nodes(){return x()},set nodes(S){x(S)},get edges(){return k()},set edges(S){k(S)},get viewport(){return E()},set viewport(S){E(S)}});const Y=ad($u);Y&&Y.setStore&&Y.setStore(B),Sh($u,{provider:!1,getStore(){return B}}),yn(()=>{var V;const S={nodes:B.selectedNodes,edges:B.selectedEdges};(V=er(()=>e.onselectionchange))==null||V(S);for(const K of B.selectionChangeHandlers.values())K(S)}),md(()=>{B.reset()}),XI(t,{get colorMode(){return B.colorMode},get width(){return e.width},get height(){return e.height},get rest(){return D},get domNode(){return B.domNode},set domNode(S){B.domNode=S},get clientWidth(){return B.width},set clientWidth(S){B.width=S},get clientHeight(){return B.height},set clientHeight(S){B.height=S},children:(S,V)=>{var K=JI(),O=Xe(K);FI(O,{get selectionKey(){return e.selectionKey},get deleteKey(){return e.deleteKey},get panActivationKey(){return e.panActivationKey},get multiSelectionKey(){return e.multiSelectionKey},get zoomActivationKey(){return e.zoomActivationKey},get store(){return B},set store(I){B=I}});var J=b(O,2);vI(J,{get panOnScrollMode(){return a()},get preventScrolling(){return s()},get zoomOnScroll(){return i()},get zoomOnDoubleClick(){return l()},get zoomOnPinch(){return u()},get panOnScroll(){return d()},get panOnScrollSpeed(){return v()},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get onmovestart(){return e.onmovestart},get onmove(){return e.onmove},get onmoveend(){return e.onmoveend},get oninit(){return e.oninit},get store(){return B},set store(I){B=I},children:(I,j)=>{pI(I,{get onpaneclick(){return e.onpaneclick},get onpanecontextmenu(){return e.onpanecontextmenu},get onselectionstart(){return e.onselectionstart},get onselectionend(){return e.onselectionend},get panOnDrag(){return p()},get paneClickDistance(){return n()},get selectionOnDrag(){return h()},get store(){return B},set store(C){B=C},children:(C,N)=>{var M=QI(),$=Xe(M);mI($,{get store(){return B},set store(L){B=L},children:(L,q)=>{var te=ZI(),ae=b(Xe(te),2);RI(ae,{get onedgeclick(){return e.onedgeclick},get onedgecontextmenu(){return e.onedgecontextmenu},get onedgepointerenter(){return e.onedgepointerenter},get onedgepointerleave(){return e.onedgepointerleave},get store(){return B},set store(re){B=re}});var W=b(ae,4);GI(W,{get type(){return m()},get LineComponent(){return e.connectionLineComponent},get containerStyle(){return e.connectionLineContainerStyle},get style(){return e.connectionLineStyle},get store(){return B},set store(re){B=re}});var G=b(W,2);EI(G,{get nodeClickDistance(){return r()},get onnodeclick(){return e.onnodeclick},get onnodecontextmenu(){return e.onnodecontextmenu},get onnodepointerenter(){return e.onnodepointerenter},get onnodepointermove(){return e.onnodepointermove},get onnodepointerleave(){return e.onnodepointerleave},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return B},set store(re){B=re}});var ne=b(G,2);zI(ne,{get onselectionclick(){return e.onselectionclick},get onselectioncontextmenu(){return e.onselectioncontextmenu},get onnodedrag(){return e.onnodedrag},get onnodedragstart(){return e.onnodedragstart},get onnodedragstop(){return e.onnodedragstop},get store(){return B},set store(re){B=re}}),T(L,te)},$$slots:{default:!0}});var H=b($,2);{let L=Q(()=>!!(B.selectionRect&&B.selectionRectMode==="user")),q=Q(()=>{var G;return(G=B.selectionRect)==null?void 0:G.width}),te=Q(()=>{var G;return(G=B.selectionRect)==null?void 0:G.height}),ae=Q(()=>{var G;return(G=B.selectionRect)==null?void 0:G.x}),W=Q(()=>{var G;return(G=B.selectionRect)==null?void 0:G.y});bm(H,{get isVisible(){return o(L)},get width(){return o(q)},get height(){return o(te)},get x(){return o(ae)},get y(){return o(W)}})}T(C,M)},$$slots:{default:!0}})},$$slots:{default:!0}});var ie=b(J,2);WI(ie,{get proOptions(){return e.proOptions},get position(){return e.attributionPosition}});var ke=b(ie,2);bI(ke,{get store(){return B}});var F=b(ke,2);yr(F,()=>e.children??Es),T(S,K)},$$slots:{default:!0}}),st()}var eP=z("<button><!></button>");function sl(t,e){let n=Is(e,["$$slots","$$events","$$legacy","class","bgColor","bgColorHover","color","colorHover","borderColor","onclick","children"]);var r=eP();Va(r,()=>({type:"button",onclick:e.onclick,class:["svelte-flow__controls-button",e.class],...n,[ha]:{"--xy-controls-button-background-color-props":e.bgColor,"--xy-controls-button-background-color-hover-props":e.bgColorHover,"--xy-controls-button-color-props":e.color,"--xy-controls-button-color-hover-props":e.colorHover,"--xy-controls-button-border-color-props":e.borderColor}}));var a=_(r);yr(a,()=>e.children??Es),T(t,r)}var tP=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"></path></svg>');function nP(t){var e=tP();T(t,e)}var rP=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 5"><path d="M0 0h32v4.2H0z"></path></svg>');function aP(t){var e=rP();T(t,e)}var sP=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 30"><path d="M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"></path></svg>');function iP(t){var e=sP();T(t,e)}var oP=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"></path></svg>');function lP(t){var e=oP();T(t,e)}var cP=mn('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 32"><path d="M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"></path></svg>');function uP(t){var e=cP();T(t,e)}var dP=z("<!> <!>",1),fP=z("<!> <!> <!> <!> <!> <!>",1);function vP(t,e){at(e,!0);let n=Ae(e,"position",3,"bottom-left"),r=Ae(e,"orientation",3,"vertical"),a=Ae(e,"showZoom",3,!0),s=Ae(e,"showFitView",3,!0),i=Ae(e,"showLock",3,!0),l=Is(e,["$$slots","$$events","$$legacy","position","orientation","showZoom","showFitView","showLock","style","class","buttonBgColor","buttonBgColorHover","buttonColor","buttonColorHover","buttonBorderColor","fitViewOptions","children","before","after"]),u=Q(Os);const d={bgColor:e.buttonBgColor,bgColorHover:e.buttonBgColorHover,color:e.buttonColor,colorHover:e.buttonColorHover,borderColor:e.buttonBorderColor};let v=Q(()=>o(u).nodesDraggable||o(u).nodesConnectable||o(u).elementsSelectable),p=Q(()=>o(u).viewport.zoom<=o(u).minZoom),h=Q(()=>o(u).viewport.zoom>=o(u).maxZoom),m=Q(()=>o(u).ariaLabelConfig),x=Q(()=>r()==="horizontal"?"horizontal":"vertical");const k=()=>{o(u).zoomIn()},E=()=>{o(u).zoomOut()},D=()=>{o(u).fitView(e.fitViewOptions)},B=()=>{let Y=!o(v);o(u).nodesDraggable=Y,o(u).nodesConnectable=Y,o(u).elementsSelectable=Y};{let Y=Q(()=>["svelte-flow__controls",o(x),e.class]);wm(t,Fs({get class(){return o(Y)},get position(){return n()},"data-testid":"svelte-flow__controls",get"aria-label"(){return o(m)["controls.ariaLabel"]},get style(){return e.style}},()=>l,{children:(S,V)=>{var K=fP(),O=Xe(K);{var J=L=>{var q=an(),te=Xe(q);yr(te,()=>e.before),T(L,q)};ce(O,L=>{e.before&&L(J)})}var ie=b(O,2);{var ke=L=>{var q=dP(),te=Xe(q);sl(te,Fs({onclick:k,class:"svelte-flow__controls-zoomin",get title(){return o(m)["controls.zoomIn.ariaLabel"]},get"aria-label"(){return o(m)["controls.zoomIn.ariaLabel"]},get disabled(){return o(h)}},()=>d,{children:(W,G)=>{nP(W)},$$slots:{default:!0}}));var ae=b(te,2);sl(ae,Fs({onclick:E,class:"svelte-flow__controls-zoomout",get title(){return o(m)["controls.zoomOut.ariaLabel"]},get"aria-label"(){return o(m)["controls.zoomOut.ariaLabel"]},get disabled(){return o(p)}},()=>d,{children:(W,G)=>{aP(W)},$$slots:{default:!0}})),T(L,q)};ce(ie,L=>{a()&&L(ke)})}var F=b(ie,2);{var I=L=>{sl(L,Fs({class:"svelte-flow__controls-fitview",onclick:D,get title(){return o(m)["controls.fitView.ariaLabel"]},get"aria-label"(){return o(m)["controls.fitView.ariaLabel"]}},()=>d,{children:(q,te)=>{iP(q)},$$slots:{default:!0}}))};ce(F,L=>{s()&&L(I)})}var j=b(F,2);{var C=L=>{sl(L,Fs({class:"svelte-flow__controls-interactive",onclick:B,get title(){return o(m)["controls.interactive.ariaLabel"]},get"aria-label"(){return o(m)["controls.interactive.ariaLabel"]}},()=>d,{children:(q,te)=>{var ae=an(),W=Xe(ae);{var G=re=>{uP(re)},ne=re=>{lP(re)};ce(W,re=>{o(v)?re(G):re(ne,!1)})}T(q,ae)},$$slots:{default:!0}}))};ce(j,L=>{i()&&L(C)})}var N=b(j,2);{var M=L=>{var q=an(),te=Xe(q);yr(te,()=>e.children),T(L,q)};ce(N,L=>{e.children&&L(M)})}var $=b(N,2);{var H=L=>{var q=an(),te=Xe(q);yr(te,()=>e.after),T(L,q)};ce($,L=>{e.after&&L(H)})}T(S,K)},$$slots:{default:!0}}))}st()}var Ba;(function(t){t.Lines="lines",t.Dots="dots",t.Cross="cross"})(Ba||(Ba={}));var hP=mn("<circle></circle>");function pP(t,e){var n=hP();se(()=>{kt(n,"cx",e.radius),kt(n,"cy",e.radius),kt(n,"r",e.radius),xt(n,0,Ts(["svelte-flow__background-pattern","dots",e.class]))}),T(t,n)}var gP=mn("<path></path>");function mP(t,e){at(e,!0);var n=gP();se(()=>{kt(n,"stroke-width",e.lineWidth),kt(n,"d",`M${e.dimensions[0]/2} 0 V${e.dimensions[1]} M0 ${e.dimensions[1]/2} H${e.dimensions[0]}`),xt(n,0,Ts(["svelte-flow__background-pattern",e.variant,e.class]))}),T(t,n),st()}const yP={[Ba.Dots]:1,[Ba.Lines]:1,[Ba.Cross]:6};var _P=mn('<svg data-testid="svelte-flow__background"><pattern patternUnits="userSpaceOnUse"><!></pattern><rect x="0" y="0" width="100%" height="100%"></rect></svg>');function bP(t,e){at(e,!0);let n=Ae(e,"variant",19,()=>Ba.Dots),r=Ae(e,"gap",3,20),a=Ae(e,"lineWidth",3,1),s=Q(Os),i=Q(()=>n()===Ba.Dots),l=Q(()=>n()===Ba.Cross),u=Q(()=>Array.isArray(r())?r():[r(),r()]),d=Q(()=>`background-pattern-${o(s).flowId}-${e.id??""}`),v=Q(()=>[o(u)[0]*o(s).viewport.zoom||1,o(u)[1]*o(s).viewport.zoom||1]),p=Q(()=>(e.size??yP[n()])*o(s).viewport.zoom),h=Q(()=>o(l)?[o(p),o(p)]:o(v)),m=Q(()=>o(i)?[o(p)/2,o(p)/2]:[o(h)[0]/2,o(h)[1]/2]);var x=_P();let k;var E=_(x),D=_(E);{var B=V=>{{let K=Q(()=>o(p)/2);pP(V,{get radius(){return o(K)},get class(){return e.patternClass}})}},Y=V=>{mP(V,{get dimensions(){return o(h)},get variant(){return n()},get lineWidth(){return a()},get class(){return e.patternClass}})};ce(D,V=>{o(i)?V(B):V(Y,!1)})}var S=b(E);se(()=>{xt(x,0,Ts(["svelte-flow__background","svelte-flow__container",e.class])),k=Dt(x,"",k,{"--xy-background-color-props":e.bgColor,"--xy-background-pattern-color-props":e.patternColor}),kt(E,"id",o(d)),kt(E,"x",o(s).viewport.x%o(v)[0]),kt(E,"y",o(s).viewport.y%o(v)[1]),kt(E,"width",o(v)[0]),kt(E,"height",o(v)[1]),kt(E,"patternTransform",`translate(-${o(m)[0]},-${o(m)[1]})`),kt(S,"fill",`url(#${o(d)})`)}),T(t,x),st()}var wP=z('<div class="trigger-node svelte-a1pdcu"><div class="trigger-header svelte-a1pdcu"><span class="icon">â¡</span> Trigger</div> <div class="trigger-body svelte-a1pdcu"><div class="label svelte-a1pdcu"> </div> <div class="group svelte-a1pdcu"> </div></div> <!></div>');function xP(t,e){at(e,!0);let n=Q(()=>nr[e.data.group]||nr.INFO);var r=wP();let a;var s=_(r);let i;var l=b(s,2),u=_(l),d=_(u),v=b(u,2);let p;var h=_(v),m=b(l,2);Ga(m,{type:"source",get position(){return wt.Right}}),se(()=>{a=Dt(r,"",a,{"border-color":o(n).color}),i=Dt(s,"",i,{background:o(n).color}),ee(d,`Event: ${e.data.label??""}`),p=Dt(v,"",p,{color:o(n).color}),ee(h,o(n).label)}),T(t,r),st()}var kP=z('<div class="binding svelte-1bgwygg"> </div>'),SP=z('<div class="binding unbound svelte-1bgwygg">unbound</div>'),EP=z('<div class="action-node svelte-1bgwygg"><!> <div class="action-header svelte-1bgwygg"><span class="icon svelte-1bgwygg"> </span> </div> <div class="action-body svelte-1bgwygg"><div class="desc svelte-1bgwygg"> </div> <!></div> <div class="action-footer svelte-1bgwygg"><button title="Edit" class="svelte-1bgwygg">âï¸ Edit</button> <button title="Delete" class="danger svelte-1bgwygg">ðï¸</button></div> <!></div>');function AP(t,e){at(e,!0);let n=Q(()=>e.data.cmd);var r=EP(),a=_(r);Ga(a,{type:"target",get position(){return wt.Left}});var s=b(a,2),i=_(s),l=_(i),u=b(i),d=b(s,2),v=_(d),p=_(v),h=b(v,2);{var m=Y=>{var S=kP(),V=_(S);se(()=>ee(V,`${o(n).pluginId??""}Â·${o(n).commandId??""}`)),T(Y,S)},x=Y=>{var S=SP();T(Y,S)};ce(h,Y=>{o(n).pluginId&&o(n).commandId?Y(m):Y(x,!1)})}var k=b(d,2),E=_(k);E.__click=function(...Y){var S;(S=e.data.onEdit)==null||S.apply(this,Y)};var D=b(E,2);D.__click=function(...Y){var S;(S=e.data.onDelete)==null||S.apply(this,Y)};var B=b(k,2);Ga(B,{type:"source",get position(){return wt.Right}}),se(()=>{ee(l,o(n).icon||"âï¸"),ee(u,` ${o(n).name??""}`),kt(v,"title",o(n).description),ee(p,o(n).description)}),T(t,r),st()}Xt(["click"]);var TP=z('<button class="add-node svelte-w8wqxx" title="Add next action"><!> <div class="plus svelte-w8wqxx">+</div></button>');function CP(t,e){at(e,!0);var n=TP();n.__click=function(...a){var s;(s=e.data.onClick)==null||s.apply(this,a)};var r=_(n);Ga(r,{type:"target",get position(){return wt.Left},style:"opacity: 0"}),T(t,n),st()}Xt(["click"]);var IP=z('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),PP=z('<span class="type-group-chip svelte-d25j4l"> </span>'),MP=z('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),OP=z("<button> </button>"),NP=z("<!> <!>",1),DP=z('<span class="picker-tile-added svelte-d25j4l">â added</span>'),RP=z('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),LP=z('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),jP=z('<div class="floating-panel picker-panel svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Add Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="action-picker svelte-d25j4l"><!> <div class="picker-custom-row svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">+ Create Custom Action</button> <span class="picker-hint svelte-d25j4l" style="margin-left: 0.5rem;">Link to any plugin command</span></div></div></div>'),zP=z("<option> </option>"),qP=z("<optgroup></optgroup>"),BP=z('<div class="floating-panel editor-panel-inner svelte-d25j4l"><div class="panel-header svelte-d25j4l"><h3 class="svelte-d25j4l">Edit Action Node</h3> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="cmd-form svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-row svelte-d25j4l"><select class="plugin-select svelte-d25j4l"><option>-- Select Plugin Command --</option><!></select></div> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div></div>'),FP=z('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button></div> <div class="canvas-wrapper svelte-d25j4l"><!> <!> <!></div>',1),KP=z('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),HP=z('<p class="svelte-d25j4l">Select an event type on the left to view and edit its visual graph.</p>'),GP=z('<div class="no-selection svelte-d25j4l"><!></div>'),UP=z('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">n8n-like visual graph editor</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function VP(t,e){at(e,!0);const n={trigger:xP,action:AP,add:CP};let r=Ae(e,"open",15,!1),a=Me(Wt([])),s=Me(Wt({})),i=Me(Wt({})),l=Me(null),u=Me("INFO"),d=Me(Wt([])),v=Me(null),p=Me(!1),h=Me(""),m=Me(!1),x=Me([]),k=Me([]);const E=[{pluginId:"gmail",pluginName:"Gmail",actions:Xp("gmail")}],D={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function B(){P(a,await vb(),!0);const q={};await Promise.all(o(a).map(async te=>{q[te]=(await Wc(te)).length})),P(s,q,!0),P(i,await pb(),!0),o(l)&&(P(d,(await Wc(o(l))).map(te=>({...te})),!0),P(u,await Ji(o(l)),!0))}yn(()=>{r()&&B()}),yn(()=>{o(l)?Y():(P(x,[]),P(k,[]))});function Y(){const q=[],te=[];q.push({id:"trigger",type:"trigger",position:{x:50,y:100},data:{label:o(l),group:o(u)}});let ae="trigger",W=300;o(d).forEach((G,ne)=>{q.push({id:G.id,type:"action",position:{x:W,y:100},data:{cmd:G,onEdit:()=>j(G),onDelete:()=>I(G.id)}}),te.push({id:`e-${ae}-${G.id}`,source:ae,target:G.id,animated:!0,style:"stroke: #666; stroke-width: 2"}),ae=G.id,W+=270}),q.push({id:"add-action",type:"add",position:{x:W,y:135},data:{onClick:()=>{P(m,!0),P(v,null)}}}),te.push({id:`e-${ae}-add-action`,source:ae,target:"add-action",style:"stroke: #444; stroke-width: 2; stroke-dasharray: 4"}),P(x,q),P(k,te)}async function S(q){P(l,q,!0),P(d,(await Wc(q)).map(te=>({...te})),!0),P(u,await Ji(q),!0),P(v,null),P(m,!1)}async function V(q){o(l)&&(await hb(o(l),q),P(u,q,!0),Y())}function K(q){return q.split("_").map(te=>te.charAt(0)+te.slice(1).toLowerCase()).join(" ")}function O(q){return`hsl(${Ql(q)}, 55%, 55%)`}async function J(){const q=o(h).trim();if(!q)return;await gb(q),P(h,""),P(p,!1),await B();const te=q.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await S(te)}async function ie(){o(l)&&(await yb(o(l)),P(l,null),P(d,[],!0),await B())}async function ke(q,te){await Qf(o(l),{id:q.actionId,pluginId:te,commandId:q.actionId,name:q.name,description:q.description,icon:D[q.actionId]||void 0}),P(m,!1),await B()}function F(q){return o(d).some(te=>te.id===q)}async function I(q){await wb(o(l),q),await B()}function j(q){P(m,!1),P(v,{...q,pluginCommandKey:q.pluginId&&q.commandId?`${q.pluginId}:${q.commandId}`:""},!0)}async function C(){o(v)&&(await kb(o(l),o(v).id,{name:o(v).name,description:o(v).description,icon:o(v).icon,pluginId:o(v).pluginId,commandId:o(v).commandId}),P(v,null),await B())}function N(){P(v,null)}async function M(){const q=`custom_${Date.now()}`;await Qf(o(l),{id:q,pluginId:"",commandId:"",name:"New Custom Action",description:"",icon:"â¡"}),P(m,!1),await B();const te=o(d).find(ae=>ae.id===q);te&&j(te)}var $=an(),H=Xe($);{var L=q=>{var te=UP(),ae=_(te),W=_(ae),G=b(_(W),4);G.__click=()=>r(!1);var ne=b(W,2),re=_(ne),pe=_(re),ye=b(_(pe),2);ye.__click=()=>P(p,!o(p));var Se=b(pe,2);{var Z=ct=>{var qe=IP(),Oe=_(qe);Oe.__keydown=Ne=>Ne.key==="Enter"&&J();var ze=b(Oe,2);ze.__click=J,Zr(Oe,()=>o(h),Ne=>P(h,Ne)),T(ct,qe)};ce(Se,ct=>{o(p)&&ct(Z)})}var he=b(Se,2);Ot(he,21,()=>o(a),Ut,(ct,qe)=>{var Oe=MP();let ze;Oe.__click=()=>S(o(qe));var Ne=_(Oe);let Fe;var Ke=b(Ne,2),$e=_(Ke),Ze=b(Ke,4);{var Ge=ft=>{const mt=Q(()=>nr[o(i)[o(qe)]]);var vt=an(),St=Xe(vt);{var bt=pt=>{var yt=PP();let dt;var Le=_(yt);se(()=>{kt(yt,"title",o(mt).description),dt=Dt(yt,"",dt,{color:o(mt).color}),ee(Le,o(mt).label)}),T(pt,yt)};ce(St,pt=>{o(mt)&&pt(bt)})}T(ft,vt)};ce(Ze,ft=>{o(i)[o(qe)]&&ft(Ge)})}var tt=b(Ze,2),nt=_(tt);se((ft,mt)=>{ze=xt(Oe,1,"type-item svelte-d25j4l",null,ze,{selected:o(l)===o(qe)}),Fe=Dt(Ne,"",Fe,ft),ee($e,mt),ee(nt,o(s)[o(qe)]??0)},[()=>({background:O(o(qe))}),()=>K(o(qe))]),T(ct,Oe)});var be=b(re,2),Ie=_(be);{var Ye=ct=>{var qe=FP(),Oe=Xe(qe),ze=_(Oe);let Ne;var Fe=_(ze),Ke=b(ze,2),$e=_(Ke),Ze=b(Ke,4);Ot(Ze,21,()=>Object.values(nr),Ut,(bt,pt)=>{var yt=OP();let dt;yt.__click=()=>V(o(pt).id);let Le;var Rt=_(yt);se(()=>{dt=xt(yt,1,"group-chip svelte-d25j4l",null,dt,{active:o(u)===o(pt).id}),kt(yt,"title",o(pt).description),Le=Dt(yt,"",Le,{"--grp-color":o(pt).color}),ee(Rt,o(pt).label)}),T(bt,yt)});var Ge=b(Ze,2);Ge.__click=ie;var tt=b(Oe,2),nt=_(tt);$I(nt,{get nodes(){return o(x)},get edges(){return o(k)},get nodeTypes(){return n},fitView:!0,fitViewOptions:{padding:.2,minZoom:.8},minZoom:.5,maxZoom:1.5,colorMode:"dark",children:(bt,pt)=>{var yt=NP(),dt=Xe(yt);bP(dt,{bgColor:"#111",patternColor:"#333"});var Le=b(dt,2);vP(Le,{showInteractive:!1}),T(bt,yt)},$$slots:{default:!0}});var ft=b(nt,2);{var mt=bt=>{var pt=jP(),yt=_(pt),dt=b(_(yt),2);dt.__click=()=>P(m,!1);var Le=b(yt,2),Rt=_(Le);Ot(Rt,17,()=>E,Ut,(De,Qt)=>{var Gn=LP(),_e=_(Gn),ln=_(_e),En=_(ln),Ct=b(_e,2);Ot(Ct,21,()=>o(Qt).actions,Ut,(Mn,it)=>{const ut=Q(()=>F(o(it).actionId));var Pt=RP();let $t;Pt.__click=()=>ke(o(it),o(Qt).pluginId);var _t=_(Pt),jt=_(_t),fn=b(_t,2),cn=_(fn),Jt=b(fn,2);{var en=jn=>{var On=DP();T(jn,On)};ce(Jt,jn=>{o(ut)&&jn(en)})}se(()=>{$t=xt(Pt,1,"picker-tile svelte-d25j4l",null,$t,{added:o(ut)}),kt(Pt,"title",o(it).description),ee(jt,D[o(it).actionId]??"Â·"),ee(cn,o(it).name)}),T(Mn,Pt)}),se(()=>ee(En,o(Qt).pluginName)),T(De,Gn)});var At=b(Rt,2),Gt=_(At);Gt.__click=M,T(bt,pt)};ce(ft,bt=>{o(m)&&bt(mt)})}var vt=b(ft,2);{var St=bt=>{var pt=BP(),yt=_(pt),dt=b(_(yt),2);dt.__click=N;var Le=b(yt,2),Rt=_(Le),At=_(Rt),Gt=b(At,2),De=b(Rt,2),Qt=b(De,2),Gn=_(Qt);Gn.__change=it=>{if(it.target.value){const[ut,Pt]=it.target.value.split(":");o(v).pluginId=ut,o(v).commandId=Pt}else o(v).pluginId="",o(v).commandId=""};var _e=_(Gn);_e.value=_e.__value="";var ln=b(_e);Ot(ln,17,()=>E,Ut,(it,ut)=>{var Pt=qP();Ot(Pt,21,()=>o(ut).actions,Ut,($t,_t)=>{var jt=zP(),fn=_(jt),cn={};se(()=>{ee(fn,`${o(_t).name??""} (${o(_t).actionId??""})`),cn!==(cn=`${o(ut).pluginId??""}:${o(_t).actionId??""}`)&&(jt.value=jt.__value=`${o(ut).pluginId??""}:${o(_t).actionId??""}`)}),T($t,jt)}),se(()=>kt(Pt,"label",o(ut).pluginName)),T(it,Pt)});var En=b(Qt,2),Ct=_(En);Ct.__click=C;var Mn=b(Ct,2);Mn.__click=N,Zr(At,()=>o(v).icon,it=>o(v).icon=it),Zr(Gt,()=>o(v).name,it=>o(v).name=it),Zr(De,()=>o(v).description,it=>o(v).description=it),pi(Gn,()=>o(v).pluginCommandKey,it=>o(v).pluginCommandKey=it),T(bt,pt)};ce(vt,bt=>{o(v)&&bt(St)})}se((bt,pt)=>{Ne=Dt(ze,"",Ne,bt),ee(Fe,pt),ee($e,`${o(d).length??""} action${o(d).length===1?"":"s"}`)},[()=>({background:O(o(l))}),()=>K(o(l))]),T(ct,qe)},Je=ct=>{var qe=GP(),Oe=_(qe);{var ze=Fe=>{var Ke=KP();T(Fe,Ke)},Ne=Fe=>{var Ke=HP();T(Fe,Ke)};ce(Oe,Fe=>{o(a).length===0?Fe(ze):Fe(Ne,!1)})}T(ct,qe)};ce(Ie,ct=>{o(l)?ct(Ye):ct(Je,!1)})}T(q,te)};ce(H,q=>{r()&&q(L)})}T(t,$),st()}Xt(["click","keydown","change"]);var WP=z('<span class="scope-chip svelte-1e15788"> </span>'),YP=z('<div class="scopes-list svelte-1e15788"></div>'),XP=z('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),ZP=z('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),QP=z('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),JP=z('<div class="empty svelte-1e15788">No plugins registered.</div>'),$P=z('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function e3(t,e){at(e,!0);let n=Ae(e,"open",15,!1);const r=Q(()=>n()?mi.getAllPlugins().map(h=>({id:h.pluginId,name:h.serviceName,actions:h.getHandlers().map(m=>({id:m.actionId,name:m.name,description:m.description,scopes:m.requiredScopes||[]}))})):[]),a={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},s=Q(()=>o(r).reduce((h,m)=>h+m.actions.length,0));let i=Me(Wt(new Set));function l(h){const m=new Set(o(i));m.has(h)?m.delete(h):m.add(h),P(i,m,!0)}function u(h){return h.replace(/^https?:\/\/[^/]+\/auth\//,"")}var d=an(),v=Xe(d);{var p=h=>{var m=$P();m.__keydown=F=>F.key==="Escape"&&n(!1);var x=_(m),k=_(x),E=_(k),D=b(_(E),2),B=b(_(D),2),Y=_(B),S=b(E,2);S.__click=()=>n(!1);var V=b(k,2),K=_(V);Ot(K,17,()=>o(r),Ut,(F,I)=>{var j=QP(),C=_(j),N=_(C),M=_(N),$=_(M),H=b(M,2),L=_(H),q=b(N,2),te=_(q),ae=b(C,2);Ot(ae,21,()=>o(I).actions,Ut,(W,G)=>{const ne=Q(()=>`${o(I).id}:${o(G).id}`),re=Q(()=>o(i).has(o(ne)));var pe=ZP(),ye=_(pe),Se=_(ye),Z=b(ye,2),he=_(Z),be=_(he),Ie=_(be),Ye=b(be,2),Je=_(Ye),ct=b(he,2),qe=_(ct),Oe=b(ct,2);{var ze=Ne=>{var Fe=XP(),Ke=_(Fe);Ke.__click=()=>l(o(ne));var $e=_(Ke);{var Ze=mt=>{var vt=on("â¾");T(mt,vt)},Ge=mt=>{var vt=on("â¸");T(mt,vt)};ce($e,mt=>{o(re)?mt(Ze):mt(Ge,!1)})}var tt=b($e),nt=b(Ke,2);{var ft=mt=>{var vt=YP();Ot(vt,21,()=>o(G).scopes,Ut,(St,bt)=>{var pt=WP(),yt=_(pt);se(dt=>{kt(pt,"title",o(bt)),ee(yt,dt)},[()=>u(o(bt))]),T(St,pt)}),T(mt,vt)};ce(nt,mt=>{o(re)&&mt(ft)})}se(()=>ee(tt,` ${o(G).scopes.length??""} scope${o(G).scopes.length===1?"":"s"}`)),T(Ne,Fe)};ce(Oe,Ne=>{o(G).scopes.length&&Ne(ze)})}se(()=>{kt(ye,"title",o(G).id),ee(Se,a[o(G).id]??"Â·"),ee(Ie,o(G).name),ee(Je,o(G).id),ee(qe,o(G).description)}),T(W,pe)}),se(()=>{ee($,o(I).name),ee(L,o(I).id),ee(te,`${o(I).actions.length??""} action${o(I).actions.length===1?"":"s"}`)}),T(F,j)});var O=b(K,2);{var J=F=>{var I=JP();T(F,I)};ce(O,F=>{o(r).length===0&&F(J)})}var ie=b(V,2),ke=b(_(ie),2);ke.__click=()=>n(!1),se(()=>ee(Y,`${o(r).length??""} plugin${o(r).length===1?"":"s"} Â· ${o(s)??""} actions available`)),T(h,m)};ce(v,h=>{n()&&h(p)})}T(t,d),st()}Xt(["keydown","click"]);var t3=z('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),n3=z('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),r3=z('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),a3=z('<button class="chip svelte-s2dwjj"> </button>'),s3=z('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),i3=z('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),o3=z('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),l3=z('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),c3=z('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),u3=z('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),d3=z('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),f3=z('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),v3=z('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),h3=z('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),p3=z('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),g3=z('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function m3(t,e){at(e,!0);let n=Ae(e,"groupOrder",19,()=>[]),r=Me(!1),a=Me(null),s=Me(!1),i=Me(null);async function l(){var F;const[O,J,ie]=await Promise.all([lt.items.where("sourceType").equals("gmail").count(),lt.emailClassifications.count(),lt.contacts.count()]);let ke=0;try{const I=await((F=navigator.storage)==null?void 0:F.estimate());ke=(I==null?void 0:I.usage)??0}catch{}P(i,{emailCount:O,classCount:J,contactCount:ie,totalBytes:ke},!0)}function u(O){return O?O<1024?`${O} B`:O<1024*1024?`${(O/1024).toFixed(1)} KB`:`${(O/(1024*1024)).toFixed(1)} MB`:"â"}function d(){P(r,!o(r)),o(r)&&l()}async function v(O){var J;P(s,!0),P(a,null);try{await O(),await l(),(J=e.onrefresh)==null||J.call(e)}finally{P(s,!1)}}async function p(){await v(()=>Jf())}async function h(O){await v(()=>Ad(O))}async function m(){await v(async()=>{await Jp(),await Jf()})}async function x(){await v(()=>lt.contacts.clear())}async function k(){await v(async()=>{await lt.delete(),window.location.reload()})}function E(O){return O.split("_").map(J=>J.charAt(0)+J.slice(1).toLowerCase()).join(" ")}var D=g3(),B=_(D);B.__click=d;var Y=b(_(B),2);let S;var V=b(B,2);{var K=O=>{var J=p3(),ie=_(J);{var ke=Z=>{var he=n3(),be=_(he),Ie=_(be),Ye=b(be,4),Je=_(Ye),ct=b(Ye,4),qe=_(ct),Oe=b(ct,2);{var ze=Ne=>{var Fe=t3(),Ke=b(Xe(Fe),2),$e=_(Ke);se(Ze=>ee($e,`${Ze??""} used`),[()=>u(o(i).totalBytes)]),T(Ne,Fe)};ce(Oe,Ne=>{o(i).totalBytes&&Ne(ze)})}se(()=>{ee(Ie,`${o(i).emailCount??""} emails`),ee(Je,`${o(i).classCount??""} classifications`),ee(qe,`${o(i).contactCount??""} contacts`)}),T(Z,he)};ce(ie,Z=>{o(i)&&Z(ke)})}var F=b(ie,2);{var I=Z=>{var he=s3(),be=b(_(he),2);Ot(be,21,n,Ut,(Ie,Ye)=>{var Je=an(),ct=Xe(Je);{var qe=ze=>{var Ne=r3(),Fe=_(Ne),Ke=b(Fe);Ke.__click=()=>P(a,null);var $e=b(Ke,2);$e.__click=()=>h(o(Ye)),se(Ze=>{ee(Fe,`Delete ${Ze??""}? `),$e.disabled=o(s)},[()=>E(o(Ye))]),T(ze,Ne)},Oe=ze=>{var Ne=a3();Ne.__click=()=>P(a,`group:${o(Ye)}`);var Fe=_(Ne);se(Ke=>{Ne.disabled=o(s),ee(Fe,`${Ke??""} â`)},[()=>E(o(Ye))]),T(ze,Ne)};ce(ct,ze=>{o(a)===`group:${o(Ye)}`?ze(qe):ze(Oe,!1)})}T(Ie,Je)}),T(Z,he)};ce(F,Z=>{n().length>0&&Z(I)})}var j=b(F,2),C=b(_(j),2),N=_(C);{var M=Z=>{var he=i3(),be=b(_(he),2);be.__click=()=>P(a,null);var Ie=b(be,2);Ie.__click=p,se(()=>Ie.disabled=o(s)),T(Z,he)},$=Z=>{var he=o3();he.__click=()=>P(a,"classifications"),se(()=>he.disabled=o(s)),T(Z,he)};ce(N,Z=>{o(a)==="classifications"?Z(M):Z($,!1)})}var H=b(N,2);{var L=Z=>{var he=l3(),be=b(_(he),2);be.__click=()=>P(a,null);var Ie=b(be,2);Ie.__click=m,se(()=>Ie.disabled=o(s)),T(Z,he)},q=Z=>{var he=c3();he.__click=()=>P(a,"emails"),se(()=>he.disabled=o(s)),T(Z,he)};ce(H,Z=>{o(a)==="emails"?Z(L):Z(q,!1)})}var te=b(H,2);{var ae=Z=>{var he=u3(),be=b(_(he),2);be.__click=()=>P(a,null);var Ie=b(be,2);Ie.__click=x,se(()=>Ie.disabled=o(s)),T(Z,he)},W=Z=>{var he=d3();he.__click=()=>P(a,"contacts"),se(()=>he.disabled=o(s)),T(Z,he)};ce(te,Z=>{o(a)==="contacts"?Z(ae):Z(W,!1)})}var G=b(j,2),ne=_(G);{var re=Z=>{var he=f3(),be=b(_(he),2);be.__click=()=>P(a,null);var Ie=b(be,2);Ie.__click=k,se(()=>Ie.disabled=o(s)),T(Z,he)},pe=Z=>{var he=v3();he.__click=()=>P(a,"nuke"),se(()=>he.disabled=o(s)),T(Z,he)};ce(ne,Z=>{o(a)==="nuke"?Z(re):Z(pe,!1)})}var ye=b(G,2);{var Se=Z=>{var he=h3();T(Z,he)};ce(ye,Z=>{o(s)&&Z(Se)})}T(O,J)};ce(V,O=>{o(r)&&O(K)})}se(()=>S=xt(Y,0,"chev svelte-s2dwjj",null,S,{open:o(r)})),T(t,D),st()}Xt(["click"]);var y3=z('<div class="error-card svelte-aym646"><span> </span> <button class="error-dismiss svelte-aym646">â</button></div>'),_3=z('<div class="success-card svelte-aym646"><span> </span> <button class="success-dismiss svelte-aym646">â</button></div>'),b3=z('<div class="groups-list svelte-aym646"></div> <div class="actions-footer svelte-aym646"><span class="footer-stat svelte-aym646"> </span></div>',1),w3=z('<div class="empty-state svelte-aym646"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-aym646">No emails classified yet</h3> <p class="svelte-aym646">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),x3=z('<div class="actions-container svelte-aym646"><!> <!> <!> <!> <div class="toolbar svelte-aym646"><button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-aym646"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-aym646"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!> <!></div>');function k3(t,e){at(e,!0);let n=Ae(e,"groups",19,()=>({})),r=Ae(e,"groupOrder",19,()=>[]),a=Ae(e,"counts",19,()=>({})),s=Ae(e,"stats",3,null),i=Ae(e,"expandedGroup",3,null),l=Ae(e,"isScanning",3,!1),u=Ae(e,"scanProgress",3,null),d=Ae(e,"scanCount",15,20),v=Ae(e,"error",3,null),p=Ae(e,"successMsg",3,null),h=Me(!1),m=Me(!1),x=Me(!1),k=Q(()=>{for(const M of r()){const $=n()[M];if(($==null?void 0:$.length)>0)return $[0]}return null});var E=x3(),D=_(E);I2(D,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return l()},get scanProgress(){return u()},get stats(){return s()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>P(h,!0),get scanCount(){return d()},set scanCount(M){d(M)}});var B=b(D,2);$2(B,{get sampleEmail(){return o(k)},get open(){return o(h)},set open(M){P(h,M,!0)}});var Y=b(B,2);VP(Y,{get open(){return o(m)},set open(M){P(m,M,!0)}});var S=b(Y,2);e3(S,{get open(){return o(x)},set open(M){P(x,M,!0)}});var V=b(S,2),K=_(V);K.__click=()=>P(x,!0);var O=b(K,2);O.__click=()=>P(m,!0);var J=b(V,2);{var ie=M=>{var $=y3(),H=_($),L=_(H),q=b(H,2);q.__click=function(...te){var ae;(ae=e.ondismisserror)==null||ae.apply(this,te)},se(()=>ee(L,v())),T(M,$)};ce(J,M=>{v()&&M(ie)})}var ke=b(J,2);{var F=M=>{var $=_3(),H=_($),L=_(H),q=b(H,2);q.__click=function(...te){var ae;(ae=e.ondismisssuccess)==null||ae.apply(this,te)},se(()=>ee(L,p())),T(M,$)};ce(ke,M=>{p()&&M(F)})}var I=b(ke,2);{var j=M=>{var $=b3(),H=Xe($);Ot(H,20,r,ae=>ae,(ae,W)=>{{let G=Q(()=>Mu(W)),ne=Q(()=>{var ye;return((ye=n()[W])==null?void 0:ye.length)||0}),re=Q(()=>n()[W]||[]),pe=Q(()=>i()===W);Y2(ae,{get action(){return W},get color(){return o(G)},get count(){return o(ne)},get items(){return o(re)},get expanded(){return o(pe)},ontoggle:()=>e.ontogglegroup(W),onexecute:ye=>e.onexecute(W,ye),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(W)})}});var L=b(H,2),q=_(L),te=_(q);se(()=>ee(te,`${a().total??""} emails classified into ${r().length??""} groups`)),T(M,$)},C=M=>{var $=w3();T(M,$)};ce(I,M=>{a().total>0?M(j):l()||M(C,1)})}var N=b(I,2);m3(N,{get groupOrder(){return r()},get onrefresh(){return e.onrefresh}}),T(t,E),st()}Xt(["click"]);var S3=z('<div class="control-board-page svelte-v2lwbo"><!></div>');function E3(t,e){at(e,!0);const n=Ep();let r=Me(Wt(n.status)),a=Me(""),s=Me(Wt({})),i=Me(Wt([])),l=Me(Wt({total:0})),u=Me(null),d=Me(null),v=Me(!1),p=Me(null),h=Me(3),m=Me(null),x=Me(null),k=Me(null);const E="me-ai-scan-history";async function D(){return await Qr(E)}async function B(M){!M||M.phase!=="done"||await ii(E,{timestamp:Date.now(),classified:M.classified||0,errors:M.errors||0,total:M.total||0,totals:M.totals||{},summary:M.summary||{}})}_n(async()=>{const M=n.onMessage(H=>{if(H.status==="ready"){P(r,"ready");const L=ea.find(ae=>ae.id===n.modelId),q=ta.find(ae=>ae.name===n.modelId),te=L||q;P(a,(te==null?void 0:te.name)||(te==null?void 0:te.displayName)||n.modelId||"",!0)}H.status==="loading"&&P(r,"loading")});if(P(r,n.status,!0),n.modelId){const H=ea.find(te=>te.id===n.modelId),L=ta.find(te=>te.name===n.modelId),q=H||L;P(a,(q==null?void 0:q.name)||(q==null?void 0:q.displayName)||n.modelId||"",!0)}const $=await D();return $&&P(p,{phase:"done",...$},!0),Y(),()=>M()});async function Y(){try{const M=await Hp();P(s,M.groups,!0),P(i,M.order,!0),P(l,await Rb(),!0),P(u,await Pu(),!0)}catch(M){P(m,`Failed to load data: ${M.message}`)}}async function S(){await K(!1)}async function V(){await K(!0)}async function K(M){if(o(v)||!n.isReady)return;P(m,null),P(x,null),P(v,!0),P(p,null);const $=new AbortController;P(k,$,!0);try{await Kp(n,{count:o(h),force:M,signal:$.signal,onProgress:H=>{P(p,{...H},!0),H.phase==="done"&&B(H)}}),await Y()}catch(H){$.signal.aborted||P(m,`Scan failed: ${H.message}`)}finally{P(v,!1),P(k,null)}}function O(){var M;(M=o(k))==null||M.abort()}async function J(M){await Sl(M,"acted"),await Y()}async function ie(M,$){const{executePipeline:H,isAuthenticated:L}=await Ln(async()=>{const{executePipeline:q,isAuthenticated:te}=await Promise.resolve().then(()=>ew);return{executePipeline:q,isAuthenticated:te}},void 0);if(!await L()){alert("Please sign in to Gmail first (Dashboard page)");return}try{const te=await H({type:M,source:"gmail",data:$},ae=>{console.log("Pipeline progress:",ae)},!0);te.success?(P(x,te.message,!0),P(m,null),await J($.emailId)):(P(m,`Execution failed: ${te.message}`),P(x,null))}catch(q){P(m,`Execution error: ${q.message}`),P(x,null)}}async function ke(M){await Sl(M,"dismissed"),await Y()}async function F(M){await Gp(M),await Y()}async function I(M){await Ad(M),await Y()}function j(M){P(d,o(d)===M?null:M,!0)}var C=S3(),N=_(C);k3(N,{get engineStatus(){return o(r)},get modelName(){return o(a)},get groups(){return o(s)},get groupOrder(){return o(i)},get counts(){return o(l)},get stats(){return o(u)},get expandedGroup(){return o(d)},get isScanning(){return o(v)},get scanProgress(){return o(p)},get error(){return o(m)},get successMsg(){return o(x)},onscan:S,onrescan:V,ontogglegroup:j,onexecute:ie,onmarkacted:J,ondismiss:ke,onremove:F,oncleargroup:I,ondismisserror:()=>P(m,null),ondismisssuccess:()=>P(x,null),onstop:O,onrefresh:Y,oncloseprogress:async()=>{P(p,null),await _d(E)},get scanCount(){return o(h)},set scanCount(M){P(h,M,!0)}}),T(t,C),st()}var A3=z('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#control">Control Board</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function T3(t,e){at(e,!0);function n(){const O=location.hash;return O==="#dashboard"?"dashboard":O==="#control"?"control":"chat"}let r=Me(Wt(n()));_n(()=>{function O(){P(r,n(),!0)}return window.addEventListener("hashchange",O),()=>window.removeEventListener("hashchange",O)});var a=A3(),s=_(a),i=b(_(s),2),l=_(i);let u;var d=b(l,2);let v;var p=b(d,2);let h;var m=b(s,2),x=_(m);let k;var E=_(x);x1(E,{});var D=b(x,2);let B;var Y=_(D);E3(Y,{});var S=b(D,2);let V;var K=_(S);$k(K,{}),se(()=>{u=xt(l,1,"svelte-1n46o8q",null,u,{active:o(r)==="chat"}),v=xt(d,1,"svelte-1n46o8q",null,v,{active:o(r)==="control"}),h=xt(p,1,"svelte-1n46o8q",null,h,{active:o(r)==="dashboard"}),k=Dt(x,"",k,{display:o(r)==="chat"?"flex":"none"}),B=Dt(D,"",B,{display:o(r)==="control"?"flex":"none"}),V=Dt(S,"",V,{display:o(r)==="dashboard"?"flex":"none"})}),T(t,a),st()}l_(T3,{target:document.getElementById("app")});
