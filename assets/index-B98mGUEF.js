var dv=Object.defineProperty;var oc=t=>{throw TypeError(t)};var vv=(t,e,n)=>e in t?dv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var bt=(t,e,n)=>vv(t,typeof e!="symbol"?e+"":e,n),ho=(t,e,n)=>e.has(t)||oc("Cannot "+n);var _e=(t,e,n)=>(ho(t,e,"read from private field"),n?n.call(t):e.get(t)),wt=(t,e,n)=>e.has(t)?oc("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),gt=(t,e,n,a)=>(ho(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),Sn=(t,e,n)=>(ho(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Oo=!1;var nl=Array.isArray,fv=Array.prototype.indexOf,Ja=Array.prototype.includes,Oi=Array.from,pv=Object.defineProperty,Ga=Object.getOwnPropertyDescriptor,hv=Object.getOwnPropertyDescriptors,mv=Object.prototype,gv=Array.prototype,nu=Object.getPrototypeOf,lc=Object.isExtensible;const _v=()=>{};function yv(t){for(var e=0;e<t.length;e++)t[e]()}function ru(){var t,e,n=new Promise((a,s)=>{t=a,e=s});return{promise:n,resolve:t,reject:e}}const bn=2,Rs=4,Ri=8,au=1<<24,Gr=16,yr=32,Da=64,su=128,ar=512,hn=1024,wn=2048,_r=4096,Qn=8192,Ur=16384,zs=32768,$a=65536,cc=1<<17,iu=1<<18,as=1<<19,bv=1<<20,Fr=1<<25,Ca=65536,Ro=1<<21,rl=1<<22,ta=1<<23,Ta=Symbol("$state"),wv=Symbol("legacy props"),kv=Symbol(""),ga=new class extends Error{constructor(){super(...arguments);bt(this,"name","StaleReactionError");bt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function xv(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Sv(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ev(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function Tv(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Av(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Iv(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Cv(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Pv(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ov(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Rv(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Mv(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function jv(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Dv=1,Lv=2,ou=4,Nv=8,qv=16,Bv=1,Fv=4,zv=8,Uv=16,lu=1,Kv=2,gn=Symbol(),cu="http://www.w3.org/1999/xhtml";function Gv(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Hv(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function uu(t){return t===this.v}function Wv(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function du(t){return!Wv(t,this.v)}let Vv=!1,Xn=null;function es(t){Xn=t}function jt(t,e=!1,n){Xn={p:Xn,i:!1,c:null,e:null,s:t,x:null,l:null}}function Dt(t){var e=Xn,n=e.e;if(n!==null){e.e=null;for(var a of n)Mu(a)}return t!==void 0&&(e.x=t),e.i=!0,Xn=e.p,t??{}}function vu(){return!0}let _a=[];function fu(){var t=_a;_a=[],yv(t)}function na(t){if(_a.length===0&&!As){var e=_a;queueMicrotask(()=>{e===_a&&fu()})}_a.push(t)}function Yv(){for(;_a.length>0;)fu()}function pu(t){var e=Kt;if(e===null)return kt.f|=ta,t;if((e.f&zs)===0&&(e.f&Rs)===0)throw t;ts(t,e)}function ts(t,e){for(;e!==null;){if((e.f&su)!==0){if((e.f&zs)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const Qv=-7169;function un(t,e){t.f=t.f&Qv|e}function al(t){(t.f&ar)!==0||t.deps===null?un(t,hn):un(t,_r)}function hu(t){if(t!==null)for(const e of t)(e.f&bn)===0||(e.f&Ca)===0||(e.f^=Ca,hu(e.deps))}function mu(t,e,n){(t.f&wn)!==0?e.add(t):(t.f&_r)!==0&&n.add(t),hu(t.deps),un(t,hn)}const li=new Set;let pt=null,ki=null,_n=null,zn=[],Mi=null,Mo=!1,As=!1;var Ha,Wa,ba,Va,Ns,qs,wa,Lr,Ya,Rr,jo,Do,gu;const Ml=class Ml{constructor(){wt(this,Rr);bt(this,"committed",!1);bt(this,"current",new Map);bt(this,"previous",new Map);wt(this,Ha,new Set);wt(this,Wa,new Set);wt(this,ba,0);wt(this,Va,0);wt(this,Ns,null);wt(this,qs,new Set);wt(this,wa,new Set);wt(this,Lr,new Map);bt(this,"is_fork",!1);wt(this,Ya,!1)}is_deferred(){return this.is_fork||_e(this,Va)>0}skip_effect(e){_e(this,Lr).has(e)||_e(this,Lr).set(e,{d:[],m:[]})}unskip_effect(e){var n=_e(this,Lr).get(e);if(n){_e(this,Lr).delete(e);for(var a of n.d)un(a,wn),hr(a);for(a of n.m)un(a,_r),hr(a)}}process(e){var s;zn=[],this.apply();var n=[],a=[];for(const o of e)Sn(this,Rr,jo).call(this,o,n,a);if(this.is_deferred()){Sn(this,Rr,Do).call(this,a),Sn(this,Rr,Do).call(this,n);for(const[o,u]of _e(this,Lr))wu(o,u)}else{for(const o of _e(this,Ha))o();_e(this,Ha).clear(),_e(this,ba)===0&&Sn(this,Rr,gu).call(this),ki=this,pt=null,uc(a),uc(n),ki=null,(s=_e(this,Ns))==null||s.resolve()}_n=null}capture(e,n){n!==gn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&ta)===0&&(this.current.set(e,e.v),_n==null||_n.set(e,e.v))}activate(){pt=this,this.apply()}deactivate(){pt===this&&(pt=null,_n=null)}flush(){if(this.activate(),zn.length>0){if(_u(),pt!==null&&pt!==this)return}else _e(this,ba)===0&&this.process([]);this.deactivate()}discard(){for(const e of _e(this,Wa))e(this);_e(this,Wa).clear()}increment(e){gt(this,ba,_e(this,ba)+1),e&&gt(this,Va,_e(this,Va)+1)}decrement(e){gt(this,ba,_e(this,ba)-1),e&&gt(this,Va,_e(this,Va)-1),!_e(this,Ya)&&(gt(this,Ya,!0),na(()=>{gt(this,Ya,!1),this.is_deferred()?zn.length>0&&this.flush():this.revive()}))}revive(){for(const e of _e(this,qs))_e(this,wa).delete(e),un(e,wn),hr(e);for(const e of _e(this,wa))un(e,_r),hr(e);this.flush()}oncommit(e){_e(this,Ha).add(e)}ondiscard(e){_e(this,Wa).add(e)}settled(){return(_e(this,Ns)??gt(this,Ns,ru())).promise}static ensure(){if(pt===null){const e=pt=new Ml;li.add(pt),As||na(()=>{pt===e&&e.flush()})}return pt}apply(){}};Ha=new WeakMap,Wa=new WeakMap,ba=new WeakMap,Va=new WeakMap,Ns=new WeakMap,qs=new WeakMap,wa=new WeakMap,Lr=new WeakMap,Ya=new WeakMap,Rr=new WeakSet,jo=function(e,n,a){e.f^=hn;for(var s=e.first,o=null;s!==null;){var u=s.f,d=(u&(yr|Da))!==0,g=d&&(u&hn)!==0,m=g||(u&Qn)!==0||_e(this,Lr).has(s);if(!m&&s.fn!==null){d?s.f^=hn:o!==null&&(u&(Rs|Ri|au))!==0?o.b.defer_effect(s):(u&Rs)!==0?n.push(s):Ks(s)&&((u&Gr)!==0&&_e(this,wa).add(s),rs(s));var _=s.first;if(_!==null){s=_;continue}}var x=s.parent;for(s=s.next;s===null&&x!==null;)x===o&&(o=null),s=x.next,x=x.parent}},Do=function(e){for(var n=0;n<e.length;n+=1)mu(e[n],_e(this,qs),_e(this,wa))},gu=function(){var s;if(li.size>1){this.previous.clear();var e=_n,n=!0;for(const o of li){if(o===this){n=!1;continue}const u=[];for(const[g,m]of this.current){if(o.current.has(g))if(n&&m!==o.current.get(g))o.current.set(g,m);else continue;u.push(g)}if(u.length===0)continue;const d=[...o.current.keys()].filter(g=>!this.current.has(g));if(d.length>0){var a=zn;zn=[];const g=new Set,m=new Map;for(const _ of u)yu(_,d,g,m);if(zn.length>0){pt=o,o.apply();for(const _ of zn)Sn(s=o,Rr,jo).call(s,_,[],[]);o.deactivate()}zn=a}}pt=null,_n=e}this.committed=!0,li.delete(this)};let ra=Ml;function Xv(t){var e=As;As=!0;try{for(var n;;){if(Yv(),zn.length===0&&(pt==null||pt.flush(),zn.length===0))return Mi=null,n;_u()}}finally{As=e}}function _u(){Mo=!0;var t=null;try{for(var e=0;zn.length>0;){var n=ra.ensure();if(e++>1e3){var a,s;Zv()}n.process(zn),aa.clear()}}finally{zn=[],Mo=!1,Mi=null}}function Zv(){try{Cv()}catch(t){ts(t,Mi)}}let ur=null;function uc(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Ur|Qn))===0&&Ks(a)&&(ur=new Set,rs(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&Nu(a),(ur==null?void 0:ur.size)>0)){aa.clear();for(const s of ur){if((s.f&(Ur|Qn))!==0)continue;const o=[s];let u=s.parent;for(;u!==null;)ur.has(u)&&(ur.delete(u),o.push(u)),u=u.parent;for(let d=o.length-1;d>=0;d--){const g=o[d];(g.f&(Ur|Qn))===0&&rs(g)}}ur.clear()}}ur=null}}function yu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const o=s.f;(o&bn)!==0?yu(s,e,n,a):(o&(rl|Gr))!==0&&(o&wn)===0&&bu(s,e,a)&&(un(s,wn),hr(s))}}function bu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const s of t.deps){if(Ja.call(e,s))return!0;if((s.f&bn)!==0&&bu(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function hr(t){for(var e=Mi=t;e.parent!==null;){e=e.parent;var n=e.f;if(Mo&&e===Kt&&(n&Gr)!==0&&(n&iu)===0)return;if((n&(Da|yr))!==0){if((n&hn)===0)return;e.f^=hn}}zn.push(e)}function wu(t,e){if(!((t.f&yr)!==0&&(t.f&hn)!==0)){(t.f&wn)!==0?e.d.push(t):(t.f&_r)!==0&&e.m.push(t),un(t,hn);for(var n=t.first;n!==null;)wu(n,e),n=n.next}}function Jv(t){let e=0,n=Pa(0),a;return()=>{ol()&&(l(n),ll(()=>(e===0&&(a=Gs(()=>t(()=>Is(n)))),e+=1,()=>{na(()=>{e-=1,e===0&&(a==null||a(),a=void 0,Is(n))})})))}}var $v=$a|as|su;function ef(t,e,n){new tf(t,e,n)}var tr,tl,Sr,ka,Er,nr,Bn,Tr,Nr,$r,xa,ea,Qa,Sa,Xa,Za,qr,Ci,mn,nf,rf,Lo,mi,gi,No;class tf{constructor(e,n,a){wt(this,mn);bt(this,"parent");bt(this,"is_pending",!1);wt(this,tr);wt(this,tl,null);wt(this,Sr);wt(this,ka);wt(this,Er);wt(this,nr,null);wt(this,Bn,null);wt(this,Tr,null);wt(this,Nr,null);wt(this,$r,null);wt(this,xa,0);wt(this,ea,0);wt(this,Qa,!1);wt(this,Sa,!1);wt(this,Xa,new Set);wt(this,Za,new Set);wt(this,qr,null);wt(this,Ci,Jv(()=>(gt(this,qr,Pa(_e(this,xa))),()=>{gt(this,qr,null)})));gt(this,tr,e),gt(this,Sr,n),gt(this,ka,a),this.parent=Kt.b,this.is_pending=!!_e(this,Sr).pending,gt(this,Er,cl(()=>{Kt.b=this;{var s=Sn(this,mn,Lo).call(this);try{gt(this,nr,rr(()=>a(s)))}catch(o){this.error(o)}_e(this,ea)>0?Sn(this,mn,gi).call(this):this.is_pending=!1}return()=>{var o;(o=_e(this,$r))==null||o.remove()}},$v))}defer_effect(e){mu(e,_e(this,Xa),_e(this,Za))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!_e(this,Sr).pending}update_pending_count(e){Sn(this,mn,No).call(this,e),gt(this,xa,_e(this,xa)+e),!(!_e(this,qr)||_e(this,Qa))&&(gt(this,Qa,!0),na(()=>{gt(this,Qa,!1),_e(this,qr)&&ns(_e(this,qr),_e(this,xa))}))}get_effect_pending(){return _e(this,Ci).call(this),l(_e(this,qr))}error(e){var n=_e(this,Sr).onerror;let a=_e(this,Sr).failed;if(_e(this,Sa)||!n&&!a)throw e;_e(this,nr)&&(Kn(_e(this,nr)),gt(this,nr,null)),_e(this,Bn)&&(Kn(_e(this,Bn)),gt(this,Bn,null)),_e(this,Tr)&&(Kn(_e(this,Tr)),gt(this,Tr,null));var s=!1,o=!1;const u=()=>{if(s){Hv();return}s=!0,o&&jv(),ra.ensure(),gt(this,xa,0),_e(this,Tr)!==null&&Aa(_e(this,Tr),()=>{gt(this,Tr,null)}),this.is_pending=this.has_pending_snippet(),gt(this,nr,Sn(this,mn,mi).call(this,()=>(gt(this,Sa,!1),rr(()=>_e(this,ka).call(this,_e(this,tr)))))),_e(this,ea)>0?Sn(this,mn,gi).call(this):this.is_pending=!1};na(()=>{try{o=!0,n==null||n(e,u),o=!1}catch(d){ts(d,_e(this,Er)&&_e(this,Er).parent)}a&&gt(this,Tr,Sn(this,mn,mi).call(this,()=>{ra.ensure(),gt(this,Sa,!0);try{return rr(()=>{a(_e(this,tr),()=>e,()=>u)})}catch(d){return ts(d,_e(this,Er).parent),null}finally{gt(this,Sa,!1)}}))})}}tr=new WeakMap,tl=new WeakMap,Sr=new WeakMap,ka=new WeakMap,Er=new WeakMap,nr=new WeakMap,Bn=new WeakMap,Tr=new WeakMap,Nr=new WeakMap,$r=new WeakMap,xa=new WeakMap,ea=new WeakMap,Qa=new WeakMap,Sa=new WeakMap,Xa=new WeakMap,Za=new WeakMap,qr=new WeakMap,Ci=new WeakMap,mn=new WeakSet,nf=function(){try{gt(this,nr,rr(()=>_e(this,ka).call(this,_e(this,tr))))}catch(e){this.error(e)}},rf=function(){const e=_e(this,Sr).pending;e&&(gt(this,Bn,rr(()=>e(_e(this,tr)))),na(()=>{var n=Sn(this,mn,Lo).call(this);gt(this,nr,Sn(this,mn,mi).call(this,()=>(ra.ensure(),rr(()=>_e(this,ka).call(this,n))))),_e(this,ea)>0?Sn(this,mn,gi).call(this):(Aa(_e(this,Bn),()=>{gt(this,Bn,null)}),this.is_pending=!1)}))},Lo=function(){var e=_e(this,tr);return this.is_pending&&(gt(this,$r,Kr()),_e(this,tr).before(_e(this,$r)),e=_e(this,$r)),e},mi=function(e){var n=Kt,a=kt,s=Xn;Pr(_e(this,Er)),ir(_e(this,Er)),es(_e(this,Er).ctx);try{return e()}catch(o){return pu(o),null}finally{Pr(n),ir(a),es(s)}},gi=function(){const e=_e(this,Sr).pending;_e(this,nr)!==null&&(gt(this,Nr,document.createDocumentFragment()),_e(this,Nr).append(_e(this,$r)),Fu(_e(this,nr),_e(this,Nr))),_e(this,Bn)===null&&gt(this,Bn,rr(()=>e(_e(this,tr))))},No=function(e){var n;if(!this.has_pending_snippet()){this.parent&&Sn(n=this.parent,mn,No).call(n,e);return}if(gt(this,ea,_e(this,ea)+e),_e(this,ea)===0){this.is_pending=!1;for(const a of _e(this,Xa))un(a,wn),hr(a);for(const a of _e(this,Za))un(a,_r),hr(a);_e(this,Xa).clear(),_e(this,Za).clear(),_e(this,Bn)&&Aa(_e(this,Bn),()=>{gt(this,Bn,null)}),_e(this,Nr)&&(_e(this,tr).before(_e(this,Nr)),gt(this,Nr,null))}};function af(t,e,n,a){const s=ji;var o=t.filter(b=>!b.settled);if(n.length===0&&o.length===0){a(e.map(s));return}var u=pt,d=Kt,g=sf(),m=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(b=>b.promise)):null;function _(b){g();try{a(b)}catch(w){(d.f&Ur)===0&&ts(w,d)}u==null||u.deactivate(),qo()}if(n.length===0){m.then(()=>_(e.map(s)));return}function x(){g(),Promise.all(n.map(b=>of(b))).then(b=>_([...e.map(s),...b])).catch(b=>ts(b,d))}m?m.then(x):x()}function sf(){var t=Kt,e=kt,n=Xn,a=pt;return function(o=!0){Pr(t),ir(e),es(n),o&&(a==null||a.activate())}}function qo(){Pr(null),ir(null),es(null)}function ji(t){var e=bn|wn,n=kt!==null&&(kt.f&bn)!==0?kt:null;return Kt!==null&&(Kt.f|=as),{ctx:Xn,deps:null,effects:null,equals:uu,f:e,fn:t,reactions:null,rv:0,v:gn,wv:0,parent:n??Kt,ac:null}}function of(t,e,n){let a=Kt;a===null&&Sv();var s=a.b,o=void 0,u=Pa(gn),d=!kt,g=new Map;return wf(()=>{var w;var m=ru();o=m.promise;try{Promise.resolve(t()).then(m.resolve,m.reject).then(()=>{_===pt&&_.committed&&_.deactivate(),qo()})}catch(I){m.reject(I),qo()}var _=pt;if(d){var x=s.is_rendered();s.update_pending_count(1),_.increment(x),(w=g.get(_))==null||w.reject(ga),g.delete(_),g.set(_,m)}const b=(I,L=void 0)=>{if(_.activate(),L)L!==ga&&(u.f|=ta,ns(u,L));else{(u.f&ta)!==0&&(u.f^=ta),ns(u,I);for(const[O,se]of g){if(g.delete(O),O===_)break;se.reject(ga)}}d&&(s.update_pending_count(-1),_.decrement(x))};m.promise.then(b,I=>b(null,I||"unknown"))}),Ru(()=>{for(const m of g.values())m.reject(ga)}),new Promise(m=>{function _(x){function b(){x===o?m(u):_(o)}x.then(b,b)}_(o)})}function it(t){const e=ji(t);return zu(e),e}function ku(t){const e=ji(t);return e.equals=du,e}function lf(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Kn(e[n])}}function cf(t){for(var e=t.parent;e!==null;){if((e.f&bn)===0)return(e.f&Ur)===0?e:null;e=e.parent}return null}function sl(t){var e,n=Kt;Pr(cf(t));try{t.f&=~Ca,lf(t),e=Hu(t)}finally{Pr(n)}return e}function xu(t){var e=sl(t);if(!t.equals(e)&&(t.wv=Ku(),(!(pt!=null&&pt.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){un(t,hn);return}sa||(_n!==null?(ol()||pt!=null&&pt.is_fork)&&_n.set(t,e):al(t))}function uf(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(ga),a.teardown=_v,a.ac=null,Ms(a,0),ul(a))}function Su(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&rs(e)}let Bo=new Set;const aa=new Map;let Eu=!1;function Pa(t,e){var n={f:0,v:t,reactions:null,equals:uu,rv:0,wv:0};return n}function Oe(t,e){const n=Pa(t);return zu(n),n}function df(t,e=!1,n=!0){const a=Pa(t);return e||(a.equals=du),a}function A(t,e,n=!1){kt!==null&&(!mr||(kt.f&cc)!==0)&&vu()&&(kt.f&(bn|Gr|rl|cc))!==0&&(sr===null||!Ja.call(sr,t))&&Mv();let a=n?Vt(e):e;return ns(t,a)}function ns(t,e){if(!t.equals(e)){var n=t.v;sa?aa.set(t,e):aa.set(t,n),t.v=e;var a=ra.ensure();if(a.capture(t,n),(t.f&bn)!==0){const s=t;(t.f&wn)!==0&&sl(s),al(s)}t.wv=Ku(),Tu(t,wn),Kt!==null&&(Kt.f&hn)!==0&&(Kt.f&(yr|Da))===0&&(er===null?xf([t]):er.push(t)),!a.is_fork&&Bo.size>0&&!Eu&&vf()}return e}function vf(){Eu=!1;for(const t of Bo)(t.f&hn)!==0&&un(t,_r),Ks(t)&&rs(t);Bo.clear()}function Is(t){A(t,t.v+1)}function Tu(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,s=0;s<a;s++){var o=n[s],u=o.f,d=(u&wn)===0;if(d&&un(o,e),(u&bn)!==0){var g=o;_n==null||_n.delete(g),(u&Ca)===0&&(u&ar&&(o.f|=Ca),Tu(g,_r))}else d&&((u&Gr)!==0&&ur!==null&&ur.add(o),hr(o))}}function Vt(t){if(typeof t!="object"||t===null||Ta in t)return t;const e=nu(t);if(e!==mv&&e!==gv)return t;var n=new Map,a=nl(t),s=Oe(0),o=Ia,u=d=>{if(Ia===o)return d();var g=kt,m=Ia;ir(null),hc(o);var _=d();return ir(g),hc(m),_};return a&&n.set("length",Oe(t.length)),new Proxy(t,{defineProperty(d,g,m){(!("value"in m)||m.configurable===!1||m.enumerable===!1||m.writable===!1)&&Ov();var _=n.get(g);return _===void 0?u(()=>{var x=Oe(m.value);return n.set(g,x),x}):A(_,m.value,!0),!0},deleteProperty(d,g){var m=n.get(g);if(m===void 0){if(g in d){const _=u(()=>Oe(gn));n.set(g,_),Is(s)}}else A(m,gn),Is(s);return!0},get(d,g,m){var w;if(g===Ta)return t;var _=n.get(g),x=g in d;if(_===void 0&&(!x||(w=Ga(d,g))!=null&&w.writable)&&(_=u(()=>{var I=Vt(x?d[g]:gn),L=Oe(I);return L}),n.set(g,_)),_!==void 0){var b=l(_);return b===gn?void 0:b}return Reflect.get(d,g,m)},getOwnPropertyDescriptor(d,g){var m=Reflect.getOwnPropertyDescriptor(d,g);if(m&&"value"in m){var _=n.get(g);_&&(m.value=l(_))}else if(m===void 0){var x=n.get(g),b=x==null?void 0:x.v;if(x!==void 0&&b!==gn)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return m},has(d,g){var b;if(g===Ta)return!0;var m=n.get(g),_=m!==void 0&&m.v!==gn||Reflect.has(d,g);if(m!==void 0||Kt!==null&&(!_||(b=Ga(d,g))!=null&&b.writable)){m===void 0&&(m=u(()=>{var w=_?Vt(d[g]):gn,I=Oe(w);return I}),n.set(g,m));var x=l(m);if(x===gn)return!1}return _},set(d,g,m,_){var he;var x=n.get(g),b=g in d;if(a&&g==="length")for(var w=m;w<x.v;w+=1){var I=n.get(w+"");I!==void 0?A(I,gn):w in d&&(I=u(()=>Oe(gn)),n.set(w+"",I))}if(x===void 0)(!b||(he=Ga(d,g))!=null&&he.writable)&&(x=u(()=>Oe(void 0)),A(x,Vt(m)),n.set(g,x));else{b=x.v!==gn;var L=u(()=>Vt(m));A(x,L)}var O=Reflect.getOwnPropertyDescriptor(d,g);if(O!=null&&O.set&&O.set.call(_,m),!b){if(a&&typeof g=="string"){var se=n.get("length"),ie=Number(g);Number.isInteger(ie)&&ie>=se.v&&A(se,ie+1)}Is(s)}return!0},ownKeys(d){l(s);var g=Reflect.ownKeys(d).filter(x=>{var b=n.get(x);return b===void 0||b.v!==gn});for(var[m,_]of n)_.v!==gn&&!(m in d)&&g.push(m);return g},setPrototypeOf(){Rv()}})}function dc(t){try{if(t!==null&&typeof t=="object"&&Ta in t)return t[Ta]}catch{}return t}function ff(t,e){return Object.is(dc(t),dc(e))}var vc,Au,Iu,Cu;function pf(){if(vc===void 0){vc=window,Au=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Iu=Ga(e,"firstChild").get,Cu=Ga(e,"nextSibling").get,lc(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),lc(n)&&(n.__t=void 0)}}function Kr(t=""){return document.createTextNode(t)}function Yn(t){return Iu.call(t)}function Us(t){return Cu.call(t)}function f(t,e){return Yn(t)}function Ze(t,e=!1){{var n=Yn(t);return n instanceof Comment&&n.data===""?Us(n):n}}function h(t,e=1,n=!1){let a=t;for(;e--;)a=Us(a);return a}function hf(t){t.textContent=""}function Pu(){return!1}function mf(t,e,n){return document.createElementNS(cu,t,void 0)}let fc=!1;function gf(){fc||(fc=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function il(t){var e=kt,n=Kt;ir(null),Pr(null);try{return t()}finally{ir(e),Pr(n)}}function Ou(t,e,n,a=n){t.addEventListener(e,()=>il(n));const s=t.__on_r;s?t.__on_r=()=>{s(),a(!0)}:t.__on_r=()=>a(!0),gf()}function _f(t){Kt===null&&(kt===null&&Iv(),Av()),sa&&Tv()}function yf(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Hr(t,e,n){var a=Kt;a!==null&&(a.f&Qn)!==0&&(t|=Qn);var s={ctx:Xn,deps:null,nodes:null,f:t|wn|ar,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{rs(s)}catch(d){throw Kn(s),d}else e!==null&&hr(s);var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&as)===0&&(o=o.first,(t&Gr)!==0&&(t&$a)!==0&&o!==null&&(o.f|=$a)),o!==null&&(o.parent=a,a!==null&&yf(o,a),kt!==null&&(kt.f&bn)!==0&&(t&Da)===0)){var u=kt;(u.effects??(u.effects=[])).push(o)}return s}function ol(){return kt!==null&&!mr}function Ru(t){const e=Hr(Ri,null,!1);return un(e,hn),e.teardown=t,e}function Oa(t){_f();var e=Kt.f,n=!kt&&(e&yr)!==0&&(e&zs)===0;if(n){var a=Xn;(a.e??(a.e=[])).push(t)}else return Mu(t)}function Mu(t){return Hr(Rs|bv,t,!1)}function bf(t){ra.ensure();const e=Hr(Da|as,t,!0);return(n={})=>new Promise(a=>{n.outro?Aa(e,()=>{Kn(e),a(void 0)}):(Kn(e),a(void 0))})}function ju(t){return Hr(Rs,t,!1)}function wf(t){return Hr(rl|as,t,!0)}function ll(t,e=0){return Hr(Ri|e,t,!0)}function Y(t,e=[],n=[],a=[]){af(a,e,n,s=>{Hr(Ri,()=>t(...s.map(l)),!0)})}function cl(t,e=0){var n=Hr(Gr|e,t,!0);return n}function rr(t){return Hr(yr|as,t,!0)}function Du(t){var e=t.teardown;if(e!==null){const n=sa,a=kt;pc(!0),ir(null);try{e.call(null)}finally{pc(n),ir(a)}}}function ul(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&il(()=>{s.abort(ga)});var a=n.next;(n.f&Da)!==0?n.parent=null:Kn(n,e),n=a}}function kf(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&yr)===0&&Kn(e),e=n}}function Kn(t,e=!0){var n=!1;(e||(t.f&iu)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Lu(t.nodes.start,t.nodes.end),n=!0),ul(t,e&&!n),Ms(t,0),un(t,Ur);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();Du(t);var s=t.parent;s!==null&&s.first!==null&&Nu(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Lu(t,e){for(;t!==null;){var n=t===e?null:Us(t);t.remove(),t=n}}function Nu(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function Aa(t,e,n=!0){var a=[];qu(t,a,!0);var s=()=>{n&&Kn(t),e&&e()},o=a.length;if(o>0){var u=()=>--o||s();for(var d of a)d.out(u)}else s()}function qu(t,e,n){if((t.f&Qn)===0){t.f^=Qn;var a=t.nodes&&t.nodes.t;if(a!==null)for(const d of a)(d.is_global||n)&&e.push(d);for(var s=t.first;s!==null;){var o=s.next,u=(s.f&$a)!==0||(s.f&yr)!==0&&(t.f&Gr)!==0;qu(s,e,u?n:!1),s=o}}}function dl(t){Bu(t,!0)}function Bu(t,e){if((t.f&Qn)!==0){t.f^=Qn,(t.f&hn)===0&&(un(t,wn),hr(t));for(var n=t.first;n!==null;){var a=n.next,s=(n.f&$a)!==0||(n.f&yr)!==0;Bu(n,s?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const u of o)(u.is_global||e)&&u.in()}}function Fu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var s=n===a?null:Us(n);e.append(n),n=s}}let _i=!1,sa=!1;function pc(t){sa=t}let kt=null,mr=!1;function ir(t){kt=t}let Kt=null;function Pr(t){Kt=t}let sr=null;function zu(t){kt!==null&&(sr===null?sr=[t]:sr.push(t))}let Un=null,Wn=0,er=null;function xf(t){er=t}let Uu=1,ya=0,Ia=ya;function hc(t){Ia=t}function Ku(){return++Uu}function Ks(t){var e=t.f;if((e&wn)!==0)return!0;if(e&bn&&(t.f&=~Ca),(e&_r)!==0){for(var n=t.deps,a=n.length,s=0;s<a;s++){var o=n[s];if(Ks(o)&&xu(o),o.wv>t.wv)return!0}(e&ar)!==0&&_n===null&&un(t,hn)}return!1}function Gu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(sr!==null&&Ja.call(sr,t)))for(var s=0;s<a.length;s++){var o=a[s];(o.f&bn)!==0?Gu(o,e,!1):e===o&&(n?un(o,wn):(o.f&hn)!==0&&un(o,_r),hr(o))}}function Hu(t){var L;var e=Un,n=Wn,a=er,s=kt,o=sr,u=Xn,d=mr,g=Ia,m=t.f;Un=null,Wn=0,er=null,kt=(m&(yr|Da))===0?t:null,sr=null,es(t.ctx),mr=!1,Ia=++ya,t.ac!==null&&(il(()=>{t.ac.abort(ga)}),t.ac=null);try{t.f|=Ro;var _=t.fn,x=_();t.f|=zs;var b=t.deps,w=pt==null?void 0:pt.is_fork;if(Un!==null){var I;if(w||Ms(t,Wn),b!==null&&Wn>0)for(b.length=Wn+Un.length,I=0;I<Un.length;I++)b[Wn+I]=Un[I];else t.deps=b=Un;if(ol()&&(t.f&ar)!==0)for(I=Wn;I<b.length;I++)((L=b[I]).reactions??(L.reactions=[])).push(t)}else!w&&b!==null&&Wn<b.length&&(Ms(t,Wn),b.length=Wn);if(vu()&&er!==null&&!mr&&b!==null&&(t.f&(bn|_r|wn))===0)for(I=0;I<er.length;I++)Gu(er[I],t);if(s!==null&&s!==t){if(ya++,s.deps!==null)for(let O=0;O<n;O+=1)s.deps[O].rv=ya;if(e!==null)for(const O of e)O.rv=ya;er!==null&&(a===null?a=er:a.push(...er))}return(t.f&ta)!==0&&(t.f^=ta),x}catch(O){return pu(O)}finally{t.f^=Ro,Un=e,Wn=n,er=a,kt=s,sr=o,es(u),mr=d,Ia=g}}function Sf(t,e){let n=e.reactions;if(n!==null){var a=fv.call(n,t);if(a!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[a]=n[s],n.pop())}}if(n===null&&(e.f&bn)!==0&&(Un===null||!Ja.call(Un,e))){var o=e;(o.f&ar)!==0&&(o.f^=ar,o.f&=~Ca),al(o),uf(o),Ms(o,0)}}function Ms(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)Sf(t,n[a])}function rs(t){var e=t.f;if((e&Ur)===0){un(t,hn);var n=Kt,a=_i;Kt=t,_i=!0;try{(e&(Gr|au))!==0?kf(t):ul(t),Du(t);var s=Hu(t);t.teardown=typeof s=="function"?s:null,t.wv=Uu;var o;Oo&&Vv&&(t.f&wn)!==0&&t.deps}finally{_i=a,Kt=n}}}async function Wu(){await Promise.resolve(),Xv()}function l(t){var e=t.f,n=(e&bn)!==0;if(kt!==null&&!mr){var a=Kt!==null&&(Kt.f&Ur)!==0;if(!a&&(sr===null||!Ja.call(sr,t))){var s=kt.deps;if((kt.f&Ro)!==0)t.rv<ya&&(t.rv=ya,Un===null&&s!==null&&s[Wn]===t?Wn++:Un===null?Un=[t]:Un.push(t));else{(kt.deps??(kt.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[kt]:Ja.call(o,kt)||o.push(kt)}}}if(sa&&aa.has(t))return aa.get(t);if(n){var u=t;if(sa){var d=u.v;return((u.f&hn)===0&&u.reactions!==null||Yu(u))&&(d=sl(u)),aa.set(u,d),d}var g=(u.f&ar)===0&&!mr&&kt!==null&&(_i||(kt.f&ar)!==0),m=(u.f&zs)===0;Ks(u)&&(g&&(u.f|=ar),xu(u)),g&&!m&&(Su(u),Vu(u))}if(_n!=null&&_n.has(t))return _n.get(t);if((t.f&ta)!==0)throw t.v;return t.v}function Vu(t){if(t.f|=ar,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&bn)!==0&&(e.f&ar)===0&&(Su(e),Vu(e))}function Yu(t){if(t.v===gn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(aa.has(e)||(e.f&bn)!==0&&Yu(e))return!0;return!1}function Gs(t){var e=mr;try{return mr=!0,t()}finally{mr=e}}const Ef=["touchstart","touchmove"];function Tf(t){return Ef.includes(t)}const Qu=new Set,Fo=new Set;function Jt(t){for(var e=0;e<t.length;e++)Qu.add(t[e]);for(var n of Fo)n(t)}let mc=null;function gc(t){var O;var e=this,n=e.ownerDocument,a=t.type,s=((O=t.composedPath)==null?void 0:O.call(t))||[],o=s[0]||t.target;mc=t;var u=0,d=mc===t&&t.__root;if(d){var g=s.indexOf(d);if(g!==-1&&(e===document||e===window)){t.__root=e;return}var m=s.indexOf(e);if(m===-1)return;g<=m&&(u=g)}if(o=s[u]||t.target,o!==e){pv(t,"currentTarget",{configurable:!0,get(){return o||n}});var _=kt,x=Kt;ir(null),Pr(null);try{for(var b,w=[];o!==null;){var I=o.assignedSlot||o.parentNode||o.host||null;try{var L=o["__"+a];L!=null&&(!o.disabled||t.target===o)&&L.call(o,t)}catch(se){b?w.push(se):b=se}if(t.cancelBubble||I===e||I===null)break;o=I}if(b){for(let se of w)queueMicrotask(()=>{throw se});throw b}}finally{t.__root=e,delete t.currentTarget,ir(_),Pr(x)}}}var $c,eu;const mo=(eu=($c=globalThis==null?void 0:globalThis.window)==null?void 0:$c.trustedTypes)==null?void 0:eu.createPolicy("svelte-trusted-html",{createHTML:t=>t});function Af(t){return(mo==null?void 0:mo.createHTML(t))??t}function vl(t,e=!1){var n=mf("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?Af(t):t,n.content}function Ra(t,e){var n=Kt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function T(t,e){var n=(e&lu)!==0,a=(e&Kv)!==0,s,o=!t.startsWith("<!>");return()=>{s===void 0&&(s=vl(o?t:"<!>"+t,!0),n||(s=Yn(s)));var u=a||Au?document.importNode(s,!0):s.cloneNode(!0);if(n){var d=Yn(u),g=u.lastChild;Ra(d,g)}else Ra(u,u);return u}}function If(t,e,n="svg"){var a=!t.startsWith("<!>"),s=(e&lu)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,u;return()=>{if(!u){var d=vl(o,!0),g=Yn(d);if(s)for(u=document.createDocumentFragment();Yn(g);)u.appendChild(Yn(g));else u=Yn(g)}var m=u.cloneNode(!0);if(s){var _=Yn(m),x=m.lastChild;Ra(_,x)}else Ra(m,m);return m}}function fl(t,e){return If(t,e,"svg")}function vn(t=""){{var e=Kr(t+"");return Ra(e,e),e}}function On(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Kr();return t.append(e,n),Ra(e,n),t}function S(t,e){t!==null&&t.before(e)}function C(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function Cf(t,e){return Pf(t,e)}const ci=new Map;function Pf(t,{target:e,anchor:n,props:a={},events:s,context:o,intro:u=!0}){pf();var d=new Set,g=x=>{for(var b=0;b<x.length;b++){var w=x[b];if(!d.has(w)){d.add(w);var I=Tf(w);for(const se of[e,document]){var L=ci.get(se);L===void 0&&(L=new Map,ci.set(se,L));var O=L.get(w);O===void 0?(se.addEventListener(w,gc,{passive:I}),L.set(w,1)):L.set(w,O+1)}}}};g(Oi(Qu)),Fo.add(g);var m=void 0,_=bf(()=>{var x=n??e.appendChild(Kr());return ef(x,{pending:()=>{}},b=>{jt({});var w=Xn;o&&(w.c=o),s&&(a.$$events=s),m=t(b,a)||{},Dt()}),()=>{var L;for(var b of d)for(const O of[e,document]){var w=ci.get(O),I=w.get(b);--I==0?(O.removeEventListener(b,gc),w.delete(b),w.size===0&&ci.delete(O)):w.set(b,I)}Fo.delete(g),x!==n&&((L=x.parentNode)==null||L.removeChild(x))}});return Of.set(m,_),m}let Of=new WeakMap;var vr,Ar,Vn,Ea,Bs,Fs,Pi;class Rf{constructor(e,n=!0){bt(this,"anchor");wt(this,vr,new Map);wt(this,Ar,new Map);wt(this,Vn,new Map);wt(this,Ea,new Set);wt(this,Bs,!0);wt(this,Fs,()=>{var e=pt;if(_e(this,vr).has(e)){var n=_e(this,vr).get(e),a=_e(this,Ar).get(n);if(a)dl(a),_e(this,Ea).delete(n);else{var s=_e(this,Vn).get(n);s&&(_e(this,Ar).set(n,s.effect),_e(this,Vn).delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),a=s.effect)}for(const[o,u]of _e(this,vr)){if(_e(this,vr).delete(o),o===e)break;const d=_e(this,Vn).get(u);d&&(Kn(d.effect),_e(this,Vn).delete(u))}for(const[o,u]of _e(this,Ar)){if(o===n||_e(this,Ea).has(o))continue;const d=()=>{if(Array.from(_e(this,vr).values()).includes(o)){var m=document.createDocumentFragment();Fu(u,m),m.append(Kr()),_e(this,Vn).set(o,{effect:u,fragment:m})}else Kn(u);_e(this,Ea).delete(o),_e(this,Ar).delete(o)};_e(this,Bs)||!a?(_e(this,Ea).add(o),Aa(u,d,!1)):d()}}});wt(this,Pi,e=>{_e(this,vr).delete(e);const n=Array.from(_e(this,vr).values());for(const[a,s]of _e(this,Vn))n.includes(a)||(Kn(s.effect),_e(this,Vn).delete(a))});this.anchor=e,gt(this,Bs,n)}ensure(e,n){var a=pt,s=Pu();if(n&&!_e(this,Ar).has(e)&&!_e(this,Vn).has(e))if(s){var o=document.createDocumentFragment(),u=Kr();o.append(u),_e(this,Vn).set(e,{effect:rr(()=>n(u)),fragment:o})}else _e(this,Ar).set(e,rr(()=>n(this.anchor)));if(_e(this,vr).set(a,e),s){for(const[d,g]of _e(this,Ar))d===e?a.unskip_effect(g):a.skip_effect(g);for(const[d,g]of _e(this,Vn))d===e?a.unskip_effect(g.effect):a.skip_effect(g.effect);a.oncommit(_e(this,Fs)),a.ondiscard(_e(this,Pi))}else _e(this,Fs).call(this)}}vr=new WeakMap,Ar=new WeakMap,Vn=new WeakMap,Ea=new WeakMap,Bs=new WeakMap,Fs=new WeakMap,Pi=new WeakMap;function Q(t,e,n=!1){var a=new Rf(t),s=n?$a:0;function o(u,d){a.ensure(u,d)}cl(()=>{var u=!1;e((d,g=0)=>{u=!0,o(g,d)}),u||o(!1,null)},s)}function Ut(t,e){return e}function Mf(t,e,n){for(var a=[],s=e.length,o,u=e.length,d=0;d<s;d++){let x=e[d];Aa(x,()=>{if(o){if(o.pending.delete(x),o.done.add(x),o.pending.size===0){var b=t.outrogroups;zo(Oi(o.done)),b.delete(o),b.size===0&&(t.outrogroups=null)}}else u-=1},!1)}if(u===0){var g=a.length===0&&n!==null;if(g){var m=n,_=m.parentNode;hf(_),_.append(m),t.items.clear()}zo(e,!g)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function zo(t,e=!0){for(var n=0;n<t.length;n++)Kn(t[n],e)}var _c;function xt(t,e,n,a,s,o=null){var u=t,d=new Map,g=(e&ou)!==0;if(g){var m=t;u=m.appendChild(Kr())}var _=null,x=ku(()=>{var se=n();return nl(se)?se:se==null?[]:Oi(se)}),b,w=!0;function I(){O.fallback=_,jf(O,b,u,e,a),_!==null&&(b.length===0?(_.f&Fr)===0?dl(_):(_.f^=Fr,Es(_,null,u)):Aa(_,()=>{_=null}))}var L=cl(()=>{b=l(x);for(var se=b.length,ie=new Set,he=pt,W=Pu(),N=0;N<se;N+=1){var z=b[N],P=a(z,N),ue=w?null:d.get(P);ue?(ue.v&&ns(ue.v,z),ue.i&&ns(ue.i,N),W&&he.unskip_effect(ue.e)):(ue=Df(d,w?u:_c??(_c=Kr()),z,P,N,s,e,n),w||(ue.e.f|=Fr),d.set(P,ue)),ie.add(P)}if(se===0&&o&&!_&&(w?_=rr(()=>o(u)):(_=rr(()=>o(_c??(_c=Kr()))),_.f|=Fr)),se>ie.size&&Ev(),!w)if(W){for(const[ke,xe]of d)ie.has(ke)||he.skip_effect(xe.e);he.oncommit(I),he.ondiscard(()=>{})}else I();l(x)}),O={effect:L,items:d,outrogroups:null,fallback:_};w=!1}function gs(t){for(;t!==null&&(t.f&yr)===0;)t=t.next;return t}function jf(t,e,n,a,s){var xe,we,Z,le,fe,$,pe,ae,X;var o=(a&Nv)!==0,u=e.length,d=t.items,g=gs(t.effect.first),m,_=null,x,b=[],w=[],I,L,O,se;if(o)for(se=0;se<u;se+=1)I=e[se],L=s(I,se),O=d.get(L).e,(O.f&Fr)===0&&((we=(xe=O.nodes)==null?void 0:xe.a)==null||we.measure(),(x??(x=new Set)).add(O));for(se=0;se<u;se+=1){if(I=e[se],L=s(I,se),O=d.get(L).e,t.outrogroups!==null)for(const oe of t.outrogroups)oe.pending.delete(O),oe.done.delete(O);if((O.f&Fr)!==0)if(O.f^=Fr,O===g)Es(O,null,n);else{var ie=_?_.next:g;O===t.effect.last&&(t.effect.last=O.prev),O.prev&&(O.prev.next=O.next),O.next&&(O.next.prev=O.prev),Zr(t,_,O),Zr(t,O,ie),Es(O,ie,n),_=O,b=[],w=[],g=gs(_.next);continue}if((O.f&Qn)!==0&&(dl(O),o&&((le=(Z=O.nodes)==null?void 0:Z.a)==null||le.unfix(),(x??(x=new Set)).delete(O))),O!==g){if(m!==void 0&&m.has(O)){if(b.length<w.length){var he=w[0],W;_=he.prev;var N=b[0],z=b[b.length-1];for(W=0;W<b.length;W+=1)Es(b[W],he,n);for(W=0;W<w.length;W+=1)m.delete(w[W]);Zr(t,N.prev,z.next),Zr(t,_,N),Zr(t,z,he),g=he,_=z,se-=1,b=[],w=[]}else m.delete(O),Es(O,g,n),Zr(t,O.prev,O.next),Zr(t,O,_===null?t.effect.first:_.next),Zr(t,_,O),_=O;continue}for(b=[],w=[];g!==null&&g!==O;)(m??(m=new Set)).add(g),w.push(g),g=gs(g.next);if(g===null)continue}(O.f&Fr)===0&&b.push(O),_=O,g=gs(O.next)}if(t.outrogroups!==null){for(const oe of t.outrogroups)oe.pending.size===0&&(zo(Oi(oe.done)),(fe=t.outrogroups)==null||fe.delete(oe));t.outrogroups.size===0&&(t.outrogroups=null)}if(g!==null||m!==void 0){var P=[];if(m!==void 0)for(O of m)(O.f&Qn)===0&&P.push(O);for(;g!==null;)(g.f&Qn)===0&&g!==t.fallback&&P.push(g),g=gs(g.next);var ue=P.length;if(ue>0){var ke=(a&ou)!==0&&u===0?n:null;if(o){for(se=0;se<ue;se+=1)(pe=($=P[se].nodes)==null?void 0:$.a)==null||pe.measure();for(se=0;se<ue;se+=1)(X=(ae=P[se].nodes)==null?void 0:ae.a)==null||X.fix()}Mf(t,P,ke)}}o&&na(()=>{var oe,ge;if(x!==void 0)for(O of x)(ge=(oe=O.nodes)==null?void 0:oe.a)==null||ge.apply()})}function Df(t,e,n,a,s,o,u,d){var g=(u&Dv)!==0?(u&qv)===0?df(n,!1,!1):Pa(n):null,m=(u&Lv)!==0?Pa(s):null;return{v:g,i:m,e:rr(()=>(o(e,g??n,m??s,d),()=>{t.delete(a)}))}}function Es(t,e,n){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,o=e&&(e.f&Fr)===0?e.nodes.start:n;a!==null;){var u=Us(a);if(o.before(a),a===s)return;a=u}}function Zr(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Lf(t,e,n=!1,a=!1,s=!1){var o=t,u="";Y(()=>{var d=Kt;if(u!==(u=e()??"")&&(d.nodes!==null&&(Lu(d.nodes.start,d.nodes.end),d.nodes=null),u!=="")){var g=u+"";n?g=`<svg>${g}</svg>`:a&&(g=`<math>${g}</math>`);var m=vl(g);if((n||a)&&(m=Yn(m)),Ra(Yn(m),m.lastChild),n||a)for(;Yn(m);)o.before(Yn(m));else o.before(m)}})}const yc=[...` 	
\r\fÂ \v\uFEFF`];function Nf(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var s in n)if(n[s])a=a?a+" "+s:s;else if(a.length)for(var o=s.length,u=0;(u=a.indexOf(s,u))>=0;){var d=u+o;(u===0||yc.includes(a[u-1]))&&(d===a.length||yc.includes(a[d]))?a=(u===0?"":a.substring(0,u))+a.substring(d+1):u=d}}return a===""?null:a}function bc(t,e=!1){var n=e?" !important;":";",a="";for(var s in t){var o=t[s];o!=null&&o!==""&&(a+=" "+s+": "+o+n)}return a}function go(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function qf(t,e){if(e){var n="",a,s;if(Array.isArray(e)?(a=e[0],s=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,u=0,d=!1,g=[];a&&g.push(...Object.keys(a).map(go)),s&&g.push(...Object.keys(s).map(go));var m=0,_=-1;const L=t.length;for(var x=0;x<L;x++){var b=t[x];if(d?b==="/"&&t[x-1]==="*"&&(d=!1):o?o===b&&(o=!1):b==="/"&&t[x+1]==="*"?d=!0:b==='"'||b==="'"?o=b:b==="("?u++:b===")"&&u--,!d&&o===!1&&u===0){if(b===":"&&_===-1)_=x;else if(b===";"||x===L-1){if(_!==-1){var w=go(t.substring(m,_).trim());if(!g.includes(w)){b!==";"&&x++;var I=t.substring(m,x).trim();n+=" "+I+";"}}m=x+1,_=-1}}}}return a&&(n+=bc(a)),s&&(n+=bc(s,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Nt(t,e,n,a,s,o){var u=t.__className;if(u!==n||u===void 0){var d=Nf(n,a,o);d==null?t.removeAttribute("class"):e?t.className=d:t.setAttribute("class",d),t.__className=n}else if(o&&s!==o)for(var g in o){var m=!!o[g];(s==null||m!==!!s[g])&&t.classList.toggle(g,m)}return o}function _o(t,e={},n,a){for(var s in n){var o=n[s];e[s]!==o&&(n[s]==null?t.style.removeProperty(s):t.style.setProperty(s,o,a))}}function dn(t,e,n,a){var s=t.__style;if(s!==e){var o=qf(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(_o(t,n==null?void 0:n[0],a[0]),_o(t,n==null?void 0:n[1],a[1],"important")):_o(t,n,a));return a}function Xu(t,e,n=!1){if(t.multiple){if(e==null)return;if(!nl(e))return Gv();for(var a of t.options)a.selected=e.includes(Cs(a));return}for(a of t.options){var s=Cs(a);if(ff(s,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Bf(t){var e=new MutationObserver(()=>{Xu(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ru(()=>{e.disconnect()})}function Di(t,e,n=e){var a=new WeakSet,s=!0;Ou(t,"change",o=>{var u=o?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(u),Cs);else{var g=t.querySelector(u)??t.querySelector("option:not([disabled])");d=g&&Cs(g)}n(d),pt!==null&&a.add(pt)}),ju(()=>{var o=e();if(t===document.activeElement){var u=ki??pt;if(a.has(u))return}if(Xu(t,o,s),s&&o===void 0){var d=t.querySelector(":checked");d!==null&&(o=Cs(d),n(o))}t.__value=o,s=!1}),Bf(t)}function Cs(t){return"__value"in t?t.__value:t.value}const Ff=Symbol("is custom element"),zf=Symbol("is html");function gr(t,e,n,a){var s=Uf(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[kv]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Kf(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Uf(t){return t.__attributes??(t.__attributes={[Ff]:t.nodeName.includes("-"),[zf]:t.namespaceURI===cu})}var wc=new Map;function Kf(t){var e=t.getAttribute("is")||t.nodeName,n=wc.get(e);if(n)return n;wc.set(e,n=[]);for(var a,s=t,o=Element.prototype;o!==s;){a=hv(s);for(var u in a)a[u].set&&n.push(u);s=nu(s)}return n}function zr(t,e,n=e){var a=new WeakSet;Ou(t,"input",async s=>{var o=s?t.defaultValue:t.value;if(o=yo(t)?bo(o):o,n(o),pt!==null&&a.add(pt),await Wu(),o!==(o=e())){var u=t.selectionStart,d=t.selectionEnd,g=t.value.length;if(t.value=o??"",d!==null){var m=t.value.length;u===d&&d===g&&m>g?(t.selectionStart=m,t.selectionEnd=m):(t.selectionStart=u,t.selectionEnd=Math.min(d,m))}}}),Gs(e)==null&&t.value&&(n(yo(t)?bo(t.value):t.value),pt!==null&&a.add(pt)),ll(()=>{var s=e();if(t===document.activeElement){var o=ki??pt;if(a.has(o))return}yo(t)&&s===bo(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function yo(t){var e=t.type;return e==="number"||e==="range"}function bo(t){return t===""?null:+t}function kc(t,e){return t===e||(t==null?void 0:t[Ta])===e}function Zu(t={},e,n,a){return ju(()=>{var s,o;return ll(()=>{s=o,o=[],Gs(()=>{t!==n(...o)&&(e(t,...o),s&&kc(n(...s),t)&&e(null,...s))})}),()=>{na(()=>{o&&kc(n(...o),t)&&e(null,...o)})}}),t}let ui=!1;function Gf(t){var e=ui;try{return ui=!1,[t(),ui]}finally{ui=e}}function Ne(t,e,n,a){var ie;var s=(n&zv)!==0,o=(n&Uv)!==0,u=a,d=!0,g=()=>(d&&(d=!1,u=o?Gs(a):a),u),m;if(s){var _=Ta in t||wv in t;m=((ie=Ga(t,e))==null?void 0:ie.set)??(_&&e in t?he=>t[e]=he:void 0)}var x,b=!1;s?[x,b]=Gf(()=>t[e]):x=t[e],x===void 0&&a!==void 0&&(x=g(),m&&(Pv(),m(x)));var w;if(w=()=>{var he=t[e];return he===void 0?g():(d=!0,he)},(n&Fv)===0)return w;if(m){var I=t.$$legacy;return(function(he,W){return arguments.length>0?((!W||I||b)&&m(W?w():he),he):w()})}var L=!1,O=((n&Bv)!==0?ji:ku)(()=>(L=!1,w()));s&&l(O);var se=Kt;return(function(he,W){if(arguments.length>0){const N=W?l(O):s?Vt(he):he;return A(O,N),L=!0,u!==void 0&&(u=N),he}return sa&&L||(se.f&Ur)!==0?O.v:l(O)})}function kn(t){Xn===null&&xv(),Oa(()=>{const e=Gs(t);if(typeof e=="function")return e})}const Hf="5";var tu;typeof window<"u"&&((tu=window.__svelte??(window.__svelte={})).v??(tu.v=new Set)).add(Hf);var Wf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yi={exports:{}},Yf=yi.exports,xc;function Qf(){return xc||(xc=1,(function(t,e){((n,a)=>{t.exports=a()})(Yf,function(){var n=function(r,i){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(c,v){c.__proto__=v}:function(c,v){for(var p in v)Object.prototype.hasOwnProperty.call(v,p)&&(c[p]=v[p])}))(r,i)},a=function(){return(a=Object.assign||function(r){for(var i,c=1,v=arguments.length;c<v;c++)for(var p in i=arguments[c])Object.prototype.hasOwnProperty.call(i,p)&&(r[p]=i[p]);return r}).apply(this,arguments)};function s(r,i,c){for(var v,p=0,y=i.length;p<y;p++)!v&&p in i||((v=v||Array.prototype.slice.call(i,0,p))[p]=i[p]);return r.concat(v||Array.prototype.slice.call(i))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Wf,u=Object.keys,d=Array.isArray;function g(r,i){return typeof i=="object"&&u(i).forEach(function(c){r[c]=i[c]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var m=Object.getPrototypeOf,_={}.hasOwnProperty;function x(r,i){return _.call(r,i)}function b(r,i){typeof i=="function"&&(i=i(m(r))),(typeof Reflect>"u"?u:Reflect.ownKeys)(i).forEach(function(c){I(r,c,i[c])})}var w=Object.defineProperty;function I(r,i,c,v){w(r,i,g(c&&x(c,"get")&&typeof c.get=="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},v))}function L(r){return{from:function(i){return r.prototype=Object.create(i.prototype),I(r.prototype,"constructor",r),{extend:b.bind(null,r.prototype)}}}}var O=Object.getOwnPropertyDescriptor,se=[].slice;function ie(r,i,c){return se.call(r,i,c)}function he(r,i){return i(r)}function W(r){if(!r)throw new Error("Assertion Failed")}function N(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function z(r,i){if(typeof i=="string"&&x(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var c=[],v=0,p=i.length;v<p;++v){var y=z(r,i[v]);c.push(y)}return c}var k,E=i.indexOf(".");return E===-1||(k=r[i.substr(0,E)])==null?void 0:z(k,i.substr(E+1))}function P(r,i,c){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){W(typeof c!="string"&&"length"in c);for(var v=0,p=i.length;v<p;++v)P(r,i[v],c[v])}else{var y,k,E=i.indexOf(".");E!==-1?(y=i.substr(0,E),(E=i.substr(E+1))===""?c===void 0?d(r)&&!isNaN(parseInt(y))?r.splice(y,1):delete r[y]:r[y]=c:P(k=(k=r[y])&&x(r,y)?k:r[y]={},E,c)):c===void 0?d(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=c}}function ue(r){var i,c={};for(i in r)x(r,i)&&(c[i]=r[i]);return c}var ke=[].concat;function xe(r){return ke.apply([],r)}var me="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(xe([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return o[r]}),we=new Set(me.map(function(r){return o[r]})),Z=null;function le(r){return Z=new WeakMap,r=(function i(c){if(!c||typeof c!="object")return c;var v=Z.get(c);if(v)return v;if(d(c)){v=[],Z.set(c,v);for(var p=0,y=c.length;p<y;++p)v.push(i(c[p]))}else if(we.has(c.constructor))v=c;else{var k,E=m(c);for(k in v=E===Object.prototype?{}:Object.create(E),Z.set(c,v),c)x(c,k)&&(v[k]=i(c[k]))}return v})(r),Z=null,r}var fe={}.toString;function $(r){return fe.call(r).slice(8,-1)}var pe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ae=typeof pe=="symbol"?function(r){var i;return r!=null&&(i=r[pe])&&i.apply(r)}:function(){return null};function X(r,i){i=r.indexOf(i),0<=i&&r.splice(i,1)}var oe={};function ge(r){var i,c,v,p;if(arguments.length===1){if(d(r))return r.slice();if(this===oe&&typeof r=="string")return[r];if(p=ae(r))for(c=[];!(v=p.next()).done;)c.push(v.value);else{if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(c=new Array(i);i--;)c[i]=r[i]}}else for(i=arguments.length,c=new Array(i);i--;)c[i]=arguments[i];return c}var Se=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},me=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(me),R={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function V(r,i){this.name=r,this.message=i}function ne(r,i){return r+". Errors: "+Object.keys(i).map(function(c){return i[c].toString()}).filter(function(c,v,p){return p.indexOf(c)===v}).join(`
`)}function K(r,i,c,v){this.failures=i,this.failedKeys=v,this.successCount=c,this.message=ne(r,i)}function ve(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(c){return i[c]}),this.failuresByPos=i,this.message=ne(r,this.failures)}L(V).from(Error).extend({toString:function(){return this.name+": "+this.message}}),L(K).from(V),L(ve).from(V);var be=Ve.reduce(function(r,i){return r[i]=i+"Error",r},{}),te=V,U=Ve.reduce(function(r,i){var c=i+"Error";function v(p,y){this.name=c,p?typeof p=="string"?(this.message="".concat(p).concat(y?`
 `+y:""),this.inner=y||null):typeof p=="object"&&(this.message="".concat(p.name," ").concat(p.message),this.inner=p):(this.message=R[i]||c,this.inner=null)}return L(v).from(te),r[i]=v,r},{}),Ee=(U.Syntax=SyntaxError,U.Type=TypeError,U.Range=RangeError,me.reduce(function(r,i){return r[i+"Error"]=U[i],r},{}));me=Ve.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=U[i]),r},{});function ce(){}function Te(r){return r}function qe(r,i){return r==null||r===Te?i:function(c){return i(r(c))}}function He(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function vt(r,i){return r===ce?i:function(){var c=r.apply(this,arguments),v=(c!==void 0&&(arguments[0]=c),this.onsuccess),p=this.onerror,y=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return v&&(this.onsuccess=this.onsuccess?He(v,this.onsuccess):v),p&&(this.onerror=this.onerror?He(p,this.onerror):p),y!==void 0?y:c}}function _t(r,i){return r===ce?i:function(){r.apply(this,arguments);var c=this.onsuccess,v=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),c&&(this.onsuccess=this.onsuccess?He(c,this.onsuccess):c),v&&(this.onerror=this.onerror?He(v,this.onerror):v)}}function Xe(r,i){return r===ce?i:function(p){var v=r.apply(this,arguments),p=(g(p,v),this.onsuccess),y=this.onerror,k=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return p&&(this.onsuccess=this.onsuccess?He(p,this.onsuccess):p),y&&(this.onerror=this.onerror?He(y,this.onerror):y),v===void 0?k===void 0?void 0:k:g(v,k)}}function Be(r,i){return r===ce?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Ue(r,i){return r===ce?i:function(){var c=r.apply(this,arguments);if(c&&typeof c.then=="function"){for(var v=this,p=arguments.length,y=new Array(p);p--;)y[p]=arguments[p];return c.then(function(){return i.apply(v,y)})}return i.apply(this,arguments)}}me.ModifyError=K,me.DexieError=V,me.BulkError=ve;var Ke=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ot(r){Ke=r}var lt={},Je=100,tt=typeof Promise>"u"?[]:(Ve=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[tt=crypto.subtle.digest("SHA-512",new Uint8Array([0])),m(tt),Ve]:[Ve,m(Ve),Ve]),Ve=tt[0],za=tt[1],za=za&&za.then,ze=Ve&&Ve.constructor,ht=!!tt[2],ct=function(r,i){Yt.push([r,i]),ut&&(queueMicrotask(rn),ut=!1)},Bt=!0,ut=!0,$e=[],dt=[],Pt=Te,at={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ce,pgp:!1,env:{},finalize:ce},Me=at,Yt=[],It=0,St=[];function Ae(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Me;if(typeof r!="function"){if(r!==lt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&en(this,this._value)}else this._state=null,this._value=null,++i.ref,(function c(v,p){try{p(function(y){if(v._state===null){if(y===v)throw new TypeError("A promise cannot be resolved with itself.");var k=v._lib&&Dn();y&&typeof y.then=="function"?c(v,function(E,q){y instanceof Ae?y._then(E,q):y.then(E,q)}):(v._state=!0,v._value=y,jn(v)),k&&st()}},en.bind(null,v))}catch(y){en(v,y)}})(this,r)}var Gt={get:function(){var r=Me,i=Ht;function c(v,p){var y=this,k=!r.global&&(r!==Me||i!==Ht),E=k&&!fn(),q=new Ae(function(ee,B){An(y,new Tn(j(v,r,k,E),j(p,r,k,E),ee,B,r))});return this._consoleTask&&(q._consoleTask=this._consoleTask),q}return c.prototype=lt,c},set:function(r){I(this,"then",r&&r.prototype===lt?Gt:{get:function(){return r},set:Gt.set})}};function Tn(r,i,c,v,p){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=c,this.reject=v,this.psd=p}function en(r,i){var c,v;dt.push(i),r._state===null&&(c=r._lib&&Dn(),i=Pt(i),r._state=!1,r._value=i,v=r,$e.some(function(p){return p._value===v._value})||$e.push(v),jn(r),c)&&st()}function jn(r){var i=r._listeners;r._listeners=[];for(var c=0,v=i.length;c<v;++c)An(r,i[c]);var p=r._PSD;--p.ref||p.finalize(),It===0&&(++It,ct(function(){--It==0&&nt()},[]))}function An(r,i){if(r._state===null)r._listeners.push(i);else{var c=r._state?i.onFulfilled:i.onRejected;if(c===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++It,ct(Ft,[c,r,i])}}function Ft(r,i,c){try{var v,p=i._value;!i._state&&dt.length&&(dt=[]),v=Ke&&i._consoleTask?i._consoleTask.run(function(){return r(p)}):r(p),i._state||dt.indexOf(p)!==-1||(y=>{for(var k=$e.length;k;)if($e[--k]._value===y._value)return $e.splice(k,1)})(i),c.resolve(v)}catch(y){c.reject(y)}finally{--It==0&&nt(),--c.psd.ref||c.psd.finalize()}}function rn(){Ye(at,function(){Dn()&&st()})}function Dn(){var r=Bt;return ut=Bt=!1,r}function st(){var r,i,c;do for(;0<Yt.length;)for(r=Yt,Yt=[],c=r.length,i=0;i<c;++i){var v=r[i];v[0].apply(null,v[1])}while(0<Yt.length);ut=Bt=!0}function nt(){for(var r=$e,i=($e=[],r.forEach(function(v){v._PSD.onunhandled.call(null,v._value,v)}),St.slice(0)),c=i.length;c;)i[--c]()}function Lt(r){return new Ae(lt,!1,r)}function rt(r,i){var c=Me;return function(){var v=Dn(),p=Me;try{return Ln(c,!0),r.apply(this,arguments)}catch(y){i&&i(y)}finally{Ln(p,!1),v&&st()}}}b(Ae.prototype,{then:Gt,_then:function(r,i){An(this,new Tn(null,null,r,i,Me))},catch:function(r){var i,c;return arguments.length===1?this.then(null,r):(i=r,c=arguments[1],typeof i=="function"?this.then(null,function(v){return(v instanceof i?c:Lt)(v)}):this.then(null,function(v){return(v&&v.name===i?c:Lt)(v)}))},finally:function(r){return this.then(function(i){return Ae.resolve(r()).then(function(){return i})},function(i){return Ae.resolve(r()).then(function(){return Lt(i)})})},timeout:function(r,i){var c=this;return r<1/0?new Ae(function(v,p){var y=setTimeout(function(){return p(new U.Timeout(i))},r);c.then(v,p).finally(clearTimeout.bind(null,y))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(Ae.prototype,Symbol.toStringTag,"Dexie.Promise"),at.env=Na(),b(Ae,{all:function(){var r=ge.apply(null,arguments).map(lr);return new Ae(function(i,c){r.length===0&&i([]);var v=r.length;r.forEach(function(p,y){return Ae.resolve(p).then(function(k){r[y]=k,--v||i(r)},c)})})},resolve:function(r){return r instanceof Ae?r:r&&typeof r.then=="function"?new Ae(function(i,c){r.then(i,c)}):new Ae(lt,!0,r)},reject:Lt,race:function(){var r=ge.apply(null,arguments).map(lr);return new Ae(function(i,c){r.map(function(v){return Ae.resolve(v).then(i,c)})})},PSD:{get:function(){return Me},set:function(r){return Me=r}},totalEchoes:{get:function(){return Ht}},newPSD:Wt,usePSD:Ye,scheduler:{get:function(){return ct},set:function(r){ct=r}},rejectionMapper:{get:function(){return Pt},set:function(r){Pt=r}},follow:function(r,i){return new Ae(function(c,v){return Wt(function(p,y){var k=Me;k.unhandleds=[],k.onunhandled=y,k.finalize=He(function(){var E,q=this;E=function(){q.unhandleds.length===0?p():y(q.unhandleds[0])},St.push(function ee(){E(),St.splice(St.indexOf(ee),1)}),++It,ct(function(){--It==0&&nt()},[])},k.finalize),r()},i,c,v)})}}),ze&&(ze.allSettled&&I(Ae,"allSettled",function(){var r=ge.apply(null,arguments).map(lr);return new Ae(function(i){r.length===0&&i([]);var c=r.length,v=new Array(c);r.forEach(function(p,y){return Ae.resolve(p).then(function(k){return v[y]={status:"fulfilled",value:k}},function(k){return v[y]={status:"rejected",reason:k}}).then(function(){return--c||i(v)})})})}),ze.any&&typeof AggregateError<"u"&&I(Ae,"any",function(){var r=ge.apply(null,arguments).map(lr);return new Ae(function(i,c){r.length===0&&c(new AggregateError([]));var v=r.length,p=new Array(v);r.forEach(function(y,k){return Ae.resolve(y).then(function(E){return i(E)},function(E){p[k]=E,--v||c(new AggregateError(p))})})})}),ze.withResolvers)&&(Ae.withResolvers=ze.withResolvers);var Ct={awaits:0,echoes:0,id:0},sn=0,on=[],In=0,Ht=0,$t=0;function Wt(r,k,c,v){var p=Me,y=Object.create(p),k=(y.parent=p,y.ref=0,y.global=!1,y.id=++$t,at.env,y.env=ht?{Promise:Ae,PromiseProp:{value:Ae,configurable:!0,writable:!0},all:Ae.all,race:Ae.race,allSettled:Ae.allSettled,any:Ae.any,resolve:Ae.resolve,reject:Ae.reject}:{},k&&g(y,k),++p.ref,y.finalize=function(){--this.parent.ref||this.parent.finalize()},Ye(y,r,c,v));return y.ref===0&&y.finalize(),k}function zt(){return Ct.id||(Ct.id=++sn),++Ct.awaits,Ct.echoes+=Je,Ct.id}function fn(){return!!Ct.awaits&&(--Ct.awaits==0&&(Ct.id=0),Ct.echoes=Ct.awaits*Je,!0)}function lr(r){return Ct.echoes&&r&&r.constructor===ze?(zt(),r.then(function(i){return fn(),i},function(i){return fn(),je(i)})):r}function Vr(){var r=on[on.length-1];on.pop(),Ln(r,!1)}function Ln(r,i){var c,v,p=Me;(i?!Ct.echoes||In++&&r===Me:!In||--In&&r===Me)||queueMicrotask(i?(function(y){++Ht,Ct.echoes&&--Ct.echoes!=0||(Ct.echoes=Ct.awaits=Ct.id=0),on.push(Me),Ln(y,!0)}).bind(null,r):Vr),r!==Me&&(Me=r,p===at&&(at.env=Na()),ht)&&(c=at.env.Promise,v=r.env,p.global||r.global)&&(Object.defineProperty(o,"Promise",v.PromiseProp),c.all=v.all,c.race=v.race,c.resolve=v.resolve,c.reject=v.reject,v.allSettled&&(c.allSettled=v.allSettled),v.any)&&(c.any=v.any)}function Na(){var r=o.Promise;return ht?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Ye(r,i,c,v,p){var y=Me;try{return Ln(r,!0),i(c,v,p)}finally{Ln(y,!1)}}function j(r,i,c,v){return typeof r!="function"?r:function(){var p=Me;c&&zt(),Ln(i,!0);try{return r.apply(this,arguments)}finally{Ln(p,!1),v&&queueMicrotask(fn)}}}function Pe(r){Promise===ze&&Ct.echoes===0?In===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+za).indexOf("[native code]")===-1&&(zt=fn=ce);var je=Ae.reject,Ot="ï¿¿",Qt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",tn="String expected.",ln=[],Nn="__dbnames",br="readonly",la="readwrite";function Zt(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var os={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ca(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=le(i))[r],i}}function jl(){throw U.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Et(r,i){try{var c=Dl(r),v=Dl(i);if(c!==v)return c==="Array"?1:v==="Array"?-1:c==="binary"?1:v==="binary"?-1:c==="string"?1:v==="string"?-1:c==="Date"?1:v!=="Date"?NaN:-1;switch(c){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":for(var p=Ll(r),y=Ll(i),k=p.length,E=y.length,q=k<E?k:E,ee=0;ee<q;++ee)if(p[ee]!==y[ee])return p[ee]<y[ee]?-1:1;return k===E?0:k<E?-1:1;case"Array":for(var B=r,M=i,G=B.length,H=M.length,F=G<H?G:H,D=0;D<F;++D){var re=Et(B[D],M[D]);if(re!==0)return re}return G===H?0:G<H?-1:1}}catch{}return NaN}function Dl(r){var i=typeof r;return i=="object"&&(ArrayBuffer.isView(r)||(i=$(r))==="ArrayBuffer")?"binary":i}function Ll(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Vs(r,i,c){var v=r.schema.yProps;return v?(i&&0<c.numFailures&&(i=i.filter(function(p,y){return!c.failures[y]})),Promise.all(v.map(function(p){return p=p.updatesTable,i?r.db.table(p).where("k").anyOf(i).delete():r.db.table(p).clear()})).then(function(){return c})):c}Nl.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var c=i.add;if(d(c))return s(s([],d(r)?r:[],!0),c).sort();if(typeof c=="number")return(Number(r)||0)+c;if(typeof c=="bigint")try{return BigInt(r)+c}catch{return BigInt(0)+c}throw new TypeError("Invalid term ".concat(c))}if(i.remove!==void 0){var v=i.remove;if(d(v))return d(r)?r.filter(function(p){return!v.includes(p)}).sort():[];if(typeof v=="number")return Number(r)-v;if(typeof v=="bigint")try{return BigInt(r)-v}catch{return BigInt(0)-v}throw new TypeError("Invalid subtrahend ".concat(v))}return c=(c=i.replacePrefix)==null?void 0:c[0],c&&typeof r=="string"&&r.startsWith(c)?i.replacePrefix[1]+r.substring(c.length):r};var ls=Nl;function Nl(r){this["@@propmod"]=r}function ql(r,i){for(var c=u(i),v=c.length,p=!1,y=0;y<v;++y){var k=c[y],E=i[k],q=z(r,k);E instanceof ls?(P(r,k,E.execute(q)),p=!0):q!==E&&(P(r,k,E),p=!0)}return p}Xt.prototype._trans=function(r,i,c){var v=this._tx||Me.trans,p=this.name,y=Ke&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function k(ee,B,M){if(M.schema[p])return i(M.idbtrans,M);throw new U.NotFound("Table "+p+" not part of transaction")}var E=Dn();try{var q=v&&v.db._novip===this.db._novip?v===Me.trans?v._promise(r,k,c):Wt(function(){return v._promise(r,k,c)},{trans:v,transless:Me.transless||Me}):(function ee(B,M,G,H){if(B.idbdb&&(B._state.openComplete||Me.letThrough||B._vip)){var F=B._createTransaction(M,G,B._dbSchema);try{F.create(),B._state.PR1398_maxLoop=3}catch(D){return D.name===be.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return ee(B,M,G,H)})):je(D)}return F._promise(M,function(D,re){return Wt(function(){return Me.trans=F,H(D,re,F)})}).then(function(D){if(M==="readwrite")try{F.idbtrans.commit()}catch{}return M==="readonly"?D:F._completion.then(function(){return D})})}if(B._state.openComplete)return je(new U.DatabaseClosed(B._state.dbOpenError));if(!B._state.isBeingOpened){if(!B._state.autoOpen)return je(new U.DatabaseClosed);B.open().catch(ce)}return B._state.dbReadyPromise.then(function(){return ee(B,M,G,H)})})(this.db,r,[this.name],k);return y&&(q._consoleTask=y,q=q.catch(function(ee){return console.trace(ee),je(ee)})),q}finally{E&&st()}},Xt.prototype.get=function(r,i){var c=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?je(new U.Type("Invalid argument to Table.get()")):this._trans("readonly",function(v){return c.core.get({trans:v,key:r}).then(function(p){return c.hook.reading.fire(p)})}).then(i)},Xt.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(d(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=u(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(E){if(E.compound&&i.every(function(ee){return 0<=E.keyPath.indexOf(ee)})){for(var q=0;q<i.length;++q)if(i.indexOf(E.keyPath[q])===-1)return!1;return!0}return!1}).sort(function(E,q){return E.keyPath.length-q.keyPath.length})[0];if(c&&this.db._maxKey!==Ot)return k=c.keyPath.slice(0,i.length),this.where(k).equals(k.map(function(E){return r[E]}));!c&&Ke&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var v=this.schema.idxByName;function p(E,q){return Et(E,q)===0}var k=i.reduce(function(B,q){var ee=B[0],B=B[1],M=v[q],G=r[q];return[ee||M,ee||!M?Zt(B,M&&M.multi?function(H){return H=z(H,q),d(H)&&H.some(function(F){return p(G,F)})}:function(H){return p(G,z(H,q))}):B]},[null,null]),y=k[0],k=k[1];return y?this.where(y.name).equals(r[y.keyPath]).filter(k):c?this.filter(k):this.where(i).equals("")},Xt.prototype.filter=function(r){return this.toCollection().and(r)},Xt.prototype.count=function(r){return this.toCollection().count(r)},Xt.prototype.offset=function(r){return this.toCollection().offset(r)},Xt.prototype.limit=function(r){return this.toCollection().limit(r)},Xt.prototype.each=function(r){return this.toCollection().each(r)},Xt.prototype.toArray=function(r){return this.toCollection().toArray(r)},Xt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Xt.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,d(r)?"[".concat(r.join("+"),"]"):r))},Xt.prototype.reverse=function(){return this.toCollection().reverse()},Xt.prototype.mapToClass=function(r){for(var i=this.db,c=this.name,v=((this.schema.mappedClass=r).prototype instanceof jl&&(r=(k=>{var E=B,q=k;if(typeof q!="function"&&q!==null)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function ee(){this.constructor=E}function B(){return k!==null&&k.apply(this,arguments)||this}return n(E,q),E.prototype=q===null?Object.create(q):(ee.prototype=q.prototype,new ee),Object.defineProperty(B.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),B.prototype.table=function(){return c},B})(r)),new Set),p=r.prototype;p;p=m(p))Object.getOwnPropertyNames(p).forEach(function(k){return v.add(k)});function y(k){if(!k)return k;var E,q=Object.create(r.prototype);for(E in k)if(!v.has(E))try{q[E]=k[E]}catch{}return q}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=y,this.hook("reading",y),r},Xt.prototype.defineClass=function(){return this.mapToClass(function(r){g(this,r)})},Xt.prototype.add=function(r,i){var c=this,v=this.schema.primKey,p=v.auto,y=v.keyPath,k=r;return y&&p&&(k=ca(y)(r)),this._trans("readwrite",function(E){return c.core.mutate({trans:E,type:"add",keys:i!=null?[i]:null,values:[k]})}).then(function(E){return E.numFailures?Ae.reject(E.failures[0]):E.lastResult}).then(function(E){if(y)try{P(r,y,E)}catch{}return E})},Xt.prototype.upsert=function(r,i){var c=this,v=this.schema.primKey.keyPath;return this._trans("readwrite",function(p){return c.core.get({trans:p,key:r}).then(function(y){var k=y??{};return ql(k,i),v&&P(k,v,r),c.core.mutate({trans:p,type:"put",values:[k],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[i]}}).then(function(E){return E.numFailures?Ae.reject(E.failures[0]):!!y})})})},Xt.prototype.update=function(r,i){return typeof r!="object"||d(r)?this.where(":id").equals(r).modify(i):(r=z(r,this.schema.primKey.keyPath))===void 0?je(new U.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i)},Xt.prototype.put=function(r,i){var c=this,v=this.schema.primKey,p=v.auto,y=v.keyPath,k=r;return y&&p&&(k=ca(y)(r)),this._trans("readwrite",function(E){return c.core.mutate({trans:E,type:"put",values:[k],keys:i!=null?[i]:null})}).then(function(E){return E.numFailures?Ae.reject(E.failures[0]):E.lastResult}).then(function(E){if(y)try{P(r,y,E)}catch{}return E})},Xt.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(c){return i.core.mutate({trans:c,type:"delete",keys:[r]}).then(function(v){return Vs(i,[r],v)}).then(function(v){return v.numFailures?Ae.reject(v.failures[0]):void 0})})},Xt.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:os}).then(function(c){return Vs(r,null,c)})}).then(function(i){return i.numFailures?Ae.reject(i.failures[0]):void 0})},Xt.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(c){return i.core.getMany({keys:r,trans:c}).then(function(v){return v.map(function(p){return i.hook.reading.fire(p)})})})},Xt.prototype.bulkAdd=function(r,i,c){var v=this,p=Array.isArray(i)?i:void 0,y=(c=c||(p?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(k){var E=v.schema.primKey,ee=E.auto,E=E.keyPath;if(E&&p)throw new U.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(p&&p.length!==r.length)throw new U.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,ee=E&&ee?r.map(ca(E)):r;return v.core.mutate({trans:k,type:"add",keys:p,values:ee,wantResults:y}).then(function(B){var M=B.numFailures,G=B.failures;if(M===0)return y?B.results:B.lastResult;throw new ve("".concat(v.name,".bulkAdd(): ").concat(M," of ").concat(q," operations failed"),G)})})},Xt.prototype.bulkPut=function(r,i,c){var v=this,p=Array.isArray(i)?i:void 0,y=(c=c||(p?void 0:i))?c.allKeys:void 0;return this._trans("readwrite",function(k){var E=v.schema.primKey,ee=E.auto,E=E.keyPath;if(E&&p)throw new U.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(p&&p.length!==r.length)throw new U.InvalidArgument("Arguments objects and keys must have the same length");var q=r.length,ee=E&&ee?r.map(ca(E)):r;return v.core.mutate({trans:k,type:"put",keys:p,values:ee,wantResults:y}).then(function(B){var M=B.numFailures,G=B.failures;if(M===0)return y?B.results:B.lastResult;throw new ve("".concat(v.name,".bulkPut(): ").concat(M," of ").concat(q," operations failed"),G)})})},Xt.prototype.bulkUpdate=function(r){var i=this,c=this.core,v=r.map(function(k){return k.key}),p=r.map(function(k){return k.changes}),y=[];return this._trans("readwrite",function(k){return c.getMany({trans:k,keys:v,cache:"clone"}).then(function(E){var q=[],ee=[],B=(r.forEach(function(M,G){var H=M.key,F=M.changes,D=E[G];if(D){for(var re=0,de=Object.keys(F);re<de.length;re++){var J=de[re],ye=F[J];if(J===i.schema.primKey.keyPath){if(Et(ye,H)!==0)throw new U.Constraint("Cannot update primary key in bulkUpdate()")}else P(D,J,ye)}y.push(G),q.push(H),ee.push(D)}}),q.length);return c.mutate({trans:k,type:"put",keys:q,values:ee,updates:{keys:v,changeSpecs:p}}).then(function(M){var G=M.numFailures,H=M.failures;if(G===0)return B;for(var F=0,D=Object.keys(H);F<D.length;F++){var re,de=D[F],J=y[Number(de)];J!=null&&(re=H[de],delete H[de],H[J]=re)}throw new ve("".concat(i.name,".bulkUpdate(): ").concat(G," of ").concat(B," operations failed"),H)})})})},Xt.prototype.bulkDelete=function(r){var i=this,c=r.length;return this._trans("readwrite",function(v){return i.core.mutate({trans:v,type:"delete",keys:r}).then(function(p){return Vs(i,r,p)})}).then(function(v){var p=v.numFailures,y=v.failures;if(p===0)return v.lastResult;throw new ve("".concat(i.name,".bulkDelete(): ").concat(p," of ").concat(c," operations failed"),y)})};var Bl=Xt;function Xt(){}function cs(r){function i(k,E){if(E){for(var q=arguments.length,ee=new Array(q-1);--q;)ee[q-1]=arguments[q];return c[k].subscribe.apply(null,ee),r}if(typeof k=="string")return c[k]}var c={};i.addEventType=y;for(var v=1,p=arguments.length;v<p;++v)y(arguments[v]);return i;function y(k,E,q){var ee,B;if(typeof k!="object")return E=E||Be,B={subscribers:[],fire:q=q||ce,subscribe:function(M){B.subscribers.indexOf(M)===-1&&(B.subscribers.push(M),B.fire=E(B.fire,M))},unsubscribe:function(M){B.subscribers=B.subscribers.filter(function(G){return G!==M}),B.fire=B.subscribers.reduce(E,q)}},c[k]=i[k]=B;u(ee=k).forEach(function(M){var G=ee[M];if(d(G))y(M,ee[M][0],ee[M][1]);else{if(G!=="asap")throw new U.InvalidArgument("Invalid event config");var H=y(M,Te,function(){for(var F=arguments.length,D=new Array(F);F--;)D[F]=arguments[F];H.subscribers.forEach(function(re){N(function(){re.apply(null,D)})})})}})}}function us(r,i){return L(i).from({prototype:r}),i}function qa(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function Gi(r,i){r.filter=Zt(r.filter,i)}function Hi(r,i,c){var v=r.replayFilter;r.replayFilter=v?function(){return Zt(v(),i())}:i,r.justLimit=c&&!v}function Ys(r,i){if(r.isPrimKey)return i.primaryKey;var c=i.getIndexByKeyPath(r.index);if(c)return c;throw new U.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed")}function Fl(r,i,c){var v=Ys(r,i.schema);return i.openCursor({trans:c,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:v,range:r.range}})}function Qs(r,i,c,v){var p,y,k=r.replayFilter?Zt(r.filter,r.replayFilter()):r.filter;return r.or?(p={},y=function(E,q,ee){var B,M;k&&!k(q,ee,function(G){return q.stop(G)},function(G){return q.fail(G)})||((M=""+(B=q.primaryKey))=="[object ArrayBuffer]"&&(M=""+new Uint8Array(B)),x(p,M))||(p[M]=!0,i(E,q,ee))},Promise.all([r.or._iterate(y,c),zl(Fl(r,v,c),r.algorithm,y,!r.keysOnly&&r.valueMapper)])):zl(Fl(r,v,c),Zt(r.algorithm,k),i,!r.keysOnly&&r.valueMapper)}function zl(r,i,c,v){var p=rt(v?function(y,k,E){return c(v(y),k,E)}:c);return r.then(function(y){if(y)return y.start(function(){var k=function(){return y.continue()};i&&!i(y,function(E){return k=E},function(E){y.stop(E),k=ce},function(E){y.fail(E),k=ce})||p(y.value,y,function(E){return k=E}),k()})})}Rt.prototype._read=function(r,i){var c=this._ctx;return c.error?c.table._trans(null,je.bind(null,c.error)):c.table._trans("readonly",r).then(i)},Rt.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,je.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},Rt.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=Zt(i.algorithm,r)},Rt.prototype._iterate=function(r,i){return Qs(this._ctx,r,i,this._ctx.table.core)},Rt.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),c=Object.create(this._ctx);return r&&g(c,r),i._ctx=c,i},Rt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Rt.prototype.each=function(r){var i=this._ctx;return this._read(function(c){return Qs(i,r,c,i.table.core)})},Rt.prototype.count=function(r){var i=this;return this._read(function(c){var v,p=i._ctx,y=p.table.core;return qa(p,!0)?y.count({trans:c,query:{index:Ys(p,y.schema),range:p.range}}).then(function(k){return Math.min(k,p.limit)}):(v=0,Qs(p,function(){return++v,!1},c,y).then(function(){return v}))}).then(r)},Rt.prototype.sortBy=function(r,i){var c=r.split(".").reverse(),v=c[0],p=c.length-1;function y(q,ee){return ee?y(q[c[ee]],ee-1):q[v]}var k=this._ctx.dir==="next"?1:-1;function E(q,ee){return Et(y(q,p),y(ee,p))*k}return this.toArray(function(q){return q.sort(E)}).then(i)},Rt.prototype.toArray=function(r){var i=this;return this._read(function(c){var v,p,y,k=i._ctx;return k.dir==="next"&&qa(k,!0)&&0<k.limit?(v=k.valueMapper,p=Ys(k,k.table.core.schema),k.table.core.query({trans:c,limit:k.limit,values:!0,query:{index:p,range:k.range}}).then(function(E){return E=E.result,v?E.map(v):E})):(y=[],Qs(k,function(E){return y.push(E)},c,k.table.core).then(function(){return y}))},r)},Rt.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,qa(i)?Hi(i,function(){var c=r;return function(v,p){return c===0||(c===1?--c:p(function(){v.advance(c),c=0}),!1)}}):Hi(i,function(){var c=r;return function(){return--c<0}})),this},Rt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),Hi(this._ctx,function(){var i=r;return function(c,v,p){return--i<=0&&v(p),0<=i}},!0),this},Rt.prototype.until=function(r,i){return Gi(this._ctx,function(c,v,p){return!r(c.value)||(v(p),i)}),this},Rt.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},Rt.prototype.last=function(r){return this.reverse().first(r)},Rt.prototype.filter=function(r){var i;return Gi(this._ctx,function(c){return r(c.value)}),(i=this._ctx).isMatch=Zt(i.isMatch,r),this},Rt.prototype.and=function(r){return this.filter(r)},Rt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},Rt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Rt.prototype.desc=function(){return this.reverse()},Rt.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,v){r(v.key,v)})},Rt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},Rt.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(c,v){r(v.primaryKey,v)})},Rt.prototype.keys=function(r){var i=this._ctx,c=(i.keysOnly=!i.isMatch,[]);return this.each(function(v,p){c.push(p.key)}).then(function(){return c}).then(r)},Rt.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&qa(i,!0)&&0<i.limit)return this._read(function(v){var p=Ys(i,i.table.core.schema);return i.table.core.query({trans:v,values:!1,limit:i.limit,query:{index:p,range:i.range}})}).then(function(v){return v.result}).then(r);i.keysOnly=!i.isMatch;var c=[];return this.each(function(v,p){c.push(p.primaryKey)}).then(function(){return c}).then(r)},Rt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},Rt.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},Rt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},Rt.prototype.distinct=function(){var r,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(r={},Gi(this._ctx,function(v){var v=v.primaryKey.toString(),p=x(r,v);return r[v]=!0,!p})),this},Rt.prototype.modify=function(r){var i=this,c=this._ctx;return this._write(function(v){function p(D,re){var de=re.failures;G+=D-re.numFailures;for(var J=0,ye=u(de);J<ye.length;J++){var Ie=ye[J];M.push(de[Ie])}}var y=typeof r=="function"?r:function(D){return ql(D,r)},k=c.table.core,B=k.schema.primaryKey,E=B.outbound,q=B.extractKey,ee=200,B=i.db._options.modifyChunkSize,M=(B&&(ee=typeof B=="object"?B[k.name]||B["*"]||200:B),[]),G=0,H=[],F=r===Ul;return i.clone().primaryKeys().then(function(D){function re(J){var ye=Math.min(ee,D.length-J),Ie=D.slice(J,J+ye);return(F?Promise.resolve([]):k.getMany({trans:v,keys:Ie,cache:"immutable"})).then(function(De){var Le=[],Ce=[],Ge=E?[]:null,Fe=F?Ie:[];if(!F)for(var Re=0;Re<ye;++Re){var We=De[Re],Tt={value:le(We),primKey:D[J+Re]};y.call(Tt,Tt.value,Tt)!==!1&&(Tt.value==null?Fe.push(D[J+Re]):E||Et(q(We),q(Tt.value))===0?(Ce.push(Tt.value),E&&Ge.push(D[J+Re])):(Fe.push(D[J+Re]),Le.push(Tt.value)))}return Promise.resolve(0<Le.length&&k.mutate({trans:v,type:"add",values:Le}).then(function(Mt){for(var et in Mt.failures)Fe.splice(parseInt(et),1);p(Le.length,Mt)})).then(function(){return(0<Ce.length||de&&typeof r=="object")&&k.mutate({trans:v,type:"put",keys:Ge,values:Ce,criteria:de,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<J}).then(function(Mt){return p(Ce.length,Mt)})}).then(function(){return(0<Fe.length||de&&F)&&k.mutate({trans:v,type:"delete",keys:Fe,criteria:de,isAdditionalChunk:0<J}).then(function(Mt){return Vs(c.table,Fe,Mt)}).then(function(Mt){return p(Fe.length,Mt)})}).then(function(){return D.length>J+ye&&re(J+ee)})})}var de=qa(c)&&c.limit===1/0&&(typeof r!="function"||F)&&{index:c.index,range:c.range};return re(0).then(function(){if(0<M.length)throw new K("Error modifying one or more objects",M,G,H);return D.length})})})},Rt.prototype.delete=function(){var r=this._ctx,i=r.range;return!qa(r)||r.table.schema.yProps||!r.isPrimKey&&i.type!==3?this.modify(Ul):this._write(function(c){var v=r.table.core.schema.primaryKey,p=i;return r.table.core.count({trans:c,query:{index:v,range:p}}).then(function(y){return r.table.core.mutate({trans:c,type:"deleteRange",range:p}).then(function(q){var E=q.failures,q=q.numFailures;if(q)throw new K("Could not delete some values",Object.keys(E).map(function(ee){return E[ee]}),y-q);return y-q})})})};var Hd=Rt;function Rt(){}var Ul=function(r,i){return i.value=null};function Wd(r,i){return r<i?-1:r===i?0:1}function Vd(r,i){return i<r?-1:r===i?0:1}function Gn(r,i,c){return r=r instanceof Gl?new r.Collection(r):r,r._ctx.error=new(c||TypeError)(i),r}function Ba(r){return new r.Collection(r,function(){return Kl("")}).limit(0)}function Xs(H,i,c,v){var p,y,k,E,q,ee,B,M=c.length;if(!c.every(function(D){return typeof D=="string"}))return Gn(H,tn);function G(D){p=D==="next"?function(de){return de.toUpperCase()}:function(de){return de.toLowerCase()},y=D==="next"?function(de){return de.toLowerCase()}:function(de){return de.toUpperCase()},k=D==="next"?Wd:Vd;var re=c.map(function(de){return{lower:y(de),upper:p(de)}}).sort(function(de,J){return k(de.lower,J.lower)});E=re.map(function(de){return de.upper}),q=re.map(function(de){return de.lower}),B=(ee=D)==="next"?"":v}G("next");var H=new H.Collection(H,function(){return Yr(E[0],q[M-1]+v)}),F=(H._ondirectionchange=function(D){G(D)},0);return H._addAlgorithm(function(D,re,de){var J=D.key;if(typeof J=="string"){var ye=y(J);if(i(ye,q,F))return!0;for(var Ie=null,De=F;De<M;++De){var Le=((Ce,Ge,Fe,Re,We,Tt)=>{for(var Mt=Math.min(Ce.length,Re.length),et=-1,mt=0;mt<Mt;++mt){var nn=Ge[mt];if(nn!==Re[mt])return We(Ce[mt],Fe[mt])<0?Ce.substr(0,mt)+Fe[mt]+Fe.substr(mt+1):We(Ce[mt],Re[mt])<0?Ce.substr(0,mt)+Re[mt]+Fe.substr(mt+1):0<=et?Ce.substr(0,et)+Ge[et]+Fe.substr(et+1):null;We(Ce[mt],nn)<0&&(et=mt)}return Mt<Re.length&&Tt==="next"?Ce+Fe.substr(Ce.length):Mt<Ce.length&&Tt==="prev"?Ce.substr(0,Fe.length):et<0?null:Ce.substr(0,et)+Re[et]+Fe.substr(et+1)})(J,ye,E[De],q[De],k,ee);Le===null&&Ie===null?F=De+1:(Ie===null||0<k(Ie,Le))&&(Ie=Le)}re(Ie!==null?function(){D.continue(Ie+B)}:de)}return!1}),H}function Yr(r,i,c,v){return{type:2,lower:r,upper:i,lowerOpen:c,upperOpen:v}}function Kl(r){return{type:1,lower:r,upper:r}}Object.defineProperty(pn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),pn.prototype.between=function(r,i,c,v){c=c!==!1,v=v===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(c||v)&&(!c||!v)?Ba(this):new this.Collection(this,function(){return Yr(r,i,!c,!v)})}catch{return Gn(this,Qt)}},pn.prototype.equals=function(r){return r==null?Gn(this,Qt):new this.Collection(this,function(){return Kl(r)})},pn.prototype.above=function(r){return r==null?Gn(this,Qt):new this.Collection(this,function(){return Yr(r,void 0,!0)})},pn.prototype.aboveOrEqual=function(r){return r==null?Gn(this,Qt):new this.Collection(this,function(){return Yr(r,void 0,!1)})},pn.prototype.below=function(r){return r==null?Gn(this,Qt):new this.Collection(this,function(){return Yr(void 0,r,!1,!0)})},pn.prototype.belowOrEqual=function(r){return r==null?Gn(this,Qt):new this.Collection(this,function(){return Yr(void 0,r)})},pn.prototype.startsWith=function(r){return typeof r!="string"?Gn(this,tn):this.between(r,r+Ot,!0,!0)},pn.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Xs(this,function(i,c){return i.indexOf(c[0])===0},[r],Ot)},pn.prototype.equalsIgnoreCase=function(r){return Xs(this,function(i,c){return i===c[0]},[r],"")},pn.prototype.anyOfIgnoreCase=function(){var r=ge.apply(oe,arguments);return r.length===0?Ba(this):Xs(this,function(i,c){return c.indexOf(i)!==-1},r,"")},pn.prototype.startsWithAnyOfIgnoreCase=function(){var r=ge.apply(oe,arguments);return r.length===0?Ba(this):Xs(this,function(i,c){return c.some(function(v){return i.indexOf(v)===0})},r,Ot)},pn.prototype.anyOf=function(){var r,i,c=this,v=ge.apply(oe,arguments),p=this._cmp;try{v.sort(p)}catch{return Gn(this,Qt)}return v.length===0?Ba(this):((r=new this.Collection(this,function(){return Yr(v[0],v[v.length-1])}))._ondirectionchange=function(y){p=y==="next"?c._ascending:c._descending,v.sort(p)},i=0,r._addAlgorithm(function(y,k,E){for(var q=y.key;0<p(q,v[i]);)if(++i===v.length)return k(E),!1;return p(q,v[i])===0||(k(function(){y.continue(v[i])}),!1)}),r)},pn.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},pn.prototype.noneOf=function(){var r=ge.apply(oe,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return Gn(this,Qt)}var i=r.reduce(function(c,v){return c?c.concat([[c[c.length-1][1],v]]):[[-1/0,v]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},pn.prototype.inAnyRange=function(r,de){var c=this,v=this._cmp,p=this._ascending,y=this._descending,k=this._min,E=this._max;if(r.length===0)return Ba(this);if(!r.every(function(J){return J[0]!==void 0&&J[1]!==void 0&&p(J[0],J[1])<=0}))return Gn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",U.InvalidArgument);var q=!de||de.includeLowers!==!1,ee=de&&de.includeUppers===!0,B,M=p;function G(J,ye){return M(J[0],ye[0])}try{(B=r.reduce(function(J,ye){for(var Ie=0,De=J.length;Ie<De;++Ie){var Le=J[Ie];if(v(ye[0],Le[1])<0&&0<v(ye[1],Le[0])){Le[0]=k(Le[0],ye[0]),Le[1]=E(Le[1],ye[1]);break}}return Ie===De&&J.push(ye),J},[])).sort(G)}catch{return Gn(this,Qt)}var H=0,F=ee?function(J){return 0<p(J,B[H][1])}:function(J){return 0<=p(J,B[H][1])},D=q?function(J){return 0<y(J,B[H][0])}:function(J){return 0<=y(J,B[H][0])},re=F,de=new this.Collection(this,function(){return Yr(B[0][0],B[B.length-1][1],!q,!ee)});return de._ondirectionchange=function(J){M=J==="next"?(re=F,p):(re=D,y),B.sort(G)},de._addAlgorithm(function(J,ye,Ie){for(var De,Le=J.key;re(Le);)if(++H===B.length)return ye(Ie),!1;return!F(De=Le)&&!D(De)||(c._cmp(Le,B[H][1])===0||c._cmp(Le,B[H][0])===0||ye(function(){M===p?J.continue(B[H][0]):J.continue(B[H][1])}),!1)}),de},pn.prototype.startsWithAnyOf=function(){var r=ge.apply(oe,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Ba(this):this.inAnyRange(r.map(function(i){return[i,i+Ot]})):Gn(this,"startsWithAnyOf() only works with strings")};var Gl=pn;function pn(){}function wr(r){return rt(function(i){return ds(i),r(i.target.error),!1})}function ds(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var vs="storagemutated",Wi="x-storagemutated-1",Qr=cs(null,vs),Yd=(kr.prototype._lock=function(){return W(!Me.global),++this._reculock,this._reculock!==1||Me.global||(Me.lockOwnerFor=this),this},kr.prototype._unlock=function(){if(W(!Me.global),--this._reculock==0)for(Me.global||(Me.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Ye(r[1],r[0])}catch{}}return this},kr.prototype._locked=function(){return this._reculock&&Me.lockOwnerFor!==this},kr.prototype.create=function(r){var i=this;if(this.mode){var c=this.db.idbdb,v=this.db._state.dbOpenError;if(W(!this.idbtrans),!r&&!c)switch(v&&v.name){case"DatabaseClosedError":throw new U.DatabaseClosed(v);case"MissingAPIError":throw new U.MissingAPI(v.message,v);default:throw new U.OpenFailed(v)}if(!this.active)throw new U.TransactionInactive;W(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||c).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=rt(function(p){ds(p),i._reject(r.error)}),r.onabort=rt(function(p){ds(p),i.active&&i._reject(new U.Abort(r.error)),i.active=!1,i.on("abort").fire(p)}),r.oncomplete=rt(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&Qr.storagemutated.fire(r.mutatedParts)})}return this},kr.prototype._promise=function(r,i,c){var v,p=this;return r==="readwrite"&&this.mode!=="readwrite"?je(new U.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ae(function(y,k){p._blockedFuncs.push([function(){p._promise(r,i,c).then(y,k)},Me])}):c?Wt(function(){var y=new Ae(function(k,E){p._lock();var q=i(k,E,p);q&&q.then&&q.then(k,E)});return y.finally(function(){return p._unlock()}),y._lib=!0,y}):((v=new Ae(function(y,k){var E=i(y,k,p);E&&E.then&&E.then(y,k)}))._lib=!0,v):je(new U.TransactionInactive)},kr.prototype._root=function(){return this.parent?this.parent._root():this},kr.prototype.waitFor=function(r){var i,c=this._root(),v=Ae.resolve(r),p=(c._waitingFor?c._waitingFor=c._waitingFor.then(function(){return v}):(c._waitingFor=v,c._waitingQueue=[],i=c.idbtrans.objectStore(c.storeNames[0]),(function y(){for(++c._spinCount;c._waitingQueue.length;)c._waitingQueue.shift()();c._waitingFor&&(i.get(-1/0).onsuccess=y)})()),c._waitingFor);return new Ae(function(y,k){v.then(function(E){return c._waitingQueue.push(rt(y.bind(null,E)))},function(E){return c._waitingQueue.push(rt(k.bind(null,E)))}).finally(function(){c._waitingFor===p&&(c._waitingFor=null)})})},kr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new U.Abort))},kr.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(x(i,r))return i[r];var c=this.schema[r];if(c)return(c=new this.db.Table(r,c,this)).core=this.db.core.table(r),i[r]=c;throw new U.NotFound("Table "+r+" not part of transaction")},kr);function kr(){}function Vi(r,i,c,v,p,y,k,E){return{name:r,keyPath:i,unique:c,multi:v,auto:p,compound:y,src:(c&&!k?"&":"")+(v?"*":"")+(p?"++":"")+Hl(i),type:E}}function Hl(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function Yi(r,i,c){return{name:r,primKey:i,indexes:c,mappedClass:null,idxByName:(v=function(p){return[p.name,p]},c.reduce(function(p,y,k){return y=v(y,k),y&&(p[y[0]]=y[1]),p},{}))};var v}var fs=function(r){try{return r.only([[]]),fs=function(){return[[]]},[[]]}catch{return fs=function(){return Ot},Ot}};function Qi(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(c){return c[i]}:function(c){return z(c,i)}:function(c){return z(c,r)};var i}function Wl(r){return[].slice.call(r)}var Qd=0;function ps(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Xd(r,i,q){function v(F){if(F.type===3)return null;if(F.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var M=F.lower,G=F.upper,H=F.lowerOpen,F=F.upperOpen;return M===void 0?G===void 0?null:i.upperBound(G,!!F):G===void 0?i.lowerBound(M,!!H):i.bound(M,G,!!H,!!F)}function p(B){var M,G=B.name;return{name:G,schema:B,mutate:function(H){var F=H.trans,D=H.type,re=H.keys,de=H.values,J=H.range;return new Promise(function(ye,Ie){ye=rt(ye);var De=F.objectStore(G),Le=De.keyPath==null,Ce=D==="put"||D==="add";if(!Ce&&D!=="delete"&&D!=="deleteRange")throw new Error("Invalid operation type: "+D);var Ge,Fe=(re||de||{length:1}).length;if(re&&de&&re.length!==de.length)throw new Error("Given keys array must have same length as given values array.");if(Fe===0)return ye({numFailures:0,failures:{},results:[],lastResult:void 0});function Re(an){++Mt,ds(an)}var We=[],Tt=[],Mt=0;if(D==="deleteRange"){if(J.type===4)return ye({numFailures:Mt,failures:Tt,results:[],lastResult:void 0});J.type===3?We.push(Ge=De.clear()):We.push(Ge=De.delete(v(J)))}else{var Le=Ce?Le?[de,re]:[de,null]:[re,null],et=Le[0],mt=Le[1];if(Ce)for(var nn=0;nn<Fe;++nn)We.push(Ge=mt&&mt[nn]!==void 0?De[D](et[nn],mt[nn]):De[D](et[nn])),Ge.onerror=Re;else for(nn=0;nn<Fe;++nn)We.push(Ge=De[D](et[nn])),Ge.onerror=Re}function $n(an){an=an.target.result,We.forEach(function(va,po){return va.error!=null&&(Tt[po]=va.error)}),ye({numFailures:Mt,failures:Tt,results:D==="delete"?re:We.map(function(va){return va.result}),lastResult:an})}Ge.onerror=function(an){Re(an),$n(an)},Ge.onsuccess=$n})},getMany:function(H){var F=H.trans,D=H.keys;return new Promise(function(re,de){re=rt(re);for(var J,ye=F.objectStore(G),Ie=D.length,De=new Array(Ie),Le=0,Ce=0,Ge=function(We){We=We.target,De[We._pos]=We.result,++Ce===Le&&re(De)},Fe=wr(de),Re=0;Re<Ie;++Re)D[Re]!=null&&((J=ye.get(D[Re]))._pos=Re,J.onsuccess=Ge,J.onerror=Fe,++Le);Le===0&&re(De)})},get:function(H){var F=H.trans,D=H.key;return new Promise(function(re,de){re=rt(re);var J=F.objectStore(G).get(D);J.onsuccess=function(ye){return re(ye.target.result)},J.onerror=wr(de)})},query:(M=E,function(H){return new Promise(function(F,D){F=rt(F);var re,de,J,Ce=H.trans,ye=H.values,Ie=H.limit,Le=H.query,De=Ie===1/0?void 0:Ie,Ge=Le.index,Le=Le.range,Ce=Ce.objectStore(G),Ce=Ge.isPrimaryKey?Ce:Ce.index(Ge.name),Ge=v(Le);if(Ie===0)return F({result:[]});M?((Le=ye?Ce.getAll(Ge,De):Ce.getAllKeys(Ge,De)).onsuccess=function(Fe){return F({result:Fe.target.result})},Le.onerror=wr(D)):(re=0,de=!ye&&"openKeyCursor"in Ce?Ce.openKeyCursor(Ge):Ce.openCursor(Ge),J=[],de.onsuccess=function(Fe){var Re=de.result;return!Re||(J.push(ye?Re.value:Re.primaryKey),++re===Ie)?F({result:J}):void Re.continue()},de.onerror=wr(D))})}),openCursor:function(H){var F=H.trans,D=H.values,re=H.query,de=H.reverse,J=H.unique;return new Promise(function(ye,Ie){ye=rt(ye);var Ce=re.index,De=re.range,Le=F.objectStore(G),Le=Ce.isPrimaryKey?Le:Le.index(Ce.name),Ce=de?J?"prevunique":"prev":J?"nextunique":"next",Ge=!D&&"openKeyCursor"in Le?Le.openKeyCursor(v(De),Ce):Le.openCursor(v(De),Ce);Ge.onerror=wr(Ie),Ge.onsuccess=rt(function(Fe){var Re,We,Tt,Mt,et=Ge.result;et?(et.___id=++Qd,et.done=!1,Re=et.continue.bind(et),We=(We=et.continuePrimaryKey)&&We.bind(et),Tt=et.advance.bind(et),Mt=function(){throw new Error("Cursor not stopped")},et.trans=F,et.stop=et.continue=et.continuePrimaryKey=et.advance=function(){throw new Error("Cursor not started")},et.fail=rt(Ie),et.next=function(){var mt=this,nn=1;return this.start(function(){return nn--?mt.continue():mt.stop()}).then(function(){return mt})},et.start=function(mt){function nn(){if(Ge.result)try{mt()}catch(an){et.fail(an)}else et.done=!0,et.start=function(){throw new Error("Cursor behind last entry")},et.stop()}var $n=new Promise(function(an,va){an=rt(an),Ge.onerror=wr(va),et.fail=va,et.stop=function(po){et.stop=et.continue=et.continuePrimaryKey=et.advance=Mt,an(po)}});return Ge.onsuccess=rt(function(an){Ge.onsuccess=nn,nn()}),et.continue=Re,et.continuePrimaryKey=We,et.advance=Tt,nn(),$n},ye(et)):ye(null)},Ie)})},count:function(H){var F=H.query,D=H.trans,re=F.index,de=F.range;return new Promise(function(J,ye){var Ie=D.objectStore(G),Ie=re.isPrimaryKey?Ie:Ie.index(re.name),De=v(de),De=De?Ie.count(De):Ie.count();De.onsuccess=rt(function(Le){return J(Le.target.result)}),De.onerror=wr(ye)})}}}y=q,k=Wl((q=r).objectStoreNames);var y,q={schema:{name:q.name,tables:k.map(function(B){return y.objectStore(B)}).map(function(B){var M=B.keyPath,G=B.autoIncrement,F=d(M),H={},F={name:B.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:M==null,compound:F,keyPath:M,autoIncrement:G,unique:!0,extractKey:Qi(M)},indexes:Wl(B.indexNames).map(function(D){return B.index(D)}).map(function(J){var ye=J.name,re=J.unique,de=J.multiEntry,J=J.keyPath,ye={name:ye,compound:d(J),keyPath:J,unique:re,multiEntry:de,extractKey:Qi(J)};return H[ps(J)]=ye}),getIndexByKeyPath:function(D){return H[ps(D)]}};return H[":id"]=F.primaryKey,M!=null&&(H[ps(M)]=F.primaryKey),F})},hasGetAll:0<k.length&&"getAll"in y.objectStore(k[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},k=q.schema,E=q.hasGetAll,q=k.tables.map(p),ee={};return q.forEach(function(B){return ee[B.name]=B}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(B){if(ee[B])return ee[B];throw new Error("Table '".concat(B,"' not found"))},MIN_KEY:-1/0,MAX_KEY:fs(i),schema:k}}function Zd(r,i,c,v){return c=c.IDBKeyRange,i=Xd(i,c,v),{dbcore:r.dbcore.reduce(function(p,y){return y=y.create,a(a({},p),y(p))},i)}}function Zs(r,i){var c=i.db,c=Zd(r._middlewares,c,r._deps,i);r.core=c.dbcore,r.tables.forEach(function(v){var p=v.name;r.core.schema.tables.some(function(y){return y.name===p})&&(v.core=r.core.table(p),r[p]instanceof r.Table)&&(r[p].core=v.core)})}function Js(r,i,c,v){c.forEach(function(p){var y=v[p];i.forEach(function(k){var E=(function q(ee,B){return O(ee,B)||(ee=m(ee))&&q(ee,B)})(k,p);(!E||"value"in E&&E.value===void 0)&&(k===r.Transaction.prototype||k instanceof r.Transaction?I(k,p,{get:function(){return this.table(p)},set:function(q){w(this,p,{value:q,writable:!0,configurable:!0,enumerable:!0})}}):k[p]=new r.Table(p,y))})})}function Xi(r,i){i.forEach(function(c){for(var v in c)c[v]instanceof r.Table&&delete c[v]})}function Jd(r,i){return r._cfg.version-i._cfg.version}function $d(r,i,c,v){var p=r._dbSchema,y=(c.objectStoreNames.contains("$meta")&&!p.$meta&&(p.$meta=Yi("$meta",Yl("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,p)),k=(y.create(c),y._completion.catch(v),y._reject.bind(y)),E=Me.transless||Me;Wt(function(){if(Me.trans=y,Me.transless=E,i!==0)return Zs(r,c),ee=i,((q=y).storeNames.includes("$meta")?q.table("$meta").get("version").then(function(B){return B??ee}):Ae.resolve(ee)).then(function(re){var M=r,G=re,H=y,F=c,D=[],re=M._versions,de=M._dbSchema=ei(0,M.idbdb,F);return(re=re.filter(function(J){return J._cfg.version>=G})).length===0?Ae.resolve():(re.forEach(function(J){D.push(function(){var ye,Ie,De,Le=de,Ce=J._cfg.dbschema,Ge=(ti(M,Le,F),ti(M,Ce,F),de=M._dbSchema=Ce,Zi(Le,Ce)),Fe=(Ge.add.forEach(function(Re){Ji(F,Re[0],Re[1].primKey,Re[1].indexes)}),Ge.change.forEach(function(Re){if(Re.recreate)throw new U.Upgrade("Not yet support for changing primary key");var We=F.objectStore(Re.name);Re.add.forEach(function(Tt){return $s(We,Tt)}),Re.change.forEach(function(Tt){We.deleteIndex(Tt.name),$s(We,Tt)}),Re.del.forEach(function(Tt){return We.deleteIndex(Tt)})}),J._cfg.contentUpgrade);if(Fe&&J._cfg.version>G)return Zs(M,F),H._memoizedTables={},ye=ue(Ce),Ge.del.forEach(function(Re){ye[Re]=Le[Re]}),Xi(M,[M.Transaction.prototype]),Js(M,[M.Transaction.prototype],u(ye),ye),H.schema=ye,(Ie=Se(Fe))&&zt(),Ce=Ae.follow(function(){var Re;(De=Fe(H))&&Ie&&(Re=fn.bind(null,null),De.then(Re,Re))}),De&&typeof De.then=="function"?Ae.resolve(De):Ce.then(function(){return De})}),D.push(function(ye){var Ie,De,Le=J._cfg.dbschema;Ie=Le,De=ye,[].slice.call(De.db.objectStoreNames).forEach(function(Ce){return Ie[Ce]==null&&De.db.deleteObjectStore(Ce)}),Xi(M,[M.Transaction.prototype]),Js(M,[M.Transaction.prototype],M._storeNames,M._dbSchema),H.schema=M._dbSchema}),D.push(function(ye){M.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(M.idbdb.version/10)===J._cfg.version?(M.idbdb.deleteObjectStore("$meta"),delete M._dbSchema.$meta,M._storeNames=M._storeNames.filter(function(Ie){return Ie!=="$meta"})):ye.objectStore("$meta").put(J._cfg.version,"version"))})}),(function J(){return D.length?Ae.resolve(D.shift()(H.idbtrans)).then(J):Ae.resolve()})().then(function(){Vl(de,F)}))}).catch(k);var q,ee;u(p).forEach(function(B){Ji(c,B,p[B].primKey,p[B].indexes)}),Zs(r,c),Ae.follow(function(){return r.on.populate.fire(y)}).catch(k)})}function ev(r,i){Vl(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var c=ei(0,r.idbdb,i);ti(r,r._dbSchema,i);for(var v=0,p=Zi(c,r._dbSchema).change;v<p.length;v++){var y=(k=>{if(k.change.length||k.recreate)return console.warn("Unable to patch indexes of table ".concat(k.name," because it has changes on the type of index or primary key.")),{value:void 0};var E=i.objectStore(k.name);k.add.forEach(function(q){Ke&&console.debug("Dexie upgrade patch: Creating missing index ".concat(k.name,".").concat(q.src)),$s(E,q)})})(p[v]);if(typeof y=="object")return y.value}}function Zi(r,i){var c,v={del:[],add:[],change:[]};for(c in r)i[c]||v.del.push(c);for(c in i){var p=r[c],y=i[c];if(p){var k={name:c,def:y,recreate:!1,del:[],add:[],change:[]};if(""+(p.primKey.keyPath||"")!=""+(y.primKey.keyPath||"")||p.primKey.auto!==y.primKey.auto)k.recreate=!0,v.change.push(k);else{var E=p.idxByName,q=y.idxByName,ee=void 0;for(ee in E)q[ee]||k.del.push(ee);for(ee in q){var B=E[ee],M=q[ee];B?B.src!==M.src&&k.change.push(M):k.add.push(M)}(0<k.del.length||0<k.add.length||0<k.change.length)&&v.change.push(k)}}else v.add.push([c,y])}return v}function Ji(r,i,c,v){var p=r.db.createObjectStore(i,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});v.forEach(function(y){return $s(p,y)})}function Vl(r,i){u(r).forEach(function(c){i.db.objectStoreNames.contains(c)||(Ke&&console.debug("Dexie: Creating missing table",c),Ji(i,c,r[c].primKey,r[c].indexes))})}function $s(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function ei(r,i,c){var v={};return ie(i.objectStoreNames,0).forEach(function(p){for(var y=c.objectStore(p),k=Vi(Hl(ee=y.keyPath),ee||"",!0,!1,!!y.autoIncrement,ee&&typeof ee!="string",!0),E=[],q=0;q<y.indexNames.length;++q){var B=y.index(y.indexNames[q]),ee=B.keyPath,B=Vi(B.name,ee,!!B.unique,!!B.multiEntry,!1,ee&&typeof ee!="string",!1);E.push(B)}v[p]=Yi(p,k,E)}),v}function ti(r,i,c){for(var v=c.db.objectStoreNames,p=0;p<v.length;++p){var y=v[p],k=c.objectStore(y);r._hasGetAll="getAll"in k;for(var E=0;E<k.indexNames.length;++E){var q,ee=k.indexNames[E],B=k.index(ee).keyPath,B=typeof B=="string"?B:"["+ie(B).join("+")+"]";i[y]&&(q=i[y].idxByName[B])&&(q.name=ee,delete i[y].idxByName[B],i[y].idxByName[ee]=q)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Yl(r){return r.split(",").map(function(i,c){var p=i.split(":"),v=(v=p[1])==null?void 0:v.trim(),p=(i=p[0].trim()).replace(/([&*]|\+\+)/g,""),y=/^\[/.test(p)?p.match(/^\[(.*)\]$/)[1].split("+"):p;return Vi(p,y||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),d(y),c===0,v)})}Fa.prototype._createTableSchema=Yi,Fa.prototype._parseIndexSyntax=Yl,Fa.prototype._parseStoresSpec=function(r,i){var c=this;u(r).forEach(function(v){if(r[v]!==null){var p=c._parseIndexSyntax(r[v]),y=p.shift();if(!y)throw new U.Schema("Invalid schema for table "+v+": "+r[v]);if(y.unique=!0,y.multi)throw new U.Schema("Primary key cannot be multiEntry*");p.forEach(function(k){if(k.auto)throw new U.Schema("Only primary key can be marked as autoIncrement (++)");if(!k.keyPath)throw new U.Schema("Index must have a name and cannot be an empty string")}),y=c._createTableSchema(v,y,p),i[v]=y}})},Fa.prototype.stores=function(c){var i=this.db,c=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,c):c,i._versions),v={},p={};return c.forEach(function(y){g(v,y._cfg.storesSource),p=y._cfg.dbschema={},y._parseStoresSpec(v,p)}),i._dbSchema=p,Xi(i,[i._allTables,i,i.Transaction.prototype]),Js(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],u(p),p),i._storeNames=u(p),this},Fa.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Ue(this._cfg.contentUpgrade||ce,r),this};var tv=Fa;function Fa(){}function $i(r,i){var c=r._dbNamesDB;return c||(c=r._dbNamesDB=new Mr(Nn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),c.table("dbnames")}function eo(r){return r&&typeof r.databases=="function"}function to(r){return Wt(function(){return Me.letThrough=!0,r()})}function no(r){return!("from"in r)}var xn=function(r,i){var c;if(!this)return c=new xn,r&&"d"in r&&g(c,r),c;g(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function hs(r,i,c){var v=Et(i,c);if(!isNaN(v)){if(0<v)throw RangeError();if(no(r))return g(r,{from:i,to:c,d:1});var v=r.l,p=r.r;if(Et(c,r.from)<0)return v?hs(v,i,c):r.l={from:i,to:c,d:1,l:null,r:null},Xl(r);if(0<Et(i,r.to))return p?hs(p,i,c):r.r={from:i,to:c,d:1,l:null,r:null},Xl(r);Et(i,r.from)<0&&(r.from=i,r.l=null,r.d=p?p.d+1:1),0<Et(c,r.to)&&(r.to=c,r.r=null,r.d=r.l?r.l.d+1:1),i=!r.r,v&&!r.l&&ms(r,v),p&&i&&ms(r,p)}}function ms(r,i){no(i)||(function c(v,p){var y=p.from,k=p.l,E=p.r;hs(v,y,p.to),k&&c(v,k),E&&c(v,E)})(r,i)}function Ql(r,i){var c=ni(i),v=c.next();if(!v.done)for(var p=v.value,y=ni(r),k=y.next(p.from),E=k.value;!v.done&&!k.done;){if(Et(E.from,p.to)<=0&&0<=Et(E.to,p.from))return!0;Et(p.from,E.from)<0?p=(v=c.next(E.from)).value:E=(k=y.next(p.from)).value}return!1}function ni(r){var i=no(r)?null:{s:0,n:r};return{next:function(c){for(var v=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,v)for(;i.n.l&&Et(c,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!v||Et(c,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Xl(r){var i,c,v,p=(((p=r.r)==null?void 0:p.d)||0)-(((p=r.l)==null?void 0:p.d)||0),p=1<p?"r":p<-1?"l":"";p&&(i=p=="r"?"l":"r",c=a({},r),v=r[p],r.from=v.from,r.to=v.to,r[p]=v[p],c[p]=v[i],(r[i]=c).d=Zl(c)),r.d=Zl(r)}function Zl(c){var i=c.r,c=c.l;return(i?c?Math.max(i.d,c.d):i.d:c?c.d:0)+1}function ri(r,i){return u(i).forEach(function(c){r[c]?ms(r[c],i[c]):r[c]=(function v(p){var y,k,E={};for(y in p)x(p,y)&&(k=p[y],E[y]=!k||typeof k!="object"||we.has(k.constructor)?k:v(k));return E})(i[c])}),r}function ro(r,i){return r.all||i.all||Object.keys(r).some(function(c){return i[c]&&Ql(i[c],r[c])})}b(xn.prototype,((Ve={add:function(r){return ms(this,r),this},addKey:function(r){return hs(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(c){return hs(i,c,c)}),this},hasKey:function(r){var i=ni(this).next(r).value;return i&&Et(i.from,r)<=0&&0<=Et(i.to,r)}})[pe]=function(){return ni(this)},Ve));var ua={},ao={},so=!1;function ai(r){ri(ao,r),so||(so=!0,setTimeout(function(){so=!1,io(ao,!(ao={}))},0))}function io(r,i){i===void 0&&(i=!1);var c=new Set;if(r.all)for(var v=0,p=Object.values(ua);v<p.length;v++)Jl(E=p[v],r,c,i);else for(var y in r){var k,E,y=/^idb\:\/\/(.*)\/(.*)\//.exec(y);y&&(k=y[1],y=y[2],E=ua["idb://".concat(k,"/").concat(y)])&&Jl(E,r,c,i)}c.forEach(function(q){return q()})}function Jl(r,i,c,v){for(var p=[],y=0,k=Object.entries(r.queries.query);y<k.length;y++){for(var E=k[y],q=E[0],ee=[],B=0,M=E[1];B<M.length;B++){var G=M[B];ro(i,G.obsSet)?G.subscribers.forEach(function(re){return c.add(re)}):v&&ee.push(G)}v&&p.push([q,ee])}if(v)for(var H=0,F=p;H<F.length;H++){var D=F[H],q=D[0],ee=D[1];r.queries.query[q]=ee}}function nv(r){var i=r._state,c=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?je(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var v=i.openCanceller,p=Math.round(10*r.verno),y=!1;function k(){if(i.openCanceller!==v)throw new U.DatabaseClosed("db.open() was cancelled")}function E(){return new Ae(function(G,H){if(k(),!c)throw new U.MissingAPI;var F=r.name,D=i.autoSchema||!p?c.open(F):c.open(F,p);if(!D)throw new U.MissingAPI;D.onerror=wr(H),D.onblocked=rt(r._fireOnBlocked),D.onupgradeneeded=rt(function(re){var de;B=D.transaction,i.autoSchema&&!r._options.allowEmptyDB?(D.onerror=ds,B.abort(),D.result.close(),(de=c.deleteDatabase(F)).onsuccess=de.onerror=rt(function(){H(new U.NoSuchDatabase("Database ".concat(F," doesnt exist")))})):(B.onerror=wr(H),de=re.oldVersion>Math.pow(2,62)?0:re.oldVersion,M=de<1,r.idbdb=D.result,y&&ev(r,B),$d(r,de/10,B,H))},H),D.onsuccess=rt(function(){B=null;var re,de,J,ye,Ie,De,Le=r.idbdb=D.result,Ce=ie(Le.objectStoreNames);if(0<Ce.length)try{var Ge=Le.transaction((Ie=Ce).length===1?Ie[0]:Ie,"readonly");if(i.autoSchema)De=Le,ye=Ge,(J=r).verno=De.version/10,ye=J._dbSchema=ei(0,De,ye),J._storeNames=ie(De.objectStoreNames,0),Js(J,[J._allTables],u(ye),ye);else if(ti(r,r._dbSchema,Ge),de=Ge,((de=Zi(ei(0,(re=r).idbdb,de),re._dbSchema)).add.length||de.change.some(function(Fe){return Fe.add.length||Fe.change.length}))&&!y)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Le.close(),p=Le.version+1,y=!0,G(E());Zs(r,Ge)}catch{}ln.push(r),Le.onversionchange=rt(function(Fe){i.vcFired=!0,r.on("versionchange").fire(Fe)}),Le.onclose=rt(function(){r.close({disableAutoOpen:!1})}),M&&(Ce=r._deps,Ie=F,eo(De=Ce.indexedDB)||Ie===Nn||$i(De,Ce.IDBKeyRange).put({name:Ie}).catch(ce)),G()},H)}).catch(function(G){switch(G==null?void 0:G.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),E();break;case"VersionError":if(0<p)return p=0,E()}return Ae.reject(G)})}var q,ee=i.dbReadyResolve,B=null,M=!1;return Ae.race([v,(typeof navigator>"u"?Ae.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(G){function H(){return indexedDB.databases().finally(G)}q=setInterval(H,100),H()}).finally(function(){return clearInterval(q)}):Promise.resolve()).then(E)]).then(function(){return k(),i.onReadyBeingFired=[],Ae.resolve(to(function(){return r.on.ready.fire(r.vip)})).then(function G(){var H;if(0<i.onReadyBeingFired.length)return H=i.onReadyBeingFired.reduce(Ue,ce),i.onReadyBeingFired=[],Ae.resolve(to(function(){return H(r.vip)})).then(G)})}).finally(function(){i.openCanceller===v&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(G){i.dbOpenError=G;try{B&&B.abort()}catch{}return v===i.openCanceller&&r._close(),je(G)}).finally(function(){i.openComplete=!0,ee()}).then(function(){var G;return M&&(G={},r.tables.forEach(function(H){H.schema.indexes.forEach(function(F){F.name&&(G["idb://".concat(r.name,"/").concat(H.name,"/").concat(F.name)]=new xn(-1/0,[[[]]]))}),G["idb://".concat(r.name,"/").concat(H.name,"/")]=G["idb://".concat(r.name,"/").concat(H.name,"/:dels")]=new xn(-1/0,[[[]]])}),Qr(vs).fire(G),io(G,!0)),r})}function oo(r){function i(y){return r.next(y)}var c=p(i),v=p(function(y){return r.throw(y)});function p(y){return function(E){var E=y(E),q=E.value;return E.done?q:q&&typeof q.then=="function"?q.then(c,v):d(q)?Promise.all(q).then(c,v):c(q)}}return p(i)()}function si(r,i,c){for(var v=d(r)?r.slice():[r],p=0;p<c;++p)v.push(i);return v}var rv={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(v){var c=r.table(v),v=c.schema,p={},y=[];function k(G,H,F){var J=ps(G),D=p[J]=p[J]||[],re=G==null?0:typeof G=="string"?1:G.length,de=0<H,J=a(a({},F),{name:de?"".concat(J,"(virtual-from:").concat(F.name,")"):F.name,lowLevelIndex:F,isVirtual:de,keyTail:H,keyLength:re,extractKey:Qi(G),unique:!de&&F.unique});return D.push(J),J.isPrimaryKey||y.push(J),1<re&&k(re===2?G[0]:G.slice(0,re-1),H+1,F),D.sort(function(ye,Ie){return ye.keyTail-Ie.keyTail}),J}var E=k(v.primaryKey.keyPath,0,v.primaryKey);p[":id"]=[E];for(var q=0,ee=v.indexes;q<ee.length;q++){var B=ee[q];k(B.keyPath,0,B)}function M(G){var H,F=G.query.index;return F.isVirtual?a(a({},G),{query:{index:F.lowLevelIndex,range:(H=G.query.range,F=F.keyTail,{type:H.type===1?2:H.type,lower:si(H.lower,H.lowerOpen?r.MAX_KEY:r.MIN_KEY,F),lowerOpen:!0,upper:si(H.upper,H.upperOpen?r.MIN_KEY:r.MAX_KEY,F),upperOpen:!0})}}):G}return a(a({},c),{schema:a(a({},v),{primaryKey:E,indexes:y,getIndexByKeyPath:function(G){return(G=p[ps(G)])&&G[0]}}),count:function(G){return c.count(M(G))},query:function(G){return c.query(M(G))},openCursor:function(G){var H=G.query.index,F=H.keyTail,D=H.keyLength;return H.isVirtual?c.openCursor(M(G)).then(function(de){return de&&re(de)}):c.openCursor(G);function re(de){return Object.create(de,{continue:{value:function(J){J!=null?de.continue(si(J,G.reverse?r.MAX_KEY:r.MIN_KEY,F)):G.unique?de.continue(de.key.slice(0,D).concat(G.reverse?r.MIN_KEY:r.MAX_KEY,F)):de.continue()}},continuePrimaryKey:{value:function(J,ye){de.continuePrimaryKey(si(J,r.MAX_KEY,F),ye)}},primaryKey:{get:function(){return de.primaryKey}},key:{get:function(){var J=de.key;return D===1?J[0]:J.slice(0,D)}},value:{get:function(){return de.value}}})}}})}})}};function lo(r,i,c,v){return c=c||{},v=v||"",u(r).forEach(function(p){var y,k,E;x(i,p)?(y=r[p],k=i[p],typeof y=="object"&&typeof k=="object"&&y&&k?(E=$(y))!==$(k)?c[v+p]=i[p]:E==="Object"?lo(y,k,c,v+p+"."):y!==k&&(c[v+p]=i[p]):y!==k&&(c[v+p]=i[p])):c[v+p]=void 0}),u(i).forEach(function(p){x(r,p)||(c[v+p]=i[p])}),c}function co(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var av={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(i){var c=r.table(i),v=c.schema.primaryKey;return a(a({},c),{mutate:function(p){var y=Me.trans,k=y.table(i).hook,E=k.deleting,q=k.creating,ee=k.updating;switch(p.type){case"add":if(q.fire===ce)break;return y._promise("readwrite",function(){return B(p)},!0);case"put":if(q.fire===ce&&ee.fire===ce)break;return y._promise("readwrite",function(){return B(p)},!0);case"delete":if(E.fire===ce)break;return y._promise("readwrite",function(){return B(p)},!0);case"deleteRange":if(E.fire===ce)break;return y._promise("readwrite",function(){return(function M(G,H,F){return c.query({trans:G,values:!1,query:{index:v,range:H},limit:F}).then(function(D){var re=D.result;return B({type:"delete",keys:re,trans:G}).then(function(de){return 0<de.numFailures?Promise.reject(de.failures[0]):re.length<F?{failures:[],numFailures:0,lastResult:void 0}:M(G,a(a({},H),{lower:re[re.length-1],lowerOpen:!0}),F)})})})(p.trans,p.range,1e4)},!0)}return c.mutate(p);function B(M){var G,H,F,D=Me.trans,re=M.keys||co(v,M);if(re)return(M=M.type==="add"||M.type==="put"?a(a({},M),{keys:re}):a({},M)).type!=="delete"&&(M.values=s([],M.values)),M.keys&&(M.keys=s([],M.keys)),G=c,F=re,((H=M).type==="add"?Promise.resolve([]):G.getMany({trans:H.trans,keys:F,cache:"immutable"})).then(function(de){var J=re.map(function(ye,Ie){var De,Le,Ce,Ge=de[Ie],Fe={onerror:null,onsuccess:null};return M.type==="delete"?E.fire.call(Fe,ye,Ge,D):M.type==="add"||Ge===void 0?(De=q.fire.call(Fe,ye,M.values[Ie],D),ye==null&&De!=null&&(M.keys[Ie]=ye=De,v.outbound||P(M.values[Ie],v.keyPath,ye))):(De=lo(Ge,M.values[Ie]),(Le=ee.fire.call(Fe,De,ye,Ge,D))&&(Ce=M.values[Ie],Object.keys(Le).forEach(function(Re){x(Ce,Re)?Ce[Re]=Le[Re]:P(Ce,Re,Le[Re])}))),Fe});return c.mutate(M).then(function(ye){for(var Ie=ye.failures,De=ye.results,Le=ye.numFailures,ye=ye.lastResult,Ce=0;Ce<re.length;++Ce){var Ge=(De||re)[Ce],Fe=J[Ce];Ge==null?Fe.onerror&&Fe.onerror(Ie[Ce]):Fe.onsuccess&&Fe.onsuccess(M.type==="put"&&de[Ce]?M.values[Ce]:Ge)}return{failures:Ie,results:De,numFailures:Le,lastResult:ye}}).catch(function(ye){return J.forEach(function(Ie){return Ie.onerror&&Ie.onerror(ye)}),Promise.reject(ye)})});throw new Error("Keys missing")}}})}})}};function $l(r,i,c){try{if(!i||i.keys.length<r.length)return null;for(var v=[],p=0,y=0;p<i.keys.length&&y<r.length;++p)Et(i.keys[p],r[y])===0&&(v.push(c?le(i.values[p]):i.values[p]),++y);return v.length===r.length?v:null}catch{return null}}var sv={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var c=r.table(i);return a(a({},c),{getMany:function(v){var p;return v.cache?(p=$l(v.keys,v.trans._cache,v.cache==="clone"))?Ae.resolve(p):c.getMany(v).then(function(y){return v.trans._cache={keys:v.keys,values:v.cache==="clone"?le(y):y},y}):c.getMany(v)},mutate:function(v){return v.type!=="add"&&(v.trans._cache=null),c.mutate(v)}})}}}};function ec(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function tc(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var iv={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,c=new xn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(v,p,y){if(Me.subscr&&p!=="readonly")throw new U.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Me.querier));return r.transaction(v,p,y)},table:function(v){function p(re){var D,re=re.query;return[D=re.index,new xn((D=(re=re.range).lower)!=null?D:r.MIN_KEY,(D=re.upper)!=null?D:r.MAX_KEY)]}var y=r.table(v),k=y.schema,E=k.primaryKey,q=k.indexes,ee=E.extractKey,B=E.outbound,M=E.autoIncrement&&q.filter(function(F){return F.compound&&F.keyPath.includes(E.keyPath)}),G=a(a({},y),{mutate:function(F){function D(We){return We="idb://".concat(i,"/").concat(v,"/").concat(We),Ie[We]||(Ie[We]=new xn)}var re,de,J,ye=F.trans,Ie=F.mutatedParts||(F.mutatedParts={}),De=D(""),Le=D(":dels"),Ce=F.type,Fe=F.type==="deleteRange"?[F.range]:F.type==="delete"?[F.keys]:F.values.length<50?[co(E,F).filter(function(We){return We}),F.values]:[],Ge=Fe[0],Fe=Fe[1],Re=F.trans._cache;return d(Ge)?(De.addKeys(Ge),(Ce=Ce==="delete"||Ge.length===Fe.length?$l(Ge,Re):null)||Le.addKeys(Ge),(Ce||Fe)&&(re=D,de=Ce,J=Fe,k.indexes.forEach(function(We){var Tt=re(We.name||"");function Mt(mt){return mt!=null?We.extractKey(mt):null}function et(mt){We.multiEntry&&d(mt)?mt.forEach(function(nn){return Tt.addKey(nn)}):Tt.addKey(mt)}(de||J).forEach(function(mt,an){var $n=de&&Mt(de[an]),an=J&&Mt(J[an]);Et($n,an)!==0&&($n!=null&&et($n),an!=null)&&et(an)})}))):Ge?(Fe={from:(Re=Ge.lower)!=null?Re:r.MIN_KEY,to:(Ce=Ge.upper)!=null?Ce:r.MAX_KEY},Le.add(Fe),De.add(Fe)):(De.add(c),Le.add(c),k.indexes.forEach(function(We){return D(We.name).add(c)})),y.mutate(F).then(function(We){return!Ge||F.type!=="add"&&F.type!=="put"||(De.addKeys(We.results),M&&M.forEach(function(Tt){for(var Mt=F.values.map(function($n){return Tt.extractKey($n)}),et=Tt.keyPath.findIndex(function($n){return $n===E.keyPath}),mt=0,nn=We.results.length;mt<nn;++mt)Mt[mt][et]=We.results[mt];D(Tt.name).addKeys(Mt)})),ye.mutatedParts=ri(ye.mutatedParts||{},Ie),We})}}),H={get:function(F){return[E,new xn(F.key)]},getMany:function(F){return[E,new xn().addKeys(F.keys)]},count:p,query:p,openCursor:p};return u(H).forEach(function(F){G[F]=function(D){var re=Me.subscr,de=!!re,J=ec(Me,y)&&tc(F,D)?D.obsSet={}:re;if(de){var ye,re=function(Fe){return Fe="idb://".concat(i,"/").concat(v,"/").concat(Fe),J[Fe]||(J[Fe]=new xn)},Ie=re(""),De=re(":dels"),de=H[F](D),Le=de[0],de=de[1];if((F==="query"&&Le.isPrimaryKey&&!D.values?De:re(Le.name||"")).add(de),!Le.isPrimaryKey){if(F!=="count")return ye=F==="query"&&B&&D.values&&y.query(a(a({},D),{values:!1})),y[F].apply(this,arguments).then(function(Fe){if(F==="query"){if(B&&D.values)return ye.then(function(Mt){return Mt=Mt.result,Ie.addKeys(Mt),Fe});var Re=D.values?Fe.result.map(ee):Fe.result;(D.values?Ie:De).addKeys(Re)}else{var We,Tt;if(F==="openCursor")return Tt=D.values,(We=Fe)&&Object.create(We,{key:{get:function(){return De.addKey(We.primaryKey),We.key}},primaryKey:{get:function(){var Mt=We.primaryKey;return De.addKey(Mt),Mt}},value:{get:function(){return Tt&&Ie.addKey(We.primaryKey),We.value}}})}return Fe});De.add(c)}}return y[F].apply(this,arguments)}}),G}})}};function nc(r,i,c){var v;return c.numFailures===0?i:i.type==="deleteRange"||(v=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,c.numFailures===v)?null:(v=a({},i),d(v.keys)&&(v.keys=v.keys.filter(function(p,y){return!(y in c.failures)})),"values"in v&&d(v.values)&&(v.values=v.values.filter(function(p,y){return!(y in c.failures)})),v)}function uo(r,i){return c=r,((v=i).lower===void 0||(v.lowerOpen?0<Et(c,v.lower):0<=Et(c,v.lower)))&&(c=r,(v=i).upper===void 0||(v.upperOpen?Et(c,v.upper)<0:Et(c,v.upper)<=0));var c,v}function rc(r,i,c,v,p,y){var k,E,q,ee,B,M;return!c||c.length===0||(k=i.query.index,E=k.multiEntry,q=i.query.range,ee=v.schema.primaryKey.extractKey,B=k.extractKey,M=(k.lowLevelIndex||k).extractKey,(v=c.reduce(function(G,H){var F=G,D=[];if(H.type==="add"||H.type==="put")for(var re=new xn,de=H.values.length-1;0<=de;--de){var J,ye=H.values[de],Ie=ee(ye);!re.hasKey(Ie)&&(J=B(ye),E&&d(J)?J.some(function(Fe){return uo(Fe,q)}):uo(J,q))&&(re.addKey(Ie),D.push(ye))}switch(H.type){case"add":var De=new xn().addKeys(i.values?G.map(function(Re){return ee(Re)}):G),F=G.concat(i.values?D.filter(function(Re){return Re=ee(Re),!De.hasKey(Re)&&(De.addKey(Re),!0)}):D.map(function(Re){return ee(Re)}).filter(function(Re){return!De.hasKey(Re)&&(De.addKey(Re),!0)}));break;case"put":var Le=new xn().addKeys(H.values.map(function(Re){return ee(Re)}));F=G.filter(function(Re){return!Le.hasKey(i.values?ee(Re):Re)}).concat(i.values?D:D.map(function(Re){return ee(Re)}));break;case"delete":var Ce=new xn().addKeys(H.keys);F=G.filter(function(Re){return!Ce.hasKey(i.values?ee(Re):Re)});break;case"deleteRange":var Ge=H.range;F=G.filter(function(Re){return!uo(ee(Re),Ge)})}return F},r))===r)?r:(v.sort(function(G,H){return Et(M(G),M(H))||Et(ee(G),ee(H))}),i.limit&&i.limit<1/0&&(v.length>i.limit?v.length=i.limit:r.length===i.limit&&v.length<i.limit&&(p.dirty=!0)),y?Object.freeze(v):v)}function ac(r,i){return Et(r.lower,i.lower)===0&&Et(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function ov(r,i){return((c,v,p,y)=>{if(c===void 0)return v!==void 0?-1:0;if(v===void 0)return 1;if((c=Et(c,v))===0){if(p&&y)return 0;if(p)return 1;if(y)return-1}return c})(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=((c,v,p,y)=>{if(c===void 0)return v!==void 0?1:0;if(v===void 0)return-1;if((c=Et(c,v))===0){if(p&&y)return 0;if(p)return-1;if(y)return 1}return c})(r.upper,i.upper,r.upperOpen,i.upperOpen)}function lv(r,i,c,v){r.subscribers.add(c),v.addEventListener("abort",function(){var p,y;r.subscribers.delete(c),r.subscribers.size===0&&(p=r,y=i,setTimeout(function(){p.subscribers.size===0&&X(y,p)},3e3))})}var cv={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return a(a({},r),{transaction:function(c,v,p){var y,k,E=r.transaction(c,v,p);return v==="readwrite"&&(p=(y=new AbortController).signal,E.addEventListener("abort",(k=function(q){return function(){if(y.abort(),v==="readwrite"){for(var ee=new Set,B=0,M=c;B<M.length;B++){var G=M[B],H=ua["idb://".concat(i,"/").concat(G)];if(H){var F=r.table(G),D=H.optimisticOps.filter(function(We){return We.trans===E});if(E._explicit&&q&&E.mutatedParts)for(var re=0,de=Object.values(H.queries.query);re<de.length;re++)for(var J=0,ye=(Le=de[re]).slice();J<ye.length;J++)ro((Ce=ye[J]).obsSet,E.mutatedParts)&&(X(Le,Ce),Ce.subscribers.forEach(function(We){return ee.add(We)}));else if(0<D.length){H.optimisticOps=H.optimisticOps.filter(function(We){return We.trans!==E});for(var Ie=0,De=Object.values(H.queries.query);Ie<De.length;Ie++)for(var Le,Ce,Ge,Fe=0,Re=(Le=De[Ie]).slice();Fe<Re.length;Fe++)(Ce=Re[Fe]).res!=null&&E.mutatedParts&&(q&&!Ce.dirty?(Ge=Object.isFrozen(Ce.res),Ge=rc(Ce.res,Ce.req,D,F,Ce,Ge),Ce.dirty?(X(Le,Ce),Ce.subscribers.forEach(function(We){return ee.add(We)})):Ge!==Ce.res&&(Ce.res=Ge,Ce.promise=Ae.resolve({result:Ge}))):(Ce.dirty&&X(Le,Ce),Ce.subscribers.forEach(function(We){return ee.add(We)})))}}}ee.forEach(function(We){return We()})}}})(!1),{signal:p}),E.addEventListener("error",k(!1),{signal:p}),E.addEventListener("complete",k(!0),{signal:p})),E},table:function(c){var v=r.table(c),p=v.schema.primaryKey;return a(a({},v),{mutate:function(y){var k,E=Me.trans;return!p.outbound&&E.db._options.cache!=="disabled"&&!E.explicit&&E.idbtrans.mode==="readwrite"&&(k=ua["idb://".concat(i,"/").concat(c)])?(E=v.mutate(y),y.type!=="add"&&y.type!=="put"||!(50<=y.values.length||co(p,y).some(function(q){return q==null}))?(k.optimisticOps.push(y),y.mutatedParts&&ai(y.mutatedParts),E.then(function(q){0<q.numFailures&&(X(k.optimisticOps,y),(q=nc(0,y,q))&&k.optimisticOps.push(q),y.mutatedParts)&&ai(y.mutatedParts)}),E.catch(function(){X(k.optimisticOps,y),y.mutatedParts&&ai(y.mutatedParts)})):E.then(function(q){var ee=nc(0,a(a({},y),{values:y.values.map(function(B,M){var G;return q.failures[M]?B:(P(G=(G=p.keyPath)!=null&&G.includes(".")?le(B):a({},B),p.keyPath,q.results[M]),G)})}),q);k.optimisticOps.push(ee),queueMicrotask(function(){return y.mutatedParts&&ai(y.mutatedParts)})}),E):v.mutate(y)},query:function(y){var k,E,q,ee,B,M,G;return ec(Me,v)&&tc("query",y)?(k=((q=Me.trans)==null?void 0:q.db._options.cache)==="immutable",E=(q=Me).requery,q=q.signal,M=((H,F,D,re)=>{var de=ua["idb://".concat(H,"/").concat(F)];if(!de)return[];if(!(H=de.queries[D]))return[null,!1,de,null];var J=H[(re.query?re.query.index.name:null)||""];if(!J)return[null,!1,de,null];switch(D){case"query":var ye=J.find(function(Ie){return Ie.req.limit===re.limit&&Ie.req.values===re.values&&ac(Ie.req.query.range,re.query.range)});return ye?[ye,!0,de,J]:[J.find(function(Ie){return("limit"in Ie.req?Ie.req.limit:1/0)>=re.limit&&(!re.values||Ie.req.values)&&ov(Ie.req.query.range,re.query.range)}),!1,de,J];case"count":return ye=J.find(function(Ie){return ac(Ie.req.query.range,re.query.range)}),[ye,!!ye,de,J]}})(i,c,"query",y),G=M[0],ee=M[2],B=M[3],G&&M[1]?G.obsSet=y.obsSet:(M=v.query(y).then(function(H){var F=H.result;if(G&&(G.res=F),k){for(var D=0,re=F.length;D<re;++D)Object.freeze(F[D]);Object.freeze(F)}else H.result=le(F);return H}).catch(function(H){return B&&G&&X(B,G),Promise.reject(H)}),G={obsSet:y.obsSet,promise:M,subscribers:new Set,type:"query",req:y,dirty:!1},B?B.push(G):(B=[G],(ee=ee||(ua["idb://".concat(i,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[y.query.index.name||""]=B)),lv(G,B,E,q),G.promise.then(function(H){return{result:rc(H.result,y,ee==null?void 0:ee.optimisticOps,v,G,k)}})):v.query(y)}})}})}};function ii(r,i){return new Proxy(r,{get:function(c,v,p){return v==="db"?i:Reflect.get(c,v,p)}})}cn.prototype.version=function(r){if(isNaN(r)||r<.1)throw new U.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new U.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,c=i.filter(function(v){return v._cfg.version===r})[0];return c||(c=new this.Version(r),i.push(c),i.sort(Jd),c.stores({}),this._state.autoSchema=!1),c},cn.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||Me.letThrough||this._vip)?r():new Ae(function(c,v){if(i._state.openComplete)return v(new U.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void v(new U.DatabaseClosed);i.open().catch(ce)}i._state.dbReadyPromise.then(c,v)}).then(r)},cn.prototype.use=function(p){var i=p.stack,c=p.create,v=p.level,p=p.name,y=(p&&this.unuse({stack:i,name:p}),this._middlewares[i]||(this._middlewares[i]=[]));return y.push({stack:i,create:c,level:v??10,name:p}),y.sort(function(k,E){return k.level-E.level}),this},cn.prototype.unuse=function(r){var i=r.stack,c=r.name,v=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(p){return v?p.create!==v:!!c&&p.name!==c})),this},cn.prototype.open=function(){var r=this;return Ye(at,function(){return nv(r)})},cn.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,i=ln.indexOf(this);if(0<=i&&ln.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Ae(function(c){r.dbReadyResolve=c}),r.openCanceller=new Ae(function(c,v){r.cancelOpen=v}))},cn.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,c=this._state;i?(c.isBeingOpened&&c.cancelOpen(new U.DatabaseClosed),this._close(),c.autoOpen=!1,c.dbOpenError=new U.DatabaseClosed):(this._close(),c.autoOpen=this._options.autoOpen||c.isBeingOpened,c.openComplete=!1,c.dbOpenError=null)},cn.prototype.delete=function(r){var i=this,c=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),v=this._state;return new Ae(function(p,y){function k(){i.close(r);var E=i._deps.indexedDB.deleteDatabase(i.name);E.onsuccess=rt(function(){var q,ee,B;q=i._deps,ee=i.name,eo(B=q.indexedDB)||ee===Nn||$i(B,q.IDBKeyRange).delete(ee).catch(ce),p()}),E.onerror=wr(y),E.onblocked=i._fireOnBlocked}if(c)throw new U.InvalidArgument("Invalid closeOptions argument to db.delete()");v.isBeingOpened?v.dbReadyPromise.then(k):k()})},cn.prototype.backendDB=function(){return this.idbdb},cn.prototype.isOpen=function(){return this.idbdb!==null},cn.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},cn.prototype.hasFailed=function(){return this._state.dbOpenError!==null},cn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(cn.prototype,"tables",{get:function(){var r=this;return u(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),cn.prototype.transaction=function(){var r=(function(i,c,v){var p=arguments.length;if(p<2)throw new U.InvalidArgument("Too few arguments");for(var y=new Array(p-1);--p;)y[p-1]=arguments[p];return v=y.pop(),[i,xe(y),v]}).apply(this,arguments);return this._transaction.apply(this,r)},cn.prototype._transaction=function(r,i,c){var v,p,y=this,k=Me.trans,E=(k&&k.db===this&&r.indexOf("!")===-1||(k=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(p=i.map(function(ee){if(ee=ee instanceof y.Table?ee.name:ee,typeof ee!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return ee}),r=="r"||r===br)v=br;else{if(r!="rw"&&r!=la)throw new U.InvalidArgument("Invalid transaction mode: "+r);v=la}if(k){if(k.mode===br&&v===la){if(!E)throw new U.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");k=null}k&&p.forEach(function(ee){if(k&&k.storeNames.indexOf(ee)===-1){if(!E)throw new U.SubTransaction("Table "+ee+" not included in parent transaction.");k=null}}),E&&k&&!k.active&&(k=null)}}catch(ee){return k?k._promise(null,function(B,M){M(ee)}):je(ee)}var q=(function ee(B,M,G,H,F){return Ae.resolve().then(function(){var J=Me.transless||Me,D=B._createTransaction(M,G,B._dbSchema,H),J=(D.explicit=!0,{trans:D,transless:J});if(H)D.idbtrans=H.idbtrans;else try{D.create(),D.idbtrans._explicit=!0,B._state.PR1398_maxLoop=3}catch(ye){return ye.name===be.InvalidState&&B.isOpen()&&0<--B._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),B.close({disableAutoOpen:!1}),B.open().then(function(){return ee(B,M,G,null,F)})):je(ye)}var re,de=Se(F),J=(de&&zt(),Ae.follow(function(){var ye;(re=F.call(D,D))&&(de?(ye=fn.bind(null,null),re.then(ye,ye)):typeof re.next=="function"&&typeof re.throw=="function"&&(re=oo(re)))},J));return(re&&typeof re.then=="function"?Ae.resolve(re).then(function(ye){return D.active?ye:je(new U.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):J.then(function(){return re})).then(function(ye){return H&&D._resolve(),D._completion.then(function(){return ye})}).catch(function(ye){return D._reject(ye),je(ye)})})}).bind(null,this,v,p,k,c);return k?k._promise(v,q,"lock"):Me.trans?Ye(Me.transless,function(){return y._whenReady(q)}):this._whenReady(q)},cn.prototype.table=function(r){if(x(this._allTables,r))return this._allTables[r];throw new U.InvalidTable("Table ".concat(r," does not exist"))};var Mr=cn;function cn(r,i){var c,v,p,y,k,E=this,q=(this._middlewares={},this.verno=0,cn.dependencies),q=(this._options=i=a({addons:cn.addons,autoOpen:!0,indexedDB:q.indexedDB,IDBKeyRange:q.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),ee=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ce,dbReadyPromise:null,cancelOpen:ce,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),B=(ee.dbReadyPromise=new Ae(function(M){ee.dbReadyResolve=M}),ee.openCanceller=new Ae(function(M,G){ee.cancelOpen=G}),this._state=ee,this.name=r,this.on=cs(this,"populate","blocked","versionchange","close",{ready:[Ue,ce]}),this.once=function(M,G){var H=function(){for(var F=[],D=0;D<arguments.length;D++)F[D]=arguments[D];E.on(M).unsubscribe(H),G.apply(E,F)};return E.on(M,H)},this.on.ready.subscribe=he(this.on.ready.subscribe,function(M){return function(G,H){cn.vip(function(){var F,D=E._state;D.openComplete?(D.dbOpenError||Ae.resolve().then(G),H&&M(G)):D.onReadyBeingFired?(D.onReadyBeingFired.push(G),H&&M(G)):(M(G),F=E,H||M(function re(){F.on.ready.unsubscribe(G),F.on.ready.unsubscribe(re)}))})}}),this.Collection=(c=this,us(Hd.prototype,function(re,D){this.db=c;var H=os,F=null;if(D)try{H=D()}catch(J){F=J}var D=re._ctx,re=D.table,de=re.hook.reading.fire;this._ctx={table:re,index:D.index,isPrimKey:!D.index||re.schema.primKey.keyPath&&D.index===re.schema.primKey.name,range:H,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:F,or:D.or,valueMapper:de!==Te?de:null}})),this.Table=(v=this,us(Bl.prototype,function(M,G,H){this.db=v,this._tx=H,this.name=M,this.schema=G,this.hook=v._allTables[M]?v._allTables[M].hook:cs(null,{creating:[vt,ce],reading:[qe,Te],updating:[Xe,ce],deleting:[_t,ce]})})),this.Transaction=(p=this,us(Yd.prototype,function(M,G,H,F,D){var re=this;M!=="readonly"&&G.forEach(function(de){de=(de=H[de])==null?void 0:de.yProps,de&&(G=G.concat(de.map(function(J){return J.updatesTable})))}),this.db=p,this.mode=M,this.storeNames=G,this.schema=H,this.chromeTransactionDurability=F,this.idbtrans=null,this.on=cs(this,"complete","error","abort"),this.parent=D||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ae(function(de,J){re._resolve=de,re._reject=J}),this._completion.then(function(){re.active=!1,re.on.complete.fire()},function(de){var J=re.active;return re.active=!1,re.on.error.fire(de),re.parent?re.parent._reject(de):J&&re.idbtrans&&re.idbtrans.abort(),je(de)})})),this.Version=(y=this,us(tv.prototype,function(M){this.db=y,this._cfg={version:M,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(k=this,us(Gl.prototype,function(M,G,H){if(this.db=k,this._ctx={table:M,index:G===":id"?null:G,or:H},this._cmp=this._ascending=Et,this._descending=function(F,D){return Et(D,F)},this._max=function(F,D){return 0<Et(F,D)?F:D},this._min=function(F,D){return Et(F,D)<0?F:D},this._IDBKeyRange=k._deps.IDBKeyRange,!this._IDBKeyRange)throw new U.MissingAPI})),this.on("versionchange",function(M){0<M.newVersion?console.warn("Another connection wants to upgrade database '".concat(E.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(E.name,"'. Closing db now to resume the delete request.")),E.close({disableAutoOpen:!1})}),this.on("blocked",function(M){!M.newVersion||M.newVersion<M.oldVersion?console.warn("Dexie.delete('".concat(E.name,"') was blocked")):console.warn("Upgrade '".concat(E.name,"' blocked by other connection holding version ").concat(M.oldVersion/10))}),this._maxKey=fs(i.IDBKeyRange),this._createTransaction=function(M,G,H,F){return new E.Transaction(M,G,H,E._options.chromeTransactionDurability,F)},this._fireOnBlocked=function(M){E.on("blocked").fire(M),ln.filter(function(G){return G.name===E.name&&G!==E&&!G._state.vcFired}).map(function(G){return G.on("versionchange").fire(M)})},this.use(sv),this.use(cv),this.use(iv),this.use(rv),this.use(av),new Proxy(this,{get:function(M,G,H){var F;return G==="_vip"||(G==="table"?function(D){return ii(E.table(D),B)}:(F=Reflect.get(M,G,H))instanceof Bl?ii(F,B):G==="tables"?F.map(function(D){return ii(D,B)}):G==="_createTransaction"?function(){return ii(F.apply(this,arguments),B)}:F)}}));this.vip=B,q.forEach(function(M){return M(E)})}var oi,za=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",uv=(vo.prototype.subscribe=function(r,i,c){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:c})},vo.prototype[za]=function(){return this},vo);function vo(r){this._subscribe=r}try{oi={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{oi={indexedDB:null,IDBKeyRange:null}}function sc(r){var i,c=!1,v=new uv(function(p){var y=Se(r),k,E=!1,q={},ee={},B={get closed(){return E},unsubscribe:function(){E||(E=!0,k&&k.abort(),M&&Qr.storagemutated.unsubscribe(H))}},M=(p.start&&p.start(B),!1),G=function(){return Pe(F)},H=function(D){ri(q,D),ro(ee,q)&&G()},F=function(){var D,re,de;!E&&oi.indexedDB&&(q={},D={},k&&k.abort(),k=new AbortController,de=(J=>{var ye=Dn();try{y&&zt();var Ie=Wt(r,J);return Ie=y?Ie.finally(fn):Ie}finally{ye&&st()}})(re={subscr:D,signal:k.signal,requery:G,querier:r,trans:null}),Promise.resolve(de).then(function(J){c=!0,i=J,E||re.signal.aborted||(q={},(ye=>{for(var Ie in ye)if(x(ye,Ie))return;return 1})(ee=D)||M||(Qr(vs,H),M=!0),Pe(function(){return!E&&p.next&&p.next(J)}))},function(J){c=!1,["DatabaseClosedError","AbortError"].includes(J==null?void 0:J.name)||E||Pe(function(){E||p.error&&p.error(J)})}))};return setTimeout(G,0),B});return v.hasValue=function(){return c},v.getValue=function(){return i},v}var da=Mr;function fo(r){var i=Xr;try{Xr=!0,Qr.storagemutated.fire(r),io(r,!0)}finally{Xr=i}}b(da,a(a({},me),{delete:function(r){return new da(r,{addons:[]}).delete()},exists:function(r){return new da(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=da.dependencies,c=i.indexedDB,i=i.IDBKeyRange,(eo(c)?Promise.resolve(c.databases()).then(function(v){return v.map(function(p){return p.name}).filter(function(p){return p!==Nn})}):$i(c,i).toCollection().primaryKeys()).then(r)}catch{return je(new U.MissingAPI)}var i,c},defineClass:function(){return function(r){g(this,r)}},ignoreTransaction:function(r){return Me.trans?Ye(Me.transless,r):r()},vip:to,async:function(r){return function(){try{var i=oo(r.apply(this,arguments));return i&&typeof i.then=="function"?i:Ae.resolve(i)}catch(c){return je(c)}}},spawn:function(r,i,c){try{var v=oo(r.apply(c,i||[]));return v&&typeof v.then=="function"?v:Ae.resolve(v)}catch(p){return je(p)}},currentTransaction:{get:function(){return Me.trans||null}},waitFor:function(r,i){return r=Ae.resolve(typeof r=="function"?da.ignoreTransaction(r):r).timeout(i||6e4),Me.trans?Me.trans.waitFor(r):r},Promise:Ae,debug:{get:function(){return Ke},set:function(r){ot(r)}},derive:L,extend:g,props:b,override:he,Events:cs,on:Qr,liveQuery:sc,extendObservabilitySet:ri,getByKeyPath:z,setByKeyPath:P,delByKeyPath:function(r,i){typeof i=="string"?P(r,i,void 0):"length"in i&&[].map.call(i,function(c){P(r,c,void 0)})},shallowClone:ue,deepClone:le,getObjectDiff:lo,cmp:Et,asap:N,minKey:-1/0,addons:[],connections:ln,errnames:be,dependencies:oi,cache:ua,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,c){return r+i/Math.pow(10,2*c)})})),da.maxKey=fs(da.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Qr(vs,function(r){Xr||(r=new CustomEvent(Wi,{detail:r}),Xr=!0,dispatchEvent(r),Xr=!1)}),addEventListener(Wi,function(r){r=r.detail,Xr||fo(r)}));var Ua,Xr=!1,ic=function(){};return typeof BroadcastChannel<"u"&&((ic=function(){(Ua=new BroadcastChannel(Wi)).onmessage=function(r){return r.data&&fo(r.data)}})(),typeof Ua.unref=="function"&&Ua.unref(),Qr(vs,function(r){Xr||Ua.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!Mr.disableBfCache&&r.persisted){Ke&&console.debug("Dexie: handling persisted pagehide"),Ua!=null&&Ua.close();for(var i=0,c=ln;i<c.length;i++)c[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!Mr.disableBfCache&&r.persisted&&(Ke&&console.debug("Dexie: handling persisted pageshow"),ic(),fo({all:new xn(-1/0,[[]])}))})),Ae.rejectionMapper=function(r,i){return!r||r instanceof V||r instanceof TypeError||r instanceof SyntaxError||!r.name||!Ee[r.name]?r:(i=new Ee[r.name](i||r.message,r),"stack"in r&&I(i,"stack",{get:function(){return this.inner.stack}}),i)},ot(Ke),a(Mr,Object.freeze({__proto__:null,Dexie:Mr,Entity:jl,PropModification:ls,RangeSet:xn,add:function(r){return new ls({add:r})},cmp:Et,default:Mr,liveQuery:sc,mergeRanges:ms,rangesOverlap:Ql,remove:function(r){return new ls({remove:r})},replacePrefix:function(r,i){return new ls({replacePrefix:[r,i]})}}),{default:Mr}),Mr})})(yi)),yi.exports}var Xf=Qf();const Uo=Vf(Xf),Sc=Symbol.for("Dexie"),En=globalThis[Sc]||(globalThis[Sc]=Uo);if(Uo.semVer!==En.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Uo.semVer} and ${En.semVer}`);const{liveQuery:ow,mergeRanges:lw,rangesOverlap:cw,RangeSet:uw,cmp:dw,Entity:vw,PropModification:fw,replacePrefix:pw,add:hw,remove:mw,DexieYProvider:gw}=En,Qe=new En("me-ai-store");Qe.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Qe.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Qe.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Qe.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});Qe.version(5).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]",settings:"&key"});Qe.version(6).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, group, date, scannedAt, status, *tags, [action+status], [group+status]",settings:"&key"});function pl(t,e){return`${t}:${e}`}const Zf=Object.freeze(Object.defineProperty({__proto__:null,db:Qe,makeItemId:pl},Symbol.toStringTag,{value:"Module"}));async function js(t,e=null){try{const n=await Qe.settings.get(t);return(n==null?void 0:n.value)??e}catch{return e}}async function Ds(t,e){try{await Qe.settings.put({key:t,value:e})}catch(n){console.error(`[settings] setSetting("${t}") failed:`,n)}}async function hl(t){try{await Qe.settings.delete(t)}catch{}}async function Jf(t){const e=await Qe.settings.bulkGet(t);return Object.fromEntries(t.map((n,a)=>{var s;return[n,((s=e[a])==null?void 0:s.value)??null]}))}const Wr=Object.freeze(Object.defineProperty({__proto__:null,getSetting:js,getSettings:Jf,removeSetting:hl,setSetting:Ds},Symbol.toStringTag,{value:"Module"})),Ir=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function ml(t){return Ir.find(e=>e.id===t)}const $f=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Ir,getModelInfo:ml},Symbol.toStringTag,{value:"Module"})),Cr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Ju(){return Cr.filter(t=>t.recommended)}function gl(t){return Cr.find(e=>e.name===t||e.name.startsWith(t+":"))}const ep=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:Cr,getOllamaModelInfo:gl,getRecommendedOllamaModels:Ju},Symbol.toStringTag,{value:"Module"}));let Fn=null,Br="idle",bi=null,pa=new Set;function di(){return Fn||(Fn=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),Fn.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Br="loading"),e.status==="ready"&&(Br="ready"),e.status==="start"&&(Br="generating"),(e.status==="complete"||e.status==="error")&&(Br=bi?"ready":"idle");for(const n of pa)try{n(e)}catch{}})),Fn}function wo(){return{check(){di().postMessage({type:"check"})},loadModel(t){bi=t,Br="loading",di().postMessage({type:"load",modelId:t})},generate(t,e){di().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,d=0,g=0;const m=x=>{switch(x.status){case"start":g=x.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=x.output,u=x.tps??u,d=x.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":_(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":_(),s(new Error(x.data));break}},_=()=>{pa.delete(m)};pa.add(m),di().postMessage({type:"generate",data:t,options:e})})},interrupt(){Fn==null||Fn.postMessage({type:"interrupt"})},reset(){Fn==null||Fn.postMessage({type:"reset"})},onMessage(t){return pa.add(t),()=>pa.delete(t)},offMessage(t){pa.delete(t)},get status(){return Br},get isReady(){return Br==="ready"},get isGenerating(){return Br==="generating"},get modelId(){return bi},terminate(){Fn==null||Fn.terminate(),Fn=null,Br="idle",bi=null,pa.clear()}}}const tp="modulepreload",np=function(t){return"/me-ai/"+t},Ec={},Zn=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let u=function(m){return Promise.all(m.map(_=>Promise.resolve(_).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));s=u(n.map(m=>{if(m=np(m),m in Ec)return;Ec[m]=!0;const _=m.endsWith(".css"),x=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${x}`))return;const b=document.createElement("link");if(b.rel=_?"stylesheet":tp,_||(b.as="script"),b.crossOrigin="",b.href=m,g&&b.setAttribute("nonce",g),document.head.appendChild(b),_)return new Promise((w,I)=>{b.addEventListener("load",w),b.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return s.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},Tc="http://localhost:11434",rp="https://me-ai.metaelon.space";function $u(){try{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"||t==="0.0.0.0"?Tc:rp}catch{return Tc}}function Hs(){return $u()}async function ap(){const{getSetting:t}=await Zn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Wr);return{getSetting:e}},void 0);return await t("ollamaUrl")||$u()}async function sp(t){const{setSetting:e}=await Zn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Wr);return{setSetting:n}},void 0);await e("ollamaUrl",t)}async function Ko(t=Hs()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return e.message.includes("CORS")||e.message.includes("Failed to fetch")||e.name==="TypeError"?{connected:!1,corsError:!0,error:"CORS error: Server must allow requests from this origin. Configure Access-Control-Allow-Origin header."}:{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function ip(t=Hs()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function op(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:s}={},o=()=>{},u=Hs()){var I;const d={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};s!==void 0?d.keep_alive=s:d.keep_alive="10m";const g=new AbortController,m=setTimeout(()=>g.abort(),3e5),_=await fetch(`${u}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:g.signal});if(clearTimeout(m),!_.ok){const L=await _.text();throw new Error(`Ollama API error: ${L}`)}const x=_.body.getReader(),b=new TextDecoder;let w="";try{for(;;){const{done:L,value:O}=await x.read();if(L)break;const ie=b.decode(O).split(`
`).filter(Boolean);for(const he of ie)try{const W=JSON.parse(he);if((I=W.message)!=null&&I.content&&(w+=W.message.content,o({content:W.message.content,done:!1,total_duration:W.total_duration,eval_count:W.eval_count,eval_duration:W.eval_duration})),W.done){o({content:"",done:!0,total_duration:W.total_duration,eval_count:W.eval_count,eval_duration:W.eval_duration});break}}catch{}}}finally{x.releaseLock()}return w}let Hn="idle",Ka=null,ha=new Set;function cr(t){for(const e of ha)try{e(t)}catch{}}function lp(){return{async check(){Hn="loading",cr({status:"loading",data:"Testing Ollama connection..."});const t=await Ko();t.connected?(Hn="idle",cr({status:"ready",data:{type:"ollama",version:t.version,url:Hs()}})):(Hn="idle",cr({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ka=t,Hn="loading",cr({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Ko();if(!e.connected){Hn="idle",Ka=null,cr({status:"error",data:`Ollama not available: ${e.error}`});return}Hn="ready",cr({status:"ready"})},async generate(t,e={}){if(!Ka){cr({status:"error",data:"No Ollama model selected"});return}Hn="generating",cr({status:"start",inputTokens:0});let n=0,a=performance.now();try{await op(Ka,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},s=>{if(s.content){n++;const o=performance.now()-a,u=o>0?n/o*1e3:0;cr({status:"update",output:s.content,tps:Math.round(u*10)/10,numTokens:n})}s.done&&(Hn="ready",cr({status:"complete",tps:s.eval_duration?Math.round(s.eval_count/(s.eval_duration/1e9)*10)/10:null,numTokens:s.eval_count||n}))})}catch(s){Hn="ready",cr({status:"error",data:s.message})}},generateFull(t,e,n){return new Promise((a,s)=>{let o="",u=null,d=0,g=0;const m=x=>{switch(x.status){case"start":g=x.inputTokens||0;break;case"update":if(o+=x.output,u=x.tps??u,d=x.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":_(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":_(),s(new Error(x.data));break}},_=()=>{ha.delete(m)};ha.add(m),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return ha.add(t),()=>ha.delete(t)},offMessage(t){ha.delete(t)},get status(){return Hn},get isReady(){return Hn==="ready"},get isGenerating(){return Hn==="generating"},get modelId(){return Ka},get backend(){return"ollama"},terminate(){Hn="idle",Ka=null,ha.clear()}}}let fa=null,ft=null,ko=new Set;function cp(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function ed(){return{loadModel(t){const e=cp(t);if(fa!==e){ft&&ft.terminate(),fa=e,ft=e==="webgpu"?wo():lp();for(const n of ko)ft.onMessage(n)}ft.loadModel(t)},check(){ft||(ft=wo(),fa="webgpu"),ft.check()},generate(t,e){if(!ft)throw new Error("No engine loaded. Call loadModel() first.");return ft.generate(t,e)},generateFull(t,e,n){return ft?ft.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){ft==null||ft.interrupt()},reset(){ft==null||ft.reset()},onMessage(t){return ft||(ft=wo(),fa="webgpu"),ko.add(t),ft.onMessage(t)},offMessage(t){ko.delete(t),ft==null||ft.offMessage(t)},get status(){return(ft==null?void 0:ft.status)||"idle"},get isReady(){return(ft==null?void 0:ft.isReady)||!1},get isGenerating(){return(ft==null?void 0:ft.isGenerating)||!1},get modelId(){return(ft==null?void 0:ft.modelId)||null},get backend(){return fa},getModelInfo(){const t=this.modelId;return t?fa==="webgpu"?ml(t):gl(t):null},terminate(){ft==null||ft.terminate(),ft=null,fa=null}}}function Go(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function xo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),s=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return s.toFixed(o)+" "+n[a]}function up(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function dp(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Li(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const vp="https://gmail.googleapis.com/gmail/v1/users/me";class _l extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function fp(t){return{Authorization:`Bearer ${t}`}}async function Ni(t,e){var a,s,o,u;const n=await fetch(`${vp}${e}`,{headers:fp(t)});if(!n.ok){const d=await n.json().catch(()=>({})),g=((a=d.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,m=((u=(o=(s=d.error)==null?void 0:s.errors)==null?void 0:o[0])==null?void 0:u.reason)||void 0;throw new _l(g,n.status,m)}return n.json()}function td(t){return Ni(t,"/profile")}function nd(t,{maxResults:e=20,pageToken:n,q:a}={}){const s=new URLSearchParams;return s.set("maxResults",String(e)),n&&s.set("pageToken",n),a&&s.set("q",a),Ni(t,`/messages?${s}`)}function rd(t,e,n="full"){return Ni(t,`/messages/${e}?format=${n}`)}function pp(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const s=new URLSearchParams;return s.set("startHistoryId",e),s.set("maxResults",String(a)),s.append("historyTypes","messageAdded"),s.append("historyTypes","messageDeleted"),n&&s.set("pageToken",n),Ni(t,`/history?${s}`)}function Jr(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),s=n.find(u=>u.name.toLowerCase()===a);return(s==null?void 0:s.value)||""}function Ps(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),s=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(s)}function hp(t){var o,u,d;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Ps(e.body.data);const n=e.parts||[],a=xi(n,"text/plain");if((u=a==null?void 0:a.body)!=null&&u.data)return Ps(a.body.data);const s=xi(n,"text/html");if((d=s==null?void 0:s.body)!=null&&d.data){const g=Ps(s.body.data);return gp(g)}return"(no body)"}function mp(t){var s,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((s=e.body)!=null&&s.data))return Ps(e.body.data);const n=e.parts||[],a=xi(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Ps(a.body.data):null}function xi(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=xi(n.parts,e);if(a)return a}}return null}function gp(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function yl(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function ad(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function sd(t){return ad(t).charAt(0).toUpperCase()}function _p(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${s}`}catch{return"email"}}function yp(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function id(t,e){return`${_p(t.date)}_${yp(t.subject)}.${e}`}function od(t){const e={};for(const a of t){const s=a.action||"UNKNOWN";e[s]||(e[s]=[]),e[s].push(a)}for(const a of Object.keys(e))e[a].sort((s,o)=>(o.date||0)-(s.date||0));const n=Object.keys(e).sort((a,s)=>e[s].length-e[a].length);return{groups:e,order:n}}async function bp(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:s}=await ld();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`Date range: ${o} to ${u}.`)}return n.join(" ")}async function wp(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:s}=await ld();if(a&&s){const o=new Date(a.date).toLocaleDateString(),u=new Date(s.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${u}`)}return n.join(`
`)}async function kp(t=10){const e=await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(cd).join(`

---

`)}async function xp(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),s=(await Qe.items.where("sourceType").equals("gmail").toArray()).map(o=>{var d,g,m,_,x;let u=0;return(d=o.subject)!=null&&d.toLowerCase().includes(n)&&(u+=3),(g=o.from)!=null&&g.toLowerCase().includes(n)&&(u+=2),(m=o.to)!=null&&m.toLowerCase().includes(n)&&(u+=2),(_=o.snippet)!=null&&_.toLowerCase().includes(n)&&(u+=1),(x=o.body)!=null&&x.toLowerCase().includes(n)&&(u+=1),{item:o,score:u}}).filter(({score:o})=>o>0).sort((o,u)=>u.score-o.score).slice(0,e);return s.length===0?`No results found for "${t}".`:s.map(({item:o})=>cd(o)).join(`

---

`)}async function Ac(){const t=await Qe.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=od(t);return{groups:e,order:n,total:t.length}}async function Sp({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),u=await Qe.items.where("sourceType").equals("gmail").filter(d=>{var g,m,_,x;return((g=d.subject)==null?void 0:g.toLowerCase().includes(o))||((m=d.from)==null?void 0:m.toLowerCase().includes(o))||((_=d.to)==null?void 0:_.toLowerCase().includes(o))||((x=d.snippet)==null?void 0:x.toLowerCase().includes(o))}).toArray();return u.sort((d,g)=>(g.date||0)-(d.date||0)),{items:u.slice(n,n+e),total:u.length}}const a=await Qe.items.where("sourceType").equals("gmail").count();return{items:await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function ld(){const t=await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).first(),e=await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).last();return{oldest:t,newest:e}}function cd(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=dp(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function Ep(){const t=await bp();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function Tp(t){const e=[],n=await wp();if(e.push(n),t){const a=await xp(t,5);e.push("","## Relevant Emails",a)}else{const a=await kp(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const ia={NOISE:{id:"NOISE",label:"Noise",description:"Unimportant emails that can be safely deleted or archived automatically.",autoExecute:!0,requiresApproval:!1,color:"#6b7280"},INFO:{id:"INFO",label:"Info",description:"Informational emails to review. Actions run on user request.",autoExecute:!1,requiresApproval:!1,color:"#3b82f6"},CRITICAL:{id:"CRITICAL",label:"Critical",description:"High-stakes emails that change state. User must approve before any action runs.",autoExecute:!1,requiresApproval:!0,color:"#f59e0b"}},bl="INFO",ud="me-ai-events",dd="me-ai-event-groups";async function ss(){const{getSetting:t}=await Zn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Wr);return{getSetting:e}},void 0);return await t(ud)||{}}async function qi(t){const{setSetting:e}=await Zn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Wr);return{setSetting:n}},void 0);await e(ud,t)}async function Bi(){const{getSetting:t}=await Zn(async()=>{const{getSetting:e}=await Promise.resolve().then(()=>Wr);return{getSetting:e}},void 0);return await t(dd)||{}}async function vd(t){const{setSetting:e}=await Zn(async()=>{const{setSetting:n}=await Promise.resolve().then(()=>Wr);return{setSetting:n}},void 0);await e(dd,t)}async function Ap(){try{const{db:t}=await Zn(async()=>{const{db:a}=await Promise.resolve().then(()=>Zf);return{db:a}},void 0),e=await t.emailClassifications.toArray();return[...new Set(e.map(a=>a.action).filter(Boolean))].sort()}catch{return[]}}async function Ip(){const t=await ss(),e=await Ap();return[...new Set([...Object.keys(t),...e])].sort()}async function Si(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"";return(await Bi())[e]||bl}async function Cp(t,e){const n=t.toUpperCase();if(!ia[e])throw new Error(`Unknown group: ${e}`);const a=await Bi();a[n]=e,await vd(a)}async function Pp(){return Bi()}async function fd(t){const e=await Si(t),n=ia[e]||ia[bl];return{autoExecute:n.autoExecute,requiresApproval:n.requiresApproval,group:e}}async function Or(t){var a;const e=((a=t==null?void 0:t.toUpperCase)==null?void 0:a.call(t))||"";return(await ss())[e]||[]}const So=Or;async function Op(t){const e=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!e)return;const n=await ss();e in n||(n[e]=[],await qi(n))}async function Rp(t,e,n){const a=t.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");if(!a)return;const s=await ss(),o=await Bi();if(!(a in o)){const u=ia[e]?e:bl;o[a]=u,await vd(o)}if(!(a in s)){const{pluginRegistry:u}=await Zn(async()=>{const{pluginRegistry:_}=await Promise.resolve().then(()=>Qp);return{pluginRegistry:_}},void 0),d=u.getAvailableActions("gmail"),g=Object.fromEntries(d.map(_=>[_.actionId,_])),m=(n||[]).filter(_=>g[_]).map(_=>({id:_,pluginId:"gmail",commandId:_,name:g[_].name,description:g[_].description}));s[a]=m,await qi(s)}}async function Mp(t){const e=t.toUpperCase(),n=await ss();delete n[e],await qi(n)}async function Fi(t,e){const n=t.toUpperCase(),a=await ss();a[n]=e,await qi(a)}const jp=Fi;async function Dp(t,e){const n=await Or(t);await Fi(t,[...n,e])}const Lp=Dp;async function Np(t,e){const n=await Or(t);await Fi(t,n.filter(a=>a.id!==e))}const qp=Np;async function Bp(t,e,n){const a=await Or(t);await Fi(t,a.map(s=>s.id===e?{...s,...n}:s))}const Fp=Bp;async function zp(t,e){var s;const n={type:t.action,source:"gmail",data:{subject:e.subject,from:e.from,date:e.date,snippet:e.snippet||((s=e.body)==null?void 0:s.slice(0,200))||""},metadata:{reason:t.reason,summary:t.summary,tags:t.tags||[],classifiedAt:Date.now()}},a=await Or(t.action);return{event:n,commands:a}}async function Up(t){return{role:"assistant",type:"event-batch",items:await Promise.all(t.filter(n=>n.success&&n.classification).map(async n=>{const{event:a,commands:s}=await zp(n.classification,n.email);return{event:a,commands:s}})),content:""}}async function Kp(t){const e=await Promise.all(t.order.map(async a=>{const s=t.groups[a]||[],o=await Or(a),u=await Si(a),d=s.map(g=>({emailId:g.emailId,subject:g.subject||"(no subject)",from:g.from||"",date:g.date,summary:g.summary||"",reason:g.reason||"",tags:g.tags||[],status:g.status||"pending"}));return{eventType:a,group:u,emails:d,commands:o}})),n=e.reduce((a,s)=>a+s.emails.length,0);return{role:"assistant",type:"events-grouped",groups:e,total:n,content:""}}class Gp{constructor(e,n){this.pluginId=e,this.serviceName=n,this.handlers=new Map}registerHandler(e){this.handlers.set(e.actionId,e)}getHandlers(){return Array.from(this.handlers.values())}async execute(e,n){var s,o,u;const a=this.handlers.get(e);if(!a)return{success:!1,error:new Error(`Unknown action: ${e}`),message:`Action "${e}" not found in ${this.serviceName} plugin`};try{(s=n.onProgress)==null||s.call(n,{phase:"executing",actionId:e,actionName:a.name});const d=await a.execute(n);return(o=n.onProgress)==null||o.call(n,{phase:"completed",actionId:e,actionName:a.name,result:d}),d}catch(d){const g={success:!1,error:d,message:d.message||"Unknown error"};return(u=n.onProgress)==null||u.call(n,{phase:"failed",actionId:e,actionName:a.name,error:d.message}),g}}canExecute(e){return this.handlers.has(e)}getRequiredScopes(e){const n=this.handlers.get(e);return(n==null?void 0:n.requiredScopes)||[]}}const Hp="https://gmail.googleapis.com/gmail/v1/users/me",jr={INBOX:"INBOX",UNREAD:"UNREAD",STARRED:"STARRED",SPAM:"SPAM",IMPORTANT:"IMPORTANT"};async function qn(t,e,n,a=null){var u;const s={method:e,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};a&&(s.body=JSON.stringify(a));const o=await fetch(`${Hp}${n}`,s);if(!o.ok){const g=((u=(await o.json().catch(()=>({}))).error)==null?void 0:u.message)||`Gmail API error: ${o.status}`;throw new Error(g)}return o.status===204?{success:!0}:o.json()}class Wp extends Gp{constructor(){super("gmail","Gmail"),this.registerAllHandlers()}registerAllHandlers(){this.registerHandler({actionId:"mark_read",name:"Mark as Read",description:"Remove the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[jr.UNREAD]}),{success:!0,message:"Marked message as read",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_unread",name:"Mark as Unread",description:"Add the UNREAD label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[jr.UNREAD]}),{success:!0,message:"Marked message as unread",data:{messageId:n}}}}),this.registerHandler({actionId:"star",name:"Star",description:"Add the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[jr.STARRED]}),{success:!0,message:"Starred message",data:{messageId:n}}}}),this.registerHandler({actionId:"unstar",name:"Unstar",description:"Remove the STARRED label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[jr.STARRED]}),{success:!0,message:"Unstarred message",data:{messageId:n}}}}),this.registerHandler({actionId:"trash",name:"Move to Trash",description:"Move message to trash (recoverable for 30 days)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/trash`),{success:!0,message:"Moved message to trash",data:{messageId:n}}}}),this.registerHandler({actionId:"delete",name:"Delete Permanently",description:"Permanently delete message (cannot be recovered)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"DELETE",`/messages/${n}`),{success:!0,message:"Permanently deleted message",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_spam",name:"Mark as Spam",description:"Move message to spam folder",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[jr.SPAM],removeLabelIds:[jr.INBOX]}),{success:!0,message:"Marked message as spam",data:{messageId:n}}}}),this.registerHandler({actionId:"archive",name:"Archive",description:"Remove from inbox (keeps message, removes INBOX label)",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[jr.INBOX]}),{success:!0,message:"Archived message",data:{messageId:n}}}}),this.registerHandler({actionId:"apply_label",name:"Apply Label",description:"Apply a custom label to the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[a]}),{success:!0,message:`Applied label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"remove_label",name:"Remove Label",description:"Remove a label from the message",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{var s;const n=e.event.data.emailId||e.event.data.id,a=(s=e.config)==null?void 0:s.labelId;if(!n)throw new Error("No message ID provided");if(!a)throw new Error("No label ID provided in config");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[a]}),{success:!0,message:`Removed label: ${a}`,data:{messageId:n,labelId:a}}}}),this.registerHandler({actionId:"mark_important",name:"Mark as Important",description:"Add the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{addLabelIds:[jr.IMPORTANT]}),{success:!0,message:"Marked as important",data:{messageId:n}}}}),this.registerHandler({actionId:"mark_not_important",name:"Mark as Not Important",description:"Remove the IMPORTANT label",requiredScopes:["https://www.googleapis.com/auth/gmail.modify"],execute:async e=>{const n=e.event.data.emailId||e.event.data.id;if(!n)throw new Error("No message ID provided");return await qn(e.accessToken,"POST",`/messages/${n}/modify`,{removeLabelIds:[jr.IMPORTANT]}),{success:!0,message:"Marked as not important",data:{messageId:n}}}})}async batchModify(e,n,a=[],s=[]){if(n.length===0)return{success:!0,message:"No messages to modify"};if(n.length>1e3)throw new Error("Batch modify supports maximum 1000 messages at once");return await qn(e,"POST","/messages/batchModify",{ids:n,addLabelIds:a,removeLabelIds:s}),{success:!0,message:`Modified ${n.length} messages`,data:{count:n.length}}}async batchDelete(e,n){if(n.length===0)return{success:!0,message:"No messages to delete"};if(n.length>1e3)throw new Error("Batch delete supports maximum 1000 messages at once");return await qn(e,"POST","/messages/batchDelete",{ids:n}),{success:!0,message:`Deleted ${n.length} messages`,data:{count:n.length}}}}const Vp=new Wp;let Yp=class{constructor(){this.plugins=new Map,this.registerDefaultPlugins()}registerDefaultPlugins(){this.registerPlugin(Vp)}registerPlugin(e){this.plugins.set(e.pluginId,e)}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}async executeAction(e,n){const a=typeof e=="string"?{id:e,commandId:e,pluginId:null}:e,s=a.pluginId||this.resolvePluginId(n.event.source),o=a.commandId||a.id,u=this.getPlugin(s);return u?u.canExecute(o)?u.execute(o,n):{success:!1,message:`Command "${o}" not found in plugin "${u.serviceName}". Available: ${u.getHandlers().map(d=>d.actionId).join(", ")}`,error:new Error(`Command not supported: ${o}`)}:{success:!1,message:`Plugin "${s}" not found. Is it registered?`,error:new Error(`Plugin not found: ${s}`)}}async executePipeline(e,n){var o,u;const a=[];let s=!0;for(const d of e){(o=n.onProgress)==null||o.call(n,{phase:"action_start",actionId:d.id,actionName:d.name,pluginId:d.pluginId,commandId:d.commandId});const g=await this.executeAction(d,n);a.push({actionId:d.id,actionName:d.name,pluginId:d.pluginId,commandId:d.commandId,...g}),g.success||(s=!1),(u=n.onProgress)==null||u.call(n,{phase:"action_complete",actionId:d.id,actionName:d.name,result:g})}return{success:s,results:a,message:s?`All ${a.length} actions completed successfully`:`Pipeline completed with ${a.filter(d=>!d.success).length} failure(s)`}}async executePipelineBatch(e,n,a){var d,g;const s=[];for(let m=0;m<n.length;m++){const _=n[m];(d=a.onProgress)==null||d.call(a,{phase:"batch_event_start",eventIndex:m,totalEvents:n.length,event:_});const x={...a,event:_},b=await this.executePipeline(e,x);s.push({event:_,...b}),(g=a.onProgress)==null||g.call(a,{phase:"batch_event_complete",eventIndex:m,totalEvents:n.length,event:_,result:b})}const o=s.filter(m=>m.success).length,u=s.filter(m=>!m.success).length;return{success:u===0,results:s,total:n.length,successful:o,failed:u,message:`Processed ${n.length} event(s): ${o} successful, ${u} failed`}}resolvePluginId(e){return{gmail:"gmail"}[e]||e}getAvailableActions(e){const n=this.resolvePluginId(e),a=this.getPlugin(n);return a?a.getHandlers():[]}getRequiredScopes(e,n){const a=this.resolvePluginId(n),s=this.getPlugin(a);return s?s.getRequiredScopes(e):[]}};const is=new Yp,Qp=Object.freeze(Object.defineProperty({__proto__:null,pluginRegistry:is},Symbol.toStringTag,{value:"Module"})),Xp=20,Zp={maxTokens:512};function pd(t){const e=[],n=[];for(const o of t)if(o.actions.length){e.push(`${o.pluginName} plugin:`);for(const u of o.actions)e.push(`  ${u.actionId.padEnd(22)} â ${u.name}: ${u.description}`),n.push(u.actionId)}const a=e.length?e.join(`
`):"  (no actions available)",s=n.join(", ");return`You are an email classifier. Analyze this email and produce a classification with suggested actions.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "group": "NOISE",
  "suggestedActions": ["trash"],
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "group":
- Classify the email into one of three urgency tiers:
  - "NOISE"    â unimportant (promotions, newsletters, notifications with no action needed). Actions run automatically.
  - "INFO"     â informational, worth reading (receipts, shipping updates, account notifications). User decides when to act.
  - "CRITICAL" â requires careful human review before acting (financial transactions, purchases, security alerts, legal notices, anything that changes state or commits money/data).
- When in doubt between NOISE and INFO, use INFO
- When in doubt between INFO and CRITICAL, use CRITICAL

Available actions (from installed plugins):
${a}

Guidelines for "suggestedActions":
- Suggest 1-3 actions from the list above, in execution order
- Use ONLY the exact action IDs listed above (${s})
- Match actions to the email's group and purpose:
    NOISE    â prefer: trash, mark_spam, archive (auto-cleanup)
    INFO     â prefer: mark_read, archive, star (quiet filing)
    CRITICAL â prefer: star, mark_important (never trash/delete CRITICAL emails)
- Choose the most specific and least destructive actions that serve the event type
- These seed the default pipeline for this event type (the user can edit later)
- If genuinely no action is needed, use []

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "group" must be exactly "NOISE", "INFO", or "CRITICAL"
- "suggestedActions" must be an array of valid action IDs from the list above
- "tags" must be an array of lowercase strings
- "summary" must be a string`}function hd(){return is.getAllPlugins().map(t=>({pluginId:t.pluginId,pluginName:t.serviceName,actions:t.getHandlers()}))}const md=pd(hd());async function gd(t,{count:e=Xp,force:n=!1,onProgress:a=()=>{},signal:s}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,u=0;if(n)o=await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).reverse().limit(e).toArray();else{const z=new Set(await Qe.emailClassifications.toCollection().primaryKeys());u=0,o=[],await Qe.items.where("[sourceType+date]").between(["gmail",En.minKey],["gmail",En.maxKey]).reverse().until(()=>o.length>=e).each(P=>{z.has(P.id)?u++:o.push(P)})}if(o.length===0){const z=n?"No emails to scan.":`All emails already classified (${u} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:z,classified:0}),{scanned:0,classified:0,skipped:u,errors:0}}const d=Date.now(),g=performance.now();let m=0,_=0,x=0,b=0;const w=[],I=hd(),L=pd(I),O=new Set(I.flatMap(z=>z.actions.map(P=>P.actionId))),se=t.modelId,ie=ml(se)||gl(se);if(!ie)throw new Error(`Unknown model: ${se}`);if(!ie.recommendedForEmailProcessing&&o.length>0){const{MODELS:z}=await Zn(async()=>{const{MODELS:xe}=await Promise.resolve().then(()=>$f);return{MODELS:xe}},void 0),{OLLAMA_MODELS:P}=await Zn(async()=>{const{OLLAMA_MODELS:xe}=await Promise.resolve().then(()=>ep);return{OLLAMA_MODELS:xe}},void 0),ue=[...z.filter(xe=>xe.recommendedForEmailProcessing).map(xe=>xe.name),...P.filter(xe=>xe.recommendedForEmailProcessing).map(xe=>xe.displayName)],ke=ie.displayName||ie.name;console.warn(`â ï¸ Current model (${ke}) is not optimized for email processing. For best results with long emails, use: ${ue.join(", ")}. Some emails may fail due to memory limits.`)}for(let z=0;z<o.length&&!(s!=null&&s.aborted);z++){const P=o[z],ue=bd(P),ke=[{role:"system",content:L},{role:"user",content:ue}];a({phase:"scanning",current:z+1,total:o.length,classified:m,errors:_,results:w,email:{subject:P.subject,from:P.from,date:P.date},prompt:{system:md,user:ue},systemPromptLength:L.length,live:null,lastResult:null,totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}});const xe=performance.now();try{const{text:we,tps:Z,numTokens:le,inputTokens:fe}=await t.generateFull(ke,{maxTokens:512,enableThinking:!1,temperature:0},ae=>{a({phase:"generating",current:z+1,total:o.length,classified:m,errors:_,results:w,email:{subject:P.subject,from:P.from,date:P.date},live:{tps:ae.tps,numTokens:ae.numTokens},streamingText:ae.text||"",totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}})});x+=le,b+=fe;const $=$p(we,O),pe=performance.now()-xe;if($){await Qe.emailClassifications.put({emailId:P.id,action:$.action,group:$.group,reason:$.reason,summary:$.summary,tags:$.tags,subject:P.subject||"(no subject)",from:P.from||"",date:P.date,scannedAt:d,status:"pending"}),await Rp($.action,$.group,$.suggestedActions),m++;const ae={success:!0,email:{subject:P.subject,from:P.from,date:P.date},classification:$,rawResponse:we,stats:{tps:Z,numTokens:le,inputTokens:fe,elapsed:pe},promptSize:ue.length};w.push(ae),a({phase:"classified",current:z+1,total:o.length,classified:m,errors:_,results:w,email:{subject:P.subject,from:P.from,date:P.date},result:$,rawResponse:we,emailStats:{tps:Z,numTokens:le,inputTokens:fe,elapsed:pe},totals:{outputTokens:x,inputTokens:b,elapsed:performance.now()-g}})}}catch(we){console.error(`Triage email ${z+1} failed:`,we),_++;const Z=we.message||String(we),le=Z.length>200?Z.slice(0,200)+"...":Z;w.push({success:!1,email:{subject:P.subject,from:P.from,date:P.date},error:le,promptSize:ue.length})}}const he=performance.now()-g,W=w.length>0?Math.round(w.reduce((z,P)=>z+P.promptSize,0)/w.length):0,N=w.filter(z=>{var P;return z.success&&((P=z.stats)==null?void 0:P.tps)}).length>0?Math.round(w.filter(z=>z.success).reduce((z,P)=>{var ue;return z+(((ue=P.stats)==null?void 0:ue.tps)||0)},0)/w.filter(z=>{var P;return z.success&&((P=z.stats)==null?void 0:P.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:m,errors:_,results:w,summary:{avgPromptSize:W,avgTps:N,systemPromptSize:L.length,processed:o.length,skipped:u,modelName:ie.displayName||ie.name,modelContextWindow:ie.contextWindow,modelMaxEmailTokens:ie.maxEmailTokens},totals:{outputTokens:x,inputTokens:b,elapsed:he}}),{scanned:o.length,classified:m,skipped:u,errors:_}}async function _d(){const t=await Qe.emailClassifications.toArray();return od(t)}async function Jp(){const t=await Qe.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function Ei(t,e){await Qe.emailClassifications.update(t,{status:e})}async function Ic(){await Qe.emailClassifications.clear()}async function wl(t){await Qe.emailClassifications.where("action").equals(t).delete()}async function yd(t){await Qe.emailClassifications.delete(t)}async function Ho(){const t=await Qe.items.where("sourceType").equals("gmail").count(),e=await Qe.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function bd(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function $p(t,e){if(!t||!t.trim())return null;let n=t.trim();n=n.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),n=n.trim();const a=n.indexOf("{"),s=n.lastIndexOf("}");if(a===-1||s===-1||s<=a)return console.warn("Triage: no JSON object found in response"),null;const o=n.indexOf("[");if(o!==-1&&o<a)return console.warn("Triage: expected JSON object, got array"),null;const u=n.slice(a,s+1);try{const d=JSON.parse(u);if(!d||typeof d!="object"||Array.isArray(d))return null;const g=eh(d.action);if(!g)return console.warn("Triage: missing or invalid action field"),null;const _=["NOISE","INFO","CRITICAL"].includes(d.group)?d.group:"INFO";let x=[];Array.isArray(d.suggestedActions)&&(x=d.suggestedActions.filter(w=>typeof w!="string"||!w.trim()?!1:e?e.has(w.trim()):!0).map(w=>w.trim()).slice(0,5)),x.length===0&&Array.isArray(d.suggestedActions)&&d.suggestedActions.length>0&&console.warn("Triage: suggestedActions contained unknown IDs â all filtered out:",d.suggestedActions);let b=[];return Array.isArray(d.tags)&&(b=d.tags.filter(w=>typeof w=="string"&&w.trim()).map(w=>w.trim().toLowerCase()).slice(0,10)),{action:g,group:_,suggestedActions:x,reason:String(d.reason||"").slice(0,300),summary:String(d.summary||"").slice(0,500),tags:b}}catch(d){return console.warn("Triage: failed to parse JSON response:",d.message),null}}function eh(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function Wo(t){return`hsl(${Li(t)}, 55%, 55%)`}function th(t){return`hsl(${Li(t)}, 40%, 35%)`}var nh=T('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),rh=T('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function ah(t,e){jt(e,!0);let n=Ne(e,"backend",15,"webgpu"),a=Ne(e,"isWebGPUAvailable",3,!0);var s=rh(),o=h(f(s),2),u=f(o);let d;u.__click=()=>n("webgpu");var g=h(u,2);let m;g.__click=()=>n("ollama");var _=h(o,2);{var x=b=>{var w=nh();S(b,w)};Q(_,b=>{!a()&&n()==="webgpu"&&b(x)})}Y(()=>{d=Nt(u,1,"backend-btn svelte-1n2kfl0",null,d,{active:n()==="webgpu"}),u.disabled=!a(),m=Nt(g,1,"backend-btn svelte-1n2kfl0",null,m,{active:n()==="ollama"})}),S(t,s),Dt()}Jt(["click"]);const sh=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function Cc(...t){sh&&console.log("[debug]",...t)}function Jn(t){return Cc(`[MOUNT] ${t}`),()=>Cc(`[DESTROY] ${t}`)}var ih=T("<option> </option>"),oh=T('<p class="model-description svelte-1p89qnn"> </p>'),lh=T('<span class="current-badge svelte-1p89qnn">Current</span>'),ch=T('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),uh=T('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),dh=T('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),vh=T('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),fh=T('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),ph=T('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),hh=T('<p class="error svelte-1p89qnn"> </p>'),mh=T('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function gh(t,e){jt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"gpuInfo",3,null),s=Ne(e,"error",3,null);kn(()=>Jn("ModelSelector"));var o=mh(),u=f(o),d=h(f(u),2),g=h(f(d),2);xt(g,21,()=>Ir,Ut,(W,N)=>{var z=ih(),P=f(z),ue={};Y(()=>{C(P,`${l(N).name??""} â ${l(N).size??""}`),ue!==(ue=l(N).id)&&(z.value=(z.__value=l(N).id)??"")}),S(W,z)});var m=h(g,2);{var _=W=>{const N=it(()=>Ir.find(ke=>ke.id===n()));var z=On(),P=Ze(z);{var ue=ke=>{var xe=oh(),we=f(xe);Y(()=>C(we,l(N).description)),S(ke,xe)};Q(P,ke=>{l(N)&&ke(ue)})}S(W,z)};Q(m,W=>{n()&&W(_)})}var x=h(d,2),b=h(f(x),2),w=f(b),I=h(f(w));xt(I,21,()=>Ir,Ut,(W,N)=>{var z=vh();let P;var ue=f(z),ke=f(ue),xe=h(ke);{var we=me=>{var R=lh();S(me,R)};Q(xe,me=>{l(N).id===n()&&me(we)})}var Z=h(ue),le=f(Z),fe=f(le),$=h(Z),pe=f($),ae=h($),X=f(ae);{var oe=me=>{var R=ch();S(me,R)},ge=me=>{var R=uh();S(me,R)},Se=me=>{var R=dh();S(me,R)};Q(X,me=>{l(N).recommendedForEmailProcessing?me(oe):l(N).maxEmailTokens>=6e3?me(ge,1):me(Se,!1)})}Y((me,R)=>{P=Nt(z,1,"svelte-1p89qnn",null,P,{selected:l(N).id===n()}),C(ke,`${l(N).name??""} `),C(fe,`${me??""}k`),C(pe,`~${R??""}k`)},[()=>(l(N).contextWindow/1024).toFixed(0),()=>(l(N).maxEmailTokens/1e3).toFixed(0)]),S(W,z)});var L=h(x,2);{var O=W=>{var N=ph(),z=h(f(N),2),P=f(z),ue=h(f(P)),ke=f(ue),xe=h(P,2),we=h(f(xe)),Z=f(we),le=h(xe,2);{var fe=$=>{var pe=fh(),ae=h(f(pe)),X=f(ae);Y(oe=>C(X,oe),[()=>Go(a().limits.maxBufferSize)]),S($,pe)};Q(le,$=>{var pe;(pe=a().limits)!=null&&pe.maxBufferSize&&$(fe)})}Y(()=>{C(ke,a().vendor),C(Z,a().architecture)}),S(W,N)};Q(L,W=>{a()&&W(O)})}var se=h(L,2);{var ie=W=>{var N=hh(),z=f(N);Y(()=>C(z,s())),S(W,N)};Q(se,W=>{s()&&W(ie)})}var he=h(se,2);he.__click=function(...W){var N;(N=e.onload)==null||N.apply(this,W)},Y(()=>he.disabled=s()),Di(g,n),S(t,o),Dt()}Jt(["click"]);var _h=T('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),yh=T('<div class="cors-help svelte-1bvvk8o"><strong class="svelte-1bvvk8o">Fix CORS Error:</strong> <ul class="svelte-1bvvk8o"><li class="svelte-1bvvk8o">In Cloudflare: Add Transform Rule to set <code class="svelte-1bvvk8o"></code></li> <li class="svelte-1bvvk8o">Or set <code class="svelte-1bvvk8o"></code> on your server</li> <li class="svelte-1bvvk8o">For testing: Use <code class="svelte-1bvvk8o">http://localhost:5173</code> (no CORS restrictions)</li></ul></div>'),bh=T('<span class="status-dot disconnected svelte-1bvvk8o"></span> <div class="error-content svelte-1bvvk8o"><span> </span> <!></div>',1),wh=T("<div><!></div>"),kh=T("<option> <!></option>"),xh=T("<option> <!></option>"),Sh=T('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Eh=T('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Th=T('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Ah=T('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Ih=T('<span class="current-badge svelte-1bvvk8o">Current</span>'),Ch=T('<span class="installed-badge svelte-1bvvk8o">â</span>'),Ph=T('<span class="rec-badge svelte-1bvvk8o">â</span>'),Oh=T('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),Rh=T('<p class="error svelte-1bvvk8o"> </p>'),Mh=T('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL: <span class="env-badge svelte-1bvvk8o"> </span></label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function jh(t,e){jt(e,!0);let n=Ne(e,"selectedModel",15),a=Ne(e,"error",15);const s=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");let o=Oe(Vt(Hs())),u=Oe(!1),d=Oe(null),g=Oe(Vt([])),m=Oe(!1);Oa(()=>{ap().then(V=>{A(o,V,!0),_()})});async function _(){A(u,!0),A(d,null);const V=await Ko(l(o));A(d,V,!0),A(u,!1),V.connected&&x()}async function x(){A(m,!0);try{const V=await ip(l(o));A(g,V.map(ne=>ne.name),!0)}catch(V){console.error("Failed to load Ollama models:",V),A(g,[],!0)}A(m,!1)}function b(){sp(l(o)),_()}function w(){if(!n()){a("Please select a model");return}e.onload()}function I(V){return l(g).length?l(g).includes(V):!1}const L=Ju();var O=Mh(),se=f(O),ie=f(se),he=h(f(ie)),W=f(he),N=h(ie,2),z=f(N);z.__change=b;var P=h(z,2);P.__click=_;var ue=f(P),ke=h(N,2);{var xe=V=>{var ne=wh();let K;var ve=f(ne);{var be=U=>{var Ee=_h(),ce=h(Ze(Ee),2),Te=f(ce);Y(()=>C(Te,`Connected â¢ v${l(d).version??""}`)),S(U,Ee)},te=U=>{var Ee=bh(),ce=h(Ze(Ee),2),Te=f(ce),qe=f(Te),He=h(Te,2);{var vt=_t=>{var Xe=yh(),Be=h(f(Xe),2),Ue=f(Be),Ke=h(f(Ue));Ke.textContent=`Access-Control-Allow-Origin: ${window.location.origin??""}`;var ot=h(Ue,2),lt=h(f(ot));lt.textContent=`OLLAMA_ORIGINS=${window.location.origin??""}`,S(_t,Xe)};Q(He,_t=>{l(d).corsError&&_t(vt)})}Y(()=>C(qe,`Disconnected: ${l(d).error??""}`)),S(U,Ee)};Q(ve,U=>{l(d).connected?U(be):U(te,!1)})}Y(()=>K=Nt(ne,1,"connection-status svelte-1bvvk8o",null,K,{connected:l(d).connected})),S(V,ne)};Q(ke,V=>{l(d)&&V(xe)})}var we=h(se,2),Z=h(f(we),2),le=f(Z);xt(le,21,()=>L,Ut,(V,ne)=>{var K=kh(),ve=f(K),be=h(ve);{var te=ce=>{var Te=vn("â");S(ce,Te)},U=it(()=>I(l(ne).name));Q(be,ce=>{l(U)&&ce(te)})}var Ee={};Y(ce=>{C(ve,`${l(ne).displayName??""} (${l(ne).params??""}) - ${ce??""}k context `),Ee!==(Ee=l(ne).name)&&(K.value=(K.__value=l(ne).name)??"")},[()=>(l(ne).contextWindow/1024).toFixed(0)]),S(V,K)});var fe=h(le);xt(fe,21,()=>Cr.filter(V=>!V.recommended),Ut,(V,ne)=>{var K=xh(),ve=f(K),be=h(ve);{var te=ce=>{var Te=vn("â");S(ce,Te)},U=it(()=>I(l(ne).name));Q(be,ce=>{l(U)&&ce(te)})}var Ee={};Y(ce=>{C(ve,`${l(ne).displayName??""} (${l(ne).params??""}) - ${ce??""}k context `),Ee!==(Ee=l(ne).name)&&(K.value=(K.__value=l(ne).name)??"")},[()=>(l(ne).contextWindow/1024).toFixed(0)]),S(V,K)});var $=h(Z,2);{var pe=V=>{const ne=it(()=>Cr.find(te=>te.name===n()));var K=On(),ve=Ze(K);{var be=te=>{var U=Ah(),Ee=f(U),ce=f(Ee),Te=h(Ee,2),qe=f(Te),He=f(qe),vt=h(qe,4),_t=f(vt),Xe=h(vt,2);{var Be=Je=>{var tt=Sh(),Ve=h(Ze(tt),2),ze=f(Ve);Y(ht=>C(ze,ht),[()=>l(ne).tags.join(", ")]),S(Je,tt)};Q(Xe,Je=>{var tt;(tt=l(ne).tags)!=null&&tt.length&&Je(Be)})}var Ue=h(Te,2);{var Ke=Je=>{var tt=Eh(),Ve=h(f(tt),2),ze=f(Ve);Y(()=>C(ze,`ollama pull ${n()??""}`)),S(Je,tt)},ot=it(()=>!I(n())),lt=Je=>{var tt=Th();S(Je,tt)};Q(Ue,Je=>{l(ot)?Je(Ke):Je(lt,!1)})}Y(Je=>{C(ce,l(ne).description),C(He,`${Je??""}k context`),C(_t,`${l(ne).params??""} params`)},[()=>(l(ne).contextWindow/1024).toFixed(0)]),S(te,U)};Q(ve,te=>{l(ne)&&te(be)})}S(V,K)};Q($,V=>{n()&&V(pe)})}var ae=h(we,2),X=h(f(ae),2),oe=f(X),ge=h(f(oe));xt(ge,21,()=>Cr,Ut,(V,ne)=>{var K=Oh();let ve;var be=f(K),te=f(be),U=h(te);{var Ee=Je=>{var tt=Ih();S(Je,tt)};Q(U,Je=>{l(ne).name===n()&&Je(Ee)})}var ce=h(U,2);{var Te=Je=>{var tt=Ch();S(Je,tt)},qe=it(()=>I(l(ne).name));Q(ce,Je=>{l(qe)&&Je(Te)})}var He=h(be),vt=f(He),_t=f(vt),Xe=h(He),Be=f(Xe),Ue=h(Xe),Ke=f(Ue);{var ot=Je=>{var tt=Ph();S(Je,tt)};Q(Ke,Je=>{l(ne).recommended&&Je(ot)})}var lt=h(Ke);Y((Je,tt,Ve)=>{ve=Nt(K,1,"svelte-1bvvk8o",null,ve,Je),C(te,`${l(ne).displayName??""} `),C(_t,`${tt??""}k`),C(Be,l(ne).params),C(lt,` ${Ve??""}`)},[()=>({selected:l(ne).name===n(),installed:I(l(ne).name)}),()=>(l(ne).contextWindow/1024).toFixed(0),()=>l(ne).tags.slice(0,2).join(", ")]),S(V,K)});var Se=h(ae,2);{var me=V=>{var ne=Rh(),K=f(ne);Y(()=>C(K,a())),S(V,ne)};Q(Se,V=>{a()&&V(me)})}var R=h(Se,2);R.__click=w,Y(()=>{var V;C(W,s?"ð¥ local":"âï¸ remote"),gr(z,"placeholder",s?"http://localhost:11434":"https://me-ai.metaelon.space"),P.disabled=l(u),C(ue,l(u)?"Testing...":"Test"),R.disabled=!((V=l(d))!=null&&V.connected)||a()}),zr(z,()=>l(o),V=>A(o,V)),Di(Z,n),S(t,O),Dt()}Jt(["change","click"]);var Dh=T('<span class="progress-percent svelte-r5fnze"> </span>'),Lh=T('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),Nh=T('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),qh=T('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),Bh=T('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),Fh=T('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),zh=T('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function Uh(t,e){jt(e,!0);let n=Ne(e,"message",3,""),a=Ne(e,"items",19,()=>[]);kn(()=>Jn("LoadingProgress"));var s=zh(),o=f(s),u=f(o),d=h(o,2);xt(d,17,a,Ut,(g,m)=>{const _=it(()=>l(m).total?up(l(m).loaded||0,l(m).total):null);var x=Fh(),b=f(x),w=f(b),I=f(w),L=h(w,2);{var O=W=>{var N=Dh(),z=f(N);Y(P=>C(z,`${P??""}%`),[()=>l(_).toFixed(1)]),S(W,N)};Q(L,W=>{l(_)!==null&&W(O)})}var se=h(b,2);{var ie=W=>{var N=Lh(),z=Ze(N),P=f(z),ue=h(z,2),ke=f(ue),xe=f(ke),we=h(ke,4),Z=f(we),le=h(we,2),fe=f(le);Y(($,pe,ae,X,oe)=>{dn(P,`width: ${$??""}%`),C(xe,pe),C(Z,ae),C(fe,`(${X??""} / ${oe??""} B)`)},[()=>Math.max(l(m).progress??0,.5).toFixed(1),()=>xo(l(m).loaded||0),()=>xo(l(m).total),()=>(l(m).loaded||0).toLocaleString(),()=>l(m).total.toLocaleString()]),S(W,N)},he=W=>{var N=Bh(),z=h(Ze(N),2),P=f(z);{var ue=xe=>{var we=Nh(),Z=Ze(we),le=f(Z),fe=h(Z,2),$=f(fe);Y((pe,ae)=>{C(le,pe),C($,`(${ae??""} B)`)},[()=>xo(l(m).loaded),()=>l(m).loaded.toLocaleString()]),S(xe,we)},ke=xe=>{var we=qh();S(xe,we)};Q(P,xe=>{l(m).loaded?xe(ue):xe(ke,!1)})}S(W,N)};Q(se,W=>{l(m).total?W(ie):W(he,!1)})}Y(()=>{gr(w,"title",l(m).file),C(I,l(m).file)}),S(g,x)}),Y(()=>C(u,n())),S(t,s),Dt()}var Kh=T('<span class="thinking-tokens svelte-11gjw00"> </span>'),Gh=T('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Hh=T('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Wh=T('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Vh=T('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),Yh=T('<span class="cursor svelte-11gjw00">|</span>'),Qh=T(" <!>",1),Xh=T('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),Zh=T('<div class="content svelte-11gjw00"> </div>'),Jh=T('<div><div class="role svelte-11gjw00"> </div> <!></div>');function $h(t,e){jt(e,!0);let n=Ne(e,"isLast",3,!1),a=Ne(e,"isRunning",3,!1),s=Ne(e,"generationPhase",3,null),o=Ne(e,"numTokens",3,null);kn(()=>Jn(`MessageBubble[${e.msg.role}]`));var u=Jh(),d=f(u),g=f(d),m=h(d,2);{var _=b=>{var w=Xh(),I=Ze(w);{var L=P=>{var ue=Gh(),ke=h(f(ue),4);{var xe=we=>{var Z=Kh(),le=f(Z);Y(()=>C(le,`${o()??""} tokens`)),S(we,Z)};Q(ke,we=>{o()&&we(xe)})}S(P,ue)},O=P=>{var ue=Hh();S(P,ue)};Q(I,P=>{a()&&n()&&s()==="thinking"?P(L):a()&&n()&&s()==="preparing"&&P(O,1)})}var se=h(I,2);{var ie=P=>{var ue=Wh(),ke=f(ue),xe=h(f(ke),2),we=f(xe),Z=h(ke,2),le=f(Z);Y(fe=>{C(we,`${fe??""} words`),C(le,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),S(P,ue)};Q(se,P=>{e.msg.thinking&&P(ie)})}var he=h(se,2),W=f(he);{var N=P=>{var ue=Vh();S(P,ue)},z=P=>{var ue=Qh(),ke=Ze(ue,!0),xe=h(ke);{var we=Z=>{var le=Yh();S(Z,le)};Q(xe,Z=>{a()&&n()&&Z(we)})}Y(()=>C(ke,e.msg.content)),S(P,ue)};Q(W,P=>{a()&&n()&&!e.msg.content&&s()!=="thinking"?P(N):P(z,!1)})}S(b,w)},x=b=>{var w=Zh(),I=f(w);Y(()=>C(I,e.msg.content)),S(b,w)};Q(m,b=>{e.msg.role==="assistant"?b(_):b(x,!1)})}Y(()=>{Nt(u,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),C(g,e.msg.role==="user"?"You":"AI")}),S(t,u),Dt()}var em=T('<span class="cmd-icon svelte-1m7x4wq"> </span>'),tm=T('<div class="cmd-body svelte-1m7x4wq"><pre class="svelte-1m7x4wq"> </pre></div>'),nm=T('<button class="command-card svelte-1m7x4wq"><!> <div class="cmd-info svelte-1m7x4wq"><span class="cmd-name svelte-1m7x4wq"> </span> <span class="cmd-desc svelte-1m7x4wq"> </span></div></button> <!>',1);function Pc(t,e){jt(e,!0);var n=nm(),a=Ze(n);a.__click=()=>{var w;return(w=e.onexecute)==null?void 0:w.call(e,e.command.id)};var s=f(a);{var o=w=>{var I=em(),L=f(I);Y(()=>C(L,e.command.icon)),S(w,I)};Q(s,w=>{e.command.icon&&w(o)})}var u=h(s,2),d=f(u),g=f(d),m=h(d,2),_=f(m),x=h(a,2);{var b=w=>{var I=tm(),L=f(I),O=f(L);Y(()=>C(O,e.command.body)),S(w,I)};Q(x,w=>{e.command.body&&w(b)})}Y(()=>{C(g,e.command.name),C(_,e.command.description)}),S(t,n),Dt()}Jt(["click"]);const Oc="https://accounts.google.com/gsi/client",rm="https://www.googleapis.com/auth/gmail.readonly",kl="me-ai:oauth-token",xl=300*1e3;let Ls=null,Os=null,oa=0;async function wd(t,e){oa=Date.now()+e*1e3;const{setSetting:n}=await Zn(async()=>{const{setSetting:a}=await Promise.resolve().then(()=>Wr);return{setSetting:a}},void 0);await n(kl,{access_token:t,expires_at:oa})}async function Vo(){oa=0;const{removeSetting:t}=await Zn(async()=>{const{removeSetting:e}=await Promise.resolve().then(()=>Wr);return{removeSetting:e}},void 0);await t(kl)}async function zi(){try{const{getSetting:t}=await Zn(async()=>{const{getSetting:s}=await Promise.resolve().then(()=>Wr);return{getSetting:s}},void 0),e=await t(kl);if(!e)return null;const{access_token:n,expires_at:a}=e;return!n||Date.now()>a-xl?(await Vo(),null):(oa=a,{access_token:n})}catch{return await Vo(),null}}function am(){return oa>0&&Date.now()<oa-xl}function sm(){return oa<=0?0:Math.max(0,oa-xl-Date.now())}function Rc(){return new Promise((t,e)=>{if(!Ls){e(new Error("Google Auth not initialized."));return}Os=async n=>{n.error?e(new Error(n.error_description||n.error)):(await wd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ls.requestAccessToken({prompt:""})})}function im(){return new Promise((t,e)=>{var s,o;if((o=(s=window.google)==null?void 0:s.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${Oc}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=Oc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function Mc(t){await im(),Ls=google.accounts.oauth2.initTokenClient({client_id:t,scope:rm,callback:e=>{Os&&(Os(e),Os=null)}})}function om(){return new Promise((t,e)=>{if(!Ls){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}Os=async n=>{n.error?e(new Error(n.error_description||n.error)):(await wd(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},Ls.requestAccessToken()})}async function lm(t){return await Vo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}async function cm(t,e,n=!1){try{e==null||e({phase:"starting",event:t});const a=await fd(t.type);if(e==null||e({phase:"policy_check",group:a.group,policy:a}),a.requiresApproval&&!n){const m=await Or(t.type);return{success:!1,requiresApproval:!0,group:a.group,actions:m,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const s=await zi();if(!(s!=null&&s.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const o=s.access_token,u=await Or(t.type);if(!u||u.length===0)return{success:!0,message:`No actions defined for event type: ${t.type}`,results:[]};e==null||e({phase:"pipeline_loaded",actions:u,actionCount:u.length});const d={accessToken:o,event:t,onProgress:e},g=await is.executePipeline(u,d);return e==null||e({phase:"done",result:g}),g}catch(a){return e==null||e({phase:"error",error:a.message}),{success:!1,error:a,message:a.message||"Unknown error"}}}async function um(t,e,n,a=!1){try{n==null||n({phase:"starting",eventType:t,eventCount:e.length});const s=await fd(t);if(s.requiresApproval&&!a){const x=await Or(t);return{success:!1,requiresApproval:!0,group:s.group,actions:x,total:e.length,successful:0,failed:0,message:"This event type is CRITICAL â review the actions below and confirm before executing."}}const o=await zi();if(!(o!=null&&o.access_token))throw new Error("Not authenticated. Please sign in to Gmail first.");const u=o.access_token,d=await Or(t);if(!d||d.length===0)return{success:!0,message:`No actions defined for event type: ${t}`,results:[],total:0,successful:0,failed:0};n==null||n({phase:"pipeline_loaded",actions:d,actionCount:d.length});const g=e.map(x=>({type:t,source:"gmail",data:x})),m={accessToken:u,onProgress:n},_=await is.executePipelineBatch(d,g,m);return n==null||n({phase:"done",result:_}),_}catch(s){return n==null||n({phase:"error",error:s.message}),{success:!1,error:s,message:s.message||"Unknown error",total:e.length,successful:0,failed:e.length}}}function dm(t){return is.getAvailableActions(t)}async function jc(){const t=await zi();return!!(t!=null&&t.access_token)}var vm=T('<div class="event-subject svelte-1w66m1k"> </div>'),fm=T('<span class="sep svelte-1w66m1k">Â·</span> ',1),pm=T('<div class="event-summary svelte-1w66m1k"> </div>'),hm=T('<span class="tag svelte-1w66m1k"> </span>'),mm=T('<div class="event-tags svelte-1w66m1k"></div>'),gm=T('<div class="event-reason svelte-1w66m1k"> </div>'),_m=T('<div class="commands svelte-1w66m1k"></div>'),ym=T('<div class="event-msg svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <span class="event-source svelte-1w66m1k"> </span></div> <!> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!> <!> <!></div> <!></div>'),bm=T('<span class="event-subject-inline svelte-1w66m1k"> </span>'),wm=T('<span class="sep svelte-1w66m1k">Â·</span> ',1),km=T('<div class="event-summary svelte-1w66m1k"> </div>'),xm=T('<div class="event-msg compact svelte-1w66m1k"><div class="event-card svelte-1w66m1k"><div class="event-head svelte-1w66m1k"><span class="event-type svelte-1w66m1k"> </span> <!></div> <div class="event-meta svelte-1w66m1k"><!> <!></div> <!></div> <div class="commands compact svelte-1w66m1k"></div></div>'),Sm=T('<div class="event-batch svelte-1w66m1k"><div class="batch-head svelte-1w66m1k"><span class="batch-title svelte-1w66m1k"> </span></div> <!></div>'),Em=T('<span class="group-tier-chip svelte-1w66m1k"> </span>'),Tm=T("<button><!></button>"),Am=T("<span> </span>"),Im=T('<span class="approval-action-desc svelte-1w66m1k"> </span>'),Cm=T("<li><!> <strong> </strong> <!></li>"),Pm=T('<ul class="approval-actions svelte-1w66m1k"></ul>'),Om=T(`<div class="approval-card svelte-1w66m1k"><div class="approval-header svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Review required â this is a CRITICAL event type</span></div> <p class="approval-body svelte-1w66m1k">The following actions will run on <strong> </strong>.
              This changes email state and cannot be undone easily.</p> <!> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">â Confirm & Execute</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>`),Rm=T("<div> </div>"),Mm=T('<span class="email-from svelte-1w66m1k"> </span>'),jm=T('<span class="sep svelte-1w66m1k">Â·</span><span class="email-date svelte-1w66m1k"> </span>',1),Dm=T('<div class="email-summary svelte-1w66m1k"> </div>'),Lm=T('<span class="tag svelte-1w66m1k"> </span>'),Nm=T('<div class="email-tags svelte-1w66m1k"></div>'),qm=T("<button><!></button>"),Bm=T('<div class="approval-card compact svelte-1w66m1k"><span class="approval-icon svelte-1w66m1k">â ï¸</span> <span class="approval-title svelte-1w66m1k">Confirm execution?</span> <div class="approval-btns svelte-1w66m1k"><button class="approval-confirm svelte-1w66m1k">Confirm</button> <button class="approval-cancel svelte-1w66m1k">Cancel</button></div></div>'),Fm=T('<span class="step-icon svelte-1w66m1k"> </span>'),zm=T('<div class="pipeline-step svelte-1w66m1k"><span class="step-number svelte-1w66m1k"></span> <div class="step-info svelte-1w66m1k"><!> <span class="step-name svelte-1w66m1k"> </span> <span class="step-desc svelte-1w66m1k"> </span></div></div>'),Um=T('<div class="pipeline-steps svelte-1w66m1k"></div>'),Km=T('<div class="pipeline-empty svelte-1w66m1k">No actions defined â configure in Actions page</div>'),Gm=T("<div> </div>"),Hm=T('<div class="email-item svelte-1w66m1k"><div class="email-main svelte-1w66m1k"><div class="email-subject svelte-1w66m1k"> </div> <div class="email-meta svelte-1w66m1k"><!> <!></div> <!> <!></div> <div class="email-pipeline svelte-1w66m1k"><div class="pipeline-header svelte-1w66m1k"><span class="pipeline-label svelte-1w66m1k">Action Pipeline</span> <!></div> <!> <!> <!></div></div>'),Wm=T('<div class="group-emails svelte-1w66m1k"></div>'),Vm=T('<div class="group-block svelte-1w66m1k"><div class="group-header-row svelte-1w66m1k"><button class="group-header svelte-1w66m1k"><span class="group-badge svelte-1w66m1k"> </span> <!> <span class="group-count svelte-1w66m1k"> </span> <span class="spacer svelte-1w66m1k"></span> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div> <!> <!> <!></div>'),Ym=T('<div class="events-grouped svelte-1w66m1k"><div class="grouped-head svelte-1w66m1k"><span class="grouped-title svelte-1w66m1k">Events</span> <span class="grouped-stat svelte-1w66m1k"> </span></div> <!></div>');function Qm(t,e){jt(e,!0);let n=Oe(Vt({})),a=Vt({}),s=Oe(Vt({}));function o(N){if(!N)return"â";const z=N.replace(/<.*>/,"").trim();return z.length>40?z.slice(0,38)+"â¦":z}function u(N){if(!N)return"";try{return new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function d(N,z){var P;(P=e.oncommand)==null||P.call(e,{event:N,commandId:z})}async function g(N,z,P=!1){if(!await jc()){alert("Please sign in to Gmail first (Dashboard page)");return}const ue=`single_${z}`;a[ue]={running:!0,progress:null,result:null};try{const ke=await cm(N,xe=>{a[ue]={...a[ue],progress:xe}},P);if(ke.requiresApproval){a[ue]={running:!1,progress:null,result:null},l(s)[ue]={event:N,emailId:z,actions:ke.actions,group:ke.group,isBatch:!1};return}a[ue]={running:!1,progress:null,result:ke}}catch(ke){a[ue]={running:!1,progress:null,result:{success:!1,message:ke.message}}}}async function m(N,z,P=!1){if(!await jc()){alert("Please sign in to Gmail first (Dashboard page)");return}const ue=`batch_${N}`;a[ue]={running:!0,progress:null,result:null};try{const ke=await um(N,z,xe=>{a[ue]={...a[ue],progress:xe}},P);if(ke.requiresApproval){a[ue]={running:!1,progress:null,result:null},l(s)[ue]={eventType:N,emails:z,actions:ke.actions,group:ke.group,isBatch:!0};return}a[ue]={running:!1,progress:null,result:ke}}catch(ke){a[ue]={running:!1,progress:null,result:{success:!1,message:ke.message}}}}async function _(N){const z=l(s)[N];z&&(delete l(s)[N],A(s,{...l(s)},!0),z.isBatch?await m(z.eventType,z.emails,!0):await g(z.event,z.emailId,!0))}function x(N){delete l(s)[N],A(s,{...l(s)},!0)}function b(N){A(n,{...l(n),[N]:!l(n)[N]},!0)}function w(N){return N.split("_").map(z=>z.charAt(0)+z.slice(1).toLowerCase()).join(" ")}function I(N){return`hsl(${Li(N)}, 55%, 55%)`}function L(N){return a[N]}var O=On(),se=Ze(O);{var ie=N=>{var z=ym(),P=f(z),ue=f(P),ke=f(ue),xe=f(ke),we=h(ke,2),Z=f(we),le=h(ue,2);{var fe=be=>{var te=vm(),U=f(te);Y(()=>C(U,e.msg.event.data.subject)),S(be,te)};Q(le,be=>{var te;(te=e.msg.event.data)!=null&&te.subject&&be(fe)})}var $=h(le,2),pe=f($);{var ae=be=>{var te=vn();Y(U=>C(te,U),[()=>o(e.msg.event.data.from)]),S(be,te)};Q(pe,be=>{var te;(te=e.msg.event.data)!=null&&te.from&&be(ae)})}var X=h(pe,2);{var oe=be=>{var te=fm(),U=h(Ze(te),1,!0);Y(Ee=>C(U,Ee),[()=>u(e.msg.event.data.date)]),S(be,te)};Q(X,be=>{var te;(te=e.msg.event.data)!=null&&te.date&&be(oe)})}var ge=h($,2);{var Se=be=>{var te=pm(),U=f(te);Y(()=>C(U,e.msg.event.metadata.summary)),S(be,te)};Q(ge,be=>{var te;(te=e.msg.event.metadata)!=null&&te.summary&&be(Se)})}var me=h(ge,2);{var R=be=>{var te=mm();xt(te,21,()=>e.msg.event.metadata.tags,Ut,(U,Ee)=>{var ce=hm(),Te=f(ce);Y(()=>C(Te,l(Ee))),S(U,ce)}),S(be,te)};Q(me,be=>{var te,U;(U=(te=e.msg.event.metadata)==null?void 0:te.tags)!=null&&U.length&&be(R)})}var V=h(me,2);{var ne=be=>{var te=gm(),U=f(te);Y(()=>C(U,e.msg.event.metadata.reason)),S(be,te)};Q(V,be=>{var te;(te=e.msg.event.metadata)!=null&&te.reason&&be(ne)})}var K=h(P,2);{var ve=be=>{var te=_m();xt(te,21,()=>e.msg.commands,Ut,(U,Ee)=>{Pc(U,{get command(){return l(Ee)},onexecute:ce=>d(e.msg.event,ce)})}),S(be,te)};Q(K,be=>{var te;(te=e.msg.commands)!=null&&te.length&&be(ve)})}Y(()=>{C(xe,e.msg.event.type),C(Z,e.msg.event.source)}),S(N,z)},he=N=>{var z=Sm(),P=f(z),ue=f(P),ke=f(ue),xe=h(P,2);xt(xe,17,()=>e.msg.items,Ut,(we,Z)=>{var le=xm(),fe=f(le),$=f(fe),pe=f($),ae=f(pe),X=h(pe,2);{var oe=be=>{var te=bm(),U=f(te);Y(()=>C(U,l(Z).event.data.subject)),S(be,te)};Q(X,be=>{var te;(te=l(Z).event.data)!=null&&te.subject&&be(oe)})}var ge=h($,2),Se=f(ge);{var me=be=>{var te=vn();Y(U=>C(te,U),[()=>o(l(Z).event.data.from)]),S(be,te)};Q(Se,be=>{var te;(te=l(Z).event.data)!=null&&te.from&&be(me)})}var R=h(Se,2);{var V=be=>{var te=wm(),U=h(Ze(te),1,!0);Y(Ee=>C(U,Ee),[()=>u(l(Z).event.data.date)]),S(be,te)};Q(R,be=>{var te;(te=l(Z).event.data)!=null&&te.date&&be(V)})}var ne=h(ge,2);{var K=be=>{var te=km(),U=f(te);Y(()=>C(U,l(Z).event.metadata.summary)),S(be,te)};Q(ne,be=>{var te;(te=l(Z).event.metadata)!=null&&te.summary&&be(K)})}var ve=h(fe,2);xt(ve,21,()=>l(Z).commands,Ut,(be,te)=>{Pc(be,{get command(){return l(te)},onexecute:U=>d(l(Z).event,U)})}),Y(()=>C(ae,l(Z).event.type)),S(we,le)}),Y(()=>C(ke,`Processed ${e.msg.items.length??""} email${e.msg.items.length===1?"":"s"}`)),S(N,z)},W=N=>{var z=Ym(),P=f(z),ue=h(f(P),2),ke=f(ue),xe=h(P,2);xt(xe,17,()=>e.msg.groups,Ut,(we,Z)=>{const le=it(()=>l(n)[l(Z).eventType]??!0),fe=it(()=>`batch_${l(Z).eventType}`),$=it(()=>L(l(fe))),pe=it(()=>l(s)[l(fe)]),ae=it(()=>l(Z).group?ia[l(Z).group]:null);var X=Vm(),oe=f(X),ge=f(oe);ge.__click=()=>b(l(Z).eventType);var Se=f(ge);let me;var R=f(Se),V=h(Se,2);{var ne=Xe=>{var Be=Em();let Ue;var Ke=f(Be);Y(()=>{gr(Be,"title",l(ae).description),Ue=dn(Be,"",Ue,{color:l(ae).color}),C(Ke,l(ae).label)}),S(Xe,Be)};Q(V,Xe=>{l(ae)&&Xe(ne)})}var K=h(V,2),ve=f(K),be=h(K,4);let te;var U=h(ge,2);{var Ee=Xe=>{var Be=Tm();let Ue;Be.__click=Ve=>{Ve.stopPropagation(),m(l(Z).eventType,l(Z).emails)};var Ke=f(Be);{var ot=Ve=>{var ze=vn("â³ Running...");S(Ve,ze)},lt=Ve=>{var ze=vn();Y(()=>C(ze,l($).result.success?`â Done (${l($).result.successful}/${l($).result.total})`:"â Failed")),S(Ve,ze)},Je=Ve=>{var ze=vn();Y(()=>C(ze,`ð Review & Execute (${l(Z).emails.length??""})`)),S(Ve,ze)},tt=Ve=>{var ze=vn();Y(()=>C(ze,`â¶ Execute All (${l(Z).emails.length??""})`)),S(Ve,ze)};Q(Ke,Ve=>{var ze,ht,ct;(ze=l($))!=null&&ze.running?Ve(ot):(ht=l($))!=null&&ht.result?Ve(lt,1):(ct=l(ae))!=null&&ct.requiresApproval?Ve(Je,2):Ve(tt,!1)})}Y(()=>{var Ve,ze;Ue=Nt(Be,1,"execute-all-btn svelte-1w66m1k",null,Ue,{critical:(Ve=l(ae))==null?void 0:Ve.requiresApproval}),Be.disabled=(ze=l($))==null?void 0:ze.running}),S(Xe,Be)};Q(U,Xe=>{l(pe)||Xe(Ee)})}var ce=h(oe,2);{var Te=Xe=>{var Be=Om(),Ue=h(f(Be),2),Ke=h(f(Ue)),ot=f(Ke),lt=h(Ue,2);{var Je=ht=>{var ct=Pm();xt(ct,21,()=>l(pe).actions,Ut,(Bt,ut)=>{var $e=Cm(),dt=f($e);{var Pt=St=>{var Ae=Am(),Gt=f(Ae);Y(()=>C(Gt,l(ut).icon)),S(St,Ae)};Q(dt,St=>{l(ut).icon&&St(Pt)})}var at=h(dt,2),Me=f(at),Yt=h(at,2);{var It=St=>{var Ae=Im(),Gt=f(Ae);Y(()=>C(Gt,`â ${l(ut).description??""}`)),S(St,Ae)};Q(Yt,St=>{l(ut).description&&St(It)})}Y(()=>C(Me,l(ut).name)),S(Bt,$e)}),S(ht,ct)};Q(lt,ht=>{var ct;(ct=l(pe).actions)!=null&&ct.length&&ht(Je)})}var tt=h(lt,2),Ve=f(tt);Ve.__click=()=>_(l(fe));var ze=h(Ve,2);ze.__click=()=>x(l(fe)),Y(()=>C(ot,`${l(Z).emails.length??""} email${l(Z).emails.length===1?"":"s"}`)),S(Xe,Be)};Q(ce,Xe=>{l(pe)&&Xe(Te)})}var qe=h(ce,2);{var He=Xe=>{var Be=Rm();let Ue;var Ke=f(Be);Y(()=>{Ue=Nt(Be,1,"batch-result svelte-1w66m1k",null,Ue,{success:l($).result.success,error:!l($).result.success}),C(Ke,l($).result.message)}),S(Xe,Be)};Q(qe,Xe=>{var Be;(Be=l($))!=null&&Be.result&&!l(pe)&&Xe(He)})}var vt=h(qe,2);{var _t=Xe=>{var Be=Wm();xt(Be,21,()=>l(Z).emails,Ut,(Ue,Ke)=>{const ot=it(()=>`single_${l(Ke).emailId}`),lt=it(()=>L(l(ot))),Je=it(()=>l(s)[l(ot)]);var tt=Hm(),Ve=f(tt),ze=f(Ve),ht=f(ze),ct=h(ze,2),Bt=f(ct);{var ut=st=>{var nt=Mm(),Lt=f(nt);Y(rt=>C(Lt,rt),[()=>o(l(Ke).from)]),S(st,nt)};Q(Bt,st=>{l(Ke).from&&st(ut)})}var $e=h(Bt,2);{var dt=st=>{var nt=jm(),Lt=h(Ze(nt)),rt=f(Lt);Y(Ct=>C(rt,Ct),[()=>u(l(Ke).date)]),S(st,nt)};Q($e,st=>{l(Ke).date&&st(dt)})}var Pt=h(ct,2);{var at=st=>{var nt=Dm(),Lt=f(nt);Y(()=>C(Lt,l(Ke).summary)),S(st,nt)};Q(Pt,st=>{l(Ke).summary&&st(at)})}var Me=h(Pt,2);{var Yt=st=>{var nt=Nm();xt(nt,21,()=>l(Ke).tags,Ut,(Lt,rt)=>{var Ct=Lm(),sn=f(Ct);Y(()=>C(sn,l(rt))),S(Lt,Ct)}),S(st,nt)};Q(Me,st=>{var nt;(nt=l(Ke).tags)!=null&&nt.length&&st(Yt)})}var It=h(Ve,2),St=f(It),Ae=h(f(St),2);{var Gt=st=>{var nt=qm();let Lt;nt.__click=()=>g({type:l(Z).eventType,source:"gmail",data:l(Ke)},l(Ke).emailId);var rt=f(nt);{var Ct=Ht=>{var $t=vn("â³ Running...");S(Ht,$t)},sn=Ht=>{var $t=vn();Y(()=>C($t,l(lt).result.success?"â Done":"â Failed")),S(Ht,$t)},on=Ht=>{var $t=vn("ð Review");S(Ht,$t)},In=Ht=>{var $t=vn("â¶ Execute");S(Ht,$t)};Q(rt,Ht=>{var $t,Wt,zt;($t=l(lt))!=null&&$t.running?Ht(Ct):(Wt=l(lt))!=null&&Wt.result?Ht(sn,1):(zt=l(ae))!=null&&zt.requiresApproval?Ht(on,2):Ht(In,!1)})}Y(()=>{var Ht,$t;Lt=Nt(nt,1,"execute-btn svelte-1w66m1k",null,Lt,{critical:(Ht=l(ae))==null?void 0:Ht.requiresApproval}),nt.disabled=($t=l(lt))==null?void 0:$t.running}),S(st,nt)};Q(Ae,st=>{l(Je)||st(Gt)})}var Tn=h(St,2);{var en=st=>{var nt=Bm(),Lt=h(f(nt),4),rt=f(Lt);rt.__click=()=>_(l(ot));var Ct=h(rt,2);Ct.__click=()=>x(l(ot)),S(st,nt)};Q(Tn,st=>{l(Je)&&st(en)})}var jn=h(Tn,2);{var An=st=>{var nt=Um();xt(nt,21,()=>l(Z).commands,Ut,(Lt,rt,Ct)=>{var sn=zm(),on=f(sn);on.textContent=Ct+1;var In=h(on,2),Ht=f(In);{var $t=Vr=>{var Ln=Fm(),Na=f(Ln);Y(()=>C(Na,l(rt).icon)),S(Vr,Ln)};Q(Ht,Vr=>{l(rt).icon&&Vr($t)})}var Wt=h(Ht,2),zt=f(Wt),fn=h(Wt,2),lr=f(fn);Y(()=>{C(zt,l(rt).name),C(lr,l(rt).description)}),S(Lt,sn)}),S(st,nt)},Ft=st=>{var nt=Km();S(st,nt)};Q(jn,st=>{var nt;(nt=l(Z).commands)!=null&&nt.length?st(An):st(Ft,!1)})}var rn=h(jn,2);{var Dn=st=>{var nt=Gm();let Lt;var rt=f(nt);Y(()=>{Lt=Nt(nt,1,"execution-result svelte-1w66m1k",null,Lt,{success:l(lt).result.success,error:!l(lt).result.success}),C(rt,l(lt).result.message)}),S(st,nt)};Q(rn,st=>{var nt;(nt=l(lt))!=null&&nt.result&&st(Dn)})}Y(()=>C(ht,l(Ke).subject)),S(Ue,tt)}),S(Xe,Be)};Q(vt,Xe=>{l(le)&&Xe(_t)})}Y((Xe,Be)=>{me=dn(Se,"",me,Xe),C(R,Be),C(ve,l(Z).emails.length),te=Nt(be,0,"chevron svelte-1w66m1k",null,te,{open:l(le)})},[()=>({background:I(l(Z).eventType)}),()=>w(l(Z).eventType)]),S(we,X)}),Y(()=>C(ke,`${e.msg.total??""} email${e.msg.total===1?"":"s"} in ${e.msg.groups.length??""} event type${e.msg.groups.length===1?"":"s"}`)),S(N,z)};Q(se,N=>{e.msg.type==="event"?N(ie):e.msg.type==="event-batch"?N(he,1):e.msg.type==="events-grouped"&&N(W,2)})}S(t,O),Dt()}Jt(["click"]);var Xm=T('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),Zm=T('<span class="edate svelte-mt5nvh"> </span>'),Jm=T('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),$m=T('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),eg=T('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),tg=T('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),ng=T('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function rg(t,e){jt(e,!0);let n=Ne(e,"pendingData",3,null),a=Oe(null),s=Oe(null);function o(w){A(a,l(a)===w?null:w,!0),A(s,null)}function u(w){return w.split("_").map(I=>I.charAt(0)+I.slice(1).toLowerCase()).join(" ")}function d(w){if(!w)return"";try{return new Date(w).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function g(w){if(!w)return"";const I=w.replace(/<.*>/,"").trim();return I.length>24?I.slice(0,22)+"â¦":I}var m={toggleGroup:o},_=On(),x=Ze(_);{var b=w=>{var I=ng(),L=f(I),O=f(L),se=h(L,2);xt(se,20,()=>n().order,W=>W,(W,N)=>{const z=it(()=>n().groups[N]),P=it(()=>Wo(N)),ue=it(()=>l(a)===N);var ke=Xm();let xe;ke.__click=()=>o(N);let we;var Z=f(ke);let le;var fe=h(Z),$=h(fe),pe=f($);Y(ae=>{xe=Nt(ke,1,"chip svelte-mt5nvh",null,xe,{active:l(ue)}),we=dn(ke,"",we,{"--c":l(P)}),le=dn(Z,"",le,{background:l(P)}),C(fe,` ${ae??""} `),C(pe,l(z).length)},[()=>u(N)]),S(W,ke)});var ie=h(se,2);{var he=W=>{const N=it(()=>n().groups[l(a)]),z=it(()=>Wo(l(a)));var P=tg(),ue=f(P);let ke;var xe=f(ue);xe.__click=()=>{A(a,null),A(s,null)};var we=h(xe,2),Z=f(we),le=h(we,2),fe=f(le),$=h(ue,2);xt($,21,()=>l(N),ge=>ge.emailId,(ge,Se)=>{var me=Jm(),R=f(me);R.__click=()=>{var Te;return(Te=e.onaskai)==null?void 0:Te.call(e,`Tell me about the email "${l(Se).subject}" from ${l(Se).from}`)};var V=f(R),ne=f(V),K=h(V,2),ve=f(K),be=h(ve);{var te=Te=>{var qe=Zm(),He=f(qe);Y(vt=>C(He,vt),[()=>d(l(Se).date)]),S(Te,qe)};Q(be,Te=>{l(Se).date&&Te(te)})}var U=h(R,2),Ee=f(U);Ee.__click=()=>{var Te;return(Te=e.onmarkacted)==null?void 0:Te.call(e,l(Se).emailId)};var ce=h(Ee,2);ce.__click=()=>{var Te;return(Te=e.ondismiss)==null?void 0:Te.call(e,l(Se).emailId)},Y(Te=>{C(ne,l(Se).subject),C(ve,Te)},[()=>g(l(Se).from)]),S(ge,me)});var pe=h($,2),ae=f(pe);{var X=ge=>{var Se=$m(),me=Ze(Se);me.__click=()=>l(N).forEach(V=>{var ne;return(ne=e.onmarkacted)==null?void 0:ne.call(e,V.emailId)});var R=h(me,2);R.__click=()=>A(s,l(a),!0),S(ge,Se)},oe=ge=>{var Se=eg(),me=Ze(Se),R=f(me),V=h(me,2);V.__click=()=>A(s,null);var ne=h(V,2);ne.__click=()=>{var K;(K=e.oncleargroup)==null||K.call(e,l(a)),A(s,null),A(a,null)},Y(()=>C(R,`Remove ${l(N).length??""}?`)),S(ge,Se)};Q(ae,ge=>{l(s)!==l(a)?ge(X):ge(oe,!1)})}Y(ge=>{ke=dn(ue,"",ke,{"border-color":l(z)}),C(Z,ge),C(fe,l(N).length)},[()=>u(l(a))]),S(W,P)};Q(ie,W=>{l(a)&&n().groups[l(a)]&&W(he)})}Y(()=>C(O,`${n().total??""} item${n().total!==1?"s":""} need attention`)),S(w,I)};Q(x,w=>{n()&&n().total>0&&w(b)})}return S(t,_),Dt(m)}Jt(["click"]);var ag=T('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),sg=T('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),ig=T('<div class="strip svelte-1ed7zw1"><!></div>');function og(t,e){let n=Ne(e,"hasScanData",3,!1),a=Ne(e,"engineReady",3,!1),s=Ne(e,"isScanning",3,!1),o=it(()=>a()&&!n()&&!s()),u=it(()=>l(o)||s());var d=On(),g=Ze(d);{var m=_=>{var x=ig(),b=f(x);{var w=L=>{var O=ag();S(L,O)},I=L=>{var O=sg();O.__click=function(...se){var ie;(ie=e.onscan)==null||ie.apply(this,se)},S(L,O)};Q(b,L=>{s()?L(w):l(o)&&L(I,1)})}S(_,x)};Q(g,_=>{l(u)&&_(m)})}S(t,d)}Jt(["click"]);var lg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),cg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),ug=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),dg=T('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),vg=T('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),fg=T('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),pg=T('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function hg(t,e){jt(e,!0),kn(()=>Jn("GpuPanel"));var n=pg(),a=f(n),s=h(f(a),2),o=h(f(s),2),u=f(o),d=h(s,2),g=h(f(d),2),m=f(g),_=h(d,2);{var x=W=>{var N=lg(),z=h(f(N),2),P=f(z);Y(()=>C(P,e.gpuInfo.device)),S(W,N)};Q(_,W=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&W(x)})}var b=h(_,2);{var w=W=>{var N=cg(),z=h(f(N),2),P=f(z);Y(ue=>C(P,ue),[()=>Go(e.gpuInfo.limits.maxBufferSize)]),S(W,N)};Q(b,W=>{var N;(N=e.gpuInfo.limits)!=null&&N.maxBufferSize&&W(w)})}var I=h(b,2);{var L=W=>{var N=ug(),z=h(f(N),2),P=f(z);Y(()=>C(P,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),S(W,N)};Q(I,W=>{var N;(N=e.gpuInfo.limits)!=null&&N.maxComputeInvocationsPerWorkgroup&&W(L)})}var O=h(I,2);{var se=W=>{var N=dg(),z=h(f(N),2),P=f(z);Y(ue=>C(P,ue),[()=>Go(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),S(W,N)};Q(O,W=>{var N;(N=e.gpuInfo.limits)!=null&&N.maxComputeWorkgroupStorageSize&&W(se)})}var ie=h(O,2);{var he=W=>{var N=fg(),z=f(N),P=f(z),ue=h(z,2);xt(ue,21,()=>e.gpuInfo.features,Ut,(ke,xe)=>{var we=vg(),Z=f(we);Y(()=>C(Z,l(xe))),S(ke,we)}),Y(()=>C(P,`Features (${e.gpuInfo.features.length??""})`)),S(W,N)};Q(ie,W=>{var N;(N=e.gpuInfo.features)!=null&&N.length&&W(he)})}Y(()=>{C(u,e.gpuInfo.vendor),C(m,e.gpuInfo.architecture)}),S(t,n),Dt()}var mg=T('<button class="gpu-badge svelte-1ktw27c"> </button>'),gg=T('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),_g=T('<span class="stats svelte-1ktw27c"> </span>'),yg=T('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),bg=T('<span class="stats preparing svelte-1ktw27c"> </span>'),wg=T('<span class="stats svelte-1ktw27c"> </span>'),kg=T('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),xg=T('<button class="btn svelte-1ktw27c">Stop</button>'),Sg=T('<button class="btn primary svelte-1ktw27c">Send</button>'),Eg=T('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Tg(t,e){jt(e,!0),kn(()=>Jn("ChatView"));let n=Ne(e,"messages",19,()=>[]),a=Ne(e,"pendingData",3,null),s=Ne(e,"hasScanData",3,!1),o=Ne(e,"engineReady",3,!1),u=Ne(e,"isScanning",3,!1),d=Ne(e,"isRunning",3,!1),g=Ne(e,"tps",3,null),m=Ne(e,"numTokens",3,null),_=Ne(e,"generationPhase",3,null),x=Ne(e,"gpuInfo",3,null),b=Ne(e,"backend",3,"webgpu"),w=Ne(e,"chatContainer",15),I=Oe(""),L=Oe(!1);function O(K){K.key==="Enter"&&!K.shiftKey&&(K.preventDefault(),se())}function se(){const K=l(I).trim();!K||d()||(A(I,""),e.onsend(K))}function ie(K){K&&!d()&&e.onsend(K)}var he=Eg(),W=f(he),N=f(W);{var z=K=>{var ve=mg();ve.__click=()=>A(L,!l(L));var be=f(ve);Y(()=>C(be,`WebGPU ${l(L)?"â²":"â¼"}`)),S(K,ve)},P=K=>{var ve=gg();S(K,ve)};Q(N,K=>{x()?K(z):b()==="ollama"&&K(P,1)})}var ue=h(N,2);{var ke=K=>{var ve=_g(),be=f(ve);Y((te,U)=>C(be,`${m()??""} tokens in ${te??""}s
        (${U??""} tok/s)`),[()=>(m()/g()).toFixed(1),()=>g().toFixed(1)]),S(K,ve)},xe=K=>{var ve=yg();S(K,ve)},we=K=>{var ve=bg(),be=f(ve);Y(te=>C(be,`thinking... ${te??""}`),[()=>g()?`${g().toFixed(0)} tok/s`:""]),S(K,ve)},Z=K=>{var ve=wg(),be=f(ve);Y(te=>C(be,`${te??""} tok/s`),[()=>g().toFixed(1)]),S(K,ve)};Q(ue,K=>{g()&&!d()?K(ke):d()&&_()==="preparing"?K(xe,1):d()&&_()==="thinking"?K(we,2):g()&&d()&&K(Z,3)})}var le=h(ue,4);le.__click=function(...K){var ve;(ve=e.onreset)==null||ve.apply(this,K)};var fe=h(W,2);{var $=K=>{hg(K,{get gpuInfo(){return x()}})};Q(fe,K=>{l(L)&&x()&&K($)})}var pe=h(fe,2),ae=f(pe);{var X=K=>{var ve=kg();S(K,ve)};Q(ae,K=>{n().length===0&&!(a()&&a().total>0)&&K(X)})}var oe=h(ae,2);xt(oe,17,n,Ut,(K,ve,be)=>{var te=On(),U=Ze(te);{var Ee=qe=>{rg(qe,{get pendingData(){return l(ve).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:ie})},ce=qe=>{Qm(qe,{get msg(){return l(ve)},get oncommand(){return e.oncommand}})},Te=qe=>{{let He=it(()=>be===n().length-1);$h(qe,{get msg(){return l(ve)},get isLast(){return l(He)},get isRunning(){return d()},get generationPhase(){return _()},get numTokens(){return m()}})}};Q(U,qe=>{l(ve).type==="dashboard"?qe(Ee):l(ve).type==="event"||l(ve).type==="event-batch"||l(ve).type==="events-grouped"?qe(ce,1):qe(Te,!1)})}S(K,te)}),Zu(pe,K=>w(K),()=>w());var ge=h(pe,2);og(ge,{get hasScanData(){return s()},get engineReady(){return o()},get isScanning(){return u()},get onscan(){return e.onscan}});var Se=h(ge,2),me=f(Se);me.__keydown=O;var R=h(me,2);{var V=K=>{var ve=xg();ve.__click=function(...be){var te;(te=e.onstop)==null||te.apply(this,be)},S(K,ve)},ne=K=>{var ve=Sg();ve.__click=se,Y(be=>ve.disabled=be,[()=>!l(I).trim()]),S(K,ve)};Q(R,K=>{d()?K(V):K(ne,!1)})}Y(()=>{le.disabled=d(),me.disabled=d()}),zr(me,()=>l(I),K=>A(I,K)),S(t,he),Dt()}Jt(["click","keydown"]);var Ag=T('<div class="container center svelte-1bi93vx"><!> <!></div>');function Ig(t,e){jt(e,!0);const n=!!navigator.gpu,a=ed();let s=Oe("webgpu"),o=Oe(Vt(Ir[0].id)),u=Oe(null),d=Oe(null),g=Oe(""),m=Oe(Vt([])),_=Oe(Vt([])),x=Oe(!1),b=Oe(null),w=Oe(null),I=Oe(null),L=Oe(null),O=Oe(null),se=Oe(null),ie=Oe(!1),he=Oe(!1),W=!1;kn(async()=>{const[R,V]=await Promise.all([js("aiBackend"),js("selectedModel")]);R&&A(s,R,!0),V&&A(o,V,!0),a.check(),a.isReady&&N();const ne=a.onMessage(K=>{switch(K.status){case"webgpu-info":A(L,K.data,!0);break;case"loading":A(u,"loading"),A(g,K.data,!0);break;case"initiate":A(m,[...l(m),K],!0);break;case"progress":A(m,l(m).map(ve=>ve.file===K.file?{...ve,...K}:ve),!0);break;case"done":A(m,l(m).filter(ve=>ve.file!==K.file),!0);break;case"ready":A(u,"ready"),N();break;case"start":if(!l(x))break;A(O,K.phase||"preparing",!0),A(_,[...l(_),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!l(x))break;A(O,K.phase,!0);break;case"thinking":{if(!l(x))break;A(b,K.tps,!0),A(w,K.numTokens,!0);const ve=l(_)[l(_).length-1];A(_,[...l(_).slice(0,-1),{...ve,thinking:(ve.thinking||"")+K.content}],!0),le();break}case"thinking-done":{if(!l(x))break;A(b,K.tps,!0),A(w,K.numTokens,!0);const ve=l(_)[l(_).length-1];A(_,[...l(_).slice(0,-1),{...ve,thinking:K.content}],!0);break}case"update":{if(!l(x))break;A(b,K.tps,!0),A(w,K.numTokens,!0);const ve=l(_)[l(_).length-1];A(_,[...l(_).slice(0,-1),{...ve,content:ve.content+K.output}],!0),le();break}case"complete":if(!l(x))break;K.tps!==void 0&&A(b,K.tps,!0),K.numTokens!==void 0&&A(w,K.numTokens,!0),A(x,!1),A(O,null),z();break;case"error":A(d,K.data,!0),l(u)==="loading"&&A(u,null),l(x)&&(A(x,!1),A(O,null));break}});return()=>ne()});async function N(){if(!(W||l(_).length>0))try{const R=await Ac();A(se,R,!0),R&&(W=!0,A(_,[{role:"assistant",type:"dashboard",pendingData:R}],!0),le());const V=await Ho();A(ie,V.classified>0)}catch{}}async function z(){try{const R=await Ac();A(se,R,!0);const V=l(_).findIndex(K=>K.type==="dashboard");V!==-1&&(R&&R.total>0?A(_,l(_).map((K,ve)=>ve===V?{...K,pendingData:R}:K),!0):A(_,l(_).filter((K,ve)=>ve!==V),!0));const ne=await Ho();A(ie,ne.classified>0)}catch{}}async function P(R){await Ei(R,"acted"),await z()}async function ue(R){await Ei(R,"dismissed"),await z()}async function ke(R){await yd(R),await z()}async function xe(R){await wl(R),await z()}async function we(){if(l(he)||!a.isReady)return;A(he,!0);let R=null;try{if(await gd(a,{count:20,onProgress:V=>{var ne;V.phase==="done"&&((ne=V.results)==null?void 0:ne.length)>0&&(R=V.results)}}),await z(),(R==null?void 0:R.length)>0){const V=await Up(R);A(_,[...l(_),V],!0),le()}l(se)&&!l(_).some(V=>V.type==="dashboard")&&(A(_,[{role:"assistant",type:"dashboard",pendingData:l(se)},...l(_)],!0),le())}catch(V){console.error("Scan failed:",V)}finally{A(he,!1)}}function Z({event:R,commandId:V}){var ne,K;`${V}${R.type}${((ne=R.data)==null?void 0:ne.subject)||"unknown"}`,A(_,[...l(_),{role:"assistant",content:`Command: ${V}

This command is not yet implemented. In the future, "${V}" will be executed on the ${R.source} event "${((K=R.data)==null?void 0:K.subject)||""}".`}],!0),le()}function le(){Wu().then(()=>{l(I)&&(l(I).scrollTop=l(I).scrollHeight)})}async function fe(){A(u,"loading"),await Ds("selectedModel",l(o)),await Ds("aiBackend",l(s)),l(s)==="ollama"&&A(L,null),a.loadModel(l(o))}Oa(()=>{l(s)==="webgpu"&&!Ir.find(R=>R.id===l(o))?A(o,Ir[0].id,!0):l(s)==="ollama"&&!Cr.find(R=>R.name===l(o))&&A(o,Cr[0].name,!0)});async function $(R){if(!R||l(x))return;if(R.trim().toLowerCase()==="/events"){A(_,[...l(_),{role:"user",content:R}],!0);try{const K=await _d();if(!K.order.length)A(_,[...l(_),{role:"assistant",content:"No classified emails yet. Run a scan first from the Actions page."}],!0);else{const ve=await Kp(K);A(_,[...l(_),ve],!0)}}catch(K){A(_,[...l(_),{role:"assistant",content:`Failed to load events: ${K.message}`}],!0)}le();return}A(_,[...l(_),{role:"user",content:R}],!0),A(b,null),A(x,!0);let V=[];try{const ve=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(R)?await Tp(R):await Ep();ve&&(V=[{role:"system",content:ve}])}catch{}const ne=l(_).filter(K=>K.type!=="dashboard"&&K.type!=="events-grouped"&&K.type!=="event-batch"&&K.type!=="event").map(K=>({role:K.role,content:K.content}));a.generate([...V,...ne]),le()}function pe(){a.interrupt()}function ae(){a.reset(),A(_,[],!0),A(b,null),A(w,null),W=!1,N()}var X=On(),oe=Ze(X);{var ge=R=>{var V=Ag(),ne=f(V);ah(ne,{get isWebGPUAvailable(){return n},get backend(){return l(s)},set backend(te){A(s,te,!0)}});var K=h(ne,2);{var ve=te=>{gh(te,{get gpuInfo(){return l(L)},get error(){return l(d)},onload:fe,get selectedModel(){return l(o)},set selectedModel(U){A(o,U,!0)}})},be=te=>{jh(te,{onload:fe,get selectedModel(){return l(o)},set selectedModel(U){A(o,U,!0)},get error(){return l(d)},set error(U){A(d,U,!0)}})};Q(K,te=>{l(s)==="webgpu"?te(ve):l(s)==="ollama"&&te(be,1)})}S(R,V)},Se=R=>{Uh(R,{get message(){return l(g)},get items(){return l(m)}})},me=R=>{Tg(R,{get messages(){return l(_)},get pendingData(){return l(se)},get hasScanData(){return l(ie)},get engineReady(){return a.isReady},get isScanning(){return l(he)},get isRunning(){return l(x)},get tps(){return l(b)},get numTokens(){return l(w)},get generationPhase(){return l(O)},get gpuInfo(){return l(L)},get backend(){return l(s)},onsend:$,onstop:pe,onreset:ae,onmarkacted:P,ondismiss:ue,onremove:ke,oncleargroup:xe,onscan:we,oncommand:Z,get chatContainer(){return l(I)},set chatContainer(V){A(I,V,!0)}})};Q(oe,R=>{l(u)===null?R(ge):l(u)==="loading"?R(Se,1):R(me,!1)})}S(t,X),Dt()}const yn="gmail",Dc=8,kd=50,xd=100;async function Cg(t,{limit:e=kd,onProgress:n=()=>{},signal:a}={}){var u;const s=await Qe.syncState.get(yn);if(s!=null&&s.historyId)try{return await jg(t,s,n,a)}catch(d){if(d instanceof _l&&(d.status===404||d.code==="notFound")||((u=d.message)==null?void 0:u.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Qe.syncState.delete(yn);else throw d}return await Rg(t,e===0?1/0:e,n,a)}async function Pg(t,{limit:e=kd,onProgress:n=()=>{},signal:a}={}){const s=await Qe.syncState.get(yn);return s!=null&&s.oldestPageToken?await Mg(t,s,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function Og(){const t=await Qe.syncState.get(yn);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Sd(){await Qe.transaction("rw",[Qe.items,Qe.syncState],async()=>{await Qe.items.where("sourceType").equals(yn).delete(),await Qe.syncState.delete(yn)})}async function Rg(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Ma(a);const s=await td(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(s.messagesTotal||e,e)});const o=[];let u,d=null;for(;o.length<e;){Ma(a);const x=e-o.length,b=await nd(t,{maxResults:Math.min(xd,x),pageToken:u}),w=(b.messages||[]).map(I=>I.id);if(o.push(...w),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(s.messagesTotal||e,e)}),u=b.nextPageToken,!u||w.length===0)break}if(d=u||null,o.length===0)return await Qe.syncState.put({sourceType:yn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:g,errors:m}=await Ed(t,o,n,a),_=await Qe.items.where("sourceType").equals(yn).count();return await Qe.syncState.put({sourceType:yn,historyId:s.historyId,lastSyncAt:Date.now(),totalItems:_,oldestPageToken:d}),n({phase:"done",message:`Synced ${g} messages`,current:g,total:g}),{added:g,deleted:0,errors:m}}async function Mg(t,e,n,a,s){a({phase:"listing",message:"Loading more messages...",current:0}),Ma(s);const o=[];let u=e.oldestPageToken,d=null;for(;o.length<n;){Ma(s);const x=n-o.length,b=await nd(t,{maxResults:Math.min(xd,x),pageToken:u}),w=(b.messages||[]).map(I=>I.id);if(o.push(...w),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),u=b.nextPageToken,!u||w.length===0)break}if(d=u||null,o.length===0)return await Qe.syncState.update(yn,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:g,errors:m}=await Ed(t,o,a,s),_=await Qe.items.where("sourceType").equals(yn).count();return await Qe.syncState.update(yn,{totalItems:_,lastSyncAt:Date.now(),oldestPageToken:d}),a({phase:"done",message:d?`Downloaded ${g} more (more available)`:`Downloaded ${g} more (all synced)`,current:_,total:_}),{added:g,errors:m}}async function jg(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Ma(a);let s=0,o=0,u=0,d,g=e.historyId;do{Ma(a);const _=await pp(t,{startHistoryId:e.historyId,pageToken:d});if(g=_.historyId||g,d=_.nextPageToken,!!_.history){for(const x of _.history){if(x.messagesAdded){const b=x.messagesAdded.map(I=>I.message.id),w=[...new Set(b.filter(I=>I))];if(w.length>0){const I=await Promise.allSettled(w.map(O=>rd(t,O))),L=[];for(const O of I)O.status==="fulfilled"?L.push(Td(O.value)):u++;L.length>0&&(await Qe.items.bulkPut(L),await Ad(L),s+=L.length)}}if(x.messagesDeleted){const b=x.messagesDeleted.map(w=>pl(yn,w.message.id)).filter(w=>w);b.length>0&&(await Qe.items.bulkDelete(b),o+=b.length)}}n({phase:"syncing",message:`Changes: +${s} -${o}`,current:s+o})}}while(d);const m=await Qe.items.where("sourceType").equals(yn).count();return await Qe.syncState.put({sourceType:yn,historyId:g,lastSyncAt:Date.now(),totalItems:m,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:s===0&&o===0?"Already up to date":`Synced: +${s} -${o}`,current:m,total:m}),{added:s,deleted:o,errors:u}}async function Ed(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let s=0,o=0;for(let u=0;u<e.length;u+=Dc){Ma(a);const d=e.slice(u,u+Dc),g=await Promise.allSettled(d.map(_=>rd(t,_))),m=[];for(const _ of g)_.status==="fulfilled"?m.push(Td(_.value)):o++;m.length>0&&(await Qe.items.bulkPut(m),await Ad(m)),s+=m.length,n({phase:"downloading",message:`Downloaded ${s} of ${e.length} messages`,current:s,total:e.length})}return{added:s,errors:o}}function Td(t){const e=Jr(t,"From"),n=Jr(t,"To"),a=Jr(t,"Cc"),s=Jr(t,"Subject")||"(no subject)",o=Jr(t,"Date"),u=Jr(t,"Message-ID"),d=Jr(t,"In-Reply-To"),g=Jr(t,"References");let m;try{m=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{m=Date.now()}return{id:pl(yn,t.id),sourceType:yn,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:s,snippet:t.snippet||"",body:hp(t),htmlBody:mp(t),date:m,labels:t.labelIds||[],messageId:u,inReplyTo:d,references:g,raw:t,syncedAt:Date.now()}}async function Ad(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const s=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of s){const u=Dg(o);u&&!e.has(u.email)&&e.set(u.email,{...u,date:n.date})}}for(const[n,{name:a,date:s}]of e)try{const o=await Qe.contacts.where("email").equals(n).first();if(o){const u={};a&&!o.name&&(u.name=a),s>(o.lastSeen||0)&&(u.lastSeen=s),Object.keys(u).length>0&&await Qe.contacts.update(o.id,u)}else await Qe.contacts.add({email:n,name:a||"",firstSeen:s,lastSeen:s})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function Dg(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),s=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:s}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Ma(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var Lg=T(`<div class="default-option svelte-1mdd5r2"><div class="default-option-text svelte-1mdd5r2"><span class="default-badge svelte-1mdd5r2">â Ready to use</span> <span>A shared OAuth Client ID is pre-configured. Just click below to sign in.</span></div> <button class="btn primary use-default-btn svelte-1mdd5r2"><svg viewBox="0 0 24 24" width="16" height="16" class="google-icon-sm svelte-1mdd5r2"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google</button></div> <details class="advanced-section svelte-1mdd5r2"><summary class="svelte-1mdd5r2">Use your own Client ID instead</summary> <div class="advanced-content svelte-1mdd5r2"><div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. Changes may take
                  a few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></details>`,1),Ng=T(`<div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
              is required because the app is deployed at a subpath. Changes may take a
              few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div>`,1),qg=T(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">Sign in with your Google account to browse Gmail messages.
      Everything runs in your browser â no data is sent to any server.</p> <!></div></div>`);function Bg(t,e){jt(e,!0);let n=Ne(e,"clientIdInput",15),a=Ne(e,"defaultClientId",3,"");kn(()=>Jn("SetupGuide"));let s=Oe(null);async function o(I){try{await navigator.clipboard.writeText(I),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}catch{const L=document.createElement("input");L.value=I,document.body.appendChild(L),L.select(),document.execCommand("copy"),document.body.removeChild(L),A(s,I,!0),setTimeout(()=>{A(s,null)},1500)}}const u="http://localhost:5173",d="https://cypherkitty.github.io",g="https://cypherkitty.github.io/me-ai/";var m=qg(),_=f(m),x=h(f(_),4);{var b=I=>{var L=Lg(),O=Ze(L),se=h(f(O),2);se.__click=()=>{n(a()),e.onsave()};var ie=h(O,2),he=h(f(ie),2),W=f(he),N=h(f(W),6),z=h(f(N),2),P=h(f(z),2),ue=h(f(P),2),ke=f(ue);ke.__click=()=>o(u);var xe=f(ke);xe.textContent="http://localhost:5173";var we=h(xe,2),Z=f(we),le=h(ke,2);le.__click=()=>o(d);var fe=f(le);fe.textContent="https://cypherkitty.github.io";var $=h(fe,2),pe=f($),ae=h(P,2),X=h(f(ae),2),oe=f(X);oe.__click=()=>o(u);var ge=f(oe);ge.textContent="http://localhost:5173";var Se=h(ge,2),me=f(Se),R=h(oe,2);R.__click=()=>o(d);var V=f(R);V.textContent="https://cypherkitty.github.io";var ne=h(V,2),K=f(ne),ve=h(R,2);ve.__click=()=>o(g);var be=f(ve);be.textContent="https://cypherkitty.github.io/me-ai/";var te=h(be,2),U=f(te),Ee=h(W,2),ce=f(Ee);ce.__keydown=qe=>qe.key==="Enter"&&e.onsave();var Te=h(ce,2);Te.__click=function(...qe){var He;(He=e.onsave)==null||He.apply(this,qe)},Y(qe=>{C(Z,l(s)===u?"â":"â§"),C(pe,l(s)===d?"â":"â§"),C(me,l(s)===u?"â":"â§"),C(K,l(s)===d?"â":"â§"),C(U,l(s)===g?"â":"â§"),Te.disabled=qe},[()=>!n().trim()]),zr(ce,n),S(I,L)},w=I=>{var L=Ng(),O=Ze(L),se=h(f(O),6),ie=h(f(se),2),he=h(f(ie),2),W=h(f(he),2),N=f(W);N.__click=()=>o(u);var z=f(N);z.textContent="http://localhost:5173";var P=h(z,2),ue=f(P),ke=h(N,2);ke.__click=()=>o(d);var xe=f(ke);xe.textContent="https://cypherkitty.github.io";var we=h(xe,2),Z=f(we),le=h(he,2),fe=h(f(le),2),$=f(fe);$.__click=()=>o(u);var pe=f($);pe.textContent="http://localhost:5173";var ae=h(pe,2),X=f(ae),oe=h($,2);oe.__click=()=>o(d);var ge=f(oe);ge.textContent="https://cypherkitty.github.io";var Se=h(ge,2),me=f(Se),R=h(oe,2);R.__click=()=>o(g);var V=f(R);V.textContent="https://cypherkitty.github.io/me-ai/";var ne=h(V,2),K=f(ne),ve=h(O,2),be=f(ve);be.__keydown=U=>U.key==="Enter"&&e.onsave();var te=h(be,2);te.__click=function(...U){var Ee;(Ee=e.onsave)==null||Ee.apply(this,U)},Y(U=>{C(ue,l(s)===u?"â":"â§"),C(Z,l(s)===d?"â":"â§"),C(X,l(s)===u?"â":"â§"),C(me,l(s)===d?"â":"â§"),C(K,l(s)===g?"â":"â§"),te.disabled=U},[()=>!n().trim()]),zr(be,n),S(I,L)};Q(x,I=>{a()?I(b):I(w,!1)})}S(t,m),Dt()}Jt(["click","keydown"]);function Fg(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof _l?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const s=n.match(/project\s+(\d+)/),o=s==null?void 0:s[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var zg=T('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),Ug=T('<div class="error-card-title svelte-14buhqq"> </div>'),Kg=T('<p class="error-card-fix svelte-14buhqq"> </p>'),Gg=T('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),Hg=T('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),Wg=T('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function Id(t,e){jt(e,!0);let n=Ne(e,"ondismiss",3,null),a=Ne(e,"onsignout",3,null),s=it(()=>Fg(e.error));kn(()=>Jn("ErrorCard"));var o=Wg(),u=f(o);{var d=se=>{var ie=zg(),he=f(ie),W=f(he),N=h(he,2);N.__click=function(...z){var P;(P=n())==null||P.apply(this,z)},Y(()=>C(W,l(s).title)),S(se,ie)},g=se=>{var ie=Ug(),he=f(ie);Y(()=>C(he,l(s).title)),S(se,ie)};Q(u,se=>{n()?se(d):se(g,!1)})}var m=h(u,2),_=f(m),x=h(m,2);{var b=se=>{var ie=Kg(),he=f(ie);Y(()=>C(he,l(s).fix)),S(se,ie)};Q(x,se=>{l(s).fix&&se(b)})}var w=h(x,2);{var I=se=>{var ie=Gg(),he=f(ie);Y(()=>{gr(ie,"href",l(s).link.url),C(he,`${l(s).link.label??""} â`)}),S(se,ie)};Q(w,se=>{l(s).link&&se(I)})}var L=h(w,2);{var O=se=>{var ie=Hg();ie.__click=function(...he){var W;(W=a())==null||W.apply(this,he)},S(se,ie)};Q(L,se=>{l(s).action==="signout"&&a()&&se(O)})}Y(()=>C(_,l(s).description)),S(t,o),Dt()}Jt(["click"]);var Vg=T('<span class="spinner svelte-nyqevv"></span> Signing in...',1),Yg=fl('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),Qg=T('<span class="client-id-badge default svelte-nyqevv">shared default</span>'),Xg=T('<span class="client-id-value svelte-nyqevv"> </span>'),Zg=T(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <!> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function Jg(t,e){jt(e,!0);let n=Ne(e,"isDefaultClientId",3,!1),a=Ne(e,"error",3,null),s=Ne(e,"loadingAuth",3,!1);kn(()=>Jn("AuthCard"));var o=Zg(),u=f(o),d=h(f(u),4);{var g=ie=>{Id(ie,{get error(){return a()},get onsignout(){return e.onsignout}})};Q(d,ie=>{a()&&ie(g)})}var m=h(d,2);m.__click=function(...ie){var he;(he=e.onsignin)==null||he.apply(this,ie)};var _=f(m);{var x=ie=>{var he=Vg();S(ie,he)},b=ie=>{var he=Yg();S(ie,he)};Q(_,ie=>{s()?ie(x):ie(b,!1)})}var w=h(m,4),I=h(f(w),2);{var L=ie=>{var he=Qg();S(ie,he)},O=ie=>{var he=Xg(),W=f(he);Y(N=>C(W,`${N??""}...`),[()=>e.clientId.slice(0,20)]),S(ie,he)};Q(I,ie=>{n()?ie(L):ie(O,!1)})}var se=h(I,2);se.__click=function(...ie){var he;(he=e.onclear)==null||he.apply(this,ie)},Y(()=>m.disabled=s()),S(t,o),Dt()}Jt(["click"]);var $g=T('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),e_=T('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),t_=T('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function n_(t,e){jt(e,!0);let n=Ne(e,"profile",3,null),a=Ne(e,"loadingProfile",3,!1);kn(()=>Jn("ProfileCard"));var s=t_(),o=f(s),u=f(o),d=h(o,2),g=f(d);{var m=b=>{var w=$g();S(b,w)},_=b=>{var w=e_(),I=Ze(w),L=f(I),O=h(I,2),se=f(O);Y((ie,he)=>{C(L,n().emailAddress),C(se,`${ie??""} messages
        Â· ${he??""} threads`)},[()=>{var ie;return((ie=n().messagesTotal)==null?void 0:ie.toLocaleString())||"?"},()=>{var ie;return((ie=n().threadsTotal)==null?void 0:ie.toLocaleString())||"?"}]),S(b,w)};Q(g,b=>{a()?b(m):n()&&b(_,1)})}var x=h(d,2);x.__click=function(...b){var w;(w=e.onsignout)==null||w.apply(this,b)},Y(b=>C(u,b),[()=>n()?sd(n().emailAddress):"?"]),S(t,s),Dt()}Jt(["click"]);var r_=T('<span class="spinner svelte-1ds3j4k"></span>'),a_=fl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),s_=T('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),i_=T('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),o_=T('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),l_=T('<option class="svelte-1ds3j4k"> </option>'),c_=T('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),u_=T('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),d_=T('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),v_=T('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),f_=T('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),p_=T('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function h_(t,e){jt(e,!0),kn(()=>Jn("SyncStatus"));let n=Ne(e,"syncStatus",3,null),a=Ne(e,"syncProgress",3,null),s=Ne(e,"isSyncing",3,!1),o=Oe(!1),u=Oe(50);const d=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function g(X){if(!X)return"never";const oe=Math.floor((Date.now()-X)/1e3);if(oe<60)return"just now";const ge=Math.floor(oe/60);if(ge<60)return`${ge}m ago`;const Se=Math.floor(ge/60);return Se<24?`${Se}h ago`:`${Math.floor(Se/24)}d ago`}function m(){var X,oe;return!((X=a())!=null&&X.total)||!((oe=a())!=null&&oe.current)?0:Math.round(a().current/a().total*100)}var _=p_(),x=f(_),b=f(x),w=f(b);{var I=X=>{var oe=r_();S(X,oe)},L=X=>{var oe=a_();S(X,oe)};Q(w,X=>{s()?X(I):X(L,!1)})}var O=h(b,2),se=h(f(O),2);{var ie=X=>{var oe=s_(),ge=f(oe),Se=h(ge);{var me=V=>{var ne=vn("Â· more available");S(V,ne)},R=V=>{var ne=vn("Â· all synced");S(V,ne)};Q(Se,V=>{n().hasMore?V(me):V(R,!1)})}Y((V,ne)=>C(ge,`${V??""} emails stored
          Â· synced ${ne??""} `),[()=>n().totalItems.toLocaleString(),()=>g(n().lastSyncAt)]),S(X,oe)},he=X=>{var oe=i_();S(X,oe)};Q(se,X=>{var oe;(oe=n())!=null&&oe.synced?X(ie):X(he,!1)})}var W=h(O,2),N=f(W);{var z=X=>{var oe=o_();oe.__click=()=>A(o,!l(o)),S(X,oe)};Q(N,X=>{var oe;(oe=n())!=null&&oe.synced&&!s()&&X(z)})}var P=h(x,2),ue=f(P),ke=h(f(ue),2);xt(ke,21,()=>d,Ut,(X,oe)=>{var ge=l_(),Se=f(ge),me={};Y(()=>{C(Se,l(oe).label),me!==(me=l(oe).value)&&(ge.value=(ge.__value=l(oe).value)??"")}),S(X,ge)});var xe=h(ue,2),we=f(xe);{var Z=X=>{var oe=u_(),ge=Ze(oe);ge.__click=()=>e.onsync(l(u));var Se=f(ge),me=h(ge,2);{var R=V=>{var ne=c_();ne.__click=()=>e.onsyncmore(l(u));var K=f(ne);Y(()=>{ne.disabled=s(),C(K,s()?"Loading...":"Sync More")}),S(V,ne)};Q(me,V=>{n().hasMore&&V(R)})}Y(()=>{ge.disabled=s(),C(Se,s()?"Syncing...":"Sync New")}),S(X,oe)},le=X=>{var oe=d_();oe.__click=()=>e.onsync(l(u));var ge=f(oe);Y(()=>{oe.disabled=s(),C(ge,s()?"Syncing...":"Download Emails")}),S(X,oe)};Q(we,X=>{var oe;(oe=n())!=null&&oe.synced?X(Z):X(le,!1)})}var fe=h(P,2);{var $=X=>{var oe=v_(),ge=f(oe),Se=f(ge);let me,R;var V=h(ge,2),ne=f(V);Y(K=>{me=Nt(Se,1,"progress-fill svelte-1ds3j4k",null,me,{indeterminate:!a().total}),R=dn(Se,"",R,K),C(ne,a().message||"Syncing...")},[()=>({width:`${m()??""}%`})]),S(X,oe)};Q(fe,X=>{s()&&a()&&X($)})}var pe=h(fe,2);{var ae=X=>{var oe=f_(),ge=h(f(oe),2),Se=f(ge);Se.__click=()=>A(o,!1);var me=h(Se,2);me.__click=()=>{e.onclear(),A(o,!1)},S(X,oe)};Q(pe,X=>{l(o)&&X(ae)})}Y(()=>ke.disabled=s()),Di(ke,()=>l(u),X=>A(u,X)),S(t,_),Dt()}Jt(["click"]);var m_=T('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),g_=T('<div class="message-list svelte-y2uamw"></div>');function __(t,e){jt(e,!0);let n=Ne(e,"messages",19,()=>[]);kn(()=>Jn("MessageList"));var a=g_();xt(a,21,n,Ut,(s,o)=>{var u=m_();u.__click=()=>e.onselect(l(o));var d=f(u),g=f(d),m=h(d,2),_=f(m),x=f(_),b=f(x),w=h(x,2),I=f(w),L=h(_,2),O=f(L),se=h(L,2),ie=f(se);Y((he,W,N)=>{C(g,he),C(b,W),C(I,N),C(O,l(o).subject),C(ie,l(o).snippet)},[()=>sd(l(o).from),()=>ad(l(o).from),()=>yl(l(o).date)]),S(s,u)}),S(t,a),Dt()}Jt(["click"]);function Sl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var La=Sl();function Cd(t){La=t}var ma={exec:()=>null};function At(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(s,o)=>{let u=typeof o=="string"?o:o.source;return u=u.replace(Pn.caret,"$1"),n=n.replace(s,u),a},getRegex:()=>new RegExp(n,e)};return a}var y_=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Pn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},b_=/^(?:[ \t]*(?:\n|$))+/,w_=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,k_=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ws=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,x_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,El=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,Pd=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Od=At(Pd).replace(/bull/g,El).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),S_=At(Pd).replace(/bull/g,El).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Tl=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,E_=/^[^\n]+/,Al=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,T_=At(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Al).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),A_=At(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,El).getRegex(),Ui="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Il=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,I_=At("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Il).replace("tag",Ui).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Rd=At(Tl).replace("hr",Ws).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex(),C_=At(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Rd).getRegex(),Cl={blockquote:C_,code:w_,def:T_,fences:k_,heading:x_,hr:Ws,html:I_,lheading:Od,list:A_,newline:b_,paragraph:Rd,table:ma,text:E_},Lc=At("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ws).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex(),P_={...Cl,lheading:S_,table:Lc,paragraph:At(Tl).replace("hr",Ws).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Lc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ui).getRegex()},O_={...Cl,html:At(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Il).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ma,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:At(Tl).replace("hr",Ws).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Od).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},R_=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,M_=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Md=/^( {2,}|\\)\n(?!\s*$)/,j_=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ki=/[\p{P}\p{S}]/u,Pl=/[\s\p{P}\p{S}]/u,jd=/[^\s\p{P}\p{S}]/u,D_=At(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Pl).getRegex(),Dd=/(?!~)[\p{P}\p{S}]/u,L_=/(?!~)[\s\p{P}\p{S}]/u,N_=/(?:[^\s\p{P}\p{S}]|~)/u,Ld=/(?![*_])[\p{P}\p{S}]/u,q_=/(?![*_])[\s\p{P}\p{S}]/u,B_=/(?:[^\s\p{P}\p{S}]|[*_])/u,F_=At(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",y_?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Nd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,z_=At(Nd,"u").replace(/punct/g,Ki).getRegex(),U_=At(Nd,"u").replace(/punct/g,Dd).getRegex(),qd="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",K_=At(qd,"gu").replace(/notPunctSpace/g,jd).replace(/punctSpace/g,Pl).replace(/punct/g,Ki).getRegex(),G_=At(qd,"gu").replace(/notPunctSpace/g,N_).replace(/punctSpace/g,L_).replace(/punct/g,Dd).getRegex(),H_=At("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,jd).replace(/punctSpace/g,Pl).replace(/punct/g,Ki).getRegex(),W_=At(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,Ld).getRegex(),V_="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",Y_=At(V_,"gu").replace(/notPunctSpace/g,B_).replace(/punctSpace/g,q_).replace(/punct/g,Ld).getRegex(),Q_=At(/\\(punct)/,"gu").replace(/punct/g,Ki).getRegex(),X_=At(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Z_=At(Il).replace("(?:-->|$)","-->").getRegex(),J_=At("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Z_).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ti=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,$_=At(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ti).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Bd=At(/^!?\[(label)\]\[(ref)\]/).replace("label",Ti).replace("ref",Al).getRegex(),Fd=At(/^!?\[(ref)\](?:\[\])?/).replace("ref",Al).getRegex(),ey=At("reflink|nolink(?!\\()","g").replace("reflink",Bd).replace("nolink",Fd).getRegex(),Nc=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Ol={_backpedal:ma,anyPunctuation:Q_,autolink:X_,blockSkip:F_,br:Md,code:M_,del:ma,delLDelim:ma,delRDelim:ma,emStrongLDelim:z_,emStrongRDelimAst:K_,emStrongRDelimUnd:H_,escape:R_,link:$_,nolink:Fd,punctuation:D_,reflink:Bd,reflinkSearch:ey,tag:J_,text:j_,url:ma},ty={...Ol,link:At(/^!?\[(label)\]\((.*?)\)/).replace("label",Ti).getRegex(),reflink:At(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ti).getRegex()},Yo={...Ol,emStrongRDelimAst:G_,emStrongLDelim:U_,delLDelim:W_,delRDelim:Y_,url:At(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",Nc).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:At(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",Nc).getRegex()},ny={...Yo,br:At(Md).replace("{2,}","*").getRegex(),text:At(Yo.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},vi={normal:Cl,gfm:P_,pedantic:O_},_s={normal:Ol,gfm:Yo,breaks:ny,pedantic:ty},ry={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},qc=t=>ry[t];function Dr(t,e){if(e){if(Pn.escapeTest.test(t))return t.replace(Pn.escapeReplace,qc)}else if(Pn.escapeTestNoEncode.test(t))return t.replace(Pn.escapeReplaceNoEncode,qc);return t}function Bc(t){try{t=encodeURI(t).replace(Pn.percentDecode,"%")}catch{return null}return t}function Fc(t,e){var o;let n=t.replace(Pn.findPipe,(u,d,g)=>{let m=!1,_=d;for(;--_>=0&&g[_]==="\\";)m=!m;return m?"|":" |"}),a=n.split(Pn.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace(Pn.slashPipe,"|");return a}function ys(t,e,n){let a=t.length;if(a===0)return"";let s=0;for(;s<a&&t.charAt(a-s-1)===e;)s++;return t.slice(0,a-s)}function ay(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function sy(t,e=0){let n=e,a="";for(let s of t)if(s==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=s,n++;return a}function zc(t,e,n,a,s){let o=e.href,u=e.title||null,d=t[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let g={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:u,text:d,tokens:a.inlineTokens(d)};return a.state.inLink=!1,g}function iy(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let s=a[1];return e.split(`
`).map(o=>{let u=o.match(n.other.beginningSpace);if(u===null)return o;let[d]=u;return d.length>=s.length?o.slice(s.length):o}).join(`
`)}var Ai=class{constructor(t){bt(this,"options");bt(this,"rules");bt(this,"lexer");this.options=t||La}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:ys(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=iy(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=ys(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ys(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=ys(e[0],`
`).split(`
`),a="",s="",o=[];for(;n.length>0;){let u=!1,d=[],g;for(g=0;g<n.length;g++)if(this.rules.other.blockquoteStart.test(n[g]))d.push(n[g]),u=!0;else if(!u)d.push(n[g]);else break;n=n.slice(g);let m=d.join(`
`),_=m.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${m}`:m,s=s?`${s}
${_}`:_;let x=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(_,o,!0),this.lexer.state.top=x,n.length===0)break;let b=o.at(-1);if((b==null?void 0:b.type)==="code")break;if((b==null?void 0:b.type)==="blockquote"){let w=b,I=w.raw+`
`+n.join(`
`),L=this.blockquote(I);o[o.length-1]=L,a=a.substring(0,a.length-w.raw.length)+L.raw,s=s.substring(0,s.length-w.text.length)+L.text;break}else if((b==null?void 0:b.type)==="list"){let w=b,I=w.raw+`
`+n.join(`
`),L=this.list(I);o[o.length-1]=L,a=a.substring(0,a.length-b.raw.length)+L.raw,s=s.substring(0,s.length-w.raw.length)+L.raw,n=I.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:s}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim(),o=s.length>1,u={type:"list",raw:"",ordered:o,start:o?+s.slice(0,-1):"",loose:!1,items:[]};s=o?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=o?s:"[*+-]");let d=this.rules.other.listItemRegex(s),g=!1;for(;t;){let _=!1,x="",b="";if(!(e=d.exec(t))||this.rules.block.hr.test(t))break;x=e[0],t=t.substring(x.length);let w=sy(e[2].split(`
`,1)[0],e[1].length),I=t.split(`
`,1)[0],L=!w.trim(),O=0;if(this.options.pedantic?(O=2,b=w.trimStart()):L?O=e[1].length+1:(O=w.search(this.rules.other.nonSpaceChar),O=O>4?1:O,b=w.slice(O),O+=e[1].length),L&&this.rules.other.blankLine.test(I)&&(x+=I+`
`,t=t.substring(I.length+1),_=!0),!_){let se=this.rules.other.nextBulletRegex(O),ie=this.rules.other.hrRegex(O),he=this.rules.other.fencesBeginRegex(O),W=this.rules.other.headingBeginRegex(O),N=this.rules.other.htmlBeginRegex(O),z=this.rules.other.blockquoteBeginRegex(O);for(;t;){let P=t.split(`
`,1)[0],ue;if(I=P,this.options.pedantic?(I=I.replace(this.rules.other.listReplaceNesting,"  "),ue=I):ue=I.replace(this.rules.other.tabCharGlobal,"    "),he.test(I)||W.test(I)||N.test(I)||z.test(I)||se.test(I)||ie.test(I))break;if(ue.search(this.rules.other.nonSpaceChar)>=O||!I.trim())b+=`
`+ue.slice(O);else{if(L||w.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||he.test(w)||W.test(w)||ie.test(w))break;b+=`
`+I}L=!I.trim(),x+=P+`
`,t=t.substring(P.length+1),w=ue.slice(O)}}u.loose||(g?u.loose=!0:this.rules.other.doubleBlankLine.test(x)&&(g=!0)),u.items.push({type:"list_item",raw:x,task:!!this.options.gfm&&this.rules.other.listIsTask.test(b),loose:!1,text:b,tokens:[]}),u.raw+=x}let m=u.items.at(-1);if(m)m.raw=m.raw.trimEnd(),m.text=m.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let _ of u.items){if(this.lexer.state.top=!1,_.tokens=this.lexer.blockTokens(_.text,[]),_.task){if(_.text=_.text.replace(this.rules.other.listReplaceTask,""),((n=_.tokens[0])==null?void 0:n.type)==="text"||((a=_.tokens[0])==null?void 0:a.type)==="paragraph"){_.tokens[0].raw=_.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),_.tokens[0].text=_.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let b=this.lexer.inlineQueue.length-1;b>=0;b--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[b].src)){this.lexer.inlineQueue[b].src=this.lexer.inlineQueue[b].src.replace(this.rules.other.listReplaceTask,"");break}}let x=this.rules.other.listTaskCheckbox.exec(_.raw);if(x){let b={type:"checkbox",raw:x[0]+" ",checked:x[0]!=="[ ]"};_.checked=b.checked,u.loose?_.tokens[0]&&["paragraph","text"].includes(_.tokens[0].type)&&"tokens"in _.tokens[0]&&_.tokens[0].tokens?(_.tokens[0].raw=b.raw+_.tokens[0].raw,_.tokens[0].text=b.raw+_.tokens[0].text,_.tokens[0].tokens.unshift(b)):_.tokens.unshift({type:"paragraph",raw:b.raw,text:b.raw,tokens:[b]}):_.tokens.unshift(b)}}if(!u.loose){let x=_.tokens.filter(w=>w.type==="space"),b=x.length>0&&x.some(w=>this.rules.other.anyLine.test(w.raw));u.loose=b}}if(u.loose)for(let _ of u.items){_.loose=!0;for(let x of _.tokens)x.type==="text"&&(x.type="paragraph")}return u}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:s}}}table(t){var u;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=Fc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let d of a)this.rules.other.tableAlignRight.test(d)?o.align.push("right"):this.rules.other.tableAlignCenter.test(d)?o.align.push("center"):this.rules.other.tableAlignLeft.test(d)?o.align.push("left"):o.align.push(null);for(let d=0;d<n.length;d++)o.header.push({text:n[d],tokens:this.lexer.inline(n[d]),header:!0,align:o.align[d]});for(let d of s)o.rows.push(Fc(d,o.header.length).map((g,m)=>({text:g,tokens:this.lexer.inline(g),header:!1,align:o.align[m]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=ys(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=ay(e[2],"()");if(o===-2)return;if(o>-1){let u=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],s=o[3])}else s=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),zc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[a.toLowerCase()];if(!s){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return zc(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,d=s,g=0,m=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(m.lastIndex=0,e=e.slice(-1*t.length+s);(a=m.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(u=[...o].length,a[3]||a[4]){d+=u;continue}else if((a[5]||a[6])&&s%3&&!((s+u)%3)){g+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d+g);let _=[...a[0]][0].length,x=t.slice(0,s+a.index+_+u);if(Math.min(s,u)%2){let w=x.slice(1,-1);return{type:"em",raw:x,text:w,tokens:this.lexer.inlineTokens(w)}}let b=x.slice(2,-2);return{type:"strong",raw:x,text:b,tokens:this.lexer.inlineTokens(b)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,o,u,d=s,g=this.rules.inline.delRDelim;for(g.lastIndex=0,e=e.slice(-1*t.length+s);(a=g.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(u=[...o].length,u!==s))continue;if(a[3]||a[4]){d+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d);let m=[...a[0]][0].length,_=t.slice(0,s+a.index+m+u),x=_.slice(s,-s);return{type:"del",raw:_,text:x,tokens:this.lexer.inlineTokens(x)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,s;if(e[2]==="@")a=e[0],s="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:a,href:s,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},fr=class Qo{constructor(e){bt(this,"tokens");bt(this,"options");bt(this,"state");bt(this,"inlineQueue");bt(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||La,this.options.tokenizer=this.options.tokenizer||new Ai,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Pn,block:vi.normal,inline:_s.normal};this.options.pedantic?(n.block=vi.pedantic,n.inline=_s.pedantic):this.options.gfm&&(n.block=vi.gfm,this.options.breaks?n.inline=_s.breaks:n.inline=_s.gfm),this.tokenizer.rules=n}static get rules(){return{block:vi,inline:_s}}static lex(e,n){return new Qo(n).lex(e)}static lexInline(e,n){return new Qo(n).inlineTokens(e)}lex(e){e=e.replace(Pn.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var s,o,u;for(this.options.pedantic&&(e=e.replace(Pn.tabCharGlobal,"    ").replace(Pn.spaceLine,""));e;){let d;if((o=(s=this.options.extensions)==null?void 0:s.block)!=null&&o.some(m=>(d=m.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.space(e)){e=e.substring(d.raw.length);let m=n.at(-1);d.raw.length===1&&m!==void 0?m.raw+=`
`:n.push(d);continue}if(d=this.tokenizer.code(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.at(-1).src=m.text):n.push(d);continue}if(d=this.tokenizer.fences(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.heading(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.hr(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.blockquote(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.list(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.html(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.def(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="paragraph"||(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.raw,this.inlineQueue.at(-1).src=m.text):this.tokens.links[d.tag]||(this.tokens.links[d.tag]={href:d.href,title:d.title},n.push(d));continue}if(d=this.tokenizer.table(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.lheading(e)){e=e.substring(d.raw.length),n.push(d);continue}let g=e;if((u=this.options.extensions)!=null&&u.startBlock){let m=1/0,_=e.slice(1),x;this.options.extensions.startBlock.forEach(b=>{x=b.call({lexer:this},_),typeof x=="number"&&x>=0&&(m=Math.min(m,x))}),m<1/0&&m>=0&&(g=e.substring(0,m+1))}if(this.state.top&&(d=this.tokenizer.paragraph(g))){let m=n.at(-1);a&&(m==null?void 0:m.type)==="paragraph"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(d),a=g.length!==e.length,e=e.substring(d.raw.length);continue}if(d=this.tokenizer.text(e)){e=e.substring(d.raw.length);let m=n.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=(m.raw.endsWith(`
`)?"":`
`)+d.raw,m.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=m.text):n.push(d);continue}if(e){let m="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var g,m,_,x,b;let a=e,s=null;if(this.tokens.links){let w=Object.keys(this.tokens.links);if(w.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)w.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=s[2]?s[2].length:0,a=a.slice(0,s.index+o)+"["+"a".repeat(s[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((m=(g=this.options.hooks)==null?void 0:g.emStrongMask)==null?void 0:m.call({lexer:this},a))??a;let u=!1,d="";for(;e;){u||(d=""),u=!1;let w;if((x=(_=this.options.extensions)==null?void 0:_.inline)!=null&&x.some(L=>(w=L.call({lexer:this},e,n))?(e=e.substring(w.raw.length),n.push(w),!0):!1))continue;if(w=this.tokenizer.escape(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.tag(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.link(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(w.raw.length);let L=n.at(-1);w.type==="text"&&(L==null?void 0:L.type)==="text"?(L.raw+=w.raw,L.text+=w.text):n.push(w);continue}if(w=this.tokenizer.emStrong(e,a,d)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.codespan(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.br(e)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.del(e,a,d)){e=e.substring(w.raw.length),n.push(w);continue}if(w=this.tokenizer.autolink(e)){e=e.substring(w.raw.length),n.push(w);continue}if(!this.state.inLink&&(w=this.tokenizer.url(e))){e=e.substring(w.raw.length),n.push(w);continue}let I=e;if((b=this.options.extensions)!=null&&b.startInline){let L=1/0,O=e.slice(1),se;this.options.extensions.startInline.forEach(ie=>{se=ie.call({lexer:this},O),typeof se=="number"&&se>=0&&(L=Math.min(L,se))}),L<1/0&&L>=0&&(I=e.substring(0,L+1))}if(w=this.tokenizer.inlineText(I)){e=e.substring(w.raw.length),w.raw.slice(-1)!=="_"&&(d=w.raw.slice(-1)),u=!0;let L=n.at(-1);(L==null?void 0:L.type)==="text"?(L.raw+=w.raw,L.text+=w.text):n.push(w);continue}if(e){let L="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(L);break}else throw new Error(L)}}return n}},Ii=class{constructor(t){bt(this,"options");bt(this,"parser");this.options=t||La}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(Pn.notSpaceStart))==null?void 0:o[0],s=t.replace(Pn.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Dr(a)+'">'+(n?s:Dr(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:Dr(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let u=0;u<t.items.length;u++){let d=t.items[u];a+=this.listitem(d)}let s=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+s+o+`>
`+a+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let a="";for(let s=0;s<t.rows.length;s++){let o=t.rows[s];n="";for(let u=0;u<o.length;u++)n+=this.tablecell(o[u]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Dr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),s=Bc(t);if(s===null)return a;t=s;let o='<a href="'+t+'"';return e&&(o+=' title="'+Dr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=Bc(t);if(s===null)return Dr(n);t=s;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Dr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Dr(t.text)}},Rl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},pr=class Xo{constructor(e){bt(this,"options");bt(this,"renderer");bt(this,"textRenderer");this.options=e||La,this.options.renderer=this.options.renderer||new Ii,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Rl}static parse(e,n){return new Xo(n).parse(e)}static parseInline(e,n){return new Xo(n).parseInline(e)}parse(e){var a,s;let n="";for(let o=0;o<e.length;o++){let u=e[o];if((s=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&s[u.type]){let g=u,m=this.options.extensions.renderers[g.type].call({parser:this},g);if(m!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(g.type)){n+=m||"";continue}}let d=u;switch(d.type){case"space":{n+=this.renderer.space(d);break}case"hr":{n+=this.renderer.hr(d);break}case"heading":{n+=this.renderer.heading(d);break}case"code":{n+=this.renderer.code(d);break}case"table":{n+=this.renderer.table(d);break}case"blockquote":{n+=this.renderer.blockquote(d);break}case"list":{n+=this.renderer.list(d);break}case"checkbox":{n+=this.renderer.checkbox(d);break}case"html":{n+=this.renderer.html(d);break}case"def":{n+=this.renderer.def(d);break}case"paragraph":{n+=this.renderer.paragraph(d);break}case"text":{n+=this.renderer.text(d);break}default:{let g='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return n}parseInline(e,n=this.renderer){var s,o;let a="";for(let u=0;u<e.length;u++){let d=e[u];if((o=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&o[d.type]){let m=this.options.extensions.renderers[d.type].call({parser:this},d);if(m!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){a+=m||"";continue}}let g=d;switch(g.type){case"escape":{a+=n.text(g);break}case"html":{a+=n.html(g);break}case"link":{a+=n.link(g);break}case"image":{a+=n.image(g);break}case"checkbox":{a+=n.checkbox(g);break}case"strong":{a+=n.strong(g);break}case"em":{a+=n.em(g);break}case"codespan":{a+=n.codespan(g);break}case"br":{a+=n.br(g);break}case"del":{a+=n.del(g);break}case"text":{a+=n.text(g);break}default:{let m='Token with "'+g.type+'" type was not found.';if(this.options.silent)return console.error(m),"";throw new Error(m)}}}return a}},hi,Ts=(hi=class{constructor(t){bt(this,"options");bt(this,"block");this.options=t||La}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?fr.lex:fr.lexInline}provideParser(){return this.block?pr.parse:pr.parseInline}},bt(hi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),bt(hi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),hi),oy=class{constructor(...t){bt(this,"defaults",Sl());bt(this,"options",this.setOptions);bt(this,"parse",this.parseMarkdown(!0));bt(this,"parseInline",this.parseMarkdown(!1));bt(this,"Parser",pr);bt(this,"Renderer",Ii);bt(this,"TextRenderer",Rl);bt(this,"Lexer",fr);bt(this,"Tokenizer",Ai);bt(this,"Hooks",Ts);this.use(...t)}walkTokens(t,e){var a,s;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let u=o;for(let d of u.header)n=n.concat(this.walkTokens(d.tokens,e));for(let d of u.rows)for(let g of d)n=n.concat(this.walkTokens(g.tokens,e));break}case"list":{let u=o;n=n.concat(this.walkTokens(u.items,e));break}default:{let u=o;(s=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&s[u.type]?this.defaults.extensions.childTokens[u.type].forEach(d=>{let g=u[d].flat(1/0);n=n.concat(this.walkTokens(g,e))}):u.tokens&&(n=n.concat(this.walkTokens(u.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=e.renderers[s.name];o?e.renderers[s.name]=function(...u){let d=s.renderer.apply(this,u);return d===!1&&(d=o.apply(this,u)),d}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[s.level];o?o.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),a.extensions=e),n.renderer){let s=this.defaults.renderer||new Ii(this.defaults);for(let o in n.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let u=o,d=n.renderer[u],g=s[u];s[u]=(...m)=>{let _=d.apply(s,m);return _===!1&&(_=g.apply(s,m)),_||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Ai(this.defaults);for(let o in n.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let u=o,d=n.tokenizer[u],g=s[u];s[u]=(...m)=>{let _=d.apply(s,m);return _===!1&&(_=g.apply(s,m)),_}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new Ts;for(let o in n.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let u=o,d=n.hooks[u],g=s[u];Ts.passThroughHooks.has(o)?s[u]=m=>{if(this.defaults.async&&Ts.passThroughHooksRespectAsync.has(o))return(async()=>{let x=await d.call(s,m);return g.call(s,x)})();let _=d.call(s,m);return g.call(s,_)}:s[u]=(...m)=>{if(this.defaults.async)return(async()=>{let x=await d.apply(s,m);return x===!1&&(x=await g.apply(s,m)),x})();let _=d.apply(s,m);return _===!1&&(_=g.apply(s,m)),_}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(u){let d=[];return d.push(o.call(this,u)),s&&(d=d.concat(s.call(this,u))),d}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return fr.lex(t,e??this.defaults)}parser(t,e){return pr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},s={...this.defaults,...a},o=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let u=s.hooks?await s.hooks.preprocess(e):e,d=await(s.hooks?await s.hooks.provideLexer():t?fr.lex:fr.lexInline)(u,s),g=s.hooks?await s.hooks.processAllTokens(d):d;s.walkTokens&&await Promise.all(this.walkTokens(g,s.walkTokens));let m=await(s.hooks?await s.hooks.provideParser():t?pr.parse:pr.parseInline)(g,s);return s.hooks?await s.hooks.postprocess(m):m})().catch(o);try{s.hooks&&(e=s.hooks.preprocess(e));let u=(s.hooks?s.hooks.provideLexer():t?fr.lex:fr.lexInline)(e,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let d=(s.hooks?s.hooks.provideParser():t?pr.parse:pr.parseInline)(u,s);return s.hooks&&(d=s.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Dr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},ja=new oy;function qt(t,e){return ja.parse(t,e)}qt.options=qt.setOptions=function(t){return ja.setOptions(t),qt.defaults=ja.defaults,Cd(qt.defaults),qt};qt.getDefaults=Sl;qt.defaults=La;qt.use=function(...t){return ja.use(...t),qt.defaults=ja.defaults,Cd(qt.defaults),qt};qt.walkTokens=function(t,e){return ja.walkTokens(t,e)};qt.parseInline=ja.parseInline;qt.Parser=pr;qt.parser=pr.parse;qt.Renderer=Ii;qt.TextRenderer=Rl;qt.Lexer=fr;qt.lexer=fr.lex;qt.Tokenizer=Ai;qt.Hooks=Ts;qt.parse=qt;qt.options;qt.setOptions;qt.use;qt.walkTokens;qt.parseInline;pr.parse;fr.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:zd,setPrototypeOf:Uc,isFrozen:ly,getPrototypeOf:cy,getOwnPropertyDescriptor:uy}=Object;let{freeze:Rn,seal:or,create:Zo}=Object,{apply:Jo,construct:$o}=typeof Reflect<"u"&&Reflect;Rn||(Rn=function(e){return e});or||(or=function(e){return e});Jo||(Jo=function(e,n){for(var a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return e.apply(n,s)});$o||($o=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return new e(...a)});const fi=Mn(Array.prototype.forEach),dy=Mn(Array.prototype.lastIndexOf),Kc=Mn(Array.prototype.pop),bs=Mn(Array.prototype.push),vy=Mn(Array.prototype.splice),wi=Mn(String.prototype.toLowerCase),Eo=Mn(String.prototype.toString),To=Mn(String.prototype.match),ws=Mn(String.prototype.replace),fy=Mn(String.prototype.indexOf),py=Mn(String.prototype.trim),dr=Mn(Object.prototype.hasOwnProperty),Cn=Mn(RegExp.prototype.test),ks=hy(TypeError);function Mn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];return Jo(t,e,a)}}function hy(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return $o(t,n)}}function yt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wi;Uc&&Uc(t,null);let a=e.length;for(;a--;){let s=e[a];if(typeof s=="string"){const o=n(s);o!==s&&(ly(e)||(e[a]=o),s=o)}t[s]=!0}return t}function my(t){for(let e=0;e<t.length;e++)dr(t,e)||(t[e]=null);return t}function xr(t){const e=Zo(null);for(const[n,a]of zd(t))dr(t,n)&&(Array.isArray(a)?e[n]=my(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=xr(a):e[n]=a);return e}function xs(t,e){for(;t!==null;){const a=uy(t,e);if(a){if(a.get)return Mn(a.get);if(typeof a.value=="function")return Mn(a.value)}t=cy(t)}function n(){return null}return n}const Gc=Rn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ao=Rn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Io=Rn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),gy=Rn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Co=Rn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),_y=Rn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Hc=Rn(["#text"]),Wc=Rn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Po=Rn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Vc=Rn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),pi=Rn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),yy=or(/\{\{[\w\W]*|[\w\W]*\}\}/gm),by=or(/<%[\w\W]*|[\w\W]*%>/gm),wy=or(/\$\{[\w\W]*/gm),ky=or(/^data-[\-\w.\u00B7-\uFFFF]+$/),xy=or(/^aria-[\-\w]+$/),Ud=or(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Sy=or(/^(?:\w+script|data):/i),Ey=or(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Kd=or(/^html$/i),Ty=or(/^[a-z][.\w]*(-[.\w]+)+$/i);var Yc=Object.freeze({__proto__:null,ARIA_ATTR:xy,ATTR_WHITESPACE:Ey,CUSTOM_ELEMENT:Ty,DATA_ATTR:ky,DOCTYPE_NAME:Kd,ERB_EXPR:by,IS_ALLOWED_URI:Ud,IS_SCRIPT_OR_DATA:Sy,MUSTACHE_EXPR:yy,TMPLIT_EXPR:wy});const Ss={element:1,text:3,progressingInstruction:7,comment:8,document:9},Ay=function(){return typeof window>"u"?null:window},Iy=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const s="data-tt-policy-suffix";n&&n.hasAttribute(s)&&(a=n.getAttribute(s));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Qc=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Gd(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ay();const e=Ye=>Gd(Ye);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==Ss.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,s=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:d,Element:g,NodeFilter:m,NamedNodeMap:_=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:x,DOMParser:b,trustedTypes:w}=t,I=g.prototype,L=xs(I,"cloneNode"),O=xs(I,"remove"),se=xs(I,"nextSibling"),ie=xs(I,"childNodes"),he=xs(I,"parentNode");if(typeof u=="function"){const Ye=n.createElement("template");Ye.content&&Ye.content.ownerDocument&&(n=Ye.content.ownerDocument)}let W,N="";const{implementation:z,createNodeIterator:P,createDocumentFragment:ue,getElementsByTagName:ke}=n,{importNode:xe}=a;let we=Qc();e.isSupported=typeof zd=="function"&&typeof he=="function"&&z&&z.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Z,ERB_EXPR:le,TMPLIT_EXPR:fe,DATA_ATTR:$,ARIA_ATTR:pe,IS_SCRIPT_OR_DATA:ae,ATTR_WHITESPACE:X,CUSTOM_ELEMENT:oe}=Yc;let{IS_ALLOWED_URI:ge}=Yc,Se=null;const me=yt({},[...Gc,...Ao,...Io,...Co,...Hc]);let R=null;const V=yt({},[...Wc,...Po,...Vc,...pi]);let ne=Object.seal(Zo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),K=null,ve=null;const be=Object.seal(Zo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let te=!0,U=!0,Ee=!1,ce=!0,Te=!1,qe=!0,He=!1,vt=!1,_t=!1,Xe=!1,Be=!1,Ue=!1,Ke=!0,ot=!1;const lt="user-content-";let Je=!0,tt=!1,Ve={},ze=null;const ht=yt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ct=null;const Bt=yt({},["audio","video","img","source","image","track"]);let ut=null;const $e=yt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),dt="http://www.w3.org/1998/Math/MathML",Pt="http://www.w3.org/2000/svg",at="http://www.w3.org/1999/xhtml";let Me=at,Yt=!1,It=null;const St=yt({},[dt,Pt,at],Eo);let Ae=yt({},["mi","mo","mn","ms","mtext"]),Gt=yt({},["annotation-xml"]);const Tn=yt({},["title","style","font","a","script"]);let en=null;const jn=["application/xhtml+xml","text/html"],An="text/html";let Ft=null,rn=null;const Dn=n.createElement("form"),st=function(j){return j instanceof RegExp||j instanceof Function},nt=function(){let j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(rn&&rn===j)){if((!j||typeof j!="object")&&(j={}),j=xr(j),en=jn.indexOf(j.PARSER_MEDIA_TYPE)===-1?An:j.PARSER_MEDIA_TYPE,Ft=en==="application/xhtml+xml"?Eo:wi,Se=dr(j,"ALLOWED_TAGS")?yt({},j.ALLOWED_TAGS,Ft):me,R=dr(j,"ALLOWED_ATTR")?yt({},j.ALLOWED_ATTR,Ft):V,It=dr(j,"ALLOWED_NAMESPACES")?yt({},j.ALLOWED_NAMESPACES,Eo):St,ut=dr(j,"ADD_URI_SAFE_ATTR")?yt(xr($e),j.ADD_URI_SAFE_ATTR,Ft):$e,ct=dr(j,"ADD_DATA_URI_TAGS")?yt(xr(Bt),j.ADD_DATA_URI_TAGS,Ft):Bt,ze=dr(j,"FORBID_CONTENTS")?yt({},j.FORBID_CONTENTS,Ft):ht,K=dr(j,"FORBID_TAGS")?yt({},j.FORBID_TAGS,Ft):xr({}),ve=dr(j,"FORBID_ATTR")?yt({},j.FORBID_ATTR,Ft):xr({}),Ve=dr(j,"USE_PROFILES")?j.USE_PROFILES:!1,te=j.ALLOW_ARIA_ATTR!==!1,U=j.ALLOW_DATA_ATTR!==!1,Ee=j.ALLOW_UNKNOWN_PROTOCOLS||!1,ce=j.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Te=j.SAFE_FOR_TEMPLATES||!1,qe=j.SAFE_FOR_XML!==!1,He=j.WHOLE_DOCUMENT||!1,Xe=j.RETURN_DOM||!1,Be=j.RETURN_DOM_FRAGMENT||!1,Ue=j.RETURN_TRUSTED_TYPE||!1,_t=j.FORCE_BODY||!1,Ke=j.SANITIZE_DOM!==!1,ot=j.SANITIZE_NAMED_PROPS||!1,Je=j.KEEP_CONTENT!==!1,tt=j.IN_PLACE||!1,ge=j.ALLOWED_URI_REGEXP||Ud,Me=j.NAMESPACE||at,Ae=j.MATHML_TEXT_INTEGRATION_POINTS||Ae,Gt=j.HTML_INTEGRATION_POINTS||Gt,ne=j.CUSTOM_ELEMENT_HANDLING||{},j.CUSTOM_ELEMENT_HANDLING&&st(j.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ne.tagNameCheck=j.CUSTOM_ELEMENT_HANDLING.tagNameCheck),j.CUSTOM_ELEMENT_HANDLING&&st(j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ne.attributeNameCheck=j.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),j.CUSTOM_ELEMENT_HANDLING&&typeof j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ne.allowCustomizedBuiltInElements=j.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Te&&(U=!1),Be&&(Xe=!0),Ve&&(Se=yt({},Hc),R=[],Ve.html===!0&&(yt(Se,Gc),yt(R,Wc)),Ve.svg===!0&&(yt(Se,Ao),yt(R,Po),yt(R,pi)),Ve.svgFilters===!0&&(yt(Se,Io),yt(R,Po),yt(R,pi)),Ve.mathMl===!0&&(yt(Se,Co),yt(R,Vc),yt(R,pi))),j.ADD_TAGS&&(typeof j.ADD_TAGS=="function"?be.tagCheck=j.ADD_TAGS:(Se===me&&(Se=xr(Se)),yt(Se,j.ADD_TAGS,Ft))),j.ADD_ATTR&&(typeof j.ADD_ATTR=="function"?be.attributeCheck=j.ADD_ATTR:(R===V&&(R=xr(R)),yt(R,j.ADD_ATTR,Ft))),j.ADD_URI_SAFE_ATTR&&yt(ut,j.ADD_URI_SAFE_ATTR,Ft),j.FORBID_CONTENTS&&(ze===ht&&(ze=xr(ze)),yt(ze,j.FORBID_CONTENTS,Ft)),j.ADD_FORBID_CONTENTS&&(ze===ht&&(ze=xr(ze)),yt(ze,j.ADD_FORBID_CONTENTS,Ft)),Je&&(Se["#text"]=!0),He&&yt(Se,["html","head","body"]),Se.table&&(yt(Se,["tbody"]),delete K.tbody),j.TRUSTED_TYPES_POLICY){if(typeof j.TRUSTED_TYPES_POLICY.createHTML!="function")throw ks('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof j.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ks('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');W=j.TRUSTED_TYPES_POLICY,N=W.createHTML("")}else W===void 0&&(W=Iy(w,s)),W!==null&&typeof N=="string"&&(N=W.createHTML(""));Rn&&Rn(j),rn=j}},Lt=yt({},[...Ao,...Io,...gy]),rt=yt({},[...Co,..._y]),Ct=function(j){let Pe=he(j);(!Pe||!Pe.tagName)&&(Pe={namespaceURI:Me,tagName:"template"});const je=wi(j.tagName),Ot=wi(Pe.tagName);return It[j.namespaceURI]?j.namespaceURI===Pt?Pe.namespaceURI===at?je==="svg":Pe.namespaceURI===dt?je==="svg"&&(Ot==="annotation-xml"||Ae[Ot]):!!Lt[je]:j.namespaceURI===dt?Pe.namespaceURI===at?je==="math":Pe.namespaceURI===Pt?je==="math"&&Gt[Ot]:!!rt[je]:j.namespaceURI===at?Pe.namespaceURI===Pt&&!Gt[Ot]||Pe.namespaceURI===dt&&!Ae[Ot]?!1:!rt[je]&&(Tn[je]||!Lt[je]):!!(en==="application/xhtml+xml"&&It[j.namespaceURI]):!1},sn=function(j){bs(e.removed,{element:j});try{he(j).removeChild(j)}catch{O(j)}},on=function(j,Pe){try{bs(e.removed,{attribute:Pe.getAttributeNode(j),from:Pe})}catch{bs(e.removed,{attribute:null,from:Pe})}if(Pe.removeAttribute(j),j==="is")if(Xe||Be)try{sn(Pe)}catch{}else try{Pe.setAttribute(j,"")}catch{}},In=function(j){let Pe=null,je=null;if(_t)j="<remove></remove>"+j;else{const tn=To(j,/^[\r\n\t ]+/);je=tn&&tn[0]}en==="application/xhtml+xml"&&Me===at&&(j='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+j+"</body></html>");const Ot=W?W.createHTML(j):j;if(Me===at)try{Pe=new b().parseFromString(Ot,en)}catch{}if(!Pe||!Pe.documentElement){Pe=z.createDocument(Me,"template",null);try{Pe.documentElement.innerHTML=Yt?N:Ot}catch{}}const Qt=Pe.body||Pe.documentElement;return j&&je&&Qt.insertBefore(n.createTextNode(je),Qt.childNodes[0]||null),Me===at?ke.call(Pe,He?"html":"body")[0]:He?Pe.documentElement:Qt},Ht=function(j){return P.call(j.ownerDocument||j,j,m.SHOW_ELEMENT|m.SHOW_COMMENT|m.SHOW_TEXT|m.SHOW_PROCESSING_INSTRUCTION|m.SHOW_CDATA_SECTION,null)},$t=function(j){return j instanceof x&&(typeof j.nodeName!="string"||typeof j.textContent!="string"||typeof j.removeChild!="function"||!(j.attributes instanceof _)||typeof j.removeAttribute!="function"||typeof j.setAttribute!="function"||typeof j.namespaceURI!="string"||typeof j.insertBefore!="function"||typeof j.hasChildNodes!="function")},Wt=function(j){return typeof d=="function"&&j instanceof d};function zt(Ye,j,Pe){fi(Ye,je=>{je.call(e,j,Pe,rn)})}const fn=function(j){let Pe=null;if(zt(we.beforeSanitizeElements,j,null),$t(j))return sn(j),!0;const je=Ft(j.nodeName);if(zt(we.uponSanitizeElement,j,{tagName:je,allowedTags:Se}),qe&&j.hasChildNodes()&&!Wt(j.firstElementChild)&&Cn(/<[/\w!]/g,j.innerHTML)&&Cn(/<[/\w!]/g,j.textContent)||j.nodeType===Ss.progressingInstruction||qe&&j.nodeType===Ss.comment&&Cn(/<[/\w]/g,j.data))return sn(j),!0;if(!(be.tagCheck instanceof Function&&be.tagCheck(je))&&(!Se[je]||K[je])){if(!K[je]&&Vr(je)&&(ne.tagNameCheck instanceof RegExp&&Cn(ne.tagNameCheck,je)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(je)))return!1;if(Je&&!ze[je]){const Ot=he(j)||j.parentNode,Qt=ie(j)||j.childNodes;if(Qt&&Ot){const tn=Qt.length;for(let ln=tn-1;ln>=0;--ln){const Nn=L(Qt[ln],!0);Nn.__removalCount=(j.__removalCount||0)+1,Ot.insertBefore(Nn,se(j))}}}return sn(j),!0}return j instanceof g&&!Ct(j)||(je==="noscript"||je==="noembed"||je==="noframes")&&Cn(/<\/no(script|embed|frames)/i,j.innerHTML)?(sn(j),!0):(Te&&j.nodeType===Ss.text&&(Pe=j.textContent,fi([Z,le,fe],Ot=>{Pe=ws(Pe,Ot," ")}),j.textContent!==Pe&&(bs(e.removed,{element:j.cloneNode()}),j.textContent=Pe)),zt(we.afterSanitizeElements,j,null),!1)},lr=function(j,Pe,je){if(Ke&&(Pe==="id"||Pe==="name")&&(je in n||je in Dn))return!1;if(!(U&&!ve[Pe]&&Cn($,Pe))){if(!(te&&Cn(pe,Pe))){if(!(be.attributeCheck instanceof Function&&be.attributeCheck(Pe,j))){if(!R[Pe]||ve[Pe]){if(!(Vr(j)&&(ne.tagNameCheck instanceof RegExp&&Cn(ne.tagNameCheck,j)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(j))&&(ne.attributeNameCheck instanceof RegExp&&Cn(ne.attributeNameCheck,Pe)||ne.attributeNameCheck instanceof Function&&ne.attributeNameCheck(Pe,j))||Pe==="is"&&ne.allowCustomizedBuiltInElements&&(ne.tagNameCheck instanceof RegExp&&Cn(ne.tagNameCheck,je)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(je))))return!1}else if(!ut[Pe]){if(!Cn(ge,ws(je,X,""))){if(!((Pe==="src"||Pe==="xlink:href"||Pe==="href")&&j!=="script"&&fy(je,"data:")===0&&ct[j])){if(!(Ee&&!Cn(ae,ws(je,X,"")))){if(je)return!1}}}}}}}return!0},Vr=function(j){return j!=="annotation-xml"&&To(j,oe)},Ln=function(j){zt(we.beforeSanitizeAttributes,j,null);const{attributes:Pe}=j;if(!Pe||$t(j))return;const je={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:R,forceKeepAttr:void 0};let Ot=Pe.length;for(;Ot--;){const Qt=Pe[Ot],{name:tn,namespaceURI:ln,value:Nn}=Qt,br=Ft(tn),la=Nn;let Zt=tn==="value"?la:py(la);if(je.attrName=br,je.attrValue=Zt,je.keepAttr=!0,je.forceKeepAttr=void 0,zt(we.uponSanitizeAttribute,j,je),Zt=je.attrValue,ot&&(br==="id"||br==="name")&&(on(tn,j),Zt=lt+Zt),qe&&Cn(/((--!?|])>)|<\/(style|title|textarea)/i,Zt)){on(tn,j);continue}if(br==="attributename"&&To(Zt,"href")){on(tn,j);continue}if(je.forceKeepAttr)continue;if(!je.keepAttr){on(tn,j);continue}if(!ce&&Cn(/\/>/i,Zt)){on(tn,j);continue}Te&&fi([Z,le,fe],ca=>{Zt=ws(Zt,ca," ")});const os=Ft(j.nodeName);if(!lr(os,br,Zt)){on(tn,j);continue}if(W&&typeof w=="object"&&typeof w.getAttributeType=="function"&&!ln)switch(w.getAttributeType(os,br)){case"TrustedHTML":{Zt=W.createHTML(Zt);break}case"TrustedScriptURL":{Zt=W.createScriptURL(Zt);break}}if(Zt!==la)try{ln?j.setAttributeNS(ln,tn,Zt):j.setAttribute(tn,Zt),$t(j)?sn(j):Kc(e.removed)}catch{on(tn,j)}}zt(we.afterSanitizeAttributes,j,null)},Na=function Ye(j){let Pe=null;const je=Ht(j);for(zt(we.beforeSanitizeShadowDOM,j,null);Pe=je.nextNode();)zt(we.uponSanitizeShadowNode,Pe,null),fn(Pe),Ln(Pe),Pe.content instanceof o&&Ye(Pe.content);zt(we.afterSanitizeShadowDOM,j,null)};return e.sanitize=function(Ye){let j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Pe=null,je=null,Ot=null,Qt=null;if(Yt=!Ye,Yt&&(Ye="<!-->"),typeof Ye!="string"&&!Wt(Ye))if(typeof Ye.toString=="function"){if(Ye=Ye.toString(),typeof Ye!="string")throw ks("dirty is not a string, aborting")}else throw ks("toString is not a function");if(!e.isSupported)return Ye;if(vt||nt(j),e.removed=[],typeof Ye=="string"&&(tt=!1),tt){if(Ye.nodeName){const Nn=Ft(Ye.nodeName);if(!Se[Nn]||K[Nn])throw ks("root node is forbidden and cannot be sanitized in-place")}}else if(Ye instanceof d)Pe=In("<!---->"),je=Pe.ownerDocument.importNode(Ye,!0),je.nodeType===Ss.element&&je.nodeName==="BODY"||je.nodeName==="HTML"?Pe=je:Pe.appendChild(je);else{if(!Xe&&!Te&&!He&&Ye.indexOf("<")===-1)return W&&Ue?W.createHTML(Ye):Ye;if(Pe=In(Ye),!Pe)return Xe?null:Ue?N:""}Pe&&_t&&sn(Pe.firstChild);const tn=Ht(tt?Ye:Pe);for(;Ot=tn.nextNode();)fn(Ot),Ln(Ot),Ot.content instanceof o&&Na(Ot.content);if(tt)return Ye;if(Xe){if(Be)for(Qt=ue.call(Pe.ownerDocument);Pe.firstChild;)Qt.appendChild(Pe.firstChild);else Qt=Pe;return(R.shadowroot||R.shadowrootmode)&&(Qt=xe.call(a,Qt,!0)),Qt}let ln=He?Pe.outerHTML:Pe.innerHTML;return He&&Se["!doctype"]&&Pe.ownerDocument&&Pe.ownerDocument.doctype&&Pe.ownerDocument.doctype.name&&Cn(Kd,Pe.ownerDocument.doctype.name)&&(ln="<!DOCTYPE "+Pe.ownerDocument.doctype.name+`>
`+ln),Te&&fi([Z,le,fe],Nn=>{ln=ws(ln,Nn," ")}),W&&Ue?W.createHTML(ln):ln},e.setConfig=function(){let Ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};nt(Ye),vt=!0},e.clearConfig=function(){rn=null,vt=!1},e.isValidAttribute=function(Ye,j,Pe){rn||nt({});const je=Ft(Ye),Ot=Ft(j);return lr(je,Ot,Pe)},e.addHook=function(Ye,j){typeof j=="function"&&bs(we[Ye],j)},e.removeHook=function(Ye,j){if(j!==void 0){const Pe=dy(we[Ye],j);return Pe===-1?void 0:vy(we[Ye],Pe,1)[0]}return Kc(we[Ye])},e.removeHooks=function(Ye){we[Ye]=[]},e.removeAllHooks=function(){we=Qc()},e}var Cy=Gd();function Py(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Xc(t.from)} |`),e.push(`| **To** | ${Xc(t.to)} |`),e.push(`| **Date** | ${yl(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?Oy(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Xc(t){return(t||"").replace(/\|/g,"\\|")}function Oy(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return el(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function Ry(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const s=e.toLowerCase();return s.includes("spacer")||s.includes("transparent")||s.includes("transp.gif")||s.includes("/track")&&s.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(s)?!0:s.includes("mail.google.com/mail/u/")&&s.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(s)||s.endsWith(".gif")&&s.includes("1x1"))}function el(t){var s;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",u=t.getAttribute("alt")||"";return Ry(t,o)?"":`![${u}](${o})`}const n=Array.from(t.childNodes).map(el).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((s=t.parentElement)==null?void 0:s.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(u=>el(u).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),u=(o.match(/\|/g)||[]).length-1,d="| "+Array(Math.max(u,1)).fill("---").join(" | ")+" |";return`${o}${d}
`}return n}function My(t){return id(t,"md")}function Zc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}function jy(t){return t.raw||null}function Dy(t){const e=jy(t);return e?JSON.stringify(e,null,2):"null"}function Ly(t){return id(t,"json")}var Ny=T('<button title="View as Markdown">.md</button>'),qy=T('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),By=T('<pre class="md-raw svelte-1b0rzpb"> </pre>'),Fy=T('<div class="md-preview svelte-1b0rzpb"><!></div>'),zy=T('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),Uy=T('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),Ky=T('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),Gy=T('<pre class="message-text svelte-1b0rzpb"> </pre>'),Hy=T('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),Wy=T('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),Vy=T('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function Yy(t,e){jt(e,!0);let n=Ne(e,"loading",3,!1);kn(()=>Jn("MessageModal"));const a=new qt.Renderer;a.link=({href:Z,title:le,text:fe})=>{const $=le?` title="${le}"`:"";return`<a href="${Z}"${$} target="_blank" rel="noopener">${fe}</a>`},qt.setOptions({breaks:!0,gfm:!0,renderer:a});let s=Oe("email"),o=it(()=>e.message.body?Py(e.message):""),u=it(()=>Dy(e.message)),d=Oe("raw");function g(Z){A(s,l(s)===Z?"email":Z,!0),Z==="markdown"&&A(d,"raw")}function m(){Zc(l(o),My(e.message))}function _(){Zc(l(u),Ly(e.message),"application/json;charset=utf-8")}function x(Z){const le=qt.parse(Z);return Cy.sanitize(le,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let b=Oe(null);Oa(()=>{var Z;if(l(b)&&e.message.htmlBody&&!n()&&l(s)==="email"){const le=l(b).contentDocument||((Z=l(b).contentWindow)==null?void 0:Z.document);le&&(le.open(),le.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),le.close())}});var w=Vy();w.__click=function(...Z){var le;(le=e.onclose)==null||le.apply(this,Z)};var I=f(w);I.__click=Z=>Z.stopPropagation();var L=f(I),O=f(L),se=f(O),ie=h(O,2),he=f(ie);let W;he.__click=()=>g("json");var N=h(he,2);{var z=Z=>{var le=Ny();let fe;le.__click=()=>g("markdown"),Y(()=>fe=Nt(le,1,"action-btn svelte-1b0rzpb",null,fe,{active:l(s)==="markdown"})),S(Z,le)};Q(N,Z=>{e.message.body&&Z(z)})}var P=h(N,2);P.__click=function(...Z){var le;(le=e.onclose)==null||le.apply(this,Z)};var ue=h(L,2);{var ke=Z=>{var le=qy(),fe=Ze(le),$=h(f(fe),2);$.__click=_;var pe=h(fe,2),ae=f(pe),X=f(ae);Y(()=>C(X,l(u))),S(Z,le)},xe=Z=>{var le=zy(),fe=Ze(le),$=f(fe),pe=f($);let ae;pe.__click=()=>A(d,"raw");var X=h(pe,2);let oe;X.__click=()=>A(d,"preview");var ge=h($,2);ge.__click=m;var Se=h(fe,2),me=f(Se);{var R=ne=>{var K=By(),ve=f(K);Y(()=>C(ve,l(o))),S(ne,K)},V=ne=>{var K=Fy(),ve=f(K);Lf(ve,()=>x(l(o))),S(ne,K)};Q(me,ne=>{l(d)==="raw"?ne(R):ne(V,!1)})}Y(()=>{ae=Nt(pe,1,"md-tab svelte-1b0rzpb",null,ae,{active:l(d)==="raw"}),oe=Nt(X,1,"md-tab svelte-1b0rzpb",null,oe,{active:l(d)==="preview"})}),S(Z,le)},we=Z=>{var le=Wy(),fe=Ze(le),$=f(fe),pe=h(f($),2),ae=f(pe),X=h($,2),oe=h(f(X),2),ge=f(oe),Se=h(X,2),me=h(f(Se),2),R=f(me),V=h(fe,2),ne=f(V);{var K=U=>{var Ee=Uy();S(U,Ee)},ve=U=>{var Ee=Ky();Zu(Ee,ce=>A(b,ce),()=>l(b)),S(U,Ee)},be=U=>{var Ee=Gy(),ce=f(Ee);Y(()=>C(ce,e.message.body)),S(U,Ee)},te=U=>{var Ee=Hy();S(U,Ee)};Q(ne,U=>{n()?U(K):e.message.htmlBody?U(ve,1):e.message.body?U(be,2):U(te,!1)})}Y(U=>{C(ae,e.message.from),C(ge,e.message.to),C(R,U)},[()=>yl(e.message.date)]),S(Z,le)};Q(ue,Z=>{l(s)==="json"?Z(ke):l(s)==="markdown"?Z(xe,1):Z(we,!1)})}Y(()=>{C(se,e.message.subject),W=Nt(he,1,"action-btn svelte-1b0rzpb",null,W,{active:l(s)==="json"})}),S(t,w),Dt()}Jt(["click"]);var Qy=T('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),Xy=T('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),Zy=T('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),Jy=T("<p> </p>"),$y=T('<p>No emails in local storage. Click "Sync New" to download.</p>'),eb=T('<div class="empty-state svelte-6ts5xm"><!></div>'),tb=T('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),nb=T('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function rb(t,e){jt(e,!0),kn(()=>Jn("DashboardView"));let n=Ne(e,"error",3,null),a=Ne(e,"profile",3,null),s=Ne(e,"loadingProfile",3,!1),o=Ne(e,"emailMessages",19,()=>[]),u=Ne(e,"totalLocalMessages",3,0),d=Ne(e,"hasMoreLocal",3,!1),g=Ne(e,"loadingMessages",3,!1),m=Ne(e,"selectedMessage",3,null),_=Ne(e,"syncStatus",3,null),x=Ne(e,"syncProgress",3,null),b=Ne(e,"isSyncing",3,!1),w=Ne(e,"searchQuery",15);var I=nb(),L=Ze(I),O=f(L);{var se=$=>{Id($,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};Q(O,$=>{n()&&$(se)})}var ie=h(O,2);n_(ie,{get profile(){return a()},get loadingProfile(){return s()},get onsignout(){return e.onsignout}});var he=h(ie,2);h_(he,{get syncStatus(){return _()},get syncProgress(){return x()},get isSyncing(){return b()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var W=h(he,2),N=f(W);N.__keydown=$=>$.key==="Enter"&&e.onsearch();var z=h(N,2);z.__click=function(...$){var pe;(pe=e.onsearch)==null||pe.apply(this,$)};var P=f(z),ue=h(W,2);{var ke=$=>{var pe=Xy(),ae=Ze(pe),X=f(ae),oe=f(X),ge=h(ae,2);__(ge,{get messages(){return o()},get onselect(){return e.onviewmessage}});var Se=h(ge,2);{var me=R=>{var V=Qy(),ne=f(V);ne.__click=function(...ve){var be;(be=e.onloadmore)==null||be.apply(this,ve)};var K=f(ne);Y(()=>{ne.disabled=g(),C(K,g()?"Loading...":"Load More")}),S(R,V)};Q(Se,R=>{d()&&R(me)})}Y(R=>C(oe,`Showing ${o().length??""} of ${R??""}
        ${w()?" matching":""} emails`),[()=>u().toLocaleString()]),S($,pe)},xe=$=>{var pe=Zy();S($,pe)},we=$=>{var pe=eb(),ae=f(pe);{var X=ge=>{var Se=Jy(),me=f(Se);Y(()=>C(me,`No emails match "${w()??""}".`)),S(ge,Se)},oe=ge=>{var Se=$y();S(ge,Se)};Q(ae,ge=>{w()?ge(X):ge(oe,!1)})}S($,pe)},Z=$=>{var pe=tb();S($,pe)};Q(ue,$=>{var pe;o().length>0?$(ke):g()?$(xe,1):(pe=_())!=null&&pe.synced?$(we,2):$(Z,!1)})}var le=h(L,2);{var fe=$=>{Yy($,{get message(){return m()},loading:!1,get onclose(){return e.onclosedetail}})};Q(le,$=>{m()&&$(fe)})}Y(()=>{z.disabled=g(),C(P,g()?"Searching...":"Search")}),zr(N,w),S(t,I),Dt()}Jt(["keydown","click"]);var ab=T('<div class="dashboard svelte-1q5o2lv"><!></div>');function sb(t,e){jt(e,!0);function n(ce){ce.key==="Escape"&&l(b)&&me()}let a=null;kn(async()=>{if(window.addEventListener("keydown",n),!l(d)){const ce=await js("googleClientId");A(d,ce||u,!0),A(g,ce||u,!0)}return()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}});function s(){a&&clearTimeout(a);const ce=sm();if(ce<=0)return;const Te=Math.max(0,ce-120*1e3);a=setTimeout(async()=>{try{const qe=await Rc();A(_,qe.access_token,!0),s()}catch{A(_,null),A(x,null),A(W,"Session expired. Please sign in again.")}},Te)}async function o(){if(am())return l(_);try{const ce=await Rc();return A(_,ce.access_token,!0),s(),l(_)}catch{return A(_,null),A(x,null),A(W,"Session expired. Please sign in again."),null}}const u="562478245230-1gohf6dtsajqo1lu3kge9k7cthm4sdv6.apps.googleusercontent.com";let d=Oe(Vt(u)),g=Oe(Vt(u)),m=Oe(!1),_=Oe(null),x=Oe(null),b=Oe(null),w=Oe(""),I=Oe(Vt([])),L=Oe(0),O=Oe(0),se=Oe(!1),ie=Oe(!1),he=Oe(!1),W=Oe(null),N=Oe(null),z=Oe(null),P=Oe(!1);const ue=50;Oa(()=>{l(_)&&(R(),X())});let ke=it(()=>!l(d)),xe=it(()=>l(d)===u),we=it(()=>!!l(_)),Z=it(()=>l(I).length<l(L));Oa(()=>{l(d)&&!l(m)&&Mc(l(d)).then(async()=>{if(A(m,!0),!l(_)){const ce=await zi();ce&&(A(_,ce.access_token,!0),s(),ae())}}).catch(ce=>{A(W,`Auth init failed: ${ce.message}`)})});async function le(){const ce=l(g).trim();ce&&(await Ds("googleClientId",ce),A(d,ce,!0),A(W,null))}async function fe(){await hl("googleClientId"),A(d,""),A(g,u),A(m,!1),A(_,null),A(x,null),A(I,[],!0),A(L,0)}async function $(){A(W,null),A(ie,!0);try{l(m)||(await Mc(l(d)),A(m,!0));const ce=await om();A(_,ce.access_token,!0),s(),await ae()}catch(ce){A(W,ce.message,!0)}finally{A(ie,!1)}}async function pe(){if(a&&clearTimeout(a),l(_))try{await lm(l(_))}catch{}A(_,null),A(x,null),A(I,[],!0),A(L,0),A(b,null),A(W,null)}async function ae(){A(he,!0);try{const ce=await td(l(_));if(!l(_))return;A(x,ce,!0)}catch(ce){if(!l(_))return;A(W,`Profile fetch failed: ${ce.message}`)}finally{A(he,!1)}}async function X(ce=!1){A(se,!0);try{const Te=ce?l(O):0,qe=await Sp({query:l(w)||void 0,limit:ue,offset:Te});ce?A(I,[...l(I),...qe.items],!0):A(I,qe.items,!0),A(L,qe.total,!0),A(O,l(I).length,!0)}catch(Te){A(W,`Failed to load messages: ${Te.message}`)}finally{A(se,!1)}}function oe(){A(O,0),X(!1)}function ge(){X(!0)}function Se(ce){A(b,ce,!0)}function me(){A(b,null)}async function R(){try{A(N,await Og(),!0)}catch{}}async function V(ce){if(l(P)||!l(_))return;const Te=await o();if(!Te)return;A(W,null),A(P,!0),A(z,null);const qe=new AbortController;try{await Cg(Te,{limit:ce,onProgress:He=>{A(z,{...He},!0)},signal:qe.signal}),await R(),await X(!1)}catch(He){if(He.name!=="AbortError"){if(!l(_))return;A(W,`Sync failed: ${He.message}`)}}finally{A(P,!1)}}async function ne(ce){if(l(P)||!l(_))return;const Te=await o();if(!Te)return;A(W,null),A(P,!0),A(z,null);const qe=new AbortController;try{await Pg(Te,{limit:ce,onProgress:He=>{A(z,{...He},!0)},signal:qe.signal}),await R(),await X(!1)}catch(He){if(He.name!=="AbortError"){if(!l(_))return;A(W,`Sync more failed: ${He.message}`)}}finally{A(P,!1)}}async function K(){try{await Sd(),await R(),A(I,[],!0),A(L,0),A(O,0)}catch(ce){A(W,`Failed to clear data: ${ce.message}`)}}var ve=ab(),be=f(ve);{var te=ce=>{Bg(ce,{onsave:le,defaultClientId:u,get clientIdInput(){return l(g)},set clientIdInput(Te){A(g,Te,!0)}})},U=ce=>{Jg(ce,{get clientId(){return l(d)},get isDefaultClientId(){return l(xe)},get error(){return l(W)},get loadingAuth(){return l(ie)},onsignin:$,onclear:fe,onsignout:pe})},Ee=ce=>{rb(ce,{get error(){return l(W)},get profile(){return l(x)},get loadingProfile(){return l(he)},get emailMessages(){return l(I)},get totalLocalMessages(){return l(L)},get hasMoreLocal(){return l(Z)},get loadingMessages(){return l(se)},get selectedMessage(){return l(b)},get syncStatus(){return l(N)},get syncProgress(){return l(z)},get isSyncing(){return l(P)},onsignout:pe,onsearch:oe,onloadmore:ge,onviewmessage:Se,onclosedetail:me,ondismisserror:()=>A(W,null),onsync:V,onsyncmore:ne,oncleardata:K,get searchQuery(){return l(w)},set searchQuery(Te){A(w,Te,!0)}})};Q(be,ce=>{l(ke)?ce(te):l(we)?ce(Ee,!1):ce(U,1)})}S(t,ve),Dt()}var ib=T('<span class="err svelte-t1ig66"> </span>'),ob=T('<div class="totals svelte-t1ig66"> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),lb=T('<span class="stream-stats svelte-t1ig66"> </span>'),cb=T('<div class="stream-box svelte-t1ig66"><div class="stream-head svelte-t1ig66"><span class="stream-email svelte-t1ig66"> </span> <!></div> <pre class="stream-output svelte-t1ig66"> </pre></div>'),ub=T('<span class="ei-group svelte-t1ig66"> </span>'),db=T('<span class="ei-tag svelte-t1ig66"> </span> <!>',1),vb=T('<span class="ei-tag err svelte-t1ig66">ERROR</span>'),fb=T('<span class="sep svelte-t1ig66">Â·</span> ',1),pb=T('<div class="ei-summary svelte-t1ig66"> </div>'),hb=T('<div class="ei-stats svelte-t1ig66"> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div>'),mb=T('<details class="ei-llm svelte-t1ig66"><summary class="svelte-t1ig66">LLM output</summary> <pre class="ei-llm-text svelte-t1ig66"> </pre></details>'),gb=T("<!> <!> <!>",1),_b=T('<div class="ei-error svelte-t1ig66"> </div>'),yb=T('<div><div class="ei-row svelte-t1ig66"><span class="ei-num svelte-t1ig66"></span> <span class="ei-subj svelte-t1ig66"> </span> <!></div> <div class="ei-from svelte-t1ig66"> <!></div> <!></div>'),bb=T('<div class="history svelte-t1ig66"><div class="history-head svelte-t1ig66"><span class="history-title svelte-t1ig66">Processed emails</span> <span class="history-count svelte-t1ig66"> </span></div> <!></div>'),wb=T('<span class="sep svelte-t1ig66">Â·</span><span class="err svelte-t1ig66"> </span>',1),kb=T('<span class="sep svelte-t1ig66">Â·</span><span class="svelte-t1ig66"> </span>',1),xb=T(' <span class="sep svelte-t1ig66">Â·</span>',1),Sb=T('<div class="summary svelte-t1ig66"><div class="summary-stats svelte-t1ig66"><span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="good svelte-t1ig66"> </span> <!> <!></div> <div class="summary-perf svelte-t1ig66"><!> <span class="sep svelte-t1ig66">Â·</span> <span class="sep svelte-t1ig66">Â·</span> </div></div>'),Eb=T('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn primary svelte-t1ig66">Close</button>',1),Tb=T('<button class="btn svelte-t1ig66">View Prompt</button> <button class="btn stop svelte-t1ig66">Stop</button>',1),Ab=T('<div class="scan-view svelte-t1ig66"><div class="header svelte-t1ig66"><span class="title svelte-t1ig66"><!></span> <span class="pct svelte-t1ig66"> </span></div> <div class="bar svelte-t1ig66"><div></div></div> <!> <!> <!> <!> <div class="btns svelte-t1ig66"><!></div></div>');function Ib(t,e){jt(e,!0);let n=Ne(e,"progress",3,null);function a(b){return!b||b<0?"â":b<1e3?`${Math.round(b)}ms`:`${(b/1e3).toFixed(1)}s`}function s(b){return b?b>=1e3?`${(b/1e3).toFixed(1)}k`:String(b):"0"}function o(b){if(!b)return"â";const w=b.replace(/<.*>/,"").trim();return w.length>30?w.slice(0,28)+"â¦":w}function u(b){if(!b)return"";try{return new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let d=it(()=>{var b;return(b=n())!=null&&b.total?Math.round(n().current/n().total*100):0}),g=it(()=>{var b;return((b=n())==null?void 0:b.phase)==="done"});var m=On(),_=Ze(m);{var x=b=>{var w=Ab(),I=f(w),L=f(I),O=f(L);{var se=me=>{var R=vn();Y(()=>C(R,`Scan complete â ${(n().classified||0)??""} classified`)),S(me,R)},ie=me=>{var R=vn("Loading emailsâ¦");S(me,R)},he=me=>{var R=vn();Y(()=>C(R,`Processing ${n().current??0??""} / ${n().total??0??""}`)),S(me,R)};Q(O,me=>{l(g)?me(se):n().phase==="loading"?me(ie,1):me(he,!1)})}var W=h(L,2),N=f(W),z=h(I,2),P=f(z);let ue,ke;var xe=h(z,2);{var we=me=>{var R=ob(),V=f(R),ne=h(V);{var K=te=>{var U=ib(),Ee=f(U);Y(()=>C(Ee,`Â· ${n().errors??""} errors`)),S(te,U)};Q(ne,te=>{n().errors&&te(K)})}var ve=h(ne,3),be=h(ve,2);Y((te,U,Ee)=>{C(V,`${(n().classified||0)??""} classified `),C(ve,` ${te??""} in + ${U??""} out `),C(be,` ${Ee??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),S(me,R)};Q(xe,me=>{n().totals&&!l(g)&&me(we)})}var Z=h(xe,2);{var le=me=>{var R=cb(),V=f(R),ne=f(V),K=f(ne),ve=h(ne,2);{var be=Ee=>{var ce=lb(),Te=f(ce);Y(qe=>C(Te,`${qe??""} tok/s Â· ${(n().live.numTokens||0)??""} tokens`),[()=>n().live.tps.toFixed(0)]),S(Ee,ce)};Q(ve,Ee=>{var ce;(ce=n().live)!=null&&ce.tps&&Ee(be)})}var te=h(V,2),U=f(te);Y(()=>{C(K,n().email.subject||"(no subject)"),C(U,n().streamingText||"Waiting for modelâ¦")}),S(me,R)};Q(Z,me=>{!l(g)&&n().email&&(n().phase==="generating"||n().phase==="scanning")&&me(le)})}var fe=h(Z,2);{var $=me=>{var R=bb(),V=f(R),ne=h(f(V),2),K=f(ne),ve=h(V,2);xt(ve,17,()=>n().results,Ut,(be,te,U)=>{var Ee=yb();let ce;var Te=f(Ee),qe=f(Te);qe.textContent=`${U+1}.`;var He=h(qe,2),vt=f(He),_t=h(He,2);{var Xe=ze=>{var ht=db(),ct=Ze(ht),Bt=f(ct),ut=h(ct,2);{var $e=dt=>{const Pt=it(()=>ia[l(te).classification.group]);var at=On(),Me=Ze(at);{var Yt=It=>{var St=ub();let Ae;var Gt=f(St);Y(()=>{gr(St,"title",l(Pt).description),Ae=dn(St,"",Ae,{color:l(Pt).color}),C(Gt,l(Pt).label)}),S(It,St)};Q(Me,It=>{l(Pt)&&It(Yt)})}S(dt,at)};Q(ut,dt=>{l(te).classification.group&&dt($e)})}Y(()=>C(Bt,l(te).classification.action)),S(ze,ht)},Be=ze=>{var ht=vb();S(ze,ht)};Q(_t,ze=>{l(te).success?ze(Xe):ze(Be,!1)})}var Ue=h(Te,2),Ke=f(Ue),ot=h(Ke);{var lt=ze=>{var ht=fb(),ct=h(Ze(ht),1,!0);Y(Bt=>C(ct,Bt),[()=>u(l(te).email.date)]),S(ze,ht)};Q(ot,ze=>{l(te).email.date&&ze(lt)})}var Je=h(Ue,2);{var tt=ze=>{var ht=gb(),ct=Ze(ht);{var Bt=at=>{var Me=pb(),Yt=f(Me);Y(()=>C(Yt,l(te).classification.summary)),S(at,Me)};Q(ct,at=>{l(te).classification.summary&&at(Bt)})}var ut=h(ct,2);{var $e=at=>{var Me=hb(),Yt=f(Me),It=h(Yt,2),St=h(It,2);Y((Ae,Gt)=>{C(Yt,`${Ae??""} `),C(It,` ${(l(te).stats.inputTokens||0)??""} in + ${(l(te).stats.numTokens||0)??""} out `),C(St,` ${Gt??""}`)},[()=>l(te).stats.tps?`${l(te).stats.tps.toFixed(0)} tok/s`:"â",()=>a(l(te).stats.elapsed)]),S(at,Me)};Q(ut,at=>{l(te).stats&&at($e)})}var dt=h(ut,2);{var Pt=at=>{var Me=mb(),Yt=h(f(Me),2),It=f(Yt);Y(()=>C(It,l(te).rawResponse)),S(at,Me)};Q(dt,at=>{l(te).rawResponse&&at(Pt)})}S(ze,ht)},Ve=ze=>{var ht=_b(),ct=f(ht);Y(()=>C(ct,l(te).error)),S(ze,ht)};Q(Je,ze=>{l(te).success?ze(tt):ze(Ve,!1)})}Y(ze=>{ce=Nt(Ee,1,"email-item svelte-t1ig66",null,ce,{failed:!l(te).success}),C(vt,l(te).email.subject||"(no subject)"),C(Ke,ze)},[()=>o(l(te).email.from)]),S(be,Ee)}),Y(()=>C(K,n().results.length)),S(me,R)};Q(fe,me=>{var R;((R=n().results)==null?void 0:R.length)>0&&me($)})}var pe=h(fe,2);{var ae=me=>{var R=Sb(),V=f(R),ne=f(V),K=f(ne),ve=h(ne,4),be=f(ve),te=h(ve,2);{var U=Be=>{var Ue=wb(),Ke=h(Ze(Ue)),ot=f(Ke);Y(()=>C(ot,`${n().errors??""} errors`)),S(Be,Ue)};Q(te,Be=>{n().errors>0&&Be(U)})}var Ee=h(te,2);{var ce=Be=>{var Ue=kb(),Ke=h(Ze(Ue)),ot=f(Ke);Y(()=>C(ot,`${n().summary.skipped??""} skipped`)),S(Be,Ue)};Q(Ee,Be=>{var Ue;(Ue=n().summary)!=null&&Ue.skipped&&Be(ce)})}var Te=h(V,2),qe=f(Te);{var He=Be=>{var Ue=xb(),Ke=Ze(Ue);Y(()=>C(Ke,`Avg ${n().summary.avgTps??""} tok/s`)),S(Be,Ue)};Q(qe,Be=>{var Ue;(Ue=n().summary)!=null&&Ue.avgTps&&Be(He)})}var vt=h(qe),_t=h(vt,2),Xe=h(_t,2);Y((Be,Ue,Ke)=>{var ot,lt;C(K,`${(((ot=n().summary)==null?void 0:ot.processed)||n().total||0)??""} processed`),C(be,`${(n().classified||0)??""} classified`),C(vt,` ${Be??""} in + ${Ue??""} out `),C(_t,` ${Ke??""} `),C(Xe,` Model: ${(((lt=n().summary)==null?void 0:lt.modelName)||"Unknown")??""}`)},[()=>s(n().totals.inputTokens),()=>s(n().totals.outputTokens),()=>a(n().totals.elapsed)]),S(me,R)};Q(pe,me=>{l(g)&&n().totals&&me(ae)})}var X=h(pe,2),oe=f(X);{var ge=me=>{var R=Eb(),V=Ze(R);V.__click=function(...K){var ve;(ve=e.oninspect)==null||ve.apply(this,K)};var ne=h(V,2);ne.__click=function(...K){var ve;(ve=e.onclose)==null||ve.apply(this,K)},S(me,R)},Se=me=>{var R=Tb(),V=Ze(R);V.__click=function(...K){var ve;(ve=e.oninspect)==null||ve.apply(this,K)};var ne=h(V,2);ne.__click=function(...K){var ve;(ve=e.onstop)==null||ve.apply(this,K)},S(me,R)};Q(oe,me=>{l(g)?me(ge):me(Se,!1)})}Y(()=>{C(N,`${l(d)??""}%`),ue=Nt(P,1,"bar-fill svelte-t1ig66",null,ue,{done:l(g)}),ke=dn(P,"",ke,{width:`${l(d)??""}%`})}),S(b,w)};Q(_,b=>{n()&&b(x)})}S(t,m),Dt()}Jt(["click"]);var Cb=T('<span class="spinner svelte-ois7em"></span>'),Pb=fl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),Ob=T('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),Rb=T("<option> </option>"),Mb=T('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),jb=T('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function Db(t,e){jt(e,!0);let n=Ne(e,"engineStatus",3,"idle"),a=Ne(e,"modelName",3,""),s=Ne(e,"isScanning",3,!1),o=Ne(e,"scanProgress",3,null),u=Ne(e,"scanCount",15,20),d=Ne(e,"stats",3,null);const g=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function m(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function _(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function x(){return n()==="ready"&&!s()}let b=it(()=>{var R;return s()&&((R=o())==null?void 0:R.phase)!=="done"});var w=jb(),I=f(w),L=f(I),O=f(L);{var se=R=>{var V=Cb();S(R,V)},ie=R=>{var V=Pb();S(R,V)};Q(O,R=>{l(b)?R(se):R(ie,!1)})}var he=h(L,2),W=f(he),N=h(f(W),2);N.__click=function(...R){var V;(V=e.oninspect)==null||V.apply(this,R)};var z=h(W,2),P=f(z);let ue;var ke=h(P),xe=h(I,2);{var we=R=>{var V=Ob(),ne=f(V),K=f(ne),ve=h(ne,4),be=f(ve),te=h(ve,4),U=f(te);Y(()=>{C(K,`${d().totalEmails??""} emails in storage`),C(be,`${d().classified??""} classified`),C(U,`${d().unclassified??""} new`)}),S(R,V)};Q(xe,R=>{d()&&R(we)})}var Z=h(xe,2),le=f(Z),fe=h(f(le),2);xt(fe,21,()=>g,Ut,(R,V)=>{var ne=Rb(),K=f(ne),ve={};Y(()=>{C(K,l(V).label),ve!==(ve=l(V).value)&&(ne.value=(ne.__value=l(V).value)??"")}),S(R,ne)});var $=h(le,2),pe=f($);pe.__click=function(...R){var V;(V=e.onscan)==null||V.apply(this,R)};var ae=f(pe),X=h(pe,2);X.__click=function(...R){var V;(V=e.onrescan)==null||V.apply(this,R)};var oe=h(Z,2);{var ge=R=>{var V=Mb();S(R,V)};Q(oe,R=>{n()!=="ready"&&n()!=="loading"&&R(ge)})}var Se=h(oe,2);{var me=R=>{Ib(R,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};Q(Se,R=>{var V;(s()||((V=o())==null?void 0:V.phase)==="done")&&R(me)})}Y((R,V,ne,K)=>{ue=dn(P,"",ue,R),C(ke,` ${V??""}`),fe.disabled=s(),pe.disabled=ne,C(ae,l(b)?"Scanning...":s()?"Finalizing...":"Scan New"),X.disabled=K},[()=>({background:_()}),m,()=>!x(),()=>!x()]),Di(fe,u),S(t,w),Dt()}Jt(["click"]);var Lb=T('<span class="row-date svelte-1czytqk"> </span>'),Nb=T('<span class="tag svelte-1czytqk"> </span>'),qb=T('<span class="row-tags svelte-1czytqk"></span>'),Bb=T('<span class="row-reason svelte-1czytqk"> </span>'),Fb=T('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),zb=T('<span class="status-label svelte-1czytqk"> </span>'),Ub=T('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),Kb=T('<p class="summary-reason svelte-1czytqk"> </p>'),Gb=T('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),Hb=T('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function Jc(t,e){jt(e,!0);let n=Ne(e,"actionColor",3,"#666"),a=Ne(e,"dimmed",3,!1);function s($){if(!$)return"";try{return new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=it(()=>e.item.status==="pending"),u=Oe(!1);var d=Hb(),g=Ze(d);let m;var _=f(g);_.__click=()=>A(u,!l(u));let x;var b=f(_),w=f(b),I=h(b,2),L=f(I),O=f(L),se=h(L,2);{var ie=$=>{var pe=Lb(),ae=f(pe);Y(X=>C(ae,X),[()=>s(e.item.date)]),S($,pe)};Q(se,$=>{e.item.date&&$(ie)})}var he=h(I,2);{var W=$=>{var pe=qb();xt(pe,21,()=>e.item.tags,Ut,(ae,X)=>{var oe=Nb();let ge;var Se=f(oe);Y(me=>{ge=dn(oe,"",ge,me),C(Se,l(X))},[()=>({background:th(l(X))})]),S(ae,oe)}),S($,pe)};Q(he,$=>{e.item.tags&&e.item.tags.length>0&&$(W)})}var N=h(he,2);{var z=$=>{var pe=Bb(),ae=f(pe);Y(()=>C(ae,e.item.reason)),S($,pe)};Q(N,$=>{e.item.reason&&!l(u)&&$(z)})}var P=h(_,2),ue=f(P);{var ke=$=>{var pe=Fb(),ae=Ze(pe);ae.__click=()=>e.onmarkacted(e.item.emailId);var X=h(ae,2);X.__click=()=>e.ondismiss(e.item.emailId),S($,pe)},xe=$=>{var pe=zb(),ae=f(pe);Y(()=>C(ae,e.item.status)),S($,pe)};Q(ue,$=>{l(o)?$(ke):$(xe,!1)})}var we=h(ue,2);{var Z=$=>{var pe=Ub();pe.__click=()=>e.onremove(e.item.emailId),S($,pe)};Q(we,$=>{e.onremove&&$(Z)})}var le=h(g,2);{var fe=$=>{var pe=Gb();let ae;var X=f(pe),oe=f(X),ge=h(X,2);{var Se=me=>{var R=Kb(),V=f(R);Y(()=>C(V,e.item.reason)),S(me,R)};Q(ge,me=>{e.item.reason&&me(Se)})}Y(()=>{ae=dn(pe,"",ae,{"border-left-color":n()}),C(oe,e.item.summary)}),S($,pe)};Q(le,$=>{l(u)&&e.item.summary&&$(fe)})}Y(()=>{m=Nt(g,1,"email-row svelte-1czytqk",null,m,{dimmed:a()}),x=dn(_,"",x,{"border-left-color":n()}),C(w,e.item.subject),C(O,e.item.from)}),S(t,d),Dt()}Jt(["click"]);var Wb=T('<span class="group-acted svelte-tl1unp"> </span>'),Vb=T('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),Yb=T('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),Qb=T('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),Xb=T('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),Zb=T('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),Jb=T('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function $b(t,e){jt(e,!0);let n=Ne(e,"color",3,"#888");Ne(e,"count",3,0);let a=Ne(e,"items",19,()=>[]),s=Ne(e,"expanded",3,!1),o=it(()=>a().filter(z=>z.status==="pending")),u=it(()=>a().filter(z=>z.status!=="pending")),d=Oe(!1);function g(z){return z.split("_").map(P=>P.charAt(0)+P.slice(1).toLowerCase()).join(" ")}var m=Jb(),_=f(m);_.__click=function(...z){var P;(P=e.ontoggle)==null||P.apply(this,z)};var x=f(_);let b;var w=f(x),I=h(x,2),L=f(I),O=h(I,2);{var se=z=>{var P=Wb(),ue=f(P);Y(()=>C(ue,`${l(u).length??""} handled`)),S(z,P)};Q(O,z=>{l(u).length>0&&z(se)})}var ie=h(O,4);let he;var W=h(_,2);{var N=z=>{var P=Zb(),ue=f(P);{var ke=ae=>{var X=Vb();S(ae,X)};Q(ue,ae=>{l(o).length===0&&l(u).length===0&&ae(ke)})}var xe=h(ue,2);xt(xe,17,()=>l(o),ae=>ae.emailId,(ae,X)=>{Jc(ae,{get item(){return l(X)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var we=h(xe,2);{var Z=ae=>{var X=Yb(),oe=f(X),ge=f(oe),Se=h(oe,2);xt(Se,17,()=>l(u),me=>me.emailId,(me,R)=>{Jc(me,{get item(){return l(R)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),Y(()=>C(ge,`${l(u).length??""} handled`)),S(ae,X)};Q(we,ae=>{l(u).length>0&&ae(Z)})}var le=h(we,2),fe=f(le);{var $=ae=>{var X=Qb();X.__click=()=>A(d,!0),S(ae,X)},pe=ae=>{var X=Xb(),oe=f(X),ge=h(oe);ge.__click=()=>A(d,!1);var Se=h(ge,2);Se.__click=()=>{e.oncleargroup(),A(d,!1)},Y(()=>C(oe,`Clear ${a().length??""} items? `)),S(ae,X)};Q(fe,ae=>{l(d)?ae(pe,!1):ae($)})}S(z,P)};Q(W,z=>{s()&&z(N)})}Y(z=>{b=dn(x,"",b,{background:n()}),C(w,z),C(L,l(o).length),he=Nt(ie,0,"chevron svelte-tl1unp",null,he,{open:s()})},[()=>g(e.action)]),S(t,m),Dt()}Jt(["click"]);var e1=T(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),t1=T(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),n1=T(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),r1=T('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function a1(t,e){jt(e,!0);let n=Ne(e,"open",15,!1),a=Ne(e,"sampleEmail",3,null),s=Oe("system");function o(){return a()?bd(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function u(){n(!1)}function d(x){x.target===x.currentTarget&&u()}var g=On(),m=Ze(g);{var _=x=>{var b=r1();b.__click=d,b.__keydown=Z=>Z.key==="Escape"&&u();var w=f(b),I=f(w),L=h(f(I),2);L.__click=u;var O=h(I,2),se=f(O);let ie;se.__click=()=>A(s,"system");var he=h(se,2);let W;he.__click=()=>A(s,"email");var N=h(he,2);let z;N.__click=()=>A(s,"config");var P=h(O,2),ue=f(P);{var ke=Z=>{var le=e1(),fe=h(Ze(le),2),$=f(fe);Y(()=>C($,md)),S(Z,le)},xe=Z=>{var le=t1(),fe=h(Ze(le),2),$=h(f(fe),2);$.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var pe=h(fe,2),ae=h(f(pe),2),X=f(ae);Y(oe=>C(X,oe),[o]),S(Z,le)},we=Z=>{var le=n1(),fe=h(Ze(le),2),$=f(fe),pe=h(f($),2),ae=f(pe),X=h($,2),oe=h(f(X),2),ge=f(oe),Se=h(X,2),me=h(f(Se),2),R=f(me),V=h(fe,4);V.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,Y(()=>{C(ae,Zp.maxTokens),C(ge,"false"),C(R,"false")}),S(Z,le)};Q(ue,Z=>{l(s)==="system"?Z(ke):l(s)==="email"?Z(xe,1):l(s)==="config"&&Z(we,2)})}Y(()=>{ie=Nt(se,1,"tab svelte-10pcy9j",null,ie,{active:l(s)==="system"}),W=Nt(he,1,"tab svelte-10pcy9j",null,W,{active:l(s)==="email"}),z=Nt(N,1,"tab svelte-10pcy9j",null,z,{active:l(s)==="config"})}),S(x,b)};Q(m,x=>{n()&&x(_)})}S(t,g),Dt()}Jt(["click","keydown"]);var s1=T('<div class="new-type-form svelte-d25j4l"><input type="text" placeholder="e.g. ESCALATE" class="svelte-d25j4l"/> <button class="small-btn svelte-d25j4l">Add</button></div>'),i1=T('<span class="type-group-chip svelte-d25j4l"> </span>'),o1=T('<button><span class="type-dot svelte-d25j4l"></span> <span class="type-label svelte-d25j4l"> </span> <span class="spacer-flex svelte-d25j4l"></span> <!> <span class="type-count svelte-d25j4l"> </span></button>'),l1=T("<button> </button>"),c1=T('<span class="picker-tile-added svelte-d25j4l">â added</span>'),u1=T('<button><span class="picker-tile-icon svelte-d25j4l"> </span> <span class="picker-tile-name svelte-d25j4l"> </span> <!></button>'),d1=T('<div class="picker-group"><div class="picker-group-label svelte-d25j4l"><span class="picker-plugin-badge svelte-d25j4l"> </span> <span class="picker-hint svelte-d25j4l">Click to add to pipeline</span></div> <div class="picker-grid svelte-d25j4l"></div></div>'),v1=T('<div class="action-picker svelte-d25j4l"></div>'),f1=T('<div class="cmd-row editing svelte-d25j4l"><div class="form-row svelte-d25j4l"><input type="text" class="icon-input svelte-d25j4l" placeholder="Icon"/> <input type="text" class="name-input svelte-d25j4l" placeholder="Name"/></div> <input type="text" class="desc-input svelte-d25j4l" placeholder="Description"/> <div class="form-actions svelte-d25j4l"><button class="small-btn primary svelte-d25j4l">Save</button> <button class="small-btn svelte-d25j4l">Cancel</button></div></div>'),p1=T('<span class="cmd-icon svelte-d25j4l"> </span>'),h1=T('<span class="cmd-binding svelte-d25j4l"> <span class="cmd-binding-sep svelte-d25j4l">Â·</span> </span>'),m1=T('<span class="cmd-binding unbound svelte-d25j4l" title="No plugin bound â will attempt to resolve from event source">unbound</span>'),g1=T('<div class="cmd-row svelte-d25j4l"><div class="step-marker svelte-d25j4l"> </div> <div class="cmd-main svelte-d25j4l"><!> <div class="cmd-info svelte-d25j4l"><div class="cmd-name-row svelte-d25j4l"><span class="cmd-name svelte-d25j4l"> </span> <!></div> <span class="cmd-desc svelte-d25j4l"> </span></div></div> <div class="cmd-actions svelte-d25j4l"><button class="icon-btn small svelte-d25j4l" title="Move up">&#9650;</button> <button class="icon-btn small svelte-d25j4l" title="Move down">&#9660;</button> <button class="icon-btn small svelte-d25j4l" title="Edit">&#9998;</button> <button class="icon-btn small danger svelte-d25j4l" title="Remove">&#10005;</button></div></div>'),_1=T('<div class="empty-cmds svelte-d25j4l">No actions yet. Add one above.</div>'),y1=T('<div class="commands-head svelte-d25j4l"><span class="type-badge svelte-d25j4l"> </span> <span class="cmd-count svelte-d25j4l"> </span> <span class="pipeline-note svelte-d25j4l">â¢ Sequential pipeline</span> <span class="spacer svelte-d25j4l"></span> <div class="group-selector svelte-d25j4l"></div> <button class="text-btn danger svelte-d25j4l">Delete</button> <button class="small-btn svelte-d25j4l"> </button></div> <!> <div class="commands-list svelte-d25j4l"><!> <!></div>',1),b1=T('<p class="svelte-d25j4l">No event types yet. Run a scan to discover event types, or click <strong>+</strong> to create one manually.</p>'),w1=T('<p class="svelte-d25j4l">Select an event type on the left to view and edit its action pipeline.</p>'),k1=T('<div class="no-selection svelte-d25j4l"><!></div>'),x1=T('<div class="editor-overlay svelte-d25j4l" role="dialog"><div class="editor-panel svelte-d25j4l"><div class="editor-header svelte-d25j4l"><h2 class="svelte-d25j4l">Action Pipeline Editor</h2> <span class="subtitle svelte-d25j4l">Configure sequential action pipelines for each event type</span> <button class="close-btn svelte-d25j4l">&#10005;</button></div> <div class="editor-body svelte-d25j4l"><div class="types-sidebar svelte-d25j4l"><div class="sidebar-head svelte-d25j4l"><span class="sidebar-title svelte-d25j4l">Event Types</span> <button class="icon-btn svelte-d25j4l" title="Add event type">+</button></div> <!> <div class="types-list svelte-d25j4l"></div></div> <div class="commands-panel svelte-d25j4l"><!></div></div></div></div>');function S1(t,e){jt(e,!0);let n=Ne(e,"open",15,!1),a=Oe(Vt([])),s=Oe(Vt({})),o=Oe(Vt({})),u=Oe(null),d=Oe(!1),g=Oe("INFO"),m=Oe(Vt([])),_=Oe(null),x=Oe(!1),b=Oe(""),w=Oe(!1);const I=[{pluginId:"gmail",pluginName:"Gmail",actions:dm("gmail")}],L={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"};async function O(){A(a,await Ip(),!0);const ae={};await Promise.all(l(a).map(async X=>{ae[X]=(await So(X)).length})),A(s,ae,!0),A(o,await Pp(),!0),l(u)&&(A(m,(await So(l(u))).map(X=>({...X})),!0),A(d,await hasUserOverride(l(u)),!0),A(g,await Si(l(u)),!0))}Oa(()=>{n()&&O()});async function se(ae){A(u,ae,!0),A(m,(await So(ae)).map(X=>({...X})),!0),A(d,await hasUserOverride(ae),!0),A(g,await Si(ae),!0),A(_,null),A(w,!1)}async function ie(ae){l(u)&&(await Cp(l(u),ae),A(g,ae,!0))}function he(ae){return ae.split("_").map(X=>X.charAt(0)+X.slice(1).toLowerCase()).join(" ")}function W(ae){return`hsl(${Li(ae)}, 55%, 55%)`}async function N(){const ae=l(b).trim();if(!ae)return;await Op(ae),A(b,""),A(x,!1),await O();const X=ae.toUpperCase().replace(/\s+/g,"_").replace(/[^A-Z0-9_]/g,"");await se(X)}async function z(){l(u)&&(await Mp(l(u)),A(u,null),A(m,[],!0),A(d,!1),await O())}async function P(ae,X){await Lp(l(u),{id:ae.actionId,pluginId:X,commandId:ae.actionId,name:ae.name,description:ae.description,icon:L[ae.actionId]||void 0}),await O()}function ue(ae){return l(m).some(X=>X.id===ae)}async function ke(ae){await qp(l(u),ae),await O()}function xe(ae){A(_,{...ae},!0)}async function we(){l(_)&&(await Fp(l(u),l(_).id,{name:l(_).name,description:l(_).description,icon:l(_).icon}),A(_,null),await O())}function Z(){A(_,null)}async function le(ae,X){const oe=[...l(m)],ge=ae+X;ge<0||ge>=oe.length||([oe[ae],oe[ge]]=[oe[ge],oe[ae]],await jp(l(u),oe),await O())}var fe=On(),$=Ze(fe);{var pe=ae=>{var X=x1(),oe=f(X),ge=f(oe),Se=h(f(ge),4);Se.__click=()=>n(!1);var me=h(ge,2),R=f(me),V=f(R),ne=h(f(V),2);ne.__click=()=>A(x,!l(x));var K=h(V,2);{var ve=Te=>{var qe=s1(),He=f(qe);He.__keydown=_t=>_t.key==="Enter"&&N();var vt=h(He,2);vt.__click=N,zr(He,()=>l(b),_t=>A(b,_t)),S(Te,qe)};Q(K,Te=>{l(x)&&Te(ve)})}var be=h(K,2);xt(be,21,()=>l(a),Ut,(Te,qe)=>{var He=o1();let vt;He.__click=()=>se(l(qe));var _t=f(He);let Xe;var Be=h(_t,2),Ue=f(Be),Ke=h(Be,4);{var ot=tt=>{const Ve=it(()=>ia[l(o)[l(qe)]]);var ze=On(),ht=Ze(ze);{var ct=Bt=>{var ut=i1();let $e;var dt=f(ut);Y(()=>{gr(ut,"title",l(Ve).description),$e=dn(ut,"",$e,{color:l(Ve).color}),C(dt,l(Ve).label)}),S(Bt,ut)};Q(ht,Bt=>{l(Ve)&&Bt(ct)})}S(tt,ze)};Q(Ke,tt=>{l(o)[l(qe)]&&tt(ot)})}var lt=h(Ke,2),Je=f(lt);Y((tt,Ve)=>{vt=Nt(He,1,"type-item svelte-d25j4l",null,vt,{selected:l(u)===l(qe)}),Xe=dn(_t,"",Xe,tt),C(Ue,Ve),C(Je,l(s)[l(qe)]??0)},[()=>({background:W(l(qe))}),()=>he(l(qe))]),S(Te,He)});var te=h(R,2),U=f(te);{var Ee=Te=>{var qe=y1(),He=Ze(qe),vt=f(He);let _t;var Xe=f(vt),Be=h(vt,2),Ue=f(Be),Ke=h(Be,6);xt(Ke,21,()=>Object.values(ia),Ut,(ut,$e)=>{var dt=l1();let Pt;dt.__click=()=>ie(l($e).id);let at;var Me=f(dt);Y(()=>{Pt=Nt(dt,1,"group-chip svelte-d25j4l",null,Pt,{active:l(g)===l($e).id}),gr(dt,"title",l($e).description),at=dn(dt,"",at,{"--grp-color":l($e).color}),C(Me,l($e).label)}),S(ut,dt)});var ot=h(Ke,2);ot.__click=z;var lt=h(ot,2);lt.__click=()=>{A(w,!l(w)),A(_,null)};var Je=f(lt),tt=h(He,2);{var Ve=ut=>{var $e=v1();xt($e,21,()=>I,Ut,(dt,Pt)=>{var at=d1(),Me=f(at),Yt=f(Me),It=f(Yt),St=h(Me,2);xt(St,21,()=>l(Pt).actions,Ut,(Ae,Gt)=>{const Tn=it(()=>ue(l(Gt).actionId));var en=u1();let jn;en.__click=()=>P(l(Gt),l(Pt).pluginId);var An=f(en),Ft=f(An),rn=h(An,2),Dn=f(rn),st=h(rn,2);{var nt=Lt=>{var rt=c1();S(Lt,rt)};Q(st,Lt=>{l(Tn)&&Lt(nt)})}Y(()=>{jn=Nt(en,1,"picker-tile svelte-d25j4l",null,jn,{added:l(Tn)}),gr(en,"title",l(Gt).description),C(Ft,L[l(Gt).actionId]??"Â·"),C(Dn,l(Gt).name)}),S(Ae,en)}),Y(()=>C(It,l(Pt).pluginName)),S(dt,at)}),S(ut,$e)};Q(tt,ut=>{l(w)&&ut(Ve)})}var ze=h(tt,2),ht=f(ze);xt(ht,19,()=>l(m),ut=>ut.id,(ut,$e,dt)=>{var Pt=On(),at=Ze(Pt);{var Me=It=>{var St=f1(),Ae=f(St),Gt=f(Ae),Tn=h(Gt,2),en=h(Ae,2),jn=h(en,2),An=f(jn);An.__click=we;var Ft=h(An,2);Ft.__click=Z,zr(Gt,()=>l(_).icon,rn=>l(_).icon=rn),zr(Tn,()=>l(_).name,rn=>l(_).name=rn),zr(en,()=>l(_).description,rn=>l(_).description=rn),S(It,St)},Yt=It=>{var St=g1(),Ae=f(St),Gt=f(Ae),Tn=h(Ae,2),en=f(Tn);{var jn=Wt=>{var zt=p1(),fn=f(zt);Y(()=>C(fn,l($e).icon)),S(Wt,zt)};Q(en,Wt=>{l($e).icon&&Wt(jn)})}var An=h(en,2),Ft=f(An),rn=f(Ft),Dn=f(rn),st=h(rn,2);{var nt=Wt=>{var zt=h1(),fn=f(zt),lr=h(fn,2,!0);Y(()=>{gr(zt,"title",`Calls ${l($e).pluginId??""} plugin â ${l($e).commandId??""}`),C(fn,l($e).pluginId),C(lr,l($e).commandId)}),S(Wt,zt)},Lt=Wt=>{var zt=m1();S(Wt,zt)};Q(st,Wt=>{l($e).pluginId&&l($e).commandId?Wt(nt):Wt(Lt,!1)})}var rt=h(Ft,2),Ct=f(rt),sn=h(Tn,2),on=f(sn);on.__click=()=>le(l(dt),-1);var In=h(on,2);In.__click=()=>le(l(dt),1);var Ht=h(In,2);Ht.__click=()=>xe(l($e));var $t=h(Ht,2);$t.__click=()=>ke(l($e).id),Y(()=>{C(Gt,l(dt)+1),C(Dn,l($e).name),C(Ct,l($e).description),on.disabled=l(dt)===0,In.disabled=l(dt)===l(m).length-1}),S(It,St)};Q(at,It=>{var St;((St=l(_))==null?void 0:St.id)===l($e).id?It(Me):It(Yt,!1)})}S(ut,Pt)});var ct=h(ht,2);{var Bt=ut=>{var $e=_1();S(ut,$e)};Q(ct,ut=>{l(m).length===0&&ut(Bt)})}Y((ut,$e)=>{_t=dn(vt,"",_t,ut),C(Xe,$e),C(Ue,`${l(m).length??""} action${l(m).length===1?"":"s"}`),C(Je,l(w)?"Cancel":"+ Add Action")},[()=>({background:W(l(u))}),()=>he(l(u))]),S(Te,qe)},ce=Te=>{var qe=k1(),He=f(qe);{var vt=Xe=>{var Be=b1();S(Xe,Be)},_t=Xe=>{var Be=w1();S(Xe,Be)};Q(He,Xe=>{l(a).length===0?Xe(vt):Xe(_t,!1)})}S(Te,qe)};Q(U,Te=>{l(u)?Te(Ee):Te(ce,!1)})}S(ae,X)};Q($,ae=>{n()&&ae(pe)})}S(t,fe),Dt()}Jt(["click","keydown"]);var E1=T('<span class="scope-chip svelte-1e15788"> </span>'),T1=T('<div class="scopes-list svelte-1e15788"></div>'),A1=T('<div class="scopes-row svelte-1e15788"><button class="scopes-toggle svelte-1e15788"><!> </button> <!></div>'),I1=T('<div class="action-row svelte-1e15788"><div class="action-icon svelte-1e15788"> </div> <div class="action-body svelte-1e15788"><div class="action-top svelte-1e15788"><span class="action-name svelte-1e15788"> </span> <code class="action-id svelte-1e15788"> </code></div> <span class="action-desc svelte-1e15788"> </span> <!></div></div>'),C1=T('<div class="plugin-section svelte-1e15788"><div class="plugin-header svelte-1e15788"><div class="plugin-title-row svelte-1e15788"><span class="plugin-name svelte-1e15788"> </span> <code class="plugin-id svelte-1e15788"> </code> <span class="plugin-status svelte-1e15788">â active</span></div> <span class="plugin-action-count svelte-1e15788"> </span></div> <div class="actions-table svelte-1e15788"></div></div>'),P1=T('<div class="empty svelte-1e15788">No plugins registered.</div>'),O1=T('<div class="overlay svelte-1e15788" role="dialog" aria-label="Plugin Registry" tabindex="-1"><div class="panel svelte-1e15788"><div class="panel-header svelte-1e15788"><div class="header-left svelte-1e15788"><span class="header-icon svelte-1e15788">â</span> <div><h2 class="svelte-1e15788">Plugin Registry</h2> <span class="subtitle svelte-1e15788"> </span></div></div> <button class="close-btn svelte-1e15788">â</button></div> <div class="panel-body svelte-1e15788"><!> <!></div> <div class="panel-footer svelte-1e15788"><span class="footer-note svelte-1e15788">Add plugins by extending <code class="svelte-1e15788">BasePlugin</code> and calling <code class="svelte-1e15788">pluginRegistry.registerPlugin()</code></span> <button class="close-footer-btn svelte-1e15788">Close</button></div></div></div>');function R1(t,e){jt(e,!0);let n=Ne(e,"open",15,!1);const a=it(()=>n()?is.getAllPlugins().map(b=>({id:b.pluginId,name:b.serviceName,actions:b.getHandlers().map(w=>({id:w.actionId,name:w.name,description:w.description,scopes:w.requiredScopes||[]}))})):[]),s={mark_read:"â",mark_unread:"â",star:"â",unstar:"â",trash:"ð",delete:"â",mark_spam:"â ",archive:"â",apply_label:"ð·",remove_label:"ð·",mark_important:"!",mark_not_important:"â"},o=it(()=>l(a).reduce((b,w)=>b+w.actions.length,0));let u=Oe(Vt(new Set));function d(b){const w=new Set(l(u));w.has(b)?w.delete(b):w.add(b),A(u,w,!0)}function g(b){return b.replace(/^https?:\/\/[^/]+\/auth\//,"")}var m=On(),_=Ze(m);{var x=b=>{var w=O1();w.__keydown=we=>we.key==="Escape"&&n(!1);var I=f(w),L=f(I),O=f(L),se=h(f(O),2),ie=h(f(se),2),he=f(ie),W=h(O,2);W.__click=()=>n(!1);var N=h(L,2),z=f(N);xt(z,17,()=>l(a),Ut,(we,Z)=>{var le=C1(),fe=f(le),$=f(fe),pe=f($),ae=f(pe),X=h(pe,2),oe=f(X),ge=h($,2),Se=f(ge),me=h(fe,2);xt(me,21,()=>l(Z).actions,Ut,(R,V)=>{const ne=it(()=>`${l(Z).id}:${l(V).id}`),K=it(()=>l(u).has(l(ne)));var ve=I1(),be=f(ve),te=f(be),U=h(be,2),Ee=f(U),ce=f(Ee),Te=f(ce),qe=h(ce,2),He=f(qe),vt=h(Ee,2),_t=f(vt),Xe=h(vt,2);{var Be=Ue=>{var Ke=A1(),ot=f(Ke);ot.__click=()=>d(l(ne));var lt=f(ot);{var Je=ct=>{var Bt=vn("â¾");S(ct,Bt)},tt=ct=>{var Bt=vn("â¸");S(ct,Bt)};Q(lt,ct=>{l(K)?ct(Je):ct(tt,!1)})}var Ve=h(lt),ze=h(ot,2);{var ht=ct=>{var Bt=T1();xt(Bt,21,()=>l(V).scopes,Ut,(ut,$e)=>{var dt=E1(),Pt=f(dt);Y(at=>{gr(dt,"title",l($e)),C(Pt,at)},[()=>g(l($e))]),S(ut,dt)}),S(ct,Bt)};Q(ze,ct=>{l(K)&&ct(ht)})}Y(()=>C(Ve,` ${l(V).scopes.length??""} scope${l(V).scopes.length===1?"":"s"}`)),S(Ue,Ke)};Q(Xe,Ue=>{l(V).scopes.length&&Ue(Be)})}Y(()=>{gr(be,"title",l(V).id),C(te,s[l(V).id]??"Â·"),C(Te,l(V).name),C(He,l(V).id),C(_t,l(V).description)}),S(R,ve)}),Y(()=>{C(ae,l(Z).name),C(oe,l(Z).id),C(Se,`${l(Z).actions.length??""} action${l(Z).actions.length===1?"":"s"}`)}),S(we,le)});var P=h(z,2);{var ue=we=>{var Z=P1();S(we,Z)};Q(P,we=>{l(a).length===0&&we(ue)})}var ke=h(N,2),xe=h(f(ke),2);xe.__click=()=>n(!1),Y(()=>C(he,`${l(a).length??""} plugin${l(a).length===1?"":"s"} Â· ${l(o)??""} actions available`)),S(b,w)};Q(_,b=>{n()&&b(x)})}S(t,m),Dt()}Jt(["keydown","click"]);var M1=T('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),j1=T('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),D1=T('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),L1=T('<button class="chip svelte-s2dwjj"> </button>'),N1=T('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),q1=T('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),B1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),F1=T('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),z1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),U1=T('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),K1=T('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),G1=T('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),H1=T('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),W1=T('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),V1=T('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),Y1=T('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function Q1(t,e){jt(e,!0);let n=Ne(e,"groupOrder",19,()=>[]),a=Oe(!1),s=Oe(null),o=Oe(!1),u=Oe(null);async function d(){var we;const[P,ue,ke]=await Promise.all([Qe.items.where("sourceType").equals("gmail").count(),Qe.emailClassifications.count(),Qe.contacts.count()]);let xe=0;try{const Z=await((we=navigator.storage)==null?void 0:we.estimate());xe=(Z==null?void 0:Z.usage)??0}catch{}A(u,{emailCount:P,classCount:ue,contactCount:ke,totalBytes:xe},!0)}function g(P){return P?P<1024?`${P} B`:P<1024*1024?`${(P/1024).toFixed(1)} KB`:`${(P/(1024*1024)).toFixed(1)} MB`:"â"}function m(){A(a,!l(a)),l(a)&&d()}async function _(P){var ue;A(o,!0),A(s,null);try{await P(),await d(),(ue=e.onrefresh)==null||ue.call(e)}finally{A(o,!1)}}async function x(){await _(()=>Ic())}async function b(P){await _(()=>wl(P))}async function w(){await _(async()=>{await Sd(),await Ic()})}async function I(){await _(()=>Qe.contacts.clear())}async function L(){await _(async()=>{await Qe.delete(),window.location.reload()})}function O(P){return P.split("_").map(ue=>ue.charAt(0)+ue.slice(1).toLowerCase()).join(" ")}var se=Y1(),ie=f(se);ie.__click=m;var he=h(f(ie),2);let W;var N=h(ie,2);{var z=P=>{var ue=V1(),ke=f(ue);{var xe=U=>{var Ee=j1(),ce=f(Ee),Te=f(ce),qe=h(ce,4),He=f(qe),vt=h(qe,4),_t=f(vt),Xe=h(vt,2);{var Be=Ue=>{var Ke=M1(),ot=h(Ze(Ke),2),lt=f(ot);Y(Je=>C(lt,`${Je??""} used`),[()=>g(l(u).totalBytes)]),S(Ue,Ke)};Q(Xe,Ue=>{l(u).totalBytes&&Ue(Be)})}Y(()=>{C(Te,`${l(u).emailCount??""} emails`),C(He,`${l(u).classCount??""} classifications`),C(_t,`${l(u).contactCount??""} contacts`)}),S(U,Ee)};Q(ke,U=>{l(u)&&U(xe)})}var we=h(ke,2);{var Z=U=>{var Ee=N1(),ce=h(f(Ee),2);xt(ce,21,n,Ut,(Te,qe)=>{var He=On(),vt=Ze(He);{var _t=Be=>{var Ue=D1(),Ke=f(Ue),ot=h(Ke);ot.__click=()=>A(s,null);var lt=h(ot,2);lt.__click=()=>b(l(qe)),Y(Je=>{C(Ke,`Delete ${Je??""}? `),lt.disabled=l(o)},[()=>O(l(qe))]),S(Be,Ue)},Xe=Be=>{var Ue=L1();Ue.__click=()=>A(s,`group:${l(qe)}`);var Ke=f(Ue);Y(ot=>{Ue.disabled=l(o),C(Ke,`${ot??""} â`)},[()=>O(l(qe))]),S(Be,Ue)};Q(vt,Be=>{l(s)===`group:${l(qe)}`?Be(_t):Be(Xe,!1)})}S(Te,He)}),S(U,Ee)};Q(we,U=>{n().length>0&&U(Z)})}var le=h(we,2),fe=h(f(le),2),$=f(fe);{var pe=U=>{var Ee=q1(),ce=h(f(Ee),2);ce.__click=()=>A(s,null);var Te=h(ce,2);Te.__click=x,Y(()=>Te.disabled=l(o)),S(U,Ee)},ae=U=>{var Ee=B1();Ee.__click=()=>A(s,"classifications"),Y(()=>Ee.disabled=l(o)),S(U,Ee)};Q($,U=>{l(s)==="classifications"?U(pe):U(ae,!1)})}var X=h($,2);{var oe=U=>{var Ee=F1(),ce=h(f(Ee),2);ce.__click=()=>A(s,null);var Te=h(ce,2);Te.__click=w,Y(()=>Te.disabled=l(o)),S(U,Ee)},ge=U=>{var Ee=z1();Ee.__click=()=>A(s,"emails"),Y(()=>Ee.disabled=l(o)),S(U,Ee)};Q(X,U=>{l(s)==="emails"?U(oe):U(ge,!1)})}var Se=h(X,2);{var me=U=>{var Ee=U1(),ce=h(f(Ee),2);ce.__click=()=>A(s,null);var Te=h(ce,2);Te.__click=I,Y(()=>Te.disabled=l(o)),S(U,Ee)},R=U=>{var Ee=K1();Ee.__click=()=>A(s,"contacts"),Y(()=>Ee.disabled=l(o)),S(U,Ee)};Q(Se,U=>{l(s)==="contacts"?U(me):U(R,!1)})}var V=h(le,2),ne=f(V);{var K=U=>{var Ee=G1(),ce=h(f(Ee),2);ce.__click=()=>A(s,null);var Te=h(ce,2);Te.__click=L,Y(()=>Te.disabled=l(o)),S(U,Ee)},ve=U=>{var Ee=H1();Ee.__click=()=>A(s,"nuke"),Y(()=>Ee.disabled=l(o)),S(U,Ee)};Q(ne,U=>{l(s)==="nuke"?U(K):U(ve,!1)})}var be=h(V,2);{var te=U=>{var Ee=W1();S(U,Ee)};Q(be,U=>{l(o)&&U(te)})}S(P,ue)};Q(N,P=>{l(a)&&P(z)})}Y(()=>W=Nt(he,0,"chev svelte-s2dwjj",null,W,{open:l(a)})),S(t,se),Dt()}Jt(["click"]);var X1=T('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),Z1=T('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),J1=T('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),$1=T('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <!> <div class="toolbar svelte-12gkq0i"><button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><circle cx="12" cy="12" r="3"></circle><path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14"></path></svg> Plugins</button> <button class="toolbar-btn svelte-12gkq0i"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12gkq0i"><path d="M12 3v18M3 12h18"></path></svg> Edit Actions</button></div> <!> <!> <!></div>');function ew(t,e){jt(e,!0);let n=Ne(e,"groups",19,()=>({})),a=Ne(e,"groupOrder",19,()=>[]),s=Ne(e,"counts",19,()=>({})),o=Ne(e,"stats",3,null),u=Ne(e,"expandedGroup",3,null),d=Ne(e,"isScanning",3,!1),g=Ne(e,"scanProgress",3,null),m=Ne(e,"scanCount",15,20),_=Ne(e,"error",3,null),x=Oe(!1),b=Oe(!1),w=Oe(!1),I=it(()=>{for(const le of a()){const fe=n()[le];if((fe==null?void 0:fe.length)>0)return fe[0]}return null});var L=$1(),O=f(L);Db(O,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return d()},get scanProgress(){return g()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>A(x,!0),get scanCount(){return m()},set scanCount(le){m(le)}});var se=h(O,2);a1(se,{get sampleEmail(){return l(I)},get open(){return l(x)},set open(le){A(x,le,!0)}});var ie=h(se,2);S1(ie,{get open(){return l(b)},set open(le){A(b,le,!0)}});var he=h(ie,2);R1(he,{get open(){return l(w)},set open(le){A(w,le,!0)}});var W=h(he,2),N=f(W);N.__click=()=>A(w,!0);var z=h(N,2);z.__click=()=>A(b,!0);var P=h(W,2);{var ue=le=>{var fe=X1(),$=f(fe),pe=f($),ae=h($,2);ae.__click=function(...X){var oe;(oe=e.ondismisserror)==null||oe.apply(this,X)},Y(()=>C(pe,_())),S(le,fe)};Q(P,le=>{_()&&le(ue)})}var ke=h(P,2);{var xe=le=>{var fe=Z1(),$=Ze(fe);xt($,20,a,oe=>oe,(oe,ge)=>{{let Se=it(()=>Wo(ge)),me=it(()=>{var ne;return((ne=n()[ge])==null?void 0:ne.length)||0}),R=it(()=>n()[ge]||[]),V=it(()=>u()===ge);$b(oe,{get action(){return ge},get color(){return l(Se)},get count(){return l(me)},get items(){return l(R)},get expanded(){return l(V)},ontoggle:()=>e.ontogglegroup(ge),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(ge)})}});var pe=h($,2),ae=f(pe),X=f(ae);Y(()=>C(X,`${s().total??""} emails classified into ${a().length??""} groups`)),S(le,fe)},we=le=>{var fe=J1();S(le,fe)};Q(ke,le=>{s().total>0?le(xe):d()||le(we,1)})}var Z=h(ke,2);Q1(Z,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),S(t,L),Dt()}Jt(["click"]);var tw=T('<div class="actions-page svelte-3tch4q"><!></div>');function nw(t,e){jt(e,!0);const n=ed();let a=Oe(Vt(n.status)),s=Oe(""),o=Oe(Vt({})),u=Oe(Vt([])),d=Oe(Vt({total:0})),g=Oe(null),m=Oe(null),_=Oe(!1),x=Oe(null),b=Oe(3),w=Oe(null),I=Oe(null);const L="me-ai-scan-history";async function O(){return await js(L)}async function se(fe){!fe||fe.phase!=="done"||await Ds(L,{timestamp:Date.now(),classified:fe.classified||0,errors:fe.errors||0,total:fe.total||0,totals:fe.totals||{},summary:fe.summary||{}})}kn(async()=>{const fe=n.onMessage(pe=>{if(pe.status==="ready"){A(a,"ready");const ae=Ir.find(ge=>ge.id===n.modelId),X=Cr.find(ge=>ge.name===n.modelId),oe=ae||X;A(s,(oe==null?void 0:oe.name)||(oe==null?void 0:oe.displayName)||n.modelId||"",!0)}pe.status==="loading"&&A(a,"loading")});if(A(a,n.status,!0),n.modelId){const pe=Ir.find(oe=>oe.id===n.modelId),ae=Cr.find(oe=>oe.name===n.modelId),X=pe||ae;A(s,(X==null?void 0:X.name)||(X==null?void 0:X.displayName)||n.modelId||"",!0)}const $=await O();return $&&A(x,{phase:"done",...$},!0),ie(),()=>fe()});async function ie(){try{const fe=await _d();A(o,fe.groups,!0),A(u,fe.order,!0),A(d,await Jp(),!0),A(g,await Ho(),!0)}catch(fe){A(w,`Failed to load data: ${fe.message}`)}}async function he(){await N(!1)}async function W(){await N(!0)}async function N(fe){if(l(_)||!n.isReady)return;A(w,null),A(_,!0),A(x,null);const $=new AbortController;A(I,$,!0);try{await gd(n,{count:l(b),force:fe,signal:$.signal,onProgress:pe=>{A(x,{...pe},!0),pe.phase==="done"&&se(pe)}}),await ie()}catch(pe){$.signal.aborted||A(w,`Scan failed: ${pe.message}`)}finally{A(_,!1),A(I,null)}}function z(){var fe;(fe=l(I))==null||fe.abort()}async function P(fe){await Ei(fe,"acted"),await ie()}async function ue(fe){await Ei(fe,"dismissed"),await ie()}async function ke(fe){await yd(fe),await ie()}async function xe(fe){await wl(fe),await ie()}function we(fe){A(m,l(m)===fe?null:fe,!0)}var Z=tw(),le=f(Z);ew(le,{get engineStatus(){return l(a)},get modelName(){return l(s)},get groups(){return l(o)},get groupOrder(){return l(u)},get counts(){return l(d)},get stats(){return l(g)},get expandedGroup(){return l(m)},get isScanning(){return l(_)},get scanProgress(){return l(x)},get error(){return l(w)},onscan:he,onrescan:W,ontogglegroup:we,onmarkacted:P,ondismiss:ue,onremove:ke,oncleargroup:xe,ondismisserror:()=>A(w,null),onstop:z,onrefresh:ie,oncloseprogress:async()=>{A(x,null),await hl(L)},get scanCount(){return l(b)},set scanCount(fe){A(b,fe,!0)}}),S(t,Z),Dt()}var rw=T('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function aw(t,e){jt(e,!0);function n(){const P=location.hash;return P==="#dashboard"?"dashboard":P==="#actions"?"actions":"chat"}let a=Oe(Vt(n()));kn(()=>{function P(){A(a,n(),!0)}return window.addEventListener("hashchange",P),()=>window.removeEventListener("hashchange",P)});var s=rw(),o=f(s),u=h(f(o),2),d=f(u);let g;var m=h(d,2);let _;var x=h(m,2);let b;var w=h(o,2),I=f(w);let L;var O=f(I);Ig(O,{});var se=h(I,2);let ie;var he=f(se);nw(he,{});var W=h(se,2);let N;var z=f(W);sb(z,{}),Y(()=>{g=Nt(d,1,"svelte-1n46o8q",null,g,{active:l(a)==="chat"}),_=Nt(m,1,"svelte-1n46o8q",null,_,{active:l(a)==="actions"}),b=Nt(x,1,"svelte-1n46o8q",null,b,{active:l(a)==="dashboard"}),L=dn(I,"",L,{display:l(a)==="chat"?"flex":"none"}),ie=dn(se,"",ie,{display:l(a)==="actions"?"flex":"none"}),N=dn(W,"",N,{display:l(a)==="dashboard"?"flex":"none"})}),S(t,s),Dt()}Cf(aw,{target:document.getElementById("app")});
