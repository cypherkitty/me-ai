var qd=Object.defineProperty;var Ul=t=>{throw TypeError(t)};var Bd=(t,e,n)=>e in t?qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ct=(t,e,n)=>Bd(t,typeof e!="symbol"?e+"":e,n),oo=(t,e,n)=>e.has(t)||Ul("Cannot "+n);var oe=(t,e,n)=>(oo(t,e,"read from private field"),n?n.call(t):e.get(t)),ut=(t,e,n)=>e.has(t)?Ul("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),it=(t,e,n,a)=>(oo(t,e,"write to private field"),a?a.call(t,n):e.set(t,n),n),pn=(t,e,n)=>(oo(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const xo=!1;var Yo=Array.isArray,Fd=Array.prototype.indexOf,os=Array.prototype.includes,Pi=Array.from,zd=Object.defineProperty,$a=Object.getOwnPropertyDescriptor,Kd=Object.getOwnPropertyDescriptors,Ud=Object.prototype,Gd=Array.prototype,Nc=Object.getPrototypeOf,Gl=Object.isExtensible;const Wd=()=>{};function Hd(t){for(var e=0;e<t.length;e++)t[e]()}function qc(){var t,e,n=new Promise((a,i)=>{t=a,e=i});return{promise:n,resolve:t,reject:e}}const cn=2,Ls=4,Ii=8,Bc=1<<24,Xr=16,gr=32,Ba=64,Fc=128,Zn=512,rn=1024,un=2048,mr=4096,Bn=8192,Yr=16384,Us=32768,ls=65536,Wl=1<<17,zc=1<<18,vs=1<<19,Vd=1<<20,Vr=1<<25,Ma=65536,So=1<<21,Qo=1<<22,sa=1<<23,Ia=Symbol("$state"),Yd=Symbol("legacy props"),Qd=Symbol(""),wa=new class extends Error{constructor(){super(...arguments);ct(this,"name","StaleReactionError");ct(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Xd(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Zd(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Jd(t,e,n){throw new Error("https://svelte.dev/e/each_key_duplicate")}function $d(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ef(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function tf(t){throw new Error("https://svelte.dev/e/effect_orphan")}function nf(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function rf(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function af(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function sf(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function of(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function lf(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const cf=1,uf=2,Kc=4,df=8,ff=16,vf=1,pf=4,hf=8,mf=16,Uc=1,gf=2,sn=Symbol(),Gc="http://www.w3.org/1999/xhtml";function _f(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function yf(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Wc(t){return t===this.v}function bf(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Hc(t){return!bf(t,this.v)}let wf=!1,Fn=null;function cs(t){Fn=t}function Pt(t,e=!1,n){Fn={p:Fn,i:!1,c:null,e:null,s:t,x:null,l:null}}function It(t){var e=Fn,n=e.e;if(n!==null){e.e=null;for(var a of n)pu(a)}return t!==void 0&&(e.x=t),e.i=!0,Fn=e.p,t??{}}function Vc(){return!0}let ka=[];function Yc(){var t=ka;ka=[],Hd(t)}function ia(t){if(ka.length===0&&!Rs){var e=ka;queueMicrotask(()=>{e===ka&&Yc()})}ka.push(t)}function kf(){for(;ka.length>0;)Yc()}function Qc(t){var e=wt;if(e===null)return ft.f|=sa,t;if((e.f&Us)===0&&(e.f&Ls)===0)throw t;us(t,e)}function us(t,e){for(;e!==null;){if((e.f&Fc)!==0){if((e.f&Us)===0)throw t;try{e.b.error(t);return}catch(n){t=n}}e=e.parent}throw t}const xf=-7169;function Ut(t,e){t.f=t.f&xf|e}function Xo(t){(t.f&Zn)!==0||t.deps===null?Ut(t,rn):Ut(t,mr)}function Xc(t){if(t!==null)for(const e of t)(e.f&cn)===0||(e.f&Ma)===0||(e.f^=Ma,Xc(e.deps))}function Zc(t,e,n){(t.f&un)!==0?e.add(t):(t.f&mr)!==0&&n.add(t),Xc(t.deps),Ut(t,rn)}const oi=new Set;let rt=null,wi=null,on=null,An=[],Ri=null,To=!1,Rs=!1;var es,ts,Sa,ns,Bs,Fs,Ta,Ur,rs,Rr,Eo,Ao,Jc;const xl=class xl{constructor(){ut(this,Rr);ct(this,"committed",!1);ct(this,"current",new Map);ct(this,"previous",new Map);ut(this,es,new Set);ut(this,ts,new Set);ut(this,Sa,0);ut(this,ns,0);ut(this,Bs,null);ut(this,Fs,new Set);ut(this,Ta,new Set);ut(this,Ur,new Map);ct(this,"is_fork",!1);ut(this,rs,!1)}is_deferred(){return this.is_fork||oe(this,ns)>0}skip_effect(e){oe(this,Ur).has(e)||oe(this,Ur).set(e,{d:[],m:[]})}unskip_effect(e){var n=oe(this,Ur).get(e);if(n){oe(this,Ur).delete(e);for(var a of n.d)Ut(a,un),fr(a);for(a of n.m)Ut(a,mr),fr(a)}}process(e){var i;An=[],this.apply();var n=[],a=[];for(const o of e)pn(this,Rr,Eo).call(this,o,n,a);if(this.is_deferred()){pn(this,Rr,Ao).call(this,a),pn(this,Rr,Ao).call(this,n);for(const[o,u]of oe(this,Ur))nu(o,u)}else{for(const o of oe(this,es))o();oe(this,es).clear(),oe(this,Sa)===0&&pn(this,Rr,Jc).call(this),wi=this,rt=null,Hl(a),Hl(n),wi=null,(i=oe(this,Bs))==null||i.resolve()}on=null}capture(e,n){n!==sn&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&sa)===0&&(this.current.set(e,e.v),on==null||on.set(e,e.v))}activate(){rt=this,this.apply()}deactivate(){rt===this&&(rt=null,on=null)}flush(){if(this.activate(),An.length>0){if($c(),rt!==null&&rt!==this)return}else oe(this,Sa)===0&&this.process([]);this.deactivate()}discard(){for(const e of oe(this,ts))e(this);oe(this,ts).clear()}increment(e){it(this,Sa,oe(this,Sa)+1),e&&it(this,ns,oe(this,ns)+1)}decrement(e){it(this,Sa,oe(this,Sa)-1),e&&it(this,ns,oe(this,ns)-1),!oe(this,rs)&&(it(this,rs,!0),ia(()=>{it(this,rs,!1),this.is_deferred()?An.length>0&&this.flush():this.revive()}))}revive(){for(const e of oe(this,Fs))oe(this,Ta).delete(e),Ut(e,un),fr(e);for(const e of oe(this,Ta))Ut(e,mr),fr(e);this.flush()}oncommit(e){oe(this,es).add(e)}ondiscard(e){oe(this,ts).add(e)}settled(){return(oe(this,Bs)??it(this,Bs,qc())).promise}static ensure(){if(rt===null){const e=rt=new xl;oi.add(rt),Rs||ia(()=>{rt===e&&e.flush()})}return rt}apply(){}};es=new WeakMap,ts=new WeakMap,Sa=new WeakMap,ns=new WeakMap,Bs=new WeakMap,Fs=new WeakMap,Ta=new WeakMap,Ur=new WeakMap,rs=new WeakMap,Rr=new WeakSet,Eo=function(e,n,a){e.f^=rn;for(var i=e.first,o=null;i!==null;){var u=i.f,d=(u&(gr|Ba))!==0,g=d&&(u&rn)!==0,p=g||(u&Bn)!==0||oe(this,Ur).has(i);if(!p&&i.fn!==null){d?i.f^=rn:o!==null&&(u&(Ls|Ii|Bc))!==0?o.b.defer_effect(i):(u&Ls)!==0?n.push(i):Ws(i)&&((u&Xr)!==0&&oe(this,Ta).add(i),fs(i));var b=i.first;if(b!==null){i=b;continue}}var w=i.parent;for(i=i.next;i===null&&w!==null;)w===o&&(o=null),i=w.next,w=w.parent}},Ao=function(e){for(var n=0;n<e.length;n+=1)Zc(e[n],oe(this,Fs),oe(this,Ta))},Jc=function(){var i;if(oi.size>1){this.previous.clear();var e=on,n=!0;for(const o of oi){if(o===this){n=!1;continue}const u=[];for(const[g,p]of this.current){if(o.current.has(g))if(n&&p!==o.current.get(g))o.current.set(g,p);else continue;u.push(g)}if(u.length===0)continue;const d=[...o.current.keys()].filter(g=>!this.current.has(g));if(d.length>0){var a=An;An=[];const g=new Set,p=new Map;for(const b of u)eu(b,d,g,p);if(An.length>0){rt=o,o.apply();for(const b of An)pn(i=o,Rr,Eo).call(i,b,[],[]);o.deactivate()}An=a}}rt=null,on=e}this.committed=!0,oi.delete(this)};let oa=xl;function Sf(t){var e=Rs;Rs=!0;try{for(var n;;){if(kf(),An.length===0&&(rt==null||rt.flush(),An.length===0))return Ri=null,n;$c()}}finally{Rs=e}}function $c(){To=!0;var t=null;try{for(var e=0;An.length>0;){var n=oa.ensure();if(e++>1e3){var a,i;Tf()}n.process(An),la.clear()}}finally{An=[],To=!1,Ri=null}}function Tf(){try{nf()}catch(t){us(t,Ri)}}let or=null;function Hl(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var a=t[n++];if((a.f&(Yr|Bn))===0&&Ws(a)&&(or=new Set,fs(a),a.deps===null&&a.first===null&&a.nodes===null&&a.teardown===null&&a.ac===null&&_u(a),(or==null?void 0:or.size)>0)){la.clear();for(const i of or){if((i.f&(Yr|Bn))!==0)continue;const o=[i];let u=i.parent;for(;u!==null;)or.has(u)&&(or.delete(u),o.push(u)),u=u.parent;for(let d=o.length-1;d>=0;d--){const g=o[d];(g.f&(Yr|Bn))===0&&fs(g)}}or.clear()}}or=null}}function eu(t,e,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const o=i.f;(o&cn)!==0?eu(i,e,n,a):(o&(Qo|Xr))!==0&&(o&un)===0&&tu(i,e,a)&&(Ut(i,un),fr(i))}}function tu(t,e,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const i of t.deps){if(os.call(e,i))return!0;if((i.f&cn)!==0&&tu(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function fr(t){for(var e=Ri=t;e.parent!==null;){e=e.parent;var n=e.f;if(To&&e===wt&&(n&Xr)!==0&&(n&zc)===0)return;if((n&(Ba|gr))!==0){if((n&rn)===0)return;e.f^=rn}}An.push(e)}function nu(t,e){if(!((t.f&gr)!==0&&(t.f&rn)!==0)){(t.f&un)!==0?e.d.push(t):(t.f&mr)!==0&&e.m.push(t),Ut(t,rn);for(var n=t.first;n!==null;)nu(n,e),n=n.next}}function Ef(t){let e=0,n=Da(0),a;return()=>{$o()&&(v(n),el(()=>(e===0&&(a=Hs(()=>t(()=>Os(n)))),e+=1,()=>{ia(()=>{e-=1,e===0&&(a==null||a(),a=void 0,Os(n))})})))}}var Af=ls|vs|Fc;function Cf(t,e,n){new Pf(t,e,n)}var Yn,Vo,Tr,Ea,Er,Qn,Tn,Ar,Gr,ra,Aa,aa,as,Ca,ss,is,Wr,Ai,an,If,Rf,Co,hi,mi,Po;class Pf{constructor(e,n,a){ut(this,an);ct(this,"parent");ct(this,"is_pending",!1);ut(this,Yn);ut(this,Vo,null);ut(this,Tr);ut(this,Ea);ut(this,Er);ut(this,Qn,null);ut(this,Tn,null);ut(this,Ar,null);ut(this,Gr,null);ut(this,ra,null);ut(this,Aa,0);ut(this,aa,0);ut(this,as,!1);ut(this,Ca,!1);ut(this,ss,new Set);ut(this,is,new Set);ut(this,Wr,null);ut(this,Ai,Ef(()=>(it(this,Wr,Da(oe(this,Aa))),()=>{it(this,Wr,null)})));it(this,Yn,e),it(this,Tr,n),it(this,Ea,a),this.parent=wt.b,this.is_pending=!!oe(this,Tr).pending,it(this,Er,tl(()=>{wt.b=this;{var i=pn(this,an,Co).call(this);try{it(this,Qn,Xn(()=>a(i)))}catch(o){this.error(o)}oe(this,aa)>0?pn(this,an,mi).call(this):this.is_pending=!1}return()=>{var o;(o=oe(this,ra))==null||o.remove()}},Af))}defer_effect(e){Zc(e,oe(this,ss),oe(this,is))}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!oe(this,Tr).pending}update_pending_count(e){pn(this,an,Po).call(this,e),it(this,Aa,oe(this,Aa)+e),!(!oe(this,Wr)||oe(this,as))&&(it(this,as,!0),ia(()=>{it(this,as,!1),oe(this,Wr)&&ds(oe(this,Wr),oe(this,Aa))}))}get_effect_pending(){return oe(this,Ai).call(this),v(oe(this,Wr))}error(e){var n=oe(this,Tr).onerror;let a=oe(this,Tr).failed;if(oe(this,Ca)||!n&&!a)throw e;oe(this,Qn)&&(Pn(oe(this,Qn)),it(this,Qn,null)),oe(this,Tn)&&(Pn(oe(this,Tn)),it(this,Tn,null)),oe(this,Ar)&&(Pn(oe(this,Ar)),it(this,Ar,null));var i=!1,o=!1;const u=()=>{if(i){yf();return}i=!0,o&&lf(),oa.ensure(),it(this,Aa,0),oe(this,Ar)!==null&&Ra(oe(this,Ar),()=>{it(this,Ar,null)}),this.is_pending=this.has_pending_snippet(),it(this,Qn,pn(this,an,hi).call(this,()=>(it(this,Ca,!1),Xn(()=>oe(this,Ea).call(this,oe(this,Yn)))))),oe(this,aa)>0?pn(this,an,mi).call(this):this.is_pending=!1};ia(()=>{try{o=!0,n==null||n(e,u),o=!1}catch(d){us(d,oe(this,Er)&&oe(this,Er).parent)}a&&it(this,Ar,pn(this,an,hi).call(this,()=>{oa.ensure(),it(this,Ca,!0);try{return Xn(()=>{a(oe(this,Yn),()=>e,()=>u)})}catch(d){return us(d,oe(this,Er).parent),null}finally{it(this,Ca,!1)}}))})}}Yn=new WeakMap,Vo=new WeakMap,Tr=new WeakMap,Ea=new WeakMap,Er=new WeakMap,Qn=new WeakMap,Tn=new WeakMap,Ar=new WeakMap,Gr=new WeakMap,ra=new WeakMap,Aa=new WeakMap,aa=new WeakMap,as=new WeakMap,Ca=new WeakMap,ss=new WeakMap,is=new WeakMap,Wr=new WeakMap,Ai=new WeakMap,an=new WeakSet,If=function(){try{it(this,Qn,Xn(()=>oe(this,Ea).call(this,oe(this,Yn))))}catch(e){this.error(e)}},Rf=function(){const e=oe(this,Tr).pending;e&&(it(this,Tn,Xn(()=>e(oe(this,Yn)))),ia(()=>{var n=pn(this,an,Co).call(this);it(this,Qn,pn(this,an,hi).call(this,()=>(oa.ensure(),Xn(()=>oe(this,Ea).call(this,n))))),oe(this,aa)>0?pn(this,an,mi).call(this):(Ra(oe(this,Tn),()=>{it(this,Tn,null)}),this.is_pending=!1)}))},Co=function(){var e=oe(this,Yn);return this.is_pending&&(it(this,ra,Qr()),oe(this,Yn).before(oe(this,ra)),e=oe(this,ra)),e},hi=function(e){var n=wt,a=ft,i=Fn;Ir(oe(this,Er)),$n(oe(this,Er)),cs(oe(this,Er).ctx);try{return e()}catch(o){return Qc(o),null}finally{Ir(n),$n(a),cs(i)}},mi=function(){const e=oe(this,Tr).pending;oe(this,Qn)!==null&&(it(this,Gr,document.createDocumentFragment()),oe(this,Gr).append(oe(this,ra)),wu(oe(this,Qn),oe(this,Gr))),oe(this,Tn)===null&&it(this,Tn,Xn(()=>e(oe(this,Yn))))},Po=function(e){var n;if(!this.has_pending_snippet()){this.parent&&pn(n=this.parent,an,Po).call(n,e);return}if(it(this,aa,oe(this,aa)+e),oe(this,aa)===0){this.is_pending=!1;for(const a of oe(this,ss))Ut(a,un),fr(a);for(const a of oe(this,is))Ut(a,mr),fr(a);oe(this,ss).clear(),oe(this,is).clear(),oe(this,Tn)&&Ra(oe(this,Tn),()=>{it(this,Tn,null)}),oe(this,Gr)&&(oe(this,Yn).before(oe(this,Gr)),it(this,Gr,null))}};function Of(t,e,n,a){const i=Oi;var o=t.filter(k=>!k.settled);if(n.length===0&&o.length===0){a(e.map(i));return}var u=rt,d=wt,g=Mf(),p=o.length===1?o[0].promise:o.length>1?Promise.all(o.map(k=>k.promise)):null;function b(k){g();try{a(k)}catch(x){(d.f&Yr)===0&&us(x,d)}u==null||u.deactivate(),Io()}if(n.length===0){p.then(()=>b(e.map(i)));return}function w(){g(),Promise.all(n.map(k=>Df(k))).then(k=>b([...e.map(i),...k])).catch(k=>us(k,d))}p?p.then(w):w()}function Mf(){var t=wt,e=ft,n=Fn,a=rt;return function(o=!0){Ir(t),$n(e),cs(n),o&&(a==null||a.activate())}}function Io(){Ir(null),$n(null),cs(null)}function Oi(t){var e=cn|un,n=ft!==null&&(ft.f&cn)!==0?ft:null;return wt!==null&&(wt.f|=vs),{ctx:Fn,deps:null,effects:null,equals:Wc,f:e,fn:t,reactions:null,rv:0,v:sn,wv:0,parent:n??wt,ac:null}}function Df(t,e,n){let a=wt;a===null&&Zd();var i=a.b,o=void 0,u=Da(sn),d=!ft,g=new Map;return Yf(()=>{var x;var p=qc();o=p.promise;try{Promise.resolve(t()).then(p.resolve,p.reject).then(()=>{b===rt&&b.committed&&b.deactivate(),Io()})}catch(I){p.reject(I),Io()}var b=rt;if(d){var w=i.is_rendered();i.update_pending_count(1),b.increment(w),(x=g.get(b))==null||x.reject(wa),g.delete(b),g.set(b,p)}const k=(I,B=void 0)=>{if(b.activate(),B)B!==wa&&(u.f|=sa,ds(u,B));else{(u.f&sa)!==0&&(u.f^=sa),ds(u,I);for(const[R,X]of g){if(g.delete(R),R===b)break;X.reject(wa)}}d&&(i.update_pending_count(-1),b.decrement(w))};p.promise.then(k,I=>k(null,I||"unknown"))}),vu(()=>{for(const p of g.values())p.reject(wa)}),new Promise(p=>{function b(w){function k(){w===o?p(u):b(o)}w.then(k,k)}b(o)})}function ht(t){const e=Oi(t);return ku(e),e}function ru(t){const e=Oi(t);return e.equals=Hc,e}function jf(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Pn(e[n])}}function Lf(t){for(var e=t.parent;e!==null;){if((e.f&cn)===0)return(e.f&Yr)===0?e:null;e=e.parent}return null}function Zo(t){var e,n=wt;Ir(Lf(t));try{t.f&=~Ma,jf(t),e=Eu(t)}finally{Ir(n)}return e}function au(t){var e=Zo(t);if(!t.equals(e)&&(t.wv=Su(),(!(rt!=null&&rt.is_fork)||t.deps===null)&&(t.v=e,t.deps===null))){Ut(t,rn);return}ca||(on!==null?($o()||rt!=null&&rt.is_fork)&&on.set(t,e):Xo(t))}function Nf(t){var e,n;if(t.effects!==null)for(const a of t.effects)(a.teardown||a.ac)&&((e=a.teardown)==null||e.call(a),(n=a.ac)==null||n.abort(wa),a.teardown=Wd,a.ac=null,Ns(a,0),nl(a))}function su(t){if(t.effects!==null)for(const e of t.effects)e.teardown&&fs(e)}let Ro=new Set;const la=new Map;let iu=!1;function Da(t,e){var n={f:0,v:t,reactions:null,equals:Wc,rv:0,wv:0};return n}function Oe(t,e){const n=Da(t);return ku(n),n}function qf(t,e=!1,n=!0){const a=Da(t);return e||(a.equals=Hc),a}function A(t,e,n=!1){ft!==null&&(!vr||(ft.f&Wl)!==0)&&Vc()&&(ft.f&(cn|Xr|Qo|Wl))!==0&&(Jn===null||!os.call(Jn,t))&&of();let a=n?Gt(e):e;return ds(t,a)}function ds(t,e){if(!t.equals(e)){var n=t.v;ca?la.set(t,e):la.set(t,n),t.v=e;var a=oa.ensure();if(a.capture(t,n),(t.f&cn)!==0){const i=t;(t.f&un)!==0&&Zo(i),Xo(i)}t.wv=Su(),ou(t,un),wt!==null&&(wt.f&rn)!==0&&(wt.f&(gr|Ba))===0&&(Vn===null?Xf([t]):Vn.push(t)),!a.is_fork&&Ro.size>0&&!iu&&Bf()}return e}function Bf(){iu=!1;for(const t of Ro)(t.f&rn)!==0&&Ut(t,mr),Ws(t)&&fs(t);Ro.clear()}function Os(t){A(t,t.v+1)}function ou(t,e){var n=t.reactions;if(n!==null)for(var a=n.length,i=0;i<a;i++){var o=n[i],u=o.f,d=(u&un)===0;if(d&&Ut(o,e),(u&cn)!==0){var g=o;on==null||on.delete(g),(u&Ma)===0&&(u&Zn&&(o.f|=Ma),ou(g,mr))}else d&&((u&Xr)!==0&&or!==null&&or.add(o),fr(o))}}function Gt(t){if(typeof t!="object"||t===null||Ia in t)return t;const e=Nc(t);if(e!==Ud&&e!==Gd)return t;var n=new Map,a=Yo(t),i=Oe(0),o=Oa,u=d=>{if(Oa===o)return d();var g=ft,p=Oa;$n(null),Zl(o);var b=d();return $n(g),Zl(p),b};return a&&n.set("length",Oe(t.length)),new Proxy(t,{defineProperty(d,g,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&af();var b=n.get(g);return b===void 0?u(()=>{var w=Oe(p.value);return n.set(g,w),w}):A(b,p.value,!0),!0},deleteProperty(d,g){var p=n.get(g);if(p===void 0){if(g in d){const b=u(()=>Oe(sn));n.set(g,b),Os(i)}}else A(p,sn),Os(i);return!0},get(d,g,p){var x;if(g===Ia)return t;var b=n.get(g),w=g in d;if(b===void 0&&(!w||(x=$a(d,g))!=null&&x.writable)&&(b=u(()=>{var I=Gt(w?d[g]:sn),B=Oe(I);return B}),n.set(g,b)),b!==void 0){var k=v(b);return k===sn?void 0:k}return Reflect.get(d,g,p)},getOwnPropertyDescriptor(d,g){var p=Reflect.getOwnPropertyDescriptor(d,g);if(p&&"value"in p){var b=n.get(g);b&&(p.value=v(b))}else if(p===void 0){var w=n.get(g),k=w==null?void 0:w.v;if(w!==void 0&&k!==sn)return{enumerable:!0,configurable:!0,value:k,writable:!0}}return p},has(d,g){var k;if(g===Ia)return!0;var p=n.get(g),b=p!==void 0&&p.v!==sn||Reflect.has(d,g);if(p!==void 0||wt!==null&&(!b||(k=$a(d,g))!=null&&k.writable)){p===void 0&&(p=u(()=>{var x=b?Gt(d[g]):sn,I=Oe(x);return I}),n.set(g,p));var w=v(p);if(w===sn)return!1}return b},set(d,g,p,b){var U;var w=n.get(g),k=g in d;if(a&&g==="length")for(var x=p;x<w.v;x+=1){var I=n.get(x+"");I!==void 0?A(I,sn):x in d&&(I=u(()=>Oe(sn)),n.set(x+"",I))}if(w===void 0)(!k||(U=$a(d,g))!=null&&U.writable)&&(w=u(()=>Oe(void 0)),A(w,Gt(p)),n.set(g,w));else{k=w.v!==sn;var B=u(()=>Gt(p));A(w,B)}var R=Reflect.getOwnPropertyDescriptor(d,g);if(R!=null&&R.set&&R.set.call(b,p),!k){if(a&&typeof g=="string"){var X=n.get("length"),Y=Number(g);Number.isInteger(Y)&&Y>=X.v&&A(X,Y+1)}Os(i)}return!0},ownKeys(d){v(i);var g=Reflect.ownKeys(d).filter(w=>{var k=n.get(w);return k===void 0||k.v!==sn});for(var[p,b]of n)b.v!==sn&&!(p in d)&&g.push(p);return g},setPrototypeOf(){sf()}})}function Vl(t){try{if(t!==null&&typeof t=="object"&&Ia in t)return t[Ia]}catch{}return t}function Ff(t,e){return Object.is(Vl(t),Vl(e))}var Yl,lu,cu,uu;function zf(){if(Yl===void 0){Yl=window,lu=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;cu=$a(e,"firstChild").get,uu=$a(e,"nextSibling").get,Gl(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Gl(n)&&(n.__t=void 0)}}function Qr(t=""){return document.createTextNode(t)}function qn(t){return cu.call(t)}function Gs(t){return uu.call(t)}function h(t,e){return qn(t)}function $e(t,e=!1){{var n=qn(t);return n instanceof Comment&&n.data===""?Gs(n):n}}function _(t,e=1,n=!1){let a=t;for(;e--;)a=Gs(a);return a}function Kf(t){t.textContent=""}function du(){return!1}function Uf(t,e,n){return document.createElementNS(Gc,t,void 0)}let Ql=!1;function Gf(){Ql||(Ql=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const n of t.target.elements)(e=n.__on_r)==null||e.call(n)})},{capture:!0}))}function Jo(t){var e=ft,n=wt;$n(null),Ir(null);try{return t()}finally{$n(e),Ir(n)}}function fu(t,e,n,a=n){t.addEventListener(e,()=>Jo(n));const i=t.__on_r;i?t.__on_r=()=>{i(),a(!0)}:t.__on_r=()=>a(!0),Gf()}function Wf(t){wt===null&&(ft===null&&tf(),ef()),ca&&$d()}function Hf(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Zr(t,e,n){var a=wt;a!==null&&(a.f&Bn)!==0&&(t|=Bn);var i={ctx:Fn,deps:null,nodes:null,f:t|un|Zn,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{fs(i)}catch(d){throw Pn(i),d}else e!==null&&fr(i);var o=i;if(n&&o.deps===null&&o.teardown===null&&o.nodes===null&&o.first===o.last&&(o.f&vs)===0&&(o=o.first,(t&Xr)!==0&&(t&ls)!==0&&o!==null&&(o.f|=ls)),o!==null&&(o.parent=a,a!==null&&Hf(o,a),ft!==null&&(ft.f&cn)!==0&&(t&Ba)===0)){var u=ft;(u.effects??(u.effects=[])).push(o)}return i}function $o(){return ft!==null&&!vr}function vu(t){const e=Zr(Ii,null,!1);return Ut(e,rn),e.teardown=t,e}function ja(t){Wf();var e=wt.f,n=!ft&&(e&gr)!==0&&(e&Us)===0;if(n){var a=Fn;(a.e??(a.e=[])).push(t)}else return pu(t)}function pu(t){return Zr(Ls|Vd,t,!1)}function Vf(t){oa.ensure();const e=Zr(Ba|vs,t,!0);return(n={})=>new Promise(a=>{n.outro?Ra(e,()=>{Pn(e),a(void 0)}):(Pn(e),a(void 0))})}function hu(t){return Zr(Ls,t,!1)}function Yf(t){return Zr(Qo|vs,t,!0)}function el(t,e=0){return Zr(Ii|e,t,!0)}function ee(t,e=[],n=[],a=[]){Of(a,e,n,i=>{Zr(Ii,()=>t(...i.map(v)),!0)})}function tl(t,e=0){var n=Zr(Xr|e,t,!0);return n}function Xn(t){return Zr(gr|vs,t,!0)}function mu(t){var e=t.teardown;if(e!==null){const n=ca,a=ft;Xl(!0),$n(null);try{e.call(null)}finally{Xl(n),$n(a)}}}function nl(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Jo(()=>{i.abort(wa)});var a=n.next;(n.f&Ba)!==0?n.parent=null:Pn(n,e),n=a}}function Qf(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&gr)===0&&Pn(e),e=n}}function Pn(t,e=!0){var n=!1;(e||(t.f&zc)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(gu(t.nodes.start,t.nodes.end),n=!0),nl(t,e&&!n),Ns(t,0),Ut(t,Yr);var a=t.nodes&&t.nodes.t;if(a!==null)for(const o of a)o.stop();mu(t);var i=t.parent;i!==null&&i.first!==null&&_u(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function gu(t,e){for(;t!==null;){var n=t===e?null:Gs(t);t.remove(),t=n}}function _u(t){var e=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),e!==null&&(e.first===t&&(e.first=a),e.last===t&&(e.last=n))}function Ra(t,e,n=!0){var a=[];yu(t,a,!0);var i=()=>{n&&Pn(t),e&&e()},o=a.length;if(o>0){var u=()=>--o||i();for(var d of a)d.out(u)}else i()}function yu(t,e,n){if((t.f&Bn)===0){t.f^=Bn;var a=t.nodes&&t.nodes.t;if(a!==null)for(const d of a)(d.is_global||n)&&e.push(d);for(var i=t.first;i!==null;){var o=i.next,u=(i.f&ls)!==0||(i.f&gr)!==0&&(t.f&Xr)!==0;yu(i,e,u?n:!1),i=o}}}function rl(t){bu(t,!0)}function bu(t,e){if((t.f&Bn)!==0){t.f^=Bn,(t.f&rn)===0&&(Ut(t,un),fr(t));for(var n=t.first;n!==null;){var a=n.next,i=(n.f&ls)!==0||(n.f&gr)!==0;bu(n,i?e:!1),n=a}var o=t.nodes&&t.nodes.t;if(o!==null)for(const u of o)(u.is_global||e)&&u.in()}}function wu(t,e){if(t.nodes)for(var n=t.nodes.start,a=t.nodes.end;n!==null;){var i=n===a?null:Gs(n);e.append(n),n=i}}let gi=!1,ca=!1;function Xl(t){ca=t}let ft=null,vr=!1;function $n(t){ft=t}let wt=null;function Ir(t){wt=t}let Jn=null;function ku(t){ft!==null&&(Jn===null?Jn=[t]:Jn.push(t))}let Cn=null,jn=0,Vn=null;function Xf(t){Vn=t}let xu=1,xa=0,Oa=xa;function Zl(t){Oa=t}function Su(){return++xu}function Ws(t){var e=t.f;if((e&un)!==0)return!0;if(e&cn&&(t.f&=~Ma),(e&mr)!==0){for(var n=t.deps,a=n.length,i=0;i<a;i++){var o=n[i];if(Ws(o)&&au(o),o.wv>t.wv)return!0}(e&Zn)!==0&&on===null&&Ut(t,rn)}return!1}function Tu(t,e,n=!0){var a=t.reactions;if(a!==null&&!(Jn!==null&&os.call(Jn,t)))for(var i=0;i<a.length;i++){var o=a[i];(o.f&cn)!==0?Tu(o,e,!1):e===o&&(n?Ut(o,un):(o.f&rn)!==0&&Ut(o,mr),fr(o))}}function Eu(t){var B;var e=Cn,n=jn,a=Vn,i=ft,o=Jn,u=Fn,d=vr,g=Oa,p=t.f;Cn=null,jn=0,Vn=null,ft=(p&(gr|Ba))===0?t:null,Jn=null,cs(t.ctx),vr=!1,Oa=++xa,t.ac!==null&&(Jo(()=>{t.ac.abort(wa)}),t.ac=null);try{t.f|=So;var b=t.fn,w=b();t.f|=Us;var k=t.deps,x=rt==null?void 0:rt.is_fork;if(Cn!==null){var I;if(x||Ns(t,jn),k!==null&&jn>0)for(k.length=jn+Cn.length,I=0;I<Cn.length;I++)k[jn+I]=Cn[I];else t.deps=k=Cn;if($o()&&(t.f&Zn)!==0)for(I=jn;I<k.length;I++)((B=k[I]).reactions??(B.reactions=[])).push(t)}else!x&&k!==null&&jn<k.length&&(Ns(t,jn),k.length=jn);if(Vc()&&Vn!==null&&!vr&&k!==null&&(t.f&(cn|mr|un))===0)for(I=0;I<Vn.length;I++)Tu(Vn[I],t);if(i!==null&&i!==t){if(xa++,i.deps!==null)for(let R=0;R<n;R+=1)i.deps[R].rv=xa;if(e!==null)for(const R of e)R.rv=xa;Vn!==null&&(a===null?a=Vn:a.push(...Vn))}return(t.f&sa)!==0&&(t.f^=sa),w}catch(R){return Qc(R)}finally{t.f^=So,Cn=e,jn=n,Vn=a,ft=i,Jn=o,cs(u),vr=d,Oa=g}}function Zf(t,e){let n=e.reactions;if(n!==null){var a=Fd.call(n,t);if(a!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[a]=n[i],n.pop())}}if(n===null&&(e.f&cn)!==0&&(Cn===null||!os.call(Cn,e))){var o=e;(o.f&Zn)!==0&&(o.f^=Zn,o.f&=~Ma),Xo(o),Nf(o),Ns(o,0)}}function Ns(t,e){var n=t.deps;if(n!==null)for(var a=e;a<n.length;a++)Zf(t,n[a])}function fs(t){var e=t.f;if((e&Yr)===0){Ut(t,rn);var n=wt,a=gi;wt=t,gi=!0;try{(e&(Xr|Bc))!==0?Qf(t):nl(t),mu(t);var i=Eu(t);t.teardown=typeof i=="function"?i:null,t.wv=xu;var o;xo&&wf&&(t.f&un)!==0&&t.deps}finally{gi=a,wt=n}}}async function Au(){await Promise.resolve(),Sf()}function v(t){var e=t.f,n=(e&cn)!==0;if(ft!==null&&!vr){var a=wt!==null&&(wt.f&Yr)!==0;if(!a&&(Jn===null||!os.call(Jn,t))){var i=ft.deps;if((ft.f&So)!==0)t.rv<xa&&(t.rv=xa,Cn===null&&i!==null&&i[jn]===t?jn++:Cn===null?Cn=[t]:Cn.push(t));else{(ft.deps??(ft.deps=[])).push(t);var o=t.reactions;o===null?t.reactions=[ft]:os.call(o,ft)||o.push(ft)}}}if(ca&&la.has(t))return la.get(t);if(n){var u=t;if(ca){var d=u.v;return((u.f&rn)===0&&u.reactions!==null||Pu(u))&&(d=Zo(u)),la.set(u,d),d}var g=(u.f&Zn)===0&&!vr&&ft!==null&&(gi||(ft.f&Zn)!==0),p=(u.f&Us)===0;Ws(u)&&(g&&(u.f|=Zn),au(u)),g&&!p&&(su(u),Cu(u))}if(on!=null&&on.has(t))return on.get(t);if((t.f&sa)!==0)throw t.v;return t.v}function Cu(t){if(t.f|=Zn,t.deps!==null)for(const e of t.deps)(e.reactions??(e.reactions=[])).push(t),(e.f&cn)!==0&&(e.f&Zn)===0&&(su(e),Cu(e))}function Pu(t){if(t.v===sn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(la.has(e)||(e.f&cn)!==0&&Pu(e))return!0;return!1}function Hs(t){var e=vr;try{return vr=!0,t()}finally{vr=e}}const Jf=["touchstart","touchmove"];function $f(t){return Jf.includes(t)}const Iu=new Set,Oo=new Set;function Wt(t){for(var e=0;e<t.length;e++)Iu.add(t[e]);for(var n of Oo)n(t)}let Jl=null;function $l(t){var R;var e=this,n=e.ownerDocument,a=t.type,i=((R=t.composedPath)==null?void 0:R.call(t))||[],o=i[0]||t.target;Jl=t;var u=0,d=Jl===t&&t.__root;if(d){var g=i.indexOf(d);if(g!==-1&&(e===document||e===window)){t.__root=e;return}var p=i.indexOf(e);if(p===-1)return;g<=p&&(u=g)}if(o=i[u]||t.target,o!==e){zd(t,"currentTarget",{configurable:!0,get(){return o||n}});var b=ft,w=wt;$n(null),Ir(null);try{for(var k,x=[];o!==null;){var I=o.assignedSlot||o.parentNode||o.host||null;try{var B=o["__"+a];B!=null&&(!o.disabled||t.target===o)&&B.call(o,t)}catch(X){k?x.push(X):k=X}if(t.cancelBubble||I===e||I===null)break;o=I}if(k){for(let X of x)queueMicrotask(()=>{throw X});throw k}}finally{t.__root=e,delete t.currentTarget,$n(b),Ir(w)}}}var Dc,jc;const lo=(jc=(Dc=globalThis==null?void 0:globalThis.window)==null?void 0:Dc.trustedTypes)==null?void 0:jc.createPolicy("svelte-trusted-html",{createHTML:t=>t});function ev(t){return(lo==null?void 0:lo.createHTML(t))??t}function al(t,e=!1){var n=Uf("template");return t=t.replaceAll("<!>","<!---->"),n.innerHTML=e?ev(t):t,n.content}function La(t,e){var n=wt;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function M(t,e){var n=(e&Uc)!==0,a=(e&gf)!==0,i,o=!t.startsWith("<!>");return()=>{i===void 0&&(i=al(o?t:"<!>"+t,!0),n||(i=qn(i)));var u=a||lu?document.importNode(i,!0):i.cloneNode(!0);if(n){var d=qn(u),g=u.lastChild;La(d,g)}else La(u,u);return u}}function tv(t,e,n="svg"){var a=!t.startsWith("<!>"),i=(e&Uc)!==0,o=`<${n}>${a?t:"<!>"+t}</${n}>`,u;return()=>{if(!u){var d=al(o,!0),g=qn(d);if(i)for(u=document.createDocumentFragment();qn(g);)u.appendChild(qn(g));else u=qn(g)}var p=u.cloneNode(!0);if(i){var b=qn(p),w=p.lastChild;La(b,w)}else La(p,p);return p}}function sl(t,e){return tv(t,e,"svg")}function Nn(t=""){{var e=Qr(t+"");return La(e,e),e}}function pr(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Qr();return t.append(e,n),La(e,n),t}function T(t,e){t!==null&&t.before(e)}function K(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function nv(t,e){return rv(t,e)}const li=new Map;function rv(t,{target:e,anchor:n,props:a={},events:i,context:o,intro:u=!0}){zf();var d=new Set,g=w=>{for(var k=0;k<w.length;k++){var x=w[k];if(!d.has(x)){d.add(x);var I=$f(x);for(const X of[e,document]){var B=li.get(X);B===void 0&&(B=new Map,li.set(X,B));var R=B.get(x);R===void 0?(X.addEventListener(x,$l,{passive:I}),B.set(x,1)):B.set(x,R+1)}}}};g(Pi(Iu)),Oo.add(g);var p=void 0,b=Vf(()=>{var w=n??e.appendChild(Qr());return Cf(w,{pending:()=>{}},k=>{Pt({});var x=Fn;o&&(x.c=o),i&&(a.$$events=i),p=t(k,a)||{},It()}),()=>{var B;for(var k of d)for(const R of[e,document]){var x=li.get(R),I=x.get(k);--I==0?(R.removeEventListener(k,$l),x.delete(k),x.size===0&&li.delete(R)):x.set(k,I)}Oo.delete(g),w!==n&&((B=w.parentNode)==null||B.removeChild(w))}});return av.set(p,b),p}let av=new WeakMap;var cr,Cr,Ln,Pa,zs,Ks,Ci;class sv{constructor(e,n=!0){ct(this,"anchor");ut(this,cr,new Map);ut(this,Cr,new Map);ut(this,Ln,new Map);ut(this,Pa,new Set);ut(this,zs,!0);ut(this,Ks,()=>{var e=rt;if(oe(this,cr).has(e)){var n=oe(this,cr).get(e),a=oe(this,Cr).get(n);if(a)rl(a),oe(this,Pa).delete(n);else{var i=oe(this,Ln).get(n);i&&(oe(this,Cr).set(n,i.effect),oe(this,Ln).delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),a=i.effect)}for(const[o,u]of oe(this,cr)){if(oe(this,cr).delete(o),o===e)break;const d=oe(this,Ln).get(u);d&&(Pn(d.effect),oe(this,Ln).delete(u))}for(const[o,u]of oe(this,Cr)){if(o===n||oe(this,Pa).has(o))continue;const d=()=>{if(Array.from(oe(this,cr).values()).includes(o)){var p=document.createDocumentFragment();wu(u,p),p.append(Qr()),oe(this,Ln).set(o,{effect:u,fragment:p})}else Pn(u);oe(this,Pa).delete(o),oe(this,Cr).delete(o)};oe(this,zs)||!a?(oe(this,Pa).add(o),Ra(u,d,!1)):d()}}});ut(this,Ci,e=>{oe(this,cr).delete(e);const n=Array.from(oe(this,cr).values());for(const[a,i]of oe(this,Ln))n.includes(a)||(Pn(i.effect),oe(this,Ln).delete(a))});this.anchor=e,it(this,zs,n)}ensure(e,n){var a=rt,i=du();if(n&&!oe(this,Cr).has(e)&&!oe(this,Ln).has(e))if(i){var o=document.createDocumentFragment(),u=Qr();o.append(u),oe(this,Ln).set(e,{effect:Xn(()=>n(u)),fragment:o})}else oe(this,Cr).set(e,Xn(()=>n(this.anchor)));if(oe(this,cr).set(a,e),i){for(const[d,g]of oe(this,Cr))d===e?a.unskip_effect(g):a.skip_effect(g);for(const[d,g]of oe(this,Ln))d===e?a.unskip_effect(g.effect):a.skip_effect(g.effect);a.oncommit(oe(this,Ks)),a.ondiscard(oe(this,Ci))}else oe(this,Ks).call(this)}}cr=new WeakMap,Cr=new WeakMap,Ln=new WeakMap,Pa=new WeakMap,zs=new WeakMap,Ks=new WeakMap,Ci=new WeakMap;function ae(t,e,n=!1){var a=new sv(t),i=n?ls:0;function o(u,d){a.ensure(u,d)}tl(()=>{var u=!1;e((d,g=0)=>{u=!0,o(g,d)}),u||o(!1,null)},i)}function yn(t,e){return e}function iv(t,e,n){for(var a=[],i=e.length,o,u=e.length,d=0;d<i;d++){let w=e[d];Ra(w,()=>{if(o){if(o.pending.delete(w),o.done.add(w),o.pending.size===0){var k=t.outrogroups;Mo(Pi(o.done)),k.delete(o),k.size===0&&(t.outrogroups=null)}}else u-=1},!1)}if(u===0){var g=a.length===0&&n!==null;if(g){var p=n,b=p.parentNode;Kf(b),b.append(p),t.items.clear()}Mo(e,!g)}else o={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(o)}function Mo(t,e=!0){for(var n=0;n<t.length;n++)Pn(t[n],e)}var ec;function Qt(t,e,n,a,i,o=null){var u=t,d=new Map,g=(e&Kc)!==0;if(g){var p=t;u=p.appendChild(Qr())}var b=null,w=ru(()=>{var X=n();return Yo(X)?X:X==null?[]:Pi(X)}),k,x=!0;function I(){R.fallback=b,ov(R,k,u,e,a),b!==null&&(k.length===0?(b.f&Vr)===0?rl(b):(b.f^=Vr,Cs(b,null,u)):Ra(b,()=>{b=null}))}var B=tl(()=>{k=v(w);for(var X=k.length,Y=new Set,U=rt,C=du(),V=0;V<X;V+=1){var J=k[V],F=a(J,V),le=x?null:d.get(F);le?(le.v&&ds(le.v,J),le.i&&ds(le.i,V),C&&U.unskip_effect(le.e)):(le=lv(d,x?u:ec??(ec=Qr()),J,F,V,i,e,n),x||(le.e.f|=Vr),d.set(F,le)),Y.add(F)}if(X===0&&o&&!b&&(x?b=Xn(()=>o(u)):(b=Xn(()=>o(ec??(ec=Qr()))),b.f|=Vr)),X>Y.size&&Jd(),!x)if(C){for(const[xe,Ae]of d)Y.has(xe)||U.skip_effect(Ae.e);U.oncommit(I),U.ondiscard(()=>{})}else I();v(w)}),R={effect:B,items:d,outrogroups:null,fallback:b};x=!1}function bs(t){for(;t!==null&&(t.f&gr)===0;)t=t.next;return t}function ov(t,e,n,a,i){var Ae,ve,te,ce,we,re,me,Se,ie;var o=(a&df)!==0,u=e.length,d=t.items,g=bs(t.effect.first),p,b=null,w,k=[],x=[],I,B,R,X;if(o)for(X=0;X<u;X+=1)I=e[X],B=i(I,X),R=d.get(B).e,(R.f&Vr)===0&&((ve=(Ae=R.nodes)==null?void 0:Ae.a)==null||ve.measure(),(w??(w=new Set)).add(R));for(X=0;X<u;X+=1){if(I=e[X],B=i(I,X),R=d.get(B).e,t.outrogroups!==null)for(const pe of t.outrogroups)pe.pending.delete(R),pe.done.delete(R);if((R.f&Vr)!==0)if(R.f^=Vr,R===g)Cs(R,null,n);else{var Y=b?b.next:g;R===t.effect.last&&(t.effect.last=R.prev),R.prev&&(R.prev.next=R.next),R.next&&(R.next.prev=R.prev),ta(t,b,R),ta(t,R,Y),Cs(R,Y,n),b=R,k=[],x=[],g=bs(b.next);continue}if((R.f&Bn)!==0&&(rl(R),o&&((ce=(te=R.nodes)==null?void 0:te.a)==null||ce.unfix(),(w??(w=new Set)).delete(R))),R!==g){if(p!==void 0&&p.has(R)){if(k.length<x.length){var U=x[0],C;b=U.prev;var V=k[0],J=k[k.length-1];for(C=0;C<k.length;C+=1)Cs(k[C],U,n);for(C=0;C<x.length;C+=1)p.delete(x[C]);ta(t,V.prev,J.next),ta(t,b,V),ta(t,J,U),g=U,b=J,X-=1,k=[],x=[]}else p.delete(R),Cs(R,g,n),ta(t,R.prev,R.next),ta(t,R,b===null?t.effect.first:b.next),ta(t,b,R),b=R;continue}for(k=[],x=[];g!==null&&g!==R;)(p??(p=new Set)).add(g),x.push(g),g=bs(g.next);if(g===null)continue}(R.f&Vr)===0&&k.push(R),b=R,g=bs(R.next)}if(t.outrogroups!==null){for(const pe of t.outrogroups)pe.pending.size===0&&(Mo(Pi(pe.done)),(we=t.outrogroups)==null||we.delete(pe));t.outrogroups.size===0&&(t.outrogroups=null)}if(g!==null||p!==void 0){var F=[];if(p!==void 0)for(R of p)(R.f&Bn)===0&&F.push(R);for(;g!==null;)(g.f&Bn)===0&&g!==t.fallback&&F.push(g),g=bs(g.next);var le=F.length;if(le>0){var xe=(a&Kc)!==0&&u===0?n:null;if(o){for(X=0;X<le;X+=1)(me=(re=F[X].nodes)==null?void 0:re.a)==null||me.measure();for(X=0;X<le;X+=1)(ie=(Se=F[X].nodes)==null?void 0:Se.a)==null||ie.fix()}iv(t,F,xe)}}o&&ia(()=>{var pe,se;if(w!==void 0)for(R of w)(se=(pe=R.nodes)==null?void 0:pe.a)==null||se.apply()})}function lv(t,e,n,a,i,o,u,d){var g=(u&cf)!==0?(u&ff)===0?qf(n,!1,!1):Da(n):null,p=(u&uf)!==0?Da(i):null;return{v:g,i:p,e:Xn(()=>(o(e,g??n,p??i,d),()=>{t.delete(a)}))}}function Cs(t,e,n){if(t.nodes)for(var a=t.nodes.start,i=t.nodes.end,o=e&&(e.f&Vr)===0?e.nodes.start:n;a!==null;){var u=Gs(a);if(o.before(a),a===i)return;a=u}}function ta(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function cv(t,e,n=!1,a=!1,i=!1){var o=t,u="";ee(()=>{var d=wt;if(u!==(u=e()??"")&&(d.nodes!==null&&(gu(d.nodes.start,d.nodes.end),d.nodes=null),u!=="")){var g=u+"";n?g=`<svg>${g}</svg>`:a&&(g=`<math>${g}</math>`);var p=al(g);if((n||a)&&(p=qn(p)),La(qn(p),p.lastChild),n||a)for(;qn(p);)o.before(qn(p));else o.before(p)}})}const tc=[...` 	
\r\fÂ \v\uFEFF`];function uv(t,e,n){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),n){for(var i in n)if(n[i])a=a?a+" "+i:i;else if(a.length)for(var o=i.length,u=0;(u=a.indexOf(i,u))>=0;){var d=u+o;(u===0||tc.includes(a[u-1]))&&(d===a.length||tc.includes(a[d]))?a=(u===0?"":a.substring(0,u))+a.substring(d+1):u=d}}return a===""?null:a}function nc(t,e=!1){var n=e?" !important;":";",a="";for(var i in t){var o=t[i];o!=null&&o!==""&&(a+=" "+i+": "+o+n)}return a}function co(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function dv(t,e){if(e){var n="",a,i;if(Array.isArray(e)?(a=e[0],i=e[1]):a=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,u=0,d=!1,g=[];a&&g.push(...Object.keys(a).map(co)),i&&g.push(...Object.keys(i).map(co));var p=0,b=-1;const B=t.length;for(var w=0;w<B;w++){var k=t[w];if(d?k==="/"&&t[w-1]==="*"&&(d=!1):o?o===k&&(o=!1):k==="/"&&t[w+1]==="*"?d=!0:k==='"'||k==="'"?o=k:k==="("?u++:k===")"&&u--,!d&&o===!1&&u===0){if(k===":"&&b===-1)b=w;else if(k===";"||w===B-1){if(b!==-1){var x=co(t.substring(p,b).trim());if(!g.includes(x)){k!==";"&&w++;var I=t.substring(p,w).trim();n+=" "+I+";"}}p=w+1,b=-1}}}}return a&&(n+=nc(a)),i&&(n+=nc(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Ct(t,e,n,a,i,o){var u=t.__className;if(u!==n||u===void 0){var d=uv(n,a,o);d==null?t.removeAttribute("class"):e?t.className=d:t.setAttribute("class",d),t.__className=n}else if(o&&i!==o)for(var g in o){var p=!!o[g];(i==null||p!==!!i[g])&&t.classList.toggle(g,p)}return o}function uo(t,e={},n,a){for(var i in n){var o=n[i];e[i]!==o&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,o,a))}}function In(t,e,n,a){var i=t.__style;if(i!==e){var o=dv(e,a);o==null?t.removeAttribute("style"):t.style.cssText=o,t.__style=e}else a&&(Array.isArray(a)?(uo(t,n==null?void 0:n[0],a[0]),uo(t,n==null?void 0:n[1],a[1],"important")):uo(t,n,a));return a}function Ru(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Yo(e))return _f();for(var a of t.options)a.selected=e.includes(Ms(a));return}for(a of t.options){var i=Ms(a);if(Ff(i,e)){a.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function fv(t){var e=new MutationObserver(()=>{Ru(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),vu(()=>{e.disconnect()})}function Mi(t,e,n=e){var a=new WeakSet,i=!0;fu(t,"change",o=>{var u=o?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(u),Ms);else{var g=t.querySelector(u)??t.querySelector("option:not([disabled])");d=g&&Ms(g)}n(d),rt!==null&&a.add(rt)}),hu(()=>{var o=e();if(t===document.activeElement){var u=wi??rt;if(a.has(u))return}if(Ru(t,o,i),i&&o===void 0){var d=t.querySelector(":checked");d!==null&&(o=Ms(d),n(o))}t.__value=o,i=!1}),fv(t)}function Ms(t){return"__value"in t?t.__value:t.value}const vv=Symbol("is custom element"),pv=Symbol("is html");function il(t,e,n,a){var i=hv(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[Qd]=n),n==null?t.removeAttribute(e):typeof n!="string"&&mv(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function hv(t){return t.__attributes??(t.__attributes={[vv]:t.nodeName.includes("-"),[pv]:t.namespaceURI===Gc})}var rc=new Map;function mv(t){var e=t.getAttribute("is")||t.nodeName,n=rc.get(e);if(n)return n;rc.set(e,n=[]);for(var a,i=t,o=Element.prototype;o!==i;){a=Kd(i);for(var u in a)a[u].set&&n.push(u);i=Nc(i)}return n}function Di(t,e,n=e){var a=new WeakSet;fu(t,"input",async i=>{var o=i?t.defaultValue:t.value;if(o=fo(t)?vo(o):o,n(o),rt!==null&&a.add(rt),await Au(),o!==(o=e())){var u=t.selectionStart,d=t.selectionEnd,g=t.value.length;if(t.value=o??"",d!==null){var p=t.value.length;u===d&&d===g&&p>g?(t.selectionStart=p,t.selectionEnd=p):(t.selectionStart=u,t.selectionEnd=Math.min(d,p))}}}),Hs(e)==null&&t.value&&(n(fo(t)?vo(t.value):t.value),rt!==null&&a.add(rt)),el(()=>{var i=e();if(t===document.activeElement){var o=wi??rt;if(a.has(o))return}fo(t)&&i===vo(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function fo(t){var e=t.type;return e==="number"||e==="range"}function vo(t){return t===""?null:+t}function ac(t,e){return t===e||(t==null?void 0:t[Ia])===e}function Ou(t={},e,n,a){return hu(()=>{var i,o;return el(()=>{i=o,o=[],Hs(()=>{t!==n(...o)&&(e(t,...o),i&&ac(n(...i),t)&&e(null,...i))})}),()=>{ia(()=>{o&&ac(n(...o),t)&&e(null,...o)})}}),t}let ci=!1;function gv(t){var e=ci;try{return ci=!1,[t(),ci]}finally{ci=e}}function Me(t,e,n,a){var Y;var i=(n&hf)!==0,o=(n&mf)!==0,u=a,d=!0,g=()=>(d&&(d=!1,u=o?Hs(a):a),u),p;if(i){var b=Ia in t||Yd in t;p=((Y=$a(t,e))==null?void 0:Y.set)??(b&&e in t?U=>t[e]=U:void 0)}var w,k=!1;i?[w,k]=gv(()=>t[e]):w=t[e],w===void 0&&a!==void 0&&(w=g(),p&&(rf(),p(w)));var x;if(x=()=>{var U=t[e];return U===void 0?g():(d=!0,U)},(n&pf)===0)return x;if(p){var I=t.$$legacy;return(function(U,C){return arguments.length>0?((!C||I||k)&&p(C?x():U),U):x()})}var B=!1,R=((n&vf)!==0?Oi:ru)(()=>(B=!1,x()));i&&v(R);var X=wt;return(function(U,C){if(arguments.length>0){const V=C?v(R):i?Gt(U):U;return A(R,V),B=!0,u!==void 0&&(u=V),U}return ca&&B||(X.f&Yr)!==0?R.v:v(R)})}function dn(t){Fn===null&&Xd(),ja(()=>{const e=Hs(t);if(typeof e=="function")return e})}const _v="5";var Lc;typeof window<"u"&&((Lc=window.__svelte??(window.__svelte={})).v??(Lc.v=new Set)).add(_v);const Pr=[{id:"onnx-community/Qwen3-0.6B-ONNX",name:"Qwen3 0.6B",size:"~400 MB",contextWindow:32768,maxEmailTokens:4e3,description:"Fastest, 32k context, best for quick answers"},{id:"onnx-community/Qwen3-1.7B-ONNX",name:"Qwen3 1.7B",size:"~1.1 GB",contextWindow:32768,maxEmailTokens:6e3,description:"Balanced speed and quality, 32k context"},{id:"onnx-community/Qwen3-4B-ONNX",name:"Qwen3 4B",size:"~2.6 GB",contextWindow:32768,maxEmailTokens:12e3,description:"Best reasoning, 32k context, recommended for email",recommendedForEmailProcessing:!0},{id:"onnx-community/Phi-3.5-mini-instruct-onnx-web",name:"Phi-3.5 Mini",size:"~2.5 GB",contextWindow:131072,maxEmailTokens:16e3,description:"128k context, WebGPU-optimized, best for very long emails",recommendedForEmailProcessing:!0},{id:"onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX",name:"DeepSeek R1 1.5B",size:"~1 GB",contextWindow:32768,maxEmailTokens:5e3,description:"Strong reasoning, CoT focused, 32k context"},{id:"onnx-community/Phi-4-mini-instruct-ONNX",name:"Phi-4 Mini",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Microsoft, good at reasoning, 16k context",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)"},{id:"onnx-community/Phi-4-mini-instruct-ONNX-GQA",name:"Phi-4 Mini GQA",size:"~2.5 GB",contextWindow:16384,maxEmailTokens:8e3,description:"Phi-4 with Grouped Query Attention, faster inference",requiresV4:!0,gpuWarning:"Requires good GPU (8GB+ VRAM recommended)",isExperimental:!0},{id:"onnx-community/gemma-3-270m-it-ONNX",name:"Gemma 3 270M",size:"~190 MB",contextWindow:8192,maxEmailTokens:2e3,description:"Smallest, ultra fast, 8k context, not for long emails"}];function ol(t){return Pr.find(e=>e.id===t)}const yv=Object.freeze(Object.defineProperty({__proto__:null,MODELS:Pr,getModelInfo:ol},Symbol.toStringTag,{value:"Module"})),hr=[{name:"qwen3:4b",displayName:"Qwen3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Latest Qwen, 128k context, enhanced reasoning",tags:["multilingual","reasoning","general"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:8b",displayName:"Qwen3 8B",params:"8B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful reasoning, 128k context, 100+ languages",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"qwen3:14b",displayName:"Qwen3 14B",params:"14B",contextWindow:131072,maxEmailTokens:1e5,description:"Most capable Qwen3, best for complex tasks",tags:["multilingual","reasoning","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:3b",displayName:"Ministral 3 3B",params:"3B",contextWindow:262144,maxEmailTokens:2e5,description:"Mistral's smallest, 256k context, Apache 2.0",tags:["fast","long-context","efficient"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:8b",displayName:"Ministral 3 8B",params:"8B",contextWindow:262144,maxEmailTokens:2e5,description:"Balanced performance, 256k context, vision capable",tags:["general","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"ministral-3:14b",displayName:"Ministral 3 14B",params:"14B",contextWindow:262144,maxEmailTokens:2e5,description:"Most capable Ministral, 256k context, function calling",tags:["advanced","long-context","vision"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gpt-oss:20b",displayName:"GPT-OSS 20B",params:"20B",contextWindow:131072,maxEmailTokens:1e5,description:"OpenAI's open model, strong reasoning, Apache 2.0",tags:["reasoning","cot","openai"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:4b",displayName:"Gemma3 4B",params:"4B",contextWindow:131072,maxEmailTokens:1e5,description:"Google, 128k context, multimodal (text + images)",tags:["multimodal","vision","multilingual"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3:12b",displayName:"Gemma3 12B",params:"12B",contextWindow:131072,maxEmailTokens:1e5,description:"Powerful multimodal, 128k context, 140+ languages",tags:["multimodal","vision","multilingual","advanced"],recommended:!0,recommendedForEmailProcessing:!0},{name:"gemma3n:e2b",displayName:"Gemma3N E2B",params:"2B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 2B, multimodal, MatFormer architecture",tags:["efficient","multimodal","fast"],recommendedForEmailProcessing:!1},{name:"gemma3n:e4b",displayName:"Gemma3N E4B",params:"4B effective",contextWindow:32768,maxEmailTokens:25e3,description:"Efficient 4B, multimodal, selective parameter activation",tags:["efficient","multimodal","balanced"],recommendedForEmailProcessing:!1},{name:"deepseek-r1:7b",displayName:"DeepSeek R1 7B",params:"7B",contextWindow:65536,maxEmailTokens:5e4,description:"Strong chain-of-thought reasoning, research-focused",tags:["reasoning","cot"],recommended:!0,recommendedForEmailProcessing:!0},{name:"deepseek-r1:14b",displayName:"DeepSeek R1 14B",params:"14B",contextWindow:65536,maxEmailTokens:5e4,description:"Advanced CoT reasoning, slower but thorough",tags:["reasoning","cot","advanced"],recommended:!0,recommendedForEmailProcessing:!0}];function Mu(){return hr.filter(t=>t.recommended)}function ll(t){return hr.find(e=>e.name===t||e.name.startsWith(t+":"))}const bv=Object.freeze(Object.defineProperty({__proto__:null,OLLAMA_MODELS:hr,getOllamaModelInfo:ll,getRecommendedOllamaModels:Mu},Symbol.toStringTag,{value:"Module"}));let En=null,Hr="idle",_i=null,_a=new Set;function ui(){return En||(En=new Worker(new URL("/me-ai/assets/worker-Svid4Xkn.js",import.meta.url),{type:"module"}),En.addEventListener("message",t=>{const e=t.data;e.status==="loading"&&(Hr="loading"),e.status==="ready"&&(Hr="ready"),e.status==="start"&&(Hr="generating"),(e.status==="complete"||e.status==="error")&&(Hr=_i?"ready":"idle");for(const n of _a)try{n(e)}catch{}})),En}function po(){return{check(){ui().postMessage({type:"check"})},loadModel(t){_i=t,Hr="loading",ui().postMessage({type:"load",modelId:t})},generate(t,e){ui().postMessage({type:"generate",data:t,options:e})},generateFull(t,e,n){return new Promise((a,i)=>{let o="",u=null,d=0,g=0;const p=w=>{switch(w.status){case"start":g=w.inputTokens||0;break;case"thinking":break;case"thinking-done":break;case"update":if(o+=w.output,u=w.tps??u,d=w.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":b(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":b(),i(new Error(w.data));break}},b=()=>{_a.delete(p)};_a.add(p),ui().postMessage({type:"generate",data:t,options:e})})},interrupt(){En==null||En.postMessage({type:"interrupt"})},reset(){En==null||En.postMessage({type:"reset"})},onMessage(t){return _a.add(t),()=>_a.delete(t)},offMessage(t){_a.delete(t)},get status(){return Hr},get isReady(){return Hr==="ready"},get isGenerating(){return Hr==="generating"},get modelId(){return _i},terminate(){En==null||En.terminate(),En=null,Hr="idle",_i=null,_a.clear()}}}const sc="http://localhost:11434";function Vs(){try{return localStorage.getItem("ollamaUrl")||sc}catch{return sc}}function wv(t){try{localStorage.setItem("ollamaUrl",t)}catch{}}async function Do(t=Vs()){try{const e=await fetch(`${t}/api/version`,{method:"GET",signal:AbortSignal.timeout(5e3)});return e.ok?{connected:!0,version:(await e.json()).version}:{connected:!1,error:`HTTP ${e.status}`}}catch(e){return{connected:!1,error:e.name==="TimeoutError"?"Connection timeout":e.message}}}async function kv(t=Vs()){const e=await fetch(`${t}/api/tags`,{method:"GET",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw new Error(`Failed to list models: HTTP ${e.status}`);return(await e.json()).models||[]}async function xv(t,e,{temperature:n=.7,maxTokens:a=4096,keepAlive:i}={},o=()=>{},u=Vs()){var I;const d={model:t,messages:e,stream:!0,options:{temperature:n,num_predict:a}};i!==void 0?d.keep_alive=i:d.keep_alive="10m";const g=new AbortController,p=setTimeout(()=>g.abort(),3e5),b=await fetch(`${u}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:g.signal});if(clearTimeout(p),!b.ok){const B=await b.text();throw new Error(`Ollama API error: ${B}`)}const w=b.body.getReader(),k=new TextDecoder;let x="";try{for(;;){const{done:B,value:R}=await w.read();if(B)break;const Y=k.decode(R).split(`
`).filter(Boolean);for(const U of Y)try{const C=JSON.parse(U);if((I=C.message)!=null&&I.content&&(x+=C.message.content,o({content:C.message.content,done:!1,total_duration:C.total_duration,eval_count:C.eval_count,eval_duration:C.eval_duration})),C.done){o({content:"",done:!0,total_duration:C.total_duration,eval_count:C.eval_count,eval_duration:C.eval_duration});break}}catch{}}}finally{w.releaseLock()}return x}let Dn="idle",Ja=null,ya=new Set;function ir(t){for(const e of ya)try{e(t)}catch{}}function Sv(){return{async check(){Dn="loading",ir({status:"loading",data:"Testing Ollama connection..."});const t=await Do();t.connected?(Dn="idle",ir({status:"ready",data:{type:"ollama",version:t.version,url:Vs()}})):(Dn="idle",ir({status:"error",data:`Ollama not available: ${t.error}. Make sure Ollama is running.`}))},async loadModel(t){Ja=t,Dn="loading",ir({status:"loading",data:`Connecting to Ollama model: ${t}...`});const e=await Do();if(!e.connected){Dn="idle",Ja=null,ir({status:"error",data:`Ollama not available: ${e.error}`});return}Dn="ready",ir({status:"ready"})},async generate(t,e={}){if(!Ja){ir({status:"error",data:"No Ollama model selected"});return}Dn="generating",ir({status:"start",inputTokens:0});let n=0,a=performance.now();try{await xv(Ja,t,{temperature:e.temperature??.7,maxTokens:e.maxTokens??4096},i=>{if(i.content){n++;const o=performance.now()-a,u=o>0?n/o*1e3:0;ir({status:"update",output:i.content,tps:Math.round(u*10)/10,numTokens:n})}i.done&&(Dn="ready",ir({status:"complete",tps:i.eval_duration?Math.round(i.eval_count/(i.eval_duration/1e9)*10)/10:null,numTokens:i.eval_count||n}))})}catch(i){Dn="ready",ir({status:"error",data:i.message})}},generateFull(t,e,n){return new Promise((a,i)=>{let o="",u=null,d=0,g=0;const p=w=>{switch(w.status){case"start":g=w.inputTokens||0;break;case"update":if(o+=w.output,u=w.tps??u,d=w.numTokens??d,n)try{n({tps:u,numTokens:d,text:o})}catch{}break;case"complete":b(),a({text:o,tps:u,numTokens:d,inputTokens:g});break;case"error":b(),i(new Error(w.data));break}},b=()=>{ya.delete(p)};ya.add(p),this.generate(t,e)})},interrupt(){console.warn("Ollama doesn't support generation interruption")},reset(){},onMessage(t){return ya.add(t),()=>ya.delete(t)},offMessage(t){ya.delete(t)},get status(){return Dn},get isReady(){return Dn==="ready"},get isGenerating(){return Dn==="generating"},get modelId(){return Ja},get backend(){return"ollama"},terminate(){Dn="idle",Ja=null,ya.clear()}}}let ga=null,nt=null,ho=new Set;function Tv(t){return t.startsWith("onnx-community/")||t.startsWith("microsoft/")?"webgpu":"ollama"}function Du(){return{loadModel(t){const e=Tv(t);if(ga!==e){nt&&nt.terminate(),ga=e,nt=e==="webgpu"?po():Sv();for(const n of ho)nt.onMessage(n)}nt.loadModel(t)},check(){nt||(nt=po(),ga="webgpu"),nt.check()},generate(t,e){if(!nt)throw new Error("No engine loaded. Call loadModel() first.");return nt.generate(t,e)},generateFull(t,e,n){return nt?nt.generateFull(t,e,n):Promise.reject(new Error("No engine loaded. Call loadModel() first."))},interrupt(){nt==null||nt.interrupt()},reset(){nt==null||nt.reset()},onMessage(t){return nt||(nt=po(),ga="webgpu"),ho.add(t),nt.onMessage(t)},offMessage(t){ho.delete(t),nt==null||nt.offMessage(t)},get status(){return(nt==null?void 0:nt.status)||"idle"},get isReady(){return(nt==null?void 0:nt.isReady)||!1},get isGenerating(){return(nt==null?void 0:nt.isGenerating)||!1},get modelId(){return(nt==null?void 0:nt.modelId)||null},get backend(){return ga},getModelInfo(){const t=this.modelId;return t?ga==="webgpu"?ol(t):ll(t):null},terminate(){nt==null||nt.terminate(),nt=null,ga=null}}}var Ev=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Av(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yi={exports:{}},Cv=yi.exports,ic;function Pv(){return ic||(ic=1,(function(t,e){((n,a)=>{t.exports=a()})(Cv,function(){var n=function(r,s){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(l,c){l.__proto__=c}:function(l,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(l[f]=c[f])}))(r,s)},a=function(){return(a=Object.assign||function(r){for(var s,l=1,c=arguments.length;l<c;l++)for(var f in s=arguments[l])Object.prototype.hasOwnProperty.call(s,f)&&(r[f]=s[f]);return r}).apply(this,arguments)};function i(r,s,l){for(var c,f=0,m=s.length;f<m;f++)!c&&f in s||((c=c||Array.prototype.slice.call(s,0,f))[f]=s[f]);return r.concat(c||Array.prototype.slice.call(s))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ev,u=Object.keys,d=Array.isArray;function g(r,s){return typeof s=="object"&&u(s).forEach(function(l){r[l]=s[l]}),r}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var p=Object.getPrototypeOf,b={}.hasOwnProperty;function w(r,s){return b.call(r,s)}function k(r,s){typeof s=="function"&&(s=s(p(r))),(typeof Reflect>"u"?u:Reflect.ownKeys)(s).forEach(function(l){I(r,l,s[l])})}var x=Object.defineProperty;function I(r,s,l,c){x(r,s,g(l&&w(l,"get")&&typeof l.get=="function"?{get:l.get,set:l.set,configurable:!0}:{value:l,configurable:!0,writable:!0},c))}function B(r){return{from:function(s){return r.prototype=Object.create(s.prototype),I(r.prototype,"constructor",r),{extend:k.bind(null,r.prototype)}}}}var R=Object.getOwnPropertyDescriptor,X=[].slice;function Y(r,s,l){return X.call(r,s,l)}function U(r,s){return s(r)}function C(r){if(!r)throw new Error("Assertion Failed")}function V(r){o.setImmediate?setImmediate(r):setTimeout(r,0)}function J(r,s){if(typeof s=="string"&&w(r,s))return r[s];if(!s)return r;if(typeof s!="string"){for(var l=[],c=0,f=s.length;c<f;++c){var m=J(r,s[c]);l.push(m)}return l}var y,S=s.indexOf(".");return S===-1||(y=r[s.substr(0,S)])==null?void 0:J(y,s.substr(S+1))}function F(r,s,l){if(r&&s!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof s!="string"&&"length"in s){C(typeof l!="string"&&"length"in l);for(var c=0,f=s.length;c<f;++c)F(r,s[c],l[c])}else{var m,y,S=s.indexOf(".");S!==-1?(m=s.substr(0,S),(S=s.substr(S+1))===""?l===void 0?d(r)&&!isNaN(parseInt(m))?r.splice(m,1):delete r[m]:r[m]=l:F(y=(y=r[m])&&w(r,m)?y:r[m]={},S,l)):l===void 0?d(r)&&!isNaN(parseInt(s))?r.splice(s,1):delete r[s]:r[s]=l}}function le(r){var s,l={};for(s in r)w(r,s)&&(l[s]=r[s]);return l}var xe=[].concat;function Ae(r){return xe.apply([],r)}var he="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ae([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(s){return s+r+"Array"})}))).filter(function(r){return o[r]}),ve=new Set(he.map(function(r){return o[r]})),te=null;function ce(r){return te=new WeakMap,r=(function s(l){if(!l||typeof l!="object")return l;var c=te.get(l);if(c)return c;if(d(l)){c=[],te.set(l,c);for(var f=0,m=l.length;f<m;++f)c.push(s(l[f]))}else if(ve.has(l.constructor))c=l;else{var y,S=p(l);for(y in c=S===Object.prototype?{}:Object.create(S),te.set(l,c),l)w(l,y)&&(c[y]=s(l[y]))}return c})(r),te=null,r}var we={}.toString;function re(r){return we.call(r).slice(8,-1)}var me=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Se=typeof me=="symbol"?function(r){var s;return r!=null&&(s=r[me])&&s.apply(r)}:function(){return null};function ie(r,s){s=r.indexOf(s),0<=s&&r.splice(s,1)}var pe={};function se(r){var s,l,c,f;if(arguments.length===1){if(d(r))return r.slice();if(this===pe&&typeof r=="string")return[r];if(f=Se(r))for(l=[];!(c=f.next()).done;)l.push(c.value);else{if(r==null)return[r];if(typeof(s=r.length)!="number")return[r];for(l=new Array(s);s--;)l[s]=r[s]}}else for(s=arguments.length,l=new Array(s);s--;)l[s]=arguments[s];return l}var ne=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},he=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Mt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(he),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $(r,s){this.name=r,this.message=s}function fe(r,s){return r+". Errors: "+Object.keys(s).map(function(l){return s[l].toString()}).filter(function(l,c,f){return f.indexOf(l)===c}).join(`
`)}function ue(r,s,l,c){this.failures=s,this.failedKeys=c,this.successCount=l,this.message=fe(r,s)}function ke(r,s){this.name="BulkError",this.failures=Object.keys(s).map(function(l){return s[l]}),this.failuresByPos=s,this.message=fe(r,this.failures)}B($).from(Error).extend({toString:function(){return this.name+": "+this.message}}),B(ue).from($),B(ke).from($);var Ke=Mt.reduce(function(r,s){return r[s]=s+"Error",r},{}),Ve=$,z=Mt.reduce(function(r,s){var l=s+"Error";function c(f,m){this.name=l,f?typeof f=="string"?(this.message="".concat(f).concat(m?`
 `+m:""),this.inner=m||null):typeof f=="object"&&(this.message="".concat(f.name," ").concat(f.message),this.inner=f):(this.message=H[s]||l,this.inner=null)}return B(c).from(Ve),r[s]=c,r},{}),Re=(z.Syntax=SyntaxError,z.Type=TypeError,z.Range=RangeError,he.reduce(function(r,s){return r[s+"Error"]=z[s],r},{}));he=Mt.reduce(function(r,s){return["Syntax","Type","Range"].indexOf(s)===-1&&(r[s+"Error"]=z[s]),r},{});function De(){}function Be(r){return r}function Tt(r,s){return r==null||r===Be?s:function(l){return s(r(l))}}function kt(r,s){return function(){r.apply(this,arguments),s.apply(this,arguments)}}function Xt(r,s){return r===De?s:function(){var l=r.apply(this,arguments),c=(l!==void 0&&(arguments[0]=l),this.onsuccess),f=this.onerror,m=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return c&&(this.onsuccess=this.onsuccess?kt(c,this.onsuccess):c),f&&(this.onerror=this.onerror?kt(f,this.onerror):f),m!==void 0?m:l}}function fn(r,s){return r===De?s:function(){r.apply(this,arguments);var l=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,s.apply(this,arguments),l&&(this.onsuccess=this.onsuccess?kt(l,this.onsuccess):l),c&&(this.onerror=this.onerror?kt(c,this.onerror):c)}}function Zt(r,s){return r===De?s:function(f){var c=r.apply(this,arguments),f=(g(f,c),this.onsuccess),m=this.onerror,y=(this.onsuccess=null,this.onerror=null,s.apply(this,arguments));return f&&(this.onsuccess=this.onsuccess?kt(f,this.onsuccess):f),m&&(this.onerror=this.onerror?kt(m,this.onerror):m),c===void 0?y===void 0?void 0:y:g(c,y)}}function Lt(r,s){return r===De?s:function(){return s.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Ye(r,s){return r===De?s:function(){var l=r.apply(this,arguments);if(l&&typeof l.then=="function"){for(var c=this,f=arguments.length,m=new Array(f);f--;)m[f]=arguments[f];return l.then(function(){return s.apply(c,m)})}return s.apply(this,arguments)}}he.ModifyError=ue,he.DexieError=$,he.BulkError=ke;var et=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ft(r){et=r}var Jt={},mn=100,Rn=typeof Promise>"u"?[]:(Mt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Rn=crypto.subtle.digest("SHA-512",new Uint8Array([0])),p(Rn),Mt]:[Mt,p(Mt),Mt]),Mt=Rn[0],Xa=Rn[1],Xa=Xa&&Xa.then,Ht=Mt&&Mt.constructor,Or=!!Rn[2],_r=function(r,s){Gn.push([r,s]),tr&&(queueMicrotask(wr),tr=!1)},Mr=!0,tr=!0,Kn=[],Un=[],yr=Be,Vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:De,pgp:!1,env:{},finalize:De},qe=Vt,Gn=[],kn=0,Dr=[];function Ie(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var s=this._PSD=qe;if(typeof r!="function"){if(r!==Jt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&nr(this,this._value)}else this._state=null,this._value=null,++s.ref,(function l(c,f){try{f(function(m){if(c._state===null){if(m===c)throw new TypeError("A promise cannot be resolved with itself.");var y=c._lib&&rr();m&&typeof m.then=="function"?l(c,function(S,D){m instanceof Ie?m._then(S,D):m.then(S,D)}):(c._state=!0,c._value=m,Ka(c)),y&&ar()}},nr.bind(null,c))}catch(m){nr(c,m)}})(this,r)}var br={get:function(){var r=qe,s=vt;function l(c,f){var m=this,y=!r.global&&(r!==qe||s!==vt),S=y&&!Et(),D=new Ie(function(W,j){da(m,new za(E(c,r,y,S),E(f,r,y,S),W,j,r))});return this._consoleTask&&(D._consoleTask=this._consoleTask),D}return l.prototype=Jt,l},set:function(r){I(this,"then",r&&r.prototype===Jt?br:{get:function(){return r},set:br.set})}};function za(r,s,l,c,f){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof s=="function"?s:null,this.resolve=l,this.reject=c,this.psd=f}function nr(r,s){var l,c;Un.push(s),r._state===null&&(l=r._lib&&rr(),s=yr(s),r._state=!1,r._value=s,c=r,Kn.some(function(f){return f._value===c._value})||Kn.push(c),Ka(r),l)&&ar()}function Ka(r){var s=r._listeners;r._listeners=[];for(var l=0,c=s.length;l<c;++l)da(r,s[l]);var f=r._PSD;--f.ref||f.finalize(),kn===0&&(++kn,_r(function(){--kn==0&&jr()},[]))}function da(r,s){if(r._state===null)r._listeners.push(s);else{var l=r._state?s.onFulfilled:s.onRejected;if(l===null)return(r._state?s.resolve:s.reject)(r._value);++s.psd.ref,++kn,_r(Dt,[l,r,s])}}function Dt(r,s,l){try{var c,f=s._value;!s._state&&Un.length&&(Un=[]),c=et&&s._consoleTask?s._consoleTask.run(function(){return r(f)}):r(f),s._state||Un.indexOf(f)!==-1||(m=>{for(var y=Kn.length;y;)if(Kn[--y]._value===m._value)return Kn.splice(y,1)})(s),l.resolve(c)}catch(m){l.reject(m)}finally{--kn==0&&jr(),--l.psd.ref||l.psd.finalize()}}function wr(){Te(Vt,function(){rr()&&ar()})}function rr(){var r=Mr;return tr=Mr=!1,r}function ar(){var r,s,l;do for(;0<Gn.length;)for(r=Gn,Gn=[],l=r.length,s=0;s<l;++s){var c=r[s];c[0].apply(null,c[1])}while(0<Gn.length);tr=Mr=!0}function jr(){for(var r=Kn,s=(Kn=[],r.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)}),Dr.slice(0)),l=s.length;l;)s[--l]()}function Lr(r){return new Ie(Jt,!1,r)}function xt(r,s){var l=qe;return function(){var c=rr(),f=qe;try{return dt(l,!0),r.apply(this,arguments)}catch(m){s&&s(m)}finally{dt(f,!1),c&&ar()}}}k(Ie.prototype,{then:br,_then:function(r,s){da(this,new za(null,null,r,s,qe))},catch:function(r){var s,l;return arguments.length===1?this.then(null,r):(s=r,l=arguments[1],typeof s=="function"?this.then(null,function(c){return(c instanceof s?l:Lr)(c)}):this.then(null,function(c){return(c&&c.name===s?l:Lr)(c)}))},finally:function(r){return this.then(function(s){return Ie.resolve(r()).then(function(){return s})},function(s){return Ie.resolve(r()).then(function(){return Lr(s)})})},timeout:function(r,s){var l=this;return r<1/0?new Ie(function(c,f){var m=setTimeout(function(){return f(new z.Timeout(s))},r);l.then(c,f).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&I(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),Vt.env=Rt(),k(Ie,{all:function(){var r=se.apply(null,arguments).map(qt);return new Ie(function(s,l){r.length===0&&s([]);var c=r.length;r.forEach(function(f,m){return Ie.resolve(f).then(function(y){r[m]=y,--c||s(r)},l)})})},resolve:function(r){return r instanceof Ie?r:r&&typeof r.then=="function"?new Ie(function(s,l){r.then(s,l)}):new Ie(Jt,!0,r)},reject:Lr,race:function(){var r=se.apply(null,arguments).map(qt);return new Ie(function(s,l){r.map(function(c){return Ie.resolve(c).then(s,l)})})},PSD:{get:function(){return qe},set:function(r){return qe=r}},totalEchoes:{get:function(){return vt}},newPSD:ze,usePSD:Te,scheduler:{get:function(){return _r},set:function(r){_r=r}},rejectionMapper:{get:function(){return yr},set:function(r){yr=r}},follow:function(r,s){return new Ie(function(l,c){return ze(function(f,m){var y=qe;y.unhandleds=[],y.onunhandled=m,y.finalize=kt(function(){var S,D=this;S=function(){D.unhandleds.length===0?f():m(D.unhandleds[0])},Dr.push(function W(){S(),Dr.splice(Dr.indexOf(W),1)}),++kn,_r(function(){--kn==0&&jr()},[])},y.finalize),r()},s,l,c)})}}),Ht&&(Ht.allSettled&&I(Ie,"allSettled",function(){var r=se.apply(null,arguments).map(qt);return new Ie(function(s){r.length===0&&s([]);var l=r.length,c=new Array(l);r.forEach(function(f,m){return Ie.resolve(f).then(function(y){return c[m]={status:"fulfilled",value:y}},function(y){return c[m]={status:"rejected",reason:y}}).then(function(){return--l||s(c)})})})}),Ht.any&&typeof AggregateError<"u"&&I(Ie,"any",function(){var r=se.apply(null,arguments).map(qt);return new Ie(function(s,l){r.length===0&&l(new AggregateError([]));var c=r.length,f=new Array(c);r.forEach(function(m,y){return Ie.resolve(m).then(function(S){return s(S)},function(S){f[y]=S,--c||l(new AggregateError(f))})})})}),Ht.withResolvers)&&(Ie.withResolvers=Ht.withResolvers);var Nt={awaits:0,echoes:0,id:0},xn=0,je=[],Ue=0,vt=0,St=0;function ze(r,y,l,c){var f=qe,m=Object.create(f),y=(m.parent=f,m.ref=0,m.global=!1,m.id=++St,Vt.env,m.env=Or?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject}:{},y&&g(m,y),++f.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()},Te(m,r,l,c));return m.ref===0&&m.finalize(),y}function Ze(){return Nt.id||(Nt.id=++xn),++Nt.awaits,Nt.echoes+=mn,Nt.id}function Et(){return!!Nt.awaits&&(--Nt.awaits==0&&(Nt.id=0),Nt.echoes=Nt.awaits*mn,!0)}function qt(r){return Nt.echoes&&r&&r.constructor===Ht?(Ze(),r.then(function(s){return Et(),s},function(s){return Et(),_e(s)})):r}function at(){var r=je[je.length-1];je.pop(),dt(r,!1)}function dt(r,s){var l,c,f=qe;(s?!Nt.echoes||Ue++&&r===qe:!Ue||--Ue&&r===qe)||queueMicrotask(s?(function(m){++vt,Nt.echoes&&--Nt.echoes!=0||(Nt.echoes=Nt.awaits=Nt.id=0),je.push(qe),dt(m,!0)}).bind(null,r):at),r!==qe&&(qe=r,f===Vt&&(Vt.env=Rt()),Or)&&(l=Vt.env.Promise,c=r.env,f.global||r.global)&&(Object.defineProperty(o,"Promise",c.PromiseProp),l.all=c.all,l.race=c.race,l.resolve=c.resolve,l.reject=c.reject,c.allSettled&&(l.allSettled=c.allSettled),c.any)&&(l.any=c.any)}function Rt(){var r=o.Promise;return Or?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function Te(r,s,l,c,f){var m=qe;try{return dt(r,!0),s(l,c,f)}finally{dt(m,!1)}}function E(r,s,l,c){return typeof r!="function"?r:function(){var f=qe;l&&Ze(),dt(s,!0);try{return r.apply(this,arguments)}finally{dt(f,!1),c&&queueMicrotask(Et)}}}function ge(r){Promise===Ht&&Nt.echoes===0?Ue===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+Xa).indexOf("[native code]")===-1&&(Ze=Et=De);var _e=Ie.reject,Xe="ï¿¿",lt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",At="String expected.",Ot=[],en="__dbnames",Sn="readonly",sr="readwrite";function Je(r,s){return r?s?function(){return r.apply(this,arguments)&&s.apply(this,arguments)}:r:s}var zt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tn(r){return typeof r!="string"||/\./.test(r)?function(s){return s}:function(s){return s[r]===void 0&&r in s&&delete(s=ce(s))[r],s}}function Wn(){throw z.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function tt(r,s){try{var l=Ua(r),c=Ua(s);if(l!==c)return l==="Array"?1:c==="Array"?-1:l==="binary"?1:c==="binary"?-1:l==="string"?1:c==="string"?-1:l==="Date"?1:c!=="Date"?NaN:-1;switch(l){case"number":case"Date":case"string":return s<r?1:r<s?-1:0;case"binary":for(var f=fa(r),m=fa(s),y=f.length,S=m.length,D=y<S?y:S,W=0;W<D;++W)if(f[W]!==m[W])return f[W]<m[W]?-1:1;return y===S?0:y<S?-1:1;case"Array":for(var j=r,P=s,N=j.length,q=P.length,L=N<q?N:q,O=0;O<L;++O){var Q=tt(j[O],P[O]);if(Q!==0)return Q}return N===q?0:N<q?-1:1}}catch{}return NaN}function Ua(r){var s=typeof r;return s=="object"&&(ArrayBuffer.isView(r)||(s=re(r))==="ArrayBuffer")?"binary":s}function fa(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}function Nr(r,s,l){var c=r.schema.yProps;return c?(s&&0<l.numFailures&&(s=s.filter(function(f,m){return!l.failures[m]})),Promise.all(c.map(function(f){return f=f.updatesTable,s?r.db.table(f).where("k").anyOf(s).delete():r.db.table(f).clear()})).then(function(){return l})):l}Ga.prototype.execute=function(r){var s=this["@@propmod"];if(s.add!==void 0){var l=s.add;if(d(l))return i(i([],d(r)?r:[],!0),l).sort();if(typeof l=="number")return(Number(r)||0)+l;if(typeof l=="bigint")try{return BigInt(r)+l}catch{return BigInt(0)+l}throw new TypeError("Invalid term ".concat(l))}if(s.remove!==void 0){var c=s.remove;if(d(c))return d(r)?r.filter(function(f){return!c.includes(f)}).sort():[];if(typeof c=="number")return Number(r)-c;if(typeof c=="bigint")try{return BigInt(r)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return l=(l=s.replacePrefix)==null?void 0:l[0],l&&typeof r=="string"&&r.startsWith(l)?s.replacePrefix[1]+r.substring(l.length):r};var qr=Ga;function Ga(r){this["@@propmod"]=r}function Wa(r,s){for(var l=u(s),c=l.length,f=!1,m=0;m<c;++m){var y=l[m],S=s[y],D=J(r,y);S instanceof qr?(F(r,y,S.execute(D)),f=!0):D!==S&&(F(r,y,S),f=!0)}return f}Qe.prototype._trans=function(r,s,l){var c=this._tx||qe.trans,f=this.name,m=et&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function y(W,j,P){if(P.schema[f])return s(P.idbtrans,P);throw new z.NotFound("Table "+f+" not part of transaction")}var S=rr();try{var D=c&&c.db._novip===this.db._novip?c===qe.trans?c._promise(r,y,l):ze(function(){return c._promise(r,y,l)},{trans:c,transless:qe.transless||qe}):(function W(j,P,N,q){if(j.idbdb&&(j._state.openComplete||qe.letThrough||j._vip)){var L=j._createTransaction(P,N,j._dbSchema);try{L.create(),j._state.PR1398_maxLoop=3}catch(O){return O.name===Ke.InvalidState&&j.isOpen()&&0<--j._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),j.close({disableAutoOpen:!1}),j.open().then(function(){return W(j,P,N,q)})):_e(O)}return L._promise(P,function(O,Q){return ze(function(){return qe.trans=L,q(O,Q,L)})}).then(function(O){if(P==="readwrite")try{L.idbtrans.commit()}catch{}return P==="readonly"?O:L._completion.then(function(){return O})})}if(j._state.openComplete)return _e(new z.DatabaseClosed(j._state.dbOpenError));if(!j._state.isBeingOpened){if(!j._state.autoOpen)return _e(new z.DatabaseClosed);j.open().catch(De)}return j._state.dbReadyPromise.then(function(){return W(j,P,N,q)})})(this.db,r,[this.name],y);return m&&(D._consoleTask=m,D=D.catch(function(W){return console.trace(W),_e(W)})),D}finally{S&&ar()}},Qe.prototype.get=function(r,s){var l=this;return r&&r.constructor===Object?this.where(r).first(s):r==null?_e(new z.Type("Invalid argument to Table.get()")):this._trans("readonly",function(c){return l.core.get({trans:c,key:r}).then(function(f){return l.hook.reading.fire(f)})}).then(s)},Qe.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(d(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var s=u(r);if(s.length===1)return this.where(s[0]).equals(r[s[0]]);var l=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&s.every(function(W){return 0<=S.keyPath.indexOf(W)})){for(var D=0;D<s.length;++D)if(s.indexOf(S.keyPath[D])===-1)return!1;return!0}return!1}).sort(function(S,D){return S.keyPath.length-D.keyPath.length})[0];if(l&&this.db._maxKey!==Xe)return y=l.keyPath.slice(0,s.length),this.where(y).equals(y.map(function(S){return r[S]}));!l&&et&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(s.join("+"),"]"));var c=this.schema.idxByName;function f(S,D){return tt(S,D)===0}var y=s.reduce(function(j,D){var W=j[0],j=j[1],P=c[D],N=r[D];return[W||P,W||!P?Je(j,P&&P.multi?function(q){return q=J(q,D),d(q)&&q.some(function(L){return f(N,L)})}:function(q){return f(N,J(q,D))}):j]},[null,null]),m=y[0],y=y[1];return m?this.where(m.name).equals(r[m.keyPath]).filter(y):l?this.filter(y):this.where(s).equals("")},Qe.prototype.filter=function(r){return this.toCollection().and(r)},Qe.prototype.count=function(r){return this.toCollection().count(r)},Qe.prototype.offset=function(r){return this.toCollection().offset(r)},Qe.prototype.limit=function(r){return this.toCollection().limit(r)},Qe.prototype.each=function(r){return this.toCollection().each(r)},Qe.prototype.toArray=function(r){return this.toCollection().toArray(r)},Qe.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Qe.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,d(r)?"[".concat(r.join("+"),"]"):r))},Qe.prototype.reverse=function(){return this.toCollection().reverse()},Qe.prototype.mapToClass=function(r){for(var s=this.db,l=this.name,c=((this.schema.mappedClass=r).prototype instanceof Wn&&(r=(y=>{var S=j,D=y;if(typeof D!="function"&&D!==null)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function W(){this.constructor=S}function j(){return y!==null&&y.apply(this,arguments)||this}return n(S,D),S.prototype=D===null?Object.create(D):(W.prototype=D.prototype,new W),Object.defineProperty(j.prototype,"db",{get:function(){return s},enumerable:!1,configurable:!0}),j.prototype.table=function(){return l},j})(r)),new Set),f=r.prototype;f;f=p(f))Object.getOwnPropertyNames(f).forEach(function(y){return c.add(y)});function m(y){if(!y)return y;var S,D=Object.create(r.prototype);for(S in y)if(!c.has(S))try{D[S]=y[S]}catch{}return D}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=m,this.hook("reading",m),r},Qe.prototype.defineClass=function(){return this.mapToClass(function(r){g(this,r)})},Qe.prototype.add=function(r,s){var l=this,c=this.schema.primKey,f=c.auto,m=c.keyPath,y=r;return m&&f&&(y=tn(m)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"add",keys:s!=null?[s]:null,values:[y]})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(m)try{F(r,m,S)}catch{}return S})},Qe.prototype.upsert=function(r,s){var l=this,c=this.schema.primKey.keyPath;return this._trans("readwrite",function(f){return l.core.get({trans:f,key:r}).then(function(m){var y=m??{};return Wa(y,s),c&&F(y,c,r),l.core.mutate({trans:f,type:"put",values:[y],keys:[r],upsert:!0,updates:{keys:[r],changeSpecs:[s]}}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):!!m})})})},Qe.prototype.update=function(r,s){return typeof r!="object"||d(r)?this.where(":id").equals(r).modify(s):(r=J(r,this.schema.primKey.keyPath))===void 0?_e(new z.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(s)},Qe.prototype.put=function(r,s){var l=this,c=this.schema.primKey,f=c.auto,m=c.keyPath,y=r;return m&&f&&(y=tn(m)(r)),this._trans("readwrite",function(S){return l.core.mutate({trans:S,type:"put",values:[y],keys:s!=null?[s]:null})}).then(function(S){return S.numFailures?Ie.reject(S.failures[0]):S.lastResult}).then(function(S){if(m)try{F(r,m,S)}catch{}return S})},Qe.prototype.delete=function(r){var s=this;return this._trans("readwrite",function(l){return s.core.mutate({trans:l,type:"delete",keys:[r]}).then(function(c){return Nr(s,[r],c)}).then(function(c){return c.numFailures?Ie.reject(c.failures[0]):void 0})})},Qe.prototype.clear=function(){var r=this;return this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"deleteRange",range:zt}).then(function(l){return Nr(r,null,l)})}).then(function(s){return s.numFailures?Ie.reject(s.failures[0]):void 0})},Qe.prototype.bulkGet=function(r){var s=this;return this._trans("readonly",function(l){return s.core.getMany({keys:r,trans:l}).then(function(c){return c.map(function(f){return s.hook.reading.fire(f)})})})},Qe.prototype.bulkAdd=function(r,s,l){var c=this,f=Array.isArray(s)?s:void 0,m=(l=l||(f?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(y){var S=c.schema.primKey,W=S.auto,S=S.keyPath;if(S&&f)throw new z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(f&&f.length!==r.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var D=r.length,W=S&&W?r.map(tn(S)):r;return c.core.mutate({trans:y,type:"add",keys:f,values:W,wantResults:m}).then(function(j){var P=j.numFailures,N=j.failures;if(P===0)return m?j.results:j.lastResult;throw new ke("".concat(c.name,".bulkAdd(): ").concat(P," of ").concat(D," operations failed"),N)})})},Qe.prototype.bulkPut=function(r,s,l){var c=this,f=Array.isArray(s)?s:void 0,m=(l=l||(f?void 0:s))?l.allKeys:void 0;return this._trans("readwrite",function(y){var S=c.schema.primKey,W=S.auto,S=S.keyPath;if(S&&f)throw new z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(f&&f.length!==r.length)throw new z.InvalidArgument("Arguments objects and keys must have the same length");var D=r.length,W=S&&W?r.map(tn(S)):r;return c.core.mutate({trans:y,type:"put",keys:f,values:W,wantResults:m}).then(function(j){var P=j.numFailures,N=j.failures;if(P===0)return m?j.results:j.lastResult;throw new ke("".concat(c.name,".bulkPut(): ").concat(P," of ").concat(D," operations failed"),N)})})},Qe.prototype.bulkUpdate=function(r){var s=this,l=this.core,c=r.map(function(y){return y.key}),f=r.map(function(y){return y.changes}),m=[];return this._trans("readwrite",function(y){return l.getMany({trans:y,keys:c,cache:"clone"}).then(function(S){var D=[],W=[],j=(r.forEach(function(P,N){var q=P.key,L=P.changes,O=S[N];if(O){for(var Q=0,Z=Object.keys(L);Q<Z.length;Q++){var G=Z[Q],de=L[G];if(G===s.schema.primKey.keyPath){if(tt(de,q)!==0)throw new z.Constraint("Cannot update primary key in bulkUpdate()")}else F(O,G,de)}m.push(N),D.push(q),W.push(O)}}),D.length);return l.mutate({trans:y,type:"put",keys:D,values:W,updates:{keys:c,changeSpecs:f}}).then(function(P){var N=P.numFailures,q=P.failures;if(N===0)return j;for(var L=0,O=Object.keys(q);L<O.length;L++){var Q,Z=O[L],G=m[Number(Z)];G!=null&&(Q=q[Z],delete q[Z],q[G]=Q)}throw new ke("".concat(s.name,".bulkUpdate(): ").concat(N," of ").concat(j," operations failed"),q)})})})},Qe.prototype.bulkDelete=function(r){var s=this,l=r.length;return this._trans("readwrite",function(c){return s.core.mutate({trans:c,type:"delete",keys:r}).then(function(f){return Nr(s,r,f)})}).then(function(c){var f=c.numFailures,m=c.failures;if(f===0)return c.lastResult;throw new ke("".concat(s.name,".bulkDelete(): ").concat(f," of ").concat(l," operations failed"),m)})};var Ha=Qe;function Qe(){}function We(r){function s(y,S){if(S){for(var D=arguments.length,W=new Array(D-1);--D;)W[D-1]=arguments[D];return l[y].subscribe.apply(null,W),r}if(typeof y=="string")return l[y]}var l={};s.addEventType=m;for(var c=1,f=arguments.length;c<f;++c)m(arguments[c]);return s;function m(y,S,D){var W,j;if(typeof y!="object")return S=S||Lt,j={subscribers:[],fire:D=D||De,subscribe:function(P){j.subscribers.indexOf(P)===-1&&(j.subscribers.push(P),j.fire=S(j.fire,P))},unsubscribe:function(P){j.subscribers=j.subscribers.filter(function(N){return N!==P}),j.fire=j.subscribers.reduce(S,D)}},l[y]=s[y]=j;u(W=y).forEach(function(P){var N=W[P];if(d(N))m(P,W[P][0],W[P][1]);else{if(N!=="asap")throw new z.InvalidArgument("Invalid event config");var q=m(P,Be,function(){for(var L=arguments.length,O=new Array(L);L--;)O[L]=arguments[L];q.subscribers.forEach(function(Q){V(function(){Q.apply(null,O)})})})}})}}function pt(r,s){return B(s).from({prototype:r}),s}function Yt(r,s){return!(r.filter||r.algorithm||r.or)&&(s?r.justLimit:!r.replayFilter)}function $t(r,s){r.filter=Je(r.filter,s)}function On(r,s,l){var c=r.replayFilter;r.replayFilter=c?function(){return Je(c(),s())}:s,r.justLimit=l&&!c}function Br(r,s){if(r.isPrimKey)return s.primaryKey;var l=s.getIndexByKeyPath(r.index);if(l)return l;throw new z.Schema("KeyPath "+r.index+" on object store "+s.name+" is not indexed")}function Va(r,s,l){var c=Br(r,s.schema);return s.openCursor({trans:l,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:c,range:r.range}})}function Fr(r,s,l,c){var f,m,y=r.replayFilter?Je(r.filter,r.replayFilter()):r.filter;return r.or?(f={},m=function(S,D,W){var j,P;y&&!y(D,W,function(N){return D.stop(N)},function(N){return D.fail(N)})||((P=""+(j=D.primaryKey))=="[object ArrayBuffer]"&&(P=""+new Uint8Array(j)),w(f,P))||(f[P]=!0,s(S,D,W))},Promise.all([r.or._iterate(m,l),va(Va(r,c,l),r.algorithm,m,!r.keysOnly&&r.valueMapper)])):va(Va(r,c,l),Je(r.algorithm,y),s,!r.keysOnly&&r.valueMapper)}function va(r,s,l,c){var f=xt(c?function(m,y,S){return l(c(m),y,S)}:l);return r.then(function(m){if(m)return m.start(function(){var y=function(){return m.continue()};s&&!s(m,function(S){return y=S},function(S){m.stop(S),y=De},function(S){m.fail(S),y=De})||f(m.value,m,function(S){return y=S}),y()})})}mt.prototype._read=function(r,s){var l=this._ctx;return l.error?l.table._trans(null,_e.bind(null,l.error)):l.table._trans("readonly",r).then(s)},mt.prototype._write=function(r){var s=this._ctx;return s.error?s.table._trans(null,_e.bind(null,s.error)):s.table._trans("readwrite",r,"locked")},mt.prototype._addAlgorithm=function(r){var s=this._ctx;s.algorithm=Je(s.algorithm,r)},mt.prototype._iterate=function(r,s){return Fr(this._ctx,r,s,this._ctx.table.core)},mt.prototype.clone=function(r){var s=Object.create(this.constructor.prototype),l=Object.create(this._ctx);return r&&g(l,r),s._ctx=l,s},mt.prototype.raw=function(){return this._ctx.valueMapper=null,this},mt.prototype.each=function(r){var s=this._ctx;return this._read(function(l){return Fr(s,r,l,s.table.core)})},mt.prototype.count=function(r){var s=this;return this._read(function(l){var c,f=s._ctx,m=f.table.core;return Yt(f,!0)?m.count({trans:l,query:{index:Br(f,m.schema),range:f.range}}).then(function(y){return Math.min(y,f.limit)}):(c=0,Fr(f,function(){return++c,!1},l,m).then(function(){return c}))}).then(r)},mt.prototype.sortBy=function(r,s){var l=r.split(".").reverse(),c=l[0],f=l.length-1;function m(D,W){return W?m(D[l[W]],W-1):D[c]}var y=this._ctx.dir==="next"?1:-1;function S(D,W){return tt(m(D,f),m(W,f))*y}return this.toArray(function(D){return D.sort(S)}).then(s)},mt.prototype.toArray=function(r){var s=this;return this._read(function(l){var c,f,m,y=s._ctx;return y.dir==="next"&&Yt(y,!0)&&0<y.limit?(c=y.valueMapper,f=Br(y,y.table.core.schema),y.table.core.query({trans:l,limit:y.limit,values:!0,query:{index:f,range:y.range}}).then(function(S){return S=S.result,c?S.map(c):S})):(m=[],Fr(y,function(S){return m.push(S)},l,y.table.core).then(function(){return m}))},r)},mt.prototype.offset=function(r){var s=this._ctx;return r<=0||(s.offset+=r,Yt(s)?On(s,function(){var l=r;return function(c,f){return l===0||(l===1?--l:f(function(){c.advance(l),l=0}),!1)}}):On(s,function(){var l=r;return function(){return--l<0}})),this},mt.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),On(this._ctx,function(){var s=r;return function(l,c,f){return--s<=0&&c(f),0<=s}},!0),this},mt.prototype.until=function(r,s){return $t(this._ctx,function(l,c,f){return!r(l.value)||(c(f),s)}),this},mt.prototype.first=function(r){return this.limit(1).toArray(function(s){return s[0]}).then(r)},mt.prototype.last=function(r){return this.reverse().first(r)},mt.prototype.filter=function(r){var s;return $t(this._ctx,function(l){return r(l.value)}),(s=this._ctx).isMatch=Je(s.isMatch,r),this},mt.prototype.and=function(r){return this.filter(r)},mt.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},mt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},mt.prototype.desc=function(){return this.reverse()},mt.prototype.eachKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,c){r(c.key,c)})},mt.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},mt.prototype.eachPrimaryKey=function(r){var s=this._ctx;return s.keysOnly=!s.isMatch,this.each(function(l,c){r(c.primaryKey,c)})},mt.prototype.keys=function(r){var s=this._ctx,l=(s.keysOnly=!s.isMatch,[]);return this.each(function(c,f){l.push(f.key)}).then(function(){return l}).then(r)},mt.prototype.primaryKeys=function(r){var s=this._ctx;if(s.dir==="next"&&Yt(s,!0)&&0<s.limit)return this._read(function(c){var f=Br(s,s.table.core.schema);return s.table.core.query({trans:c,values:!1,limit:s.limit,query:{index:f,range:s.range}})}).then(function(c){return c.result}).then(r);s.keysOnly=!s.isMatch;var l=[];return this.each(function(c,f){l.push(f.primaryKey)}).then(function(){return l}).then(r)},mt.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},mt.prototype.firstKey=function(r){return this.limit(1).keys(function(s){return s[0]}).then(r)},mt.prototype.lastKey=function(r){return this.reverse().firstKey(r)},mt.prototype.distinct=function(){var r,s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];return s&&s.multi&&(r={},$t(this._ctx,function(c){var c=c.primaryKey.toString(),f=w(r,c);return r[c]=!0,!f})),this},mt.prototype.modify=function(r){var s=this,l=this._ctx;return this._write(function(c){function f(O,Q){var Z=Q.failures;N+=O-Q.numFailures;for(var G=0,de=u(Z);G<de.length;G++){var ye=de[G];P.push(Z[ye])}}var m=typeof r=="function"?r:function(O){return Wa(O,r)},y=l.table.core,j=y.schema.primaryKey,S=j.outbound,D=j.extractKey,W=200,j=s.db._options.modifyChunkSize,P=(j&&(W=typeof j=="object"?j[y.name]||j["*"]||200:j),[]),N=0,q=[],L=r===Sl;return s.clone().primaryKeys().then(function(O){function Q(G){var de=Math.min(W,O.length-G),ye=O.slice(G,G+de);return(L?Promise.resolve([]):y.getMany({trans:c,keys:ye,cache:"immutable"})).then(function(Ce){var Pe=[],be=[],Ne=S?[]:null,Le=L?ye:[];if(!L)for(var Ee=0;Ee<de;++Ee){var Fe=Ce[Ee],gt={value:ce(Fe),primKey:O[G+Ee]};m.call(gt,gt.value,gt)!==!1&&(gt.value==null?Le.push(O[G+Ee]):S||tt(D(Fe),D(gt.value))===0?(be.push(gt.value),S&&Ne.push(O[G+Ee])):(Le.push(O[G+Ee]),Pe.push(gt.value)))}return Promise.resolve(0<Pe.length&&y.mutate({trans:c,type:"add",values:Pe}).then(function(yt){for(var He in yt.failures)Le.splice(parseInt(He),1);f(Pe.length,yt)})).then(function(){return(0<be.length||Z&&typeof r=="object")&&y.mutate({trans:c,type:"put",keys:Ne,values:be,criteria:Z,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<G}).then(function(yt){return f(be.length,yt)})}).then(function(){return(0<Le.length||Z&&L)&&y.mutate({trans:c,type:"delete",keys:Le,criteria:Z,isAdditionalChunk:0<G}).then(function(yt){return Nr(l.table,Le,yt)}).then(function(yt){return f(Le.length,yt)})}).then(function(){return O.length>G+de&&Q(G+W)})})}var Z=Yt(l)&&l.limit===1/0&&(typeof r!="function"||L)&&{index:l.index,range:l.range};return Q(0).then(function(){if(0<P.length)throw new ue("Error modifying one or more objects",P,N,q);return O.length})})})},mt.prototype.delete=function(){var r=this._ctx,s=r.range;return!Yt(r)||r.table.schema.yProps||!r.isPrimKey&&s.type!==3?this.modify(Sl):this._write(function(l){var c=r.table.core.schema.primaryKey,f=s;return r.table.core.count({trans:l,query:{index:c,range:f}}).then(function(m){return r.table.core.mutate({trans:l,type:"deleteRange",range:f}).then(function(D){var S=D.failures,D=D.numFailures;if(D)throw new ue("Could not delete some values",Object.keys(S).map(function(W){return S[W]}),m-D);return m-D})})})};var qi=mt;function mt(){}var Sl=function(r,s){return s.value=null};function yd(r,s){return r<s?-1:r===s?0:1}function bd(r,s){return s<r?-1:r===s?0:1}function Mn(r,s,l){return r=r instanceof El?new r.Collection(r):r,r._ctx.error=new(l||TypeError)(s),r}function Ya(r){return new r.Collection(r,function(){return Tl("")}).limit(0)}function Qs(q,s,l,c){var f,m,y,S,D,W,j,P=l.length;if(!l.every(function(O){return typeof O=="string"}))return Mn(q,At);function N(O){f=O==="next"?function(Z){return Z.toUpperCase()}:function(Z){return Z.toLowerCase()},m=O==="next"?function(Z){return Z.toLowerCase()}:function(Z){return Z.toUpperCase()},y=O==="next"?yd:bd;var Q=l.map(function(Z){return{lower:m(Z),upper:f(Z)}}).sort(function(Z,G){return y(Z.lower,G.lower)});S=Q.map(function(Z){return Z.upper}),D=Q.map(function(Z){return Z.lower}),j=(W=O)==="next"?"":c}N("next");var q=new q.Collection(q,function(){return Jr(S[0],D[P-1]+c)}),L=(q._ondirectionchange=function(O){N(O)},0);return q._addAlgorithm(function(O,Q,Z){var G=O.key;if(typeof G=="string"){var de=m(G);if(s(de,D,L))return!0;for(var ye=null,Ce=L;Ce<P;++Ce){var Pe=((be,Ne,Le,Ee,Fe,gt)=>{for(var yt=Math.min(be.length,Ee.length),He=-1,st=0;st<yt;++st){var jt=Ne[st];if(jt!==Ee[st])return Fe(be[st],Le[st])<0?be.substr(0,st)+Le[st]+Le.substr(st+1):Fe(be[st],Ee[st])<0?be.substr(0,st)+Ee[st]+Le.substr(st+1):0<=He?be.substr(0,He)+Ne[He]+Le.substr(He+1):null;Fe(be[st],jt)<0&&(He=st)}return yt<Ee.length&&gt==="next"?be+Le.substr(be.length):yt<be.length&&gt==="prev"?be.substr(0,Le.length):He<0?null:be.substr(0,He)+Ee[He]+Le.substr(He+1)})(G,de,S[Ce],D[Ce],y,W);Pe===null&&ye===null?L=Ce+1:(ye===null||0<y(ye,Pe))&&(ye=Pe)}Q(ye!==null?function(){O.continue(ye+j)}:Z)}return!1}),q}function Jr(r,s,l,c){return{type:2,lower:r,upper:s,lowerOpen:l,upperOpen:c}}function Tl(r){return{type:1,lower:r,upper:r}}Object.defineProperty(nn.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),nn.prototype.between=function(r,s,l,c){l=l!==!1,c=c===!0;try{return 0<this._cmp(r,s)||this._cmp(r,s)===0&&(l||c)&&(!l||!c)?Ya(this):new this.Collection(this,function(){return Jr(r,s,!l,!c)})}catch{return Mn(this,lt)}},nn.prototype.equals=function(r){return r==null?Mn(this,lt):new this.Collection(this,function(){return Tl(r)})},nn.prototype.above=function(r){return r==null?Mn(this,lt):new this.Collection(this,function(){return Jr(r,void 0,!0)})},nn.prototype.aboveOrEqual=function(r){return r==null?Mn(this,lt):new this.Collection(this,function(){return Jr(r,void 0,!1)})},nn.prototype.below=function(r){return r==null?Mn(this,lt):new this.Collection(this,function(){return Jr(void 0,r,!1,!0)})},nn.prototype.belowOrEqual=function(r){return r==null?Mn(this,lt):new this.Collection(this,function(){return Jr(void 0,r)})},nn.prototype.startsWith=function(r){return typeof r!="string"?Mn(this,At):this.between(r,r+Xe,!0,!0)},nn.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Qs(this,function(s,l){return s.indexOf(l[0])===0},[r],Xe)},nn.prototype.equalsIgnoreCase=function(r){return Qs(this,function(s,l){return s===l[0]},[r],"")},nn.prototype.anyOfIgnoreCase=function(){var r=se.apply(pe,arguments);return r.length===0?Ya(this):Qs(this,function(s,l){return l.indexOf(s)!==-1},r,"")},nn.prototype.startsWithAnyOfIgnoreCase=function(){var r=se.apply(pe,arguments);return r.length===0?Ya(this):Qs(this,function(s,l){return l.some(function(c){return s.indexOf(c)===0})},r,Xe)},nn.prototype.anyOf=function(){var r,s,l=this,c=se.apply(pe,arguments),f=this._cmp;try{c.sort(f)}catch{return Mn(this,lt)}return c.length===0?Ya(this):((r=new this.Collection(this,function(){return Jr(c[0],c[c.length-1])}))._ondirectionchange=function(m){f=m==="next"?l._ascending:l._descending,c.sort(f)},s=0,r._addAlgorithm(function(m,y,S){for(var D=m.key;0<f(D,c[s]);)if(++s===c.length)return y(S),!1;return f(D,c[s])===0||(y(function(){m.continue(c[s])}),!1)}),r)},nn.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},nn.prototype.noneOf=function(){var r=se.apply(pe,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return Mn(this,lt)}var s=r.reduce(function(l,c){return l?l.concat([[l[l.length-1][1],c]]):[[-1/0,c]]},null);return s.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(s,{includeLowers:!1,includeUppers:!1})},nn.prototype.inAnyRange=function(r,Z){var l=this,c=this._cmp,f=this._ascending,m=this._descending,y=this._min,S=this._max;if(r.length===0)return Ya(this);if(!r.every(function(G){return G[0]!==void 0&&G[1]!==void 0&&f(G[0],G[1])<=0}))return Mn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",z.InvalidArgument);var D=!Z||Z.includeLowers!==!1,W=Z&&Z.includeUppers===!0,j,P=f;function N(G,de){return P(G[0],de[0])}try{(j=r.reduce(function(G,de){for(var ye=0,Ce=G.length;ye<Ce;++ye){var Pe=G[ye];if(c(de[0],Pe[1])<0&&0<c(de[1],Pe[0])){Pe[0]=y(Pe[0],de[0]),Pe[1]=S(Pe[1],de[1]);break}}return ye===Ce&&G.push(de),G},[])).sort(N)}catch{return Mn(this,lt)}var q=0,L=W?function(G){return 0<f(G,j[q][1])}:function(G){return 0<=f(G,j[q][1])},O=D?function(G){return 0<m(G,j[q][0])}:function(G){return 0<=m(G,j[q][0])},Q=L,Z=new this.Collection(this,function(){return Jr(j[0][0],j[j.length-1][1],!D,!W)});return Z._ondirectionchange=function(G){P=G==="next"?(Q=L,f):(Q=O,m),j.sort(N)},Z._addAlgorithm(function(G,de,ye){for(var Ce,Pe=G.key;Q(Pe);)if(++q===j.length)return de(ye),!1;return!L(Ce=Pe)&&!O(Ce)||(l._cmp(Pe,j[q][1])===0||l._cmp(Pe,j[q][0])===0||de(function(){P===f?G.continue(j[q][0]):G.continue(j[q][1])}),!1)}),Z},nn.prototype.startsWithAnyOf=function(){var r=se.apply(pe,arguments);return r.every(function(s){return typeof s=="string"})?r.length===0?Ya(this):this.inAnyRange(r.map(function(s){return[s,s+Xe]})):Mn(this,"startsWithAnyOf() only works with strings")};var El=nn;function nn(){}function kr(r){return xt(function(s){return ps(s),r(s.target.error),!1})}function ps(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var hs="storagemutated",Bi="x-storagemutated-1",$r=We(null,hs),wd=(xr.prototype._lock=function(){return C(!qe.global),++this._reculock,this._reculock!==1||qe.global||(qe.lockOwnerFor=this),this},xr.prototype._unlock=function(){if(C(!qe.global),--this._reculock==0)for(qe.global||(qe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{Te(r[1],r[0])}catch{}}return this},xr.prototype._locked=function(){return this._reculock&&qe.lockOwnerFor!==this},xr.prototype.create=function(r){var s=this;if(this.mode){var l=this.db.idbdb,c=this.db._state.dbOpenError;if(C(!this.idbtrans),!r&&!l)switch(c&&c.name){case"DatabaseClosedError":throw new z.DatabaseClosed(c);case"MissingAPIError":throw new z.MissingAPI(c.message,c);default:throw new z.OpenFailed(c)}if(!this.active)throw new z.TransactionInactive;C(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||l).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=xt(function(f){ps(f),s._reject(r.error)}),r.onabort=xt(function(f){ps(f),s.active&&s._reject(new z.Abort(r.error)),s.active=!1,s.on("abort").fire(f)}),r.oncomplete=xt(function(){s.active=!1,s._resolve(),"mutatedParts"in r&&$r.storagemutated.fire(r.mutatedParts)})}return this},xr.prototype._promise=function(r,s,l){var c,f=this;return r==="readwrite"&&this.mode!=="readwrite"?_e(new z.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Ie(function(m,y){f._blockedFuncs.push([function(){f._promise(r,s,l).then(m,y)},qe])}):l?ze(function(){var m=new Ie(function(y,S){f._lock();var D=s(y,S,f);D&&D.then&&D.then(y,S)});return m.finally(function(){return f._unlock()}),m._lib=!0,m}):((c=new Ie(function(m,y){var S=s(m,y,f);S&&S.then&&S.then(m,y)}))._lib=!0,c):_e(new z.TransactionInactive)},xr.prototype._root=function(){return this.parent?this.parent._root():this},xr.prototype.waitFor=function(r){var s,l=this._root(),c=Ie.resolve(r),f=(l._waitingFor?l._waitingFor=l._waitingFor.then(function(){return c}):(l._waitingFor=c,l._waitingQueue=[],s=l.idbtrans.objectStore(l.storeNames[0]),(function m(){for(++l._spinCount;l._waitingQueue.length;)l._waitingQueue.shift()();l._waitingFor&&(s.get(-1/0).onsuccess=m)})()),l._waitingFor);return new Ie(function(m,y){c.then(function(S){return l._waitingQueue.push(xt(m.bind(null,S)))},function(S){return l._waitingQueue.push(xt(y.bind(null,S)))}).finally(function(){l._waitingFor===f&&(l._waitingFor=null)})})},xr.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new z.Abort))},xr.prototype.table=function(r){var s=this._memoizedTables||(this._memoizedTables={});if(w(s,r))return s[r];var l=this.schema[r];if(l)return(l=new this.db.Table(r,l,this)).core=this.db.core.table(r),s[r]=l;throw new z.NotFound("Table "+r+" not part of transaction")},xr);function xr(){}function Fi(r,s,l,c,f,m,y,S){return{name:r,keyPath:s,unique:l,multi:c,auto:f,compound:m,src:(l&&!y?"&":"")+(c?"*":"")+(f?"++":"")+Al(s),type:S}}function Al(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function zi(r,s,l){return{name:r,primKey:s,indexes:l,mappedClass:null,idxByName:(c=function(f){return[f.name,f]},l.reduce(function(f,m,y){return m=c(m,y),m&&(f[m[0]]=m[1]),f},{}))};var c}var ms=function(r){try{return r.only([[]]),ms=function(){return[[]]},[[]]}catch{return ms=function(){return Xe},Xe}};function Ki(r){return r==null?function(){}:typeof r=="string"?(s=r).split(".").length===1?function(l){return l[s]}:function(l){return J(l,s)}:function(l){return J(l,r)};var s}function Cl(r){return[].slice.call(r)}var kd=0;function gs(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function xd(r,s,D){function c(L){if(L.type===3)return null;if(L.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var P=L.lower,N=L.upper,q=L.lowerOpen,L=L.upperOpen;return P===void 0?N===void 0?null:s.upperBound(N,!!L):N===void 0?s.lowerBound(P,!!q):s.bound(P,N,!!q,!!L)}function f(j){var P,N=j.name;return{name:N,schema:j,mutate:function(q){var L=q.trans,O=q.type,Q=q.keys,Z=q.values,G=q.range;return new Promise(function(de,ye){de=xt(de);var Ce=L.objectStore(N),Pe=Ce.keyPath==null,be=O==="put"||O==="add";if(!be&&O!=="delete"&&O!=="deleteRange")throw new Error("Invalid operation type: "+O);var Ne,Le=(Q||Z||{length:1}).length;if(Q&&Z&&Q.length!==Z.length)throw new Error("Given keys array must have same length as given values array.");if(Le===0)return de({numFailures:0,failures:{},results:[],lastResult:void 0});function Ee(Bt){++yt,ps(Bt)}var Fe=[],gt=[],yt=0;if(O==="deleteRange"){if(G.type===4)return de({numFailures:yt,failures:gt,results:[],lastResult:void 0});G.type===3?Fe.push(Ne=Ce.clear()):Fe.push(Ne=Ce.delete(c(G)))}else{var Pe=be?Pe?[Z,Q]:[Z,null]:[Q,null],He=Pe[0],st=Pe[1];if(be)for(var jt=0;jt<Le;++jt)Fe.push(Ne=st&&st[jt]!==void 0?Ce[O](He[jt],st[jt]):Ce[O](He[jt])),Ne.onerror=Ee;else for(jt=0;jt<Le;++jt)Fe.push(Ne=Ce[O](He[jt])),Ne.onerror=Ee}function Hn(Bt){Bt=Bt.target.result,Fe.forEach(function(ma,io){return ma.error!=null&&(gt[io]=ma.error)}),de({numFailures:yt,failures:gt,results:O==="delete"?Q:Fe.map(function(ma){return ma.result}),lastResult:Bt})}Ne.onerror=function(Bt){Ee(Bt),Hn(Bt)},Ne.onsuccess=Hn})},getMany:function(q){var L=q.trans,O=q.keys;return new Promise(function(Q,Z){Q=xt(Q);for(var G,de=L.objectStore(N),ye=O.length,Ce=new Array(ye),Pe=0,be=0,Ne=function(Fe){Fe=Fe.target,Ce[Fe._pos]=Fe.result,++be===Pe&&Q(Ce)},Le=kr(Z),Ee=0;Ee<ye;++Ee)O[Ee]!=null&&((G=de.get(O[Ee]))._pos=Ee,G.onsuccess=Ne,G.onerror=Le,++Pe);Pe===0&&Q(Ce)})},get:function(q){var L=q.trans,O=q.key;return new Promise(function(Q,Z){Q=xt(Q);var G=L.objectStore(N).get(O);G.onsuccess=function(de){return Q(de.target.result)},G.onerror=kr(Z)})},query:(P=S,function(q){return new Promise(function(L,O){L=xt(L);var Q,Z,G,be=q.trans,de=q.values,ye=q.limit,Pe=q.query,Ce=ye===1/0?void 0:ye,Ne=Pe.index,Pe=Pe.range,be=be.objectStore(N),be=Ne.isPrimaryKey?be:be.index(Ne.name),Ne=c(Pe);if(ye===0)return L({result:[]});P?((Pe=de?be.getAll(Ne,Ce):be.getAllKeys(Ne,Ce)).onsuccess=function(Le){return L({result:Le.target.result})},Pe.onerror=kr(O)):(Q=0,Z=!de&&"openKeyCursor"in be?be.openKeyCursor(Ne):be.openCursor(Ne),G=[],Z.onsuccess=function(Le){var Ee=Z.result;return!Ee||(G.push(de?Ee.value:Ee.primaryKey),++Q===ye)?L({result:G}):void Ee.continue()},Z.onerror=kr(O))})}),openCursor:function(q){var L=q.trans,O=q.values,Q=q.query,Z=q.reverse,G=q.unique;return new Promise(function(de,ye){de=xt(de);var be=Q.index,Ce=Q.range,Pe=L.objectStore(N),Pe=be.isPrimaryKey?Pe:Pe.index(be.name),be=Z?G?"prevunique":"prev":G?"nextunique":"next",Ne=!O&&"openKeyCursor"in Pe?Pe.openKeyCursor(c(Ce),be):Pe.openCursor(c(Ce),be);Ne.onerror=kr(ye),Ne.onsuccess=xt(function(Le){var Ee,Fe,gt,yt,He=Ne.result;He?(He.___id=++kd,He.done=!1,Ee=He.continue.bind(He),Fe=(Fe=He.continuePrimaryKey)&&Fe.bind(He),gt=He.advance.bind(He),yt=function(){throw new Error("Cursor not stopped")},He.trans=L,He.stop=He.continue=He.continuePrimaryKey=He.advance=function(){throw new Error("Cursor not started")},He.fail=xt(ye),He.next=function(){var st=this,jt=1;return this.start(function(){return jt--?st.continue():st.stop()}).then(function(){return st})},He.start=function(st){function jt(){if(Ne.result)try{st()}catch(Bt){He.fail(Bt)}else He.done=!0,He.start=function(){throw new Error("Cursor behind last entry")},He.stop()}var Hn=new Promise(function(Bt,ma){Bt=xt(Bt),Ne.onerror=kr(ma),He.fail=ma,He.stop=function(io){He.stop=He.continue=He.continuePrimaryKey=He.advance=yt,Bt(io)}});return Ne.onsuccess=xt(function(Bt){Ne.onsuccess=jt,jt()}),He.continue=Ee,He.continuePrimaryKey=Fe,He.advance=gt,jt(),Hn},de(He)):de(null)},ye)})},count:function(q){var L=q.query,O=q.trans,Q=L.index,Z=L.range;return new Promise(function(G,de){var ye=O.objectStore(N),ye=Q.isPrimaryKey?ye:ye.index(Q.name),Ce=c(Z),Ce=Ce?ye.count(Ce):ye.count();Ce.onsuccess=xt(function(Pe){return G(Pe.target.result)}),Ce.onerror=kr(de)})}}}m=D,y=Cl((D=r).objectStoreNames);var m,D={schema:{name:D.name,tables:y.map(function(j){return m.objectStore(j)}).map(function(j){var P=j.keyPath,N=j.autoIncrement,L=d(P),q={},L={name:j.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:P==null,compound:L,keyPath:P,autoIncrement:N,unique:!0,extractKey:Ki(P)},indexes:Cl(j.indexNames).map(function(O){return j.index(O)}).map(function(G){var de=G.name,Q=G.unique,Z=G.multiEntry,G=G.keyPath,de={name:de,compound:d(G),keyPath:G,unique:Q,multiEntry:Z,extractKey:Ki(G)};return q[gs(G)]=de}),getIndexByKeyPath:function(O){return q[gs(O)]}};return q[":id"]=L.primaryKey,P!=null&&(q[gs(P)]=L.primaryKey),L})},hasGetAll:0<y.length&&"getAll"in m.objectStore(y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},y=D.schema,S=D.hasGetAll,D=y.tables.map(f),W={};return D.forEach(function(j){return W[j.name]=j}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(j){if(W[j])return W[j];throw new Error("Table '".concat(j,"' not found"))},MIN_KEY:-1/0,MAX_KEY:ms(s),schema:y}}function Sd(r,s,l,c){return l=l.IDBKeyRange,s=xd(s,l,c),{dbcore:r.dbcore.reduce(function(f,m){return m=m.create,a(a({},f),m(f))},s)}}function Xs(r,s){var l=s.db,l=Sd(r._middlewares,l,r._deps,s);r.core=l.dbcore,r.tables.forEach(function(c){var f=c.name;r.core.schema.tables.some(function(m){return m.name===f})&&(c.core=r.core.table(f),r[f]instanceof r.Table)&&(r[f].core=c.core)})}function Zs(r,s,l,c){l.forEach(function(f){var m=c[f];s.forEach(function(y){var S=(function D(W,j){return R(W,j)||(W=p(W))&&D(W,j)})(y,f);(!S||"value"in S&&S.value===void 0)&&(y===r.Transaction.prototype||y instanceof r.Transaction?I(y,f,{get:function(){return this.table(f)},set:function(D){x(this,f,{value:D,writable:!0,configurable:!0,enumerable:!0})}}):y[f]=new r.Table(f,m))})})}function Ui(r,s){s.forEach(function(l){for(var c in l)l[c]instanceof r.Table&&delete l[c]})}function Td(r,s){return r._cfg.version-s._cfg.version}function Ed(r,s,l,c){var f=r._dbSchema,m=(l.objectStoreNames.contains("$meta")&&!f.$meta&&(f.$meta=zi("$meta",Il("")[0],[]),r._storeNames.push("$meta")),r._createTransaction("readwrite",r._storeNames,f)),y=(m.create(l),m._completion.catch(c),m._reject.bind(m)),S=qe.transless||qe;ze(function(){if(qe.trans=m,qe.transless=S,s!==0)return Xs(r,l),W=s,((D=m).storeNames.includes("$meta")?D.table("$meta").get("version").then(function(j){return j??W}):Ie.resolve(W)).then(function(Q){var P=r,N=Q,q=m,L=l,O=[],Q=P._versions,Z=P._dbSchema=$s(0,P.idbdb,L);return(Q=Q.filter(function(G){return G._cfg.version>=N})).length===0?Ie.resolve():(Q.forEach(function(G){O.push(function(){var de,ye,Ce,Pe=Z,be=G._cfg.dbschema,Ne=(ei(P,Pe,L),ei(P,be,L),Z=P._dbSchema=be,Gi(Pe,be)),Le=(Ne.add.forEach(function(Ee){Wi(L,Ee[0],Ee[1].primKey,Ee[1].indexes)}),Ne.change.forEach(function(Ee){if(Ee.recreate)throw new z.Upgrade("Not yet support for changing primary key");var Fe=L.objectStore(Ee.name);Ee.add.forEach(function(gt){return Js(Fe,gt)}),Ee.change.forEach(function(gt){Fe.deleteIndex(gt.name),Js(Fe,gt)}),Ee.del.forEach(function(gt){return Fe.deleteIndex(gt)})}),G._cfg.contentUpgrade);if(Le&&G._cfg.version>N)return Xs(P,L),q._memoizedTables={},de=le(be),Ne.del.forEach(function(Ee){de[Ee]=Pe[Ee]}),Ui(P,[P.Transaction.prototype]),Zs(P,[P.Transaction.prototype],u(de),de),q.schema=de,(ye=ne(Le))&&Ze(),be=Ie.follow(function(){var Ee;(Ce=Le(q))&&ye&&(Ee=Et.bind(null,null),Ce.then(Ee,Ee))}),Ce&&typeof Ce.then=="function"?Ie.resolve(Ce):be.then(function(){return Ce})}),O.push(function(de){var ye,Ce,Pe=G._cfg.dbschema;ye=Pe,Ce=de,[].slice.call(Ce.db.objectStoreNames).forEach(function(be){return ye[be]==null&&Ce.db.deleteObjectStore(be)}),Ui(P,[P.Transaction.prototype]),Zs(P,[P.Transaction.prototype],P._storeNames,P._dbSchema),q.schema=P._dbSchema}),O.push(function(de){P.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(P.idbdb.version/10)===G._cfg.version?(P.idbdb.deleteObjectStore("$meta"),delete P._dbSchema.$meta,P._storeNames=P._storeNames.filter(function(ye){return ye!=="$meta"})):de.objectStore("$meta").put(G._cfg.version,"version"))})}),(function G(){return O.length?Ie.resolve(O.shift()(q.idbtrans)).then(G):Ie.resolve()})().then(function(){Pl(Z,L)}))}).catch(y);var D,W;u(f).forEach(function(j){Wi(l,j,f[j].primKey,f[j].indexes)}),Xs(r,l),Ie.follow(function(){return r.on.populate.fire(m)}).catch(y)})}function Ad(r,s){Pl(r._dbSchema,s),s.db.version%10!=0||s.objectStoreNames.contains("$meta")||s.db.createObjectStore("$meta").add(Math.ceil(s.db.version/10-1),"version");var l=$s(0,r.idbdb,s);ei(r,r._dbSchema,s);for(var c=0,f=Gi(l,r._dbSchema).change;c<f.length;c++){var m=(y=>{if(y.change.length||y.recreate)return console.warn("Unable to patch indexes of table ".concat(y.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=s.objectStore(y.name);y.add.forEach(function(D){et&&console.debug("Dexie upgrade patch: Creating missing index ".concat(y.name,".").concat(D.src)),Js(S,D)})})(f[c]);if(typeof m=="object")return m.value}}function Gi(r,s){var l,c={del:[],add:[],change:[]};for(l in r)s[l]||c.del.push(l);for(l in s){var f=r[l],m=s[l];if(f){var y={name:l,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(f.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||f.primKey.auto!==m.primKey.auto)y.recreate=!0,c.change.push(y);else{var S=f.idxByName,D=m.idxByName,W=void 0;for(W in S)D[W]||y.del.push(W);for(W in D){var j=S[W],P=D[W];j?j.src!==P.src&&y.change.push(P):y.add.push(P)}(0<y.del.length||0<y.add.length||0<y.change.length)&&c.change.push(y)}}else c.add.push([l,m])}return c}function Wi(r,s,l,c){var f=r.db.createObjectStore(s,l.keyPath?{keyPath:l.keyPath,autoIncrement:l.auto}:{autoIncrement:l.auto});c.forEach(function(m){return Js(f,m)})}function Pl(r,s){u(r).forEach(function(l){s.db.objectStoreNames.contains(l)||(et&&console.debug("Dexie: Creating missing table",l),Wi(s,l,r[l].primKey,r[l].indexes))})}function Js(r,s){r.createIndex(s.name,s.keyPath,{unique:s.unique,multiEntry:s.multi})}function $s(r,s,l){var c={};return Y(s.objectStoreNames,0).forEach(function(f){for(var m=l.objectStore(f),y=Fi(Al(W=m.keyPath),W||"",!0,!1,!!m.autoIncrement,W&&typeof W!="string",!0),S=[],D=0;D<m.indexNames.length;++D){var j=m.index(m.indexNames[D]),W=j.keyPath,j=Fi(j.name,W,!!j.unique,!!j.multiEntry,!1,W&&typeof W!="string",!1);S.push(j)}c[f]=zi(f,y,S)}),c}function ei(r,s,l){for(var c=l.db.objectStoreNames,f=0;f<c.length;++f){var m=c[f],y=l.objectStore(m);r._hasGetAll="getAll"in y;for(var S=0;S<y.indexNames.length;++S){var D,W=y.indexNames[S],j=y.index(W).keyPath,j=typeof j=="string"?j:"["+Y(j).join("+")+"]";s[m]&&(D=s[m].idxByName[j])&&(D.name=W,delete s[m].idxByName[j],s[m].idxByName[W]=D)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function Il(r){return r.split(",").map(function(s,l){var f=s.split(":"),c=(c=f[1])==null?void 0:c.trim(),f=(s=f[0].trim()).replace(/([&*]|\+\+)/g,""),m=/^\[/.test(f)?f.match(/^\[(.*)\]$/)[1].split("+"):f;return Fi(f,m||null,/\&/.test(s),/\*/.test(s),/\+\+/.test(s),d(m),l===0,c)})}Qa.prototype._createTableSchema=zi,Qa.prototype._parseIndexSyntax=Il,Qa.prototype._parseStoresSpec=function(r,s){var l=this;u(r).forEach(function(c){if(r[c]!==null){var f=l._parseIndexSyntax(r[c]),m=f.shift();if(!m)throw new z.Schema("Invalid schema for table "+c+": "+r[c]);if(m.unique=!0,m.multi)throw new z.Schema("Primary key cannot be multiEntry*");f.forEach(function(y){if(y.auto)throw new z.Schema("Only primary key can be marked as autoIncrement (++)");if(!y.keyPath)throw new z.Schema("Index must have a name and cannot be an empty string")}),m=l._createTableSchema(c,m,f),s[c]=m}})},Qa.prototype.stores=function(l){var s=this.db,l=(this._cfg.storesSource=this._cfg.storesSource?g(this._cfg.storesSource,l):l,s._versions),c={},f={};return l.forEach(function(m){g(c,m._cfg.storesSource),f=m._cfg.dbschema={},m._parseStoresSpec(c,f)}),s._dbSchema=f,Ui(s,[s._allTables,s,s.Transaction.prototype]),Zs(s,[s._allTables,s,s.Transaction.prototype,this._cfg.tables],u(f),f),s._storeNames=u(f),this},Qa.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Ye(this._cfg.contentUpgrade||De,r),this};var Cd=Qa;function Qa(){}function Hi(r,s){var l=r._dbNamesDB;return l||(l=r._dbNamesDB=new zr(en,{addons:[],indexedDB:r,IDBKeyRange:s})).version(1).stores({dbnames:"name"}),l.table("dbnames")}function Vi(r){return r&&typeof r.databases=="function"}function Yi(r){return ze(function(){return qe.letThrough=!0,r()})}function Qi(r){return!("from"in r)}var vn=function(r,s){var l;if(!this)return l=new vn,r&&"d"in r&&g(l,r),l;g(this,arguments.length?{d:1,from:r,to:1<arguments.length?s:r}:{d:0})};function _s(r,s,l){var c=tt(s,l);if(!isNaN(c)){if(0<c)throw RangeError();if(Qi(r))return g(r,{from:s,to:l,d:1});var c=r.l,f=r.r;if(tt(l,r.from)<0)return c?_s(c,s,l):r.l={from:s,to:l,d:1,l:null,r:null},Ol(r);if(0<tt(s,r.to))return f?_s(f,s,l):r.r={from:s,to:l,d:1,l:null,r:null},Ol(r);tt(s,r.from)<0&&(r.from=s,r.l=null,r.d=f?f.d+1:1),0<tt(l,r.to)&&(r.to=l,r.r=null,r.d=r.l?r.l.d+1:1),s=!r.r,c&&!r.l&&ys(r,c),f&&s&&ys(r,f)}}function ys(r,s){Qi(s)||(function l(c,f){var m=f.from,y=f.l,S=f.r;_s(c,m,f.to),y&&l(c,y),S&&l(c,S)})(r,s)}function Rl(r,s){var l=ti(s),c=l.next();if(!c.done)for(var f=c.value,m=ti(r),y=m.next(f.from),S=y.value;!c.done&&!y.done;){if(tt(S.from,f.to)<=0&&0<=tt(S.to,f.from))return!0;tt(f.from,S.from)<0?f=(c=l.next(S.from)).value:S=(y=m.next(f.from)).value}return!1}function ti(r){var s=Qi(r)?null:{s:0,n:r};return{next:function(l){for(var c=0<arguments.length;s;)switch(s.s){case 0:if(s.s=1,c)for(;s.n.l&&tt(l,s.n.from)<0;)s={up:s,n:s.n.l,s:1};else for(;s.n.l;)s={up:s,n:s.n.l,s:1};case 1:if(s.s=2,!c||tt(l,s.n.to)<=0)return{value:s.n,done:!1};case 2:if(s.n.r){s.s=3,s={up:s,n:s.n.r,s:0};continue}case 3:s=s.up}return{done:!0}}}}function Ol(r){var s,l,c,f=(((f=r.r)==null?void 0:f.d)||0)-(((f=r.l)==null?void 0:f.d)||0),f=1<f?"r":f<-1?"l":"";f&&(s=f=="r"?"l":"r",l=a({},r),c=r[f],r.from=c.from,r.to=c.to,r[f]=c[f],l[f]=c[s],(r[s]=l).d=Ml(l)),r.d=Ml(r)}function Ml(l){var s=l.r,l=l.l;return(s?l?Math.max(s.d,l.d):s.d:l?l.d:0)+1}function ni(r,s){return u(s).forEach(function(l){r[l]?ys(r[l],s[l]):r[l]=(function c(f){var m,y,S={};for(m in f)w(f,m)&&(y=f[m],S[m]=!y||typeof y!="object"||ve.has(y.constructor)?y:c(y));return S})(s[l])}),r}function Xi(r,s){return r.all||s.all||Object.keys(r).some(function(l){return s[l]&&Rl(s[l],r[l])})}k(vn.prototype,((Mt={add:function(r){return ys(this,r),this},addKey:function(r){return _s(this,r,r),this},addKeys:function(r){var s=this;return r.forEach(function(l){return _s(s,l,l)}),this},hasKey:function(r){var s=ti(this).next(r).value;return s&&tt(s.from,r)<=0&&0<=tt(s.to,r)}})[me]=function(){return ti(this)},Mt));var pa={},Zi={},Ji=!1;function ri(r){ni(Zi,r),Ji||(Ji=!0,setTimeout(function(){Ji=!1,$i(Zi,!(Zi={}))},0))}function $i(r,s){s===void 0&&(s=!1);var l=new Set;if(r.all)for(var c=0,f=Object.values(pa);c<f.length;c++)Dl(S=f[c],r,l,s);else for(var m in r){var y,S,m=/^idb\:\/\/(.*)\/(.*)\//.exec(m);m&&(y=m[1],m=m[2],S=pa["idb://".concat(y,"/").concat(m)])&&Dl(S,r,l,s)}l.forEach(function(D){return D()})}function Dl(r,s,l,c){for(var f=[],m=0,y=Object.entries(r.queries.query);m<y.length;m++){for(var S=y[m],D=S[0],W=[],j=0,P=S[1];j<P.length;j++){var N=P[j];Xi(s,N.obsSet)?N.subscribers.forEach(function(Q){return l.add(Q)}):c&&W.push(N)}c&&f.push([D,W])}if(c)for(var q=0,L=f;q<L.length;q++){var O=L[q],D=O[0],W=O[1];r.queries.query[D]=W}}function Pd(r){var s=r._state,l=r._deps.indexedDB;if(s.isBeingOpened||r.idbdb)return s.dbReadyPromise.then(function(){return s.dbOpenError?_e(s.dbOpenError):r});s.isBeingOpened=!0,s.dbOpenError=null,s.openComplete=!1;var c=s.openCanceller,f=Math.round(10*r.verno),m=!1;function y(){if(s.openCanceller!==c)throw new z.DatabaseClosed("db.open() was cancelled")}function S(){return new Ie(function(N,q){if(y(),!l)throw new z.MissingAPI;var L=r.name,O=s.autoSchema||!f?l.open(L):l.open(L,f);if(!O)throw new z.MissingAPI;O.onerror=kr(q),O.onblocked=xt(r._fireOnBlocked),O.onupgradeneeded=xt(function(Q){var Z;j=O.transaction,s.autoSchema&&!r._options.allowEmptyDB?(O.onerror=ps,j.abort(),O.result.close(),(Z=l.deleteDatabase(L)).onsuccess=Z.onerror=xt(function(){q(new z.NoSuchDatabase("Database ".concat(L," doesnt exist")))})):(j.onerror=kr(q),Z=Q.oldVersion>Math.pow(2,62)?0:Q.oldVersion,P=Z<1,r.idbdb=O.result,m&&Ad(r,j),Ed(r,Z/10,j,q))},q),O.onsuccess=xt(function(){j=null;var Q,Z,G,de,ye,Ce,Pe=r.idbdb=O.result,be=Y(Pe.objectStoreNames);if(0<be.length)try{var Ne=Pe.transaction((ye=be).length===1?ye[0]:ye,"readonly");if(s.autoSchema)Ce=Pe,de=Ne,(G=r).verno=Ce.version/10,de=G._dbSchema=$s(0,Ce,de),G._storeNames=Y(Ce.objectStoreNames,0),Zs(G,[G._allTables],u(de),de);else if(ei(r,r._dbSchema,Ne),Z=Ne,((Z=Gi($s(0,(Q=r).idbdb,Z),Q._dbSchema)).add.length||Z.change.some(function(Le){return Le.add.length||Le.change.length}))&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Pe.close(),f=Pe.version+1,m=!0,N(S());Xs(r,Ne)}catch{}Ot.push(r),Pe.onversionchange=xt(function(Le){s.vcFired=!0,r.on("versionchange").fire(Le)}),Pe.onclose=xt(function(){r.close({disableAutoOpen:!1})}),P&&(be=r._deps,ye=L,Vi(Ce=be.indexedDB)||ye===en||Hi(Ce,be.IDBKeyRange).put({name:ye}).catch(De)),N()},q)}).catch(function(N){switch(N==null?void 0:N.name){case"UnknownError":if(0<s.PR1398_maxLoop)return s.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<f)return f=0,S()}return Ie.reject(N)})}var D,W=s.dbReadyResolve,j=null,P=!1;return Ie.race([c,(typeof navigator>"u"?Ie.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(N){function q(){return indexedDB.databases().finally(N)}D=setInterval(q,100),q()}).finally(function(){return clearInterval(D)}):Promise.resolve()).then(S)]).then(function(){return y(),s.onReadyBeingFired=[],Ie.resolve(Yi(function(){return r.on.ready.fire(r.vip)})).then(function N(){var q;if(0<s.onReadyBeingFired.length)return q=s.onReadyBeingFired.reduce(Ye,De),s.onReadyBeingFired=[],Ie.resolve(Yi(function(){return q(r.vip)})).then(N)})}).finally(function(){s.openCanceller===c&&(s.onReadyBeingFired=null,s.isBeingOpened=!1)}).catch(function(N){s.dbOpenError=N;try{j&&j.abort()}catch{}return c===s.openCanceller&&r._close(),_e(N)}).finally(function(){s.openComplete=!0,W()}).then(function(){var N;return P&&(N={},r.tables.forEach(function(q){q.schema.indexes.forEach(function(L){L.name&&(N["idb://".concat(r.name,"/").concat(q.name,"/").concat(L.name)]=new vn(-1/0,[[[]]]))}),N["idb://".concat(r.name,"/").concat(q.name,"/")]=N["idb://".concat(r.name,"/").concat(q.name,"/:dels")]=new vn(-1/0,[[[]]])}),$r(hs).fire(N),$i(N,!0)),r})}function eo(r){function s(m){return r.next(m)}var l=f(s),c=f(function(m){return r.throw(m)});function f(m){return function(S){var S=m(S),D=S.value;return S.done?D:D&&typeof D.then=="function"?D.then(l,c):d(D)?Promise.all(D).then(l,c):l(D)}}return f(s)()}function ai(r,s,l){for(var c=d(r)?r.slice():[r],f=0;f<l;++f)c.push(s);return c}var Id={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return a(a({},r),{table:function(c){var l=r.table(c),c=l.schema,f={},m=[];function y(N,q,L){var G=gs(N),O=f[G]=f[G]||[],Q=N==null?0:typeof N=="string"?1:N.length,Z=0<q,G=a(a({},L),{name:Z?"".concat(G,"(virtual-from:").concat(L.name,")"):L.name,lowLevelIndex:L,isVirtual:Z,keyTail:q,keyLength:Q,extractKey:Ki(N),unique:!Z&&L.unique});return O.push(G),G.isPrimaryKey||m.push(G),1<Q&&y(Q===2?N[0]:N.slice(0,Q-1),q+1,L),O.sort(function(de,ye){return de.keyTail-ye.keyTail}),G}var S=y(c.primaryKey.keyPath,0,c.primaryKey);f[":id"]=[S];for(var D=0,W=c.indexes;D<W.length;D++){var j=W[D];y(j.keyPath,0,j)}function P(N){var q,L=N.query.index;return L.isVirtual?a(a({},N),{query:{index:L.lowLevelIndex,range:(q=N.query.range,L=L.keyTail,{type:q.type===1?2:q.type,lower:ai(q.lower,q.lowerOpen?r.MAX_KEY:r.MIN_KEY,L),lowerOpen:!0,upper:ai(q.upper,q.upperOpen?r.MIN_KEY:r.MAX_KEY,L),upperOpen:!0})}}):N}return a(a({},l),{schema:a(a({},c),{primaryKey:S,indexes:m,getIndexByKeyPath:function(N){return(N=f[gs(N)])&&N[0]}}),count:function(N){return l.count(P(N))},query:function(N){return l.query(P(N))},openCursor:function(N){var q=N.query.index,L=q.keyTail,O=q.keyLength;return q.isVirtual?l.openCursor(P(N)).then(function(Z){return Z&&Q(Z)}):l.openCursor(N);function Q(Z){return Object.create(Z,{continue:{value:function(G){G!=null?Z.continue(ai(G,N.reverse?r.MAX_KEY:r.MIN_KEY,L)):N.unique?Z.continue(Z.key.slice(0,O).concat(N.reverse?r.MIN_KEY:r.MAX_KEY,L)):Z.continue()}},continuePrimaryKey:{value:function(G,de){Z.continuePrimaryKey(ai(G,r.MAX_KEY,L),de)}},primaryKey:{get:function(){return Z.primaryKey}},key:{get:function(){var G=Z.key;return O===1?G[0]:G.slice(0,O)}},value:{get:function(){return Z.value}}})}}})}})}};function to(r,s,l,c){return l=l||{},c=c||"",u(r).forEach(function(f){var m,y,S;w(s,f)?(m=r[f],y=s[f],typeof m=="object"&&typeof y=="object"&&m&&y?(S=re(m))!==re(y)?l[c+f]=s[f]:S==="Object"?to(m,y,l,c+f+"."):m!==y&&(l[c+f]=s[f]):m!==y&&(l[c+f]=s[f])):l[c+f]=void 0}),u(s).forEach(function(f){w(r,f)||(l[c+f]=s[f])}),l}function no(r,s){return s.type==="delete"?s.keys:s.keys||s.values.map(r.extractKey)}var Rd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return a(a({},r),{table:function(s){var l=r.table(s),c=l.schema.primaryKey;return a(a({},l),{mutate:function(f){var m=qe.trans,y=m.table(s).hook,S=y.deleting,D=y.creating,W=y.updating;switch(f.type){case"add":if(D.fire===De)break;return m._promise("readwrite",function(){return j(f)},!0);case"put":if(D.fire===De&&W.fire===De)break;return m._promise("readwrite",function(){return j(f)},!0);case"delete":if(S.fire===De)break;return m._promise("readwrite",function(){return j(f)},!0);case"deleteRange":if(S.fire===De)break;return m._promise("readwrite",function(){return(function P(N,q,L){return l.query({trans:N,values:!1,query:{index:c,range:q},limit:L}).then(function(O){var Q=O.result;return j({type:"delete",keys:Q,trans:N}).then(function(Z){return 0<Z.numFailures?Promise.reject(Z.failures[0]):Q.length<L?{failures:[],numFailures:0,lastResult:void 0}:P(N,a(a({},q),{lower:Q[Q.length-1],lowerOpen:!0}),L)})})})(f.trans,f.range,1e4)},!0)}return l.mutate(f);function j(P){var N,q,L,O=qe.trans,Q=P.keys||no(c,P);if(Q)return(P=P.type==="add"||P.type==="put"?a(a({},P),{keys:Q}):a({},P)).type!=="delete"&&(P.values=i([],P.values)),P.keys&&(P.keys=i([],P.keys)),N=l,L=Q,((q=P).type==="add"?Promise.resolve([]):N.getMany({trans:q.trans,keys:L,cache:"immutable"})).then(function(Z){var G=Q.map(function(de,ye){var Ce,Pe,be,Ne=Z[ye],Le={onerror:null,onsuccess:null};return P.type==="delete"?S.fire.call(Le,de,Ne,O):P.type==="add"||Ne===void 0?(Ce=D.fire.call(Le,de,P.values[ye],O),de==null&&Ce!=null&&(P.keys[ye]=de=Ce,c.outbound||F(P.values[ye],c.keyPath,de))):(Ce=to(Ne,P.values[ye]),(Pe=W.fire.call(Le,Ce,de,Ne,O))&&(be=P.values[ye],Object.keys(Pe).forEach(function(Ee){w(be,Ee)?be[Ee]=Pe[Ee]:F(be,Ee,Pe[Ee])}))),Le});return l.mutate(P).then(function(de){for(var ye=de.failures,Ce=de.results,Pe=de.numFailures,de=de.lastResult,be=0;be<Q.length;++be){var Ne=(Ce||Q)[be],Le=G[be];Ne==null?Le.onerror&&Le.onerror(ye[be]):Le.onsuccess&&Le.onsuccess(P.type==="put"&&Z[be]?P.values[be]:Ne)}return{failures:ye,results:Ce,numFailures:Pe,lastResult:de}}).catch(function(de){return G.forEach(function(ye){return ye.onerror&&ye.onerror(de)}),Promise.reject(de)})});throw new Error("Keys missing")}}})}})}};function jl(r,s,l){try{if(!s||s.keys.length<r.length)return null;for(var c=[],f=0,m=0;f<s.keys.length&&m<r.length;++f)tt(s.keys[f],r[m])===0&&(c.push(l?ce(s.values[f]):s.values[f]),++m);return c.length===r.length?c:null}catch{return null}}var Od={stack:"dbcore",level:-1,create:function(r){return{table:function(s){var l=r.table(s);return a(a({},l),{getMany:function(c){var f;return c.cache?(f=jl(c.keys,c.trans._cache,c.cache==="clone"))?Ie.resolve(f):l.getMany(c).then(function(m){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?ce(m):m},m}):l.getMany(c)},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),l.mutate(c)}})}}}};function Ll(r,s){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!s.schema.primaryKey.outbound}function Nl(r,s){switch(r){case"query":return s.values&&!s.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Md={stack:"dbcore",level:0,name:"Observability",create:function(r){var s=r.schema.name,l=new vn(r.MIN_KEY,r.MAX_KEY);return a(a({},r),{transaction:function(c,f,m){if(qe.subscr&&f!=="readonly")throw new z.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(qe.querier));return r.transaction(c,f,m)},table:function(c){function f(Q){var O,Q=Q.query;return[O=Q.index,new vn((O=(Q=Q.range).lower)!=null?O:r.MIN_KEY,(O=Q.upper)!=null?O:r.MAX_KEY)]}var m=r.table(c),y=m.schema,S=y.primaryKey,D=y.indexes,W=S.extractKey,j=S.outbound,P=S.autoIncrement&&D.filter(function(L){return L.compound&&L.keyPath.includes(S.keyPath)}),N=a(a({},m),{mutate:function(L){function O(Fe){return Fe="idb://".concat(s,"/").concat(c,"/").concat(Fe),ye[Fe]||(ye[Fe]=new vn)}var Q,Z,G,de=L.trans,ye=L.mutatedParts||(L.mutatedParts={}),Ce=O(""),Pe=O(":dels"),be=L.type,Le=L.type==="deleteRange"?[L.range]:L.type==="delete"?[L.keys]:L.values.length<50?[no(S,L).filter(function(Fe){return Fe}),L.values]:[],Ne=Le[0],Le=Le[1],Ee=L.trans._cache;return d(Ne)?(Ce.addKeys(Ne),(be=be==="delete"||Ne.length===Le.length?jl(Ne,Ee):null)||Pe.addKeys(Ne),(be||Le)&&(Q=O,Z=be,G=Le,y.indexes.forEach(function(Fe){var gt=Q(Fe.name||"");function yt(st){return st!=null?Fe.extractKey(st):null}function He(st){Fe.multiEntry&&d(st)?st.forEach(function(jt){return gt.addKey(jt)}):gt.addKey(st)}(Z||G).forEach(function(st,Bt){var Hn=Z&&yt(Z[Bt]),Bt=G&&yt(G[Bt]);tt(Hn,Bt)!==0&&(Hn!=null&&He(Hn),Bt!=null)&&He(Bt)})}))):Ne?(Le={from:(Ee=Ne.lower)!=null?Ee:r.MIN_KEY,to:(be=Ne.upper)!=null?be:r.MAX_KEY},Pe.add(Le),Ce.add(Le)):(Ce.add(l),Pe.add(l),y.indexes.forEach(function(Fe){return O(Fe.name).add(l)})),m.mutate(L).then(function(Fe){return!Ne||L.type!=="add"&&L.type!=="put"||(Ce.addKeys(Fe.results),P&&P.forEach(function(gt){for(var yt=L.values.map(function(Hn){return gt.extractKey(Hn)}),He=gt.keyPath.findIndex(function(Hn){return Hn===S.keyPath}),st=0,jt=Fe.results.length;st<jt;++st)yt[st][He]=Fe.results[st];O(gt.name).addKeys(yt)})),de.mutatedParts=ni(de.mutatedParts||{},ye),Fe})}}),q={get:function(L){return[S,new vn(L.key)]},getMany:function(L){return[S,new vn().addKeys(L.keys)]},count:f,query:f,openCursor:f};return u(q).forEach(function(L){N[L]=function(O){var Q=qe.subscr,Z=!!Q,G=Ll(qe,m)&&Nl(L,O)?O.obsSet={}:Q;if(Z){var de,Q=function(Le){return Le="idb://".concat(s,"/").concat(c,"/").concat(Le),G[Le]||(G[Le]=new vn)},ye=Q(""),Ce=Q(":dels"),Z=q[L](O),Pe=Z[0],Z=Z[1];if((L==="query"&&Pe.isPrimaryKey&&!O.values?Ce:Q(Pe.name||"")).add(Z),!Pe.isPrimaryKey){if(L!=="count")return de=L==="query"&&j&&O.values&&m.query(a(a({},O),{values:!1})),m[L].apply(this,arguments).then(function(Le){if(L==="query"){if(j&&O.values)return de.then(function(yt){return yt=yt.result,ye.addKeys(yt),Le});var Ee=O.values?Le.result.map(W):Le.result;(O.values?ye:Ce).addKeys(Ee)}else{var Fe,gt;if(L==="openCursor")return gt=O.values,(Fe=Le)&&Object.create(Fe,{key:{get:function(){return Ce.addKey(Fe.primaryKey),Fe.key}},primaryKey:{get:function(){var yt=Fe.primaryKey;return Ce.addKey(yt),yt}},value:{get:function(){return gt&&ye.addKey(Fe.primaryKey),Fe.value}}})}return Le});Ce.add(l)}}return m[L].apply(this,arguments)}}),N}})}};function ql(r,s,l){var c;return l.numFailures===0?s:s.type==="deleteRange"||(c=s.keys?s.keys.length:"values"in s&&s.values?s.values.length:1,l.numFailures===c)?null:(c=a({},s),d(c.keys)&&(c.keys=c.keys.filter(function(f,m){return!(m in l.failures)})),"values"in c&&d(c.values)&&(c.values=c.values.filter(function(f,m){return!(m in l.failures)})),c)}function ro(r,s){return l=r,((c=s).lower===void 0||(c.lowerOpen?0<tt(l,c.lower):0<=tt(l,c.lower)))&&(l=r,(c=s).upper===void 0||(c.upperOpen?tt(l,c.upper)<0:tt(l,c.upper)<=0));var l,c}function Bl(r,s,l,c,f,m){var y,S,D,W,j,P;return!l||l.length===0||(y=s.query.index,S=y.multiEntry,D=s.query.range,W=c.schema.primaryKey.extractKey,j=y.extractKey,P=(y.lowLevelIndex||y).extractKey,(c=l.reduce(function(N,q){var L=N,O=[];if(q.type==="add"||q.type==="put")for(var Q=new vn,Z=q.values.length-1;0<=Z;--Z){var G,de=q.values[Z],ye=W(de);!Q.hasKey(ye)&&(G=j(de),S&&d(G)?G.some(function(Le){return ro(Le,D)}):ro(G,D))&&(Q.addKey(ye),O.push(de))}switch(q.type){case"add":var Ce=new vn().addKeys(s.values?N.map(function(Ee){return W(Ee)}):N),L=N.concat(s.values?O.filter(function(Ee){return Ee=W(Ee),!Ce.hasKey(Ee)&&(Ce.addKey(Ee),!0)}):O.map(function(Ee){return W(Ee)}).filter(function(Ee){return!Ce.hasKey(Ee)&&(Ce.addKey(Ee),!0)}));break;case"put":var Pe=new vn().addKeys(q.values.map(function(Ee){return W(Ee)}));L=N.filter(function(Ee){return!Pe.hasKey(s.values?W(Ee):Ee)}).concat(s.values?O:O.map(function(Ee){return W(Ee)}));break;case"delete":var be=new vn().addKeys(q.keys);L=N.filter(function(Ee){return!be.hasKey(s.values?W(Ee):Ee)});break;case"deleteRange":var Ne=q.range;L=N.filter(function(Ee){return!ro(W(Ee),Ne)})}return L},r))===r)?r:(c.sort(function(N,q){return tt(P(N),P(q))||tt(W(N),W(q))}),s.limit&&s.limit<1/0&&(c.length>s.limit?c.length=s.limit:r.length===s.limit&&c.length<s.limit&&(f.dirty=!0)),m?Object.freeze(c):c)}function Fl(r,s){return tt(r.lower,s.lower)===0&&tt(r.upper,s.upper)===0&&!!r.lowerOpen==!!s.lowerOpen&&!!r.upperOpen==!!s.upperOpen}function Dd(r,s){return((l,c,f,m)=>{if(l===void 0)return c!==void 0?-1:0;if(c===void 0)return 1;if((l=tt(l,c))===0){if(f&&m)return 0;if(f)return 1;if(m)return-1}return l})(r.lower,s.lower,r.lowerOpen,s.lowerOpen)<=0&&0<=((l,c,f,m)=>{if(l===void 0)return c!==void 0?1:0;if(c===void 0)return-1;if((l=tt(l,c))===0){if(f&&m)return 0;if(f)return-1;if(m)return 1}return l})(r.upper,s.upper,r.upperOpen,s.upperOpen)}function jd(r,s,l,c){r.subscribers.add(l),c.addEventListener("abort",function(){var f,m;r.subscribers.delete(l),r.subscribers.size===0&&(f=r,m=s,setTimeout(function(){f.subscribers.size===0&&ie(m,f)},3e3))})}var Ld={stack:"dbcore",level:0,name:"Cache",create:function(r){var s=r.schema.name;return a(a({},r),{transaction:function(l,c,f){var m,y,S=r.transaction(l,c,f);return c==="readwrite"&&(f=(m=new AbortController).signal,S.addEventListener("abort",(y=function(D){return function(){if(m.abort(),c==="readwrite"){for(var W=new Set,j=0,P=l;j<P.length;j++){var N=P[j],q=pa["idb://".concat(s,"/").concat(N)];if(q){var L=r.table(N),O=q.optimisticOps.filter(function(Fe){return Fe.trans===S});if(S._explicit&&D&&S.mutatedParts)for(var Q=0,Z=Object.values(q.queries.query);Q<Z.length;Q++)for(var G=0,de=(Pe=Z[Q]).slice();G<de.length;G++)Xi((be=de[G]).obsSet,S.mutatedParts)&&(ie(Pe,be),be.subscribers.forEach(function(Fe){return W.add(Fe)}));else if(0<O.length){q.optimisticOps=q.optimisticOps.filter(function(Fe){return Fe.trans!==S});for(var ye=0,Ce=Object.values(q.queries.query);ye<Ce.length;ye++)for(var Pe,be,Ne,Le=0,Ee=(Pe=Ce[ye]).slice();Le<Ee.length;Le++)(be=Ee[Le]).res!=null&&S.mutatedParts&&(D&&!be.dirty?(Ne=Object.isFrozen(be.res),Ne=Bl(be.res,be.req,O,L,be,Ne),be.dirty?(ie(Pe,be),be.subscribers.forEach(function(Fe){return W.add(Fe)})):Ne!==be.res&&(be.res=Ne,be.promise=Ie.resolve({result:Ne}))):(be.dirty&&ie(Pe,be),be.subscribers.forEach(function(Fe){return W.add(Fe)})))}}}W.forEach(function(Fe){return Fe()})}}})(!1),{signal:f}),S.addEventListener("error",y(!1),{signal:f}),S.addEventListener("complete",y(!0),{signal:f})),S},table:function(l){var c=r.table(l),f=c.schema.primaryKey;return a(a({},c),{mutate:function(m){var y,S=qe.trans;return!f.outbound&&S.db._options.cache!=="disabled"&&!S.explicit&&S.idbtrans.mode==="readwrite"&&(y=pa["idb://".concat(s,"/").concat(l)])?(S=c.mutate(m),m.type!=="add"&&m.type!=="put"||!(50<=m.values.length||no(f,m).some(function(D){return D==null}))?(y.optimisticOps.push(m),m.mutatedParts&&ri(m.mutatedParts),S.then(function(D){0<D.numFailures&&(ie(y.optimisticOps,m),(D=ql(0,m,D))&&y.optimisticOps.push(D),m.mutatedParts)&&ri(m.mutatedParts)}),S.catch(function(){ie(y.optimisticOps,m),m.mutatedParts&&ri(m.mutatedParts)})):S.then(function(D){var W=ql(0,a(a({},m),{values:m.values.map(function(j,P){var N;return D.failures[P]?j:(F(N=(N=f.keyPath)!=null&&N.includes(".")?ce(j):a({},j),f.keyPath,D.results[P]),N)})}),D);y.optimisticOps.push(W),queueMicrotask(function(){return m.mutatedParts&&ri(m.mutatedParts)})}),S):c.mutate(m)},query:function(m){var y,S,D,W,j,P,N;return Ll(qe,c)&&Nl("query",m)?(y=((D=qe.trans)==null?void 0:D.db._options.cache)==="immutable",S=(D=qe).requery,D=D.signal,P=((q,L,O,Q)=>{var Z=pa["idb://".concat(q,"/").concat(L)];if(!Z)return[];if(!(q=Z.queries[O]))return[null,!1,Z,null];var G=q[(Q.query?Q.query.index.name:null)||""];if(!G)return[null,!1,Z,null];switch(O){case"query":var de=G.find(function(ye){return ye.req.limit===Q.limit&&ye.req.values===Q.values&&Fl(ye.req.query.range,Q.query.range)});return de?[de,!0,Z,G]:[G.find(function(ye){return("limit"in ye.req?ye.req.limit:1/0)>=Q.limit&&(!Q.values||ye.req.values)&&Dd(ye.req.query.range,Q.query.range)}),!1,Z,G];case"count":return de=G.find(function(ye){return Fl(ye.req.query.range,Q.query.range)}),[de,!!de,Z,G]}})(s,l,"query",m),N=P[0],W=P[2],j=P[3],N&&P[1]?N.obsSet=m.obsSet:(P=c.query(m).then(function(q){var L=q.result;if(N&&(N.res=L),y){for(var O=0,Q=L.length;O<Q;++O)Object.freeze(L[O]);Object.freeze(L)}else q.result=ce(L);return q}).catch(function(q){return j&&N&&ie(j,N),Promise.reject(q)}),N={obsSet:m.obsSet,promise:P,subscribers:new Set,type:"query",req:m,dirty:!1},j?j.push(N):(j=[N],(W=W||(pa["idb://".concat(s,"/").concat(l)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[m.query.index.name||""]=j)),jd(N,j,S,D),N.promise.then(function(q){return{result:Bl(q.result,m,W==null?void 0:W.optimisticOps,c,N,y)}})):c.query(m)}})}})}};function si(r,s){return new Proxy(r,{get:function(l,c,f){return c==="db"?s:Reflect.get(l,c,f)}})}Kt.prototype.version=function(r){if(isNaN(r)||r<.1)throw new z.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var s=this._versions,l=s.filter(function(c){return c._cfg.version===r})[0];return l||(l=new this.Version(r),s.push(l),s.sort(Td),l.stores({}),this._state.autoSchema=!1),l},Kt.prototype._whenReady=function(r){var s=this;return this.idbdb&&(this._state.openComplete||qe.letThrough||this._vip)?r():new Ie(function(l,c){if(s._state.openComplete)return c(new z.DatabaseClosed(s._state.dbOpenError));if(!s._state.isBeingOpened){if(!s._state.autoOpen)return void c(new z.DatabaseClosed);s.open().catch(De)}s._state.dbReadyPromise.then(l,c)}).then(r)},Kt.prototype.use=function(f){var s=f.stack,l=f.create,c=f.level,f=f.name,m=(f&&this.unuse({stack:s,name:f}),this._middlewares[s]||(this._middlewares[s]=[]));return m.push({stack:s,create:l,level:c??10,name:f}),m.sort(function(y,S){return y.level-S.level}),this},Kt.prototype.unuse=function(r){var s=r.stack,l=r.name,c=r.create;return s&&this._middlewares[s]&&(this._middlewares[s]=this._middlewares[s].filter(function(f){return c?f.create!==c:!!l&&f.name!==l})),this},Kt.prototype.open=function(){var r=this;return Te(Vt,function(){return Pd(r)})},Kt.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var r=this._state,s=Ot.indexOf(this);if(0<=s&&Ot.splice(s,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new Ie(function(l){r.dbReadyResolve=l}),r.openCanceller=new Ie(function(l,c){r.cancelOpen=c}))},Kt.prototype.close=function(s){var s=(s===void 0?{disableAutoOpen:!0}:s).disableAutoOpen,l=this._state;s?(l.isBeingOpened&&l.cancelOpen(new z.DatabaseClosed),this._close(),l.autoOpen=!1,l.dbOpenError=new z.DatabaseClosed):(this._close(),l.autoOpen=this._options.autoOpen||l.isBeingOpened,l.openComplete=!1,l.dbOpenError=null)},Kt.prototype.delete=function(r){var s=this,l=(r===void 0&&(r={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),c=this._state;return new Ie(function(f,m){function y(){s.close(r);var S=s._deps.indexedDB.deleteDatabase(s.name);S.onsuccess=xt(function(){var D,W,j;D=s._deps,W=s.name,Vi(j=D.indexedDB)||W===en||Hi(j,D.IDBKeyRange).delete(W).catch(De),f()}),S.onerror=kr(m),S.onblocked=s._fireOnBlocked}if(l)throw new z.InvalidArgument("Invalid closeOptions argument to db.delete()");c.isBeingOpened?c.dbReadyPromise.then(y):y()})},Kt.prototype.backendDB=function(){return this.idbdb},Kt.prototype.isOpen=function(){return this.idbdb!==null},Kt.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Kt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Kt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Kt.prototype,"tables",{get:function(){var r=this;return u(this._allTables).map(function(s){return r._allTables[s]})},enumerable:!1,configurable:!0}),Kt.prototype.transaction=function(){var r=(function(s,l,c){var f=arguments.length;if(f<2)throw new z.InvalidArgument("Too few arguments");for(var m=new Array(f-1);--f;)m[f-1]=arguments[f];return c=m.pop(),[s,Ae(m),c]}).apply(this,arguments);return this._transaction.apply(this,r)},Kt.prototype._transaction=function(r,s,l){var c,f,m=this,y=qe.trans,S=(y&&y.db===this&&r.indexOf("!")===-1||(y=null),r.indexOf("?")!==-1);r=r.replace("!","").replace("?","");try{if(f=s.map(function(W){if(W=W instanceof m.Table?W.name:W,typeof W!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return W}),r=="r"||r===Sn)c=Sn;else{if(r!="rw"&&r!=sr)throw new z.InvalidArgument("Invalid transaction mode: "+r);c=sr}if(y){if(y.mode===Sn&&c===sr){if(!S)throw new z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");y=null}y&&f.forEach(function(W){if(y&&y.storeNames.indexOf(W)===-1){if(!S)throw new z.SubTransaction("Table "+W+" not included in parent transaction.");y=null}}),S&&y&&!y.active&&(y=null)}}catch(W){return y?y._promise(null,function(j,P){P(W)}):_e(W)}var D=(function W(j,P,N,q,L){return Ie.resolve().then(function(){var G=qe.transless||qe,O=j._createTransaction(P,N,j._dbSchema,q),G=(O.explicit=!0,{trans:O,transless:G});if(q)O.idbtrans=q.idbtrans;else try{O.create(),O.idbtrans._explicit=!0,j._state.PR1398_maxLoop=3}catch(de){return de.name===Ke.InvalidState&&j.isOpen()&&0<--j._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),j.close({disableAutoOpen:!1}),j.open().then(function(){return W(j,P,N,null,L)})):_e(de)}var Q,Z=ne(L),G=(Z&&Ze(),Ie.follow(function(){var de;(Q=L.call(O,O))&&(Z?(de=Et.bind(null,null),Q.then(de,de)):typeof Q.next=="function"&&typeof Q.throw=="function"&&(Q=eo(Q)))},G));return(Q&&typeof Q.then=="function"?Ie.resolve(Q).then(function(de){return O.active?de:_e(new z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):G.then(function(){return Q})).then(function(de){return q&&O._resolve(),O._completion.then(function(){return de})}).catch(function(de){return O._reject(de),_e(de)})})}).bind(null,this,c,f,y,l);return y?y._promise(c,D,"lock"):qe.trans?Te(qe.transless,function(){return m._whenReady(D)}):this._whenReady(D)},Kt.prototype.table=function(r){if(w(this._allTables,r))return this._allTables[r];throw new z.InvalidTable("Table ".concat(r," does not exist"))};var zr=Kt;function Kt(r,s){var l,c,f,m,y,S=this,D=(this._middlewares={},this.verno=0,Kt.dependencies),D=(this._options=s=a({addons:Kt.addons,autoOpen:!0,indexedDB:D.indexedDB,IDBKeyRange:D.IDBKeyRange,cache:"cloned"},s),this._deps={indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},s.addons),W=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:De,dbReadyPromise:null,cancelOpen:De,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:s.autoOpen}),j=(W.dbReadyPromise=new Ie(function(P){W.dbReadyResolve=P}),W.openCanceller=new Ie(function(P,N){W.cancelOpen=N}),this._state=W,this.name=r,this.on=We(this,"populate","blocked","versionchange","close",{ready:[Ye,De]}),this.once=function(P,N){var q=function(){for(var L=[],O=0;O<arguments.length;O++)L[O]=arguments[O];S.on(P).unsubscribe(q),N.apply(S,L)};return S.on(P,q)},this.on.ready.subscribe=U(this.on.ready.subscribe,function(P){return function(N,q){Kt.vip(function(){var L,O=S._state;O.openComplete?(O.dbOpenError||Ie.resolve().then(N),q&&P(N)):O.onReadyBeingFired?(O.onReadyBeingFired.push(N),q&&P(N)):(P(N),L=S,q||P(function Q(){L.on.ready.unsubscribe(N),L.on.ready.unsubscribe(Q)}))})}}),this.Collection=(l=this,pt(qi.prototype,function(Q,O){this.db=l;var q=zt,L=null;if(O)try{q=O()}catch(G){L=G}var O=Q._ctx,Q=O.table,Z=Q.hook.reading.fire;this._ctx={table:Q,index:O.index,isPrimKey:!O.index||Q.schema.primKey.keyPath&&O.index===Q.schema.primKey.name,range:q,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:L,or:O.or,valueMapper:Z!==Be?Z:null}})),this.Table=(c=this,pt(Ha.prototype,function(P,N,q){this.db=c,this._tx=q,this.name=P,this.schema=N,this.hook=c._allTables[P]?c._allTables[P].hook:We(null,{creating:[Xt,De],reading:[Tt,Be],updating:[Zt,De],deleting:[fn,De]})})),this.Transaction=(f=this,pt(wd.prototype,function(P,N,q,L,O){var Q=this;P!=="readonly"&&N.forEach(function(Z){Z=(Z=q[Z])==null?void 0:Z.yProps,Z&&(N=N.concat(Z.map(function(G){return G.updatesTable})))}),this.db=f,this.mode=P,this.storeNames=N,this.schema=q,this.chromeTransactionDurability=L,this.idbtrans=null,this.on=We(this,"complete","error","abort"),this.parent=O||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(function(Z,G){Q._resolve=Z,Q._reject=G}),this._completion.then(function(){Q.active=!1,Q.on.complete.fire()},function(Z){var G=Q.active;return Q.active=!1,Q.on.error.fire(Z),Q.parent?Q.parent._reject(Z):G&&Q.idbtrans&&Q.idbtrans.abort(),_e(Z)})})),this.Version=(m=this,pt(Cd.prototype,function(P){this.db=m,this._cfg={version:P,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(y=this,pt(El.prototype,function(P,N,q){if(this.db=y,this._ctx={table:P,index:N===":id"?null:N,or:q},this._cmp=this._ascending=tt,this._descending=function(L,O){return tt(O,L)},this._max=function(L,O){return 0<tt(L,O)?L:O},this._min=function(L,O){return tt(L,O)<0?L:O},this._IDBKeyRange=y._deps.IDBKeyRange,!this._IDBKeyRange)throw new z.MissingAPI})),this.on("versionchange",function(P){0<P.newVersion?console.warn("Another connection wants to upgrade database '".concat(S.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(S.name,"'. Closing db now to resume the delete request.")),S.close({disableAutoOpen:!1})}),this.on("blocked",function(P){!P.newVersion||P.newVersion<P.oldVersion?console.warn("Dexie.delete('".concat(S.name,"') was blocked")):console.warn("Upgrade '".concat(S.name,"' blocked by other connection holding version ").concat(P.oldVersion/10))}),this._maxKey=ms(s.IDBKeyRange),this._createTransaction=function(P,N,q,L){return new S.Transaction(P,N,q,S._options.chromeTransactionDurability,L)},this._fireOnBlocked=function(P){S.on("blocked").fire(P),Ot.filter(function(N){return N.name===S.name&&N!==S&&!N._state.vcFired}).map(function(N){return N.on("versionchange").fire(P)})},this.use(Od),this.use(Ld),this.use(Md),this.use(Id),this.use(Rd),new Proxy(this,{get:function(P,N,q){var L;return N==="_vip"||(N==="table"?function(O){return si(S.table(O),j)}:(L=Reflect.get(P,N,q))instanceof Ha?si(L,j):N==="tables"?L.map(function(O){return si(O,j)}):N==="_createTransaction"?function(){return si(L.apply(this,arguments),j)}:L)}}));this.vip=j,D.forEach(function(P){return P(S)})}var ii,Xa=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Nd=(ao.prototype.subscribe=function(r,s,l){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:s,complete:l})},ao.prototype[Xa]=function(){return this},ao);function ao(r){this._subscribe=r}try{ii={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{ii={indexedDB:null,IDBKeyRange:null}}function zl(r){var s,l=!1,c=new Nd(function(f){var m=ne(r),y,S=!1,D={},W={},j={get closed(){return S},unsubscribe:function(){S||(S=!0,y&&y.abort(),P&&$r.storagemutated.unsubscribe(q))}},P=(f.start&&f.start(j),!1),N=function(){return ge(L)},q=function(O){ni(D,O),Xi(W,D)&&N()},L=function(){var O,Q,Z;!S&&ii.indexedDB&&(D={},O={},y&&y.abort(),y=new AbortController,Z=(G=>{var de=rr();try{m&&Ze();var ye=ze(r,G);return ye=m?ye.finally(Et):ye}finally{de&&ar()}})(Q={subscr:O,signal:y.signal,requery:N,querier:r,trans:null}),Promise.resolve(Z).then(function(G){l=!0,s=G,S||Q.signal.aborted||(D={},(de=>{for(var ye in de)if(w(de,ye))return;return 1})(W=O)||P||($r(hs,q),P=!0),ge(function(){return!S&&f.next&&f.next(G)}))},function(G){l=!1,["DatabaseClosedError","AbortError"].includes(G==null?void 0:G.name)||S||ge(function(){S||f.error&&f.error(G)})}))};return setTimeout(N,0),j});return c.hasValue=function(){return l},c.getValue=function(){return s},c}var ha=zr;function so(r){var s=ea;try{ea=!0,$r.storagemutated.fire(r),$i(r,!0)}finally{ea=s}}k(ha,a(a({},he),{delete:function(r){return new ha(r,{addons:[]}).delete()},exists:function(r){return new ha(r,{addons:[]}).open().then(function(s){return s.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return s=ha.dependencies,l=s.indexedDB,s=s.IDBKeyRange,(Vi(l)?Promise.resolve(l.databases()).then(function(c){return c.map(function(f){return f.name}).filter(function(f){return f!==en})}):Hi(l,s).toCollection().primaryKeys()).then(r)}catch{return _e(new z.MissingAPI)}var s,l},defineClass:function(){return function(r){g(this,r)}},ignoreTransaction:function(r){return qe.trans?Te(qe.transless,r):r()},vip:Yi,async:function(r){return function(){try{var s=eo(r.apply(this,arguments));return s&&typeof s.then=="function"?s:Ie.resolve(s)}catch(l){return _e(l)}}},spawn:function(r,s,l){try{var c=eo(r.apply(l,s||[]));return c&&typeof c.then=="function"?c:Ie.resolve(c)}catch(f){return _e(f)}},currentTransaction:{get:function(){return qe.trans||null}},waitFor:function(r,s){return r=Ie.resolve(typeof r=="function"?ha.ignoreTransaction(r):r).timeout(s||6e4),qe.trans?qe.trans.waitFor(r):r},Promise:Ie,debug:{get:function(){return et},set:function(r){Ft(r)}},derive:B,extend:g,props:k,override:U,Events:We,on:$r,liveQuery:zl,extendObservabilitySet:ni,getByKeyPath:J,setByKeyPath:F,delByKeyPath:function(r,s){typeof s=="string"?F(r,s,void 0):"length"in s&&[].map.call(s,function(l){F(r,l,void 0)})},shallowClone:le,deepClone:ce,getObjectDiff:to,cmp:tt,asap:V,minKey:-1/0,addons:[],connections:Ot,errnames:Ke,dependencies:ii,cache:pa,semVer:"4.3.0",version:"4.3.0".split(".").map(function(r){return parseInt(r)}).reduce(function(r,s,l){return r+s/Math.pow(10,2*l)})})),ha.maxKey=ms(ha.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&($r(hs,function(r){ea||(r=new CustomEvent(Bi,{detail:r}),ea=!0,dispatchEvent(r),ea=!1)}),addEventListener(Bi,function(r){r=r.detail,ea||so(r)}));var Za,ea=!1,Kl=function(){};return typeof BroadcastChannel<"u"&&((Kl=function(){(Za=new BroadcastChannel(Bi)).onmessage=function(r){return r.data&&so(r.data)}})(),typeof Za.unref=="function"&&Za.unref(),$r(hs,function(r){ea||Za.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!zr.disableBfCache&&r.persisted){et&&console.debug("Dexie: handling persisted pagehide"),Za!=null&&Za.close();for(var s=0,l=Ot;s<l.length;s++)l[s].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!zr.disableBfCache&&r.persisted&&(et&&console.debug("Dexie: handling persisted pageshow"),Kl(),so({all:new vn(-1/0,[[]])}))})),Ie.rejectionMapper=function(r,s){return!r||r instanceof $||r instanceof TypeError||r instanceof SyntaxError||!r.name||!Re[r.name]?r:(s=new Re[r.name](s||r.message,r),"stack"in r&&I(s,"stack",{get:function(){return this.inner.stack}}),s)},Ft(et),a(zr,Object.freeze({__proto__:null,Dexie:zr,Entity:Wn,PropModification:qr,RangeSet:vn,add:function(r){return new qr({add:r})},cmp:tt,default:zr,liveQuery:zl,mergeRanges:ys,rangesOverlap:Rl,remove:function(r){return new qr({remove:r})},replacePrefix:function(r,s){return new qr({replacePrefix:[r,s]})}}),{default:zr}),zr})})(yi)),yi.exports}var Iv=Pv();const jo=Av(Iv),oc=Symbol.for("Dexie"),hn=globalThis[oc]||(globalThis[oc]=jo);if(jo.semVer!==hn.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${jo.semVer} and ${hn.semVer}`);const{liveQuery:$y,mergeRanges:eb,rangesOverlap:tb,RangeSet:nb,cmp:rb,Entity:ab,PropModification:sb,replacePrefix:ib,add:ob,remove:lb,DexieYProvider:cb}=hn,Ge=new hn("me-ai-store");Ge.version(1).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType"});Ge.version(2).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",actionItems:"++id, type, status, sourceItemId, createdAt, dueDate, [type+status]"});Ge.version(3).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, [action+status]",actionItems:null});Ge.version(4).stores({items:"id, sourceType, sourceId, threadKey, date, from, *labels, [sourceType+date]",contacts:"++id, &email, name, lastSeen",syncState:"sourceType",emailClassifications:"emailId, action, date, scannedAt, status, *tags, [action+status]"});function ju(t,e){return`${t}:${e}`}function Lo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return(t/Math.pow(e,a)).toFixed(1)+" "+n[a]}function mo(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e)),i=t/Math.pow(e,a),o=a>=2?2:a>=1?1:0;return i.toFixed(o)+" "+n[a]}function Rv(t,e){return!e||e<=0?null:Math.min(100,t/e*100)}function Ov(t,e){return t?t.length<=e?t:t.slice(0,e)+"...":""}function Lu(t){let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return Math.abs(e)%360}const Mv="https://gmail.googleapis.com/gmail/v1/users/me";class cl extends Error{constructor(e,n,a){super(e),this.name="GmailApiError",this.status=n,this.code=a||null}}function Dv(t){return{Authorization:`Bearer ${t}`}}async function ji(t,e){var a,i,o,u;const n=await fetch(`${Mv}${e}`,{headers:Dv(t)});if(!n.ok){const d=await n.json().catch(()=>({})),g=((a=d.error)==null?void 0:a.message)||`Gmail API error: ${n.status}`,p=((u=(o=(i=d.error)==null?void 0:i.errors)==null?void 0:o[0])==null?void 0:u.reason)||void 0;throw new cl(g,n.status,p)}return n.json()}function Nu(t){return ji(t,"/profile")}function qu(t,{maxResults:e=20,pageToken:n,q:a}={}){const i=new URLSearchParams;return i.set("maxResults",String(e)),n&&i.set("pageToken",n),a&&i.set("q",a),ji(t,`/messages?${i}`)}function Bu(t,e,n="full"){return ji(t,`/messages/${e}?format=${n}`)}function jv(t,{startHistoryId:e,pageToken:n,maxResults:a=500}={}){const i=new URLSearchParams;return i.set("startHistoryId",e),i.set("maxResults",String(a)),i.append("historyTypes","messageAdded"),i.append("historyTypes","messageDeleted"),n&&i.set("pageToken",n),ji(t,`/history?${i}`)}function na(t,e){var o;const n=((o=t==null?void 0:t.payload)==null?void 0:o.headers)||[],a=e.toLowerCase(),i=n.find(u=>u.name.toLowerCase()===a);return(i==null?void 0:i.value)||""}function Ds(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const n=e.length%4;n&&(e+="=".repeat(4-n));const a=atob(e),i=Uint8Array.from(a,o=>o.charCodeAt(0));return new TextDecoder().decode(i)}function Lv(t){var o,u,d;const e=t==null?void 0:t.payload;if(!e)return"";if((o=e.body)!=null&&o.data)return Ds(e.body.data);const n=e.parts||[],a=ki(n,"text/plain");if((u=a==null?void 0:a.body)!=null&&u.data)return Ds(a.body.data);const i=ki(n,"text/html");if((d=i==null?void 0:i.body)!=null&&d.data){const g=Ds(i.body.data);return qv(g)}return"(no body)"}function Nv(t){var i,o;const e=t==null?void 0:t.payload;if(!e)return null;if(e.mimeType==="text/html"&&((i=e.body)!=null&&i.data))return Ds(e.body.data);const n=e.parts||[],a=ki(n,"text/html");return(o=a==null?void 0:a.body)!=null&&o.data?Ds(a.body.data):null}function ki(t,e){for(const n of t){if(n.mimeType===e)return n;if(n.parts){const a=ki(n.parts,e);if(a)return a}}return null}function qv(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script"))n.remove();return(e.body.textContent||"").replace(/\s+/g," ").trim()}catch{return t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<[^>]+>/g," ").replace(/&#x([0-9a-f]+);/gi,(e,n)=>String.fromCodePoint(parseInt(n,16))).replace(/&#(\d+);/g,(e,n)=>String.fromCodePoint(Number(n))).replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/\s+/g," ").trim()}}function ul(t){if(!t)return"";try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return t}}function Fu(t){if(!t)return"Unknown";const e=t.match(/^"?([^"<]+)"?\s*</);return e?e[1].trim():t.split("@")[0]}function zu(t){return Fu(t).charAt(0).toUpperCase()}function Bv(t){try{const e=new Date(t),n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${i}`}catch{return"email"}}function Fv(t){return(t||"email").replace(/[^a-zA-Z0-9 _-]/g,"").replace(/\s+/g,"-").slice(0,60).replace(/-+$/,"")}function Ku(t,e){return`${Bv(t.date)}_${Fv(t.subject)}.${e}`}function Uu(t){const e={};for(const a of t){const i=a.action||"UNKNOWN";e[i]||(e[i]=[]),e[i].push(a)}for(const a of Object.keys(e))e[a].sort((i,o)=>(o.date||0)-(i.date||0));const n=Object.keys(e).sort((a,i)=>e[i].length-e[a].length);return{groups:e,order:n}}async function zv(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return null;const n=[`Stored data: ${t} emails, ${e} contacts.`],{oldest:a,newest:i}=await Gu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),u=new Date(i.date).toLocaleDateString();n.push(`Date range: ${o} to ${u}.`)}return n.join(" ")}async function Kv(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.contacts.count();if(t===0)return"No emails stored locally.";const n=["## Data Summary",`- **Emails:** ${t}`,`- **Contacts:** ${e}`],{oldest:a,newest:i}=await Gu();if(a&&i){const o=new Date(a.date).toLocaleDateString(),u=new Date(i.date).toLocaleDateString();n.push(`- **Date range:** ${o} â ${u}`)}return n.join(`
`)}async function Uv(t=10){const e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(t).toArray();return e.length===0?"No emails stored locally.":e.map(Wu).join(`

---

`)}async function Gv(t,e=10){if(!t)return"No search query provided.";const n=t.toLowerCase(),i=(await Ge.items.where("sourceType").equals("gmail").toArray()).map(o=>{var d,g,p,b,w;let u=0;return(d=o.subject)!=null&&d.toLowerCase().includes(n)&&(u+=3),(g=o.from)!=null&&g.toLowerCase().includes(n)&&(u+=2),(p=o.to)!=null&&p.toLowerCase().includes(n)&&(u+=2),(b=o.snippet)!=null&&b.toLowerCase().includes(n)&&(u+=1),(w=o.body)!=null&&w.toLowerCase().includes(n)&&(u+=1),{item:o,score:u}}).filter(({score:o})=>o>0).sort((o,u)=>u.score-o.score).slice(0,e);return i.length===0?`No results found for "${t}".`:i.map(({item:o})=>Wu(o)).join(`

---

`)}async function lc(){const t=await Ge.emailClassifications.where("status").equals("pending").toArray();if(t.length===0)return null;const{groups:e,order:n}=Uu(t);return{groups:e,order:n,total:t.length}}async function Wv({query:t,limit:e=50,offset:n=0}={}){if(t){const o=t.toLowerCase(),u=await Ge.items.where("sourceType").equals("gmail").filter(d=>{var g,p,b,w;return((g=d.subject)==null?void 0:g.toLowerCase().includes(o))||((p=d.from)==null?void 0:p.toLowerCase().includes(o))||((b=d.to)==null?void 0:b.toLowerCase().includes(o))||((w=d.snippet)==null?void 0:w.toLowerCase().includes(o))}).toArray();return u.sort((d,g)=>(g.date||0)-(d.date||0)),{items:u.slice(n,n+e),total:u.length}}const a=await Ge.items.where("sourceType").equals("gmail").count();return{items:await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().offset(n).limit(e).toArray(),total:a}}async function Gu(){const t=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).first(),e=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).last();return{oldest:t,newest:e}}function Wu(t){const e=t.date?new Date(t.date).toLocaleString():"Unknown date",n=Ov(t.body||t.snippet||"",500);switch(t.type){case"email":return[`**Subject:** ${t.subject}`,`**From:** ${t.from}`,`**To:** ${t.to}`,t.cc?`**CC:** ${t.cc}`:"",`**Date:** ${e}`,`**Labels:** ${(t.labels||[]).join(", ")}`,"",n].filter(Boolean).join(`
`);default:return[`**From:** ${t.from}`,`**Date:** ${e}`,"",n].join(`
`)}}async function Hv(){const t=await zv();return t?["You have access to the user's locally stored data.",t,"The user can ask you about their emails. If they do, you can see recent emails and search results that will be provided."].join(" "):null}async function Vv(t){const e=[],n=await Kv();if(e.push(n),t){const a=await Gv(t,5);e.push("","## Relevant Emails",a)}else{const a=await Uv(5);e.push("","## Recent Emails",a)}return e.join(`
`)}const Yv="modulepreload",Qv=function(t){return"/me-ai/"+t},cc={},uc=function(e,n,a){let i=Promise.resolve();if(n&&n.length>0){let u=function(p){return Promise.all(p.map(b=>Promise.resolve(b).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),g=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));i=u(n.map(p=>{if(p=Qv(p),p in cc)return;cc[p]=!0;const b=p.endsWith(".css"),w=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${w}`))return;const k=document.createElement("link");if(k.rel=b?"stylesheet":Yv,b||(k.as="script"),k.crossOrigin="",k.href=p,g&&k.setAttribute("nonce",g),document.head.appendChild(k),b)return new Promise((x,I)=>{k.addEventListener("load",x),k.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${p}`)))})}))}function o(u){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=u,window.dispatchEvent(d),!d.defaultPrevented)throw u}return i.then(u=>{for(const d of u||[])d.status==="rejected"&&o(d.reason);return e().catch(o)})},Xv=20,Zv={maxTokens:512},Ps=`You are an email classifier. Analyze this email and produce a classification.

Output ONLY a valid JSON object â no markdown, no explanation, no extra text.

Format:
{
  "action": "SHORT_ACTION_NAME",
  "reason": "One sentence explaining why",
  "summary": "2-3 sentence summary of the email content",
  "tags": ["tag1", "tag2", "tag3"]
}

Guidelines for "action":
- Use a short UPPER_SNAKE_CASE label that describes what the user should do
- Examples: DELETE, REPLY, REVIEW, READ_LATER, ARCHIVE, PAY_BILL, TRACK_DELIVERY, SCHEDULE_MEETING, UNSUBSCRIBE, SAVE_RECEIPT, FOLLOW_UP, ACKNOWLEDGE, IGNORE
- Be specific: prefer "TRACK_DELIVERY" over "NOTIFY", prefer "PAY_BILL" over "REVIEW"
- If genuinely nothing to do, use "NO_ACTION"

Guidelines for "tags":
- 2-5 short lowercase tags describing the email's nature
- Examples: ad, promotion, newsletter, delivery, billing, personal, work, social, receipt, shipping, subscription, security, update, notification, newsletter, finance, travel
- Be descriptive and specific

Guidelines for "summary":
- 2-3 sentences capturing the key information
- Include specific details: amounts, dates, names, tracking numbers, deadlines
- Write from the perspective of what matters to the recipient

Rules:
- Output ONLY the JSON object, nothing else
- "action" must be UPPER_SNAKE_CASE
- "tags" must be an array of lowercase strings
- "summary" must be a string`;async function Hu(t,{count:e=Xv,force:n=!1,onProgress:a=()=>{},signal:i}={}){if(!t.isReady)throw new Error("Model not loaded. Please load a model first.");a({phase:"loading",message:"Loading recent emails..."});let o,u=0;if(n)o=await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().limit(e).toArray();else{const U=new Set(await Ge.emailClassifications.toCollection().primaryKeys());u=0,o=[],await Ge.items.where("[sourceType+date]").between(["gmail",hn.minKey],["gmail",hn.maxKey]).reverse().until(()=>o.length>=e).each(C=>{U.has(C.id)?u++:o.push(C)})}if(o.length===0){const U=n?"No emails to scan.":`All emails already classified (${u} total). Use "Rescan All" to reclassify.`;return a({phase:"done",message:U,classified:0}),{scanned:0,classified:0,skipped:u,errors:0}}const d=Date.now(),g=performance.now();let p=0,b=0,w=0,k=0;const x=[],I=t.modelId,B=ol(I)||ll(I);if(!B)throw new Error(`Unknown model: ${I}`);if(!B.recommendedForEmailProcessing&&o.length>0){const{MODELS:U}=await uc(async()=>{const{MODELS:F}=await Promise.resolve().then(()=>yv);return{MODELS:F}},void 0),{OLLAMA_MODELS:C}=await uc(async()=>{const{OLLAMA_MODELS:F}=await Promise.resolve().then(()=>bv);return{OLLAMA_MODELS:F}},void 0),V=[...U.filter(F=>F.recommendedForEmailProcessing).map(F=>F.name),...C.filter(F=>F.recommendedForEmailProcessing).map(F=>F.displayName)],J=B.displayName||B.name;console.warn(`â ï¸ Current model (${J}) is not optimized for email processing. For best results with long emails, use: ${V.join(", ")}. Some emails may fail due to memory limits.`)}for(let U=0;U<o.length&&!(i!=null&&i.aborted);U++){const C=o[U],V=Yu(C),J=[{role:"system",content:Ps},{role:"user",content:V}];a({phase:"scanning",current:U+1,total:o.length,classified:p,errors:b,email:{subject:C.subject,from:C.from,date:C.date},prompt:{system:Ps,user:V},systemPromptLength:Ps.length,live:null,lastResult:null,totals:{outputTokens:w,inputTokens:k,elapsed:performance.now()-g}});const F=performance.now();try{const{text:le,tps:xe,numTokens:Ae,inputTokens:ve}=await t.generateFull(J,{maxTokens:512,enableThinking:!1,temperature:0},we=>{a({phase:"generating",current:U+1,total:o.length,classified:p,errors:b,email:{subject:C.subject,from:C.from,date:C.date},live:{tps:we.tps,numTokens:we.numTokens},streamingText:we.text||"",totals:{outputTokens:w,inputTokens:k,elapsed:performance.now()-g}})});w+=Ae,k+=ve;const te=ep(le),ce=performance.now()-F;if(te){await Ge.emailClassifications.put({emailId:C.id,action:te.action,reason:te.reason,summary:te.summary,tags:te.tags,subject:C.subject||"(no subject)",from:C.from||"",date:C.date,scannedAt:d,status:"pending"}),p++;const we={success:!0,email:{subject:C.subject,from:C.from,date:C.date},classification:te,rawResponse:le,stats:{tps:xe,numTokens:Ae,inputTokens:ve,elapsed:ce},promptSize:V.length};x.push(we),a({phase:"classified",current:U+1,total:o.length,classified:p,errors:b,email:{subject:C.subject,from:C.from,date:C.date},result:te,rawResponse:le,emailStats:{tps:xe,numTokens:Ae,inputTokens:ve,elapsed:ce},totals:{outputTokens:w,inputTokens:k,elapsed:performance.now()-g}})}}catch(le){console.error(`Triage email ${U+1} failed:`,le),b++;const xe=le.message||String(le),Ae=xe.length>200?xe.slice(0,200)+"...":xe;x.push({success:!1,email:{subject:C.subject,from:C.from,date:C.date},error:Ae,promptSize:V.length})}}const R=performance.now()-g,X=x.length>0?Math.round(x.reduce((U,C)=>U+C.promptSize,0)/x.length):0,Y=x.filter(U=>{var C;return U.success&&((C=U.stats)==null?void 0:C.tps)}).length>0?Math.round(x.filter(U=>U.success).reduce((U,C)=>{var V;return U+(((V=C.stats)==null?void 0:V.tps)||0)},0)/x.filter(U=>{var C;return U.success&&((C=U.stats)==null?void 0:C.tps)}).length):null;return a({phase:"done",current:o.length,total:o.length,classified:p,errors:b,results:x,summary:{avgPromptSize:X,avgTps:Y,systemPromptSize:Ps.length,processed:o.length,skipped:u,modelName:B.displayName||B.name,modelContextWindow:B.contextWindow,modelMaxEmailTokens:B.maxEmailTokens},totals:{outputTokens:w,inputTokens:k,elapsed:R}}),{scanned:o.length,classified:p,skipped:u,errors:b}}async function Jv(){const t=await Ge.emailClassifications.toArray();return Uu(t)}async function $v(){const t=await Ge.emailClassifications.toArray(),e={total:t.length};for(const n of t){const a=n.action||"UNKNOWN";e[a]=(e[a]||0)+1}return e}async function xi(t,e){await Ge.emailClassifications.update(t,{status:e})}async function dc(){await Ge.emailClassifications.clear()}async function dl(t){await Ge.emailClassifications.where("action").equals(t).delete()}async function Vu(t){await Ge.emailClassifications.delete(t)}async function No(){const t=await Ge.items.where("sourceType").equals("gmail").count(),e=await Ge.emailClassifications.count();return{totalEmails:t,classified:e,unclassified:Math.max(0,t-e)}}function Yu(t){const e=t.date?new Date(t.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}):"Unknown date",n=t.body||t.snippet||"";return[`Subject: ${t.subject}`,`From: ${t.from}`,`To: ${t.to||"me"}`,`Date: ${e}`,`Labels: ${(t.labels||[]).join(", ")}`,"",n].join(`
`)}function ep(t){if(!t||!t.trim())return null;let e=t.trim();e=e.replace(/^```(?:json)?\s*\n?/i,"").replace(/\n?```\s*$/i,""),e=e.trim();const n=e.indexOf("{"),a=e.lastIndexOf("}");if(n===-1||a===-1||a<=n)return console.warn("Triage: no JSON object found in response"),null;const i=e.indexOf("[");if(i!==-1&&i<n)return console.warn("Triage: expected JSON object, got array"),null;const o=e.slice(n,a+1);try{const u=JSON.parse(o);if(!u||typeof u!="object"||Array.isArray(u))return null;const d=tp(u.action);if(!d)return console.warn("Triage: missing or invalid action field"),null;let g=[];return Array.isArray(u.tags)&&(g=u.tags.filter(p=>typeof p=="string"&&p.trim()).map(p=>p.trim().toLowerCase()).slice(0,10)),{action:d,reason:String(u.reason||"").slice(0,300),summary:String(u.summary||"").slice(0,500),tags:g}}catch(u){return console.warn("Triage: failed to parse JSON response:",u.message),null}}function tp(t){return!t||typeof t!="string"?null:t.trim().toUpperCase().replace(/[\s-]+/g,"_").replace(/[^A-Z0-9_]/g,"")||null}function qo(t){return`hsl(${Lu(t)}, 55%, 55%)`}function np(t){return`hsl(${Lu(t)}, 40%, 35%)`}var rp=M('<p class="warning svelte-1n2kfl0">WebGPU not available in this browser. Use Ollama or upgrade your browser.</p>'),ap=M('<div class="backend-selector svelte-1n2kfl0"><div class="backend-label svelte-1n2kfl0">AI Backend:</div> <div class="backend-options svelte-1n2kfl0"><button><span class="backend-icon svelte-1n2kfl0">ð·</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">WebGPU</div> <div class="backend-desc svelte-1n2kfl0">Browser, private, no server</div></div></button> <button><span class="backend-icon svelte-1n2kfl0">ð¦</span> <div class="backend-info svelte-1n2kfl0"><div class="backend-name svelte-1n2kfl0">Ollama</div> <div class="backend-desc svelte-1n2kfl0">Local server, larger models</div></div></button></div> <!></div>');function sp(t,e){Pt(e,!0);let n=Me(e,"backend",15,"webgpu"),a=Me(e,"isWebGPUAvailable",3,!0);var i=ap(),o=_(h(i),2),u=h(o);let d;u.__click=()=>n("webgpu");var g=_(u,2);let p;g.__click=()=>n("ollama");var b=_(o,2);{var w=k=>{var x=rp();T(k,x)};ae(b,k=>{!a()&&n()==="webgpu"&&k(w)})}ee(()=>{d=Ct(u,1,"backend-btn svelte-1n2kfl0",null,d,{active:n()==="webgpu"}),u.disabled=!a(),p=Ct(g,1,"backend-btn svelte-1n2kfl0",null,p,{active:n()==="ollama"})}),T(t,i),It()}Wt(["click"]);const ip=typeof localStorage<"u"&&localStorage.getItem("debug")==="true";function fc(...t){ip&&console.log("[debug]",...t)}function zn(t){return fc(`[MOUNT] ${t}`),()=>fc(`[DESTROY] ${t}`)}var op=M("<option> </option>"),lp=M('<p class="model-description svelte-1p89qnn"> </p>'),cp=M('<span class="current-badge svelte-1p89qnn">Current</span>'),up=M('<span class="rec-badge rec-good svelte-1p89qnn">â</span>'),dp=M('<span class="rec-badge rec-ok svelte-1p89qnn">â ï¸</span>'),fp=M('<span class="rec-badge rec-bad svelte-1p89qnn">â</span>'),vp=M('<tr><td class="model-name svelte-1p89qnn"> <!></td><td class="context-col svelte-1p89qnn"><strong> </strong></td><td class="tokens-col svelte-1p89qnn"> </td><td class="rec-col svelte-1p89qnn"><!></td></tr>'),pp=M('<div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Max buffer</span><span class="svelte-1p89qnn"> </span></div>'),hp=M('<div class="gpu-card svelte-1p89qnn"><div class="gpu-card-header svelte-1p89qnn"><span class="gpu-dot svelte-1p89qnn"></span> <span>WebGPU Active</span></div> <div class="gpu-card-body svelte-1p89qnn"><div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Vendor</span><span class="svelte-1p89qnn"> </span></div> <div class="gpu-row svelte-1p89qnn"><span class="svelte-1p89qnn">Architecture</span><span class="svelte-1p89qnn"> </span></div> <!></div></div>'),mp=M('<p class="error svelte-1p89qnn"> </p>'),gp=M('<div class="container svelte-1p89qnn"><div class="content-wrapper svelte-1p89qnn"><p class="subtitle svelte-1p89qnn">A private AI chat that runs <strong>entirely in your browser</strong> using WebGPU.</p> <div class="model-selector svelte-1p89qnn"><label for="model-select" class="svelte-1p89qnn">Choose Model:</label> <select id="model-select" class="svelte-1p89qnn"></select> <!></div> <details class="model-details svelte-1p89qnn"><summary class="model-details-summary svelte-1p89qnn">Model Capabilities</summary> <div class="model-table-wrapper svelte-1p89qnn"><table class="model-table svelte-1p89qnn"><thead class="svelte-1p89qnn"><tr><th class="svelte-1p89qnn">Model</th><th class="svelte-1p89qnn">Context</th><th class="svelte-1p89qnn">Email Limit</th><th class="svelte-1p89qnn">Status</th></tr></thead><tbody class="svelte-1p89qnn"></tbody></table></div> <p class="model-table-note svelte-1p89qnn"><strong class="svelte-1p89qnn">Context</strong> = max input capacity. <strong class="svelte-1p89qnn">Email Limit</strong> = WebGPU safe limit. â = Recommended, â ï¸ = Limited, â = May fail.</p></details> <!> <!> <button class="btn primary svelte-1p89qnn">Load Model</button></div></div>');function _p(t,e){Pt(e,!0);let n=Me(e,"selectedModel",15),a=Me(e,"gpuInfo",3,null),i=Me(e,"error",3,null);dn(()=>zn("ModelSelector"));var o=gp(),u=h(o),d=_(h(u),2),g=_(h(d),2);Qt(g,21,()=>Pr,yn,(C,V)=>{var J=op(),F=h(J),le={};ee(()=>{K(F,`${v(V).name??""} â ${v(V).size??""}`),le!==(le=v(V).id)&&(J.value=(J.__value=v(V).id)??"")}),T(C,J)});var p=_(g,2);{var b=C=>{const V=ht(()=>Pr.find(xe=>xe.id===n()));var J=pr(),F=$e(J);{var le=xe=>{var Ae=lp(),ve=h(Ae);ee(()=>K(ve,v(V).description)),T(xe,Ae)};ae(F,xe=>{v(V)&&xe(le)})}T(C,J)};ae(p,C=>{n()&&C(b)})}var w=_(d,2),k=_(h(w),2),x=h(k),I=_(h(x));Qt(I,21,()=>Pr,yn,(C,V)=>{var J=vp();let F;var le=h(J),xe=h(le),Ae=_(xe);{var ve=he=>{var H=cp();T(he,H)};ae(Ae,he=>{v(V).id===n()&&he(ve)})}var te=_(le),ce=h(te),we=h(ce),re=_(te),me=h(re),Se=_(re),ie=h(Se);{var pe=he=>{var H=up();T(he,H)},se=he=>{var H=dp();T(he,H)},ne=he=>{var H=fp();T(he,H)};ae(ie,he=>{v(V).recommendedForEmailProcessing?he(pe):v(V).maxEmailTokens>=6e3?he(se,1):he(ne,!1)})}ee((he,H)=>{F=Ct(J,1,"svelte-1p89qnn",null,F,{selected:v(V).id===n()}),K(xe,`${v(V).name??""} `),K(we,`${he??""}k`),K(me,`~${H??""}k`)},[()=>(v(V).contextWindow/1024).toFixed(0),()=>(v(V).maxEmailTokens/1e3).toFixed(0)]),T(C,J)});var B=_(w,2);{var R=C=>{var V=hp(),J=_(h(V),2),F=h(J),le=_(h(F)),xe=h(le),Ae=_(F,2),ve=_(h(Ae)),te=h(ve),ce=_(Ae,2);{var we=re=>{var me=pp(),Se=_(h(me)),ie=h(Se);ee(pe=>K(ie,pe),[()=>Lo(a().limits.maxBufferSize)]),T(re,me)};ae(ce,re=>{var me;(me=a().limits)!=null&&me.maxBufferSize&&re(we)})}ee(()=>{K(xe,a().vendor),K(te,a().architecture)}),T(C,V)};ae(B,C=>{a()&&C(R)})}var X=_(B,2);{var Y=C=>{var V=mp(),J=h(V);ee(()=>K(J,i())),T(C,V)};ae(X,C=>{i()&&C(Y)})}var U=_(X,2);U.__click=function(...C){var V;(V=e.onload)==null||V.apply(this,C)},ee(()=>U.disabled=i()),Mi(g,n),T(t,o),It()}Wt(["click"]);var yp=M('<span class="status-dot connected svelte-1bvvk8o"></span> <span> </span>',1),bp=M('<span class="status-dot disconnected svelte-1bvvk8o"></span> <span> </span>',1),wp=M("<div><!></div>"),kp=M("<option> <!></option>"),xp=M("<option> <!></option>"),Sp=M('<span class="sep svelte-1bvvk8o">Â·</span> <span> </span>',1),Tp=M('<div class="install-hint svelte-1bvvk8o"><strong>Not installed.</strong> Run: <code class="svelte-1bvvk8o"> </code></div>'),Ep=M('<div class="install-hint installed svelte-1bvvk8o">â Model installed and ready</div>'),Ap=M('<div class="model-info svelte-1bvvk8o"><p class="model-desc svelte-1bvvk8o"> </p> <div class="model-meta svelte-1bvvk8o"><span> </span> <span class="sep svelte-1bvvk8o">Â·</span> <span> </span> <!></div> <!></div>'),Cp=M('<span class="current-badge svelte-1bvvk8o">Current</span>'),Pp=M('<span class="installed-badge svelte-1bvvk8o">â</span>'),Ip=M('<span class="rec-badge svelte-1bvvk8o">â</span>'),Rp=M('<tr><td class="model-name svelte-1bvvk8o"> <!> <!></td><td class="context-col svelte-1bvvk8o"><strong> </strong></td><td class="params-col svelte-1bvvk8o"> </td><td class="tags-col svelte-1bvvk8o"><!> </td></tr>'),Op=M('<p class="error svelte-1bvvk8o"> </p>'),Mp=M('<div class="ollama-settings svelte-1bvvk8o"><div class="connection-section svelte-1bvvk8o"><label for="ollama-url" class="svelte-1bvvk8o">Ollama Server URL:</label> <div class="url-input-group svelte-1bvvk8o"><input id="ollama-url" type="text" placeholder="http://localhost:11434" class="svelte-1bvvk8o"/> <button class="btn-test svelte-1bvvk8o"> </button></div> <!></div> <div class="model-section svelte-1bvvk8o"><label for="ollama-model" class="svelte-1bvvk8o">Choose Model:</label> <select id="ollama-model" class="svelte-1bvvk8o"><optgroup label="Recommended (install via: ollama pull MODEL_NAME)"></optgroup><optgroup label="Other Models"></optgroup></select> <!></div> <details class="model-details svelte-1bvvk8o"><summary class="model-details-summary svelte-1bvvk8o">Ollama Model Capabilities</summary> <div class="model-table-wrapper svelte-1bvvk8o"><table class="model-table svelte-1bvvk8o"><thead class="svelte-1bvvk8o"><tr><th class="svelte-1bvvk8o">Model</th><th class="svelte-1bvvk8o">Context Window</th><th class="svelte-1bvvk8o">Params</th><th class="svelte-1bvvk8o">Strengths</th></tr></thead><tbody class="svelte-1bvvk8o"></tbody></table></div> <p class="model-table-note svelte-1bvvk8o">â = installed on your Ollama server. To install: <code class="svelte-1bvvk8o">ollama pull MODEL_NAME</code></p></details> <!> <button class="btn primary svelte-1bvvk8o">Load Model</button></div>');function Dp(t,e){Pt(e,!0);let n=Me(e,"selectedModel",15),a=Me(e,"error",15),i=Oe(Gt(Vs())),o=Oe(!1),u=Oe(null),d=Oe(Gt([])),g=Oe(!1);ja(()=>{p()});async function p(){A(o,!0),A(u,null);const se=await Do(v(i));A(u,se,!0),A(o,!1),se.connected&&b()}async function b(){A(g,!0);try{const se=await kv(v(i));A(d,se.map(ne=>ne.name),!0)}catch(se){console.error("Failed to load Ollama models:",se),A(d,[],!0)}A(g,!1)}function w(){wv(v(i)),p()}function k(){if(!n()){a("Please select a model");return}e.onload()}function x(se){return v(d).length?v(d).includes(se):!1}const I=Mu();var B=Mp(),R=h(B),X=_(h(R),2),Y=h(X);Y.__change=w;var U=_(Y,2);U.__click=p;var C=h(U),V=_(X,2);{var J=se=>{var ne=wp();let he;var H=h(ne);{var $=ue=>{var ke=yp(),Ke=_($e(ke),2),Ve=h(Ke);ee(()=>K(Ve,`Connected â¢ v${v(u).version??""}`)),T(ue,ke)},fe=ue=>{var ke=bp(),Ke=_($e(ke),2),Ve=h(Ke);ee(()=>K(Ve,`Disconnected: ${v(u).error??""}`)),T(ue,ke)};ae(H,ue=>{v(u).connected?ue($):ue(fe,!1)})}ee(()=>he=Ct(ne,1,"connection-status svelte-1bvvk8o",null,he,{connected:v(u).connected})),T(se,ne)};ae(V,se=>{v(u)&&se(J)})}var F=_(R,2),le=_(h(F),2),xe=h(le);Qt(xe,21,()=>I,yn,(se,ne)=>{var he=kp(),H=h(he),$=_(H);{var fe=Ke=>{var Ve=Nn("â");T(Ke,Ve)},ue=ht(()=>x(v(ne).name));ae($,Ke=>{v(ue)&&Ke(fe)})}var ke={};ee(Ke=>{K(H,`${v(ne).displayName??""} (${v(ne).params??""}) - ${Ke??""}k context `),ke!==(ke=v(ne).name)&&(he.value=(he.__value=v(ne).name)??"")},[()=>(v(ne).contextWindow/1024).toFixed(0)]),T(se,he)});var Ae=_(xe);Qt(Ae,21,()=>hr.filter(se=>!se.recommended),yn,(se,ne)=>{var he=xp(),H=h(he),$=_(H);{var fe=Ke=>{var Ve=Nn("â");T(Ke,Ve)},ue=ht(()=>x(v(ne).name));ae($,Ke=>{v(ue)&&Ke(fe)})}var ke={};ee(Ke=>{K(H,`${v(ne).displayName??""} (${v(ne).params??""}) - ${Ke??""}k context `),ke!==(ke=v(ne).name)&&(he.value=(he.__value=v(ne).name)??"")},[()=>(v(ne).contextWindow/1024).toFixed(0)]),T(se,he)});var ve=_(le,2);{var te=se=>{const ne=ht(()=>hr.find(fe=>fe.name===n()));var he=pr(),H=$e(he);{var $=fe=>{var ue=Ap(),ke=h(ue),Ke=h(ke),Ve=_(ke,2),z=h(Ve),Re=h(z),De=_(z,4),Be=h(De),Tt=_(De,2);{var kt=Ye=>{var et=Sp(),Ft=_($e(et),2),Jt=h(Ft);ee(mn=>K(Jt,mn),[()=>v(ne).tags.join(", ")]),T(Ye,et)};ae(Tt,Ye=>{var et;(et=v(ne).tags)!=null&&et.length&&Ye(kt)})}var Xt=_(Ve,2);{var fn=Ye=>{var et=Tp(),Ft=_(h(et),2),Jt=h(Ft);ee(()=>K(Jt,`ollama pull ${n()??""}`)),T(Ye,et)},Zt=ht(()=>!x(n())),Lt=Ye=>{var et=Ep();T(Ye,et)};ae(Xt,Ye=>{v(Zt)?Ye(fn):Ye(Lt,!1)})}ee(Ye=>{K(Ke,v(ne).description),K(Re,`${Ye??""}k context`),K(Be,`${v(ne).params??""} params`)},[()=>(v(ne).contextWindow/1024).toFixed(0)]),T(fe,ue)};ae(H,fe=>{v(ne)&&fe($)})}T(se,he)};ae(ve,se=>{n()&&se(te)})}var ce=_(F,2),we=_(h(ce),2),re=h(we),me=_(h(re));Qt(me,21,()=>hr,yn,(se,ne)=>{var he=Rp();let H;var $=h(he),fe=h($),ue=_(fe);{var ke=Ye=>{var et=Cp();T(Ye,et)};ae(ue,Ye=>{v(ne).name===n()&&Ye(ke)})}var Ke=_(ue,2);{var Ve=Ye=>{var et=Pp();T(Ye,et)},z=ht(()=>x(v(ne).name));ae(Ke,Ye=>{v(z)&&Ye(Ve)})}var Re=_($),De=h(Re),Be=h(De),Tt=_(Re),kt=h(Tt),Xt=_(Tt),fn=h(Xt);{var Zt=Ye=>{var et=Ip();T(Ye,et)};ae(fn,Ye=>{v(ne).recommended&&Ye(Zt)})}var Lt=_(fn);ee((Ye,et,Ft)=>{H=Ct(he,1,"svelte-1bvvk8o",null,H,Ye),K(fe,`${v(ne).displayName??""} `),K(Be,`${et??""}k`),K(kt,v(ne).params),K(Lt,` ${Ft??""}`)},[()=>({selected:v(ne).name===n(),installed:x(v(ne).name)}),()=>(v(ne).contextWindow/1024).toFixed(0),()=>v(ne).tags.slice(0,2).join(", ")]),T(se,he)});var Se=_(ce,2);{var ie=se=>{var ne=Op(),he=h(ne);ee(()=>K(he,a())),T(se,ne)};ae(Se,se=>{a()&&se(ie)})}var pe=_(Se,2);pe.__click=k,ee(()=>{var se;U.disabled=v(o),K(C,v(o)?"Testing...":"Test"),pe.disabled=!((se=v(u))!=null&&se.connected)||a()}),Di(Y,()=>v(i),se=>A(i,se)),Mi(le,n),T(t,B),It()}Wt(["change","click"]);var jp=M('<span class="progress-percent svelte-r5fnze"> </span>'),Lp=M('<div class="progress-bar svelte-r5fnze"><div class="progress-fill svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-sep svelte-r5fnze">/</span> <span class="progress-total svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span></div>',1),Np=M('<span class="progress-loaded svelte-r5fnze"> </span> <span class="progress-raw svelte-r5fnze" title="Exact bytes"> </span>',1),qp=M('<span class="progress-indeterminate svelte-r5fnze">downloadingâ¦</span>'),Bp=M('<div class="progress-bar svelte-r5fnze"><div class="progress-fill indeterminate svelte-r5fnze"></div></div> <div class="progress-numbers svelte-r5fnze"><!></div>',1),Fp=M('<div class="progress-card svelte-r5fnze"><div class="progress-header svelte-r5fnze"><span class="progress-file svelte-r5fnze"> </span> <!></div> <!></div>'),zp=M('<div class="container center loading-container svelte-r5fnze"><p class="loading-msg svelte-r5fnze"> </p> <!></div>');function Kp(t,e){Pt(e,!0);let n=Me(e,"message",3,""),a=Me(e,"items",19,()=>[]);dn(()=>zn("LoadingProgress"));var i=zp(),o=h(i),u=h(o),d=_(o,2);Qt(d,17,a,yn,(g,p)=>{const b=ht(()=>v(p).total?Rv(v(p).loaded||0,v(p).total):null);var w=Fp(),k=h(w),x=h(k),I=h(x),B=_(x,2);{var R=C=>{var V=jp(),J=h(V);ee(F=>K(J,`${F??""}%`),[()=>v(b).toFixed(1)]),T(C,V)};ae(B,C=>{v(b)!==null&&C(R)})}var X=_(k,2);{var Y=C=>{var V=Lp(),J=$e(V),F=h(J),le=_(J,2),xe=h(le),Ae=h(xe),ve=_(xe,4),te=h(ve),ce=_(ve,2),we=h(ce);ee((re,me,Se,ie,pe)=>{In(F,`width: ${re??""}%`),K(Ae,me),K(te,Se),K(we,`(${ie??""} / ${pe??""} B)`)},[()=>Math.max(v(p).progress??0,.5).toFixed(1),()=>mo(v(p).loaded||0),()=>mo(v(p).total),()=>(v(p).loaded||0).toLocaleString(),()=>v(p).total.toLocaleString()]),T(C,V)},U=C=>{var V=Bp(),J=_($e(V),2),F=h(J);{var le=Ae=>{var ve=Np(),te=$e(ve),ce=h(te),we=_(te,2),re=h(we);ee((me,Se)=>{K(ce,me),K(re,`(${Se??""} B)`)},[()=>mo(v(p).loaded),()=>v(p).loaded.toLocaleString()]),T(Ae,ve)},xe=Ae=>{var ve=qp();T(Ae,ve)};ae(F,Ae=>{v(p).loaded?Ae(le):Ae(xe,!1)})}T(C,V)};ae(X,C=>{v(p).total?C(Y):C(U,!1)})}ee(()=>{il(x,"title",v(p).file),K(I,v(p).file)}),T(g,w)}),ee(()=>K(u,n())),T(t,i),It()}var Up=M('<span class="thinking-tokens svelte-11gjw00"> </span>'),Gp=M('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Thinking...</span> <!></div>'),Wp=M('<div class="thinking-bar active svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> <span class="svelte-11gjw00">Preparing...</span></div>'),Hp=M('<details class="thinking-details svelte-11gjw00"><summary class="thinking-summary svelte-11gjw00"><span class="thinking-icon svelte-11gjw00">ð­</span> Thinking <span class="thinking-token-count svelte-11gjw00"> </span></summary> <div class="thinking-content svelte-11gjw00"> </div></details>'),Vp=M('<div class="gen-status svelte-11gjw00"><span class="gen-dots svelte-11gjw00"><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span><span class="svelte-11gjw00"></span></span> Generating...</div>'),Yp=M('<span class="cursor svelte-11gjw00">|</span>'),Qp=M(" <!>",1),Xp=M('<!> <!> <div class="content svelte-11gjw00"><!></div>',1),Zp=M('<div class="content svelte-11gjw00"> </div>'),Jp=M('<div><div class="role svelte-11gjw00"> </div> <!></div>');function $p(t,e){Pt(e,!0);let n=Me(e,"isLast",3,!1),a=Me(e,"isRunning",3,!1),i=Me(e,"generationPhase",3,null),o=Me(e,"numTokens",3,null);dn(()=>zn(`MessageBubble[${e.msg.role}]`));var u=Jp(),d=h(u),g=h(d),p=_(d,2);{var b=k=>{var x=Xp(),I=$e(x);{var B=F=>{var le=Gp(),xe=_(h(le),4);{var Ae=ve=>{var te=Up(),ce=h(te);ee(()=>K(ce,`${o()??""} tokens`)),T(ve,te)};ae(xe,ve=>{o()&&ve(Ae)})}T(F,le)},R=F=>{var le=Wp();T(F,le)};ae(I,F=>{a()&&n()&&i()==="thinking"?F(B):a()&&n()&&i()==="preparing"&&F(R,1)})}var X=_(I,2);{var Y=F=>{var le=Hp(),xe=h(le),Ae=_(h(xe),2),ve=h(Ae),te=_(xe,2),ce=h(te);ee(we=>{K(ve,`${we??""} words`),K(ce,e.msg.thinking)},[()=>e.msg.thinking.split(/\s+/).length]),T(F,le)};ae(X,F=>{e.msg.thinking&&F(Y)})}var U=_(X,2),C=h(U);{var V=F=>{var le=Vp();T(F,le)},J=F=>{var le=Qp(),xe=$e(le,!0),Ae=_(xe);{var ve=te=>{var ce=Yp();T(te,ce)};ae(Ae,te=>{a()&&n()&&te(ve)})}ee(()=>K(xe,e.msg.content)),T(F,le)};ae(C,F=>{a()&&n()&&!e.msg.content&&i()!=="thinking"?F(V):F(J,!1)})}T(k,x)},w=k=>{var x=Zp(),I=h(x);ee(()=>K(I,e.msg.content)),T(k,x)};ae(p,k=>{e.msg.role==="assistant"?k(b):k(w,!1)})}ee(()=>{Ct(u,1,`bubble ${e.msg.role??""}`,"svelte-11gjw00"),K(g,e.msg.role==="user"?"You":"AI")}),T(t,u),It()}var eh=M('<button><span class="dot svelte-mt5nvh"></span> <span class="cnt svelte-mt5nvh"> </span></button>'),th=M('<span class="edate svelte-mt5nvh"> </span>'),nh=M('<div class="erow svelte-mt5nvh"><button class="einfo svelte-mt5nvh" title="Ask AI about this email"><span class="esubj svelte-mt5nvh"> </span> <span class="emeta svelte-mt5nvh"> <!></span></button> <div class="ebtns svelte-mt5nvh"><button class="abtn ok svelte-mt5nvh" title="Handled">â</button> <button class="abtn no svelte-mt5nvh" title="Dismiss">â</button></div></div>'),rh=M('<button class="bbtn svelte-mt5nvh">All handled</button> <button class="bbtn muted svelte-mt5nvh">Clear group</button>',1),ah=M('<span class="bconf svelte-mt5nvh"> </span> <button class="bbtn svelte-mt5nvh">Cancel</button> <button class="bbtn danger svelte-mt5nvh">Delete</button>',1),sh=M('<div class="detail svelte-mt5nvh"><div class="detail-head svelte-mt5nvh"><button class="back-btn svelte-mt5nvh">â</button> <span class="detail-title svelte-mt5nvh"> </span> <span class="detail-cnt svelte-mt5nvh"> </span></div> <div class="emails svelte-mt5nvh"></div> <div class="batch svelte-mt5nvh"><!></div></div>'),ih=M('<div class="widget svelte-mt5nvh"><div class="summary svelte-mt5nvh"> </div> <div class="chips svelte-mt5nvh"></div> <!></div>');function oh(t,e){Pt(e,!0);let n=Me(e,"pendingData",3,null),a=Oe(null),i=Oe(null);function o(x){A(a,v(a)===x?null:x,!0),A(i,null)}function u(x){return x.split("_").map(I=>I.charAt(0)+I.slice(1).toLowerCase()).join(" ")}function d(x){if(!x)return"";try{return new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function g(x){if(!x)return"";const I=x.replace(/<.*>/,"").trim();return I.length>24?I.slice(0,22)+"â¦":I}var p={toggleGroup:o},b=pr(),w=$e(b);{var k=x=>{var I=ih(),B=h(I),R=h(B),X=_(B,2);Qt(X,20,()=>n().order,C=>C,(C,V)=>{const J=ht(()=>n().groups[V]),F=ht(()=>qo(V)),le=ht(()=>v(a)===V);var xe=eh();let Ae;xe.__click=()=>o(V);let ve;var te=h(xe);let ce;var we=_(te),re=_(we),me=h(re);ee(Se=>{Ae=Ct(xe,1,"chip svelte-mt5nvh",null,Ae,{active:v(le)}),ve=In(xe,"",ve,{"--c":v(F)}),ce=In(te,"",ce,{background:v(F)}),K(we,` ${Se??""} `),K(me,v(J).length)},[()=>u(V)]),T(C,xe)});var Y=_(X,2);{var U=C=>{const V=ht(()=>n().groups[v(a)]),J=ht(()=>qo(v(a)));var F=sh(),le=h(F);let xe;var Ae=h(le);Ae.__click=()=>{A(a,null),A(i,null)};var ve=_(Ae,2),te=h(ve),ce=_(ve,2),we=h(ce),re=_(le,2);Qt(re,21,()=>v(V),se=>se.emailId,(se,ne)=>{var he=nh(),H=h(he);H.__click=()=>{var Be;return(Be=e.onaskai)==null?void 0:Be.call(e,`Tell me about the email "${v(ne).subject}" from ${v(ne).from}`)};var $=h(H),fe=h($),ue=_($,2),ke=h(ue),Ke=_(ke);{var Ve=Be=>{var Tt=th(),kt=h(Tt);ee(Xt=>K(kt,Xt),[()=>d(v(ne).date)]),T(Be,Tt)};ae(Ke,Be=>{v(ne).date&&Be(Ve)})}var z=_(H,2),Re=h(z);Re.__click=()=>{var Be;return(Be=e.onmarkacted)==null?void 0:Be.call(e,v(ne).emailId)};var De=_(Re,2);De.__click=()=>{var Be;return(Be=e.ondismiss)==null?void 0:Be.call(e,v(ne).emailId)},ee(Be=>{K(fe,v(ne).subject),K(ke,Be)},[()=>g(v(ne).from)]),T(se,he)});var me=_(re,2),Se=h(me);{var ie=se=>{var ne=rh(),he=$e(ne);he.__click=()=>v(V).forEach($=>{var fe;return(fe=e.onmarkacted)==null?void 0:fe.call(e,$.emailId)});var H=_(he,2);H.__click=()=>A(i,v(a),!0),T(se,ne)},pe=se=>{var ne=ah(),he=$e(ne),H=h(he),$=_(he,2);$.__click=()=>A(i,null);var fe=_($,2);fe.__click=()=>{var ue;(ue=e.oncleargroup)==null||ue.call(e,v(a)),A(i,null),A(a,null)},ee(()=>K(H,`Remove ${v(V).length??""}?`)),T(se,ne)};ae(Se,se=>{v(i)!==v(a)?se(ie):se(pe,!1)})}ee(se=>{xe=In(le,"",xe,{"border-color":v(J)}),K(te,se),K(we,v(V).length)},[()=>u(v(a))]),T(C,F)};ae(Y,C=>{v(a)&&n().groups[v(a)]&&C(U)})}ee(()=>K(R,`${n().total??""} item${n().total!==1?"s":""} need attention`)),T(x,I)};ae(w,x=>{n()&&n().total>0&&x(k)})}return T(t,b),It(p)}Wt(["click"]);var lh=M('<div class="chip scanning svelte-1ed7zw1"><span class="spinner svelte-1ed7zw1"></span> <span>Scanning...</span></div>'),ch=M('<button class="chip scan-chip svelte-1ed7zw1"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg> Scan Emails</button>'),uh=M('<div class="strip svelte-1ed7zw1"><!></div>');function dh(t,e){let n=Me(e,"hasScanData",3,!1),a=Me(e,"engineReady",3,!1),i=Me(e,"isScanning",3,!1),o=ht(()=>a()&&!n()&&!i()),u=ht(()=>v(o)||i());var d=pr(),g=$e(d);{var p=b=>{var w=uh(),k=h(w);{var x=B=>{var R=lh();T(B,R)},I=B=>{var R=ch();R.__click=function(...X){var Y;(Y=e.onscan)==null||Y.apply(this,X)},T(B,R)};ae(k,B=>{i()?B(x):v(o)&&B(I,1)})}T(b,w)};ae(g,b=>{v(u)&&b(p)})}T(t,d)}Wt(["click"]);var fh=M('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Device</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),vh=M('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Buffer</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),ph=M('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Max Compute Invocations</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),hh=M('<div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Workgroup Storage</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div>'),mh=M('<span class="gpu-feature-tag svelte-1qmgokn"> </span>'),gh=M('<div class="gpu-panel-item full svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn"> </div> <div class="gpu-panel-features svelte-1qmgokn"></div></div>'),_h=M('<div class="gpu-panel svelte-1qmgokn"><div class="gpu-panel-grid svelte-1qmgokn"><div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Status</div> <div class="gpu-panel-value ok svelte-1qmgokn">Active</div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Vendor</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <div class="gpu-panel-item svelte-1qmgokn"><div class="gpu-panel-label svelte-1qmgokn">Architecture</div> <div class="gpu-panel-value svelte-1qmgokn"> </div></div> <!> <!> <!> <!> <!></div></div>');function yh(t,e){Pt(e,!0),dn(()=>zn("GpuPanel"));var n=_h(),a=h(n),i=_(h(a),2),o=_(h(i),2),u=h(o),d=_(i,2),g=_(h(d),2),p=h(g),b=_(d,2);{var w=C=>{var V=fh(),J=_(h(V),2),F=h(J);ee(()=>K(F,e.gpuInfo.device)),T(C,V)};ae(b,C=>{e.gpuInfo.device&&e.gpuInfo.device!=="unknown"&&C(w)})}var k=_(b,2);{var x=C=>{var V=vh(),J=_(h(V),2),F=h(J);ee(le=>K(F,le),[()=>Lo(e.gpuInfo.limits.maxBufferSize)]),T(C,V)};ae(k,C=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxBufferSize&&C(x)})}var I=_(k,2);{var B=C=>{var V=ph(),J=_(h(V),2),F=h(J);ee(()=>K(F,e.gpuInfo.limits.maxComputeInvocationsPerWorkgroup)),T(C,V)};ae(I,C=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxComputeInvocationsPerWorkgroup&&C(B)})}var R=_(I,2);{var X=C=>{var V=hh(),J=_(h(V),2),F=h(J);ee(le=>K(F,le),[()=>Lo(e.gpuInfo.limits.maxComputeWorkgroupStorageSize)]),T(C,V)};ae(R,C=>{var V;(V=e.gpuInfo.limits)!=null&&V.maxComputeWorkgroupStorageSize&&C(X)})}var Y=_(R,2);{var U=C=>{var V=gh(),J=h(V),F=h(J),le=_(J,2);Qt(le,21,()=>e.gpuInfo.features,yn,(xe,Ae)=>{var ve=mh(),te=h(ve);ee(()=>K(te,v(Ae))),T(xe,ve)}),ee(()=>K(F,`Features (${e.gpuInfo.features.length??""})`)),T(C,V)};ae(Y,C=>{var V;(V=e.gpuInfo.features)!=null&&V.length&&C(U)})}ee(()=>{K(u,e.gpuInfo.vendor),K(p,e.gpuInfo.architecture)}),T(t,n),It()}var bh=M('<button class="gpu-badge svelte-1ktw27c"> </button>'),wh=M('<span class="backend-badge svelte-1ktw27c">ð¦ Ollama</span>'),kh=M('<span class="stats svelte-1ktw27c"> </span>'),xh=M('<span class="stats preparing svelte-1ktw27c">preparing...</span>'),Sh=M('<span class="stats preparing svelte-1ktw27c"> </span>'),Th=M('<span class="stats svelte-1ktw27c"> </span>'),Eh=M('<div class="empty svelte-1ktw27c">Send a message to start chatting.</div>'),Ah=M('<button class="btn svelte-1ktw27c">Stop</button>'),Ch=M('<button class="btn primary svelte-1ktw27c">Send</button>'),Ph=M('<div class="chat-wrapper svelte-1ktw27c"><header class="svelte-1ktw27c"><!> <!> <span class="spacer svelte-1ktw27c"></span> <button class="btn small svelte-1ktw27c">Reset</button></header> <!> <div class="messages svelte-1ktw27c"><!> <!></div> <!> <div class="input-row svelte-1ktw27c"><textarea rows="1" placeholder="Type a message..." class="svelte-1ktw27c"></textarea> <!></div></div>');function Ih(t,e){Pt(e,!0),dn(()=>zn("ChatView"));let n=Me(e,"messages",19,()=>[]),a=Me(e,"pendingData",3,null),i=Me(e,"hasScanData",3,!1),o=Me(e,"engineReady",3,!1),u=Me(e,"isScanning",3,!1),d=Me(e,"isRunning",3,!1),g=Me(e,"tps",3,null),p=Me(e,"numTokens",3,null),b=Me(e,"generationPhase",3,null),w=Me(e,"gpuInfo",3,null),k=Me(e,"backend",3,"webgpu"),x=Me(e,"chatContainer",15),I=Oe(""),B=Oe(!1);function R(ue){ue.key==="Enter"&&!ue.shiftKey&&(ue.preventDefault(),X())}function X(){const ue=v(I).trim();!ue||d()||(A(I,""),e.onsend(ue))}function Y(ue){ue&&!d()&&e.onsend(ue)}var U=Ph(),C=h(U),V=h(C);{var J=ue=>{var ke=bh();ke.__click=()=>A(B,!v(B));var Ke=h(ke);ee(()=>K(Ke,`WebGPU ${v(B)?"â²":"â¼"}`)),T(ue,ke)},F=ue=>{var ke=wh();T(ue,ke)};ae(V,ue=>{w()?ue(J):k()==="ollama"&&ue(F,1)})}var le=_(V,2);{var xe=ue=>{var ke=kh(),Ke=h(ke);ee((Ve,z)=>K(Ke,`${p()??""} tokens in ${Ve??""}s
        (${z??""} tok/s)`),[()=>(p()/g()).toFixed(1),()=>g().toFixed(1)]),T(ue,ke)},Ae=ue=>{var ke=xh();T(ue,ke)},ve=ue=>{var ke=Sh(),Ke=h(ke);ee(Ve=>K(Ke,`thinking... ${Ve??""}`),[()=>g()?`${g().toFixed(0)} tok/s`:""]),T(ue,ke)},te=ue=>{var ke=Th(),Ke=h(ke);ee(Ve=>K(Ke,`${Ve??""} tok/s`),[()=>g().toFixed(1)]),T(ue,ke)};ae(le,ue=>{g()&&!d()?ue(xe):d()&&b()==="preparing"?ue(Ae,1):d()&&b()==="thinking"?ue(ve,2):g()&&d()&&ue(te,3)})}var ce=_(le,4);ce.__click=function(...ue){var ke;(ke=e.onreset)==null||ke.apply(this,ue)};var we=_(C,2);{var re=ue=>{yh(ue,{get gpuInfo(){return w()}})};ae(we,ue=>{v(B)&&w()&&ue(re)})}var me=_(we,2),Se=h(me);{var ie=ue=>{var ke=Eh();T(ue,ke)};ae(Se,ue=>{n().length===0&&!(a()&&a().total>0)&&ue(ie)})}var pe=_(Se,2);Qt(pe,17,n,yn,(ue,ke,Ke)=>{var Ve=pr(),z=$e(Ve);{var Re=Be=>{oh(Be,{get pendingData(){return v(ke).pendingData},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},get oncleargroup(){return e.oncleargroup},onaskai:Y})},De=Be=>{{let Tt=ht(()=>Ke===n().length-1);$p(Be,{get msg(){return v(ke)},get isLast(){return v(Tt)},get isRunning(){return d()},get generationPhase(){return b()},get numTokens(){return p()}})}};ae(z,Be=>{v(ke).type==="dashboard"?Be(Re):Be(De,!1)})}T(ue,Ve)}),Ou(me,ue=>x(ue),()=>x());var se=_(me,2);dh(se,{get hasScanData(){return i()},get engineReady(){return o()},get isScanning(){return u()},get onscan(){return e.onscan}});var ne=_(se,2),he=h(ne);he.__keydown=R;var H=_(he,2);{var $=ue=>{var ke=Ah();ke.__click=function(...Ke){var Ve;(Ve=e.onstop)==null||Ve.apply(this,Ke)},T(ue,ke)},fe=ue=>{var ke=Ch();ke.__click=X,ee(Ke=>ke.disabled=Ke,[()=>!v(I).trim()]),T(ue,ke)};ae(H,ue=>{d()?ue($):ue(fe,!1)})}ee(()=>{ce.disabled=d(),he.disabled=d()}),Di(he,()=>v(I),ue=>A(I,ue)),T(t,U),It()}Wt(["click","keydown"]);var Rh=M('<div class="container center svelte-1bi93vx"><!> <!></div>');function Oh(t,e){Pt(e,!0);const n=!!navigator.gpu,a=Du();let i=Oe(Gt(localStorage.getItem("aiBackend")||"webgpu"));function o(){const H=localStorage.getItem("selectedModel");return H||(v(i)==="webgpu"?Pr[0].id:hr[0].name)}let u=Oe(Gt(o())),d=Oe(null),g=Oe(null),p=Oe(""),b=Oe(Gt([])),w=Oe(Gt([])),k=Oe(!1),x=Oe(null),I=Oe(null),B=Oe(null),R=Oe(null),X=Oe(null),Y=Oe(null),U=Oe(!1),C=Oe(!1),V=!1;dn(()=>{a.check(),a.isReady&&J();const H=a.onMessage($=>{switch($.status){case"webgpu-info":A(R,$.data,!0);break;case"loading":A(d,"loading"),A(p,$.data,!0);break;case"initiate":A(b,[...v(b),$],!0);break;case"progress":A(b,v(b).map(fe=>fe.file===$.file?{...fe,...$}:fe),!0);break;case"done":A(b,v(b).filter(fe=>fe.file!==$.file),!0);break;case"ready":A(d,"ready"),J();break;case"start":if(!v(k))break;A(X,$.phase||"preparing",!0),A(w,[...v(w),{role:"assistant",content:"",thinking:""}],!0);break;case"phase":if(!v(k))break;A(X,$.phase,!0);break;case"thinking":{if(!v(k))break;A(x,$.tps,!0),A(I,$.numTokens,!0);const fe=v(w)[v(w).length-1];A(w,[...v(w).slice(0,-1),{...fe,thinking:(fe.thinking||"")+$.content}],!0),ce();break}case"thinking-done":{if(!v(k))break;A(x,$.tps,!0),A(I,$.numTokens,!0);const fe=v(w)[v(w).length-1];A(w,[...v(w).slice(0,-1),{...fe,thinking:$.content}],!0);break}case"update":{if(!v(k))break;A(x,$.tps,!0),A(I,$.numTokens,!0);const fe=v(w)[v(w).length-1];A(w,[...v(w).slice(0,-1),{...fe,content:fe.content+$.output}],!0),ce();break}case"complete":if(!v(k))break;$.tps!==void 0&&A(x,$.tps,!0),$.numTokens!==void 0&&A(I,$.numTokens,!0),A(k,!1),A(X,null),F();break;case"error":A(g,$.data,!0),v(d)==="loading"&&A(d,null),v(k)&&(A(k,!1),A(X,null));break}});return()=>H()});async function J(){if(!(V||v(w).length>0))try{const H=await lc();A(Y,H,!0),H&&(V=!0,A(w,[{role:"assistant",type:"dashboard",pendingData:H}],!0),ce());const $=await No();A(U,$.classified>0)}catch{}}async function F(){try{const H=await lc();A(Y,H,!0);const $=v(w).findIndex(ue=>ue.type==="dashboard");$!==-1&&(H&&H.total>0?A(w,v(w).map((ue,ke)=>ke===$?{...ue,pendingData:H}:ue),!0):A(w,v(w).filter((ue,ke)=>ke!==$),!0));const fe=await No();A(U,fe.classified>0)}catch{}}async function le(H){await xi(H,"acted"),await F()}async function xe(H){await xi(H,"dismissed"),await F()}async function Ae(H){await Vu(H),await F()}async function ve(H){await dl(H),await F()}async function te(){if(!(v(C)||!a.isReady)){A(C,!0);try{await Hu(a,{count:20}),await F(),v(Y)&&!v(w).some(H=>H.type==="dashboard")&&(A(w,[{role:"assistant",type:"dashboard",pendingData:v(Y)},...v(w)],!0),ce())}catch(H){console.error("Scan failed:",H)}finally{A(C,!1)}}}function ce(){Au().then(()=>{v(B)&&(v(B).scrollTop=v(B).scrollHeight)})}function we(){A(d,"loading"),localStorage.setItem("selectedModel",v(u)),localStorage.setItem("aiBackend",v(i)),v(i)==="ollama"&&A(R,null),a.loadModel(v(u))}ja(()=>{v(i)==="webgpu"&&!Pr.find(H=>H.id===v(u))?A(u,Pr[0].id,!0):v(i)==="ollama"&&!hr.find(H=>H.name===v(u))&&A(u,hr[0].name,!0)});async function re(H){if(!H||v(k))return;A(w,[...v(w),{role:"user",content:H}],!0),A(x,null),A(k,!0);let $=[];try{const ke=/\b(email|mail|inbox|message|sent|sender|from|subject|unread|gmail|pending|action|archive|delete|reply|follow.?up|prioriti|triage|urgent)\b/i.test(H)?await Vv(H):await Hv();ke&&($=[{role:"system",content:ke}])}catch{}const fe=v(w).filter(ue=>ue.type!=="dashboard").map(ue=>({role:ue.role,content:ue.content}));a.generate([...$,...fe]),ce()}function me(){a.interrupt()}function Se(){a.reset(),A(w,[],!0),A(x,null),A(I,null),V=!1,J()}var ie=pr(),pe=$e(ie);{var se=H=>{var $=Rh(),fe=h($);sp(fe,{get isWebGPUAvailable(){return n},get backend(){return v(i)},set backend(Ve){A(i,Ve,!0)}});var ue=_(fe,2);{var ke=Ve=>{_p(Ve,{get gpuInfo(){return v(R)},get error(){return v(g)},onload:we,get selectedModel(){return v(u)},set selectedModel(z){A(u,z,!0)}})},Ke=Ve=>{Dp(Ve,{onload:we,get selectedModel(){return v(u)},set selectedModel(z){A(u,z,!0)},get error(){return v(g)},set error(z){A(g,z,!0)}})};ae(ue,Ve=>{v(i)==="webgpu"?Ve(ke):v(i)==="ollama"&&Ve(Ke,1)})}T(H,$)},ne=H=>{Kp(H,{get message(){return v(p)},get items(){return v(b)}})},he=H=>{Ih(H,{get messages(){return v(w)},get pendingData(){return v(Y)},get hasScanData(){return v(U)},get engineReady(){return a.isReady},get isScanning(){return v(C)},get isRunning(){return v(k)},get tps(){return v(x)},get numTokens(){return v(I)},get generationPhase(){return v(X)},get gpuInfo(){return v(R)},get backend(){return v(i)},onsend:re,onstop:me,onreset:Se,onmarkacted:le,ondismiss:xe,onremove:Ae,oncleargroup:ve,onscan:te,get chatContainer(){return v(B)},set chatContainer($){A(B,$,!0)}})};ae(pe,H=>{v(d)===null?H(se):v(d)==="loading"?H(ne,1):H(he,!1)})}T(t,ie),It()}const vc="https://accounts.google.com/gsi/client",Mh="https://www.googleapis.com/auth/gmail.readonly",fl="me-ai:oauth-token",vl=300*1e3;let qs=null,js=null,ua=0;function Qu(t,e){ua=Date.now()+e*1e3;try{sessionStorage.setItem(fl,JSON.stringify({access_token:t,expires_at:ua}))}catch{}}function Bo(){ua=0;try{sessionStorage.removeItem(fl)}catch{}}function Dh(){try{const t=sessionStorage.getItem(fl);if(!t)return null;const{access_token:e,expires_at:n}=JSON.parse(t);return!e||Date.now()>n-vl?(Bo(),null):(ua=n,{access_token:e})}catch{return Bo(),null}}function jh(){return ua>0&&Date.now()<ua-vl}function Lh(){return ua<=0?0:Math.max(0,ua-vl-Date.now())}function pc(){return new Promise((t,e)=>{if(!qs){e(new Error("Google Auth not initialized."));return}js=n=>{n.error?e(new Error(n.error_description||n.error)):(Qu(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},qs.requestAccessToken({prompt:""})})}function Nh(){return new Promise((t,e)=>{var i,o;if((o=(i=window.google)==null?void 0:i.accounts)!=null&&o.oauth2){t();return}const n=document.querySelector(`script[src="${vc}"]`);if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Google Identity Services")));return}const a=document.createElement("script");a.src=vc,a.async=!0,a.defer=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Google Identity Services")),document.head.appendChild(a)})}async function hc(t){await Nh(),qs=google.accounts.oauth2.initTokenClient({client_id:t,scope:Mh,callback:e=>{js&&(js(e),js=null)}})}function qh(){return new Promise((t,e)=>{if(!qs){e(new Error("Google Auth not initialized. Call initGoogleAuth first."));return}js=n=>{n.error?e(new Error(n.error_description||n.error)):(Qu(n.access_token,n.expires_in),t({access_token:n.access_token,expires_in:n.expires_in}))},qs.requestAccessToken()})}function Bh(t){return Bo(),new Promise(e=>{var n,a;(a=(n=window.google)==null?void 0:n.accounts)!=null&&a.oauth2?google.accounts.oauth2.revoke(t,()=>e()):e()})}const ln="gmail",mc=8,Xu=50,Zu=100;async function Fh(t,{limit:e=Xu,onProgress:n=()=>{},signal:a}={}){var u;const i=await Ge.syncState.get(ln);if(i!=null&&i.historyId)try{return await Wh(t,i,n,a)}catch(d){if(d instanceof cl&&(d.status===404||d.code==="notFound")||((u=d.message)==null?void 0:u.includes("Start history id")))n({phase:"info",message:"History expired, performing full re-sync..."}),await Ge.syncState.delete(ln);else throw d}return await Uh(t,e===0?1/0:e,n,a)}async function zh(t,{limit:e=Xu,onProgress:n=()=>{},signal:a}={}){const i=await Ge.syncState.get(ln);return i!=null&&i.oldestPageToken?await Gh(t,i,e===0?1/0:e,n,a):(n({phase:"done",message:"All messages already synced"}),{added:0,errors:0})}async function Kh(){const t=await Ge.syncState.get(ln);return t?{synced:!0,totalItems:t.totalItems||0,lastSyncAt:t.lastSyncAt,historyId:t.historyId,hasMore:!!t.oldestPageToken}:{synced:!1,totalItems:0,lastSyncAt:null,hasMore:!1}}async function Ju(){await Ge.transaction("rw",[Ge.items,Ge.syncState],async()=>{await Ge.items.where("sourceType").equals(ln).delete(),await Ge.syncState.delete(ln)})}async function Uh(t,e,n,a){n({phase:"counting",message:"Getting mailbox info..."}),Na(a);const i=await Nu(t);n({phase:"listing",message:"Listing messages...",current:0,total:Math.min(i.messagesTotal||e,e)});const o=[];let u,d=null;for(;o.length<e;){Na(a);const w=e-o.length,k=await qu(t,{maxResults:Math.min(Zu,w),pageToken:u}),x=(k.messages||[]).map(I=>I.id);if(o.push(...x),n({phase:"listing",message:`Listed ${o.length} messages...`,current:o.length,total:Math.min(i.messagesTotal||e,e)}),u=k.nextPageToken,!u||x.length===0)break}if(d=u||null,o.length===0)return await Ge.syncState.put({sourceType:ln,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:0,oldestPageToken:null}),{added:0,deleted:0,errors:0};const{added:g,errors:p}=await $u(t,o,n,a),b=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:i.historyId,lastSyncAt:Date.now(),totalItems:b,oldestPageToken:d}),n({phase:"done",message:`Synced ${g} messages`,current:g,total:g}),{added:g,deleted:0,errors:p}}async function Gh(t,e,n,a,i){a({phase:"listing",message:"Loading more messages...",current:0}),Na(i);const o=[];let u=e.oldestPageToken,d=null;for(;o.length<n;){Na(i);const w=n-o.length,k=await qu(t,{maxResults:Math.min(Zu,w),pageToken:u}),x=(k.messages||[]).map(I=>I.id);if(o.push(...x),a({phase:"listing",message:`Listed ${o.length} more messages...`,current:o.length}),u=k.nextPageToken,!u||x.length===0)break}if(d=u||null,o.length===0)return await Ge.syncState.update(ln,{oldestPageToken:null,lastSyncAt:Date.now()}),a({phase:"done",message:"All messages synced"}),{added:0,errors:0};const{added:g,errors:p}=await $u(t,o,a,i),b=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.update(ln,{totalItems:b,lastSyncAt:Date.now(),oldestPageToken:d}),a({phase:"done",message:d?`Downloaded ${g} more (more available)`:`Downloaded ${g} more (all synced)`,current:b,total:b}),{added:g,errors:p}}async function Wh(t,e,n,a){n({phase:"syncing",message:"Checking for changes..."}),Na(a);let i=0,o=0,u=0,d,g=e.historyId;do{Na(a);const b=await jv(t,{startHistoryId:e.historyId,pageToken:d});if(g=b.historyId||g,d=b.nextPageToken,!!b.history){for(const w of b.history){if(w.messagesAdded){const k=w.messagesAdded.map(I=>I.message.id),x=[...new Set(k.filter(I=>I))];if(x.length>0){const I=await Promise.allSettled(x.map(R=>Bu(t,R))),B=[];for(const R of I)R.status==="fulfilled"?B.push(ed(R.value)):u++;B.length>0&&(await Ge.items.bulkPut(B),await td(B),i+=B.length)}}if(w.messagesDeleted){const k=w.messagesDeleted.map(x=>ju(ln,x.message.id)).filter(x=>x);k.length>0&&(await Ge.items.bulkDelete(k),o+=k.length)}}n({phase:"syncing",message:`Changes: +${i} -${o}`,current:i+o})}}while(d);const p=await Ge.items.where("sourceType").equals(ln).count();return await Ge.syncState.put({sourceType:ln,historyId:g,lastSyncAt:Date.now(),totalItems:p,oldestPageToken:e.oldestPageToken}),n({phase:"done",message:i===0&&o===0?"Already up to date":`Synced: +${i} -${o}`,current:p,total:p}),{added:i,deleted:o,errors:u}}async function $u(t,e,n,a){n({phase:"downloading",message:"Downloading messages...",current:0,total:e.length});let i=0,o=0;for(let u=0;u<e.length;u+=mc){Na(a);const d=e.slice(u,u+mc),g=await Promise.allSettled(d.map(b=>Bu(t,b))),p=[];for(const b of g)b.status==="fulfilled"?p.push(ed(b.value)):o++;p.length>0&&(await Ge.items.bulkPut(p),await td(p)),i+=p.length,n({phase:"downloading",message:`Downloaded ${i} of ${e.length} messages`,current:i,total:e.length})}return{added:i,errors:o}}function ed(t){const e=na(t,"From"),n=na(t,"To"),a=na(t,"Cc"),i=na(t,"Subject")||"(no subject)",o=na(t,"Date"),u=na(t,"Message-ID"),d=na(t,"In-Reply-To"),g=na(t,"References");let p;try{p=o?new Date(o).getTime():t.internalDate?Number(t.internalDate):Date.now()}catch{p=Date.now()}return{id:ju(ln,t.id),sourceType:ln,sourceId:t.id,threadKey:`gmail:${t.threadId}`,type:"email",from:e,to:n,cc:a,subject:i,snippet:t.snippet||"",body:Lv(t),htmlBody:Nv(t),date:p,labels:t.labelIds||[],messageId:u,inReplyTo:d,references:g,raw:t,syncedAt:Date.now()}}async function td(t){const e=new Map;for(const n of t)for(const a of[n.from,n.to,n.cc]){if(!a)continue;const i=a.split(",").map(o=>o.trim()).filter(Boolean);for(const o of i){const u=Hh(o);u&&!e.has(u.email)&&e.set(u.email,{...u,date:n.date})}}for(const[n,{name:a,date:i}]of e)try{const o=await Ge.contacts.where("email").equals(n).first();if(o){const u={};a&&!o.name&&(u.name=a),i>(o.lastSeen||0)&&(u.lastSeen=i),Object.keys(u).length>0&&await Ge.contacts.update(o.id,u)}else await Ge.contacts.add({email:n,name:a||"",firstSeen:i,lastSeen:i})}catch(o){(o==null?void 0:o.name)!=="ConstraintError"&&console.debug("Contact upsert skipped:",n,(o==null?void 0:o.message)||o)}}function Hh(t){if(!t)return null;const e=t.match(/<([^>]+)>/);if(e){const a=e[1].toLowerCase().trim(),i=t.slice(0,t.indexOf("<")).replace(/"/g,"").trim();return{email:a,name:i}}const n=t.toLowerCase().trim();return n.includes("@")?{email:n,name:""}:null}function Na(t){if(t!=null&&t.aborted)throw new DOMException("Sync was cancelled","AbortError")}var Vh=M(`<div class="setup-container svelte-1mdd5r2"><div class="setup-card svelte-1mdd5r2"><h2 class="svelte-1mdd5r2">Connect Gmail</h2> <p class="setup-intro svelte-1mdd5r2">To access Gmail from the browser, you need a Google Cloud OAuth Client ID.
      This stays in your browser â no data is sent to any server.</p> <div class="setup-steps svelte-1mdd5r2"><div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">1</span> <div><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create a Google Cloud project</a> (or use an existing one)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">2</span> <div><a href="https://console.cloud.google.com/apis/library/gmail.googleapis.com" target="_blank" rel="noopener" class="svelte-1mdd5r2">Enable the Gmail API</a> for your project</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">3</span> <div><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noopener" class="svelte-1mdd5r2">Create an OAuth 2.0 Client ID</a> (type: <strong>Web application</strong>)</div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">4</span> <div><p class="step-label svelte-1mdd5r2">Add these URLs to your OAuth client. Click to copy:</p> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized JavaScript origins (no trailing slash):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <div class="url-section svelte-1mdd5r2"><span class="url-section-title svelte-1mdd5r2">Authorized redirect URIs (add all three):</span> <div class="url-chips svelte-1mdd5r2"><button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button> <button class="url-chip svelte-1mdd5r2"><code class="svelte-1mdd5r2"></code> <span class="copy-icon svelte-1mdd5r2"> </span></button></div></div> <p class="step-hint svelte-1mdd5r2">Both localhost (dev) and GitHub Pages (prod) are needed. The /me-ai/ path
            is required because the app is deployed at a subpath. Changes may take a
            few minutes to propagate after saving.</p></div></div> <div class="step svelte-1mdd5r2"><span class="step-num svelte-1mdd5r2">5</span> <div>Copy the <strong>Client ID</strong> and paste it below</div></div></div> <div class="client-id-form svelte-1mdd5r2"><input type="text" placeholder="xxxx.apps.googleusercontent.com" class="svelte-1mdd5r2"/> <button class="btn primary svelte-1mdd5r2">Save</button></div></div></div>`);function Yh(t,e){Pt(e,!0);let n=Me(e,"clientIdInput",15);dn(()=>zn("SetupGuide"));let a=Oe(null);async function i($){try{await navigator.clipboard.writeText($),A(a,$,!0),setTimeout(()=>{A(a,null)},1500)}catch{const fe=document.createElement("input");fe.value=$,document.body.appendChild(fe),fe.select(),document.execCommand("copy"),document.body.removeChild(fe),A(a,$,!0),setTimeout(()=>{A(a,null)},1500)}}const o="http://localhost:5173",u="https://cypherkitty.github.io",d="https://cypherkitty.github.io/me-ai/";var g=Vh(),p=h(g),b=_(h(p),4),w=_(h(b),6),k=_(h(w),2),x=_(h(k),2),I=_(h(x),2),B=h(I);B.__click=()=>i(o);var R=h(B);R.textContent="http://localhost:5173";var X=_(R,2),Y=h(X),U=_(B,2);U.__click=()=>i(u);var C=h(U);C.textContent="https://cypherkitty.github.io";var V=_(C,2),J=h(V),F=_(x,2),le=_(h(F),2),xe=h(le);xe.__click=()=>i(o);var Ae=h(xe);Ae.textContent="http://localhost:5173";var ve=_(Ae,2),te=h(ve),ce=_(xe,2);ce.__click=()=>i(u);var we=h(ce);we.textContent="https://cypherkitty.github.io";var re=_(we,2),me=h(re),Se=_(ce,2);Se.__click=()=>i(d);var ie=h(Se);ie.textContent="https://cypherkitty.github.io/me-ai/";var pe=_(ie,2),se=h(pe),ne=_(b,2),he=h(ne);he.__keydown=$=>$.key==="Enter"&&e.onsave();var H=_(he,2);H.__click=function(...$){var fe;(fe=e.onsave)==null||fe.apply(this,$)},ee($=>{K(Y,v(a)===o?"â":"â§"),K(J,v(a)===u?"â":"â§"),K(te,v(a)===o?"â":"â§"),K(me,v(a)===u?"â":"â§"),K(se,v(a)===d?"â":"â§"),H.disabled=$},[()=>!n().trim()]),Di(he,n),T(t,g),It()}Wt(["click","keydown"]);function Qh(t){const e=typeof t=="object"&&t!==null?t:null,n=(e==null?void 0:e.message)||String(t||""),a=e instanceof cl?e.status:null;if(n.includes("has not been used in project")||n.includes("is disabled")){const i=n.match(/project\s+(\d+)/),o=i==null?void 0:i[1];return{title:"Gmail API not enabled",description:"The Gmail API needs to be enabled in your Google Cloud project before it can be used.",fix:"Click the link below to enable it, then wait ~30 seconds and retry.",link:{url:o?`https://console.developers.google.com/apis/api/gmail.googleapis.com/overview?project=${o}`:"https://console.cloud.google.com/apis/library/gmail.googleapis.com",label:"Enable Gmail API"}}}return a===401||n.includes("Invalid Credentials")||n.includes("invalid_token")?{title:"Session expired",description:"Your access token has expired or is invalid.",fix:"Sign out and sign in again to get a fresh token.",action:"signout"}:a===403||n.includes("insufficient")&&n.includes("scope")?{title:"Insufficient permissions",description:"The app doesn't have the required permissions to access Gmail.",fix:"Sign out, sign in again, and make sure to grant the Gmail read permission in the consent screen.",action:"signout"}:n.includes("access_denied")||n.includes("user_denied")?{title:"Access denied",description:"You declined the Gmail permission request.",fix:"Click 'Sign in with Google' again and grant the Gmail read-only permission when prompted."}:n.includes("popup")||n.includes("blocked")?{title:"Popup blocked",description:"The sign-in popup was blocked by your browser.",fix:"Allow popups for localhost:5173 in your browser settings, then try again."}:a===429||n.includes("Rate Limit")||n.includes("quota")?{title:"Rate limit exceeded",description:"Too many requests to the Gmail API.",fix:"Wait a minute and try again."}:n.includes("Failed to fetch")||n.includes("NetworkError")||n.includes("network")?{title:"Network error",description:"Could not reach the Gmail API.",fix:"Check your internet connection and try again."}:{title:"Something went wrong",description:n,fix:null}}var Xh=M('<div class="error-card-header svelte-14buhqq"><div class="error-card-title svelte-14buhqq"> </div> <button class="error-dismiss svelte-14buhqq">â</button></div>'),Zh=M('<div class="error-card-title svelte-14buhqq"> </div>'),Jh=M('<p class="error-card-fix svelte-14buhqq"> </p>'),$h=M('<a class="error-card-link svelte-14buhqq" target="_blank" rel="noopener"> </a>'),em=M('<button class="btn small error-action svelte-14buhqq">Sign Out & Retry</button>'),tm=M('<div class="error-card svelte-14buhqq"><!> <p class="error-card-desc svelte-14buhqq"> </p> <!> <!> <!></div>');function nd(t,e){Pt(e,!0);let n=Me(e,"ondismiss",3,null),a=Me(e,"onsignout",3,null),i=ht(()=>Qh(e.error));dn(()=>zn("ErrorCard"));var o=tm(),u=h(o);{var d=X=>{var Y=Xh(),U=h(Y),C=h(U),V=_(U,2);V.__click=function(...J){var F;(F=n())==null||F.apply(this,J)},ee(()=>K(C,v(i).title)),T(X,Y)},g=X=>{var Y=Zh(),U=h(Y);ee(()=>K(U,v(i).title)),T(X,Y)};ae(u,X=>{n()?X(d):X(g,!1)})}var p=_(u,2),b=h(p),w=_(p,2);{var k=X=>{var Y=Jh(),U=h(Y);ee(()=>K(U,v(i).fix)),T(X,Y)};ae(w,X=>{v(i).fix&&X(k)})}var x=_(w,2);{var I=X=>{var Y=$h(),U=h(Y);ee(()=>{il(Y,"href",v(i).link.url),K(U,`${v(i).link.label??""} â`)}),T(X,Y)};ae(x,X=>{v(i).link&&X(I)})}var B=_(x,2);{var R=X=>{var Y=em();Y.__click=function(...U){var C;(C=a())==null||C.apply(this,U)},T(X,Y)};ae(B,X=>{v(i).action==="signout"&&a()&&X(R)})}ee(()=>K(b,v(i).description)),T(t,o),It()}Wt(["click"]);var nm=M('<span class="spinner svelte-nyqevv"></span> Signing in...',1),rm=sl('<svg viewBox="0 0 24 24" width="18" height="18" class="google-icon svelte-nyqevv"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path></svg> Sign in with Google',1),am=M(`<div class="auth-container svelte-nyqevv"><div class="auth-card svelte-nyqevv"><h2 class="svelte-nyqevv">Gmail Dashboard</h2> <p class="auth-desc svelte-nyqevv">Sign in with your Google account to browse your Gmail messages.
      Read-only access â nothing is modified.</p> <!> <button class="btn google-btn svelte-nyqevv"><!></button> <p class="auth-hint svelte-nyqevv">Popup blocked? Use <a href="/oauth-redirect.html" class="auth-link svelte-nyqevv">Sign in with Google (redirect)</a> â works in Cursor and other environments without popups.</p> <div class="client-id-info svelte-nyqevv"><span class="client-id-label">Client ID:</span> <span class="client-id-value svelte-nyqevv"> </span> <button class="btn-link svelte-nyqevv">Change</button></div></div></div>`);function sm(t,e){Pt(e,!0);let n=Me(e,"error",3,null),a=Me(e,"loadingAuth",3,!1);dn(()=>zn("AuthCard"));var i=am(),o=h(i),u=_(h(o),4);{var d=R=>{nd(R,{get error(){return n()},get onsignout(){return e.onsignout}})};ae(u,R=>{n()&&R(d)})}var g=_(u,2);g.__click=function(...R){var X;(X=e.onsignin)==null||X.apply(this,R)};var p=h(g);{var b=R=>{var X=nm();T(R,X)},w=R=>{var X=rm();T(R,X)};ae(p,R=>{a()?R(b):R(w,!1)})}var k=_(g,4),x=_(h(k),2),I=h(x),B=_(x,2);B.__click=function(...R){var X;(X=e.onclear)==null||X.apply(this,R)},ee(R=>{g.disabled=a(),K(I,`${R??""}...`)},[()=>e.clientId.slice(0,20)]),T(t,i),It()}Wt(["click"]);var im=M('<span class="profile-email svelte-1w180uc">Loading profile...</span>'),om=M('<span class="profile-email svelte-1w180uc"> </span> <span class="profile-stats svelte-1w180uc"> </span>',1),lm=M('<div class="profile-card svelte-1w180uc"><div class="profile-avatar svelte-1w180uc"> </div> <div class="profile-info svelte-1w180uc"><!></div> <button class="btn small svelte-1w180uc">Sign Out</button></div>');function cm(t,e){Pt(e,!0);let n=Me(e,"profile",3,null),a=Me(e,"loadingProfile",3,!1);dn(()=>zn("ProfileCard"));var i=lm(),o=h(i),u=h(o),d=_(o,2),g=h(d);{var p=k=>{var x=im();T(k,x)},b=k=>{var x=om(),I=$e(x),B=h(I),R=_(I,2),X=h(R);ee((Y,U)=>{K(B,n().emailAddress),K(X,`${Y??""} messages
        Â· ${U??""} threads`)},[()=>{var Y;return((Y=n().messagesTotal)==null?void 0:Y.toLocaleString())||"?"},()=>{var Y;return((Y=n().threadsTotal)==null?void 0:Y.toLocaleString())||"?"}]),T(k,x)};ae(g,k=>{a()?k(p):n()&&k(b,1)})}var w=_(d,2);w.__click=function(...k){var x;(x=e.onsignout)==null||x.apply(this,k)},ee(k=>K(u,k),[()=>n()?zu(n().emailAddress):"?"]),T(t,i),It()}Wt(["click"]);var um=M('<span class="spinner svelte-1ds3j4k"></span>'),dm=sl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m0 0a9 9 0 0 1 9-9m-9 9a9 9 0 0 0 9 9" class="svelte-1ds3j4k"></path></svg>'),fm=M('<span class="sync-meta svelte-1ds3j4k"> <!></span>'),vm=M('<span class="sync-meta svelte-1ds3j4k">Not synced yet</span>'),pm=M('<button class="btn-icon svelte-1ds3j4k" title="Clear local data"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1ds3j4k"><path d="M3 6h18M8 6V4h8v2m1 0v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V6h10z" class="svelte-1ds3j4k"></path></svg></button>'),hm=M('<option class="svelte-1ds3j4k"> </option>'),mm=M('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),gm=M('<button class="btn sync-btn svelte-1ds3j4k"> </button> <!>',1),_m=M('<button class="btn sync-btn primary svelte-1ds3j4k"> </button>'),ym=M('<div class="sync-progress svelte-1ds3j4k"><div class="progress-bar svelte-1ds3j4k"><div></div></div> <span class="progress-text svelte-1ds3j4k"> </span></div>'),bm=M('<div class="clear-confirm svelte-1ds3j4k"><span class="svelte-1ds3j4k">Delete all locally stored emails?</span> <div class="clear-actions svelte-1ds3j4k"><button class="btn small svelte-1ds3j4k">Cancel</button> <button class="btn small danger svelte-1ds3j4k">Delete</button></div></div>'),wm=M('<div class="sync-card svelte-1ds3j4k"><div class="sync-header svelte-1ds3j4k"><div class="sync-icon svelte-1ds3j4k"><!></div> <div class="sync-info svelte-1ds3j4k"><span class="sync-title svelte-1ds3j4k">Local Storage</span> <!></div> <div class="sync-actions svelte-1ds3j4k"><!></div></div> <div class="sync-controls svelte-1ds3j4k"><div class="limit-group svelte-1ds3j4k"><label class="limit-label svelte-1ds3j4k" for="sync-limit">Batch:</label> <select id="sync-limit" class="limit-select svelte-1ds3j4k"></select></div> <div class="sync-buttons svelte-1ds3j4k"><!></div></div> <!> <!></div>');function km(t,e){Pt(e,!0),dn(()=>zn("SyncStatus"));let n=Me(e,"syncStatus",3,null),a=Me(e,"syncProgress",3,null),i=Me(e,"isSyncing",3,!1),o=Oe(!1),u=Oe(50);const d=[{value:50,label:"50"},{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"},{value:0,label:"All"}];function g(ie){if(!ie)return"never";const pe=Math.floor((Date.now()-ie)/1e3);if(pe<60)return"just now";const se=Math.floor(pe/60);if(se<60)return`${se}m ago`;const ne=Math.floor(se/60);return ne<24?`${ne}h ago`:`${Math.floor(ne/24)}d ago`}function p(){var ie,pe;return!((ie=a())!=null&&ie.total)||!((pe=a())!=null&&pe.current)?0:Math.round(a().current/a().total*100)}var b=wm(),w=h(b),k=h(w),x=h(k);{var I=ie=>{var pe=um();T(ie,pe)},B=ie=>{var pe=dm();T(ie,pe)};ae(x,ie=>{i()?ie(I):ie(B,!1)})}var R=_(k,2),X=_(h(R),2);{var Y=ie=>{var pe=fm(),se=h(pe),ne=_(se);{var he=$=>{var fe=Nn("Â· more available");T($,fe)},H=$=>{var fe=Nn("Â· all synced");T($,fe)};ae(ne,$=>{n().hasMore?$(he):$(H,!1)})}ee(($,fe)=>K(se,`${$??""} emails stored
          Â· synced ${fe??""} `),[()=>n().totalItems.toLocaleString(),()=>g(n().lastSyncAt)]),T(ie,pe)},U=ie=>{var pe=vm();T(ie,pe)};ae(X,ie=>{var pe;(pe=n())!=null&&pe.synced?ie(Y):ie(U,!1)})}var C=_(R,2),V=h(C);{var J=ie=>{var pe=pm();pe.__click=()=>A(o,!v(o)),T(ie,pe)};ae(V,ie=>{var pe;(pe=n())!=null&&pe.synced&&!i()&&ie(J)})}var F=_(w,2),le=h(F),xe=_(h(le),2);Qt(xe,21,()=>d,yn,(ie,pe)=>{var se=hm(),ne=h(se),he={};ee(()=>{K(ne,v(pe).label),he!==(he=v(pe).value)&&(se.value=(se.__value=v(pe).value)??"")}),T(ie,se)});var Ae=_(le,2),ve=h(Ae);{var te=ie=>{var pe=gm(),se=$e(pe);se.__click=()=>e.onsync(v(u));var ne=h(se),he=_(se,2);{var H=$=>{var fe=mm();fe.__click=()=>e.onsyncmore(v(u));var ue=h(fe);ee(()=>{fe.disabled=i(),K(ue,i()?"Loading...":"Sync More")}),T($,fe)};ae(he,$=>{n().hasMore&&$(H)})}ee(()=>{se.disabled=i(),K(ne,i()?"Syncing...":"Sync New")}),T(ie,pe)},ce=ie=>{var pe=_m();pe.__click=()=>e.onsync(v(u));var se=h(pe);ee(()=>{pe.disabled=i(),K(se,i()?"Syncing...":"Download Emails")}),T(ie,pe)};ae(ve,ie=>{var pe;(pe=n())!=null&&pe.synced?ie(te):ie(ce,!1)})}var we=_(F,2);{var re=ie=>{var pe=ym(),se=h(pe),ne=h(se);let he,H;var $=_(se,2),fe=h($);ee(ue=>{he=Ct(ne,1,"progress-fill svelte-1ds3j4k",null,he,{indeterminate:!a().total}),H=In(ne,"",H,ue),K(fe,a().message||"Syncing...")},[()=>({width:`${p()??""}%`})]),T(ie,pe)};ae(we,ie=>{i()&&a()&&ie(re)})}var me=_(we,2);{var Se=ie=>{var pe=bm(),se=_(h(pe),2),ne=h(se);ne.__click=()=>A(o,!1);var he=_(ne,2);he.__click=()=>{e.onclear(),A(o,!1)},T(ie,pe)};ae(me,ie=>{v(o)&&ie(Se)})}ee(()=>xe.disabled=i()),Mi(xe,()=>v(u),ie=>A(u,ie)),T(t,b),It()}Wt(["click"]);var xm=M('<button class="message-row svelte-y2uamw"><div class="msg-avatar svelte-y2uamw"> </div> <div class="msg-body svelte-y2uamw"><div class="msg-top svelte-y2uamw"><span class="msg-from svelte-y2uamw"> </span> <span class="msg-date svelte-y2uamw"> </span></div> <div class="msg-subject svelte-y2uamw"> </div> <div class="msg-snippet svelte-y2uamw"> </div></div></button>'),Sm=M('<div class="message-list svelte-y2uamw"></div>');function Tm(t,e){Pt(e,!0);let n=Me(e,"messages",19,()=>[]);dn(()=>zn("MessageList"));var a=Sm();Qt(a,21,n,yn,(i,o)=>{var u=xm();u.__click=()=>e.onselect(v(o));var d=h(u),g=h(d),p=_(d,2),b=h(p),w=h(b),k=h(w),x=_(w,2),I=h(x),B=_(b,2),R=h(B),X=_(B,2),Y=h(X);ee((U,C,V)=>{K(g,U),K(k,C),K(I,V),K(R,v(o).subject),K(Y,v(o).snippet)},[()=>zu(v(o).from),()=>Fu(v(o).from),()=>ul(v(o).date)]),T(i,u)}),T(t,a),It()}Wt(["click"]);function pl(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Fa=pl();function rd(t){Fa=t}var ba={exec:()=>null};function _t(t,e=""){let n=typeof t=="string"?t:t.source,a={replace:(i,o)=>{let u=typeof o=="string"?o:o.source;return u=u.replace(_n.caret,"$1"),n=n.replace(i,u),a},getRegex:()=>new RegExp(n,e)};return a}var Em=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),_n={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i"),blockquoteBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}>`)},Am=/^(?:[ \t]*(?:\n|$))+/,Cm=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Pm=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ys=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Im=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hl=/ {0,3}(?:[*+-]|\d{1,9}[.)])/,ad=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,sd=_t(ad).replace(/bull/g,hl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Rm=_t(ad).replace(/bull/g,hl).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),ml=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Om=/^[^\n]+/,gl=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Mm=_t(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",gl).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Dm=_t(/^(bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,hl).getRegex(),Li="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",_l=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,jm=_t("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",_l).replace("tag",Li).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),id=_t(ml).replace("hr",Ys).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li).getRegex(),Lm=_t(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",id).getRegex(),yl={blockquote:Lm,code:Cm,def:Mm,fences:Pm,heading:Im,hr:Ys,html:jm,lheading:sd,list:Dm,newline:Am,paragraph:id,table:ba,text:Om},gc=_t("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ys).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li).getRegex(),Nm={...yl,lheading:Rm,table:gc,paragraph:_t(ml).replace("hr",Ys).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",gc).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)])[ \\t]").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Li).getRegex()},qm={...yl,html:_t(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",_l).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ba,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:_t(ml).replace("hr",Ys).replace("heading",` *#{1,6} *[^
]`).replace("lheading",sd).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Bm=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Fm=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,od=/^( {2,}|\\)\n(?!\s*$)/,zm=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ni=/[\p{P}\p{S}]/u,bl=/[\s\p{P}\p{S}]/u,ld=/[^\s\p{P}\p{S}]/u,Km=_t(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,bl).getRegex(),cd=/(?!~)[\p{P}\p{S}]/u,Um=/(?!~)[\s\p{P}\p{S}]/u,Gm=/(?:[^\s\p{P}\p{S}]|~)/u,ud=/(?![*_])[\p{P}\p{S}]/u,Wm=/(?![*_])[\s\p{P}\p{S}]/u,Hm=/(?:[^\s\p{P}\p{S}]|[*_])/u,Vm=_t(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Em?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),dd=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ym=_t(dd,"u").replace(/punct/g,Ni).getRegex(),Qm=_t(dd,"u").replace(/punct/g,cd).getRegex(),fd="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Xm=_t(fd,"gu").replace(/notPunctSpace/g,ld).replace(/punctSpace/g,bl).replace(/punct/g,Ni).getRegex(),Zm=_t(fd,"gu").replace(/notPunctSpace/g,Gm).replace(/punctSpace/g,Um).replace(/punct/g,cd).getRegex(),Jm=_t("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ld).replace(/punctSpace/g,bl).replace(/punct/g,Ni).getRegex(),$m=_t(/^~~?(?:((?!~)punct)|[^\s~])/,"u").replace(/punct/g,ud).getRegex(),eg="^[^~]+(?=[^~])|(?!~)punct(~~?)(?=[\\s]|$)|notPunctSpace(~~?)(?!~)(?=punctSpace|$)|(?!~)punctSpace(~~?)(?=notPunctSpace)|[\\s](~~?)(?!~)(?=punct)|(?!~)punct(~~?)(?!~)(?=punct)|notPunctSpace(~~?)(?=notPunctSpace)",tg=_t(eg,"gu").replace(/notPunctSpace/g,Hm).replace(/punctSpace/g,Wm).replace(/punct/g,ud).getRegex(),ng=_t(/\\(punct)/,"gu").replace(/punct/g,Ni).getRegex(),rg=_t(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ag=_t(_l).replace("(?:-->|$)","-->").getRegex(),sg=_t("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ag).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Si=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,ig=_t(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Si).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),vd=_t(/^!?\[(label)\]\[(ref)\]/).replace("label",Si).replace("ref",gl).getRegex(),pd=_t(/^!?\[(ref)\](?:\[\])?/).replace("ref",gl).getRegex(),og=_t("reflink|nolink(?!\\()","g").replace("reflink",vd).replace("nolink",pd).getRegex(),_c=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,wl={_backpedal:ba,anyPunctuation:ng,autolink:rg,blockSkip:Vm,br:od,code:Fm,del:ba,delLDelim:ba,delRDelim:ba,emStrongLDelim:Ym,emStrongRDelimAst:Xm,emStrongRDelimUnd:Jm,escape:Bm,link:ig,nolink:pd,punctuation:Km,reflink:vd,reflinkSearch:og,tag:sg,text:zm,url:ba},lg={...wl,link:_t(/^!?\[(label)\]\((.*?)\)/).replace("label",Si).getRegex(),reflink:_t(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Si).getRegex()},Fo={...wl,emStrongRDelimAst:Zm,emStrongLDelim:Qm,delLDelim:$m,delRDelim:tg,url:_t(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",_c).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:_t(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",_c).getRegex()},cg={...Fo,br:_t(od).replace("{2,}","*").getRegex(),text:_t(Fo.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},di={normal:yl,gfm:Nm,pedantic:qm},ws={normal:wl,gfm:Fo,breaks:cg,pedantic:lg},ug={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yc=t=>ug[t];function Kr(t,e){if(e){if(_n.escapeTest.test(t))return t.replace(_n.escapeReplace,yc)}else if(_n.escapeTestNoEncode.test(t))return t.replace(_n.escapeReplaceNoEncode,yc);return t}function bc(t){try{t=encodeURI(t).replace(_n.percentDecode,"%")}catch{return null}return t}function wc(t,e){var o;let n=t.replace(_n.findPipe,(u,d,g)=>{let p=!1,b=d;for(;--b>=0&&g[b]==="\\";)p=!p;return p?"|":" |"}),a=n.split(_n.splitPipe),i=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),e)if(a.length>e)a.splice(e);else for(;a.length<e;)a.push("");for(;i<a.length;i++)a[i]=a[i].trim().replace(_n.slashPipe,"|");return a}function ks(t,e,n){let a=t.length;if(a===0)return"";let i=0;for(;i<a&&t.charAt(a-i-1)===e;)i++;return t.slice(0,a-i)}function dg(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===e[0])n++;else if(t[a]===e[1]&&(n--,n<0))return a;return n>0?-2:-1}function fg(t,e=0){let n=e,a="";for(let i of t)if(i==="	"){let o=4-n%4;a+=" ".repeat(o),n+=o}else a+=i,n++;return a}function kc(t,e,n,a,i){let o=e.href,u=e.title||null,d=t[1].replace(i.other.outputLinkReplace,"$1");a.state.inLink=!0;let g={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:u,text:d,tokens:a.inlineTokens(d)};return a.state.inLink=!1,g}function vg(t,e,n){let a=t.match(n.other.indentCodeCompensation);if(a===null)return e;let i=a[1];return e.split(`
`).map(o=>{let u=o.match(n.other.beginningSpace);if(u===null)return o;let[d]=u;return d.length>=i.length?o.slice(i.length):o}).join(`
`)}var Ti=class{constructor(t){ct(this,"options");ct(this,"rules");ct(this,"lexer");this.options=t||Fa}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:ks(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],a=vg(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:a}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let a=ks(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ks(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=ks(e[0],`
`).split(`
`),a="",i="",o=[];for(;n.length>0;){let u=!1,d=[],g;for(g=0;g<n.length;g++)if(this.rules.other.blockquoteStart.test(n[g]))d.push(n[g]),u=!0;else if(!u)d.push(n[g]);else break;n=n.slice(g);let p=d.join(`
`),b=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${p}`:p,i=i?`${i}
${b}`:b;let w=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(b,o,!0),this.lexer.state.top=w,n.length===0)break;let k=o.at(-1);if((k==null?void 0:k.type)==="code")break;if((k==null?void 0:k.type)==="blockquote"){let x=k,I=x.raw+`
`+n.join(`
`),B=this.blockquote(I);o[o.length-1]=B,a=a.substring(0,a.length-x.raw.length)+B.raw,i=i.substring(0,i.length-x.text.length)+B.text;break}else if((k==null?void 0:k.type)==="list"){let x=k,I=x.raw+`
`+n.join(`
`),B=this.list(I);o[o.length-1]=B,a=a.substring(0,a.length-k.raw.length)+B.raw,i=i.substring(0,i.length-x.raw.length)+B.raw,n=I.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:i}}}list(t){var n,a;let e=this.rules.block.list.exec(t);if(e){let i=e[1].trim(),o=i.length>1,u={type:"list",raw:"",ordered:o,start:o?+i.slice(0,-1):"",loose:!1,items:[]};i=o?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=o?i:"[*+-]");let d=this.rules.other.listItemRegex(i),g=!1;for(;t;){let b=!1,w="",k="";if(!(e=d.exec(t))||this.rules.block.hr.test(t))break;w=e[0],t=t.substring(w.length);let x=fg(e[2].split(`
`,1)[0],e[1].length),I=t.split(`
`,1)[0],B=!x.trim(),R=0;if(this.options.pedantic?(R=2,k=x.trimStart()):B?R=e[1].length+1:(R=x.search(this.rules.other.nonSpaceChar),R=R>4?1:R,k=x.slice(R),R+=e[1].length),B&&this.rules.other.blankLine.test(I)&&(w+=I+`
`,t=t.substring(I.length+1),b=!0),!b){let X=this.rules.other.nextBulletRegex(R),Y=this.rules.other.hrRegex(R),U=this.rules.other.fencesBeginRegex(R),C=this.rules.other.headingBeginRegex(R),V=this.rules.other.htmlBeginRegex(R),J=this.rules.other.blockquoteBeginRegex(R);for(;t;){let F=t.split(`
`,1)[0],le;if(I=F,this.options.pedantic?(I=I.replace(this.rules.other.listReplaceNesting,"  "),le=I):le=I.replace(this.rules.other.tabCharGlobal,"    "),U.test(I)||C.test(I)||V.test(I)||J.test(I)||X.test(I)||Y.test(I))break;if(le.search(this.rules.other.nonSpaceChar)>=R||!I.trim())k+=`
`+le.slice(R);else{if(B||x.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||U.test(x)||C.test(x)||Y.test(x))break;k+=`
`+I}B=!I.trim(),w+=F+`
`,t=t.substring(F.length+1),x=le.slice(R)}}u.loose||(g?u.loose=!0:this.rules.other.doubleBlankLine.test(w)&&(g=!0)),u.items.push({type:"list_item",raw:w,task:!!this.options.gfm&&this.rules.other.listIsTask.test(k),loose:!1,text:k,tokens:[]}),u.raw+=w}let p=u.items.at(-1);if(p)p.raw=p.raw.trimEnd(),p.text=p.text.trimEnd();else return;u.raw=u.raw.trimEnd();for(let b of u.items){if(this.lexer.state.top=!1,b.tokens=this.lexer.blockTokens(b.text,[]),b.task){if(b.text=b.text.replace(this.rules.other.listReplaceTask,""),((n=b.tokens[0])==null?void 0:n.type)==="text"||((a=b.tokens[0])==null?void 0:a.type)==="paragraph"){b.tokens[0].raw=b.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),b.tokens[0].text=b.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let k=this.lexer.inlineQueue.length-1;k>=0;k--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[k].src)){this.lexer.inlineQueue[k].src=this.lexer.inlineQueue[k].src.replace(this.rules.other.listReplaceTask,"");break}}let w=this.rules.other.listTaskCheckbox.exec(b.raw);if(w){let k={type:"checkbox",raw:w[0]+" ",checked:w[0]!=="[ ]"};b.checked=k.checked,u.loose?b.tokens[0]&&["paragraph","text"].includes(b.tokens[0].type)&&"tokens"in b.tokens[0]&&b.tokens[0].tokens?(b.tokens[0].raw=k.raw+b.tokens[0].raw,b.tokens[0].text=k.raw+b.tokens[0].text,b.tokens[0].tokens.unshift(k)):b.tokens.unshift({type:"paragraph",raw:k.raw,text:k.raw,tokens:[k]}):b.tokens.unshift(k)}}if(!u.loose){let w=b.tokens.filter(x=>x.type==="space"),k=w.length>0&&w.some(x=>this.rules.other.anyLine.test(x.raw));u.loose=k}}if(u.loose)for(let b of u.items){b.loose=!0;for(let w of b.tokens)w.type==="text"&&(w.type="paragraph")}return u}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:a,title:i}}}table(t){var u;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=wc(e[1]),a=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let d of a)this.rules.other.tableAlignRight.test(d)?o.align.push("right"):this.rules.other.tableAlignCenter.test(d)?o.align.push("center"):this.rules.other.tableAlignLeft.test(d)?o.align.push("left"):o.align.push(null);for(let d=0;d<n.length;d++)o.header.push({text:n[d],tokens:this.lexer.inline(n[d]),header:!0,align:o.align[d]});for(let d of i)o.rows.push(wc(d,o.header.length).map((g,p)=>({text:g,tokens:this.lexer.inline(g),header:!1,align:o.align[p]})));return o}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let o=ks(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=dg(e[2],"()");if(o===-2)return;if(o>-1){let u=(e[0].indexOf("!")===0?5:4)+e[1].length+o;e[2]=e[2].substring(0,o),e[0]=e[0].substring(0,u).trim(),e[3]=""}}let a=e[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],i=o[3])}else i=e[3]?e[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),kc(e,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[a.toLowerCase()];if(!i){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return kc(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...a[0]].length-1,o,u,d=i,g=0,p=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+i);(a=p.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o)continue;if(u=[...o].length,a[3]||a[4]){d+=u;continue}else if((a[5]||a[6])&&i%3&&!((i+u)%3)){g+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d+g);let b=[...a[0]][0].length,w=t.slice(0,i+a.index+b+u);if(Math.min(i,u)%2){let x=w.slice(1,-1);return{type:"em",raw:w,text:x,tokens:this.lexer.inlineTokens(x)}}let k=w.slice(2,-2);return{type:"strong",raw:w,text:k,tokens:this.lexer.inlineTokens(k)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t,e,n=""){let a=this.rules.inline.delLDelim.exec(t);if(a&&(!a[1]||!n||this.rules.inline.punctuation.exec(n))){let i=[...a[0]].length-1,o,u,d=i,g=this.rules.inline.delRDelim;for(g.lastIndex=0,e=e.slice(-1*t.length+i);(a=g.exec(e))!=null;){if(o=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!o||(u=[...o].length,u!==i))continue;if(a[3]||a[4]){d+=u;continue}if(d-=u,d>0)continue;u=Math.min(u,u+d);let p=[...a[0]][0].length,b=t.slice(0,i+a.index+p+u),w=b.slice(i,-i);return{type:"del",raw:b,text:w,tokens:this.lexer.inlineTokens(w)}}}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,a;return e[2]==="@"?(n=e[1],a="mailto:"+n):(n=e[1],a=n),{type:"link",raw:e[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let a,i;if(e[2]==="@")a=e[0],i="mailto:"+a;else{let o;do o=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(o!==e[0]);a=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:a,href:i,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},ur=class zo{constructor(e){ct(this,"tokens");ct(this,"options");ct(this,"state");ct(this,"inlineQueue");ct(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Fa,this.options.tokenizer=this.options.tokenizer||new Ti,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:_n,block:di.normal,inline:ws.normal};this.options.pedantic?(n.block=di.pedantic,n.inline=ws.pedantic):this.options.gfm&&(n.block=di.gfm,this.options.breaks?n.inline=ws.breaks:n.inline=ws.gfm),this.tokenizer.rules=n}static get rules(){return{block:di,inline:ws}}static lex(e,n){return new zo(n).lex(e)}static lexInline(e,n){return new zo(n).inlineTokens(e)}lex(e){e=e.replace(_n.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],a=!1){var i,o,u;for(this.options.pedantic&&(e=e.replace(_n.tabCharGlobal,"    ").replace(_n.spaceLine,""));e;){let d;if((o=(i=this.options.extensions)==null?void 0:i.block)!=null&&o.some(p=>(d=p.call({lexer:this},e,n))?(e=e.substring(d.raw.length),n.push(d),!0):!1))continue;if(d=this.tokenizer.space(e)){e=e.substring(d.raw.length);let p=n.at(-1);d.raw.length===1&&p!==void 0?p.raw+=`
`:n.push(d);continue}if(d=this.tokenizer.code(e)){e=e.substring(d.raw.length);let p=n.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.at(-1).src=p.text):n.push(d);continue}if(d=this.tokenizer.fences(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.heading(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.hr(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.blockquote(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.list(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.html(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.def(e)){e=e.substring(d.raw.length);let p=n.at(-1);(p==null?void 0:p.type)==="paragraph"||(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.raw,this.inlineQueue.at(-1).src=p.text):this.tokens.links[d.tag]||(this.tokens.links[d.tag]={href:d.href,title:d.title},n.push(d));continue}if(d=this.tokenizer.table(e)){e=e.substring(d.raw.length),n.push(d);continue}if(d=this.tokenizer.lheading(e)){e=e.substring(d.raw.length),n.push(d);continue}let g=e;if((u=this.options.extensions)!=null&&u.startBlock){let p=1/0,b=e.slice(1),w;this.options.extensions.startBlock.forEach(k=>{w=k.call({lexer:this},b),typeof w=="number"&&w>=0&&(p=Math.min(p,w))}),p<1/0&&p>=0&&(g=e.substring(0,p+1))}if(this.state.top&&(d=this.tokenizer.paragraph(g))){let p=n.at(-1);a&&(p==null?void 0:p.type)==="paragraph"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):n.push(d),a=g.length!==e.length,e=e.substring(d.raw.length);continue}if(d=this.tokenizer.text(e)){e=e.substring(d.raw.length);let p=n.at(-1);(p==null?void 0:p.type)==="text"?(p.raw+=(p.raw.endsWith(`
`)?"":`
`)+d.raw,p.text+=`
`+d.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=p.text):n.push(d);continue}if(e){let p="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var g,p,b,w,k;let a=e,i=null;if(this.tokens.links){let x=Object.keys(this.tokens.links);if(x.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)x.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,i.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)o=i[2]?i[2].length:0,a=a.slice(0,i.index+o)+"["+"a".repeat(i[0].length-o-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=((p=(g=this.options.hooks)==null?void 0:g.emStrongMask)==null?void 0:p.call({lexer:this},a))??a;let u=!1,d="";for(;e;){u||(d=""),u=!1;let x;if((w=(b=this.options.extensions)==null?void 0:b.inline)!=null&&w.some(B=>(x=B.call({lexer:this},e,n))?(e=e.substring(x.raw.length),n.push(x),!0):!1))continue;if(x=this.tokenizer.escape(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.tag(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.link(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(x.raw.length);let B=n.at(-1);x.type==="text"&&(B==null?void 0:B.type)==="text"?(B.raw+=x.raw,B.text+=x.text):n.push(x);continue}if(x=this.tokenizer.emStrong(e,a,d)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.codespan(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.br(e)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.del(e,a,d)){e=e.substring(x.raw.length),n.push(x);continue}if(x=this.tokenizer.autolink(e)){e=e.substring(x.raw.length),n.push(x);continue}if(!this.state.inLink&&(x=this.tokenizer.url(e))){e=e.substring(x.raw.length),n.push(x);continue}let I=e;if((k=this.options.extensions)!=null&&k.startInline){let B=1/0,R=e.slice(1),X;this.options.extensions.startInline.forEach(Y=>{X=Y.call({lexer:this},R),typeof X=="number"&&X>=0&&(B=Math.min(B,X))}),B<1/0&&B>=0&&(I=e.substring(0,B+1))}if(x=this.tokenizer.inlineText(I)){e=e.substring(x.raw.length),x.raw.slice(-1)!=="_"&&(d=x.raw.slice(-1)),u=!0;let B=n.at(-1);(B==null?void 0:B.type)==="text"?(B.raw+=x.raw,B.text+=x.text):n.push(x);continue}if(e){let B="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(B);break}else throw new Error(B)}}return n}},Ei=class{constructor(t){ct(this,"options");ct(this,"parser");this.options=t||Fa}space(t){return""}code({text:t,lang:e,escaped:n}){var o;let a=(o=(e||"").match(_n.notSpaceStart))==null?void 0:o[0],i=t.replace(_n.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Kr(a)+'">'+(n?i:Kr(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:Kr(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,a="";for(let u=0;u<t.items.length;u++){let d=t.items[u];a+=this.listitem(d)}let i=e?"ol":"ul",o=e&&n!==1?' start="'+n+'"':"";return"<"+i+o+`>
`+a+"</"+i+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let i=0;i<t.header.length;i++)n+=this.tablecell(t.header[i]);e+=this.tablerow({text:n});let a="";for(let i=0;i<t.rows.length;i++){let o=t.rows[i];n="";for(let u=0;u<o.length;u++)n+=this.tablecell(o[u]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Kr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let a=this.parser.parseInline(n),i=bc(t);if(i===null)return a;t=i;let o='<a href="'+t+'"';return e&&(o+=' title="'+Kr(e)+'"'),o+=">"+a+"</a>",o}image({href:t,title:e,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let i=bc(t);if(i===null)return Kr(n);t=i;let o=`<img src="${t}" alt="${n}"`;return e&&(o+=` title="${Kr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Kr(t.text)}},kl=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},dr=class Ko{constructor(e){ct(this,"options");ct(this,"renderer");ct(this,"textRenderer");this.options=e||Fa,this.options.renderer=this.options.renderer||new Ei,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new kl}static parse(e,n){return new Ko(n).parse(e)}static parseInline(e,n){return new Ko(n).parseInline(e)}parse(e){var a,i;let n="";for(let o=0;o<e.length;o++){let u=e[o];if((i=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&i[u.type]){let g=u,p=this.options.extensions.renderers[g.type].call({parser:this},g);if(p!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(g.type)){n+=p||"";continue}}let d=u;switch(d.type){case"space":{n+=this.renderer.space(d);break}case"hr":{n+=this.renderer.hr(d);break}case"heading":{n+=this.renderer.heading(d);break}case"code":{n+=this.renderer.code(d);break}case"table":{n+=this.renderer.table(d);break}case"blockquote":{n+=this.renderer.blockquote(d);break}case"list":{n+=this.renderer.list(d);break}case"checkbox":{n+=this.renderer.checkbox(d);break}case"html":{n+=this.renderer.html(d);break}case"def":{n+=this.renderer.def(d);break}case"paragraph":{n+=this.renderer.paragraph(d);break}case"text":{n+=this.renderer.text(d);break}default:{let g='Token with "'+d.type+'" type was not found.';if(this.options.silent)return console.error(g),"";throw new Error(g)}}}return n}parseInline(e,n=this.renderer){var i,o;let a="";for(let u=0;u<e.length;u++){let d=e[u];if((o=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&o[d.type]){let p=this.options.extensions.renderers[d.type].call({parser:this},d);if(p!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(d.type)){a+=p||"";continue}}let g=d;switch(g.type){case"escape":{a+=n.text(g);break}case"html":{a+=n.html(g);break}case"link":{a+=n.link(g);break}case"image":{a+=n.image(g);break}case"checkbox":{a+=n.checkbox(g);break}case"strong":{a+=n.strong(g);break}case"em":{a+=n.em(g);break}case"codespan":{a+=n.codespan(g);break}case"br":{a+=n.br(g);break}case"del":{a+=n.del(g);break}case"text":{a+=n.text(g);break}default:{let p='Token with "'+g.type+'" type was not found.';if(this.options.silent)return console.error(p),"";throw new Error(p)}}}return a}},pi,Is=(pi=class{constructor(t){ct(this,"options");ct(this,"block");this.options=t||Fa}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?ur.lex:ur.lexInline}provideParser(){return this.block?dr.parse:dr.parseInline}},ct(pi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),ct(pi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),pi),pg=class{constructor(...t){ct(this,"defaults",pl());ct(this,"options",this.setOptions);ct(this,"parse",this.parseMarkdown(!0));ct(this,"parseInline",this.parseMarkdown(!1));ct(this,"Parser",dr);ct(this,"Renderer",Ei);ct(this,"TextRenderer",kl);ct(this,"Lexer",ur);ct(this,"Tokenizer",Ti);ct(this,"Hooks",Is);this.use(...t)}walkTokens(t,e){var a,i;let n=[];for(let o of t)switch(n=n.concat(e.call(this,o)),o.type){case"table":{let u=o;for(let d of u.header)n=n.concat(this.walkTokens(d.tokens,e));for(let d of u.rows)for(let g of d)n=n.concat(this.walkTokens(g.tokens,e));break}case"list":{let u=o;n=n.concat(this.walkTokens(u.items,e));break}default:{let u=o;(i=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&i[u.type]?this.defaults.extensions.childTokens[u.type].forEach(d=>{let g=u[d].flat(1/0);n=n.concat(this.walkTokens(g,e))}):u.tokens&&(n=n.concat(this.walkTokens(u.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=e.renderers[i.name];o?e.renderers[i.name]=function(...u){let d=i.renderer.apply(this,u);return d===!1&&(d=o.apply(this,u)),d}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=e[i.level];o?o.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),a.extensions=e),n.renderer){let i=this.defaults.renderer||new Ei(this.defaults);for(let o in n.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let u=o,d=n.renderer[u],g=i[u];i[u]=(...p)=>{let b=d.apply(i,p);return b===!1&&(b=g.apply(i,p)),b||""}}a.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new Ti(this.defaults);for(let o in n.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let u=o,d=n.tokenizer[u],g=i[u];i[u]=(...p)=>{let b=d.apply(i,p);return b===!1&&(b=g.apply(i,p)),b}}a.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new Is;for(let o in n.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let u=o,d=n.hooks[u],g=i[u];Is.passThroughHooks.has(o)?i[u]=p=>{if(this.defaults.async&&Is.passThroughHooksRespectAsync.has(o))return(async()=>{let w=await d.call(i,p);return g.call(i,w)})();let b=d.call(i,p);return g.call(i,b)}:i[u]=(...p)=>{if(this.defaults.async)return(async()=>{let w=await d.apply(i,p);return w===!1&&(w=await g.apply(i,p)),w})();let b=d.apply(i,p);return b===!1&&(b=g.apply(i,p)),b}}a.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(u){let d=[];return d.push(o.call(this,u)),i&&(d=d.concat(i.call(this,u))),d}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return ur.lex(t,e??this.defaults)}parser(t,e){return dr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let a={...n},i={...this.defaults,...a},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=t),i.async)return(async()=>{let u=i.hooks?await i.hooks.preprocess(e):e,d=await(i.hooks?await i.hooks.provideLexer():t?ur.lex:ur.lexInline)(u,i),g=i.hooks?await i.hooks.processAllTokens(d):d;i.walkTokens&&await Promise.all(this.walkTokens(g,i.walkTokens));let p=await(i.hooks?await i.hooks.provideParser():t?dr.parse:dr.parseInline)(g,i);return i.hooks?await i.hooks.postprocess(p):p})().catch(o);try{i.hooks&&(e=i.hooks.preprocess(e));let u=(i.hooks?i.hooks.provideLexer():t?ur.lex:ur.lexInline)(e,i);i.hooks&&(u=i.hooks.processAllTokens(u)),i.walkTokens&&this.walkTokens(u,i.walkTokens);let d=(i.hooks?i.hooks.provideParser():t?dr.parse:dr.parseInline)(u,i);return i.hooks&&(d=i.hooks.postprocess(d)),d}catch(u){return o(u)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let a="<p>An error occurred:</p><pre>"+Kr(n.message+"",!0)+"</pre>";return e?Promise.resolve(a):a}if(e)return Promise.reject(n);throw n}}},qa=new pg;function bt(t,e){return qa.parse(t,e)}bt.options=bt.setOptions=function(t){return qa.setOptions(t),bt.defaults=qa.defaults,rd(bt.defaults),bt};bt.getDefaults=pl;bt.defaults=Fa;bt.use=function(...t){return qa.use(...t),bt.defaults=qa.defaults,rd(bt.defaults),bt};bt.walkTokens=function(t,e){return qa.walkTokens(t,e)};bt.parseInline=qa.parseInline;bt.Parser=dr;bt.parser=dr.parse;bt.Renderer=Ei;bt.TextRenderer=kl;bt.Lexer=ur;bt.lexer=ur.lex;bt.Tokenizer=Ti;bt.Hooks=Is;bt.parse=bt;bt.options;bt.setOptions;bt.use;bt.walkTokens;bt.parseInline;dr.parse;ur.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:hd,setPrototypeOf:xc,isFrozen:hg,getPrototypeOf:mg,getOwnPropertyDescriptor:gg}=Object;let{freeze:bn,seal:er,create:Uo}=Object,{apply:Go,construct:Wo}=typeof Reflect<"u"&&Reflect;bn||(bn=function(e){return e});er||(er=function(e){return e});Go||(Go=function(e,n){for(var a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];return e.apply(n,i)});Wo||(Wo=function(e){for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return new e(...a)});const fi=wn(Array.prototype.forEach),_g=wn(Array.prototype.lastIndexOf),Sc=wn(Array.prototype.pop),xs=wn(Array.prototype.push),yg=wn(Array.prototype.splice),bi=wn(String.prototype.toLowerCase),go=wn(String.prototype.toString),_o=wn(String.prototype.match),Ss=wn(String.prototype.replace),bg=wn(String.prototype.indexOf),wg=wn(String.prototype.trim),lr=wn(Object.prototype.hasOwnProperty),gn=wn(RegExp.prototype.test),Ts=kg(TypeError);function wn(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return Go(t,e,a)}}function kg(t){return function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return Wo(t,n)}}function ot(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bi;xc&&xc(t,null);let a=e.length;for(;a--;){let i=e[a];if(typeof i=="string"){const o=n(i);o!==i&&(hg(e)||(e[a]=o),i=o)}t[i]=!0}return t}function xg(t){for(let e=0;e<t.length;e++)lr(t,e)||(t[e]=null);return t}function Sr(t){const e=Uo(null);for(const[n,a]of hd(t))lr(t,n)&&(Array.isArray(a)?e[n]=xg(a):a&&typeof a=="object"&&a.constructor===Object?e[n]=Sr(a):e[n]=a);return e}function Es(t,e){for(;t!==null;){const a=gg(t,e);if(a){if(a.get)return wn(a.get);if(typeof a.value=="function")return wn(a.value)}t=mg(t)}function n(){return null}return n}const Tc=bn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),yo=bn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),bo=bn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Sg=bn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),wo=bn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Tg=bn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ec=bn(["#text"]),Ac=bn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),ko=bn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Cc=bn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),vi=bn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Eg=er(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ag=er(/<%[\w\W]*|[\w\W]*%>/gm),Cg=er(/\$\{[\w\W]*/gm),Pg=er(/^data-[\-\w.\u00B7-\uFFFF]+$/),Ig=er(/^aria-[\-\w]+$/),md=er(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Rg=er(/^(?:\w+script|data):/i),Og=er(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),gd=er(/^html$/i),Mg=er(/^[a-z][.\w]*(-[.\w]+)+$/i);var Pc=Object.freeze({__proto__:null,ARIA_ATTR:Ig,ATTR_WHITESPACE:Og,CUSTOM_ELEMENT:Mg,DATA_ATTR:Pg,DOCTYPE_NAME:gd,ERB_EXPR:Ag,IS_ALLOWED_URI:md,IS_SCRIPT_OR_DATA:Rg,MUSTACHE_EXPR:Eg,TMPLIT_EXPR:Cg});const As={element:1,text:3,progressingInstruction:7,comment:8,document:9},Dg=function(){return typeof window>"u"?null:window},jg=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(a=n.getAttribute(i));const o="dompurify"+(a?"#"+a:"");try{return e.createPolicy(o,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Ic=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function _d(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Dg();const e=Te=>_d(Te);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==As.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const a=n,i=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:u,Node:d,Element:g,NodeFilter:p,NamedNodeMap:b=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:w,DOMParser:k,trustedTypes:x}=t,I=g.prototype,B=Es(I,"cloneNode"),R=Es(I,"remove"),X=Es(I,"nextSibling"),Y=Es(I,"childNodes"),U=Es(I,"parentNode");if(typeof u=="function"){const Te=n.createElement("template");Te.content&&Te.content.ownerDocument&&(n=Te.content.ownerDocument)}let C,V="";const{implementation:J,createNodeIterator:F,createDocumentFragment:le,getElementsByTagName:xe}=n,{importNode:Ae}=a;let ve=Ic();e.isSupported=typeof hd=="function"&&typeof U=="function"&&J&&J.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:te,ERB_EXPR:ce,TMPLIT_EXPR:we,DATA_ATTR:re,ARIA_ATTR:me,IS_SCRIPT_OR_DATA:Se,ATTR_WHITESPACE:ie,CUSTOM_ELEMENT:pe}=Pc;let{IS_ALLOWED_URI:se}=Pc,ne=null;const he=ot({},[...Tc,...yo,...bo,...wo,...Ec]);let H=null;const $=ot({},[...Ac,...ko,...Cc,...vi]);let fe=Object.seal(Uo(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ue=null,ke=null;const Ke=Object.seal(Uo(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Ve=!0,z=!0,Re=!1,De=!0,Be=!1,Tt=!0,kt=!1,Xt=!1,fn=!1,Zt=!1,Lt=!1,Ye=!1,et=!0,Ft=!1;const Jt="user-content-";let mn=!0,Rn=!1,Mt={},Ht=null;const Or=ot({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let _r=null;const Mr=ot({},["audio","video","img","source","image","track"]);let tr=null;const Kn=ot({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Un="http://www.w3.org/1998/Math/MathML",yr="http://www.w3.org/2000/svg",Vt="http://www.w3.org/1999/xhtml";let qe=Vt,Gn=!1,kn=null;const Dr=ot({},[Un,yr,Vt],go);let Ie=ot({},["mi","mo","mn","ms","mtext"]),br=ot({},["annotation-xml"]);const za=ot({},["title","style","font","a","script"]);let nr=null;const Ka=["application/xhtml+xml","text/html"],da="text/html";let Dt=null,wr=null;const rr=n.createElement("form"),ar=function(E){return E instanceof RegExp||E instanceof Function},jr=function(){let E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(wr&&wr===E)){if((!E||typeof E!="object")&&(E={}),E=Sr(E),nr=Ka.indexOf(E.PARSER_MEDIA_TYPE)===-1?da:E.PARSER_MEDIA_TYPE,Dt=nr==="application/xhtml+xml"?go:bi,ne=lr(E,"ALLOWED_TAGS")?ot({},E.ALLOWED_TAGS,Dt):he,H=lr(E,"ALLOWED_ATTR")?ot({},E.ALLOWED_ATTR,Dt):$,kn=lr(E,"ALLOWED_NAMESPACES")?ot({},E.ALLOWED_NAMESPACES,go):Dr,tr=lr(E,"ADD_URI_SAFE_ATTR")?ot(Sr(Kn),E.ADD_URI_SAFE_ATTR,Dt):Kn,_r=lr(E,"ADD_DATA_URI_TAGS")?ot(Sr(Mr),E.ADD_DATA_URI_TAGS,Dt):Mr,Ht=lr(E,"FORBID_CONTENTS")?ot({},E.FORBID_CONTENTS,Dt):Or,ue=lr(E,"FORBID_TAGS")?ot({},E.FORBID_TAGS,Dt):Sr({}),ke=lr(E,"FORBID_ATTR")?ot({},E.FORBID_ATTR,Dt):Sr({}),Mt=lr(E,"USE_PROFILES")?E.USE_PROFILES:!1,Ve=E.ALLOW_ARIA_ATTR!==!1,z=E.ALLOW_DATA_ATTR!==!1,Re=E.ALLOW_UNKNOWN_PROTOCOLS||!1,De=E.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Be=E.SAFE_FOR_TEMPLATES||!1,Tt=E.SAFE_FOR_XML!==!1,kt=E.WHOLE_DOCUMENT||!1,Zt=E.RETURN_DOM||!1,Lt=E.RETURN_DOM_FRAGMENT||!1,Ye=E.RETURN_TRUSTED_TYPE||!1,fn=E.FORCE_BODY||!1,et=E.SANITIZE_DOM!==!1,Ft=E.SANITIZE_NAMED_PROPS||!1,mn=E.KEEP_CONTENT!==!1,Rn=E.IN_PLACE||!1,se=E.ALLOWED_URI_REGEXP||md,qe=E.NAMESPACE||Vt,Ie=E.MATHML_TEXT_INTEGRATION_POINTS||Ie,br=E.HTML_INTEGRATION_POINTS||br,fe=E.CUSTOM_ELEMENT_HANDLING||{},E.CUSTOM_ELEMENT_HANDLING&&ar(E.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(fe.tagNameCheck=E.CUSTOM_ELEMENT_HANDLING.tagNameCheck),E.CUSTOM_ELEMENT_HANDLING&&ar(E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(fe.attributeNameCheck=E.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),E.CUSTOM_ELEMENT_HANDLING&&typeof E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(fe.allowCustomizedBuiltInElements=E.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Be&&(z=!1),Lt&&(Zt=!0),Mt&&(ne=ot({},Ec),H=[],Mt.html===!0&&(ot(ne,Tc),ot(H,Ac)),Mt.svg===!0&&(ot(ne,yo),ot(H,ko),ot(H,vi)),Mt.svgFilters===!0&&(ot(ne,bo),ot(H,ko),ot(H,vi)),Mt.mathMl===!0&&(ot(ne,wo),ot(H,Cc),ot(H,vi))),E.ADD_TAGS&&(typeof E.ADD_TAGS=="function"?Ke.tagCheck=E.ADD_TAGS:(ne===he&&(ne=Sr(ne)),ot(ne,E.ADD_TAGS,Dt))),E.ADD_ATTR&&(typeof E.ADD_ATTR=="function"?Ke.attributeCheck=E.ADD_ATTR:(H===$&&(H=Sr(H)),ot(H,E.ADD_ATTR,Dt))),E.ADD_URI_SAFE_ATTR&&ot(tr,E.ADD_URI_SAFE_ATTR,Dt),E.FORBID_CONTENTS&&(Ht===Or&&(Ht=Sr(Ht)),ot(Ht,E.FORBID_CONTENTS,Dt)),E.ADD_FORBID_CONTENTS&&(Ht===Or&&(Ht=Sr(Ht)),ot(Ht,E.ADD_FORBID_CONTENTS,Dt)),mn&&(ne["#text"]=!0),kt&&ot(ne,["html","head","body"]),ne.table&&(ot(ne,["tbody"]),delete ue.tbody),E.TRUSTED_TYPES_POLICY){if(typeof E.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ts('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof E.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ts('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');C=E.TRUSTED_TYPES_POLICY,V=C.createHTML("")}else C===void 0&&(C=jg(x,i)),C!==null&&typeof V=="string"&&(V=C.createHTML(""));bn&&bn(E),wr=E}},Lr=ot({},[...yo,...bo,...Sg]),xt=ot({},[...wo,...Tg]),Nt=function(E){let ge=U(E);(!ge||!ge.tagName)&&(ge={namespaceURI:qe,tagName:"template"});const _e=bi(E.tagName),Xe=bi(ge.tagName);return kn[E.namespaceURI]?E.namespaceURI===yr?ge.namespaceURI===Vt?_e==="svg":ge.namespaceURI===Un?_e==="svg"&&(Xe==="annotation-xml"||Ie[Xe]):!!Lr[_e]:E.namespaceURI===Un?ge.namespaceURI===Vt?_e==="math":ge.namespaceURI===yr?_e==="math"&&br[Xe]:!!xt[_e]:E.namespaceURI===Vt?ge.namespaceURI===yr&&!br[Xe]||ge.namespaceURI===Un&&!Ie[Xe]?!1:!xt[_e]&&(za[_e]||!Lr[_e]):!!(nr==="application/xhtml+xml"&&kn[E.namespaceURI]):!1},xn=function(E){xs(e.removed,{element:E});try{U(E).removeChild(E)}catch{R(E)}},je=function(E,ge){try{xs(e.removed,{attribute:ge.getAttributeNode(E),from:ge})}catch{xs(e.removed,{attribute:null,from:ge})}if(ge.removeAttribute(E),E==="is")if(Zt||Lt)try{xn(ge)}catch{}else try{ge.setAttribute(E,"")}catch{}},Ue=function(E){let ge=null,_e=null;if(fn)E="<remove></remove>"+E;else{const At=_o(E,/^[\r\n\t ]+/);_e=At&&At[0]}nr==="application/xhtml+xml"&&qe===Vt&&(E='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+E+"</body></html>");const Xe=C?C.createHTML(E):E;if(qe===Vt)try{ge=new k().parseFromString(Xe,nr)}catch{}if(!ge||!ge.documentElement){ge=J.createDocument(qe,"template",null);try{ge.documentElement.innerHTML=Gn?V:Xe}catch{}}const lt=ge.body||ge.documentElement;return E&&_e&&lt.insertBefore(n.createTextNode(_e),lt.childNodes[0]||null),qe===Vt?xe.call(ge,kt?"html":"body")[0]:kt?ge.documentElement:lt},vt=function(E){return F.call(E.ownerDocument||E,E,p.SHOW_ELEMENT|p.SHOW_COMMENT|p.SHOW_TEXT|p.SHOW_PROCESSING_INSTRUCTION|p.SHOW_CDATA_SECTION,null)},St=function(E){return E instanceof w&&(typeof E.nodeName!="string"||typeof E.textContent!="string"||typeof E.removeChild!="function"||!(E.attributes instanceof b)||typeof E.removeAttribute!="function"||typeof E.setAttribute!="function"||typeof E.namespaceURI!="string"||typeof E.insertBefore!="function"||typeof E.hasChildNodes!="function")},ze=function(E){return typeof d=="function"&&E instanceof d};function Ze(Te,E,ge){fi(Te,_e=>{_e.call(e,E,ge,wr)})}const Et=function(E){let ge=null;if(Ze(ve.beforeSanitizeElements,E,null),St(E))return xn(E),!0;const _e=Dt(E.nodeName);if(Ze(ve.uponSanitizeElement,E,{tagName:_e,allowedTags:ne}),Tt&&E.hasChildNodes()&&!ze(E.firstElementChild)&&gn(/<[/\w!]/g,E.innerHTML)&&gn(/<[/\w!]/g,E.textContent)||E.nodeType===As.progressingInstruction||Tt&&E.nodeType===As.comment&&gn(/<[/\w]/g,E.data))return xn(E),!0;if(!(Ke.tagCheck instanceof Function&&Ke.tagCheck(_e))&&(!ne[_e]||ue[_e])){if(!ue[_e]&&at(_e)&&(fe.tagNameCheck instanceof RegExp&&gn(fe.tagNameCheck,_e)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(_e)))return!1;if(mn&&!Ht[_e]){const Xe=U(E)||E.parentNode,lt=Y(E)||E.childNodes;if(lt&&Xe){const At=lt.length;for(let Ot=At-1;Ot>=0;--Ot){const en=B(lt[Ot],!0);en.__removalCount=(E.__removalCount||0)+1,Xe.insertBefore(en,X(E))}}}return xn(E),!0}return E instanceof g&&!Nt(E)||(_e==="noscript"||_e==="noembed"||_e==="noframes")&&gn(/<\/no(script|embed|frames)/i,E.innerHTML)?(xn(E),!0):(Be&&E.nodeType===As.text&&(ge=E.textContent,fi([te,ce,we],Xe=>{ge=Ss(ge,Xe," ")}),E.textContent!==ge&&(xs(e.removed,{element:E.cloneNode()}),E.textContent=ge)),Ze(ve.afterSanitizeElements,E,null),!1)},qt=function(E,ge,_e){if(et&&(ge==="id"||ge==="name")&&(_e in n||_e in rr))return!1;if(!(z&&!ke[ge]&&gn(re,ge))){if(!(Ve&&gn(me,ge))){if(!(Ke.attributeCheck instanceof Function&&Ke.attributeCheck(ge,E))){if(!H[ge]||ke[ge]){if(!(at(E)&&(fe.tagNameCheck instanceof RegExp&&gn(fe.tagNameCheck,E)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(E))&&(fe.attributeNameCheck instanceof RegExp&&gn(fe.attributeNameCheck,ge)||fe.attributeNameCheck instanceof Function&&fe.attributeNameCheck(ge,E))||ge==="is"&&fe.allowCustomizedBuiltInElements&&(fe.tagNameCheck instanceof RegExp&&gn(fe.tagNameCheck,_e)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(_e))))return!1}else if(!tr[ge]){if(!gn(se,Ss(_e,ie,""))){if(!((ge==="src"||ge==="xlink:href"||ge==="href")&&E!=="script"&&bg(_e,"data:")===0&&_r[E])){if(!(Re&&!gn(Se,Ss(_e,ie,"")))){if(_e)return!1}}}}}}}return!0},at=function(E){return E!=="annotation-xml"&&_o(E,pe)},dt=function(E){Ze(ve.beforeSanitizeAttributes,E,null);const{attributes:ge}=E;if(!ge||St(E))return;const _e={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let Xe=ge.length;for(;Xe--;){const lt=ge[Xe],{name:At,namespaceURI:Ot,value:en}=lt,Sn=Dt(At),sr=en;let Je=At==="value"?sr:wg(sr);if(_e.attrName=Sn,_e.attrValue=Je,_e.keepAttr=!0,_e.forceKeepAttr=void 0,Ze(ve.uponSanitizeAttribute,E,_e),Je=_e.attrValue,Ft&&(Sn==="id"||Sn==="name")&&(je(At,E),Je=Jt+Je),Tt&&gn(/((--!?|])>)|<\/(style|title|textarea)/i,Je)){je(At,E);continue}if(Sn==="attributename"&&_o(Je,"href")){je(At,E);continue}if(_e.forceKeepAttr)continue;if(!_e.keepAttr){je(At,E);continue}if(!De&&gn(/\/>/i,Je)){je(At,E);continue}Be&&fi([te,ce,we],tn=>{Je=Ss(Je,tn," ")});const zt=Dt(E.nodeName);if(!qt(zt,Sn,Je)){je(At,E);continue}if(C&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!Ot)switch(x.getAttributeType(zt,Sn)){case"TrustedHTML":{Je=C.createHTML(Je);break}case"TrustedScriptURL":{Je=C.createScriptURL(Je);break}}if(Je!==sr)try{Ot?E.setAttributeNS(Ot,At,Je):E.setAttribute(At,Je),St(E)?xn(E):Sc(e.removed)}catch{je(At,E)}}Ze(ve.afterSanitizeAttributes,E,null)},Rt=function Te(E){let ge=null;const _e=vt(E);for(Ze(ve.beforeSanitizeShadowDOM,E,null);ge=_e.nextNode();)Ze(ve.uponSanitizeShadowNode,ge,null),Et(ge),dt(ge),ge.content instanceof o&&Te(ge.content);Ze(ve.afterSanitizeShadowDOM,E,null)};return e.sanitize=function(Te){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ge=null,_e=null,Xe=null,lt=null;if(Gn=!Te,Gn&&(Te="<!-->"),typeof Te!="string"&&!ze(Te))if(typeof Te.toString=="function"){if(Te=Te.toString(),typeof Te!="string")throw Ts("dirty is not a string, aborting")}else throw Ts("toString is not a function");if(!e.isSupported)return Te;if(Xt||jr(E),e.removed=[],typeof Te=="string"&&(Rn=!1),Rn){if(Te.nodeName){const en=Dt(Te.nodeName);if(!ne[en]||ue[en])throw Ts("root node is forbidden and cannot be sanitized in-place")}}else if(Te instanceof d)ge=Ue("<!---->"),_e=ge.ownerDocument.importNode(Te,!0),_e.nodeType===As.element&&_e.nodeName==="BODY"||_e.nodeName==="HTML"?ge=_e:ge.appendChild(_e);else{if(!Zt&&!Be&&!kt&&Te.indexOf("<")===-1)return C&&Ye?C.createHTML(Te):Te;if(ge=Ue(Te),!ge)return Zt?null:Ye?V:""}ge&&fn&&xn(ge.firstChild);const At=vt(Rn?Te:ge);for(;Xe=At.nextNode();)Et(Xe),dt(Xe),Xe.content instanceof o&&Rt(Xe.content);if(Rn)return Te;if(Zt){if(Lt)for(lt=le.call(ge.ownerDocument);ge.firstChild;)lt.appendChild(ge.firstChild);else lt=ge;return(H.shadowroot||H.shadowrootmode)&&(lt=Ae.call(a,lt,!0)),lt}let Ot=kt?ge.outerHTML:ge.innerHTML;return kt&&ne["!doctype"]&&ge.ownerDocument&&ge.ownerDocument.doctype&&ge.ownerDocument.doctype.name&&gn(gd,ge.ownerDocument.doctype.name)&&(Ot="<!DOCTYPE "+ge.ownerDocument.doctype.name+`>
`+Ot),Be&&fi([te,ce,we],en=>{Ot=Ss(Ot,en," ")}),C&&Ye?C.createHTML(Ot):Ot},e.setConfig=function(){let Te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};jr(Te),Xt=!0},e.clearConfig=function(){wr=null,Xt=!1},e.isValidAttribute=function(Te,E,ge){wr||jr({});const _e=Dt(Te),Xe=Dt(E);return qt(_e,Xe,ge)},e.addHook=function(Te,E){typeof E=="function"&&xs(ve[Te],E)},e.removeHook=function(Te,E){if(E!==void 0){const ge=_g(ve[Te],E);return ge===-1?void 0:yg(ve[Te],ge,1)[0]}return Sc(ve[Te])},e.removeHooks=function(Te){ve[Te]=[]},e.removeAllHooks=function(){ve=Ic()},e}var Lg=_d();function Ng(t){const e=[];e.push(`# ${t.subject}`),e.push(""),e.push("| | |"),e.push("|---|---|"),e.push(`| **From** | ${Rc(t.from)} |`),e.push(`| **To** | ${Rc(t.to)} |`),e.push(`| **Date** | ${ul(t.date)} |`),e.push(""),e.push("---"),e.push("");const n=t.htmlBody?qg(t.htmlBody):null;return e.push(n||t.body||"*(no body)*"),e.push(""),e.join(`
`)}function Rc(t){return(t||"").replace(/\|/g,"\\|")}function qg(t){try{const e=new DOMParser().parseFromString(t,"text/html");for(const n of e.querySelectorAll("style, script, head"))n.remove();return Ho(e.body).replace(/\n{3,}/g,`

`).trim()}catch{return null}}function Bg(t,e){if(!e||e.startsWith("data:"))return!0;const n=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10);if(n>0&&n<=3||a>0&&a<=3)return!0;const i=e.toLowerCase();return i.includes("spacer")||i.includes("transparent")||i.includes("transp.gif")||i.includes("/track")&&i.includes("pixel")||/amazon\.com\/gp\/r\.html\?/.test(e)||/[?&](open|track|beacon|pixel|img)=/i.test(i)?!0:i.includes("mail.google.com/mail/u/")&&i.includes("view=fimg")?!1:!!(/ci\d+\.\w+\.com\//.test(i)||i.endsWith(".gif")&&i.includes("1x1"))}function Ho(t){var i;if(t.nodeType===3)return t.textContent.replace(/[ \t]+/g," ");if(t.nodeType!==1)return"";const e=t.tagName.toLowerCase();if(e==="br")return`
`;if(e==="hr")return`

---

`;if(e==="img"){const o=t.getAttribute("src")||"",u=t.getAttribute("alt")||"";return Bg(t,o)?"":`![${u}](${o})`}const n=Array.from(t.childNodes).map(Ho).join(""),a=n.trim();if(!a&&!["img","br","hr"].includes(e))return n;if(e==="p"||e==="div")return`

${a}

`;if(e==="blockquote")return`

> ${a.replace(/\n/g,`
> `)}

`;if(/^h[1-6]$/.test(e)){const o=Number(e[1]);return`

${"#".repeat(o)} ${a}

`}if(e==="ul"||e==="ol")return`

${n}

`;if(e==="li")return`${((i=t.parentElement)==null?void 0:i.tagName.toLowerCase())==="ol"?"1.":"-"} ${a}
`;if(e==="a"){const o=t.getAttribute("href")||"";return!o||o.startsWith("mailto:")?a:a===o?o:`[${a}](${o})`}if(e==="strong"||e==="b")return`**${a}**`;if(e==="em"||e==="i")return`*${a}*`;if(e==="code")return`\`${a}\``;if(e==="table")return`

${n}

`;if(e==="tr")return`| ${Array.from(t.children).map(u=>Ho(u).trim()).join(" | ")} |
`;if(e==="td"||e==="th")return n;if(e==="thead"){const o=n.trim(),u=(o.match(/\|/g)||[]).length-1,d="| "+Array(Math.max(u,1)).fill("---").join(" | ")+" |";return`${o}${d}
`}return n}function Fg(t){return Ku(t,"md")}function Oc(t,e,n="text/markdown;charset=utf-8"){const a=new Blob([t],{type:n}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}function zg(t){return t.raw||null}function Kg(t){const e=zg(t);return e?JSON.stringify(e,null,2):"null"}function Ug(t){return Ku(t,"json")}var Gg=M('<button title="View as Markdown">.md</button>'),Wg=M('<div class="md-toolbar svelte-1b0rzpb"><span class="toolbar-label svelte-1b0rzpb">JSON</span> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .json file">Download</button></div> <div class="md-body svelte-1b0rzpb"><pre class="md-raw svelte-1b0rzpb"> </pre></div>',1),Hg=M('<pre class="md-raw svelte-1b0rzpb"> </pre>'),Vg=M('<div class="md-preview svelte-1b0rzpb"><!></div>'),Yg=M('<div class="md-toolbar svelte-1b0rzpb"><div class="md-tabs svelte-1b0rzpb"><button>Raw</button> <button>Preview</button></div> <button class="action-btn download-btn svelte-1b0rzpb" title="Download .md file">Download</button></div> <div class="md-body svelte-1b0rzpb"><!></div>',1),Qg=M('<div class="loading-state svelte-1b0rzpb"><span class="spinner svelte-1b0rzpb"></span> <span>Loading message...</span></div>'),Xg=M('<iframe class="html-frame svelte-1b0rzpb" sandbox="allow-same-origin" title="Email content"></iframe>'),Zg=M('<pre class="message-text svelte-1b0rzpb"> </pre>'),Jg=M('<p class="empty-body svelte-1b0rzpb">Loading...</p>'),$g=M('<div class="modal-meta svelte-1b0rzpb"><div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">From:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">To:</span> <span> </span></div> <div class="meta-row svelte-1b0rzpb"><span class="meta-label svelte-1b0rzpb">Date:</span> <span> </span></div></div> <div class="modal-body svelte-1b0rzpb"><!></div>',1),e_=M('<div class="modal-overlay svelte-1b0rzpb" role="dialog" aria-modal="true"><div class="modal-content svelte-1b0rzpb" role="document"><div class="modal-header svelte-1b0rzpb"><h3 class="modal-subject svelte-1b0rzpb"> </h3> <div class="header-actions svelte-1b0rzpb"><button title="View as JSON">.json</button> <!> <button class="modal-close svelte-1b0rzpb">â</button></div></div> <!></div></div>');function t_(t,e){Pt(e,!0);let n=Me(e,"loading",3,!1);dn(()=>zn("MessageModal"));const a=new bt.Renderer;a.link=({href:te,title:ce,text:we})=>{const re=ce?` title="${ce}"`:"";return`<a href="${te}"${re} target="_blank" rel="noopener">${we}</a>`},bt.setOptions({breaks:!0,gfm:!0,renderer:a});let i=Oe("email"),o=ht(()=>e.message.body?Ng(e.message):""),u=ht(()=>Kg(e.message)),d=Oe("raw");function g(te){A(i,v(i)===te?"email":te,!0),te==="markdown"&&A(d,"raw")}function p(){Oc(v(o),Fg(e.message))}function b(){Oc(v(u),Ug(e.message),"application/json;charset=utf-8")}function w(te){const ce=bt.parse(te);return Lg.sanitize(ce,{ADD_ATTR:["target"],ALLOW_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","blockquote","pre","code","strong","b","em","i","a","img","ul","ol","li","table","thead","tbody","tr","th","td","del","s"]})}let k=Oe(null);ja(()=>{var te;if(v(k)&&e.message.htmlBody&&!n()&&v(i)==="email"){const ce=v(k).contentDocument||((te=v(k).contentWindow)==null?void 0:te.document);ce&&(ce.open(),ce.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="utf-8">
            <style>
              body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
                color: #e0e0e0;
                background: #1a1a1a;
                margin: 0;
                padding: 16px;
                word-break: break-word;
              }
              a { color: #60a5fa; }
              img { max-width: 100%; height: auto; }
              table { border-collapse: collapse; max-width: 100%; }
              td, th { padding: 4px 8px; }
            </style>
          </head>
          <body>${e.message.htmlBody}</body>
          </html>
        `),ce.close())}});var x=e_();x.__click=function(...te){var ce;(ce=e.onclose)==null||ce.apply(this,te)};var I=h(x);I.__click=te=>te.stopPropagation();var B=h(I),R=h(B),X=h(R),Y=_(R,2),U=h(Y);let C;U.__click=()=>g("json");var V=_(U,2);{var J=te=>{var ce=Gg();let we;ce.__click=()=>g("markdown"),ee(()=>we=Ct(ce,1,"action-btn svelte-1b0rzpb",null,we,{active:v(i)==="markdown"})),T(te,ce)};ae(V,te=>{e.message.body&&te(J)})}var F=_(V,2);F.__click=function(...te){var ce;(ce=e.onclose)==null||ce.apply(this,te)};var le=_(B,2);{var xe=te=>{var ce=Wg(),we=$e(ce),re=_(h(we),2);re.__click=b;var me=_(we,2),Se=h(me),ie=h(Se);ee(()=>K(ie,v(u))),T(te,ce)},Ae=te=>{var ce=Yg(),we=$e(ce),re=h(we),me=h(re);let Se;me.__click=()=>A(d,"raw");var ie=_(me,2);let pe;ie.__click=()=>A(d,"preview");var se=_(re,2);se.__click=p;var ne=_(we,2),he=h(ne);{var H=fe=>{var ue=Hg(),ke=h(ue);ee(()=>K(ke,v(o))),T(fe,ue)},$=fe=>{var ue=Vg(),ke=h(ue);cv(ke,()=>w(v(o))),T(fe,ue)};ae(he,fe=>{v(d)==="raw"?fe(H):fe($,!1)})}ee(()=>{Se=Ct(me,1,"md-tab svelte-1b0rzpb",null,Se,{active:v(d)==="raw"}),pe=Ct(ie,1,"md-tab svelte-1b0rzpb",null,pe,{active:v(d)==="preview"})}),T(te,ce)},ve=te=>{var ce=$g(),we=$e(ce),re=h(we),me=_(h(re),2),Se=h(me),ie=_(re,2),pe=_(h(ie),2),se=h(pe),ne=_(ie,2),he=_(h(ne),2),H=h(he),$=_(we,2),fe=h($);{var ue=z=>{var Re=Qg();T(z,Re)},ke=z=>{var Re=Xg();Ou(Re,De=>A(k,De),()=>v(k)),T(z,Re)},Ke=z=>{var Re=Zg(),De=h(Re);ee(()=>K(De,e.message.body)),T(z,Re)},Ve=z=>{var Re=Jg();T(z,Re)};ae(fe,z=>{n()?z(ue):e.message.htmlBody?z(ke,1):e.message.body?z(Ke,2):z(Ve,!1)})}ee(z=>{K(Se,e.message.from),K(se,e.message.to),K(H,z)},[()=>ul(e.message.date)]),T(te,ce)};ae(le,te=>{v(i)==="json"?te(xe):v(i)==="markdown"?te(Ae,1):te(ve,!1)})}ee(()=>{K(X,e.message.subject),C=Ct(U,1,"action-btn svelte-1b0rzpb",null,C,{active:v(i)==="json"})}),T(t,x),It()}Wt(["click"]);var n_=M('<div class="load-more svelte-6ts5xm"><button class="btn svelte-6ts5xm"> </button></div>'),r_=M('<div class="list-header svelte-6ts5xm"><span class="list-count svelte-6ts5xm"> </span></div> <!> <!>',1),a_=M('<div class="loading-state svelte-6ts5xm"><span class="spinner svelte-6ts5xm"></span> <span>Loading messages...</span></div>'),s_=M("<p> </p>"),i_=M('<p>No emails in local storage. Click "Sync New" to download.</p>'),o_=M('<div class="empty-state svelte-6ts5xm"><!></div>'),l_=M('<div class="empty-state svelte-6ts5xm"><p>Sync your emails to browse them locally.</p></div>'),c_=M('<div class="main-content svelte-6ts5xm"><!> <!> <!> <div class="toolbar svelte-6ts5xm"><input type="text" class="search-input svelte-6ts5xm" placeholder="Search stored emails (subject, sender, snippet)..."/> <button class="btn primary svelte-6ts5xm"> </button></div> <!></div> <!>',1);function u_(t,e){Pt(e,!0),dn(()=>zn("DashboardView"));let n=Me(e,"error",3,null),a=Me(e,"profile",3,null),i=Me(e,"loadingProfile",3,!1),o=Me(e,"emailMessages",19,()=>[]),u=Me(e,"totalLocalMessages",3,0),d=Me(e,"hasMoreLocal",3,!1),g=Me(e,"loadingMessages",3,!1),p=Me(e,"selectedMessage",3,null),b=Me(e,"syncStatus",3,null),w=Me(e,"syncProgress",3,null),k=Me(e,"isSyncing",3,!1),x=Me(e,"searchQuery",15);var I=c_(),B=$e(I),R=h(B);{var X=re=>{nd(re,{get error(){return n()},get ondismiss(){return e.ondismisserror},get onsignout(){return e.onsignout}})};ae(R,re=>{n()&&re(X)})}var Y=_(R,2);cm(Y,{get profile(){return a()},get loadingProfile(){return i()},get onsignout(){return e.onsignout}});var U=_(Y,2);km(U,{get syncStatus(){return b()},get syncProgress(){return w()},get isSyncing(){return k()},get onsync(){return e.onsync},get onsyncmore(){return e.onsyncmore},get onclear(){return e.oncleardata}});var C=_(U,2),V=h(C);V.__keydown=re=>re.key==="Enter"&&e.onsearch();var J=_(V,2);J.__click=function(...re){var me;(me=e.onsearch)==null||me.apply(this,re)};var F=h(J),le=_(C,2);{var xe=re=>{var me=r_(),Se=$e(me),ie=h(Se),pe=h(ie),se=_(Se,2);Tm(se,{get messages(){return o()},get onselect(){return e.onviewmessage}});var ne=_(se,2);{var he=H=>{var $=n_(),fe=h($);fe.__click=function(...ke){var Ke;(Ke=e.onloadmore)==null||Ke.apply(this,ke)};var ue=h(fe);ee(()=>{fe.disabled=g(),K(ue,g()?"Loading...":"Load More")}),T(H,$)};ae(ne,H=>{d()&&H(he)})}ee(H=>K(pe,`Showing ${o().length??""} of ${H??""}
        ${x()?" matching":""} emails`),[()=>u().toLocaleString()]),T(re,me)},Ae=re=>{var me=a_();T(re,me)},ve=re=>{var me=o_(),Se=h(me);{var ie=se=>{var ne=s_(),he=h(ne);ee(()=>K(he,`No emails match "${x()??""}".`)),T(se,ne)},pe=se=>{var ne=i_();T(se,ne)};ae(Se,se=>{x()?se(ie):se(pe,!1)})}T(re,me)},te=re=>{var me=l_();T(re,me)};ae(le,re=>{var me;o().length>0?re(xe):g()?re(Ae,1):(me=b())!=null&&me.synced?re(ve,2):re(te,!1)})}var ce=_(B,2);{var we=re=>{t_(re,{get message(){return p()},loading:!1,get onclose(){return e.onclosedetail}})};ae(ce,re=>{p()&&re(we)})}ee(()=>{J.disabled=g(),K(F,g()?"Searching...":"Search")}),Di(V,x),T(t,I),It()}Wt(["keydown","click"]);var d_=M('<div class="dashboard svelte-1q5o2lv"><!></div>');function f_(t,e){Pt(e,!0);function n(z){z.key==="Escape"&&v(w)&&se()}let a=null;dn(()=>(window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n),a&&clearTimeout(a)}));function i(){a&&clearTimeout(a);const z=Lh();if(z<=0)return;const Re=Math.max(0,z-120*1e3);a=setTimeout(async()=>{try{const De=await pc();A(p,De.access_token,!0),i()}catch{A(p,null),A(b,null),A(U,"Session expired. Please sign in again.")}},Re)}async function o(){if(jh())return v(p);try{const z=await pc();return A(p,z.access_token,!0),i(),v(p)}catch{return A(p,null),A(b,null),A(U,"Session expired. Please sign in again."),null}}let u=Oe(Gt(localStorage.getItem("googleClientId")||"")),d=Oe(Gt(localStorage.getItem("googleClientId")||"")),g=Oe(!1),p=Oe(null),b=Oe(null),w=Oe(null),k=Oe(""),x=Oe(Gt([])),I=Oe(0),B=Oe(0),R=Oe(!1),X=Oe(!1),Y=Oe(!1),U=Oe(null),C=Oe(null),V=Oe(null),J=Oe(!1);const F=50;ja(()=>{v(p)&&(ne(),me())});let le=ht(()=>!v(u)),xe=ht(()=>!!v(p)),Ae=ht(()=>v(x).length<v(I));ja(()=>{v(u)&&!v(g)&&hc(v(u)).then(()=>{if(A(g,!0),!v(p)){const z=Dh();z&&(A(p,z.access_token,!0),i(),re())}}).catch(z=>{A(U,`Auth init failed: ${z.message}`)})});function ve(){const z=v(d).trim();z&&(localStorage.setItem("googleClientId",z),A(u,z,!0),A(U,null))}function te(){localStorage.removeItem("googleClientId"),A(u,""),A(d,""),A(g,!1),A(p,null),A(b,null),A(x,[],!0),A(I,0)}async function ce(){A(U,null),A(X,!0);try{v(g)||(await hc(v(u)),A(g,!0));const z=await qh();A(p,z.access_token,!0),i(),await re()}catch(z){A(U,z.message,!0)}finally{A(X,!1)}}async function we(){if(a&&clearTimeout(a),v(p))try{await Bh(v(p))}catch{}A(p,null),A(b,null),A(x,[],!0),A(I,0),A(w,null),A(U,null)}async function re(){A(Y,!0);try{const z=await Nu(v(p));if(!v(p))return;A(b,z,!0)}catch(z){if(!v(p))return;A(U,`Profile fetch failed: ${z.message}`)}finally{A(Y,!1)}}async function me(z=!1){A(R,!0);try{const Re=z?v(B):0,De=await Wv({query:v(k)||void 0,limit:F,offset:Re});z?A(x,[...v(x),...De.items],!0):A(x,De.items,!0),A(I,De.total,!0),A(B,v(x).length,!0)}catch(Re){A(U,`Failed to load messages: ${Re.message}`)}finally{A(R,!1)}}function Se(){A(B,0),me(!1)}function ie(){me(!0)}function pe(z){A(w,z,!0)}function se(){A(w,null)}async function ne(){try{A(C,await Kh(),!0)}catch{}}async function he(z){if(v(J)||!v(p))return;const Re=await o();if(!Re)return;A(U,null),A(J,!0),A(V,null);const De=new AbortController;try{await Fh(Re,{limit:z,onProgress:Be=>{A(V,{...Be},!0)},signal:De.signal}),await ne(),await me(!1)}catch(Be){if(Be.name!=="AbortError"){if(!v(p))return;A(U,`Sync failed: ${Be.message}`)}}finally{A(J,!1)}}async function H(z){if(v(J)||!v(p))return;const Re=await o();if(!Re)return;A(U,null),A(J,!0),A(V,null);const De=new AbortController;try{await zh(Re,{limit:z,onProgress:Be=>{A(V,{...Be},!0)},signal:De.signal}),await ne(),await me(!1)}catch(Be){if(Be.name!=="AbortError"){if(!v(p))return;A(U,`Sync more failed: ${Be.message}`)}}finally{A(J,!1)}}async function $(){try{await Ju(),await ne(),A(x,[],!0),A(I,0),A(B,0)}catch(z){A(U,`Failed to clear data: ${z.message}`)}}var fe=d_(),ue=h(fe);{var ke=z=>{Yh(z,{onsave:ve,get clientIdInput(){return v(d)},set clientIdInput(Re){A(d,Re,!0)}})},Ke=z=>{sm(z,{get clientId(){return v(u)},get error(){return v(U)},get loadingAuth(){return v(X)},onsignin:ce,onclear:te,onsignout:we})},Ve=z=>{u_(z,{get error(){return v(U)},get profile(){return v(b)},get loadingProfile(){return v(Y)},get emailMessages(){return v(x)},get totalLocalMessages(){return v(I)},get hasMoreLocal(){return v(Ae)},get loadingMessages(){return v(R)},get selectedMessage(){return v(w)},get syncStatus(){return v(C)},get syncProgress(){return v(V)},get isSyncing(){return v(J)},onsignout:we,onsearch:Se,onloadmore:ie,onviewmessage:pe,onclosedetail:se,ondismisserror:()=>A(U,null),onsync:he,onsyncmore:H,oncleardata:$,get searchQuery(){return v(k)},set searchQuery(Re){A(k,Re,!0)}})};ae(ue,z=>{v(le)?z(ke):v(xe)?z(Ve,!1):z(Ke,1)})}T(t,fe),It()}var v_=M('<span class="sep svelte-t1ig66">Â·</span> ',1),p_=M('<div class="email-card svelte-t1ig66"><div class="email-subj svelte-t1ig66"> </div> <div class="email-meta svelte-t1ig66"> <!></div></div>'),h_=M('<div class="stat svelte-t1ig66"><span class="stat-val svelte-t1ig66"> </span> <span class="stat-label svelte-t1ig66">remaining</span></div>'),m_=M('<div class="stats-row svelte-t1ig66"><div class="stat svelte-t1ig66"><span class="stat-val svelte-t1ig66"> </span> <span class="stat-label svelte-t1ig66">tok/s</span></div> <div class="stat svelte-t1ig66"><span class="stat-val svelte-t1ig66"> </span> <span class="stat-label svelte-t1ig66">tokens</span></div> <!></div>'),g_=M('<span class="llm-stream-badge svelte-t1ig66">Live</span>'),__=M('<div class="llm-stream-box svelte-t1ig66"><div class="llm-stream-header svelte-t1ig66"><span class="llm-stream-label svelte-t1ig66"><!></span> <!></div> <div class="llm-output-content svelte-t1ig66"> </div></div>'),y_=M('<details class="debug-details svelte-t1ig66"><summary class="debug-summary svelte-t1ig66">View progress.results array (click to expand)</summary> <pre class="debug-raw svelte-t1ig66"> </pre></details>'),b_=M('<details class="debug-details svelte-t1ig66"><summary class="debug-summary svelte-t1ig66">View processedEmails array (click to expand)</summary> <pre class="debug-raw svelte-t1ig66"> </pre></details>'),w_=M('<span class="processed-badge final svelte-t1ig66">Final Results</span>'),k_=M('<span class="processed-badge live svelte-t1ig66">Live Updates</span>'),x_=M('<br class="svelte-t1ig66"/> ',1),S_=M('â ï¸ <strong class="svelte-t1ig66">No emails were processed!</strong> <div class="empty-details svelte-t1ig66"> <!></div>',1),T_=M('<div class="processed-empty svelte-t1ig66"><!></div>'),E_=M('<span class="pi-action error svelte-t1ig66">â ERROR</span>'),A_=M('<span class="pi-action svelte-t1ig66"> </span>'),C_=M('<span class="sep svelte-t1ig66">Â·</span> ',1),P_=M('<div class="pi-error-msg svelte-t1ig66"> </div>'),I_=M('<div class="pi-summary svelte-t1ig66"> </div>'),R_=M('<span class="pi-tag svelte-t1ig66"> </span>'),O_=M('<div class="pi-tags svelte-t1ig66"></div>'),M_=M('<div class="pi-stats svelte-t1ig66"><span class="pi-stat-item svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="pi-stat-item svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="pi-stat-item svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="pi-stat-item svelte-t1ig66"> </span></div>'),D_=M('<div class="pi-stats warning svelte-t1ig66">â ï¸ No stats available</div>'),j_=M('<details class="pi-llm-details svelte-t1ig66"><summary class="pi-llm-toggle svelte-t1ig66"> </summary> <div class="llm-output-content svelte-t1ig66"> </div></details>'),L_=M('<div class="pi-no-response svelte-t1ig66">â ï¸ No raw LLM response captured</div>'),N_=M("<!> <!> <!> <!>",1),q_=M('<div><div class="pi-head svelte-t1ig66"><span class="pi-index svelte-t1ig66"> </span> <span class="pi-subj svelte-t1ig66"> </span> <!></div> <div class="pi-meta svelte-t1ig66"> <!></div> <!></div>'),B_=M('<div class="summary-stat svelte-t1ig66"><span class="sstat-val svelte-t1ig66"> </span> <span class="sstat-label svelte-t1ig66">already classified</span></div>'),F_=M('<div class="summary-stat svelte-t1ig66"><span class="sstat-val err svelte-t1ig66"> </span> <span class="sstat-label svelte-t1ig66">errors</span></div>'),z_=M('<span class="ssec-item svelte-t1ig66">Avg speed: <strong class="svelte-t1ig66"> </strong></span> <span class="sep svelte-t1ig66">Â·</span>',1),K_=M('<div class="summary-card svelte-t1ig66"><div class="summary-head svelte-t1ig66"><span class="summary-title svelte-t1ig66">Scan Summary</span></div> <div class="summary-grid svelte-t1ig66"><div class="summary-stat svelte-t1ig66"><span class="sstat-val svelte-t1ig66"> </span> <span class="sstat-label svelte-t1ig66">emails processed</span></div> <!> <div class="summary-stat svelte-t1ig66"><span class="sstat-val success svelte-t1ig66"> </span> <span class="sstat-label svelte-t1ig66">classified</span></div> <!></div> <div class="summary-section svelte-t1ig66"><div class="ssec-title svelte-t1ig66">LLM Performance</div> <div class="ssec-items svelte-t1ig66"><!> <span class="ssec-item svelte-t1ig66">Total tokens: <strong class="svelte-t1ig66"> </strong></span> <span class="sep svelte-t1ig66">Â·</span> <span class="ssec-item svelte-t1ig66">Duration: <strong class="svelte-t1ig66"> </strong></span></div></div> <div class="summary-section svelte-t1ig66"><div class="ssec-title svelte-t1ig66">Model & Prompts</div> <div class="ssec-items svelte-t1ig66"><span class="ssec-item svelte-t1ig66">Model: <strong class="svelte-t1ig66"> </strong> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="ssec-item svelte-t1ig66">System prompt: <strong class="svelte-t1ig66"> </strong></span> <span class="sep svelte-t1ig66">Â·</span> <span class="ssec-item svelte-t1ig66">Avg email: <strong class="svelte-t1ig66"> </strong></span></div></div></div>'),U_=M('<span class="err svelte-t1ig66"> </span>'),G_=M('<div class="totals svelte-t1ig66"><span class="svelte-t1ig66"> </span> <!> <span class="sep svelte-t1ig66">Â·</span> <span class="svelte-t1ig66"> </span> <span class="sep svelte-t1ig66">Â·</span> <span class="svelte-t1ig66"> </span></div>'),W_=M('<button class="action-btn svelte-t1ig66">View Prompt Config</button> <button class="action-btn primary svelte-t1ig66">Close</button>',1),H_=M('<button class="action-btn svelte-t1ig66">View Prompt</button> <button class="action-btn stop svelte-t1ig66">Stop</button>',1),V_=M('<div class="live svelte-t1ig66"><div class="live-head svelte-t1ig66"><span class="live-title svelte-t1ig66"><!></span> <span class="live-pct svelte-t1ig66"> </span></div> <div class="bar-track svelte-t1ig66"><div></div></div> <!> <!> <!> <div class="debug-panel svelte-t1ig66"><div class="debug-title svelte-t1ig66">ð Scan Debug Info</div> <div class="debug-grid svelte-t1ig66"><div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Phase:</span> <span class="debug-value svelte-t1ig66"> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Current/Total:</span> <span class="debug-value svelte-t1ig66"> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Captured Emails:</span> <span> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Results Array:</span> <span> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Classified:</span> <span> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Errors:</span> <span> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Using:</span> <span class="debug-value svelte-t1ig66"> </span></div> <div class="debug-item svelte-t1ig66"><span class="debug-label svelte-t1ig66">Display Count:</span> <span> </span></div></div> <!> <!></div> <div class="processed-list svelte-t1ig66"><div class="processed-header svelte-t1ig66"><span class="processed-title svelte-t1ig66">ð§ Processed Emails <!></span> <span class="processed-count svelte-t1ig66"> </span></div> <!></div> <!> <div class="actions svelte-t1ig66"><!></div></div>');function Y_(t,e){Pt(e,!0);let n=Me(e,"progress",3,null),a=Oe(Gt([])),i=Oe(-1);ja(()=>{if(!n()){A(a,[],!0),A(i,-1);return}if(n().phase==="loading"){A(a,[],!0),A(i,-1);return}n().phase==="classified"&&n().current!==v(i)&&(A(a,[...v(a),{index:n().current,email:n().email,result:n().result,rawResponse:n().rawResponse||"",stats:n().emailStats}],!0),A(i,n().current,!0))});function o(Y){return!Y||Y<0?"â":Y<1e3?`${Math.round(Y)}ms`:`${(Y/1e3).toFixed(1)}s`}function u(Y){return Y?Y>=1e3?`${(Y/1e3).toFixed(1)}k`:String(Y):"0"}function d(Y){if(!Y)return"â";const U=Y.replace(/<.*>/,"").trim();return U.length>30?U.slice(0,28)+"â¦":U}function g(Y){if(!Y)return"";try{return new Date(Y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function p(Y){var V;if(!((V=Y==null?void 0:Y.totals)!=null&&V.elapsed)||!(Y!=null&&Y.current)||Y.current<2)return null;const U=Y.totals.elapsed/Y.current;return(Y.total-Y.current)*U}let b=ht(()=>{var Y;return(Y=n())!=null&&Y.total?Math.round(n().current/n().total*100):0}),w=ht(()=>p(n())),k=ht(()=>{var Y;return((Y=n())==null?void 0:Y.phase)==="done"}),x=ht(()=>{var Y,U,C;return((Y=n())==null?void 0:Y.phase)==="done"&&((C=(U=n())==null?void 0:U.results)==null?void 0:C.length)>0}),I=ht(()=>{var Y;return v(x)&&((Y=n())!=null&&Y.results)?n().results.map((U,C)=>({index:C+1,email:U.email,result:U.success?U.classification:null,rawResponse:U.rawResponse||"",stats:U.stats,error:U.success?null:U.error})):v(a)});var B=pr(),R=$e(B);{var X=Y=>{var U=V_(),C=h(U),V=h(C),J=h(V);{var F=je=>{var Ue=Nn("Scan complete");T(je,Ue)},le=je=>{var Ue=Nn("Loading emails...");T(je,Ue)},xe=je=>{var Ue=Nn();ee(()=>K(Ue,`Processing ${n().current??0??""} of ${n().total??0??""}`)),T(je,Ue)};ae(J,je=>{v(k)?je(F):n().phase==="loading"?je(le,1):je(xe,!1)})}var Ae=_(V,2),ve=h(Ae),te=_(C,2),ce=h(te);let we,re;var me=_(te,2);{var Se=je=>{var Ue=p_(),vt=h(Ue),St=h(vt),ze=_(vt,2),Ze=h(ze),Et=_(Ze);{var qt=at=>{var dt=v_(),Rt=_($e(dt),1,!0);ee(Te=>K(Rt,Te),[()=>g(n().email.date)]),T(at,dt)};ae(Et,at=>{n().email.date&&at(qt)})}ee(at=>{K(St,n().email.subject||"(no subject)"),K(Ze,`${at??""} `)},[()=>d(n().email.from)]),T(je,Ue)};ae(me,je=>{n().email&&!v(k)&&je(Se)})}var ie=_(me,2);{var pe=je=>{var Ue=m_(),vt=h(Ue),St=h(vt),ze=h(St),Ze=_(vt,2),Et=h(Ze),qt=h(Et),at=_(Ze,2);{var dt=Rt=>{var Te=h_(),E=h(Te),ge=h(E);ee(_e=>K(ge,`~${_e??""}`),[()=>o(v(w))]),T(Rt,Te)};ae(at,Rt=>{v(w)&&Rt(dt)})}ee(Rt=>{K(ze,Rt),K(qt,n().live.numTokens||0)},[()=>n().live.tps?n().live.tps.toFixed(0):"â"]),T(je,Ue)};ae(ie,je=>{n().live&&n().phase==="generating"&&je(pe)})}var se=_(ie,2);{var ne=je=>{var Ue=__(),vt=h(Ue),St=h(vt),ze=h(St);{var Ze=Te=>{var E=Nn("LLM Output");T(Te,E)},Et=Te=>{var E=Nn("Sending to modelâ¦");T(Te,E)};ae(ze,Te=>{n().phase==="generating"?Te(Ze):Te(Et,!1)})}var qt=_(St,2);{var at=Te=>{var E=g_();T(Te,E)};ae(qt,Te=>{n().phase==="generating"&&Te(at)})}var dt=_(vt,2),Rt=h(dt);ee(()=>K(Rt,n().streamingText||"Waiting for modelâ¦")),T(je,Ue)};ae(se,je=>{!v(k)&&(n().phase==="generating"||n().phase==="scanning")&&n().email&&je(ne)})}var he=_(se,2),H=_(h(he),2),$=h(H),fe=_(h($),2),ue=h(fe),ke=_($,2),Ke=_(h(ke),2),Ve=h(Ke),z=_(ke,2),Re=_(h(z),2);let De;var Be=h(Re),Tt=_(z,2),kt=_(h(Tt),2);let Xt;var fn=h(kt),Zt=_(Tt,2),Lt=_(h(Zt),2);let Ye;var et=h(Lt),Ft=_(Zt,2),Jt=_(h(Ft),2);let mn;var Rn=h(Jt),Mt=_(Ft,2),Ht=_(h(Mt),2),Or=h(Ht),_r=_(Mt,2),Mr=_(h(_r),2);let tr;var Kn=h(Mr),Un=_(H,2);{var yr=je=>{var Ue=y_(),vt=_(h(Ue),2),St=h(vt);ee(ze=>K(St,ze),[()=>JSON.stringify(n().results,null,2)]),T(je,Ue)};ae(Un,je=>{var Ue;n().phase==="done"&&((Ue=n().results)==null?void 0:Ue.length)>0&&je(yr)})}var Vt=_(Un,2);{var qe=je=>{var Ue=b_(),vt=_(h(Ue),2),St=h(vt);ee(ze=>K(St,ze),[()=>JSON.stringify(v(a),null,2)]),T(je,Ue)};ae(Vt,je=>{v(a).length>0&&je(qe)})}var Gn=_(he,2),kn=h(Gn),Dr=h(kn),Ie=_(h(Dr));{var br=je=>{var Ue=w_();T(je,Ue)},za=je=>{var Ue=k_();T(je,Ue)};ae(Ie,je=>{v(x)?je(br):je(za,!1)})}var nr=_(Dr,2),Ka=h(nr),da=_(kn,2);{var Dt=je=>{var Ue=T_(),vt=h(Ue);{var St=at=>{var dt=Nn("â³ Loading emails from database...");T(at,dt)},ze=at=>{var dt=S_(),Rt=_($e(dt),3),Te=h(Rt),E=_(Te);{var ge=_e=>{var Xe=x_(),lt=_($e(Xe));ee(()=>K(lt,`â¢ Skipped: ${n().summary.skipped??""} (already classified)`)),T(_e,Xe)};ae(E,_e=>{var Xe;(Xe=n().summary)!=null&&Xe.skipped&&_e(ge)})}ee(()=>{var _e;return K(Te,`â¢ Captured during scan: ${v(a).length??""}
              â¢ In results array: ${(((_e=n().results)==null?void 0:_e.length)||0)??""}
              â¢ Classified count: ${(n().classified||0)??""} `)}),T(at,dt)},Ze=at=>{var dt=Nn("â³ Waiting for first email to complete...");T(at,dt)},Et=at=>{var dt=Nn("â First email just finished - should appear now!");T(at,dt)},qt=at=>{var dt=Nn();ee(()=>K(dt,`Waiting... (Phase: ${n().phase??""})`)),T(at,dt)};ae(vt,at=>{n().phase==="loading"?at(St):n().phase==="done"?at(ze,1):n().phase==="scanning"||n().phase==="generating"?at(Ze,2):n().phase==="classified"?at(Et,3):at(qt,!1)})}T(je,Ue)},wr=je=>{var Ue=pr(),vt=$e(Ue);Qt(vt,17,()=>v(I),yn,(St,ze)=>{var Ze=q_();let Et;var qt=h(Ze),at=h(qt),dt=h(at),Rt=_(at,2),Te=h(Rt),E=_(Rt,2);{var ge=Je=>{var zt=E_();T(Je,zt)},_e=Je=>{var zt=A_(),tn=h(zt);ee(()=>{var Wn;return K(tn,`â ${(((Wn=v(ze).result)==null?void 0:Wn.action)||"UNKNOWN")??""}`)}),T(Je,zt)};ae(E,Je=>{v(ze).error?Je(ge):Je(_e,!1)})}var Xe=_(qt,2),lt=h(Xe),At=_(lt);{var Ot=Je=>{var zt=C_(),tn=_($e(zt),1,!0);ee(Wn=>K(tn,Wn),[()=>g(v(ze).email.date)]),T(Je,zt)};ae(At,Je=>{v(ze).email.date&&Je(Ot)})}var en=_(Xe,2);{var Sn=Je=>{var zt=P_(),tn=h(zt);ee(()=>K(tn,v(ze).error)),T(Je,zt)},sr=Je=>{var zt=N_(),tn=$e(zt);{var Wn=Qe=>{var We=I_(),pt=h(We);ee(()=>K(pt,v(ze).result.summary)),T(Qe,We)};ae(tn,Qe=>{var We;(We=v(ze).result)!=null&&We.summary&&Qe(Wn)})}var tt=_(tn,2);{var Ua=Qe=>{var We=O_();Qt(We,21,()=>v(ze).result.tags,yn,(pt,Yt)=>{var $t=R_(),On=h($t);ee(()=>K(On,v(Yt))),T(pt,$t)}),T(Qe,We)};ae(tt,Qe=>{var We,pt;(pt=(We=v(ze).result)==null?void 0:We.tags)!=null&&pt.length&&Qe(Ua)})}var fa=_(tt,2);{var Nr=Qe=>{var We=M_(),pt=h(We),Yt=h(pt),$t=_(pt,4),On=h($t),Br=_($t,4),Va=h(Br),Fr=_(Br,4),va=h(Fr);ee((qi,mt)=>{K(Yt,`â¡ ${qi??""}`),K(On,`ð¥ ${(v(ze).stats.inputTokens||0)??""} in`),K(Va,`ð¤ ${(v(ze).stats.numTokens||0)??""} out`),K(va,`â±ï¸ ${mt??""}`)},[()=>v(ze).stats.tps?`${v(ze).stats.tps.toFixed(0)} tok/s`:"â",()=>o(v(ze).stats.elapsed)]),T(Qe,We)},qr=Qe=>{var We=D_();T(Qe,We)};ae(fa,Qe=>{v(ze).stats?Qe(Nr):Qe(qr,!1)})}var Ga=_(fa,2);{var Wa=Qe=>{var We=j_(),pt=h(We),Yt=h(pt),$t=_(pt,2),On=h($t);ee(()=>{K(Yt,`ð View raw LLM output (${v(ze).rawResponse.length??""} chars)`),K(On,v(ze).rawResponse)}),T(Qe,We)},Ha=Qe=>{var We=L_();T(Qe,We)};ae(Ga,Qe=>{v(ze).rawResponse?Qe(Wa):Qe(Ha,!1)})}T(Je,zt)};ae(en,Je=>{v(ze).error?Je(Sn):Je(sr,!1)})}ee(Je=>{Et=Ct(Ze,1,"processed-item svelte-t1ig66",null,Et,{failed:v(ze).error}),K(dt,`#${v(ze).index??""}`),il(Rt,"title",v(ze).email.subject),K(Te,v(ze).email.subject||"(no subject)"),K(lt,`${Je??""} `)},[()=>d(v(ze).email.from)]),T(St,Ze)}),T(je,Ue)};ae(da,je=>{v(I).length===0?je(Dt):je(wr,!1)})}var rr=_(Gn,2);{var ar=je=>{var Ue=K_(),vt=_(h(Ue),2),St=h(vt),ze=h(St),Ze=h(ze),Et=_(St,2);{var qt=We=>{var pt=B_(),Yt=h(pt),$t=h(Yt);ee(()=>K($t,n().summary.skipped)),T(We,pt)};ae(Et,We=>{var pt;(pt=n().summary)!=null&&pt.skipped&&We(qt)})}var at=_(Et,2),dt=h(at),Rt=h(dt),Te=_(at,2);{var E=We=>{var pt=F_(),Yt=h(pt),$t=h(Yt);ee(()=>K($t,n().errors)),T(We,pt)};ae(Te,We=>{n().errors>0&&We(E)})}var ge=_(vt,2),_e=_(h(ge),2),Xe=h(_e);{var lt=We=>{var pt=z_(),Yt=$e(pt),$t=_(h(Yt)),On=h($t);ee(()=>K(On,`${n().summary.avgTps??""} tok/s`)),T(We,pt)};ae(Xe,We=>{var pt;(pt=n().summary)!=null&&pt.avgTps&&We(lt)})}var At=_(Xe,2),Ot=_(h(At)),en=h(Ot),Sn=_(At,4),sr=_(h(Sn)),Je=h(sr),zt=_(ge,2),tn=_(h(zt),2),Wn=h(tn),tt=_(h(Wn)),Ua=h(tt),fa=_(tt),Nr=_(Wn,4),qr=_(h(Nr)),Ga=h(qr),Wa=_(Nr,4),Ha=_(h(Wa)),Qe=h(Ha);ee((We,pt,Yt,$t,On,Br,Va)=>{var Fr,va;K(Ze,((Fr=n().summary)==null?void 0:Fr.processed)||n().total||0),K(Rt,n().classified||0),K(en,`${We??""} in + ${pt??""} out`),K(Je,Yt),K(Ua,((va=n().summary)==null?void 0:va.modelName)||"Unknown"),K(fa,` (${$t??""}k context, ~${On??""}k email limit)`),K(Ga,`${Br??""} chars`),K(Qe,`${Va??""} chars`)},[()=>u(n().totals.inputTokens),()=>u(n().totals.outputTokens),()=>o(n().totals.elapsed),()=>{var We;return Math.round((((We=n().summary)==null?void 0:We.modelContextWindow)||0)/1024)},()=>{var We;return Math.round((((We=n().summary)==null?void 0:We.modelMaxEmailTokens)||0)/1e3)},()=>{var We;return u(((We=n().summary)==null?void 0:We.systemPromptSize)||0)},()=>{var We;return u(((We=n().summary)==null?void 0:We.avgPromptSize)||0)}]),T(je,Ue)},jr=je=>{var Ue=pr(),vt=$e(Ue);{var St=ze=>{var Ze=G_(),Et=h(Ze),qt=h(Et),at=_(Et,2);{var dt=_e=>{var Xe=U_(),lt=h(Xe);ee(()=>K(lt,`${n().errors??""} errors`)),T(_e,Xe)};ae(at,_e=>{n().errors&&_e(dt)})}var Rt=_(at,4),Te=h(Rt),E=_(Rt,4),ge=h(E);ee((_e,Xe,lt)=>{K(qt,`${(n().classified||0)??""} classified`),K(Te,`${_e??""} in + ${Xe??""} out tokens`),K(ge,lt)},[()=>u(n().totals.inputTokens),()=>u(n().totals.outputTokens),()=>o(n().totals.elapsed)]),T(ze,Ze)};ae(vt,ze=>{n().totals&&ze(St)})}T(je,Ue)};ae(rr,je=>{v(k)?je(ar):je(jr,!1)})}var Lr=_(rr,2),xt=h(Lr);{var Nt=je=>{var Ue=W_(),vt=$e(Ue);vt.__click=function(...ze){var Ze;(Ze=e.oninspect)==null||Ze.apply(this,ze)};var St=_(vt,2);St.__click=function(...ze){var Ze;(Ze=e.onclose)==null||Ze.apply(this,ze)},T(je,Ue)},xn=je=>{var Ue=H_(),vt=$e(Ue);vt.__click=function(...ze){var Ze;(Ze=e.oninspect)==null||Ze.apply(this,ze)};var St=_(vt,2);St.__click=function(...ze){var Ze;(Ze=e.onstop)==null||Ze.apply(this,ze)},T(je,Ue)};ae(xt,je=>{v(k)?je(Nt):je(xn,!1)})}ee(()=>{var je,Ue;K(ve,`${v(b)??""}%`),we=Ct(ce,1,"bar-fill svelte-t1ig66",null,we,{done:v(k)}),re=In(ce,"",re,{width:`${v(b)??""}%`}),K(ue,n().phase||"â"),K(Ve,`${(n().current||0)??""} / ${(n().total||0)??""}`),De=Ct(Re,1,"debug-value svelte-t1ig66",null,De,{good:v(a).length>0}),K(Be,v(a).length),Xt=Ct(kt,1,"debug-value svelte-t1ig66",null,Xt,{good:((je=n().results)==null?void 0:je.length)>0}),K(fn,((Ue=n().results)==null?void 0:Ue.length)||0),Ye=Ct(Lt,1,"debug-value svelte-t1ig66",null,Ye,{good:n().classified>0}),K(et,n().classified||0),mn=Ct(Jt,1,"debug-value svelte-t1ig66",null,mn,{bad:n().errors>0}),K(Rn,n().errors||0),K(Or,v(x)?"progress.results (Final)":"processedEmails (Live)"),tr=Ct(Mr,1,"debug-value svelte-t1ig66",null,tr,{good:v(I).length>0}),K(Kn,v(I).length),K(Ka,`${v(I).length??""}${n().total?` / ${n().total}`:""}`)}),T(Y,U)};ae(R,Y=>{n()&&Y(X)})}T(t,B),It()}Wt(["click"]);var Q_=M('<span class="spinner svelte-ois7em"></span>'),X_=sl('<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>'),Z_=M('<div class="scan-stats svelte-ois7em"><span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span> <span class="stat-sep svelte-ois7em">Â·</span> <span class="stat svelte-ois7em"> </span></div>'),J_=M("<option> </option>"),$_=M('<p class="scan-hint svelte-ois7em">Load a model on the Chat page first, then come back to scan.</p>'),ey=M('<div class="scan-card svelte-ois7em"><div class="scan-header svelte-ois7em"><div class="scan-icon svelte-ois7em"><!></div> <div class="scan-info svelte-ois7em"><div class="scan-title-row svelte-ois7em"><span class="scan-title svelte-ois7em">Email Triage</span> <button class="inspect-btn svelte-ois7em" title="View system prompt and LLM config"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Prompt</button></div> <span class="scan-status svelte-ois7em"><span class="status-dot svelte-ois7em"></span> </span></div></div> <!> <div class="scan-controls svelte-ois7em"><div class="control-group svelte-ois7em"><label class="control-label svelte-ois7em" for="scan-count">Emails:</label> <select id="scan-count" class="control-select svelte-ois7em"></select></div> <div class="btn-group svelte-ois7em"><button class="btn scan-btn primary svelte-ois7em"> </button> <button class="btn scan-btn svelte-ois7em" title="Rescan all (including already classified)">Rescan All</button></div></div> <!> <!></div>');function ty(t,e){Pt(e,!0);let n=Me(e,"engineStatus",3,"idle"),a=Me(e,"modelName",3,""),i=Me(e,"isScanning",3,!1),o=Me(e,"scanProgress",3,null),u=Me(e,"scanCount",15,20),d=Me(e,"stats",3,null);const g=[{value:1,label:"1"},{value:3,label:"3"},{value:5,label:"5"},{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"},{value:100,label:"100"},{value:500,label:"500"}];function p(){return n()==="ready"?`${a()} ready`:n()==="loading"?"Loading model...":n()==="generating"?"Model busy...":"No model loaded"}function b(){return n()==="ready"?"#34d399":n()==="loading"?"#fbbf24":"#666"}function w(){return n()==="ready"&&!i()}let k=ht(()=>{var H;return i()&&((H=o())==null?void 0:H.phase)!=="done"});var x=ey(),I=h(x),B=h(I),R=h(B);{var X=H=>{var $=Q_();T(H,$)},Y=H=>{var $=X_();T(H,$)};ae(R,H=>{v(k)?H(X):H(Y,!1)})}var U=_(B,2),C=h(U),V=_(h(C),2);V.__click=function(...H){var $;($=e.oninspect)==null||$.apply(this,H)};var J=_(C,2),F=h(J);let le;var xe=_(F),Ae=_(I,2);{var ve=H=>{var $=Z_(),fe=h($),ue=h(fe),ke=_(fe,4),Ke=h(ke),Ve=_(ke,4),z=h(Ve);ee(()=>{K(ue,`${d().totalEmails??""} emails in storage`),K(Ke,`${d().classified??""} classified`),K(z,`${d().unclassified??""} new`)}),T(H,$)};ae(Ae,H=>{d()&&H(ve)})}var te=_(Ae,2),ce=h(te),we=_(h(ce),2);Qt(we,21,()=>g,yn,(H,$)=>{var fe=J_(),ue=h(fe),ke={};ee(()=>{K(ue,v($).label),ke!==(ke=v($).value)&&(fe.value=(fe.__value=v($).value)??"")}),T(H,fe)});var re=_(ce,2),me=h(re);me.__click=function(...H){var $;($=e.onscan)==null||$.apply(this,H)};var Se=h(me),ie=_(me,2);ie.__click=function(...H){var $;($=e.onrescan)==null||$.apply(this,H)};var pe=_(te,2);{var se=H=>{var $=$_();T(H,$)};ae(pe,H=>{n()!=="ready"&&n()!=="loading"&&H(se)})}var ne=_(pe,2);{var he=H=>{Y_(H,{get progress(){return o()},get onstop(){return e.onstop},get oninspect(){return e.oninspect},get onclose(){return e.oncloseprogress}})};ae(ne,H=>{var $;(i()||(($=o())==null?void 0:$.phase)==="done")&&H(he)})}ee((H,$,fe,ue)=>{le=In(F,"",le,H),K(xe,` ${$??""}`),we.disabled=i(),me.disabled=fe,K(Se,v(k)?"Scanning...":i()?"Finalizing...":"Scan New"),ie.disabled=ue},[()=>({background:b()}),p,()=>!w(),()=>!w()]),Mi(we,u),T(t,x),It()}Wt(["click"]);var ny=M('<span class="row-date svelte-1czytqk"> </span>'),ry=M('<span class="tag svelte-1czytqk"> </span>'),ay=M('<span class="row-tags svelte-1czytqk"></span>'),sy=M('<span class="row-reason svelte-1czytqk"> </span>'),iy=M('<button class="icon-btn done-btn svelte-1czytqk" title="Mark handled"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg></button> <button class="icon-btn dismiss-btn svelte-1czytqk" title="Dismiss"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>',1),oy=M('<span class="status-label svelte-1czytqk"> </span>'),ly=M('<button class="icon-btn remove-btn svelte-1czytqk" title="Remove classification"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"></path><path d="M8 6V4h8v2"></path><path d="m19 6-.867 12.142A2 2 0 0 1 16.138 20H7.862a2 2 0 0 1-1.995-1.858L5 6"></path></svg></button>'),cy=M('<p class="summary-reason svelte-1czytqk"> </p>'),uy=M('<div class="summary-panel svelte-1czytqk"><p class="summary-text svelte-1czytqk"> </p> <!></div>'),dy=M('<div><button class="row-left svelte-1czytqk"><span class="row-subject svelte-1czytqk"> </span> <span class="row-meta svelte-1czytqk"><span class="row-from svelte-1czytqk"> </span> <!></span> <!> <!></button> <div class="row-actions svelte-1czytqk"><!> <!></div></div> <!>',1);function Mc(t,e){Pt(e,!0);let n=Me(e,"actionColor",3,"#666"),a=Me(e,"dimmed",3,!1);function i(re){if(!re)return"";try{return new Date(re).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}let o=ht(()=>e.item.status==="pending"),u=Oe(!1);var d=dy(),g=$e(d);let p;var b=h(g);b.__click=()=>A(u,!v(u));let w;var k=h(b),x=h(k),I=_(k,2),B=h(I),R=h(B),X=_(B,2);{var Y=re=>{var me=ny(),Se=h(me);ee(ie=>K(Se,ie),[()=>i(e.item.date)]),T(re,me)};ae(X,re=>{e.item.date&&re(Y)})}var U=_(I,2);{var C=re=>{var me=ay();Qt(me,21,()=>e.item.tags,yn,(Se,ie)=>{var pe=ry();let se;var ne=h(pe);ee(he=>{se=In(pe,"",se,he),K(ne,v(ie))},[()=>({background:np(v(ie))})]),T(Se,pe)}),T(re,me)};ae(U,re=>{e.item.tags&&e.item.tags.length>0&&re(C)})}var V=_(U,2);{var J=re=>{var me=sy(),Se=h(me);ee(()=>K(Se,e.item.reason)),T(re,me)};ae(V,re=>{e.item.reason&&!v(u)&&re(J)})}var F=_(b,2),le=h(F);{var xe=re=>{var me=iy(),Se=$e(me);Se.__click=()=>e.onmarkacted(e.item.emailId);var ie=_(Se,2);ie.__click=()=>e.ondismiss(e.item.emailId),T(re,me)},Ae=re=>{var me=oy(),Se=h(me);ee(()=>K(Se,e.item.status)),T(re,me)};ae(le,re=>{v(o)?re(xe):re(Ae,!1)})}var ve=_(le,2);{var te=re=>{var me=ly();me.__click=()=>e.onremove(e.item.emailId),T(re,me)};ae(ve,re=>{e.onremove&&re(te)})}var ce=_(g,2);{var we=re=>{var me=uy();let Se;var ie=h(me),pe=h(ie),se=_(ie,2);{var ne=he=>{var H=cy(),$=h(H);ee(()=>K($,e.item.reason)),T(he,H)};ae(se,he=>{e.item.reason&&he(ne)})}ee(()=>{Se=In(me,"",Se,{"border-left-color":n()}),K(pe,e.item.summary)}),T(re,me)};ae(ce,re=>{v(u)&&e.item.summary&&re(we)})}ee(()=>{p=Ct(g,1,"email-row svelte-1czytqk",null,p,{dimmed:a()}),w=In(b,"",w,{"border-left-color":n()}),K(x,e.item.subject),K(R,e.item.from)}),T(t,d),It()}Wt(["click"]);var fy=M('<span class="group-acted svelte-tl1unp"> </span>'),vy=M('<p class="group-empty svelte-tl1unp">No emails in this category.</p>'),py=M('<details class="handled-section svelte-tl1unp"><summary class="handled-summary svelte-tl1unp"> </summary> <!></details>'),hy=M('<button class="group-action-btn svelte-tl1unp">Clear group</button>'),my=M('<span class="confirm-row svelte-tl1unp"> <button class="group-action-btn svelte-tl1unp">Cancel</button> <button class="group-action-btn danger svelte-tl1unp">Delete</button></span>'),gy=M('<div class="group-body svelte-tl1unp"><!> <!> <!> <div class="group-footer svelte-tl1unp"><!></div></div>'),_y=M('<div class="action-group svelte-tl1unp"><button class="group-header svelte-tl1unp"><span class="group-badge svelte-tl1unp"> </span> <span class="group-count svelte-tl1unp"> </span> <!> <span class="spacer svelte-tl1unp"></span> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function yy(t,e){Pt(e,!0);let n=Me(e,"color",3,"#888");Me(e,"count",3,0);let a=Me(e,"items",19,()=>[]),i=Me(e,"expanded",3,!1),o=ht(()=>a().filter(J=>J.status==="pending")),u=ht(()=>a().filter(J=>J.status!=="pending")),d=Oe(!1);function g(J){return J.split("_").map(F=>F.charAt(0)+F.slice(1).toLowerCase()).join(" ")}var p=_y(),b=h(p);b.__click=function(...J){var F;(F=e.ontoggle)==null||F.apply(this,J)};var w=h(b);let k;var x=h(w),I=_(w,2),B=h(I),R=_(I,2);{var X=J=>{var F=fy(),le=h(F);ee(()=>K(le,`${v(u).length??""} handled`)),T(J,F)};ae(R,J=>{v(u).length>0&&J(X)})}var Y=_(R,4);let U;var C=_(b,2);{var V=J=>{var F=gy(),le=h(F);{var xe=Se=>{var ie=vy();T(Se,ie)};ae(le,Se=>{v(o).length===0&&v(u).length===0&&Se(xe)})}var Ae=_(le,2);Qt(Ae,17,()=>v(o),Se=>Se.emailId,(Se,ie)=>{Mc(Se,{get item(){return v(ie)},get actionColor(){return n()},get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove}})});var ve=_(Ae,2);{var te=Se=>{var ie=py(),pe=h(ie),se=h(pe),ne=_(pe,2);Qt(ne,17,()=>v(u),he=>he.emailId,(he,H)=>{Mc(he,{get item(){return v(H)},get actionColor(){return n()},get onremove(){return e.onremove},dimmed:!0})}),ee(()=>K(se,`${v(u).length??""} handled`)),T(Se,ie)};ae(ve,Se=>{v(u).length>0&&Se(te)})}var ce=_(ve,2),we=h(ce);{var re=Se=>{var ie=hy();ie.__click=()=>A(d,!0),T(Se,ie)},me=Se=>{var ie=my(),pe=h(ie),se=_(pe);se.__click=()=>A(d,!1);var ne=_(se,2);ne.__click=()=>{e.oncleargroup(),A(d,!1)},ee(()=>K(pe,`Clear ${a().length??""} items? `)),T(Se,ie)};ae(we,Se=>{v(d)?Se(me,!1):Se(re)})}T(J,F)};ae(C,J=>{i()&&J(V)})}ee(J=>{k=In(w,"",k,{background:n()}),K(x,J),K(B,v(o).length),U=Ct(Y,0,"chevron svelte-tl1unp",null,U,{open:i()})},[()=>g(e.action)]),T(t,p),It()}Wt(["click"]);var by=M(`<div class="section-desc svelte-10pcy9j">This is the system prompt sent to the LLM before each email. It instructs the model
            on how to classify emails and what JSON format to produce.</div> <pre class="code-block svelte-10pcy9j"> </pre>`,1),wy=M(`<div class="section-desc svelte-10pcy9j">Each email is formatted into this template and sent as the user message.
            The full email body is included.</div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Format:</div> <pre class="code-block template svelte-10pcy9j"></pre></div> <div class="template-format svelte-10pcy9j"><div class="format-label svelte-10pcy9j">Sample:</div> <pre class="code-block sample svelte-10pcy9j"> </pre></div>`,1),ky=M(`<div class="section-desc svelte-10pcy9j">These generation parameters control how the LLM produces its output
            for email classification.</div> <div class="config-grid svelte-10pcy9j"><div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">max_new_tokens</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Maximum tokens in the response (classification needs ~150)</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">enable_thinking</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Thinking mode disabled â structured JSON doesn't need reasoning</span></div> <div class="config-row svelte-10pcy9j"><span class="config-key svelte-10pcy9j">do_sample</span> <span class="config-val svelte-10pcy9j"> </span> <span class="config-desc svelte-10pcy9j">Greedy decoding â deterministic, consistent output</span></div></div> <div class="section-desc svelte-10pcy9j" style="margin-top: 1rem;">The full message array sent to the model:</div> <pre class="code-block svelte-10pcy9j"></pre>`,1),xy=M('<div class="backdrop svelte-10pcy9j"><div class="modal svelte-10pcy9j" role="dialog" aria-label="Prompt Inspector"><div class="modal-header svelte-10pcy9j"><h2 class="svelte-10pcy9j">Prompt Inspector</h2> <button class="close-btn svelte-10pcy9j" aria-label="Close">â</button></div> <div class="tabs svelte-10pcy9j"><button>System Prompt</button> <button>Email Template</button> <button>Generation Config</button></div> <div class="modal-body svelte-10pcy9j"><!></div></div></div>');function Sy(t,e){Pt(e,!0);let n=Me(e,"open",15,!1),a=Me(e,"sampleEmail",3,null),i=Oe("system");function o(){return a()?Yu(a()):["Subject: Your order has shipped!","From: orders@example.com","To: me","Date: Sat, Feb 15, 2026","Labels: INBOX, CATEGORY_UPDATES","","Hi! Your order #12345 has shipped via FedEx. Tracking number: 7891011..."].join(`
`)}function u(){n(!1)}function d(w){w.target===w.currentTarget&&u()}var g=pr(),p=$e(g);{var b=w=>{var k=xy();k.__click=d,k.__keydown=te=>te.key==="Escape"&&u();var x=h(k),I=h(x),B=_(h(I),2);B.__click=u;var R=_(I,2),X=h(R);let Y;X.__click=()=>A(i,"system");var U=_(X,2);let C;U.__click=()=>A(i,"email");var V=_(U,2);let J;V.__click=()=>A(i,"config");var F=_(R,2),le=h(F);{var xe=te=>{var ce=by(),we=_($e(ce),2),re=h(we);ee(()=>K(re,Ps)),T(te,ce)},Ae=te=>{var ce=wy(),we=_($e(ce),2),re=_(h(we),2);re.textContent=`Subject: {email.subject}
From: {email.from}
To: {email.to}
Date: {formatted date}
Labels: {email.labels}

{email.body (full content)`;var me=_(we,2),Se=_(h(me),2),ie=h(Se);ee(pe=>K(ie,pe),[o]),T(te,ce)},ve=te=>{var ce=ky(),we=_($e(ce),2),re=h(we),me=_(h(re),2),Se=h(me),ie=_(re,2),pe=_(h(ie),2),se=h(pe),ne=_(ie,2),he=_(h(ne),2),H=h(he),$=_(we,4);$.textContent=`[
  { role: "system", content: SYSTEM_PROMPT },
  { role: "user",   content: formatEmailPrompt(email) }
]`,ee(()=>{K(Se,Zv.maxTokens),K(se,"false"),K(H,"false")}),T(te,ce)};ae(le,te=>{v(i)==="system"?te(xe):v(i)==="email"?te(Ae,1):v(i)==="config"&&te(ve,2)})}ee(()=>{Y=Ct(X,1,"tab svelte-10pcy9j",null,Y,{active:v(i)==="system"}),C=Ct(U,1,"tab svelte-10pcy9j",null,C,{active:v(i)==="email"}),J=Ct(V,1,"tab svelte-10pcy9j",null,J,{active:v(i)==="config"})}),T(w,k)};ae(p,w=>{n()&&w(b)})}T(t,g),It()}Wt(["click","keydown"]);var Ty=M('<span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span>',1),Ey=M('<div class="summary-row svelte-s2dwjj"><span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <span class="sep svelte-s2dwjj">Â·</span> <span class="s-item"> </span> <!></div>'),Ay=M('<span class="confirm-inline svelte-s2dwjj"> <button class="link-btn svelte-s2dwjj">No</button> <button class="link-btn danger svelte-s2dwjj">Yes</button></span>'),Cy=M('<button class="chip svelte-s2dwjj"> </button>'),Py=M('<div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Clear by action group</div> <div class="group-chips svelte-s2dwjj"></div></div>'),Iy=M('<div class="confirm-row svelte-s2dwjj"><span>Clear all classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),Ry=M('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear all classifications</span> <span class="action-desc svelte-s2dwjj">Remove all LLM scan results. Emails stay.</span></button>'),Oy=M('<div class="confirm-row svelte-s2dwjj"><span>Delete all synced emails &amp; classifications?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),My=M('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear emails &amp; classifications</span> <span class="action-desc svelte-s2dwjj">Remove all synced Gmail data and scan results.</span></button>'),Dy=M('<div class="confirm-row svelte-s2dwjj"><span>Delete all contacts?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Delete</button></div>'),jy=M('<button class="action-row svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Clear contacts</span> <span class="action-desc svelte-s2dwjj">Remove extracted contacts from the database.</span></button>'),Ly=M('<div class="confirm-row nuke svelte-s2dwjj"><span>This will delete the entire database and reload the page. Are you sure?</span> <button class="link-btn svelte-s2dwjj">Cancel</button> <button class="link-btn danger svelte-s2dwjj">Wipe Everything</button></div>'),Ny=M('<button class="action-row nuke-btn svelte-s2dwjj"><span class="action-label svelte-s2dwjj">Wipe entire local storage</span> <span class="action-desc svelte-s2dwjj">Delete the IndexedDB database and reload. All data will be lost.</span></button>'),qy=M('<div class="busy-overlay svelte-s2dwjj">Working...</div>'),By=M('<div class="dm-panel svelte-s2dwjj"><!> <!> <div class="section svelte-s2dwjj"><div class="section-title svelte-s2dwjj">Bulk actions</div> <div class="btn-list svelte-s2dwjj"><!> <!> <!></div></div> <div class="section danger-section svelte-s2dwjj"><!></div> <!></div>'),Fy=M('<div class="dm svelte-s2dwjj"><button class="dm-toggle svelte-s2dwjj"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg> Data Management <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"></polyline></svg></button> <!></div>');function zy(t,e){Pt(e,!0);let n=Me(e,"groupOrder",19,()=>[]),a=Oe(!1),i=Oe(null),o=Oe(!1),u=Oe(null);async function d(){var ve;const[F,le,xe]=await Promise.all([Ge.items.where("sourceType").equals("gmail").count(),Ge.emailClassifications.count(),Ge.contacts.count()]);let Ae=0;try{const te=await((ve=navigator.storage)==null?void 0:ve.estimate());Ae=(te==null?void 0:te.usage)??0}catch{}A(u,{emailCount:F,classCount:le,contactCount:xe,totalBytes:Ae},!0)}function g(F){return F?F<1024?`${F} B`:F<1024*1024?`${(F/1024).toFixed(1)} KB`:`${(F/(1024*1024)).toFixed(1)} MB`:"â"}function p(){A(a,!v(a)),v(a)&&d()}async function b(F){var le;A(o,!0),A(i,null);try{await F(),await d(),(le=e.onrefresh)==null||le.call(e)}finally{A(o,!1)}}async function w(){await b(()=>dc())}async function k(F){await b(()=>dl(F))}async function x(){await b(async()=>{await Ju(),await dc()})}async function I(){await b(()=>Ge.contacts.clear())}async function B(){await b(async()=>{await Ge.delete(),window.location.reload()})}function R(F){return F.split("_").map(le=>le.charAt(0)+le.slice(1).toLowerCase()).join(" ")}var X=Fy(),Y=h(X);Y.__click=p;var U=_(h(Y),2);let C;var V=_(Y,2);{var J=F=>{var le=By(),xe=h(le);{var Ae=z=>{var Re=Ey(),De=h(Re),Be=h(De),Tt=_(De,4),kt=h(Tt),Xt=_(Tt,4),fn=h(Xt),Zt=_(Xt,2);{var Lt=Ye=>{var et=Ty(),Ft=_($e(et),2),Jt=h(Ft);ee(mn=>K(Jt,`${mn??""} used`),[()=>g(v(u).totalBytes)]),T(Ye,et)};ae(Zt,Ye=>{v(u).totalBytes&&Ye(Lt)})}ee(()=>{K(Be,`${v(u).emailCount??""} emails`),K(kt,`${v(u).classCount??""} classifications`),K(fn,`${v(u).contactCount??""} contacts`)}),T(z,Re)};ae(xe,z=>{v(u)&&z(Ae)})}var ve=_(xe,2);{var te=z=>{var Re=Py(),De=_(h(Re),2);Qt(De,21,n,yn,(Be,Tt)=>{var kt=pr(),Xt=$e(kt);{var fn=Lt=>{var Ye=Ay(),et=h(Ye),Ft=_(et);Ft.__click=()=>A(i,null);var Jt=_(Ft,2);Jt.__click=()=>k(v(Tt)),ee(mn=>{K(et,`Delete ${mn??""}? `),Jt.disabled=v(o)},[()=>R(v(Tt))]),T(Lt,Ye)},Zt=Lt=>{var Ye=Cy();Ye.__click=()=>A(i,`group:${v(Tt)}`);var et=h(Ye);ee(Ft=>{Ye.disabled=v(o),K(et,`${Ft??""} â`)},[()=>R(v(Tt))]),T(Lt,Ye)};ae(Xt,Lt=>{v(i)===`group:${v(Tt)}`?Lt(fn):Lt(Zt,!1)})}T(Be,kt)}),T(z,Re)};ae(ve,z=>{n().length>0&&z(te)})}var ce=_(ve,2),we=_(h(ce),2),re=h(we);{var me=z=>{var Re=Iy(),De=_(h(Re),2);De.__click=()=>A(i,null);var Be=_(De,2);Be.__click=w,ee(()=>Be.disabled=v(o)),T(z,Re)},Se=z=>{var Re=Ry();Re.__click=()=>A(i,"classifications"),ee(()=>Re.disabled=v(o)),T(z,Re)};ae(re,z=>{v(i)==="classifications"?z(me):z(Se,!1)})}var ie=_(re,2);{var pe=z=>{var Re=Oy(),De=_(h(Re),2);De.__click=()=>A(i,null);var Be=_(De,2);Be.__click=x,ee(()=>Be.disabled=v(o)),T(z,Re)},se=z=>{var Re=My();Re.__click=()=>A(i,"emails"),ee(()=>Re.disabled=v(o)),T(z,Re)};ae(ie,z=>{v(i)==="emails"?z(pe):z(se,!1)})}var ne=_(ie,2);{var he=z=>{var Re=Dy(),De=_(h(Re),2);De.__click=()=>A(i,null);var Be=_(De,2);Be.__click=I,ee(()=>Be.disabled=v(o)),T(z,Re)},H=z=>{var Re=jy();Re.__click=()=>A(i,"contacts"),ee(()=>Re.disabled=v(o)),T(z,Re)};ae(ne,z=>{v(i)==="contacts"?z(he):z(H,!1)})}var $=_(ce,2),fe=h($);{var ue=z=>{var Re=Ly(),De=_(h(Re),2);De.__click=()=>A(i,null);var Be=_(De,2);Be.__click=B,ee(()=>Be.disabled=v(o)),T(z,Re)},ke=z=>{var Re=Ny();Re.__click=()=>A(i,"nuke"),ee(()=>Re.disabled=v(o)),T(z,Re)};ae(fe,z=>{v(i)==="nuke"?z(ue):z(ke,!1)})}var Ke=_($,2);{var Ve=z=>{var Re=qy();T(z,Re)};ae(Ke,z=>{v(o)&&z(Ve)})}T(F,le)};ae(V,F=>{v(a)&&F(J)})}ee(()=>C=Ct(U,0,"chev svelte-s2dwjj",null,C,{open:v(a)})),T(t,X),It()}Wt(["click"]);var Ky=M('<div class="error-card svelte-12gkq0i"><span> </span> <button class="error-dismiss svelte-12gkq0i">â</button></div>'),Uy=M('<div class="groups-list svelte-12gkq0i"></div> <div class="actions-footer svelte-12gkq0i"><span class="footer-stat svelte-12gkq0i"> </span></div>',1),Gy=M('<div class="empty-state svelte-12gkq0i"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path><rect x="9" y="3" width="6" height="4" rx="1"></rect><path d="m9 14 2 2 4-4"></path></svg> <h3 class="svelte-12gkq0i">No emails classified yet</h3> <p class="svelte-12gkq0i">Click <strong>Scan New</strong> to classify your recent emails. The LLM will determine action types, tags, and summaries automatically.</p></div>'),Wy=M('<div class="actions-container svelte-12gkq0i"><!> <!> <!> <!> <!></div>');function Hy(t,e){Pt(e,!0);let n=Me(e,"groups",19,()=>({})),a=Me(e,"groupOrder",19,()=>[]),i=Me(e,"counts",19,()=>({})),o=Me(e,"stats",3,null),u=Me(e,"expandedGroup",3,null),d=Me(e,"isScanning",3,!1),g=Me(e,"scanProgress",3,null),p=Me(e,"scanCount",15,20),b=Me(e,"error",3,null),w=Oe(!1),k=ht(()=>{for(const J of a()){const F=n()[J];if((F==null?void 0:F.length)>0)return F[0]}return null});var x=Wy(),I=h(x);ty(I,{get engineStatus(){return e.engineStatus},get modelName(){return e.modelName},get isScanning(){return d()},get scanProgress(){return g()},get stats(){return o()},get onscan(){return e.onscan},get onrescan(){return e.onrescan},get onstop(){return e.onstop},get oncloseprogress(){return e.oncloseprogress},oninspect:()=>A(w,!0),get scanCount(){return p()},set scanCount(J){p(J)}});var B=_(I,2);Sy(B,{get sampleEmail(){return v(k)},get open(){return v(w)},set open(J){A(w,J,!0)}});var R=_(B,2);{var X=J=>{var F=Ky(),le=h(F),xe=h(le),Ae=_(le,2);Ae.__click=function(...ve){var te;(te=e.ondismisserror)==null||te.apply(this,ve)},ee(()=>K(xe,b())),T(J,F)};ae(R,J=>{b()&&J(X)})}var Y=_(R,2);{var U=J=>{var F=Uy(),le=$e(F);Qt(le,20,a,te=>te,(te,ce)=>{{let we=ht(()=>qo(ce)),re=ht(()=>{var ie;return((ie=n()[ce])==null?void 0:ie.length)||0}),me=ht(()=>n()[ce]||[]),Se=ht(()=>u()===ce);yy(te,{get action(){return ce},get color(){return v(we)},get count(){return v(re)},get items(){return v(me)},get expanded(){return v(Se)},ontoggle:()=>e.ontogglegroup(ce),get onmarkacted(){return e.onmarkacted},get ondismiss(){return e.ondismiss},get onremove(){return e.onremove},oncleargroup:()=>e.oncleargroup(ce)})}});var xe=_(le,2),Ae=h(xe),ve=h(Ae);ee(()=>K(ve,`${i().total??""} emails classified into ${a().length??""} groups`)),T(J,F)},C=J=>{var F=Gy();T(J,F)};ae(Y,J=>{i().total>0?J(U):d()||J(C,1)})}var V=_(Y,2);zy(V,{get groupOrder(){return a()},get onrefresh(){return e.onrefresh}}),T(t,x),It()}Wt(["click"]);var Vy=M('<div class="actions-page svelte-3tch4q"><!></div>');function Yy(t,e){Pt(e,!0);const n=Du();let a=Oe(Gt(n.status)),i=Oe(""),o=Oe(Gt({})),u=Oe(Gt([])),d=Oe(Gt({total:0})),g=Oe(null),p=Oe(null),b=Oe(!1),w=Oe(null),k=Oe(3),x=Oe(null),I=Oe(null);dn(()=>{const ve=n.onMessage(te=>{if(te.status==="ready"){A(a,"ready");const ce=Pr.find(me=>me.id===n.modelId),we=hr.find(me=>me.name===n.modelId),re=ce||we;A(i,(re==null?void 0:re.name)||(re==null?void 0:re.displayName)||n.modelId||"",!0)}te.status==="loading"&&A(a,"loading")});if(A(a,n.status,!0),n.modelId){const te=Pr.find(re=>re.id===n.modelId),ce=hr.find(re=>re.name===n.modelId),we=te||ce;A(i,(we==null?void 0:we.name)||(we==null?void 0:we.displayName)||n.modelId||"",!0)}return B(),()=>ve()});async function B(){try{const ve=await Jv();A(o,ve.groups,!0),A(u,ve.order,!0),A(d,await $v(),!0),A(g,await No(),!0)}catch(ve){A(x,`Failed to load data: ${ve.message}`)}}async function R(){await Y(!1)}async function X(){await Y(!0)}async function Y(ve){if(v(b)||!n.isReady)return;A(x,null),A(b,!0),A(w,null);const te=new AbortController;A(I,te,!0);try{await Hu(n,{count:v(k),force:ve,signal:te.signal,onProgress:ce=>{A(w,{...ce},!0)}}),await B()}catch(ce){te.signal.aborted||A(x,`Scan failed: ${ce.message}`)}finally{A(b,!1),A(I,null)}}function U(){var ve;(ve=v(I))==null||ve.abort()}async function C(ve){await xi(ve,"acted"),await B()}async function V(ve){await xi(ve,"dismissed"),await B()}async function J(ve){await Vu(ve),await B()}async function F(ve){await dl(ve),await B()}function le(ve){A(p,v(p)===ve?null:ve,!0)}var xe=Vy(),Ae=h(xe);Hy(Ae,{get engineStatus(){return v(a)},get modelName(){return v(i)},get groups(){return v(o)},get groupOrder(){return v(u)},get counts(){return v(d)},get stats(){return v(g)},get expandedGroup(){return v(p)},get isScanning(){return v(b)},get scanProgress(){return v(w)},get error(){return v(x)},onscan:R,onrescan:X,ontogglegroup:le,onmarkacted:C,ondismiss:V,onremove:J,oncleargroup:F,ondismisserror:()=>A(x,null),onstop:U,onrefresh:B,oncloseprogress:()=>A(w,null),get scanCount(){return v(k)},set scanCount(ve){A(k,ve,!0)}}),T(t,xe),It()}var Qy=M('<div class="app-shell svelte-1n46o8q"><nav class="top-nav svelte-1n46o8q"><a class="nav-brand svelte-1n46o8q" href="#chat">me-ai</a> <div class="nav-links svelte-1n46o8q"><a href="#chat">Chat</a> <a href="#actions">Actions</a> <a href="#dashboard">Dashboard</a></div></nav> <main class="svelte-1n46o8q"><div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div> <div class="page-view svelte-1n46o8q"><!></div></main></div>');function Xy(t,e){Pt(e,!0);function n(){const F=location.hash;return F==="#dashboard"?"dashboard":F==="#actions"?"actions":"chat"}let a=Oe(Gt(n()));dn(()=>{function F(){A(a,n(),!0)}return window.addEventListener("hashchange",F),()=>window.removeEventListener("hashchange",F)});var i=Qy(),o=h(i),u=_(h(o),2),d=h(u);let g;var p=_(d,2);let b;var w=_(p,2);let k;var x=_(o,2),I=h(x);let B;var R=h(I);Oh(R,{});var X=_(I,2);let Y;var U=h(X);Yy(U,{});var C=_(X,2);let V;var J=h(C);f_(J,{}),ee(()=>{g=Ct(d,1,"svelte-1n46o8q",null,g,{active:v(a)==="chat"}),b=Ct(p,1,"svelte-1n46o8q",null,b,{active:v(a)==="actions"}),k=Ct(w,1,"svelte-1n46o8q",null,k,{active:v(a)==="dashboard"}),B=In(I,"",B,{display:v(a)==="chat"?"flex":"none"}),Y=In(X,"",Y,{display:v(a)==="actions"?"flex":"none"}),V=In(C,"",V,{display:v(a)==="dashboard"?"flex":"none"})}),T(t,i),It()}nv(Xy,{target:document.getElementById("app")});
